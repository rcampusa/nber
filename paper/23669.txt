                              NBER WORKING PAPER SERIES




                 INDIRECT INFERENCE WITH IMPORTANCE SAMPLING:
                    AN APPLICATION TO WOMEN’S WAGE GROWTH

                                       Robert M. Sauer
                                      Christopher R. Taber

                                       Working Paper 23669
                               http://www.nber.org/papers/w23669


                     NATIONAL BUREAU OF ECONOMIC RESEARCH
                              1050 Massachusetts Avenue
                                Cambridge, MA 02138
                                    August 2017




The views expressed herein are those of the authors and do not necessarily reflect the views of the
National Bureau of Economic Research.

NBER working papers are circulated for discussion and comment purposes. They have not been
peer-reviewed or been subject to the review by the NBER Board of Directors that accompanies
official NBER publications.

© 2017 by Robert M. Sauer and Christopher R. Taber. All rights reserved. Short sections of text,
not to exceed two paragraphs, may be quoted without explicit permission provided that full
credit, including © notice, is given to the source.
Indirect Inference with Importance Sampling: An Application to Women’s Wage Growth
Robert M. Sauer and Christopher R. Taber
NBER Working Paper No. 23669
August 2017
JEL No. C51,J16

                                         ABSTRACT

This paper has two main parts. In the first, we describe a method that smooths the objective
function in a general class of indirect inference models. Our smoothing procedure makes use of
importance sampling weights in estimation of the auxiliary model on simulated data. The
importance sampling weights are constructed from likelihood contributions implied by the
structural model. Since this approach does not require transformations of endogenous variables in
the structural model, we avoid the potential approximation errors that may arise in other
smoothing approaches for indirect inference. We show that our alternative smoothing method
yields consistent estimates. The second part of the paper applies the method to estimating the
effect of women’s fertility on their human capital accumulation. We find that the curvature in the
wage profile is determined primarily by curvature in the human capital accumulation function as
a function of previous human capital, as opposed to being driven primarily by age. We also find a
modest effect of fertility induced nonemployment spells on human capital accumulation. We
estimate that the difference in wages among prime age women would be approximately 3%
higher if the relationship between fertility and working were eliminated.


Robert M. Sauer
Royal Holloway College
University of London
Egham, Surrey TW20 0EX
United Kingdom
robert.sauer@rhul.ac.uk

Christopher R. Taber
Department of Economics
University of Wisconsin -Madison
1180 Observatory Dr
Social Sciences Building #6448
Madison, WI 53706-1320
and NBER
ctaber@ssc.wisc.edu
1    Introduction
Indirect inference is an increasingly common way to estimate complex econometric models.
Similar to the simulated method of moments, it is a computationally practical technique since
it relies on unconditional simulations of the model to obtain structural estimates. In contrast
to the simulated method of moments, indirect inference involves estimating a reduced-form
auxiliary model. The auxiliary model is estimated on the actual data as well as simulated
data from the structural model. Structural estimates are found by minimizing the distance
between the two sets of reduced-form auxiliary parameter estimates.
    A nice property of indirect inference is that consistent structural estimates are obtained
even if the the auxiliary model is not an exact reduced form of the structural model. The only
requirement for identification and consistent estimation is that each structural parameter has
an independent effect on at least one parameter of the auxiliary model. The specification of
the auxiliary model has implications for efficiency only. When the auxiliary model is an exact
reduced form of the structural model, indirect inference is analogous to maximum likelihood
(Smith, 1993, 1990, Gourieroux, Monfort, and Renault, 1993, Gallant and Tauchen, 1996,
and Gourieroux and Monfort, 1996).
    One of the main practical problems with indirect inference is the computational difficulty
of optimizing the objective function when the structural model contains discrete choices (see,
e.g., Magnac, Robin, and Visser, 1995, An and Liu, 2000, or Nagypál, 2007). In this case,
a step function often arises because a small change in structural parameters causes a jump
in the metric of distance between the two sets of auxiliary model parameter estimates. A
non-smooth objective function precludes the use of gradient-based numerical optimization
methods leading to slow convergence and difficulties in obtaining standard errors. More-
over, non-differentiability of the objective function may lead to estimates that are consistent
but not asymptotically normal (see Gallant and Tauchen, 1996, and Hansen, Heaton, and
Luttmer, 1995, in the context of GMM). A main purpose of this paper is to propose a flexible
strategy for this problem that involves the use of importance sampling.
    In this paper, we explain how the problem of non-differentiability can be solved using
Monte Carlo importance sampling (see e.g. Kloek and van Dijk, 1978, or Kloek and van Dijk,
1978) in a general class of indirect inference models. We smooth the objective function by
making use of importance sampling weights in estimation of the auxiliary model on simulated
data. The denominator of the weight is the likelihood contribution of each observation in
the simulated sample, at an initial trial vector of structural parameters. The denominator
remains fixed during minimum distance iterations. The numerator of the weight is the
likelihood contribution at the updated trial vector of parameters. The importance sampling
weights can be formed with either the exact likelihood of the structural model or a simulated


                                              1
likelihood in case the former is difficult to construct. We show that this alternative technique
which is explained in the context of Simulated Method of Moments by Gourieroux and
Monfort (1996) and Ackerberg (2009) can be extended to indirect inference to yield structural
parameter estimates that are consistent. While this extension is straight forward, in our
view it is a very useful approach which is underused in the empirical literature using indirect
inference models.
    In order to deal with the problem of non-differentiability, Bruins et al. (2017) propose an
alternative method, called generalized indirect inference (GII), that replaces the the discrete
endogenous variables in the structural model with a logistic-kernel of simulated latent utilities
(see also McFadden, 1989). Consistent structural parameter estimates are obtained as the
smoothing parameter in the logistic kernel goes to zero. However, considerable approximation
error and small sample bias may arise for any non-zero smoothing parameter, especially when
discrete outcomes accumulate in the structural model. This arises in models that contain
variables such as endogenous work experience and tenure (see Altonji et al., 2013). We
view our approach as an additional tool rather than as an alternative to GII. For some
problems GII may work better, but we suspect that there are others for which our approach
is preferable.
    The second main contribution of this paper is empirical. We are motivated by the finding
that the wage profile of men is much steeper than that of women (see figure 1). We apply
indirect inference with importance sampling in this context by estimating a continuous time
Markov model of female work, marriage, and fertility using data from the Survey of Income
and Program Participation. Our specific goal is to understand the importance of child care
related non-employment spells in explaining the gender gap in wage growth. In the model,
women move into and out of work as well as into and out of marriage. They also have
children. Importantly, the number of children influence labor supply which affects human
capital. Note that if the curvature of the female wage profile is purely due to previous human
capital, when mothers re-enter the labor market they can expect rapid wage growth because
they have relatively low levels of human capital. By contrast, if the flattening is due to age,
and they re-enter mid-life, they would expect slower wage growth.
    We have two main empirical findings. We show that the curvature in the wage profile is
determined primarily by curvature in the human capital accumulation function as a function
of previous human capital, as opposed to being driven primarily by age. We then measure
the extent to which women’s dropping out of the labor force for fertility related reasons
suppresses human capital accumulation. Our finding is that it does so to a modest extent.
Wages among prime age women would be approximately 3% higher if fertility did not affect
women’s labor supply.
    The rest of this paper is organized as follows. In the next section, we provide a more


                                               2
detailed background on the method of Bruins et al. (2017) and on importance sampling
in order to put the alternatives in context. Section 3 defines the basic setup for indirect
inference. In section 4, we describe our alternative method in more detail. Section 5 provides
several examples. Section 6 includes our empirical work and section 7 concludes.



2     Background and Previous Work on Smoothing in Indi-
      rect Inference
Indirect inference has become a very important tool for estimation of econometric models. We
avoid a long survey here as it has been discussed widely. Key papers are Smith (1993,1990)
and Gourieroux, Monfort, and Renault (1993). The econometrics is discussed in detail in
Gourieroux and Monfort (1996). The basic idea is to estimate auxiliary parameters from the
data and match them to the model. That is, the auxiliary model is estimated on the real data
and also estimated on data simulated from the model. The underlying parameters are chosen
to minimize the distance between the model estimated auxiliary parameters and simulated
auxiliary parameters. We discuss this in more detail below. The problem addressed in
this paper is that the mapping between the underlying parameters and simulated auxiliary
parameters is often not smooth which complicates estimation and inference. We show how
to use importance weight sampling to smooth this relationship.
    Another approach to smoothing is provided by the method of generalized indirect infer-
ence (GII) proposed by Bruins et al. 2017. It replaces the discrete outcome simulated by
the structural model with a logistic-kernel transformation of simulated latent utilities. The
resulting objective function is smooth because the latent utilities are smooth functions of
the structural parameters, and the logistic-kernel is a smooth function of the latent utilities.
                                                      
    In order to illustrate GII formally, let yeh (β) ≡ yeith (β) , h = 1, ..., H, denote H statisti-
cally independent simulated choice sequences for a given trial vector of structural parameters,
β, using the same set of observed exogenous variables x ≡ {xit }. The auxiliary model is
                                
estimated separately for each yeith (β) yielding θeh (β). That is, θeh (β) solves:

                                  θeh (β) = arg max L yeh (β) ; x, θ
                                                                       
                                                  θ


    where L (·) is the likelihood associated with the auxiliary model.1 Since yeh (β) is a step
   1
     Auxiliary parameter estimates may be obtained using other statistical methods. Maximum likelihood is
referred to without loss of generality.




                                                      3
function, so is θeh (β). The same is true for

                                                       H
                                                    1 Xe
                                            θ (β) =
                                            e             θh (β)
                                                    H h=1

    whose distance from θb is minimized to obtain structural parameters estimates via indirect
inference.
    θb is obtained as
                                    θb = arg max L (y; x, θ)
                                                      θ

    using the observed choice sequence in the data y ≡ {yit }.
    Note that structural parameter estimates produced by indirect inference are consistent as
long as θb and θe (β0 ) converge to the same “pseudo” true value θ0 = h(β0 ) as the sample size
N grows. h is referred to as the “binding” function by Gourieroux, Monfort, and Renault
(1993). Underlying GII, and our alternative method, is the insight that the estimation
procedures applied to the observed and simulated data sets can differ, as long as they both
yield consistent estimates of the same vector of pseudo true parameter values (see also Genton
and Ronchetti, 2003). Our methods differ in how we smooth the function θe (β), and avoid
the need to optimize a step function.
    In order to illustrate how GII smooths θe (β), denote u              ehit (β) as individual i’s set of latent
utilities in time t for the first J − 1 choice options in simulated data set m. Define a smooth
                                                                                    
function of latent utilities g u      ehit (β) , j; λ such that g u   ehit (β) , j; λ converges to yeitj
                                                                                                      h
                                                                                                         (β) (the
simulated choice out of the J −1 alternatives in time t) as the smoothing parameter λ goes to
                                              
zero. GII substitutes g u                              h
                               ehit (β) , j; λ for yeitj (β) in computation of θe (β). Thus, the objective
function is smooth and θe (β0 ) converges to θ0 as λ goes to zero and N goes to infinity, with
H and T fixed.
                            
    The g u  ehit (β) , j; λ Bruins et al. (2017) use in their Monte Carlo experiments is the
logistic-kernel,                                                                
                                    h
                                                          exp u ehitj (β) /λ
                              g u eit (β) , j; λ =                                    .
                                                       1 + J−1             h
                                                          P
                                                             k=1 exp     u
                                                                         e itk (β)  /λ
   Monte Carlo experiments on four specific types of discrete choice models show that their
method, combined with very flexible auxiliary models, yields structural parameter estimates
with little bias and an efficiency level close to that produced by simulated maximum likeli-
hood (using the GHK algorithm).2
   2
    The four discrete choice models are, i) a two-alternative dynamic probit model with serially correlated
errors, ii) a two-alternative dynamic probit model with serially correlated errors and a lagged dependent
variable, iii) the same model as in (ii) with an initial conditions problem, and iv) a static three-alternative
probit model with contemporaneously correlated errors. The model with the initial conditions problem is
not estimated by SML due to complications arising from the initial conditions problem.


                                                          4
    In models where past simulated choices are transformed into a state variable which deter-
mines current period choices, the g(·) functions corresponding to previous period choices can
be accumulated over time. This is a straightforward extension of the Bruins et al. (2017)
approach. However, this strategy can further exacerbate the inherent measurement error
problem (see Altonji, Smith, and Vidangos, 2013 and Guvenen and Smith, 2014).
    Importance sampling has a long history, and the use of importance sampling with Monte
Carlo to simulate expectations goes back at least to Kloek and van Dijk (1978). It has
been used for smoothing objective functions in simulated maximum likelihood (see Keane
and Sauer, 2010, for discussion). It was discussed by McFadden (1989) as a way to smooth
his simulated method of moments approach. A particularly relevant paper is Ackerberg
(2009) who discusses cases in which it can greatly simplify simulated method of moments
and simulated maximum likelihood models. Our main methodological contribution is to
extend this methodology to a general class of indirect inference models as well as providing
some additional examples. Lee (2012), Han (2016), and Fu and Gregory (2016) have applied
our approach.



3    Basic Setup for Indirect Inference
Our framework is very similar to Chapter 4 in Gourieroux and Monfort (1996) but we focus
on a narrower (though still large) set of problems for which our importance weight sampling
is natural. We also focus on the cross section and panel data version rather than the time
series version. We explicitly derive the asymptotic properties using importance weights. The
basic properties are quite similar.
    We assume that the econometrician observes (Yi , Xi ) which are i.i.d. and both Xi and Yi
are potentially large dimensional (Kx and Ky ). Here Xi is exogenous in the sense that it is
determined outside the model and is i.i.d. coming from underlying distribution Ξ0 .
    We write the data generating process as

                                       Yi ≡ y(Xi , ui ; θ)

where ui is an i.i.d. vector error term with distribution

                                           Ψ(ui ; θ).

Both Ψ and y are known up to parameter θ ∈ Θ ⊂ <Kθ and we write the true value as θ0 .
We mean this notation to be general enough to represent a complicated system with lagged
dependent variables and/or equlibrium, but we assume it can be written in reduced form

                                               5
using y.3
   To apply indirect inference assume that we can write our auxiliary model as

                                                     N
                                                                            !
                                                  1 X
                             βb = argminβ F             g(Xi , Yi , β), β
                                                  N i=1

where β ∈ B ⊂ RKβ . Here we take g to be a function g : RKx × RKy × B → RKg while F :
RKg +Kβ → R. We have written this in a general enough way that it can incorporate a typical
M-estimator such as maximum likelihood. In that case g would be the negative of the log-
likelihood function and F would be degenerate. It can also incorporate a Generalized Method
of Moments type estimator in which g would be the moments so that E [g(Xi , Yi , β)] = 0
and F would be the function:

                                           F (g, β) =g 0 W g

where W is some weighting matrix. We could also use it to represent a quantile or quantile
regression.
   Define the population value of βb to be

                                β0 ≡argminβ F (E [g(Xi , Yi , β)] , β).

    To see the idea of indirect inference in this context let Ξ be a potential distribution of
Xi , then the data generation process is known up to (Ξ, θ) . Define the population functions
                                    ˆ ˆ
                        G(θ, β) ≡         g(x, y(x, u; θ), β)dF (u | θ) dΞ0 (x)

and what Gourieroux, Montfort and Renault (1993) refer to as the binding function

                                  B(θ) =argminβ F (G(θ, β), β) .

Note that B(θ0 ) = β0 . Identification of Ξ0 is straight forward since Xi is observable, which
is why we mostly abstract from it. Essentially what one needs for identification is that this
equation is invertible so that knowledge of β0 is sufficient for knowledge of θ. In that case,
since the model is known up to parameter θ, the function B(θ) is known. Thus, we could
just invert β to obtain an estimate of θ0 .
    In practice we typically do not have a closed form for B. Instead, we need to use simulation
   3
     One can think of y as the function used by the computer code that produces simulated data given Xi ,
ui , and the parameter value θ. If there are mulitiple equlibria the code must have some form of choosing
between them. The same mechanism would be incorporated into y.



                                                   6
estimators in order to approximate B(θ). A typical approach is to generate H difference
simulated samples each with size S. For each observation we draw uhs randomly from the
distribution Ψ calculate Xhs from the empirical distribution of Xi .4 We then define

                            H                         S
                                                                                           !
                         1 X                       1X
                  B(θ) ≡
                  e            argminβ F                 g(Xhs , y(Xhs , uhs ; θ); β), β
                         H h=1                     S s=1

and choose                                          0         
                               θb = argminθ B(θ)
                                             e   − βb Ω B(θ)
                                                          e  − βb

where Ω is a weighting matrix.



4       Indirect Inference with Importance Sampling Weights
A major problem with this procedure is that often some components the dependent variable
vector, Yhs (θ) is discrete so that a small change in the parameters can lead to discontinuous
jumps in y(Xi , ui ; θ). This leads the objective function to be discontinuous as well. In
principle, with enough simulations we could make this as smooth as we would like, but in
practice this can be a major problem and minimizing the objective function can be difficult.
The Bruins et al. (2017) approach is to smooth Yhs (θ). There are two drawbacks to this
approach. First, one must choose a smoothing parameter. Second, it will not work for all
cases.5 Hence, we describe an alternative method.
    We assume that there is missing data, so the econometrician does not generally get to
observe the full set of potential data, but only a subset of it. The key component of our
analysis is Υi which one can think of as a superset of the data. The actual empirical economist
does not get to observe Υi , but the data simulator can observe this. In a typical problem
there are multiple ways to choose Υi , and finding the best one will be computationally very
important. This is essentially what Ackerberg (2009) discusses as a “change in variables.” 6
He makes some stronger assumptions on these variables than we do which give particularly
nice computational results. We are somewhat more general, but the the basic idea is similar.
    4
     There are different ways to obtain Xhs . One possibility is to take S = N and all of the Xi that we see in
the data, that is choose Xhs = Xs . Alternatively we could draw randomly from the empirical distribution
of Xi . What is crucial is that the distribution we use converges to Ξ0 .
   5
     At least there are models in which we have not figured out how to use their approach. Our example 5.4
and empirical example are cases.
   6
     He denotes it by u(Xi , i , θ) rather than Υi .




                                                      7
   We express the data generation process as:

                                         Υi ∼`(· | Xi ; θ)
                                         Yi =yΥ (Υi , Xi ; θ)

where the likelihood function ` and the data generating function yΥ are known up to pa-
rameter θ. While the distinction between Υi and Yi may seem arbitrary at this point, its
usefulness should become clear in the examples below. What will be important to get the
model to be well behaved is that ` and yΥ should be differentiable in θ and that ` should be
relatively easy to compute.
    Our approach is the following: Obtain the values of Xhs from the empirical distribution
of Xi . Generate Υhs ex-ante without regards to θ using the distribution `0 (Υhs ; Xhs ).


   1. For any given θ Calculate `(Υhs ; Xhs , θ) as the likelihood function of Υhs given θ


       (a) Calculate

                       H                       S
                                                                                                         !
                    1 X                     1 X `(Υhs ; Xhs , θ)
             B(θ)
             e    ≡       argminβ F                               g (Xhs , yΥ (Υhs , Xhs ; θ) ; β) , β
                    H h=1                   S s=1 `0 (Υhs ; Xhs )




Now choose                                       0         
                            θb = argminθ B(θ)
                                          e   − βb Ω B(θ)
                                                       e  − βb .

    First, note that standard indirect inference as it typically is practiced is a special case
of this. To avoid jumps in the objective function researchers typically draw the random
variables that determine outcomes first and then fix these values through the estimation.
For example if the distribution of an underlying random variable uhs does not depend on
θ, one would draw the uhs one time at the beginning of the program and we would choose
Υhs = uhs . In this case `(Υhs ; Xhs , θ) = `0 (Υhs ; Xhs ) so the ratio of the likelihoods would just
be one and this would be the standard estimator. When uhs does depend on parameters,
typically one would draw underlying random variables that do not depend on θ and write
uhs as a parametric function of those underlying variables. We discuss this point below.
    The key improvement of this approach relative to the base model is that if we choose Υhs
in the appropriate way, yΥ (Υhs , Xhs ; θ) and thus B(θ) e      will be continuous and differentiable
functions of θ as long as ` and F are continuous and differentiable functions. This makes
both estimation and formation of standard errors much easier. To keep our results general

                                                  8
enough to cover the base case, in our formal results we do not impose that yΥ (Υhs , Xhs ; θ)
is continuous.
    To see the basic intuition of the approach, suppose that Υhs has a continuous distribu-
tion and ignore X 0 s. Let Es denote the expected value from the simulation. Since in the
simulation Υhs was drawn from the density `0 ,
                                                 ˆ
            `(Υhs ; θ)                                `(Υhs ; θ)
   Es                  g (Xhs , yΥ (Υhs ; θ) ; β) =              g (Xhs , yΥ (Υhs ; θ) ; β) `0 (Υhs )dΥhs
             `0 (Υhs )                                 ` (Υ )
                                                    ˆ 0 hs
                                                  = g (Xhs , yΥ (Υhs ; θ) ; β) `(Υhs ; θ)dΥhs

                                                 =G(θ, β).

Thus, using importance sampling gives a consistent estimate of the function G(θ, β). Impor-
tantly, we will approximate this integral using a Monte Carlo procedure where we draw Υhs
from the distribution `0 (Υhs ), then

                                  S
                               1 X `(Υhs ; θ)
                                               g (yΥ (Υhs ; θ) ; β) ≈ G(θ, β)
                               S s=1 `0 (Υhs )

but most important, as long as `(Υhs ; θ) and yΥ (Υhs ; θ) are smooth functions of θ, then this
approximation is a smooth function of θ.



4.1     Consistency
We first show consistency of the estimator.
  Define
                                             N
                                        1    X
                                 G(β)
                                 b    ≡             g(Xi , Yi , β)
                                        N     i=1
                                            S
                                         1 X `(Υhs ; Xhs , θ)
                             Gh (θ, β) ≡
                             e                                 g(Xhs , Yhs ; β).
                                         S s=1 `0 (Υhs ; Xhs )

   We need the following assumptions:

Assumption 1 G(β)
             b    converges uniformly in probability to G(θ0 , β).

   The key aspect of this is that g is well behaved so that this convergence is uniform. Note
that we are being general enough not to require the expressions to be differential in the
underlying function θ but are assuming that the auxiliary model that we estimate on the
actual data is simple.

                                                         9
   The next are standard regularity assumptions as well as a condition for identification of
B(θ).

Assumption 2 Θ and B are compact.

Assumption 3 For each θ ∈ Θ, B(θ) is a singleton. F ,g, and B are continuous.

Presumably one could relax the assumption of point identification of B(θ) allowing this to
be a set and modify the objective function so that the set B(θ)
                                                             b is close to the set β.
                                                                                   b This
seems straight forward, but we do not know of an empirical researcher that has done this,
so we focus on the point identified case.
   Next we have the identification assumption for θ :

Assumption 4 If θ1 6= θ2 then

                                            B(θ1 ) 6=B(θ2 ).




    If this assumption were relaxed we would no longer obtain point identification, but would
instead obtain set identification.
                                             
Assumption 5 We can write Υhs = Υdhs , Υchs where Υdhs is discrete taking on values
Υd(1) , ..., Υd(KΥ ) and Υchs is continuous. For every θ ∈ Θ, the support of Υhs generated by
`(Υhs ; Xhs , θ) is a subset of or equal to the support of Υhs generated by `0 (Υhs ; Xhs ).

   This assumption makes the likelihood function easy to write down. We could easily
extend the results to accommodate other specific cases.

Assumption 6 For each simulation h = 1, .., H,

                                  S
                               1 X `(Υhs ; Xhs , θ)
                                                     g(Xhs , Yhs ; β))
                               S s=1 `0 (Υhs ; Xhs )

converges uniformly in probability over β and θ to
                                                                               
                                   `(Υhs ; Xhs , θ)
                          Es                        g(Xhs , Yhs ; β); Ξ0 , `0
                                    `0 (Υhs ; Xhs )

where Es represents the expected value when the data are generated from a simulation in
which Xhs is drawn from Ξ0 and Υhs is drawn from `0 (Υ; Xhs ).


                                                    10
There are really three separate aspects of this assumption. First that we are drawing Υhs
from `0 (Υ; Xhs ) which is a fundamental part of the importance weight sampling approach.
The second is that convergence is uniform which is standard. The third aspect reflects how
Xhs is chosen. For calculating the asymptotic distribution we will need to put more structure
on this, but here we just require that asymptotically it is drawn from the true distribution.
There are many ways to do this, and we will discuss this in the next section.

Theorem 1 Under Assumptions 1-6, θb converges in probability to θ.




4.2       Asymptotic Distribution
We now explicitly define Gj , G        ej to be the j th element of G, G,
                              bj , and G                               b and G
                                                                             eh respectively.
We first assume the following regularity conditions. These are weak assumptions that are
standard and will hold in typical applications. The first is standard.

Assumption 7 B (θ) is differentiable with

                                                    dB(θ0 )
                                             Bθ ≡
                                                     dθ0
      0
and Bθ ΩBθ is of full rank and θ0 is an interior point.

    The second is an assumption about stochastic equicontinuity. In small samples our
estimator is potentially discontinuous in θ but it converges to a smooth function.

Assumption 8 For and δN ,
                                  √
                                      N B(θ)
                                        e    − B(θ
                                               e 0 ) − B (θ) + B (θ0 )
                                                                       p
                        sup                    √                       → 0.
                     kθ−θ0 k≤δN             1 + N kθ − θ0 k

   Finally we use,
                                                                 Up
Assumption 9 G     e are differenable in β. Letting the notation →
             b and G                                                denote uniform




                                                  11
convergence in probability,

                                       ∂G bj (β) Up ∂Gj (θ0 , β)
                                                  →
                                          ∂β              ∂β
                                      ∂ 2Gbj (β) Up ∂ 2 Gj (θ0 , β)
                                                  →
                                        ∂β∂β 0           ∂β∂β 0
                                    ∂Gej (θ0 , β) Up ∂Gj (β)
                                                  →
                                         ∂β              ∂β
                                   ∂ 2G
                                      ej (θ0 , β) Up ∂ 2 Gj (β)
                                                  →
                                      ∂β∂β 0          ∂β∂β 0

and all of these objects are continuous in their arguments.

    The differentiability rules out some interesting cases like quantile regression. Extending
this to allow for more complicated cases should be straight forward but our main goal is
to provide the formula for the asymptotic variance in the typical case rather than the most
general case.
    Let β0 = B (θ0 ), we also need

Assumption 10 F is two time (totally) continuously differential and define

                                            d2 F (G (θ0 , β0 ) , β0 )
                                    Fββ ≡
                                                   dβdβ 0

and assume Fββ is of full rank.

    We assume that the Xhs are composed of actual values that we see in the data. Let Mhi
be the total number of times Xi is used for each simulated data set h. This can pick up two
important cases. In one case we let each simulated data set be the same size as the actual
data (S = N ) and each value of Xi is used once so Xhs = Xs . In this case Mhi = 1 for every
i. The other case is one in which Xhs is drawn from the empirical distribution. In this case
Mhi is a random variable taking integer values with expected value S/N. Of course it can
cover other cases as well, for example if S = 2N and each observable is used twice.
    To simplify notation let Υhim denote the mth simulation using observation i for sample
h. Define
                              Mhi
                            N X   ` (Υhim ; Xi , θ0 )
                 gehi (β) ≡                           g (Xi , yΥ (Υhim , Xi ; θ0 ) , β)
                            S m=1 `0 (Υhim ; Xi )




                                                  12
Notice that this means that
                                                  S
                            eh (θ0 , β) = 1         `(Υhs ; Xhs , θ)
                                                  X
                            G                                             g(Xhs , Yhs , β)
                                          S       s=1
                                                        `0 (Υhs ; Xhs )
                                                   N
                                              1   X
                                          =             gehi (β) .
                                              N   i=1


    Define

                ∂G (β0 ) ∂ 2 F (G (β0 ) , β0 ) ∂ 2 F (G (β0 ) , β0 )
                                                                      
         ϑi ≡                                    +                       (g (Xi , Yi , β0 ) − G (β0 ))
                  ∂β           ∂G∂G0                   ∂β∂G0
                                                  
                  ∂g (Xi , Yi , β0 ) ∂G (β0 ) ∂F (G (β0 ) , β0 )
              +                     −
                          ∂β                 ∂β            ∂G
                                                                    
                ∂G (β 0 ) ∂F  (G  (β 0 ) , β0 )   ∂F (G (β0 ) , β0 )
       ϑehi ≡                                   +                       ghi (β0 ) − G (β0 ))
                                                                       (e
                 ∂β 0          ∂G∂G0                  ∂β∂G0
                                            
                   ghi (β0 ) ∂G (β0 ) ∂F (G (β0 ) , β0 )
                  ∂e
              +               −                                  .
                     ∂β             ∂β               ∂G
                              h P               i    
                                1 H           ehi − ϑi .
Let V be the variance of            H     h=1 ϑ

                                     √         
Theorem 2 Under Assumptions ..., N θ − θ converges in distribution to a normal ran-
                                           b
dom variable with expected value 0 and variance


                                    −1                                                  −1
                 ∂B(θ0 )0 ∂B(θ0 )         ∂B(θ0 )0                           0
                                                                    
                                                     −1    −1 ∂B(θ0 ) ∂B(θ0 )    ∂B(θ0 )
                         Ω                         ΩFββ V Fββ Ω ∂θ             Ω             .
                   ∂θ      ∂θ0              ∂θ                          ∂θ        ∂θ0




5     Examples
We present a number of different examples starting with very simple ones. One wouldn’t
need to use our methodology in the first two cases, but they are nice for demonstrating the
basic ideas. The third and fourth examples are more complicated problems for which this
approach would be well suited.



5.1    Example 1: Bernoulli Random Variables
The easiest way to see our approach is with a Bernoulli random variable. We repeat the
statement above: this is a simple problem that one would never use indirect inference to

                                                            13
estimate, but works nicely for showing the issue in standard indirect inference (or Simulated
Method of Moments) and how the approach works. Since many problems involve simulating
discrete random variables, this is the essence of the problem.
    Suppose that                   
                                   1 with probability ρ
                                                           0
                             Yi =                                .
                                   0 with probability 1 − ρ
                                                               0

To estimate the model in a standard way one would just use the sample mean which is the
maximum likelihood estimator

                                           ρbmle =Ȳ .

Given this, if one were to think about estimating p using indirect inference the most natural
auxiliary model would be the sample mean Ȳ . Focusing on the case in which we only simulate
once (H = 1), the standard way to estimate using indirect inference would be to draw a
sample of S random variables from a uniform distribution, u1 , ..., uS . We could then simulate
Ȳ for any given level of p as

                                                S
                                            1   X
                                  Ye1 (ρ) =           1 (us < ρ) .
                                            S   s=1


We then choose our indirect inference estimator
                                                               
                                 ρb1 =argminp        Ȳ − Y1 (ρ) .
                                                          e


The problem is that Ye (p) is a step function so solving for ρ and finding standard errors is
problematic.
    To simulate using importance sampling weights, rather than simulate us we simulate Ys
directly from some initial probability, say µ, so Ys is drawn from a Bernoulli distribution
with probability µ. The simplest simulator for the auxiliary model in this case is

                                                S
                                            1   X          ` (Ys ; ρ)
                                  Ye2 (ρ) =           Ys
                                            S   s=1
                                                            `0 (Ys )

where the likelihood functions are

                              ` (Ys ; ρ) =Ys ρ + (1 − Ys ) (1 − ρ)
                               `0 (Ys ) =Ys µ + (1 − Ys ) (1 − µ).




                                                14
To see why Ye1 (ρ) is consistent, let Y s be the fraction of the simulated sample for which
Ys = 1 and divide the numerator and denominator by S, then

                                                  S
                                             1    X             ` (Ys ; ρ)
                                   Ye2 (ρ) =               Ys              .
                                             S    s=1
                                                                 `0 (Ys )
                                                   ρ
                                          =Y s
                                                   µ
                                           p
                                          →ρ

             p
because Y s → µ as S gets large.
   The estimator is
                                                                     
                                   ρb2 =argminp            Ȳ − Y2 (ρ)
                                                                e

so the solution is

                                                         µ
                                               ρb2 =Ȳ      .
                                                         Ys

   To see how this fits into our notation above with H potentially greater than one, we
would choose:

                                     g(Xi , Yi ; β) = Yi
                                         F (d, β) = (d − β)2
                                                 Υi = Yi .

   Then

                               H                          S
                                                                                 !2
                            1 X                        1 X `(Υhs ; ρ)
                     B(p) ≡
                     e            argminβ                              Yhs − β
                            H h=1                      S s=1 `0 (Υhs )
                              H     S
                           1 X1Xρ
                         =               Yhs .
                           H h=1 S s=1 µ
                           ρ H
                             P     PS
                               h=1  s=1 Yhs
                         =
                           µ     H +S




                                                   15
5.2      Example 2: Logit Model
Our next example is a logit model. The true model is

                                       P r(Yi = 1 | Xi ) =Λ(Xi0 θ0 )

where Λ denotes the logit cdf. We use the linear probability model as our auxiliary model.
We can put this into our notation by ignoring F 7 and choosing

                                                                  2
                                      g(Xi , Yi ; β) = (Yi − Xi0 β) .

We generate the simulated data in the following way.



     1. Choose Xhs by drawing randomly from the empirical distribution of Xi 8

     2. Choose some initial logit value θ∗

     3. Simulate Yhs so that
                                       
                                       1 with probability Λ (X 0 θ∗ )
                                                               hs
                               Yhs   =                                     .
                                       0 with probability 1 − Λ (X 0 θ∗ )
                                                                     hs




Once again we will choose Υhs = Yhs.
  For this model note that

                                  `(Υhs ; Xhs , θ)
                       Whs (θ) ≡
                                   `0 (Υhs ; Xhs )
                                              0                           0
                                   Yhs Λ (Xhs   θ) + (1 − Yhs. ) (1 − Λ (Xhs θ))
                                =            0 ∗                          0 ∗
                                  Yhs Λ (Xhs θ ) + (1 − Yhs. ) (1 − Λ (Xhs θ ))

so
     7
    That is F is just the identity function.
     8
    As discussed above this could be with or without replacement. Of course, if you did it without replace-
ment and your simulation sample is larger than your original one, you would have to replenish it once you
have run through the full sample.




                                                    16
                         H                     S
                                                                            !
                      1 X                   1X
               B(θ) ≡       argminβ F             Whs (θ) g(Xhs , Yhs ; β),
                                                                        b βb
                      H h=1                 S s=1
                          H             S
                       1 X           1X            
                                                           0
                                                                  2
                     =       argminβ       Whs (θ) Yhs − Xhs B(β)
                                                                b
                       H h=1         S s=1
                          H     S
                                                  !−1 S                  !
                       1 X X                   0
                                                      X
                     =            Whs (θ) Xhs Xhs         Whs (θ) Xhs Yhs .
                       H h=1 s=1                      s=1


Clearly this is just H weighted regressions with weights Whs (θ). Also, since Whs (θ) is differ-
entiable in θ, so is B(θ). To see why this works note that

   S
1X                 0   p                  0
      Whs (θ) Xhs Xhs  → E (Whs (θ) Xhs Xhs  )
S s=1                 S→∞

                                                     0                             0
                                                                                              
                                  0       Yhs Λ (Xhs    θ) + (1 − Yhs ) (1 − Λ (Xhs  θ))
                         =E Xhs Xhs E               0 ∗                            0 ∗
                                                                                          | Xhs
                                         Yhs Λ (Xhs    θ ) + (1 − Yhs ) (1 − Λ (Xhs  θ ))
                                              0                               0
                                                                                                   
                                  0    Λ (Xhs   θ)        0 ∗      (1 − Λ (Xhs  θ))             0 ∗
                         =E Xhs Xhs          0 ∗
                                                    Λ (Xhs θ ) +             0 ∗
                                                                                     (1 − Λ (Xhs θ ))
                                       Λ (Xhs   θ )               (1 − Λ (Xhs   θ ))
                           =E (Xi Xi0 )

and at the true value θ = θ0

    S                                           0                             0
                                                                                               
 1X                     p                Yhs Λ (Xhs  θ0 ) + (1 − Yhs ) (1 − Λ (Xhs θ0 ))
       Whs (θ0 )Xhs Yhs → E Xhs E Yhs             0 ∗                           0 ∗
                                                                                         | Xhs
 S s=1                 S→∞               Yhs Λ (Xhs  θ ) + (1 − Yhs ) (1 − Λ (Xhs  θ ))
                                      0
                                                      
                                 Λ (Xhs θ0 )     0 ∗
                       = E Xhs        0 ∗
                                             Λ (Xhs θ )
                                 Λ (Xhs θ )
                         = E(Xi Yi ).

Thus, this procedure will give a consistent estimate (i.e. plim(B(θ0 ) = β0 ).



5.3    Example 3: Dynamic Labor Force Model
Now we consider a more complicated case in which one might actually want to use this
approach. The main issues and modeling is analogous to the previous two examples. In this
dynamic labor force model, we assume that Xit is observable and vi is unobservable. We
will think of dit as employment and that we have panel data on employment, and when the
worker is employed we also observe the wage. The underlying data process is



                                               17
                             
                             1 (X 0 δ + α v + α ε + η ≥ 0) d
                                  it 0    v0 i  ε0 it it     it−1 = 0
                       dit =
                             1 (X 0 δ + α v + α ε + η ≥ 0) d
                                  it 1    v1 i  ε1 it it     it−1 = 1

                 log(wit ) =Xit0 γ + α3 vi + εit
                          ηit ∼ Logistically Distributed
                          vi ∼ N (0, 1)
                          εit ∼ N (0, σε2 )

where the idiosyncratic part of the error term εit is i.i.d.. Note that the terms αv0 and αε0
allow for sample selection bias on wages in a reduced form manner. The model starts in
period 1 and we assume that di0 = 0 (i.e. workers enter the labor market without a job).
However, the data is not collected until some point τ and for each person we observe the
data from τ to T .
    This is a problem for which Indirect Inference is well suited. Maximum likelihood is very
computationally heavy here because of the “initial conditions” problem. The data start at
time τ so we may observe individuals working at time τ (i.e. diτ = 1), but we don’t know how
they got there. In pure maximum likelihood one would have to integrate through all of the
paths that could lead one from di0 = 0 because we don’t observe the sequence di1 , ..., diτ −1 .
However, this is not a problem when we simulate the model. Since we simulate those objects
as well we can incorporate them into Υhs which simplifies the problem substantially.
    An interesting aspect of this model relative to our previous cases is that it is smooth in
its determination of log (wit ) but not in the determination of dit . For this reason we only
need to smooth part of the model. First we define

                                                εit =σε it

and draw hs ex-ante. Since the model with be continuous in σε ,y and thus the objective will
also be continuous in σ.
    We choose

                                 Υi =(vi , di1 , ..., diT , i1 , ..., iT ).

Note that the sequence of d begins at 1 rather than τ so to calculate the likelihood functions
for the weights we avoid the initial conditions problem.
    In practice there are many ways one could choose to estimate the auxiliary model. We
do not take a stand on precisely what that is, but leave it in a general form. Instead, we


                                                     18
describe how to simulate the model. We propose the following algorithm: We first draw the
original data. For every h and s, Draw vhs from a standard normal distribution


  1. Then for every t = 1, ..., T


      (a) Draw hst from a standard normal distribution


             i. Simulate dhst from the model
                                                                                                                             
                     P r(dhst = 1 | dhst−1 = 0) =Λ                     Xit0 δ ∗dhst−1   +    ∗
                                                                                            αvd     v
                                                                                               hst−1 i
                                                                                                         +    ∗
                                                                                                             αεd      σ∗
                                                                                                                 hst−1 ε it



                where (δ0∗ , δ1∗ , αv0
                                    ∗     ∗
                                       , αv1    ∗
                                             , αε0    ∗
                                                   , αε1 , σε∗ ) are chosen from somewhere


      (b) Calculate the likelihood function which is

                                      T 
                                      Y                                                           dst
             `0 (Υhs ; Xhs ) =φ(vhs )    φ(hst )Λ Xit0 δ ∗dhst−1 + αvd
                                                                     ∗
                                                                       hst−1
                                                                             vi + α ∗
                                                                                          σ
                                                                                   εdhst−1 ε
                                                                                            ∗
                                                                                              hst
                                      t=1
                                                                                                             1−dst 
                               × 1−Λ              Xit0 δ ∗dhst−1   +      ∗
                                                                         αvd     v
                                                                            hst−1 i
                                                                                        +     ∗
                                                                                             αεd      σ∗
                                                                                                 hst−1 ε hst
                                                                                                                            .




  2. Calculate objective function for a given θ = (δ0 , δ1 , αv0 , αv1 , αε0 , αε1 , σε ), for each hs


      (a) Calculate the likelihood which is very similar to above

                                       T h
                                       Y                                                           dst
             `(Υhs ; Xhs , θ) =φ(vhs )    φ(hst )Λ Xit0 δ dhst−1 + αvdhst−1 vi + αεdhst−1 σε hst
                                        t=1
                                                                                                                1−dst i
                                × 1 − Λ Xit0 δ dhst−1 + αvdhst−1 vi + αεdhst−1 σε hst

      (b) Calculate the weight as

                                                                   `(Υhs ; Xhs , θ)
                                                  Whs (θ) =
                                                                    `0 (Υhs ; Xhs )

      (c) Generate log wages for each t as

                                                    0
                                       log(whst ) =Xhst γ + α3 vhs + σε hst

                                                          19
       (d) We then define:

                              Yhs ≡(dhsτ , ..., dhsT , dhsτ log(wiτ ), ..., dhsT log(whsT )).




   3. Given knowledge of g and F, solve for the auxiliary parameter

                            H                         S
                                                                                                !
                         1 X                       1 X `(Υhs ; Xhs , θ)
                  B(θ) ≡
                  b            argminβ F                                 g(Xhs , Yhs ; β), β        .
                         H h=1                     S s=1 `0 (Υhs ; Xhs )




Notice that in this case the ratio of the likelihoods will simplify. We needed to smooth part
of the model but not all. The aspects of the likelihood related to the parts we didn’t need
to smooth (νi , it ) will drop out. That is, the term φ(vhs ) Tt=1 φ(hst ) will cancel.9
                                                              Q




5.4     Example 4: Continuous Time Transition Model with Wages
Now we consider a framework very similar to the previous one, except that time is continuous
rather than discrete. We assume that the data we observe is analogous to most sample designs
- at certain points of time we observe current employment status and the current wage but
do not know what happened in between. This is a reasonable way to think about most data
sets as one can sometimes try to extract more information on employment histories, but this
data relies on respondents memory which may not be accurate. This methodology can be
extended to other types of data gathering as well, but we stick with this one as it is most
closely related to the above model. A major difference between this model and the previous
one is that we can not figure out how to use the Bruins et al. (2017) approach for this model.
    We take the continuous time analogy to the model above with a constant (over time) but
heterogeneous (over workers) hazard rate of finding a job

                                                    0
                                                eXi β0 +α0 vi

and an analogous rate for losing one’s job

                                                    0
                                                eXi β1 +α1 vi
   9
   Monte Carlo experiments on a set of similar but slightly simpler dynamic choice models show that our
smoothing technique has excellent small sample properties as well. These results are available upon request.




                                                        20
with

                                                   vi ∼N (0, 1).

For simplicity we abstract from time varying aspects of the wage affecting employment, but
this should be straightforward to do after modeling the stochastic process. Wages are the
same as the previous case

                                         log(wit ) =Xit0 γ + α3 vi + εit
                                                    εit ∼ N (0, σε2 )

where we will assume that we observe wages and employment at the interval values τ, τ +1, ...,
and T.
    Consider how one would simulate this model. First, we draw vi from a standard normal
distribution. Now for a given guess of (β0 ,α0 , β1 , α1 ) we know the two hazard rates. Starting
                                                                           u
at zero we draw the length of the first unemployment spell. Letting Uhs1      be a uniform (0,1)
random variable this can be written as

                                                                         0
                                    `uhs1 = − log(1 − Uhs1
                                                       u
                                                           )e−Xi β0 −α0 vi .

If this unemployment spell is less than T, we then draw the length of the next employment
spell

                                                                          0
                                    `ehs1 = − log(1 − Uhs1
                                                       e
                                                           )e−Xi β1 −α1 vi

         e
where Uhs1  is uniform. We then check whether the cumulated time (`uhs1 + `uhs1 ) > T. If so
we stop, if not we draw another unemployment spell. We keep iterating on this procedure
until we draw a spell that extends beyond T . For notational purposes let Jhs be the number
                                               u
of unemployment spells we observe and let Ths     be a dummy variable indicating that the
                                                             u
last unemployment spell was right truncated at T (with Ths       = 0 implying that the last
employment spell was right truncated at T ). Also, we take the length of the last employment
or unemployment spell to be its right truncated value (as oppose to its final realized value).
We will then define

                                                    u
              Υhs =(vhs , hs1 , ..., hsT , Jhs , Ths , `uhs1 , ..., `uhsJhs , `ehs1 , ..., `ehsJhs −Ths
                                                                                                       u ).




   Given this information for each t = τ, ..., T we can check whether the individual is
employed at t. We don’t explicitly write down the function yΥ (Υi , Xi ; θ) as it is relatively
simple to understand yet relatively cumbersome to represent as a mathematical expression.

                                                          21
Wages can be simulated in exactly the same way as in the previous expression.
   The only additional thing one would need to apply the methodology is the likelihood
function which needs to be evaluated at the initial draw and on any subsequent draw. To
simplify the expression let

                                                                0
                                              λuhs (θ) ≡eXhs β0 +α0 vhs
                                                                0
                                              λehs (θ) ≡eXhs β1 +α1 vhs .

Then one can write the likelihood function as
                            T
                            Y
`(Υhs ; Xhs , θ) =φ(vhs )       φ(hs )
                        t=1
                           hs −1 h
                      "   JY
                                                                                      −λu (θ)`u
                                     u       u                   e      e
                                                                                    i
                  ×    u
                      Ths         e−λhs (θ)t`hsj λuhs     (θ) e−λhs (θ)`hsj λehs (θ) e hs hsJjs
                           j=1
                                   hs −1 h
                                  JY
                                                                                                                                     #
                                                                                                         u (θ)`u             e (θ)`e
                                                                                                    i
                                              −λu       u                  −λehs (θ)`ehsj             −λ                  −λ
                          u
                  + (1 − Ths )            e     hs (θ)t`hsj   λuhs (θ) e                    λehs (θ) e hs hsJjs λuhs (θ) e hs hsJjs .
                                   j=1


Notice one important feature of this approach. When we simulate this model, we have
data from all periods, not just after τ. This means we don’t have to worry about the initial
conditions problem when calculating this likelihood function.



6     Empirical Application: Fertility and Female Human
      Capital Accumulation
We next develop and estimate an empirical model using the importance sampling method-
ology. The main goal of this empirical exercise is to understand the relationship between
human capital accumulation and fertility for women. It is well known that women have a
less steep wage profile than men. Presumably some of this difference is due to the fact that
women take time out of the labor market to have and care for children. Our main goal is to
quantify the importance of this effect on human capital accumulation.
    A second closely related goal is to understand the source of the curvature of the lifecycle
wage profile. Wages increase rapidly at the beginning of the lifecycle and then flatten out
in the middle. In a learning-by-doing model it could be due either to declining returns from
learning or from the aging process. The idea of the first is that once I have mastered my
job, my wages stop rising. This would correspond to curvature in actual experience while
the other would be curvature in potential experience. These two types of curvature can also


                                                              22
captured by the Ben-Porath (1967) model. As workers get closer to retirement, the incentive
to invest declines which leads to an age affect but there will also be a direct human capital
effect as conditional on age, the incentive to invest is lower when human capital is lower. We
do not explicitly allow for endogenous Ben-Porath investment, but we do allow the curvature
to result from both previous human capital and from age. For women who take time out of
the labor market to have children, the distinction is very important. If it is purely previous
human capital, when mothers re-enter the labor market they can expect rapid wage growth
because they have relatively low levels of human capital. By contrast, if the flattening is due
to age, and they re-enter mid-life, they would expect slower wage growth.
    To address these questions we use data from the Survey of Income and Program Partici-
pation (SIPP). Alternative data sets that researchers have used to study female wage growth
is the National Longitudinal Survey of Youth 1979 (NSLY79) as well as the older National
Longitudinal Surveys of Young Women and Mature Women (NLSW). We don’t want to ar-
gue that SIPP is clearly better than the NLSY79, but rather that there are tradeoffs between
the two and most previous work (see discussion in next section) has focused on the NLSY79
or NLSW. The advantage of the NLSY79 is it is a much longer panel, but the disadvantage
is that it is much smaller number of individuals (at most around 6000 women which gets
smaller over time due to attrition from the survey). The SIPP is a very large data set with
short panels - we will use observations from almost 100,000 different women. The challenge
with the SIPP is that since we do not observe the full lifecycle profile for any women, we
must piece the panel data of people at different ages. This requires an econometric model
and we propose a Markov model of work, fertility and marriage. Estimating such a model by
maximum likelihood is extremely difficult given the severe initial conditions problem with
this data. For this reason indirect inference is a more feasible way to address the problem.
However, given that the main state variables of interest (work, marriage, number of chil-
dren) are discrete, smoothness in the objective function will be an issue. This makes indirect
inference with importance weight sampling ideal for this problem.
    The basic empirical motivation can be seen in Figure 1. We run a regression of log wages
on dummy variables for potential experience and individual fixed effects for white men and
for white women. We plot the predicted profile normalizing log wages at entry to zero.
Two things can be seen from the figure. First, as has been established,10 wages increase
more quickly for men than for women during the beginning of the lifecycle.11 Secondly,
while wages diverge in the middle, they eventually converge towards the end of the lifecycle.
One possible explanation for this pattern is labor supply and fertility - when women have
  10
    See e.g. Gladden and Taber (2000) among a large literature.
  11
    This difference is smaller than what Gladden and Taber (2000) find for the NLSY though the samples
are directly comparable and the SIPP covers a later period.



                                                 23
children they tend to leave the labor market and then re-enter as their children age. This
could cause wage growth to slow during this time, but then pick up after re-entry. This
raises the fundamental question in labor economics we mentioned before: what leads to the
curvature in wage growth? That is, wage growth slows more quickly for men than for women.
If the curvature is driven by “actual experience” then one would expect this. When women
re-enter the labor force they have less actual experience than men and thus their wages will
grow faster. This could explain why wage growth of women with potential experience over
20 experience faster wage growth then men. By contrast if it is potential experience or age
that is driving the curvature, then women who re-enter will not see faster wage growth.
Our empirical specification below allows for both possibilities to measure their quantitative
importance.



6.1    Literature
There are a large number of papers looking at male-female wage differentials. We differ
from the vast majority of papers as we focus on female wage growth rather than levels. We
mention some relevant work.
    Hill (1979) was one of the first to examine the effect of motherhood on wages. She uses
one wave of the PSID and finds a 7 percent motherhood wage penalty for white women
when productivity characteristics are excluded. After adding productivity characteristics,
the motherhood wage penalty nearly disappears. The driving factor in the wage differences
is intermittent work amongst mothers. She concludes that “the number of children is a good
proxy variable for differential work history and labor force attachment for white women” (p.
591). We use this idea for identification in our model. Becker (1985) suggests that a part of
the wage gap observed between single and married mothers arises from the choice by married
mothers to work in less intensive and more convenient jobs (p. S54). Married men do not
typically make such trade-offs. Korenman and Neumark (1992) use NLSY data and find
no significant effect on wages of having a first child, but large effects from the second child
(between a 10 and 20 percent penalty). Using panel data methods this effect disappears.
However, cross-sectional IV estimates imply that working continuously following childbirth
will not eliminate the motherhood wage gap.
    Using the NLSY and estimating wage equations with fixed-effects, Waldfogel’s (1998a,
1998b) findings suggest a motherhood wage penalty of 4.6 percent for the first child and 12.6
percent for two or more children. She also finds that women who have access to family leave
upon childbirth are more likely to return to their pre-childbirth employer and, consequently,
receive a wage boost that partially offsets the motherhood wage penalty (75 percent of the
wage penalty is eliminated). Anderson, Binder, and Krause (2002) use the NLSY and find

                                              24
no evidence (in a panel framework) that reduced work effort is at the root of the wage gap.
They estimate the wage gap to be 3 percent for mothers with one child and 6 percent for
mothers of two or more children. They posit that the wage gap is largely caused by high
costs of flexible work schedules for women holding medium office jobs with standard work
hours.
    Adda, Dustmann, and Stevens (2017) formulate and estimate a dynamic programming
model of female labor supply, marriage and fertility choices and use it decompose the career
costs of children into several different components. Using data from the German Socio-
Economic Panel (GSOEP) and other sources, they find that roughly three quarters of the
35% reduction in lifetime income derives from foregone earnings while out of the labor force.
The remainder is due to lower wages while working, less work experience and depreciation
of skills. In addition, Adda, Dustmann, and Stevens (2017) find that skill depreciation rates
are higher in mid-career and differ across occupations. Since selection into occupations is
based partially on expected fertility outcomes, a portion of the career costs of children are
incurred prior to children being born. They also show that fertility leads to changes in the
ability composition of working women over the life-cycle and find that fertility explains a
substantial part of the gender wage-gap, especially for women in their mid-thirties.
    Loughran and Zissimopoulos (2007) concentrate on the effect of marriage and fertility on
the wage growth of men and women. Fixed-effects regressions using NLSY data show that
not only does marriage reduce female wage levels, but it also reduces female wage growth
by four percentage points. The wage growth of men is reduced by two percentage points.
A first birth lowers female wages by between two and three percentage points but does not
affect wage growth for males or females. The findings are consistent with male careers being
accommodated more than female careers within the couple. This can lead to lower wage
growth for married women, even before children are born. The arrival of children further
reduces female wage levels as they reduce labor supply or drop out of the labour force. Since
marriage and childbearing at young ages can cause substantial decreases in lifetime earnings,
this may be an important factor in explaining why marriage and fertility has been delayed
since the mid-1960s.
    Daniel, Lacuesta, and Rodríguez-Planas (2013) estimate fixed-effects regressions on Span-
ish data, also controlling for firm-level heterogeneity, to explore the effects of childbirth on
female wages. The results indicate that, compared to childless women, “mothers to be” ex-
perience earnings increases of up to 6 percentage points prior to a first-birth. The earnings
advantage is then wiped out. It takes another nine years on average for a mother’s earnings
to return to pre-birth relative levels (relative to childless women). Roughly half of the earn-
ings loss upon becoming a mother is due to less accumulated work experience, as mothers
switch to part-time work or take a leave of absence.


                                              25
    Using NLSY data and a variety of regression techniques, Braga (2013) finds that more
educated workers benefit from faster wage growth due to accumulation of work experience
but suffer greater wage losses from spells of unemployment. He uncovers this by estimating
regression models where earnings depend on work experience, past unemployment and non-
participation periods, interacted with schooling. The data is restricted to non-black males
but qualitatively similar results are obtained for blacks and women.
    Other important papers include Weiss and Gronau (1981), which provides a human
capital model showing why wage growth might be lower for women. Polachek (1981) presents
a model and evidence that women choose occupations with lower depreciation of human
capital. Like us, Light and Ureta (1995) use a more complicated model for experience. They
take advantage of the NLSY79 and the long histories. Baum (2002) looks directly at the
effect of work interruptions on wages for women. Wilde, Batchelder, and Ellwood (2010)
emphasize the difference between low and high skilled workers in the impact of childbearing.
    In addition to Adda, Dustmann, and Stevens (2017) discussed above, our work is related
to structural models of fertility, labor supply and wages such as Moffitt (1984), Hotz and
Miller (1988), Eckstein and Wolpin (1989), Heckman and Walker (1990), Van Der Klaauw
(1996), Altug and Miller (1998), Francesconi (2002) Sheran (2007), Keane and Wolpin (2010),
Gayle and Miller (2012), and Blundell, Costa Dias, Meghir, and Shaw (2015). While we are
not explicitly structural, our approach is similar. None of these papers focus on the precise
question about fertility and wage growth that we do.
    There is also a large literature on the motherhood penalty. Additional papers to the ones
discussed above include Waldfogel (1997), Lundberg and Rose (2000), Budig and England
(2001), Anderson, Binder, and Krause (2003), Gangl and Ziefle (2009), and Pal and Waldfogel
(2014).



6.2    The Markov Model
The model is a continuous time Markov model in which women transition between several
states. Individuals can move into and out of work and into and out of marriage. They also
potentially give birth to children which influences other variables. Human capital generally
increases while individuals work and falls when they don’t. The state variables are

                      Sit ≡ {t, Lit , Mit , Hit , Kit , {A1it , .., AKit it }; Ei , νi }

where t is time since labor market entry (e.g. potential experience), Lit is a dummy variable
for having a job, Mit is a dummy variable for marriage, Hit is human capital, Kit is the
number of children the woman has given birth to, and the Ajit are the ages of each of the


                                                     26
children. The last two variables do not change over time. The first is education Ei , which is
observed in the data, and the second is unobserved heterogeneity νi . The latter is assumed
to have a standard normal distribution.
    The transitions are governed by five different hazard rates; the hazard rate for job ar-
rival for the non-employed, λJ (Sit ), the hazard rate for job destruction (leading to non-
employment), λN (Sit ), the rate of marriage formation, λM (Sit ), for divorce. λD 1 (Sit ) , and
finally for births of children, λK (Sit ). The ages of both the woman and her children increase
with time and human capital evolves deterministically as a function of the state variables.
Wages are a function of the state variables and an i.i.d. error term.
    All five hazard rates take the basic form.

                                  log λR (Sit ) = XitR (Sit )0 β0R
                                               


for R ∈ {J, N, M, D, K} where XitR is a vector of covariates that are functions of the un-
derlying state variables (observable and unobservable). We discretize all of the continuous
state variables in this expression. In particular, we allow the child age range to differ for
children less than seven and from eight to seventeen. We use three age groups, potential
experience is ten or less, between 11 and 20, and older than 20. The specific variables are
listed in the tables below. Of course, the fertility variables are key and we will estimate how
they influence labor supply and thus human capital accumulation.
    We choose a human capital accumulation function that allows for curvature of the profile
either through age t, or human capital Hit . Specifically, for workers we allow human capital
to accumulate according to

                                   Ḣ =a (Sit ) H̄ − Hit e−µt
                                                        


where H̄ is the maximum level of human capital (and Ḣ = ∂H/∂t). One can see that as
Hit approaches H̄, human capital accumulation slows down. The other force that may allow
for human capital to accumulation to slow down is the potential experience term e−µt . As
discussed above, the distinction between the two is very important for mothers who take
time out of the labor force. With a long spell out of the labor force to care for children,
they will have relatively high t but relatively low Hit . So if the first effect is important, they
should see large wage growth upon re-entering, but with higher µ they will not. The key
moment for identifying this parameter is the wage growth for women with children over the
age of 18. We put high weight on this parameter to make sure the model fits it very well.
We parameterize log (a (Sit )) to be linear in state variables. Note that our specification also
does not allow human capital to fall for older women (when they work). This is consistent
with our data-see Figure 1.

                                                27
       When women do not work their human capital depreciates according to the formula

                                                Ḣ = − δH

where δ is a parameter.12
   Finally we allow wages to depend on human capital as well as the other state variables

                                  log (Wit ) =Xit (Sit )0 γ + Hit + εit .

Since Hit is an element of Sit , the notation is general enough that we could have incorporated
it into Xit (Sit )0 γ. We show it explicitly here to clarify that its scale is determined by the
wage equation since it is restricted to have a sign of 1. We also assume that εit is i.i.d.
normally distributed with mean zero and variance σε2 .



6.3       Data and Auxiliary model
We estimate the model using the last four panels of the Survey of Income and Program
Participation 1996, 2001, 2004, and 2008.13 This survey interviews individuals every four
months and we only use data from the survey month. This data has the advantage of very
large samples and a panel structure. The large sample size is important as identification
for many of our parameters is quite subtle. Panel data is essential as well. We use white
women who are 18 years or older and have at most 35 years of potential experience. Table 1
presents summary statistics of the main variables we use in our analysis. Details of the data
are discussed in Appendix B.
    We construct our auxiliary model using the following auxiliary parameters. The full list
can be seen in the tables with more detail contained in Appendix C.Regression of log wages
on potential experience dummies and state variables with individual fixed effects



       • Within and between variance of the error term from the regression

       • Regression of estimated fixed effect on education

       • Linear probability regression of whether a woman is married in the initial period we
         see her, on potential experience dummies and state variables
  12
     In a previous version, we allowed it to be a log linear function of state variables, but we did not find
sufficiently strong predictors of this in the data.
  13
     We do not use earlier years because the nature of the survey changed around 1996. These panels are
substantially longer than the previous ones.



                                                     28
   • Linear probability regression of whether an unmarried woman gets married between
     waves, on potential experience dummies and state variables

   • Linear probability regression of whether a married woman stays married between waves,
     on potential experience dummies and state variable

   • Fraction of mothers who are married at childbirth

   • Regression of having a child on wages of mothers who work (with other covariates)

   • Age difference between youngest and oldest child

   • Linear probability regression of any children/two children/number of kids, on potential
     experience dummies and state variables

   • Linear probability regression of whether a woman works in the initial period we see
     her, on potential experience dummies and state variables

   • Linear probability regression of working in one wave conditional on working in the
     previous wave, on potential experience dummies and state variables

   • Linear probability regression of working in one wave conditional on not working in the
     previous wave, on potential experience dummies and state variables

   • Fraction of mothers who work in interview before giving birth

   • Per person regression of mean number of observations individual works on wage fixed
     effect

   • Regression of wage gains between periods for women who are employed between periods

   • Change in log wages for women with non-employment spells divided by difference in
     potential experience dummies.



These auxiliary parameters can be seen in Tabes 3a-3f under the column labeled data. The
key parameters are the effects of the number of children on various outcomes. In the fixed
effects wage regression, we see little evidence of a children penalty relative to many of the
papers mentioned above. This is in large part because this is a very short panel. Another
key parameter is the children over 18 in the wage growth regression. We included other
children variables in the log wage growth equation but did not find significant results so we
do not include them here and do not incorporate children directly into the human capital



                                             29
production function. We see large effects of fertility on labor supply. We discuss many of
the other auxiliary parameters when we examine the results of the model.



6.4    Estimation in Practice
In practice, since the model is complicated, if the estimation procedure runs long enough
so that the parameters change substantially, the likelihood can get very small for many
observations. As a result, the weight `(Υhs ; Xhs , θ)/`0 (Υhs ; Xhs ) becomes approximately
zero for a large number of the observations. In theory, there is no problem with this as the
law of large numbers still works. However, as a practical matter, one is using essentially
a much smaller sample to approximate the auxiliary moments. Note as well that if one
simulates the model using parameter value θ0 then `0 (Υhs ; Xhs ) = `(Υhs ; Xhs , θ0 ), so if we
evaluate at this parameter value, the weights are all equal to one. We used the following
iterative approach to deal with this problem. At iteration j we have estimated θbj At iteration
j + 1 re-simulate the model using θj so that `0 (Υhs ; Xhs ) = `(Υhs ; Xhs , θj )



   • Use a Newton method to minimize the distance between the auxiliary and simulated
     parameters with at most 100 steps

   • Let the parameter that minimizes this be θbj+1 . The value of the standard simulated
     objective function may not continue improving as j increases. In practice we find that
     it does improve for a while, and then stops. At that point we use a simplex method
     starting with the value of θbj that minimizes the unweighted objective function. We then
     iterate between the simplex and Newton methods until convergence. In practice we
     find this works well. To estimate the standard errors we use the Importance Sampling
     approach.



The weights for the parameters of the auxiliary model were chosen in a somewhat ad hoc
manner. We chose a diagonal weighting matrix Ω where for most auxiliary parameters we
divided by the variance of the estimated parameter. The problem with the default approach
to doing this or more generally efficient weighting is that it does not put the proper weight
on the moments we are most interested in fitting. For example most of our regression models
contain a full set of potential experience dummy variables which gives 35 parameters, but
only a few variables picking up fertility (the wage regression has two). This means that the
statistical criterion will put much more weight on fitting the experience profile because this
is 35 parameters rather than fertility which is only two. We adjust for this by overweighting

                                              30
the fertility parameters. While ad hoc, we think it provides a better objective function than
a pure statistical one. The precise design is presented in Appendix C.
   In the model we simulate, Movement in and out of work



   • Movement in and out of marriage

   • Birth of children

   • Human capital

   • Wages. We start the model when individuals enter the market after school and we
     assume they are unmarried, without a job, and without children. Note that the dis-
     creteness in the movement in and out of work, in and out of marriage, and having
     children all lead to discrete jumps in the state space when they occur. By contrast,
     human capital and the subsequent wage are smooth functions of the parameters con-
     ditional on the state variables. To formally define Υi we define some new notation.
     Let Niw be the number of work transitions and define the date (in terms of actual
     experience) of these transitions to be τi1w , ..., τiN
                                                         w
                                                            w . Note that since individuals start
                                                            i

     nonemployed we can keep track of the state so we know the direction of the transi-
     tion. Similar for marriage we define Nim to be the number of marriage transitions and
                  m
     τi1m , ..., τiN                               k                                   k
                     m their dates. Similarly let Ni be the number of children and τi1 , ..., τ
                     i
                                                                                                k
                                                                                                iNik
     the dates when they were born. Finally, as in the examples above, we take εit = σε it
     where it is standard normal. Let i be the vector of these objects for the periods in
     which the wage is observed by the econometrician. Then we take our Υi to be
                               n                                                            o
                           Υi = τi1w , ..., τiN
                                             w       m          m       k
                                                w , τi1 , ..., τiN m , τi1 , ..., τ
                                                i                 i
                                                                                    k
                                                                                    iN k i .
                                                                                        , 
                                                                                    i




What is crucial for our approach is that the likelihood function `(Υi | Xi ; θ) is smooth as a
function of θ and the rest of the variables used to produce the auxiliary model are smooth
in θ once we condition on Υi .



6.5    Empirical Results
In Tables 2a-2c we present the estimated parameters of the model. The parameters them-
selves are difficult to interpret on their own but can be more easily understood through the
simulations that follow. Most of the parameters have the signs one would expect.


                                                      31
    We present the fit of the model in Tables 3a-3d, Figures 2a-2d, and in Appendix Figures
A1-A8. One can see in Tables 3a-3d that with only a few exceptions, the fit of the model for
these parameters is excellent. We also try to fit the profile of wages, marriage, children, and
working across the lifecycle. Figures 2a-2d show that the fit for wages is excellent and the fit
for the other three is good. We put less weight on fitting the profile in the log wage regression
than the profile result. This fit is shown in Appendix Figure A1. The main goal is to fit the
levels though we also fit the transitions which are shown in appendix Figures A2-A8. Given
the coarseness of our model, the relationship between hazard rates and potential experience
we can not fit perfectly and in some cases one can see that the model is too course to fit
some of the details in the data. Since our main goal is the overall wage profile we do not
think this is problematic.
    Our first issue of interest is the curvature in human capital which is important for un-
derstanding the shape of women’s wage growth for the reasons discussed above. Recall that
our baseline model is

                                     Ḣ =a (Sit ) H̄ − Hit e−µt .
                                                          

                                                                                              
In this case curvature can come from two different sources. The first is the term H̄ − Hit
that leads to human capital slowing down as it approaches H̄. The second is from the
µ term in which human capital will slow down as workers age. The former is analogous
to curvature due to “actual experience” while the latter is analogous to curvature due to
“potential experience.” As mentioned previously, we think this difference is identified by the
coefficient on kids greater than 18 in the wage growth regression and we put a lot of weight on
this particular auxiliary covariate. One can see from Table 3e that it is matched quite well.14
The reason for using this moment is analogous to why this distinction is important. If women
take a lot of time out of the labor market when having children and then re-enter they will
have relatively low Hit and relatively high t. If the curvature primarily comes from µ they
will not accumulate a lot of human capital when they re-enter the labor market. However, if
                                      
the curvature comes from H̄ − Hit they will see their wages rise relatively rapidly because
          
 H̄ − Hit will be relatively large. To understand this, we graph three alternative versions
  14
    Our estimate is lower than the estimate in the data, though well within the 95% confidence region. A
larger number would mean even higher growth for women re-entering the market which would suggest an
even smaller roll for µ, so this would just reinforce our main result.




                                                  32
of the human capital production function:

                                  Model A : Ḣ =aA (Sit ) H̄ − Hit
                                                                         

                                   Model B: Ḣ =aB (Sit ) e−µt
                                   Model C: Ḣ =aC (Sit ) .

In all cases we adjust the value of a (Sit ) to keep human capital growth in the first ten years
the same as in the base case. Figure 3 presents the results in which Model A is labeled “No
Age Effect,” Model B is labeled “No Direct Human Capital,” and Model C is labeled “Neither
Age nor Hum. Cap.” We show the progression of the function for married women with 4
years of college. It is clear here that our estimated value of µ of 0.002 is sufficiently small
that the direct human capital effect is much more important.15
    Next we simulate a model in which we relax the relationship between fertility and work
and see how that affects human capital accumulation. That is, we compare our base model
to a counterfactual in which children at home have no effect on working. Specifically, the
effect of “Number of Kids < 18”, “Number of Kids < 7” and “Any Kids < 7” on finding a job
and leaving a job are set to zero (the five numbers are shown in Table 2a). The direct effect
can be seen in Figure 4a in which there is a considerable increase in labor force participation
during the prime child bearing years. The difference peaks at around 10 years of potential
experience at a level of roughly 10% (85% compared to 75%). It is worth pointing out that
this is a substantial effect, but it is not enormous. This is not that surprising. From the raw
data, one can see in the initial work regression in Table 3d, that the coefficient on “Number
of Kids < 7” is of a similar magnitude. Many women stop working while they have young
children, but most do not.
    We next examine the effect of this labor supply decline on human capital accumulation
and wages. These simulations will not be completely analogous to those in Figure 1 as
to be in the actual wage regression, a woman needs to be working. This means that the
shape of the profile in Figure 1 depends not just on human capital accumulation but also on
selection into who is working. Since our counterfactual involves a change in working, there
will be a selection effect that will affect the profile. We avoid this problem when we simulate
the model because we can simulate a counterfactual wage and a level of human capital for
everyone - those working and those not working. Figure 4b presents a simulation of the
level of log wages (Hit in our model) at different ages. The line labeled “Base Model” is a
simulation using the estimated parameters while the line labeled “Fertility Doesn’t Affect
Work” presents a case in which human capital acquisition speeds up because women’s labor
  15
    One can also see that the standard error on this parameter is quite large. This is really due to the fact
that the value of the parameter is essentially zero so the asymptotic approximation is poor.



                                                     33
supply is no longer affected by working (as in Figure 4a). One can see that the loss in
labor supply does suppress human capital. The difference peaks at experience level 18 where
it is 0.79 in the baseline and 0.82 in the counterfactual. While the sign is as expected, the
magnitude of the difference is modest in comparison to the difference in wage growth between
men and women. We next exclude the motherhood penalty by disallowing the direct effect
of children on wages (coefficients on wages in Table 2b). The effect here is quite modest.
    To put this simulation in a more familiar context we calculate the difference in log wages
for both the counterfactual and the baseline and plot it in Figure 3c. The difference in
wages peaks around experience levels 15-20 at a difference of somewhat over 0.032. This
suggests that on average, wages of women at these ages would be about three percent larger
if there was no effect of fertility on labor supply. Again, this is a non-trivial effect, but when
compared to the difference in log wages between men and women it is quite modest.16



7        Conclusion
In this paper, we show how to use importance sampling weights for indirect inference that
maintains the discreteness of endogenous variables in the model. Thus, we eliminate the
approximation error and potential small sample bias that may arise with the use of GII
from Bruins et al. (2017). Our procedure requires calculating the likelihood contribution
for each observation in the sample at an initial trial vector of structural parameters. This
constitutes the denominator of the weight, which remains fixed during minimum distance
iterations. The numerator of the weight is the likelihood contribution at the updated vector
of trial parameters. At each iteration, the likelihood ratio is the importance sampling weight
used in estimation of the auxiliary model. The importance sampling weights can be formed
with either the exact likelihood of the structural model or a simulated likelihood in case the
former is difficult to construct.
    We apply our new approach to estimating a continuous time Markov model of female
work, marriage, and fertility using data from the Survey of Income and Program Participa-
tion. The model provides a reasonably good fit of the data. We then simulate two different
types of counterfactuals. The first attempts to see whether the curvature in the female wage
profile is determined primarily by curvature in the human capital accumulation function as
a function of previous human capital or if it is primarily driven by age. Our results strongly
    16
    The three percent motherhood wage penalty we find is greater than the near zero penalty found in Hill
(1979) and Korenman and Neumark (1992), but less than the penalty amongst mothers with two or more
children found in Waldfogel (1998a), Waldfogel (1998b), and Anderson, Binder, and Krause (2002). Our
estimate is similar in magnitude to the wage penalties for the first child found in Loughran and Zissimopoulos
(2007) and Miller (2011). Our other estimates are less directly comparable to previous findings but are
consistent with results in Adda, Dustmann, and Stevens (2017) and Braga (2013).


                                                     34
suggest that curvature in the human capital production function is the driving force. Our
second counterfactual attempts to uncover the extent to which women’s dropping out of the
labor force for fertility related reasons suppresses human capital accumulation. Our finding
is that it does to a modest extent. Wages among prime age women would be approximately
3% higher if the relationship between fertility and working were eliminated.




                                            35
References
 Ackerberg, D. A. (2009). A new use of importance sampling to reduce computational
    burden in simulation estimation. QME 7 (4), 343–376.

 Adda, J., C. Dustmann, and K. Stevens (2017). The career costs of children. Journal of
    Political Economy 125 (2), 293–337.

 Altonji, J. G., A. A. Smith, and I. Vidangos (2013). Modeling earnings dynamics. Econo-
    metrica 81 (4), 1395–1454.

 Altug, S. and R. Miller (1998). The effect of work experience on female wages and the effect
    of work experience on female wages and labour supply. Review of Economic Studies.

 An, M. Y. and M. Liu (2000). Using indirect inference to solve the initial-conditions
    problem. The Review of Economics and Statistics 82 (4), 656–667.

 Anderson, D. J., M. Binder, and K. Krause (2002). The motherhood wage penalty: Which
    mothers pay it and why? The American Economic Review 92 (2), 354–358.

 Anderson, D. J., M. Binder, and K. Krause (2003, January). The Motherhood Wage
    Penalty Revisited: Experience, Heterogeneity, Work Effort, and Work-Schedule Flexi-
    bility. Industrial and Labor Relations Review 56 (2), 273–294.

 Baum, C. L. (2002). The efffect of work interruptions on women’s wages. LABOUR 16 (1),
    1–37.

 Becker, G. S. (1985). Human capital, effort, and the sexual division of labor. Journal of
    Labor Economics 3 (1), S33–S58.

 Ben-Porath, Y. (1967). The production of human capital and the life cycle of earnings.
    The Journal of Political Economy, 352–365.

 Blundell, R., M. Costa Dias, C. Meghir, and J. Shaw (2015, March). Female labour supply,
    human capital and welfare reform.

 Braga, B. (2013). Schooling, experience, career interruptions, and earnings.

 Bruins, M., J. Duffy, M. Keane, and A. Smith (2017, March). Generalized indirect inference
    for discrete choice models.

 Budig, M. J. and P. England (2001). The wage penalty for motherhood. American Socio-
    logical Review 66 (2), 204–225.



                                            36
Daniel, F.-K., A. Lacuesta, and N. Rodríguez-Planas (2013). The motherhood earnings
   dip: Evidence from administrative records. Journal of Human Resources 48 (1), 169–
   197.

Eckstein, Z. and K. I. Wolpin (1989). Dynamic labour force participation of married women
   and endogenous work experience. The Review of Economic Studies 56 (3), 375–390.

Francesconi, M. (2002). A joint dynamic model of fertility and work of married women.
   Journal of Labor Economics 20 (2), 336–380.

Fu, C. and J. Gregory (2016, March). Estimation of an equilibrium model with externali-
   ties: Combining the strengths of structural models and quasi-experiments.

Gallant, A. R. and G. Tauchen (1996). Which moments to match? Econometric The-
   ory 12 (4), 657–681.

Gangl, M. and A. Ziefle (2009). Motherhood, labor force behavior, and women’s careers:
   An empirical assessment of the wage penalty for motherhood in britain, germany, and
   the united states. Demography 46 (2), 341–369.

Gayle, G.-L. and R. Miller (2012). Life-cycle fertility and human capital accumulation.

Genton, M. G. and E. Ronchetti (2003). Robust indirect inference. Journal of the American
   Statistical Association 98 (461), 67–76.

Gladden, T. and C. Taber (2000). Wage progression among less skilled workers. In Card
   and Blank (Eds.), Finding Jobs, Work and Welfare Reform, pp. 160–192. Russel Sage.

Gourieroux, C. and A. Monfort (1996). Simulation-Based Econometric Methods. Oxford
   University Press.

Gourieroux, C., A. Monfort, and E. Renault (1993). Indirect inference. Journal of applied
   econometrics 8 (S1), S85–S118.

Guvenen, F. and A. A. Smith (2014). Inferring labor income risk and partial insurance
   from economic choices. Econometrica 82 (6), 2085–2129.

Han, J. (2016). Three Essays on Life-Cycle Labor Supply and Human Capital Formation.
   Ph. D. thesis, University of Wisconsin-Madison.

Hansen, L. P., J. Heaton, and E. G. J. Luttmer (1995). Econometric evaluation of asset
   pricing models. The Review of Financial Studies 8 (2), 237–274.




                                              37
Heckman, J. J. and J. R. Walker (1990). The relationship between wages and income and
   the timing and spacing of births: Evidence from swedish longitudinal data. Economet-
   rica 58 (6), 1411–1441.

Hill, M. S. (1979). The wage effects of marital status and children. The Journal of Human
   Resources 14 (4), 579–594.

Hotz, V. J. and R. A. Miller (1988). An empirical analysis of life cycle fertility and female
   labor supply. Econometrica 56 (1), 91–118.

Keane, M. P. and R. M. Sauer (2010). A computationally practical simulation estimation
   algorithm for dynamic panel data models with unobserved endogenous state variables*.
   International Economic Review 51 (4), 925–958.

Keane, M. P. and K. Wolpin (2010). The role of labor and marriage markets, preference
   heterogeneity, and the welfare system in the life cycle decisions of black, hispanic, and
   white women. International Economic Review 51 (3), 851–892.

Kloek, T. and H. K. van Dijk (1978). Bayesian estimates of equation system parameters:
   An application of integration by monte carlo. Econometrica 46 (1), 1–19.

Korenman, S. and D. Neumark (1992). Marriage, motherhood, and wages. The Journal of
   Human Resources 27 (2), 233–255.

Lee, Y. (2012). Labor Supply Effects of the Earned Income Tax Credit with Labor Supply
   Restrictions. Ph. D. thesis, University of Wisconsin-Madison.

Light, A. and M. Ureta (1995). Early-career work experience and gender wage differentials.
   Journal of Labor Economics 13 (1), 121–154.

Loughran, D. and J. Zissimopoulos (2007). Why wait? the effect of marriage and child-
   bearing on the wages of men and women. Journal of Human Resources.

Lundberg, S. and E. Rose (2000). Parenthood and the earnings of married men and women.
   Labour Economics 7 (6), 689 – 710.

Magnac, T., J.-M. Robin, and M. Visser (1995). Analysing incomplete individual em-
   ployment histories using indirect inference. Journal of Applied Econometrics 10 (S1),
   S153–S169.

McFadden, D. (1989). A method of simulated moments for estimation of discrete response
   models without numerical integration. Econometrica 57 (5), 995–1026.


                                            38
Miller, A. R. (2011). The effects of motherhood timing on career path. Journal of Popu-
   lation Economics 24 (3), 1071–1100.

Moffitt, R. (1984). Profiles of fertility, labour supply and wages of married women: A
   complete life-cycle model. The Review of Economic Studies 51 (2), 263–278.

Nagypál, É. (2007). Learning by doing vs. learning about match quality: Can we tell them
   apart? The Review of Economic Studies 74 (2), 537.

Pal, I. and J. Waldfogel (2014, August). Re-visiting the family gap in pay in the united
   states.

Polachek, S. W. (1981). Occupational self-selection: A human capital approach to sex
   differences in occupational structure. The Review of Economics and Statistics 63 (1),
   60–69.

Sheran, M. (2007). The career and family choices of women: A dynamic analysis of labor
   force participation, schooling, marriage, and fertility decisions. Review of Economic
   Dynamics 10 (3), 367 – 399.

Smith, A. (1990). Three Essays on the Solution and Estimation of Dynamic Macroeco-
   nomic Models. Ph. D. thesis, Duke University.

Smith, A. A. (1993). Estimating nonlinear time-series models using simulated vector au-
   toregressions. Journal of Applied Econometrics 8 (S1), S63–S84.

Van Der Klaauw, W. (1996). Female labour supply and marital status decisions: A life-
   cycle model. The Review of Economic Studies 63 (2), 199–235.

Waldfogel, J. (1997). The effect of children on women’s wages. American Sociological
   Review 62 (2), 209–217.

Waldfogel, J. (1998a). The family gap for young women in the united states and britain:
   Can maternity leave make a difference? Journal of Labor Economics 16 (3), 505–545.

Waldfogel, J. (1998b). Understanding the "family gap" in pay for women with children.
   The Journal of Economic Perspectives 12 (1), 137–156.

Weiss, Y. and R. Gronau (1981). Expected interruptions in labour force participation and
   sex-related differences in earnings growth. The Review of Economic Studies 48 (4),
   607–619.




                                         39
Wilde, E., L. Batchelder, and D. Ellwood (2010). The mommy track divides: The impact
   of childbearing on wages of women of differeing skill levels. NBER Working Paper
   16582 .




                                       40
                          Table 1
                     Summary Statistics
                    White Women 18-65
        Survey of Income and Program Participation
           Variable             Mean    Standard Deviation
Potential Experience           18.028         10.021
Employed                        0.728         0.445
log(Wage)                       2.642         0.589
Education                      13.529          2.412
Married/Spouse Present          0.591         0.492
Number Children < 18           0.958          1.168
Number Children < 7            0.344          0.677
Number of Children              1.546          1.353
Any Children                    0.717         0.451
Age Youngest                    8.147         8.679
Age Difference Oldest/Youngest 5.699           4.038
Had Baby                       0.009          0.094
Number of Cells                           726484
Number of Women                           97354




                           41
                                   Table 2a
                       Model Estimates: Hazard Estimates
                                   Get        Get     Find   Leave         Have
          Covariate              Married   Divorced    Job     Job           Kid
          Education               -0.005     -0.111   0.050  -0.189        -0.162
                                 (0.015)    (0.048) (0.005) (0.013)       (0.011)
              ν                   0.016     -0.288   -0.395 -0.539         0.130
                                 (0.021)    (0.107) (0.053) (0.044)       (0.034)
           Married                                   -0.245 -0.067          0.130
                                                    (0.040) (0.042)       (0.034)
    Number of Kids < 18                      0.037    0.071   0.051
                                            (0.100) (0.020) ( 0.020)
     Number of Kids < 7                              -0.181   0.205
                                                    (0.031) (0.026)
        Any Kids < 7                        -0.241
                                                    (0.047)
          Working                                                          -0.826
                                                                          ( 0.100)
     Number of Kids=1                                                      -0.314
                                                                          (0.153)
     Number of Kids=2                                                      -1.752
                                                                          (0.150)
     Number of Kids>2                                                      -5.102
                                                                          (3.048)
 Number of Kids× Education                                                  0.307
                                                                          (0.817)
        Age Youngest                                                       -0.055
                                                                          (0.021)
  Potential Experience ≤ 10      -2.250     -3.682     -0.158    -1.544    -2.271
                                 (0.037)    (0.312)   (0.032)   (0.087)   ( 0.086)
10 ≤ Potential Experience ≤ 20    -2.840     -3.449    -0.612    -1.971    -2.930
                                 (0.169)    (0.309)   (0.094)   (0.122)   (0.107)
  Potential Experience > 20      -3.561     -4.218     -1.168    -2.194    -4.154
                                 (0.522)    (0.656)   (0.104)   (0.098)   (0.208)




                                      42
                 Table 2b
Model Estimates: Human Capital and Wages
                           Human
      Covariate           Capital (a)   Wages
      Intercept              -3.069
                            (0.331)
      Education              0.307       0.026
                            (0.111)     (0.015)
         νi                              0.446
                                        (0.010)
      Married                -0.119      0.014
                            (0.147)     (0.006)
Number of Kids < 18                     -0.004
                                        (0.003)
Number of Kids < 7                      -0.002
                                        (0.003)

                Table 2c
 Model Estimates: Additional Parameters
  δ                   0.055
                     (0.016)
  µ                   0.002
                     (0.013)
 H̄                   0.987
                     (0.061)
 σε                   0.290
                     (0.010)




                     43
                                 Table 3a
                          Fit of Model: Wages
                                   log(wage)                Fixed Effects
     Covariate                  with fixed effects          Themselves
                                Model         Data         Model      Data
     Education                                             0.107      0.114
                                                                    ( 0.001)
     Married                     0.020        0.009
                                             (0.006)
     Number of Kids < 18        -0.007        -0.000
                                             ( 0.003)
     Number of Kids < 7         -0.003        -0.002
                                             (0.003)

                                Table 3b
                        Fit of Model: Marriage
                              Initial            Get                   Get
     Covariate               Married            Married              Divorced
     Education         0.015  0.015          0.000  -0.000         0.001    0.001
                             (0.001)                (0.000)               (0.000)
         νbi           0.039 0.045           0.002 0.000           0.004    0.003
                             (0.004)                (0.001)               (0.000)
     νbi Missing       0.041 0.041           -0.002 -0.002         0.003    0.003
                             (0.004)                (0.001)               (0.000)
Number of Kids < 18                                                -0.000 -0.000
                                                                          ( 0.000)
Pot. Exp. Dummies       Yes         Yes       Yes          Yes      Yes      Yes

                                 Table 3c
                         Fit of Model : Fertility
                             Any                    Two               Number
    Covariate                Kids                   Kids               Kids
                      Model       Data       Model       Data      Model         Data
    Education         -0.026     -0.026      0.002       0.002     -0.112       -0.110
                                (0.001)                 (0.001)                (0.002)
Pot. Exp. Dummies      Yes        Yes         Yes         Yes       Yes          Yes


                                        44
                                        Table 3d
                                 Fit of Model : Work
                                  Initial               Start               Keep
         Covariate                Work                  Work               Working
                          Model         Data     Model       Data     Model     Data
         Education        0.038        0.037     0.007       0.007    0.008     0.008
                                      (0.001)              (0.000)             (0.000)
          Married          -0.001      -0.006    -0.035     -0.032    0.002     0.002
                                      (0.003)              (0.003)             (0.001)
       Any Kids ≤ 6                              -0.026     -0.022
                                                           (0.004)
    Number of Kids < 18    -0.022     -0.020     0.002       0.001    -0.001   -0.001
                                      (0.002)              (0.001)             (0.000)
    Number of Kids < 7     -0.087     -0.094     -0.025    -0.021     -0.013   -0.012
                                      (0.003)              (0.002)             (0.001)
             νbi                                                      0.039     0.039
                                                                               (0.001)
       Exp. Dummies         Yes           Yes     Yes       Yes        Yes       Yes

                                    Table 3e
                          Fit of Model : Wage Growth
                                    Wage Growth×100                Wage Growth ×100
          Covariate               Continuously Employed           Nonemployment Spell
                                  Model           Data            Model         Data
          Education               0.023           0.024
                                                 (0.015)
           Married                 -0.092        -0.173
                                                 (0.070)
          Total Kids               0.097          0.121
                                                 (0.038)
Change in Potential Experience                                    -0.864        -0.921
                                                                               (0.429)
     Pot. Exp. Dummies              Yes            Yes               Yes         Yes




                                            45
                                Table 3f
             Fit of Model : Additional Auxiliary Parameters
                                                      Model     Data
             Within Variance Log Wages                0.068     0.067
                                                               (0.001)
             Between Variance Log Wages               0.288     0.263
                                                               (0.002 )
         Praction Married When Giving Birth           0.768     0.769
                                                               (0.005)
         Regression had Kid on Wage Residual          0.008     0.007
                                                               (0.002)
           Age Difference Youngest/ Oldest            5.771     5.770
                                                               (0.021)
             Working Before Giving Birth              0.658     0.664
                                                               (0.007)
                    Working on νbi                    0.078     0.078
                                                               (0.002)

              Figure 1: Male and Female Log Wage Profiles
.8
.6
.4
.2
0




     0              10                  20                30              40
                                Female Wage Profile

                         Male Wage Profile             (mean) wfem




                                      46
           Figure 2a: Fit of model: Wage Growth Employed


.03
.02
.01
0
-.01




       0           10                20                   30   40
                            Potential Experience

                               model               data


               Figure 2b: Fit of model: Initial Marriage
.6
.4
.2
0
-.2




       0           10                20                   30   40
                            Potential Experience

                               model               data




                                  47
          Figure 2c: Fit of model: Number Children


3.5
3
2.5
2
1.5




      0        10               20                   30   40
                       Potential Experience

                          model               data


            Figure 2d: Fit of model: Initial Work
.35
.3
.25
.2
.15




      0        10               20                   30   40
                       Potential Experience

                          model               data




                             48
Figure 3: Human Capital Accumulation under Alternative Curvature Parameters


     3
     2
     1
     0




          0             10                   20                   30                   40
                                    Potential Experience

                 Base Model                                No Age Effect
                 No Direct Human Capital                   Neither Age nor Hum. Cap.


      Figure 4a: Labor Supply when Fertility Doesn’t Affect Labor Supply
     1
     .9
     .8
     .7
     .6
     .5
     .4
     .3
     .2
     .1
     0




          0             10                   20                   30                   40
                                    Potential Experience

                       Base Model                Fertility Doesn't Affect Work




                                           49
                      Figure 4b: Log Wages when Fertility Doesn’t Affect Labor Supply


     1
     .8
     .6
     .4




                             0                   10                 20                   30                  40
                                                           Potential Experience

                                        Base Model                                  Fertility Doesn't Affect Work
                                        Fertility Doesn't Affect Work\Wages


Figure 4c: Difference in Human Capital when Fertility Doesn’t Affect Labor Supply
                    .03
      Difference in Human Capital
         .01        0   .02




                                    0              10                 20                 30                  40
                                                             Potential Experience




                                                                  50
Appendix A: Proofs
A.1         Proof of Consistency Theorem
We verify the four conditions for consistency from Newey and McFadden Theorem 2.1.
  Following their notation we define

                              Q0 (θ) ≡ − (B(θ) − B(θ0 ))0 Ω (B(θ) − B(θ0 )) .

    Their first assumption is that Q0 (θ) is maximized at θ0 . This follows since it is negative
at any other value and zero when evaluated at θ0 by Assumption 4.
    Their second assumption is that Θ is compact which we assume directly in Assumption
2.
    Their third assumption is that Q0 is continuous which follows directly from Assumption
3.
    Finally we need that
                                                 0          
                                        − B(θ) − β Ω B(θ)) − β
                                          e      b     e     b


   converges uniformly to Q0 .
   We know that given assumptions 1,2, and 6 the standard argument for consistency of
M-estimators gives

                                                      p
                                                   βb →B(θ0 ).

     Thus, what remains is that we need to show that B(θ)
                                                        e      converges uniformly to B(θ).
     First note that when Υhs is simulated from `0 (Υhs ; Xhs )


                                           ˆ ˆ XKΥ
                                                     `(Υd(j) , Υc ; Xhs , θ)
     
         `(Υhs ; Xhs , θ)
Es                        g(Xhs , Yhs ; β) =               d       c
                                                                             g(Xhs , Yhs ; β)`0 (Υd(j) , Υc ; Xhs )dΥc dΞ0 (x)
          `0 (Υhs ; Xhs )                        j=1
                                                      `0 (Υ(j) , Υ ; Xhs )
                                             ˆ ˆ
                                           =     g(Xhs , Yhs ; β)`(Υd(j) , Υc ; Xhs , θ)dΥc dΞ0 (x)

                                           =G(θ, β)

where Es is the expected value from the simulator.




                                                       A -1
   For any ε > 0 , the following three inequalities hold with probability approaching 1.
                    "  H              S
                                                                                   !
                    1 X            1 X `(Υhs ; Xhs , θ)
                sup       F                              g(Xhs , Yhs ; B(θ)),
                                                                       e      B(θ)
                                                                              e
                θ∈Θ H              S s=1 `0 (Υhs ; Xhs )
                      h=1
                     H             S
                                                                                 !#
                  1 X           1 X `(Υhs ; Xhs , θ)                                  ε
                −       F                             g(Xhs , Yhs ; B(θ)), B (θ)    <
                  H h=1         S s=1 `0 (Υhs ; Xhs )                                 3


      "H                        S
                                                                               !                              #
    1 X                      1 X `(Υhs ; Xhs , θ)                                                               ε
sup       argminβ F                                g(Xhs , Yhs ; B(θ)),
                                                                 e      B(θ)
                                                                        e          − F G(Ξ0 , θ, B(θ)),
                                                                                                 e      B(θ)
                                                                                                        e       <
θ∈Θ H                        S s=1 `0 (Υhs ; Xhs )                                                                3
      h=1


and
      "                 H                             S
                                                                                                   !#
                     1 X                           1 X   `(Υhs ; Xhs , θ)                              ε
sup F (G(θ, B(θ))) −       argminβ F                                      g(Xhs , Yhs ; B(θ)), B(θ)   < .
θ∈Θ                  H h=1                         S s=1 `0 (Υhs ; Xhs )                               3

   The first one comes from the fact that B(θ)
                                          e    maximizes the objective function and the
second two come from assumption 6.
   So with probability approaching one
          h                                               i
  sup F (G(θ, B(θ))), B(θ)) − F G(θ, B(θ))), B(θ)
                                           e          e
  θ∈Θ
      "                            H                        S
                                                                                                          !#
                               1 X                       1 X `(Υhs ; Xhs , θ)
≤ sup F (G(θ, B(θ)), B(θ)) −           argminβ F                                g(Xhs , Yhs ; B(θ)), B(θ)
  θ∈Θ                         H h=1                      S s=1 `0 (Υhs ; Xhs )
        "    H                   S
                                                                                  !
          1 X                1 X `(Υhs ; Xhs , θ)
  + sup         argminβ F                               g(Xhs , Yhs ; B(θ)), B(θ)
    θ∈Θ H                   S   s=1
                                      `0 (Υ hs ; X hs )
            h=1
               H                    S
                                                                                    !#
            1 X                1 X `(Υhs ; Xhs , θ)
          −       argminβ F                               g(Xhs , Yhs ; B(θ)),
                                                                        e      B(θ)
                                                                               e
            H h=1              S s=1 `0 (Υhs ; Xhs )
        "    H                   S
                                                                                  !                            #
          1 X                1 X     `(Υhs ; Xhs , θ)                                                       
  + sup         argminβ F                               g(Xhs , Yhs ; B(θ)),
                                                                      e      B(θ)
                                                                             e      − F G(θ, B(θ)),
                                                                                                  e     B(θ)
                                                                                                         e
    θ∈Θ H                   S   s=1
                                      `0 (Υ hs ; X hs )
            h=1
<ε.

Since F and G are continuous and Θ and B are both compact, for any δ define

                ε∗ (δ) ≡          inf           F (G(θ, B(θ)), B(θ)) − F (G(θ, β), β) .
                           θ∈Θ,β∈B|kβ−B(θ)k≥δ

                                                                                                     h
Then choose ε = ε∗ (δ). That means with probability approaching 1, supθ∈Θ inf β∈B|kβ−B(θ0 )k≥δ supθ∈Θ F (G(θ
ε∗ (δ) so with probability approaching 1, supθ∈Θ B
                                                 e (θ) − B(θ) < δ.

                                                    A -2
                                                                    p
 The fact     B (θ) 
          0 that
                  e     converges uniformly to B(θ) and that βb → B(θ0 ) means that
 B(θ)
 e    − βb Ω B(θ)
                e   − βb converges uniformly in probability to − (B(θ) − B(θ0 ))0 Ω (B(θ) − B(θ0 )) .
   Thus we have verified all of the conditions of Newey and McFadden Theorem 2.1.



A.2    Proof of Asymptotic Distribution
We follow Newey and McFadden Theorem 7.2.
Our estimator satisfies their basic conditions to apply the theorem. Assumption (i) holds
since B(θ0 ) − B(θ0 ) = 0. Assumption 7 guarantees that (ii) and (iii) hold, and 8 guarantee
that (v) holds.
                                                                      √               
To prove the result we need to derive the asymptotic distribution of N B(θ   e 0 ) − βb .
Consider β.
          b Then the first order condition comes from totally differentiating the objective
function
                                              
                                            b βb , βb
                                         dF G
                                    0=                  .
                                              dβ

Let β0 = B (θ0 ) . With the mean value theorem we get
                                                          
                           2
                        d F G β ,β
                             b                dF G (β0 ) , β0
                                                    b
                   0 =              βb − β0 +                   .
                            dβdβ 0                    dβ




                                            A -3
           bj be the j th elements of G and G
Let Gj and G                                b respectively, then
                                    
       d2 F Gb β ,β       Kg ∂F G   b β                
                          X                 ∂ 2Gbj β
                       =
            dβdβ 0        j=1
                                  ∂Gj         ∂β∂β 0
                                                                              
                                   0  2                                2
                                        ∂ F G β , β ∂G                  ∂ F G β ,β
                                                                    
                            ∂Gb β                             b β
                                                b                             b
                          +                                          +                  
                               ∂β             ∂G∂G0           ∂β 0          ∂G∂β 0
                                                                    
                                                            2
                            ∂F G β , β ∂ G                 ∂ F G β ,β
                                                      
                                  b             b β                b
                          +                              +
                                 ∂β∂G0           ∂β 0          ∂β∂β 0
                          Kg                 2
                       Up X ∂F (G (β0 )) ∂ Gj (β0 )
                       →
                          j=1
                                  ∂Gj         ∂β∂β 0
                            ∂G (β0 ) ∂ 2 F (G (β0 ) , β0 ) ∂G (β0 ) ∂ 2 F (G (β0 ) , β0 )
                                                                                         
                          +                                           +
                              ∂β              ∂G∂G0           ∂β 0           ∂G∂β 0
                            ∂F (G (β0 ) , β0 ) ∂G (β0 ) ∂ 2 F (G (β0 ) , β0 )
                          +                              +
                                 ∂β∂G0           ∂β 0           ∂β∂β 0
                        =Fββ

and using the fact that β0 solves

                           dF (G (β0 ) , β0 )
                       0=
                                 dβ
                           ∂G (β0 ) ∂F (G (β0 ) , β0 ) ∂F (G (β0 ) , β0 )
                         =                            +
                             ∂β            ∂G               ∂β

then adding and subtracting terms including the term in the above expression and using the




                                             A -4
mean value theorem
                              
     √   dF    G
               b  (β 0 )  , β0
       N
                 dβ
                                                                      
     √      ∂Gb (β0 ) 0   ∂F    Gb (β 0 ) , β0      ∂F    Gb  (β 0 ) , β0
   = N                                          +                         
               ∂β                 ∂G                         ∂β
                                                                                 
                        0
     √      ∂ G (β0 )
              b           ∂F    Gb (β 0 ) , β0        b        0
                                                    ∂ G (β0 ) ∂F (G (β0 ) , β0 ) 
   = N                                          −
               ∂β                 ∂G                   ∂β                ∂G
                                                                                     !
        √      ∂G b (β0 )0 ∂F (G (β0 ) , β0 ) ∂G (β0 )0 ∂F (G (β0 ) , β0 )
     + N                                           −
                   ∂β               ∂G                   ∂β                ∂G
                                                               
        √      ∂F G     b (β0 ) , β0
                                             ∂F (G (β0 ) , β0 ) 
     + N                                 −
                           ∂β                       ∂β
                                                     N
                                                                                       !
     √      ∂G (β0 )0 ∂ 2 F (G (β0 ) , β0 ) 1 X
   = N                                                  (g (Xi , Yi , β0 ) − G (β0 ))
               ∂β               ∂G∂G0            N i=1
                    N 
                                                                                       !
        √       1 X ∂g (Xi , Yi , β0 )0 ∂G (β0 )0 ∂F (G (β0 ) , β0 )
                                                                 
     + N                                          −
               N i=1                ∂β                  ∂β                  ∂G
                                              N
                                                                                !
        √      ∂ 2 F (G (β0 ) , β0 ) 1 X
     + N                                         (g (Xi , Yi , β0 ) − G (β0 )) + op (1)
                      ∂β∂G0             N i=1
           N 
                   ∂G (β0 ) 0 ∂ 2 F (G (β0 ) , β0 ) ∂ 2 F (G (β0 ) , β0 )
                                                                                 
      1 X
   =√                                                  +                           (g (Xi , Yi , β0 ) − G (β0 ))
       N i=1          ∂β              ∂G∂G0                       ∂β∂G0
          ∂g (Xi , Yi , β0 )0 ∂G (β0 )0 ∂F (G (β0 ) , β0 )
                                                                      
     +                          −                                         + op (1)
                 ∂β                    ∂β                ∂G
           N
      1 X
   =√         ϑi + op (1).
       N i=1

Next we derive the asymptotic distribution for B
                                               e (θ0 ). This follows an analogous but slightly
more complicated derivation. First define

                                          eh (θ) ≡argminβ F (G(θ, β))
                                          B

then the first order condition and mean value theorem gives for each h = 1, ..., H
                                                                                            
                        d2 F Ge h θ0 , β , β                           dF Geh (θ0 , β0 ) , β0
                  0=                                eh (θ0 ) − β0 +
                                                    B
                                 dβdβ 0                                             dβ


                                                        A -5
where
                                           
d2 F Geh θ0 , β , β      Kg ∂F G   eh θ0 , β , β 2 e              
                         X                          ∂ Ghj θ0 , β
                      =
       dβdβ 0            j=1
                                      ∂G0j              ∂β∂β 0
                                                                                                 
                                        0  2                                          2
                                              ∂ F Gh θ0 , β , β ∂ G                    ∂ F Gh θ0 , β , β
                                                                                  
                           ∂Ge h θ0 , β                                 eh θ0 , β
                                                     e                                       e
                         +                                                          +                   
                                ∂β                   ∂G∂G0                ∂β 0               ∂G∂β 0
                                                                                   
                                                                      2
                           ∂F G  e h θ0 , β , β                     ∂   F   e h θ0 , β , β
                                                                            G
                                                              
                                                  ∂ Gh θ0 , β
                                                     e
                         +                 0
                                                                +
                                  ∂β∂G                 ∂β 0                  ∂β∂β 0
                         Kg                   2
                      Up X ∂F (G (β0 )) ∂ Gj (β0 )
                      →
                         j=1
                                 ∂G0j         ∂β∂β 0
                           ∂G (β0 )0 ∂ 2 F (G (β0 ) , β0 ) ∂G (β0 ) ∂ 2 F (G (β0 ) , β0 )
                                                                                          
                         +                                            +
                              ∂β               ∂G∂G0         ∂β 0              ∂G∂β 0
                           ∂F (G (β0 ) , β0 ) ∂G0 (β0 ) ∂ 2 F (G (β0 ) , β0 )
                         +                              +
                                ∂β∂G0            ∂β             ∂β∂β 0
                      =Fββ

      ehj is the j th element of G
where G                          eh .




                                               A -6
Analogously to above
                                     
          √ dF Gh (θ0 , β0 ) , β0
                    e
            N
                         dβ
                                                                                     
          √      ∂ Gh (θ0 , β0 )
                   e             ∂F    G
                                       eh (θ0 , β0 ) , β0      ∂F    Geh (θ0 , β0 ) , β0
         = N                                               +                             
                      ∂β                    ∂G                            ∂β
                                                                                               
          √      ∂ Gh (θ0 , β0 )
                   e             ∂F    G
                                       eh (θ0 , β0 ) , β0
                                                               ∂ Gh (θ0 , β0 ) ∂F (G (β0 ) , β0 ) 
                                                                 e
         = N                                               −
                      ∂β                    ∂G                      ∂β                 ∂G
                                                                                          !
            √       ∂Geh (θ0 , β0 ) ∂F (G (β0 ) , β0 ) ∂G (β0 ) ∂F (G (β0 ) , β0 )
          + N                                            −
                          ∂β                ∂G                 ∂β             ∂G
                                                                    
            √       ∂F G   eh (θ0 , β0 ) , β0
                                                   ∂F (G (β0 ) , β0 ) 
          + N                                  −
                                ∂β                          ∂β
                                                          N
                                                                                     !
          √      ∂G (β0 ) ∂F (G (β0 ) , B (θ0 )) 1 X
         = N                                                  ghi (β0 ) − G (β0 ))
                                                             (e
                   ∂β 0            ∂G∂G0            N i=1
                         N 
                                                                               !
            √
                                                         
                     1 X ∂e      ghi (β0 ) ∂G (β0 ) ∂F (G (β0 ) , β0 )
          + N                               −
                    N i=1          ∂β            ∂β                ∂G
                                              N
                                                                        !
            √       ∂F (G (β0 ) , β0 ) 1    X
          + N                                    ghi (β0 ) − G (β0 )) + op (1)
                                                (e
                          ∂β∂G0          N i=1
                N                                                           
           1 X          ∂G (β0 ) ∂F (G (β0 ) , β0 ) ∂F (G (β0 ) , β0 )
         =√                                            +                        (eghi (β0 ) − G (β0 ))
            N i=1         ∂β 0         ∂G∂G0                    ∂β∂G0
                                                             
                ghi (β0 ) ∂G (β0 ) ∂F (G (β0 ) , β0 )
               ∂e
          +               −                                      + op (1)
                  ∂β             ∂β               ∂G
                N
           1 Xe
         =√        ϑhi + op (1).
            N i=1

And so
                                          N
                                                            "  H
                                                                    #    !
                  √ h          i
                                  −1 1
                                         X                  1 Xe
                   N B(θ0 ) − β =Fββ √
                      b       b                                  ϑhi − ϑi + op (1)
                                       N i=1               H h=1
                                                  −1    −1
                                                           
                                           ∼N 0, Fββ V Fββ   .

Then
                                                   −1                                                   −1 !
√                                      0                        0                                 0
                                                                                      
            
              d                  ∂B(θ0 ) ∂B(θ0 )         ∂B(θ0 )   −1    −1 ∂B(θ0 ) ∂B(θ0 )   ∂B(θ0 )
    N θb − θ0 →N        0,              Ω                        ΩFββ V Fββ Ω ∂θ            Ω                    .
                                   ∂θ     ∂θ0              ∂θ                         ∂θ       ∂θ0


                                                     A -7
Appendix B: Data
As mentioned in the text, we use white women from the last four panels of the Survey of
Income and Program Participation. We first measure potential experience in months and
use anyone from 1 month to 35 years of potential experience. The variable used in the data
is annualized. The SIPP is asked every four months. We only use data from the month of
the interview.
We detail construction of the variables



   • Potential Experience: For older workers we don’t know exactly when they graduated
     school. We assume that they graduate in June of the year they turn a)16 if education
     is less than 12, b) 18 if their education is exactly 12, c) 20 if their education is more
     than 12 but less than 16, and d) 22 if their education is larger than 22.

   • Employment: We define employment to be 1 for individuals who work some during the
     month and are never unemployed during the month.

   • Education: We take the maximum of the education variable in each wave which is
     completed education. We convert to numeric variables as, 0 if less than first grade, 2.5 if
     education is first through fifth grade, 5.5 if it is fifth or sixth, 7.5 if it is seventh or eighth,
     the numeric grade completed through high school, 12 if high school or equivalent, 13 if a
     vocational certificate, 13.5 if a vocational associate degree, 14 if an academic vocational
     degree, 16 if a four year graduate, 17 if a masters degree, and 18 if professional degree
     or higher.

   • Log wage: Wage is constructed as the hourly rate of pay for people who are paid by
     the hour and monthly earnings divided by (weeks worked×usual hours per week). If
     one worked every week of the month we use 4.3 as the number of weeks. It is deflated
     to 2008 dollars using the personal consumption expenditures price index. We drop
     observations with a real wage below 1$ or above 300$.

   • Married: What we really use for married is whether the spouse is present in the
     household. Using the household interview status code, we use epnspous to match the
     respondent to spouse, and our married variable is a dummy variable for whether that
     spouse is in the household in that particular wave.

   • Kids ages: To measure kids that are present we use the household data to match
     mothers to their children. From the individual records we collect their birthdates and
     use that to keep track of the number of children less than seven and less than eighteen.

                                                 A -8
     We also use this to construct the difference in age between the oldest and youngest
     child. We construct a dummy variable for having a baby when a baby enters the
     household between waves (thus, if they never lived in the household with the mother
     any any wave they would not be recorded as children).

   • Total Number of Children ever had: From topical module wave 2, variable tmomchl.
     We also sometimes use a dummy variable for whether this is bigger than zero. We also
     occasionally use a variable that is kids greater than 18. To get this we combine data
     from the topical module for total children and then subtract the number less than 18
     at wave 2. We then use the ages in the household roster to determine that in the other
     waves.



Appendix C: Auxiliary Model
We have a total of 432 auxiliary parameters. We detail them in this appendix and document
how much weight is given to each. All of them start with the inverse of the variance of
estimated parameters and are multiplied by the weights listed below.



   • Regression of log wages on experience and other variables (38 parameters)



        – 35 Experience dummies (all weight=1)
        – Number of Children < 18 (weight 101)
        – Number of Children < 7 (weight 101)
        – Dummy variable for Married (weight 101)



   • Within and between variance of residual from fixed effect regression (2 parameters)



        – Let Ti be the number of wage observations we have from individual i. Construct
          residuals from the fixed effect regression above (where the fixed effect is included




                                            A -9
       in the regression). Define these as ωit and order them as ωi1 , ..., ωiTi . Define

                                               T
                                               i
                                          1 X
                                     ωi ≡        log (ωit )
                                          Ti t=1
                                          PN PTi
                                                       log (ωit )
                                     ω = i=1 Pt=1  N
                                                                  .
                                                   i=1 T i


       We can then decompose the total variance into
          PN PTi
                    [log (ωit ) − ω]2
                                          PN PTi
                                                     [log (ωit ) − ω i ]2
                                                                              PN
            i=1   t=1                       i=1    t=1                         i=1 Ti [ω i − ω]2
                   PN                 =             PN                    +        PN
                    i=1 T i                           i=1 Ti                        i=1 Ti


       where the first part is the within variance and the second is the between variance.
    – Both have weight=1



• Regression of fixed effect on education



    – coefficient on education (weight=1)
    – Intercept from regression not matched (weight=0)



• Linear probability model of being married in the first period observed (39 parameters)



    – 36 experience dummies (all weight=1)
    – education (weight=101)
    – estimate of fixed effect (weight=101)
    – dummy variable for fixed effect missing not matched (weight=0)



• Linear probability of marriage conditional on not married in previous period (38 pa-
  rameters)



    – 35 experience dummies (all weight=1)
    – education (weight=101)
    – estimate of fixed effect (weight=101)

                                          A -10
    – dummy variable for fixed effect missing not matched (weight=0)



• Linear probability of marriage conditional on married in the previous period (39 pa-
  rameters)



    – 35 experience dummies (all weight=1)
    – education (weight=101)
    – estimate of fixed effect (weight=101)
    – dummy variable for fixed effect missing not matched (weight=0)
    – number of kids≤ 18(weight=101)



• fraction of people having a baby who are married (1 parameter)



    – weight=101



• regression of having a kid on wage (1 parameter)



    – current wage for women working (weight=101)
    – also in regression: intercept, education, married, number of kids <7, number of
      kids ≤ 18, potexp, potexp2 (not matched, weight=0)



• Age difference between oldest and youngest child (1 parameter)



    – weight=101



• regression of dummy variable for any kids (37 parameters)



    – 36 age dummies (weight=1)


                                      A -11
    – education (weight=101)



• regression of dummy variable for exactly 2 kids (37 parameters)



    – 36 age dummies (weight=1)
    – education (weight=101)



• regression of number of kids (37 parameters)



    – 36 age dummies (weight=1)
    – education (weight=101)



• Linear probability model of working in the first period observed (40 parameters)



    – experience dummy variables (36 parameters)
    – education (weight=1)
    – married (weight=101)
    – number of kids <7 (weight=101)
    – number of kids < 18 (weight=101)



• Linear probability model of finding a job conditional on not working in the previous
  period (40 parameters)



    – experience dummy variables (35 parameters)
    – education (weight=1)
    – married (weight=101)
    – any kids <7 (weight=101)
    – number of kids <7 (weight=101)


                                       A -12
    – number of kids < 18 (weight=101)



• Linear probability model of keeping one’s job conditional on working in previous period
  (40 parameters)



    – 35 experience dummy variables (weight=1)
    – education (weight=1)
    – fixed effect (weight=101)
    – married (weight=101)
    – number of kids < 7 (weight=101)
    – number of kids ≤ 18 (weight=101)



• fraction of women who were working when having a kid (1 parameter)



    – weight=101



• regression of work on fixed effect (1 parameter)



    – fixed effect (weight=101)
    – intercept not matched (weight=0)



• Regression of wage growth for continuously employed (39 parameters)



    – 36 experience dummy variables (weight=11)
    – education (weight=801)
    – married (weight=801)
    – number of kids ≥ 18 (weight=801)




                                       A -13
• wage growth overlapping non-employment spell (1 parameter)



    – change in potential experience (weight=801)
    – That is, we look at people who had a wave where they were working followed by
      one or more waves of non-employment, followed by a wave in which they were
      working. We regress the difference in wages post and pre non-employment spell
      on the length of the time in between.




                                     A -14
          Figure A1: Fit of model: Fixed Effect Profile


.8
.6
.4
.2
0




      0         10                20                   30   40
                         Potential Experience

                            model               data


             Figure A2: Fit of model: Get Married
.04
.03
.02
.01
0




      0         10                20                   30   40
                         Potential Experience

                            model               data




                             A -15
           Figure A3: Fit of model: Stay Married


.985
.98
.975
.97
.965




       0      10               20                   30   40
                      Potential Experience

                         model               data


           Figure A4: Fit of model: Any Children
1.2
1
.8
.6
.4




       0      10               20                   30   40
                      Potential Experience

                         model               data




                          A -16
           Figure A5: Fit of model: Stay Married


.4
.3
.2
.1
0




      0       10               20                   30   40
                      Potential Experience

                         model               data


          Figure A6: Fit of model: Stay Employed
.2
.15
.1
.05
0




      0       10               20                   30   40
                      Potential Experience

                         model               data




                          A -17
          Figure A7: Fit of model: Non-employed to Employed


.86
.84
.82
.8
.78
.76




      0             10               20                   30   40
                            Potential Experience

                               model               data




                                A -18
