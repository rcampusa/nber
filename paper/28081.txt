                              NBER WORKING PAPER SERIES




          AGGREGATE IMPLICATIONS OF FIRM HETEROGENEITY:
A NONPARAMETRIC ANALYSIS OF MONOPOLISTIC COMPETITION TRADE MODELS

                                         Rodrigo Adão
                                        Costas Arkolakis
                                        Sharat Ganapati

                                      Working Paper 28081
                              http://www.nber.org/papers/w28081


                     NATIONAL BUREAU OF ECONOMIC RESEARCH
                              1050 Massachusetts Avenue
                                Cambridge, MA 02138
                                   November 2020




We thank Xiaohong Chen, Phil Haile, Giovanni Compiani, Chang-Tai Hsieh, Samuel Kortum,
and Steve Redding for valuable comments. We thank Takashi Onada, Mengly Xu, and Linghui
Wu for research assistance. We are grateful to Peter Morrow for sharing his data. The support of
the National Science Foundation under grant 2018234 is gratefully acknowledged. Part of this
research was conducted while Ganapati was a Fellow at Dartmouth College. All errors are our
own. The views expressed herein are those of the authors and do not necessarily reflect the views
of the National Bureau of Economic Research.

NBER working papers are circulated for discussion and comment purposes. They have not been
peer-reviewed or been subject to the review by the NBER Board of Directors that accompanies
official NBER publications.

© 2020 by Rodrigo Adão, Costas Arkolakis, and Sharat Ganapati. All rights reserved. Short
sections of text, not to exceed two paragraphs, may be quoted without explicit permission
provided that full credit, including © notice, is given to the source.
Aggregate Implications of Firm Heterogeneity: A Nonparametric Analysis of Monopolistic
Competition Trade Models
Rodrigo Adão, Costas Arkolakis, and Sharat Ganapati
NBER Working Paper No. 28081
November 2020
JEL No. C14,F12,F14,F15

                                         ABSTRACT

We measure the role of firm heterogeneity in counterfactual predictions of monopolistic
competition trade models without parametric restrictions on the distribution of firm fundamentals.
We show that two bilateral elasticity functions are sufficient to nonparametrically compute the
counterfactual aggregate impact of trade shocks, and recover changes in economic fundamentals
from observed data. These functions are identified from two semiparametric gravity equations
governing the impact of bilateral trade costs on the extensive and intensive margins of firm-level
exports. Applying our methodology, we estimate elasticity functions that imply an impact of trade
costs on trade flows that falls when more firms serve a market because of smaller extensive
margin responses. Compared to a baseline where elasticities are constant, firm heterogeneity
amplifies both the gains from trade in countries with more exporter firms and the welfare gains of
European market integration in 2003-2012.

Rodrigo Adão                                    Sharat Ganapati
Booth School of Business                        Georgetown University
University of Chicago                           Edward B. Bunn, S.J. Intercultural Center
5807 South Woodlawn Avenue                      37th and O Streets, NW
Chicago, IL 60637                               Washington, DC 20057
and NBER                                        and CESifo
rodrigo.adao@chicagobooth.edu                   sganapati@gmail.com

Costas Arkolakis
Department of Economics
Yale University, 28 Hillhouse Avenue
P.O. Box 208268
New Haven, CT 06520-8268
and NBER
costas.arkolakis@yale.edu




A data appendix is available at http://www.nber.org/data-appendix/w28081
1       Introduction
The international trade field has been transformed by the study of firm heterogeneity. The
observed correlation between firm characteristics and export participation is the cornerstone
of the workhorse monopolistic competition model, linking decisions of heterogeneous firms to
international trade and welfare ­ see Melitz (2003) and, for a review, Melitz and Redding
(2014). Typically, to specify firm heterogeneity, the literature relies on restrictive parametric
assumptions about the distribution of firm fundamentals. Such restrictions are useful in
practice: approximations help with estimation and functional forms facilitate extrapolating
aggregate counterfactual predictions from observed firm-level outcomes. However, an im-
portant question is whether these parametric distributional assumptions are essential for
incorporating firm heterogeneity into empirical and counterfactual analyses in international
trade. Furthermore, to what extent do these assumptions determine the implications of firm
heterogeneity for the economy's aggregate response to international trade shocks?1
    This paper aims to measure the aggregate importance of firm heterogeneity by developing
a foundation for a widely used class of monopolistic competition trade models of firm hetero-
geneity, without any parametric restrictions on the distribution of firm fundamentals. We
show that two elasticity functions are sufficient to nonparametrically compute the counterfac-
tual aggregate impact of trade shocks, and recover changes in economic fundamentals from
observed data. These functions are identified from two semiparametric gravity equations
governing the impact of bilateral trade costs on the extensive and intensive margins of
firm-level exports. Estimating these equations only requires bilateral data on a trade cost
shifter, the share of a country's firms exporting to a destination, and their average exports.
Conditional on these elasticity functions, more information on cross-section variation in
firm-level outcomes does not affect the model's aggregate counterfactual predictions. We
exploit this characterization to provide estimates of these two sufficient elasticity functions
and quantify the importance of firm heterogeneity in measuring the aggregate implications of
international market integration.
    Our starting point is an augmented version of the multi-country workhorse monopolistic
competition model with constant elasticity of substitution (CES) preferences. Firms are
heterogeneous with respect to productivity, demand, and variable and fixed trade costs
across destinations. An extensive literature has imposed different parametric distributional
    1
    A series of recent papers have shown that parametric distributional assumptions are important to
determine both the adjustment margins driving the model's counterfactual predictions and the set of moments
used for identification ­ e.g., Chaney (2008); Arkolakis, Costinot and Rodr´iguez-Clare (2012); Melitz and
Redding (2014, 2015); Bas, Mayer and Thoenig (2017); Fernandes, Klenow, Denisse Periola, Meleshchuk and
Rodriguez-Clare (2019).



                                                    1
assumptions on some of these dimensions of firm heterogeneity to generate the observed
patterns of cross-firm variation in productivity, sales, and entry in different markets ­ e.g.,
Chaney (2008), Helpman, Melitz and Rubinstein (2008), Eaton, Kortum and Kramarz (2011),
Redding (2011), Head, Mayer and Thoenig (2014). In contrast, we do not restrict the
distribution of these firm fundamentals. We thus only acknowledge that such heterogeneity
exists and evaluate how it affects the response of aggregate outcomes to trade shocks.
     We show that the distribution of all these sources of firm heterogeneity can be folded
into two functions that yield semiparametric gravity equations for the extensive margin (i.e.,
exporter firm share) and intensive margin (i.e., average firm exports) of firm sales in each
market. The extensive margin gravity equation links a flexible function of the exporter firm
share to exogenous bilateral trade costs, and endogenous origin and destination fixed-effects
(i.e., wages and price indices). The intensive margin gravity equation connects average firm
exports to a flexible function of the exporter firm share, as well as bilateral trade costs and
origin and destination fixed-effects.2 The functions in the two gravity equations control the
elasticities of the extensive and intensive margins of firm exports to changes in bilateral trade
costs. The elasticity of each margin is an arbitrary function of the initial exporter firm share.
These functions also determine the aggregate trade elasticity, which combines the elasticities
of the two margins and, thus, may vary arbitrarily with the initial exporter firm share.
     With this characterization, we establish that the two gravity elasticity functions of firm
exports summarize the role that firm heterogeneity plays in the model's counterfactual
predictions following shocks in trade costs and productivity. Formally, three objects are
sufficient for conducting counterfactual exercises: (i) bilateral data on trade flows and export
firm shares, (ii) the elasticity of substitution across varieties, and (iii) the gravity elasticity
functions of the extensive and intensive margins of firm exports. Thus, the distribution of
firm fundamentals only affects the model's aggregate counterfactual predictions through the
shape and level of the two gravity elasticity functions.
     We provide theoretical results that synthesize the debate on the aggregate implications of
firm heterogeneity. For small shocks, the aggregate trade elasticity is sufficient to characterize
the response of aggregate outcomes, in line with Arkolakis et al. (2012). For large shocks, the
trade elasticity changes along the adjustment path to the new equilibrium due to changes in
exporter firm shares, implying that firm heterogeneity plays an important role for the model's
predictions, in line with Melitz and Redding (2015) and Feenstra (2018). We show, however,
that this role is summarized by the gravity elasticities of the firm export margins and their
   2
    We derive these semiparametric gravity equations using the same type of inversion argument in Berry
and Haile (2014) and Ad~  ao (2015). The function of the exporter firm share in the intensive margin equation
captures composition effects in exports generated by endogenous firm entry: average firm exports depend on
the average sales cost of the endogenous pool of exporter firms.


                                                     2
dependence on the firm exporter share. When both elasticity functions are constant, the
aggregate trade elasticity is also constant and the model's predictions are isomorphic to those
of the constant-elasticity gravity trade models in Arkolakis et al. (2012).
    We then derive expressions to nonparametrically recover changes in economic fundamentals
from observed data. Given the two gravity elasticity functions, the inversion of changes in
bilateral (variable and fixed) trade costs only requires data on changes in trade flows, firm
exporter shares, and wages. This result does not hinge on the type of symmetry assumption
imposed by Head and Ries (2001). The inversion of domestic productivity shifters also
requires observing changes in the country's price index, as in Eaton, Kortum, Neiman and
Romalis (2016).
    We conclude our theoretical analysis by deriving nonparametric expressions for the impact
of trade shocks on welfare that extend sufficient statistics in the literature ­ e.g., Melitz
(2003), Arkolakis et al. (2012) and Melitz and Redding (2015). In particular, we derive an
extension of the formula in Arkolakis et al. (2012) for small shocks in which welfare gains
combine the initial trade elasticity, and changes in the domestic spending share and number
of entrants. By integrating this formula for large shocks, we show that welfare gains must
account for the correlation between changes in the trade elasticity and changes in domestic
spending share and firm entry, which depends on the two elasticity functions of firm exports.
    Our theoretical results indicate that different parametric assumptions in the literature only
affect the model's aggregate predictions through what they imply for the shape and level of the
gravity elasticity functions of the firm export margins. Moreover, such parametric assumptions
play the key role of allowing the identification of the export margin elasticities from micro
cross-sectional variation in observed firm outcomes.3 Without parametric distributional
assumptions, cross-firm variation in sales and exports does not identify the two functions
necessary for counterfactual analysis. Instead, we argue that, in a more general environment
without parametric restrictions in the distribution of firm fundamental, one should directly
estimate the gravity elasticity functions of the firm export margins.
    We do so by extending standard tools for gravity estimation to recover the two sufficient
elasticity functions using the model-implied semiparametric gravity equations of firm exports.
We exploit cross-country variation in exporter firm share and average firm exports induced by
observed shifters of bilateral trade costs (conditional on origin and destination fixed-effects).
This requires two main assumptions. First, different country groups must have common trade
   3
     For instance, the elasticities of all margins do not vary with the exporter firm share if firm productivity
has the Pareto distribution in Chaney (2008). The elasticities are decreasing in the exporter firm share
if productivity has the Truncated Pareto distribution in Melitz and Redding (2015) or the Log-normal
distribution in Head et al. (2014). These parametric assumptions allow the identification of the elasticity
functions and the extrapolation of counterfactual predictions from cross-firm variation in sales and exports.



                                                       3
elasticity functions. Second, observed cost shifters must satisfy the same set of assumptions
necessary for the consistent estimation of constant-elasticity gravity models ­ for a review,
see Head and Mayer (2014). Intuitively, our methodology extends that of standard constant-
elasticity gravity estimation by specifying the elasticity of each export margin to be a flexible
function of the observed exporter firm share.
    Our estimates yield three main insights about the impact of trade costs on the different
export margins.4 First, the extensive margin of firm entry is more responsive when few firms
serve a market (in line with Kehoe and Ruhl (2013) and Kehoe, Rossbach and Ruhl (2015)).
We estimate an extensive margin elasticity of six for low levels of the exporter firm share,
but this elasticity is only two if more than 10% of the country's firms export to a destination.
Second, we estimate an intensive margin elasticity that is positive (as in Fernandes et al.
(2019)) but not sensitive to the number of exporter firms. As in Melitz (2003), our intensive
margin elasticity entails strong composition effects: an increase of 1% in the number of
exporters is associated with a reduction of 0.2% in average firm exports due to the higher
cost of marginal exporters. Lastly, the combination of these two margins yields an aggregate
trade elasticity that declines with the firm exporter share, varying between seven and four.
    We conclude by studying the welfare consequences of two types of trade shocks in 2012:
(i) moving from the current equilibrium to autarky by setting trade costs to infinity, and (ii)
reverting trade costs within the European single market to its level of 2003. We measure the
importance of firm heterogeneity for the shock's impact by comparing results implied by our
baseline estimates of the gravity elasticity functions and those implied by the benchmark
constant-elasticity gravity model of bilateral trade flows.5
    In our first exercise, the welfare impact of moving to autarky obtained with our baseline
estimates differs on absolute value by an average of 7% from those implied by the constant-
elasticity gravity benchmark. Firm heterogeneity has a substantial impact on some countries
in which our baseline gains differ by more than 25% from the gains in the benchmark model.
We find that, because of the non-linear trade elasticities, our baseline gains are systematically
larger than those in the benchmark for countries with a higher fraction of firms exporting.
    Our second exercise quantifies the welfare impact of changes in trade costs within the
European single market from 2003 to 2012. Using our theoretical inversion result, we use
changes in observed outcomes to recover actual changes in fixed and variable costs of selling
in different markets. We find that the impact of such shocks was highly heterogeneous across
   4
     We use a sample of exporter-importer pairs in 2012 covering 88% of world trade. Following the gravity
estimation literature, our trade cost shifter is bilateral distance.
   5
     As discussed above, firm heterogeneity does not matter in this benchmark since it is isomorphic to the
gravity trade models in Arkolakis et al. (2012). So, counterfactual predictions only require the aggregate
constant trade elasticity and the initial trade flow matrix.



                                                    4
countries. While the average welfare gain was only 0.5% in Western Europe, it was 3.4%
in East Europe (Estonia and Hungary both saw gains of over 5%). Isolating the impact of
different shocks, we show that changes in fixed costs had only a small welfare impact. Most
of the gains came from reductions in variable costs, with the larger gains in East Europe
driven by stronger reductions in their export costs.6 Compared to the constant-elasticity
gravity benchmark, the average welfare impact of European market integration is 8% higher
with our baseline estimates. This is because trade shocks affect several country pairs whose
exporter firm shares yield a trade elasticity above the benchmark constant trade elasticity.
    Our paper is related to an extensive literature using variations of the framework in
Melitz (2003) together with parametric distributional assumptions to conduct empirical and
counterfactual analyses ­ for a review, see Melitz and Redding (2014). We complement this
literature by showing how to introduce firm heterogeneity in such analyses while dispensing
parametric restrictions on the distribution of firm fundamentals. Our analysis indicates
that the role of firm heterogeneity is summarized by two trade elasticity functions that are
identified from semiparametric gravity equations for the margins of firm exports.7 Parametric
assumptions made in the literature are central to extrapolate counterfactual predictions
from micro moments associated with cross-firm heterogeneity. Our empirical results show
that such an approach may have a large quantitative impact on the contribution of firm
heterogeneity for the model's predictions as it effectively restricts the two elasticity functions.
    Our empirical analysis relies on two semiparametric gravity equations of firm exports.
It is thus related to the literature estimating extensions of the log-linear gravity equation
of bilateral trade flows ­ e.g., Novy (2013), Fajgelbaum and Khandelwal (2016), and Lind
and Ramondo (2018). We also show that semiparametric gravity equations arise when we
extend our baseline environment to allow for (i) tariffs, multiple sectors, multiple factors,
and input-output links as in Costinot and Rodriguez-Clare (2013) and Caliendo and Parro
(2014), (ii) zero bilateral trade flows as in Helpman et al. (2008), (iii) multi-product firms as
in Bernard, Redding and Schott (2011) and Arkolakis, Ganapati and Muendler (2019b), and
(iv) non-CES demand functions with a single price aggregator as in Matsuyama and Ushchev
(2017) and Arkolakis, Costinot, Donaldson and Rodr´     iguez-Clare (2019a).
    We also contribute to a recent literature focusing on nonparametric counterfactual
analysis in international trade models (Adao, Costinot and Donaldson, 2017; Bartelme, Lan
and Levchenko, 2019). Counterfactual predictions in these settings require knowledge of
   6
     The impact of our baseline inverted shocks is larger and more heterogeneous than the impact of either
observed changes in tariffs or symmetric trade shocks inverted with a nonparametric extension of the procedure
in Head and Ries (2001).
   7
     Fernandes et al. (2019) show that counterfactual analysis can be conducted for any given parametric
distribution of firm productivity, but its implementation still requires the distribution to be specified.



                                                      5
multivariate functions whose nonparametric estimation is challenging in finite samples ­ for
example, Adao et al. (2017) must estimate a country's demand function for all factors in
the world economy. Compared to these papers, we show how to construct nonparametric
counterfactuals in a different class of models featuring monopolistic competition and increasing
returns to scale. Moreover, it is simple to implement our methodology in finite samples
since it only requires estimating two univariate functions of the exporter firm share using
semiparametric gravity equations. Further work that offers sufficient statistics for welfare and
trade in general environments requires parametric assumptions for the actual implementation
of empirical and counterfactual analyses (e.g. Baqaee and Farhi (2019); Kleinman, Liu and
Redding (2020); Adao, Arkolakis and Esposito (2020)).
    Finally, we offer formal results on how to recover changes in economic fundamentals that
can be used in counterfactual analysis. These results constitute a nonparametric extension of
the identification procedure in Eaton et al. (2016) in which we recover (potentially asymmetric)
changes in fixed and variable trade costs, as well as changes in productivity. This is different
from the focus on symmetric bilateral variable trade shifters, as in the approach of Adao et
al. (2017), or productivity and amenity shocks (given bilateral trade shifters), as for example
in the spatial models in Allen and Arkolakis (2014) and Redding (2016).
    Our paper is organized as follows. Section 2 derives the semiparametric gravity equations
for the extensive and intensive margins of firm exports. In Section 3, we present our
nonparametric counterfactual analysis and inversion of economic fundamentals. Section 4
outlines the methodology to estimate the two main elasticity functions in the model. In
Section 5, we report our baseline estimation results. Section 6 conducts counterfactual
exercises. Section 7 concludes.


2     Model
We consider an economy in which firms are heterogeneous in terms of productivity, demand,
and trade (variable and fixed) costs. The equilibrium of this economy entails two semi-
parametric gravity equations for the extensive and intensive margins of firm exports. In
general equilibrium, the functions in these two gravity equations along with country-level
fundamentals determine trade flows, firm entry, price indices, and wages.


2.1    Environment
Demand.       Each country j has a representative household that inelastically supplies L¯j
units of labor. In each country j , the representative household has Constant Elasticity of


                                               6
Substitution (CES) preferences over the continuum of available varieties from different origins
i,   ij , with elasticity of substitution  > 1. This yields j 's demand for variety  from
country i:
                                                                    -
                                                          pij ( )       Ej
                              qij ( ) = ¯
                                        bij bij ( )                        ,                      (1)
                                                            Pj          Pj
where, in market j , Ej is the total spending, pij ( ) is the price of variety  of country i, and
Pj is the CES price index,

                           Pj1- =               bij bij ( ) (pij ( ))1- d.
                                                ¯                                                 (2)
                                     i   ij


    The demand shifters, bij ( ), generate dispersion in sales across varieties conditional on
prices. The term ¯
                 bij is the component of bilateral taste shifters that is common to all varieties.

Production.       Each variety is produced by a single firm, so we refer to a variety as a
firm-specific good. The production function implies that, in order to sell q units in country j ,
firm  from country i incurs in a labor cost of

                                               ij ( ) ¯ij        ¯
                             Cij (, q ) = wi              q + wi f ij fij ( ).
                                               ai ( ) a
                                                      ¯i

The first term is the variable cost of selling q units in country j , including both firm-specific
iceberg shipping costs,     ¯ij ij ( ), and productivity, a
                                                          ¯i ai ( ). The second term is the fixed cost
of labor necessary to enter j . As in Melitz (2003), we specify the fixed entry cost in terms of
labor in the origin country. However, we depart from Melitz (2003) by allowing firms to be
different not only in their productivity, but also in their variable and fixed costs of exporting.
Eaton et al. (2011) show that these additional sources of firm heterogeneity are important to
generate observed patterns of firm-level exports to different countries.
    We consider a monopolistic competitive environment in which firms maximize profits
given the demand in (1). For firm  of country i, the optimal price in market j is pij ( ) =
     ¯ij wi ij ( )
 -1 a  ¯i ai ( )
                   with an associated revenue of

                                                          1-
                                                     wi
                         Rij ( ) = r
                                   ¯ij rij ( )                 Ej         where                   (3)
                                                     Pj

                                             1-                                    1-
                                    ij ( )                                   ¯ij
                rij ( )  bij ( )                         ¯ij  ¯
                                                     and r    bij                       .         (4)
                                    ai ( )                                -1 a
                                                                             ¯i



                                                    7
   We refer to rij ( ) as the revenue potential in j of firm  from i and r       ¯ij as the bilateral
revenue shifter that is common to all firms. Conditional on entering market j , rij ( ) is the
 -specific sales shifter in j that combines different sources of firm heterogeneity.
   The firm's entry decision depends on the profit generated by the revenue in (3), (1/ )Rij ( ),
and the fixed-cost of entry, wi f     ¯ij fij ( ). Specifically, firm  of i enters j if, and only if,

ij ( ) =  1
            Rij ( ) - wi f¯ij fij ( )  0. This yields the set of firms from i selling in j , ij :

                                                        ¯                  
                                               rij ( )  f ij          wi      Pj
                        ij        eij ( )                                        .               (5)
                                               fij ( )  r
                                                        ¯ij           Pj      Ej
We refer to eij ( ) as the entry potential of firm  of i in j . Among firms with identical
revenue potential, heterogeneity in the fixed-cost of entry generates heterogeneity in entry
potentials and, therefore, in decisions to enter different destination markets. The difference
between revenue and entry potentials of firms allows for imperfect cross-firm correlation
between entry and sales across markets.

General Equilibrium. Firms in country i hire F    ¯i units of domestic labor to create a new
variety whose characteristics are a random draw from an arbitrary distribution:

                        vi ( )  {ai ( ) , bij ( ), ij ( ), fij ( )}j  Gi (v ).                   (6)

   In the free entry equilibrium, Ni enter and receive an expected profit of zero,

                                                               ¯i .
                                      E [max {ij ( ); 0}] = wi F                                 (7)
                                  j


                                                                           ¯i }i , so that
As in Dekle et al. (2008), we allow for exogenous international transfers {T

                                           ¯i + T
                                  Ei = w i L    ¯i ,        ¯i = 0.
                                                            T                                    (8)
                                                        i


    Since labor is the only factor of production, labor income in i equals the total revenue of
firms from i: wi Li = ij Rij ( ) d . Given the expression in (3),

                                             1-
                             ¯i = r     wi
                          wi L    ¯ij             Ej          rij ( ) d .                        (9)
                                        Pj               ij


Summarizing, given the arbitrary distribution in (6), the equilibrium is defined as the vector
{Pi , {ij }j , Ni , Ei , wi }i satisfying equations (2), (5), (7), (8), (9) for all i.



                                                  8
2.2     The Extensive and Intensive Margins of Firm Exports
We now use two aggregate bilateral outcomes, the share of firms from i selling in j , nij =
P r [  ij ], and their average sales, x  ¯ij  E [Rij ( ) |  ij ], to define two corresponding
aggregate elasticity functions that control how the intensive and extensive margins of firm-
level exports respond to changes in bilateral trade costs. In the next section, we use these
elasticity functions in our sufficient statistics characterization of the counterfactual impact
of trade shocks on aggregate outcomes. In the rest of the paper, we refer to nij and x      ¯ij as
exporter firm share and average firm exports.
    We consider the CDF of (rij ( ), eij ( )) implied by Gi (v ). Without loss of generality, this
CDF can be decomposed as

                                    r                                     e
                          rij ( )  Hij (r|e) ,        and       eij ( )  Hij (e).                        (10)
                                                        e
Intuitively, firms draw their entry potential e from Hij  (e). Conditional on having an entry
                                                              r
potential of e, firms draw their revenue potential r from Hij   (r|e). We impose the following
regularity condition on the distribution of entry potentials.
                           e
Assumption 1. Assume that Hij (e) is continuous and strictly increasing in R+ with
       e
lime Hij (e) = 1.
                                            e
     This assumption implies that that Hij     has no mass points, which guarantees that any
trade cost change induces a positive mass of firms to switch entry decisions. This is central
for the change of variables necessary for our characterization of the equilibrium below.8
     Our specification allows for any pattern of heterogeneity and correlation in (rij ( ), eij ( )).
It thus encompasses several distributional assumptions in the literature. For instance, in
Melitz (2003), the only source of firm heterogeneity is productivity such that rij ( ) =
eij ( ) = (ai ( ))-1 . The single source of heterogeneity implies a strict hierarchy of entry
across destinations and a perfect cross-firm correlation between intensive and extensive
margins of export. The distribution of eij can be specified to be Pareto, as in Chaney
(2008) and Arkolakis (2010), truncated Pareto, as in Helpman et al. (2008) and Melitz and
Redding (2015), or log-normal, as in Head et al. (2014) and Bas et al. (2017). Multiple
papers incorporate additional sources of heterogeneity across firms that yield dispersion in
both rij ( ) and eij ( ). For example, the demand and entry cost heterogeneity in Eaton et
al. (2011) are modeled so that ai ( ) is Pareto distributed while bij ( ) and fij ( ) are joint
log-normally distributed while Fernandes et al. (2019) assume a multivariate log-normal
   8
    The assumption of no upper bound on the support of e also implies positive trade flows between all
origin-destination pairs. However, this is not essential. In Section 3.4, we allow for the possibility of zero
                                                                   e
                                              ¯ij <  such that Hij
bilateral trade by imposing that there exists e                      (¯
                                                                      eij ) = 1.

                                                      9
distribution of bilateral sale shifters across destinations. Arkolakis et al. (2019b) extend these
setups by considering a further layer of product-firm heterogeneity.
    We now use Assumption 1 to characterize the extensive and intensive margins of firm
exports. Focusing on the extensive margin first, we define the inverse distribution of entry
                           e -1
potential: ij (n)  Hij           (1 - n) where ¯ij (n) is strictly decreasing, ij (1) = 0, and
limn0 ij (n) = . Applying this definition to (5),

                        ln   ij (nij )
                                               ¯
                                         = ln  f ij /r
                                                                
                                                     ¯ij + ln (wi ) - ln Ej Pj-1 .                                 (11)

This expression is a semiparametric gravity equation since it relates the function ij (nij ) to a
log-linear combination of exogenous bilateral trade shifters and endogenous outcomes in the
                                                                         ln ij (n)
origin and destination markets. Notice that its elasticity, ij (nij )   ln    n
                                                                                     , controls
                                                                                                    n=nij
the sensitivity of the exporter firm share to changes in bilateral trade costs (holding constant
other endogenous variables),
                                      ln nij    -1
                                             =            < 0.                              (12)
                                      ln ¯ij    ij (nij )
Turning to the intensive margin, we define the average revenue potential when a share nij of
i s firms sell in j as
                                            nij
                                       1
                           ij (nij )            E [r|e = ij (n)] dn                    (13)
                                      nij 0
where E [r|e = ¯ij (n)] is the mean revenue potential of firms in quantile n of the entry
potential distribution. Average bilateral firm sales can be written as

                        1-                                                                  ¯           
                 wi                                     dH e (e)                            f ij   wi       Pj
    x
    ¯ij = r
          ¯ij                Ej             E [r|e]                  ,     where eij                           .
                 Pj                  eij
                                                      1 - H e (eij )                        ¯ij
                                                                                            r      Pj       Ej

                                                                                        e
   We now implement a change of variables in this expression by defining n = 1 - Hij      (e)
                     e
such that nij = 1 - Hij (eij ). This yields our second semiparametric gravity equation:


                                                              1-
                         ¯ij - ln ij (nij ) = ln (¯
                      ln x                        rij ) + ln wi  + ln Ej Pj-1 ,                                    (14)

The expression relates the composition-adjusted average firm exports to a linear combination
of exogenous bilateral trade shifters and endogenous outcomes in the origin and destination
                                               ln  (n)
markets. The elasticity of ij (n), ij (nij )   lnij
                                                  nij
                                                          , controls the sensitivity of average
                                                                         n=nij
firm exports to changes in bilateral trade costs (holding constant other endogenous variables):

                                   ln x
                                      ¯ij                                        ln nij
                                          = -( - 1) +               ij (nij )           .                          (15)
                                   ln ¯ij                                        ln ¯ij


                                                            10
    This elasticity combines two well-known forces. The first term is the reduction in the sales
of the initial set of exporters in j arising from the constant elasticity of substitution across
varieties. The second term measures how the change in the number of exporters affects the
average revenue potential of firms selling in j . The sign of this term depends on how different
marginal and infra-marginal exporters are in terms of revenue potential. Specifically,

                                                        E [r|e = ij (nij )]
                                 ij (nij )   =    1     nij                     - 1.                           (16)
                                                 nij   0
                                                            E [r|e = ij (n)] dn

Notice that ij (nij ) < 0 if, and only if, the mean revenue potential of marginal exporters,
                                                                                        nij
E [r|e = ij (nij )], is lower than that of the average exporter, ij (nij ) = n1    ij  0
                                                                                            E [r|e =
            9
 ij (n)] dn.

     The bilateral trade flow between i and j , Xij , combines the extensive and intensive
margins of firm exports, Xij = Ni nij x
                                      ¯ij . Thus, by definition, ij (nij ) and ij (nij ) determine
the elasticity of bilateral trade flows to changes in bilateral trade costs (holding constant
endogenous variables in the origin and destination countries):

                       ln Xij             ln nij  ln x ¯ij                             1 + ij (nij )
       ij (nij )  -           =-                 +                  = ( - 1) 1 -                       .       (17)
                       ln ¯ij             ln ¯ij    ln ¯ij                               ij (nij )

    This expression indicates that nij acts like a state variable that determines the elasticity
of bilateral trade flows to changes in trade costs ­ the so-called trade elasticity. This occurs
because nij controls the elasticity of the extensive and intensive margins of firm exports.
Notice that the trade elasticity is positive for all nij since ij (nij ) < 0 and ij (nij ) > -1.

Distributional assumptions and elasticity of trade flows. Overall, one of our key
findings is that the extensive and intensive margin elasticities, and thus the bilateral trade
elasticity, are univariate functions of the exporter firm share, nij . We do not impose
restrictions on these functions other than the regularity conditions in Assumption 1. Before
characterizing the non-parametric sufficient statistics in our model, we show how different
parametric assumptions on the distribution of firm fundamentals yield specific patterns of
dependence between the extensive and intensive margin elasticities of firm exports and the
exporter firm share. In particular, Figure 1 illustrates the elasticity functions implied by
productivity distributions from the Pareto family (Chaney, 2008), the truncated Pareto
family (Melitz and Redding, 2015), and the log-normal family (Head et al., 2014). We also
   9
     In Melitz (2003), the single source of firm heterogeneity (rij ( ) = eij ( )) implies that E [r|e = ij (nij )] =
                                                                                                          ij (n)
 ij (nij ). In this case, marginal exporters are worse than existing infra-marginal exporters since          n      =
1     n
n 2  0
        (  ij ( n ) - ij ( x )) dx < 0 and ij ( n ) < ij ( x) for all x < n.



                                                           11
              Figure 1: Distributional assumptions and Elasticity of different margins of trade flows
                             Elasticity of    (n)                                         Elasticity of    (n)                                Elasticity of Trade:
              0                                                            0                                                      8
                                                                                                                                                            Pareto
            -0.5                                                         -0.5
                                                                                                                                  7                         Truncated Pareto
                                                                                                                                                            Log Normal




                                                                ln (n)
ln (n)




                                                                                                                                  6
             -1                                                           -1                                                                                EKK
                                                                                                                                  5




                                                                (n ) /
ln (n ) /




                                                                                                                             ij
            -1.5                                                         -1.5
                                                                                                                                  4

             -2
                   Pareto                                                 -2
                                                                                Pareto




                                                                ln
                   Truncated Pareto                                             Truncated Pareto                                  3
                   Log Normal                                                   Log Normal
            -2.5                                                         -2.5
                   EKK                                                          EKK                                               2


             -3                                                           -3                                                      1
                   0.1%     0.5% 1%          5% 10%   50%100%                   0.1%     0.5% 1%          5% 10%   50%100%            0.1%     0.5% 1%       5% 10%     50%100%
                          Log Exporter Firm Share                                      Log Exporter Firm Share                               Log Exporter Firm Share

Note. Left panel reports the elasticity of ij (n). Center panel reports the elasticity of ij (n). Right panel reports the trade
elasticity ij (n) in (17). Each line corresponds to the elasticity as a function of n implied by different parametric restrictions
on the distribution of firm fundamentals. See main text for a description of each parametrization.


consider the specification in Eaton et al. (2011) where productivity has a Pareto distribution
and shifters of demand and entry costs have a joint log-normal distribution. In all cases, we
use the baseline parameters reported in each paper.
    The first plot indicates that the Pareto assumption yields constant elasticities of all
margins. The other parameterizations yield a declining elasticity of (n), which, by equation
(12), implies that the extensive margin elasticity is more sensitive when the exporter firm share
is low. Similarly, all other parameterizations yield a declining elasticity of (n), indicating
that new entrants and incumbents are more similar to each other when nij is small. This
implies that composition effects are weaker when few firms export to a particular destination.
The third panel combines these two margins to show that the trade elasticity is higher when
nij is low. In all parametrizations, the trade elasticity falls below two when nij is above 50%.
We show below that this implies a low elasticity in the domestic market where nii is high,
which has important implications for the measurement of the gains from trade.


2.3                  Sufficient Statistics of Firm Heterogeneity
Having characterized individual firm decisions and aggregate trade flows as a function of ij (n)
and ij (n), the following lemma establishes that all aggregate variables in equilibrium only
depend on firm heterogeneity through ij (n) and ij (n). Specifically, we show in Appendix A.1
that the equilibrium equations determining price indices, number of entrants, expenditures
and wages can be expressed in terms of model fundamentals {T       ¯i , L
                                                                        ¯ i, F    ¯
                                                                             ¯i , f      ¯ij }, the elasticity
                                                                                    ij , r

of substitution  , and the elasticity functions { ij (n), ij (n)}i,j .

Lemma 1. Suppose Assumption 1 holds. The equilibrium vector {nij , x       ¯ij , Xij , Pi , Ni , Ei , wi }i,j
can be fully characterized as a function of (i) country fundamentals {T    ¯i , L
                                                                                ¯ i, F    ¯
                                                                                     ¯i , f      ¯ij }i,j , (ii)
                                                                                            ij , r

the elasticity of substitution  , and (iii) the bilateral elasticity functions, { ij (n), ij (n)}i,j .

                                                                                             12
Proof. See Appendix A.1.
    The intuition for this lemma follows from the equilibrium characterization in Melitz
(2003). We first show that all aggregate variables depend on the set of firms operating in each
country pair and their average sales, which can be written as functions of the equilibrium
entry cutoff. We then use the same inversion argument used in Section 2.2 to establish a
one-to-one mapping between these functions of the entry cutoff and ( ij (n), ij (n)).
    The results of this section indicate that the functions ij (n) and ij (n) summarize the
aggregate implications of the different dimensions of firm heterogeneity in the model. Thus,
any parametric restriction on the distribution of firm fundamentals affects the economy's
equilibrium insofar it determines the shape of these functions. We summarize this discussion
in the following remark.

Remark 1. All dimensions of heterogeneity can be folded into the functions ij (n) and ij (n)
that govern the semiparametric gravity equations for the extensive and intensive margins of
firm exports, (11) and (14), and all aggregate variables in general equilibrium.

    The rest of the paper exploits this insight in two ways. In the next section, we build
directly on Lemma 1 by using { ij (n), ij (n)}i,j to provide ex-ante and ex-post sufficient
statistics for the counterfactual impact of trade shocks on aggregate outcomes and welfare
given bilateral trade and exporter entry data. We also show how to invert changes in
the economy's fundamentals given knowledge of { ij (n), ij (n)}i,j and observed changes in
bilateral trade and exporter entry. In Section 4, we will exploit the semiparametric gravity
equations in (11) and (14) to estimate ij (n) and ij (n) without imposing any parametric
restrictions on the distribution of firm fundamentals.


3     Nonparametric Counterfactual Analysis and Identi-
      fication of Economic Fundamentals
This section uses the equilibrium characterization above for counterfactual analysis and
identification of changes in fundamentals without imposing parametric restrictions on the
distribution of firm fundamentals. We first show how to construct nonparametric coun-
terfactual changes in aggregate outcomes in response to changes in fundamentals using
observed trade data in the initial equilibrium and (, ij (n), ij (n)). We then discuss how
to nonparametrically identify shocks to economic fundamentals from changes in observed
outcomes given knowledge of (, ij (n), ij (n)). Finally, we use (, ij (n), ij (n)) and trade
data to construct sufficient statistics for welfare gains implied by shocks in trade cost.

                                              13
3.1     Counterfactual Responses to Changes in Fundamentals
We start by characterizing how to compute counterfactual changes in aggregate outcomes
following exogenous shocks in the economy's fundamentals. We consider shocks in interna-
tional transfers T¯i , population L
                                  ¯ i , entry costs F                              ¯
                                                     ¯i , fixed costs of exporting f ij , and bilateral
                                           0
revenue shifters r
                 ¯ij . We use y^j  yj /yj to express changes in any variable between its level in
                                      0
the initial observed equilibrium, yi    , and the counterfactual equilibrium, yi . We also use bold
letters to denote vectors, y = [yi ]i , and bold bar variables to denote matrices, y      ¯ = [yij ]i,j .

Proposition 1. Consider any change in fundamentals, {T         ^,L^,F^,f^
                                                                        ¯,^
                                                                          r }. Given the matrices
                                                                          ¯
of exporter firm shares and bilateral trade flows in the initial equilibrium (n      ¯ 0 ), the substi-
                                                                                ¯ 0, X
tution elasticity  and the functions (¯(n ¯ ), ¯ (n
                                                  ¯ )) (up to a scalar) are ``sufficient statistics''
that characterize the counterfactual changes in equilibrium outcomes, {n      ^
                                                                              ¯,x ^
                                                                                  ¯,X^
                                                                                     ¯ ,P ^,N ^ ,w^ }.

Proof. See Appendix A.2.
    The proposition generalizes the sufficient statistics result of Arkolakis et al. (2012) beyond
the class of constant-elasticity gravity models by exploiting the characterization of the
equilibrium in Lemma 1. It outlines two sufficient requirements to compute counterfactual
changes in aggregate outcomes. First, it is not necessary to know the entire distribution of
firm fundamentals in the initial equilibrium. Instead, one only needs to obtain the exporter
firm share nij , and the two functions controlling the extensive and intensive margins of
firm exports, ij (n) and ij (n). Second, it is also necessary to obtain bilateral trade flows
between countries, as in the original ``hat algebra'' methodology in Dekle et al. (2008), and
the elasticity of substitution  , as in the ``hat algebra'' for heterogeneous firm models (see
Costinot and Rodriguez-Clare (2013)).10
    According to Proposition 1, the trade elasticity, ij (nij ), does not play a direct role in
the model's counterfactual predictions without parametric restriction on the distribution
of firm fundamentals. However, as the next proposition shows, the trade elasticity is the
channel through which the extensive and intensive margin elasticities of firm exports affect
counterfactual changes in aggregate outcomes in response to trade cost shocks.

Proposition 2. Consider a small shock to the bilateral revenue shifters between origin o and
                    ¯od . Denote the vector of aggregate outcomes as Yi  {{Xij }j , Pi , Ni , wi }.
destination d, d ln r
1. The elasticity of any element of Yi to r
                                          ¯od is a function of (, ¯ (n      ¯ 0 ):
                                                                     ¯ 0 ), X

                                    d ln Yi                    ¯0 ,
                                                      ¯ ¯ 0 ), X
                                             = z
                                               i,od ,  (n                                                (18)
                                    d ln r
                                         ¯od
  10
    The elasticity of substitution is necessary when the entry cost is set in terms of the origin country wage.
In this case, gravity origin fixed-effects contain wages with an elasticity determined by  .

                                                     14
where ij (n) is the trade elasticity function defined in (17).
2. The elasticity of nij to r
                            ¯od is a function of (, ¯ (n      ¯ 0 ) and ij (n0 ):
                                                       ¯ 0 ), X              ij


                                d ln nij  ~z                ¯ 0 , ij (n0 ) .
                                                   ¯ ¯ 0 ), X
                                         = ij,od ,  (n                 ij                                    (19)
                                d ln r
                                     ¯od

Proof. See Appendix A.3.
    The first part of the proposition establishes that the elasticity of aggregate outcomes,
{{Xij }j , Pi , Ni , Ei , wi }, to bilateral trade costs is a function of the initial aggregate trade
matrix, X  ¯ 0 , the elasticity of substitution  , and the bilateral trade elasticity matrix,    ¯ (n
                                                                                                    ¯ 0 ).
Thus, in contrast to Proposition 1, the first part of Proposition 2 indicates that, at least for
local responses, separate knowledge of the extensive and intensive margin elasticities ­and
thus the distribution of firm-specific fundamentals­is not required conditional on knowing
the trade elasticity matrix,          ¯ (n
                                         ¯ 0 ).11 The second part of Proposition 2 explains exactly
why computing counterfactual responses for large changes in parameters requires separate
knowledge of ij (n) and ij (n). The extensive margin elasticity, ij (n0            ij ), pins down the
impact of the shock on the exporter firm share, nij . Along the path to the new equilibrium,
changes in nij then imply changes in the trade elasticity ij (nij ) through both the intensive
and extensive margins of firm exports ­ see equation (17). This determines the local responses
of aggregate outcomes for any sequence of small shocks (as shown in the first part of the
proposition).
    Propositions 1 and 2 provide a synthesis of the results in Melitz and Redding (2015), who
stress the importance of varying trade elasticities and firm entry, with the results of Arkolakis
et al. (2012), who stress the sufficient role of the constant trade elasticity for responses in
aggregate outcomes to trade shocks. According to Proposition 2, firm heterogeneity matters
to the extent that it controls how much trade shocks affect the trade elasticity through (large)
changes in the exporter firm share, ultimately regulated by the functions ij (n) and ij (n).12
    This point is illustrated by the special case in which the intensive and extensive margin
elasticities are constant,
  11
     In Appendix A.3, we show that the same data and elasticity requirements are sufficient to compute the
elasticity of aggregate outcomes to changes in population d ln L      ¯ o and trade imbaliances d ln T
                                                                                                     ¯o . Howerver,
                                                                        ¯                     ¯
to compute elasticities to changes in fixed cost of exporting d ln fod and entry cost d ln Fo , we need also the
initial share of the country's labor force employed to cover fixed costs of exporting, which depends on the
functions ( ij (n), ij (n)) and initial firm export shares {n0ij }i,j in equilibrium.
  12
     It is also useful to compare Proposition 2 to the results of Arkolakis et al. (2019a) showing that knowledge
of the trade elasticity is sufficient, locally, for nonparametric counterfactuals in the case of two symmetric
countries. We show that their results hold locally, for many asymmetric countries, but they are not true
when we consider large shocks.




                                                       15
                                 ij (n) = n    ij
                                                    and       ij (n)   = nij ,                       (20)

for ij > -1 and ij < 0. This specification is a flexible extension of the constant elasticity
Pareto variant of Melitz (2003) studied by Chaney (2008).13 In this case, Proposition 2
implies that all aggregate outcomes can be computed by integrating the local responses in
(18) without tracking the changes in the exporter firm share nij (even for large shocks). Thus,
firm heterogeneity does not matter for aggregate outcomes conditional on knowing the trade
elasticity matrix. We summarize the conclusions of this section under the following remark.

Remark 2. Firm heterogeneity only matters for counterfactual responses in aggregate out-
comes to trade shocks through  and the shape of (¯(n      ¯ ), ¯ (n
                                                                  ¯ )). For small trade cost shocks,
   ¯ ), 
(¯(n    ¯ (n
           ¯ )) matter only through their combined effect on the trade elasticity matrix   ¯ (n
                                                                                              ¯ ). If
   ¯ ), 
(¯(n    ¯ (n
           ¯ )) have constant elasticities, then trade elasticities ij are constant and sufficient
to compute counterfactual responses of aggregate outcomes to trade cost shocks.


3.2     Identification of Changes in Fundamentals
In the preceding discussion, we established how to conduct counterfactual experiments
for any given change in economic fundamentals, like changes in productivity and trade
costs. An important challenge in conducting these counterfactuals is to measure actual
changes in economic fundamentals hitting the world economy. We thus show how to identify
such changes in fundamentals from observed aggregate data without imposing parametric
restrictions on the distribution of firm fundamentals or symmetry restrictions on trade cost
changes.
    Given data on n0         ^t
                     ij and {n
                                   ^
                                   ¯t
                              ij , x ij , w
                                          ^it
                                              } for all i and j , we can invert changes in fixed costs of
exporting and relative revenue shifters using {, ij (n), ij (n)}, along with data on bilateral
sales, firm entry, and wages. In particular, equations (11) and (14) immediately yield

                                            ^
                                            ¯t
                                            x                     0 t
                                                                     ^ ij )/ ij (n0
                                                             ij (nij n            ij )
                           ^
                           ¯t =
                           f
                                               ij
                                                                                       ,             (21)
                             ij        0 t
                                          ^ ij )/ij (n0
                                  ij (nij n           ij )              w
                                                                        ^i t



and equation (14) implies that

                    ^ t             ^                                                       -1
                    r
                    ¯ij             ¯t
                                    x ij          jj (n0  ^t
                                                       jj n
                                                                      0
                                                            jj )/jj (njj )          w
                                                                                    ^it
                        =                                                                        .   (22)
                    ^ t
                    ¯jj
                    r     ij (n0  ^t
                               ij n
                                             0
                                   ij )/ij (nij )
                                                            ^
                                                            ¯t
                                                            x jj                    ^j
                                                                                    w t


  13
    The model in Chaney (2008) entails rij ( ) = ij ( ) = (ai ( ))-1 and ai ( )  1 - a- , leading to
 ij = ij = ( - 1)/ . This implies that average firm exports do not respond to changes in variable trade
costs because ln x
                 ¯ij does not depend on ln r
                                           ¯ij .


                                                     16
Notice that we obtain these expressions without imposing the symmetry of trade cost changes
used by Head and Ries (2001). We achieve this more general result at the cost of also
requiring data on wage changes.14 In Appendix A.4, we show that one can use the free entry
condition to invert changes in fixed entry costs, F ^
                                                    ¯i , using the same information.
    Intuitively, equation (21) states that fixed entry costs must have increased whenever we
                                                              ¯t
                                                              ^
                                                              x ij
observe that the composition-adjusted firm sales, ij (n0 n    t         0 , has increased relative to the
                                                         ij ^ ij )/ij (nij )
                                                   0 t              0       t
change in the entry cost of marginal firms, ij (nij n
                                                    ^ ij )/ ij (nij )w   ^i   . Similarly, in market j , the
revenue shifter of i must have increased more than that of j whenever the composition-adjusted
sales of firms from i in j increase more than those of domestic firms.
    We use the expressions in (21)­(22) to formally establish the identification of changes in
economic fundamentals from observed changes in aggregate outcomes.

Proposition 3. Consider matrices of exporter firm shares and bilateral trade flows in
the initial equilibrium (n       ¯ 0 ), the substitution elasticity  , and the elasticity functions
                            ¯ 0, X
   ¯ ), 
(¯(n       ¯ )). Observed changes in {n
        ¯ (n                              ^
                                          ¯,x^
                                             ¯,X^
                                                ¯ ,w^ } between two equilibria uniquely identify the
set of shocks in fundamentals {T    ^,L ^,F^,f^ ^
                                              ¯,¯        ^
                                                r } with r
                                                ~              ^
                                                         ~ij = r    ^
                                                               ¯ij /r
                                                                    ¯jj . Observing also the change in
                    ^
the price index Pj in country j between the two equilibria uniquely identifies the domestic
revenue shock r   ^
                  ¯jj in country j .

Proof. See Appendix A.4.
    It is important to note that the full separation of location specific shocks (e.g. productivity
gains) from bilateral revenue shocks (e.g. bilateral trade shocks) requires knowledge of
price index changes (as the second part of the proposition shows). Without price index
information, the two could not be separated because changes in relative output of countries
can be generated by either a uniform change in exporting advantage or different combinations
of changes in bilateral revenue shifters ­ a formal result that follows from the insights of
Eaton et al. (2016).15


3.3      Sufficient Statistics for Welfare Gains
We finally derive expressions for welfare gains caused by shocks to fundamentals, {T  ^,L
                                                                                        ^,F  ^
                                                                                             ¯,^
                                                                                           ^,f  r },
                                                                                                ¯
under trade balance (i.e., Ti = 0). When f  ^
                                            ¯     ^
                                             ii = r
                                                  ¯ii = 1, our expressions link real wage changes
to observable variables and measurable functions, leading to sufficient statistics for the
  14
     Our result differs from that in Adao et al. (2017) who use an invertible aggregate demand system to
                                                                                                      ^
nonparametrically recover the effective bilateral prices in each destination ­ i.e., in our notation, r    ^
                                                                                                      ¯ij /r
                                                                                                           ¯jj . We
instead combine demand and supply equations to invert fixed costs and relative revenue shifters.
  15
     See also Allen et al. (2014) and Costinot et al. (2010). Our identification result provides a formal
treatment of that insight, extends it to cases where elasticities are not constant, and adapts it to monopolistic
competition environments.

                                                        17
welfare consequences of trade shocks. We discuss here the main formulas and present their
derivations in Appendix A.5.
    We first express changes in the real wage in terms of the change in the share of domestic
active firms, n
              ^ ii , and the domestic elasticity function, ii (n). From (11),

                             w
                             ^i        1           ^
                                                   r
                                                   ¯ii             1          ii (nii n
                                                                                      ^ ii )
                        ln         =      ln                   +      ln                       .          (23)
                             ^i
                             P         -1          ^
                                                   ¯
                                                   f               -1           ii (nii )
                                                     ii


Since ii (n) is decreasing and  > 1, the real wage increases if, and only if, nii falls (i.e.,
n
^ ii < 1). The second term in this expression illustrates the main new source of gains
from trade in Melitz (2003): the consumption-equivalent gain of reallocating resources from
domestic firms with a lower entry potential to firms with a higher entry potential. Given
the change in the share of domestic active firms n   ^ ii , welfare gains are higher if ¯ii (n) is more
elastic. Intuitively, for a steeper ii (n), the difference in entry potential between incumbent
and marginal firms is larger, leading to larger reallocation gains.16
     We obtain an alternative welfare formula by combining (11) and (14) to solve for the
change in nii as a function of the changes in domestic spending share xii and number of
entrants Ni . Locally,

                             wi        1       r
                                               ¯ii     1                     xii        ¯
                     d ln         =       d ln ¯ -                    d ln       - d ln f ii ,            (24)
                             Pi        -1      fii ii (nii )                 Ni

which can be written in terms of (, ii (n), ii (n)) due to the definition of ii (n) in (17).
    This expression shows that, for any given d ln (xii /Ni ), the real wage change is stronger
whenever the domestic trade elasticity ii (nii ) is lower. Intuitively, the lower trade elasticity
implies that it is harder for the economy to substitute consumption from foreign varieties to
domestic varieties (through both the extensive and the intensive margins). This amplifies
the cost of reducing the spending share on foreign varieties.
    This expression is closely related to the welfare formulas in Arkolakis et al. (2009) (footnote
17) and Melitz and Redding (2013) (equation 33). Our characterization shows that the trade
elasticity is a function of the observable share of active firms nii . Thus, for large shocks, the
computation of welfare gains must account for the correlation between changes in the domestic
trade elasticity and the domestic spending share (normalized by the number of domestic
entrants). Such a correlation arises from endogenous changes in the share of domestic active
  16
      Expression (23) is related to the characterization of the gains from trade in terms of the domestic
productivity cutoff in Melitz (2003). Notice however that such characterization lacks empirical analogs due
to the lack of measures of the productivity cutoff. Instead, our formula expresses the gains from trade in
terms of the change in the share of active domestic firms n   ^ ii and the extensive margin elasticity function
 ii (n). The next section shows that it is possible to obtain measures of both of these elements.



                                                          18
firms and its implied effect on the domestic trade elasticity.17 Most importantly, perhaps,
the domestic trade elasticity function in equation (24) has a precise empirical content, as we
discuss in the next section.

Remark 3. The elasticity of substitution,  , and the domestic elasticity functions, ii (n) and
ii (n), can be used to compute nonparametric sufficient statistics for the welfare gains implied
by trade shocks.

Gains from Trade. It is possible to use the welfare expressions above to compute the
welfare gains of moving from autarky to the trade equilibrium. This requires solving for the
counterfactual changes in nii and Ni . In Appendix A.6, we show that such changes are the
solution of a nonlinear system of two equations and two unknowns. This system is a special
case of the general system used to compute the nonparametric counterfactual changes in
Proposition 1. It depends on three ingredients: (i) data on exporter firm shares and export
flows of country i in the initial equilibrium {n0      0
                                                 ij , Xij }j , (ii) the elasticity of substitution  ,
and (iii) the two elasticity functions of firm exports for country i, { ij (n), ij (n)}j .


3.4     Extensions
Online Supplemental Material A presents five extensions of our baseline framework.

Multiple sectors, multiple factors, input-output links.               We extend our baseline
model to include multiple factors of production and input-output links between multiple
sectors. Specifically, we extend the multi-sector multi-factor gravity model of Costinot and
Rodriguez-Clare (2013) in which, as in our baseline, firms in each sector are heterogeneous
with respect to productivity, preferences, and variable and fixed trade costs. We restrict all
firms in a sector to have the same nested constant elasticity of substitution (CES) production
technology that uses multiple factors and multiple sectoral composite goods. In this setting,
we derive sector-specific analogs of (11) and (14) that can be used to perform nonparametric
counterfactual analysis with respect to trade cost shocks.18

Allowing for zero bilateral trade flows. We extend our baseline framework to allow
for zero trade flows between two countries. As in Helpman et al. (2008), we allow the support
  17
     As shown in Appendix A.5, expression (24) reduces to the sufficient statistic for the gains from trade in
Arkolakis et al. (2012) when the trade elasticity is restricted to be constant ­as in our CES benchmark­ and
also identical across all destinations ­as in the Melitz-Pareto baseline. This equivalence arises because Ni
does not depend on trade costs in this case.
  18
     This framework also accommodates nested CES preferences for the goods produced by firms with different
observable characteristics ­ for instance, sector affiliation or country of origin.

                                                     19
                                                      e
of the entry potential distribution to be bounded: Hij  (e) has full support over [0, e
                                                                                      ¯ij ]. The
bounded support does not affect the intensive margin gravity equation (14), but it introduces
a censoring structure in the extensive margin equation (11). Under the assumption that zero
trade flows remain equal to zero, we use these extended gravity equations to compute the
model's counterfactual predictions.

Allowing for import tariffs.       Third, we follow Costinot and Rodriguez-Clare (2013)
and introduce bilateral import tariffs in the model. In this setting, market clearing and
spending must account for the fact that tariff revenue remains in the destination country.
We show that the semiparametric gravity equations above still hold, but now bilateral trade
costs also include ad-valorem import tariffs. We then characterize the system of equations
that determines the model's counterfactual predictions without parametric distributional
assumptions. It depends on the same elements as before, with one addition, the tariff levels
in the initial equilibrium.

Multi-product firms. We extend our model to allow firms to produce multiple products
as in Bernard et al. (2011). As in the baseline, we allow for an arbitrary distribution
of firm-specific fundamentals. In this extension however, firms face a convex labor cost
of increasing the number of product varieties that they will sell in each destination (see
e.g. Arkolakis et al. (2019b)). This yields three semiparametric gravity equations: two
extended versions of the baseline expressions for the extensive and intensive margins of firm
exports, and one additional equation for the average number of products sold per firm across
destinations. We establish that the elasticity functions in these equations are sufficient to
construct counterfactual predictions given the same information required by our baseline
setting (i.e., initial trade flows and firm exporter shares, and the elasticity of substitution
across varieties).

Non-CES Preferences.           We adapt our framework to general Marshallian demand
functions that can be written as a function of the destination's price aggregator and income
level. Our demand system subsumes the settings in Arkolakis et al. (2019a) and Matsuyama
and Ushchev (2017). In this case, we abstract from fixed entry costs and incorporate
endogenous firm entry through a choke price in demand. We show how to extend our
inversion argument to derive an extensive margin gravity equation analogous to the one in
(11). Because revenue and entry potentials are identical, the same function in the extensive
margin gravity equation determines the intensive margin of average firm exports.




                                              20
4     Estimation Strategy: Semiparametric Gravity
In the previous section, we derived two main insights. First, the functions ij (n) and
 ij (n) are sufficient to summarize how firm heterogeneity affects counterfactual responses

of aggregate outcomes to trade shocks. Second, these two functions control semiparametric
gravity equations for the extensive and intensive margins of firm exports. This section
outlines a strategy to estimate ij (n) and ij (n) using these gravity equations. We then use
these estimates for counterfactual analysis.


4.1    Semiparametric Gravity Equations of Firm Exports
The gravity equations in (11) and (14) imply the following semiparametric specifications:

                                 ln   ij (nij )
                                                       ¯
                                                  = ln f ij 
                                                              -1
                                                            ¯ij  +~ +~,                      (25)
                                                                   i j


                               ¯ij - ln ij (nij ) = ln 
                            ln x                        1-
                                                       ¯ij +~ + ~ .                          (26)
                                                             i   j

where  ~  ln(  ( - 1)1- a     ¯1 - 
                                   wi ), ~  - ln(Ej P -1 ),  ~  ln(wi ) -    ~ , and   ~  - ~.
        i                      i          j           j       i                i        j    j
                                            ¯
Without loss of generality, we normalize bij  1 since bilateral shifters of demand and trade
                                                                             1- ¯
costs are isomorphic in the model ­ i.e., the equilibrium only depend on   ¯ij   bij .
    These two equations form the basis of our empirical strategy. They link average firm
exports and the two functions of the exporter firm share to bilateral shifters of variable and
fixed costs of exporting, as well as exporter and importer fixed-effects. We can then estimate
ij (n) and ij (n) using these equations along with bilateral data on average firm exports,
exporter firm shares, and trade cost shifters.

Remark 4. ij (n) and   ij (n)   can be estimated with the semiparametric specifications (25)­(26).

    In the rest of this section, we first describe sufficient assumptions on the data generating
process that allow us to estimate ij (n) and ij (n) using the semiparametric equations in (25)
and (26). We then outline an estimator of ij (n) and ij (n) based on cross-country variation
in bilateral trade cost shifters.


4.2    Data Generating Process
Our goal is to estimate the functions ij (n) and ij (n). Throughout our analysis, we use
estimates in the literature to calibrate the elasticity of substitution,  . In particular, we set
 = 3.9 to match the median estimate in Hottman et al. (2016).



                                                       21
    We start by describing the observed and unobserved variables in the economy. For a set
of origin-destination pairs (i, j ), we observe the share of firms of i selling in j , nij , and their
average sales, x
               ¯ij . We make assumptions on the relationship between the variable trade costs
in the model and their observed counterparts (denoted by ij ). We also assume that there is
an exogenous shifter of the variable and fixed trade costs (denoted by zij ).

Assumption 2. Assume that we observe a component of variable trade costs, ij , such that

                                                               u
                                              ln ¯ij = ln ij + ij .                                          (27)

       Assume also that there exists an observed bilateral trade shifter, zij , such that

                                     ln ¯ij = zij  + i    
                                                        + j   
                                                            + ij ,
                                                                                                             (28)
                                        ¯
                                     ln f          f  f   f   f
                                          ij = zij  + i + j + ij .


    These equations are the first-stage of the estimation of the semiparametric gravity
equations. They link variable and fixed trade costs to an observed shifter while accounting for
the fact that we may not observe all components of trade costs.19 Previewing our empirical
application, we use data on bilateral freight costs to measure ij , and data on bilateral
distance to measure zij .
    We further restrict the data generating process of trade shocks.

                                                       f                    u
Assumption 3. Assume that E [ij      |zij , Dij ] = E [ij |zij , Dij ] = E [ij |zij , Dij ] = 0, where Dij
is a vector of origin and destination fixed-effects.

   This orthogonality assumption is the basis of the estimation of constant elasticity gravity
equations of international trade flows ­ for a review, see Head and Mayer (2014). Conditional
on origin and destination fixed-effects, the observed shifter must be mean independent from
unobserved shifters of trade costs.
   Finally, we impose the following restrictions on the functions ij (n) and ij (n) that reduce
their dimensionality but allow for their flexible estimation.

Assumption 4. Assume that origin-destination pairs are divided into groups (g = 1, ..., G)
such that, for all (i, j )  g ,

                                                                  K      
                            ln ij (n)           ln g (n)                 g,k fk (ln n)
                                          =                   =                                              (29)
                            ln ij (n)           ln g (n)          k=1
                                                                         g,k fk (ln n)
  19
    This specification allows zij to affect the fixed cost of entering foreign markets and, therefore, it is weaker
than the requirement in Helpman et al. (2008) that the instrument cannot affect entry costs.

                                                        22
where fk (ln n) denotes restricted cubic splines over knots k = 1, ..., K .

    This assumption imposes two types of restrictions on ij (n) and ij (n). First, these
functions are identical among origin-destination pairs in the same group g . This allows us
to estimate g (n) and g (n) using variation in the observed shifters of trade costs across
origin-destination pairs at a point in time.20 In our empirical application, we specify that all
countries belong to a single group, so that ij (n) = (n) and ij (n) = (n) for all i and j . In
Supplementary Material B, we provide estimates with multiple country groups defined in
terms of characteristics of origin and destination countries.
    Second, Assumption 4 specifies a flexible function basis for g (n) and g (n). We approxi-
mate the shape of these functions with a series of restricted cubic polynomials. We specify
K knots that form intervals, Uk  [uk , uk+1 ], over which a cubic spline function governs the
behavior of the elasticity function ­ see Appendix B.2. We discuss below how our functional
form choice affects the interpretation and generality of our estimates.


4.3     Estimating Moment Conditions
We now construct moment conditions for the estimation of g (n) and                   g (n).



Pass-through from observed shifter to variable trade cost. We first specify an
equation for the estimation of the pass-through from the observed cost shifter zij to the
observed component of variable trade costs ij . Assumption 2, by combining equations (27)
and (28), implies that
                                
                               vij = ln ij - zij  - i
                                                    
                                                      - j
                                                          .                          (30)
                   u                     
Here, vij = ij  - ij , implying that E [vij |zij , Dij ] = 0 by Assumption 3. We exploit this
                        
condition to estimate  using the linear equation in (30).

Semiparametric gravity equations of firm exports. To estimate        ¯g (n) and ¯g (n), we
show in Appendix A.7 that, under Assumptions 2 and 4, equations (25)­(26) yield

                                                     K
                vij                zij                      g,k fk (ln n)           i + j
                       =                         -                            -                ,         (31)
                vij         ln x
                               ¯ij +  ~  zij         k=1
                                                           g,k fk (ln n)            i + j

where ~   - 1 and   1/ ~  + f .
  20
    Our notation allows groups to be defined as destination-origin country pairs over different years. In this
case, one can easily extend our strategy to exploit variation over time in the observed trade cost shifter to
obtain bilateral-specific estimates of the elasticity functions.



                                                      23
                                                                                                 f
    In terms of the structural unobserved shifters introduced above, vij   (vij               - ij ) and
                                                                         
vij  -  ~ ij . Thus, Assumption 3 implies that E [vij |zij , Dij ] = E [vij |zij , Dij ] = 0. Combined
                                                                                          
with (31), these moment conditions can be used to estimate the parameters g,k                and g,k .21

Pass-through from observed shifter to fixed entry cost. To estimate the scale
parameter  , we exploit the restriction imposed by the specification of entry costs in terms
of labor in the origin country. Under this assumption, we show in Appendix A.7 that

                                                f    
                                               vj =  j - j .                                                (32)
        f       f
Here, vj    j     is the destination fixed-effect in the first-stage specification for the entry
                                                         f
cost in (28) and, because (28) contains a constant, E [vj  ] = 0. We use this moment condition
to estimate  .

                                                                                    f
Estimator.         Expressions (30)­(32) can be used to compute (vij , vij , vij , vj ) conditional on
                                                                       G,K
our main parameters of interest,    ,  , g,k , g,k                     g,k=1
                                                                               , as well as the set of origin
                            N                                                                  N
fixed-effects,   {i  , i , i }i=1 and destination fixed-effects,   i , j , j j =1
                                                                                  . We use the
recovered structural residuals to construct the following GMM estimator for (,  ,  ):

                                                                                                        
                                                                                              
                                                                               ij vij zij , vij Dij
                                                                                                        
                      ^ h (,  ,  ) ,                                         ij vij F (zij ), vij Dij
                                                                                                        
       min h (,  ,  )                      where h (,  ,  )                                     
                                                                                                        ,   (33)
                                                                             ij vij F (zij ), vij Dij
   (,, )                                                     
                                                             
                                                                                                        
                                                                                                        
                                                                                            f
                                                                                        j vj


and ^ is the two-step optimal matrix of moment weights and F (zij ) is the following function,

                                                                    G,K,3
                                F (zij )  I(ij g) I(nUk ) (zij )d   g =1,k=1,d=1
                                                                                   .

    There are two ways of perceiving our estimation procedure to recover g (n) and g (n).
First, imposing that g (n) and g (n) are given by the flexible functional form in Assumption
4 implies that identification, consistency, and inference follow from usual results for GMM.
As such, identification requires the typical GMM rank condition. Our functional form choice
fits in the general class of sieve functions, which can be represented as h(x) = D d=1 d fd (x)
where {fd (x)}d is a set of known functional basis. We choose a series of cubic polynomials
  21
    Conditional on observing  , the assumption that E [ij  u
                                                              |zij , Dij ] = 0 is not necessary for the estimation
of g (n) and g (n) using (31). Accordingly, as in Adao et al. (2017), it is possible to estimate g (n) and g (n)
with the alternative assumption of perfect pass-through from zij to       ¯ij (i.e.,   1).


                                                       24
over intervals, as in Ryan (2012), but restrict the bottom and upper intervals to have a linear
slope to improve on the precision of our estimates at extreme values of the support.
    Alternatively, the functional form in Assumption 4 can be seen as a functional basis for
the nonparametric estimation of g (n) and g (n). Under this interpretation, our estimator is
the sieve nonparametric instrumental variable (NPIV) estimator in Chen and Qiu (2016),
Chen and Christensen (2018), and Compiani (2019). In this case, identification requires the
assumption of completeness in Newey and Powell (2003) or, in the case of our model with a
linear component, the weaker version of this assumption in Florens et al. (2012).22 Chen and
Christensen (2018) derive converge rates and confidence intervals for this type of sieve NPIV
estimator. In Appendix B.4, we implement their procedure to compute confidence bands
accounting for the fact that the function basis approximates g (n) and g (n).

4.3.1    The Constant Elasticity Benchmark

To gain intuition for the estimation strategy, we return to the constant elasticity benchmark
where ij (n) = (n) and ij (n) = (n) are log-linear (as in (20)). In this case, the equations
in (31) yield two constant-elasticity gravity equations, one for the exporter firm share nij ,
and another for the average firm exports x ¯ij :

                                    ln nij =  zij + ~ + ~ + ~ij
                                                      i  j
                                                                                                         (34)
                                    ln x            ~   ~
                                       ¯ij =  zij + i + j +  
                                                            ~ij ,

where
                              ( )-1           and    -( - 1) +  .                                        (35)

    These expressions illustrate how our estimation strategy identifies the parameters control-
ling the functions ij (n) = (n) and ij (n) = (n). The parameter  of (n) is proportional
to  : the constant gravity elasticity of the bilateral exporter firm share to the bilat-
eral cost shifter (conditional on origin and destination fixed-effects). Given the fact that
            f       
~ij    (ij
               + ~ ij ), the consistent estimation of  requires the orthogonality between the
                                                                           f    
observed shifter zij and the unobserved shifters of bilateral trade costs (ij , ij ) in (28). This
is the same type of assumption necessary for the causal interpretation of the estimates of
any gravity equation. Notice that, in order to independently recover  from the definition of
 in (35), we need the pass-through of the cost shifter to the fixed entry cost  , which we
estimate using the relationship described above between the destination fixed-effects in the
  22
    The completeness assumption is not testable (Canay et al., 2013), but it is generically satisfied (Andrews,
2011; Chen and Christensen, 2018). By imposing that g (n) and g (n) are bounded, identification can be
achieved by the weaker condition of bounded completeness (Blundell et al., 2007).



                                                     25
two gravity equations.23
    In addition, the parameter in (n) regulates   : the constant gravity elasticity of
the bilateral average firm exports to the bilateral cost shifter (conditional on origin and
                                               
destination fixed-effects). Again, because    ~ij is a linear combination of the unobserved shifters
of variable and fixed trade costs in (28), the consistent estimation of   requires the observed
                                     f   
shifter zij to be orthogonal to (ij    , ij ). Finally, to separately recover from   in (35),
we need the pass-through of zij to the variable entry cost  , which we estimate from the
log-linear specification in (30) with an observable component of variable trade costs, ij .
    Our GMM estimator in (33) is an extension of the estimator for this log-linear specification.
The only difference is that, instead of imposing a unique interval with a log-linear function, we
specify that the elasticities are determined by cubic splines that may differ over K intervals:
                             G,K
the parameters g,k     , g,k g,k=1 governing the functions ij (n) = g (n) and ij (n) = g (n) in
Assumption 4. Thus, the parameters controlling g (n) and g (n) are identified from the fact
that the extensive and intensive margin elasticities may differ across country pairs (in the
same group) that have different levels of the exporter firm share.


5      Empirical Estimation
We use the strategy above to estimate ij (n) and ij (n) using the semiparametric gravity
equations for the extensive and intensive margins of firm exports. Our results show how
the two elasticity functions of firm exports vary with the exporter firm share. In the next
section, we use our estimates to evaluate how much firm heterogeneity matters for computing
counterfactual changes in aggregate outcomes following trade shocks.


5.1     Data
Our baseline data source for bilateral trade flows is the 2016 release of the World Input-Output
Database (WIOD). It contains domestic sales, Xii , as well as bilateral trade flows, Xij , for 43
countries. The first columns in Table OA.1 in Appendix B.1 presents the list of countries
with trade flows in the WIOD. Our sample of countries accounts for 90% of world trade and
entails positive bilateral flows for almost all exporter-importer pairs.24
   The estimator in equation (33) requires four bilateral variables: (i) the exporter firm
share, nij ; (ii) the average firm revenue, x ¯ij ; (iii) the trade cost shifter, zij ; and (iv) the
  23                                                   f   ~ -   ~ +     ~ with E [v f ] = 0.
    In this case, this relationship can be written as vj =  j     j       j         j
 24
    This attenuates concerns related to the estimation of gravity equations with zero trade flows, as in
Helpman et al. (2008) and Silva and Tenreyro (2006).



                                                  26
observed component of trade costs, ij . We now describe how we construct these variables
for a subset of the countries in the WIOD in 2012.
    We use various sources to construct nij and x   ¯ij for a subset of 37 origin countries in the
WIOD ­ for the full list of countries, see columns (2) and (3) of Table OA.1 in Appendix
B.1. We construct the data in two steps. We first use the OECD Trade by Enterprise
Characteristics (TEC) database to obtain the number of manufacturing firms from i selling
in j , Nij for i = j . For origin-destination pairs not in the OECD TEC database, we obtain
Nij from the World Bank Exporter Dynamics Database (EDD). These datasets also contain
the total exports of the same set of firms from i exporting to j . We use this information to
compute the average revenue of firms from i selling to j , x   ¯ij .25
    The second step is the construction of the number of entrants Ni , which is not readily
available in national statistics. Together with the number of exporters Nij , we use Ni to
construct the exporter firm shares, nij = Nij /Ni .26 We compute the number of entrants as
Ni = Nii /nii where, in country i, Nii is the number of active manufacturing firms and nii
is the survival probability of new manufacturing firms. Our approach assumes that a low
survival rate represents a large pool of entrants that pay the sunk entry cost but fail to be
productive enough to survive. A high survival rate reflects instead that most firms paying the
entry cost are successful in production. To maximize country coverage, we obtain Nii from
several datasets: the OECD Demographic Business Statistics (SDBS), the OECD Structural
Statistics for Industry and Services (SSIS), and the World Bank Enterprise Surveys. In
addition, we obtain nii from the one-year survival rate of manufacturing firms in the OECD
SDBS.27
    Our measure of the bilateral trade cost shifter, zij , is the log of bilateral distance
(population-weighted) in the Centre d'Etudes Prospectives et d'Informations Internationales
(CEPII). This dataset includes not only distance between countries, but also distances within
a country zii due to the nature of population weighting. We use this information to include
observations associated with domestic trade in our baseline sample.
    Finally, we use the bilateral freight cost to measure the observed component of variable
trade costs ij . This is only necessary for the estimation of  using the linear specification
in (30). We consider a subset of countries for which we observe CIF/FOB import margins in
  25
     For Australia and China, we directly construct Nij and x   ¯ij from national statistic agencies.
  26
     Prior research circumvents this data requirement by assuming that Ni = Nii and nii = 1 ­ e.g., see
Fernandes et al. (2019). However, this limits the potential sources of gains from trade in our model by
shutting down welfare gains implied by changes in domestic firm composition ­ see Section 3.3.
  27
     This data is only available for 80% of the origin countries in our sample. We impute the survival rate for
the remaining countries using the simple average of the survival rate for countries with available data. We
show that our results are robust to excluding from the sample countries without survival rate data. We also
show that our results are similar when we use two-year or three-year survival rates.



                                                      27
                            Figure 2: Empirical distribution of ln nij , 2012

                                     .3




                                     .2




                           Density

                                     .1




                                     0
                                          0.01%   0.1%                1%              10%   100%
                                                         Log of Exporter Firm Share


Note. Empirical distribution of ln(nij ) in the cross-section of origin-destination pairs in 2012. For the list of
countries, see Table OA.1 in Appendix B.1.


the OECD freight cost database. For each country pair, we compute ij as the ratio of the
total CIF and FOB imports for manufacturing products. Columns (4) and (5) of Table OA.1
in Appendix B.1 report the list of countries with available data on bilateral freight costs.
    The availability of data on x  ¯ij , nij , and zij determines our sample for the estimation
of the last three moment conditions in (33). Table OA.1 in Appendix B.1 reports the list
of countries in our baseline sample. Figure 2 summarizes the distribution of ln(nij ) for all
bilateral pairs in 2012.28 The empirical distribution of nij is central for our analysis: because
nij is the only input of the elasticity functions g (n) and g (n), we are only able to precisely
estimate these functions in the part of the support in which we observe values of nij .


5.2      Pass-Through of Distance to Freight Costs
We start by estimating the pass-through parameter  from the linear specification in (30).
We consider the pooled sample of exporter-importer-year triples in 2008-2014. Table 1 reports
our pass-though estimates along with standard errors clustered at the destination-origin
level. We estimate an elasticity of trade costs to distance of roughly 0.35. We obtain similar
pass-through estimates in the presence of different sets of fixed-effects. This is reassuring
given that the fixed-effects absorb a great deal of variation in freight costs in our sample ­
the R2 increases from 0.48 in columns (1) to 0.81 in column (3).
  28
    We obtain a similar country coverage for (¯
                                              xij , nij , zij ) in every year between 2010 and 2014. In addition,
2012 is the year with the most observations of the freight cost ij used in estimation. In the appendix, we
show that our results are similar when we use data for 2010 and 2014.




                                                                28
                                      Table 1: Estimation of 

                                                         Dep. Var.: Log of Freight Cost
                                                           (1)       (2)         (3)
              Log of Distance                            0.349*** 0.360***        0.369***
                                                          (0.057)  (0.083)         (0.097)
              R2                                           0.483    0.726           0.813
              Fixed-Effects:
                 Year                                      Yes          Yes          No
                 Origin, Destination                       No           Yes          No
                 Origin-Year, Destination-Year             No           No           Yes
Note. Sample of 547 origin-destination-year triples described in Table OA.1 of Appendix B.1. Standard errors
clustered by origin-destination pair. *** p < 0.01


5.3     Results: Constant Elasticity Gravity
As a benchmark, Table 2 presents the estimates of  and obtained with the GMM estimator
in (33) under the constant elasticity assumption in (20). Using (11), our estimate of 
indicates that a 1% increase in bilateral trade costs triggers a change of ( - 1)/ = -3.5% in
the exporter firm share (conditional on origin and destination fixed-effects). This is consistent
with a skewed distribution of firm entry potentials such that the exporter firm share falls
sharply with the increase in cost caused by higher bilateral distance. Our estimate of 
indicates that a 1% increase in the exporter firm share is associated with a 0.21% decline in
the mean revenue potential of exporters, implying that marginal exporters are worse than
infra-marginal exporters. The combination of the definition in (17) and our estimates of 
and implies a trade elasticity of 5, which is within the range of estimates in the literature ­
see Costinot and Rodriguez-Clare (2013).
    As shown in Section 4.3.1, our structural estimates are closely related to the gravity
elasticity of the extensive and intensive margin of firm exports to distance, which we report
in Table OA.2 of Appendix B.3.1. Columns (1) and (2) indicate that 1% higher distance
is associated with declines of  = 1.2% in exporter firm shares and   = 0.8% in average
firm exports. The extensive margin gravity coefficient is  = 1/ , which yields  = 1.1
because the ratio of the average destination fixed-effects is   0.75. The intensive margin
gravity coefficient is     - ( - 1) , which yields  = -0.21 because we set  = 3.9
and estimate  = 0.36 in Table 1. Thus, due to the non-zero intensive margin elasticity, we
reject the restriction of =  imposed in the Melitz-Pareto model of Chaney (2008).




                                                    29
          Table 2: Constant Elasticity Gravity of Firm Exports with                                                          ij (n)    = n and ij (n) = n

                                                                                                                             
                                                   -1.16   -0.23   4.82     0.75    0.36
                                                  (0.030) (0.029) (0.180) (0.038) (0.083)

Note. Estimates obtained with GMM estimator in (33) in the 2012 sample of 1,522 origin-destination pairs
described in Table OA.1 of Appendix B.1. Calibration of     ~ =  - 1 = 2.9 from Hottman, Redding and
Weinstein (2016). Standard errors in parenthesis and 95% confidence intervals in brackets. For ,  and  ,
we report robust standard errors implied estimation of (33). For , we report standard error obtained from
1,000 bootstrapped draws. For  , we report standard errors clustered by origin-destination, as in Table 1.



5.4              Results: Semiparametric Gravity
We now turn to our semiparametric estimates of (n) and (n) for a single group pooling
all countries. Figure 3 presents estimates of the elasticities of (n) and (n) with respect
to the exporter firm share. We use green bars to denote the estimation knots, and overlay
our baseline estimates with the estimates of the constant elasticity specification presented in
Table 2. We report the elasticity of (n) in Panel (a), the elasticity of (n) in Panel (b), and
the implied trade elasticity (n) in Panel (c) (obtained from (17)).

      Figure 3: Semiparametric Gravity of Firm Exports with                                                              ij (n)    = (n) and ij (n) = (n)
                 (a) Elasticity of (n)                                        (b) Elasticity of  (n)                                      (c) Implied  (n)
            0                                                          0.1                                                        12


                                                                         0                                                        10
          -0.5                                                                                                                                                 Constant Elasticity
                                                              ln (n)
 ln (n)




                                                                       -0.1
                                                                                                                                  8                            Semiparametric
                                                                       -0.2
                                                              (n ) /
 (n ) /




           -1
                                                                                                                             ij




                                                                                                                                  6
                                                                       -0.3
 ln




                                                              ln




                                                                                                                                  4
                                                                       -0.4
          -1.5

                                                                       -0.5                                                       2
                 Constant Elasticity                                                               Constant Elasticity
                 Semiparametric                                                                    Semiparametric
           -2                                                          -0.6                                                       0
                    0.1%      0.5%1%     5% 10%     50%100%                      0.1%   0.5%1%      5% 10%       50%100%               0.1%    0.5% 1%        5% 10%         50% 100%
                        Log Exporter Firm Share                                    Log Exporter Firm Share                                    Log Exporter Firm Share


Note. Estimates obtained with GMM estimator in (33) in the 2012 sample of 1,522 origin-destination pairs
described in Table OA.1 of Appendix B.1. Estimates obtained with a cubic spline over three intervals (K = 3)
for a single group (G = 1). Calibration of ~ =  - 1 = 2.9 from Hottman, Redding and Weinstein (2016).
Thick lines are the point estimates and thin lines are the 95% confidence intervals computed with robust
standard errors for (n) and (n) and 1,000 bootstrap draws for (n).


   Our estimates show that the extensive margin elasticity varies with the share of firms
                                 ln nij
exporting to a market. Since  ln    ¯ij
                                        is inversely proportional to (n) (see equation (12)),
Panel (a) shows that the extensive margin becomes less responsive as more firms serve a
market. For low levels of entry, the expression in (12) implies that a 1 log-point increase in
trade costs reduces the share of exporting firms by 5.8 log-points. This elasticity is lower for

                                                                                        30
higher levels of firm entry. In the top knot, a 1 log-point increase in trade costs reduces the
exporter firm share by 2.1 log-point. This implies that, at first, exporters are very sensitive
to changes in trade frictions. However, high levels of entry potential are rare in the economy:
when many firms export, small changes in trade frictions lead to smaller responses in the
share of firms that decide to export.
    Panel (b) indicates that selection patterns do not change substantially with the exporter
firm share. For all levels of nij , the entry of 1% more exporters into a market induces a
reduction in the mean revenue potential of around 0.2%. Thus, for different levels of entry
potential, marginal exporters are worse than incumbent exporters in terms of average sales
by a similar amount.
    Panel (c) shows what the elasticities of the two margins of firm exports imply for the
response of bilateral trade flows to changes in bilateral trade costs. Due to the declining
extensive margin, the trade elasticity is lower when the exporter firm share is high, falling
from 7 in pairs with nij in the lower knot to 4 in pairs with nij in the top knot.29 Thus, in
line with the product-level evidence in Kehoe and Ruhl (2013) and Kehoe et al. (2015), the
trade elasticity tends to be lower when trade volumes are high.
    As discussed in Section 4.3.1, our estimation strategy extends the constant elasticity
gravity specification widely used in the literature. As such, we obtain variation in the
estimated coefficients around the values obtained when we restrict the elasticities to be
constant for all values of nij . The patterns shown in Figure 3 arise because the impact of
distance on firm level exports varies across different parts of the support of nij . In Table
OA.3 of Appendix OA.2, we show that the extensive margin elasticity is less sensitive to
distance among country pairs with high nij , while the intensive margin elasticity varies little
with nij . The decreasing the extensive margin elasticity then implies that bilateral trade
flows become less sensitive to distance among countries with high values of nij .
    In Figure OA.10 of Appendix B.5.1, we compare our estimated trade elasticity function to
that implied by parametric assumptions and their associated estimates about the distribution
of firm fundamentals in the existing literature. The log-normal assumption in Bas et al.
(2017) and Head et al. (2014) implies a much steeper trade elasticity function. The trade
elasticity for high levels of nij is below two, while it is above twelve for low levels of nij . The
truncated Pareto assumption in Melitz and Redding (2015) yields a trade elasticity function
that is uniformly low. It is always below four and falls below two for high levels of nij . In
both cases, the sharp decline in the trade elasticity is driven by strong reductions in (nij )
  29
    It is possible that existing trade elasticity estimates are average treatment effects obtained from variation
in particular parts of the support of exporter firm shares. Our approach then just captures how the trade
elasticity varies across the support of values of nij .



                                                       31
and (nij ) when nij increases.
    These comparisons highlight the difference between our approach based on semiparametric
gravity equations and approaches based on parametrizations of cross-section variation in
firm-level outcomes. While we directly estimate the elasticity functions driving the model's
aggregate predictions, the parametric micro approach extrapolates from heterogeneity in firm-
level outcomes to obtain these elasticity functions. Our results indicate that this extrapolation
may lead to elasticity functions that are substantially different from those implied by estimates
of the semiparametric gravity equations of firm exports. In the next section, we investigate
the quantitative implications of such differences for the model's counterfactual predictions.

Robustness of baseline estimates. In Appendix B.4, we investigate the robustness of
the baseline estimates in Figure 3. We show that confidence intervals are similar when we
implement the inference method in Chen and Christensen (2018) that accounts for the fact
that the function basis in Assumption 4 approximates the nonparametric functions (n) and
(n). We show that estimates are similar when (i) we use data for alternative years with
similar country coverage, (ii) we exclude observations associated with domestic sales, (iii)
we measure nii using two-year or three-year survival rates, (iv) we exclude from the sample
origin countries with imputed survival rates, (v) we assume that all entrants sell in the
                                   ¯
domestic market (i.e., nii = 1 and f ii = 0), and (vi) we use a higher elasticity of substitution

given by  = 5.

Additional estimates for multiple country groups. Our baseline estimates impose
identical elasticity functions across all exporter-destination pairs (G = 1). In the Online
Supplementary Material B, we allow the elasticity functions to vary across country groups.
Specifically, we investigate whether the trade elasticity functions vary with the country's
per capita income, as in Adao et al. (2017). For developed origin countries, all elasticity
functions are similar to those reported in Figure 3. However, for developing origins, the
extensive margin elasticity almost does not vary with nij , leading to a trade elasticity that is
roughly constant around six. We further show that the elasticity estimates do not vary with
the destination's development level. Finally, we also find that the elasticity functions do not
differ across country pairs that belong to free trade areas, and share a common language or
currency.




                                               32
6      Quantifying The Importance of Firm Heterogeneity
       for The Impact of Trade Shocks on Welfare
We conclude by applying our methodology to study the welfare consequences of two types of
trade shocks. In Section 6.1, we use the results in Sections 3.1 and 3.3 to quantify the impact
of reducing trade costs from infinity to the levels observed in the current trade equilibrium
­ i.e., the so-called gains from trade. In Section 6.2, we use the results in Section 3.2 to
identify the changes in economic fundamentals in the world economy between 2003 and
2012. We then use the inverted shocks to quantify the welfare consequences of good market
integration among countries in the European single market. In both cases, we measure the
importance of firm heterogeneity for the shock's impact by comparing results implied by our
semiparametric estimates of the gravity equations of firm exports and those implied by the
benchmark constant elasticity gravity model of bilateral trade flows.


6.1     Welfare Impact of Moving to Autarky
To investigate how firm heterogeneity affects the gains from trade, we consider results under
two scenarios. First, the benchmark constant elasticity specification in Table 2, where the
gains are given by the aggregate sufficient statistics in Arkolakis et al. (2012), and firm
heterogeneity does not play any role for the gains from trade. Second, the semiparametric
gravity estimates in Figure 3, where the gains are given by the nonparametric sufficient
statistics in Section 3.3, and depend on the export decisions of firms.30
    Figure 4a compares the gains under the two scenarios implied by a move from the
counterfactual autarky equilibrium to the trade equilibrium of 2012. They yield highly
correlated gains from trade ­ the cross-country correlation is 0.99. As pointed out in Section
3.3, this is a consequence of the fact that the domestic trade share remains an important
driver of the gains from trade in our general specification. Notice that firm heterogeneity
may still have a substantial impact on the gains from trade of some countries. It yields gains
from trade that are roughly 10% higher for Luxembourg, China, Denmark, Belgium and
Netherlands. However, the gains are more than 10% lower for Brazil, Mexico, Turkey, India
and Australia. Overall, when we account for firm heterogeneity, the absolute average change
in the gains from trade is 6%.
    In Figure 4b, we investigate how firm heterogeneity affects the ratio between the gains
  30
    We solve n         ^i using the system in Appendix A.6. We have data on nij for 81% of country pairs in
              ^ ii and N
our baseline sample, accounting for 88% world trade flows in 2012. To compute gains from trade, we impute
the exporter firm share for the subset of pairs with missing data using estimates of the constant elasticity
gravity equations reported in column of (1) of Table OA.2.


                                                    33
                                                           Figure 4: Importance of Firm Heterogeneity for the Gains from Trade
                                                             (a) Gains from Trade                                                             (b) Gains from Trade and Exporter Firm Share
 Gains From Trade: Semiparametric (%)


                                                                                                                                                                    1.15




                                                                                                                               Semiparametric/Constant Elasticity
                                        18

                                                                                                                                                                     1.1                                                                      CHN          LUX
                                                                                                                                                                                                                                 DNK
                                                                                                                                                                                                                           BEL NLD
                                        16                                                                          LUX                                                                                                AUT
                                                                                                                                                                                                                      SWENOR
                                                                                                                                                                                             CAN       EST
                                                                                                                                                                    1.05                              SVN
                                                                                                                                                                                                 LVACZE
                                                                                                                                                                                                USA      FIN     DEUITA
                                                                                                                                                                                                                      SVK
                                                                                                                                                                                                     IRL
                                                                                                                                                                                                    FRA
                                                                                                                                                                                                    CHE
                                                                                                                                                                                              LTU GBR
                                                                                                                                                                                            PRT
                                        14




                                                                                                                                     Gains From Trade:
                                                                                                              MLT
                                                                                                                                                                      1               TWNMLT ESP
                                                                                                                                                                                        HRV
                                                                                                                                                                                  GRC JPN
                                                                                                                                                                                       BGR
                                        12                                                                                                                                             KORPOL

                                                                                                    IRL                                                             0.95               HUN RUS
                                                                                                                                                                                     IND
                                                                                                                                                                                     ROU
                                        10                                                                                                                                           IDN
                                                                                                                                                                                     AUS
                                                                                                                                                                               MEX TUR
                                                                                                                                                                     0.9
                                                                                          LTUHUN                                                                                  CYP
                                         8                                             EST
                                                                                   BEL
                                                                                    SVK                                                                             0.85
                                                                                 SVN
                                                                                CZE
                                         6                                    NLD
                                                                           AUT
                                                                             BGR
                                                                           LVA                                                                                       0.8
                                                                         DNK
                                                                       SWE
                                         4                            POL CYP
                                                                     FIN
                                                                      TWN
                                                                      HRV
                                                                    CHE
                                                                    DEU
                                                                 PRT                                                                                                0.75       BRA
                                                                NOR
                                                                  ROU
                                                                CAN
                                                                GRC
                                                                 MEX
                                                               GBR
                                                              FRA
                                                              KOR
                                         2                ITA
                                                            TUR
                                                           ESP
                                                         RUS                                                                                                         0.7
                                                      IDN
                                                     USA
                                                      AUS
                                                    IND
                                                   JPN
                                                  CHN
                                                                                                   45-degree line
                                                   BRA
                                         0                                                                                                                          0.65
                                             0                         5                       10                    15                                                    0         0.01    0.02    0.03      0.04   0.05   0.06      0.07         0.08     0.09

                                                 Gains From Trade: Constant Elasticity (%)                                                                                                  Average Exporter Firm Share

Note. Gains from trade is the percentage change in the real wage implied by moving from autarky to the
observed equilibrium in 2012. Gains from trade for semiparametric specification computed with the formula
in Section 3.3 for n        ^i solving the system in Appendix A.6 and the baseline semiparametric estimates
                   ^ ii and N
in Figure 3. Gains from trade for constant elasticity specification computed with the formula in Section 3.3
with N^i = 1 and ii (n) =  reported in Table 2.


from trade implied by the semiparametric and the constant elasticity specifications. For
each country, we compute this ratio and plot it against the average exporter firm share (i.e.,
average nij across j = i). The use of this statistic is motivated by our welfare gains derivation,
equation (23), and a large tradition in international trade that stresses the link between
firm heterogeneity and exporter success (see e.g. Bernard and Jensen (1999); Bernard et al.
(2007); Melitz and Redding (2014)). The plot shows that firm heterogeneity amplifies the
gains from trade in countries with a higher share of exporting firms. Economies of scale drive
this relationship. When the fraction of firms exporting is high, more resources are allocated
to covering the fixed cost of entering foreign markets. This strengthens competition in the
domestic labor market and, therefore, amplifies the decline in domestic survival rate. This in
turn creates higher welfare gains, as discussed in Section 3.3.

The Importance of Parametric Assumptions. In Appendix B.5.1, we investigate the
quantitative importance of using our semiparametric approach to recover the two elasticity
functions that are sufficient for counterfactual analysis. We compare our baseline estimates of
the gains from trade to those implied by parametric assumptions about the firm productivity
distribution and their associated estimates in the literature ­ specifically, the Truncated
Pareto distribution in Melitz and Redding (2015) and the Log-normal distribution in Bas
et al. (2017). Both parametric assumptions have quantitatively large impacts on the gains


                                                                                                                          34
from trade. They yield gains from trade that are too large because they imply a low trade
elasticity for all levels of the exporter firm share ­ see Figure OA.10 of Appendix B.5.1. These
results indicate that one should be cautious when extrapolating elasticity functions from
cross-sectional dispersion in firm-level outcomes.


6.2     The Welfare Impact of Observed Changes in Trade Costs
Our second exercise investigates the welfare consequences of actual changes in trade costs that
recently hit the world economy. We use Proposition 3 to recover the changes in fixed costs
of exporting f ^
               ¯                        ^
                                        ¯ij between 2003 and 2012.31 We focus on measuring
                ij and revenue shifters r

the welfare consequences of changes in trade costs between countries in the European single
market, including the admission of 12 new members that took place in this period. Specifically,
we ask ``For any country j , how much higher (or lower) would welfare have been in 2012 if
fixed costs of exporting and revenue shifters between members of the European single market
were those of 2003 rather than those of 2012?''.32
    We first invert the changes in economic fundamentals between the EU-28, Norway, and
Switzerland. In our model, they can be recovered from changes in bilateral trade outcomes,
wages and prices. In fact, up to a first order approximation, (21)­(22) imply that

                          ^
                          ¯t  log x  ^
                                     ¯t          0          0
                                                                   ^t          t
                      log f ij          ij + ((nij ) - (nij )) log nij - log w^i
                                                                                                         (36)
                          ^
                      log r t
                          ¯ij       ^
                                    ¯t
                                log x          0
                                                      ^t
                                      ij - (nij ) log n ij + ( - 1) log w^it
                                                                             + j t


         t
where j    is a destination-specific component. Given our baseline estimates, these expressions
clearly illustrate what features in the data are associated with changes in economic fundamen-
tals through the lens of our model. The fixed cost of exporting must have increased whenever
we observe firm-level exports increasing (x  ^
                                             ¯tij increasing), but firms are not entering foreign
markets (^  nt
             ij decreasing) or production costs are not increasing (w
                                                                      t
                                                                     ^i decreasing). Similarly, we
recover an increase in the bilateral revenue shifter whenever we observe increases in either firm
  31
      We construct changes in trade outcomes using the same data described in Section 5.1. The inversion of
economic fundamentals also requires changes in wages and prices (relative to the economy's numeraire). We
construct these variables using data from the Penn Tables while normalizing variables so that the U.S. wage
is the numeraire. Since our model entails a single factor, our wage measure is the output-side real GDP at
current PPPs divided by the number of engaged persons. Our price index measure is the corresponding GDP
price deflator PPP-adjusted to U.S. prices of 2011. We normalize both variables by the U.S. per-worker GDP
in each year.
   32
      Our exercise differs from that in Caliendo et al. (2017) for two main reasons. First, we focus on the
consequences of firm heterogeneity and ignore changes in labor mobility frictions across countries. Second, we
consider all changes in economic fundamentals instead of changes in tariffs associated with the EU enlargement,
so our exercise accounts for changes in (variable and fixed) trade costs and productivity experienced by both
old and new members.



                                                     35
average exports (higher x     ^
                              ¯t
                               ij ) or wages (higher w
                                                     ^it
                                                         ) given the change in firm composition (lower
 (n0         ^t
    ij ) log n  ij ). Note that such changes in revenue shifters are proportional to productivity
and inversely proportional to variable trade costs.
    Table 3 displays the results of regressing inverted changes in bilateral fundamentals on the
changes in firm average exports, firm entry share, and origin's labor cost. Not surprisingly,
all coefficient estimates are close to the values in the first-order approximation above. These
variables explain most of the variation in fundamentals across country pairs: 93% for f         ^
                                                                                                ¯t and
                                                                                                 ij
72% for r   ^t                                                                     2
            ¯ij . More interesting, we use a Shapley decomposition of the R to uncover which
variables drive most of the cross-country variation in changes in fundamentals. For fixed
exporting costs, the main driver is the growth in firm average exports, with a smaller relevant
contribution of firm entry shares. In contrast, growth in firm average exports and labor costs
have equal contributions for the variation in the growth of bilateral revenue shifters.
                     Table 3: Determinants of Changes in Bilateral Shifters

                                 Dep. Var.         log f^
                                                        ¯             ^
                                                                  log r
                                                                      ¯ij
                                                         ij
                                                     (1)            (2)
                                     ^
                                 log x
                                     ¯ij        0.976***        0.723***
                                                  (0.015)        (0.027)
                                                  [79.1%]        [49.6%]
                                 log n
                                     ^ ij       -0.498***        -0.092*
                                                  (0.052)        (0.046)
                                                  [19.3%]         [2.1%]
                                 log w
                                     ^i         -0.853***       3.499***
                                                  (0.005)        (0.123)
                                                   [1.7%]        [48.3%]
                                 Constant        -0.039**       0.753***
                                                  (0.013)        (0.037)
                                 R2                 0.934          0.719
Note. Sample of changes in bilateral shifters between 870 country pairs in the European single market (where
origin and destination are different). We report the robust standard errors in parenthesis, and the Shapley
contribution to the R2 of each regressor in brackets. * p < 0.1 ** p < 0.05 *** p < 0.01

    Figure 5 displays each origin's average inverted shock for the 30 countries of our sample
in the European single market. Panel (a) shows that, through the lens of our model, firms
in most countries had to hire more labor to cover the fixed cost necessary to enter foreign
markets. This follows from the fact that, in almost every country, the increase in bilateral
average firm exports was much stronger than average growth in firm export shares and wages
­ see Figure OA.12 in Appendix B.5.2. Panel (b) reports the average change in bilateral
revenue shifters for each origin country. This panel shows that revenue shifters increased
substantially in most countries mainly because of their strong growth in average firm export

                                                    36
Figure 5: Average Change in Bilateral Shifters of Exporting to Countries in The European
Single Market, 2003-2012
                   ^ for i = j
                   ¯
       (a) Average f                                 ^
                                         (b) Average r
                                                     ¯ij for i = j                      ^
                                                                            (c) Average r    ^
                                                                                        ¯ij /r
                                                                                             ¯ii for i = j
                    ij

                             >2                                 >2                                    >2
                             1.6 - 2                            1.6 - 2                               1.6 - 2
                             1.2 - 1.6                          1.2 - 1.6                             1.2 - 1.6
                             1 - 1.2                            1 - 1.2                               1 - 1.2
                             .85 - 1                            .85 - 1                               .85 - 1
                             .75 - .85                          .75 - .85                             .75 - .85
                             .6 - .75                           .6 - .75                              .6 - .75
                             <.6                                <.6                                   <.6




Note: Changes in economic fundamentals computed with the expressions in Proposition 3 using changes in
outcomes between 2003 and 2012. For each origin country i, we report the simple average of the changes in
bilateral fundamentals across all other destination countries j in the European single market (with i = j ).


and wages ­ see Figure OA.12 in Appendix B.5.2.33 This growth was particularly strong in
Eastern Europe, exceeding 100% in several countries. Notice that, by the definition in (4), r     ^
                                                                                                  ¯ij
incorporates changes in both variable trade costs and productivity. To measure only changes
in trade costs, panel (c) presents the average change in the normalized bilateral revenue
         ^
shifter, r    ¯ii = ^
              ^
         ¯ij /r     ¯
                    bij (¯ij )1- . Our results indicate that countries in Eastern Europe experienced
                         ^
strong average increases in normalized revenue shifters (and thus reductions in trade costs).
In contrast, countries in Western Europe had reductions in their average normalized revenue
shifter, indicating that the export growth was particularly weak compared to the domestic
performance of firms.
    We now turn to the welfare consequences of the changes in bilateral trade shifters between
members of the European single market. The top panels of Figure 6 report the negative of
the percentage change in the real wage of each country implied by a different set of shocks.
A positive (negative) number corresponds to welfare gains (losses). Panel (a) shows that
changes in both f   ^
                    ¯          ^
                     ij and r  ¯ij caused welfare gains in all member countries (except Greece). The
average gain was 1.7% among all countries. The map also shows that, because of stronger
increases in revenue shifters, gains were higher for countries in East Europe that experienced
an average gain of 3.4%. The largest gains occurred in Slovakia (4.1%), Lithuania (4.5%),
Estonia (5.1%), and Hungary (5.2%).
  33
    Notable exceptions are Greece and Italy. For these countries, the revenue shifter reduction follows from
their weak growth in firm average exports and, more importantly, in wages (relative to the U.S.).



                                                    37
    In panel (b), we display the real wage changes only considering the impact of changes
in revenue shifters. Because we find that fixed exporting costs tended to increase in this
period, welfare gains are typically higher when we do not feed shocks in fixed exporting
costs. However, the similarity between panels (a) and (b) indicates that the change in fixed
exporting costs had a quantitatively small impact on real wages throughout this period.
    Finally, panel (c) reports the impact of changes in variable trade costs. The stark difference
between panels (b) and (c) indicates that Western and Eastern Europe had different source
of welfare gains. For countries in West Europe, gains are much lower in panel (c) than in
panel (b) ­ the average gain is 0.5% in panel (b) and -0.1% in panel (c). This implies that
these countries mostly benefited from productivity gains in their trade partners. In fact, as
discussed above, they seem to have experienced average increases in their variable export
costs (reduction in normalized revenue shifters). For countries in East Europe, the gains are
similar in both panels. This indicates that their gains came mostly from gaining access to
the European single market. Interestingly, the only Eastern country to suffer a welfare loss,
Croatia, is also the only in country in our sample to join the EU after 2012.
    Panels (e)­(f) of Figure 6 conclude our analysis by comparing the real wage change
obtained by our baseline model based on the semiparametric estimates in Figure 3 and those
obtained by the constant elasticity benchmark in Table 2. We consider the same set of
changes in economic fundamentals. For the three sets of shocks, our baseline estimates
yield larger gains than those implied by the constant elasticity benchmark: the median
ratio is 1.08 in panel (a), 1.04 in panel (b) and 1.04 in panel (c). This difference combines
two consequences of the non-linearity in the estimates of the elasticity function: different
recovered shocks (f  ^
                     ¯       ^
                      ij and r
                             ¯ij ), as well as different firm-level counterfactual responses. In
particular, it is mainly driven by the fact that the changes in revenue shifters affect many
country pairs for which the firm export share is in the range with a semiparametric trade
elasticity above the benchmark constant trade elasticity.

The Importance of Recovering Asymmetric Trade Costs. Appendix B.5.2 investi-
gates the quantitative importance of using our methodology to recover shocks in bilateral trade
costs. We consider two alternative approaches in the existing literature. First, we measure
trade cost shocks using tariff changes triggered by the EU enlargement, as in Caliendo et al.
(2017). Since tariffs are only a fraction of trade costs, this approach yields shocks that are
much smaller and more homogeneous (especially for pre-2003 EU members). This translates
into much smaller welfare changes, with small gains for all countries. Finally, we consider a
non-parametric extension of the approach in Head and Ries (2001) that imposes symmetry
of trade cost shocks. This yields smaller welfare losses in West Europe and smaller welfare


                                               38
Figure 6: The Welfare Impact of Changing Bilateral Shifters of Exporting to Countries in
The European Single Market, 2003-2012
                   Percentage Change in Real Wage: Semiparametric Gravity
          ^
          ¯
      (a) f       ^                                 ^                                 ¯ij )1- = r
                                                                                      ^         ^    ^
           ij and r
                  ¯ij for i = j                 (b) r
                                                    ¯ij for i = j                (c) (          ¯ij /r
                                                                                                     ¯ii for i = j
                              >4                                    >4                                        >4
                              2-4                                   2-4                                       2-4
                              1-2                                   1-2                                       1-2
                              .75 - 1                               .75 - 1                                   .75 - 1
                              .5 - .75                              .5 - .75                                  .5 - .75
                              .25 - .5                              .25 - .5                                  .25 - .5
                              .1 - .25                              .1 - .25                                  .1 - .25
                              0 - .1                                0 - .1                                    0 - .1
                              <0                                    <0                                        <0
                              No data                               No data                                   No data




Ratio of Percentage Change in Real Wage: Semiparametric and Constant Elasticity Gravity
          ^
          ¯
      (d) f       ^                                      ^                            ¯ij )1- = r
                                                                                      ^         ^    ^
           ij and r
                  ¯ij for i = j            (e) Impact of r
                                                         ¯ij for i = j           (f) (          ¯ij /r
                                                                                                     ¯ii for i = j
                              > 1.25                                > 1.25                                    > 1.25
                              1.1 - 1.25                            1.1 - 1.25                                1.1 - 1.25
                              1.05 - 1.1                            1.05 - 1.1                                1.05 - 1.1
                              1 - 1.05                              1 - 1.05                                  1 - 1.05
                              .95 - 1                               .95 - 1                                   .95 - 1
                              .85 - .95                             .85 - .95                                 .85 - .95
                              .7 - .85                              .7 - .85                                  .7 - .85
                              < .7                                  < .7                                      < .7
                              No data                               No data                                   No data




Note: Real wage changes caused by changes in bilateral trade shifters between 2003 and 2012 among 30
countries in the European single market. Bilateral trade shifters computed with the expressions in Proposition
3 for observed changes in outcomes between 2003 and 2012. Counterfactual exercise: starting from the
equilibrium in 2012, we compute the impact of changing fundamentals back to their level of 2003 (while
holding r^
         ¯ii = f ^
                 ¯ii = 1). Panels (a)­(c) report minus the real wage change obtained with the baseline
semiparametric estimates in Figure 3. Panel (d)­(f) report the ratio of real wage changes obtained with the
baseline semiparametric estimates in Figure 3 and the constant elasticity estimates in Table 2.




                                                      39
gains in East Europe because the symmetry assumption attenuates the increase (decline) in
bilateral trade costs for West (East) Europe shown in Figure 5.


7      Conclusion
We propose a new way of modeling and estimating the aggregate implications of firm
heterogeneity in the workhorse monopolistic competition framework of international trade
that dispenses parametric restrictions on the distribution of firm fundamentals. We use this
approach to revisit a number of open questions about the role of firm heterogeneity for the
economy's response to trade shocks through the lens of a new not -parametric point of view.
    Instead of focusing on parametrically specifying the distribution of various firm-specific
wedges, we show that they can be folded into two elasticity functions in the model's semi-
parametric gravity equations that intuitively shape how trade costs affect firm-level entry
and sales across country pairs. Given the initial equilibrium, the different sources of firm
heterogeneity, and any associated parametric assumption imposed, only matter for coun-
terfactual predictions through the shape of these two gravity elasticity functions of firm
exports. This characterization also allows us to (i) construct nonparametric counterfactual
predictions to trade shocks, (ii) nonparametrically recover changes in economic fundamentals
from observed trade and macroeconomic outcomes, and (iii) obtain nonparametric ex-post
sufficient statistics for the impact of trade shocks on welfare.
    Our results indicate that a key new statistic for aggregate gains from trade is the share of
exporting firms. We evaluate its impact on the trade elasticity and the welfare impact of
trade shocks. We find that firm heterogeneity amplifies both the gains from trade in countries
with more exporter firms, and the welfare gains of European good market integration in
2003-2012.


References
Ad~
  ao, Rodrigo, ``Worker heterogeneity, wage inequality, and international trade: Theory and evidence
 from Brazil,'' Unpublished paper, MIT, 2015.

Adao, Rodrigo, Arnaud Costinot, and Dave Donaldson, ``Nonparametric counterfactual predictions
 in neoclassical models of international trade,'' The American Economic Review, 2017, 107 (3), 633--689.

    , Costas Arkolakis, and Federico Esposito, ``General equilibrium effects in space: Theory and
    measurement,'' Technical Report, Tech. rep., Working Paper 2020.

Allen, Treb and Costas Arkolakis, ``Trade and the Topography of the Spatial Economy,'' The Quarterly
  Journal of Economics, 2014, 129 (3), 1085--1140.


                                                  40
  ,   , and Yuta Takahashi, ``Universal gravity,'' NBER Working Paper, 2014, (w20787).

Andrews, Donald WK, ``Examples of l2-complete and boundedly-complete distributions,'' 2011.

Arkolakis, Costas, ``Market Penetration Costs and the New Consumers Margin in International Trade,''
 Journal of Political Economy, 2010, 118 (6), 1151--1199.

  , Arnaud Costinot, and Andr´   es Rodr´
                                        iguez-Clare, ``New Trade Models, Same Old Gains?,'' NBER
  Working Paper, 2009, (w15628).

  ,   , and Andres Rodr´     iguez-Clare, ``New Trade Models, Same Old Gains?,'' American Economic
  Review, 2012, 102 (1), 94--130.

  ,   , Dave Donaldson, and Andr´   es Rodr´  iguez-Clare, ``The elusive pro-competitive effects of trade,''
  The Review of Economic Studies, 2019, 86 (1), 46--80.

  , Sharat Ganapati, and Marc-Andreas Muendler, ``The Extensive Margin of Exporting Products:
  A Firm-level Analysis,'' 2019.

Baqaee, David and Emmanuel Farhi, ``Networks, barriers, and trade,'' Technical Report, National
  Bureau of Economic Research 2019.

Bartelme, Dominick, Ting Lan, and Andrei Levchenko, ``Specialization, Market Access and Medium-
  Term Growth,'' 2019.

Bas, Maria, Thierry Mayer, and Mathias Thoenig, ``From micro to macro: Demand, supply, and
  heterogeneity in the trade elasticity,'' Journal of International Economics, 2017, 108, 1--19.

Bernard, Andrew B. and J. Bradford Jensen, ``Exceptional Exporter Performance: Cause, Effect, or
  Both,'' Journal of International Economics, 1999, 47, 1--25.

  , Stephen J. Redding, and Peter Schott, ``Multi-Product Firms and Trade Liberalization,'' Quarterly
  Journal of Economics, 2011, 126 (3), 1271--1318.

Bernard, Andrew, Bradford Jensen, Steve Redding, and Peter J. Schott, ``FIrms in International
  Trade,'' Journal of Economic Perspectives, 2007, 21 (3), 105--130.

Berry, Steven T and Philip A Haile, ``Identification in differentiated products markets using market
  level data,'' Econometrica, 2014, 82 (5), 1749--1797.

Blundell, Richard, Xiaohong Chen, and Dennis Kristensen, ``Semi-Nonparametric IV Estimation of
  Shape-Invariant Engel Curves,'' Econometrica, 2007, 75 (6), 1613--1669.

Caliendo, Lorenzo and Fernando Parro, ``Estimates of the Trade and Welfare Effects of NAFTA,'' The
  Review of Economic Studies, 2014.

  , Luca David Opromolla, Fernando Parro, and Alessandro Sforza, ``Goods and factor market
  integration: a quantitative assessment of the eu enlargement,'' Technical Report, National Bureau of
  Economic Research 2017.


                                                    41
Canay, Ivan A, Andres Santos, and Azeem M Shaikh, ``On the testability of identification in some
  nonparametric models with endogeneity,'' Econometrica, 2013, 81 (6), 2535--2559.

Chaney, Thomas, ``Distorted Gravity: The Intensive and Extensive Margins of International Trade,''
 American Economic Review, 2008, 98 (4), 1707--1721.

Chen, Xiaohong and Timothy M Christensen, ``Optimal sup-norm rates and uniform inference on
  nonlinear functionals of nonparametric IV regression,'' Quantitative Economics, 2018, 9 (1), 39--84.

   and Yin Jia Jeff Qiu, ``Methods for nonparametric and semiparametric regressions with endogeneity:
  A gentle guide,'' Annual Review of Economics, 2016, 8, 259--290.

Compiani, Giovanni, ``Market counterfactuals and the specification of multi-product demand: a nonpara-
  metric approach,'' Technical Report, Working paper. 3, 43 2019.

Costinot, Arnaud and Andres Rodriguez-Clare, ``Trade theory with numbers: Quantifying the conse-
  quences of globalization,'' Technical Report, National Bureau of Economic Research 2013.

  , Dave Donaldson, and Ivana Komunjer, ``What Goods Do Countries Trade? A Quantitative
  Exploration of Ricardo's Ideas,'' 2010. Forthcoming, Review of Economic Studies.

Dekle, Robert, Jonathan Eaton, and Samuel Kortum, ``Global Rebalancing with Gravity: Measuring
  the Burden of Adjustment,'' IMF Staff Papers, 2008, 55 (3), 511--540.

Eaton, Jonathan, Samuel Kortum, and Francis Kramarz, ``An Anatomy of International Trade:
  Evidence from French Firms,'' Econometrica, 2011, 79 (5), 1453--1498.

  ,   , Brent Neiman, and John Romalis, ``Trade and the global recession,'' The American Economic
  Review, 2016, 106 (11), 3401--3438.

Fajgelbaum, Pablo D and Amit K Khandelwal, ``Measuring the unequal gains from trade,'' The
  Quarterly Journal of Economics, 2016, 131 (3), 1113--1180.

Feenstra, Robert C, ``Restoring the product variety and pro-competitive gains from trade with heteroge-
  neous firms and bounded productivity,'' Journal of International Economics, 2018, 110, 16--27.

Fernandes, Ana, Peter Klenow, Martha Denisse Periola, Sergii Meleshchuk, and Andres
  Rodriguez-Clare, ``The Intensive Margin in Trade: How Big and How Important?,'' Unpublished
  manuscript, 2019.

Florens, Jean-Pierre, Jan Johannes, and S´       ebastien Van Bellegem, ``Instrumental regression in
  partially linear models,'' The Econometrics Journal, 2012, 15 (2), 304--324.

Head, Keith and John Ries, ``Increasing Returns versus National Product Differentiation as an Explanation
  for the Pattern of U.S.-Canada Trade,'' American Economic Review, 2001, 91 (4), 858--876.

   and Thierry Mayer, ``Chapter 3 - Gravity Equations: Workhorse,Toolkit, and Cookbook,'' in Gita
  Gopinath, Elhanan Helpman, and Kenneth Rogoff, eds., Handbook of International Economics, Vol. 4 of
  Handbook of International Economics, Elsevier, 2014, pp. 131 -- 195.

                                                   42
  ,   , and Mathias Thoenig, ``Welfare and trade without pareto,'' American Economic Review, 2014,
  104 (5), 310--16.

Helpman, Elhanan, Marc Melitz, and Yona Rubinstein, ``Estimating Trade Flows: Trading Partners
  and Trading Volumes,'' Quarterly Journal of Economics, 2008, 2 (5), 441--487.

Hottman, Colin J, Stephen J Redding, and David E Weinstein, ``Quantifying the sources of firm
 heterogeneity,'' The Quarterly Journal of Economics, 2016, 131 (3), 1291--1364.

Jr, Frank E Harrell, Regression modeling strategies: with applications to linear models, logistic and
  ordinal regression, and survival analysis, Springer, 2001.

Kehoe, Timothy J. and Kim J. Ruhl, ``How Important Is the New Goods Margin in International
 Trade?,'' Journal of Political Economy, 2013, 121 (2), 358 -- 392.

Kehoe, Timothy J, Jack Rossbach, and Kim J Ruhl, ``Using the new products margin to predict the
  industry-level impact of trade reform,'' Journal of International Economics, 2015, 96 (2), 289--297.

Kleinman, Benny, Ernest Liu, and Stephen J Redding, ``International friends and enemies,'' Technical
  Report, National Bureau of Economic Research 2020.

Lind, Nelson and Natalia Ramondo, ``Trade with correlation,'' Technical Report, National Bureau of
  Economic Research 2018.

Matsuyama, Kiminori and Philip Ushchev, ``Beyond CES: Three Alternative Cases of Flexible Homo-
 thetic Demand Systems,'' Buffett Institute Global Poverty Research Lab Working Paper, 2017, (17-109).

Melitz, Marc J., ``The Impact of Trade on Intra-Industry Reallocations and Aggregate Industry Productiv-
 ity,'' Econometrica, 2003, 71 (6), 1695--1725.

Melitz, Marc J and Stephen J Redding, ``New trade models, new welfare implications,'' Technical
 Report, National Bureau of Economic Research 2013.

   and    , ``Heterogeneous firms and trade,'' in ``Handbook of international economics,'' Vol. 4, Elsevier,
  2014, pp. 1--54.

   and      , ``New trade models, new welfare implications,'' American Economic Review, 2015, 105 (3),
  1105--46.

Newey, Whitney K and James L Powell, ``Instrumental variable estimation of nonparametric models,''
 Econometrica, 2003, 71 (5), 1565--1578.

Novy, Dennis, ``International trade without CES: Estimating translog gravity,'' Journal of International
 Economics, 2013, 89 (2), 271--282.

Redding, Stephen J., ``Theories of Heterogeneous FIrms and Trade,'' Annual Review of Economics, 2011,
 3, 77--105.




                                                    43
Redding, Stephen J, ``Goods trade, factor mobility and welfare,'' Journal of International Economics,
  2016, 101, 148--167.

Ryan, Stephen P, ``The costs of environmental regulation in a concentrated industry,'' Econometrica,
 2012, 80 (3), 1019--1061.

Silva, J. M. C. Santos and Silvana Tenreyro, ``The Log of Gravity,'' Review of Economics and
   Statistics, 2006, 88 (4), 641--658.




                                                 44
Online Appendix

A         Theory Appendix: Proofs and Additional Results
A.1       Proof of Lemma 1
Part 1. The extensive and intensive margins of firm-level sales, nij and x  ¯ij , satisfy (11) and (14) for all i
and j . Together with Ni , they determine bilateral trade flows, Xij = Ni nij x
                                                                              ¯ij .

Part 2. For all i, total spending, Ei , satisfies (8).

Part 3. To derive the labor market clearing condition notice that there are three sources of demand for
labor: production of goods, fixed-cost of entering a market and fixed-cost of creating a variety. Thus,

   ¯i =                              1                                                           ¯                             ¯
wi L          Ni P r[  ij ] 1 -           E [Rij ( ) |  ij ]+                    Ni P r[  ij ]wi fij E [fij ( ) |  ij ]+ Ni wi Fi
          j
                                                                            j


    From the free entry condition, we know that

      ¯i =                                                              1                         ¯
   wi F           E [max {ij ( ); 0}] =           P r[  ij ]              E [Rij ( ) |  ij ] - wi f ij E [fij ( ) |  ij ] ,
              j                               j
                                                                        

which implies that
                                       ¯i =
                                    wi L              Ni P r[  ij ]E [Rij ( ) |  ij ] .
                                                  j

                ¯ij  E [Rij ( ) |  ij ] and nij = P r[  ij ], this immediately implies
    Thus, since x

                                                          ¯i =
                                                       wi L             Ni nij x
                                                                               ¯ij .                                     (OA.1)
                                                                    j


                                                           ¯i.
    Thus, the only exogenous element in this expression is L
                                ¯ij wi ij ( )
Part 4. Since pij ( ) =       -1 a¯i ai ( ) ,     the expression for Pj1- in (2) implies that

                                                            1-                                              1-
                                    ¯         ¯ij                                                  ij ( )
                     Pj1- =         bij                              1-
                                                                    wi                 (bij ( ))                 d
                                i
                                           -1 a
                                              ¯i                                 ij                ai ( )

    Using the definitions in (4), we can write this expression as

                                          Pj1- =            r    1-
                                                            ¯ij wi                   rij ( ) d
                                                        i                       ij

    Notice that     ij
                         rij ( ) d = Ni P r[  ij ]E [r|  ij ] = Ni nij ij (nij ). This immediately yields

                                           Pj1- =               r    1-
                                                                ¯ij wi  ij (nij )nij Ni .                                (OA.2)
                                                            i


    Thus, the only exogenous elements in this expression are  , r
                                                                ¯ij , and ij (n).




                                                                OA - 1
Part 5. We start by writing

            E [max {ij ( ); 0}]     =       P r[  ij ]E [ij ( ) |  ij ] + P r[        / ij ]0
                                                  1                               ¯
                                    = P r[  ij ]  E [Rij ( ) |  ij ] - wi fij E [fij ( ) |  ij ]
                                    =         nij  1          ¯
                                                     ¯ij - wi f
                                                     x         ij E [rij ( )/eij ( )|  ij ]


                                                                                     ¯
where the second equality follows from the expression for ij ( ) = (1/ )Rij ( ) - wi f ij fij ( ), and the third
                                         ¯ij  E [Rij ( ) |  ij ] and eij ( )  rij ( )/fij ( ).
equality follows from the definitions of x
                         ¯           
                         f     wi        Pj
    By defining eij   r
                        ij
                      ¯ij      Pj        Ej       , we can write

                                                                                        
                                                                            1                 r                             dH e (e)
                       E [rij ( )/eij ( )|  ij ] =                                         rdHij (r|e)
                                                                   eij
                                                                            e       0                                     1 - H e (eij )


    Consider the transformation n = 1 - Hij (e) such that e = ¯ij (n). In this case, dHij (e) = -dn and
nij = 1 - Hij (eij ), which implies that


                                                                                     1          nij       m
                                                                                                          ij (n)
                                  E [rij ( )/eij ( )|  ij ] =                                                    dn,
                                                                                    nij     0             ij (n)


where, to simplify exposition, we define the mean revenue potential of firms in quantile n of the entry potential
distribution as
                                           m ij (n)  E [r |e = ij (n)] .                                 (OA.3)

    Thus,

                                                                  1                                       nij   m
                                                                                                                ij (n)
                             E [max {ij ( ); 0}] =                               ¯
                                                                        ¯ij - wi f
                                                                    nij x          ij                                  dn.
                                                                                                      0         ij (n)

    Thus, the free entry condition is
                                                                                                  nij      m
                                                                                                           ij (n)
                                  ¯i =
                               wi F                        ¯ij -
                                                       nij x                    ¯
                                                                             wi f ij                              dn.                      (OA.4)
                                                  j                    j                      0            ij (n)


    Notice that the summation of (11) and (14) implies that

                                          ¯
                                    ln wi f        ¯ij - ln ij (nij ) + ln
                                           ij = ln x                                                        ij (nij )


which yields
                                                                                  ij (nij )
                                                                                                      nij       m
                                                                                                                ij (n)
                                ¯i =
                             wi F                         ¯ij -
                                                      nij x                x
                                                                           ¯ij                                         dn.
                                              j                    j
                                                                                 ij (nij )        0             ij (n)


    By substituting the definition of ij (n), we can write the free entry condition as

                                                                                    ij (nij )
                                                                                                                    nij   m
                                                                                                                          ij (n)
                           ¯i =
                        wi F                 ¯ij -
                                         nij x                 nij x
                                                                   ¯ij       nij                                                 dn.       (OA.5)
                                     j                     j                 0
                                                                                     m ij (n)     dn            0         ij (n)




                                                                   OA - 2
     Using the market clearing condition in (OA.1), we have that

                                1   ¯i
                                    F                        ¯ij
                                                         nij x            ij (nij )
                                                                                                nij   m
                                                                                                      ij (n)
                                   =¯ +                      ¯i        nij m                                 dn,       (OA.6)
                                Ni  Li              j
                                                         wi L          0
                                                                           ij (n)     dn    0         ij (n)


which immediately yields
                                                                                     m            -1
                                                                                nij ij (n)
                                           ¯i
                                           F                       nij x
                                                                       ¯ij     0     ij (n)
                                                                                              dn
                                     Ni =  ¯ +                         ¯i     nij m
                                                                                                          .            (OA.7)
                                           Li                      wi L              ij (n)
                                                               j              0     ij (nij )
                                                                                               dn

    Notice that, by (16), m  ij (n) is uniquely determined by ij (n). Thus, the only exogenous elements in this
                 ¯   ¯
expression are  Fi , Li , ij (n), and ij (n).

Part 6. The equilibrium vector {nij , x¯ij , Ei , wi , Pi , Ni }i,j is determined by equations (11), (14), (8), (OA.1),
(OA.2), and (OA.7). The system is thus a function of the vector of country fundamentals {T           ¯i , L
                                                                                                          ¯i, F    ¯
                                                                                                              ¯i , f      ¯ij },
                                                                                                                     ij , r
the elasticity of substitution  , and the bilateral functions, { ij (n), ij (n)}i,j .


A.2        Proof of Proposition 1
Part 1. We start by pointing out that equation (16) implies that knowledge of ij (n) implies knowledge of
mij (n) (as defined in (OA.3)). We then use the equilibrium conditions in Proposition 1 to obtain a system of
                                     ¯ij }j , Pi , Ni , Ei , wi } given changes in T
equations for the changes in {{nij , x                                                ¯i , L
                                                                                           ¯i, F
                                                                                               ¯i , {r     ¯
                                                                                                     ¯ij , f ij }j i .
1. The extensive and intensive margins of firm-level sales, nij and x       ¯ij , in (11) and (14) imply
                                                                                      
                                                                     ^
                                                                     ¯                     ^j
                                                 ij (nij n
                                                         ^ ij )      f ij       w
                                                                                ^i         P
                                                                   =                          ,                        (OA.8)
                                                   ij (nij )         ^
                                                                     r
                                                                     ¯ij        ^j
                                                                                P          ^j
                                                                                           E

                                                                                                      
                                                                                       1-
                                                            ^ ij )  w
                                                    ij (nij n       ^i                          ^j  .
                                          ^
                                          x     ^
                                          ¯ij = r
                                                ¯ij                                             E                      (OA.9)
                                                    ij (nij )       ^j
                                                                    P

2. Let i  wi Li /Ei = ( d Xid ) / ( o Xoi ) be the output-spending ratio in country i in the initial equilibrium.
The spending equation in (8) implies

                                                  ^ i = i w
                                                  E          ^
                                                          ^i L             ^
                                                                           ¯i ,
                                                             ¯ i + (1 - i )T                                          (OA.10)

3. Let yij  (Ni nij x
                    ¯ij ) / (wi Li ) = Xij / j Xij                      be the share of i's revenue from sales to j . The labor
market clearing condition in (OA.1) implies

                                                      ^
                                                      ¯i =
                                                   ^i L
                                                   w                       ^i n
                                                                       yij N       ^
                                                                              ^ ij x
                                                                                   ¯ij .                              (OA.11)
                                                                   j


4. The price index (OA.2) implies
                                                    1-
                      ^ 1-                     r
                                               ¯ij wi   ij (nij )nij Ni       (nij n ^ ij ) 1-         ^i
                      Pj       =             i            1-
                                                                          ^
                                                                          ¯ij ij
                                                                          r    ij (nij ) w ^i n   ^ ij N
                                                        Pj
                                                1-                       -1
                                          r
                                          ¯ij wi    ij (nij )nij Ni Ej Pj            (nij n ^ ij ) 1-
                               =                                                 ^
                                                                                 ¯ij ij
                                                                                 r                             ^i
                                      i
                                          or
                                                 1-
                                            ¯oj wo    oj (noj )noj No Ej P -1         ij (nij ) w ^i n    ^ ij N
                                                                                 j
                                                          x
                                                          ¯ij nij Ni             (nij n^ ij ) 1-      ^i
                               =                     i
                                                                             ^
                                                                             ¯ij ij
                                                                             r    ij (nij ) w^i n^ ij N
                                                          ox¯oj noj No




                                                                   OA - 3
Let xij  (Ni nij x
                 ¯ij ) / (    o   x
                                  ¯oj noj No ) = Xij / (                       o   Xoj ) be the spending share of country j on country i.
Thus,
                                      ^ 1- =                                       ij (nij n
                                                                                           ^ ij ) 1-      ^i .
                                      Pj
                                                                       ^
                                                                       ¯ij
                                                                   xij r                         w
                                                                                                 ^   n
                                                                                                     ^ ij N                                                        (OA.12)
                                                          i
                                                                                   ij (nij ) i

5. The free entry condition in (OA.7) implies
                                                                                                                    m              -1
                                                                                                       nij n^ ij ij (n)
                                  ¯ ¯^                                                 ^                                     dn
                            ^i =  Fi Fi +
                         Ni N
                                                                              ¯ij n
                                                                          nij x        ¯ij
                                                                                  ^ ij x               0            ij (n)
                                                                                                                                   
                                  ¯  ^
                                  Li L
                                     ¯i                                       ¯
                                                                          wi Li w      ^
                                                                                       ¯                 ^ ij
                                                                                                     nij n        m ij (n)
                                                                    j              ^i L  i                                      dn
                                                                                                     0          ij (nij n^ ij )


                                Fi       ¯
Using (OA.7) to substitute for  L
                                ¯i ,

                                       m                                                                                    m              -1
                                  nij ij (n)                                                                   nij n^ ij ij (n)
                                                dn                      ^
                                                                        ¯i
                                                                        F                   n    ^
                                                                                            ^ ij x
                                                                                                 ¯ij                                 dn
          ^i = 1 -                0    ij (n)                                                                  0            ij (n)
          N                   yij n m (n)                                  +            yij                               m
                                                                                                                                                .                  (OA.13)
                                    ij  ij
                                                 d                      ^
                                                                        ¯i
                                                                        L                   w^L  ^
                                                                                                 ¯               ^ ij
                                                                                                             nij n          ij (n)
                                                                                                                                        dn
                          j                                                         j            i     i
                                  0    ij (nij )                                                             0          ij (nij n^ ij )



A.3       Proof of Proposition 2
Part 1. We start by totally differentiating the equilibrium equations in Lemma 1. Equation (11) implies

                                              ¯
                     ij (nij )d ln nij = d ln f ij - d ln r
                                                          ¯ij + d ln wi - ( - 1)d ln Pj - d ln Ej                                                                  (OA.14)

    Equation (14) yields

                 d ln x
                      ¯ij = d ln r
                                 ¯ij +       ij (nij )d ln nij                - ( - 1)d ln wi + ( - 1)d ln Pj + d ln Ej .

    The sum of the two equations above implies that

                              d ln x          ¯
                                   ¯ij = d ln fij + d ln wi + (                           ij (nij )        - ij (nij )) d ln nij                                   (OA.15)

    Equation 8 implies that

                                                                  ¯ j + (1 - j )d ln T
                                     d ln Ej = j d ln wj + j d ln L                  ¯j .                                                                          (OA.16)

   By combining the market clearing condition in (OA.1) with the version of the free entry condition in
(OA.4), we have that
                               F ¯i    1        f  ¯ij
                                                       nij m (n)
                                                           ij
                                ¯i  =     -       ¯i 0            dn,
                                L     Ni     j
                                                 L         ij (n)

which implies that
                                                                         ¯         m                                                            ¯    m
                 ¯i      ¯ ¯                                          f       nij ij (n)                            ¯           ¯              f ij ij (nij )
  1
 -Ni
     d ln Ni   -L
                 F
                ¯ i d ln Fi /Li =                                   j L ¯i
                                                                          ij
                                                                              0    ij (n)
                                                                                           dn                  d ln f ij - d ln Li +           ¯ i ij (nij ) nij d ln nij
                                                                                                                                               Lj
                                                                                          m                                                                   m
                                                                   ¯ij ij (nij ) nij ij (n)
                                                                   x                                                      ¯          ¯              ¯ij nij ij (nij )
                                                                                                                                                    x
                         =                            j              ¯ i ij (nij ) 0
                                                                  wi L                    ij (n)
                                                                                                              dn     d ln fij - d ln Li       + j w     ¯
                                                                                                                                                        L
                                                                                                                                                      i i     ij (nij )
                                                                                                                                                                        d ln nij
                                                                                     m
                                                                                nij ij (n)
                                                                  nij x
                                                                      ¯ij                       dn                                             x
                                                                                                                                               ¯ij nij
                         =                                            ¯i
                                                                               0     ij (n)
                                                                                     m
                                                                                                                  ¯
                                                                                                             d ln f          ¯
                                                                                                                   ij - d ln Li +                  ¯i      (1 +     ij (nij )) d ln nij
                                                  j               wi L        nij ij (n)                                                     j wi L
                                                                              0                 dn
                                                                                    ij (nij )
                                                                                     m
                                                                               nij ij (n)
                                                                                                dn
                         =                   1
                                                                        yij
                                                                              0      ij (n)
                                                                                    m (n)
                                                                                                                 ¯
                                                                                                            d ln f           ¯
                                                                                                                   ij - d ln Li +
                                                                                                                                        1
                                                                                                                                                        yij (1 +    ij (nij )) d ln nij ,
                                             Ni               j               nij    ij                                                 Ni          j
                                                                              0                 dn
                                                                                    ij (nij )




                                                                              OA - 4
                                             ij (nij ) ¯
where the second equality uses x
                               ¯ij =         ij (nij )
                                                        fij wi ,    the third equality uses (16) and (OA.3), and the fourth
uses yij  Ni x           ¯i.
             ¯ij nij /wi L
    Thus,


                        ¯i /L
      d ln Ni = -i d ln F   ¯i -                            ¯
                                         yij ij (nij ) d ln f          ¯
                                                             ij - d ln Li -                       yij (1 +   ij (nij )) d ln nij   (OA.17)
                                     j                                                      j


where                                                                      m
                                                                      nij ij (n)
                                                                     0     ij (n)
                                                                                    dn
                                                    ij (nij )       nij    m (n)                                                   (OA.18)
                                                                           ij
                                                                    0     ij (nij )
                                                                                     dn

and, by equation (OA.6),
                                                ¯i Ni
                                                F
                                             i   ¯ = 1 -                        yij ij (nij ).                                     (OA.19)
                                                 Li                        j

    Equation (OA.1) implies

                                             ¯i =
                              d ln wi + d ln L                 yij (d ln Ni + d ln nij + d ln x
                                                                                              ¯ij ) ,
                                                          j


which combined with (OA.15) implies

                              ¯i =
             - d ln Ni + d ln L                       ¯
                                             yij d ln f ij +        yij (1 +         ij (nij )   - ij (nij )) d ln nij .           (OA.20)
                                         j                      j

    The combination of this equation and (OA.17) implies that

                                                             ¯i +
                             yij ij (nij )d ln nij = -i d ln F                                                ¯
                                                                                     yij (1 - ij (nij )) d ln f ij .               (OA.21)
                        j                                                       j


    Finally, equation (OA.2) implies

          (1 -  )d ln Pj =                  ¯ij - ( - 1)d ln wi + (1 +
                                  xij (d ln r                                            ij (nij )) d ln nij   + d ln Ni )         (OA.22)
                              i


    Equations (OA.14), (OA.17), (OA.21) and (OA.22) form a system that determines {d ln nij , d ln Ni , d ln Pi , d ln wi }i.j
for any arbitrary set of shocks. We now establish Part 1 of Proposition 2 by reducing this system to two
sets of equations determining {d ln Pi , d ln wi }i in terms of  , {ij (nij ), nij , Xij }i,j . To this end, note that
                                                   1+    (nij )       ij (nij )
the definition of ij (nij ) in (17) implies that ijij   (nij ) = 1 + 1- . Thus, equations (OA.22) and (OA.20)
imply
                     (1 -  )d ln Pj =         i xij (d ln r¯ij - ( - 1)d ln wi + ij (nij )d ln nij )
                                                            ij (nij )                                         (OA.23)
                                      +           i xij       1-      ij (nij )d ln nij + d ln Ni

                                    ¯i -                      ¯                       ij (nij )
                     d ln Ni = d ln L                yij d ln fij +            yij                   ij (nij )d ln nij .           (OA.24)
                                                j                      j
                                                                                      -1




                                                               OA - 5
   By substituting the second equation into the first, we get that

           (1 -  )d ln Pj                 =                           i xij          ¯ij - ( - 1)d ln wi + ij (nij )d ln nij )
                                                                               (d ln r
                                                                   ij (nij )                                               id (nid )
                                          -      i   xij             -1         ij (nij )d ln nij -             d   yid      -1          id (nid )d ln nid
                                          +                                         xij d ln L ¯i -                        ¯
                                                                                   i                            d yid d ln fid


   By substituting (OA.14) into this expression,

               -                                                                                  ¯                 ¯                        ¯
 d ln Ej               i   xij d ln wi =                                   i xij d ln Li + d ln fij -     d yid d ln fid
                                                                  ij (nij )         ¯
                             -                            i xij      -1                  ¯ij + d ln wi - ( - 1)d ln Pj - d ln Ej
                                                                               d ln fij /r
                                                                      id (nid )          ¯
                             +                       i xij    d yid      -1        d ln f     ¯id + d ln wi - ( - 1)d ln Pd - d ln Ed
                                                                                          id /r


   Substituting (OA.16) into this expression,

j d ln wj -                                                        -j d ln L  ¯ j - (1 - j )d ln T   ¯j +                ¯           ¯                  ¯
                   i   xij d ln wi         =                                                                  i xij d ln Li + d ln fij -     d yid d ln fid
                                                                                 ij (nij )      ¯
                                           -                               i xij  -1       d ln f     ¯ij + d ln wi - ( - 1)d ln Pj - j d ln wj
                                                                                                  ij /r
                                                                                     id (nid )        ¯
                                           +                         i xij     d yid  -1       d ln f      ¯id + d ln wi - ( - 1)d ln Pd - d d ln wd
                                                                                                       id /r
                                                                   ij (nij )
                                           +         i   xij          -1      j d ln L¯ j + (1 - j )d ln T   ¯j -       yid id (nid ) d d ln L
                                                                                                                                     d
                                                                                                                                                                ¯d
                                                                                                                                             ¯ d + (1 - d )d ln T
                                                                                                                                              -1


   Thus, for market i,

                                          p                                             p
                                         vij d ln Pj -               w
                                                                    vij d ln wj = d ln ri - d ln fip + d ln Lp         p
                                                                                                             i + d ln Ti                                     (OA.25)
                                 j                             j

          w                                                                                  xji ji (nji )
         vij                                                       1[i = j ] 1 -        j         -1             i
                                                                    j
                                                                                                                                                             (OA.26)
                                                                                              
                   +        (    o   xoi yoj oj (noj ))              -1        - xji 1 -      -1      (ji (nji ) -             d   yjd jd (njd ))

                                           p
                                          vij  1[i = j ]                   xoi oi (noi )       -               xoi yoj oj (noj )                             (OA.27)
                                                                       o                                o


                                               p                       ji (nji )                               jd (njd )
                                         d ln ri             xji                      ¯ji -
                                                                                 d ln r                 yjd              d ln r
                                                                                                                              ¯jd                            (OA.28)
                                                         j
                                                                       1-                                      1-
                                                                                                   d


                                                                    ji (nji )                                             jd (njd )
                       d ln fip                xji           1-                         ¯
                                                                                   d ln fji -          yjd 1 -                                 ¯
                                                                                                                                          d ln f jd          (OA.29)
                                           j
                                                                    -1                                                    -1
                                                                                                   d
                                                        
                                              ji (nji )                                                                        jd (njd )
       d ln Lp
             i    1 -                     xji                   ¯i -
                                                         i d ln L                      xji            ¯j -
                                                                                                 d ln L                  yjd                    ¯d
                                                                                                                                         d d ln L            (OA.30)
                                     j
                                              -1                                   j
                                                                                                                               -1
                                                                                                                    d
                                                       
                                             ji (nji )                                                                  jd (njd )
    d ln Tip  1 -                        xji                         ¯i +
                                                        (1 - i )d ln T                        xji               yjd                            ¯d
                                                                                                                                  (1 - d )d ln T             (OA.31)
                                 j
                                             -1                                          j
                                                                                                                        -1
                                                                                                           d

   Equations (OA.21) and (OA.14) imply

                ¯
       yij d ln f           ¯ij + d ln wi - ( - 1)d ln Pj
                  ij - d ln r                                                                -                                 ¯ j + (1 - j )d ln T
                                                                                                        yij j d ln wj + j d ln L                   ¯j
   j                                                                                                   j
                                                                                                               ¯i +
                                                                                                       -i d ln F                                 ¯
                                                                                             =                        j yij (1 - ij (nij )) d ln fij




                                                                                  OA - 6
     Thus,

          d ln wi -           yij j d ln wj -          yij ( - 1)d ln Pj        =                  ¯ij - j yij ij (nij )d ln f
                                                                                          yij d ln r                          ¯ij
                          i                        j                                     j
                                                                                                  ¯
                                                                                         -i d ln Fi + j yij (1 - j )d ln Tj ¯
                                                                                                                 ¯j
                                                                                                  + j yij j d ln L

     Thus,

                  mw
                   ij d ln wj -         mp                  w         w         w         w         w
                                         ij d ln Pj = d ln ri - d ln fi + d ln Fi + d ln Ti + d ln Li                               (OA.32)
              j                     j


                                                         mw
                                                          ij  1[i = j ] - yij j                                                     (OA.33)

                                                               mp
                                                                ij  yij ( - 1)                                                      (OA.34)
                                    w
                              d ln ri                    ¯ij ,
                                                yij d ln r         and d ln fiw                                 ¯
                                                                                              yij ij (nij )d ln f ij                (OA.35)
                                          j                                               j

                             ¯i ,
           d ln Fiw  -i d ln F           d ln Tiw                                 ¯j ,
                                                                 yij (1 - j )d ln T          d ln Lw
                                                                                                   i 
                                                                                                                         ¯j
                                                                                                              yij j d ln L          (OA.36)
                                                           j                                              j

                                                                                                    ¯ = [vij ]i,j .
   Let us use bold letters to denote vectors, v = [vi ]i and bold bar variables to denote matrices, v
Thus, equations (OA.25)­(OA.32) imply

                                               ¯ p d ln P - v
                                               v            ¯ w d ln w              = d ln  p
                                               ¯ p d ln P + m
                                              -m              ¯ w d ln w            = d ln  w

where
                                     p                   p
                                d ln i             d ln ri - d ln fip + d ln Lp         p
                                                                              i + d ln Ti
                                     w           w
                                d ln i     d ln ri  - d ln fiw + d ln Lw           w        w
                                                                        i + d ln Ti + d ln Fi

     We then use the first equation to solve for the price index change,

                                                                   -1
                                                        vp )
                                              d ln P = (¯                v w d ln w + d ln  p ) ,
                                                                        (¯                                                          (OA.37)

which we then substitute into the second equation to obtain,

                                             -1 w                             -1
                                ¯w -m
                                m        vp ) v
                                    ¯ p (¯     ¯ d ln w = d ln  w + m    v p ) d ln  p .
                                                                    ¯ p (¯                                                          (OA.38)

    Notice that, because of the numeraire choice, solving (OA.38) requires dropping one row and one column
by setting d ln wn = 0 for some arbitrary country n.
    Recall that {Xij }ij immediately yields {j , xij , yij }i,j . Thus, the system (OA.37)­(OA.38) determines
{d ln Pi , d ln wi }i as a function of shocks. Since (m       ¯ w, m¯ p, v    ¯ p ) and (d ln r p , d ln r w ) depend only on  ,
                                                                         ¯w , v
                                             d ln wi       d ln Pi
{ij (nij ), Xij }i,j , and {d ln r¯ij }i,j , d    ¯od and d ln r
                                               ln r             ¯od are functions of (, {km (nkm )}km , {Xkm }km ) . By
            d ln Ei
(OA.16), d ln r ¯od  is also a function   of ( ,  {  km km km , {Xkm }km ) . For the other shocks, it is also necessary
                                                              }
                                                       ( n  )
to know the share of country i's labor force allocated to cover fixed costs of exporting to j , {ij (n0                   ij )}i,j ,
which immediately yields i as defined in (OA.19).




                                                                     OA - 7
     To obtain changes in the number of entrants, we combine equations (OA.24) and (OA.14):

                  ¯i -                        ¯                   ij (nij )           ¯
   d ln Ni = d ln L                  yij d ln f ij +        yij                  d ln f     ¯ij + d ln wi - ( - 1)d ln Pj - d ln Ej .
                                                                                        ij /r
                             j                          j
                                                                  -1
                                                                                                                                (OA.39)
    This implies that d ln Ni is a function of d ln f      ¯ij , d ln ¯
                                                                      rij j ,  , { ij
                                                                                      ( n  )
                                                                                         ij j}  ,  { d ln Pj , d ln w j , d ln Ej }j , and
                             d ln wi   d ln Pi      d ln Ei                                                                      d ln Ni
{Xij }ij . Thus, given that d ln r
                                 ¯od , d ln r            ¯od are functions of (, {km (nkm )}km , {Xkm }km ), d ln r
                                            ¯od and d ln r                                                                            ¯od is
a function of (, {km (nkm )}km , {Xkm }km ) .
    Finally,
                        d ln Xij =                      d ln Ni + d ln nij + d ln x    ¯ij
                                     = d ln Ni + d ln wi + (1 + ij (nij ) - ij (nij )) d ln nij
                                                           ¯                             ij (nij )
                                     = d ln Ni + d ln f     ij + d ln wi - ij (nij )  -1 d ln nij

where the first equality follows from Xij  Ni nij x ¯ij , the second equality follows from (OA.15), and the third
equality follows from the definition of ij (nij ) in (17).
   Using (OA.14),

                           ¯                                ij (nij )         ¯
 d ln Xij = d ln Ni + d ln f ij + d ln wi -                              d ln f    ¯ij + d ln wi - ( - 1)d ln Pj - d ln Ej
                                                                               ij /r                                                        (OA.40)
                                                            -1

              d ln wi d ln Pi d ln Ei d ln Ni                                                                                    d ln Xij
Thus, since { d    ¯od , d ln r
                ln r                                ¯od }j are functions of (, {km (nkm )}km , {Xkm }km ),
                                         ¯od , d ln r
                              ¯od , d ln r                                                                                       d ln r
                                                                                                                                      ¯od   is a func-
tion of (, {km (nkm )}km , {Xkm }km ) .

Part 2. Equation (OA.14) immediately implies that

                                            1          ¯
                      d ln nij =                  d ln f ij - d ln r
                                                                   ¯ij + d ln wi - ( - 1)d ln Pj - d ln Ej
                                        ij (nij )

            d ln wi d ln Pi d ln Ei                                                                                        d ln nij
    Since { d    ¯od , d ln r
              ln r                     ¯od }j are functions of (, {km (nkm )}km , {Xkm }km ) , then
                            ¯od , d ln r                                                                                        ¯od
                                                                                                                           d ln r     is a function
of (, {km (nkm )}km , {Xkm }km ) and ij (nij ).


A.4         Proof of Proposition 3
Assume that we observe trade outcomes in the initial equilibrium, {n0                   0
                                                                                ij , Xij }i,j , and changes in wages and trade
outcomes between two equilibria, {w     t
                                           ^t     ¯t
                                                  ^      ^t                                                       0     0        0
                                       ^i ,n ij , x ij , Xij }i,j . We can immediately compute yij = Xij /                   d Xid ,
0              0            0    ^t   ^t ^ ¯t    ^t      ^
                                                         ¯             0 ^t      t     ^t =             0 ^t            ^
                                                                                                                      t ¯t ^t
 i =       d Xid /       o Xoi , Ni = Xij /x  ij n ij , Li =                   ^i
                                                                    j yij Xij /w   , E   i          i xij Xij , ^
                                                                                                                i = w
                                                                                                                    ^i Li /Ei and
^  t  ^ t
Ti = Ei (1 - i ^0           0
                  i )/(1 - i ).
     The first step of the proof is to establish the set of fundamental changes that rationalizes changes in
bilateral trade outcomes and observed wages. In the main text we discuss the identification of f                           ^
                                                                                                                           ¯ij and
^
r t
~ij  r^t   ^
      ¯ij /r t                                                  0    0
           ¯jj ­ see equations (21) and (22). Given {nij , yij }j and {w             t
                                                                                   ^i , n  t   ^ t   ^ }j , equation (OA.13) for
                                                                                               ¯ij , X
                                                                                        ^ ij , x       t
                                                                                                       ij
origin i implies that
                                                                       m
                                                                                                               m
                                                                                                                            -1
                                                          n0ij n^t
                                                                 ij ij (n)                               n0ij ij (n)
                   ^
                   ¯t
                   L                       n  ¯t
                                           ^t x
                                              ^                                 dn                                      dn
            ^
            ¯it = 
            F        i
                   ^t -
                                        0 ij ij
                                       yij
                                                          0            ij (n)
                                                                                       1   -        0
                                                                                                   yij
                                                                                                        0      ij (n)       
                                                                                                                                            (OA.41)
                                             ^i
                                             w t       n0   n
                                                            ^ t
                                                                       m (n)                           n0      m
                                                                                                          ij ij (n)
                                                                                                                            
                   N    i        j
                                                         ij ij         ij
                                                                                   dn          j                         dn
                                                       0                 0
                                                                   ij (nij n
                                                                              t
                                                                            ^ ij )                     0           0
                                                                                                              ij (nij )


     The second step of the proof is to show that, given {n0     0
                                                           ij , Xij }i,j in the initial equilibrium, the observed




                                                                        OA - 8
changes {w t
              ^t     ¯t
                     ^      ^t
         ^i  ,n ij , x ij , Xij }i,j are the equilibrium changes in our economy when


          ^
          ¯      ^
                 ¯t                ^     ^ t                      ^                ^    ^
                                                                                   ¯i = F
                                                                                        ¯it i;           ^    ^
                                                                                                              ¯t
                                                                                                         ¯i = L     ^
                                                                                                                    ¯    ^
          f ij = fij i, j ;        ¯ij = r
                                   r     ~ij i = j ;              ¯ii = 1 i;
                                                                  r                F                     L      i ; Ti = Ti i.                   (OA.42)

      To this end, we use (OA.8)­(OA.13) to write the conditions that determine the equilibrium vector
{w^i , n      ^     ^i , E
              ¯ij , N
       ^ ij , x                                                                            ^
                                                                                           ¯t in expression (21) into
                         ^j }i,j for the set of exogenous shocks in OA.42. By substituting f
                                                                                             ij
(OA.8) and (OA.9), n                   ^
                              ^ ij and x
                                       ¯ij must satisfy

                                              0          ^ij ij (n0           ^t             0 t
                                                ^ ij )
                                        ij (nij n        x
                                                         ¯          ij )      x
                                                                              ¯ ij             ^ ij )
                                                                                       ij (nij n        ij (n0 ij )
                                                0                           =                                                                    (OA.43)
                                          ij (nij )      w^i ij (n0
                                                                  ij n
                                                                     ^ ij )   w^it            0
                                                                                         ij (nij )
                                                                                                             0  ^t
                                                                                                        ij (nij n ij )


     By substituting r^     ^
                      ¯ij = r t
                            ~ij in expression (22) into the ratio of equation (OA.9) for pairs (i, j ) and (j, j ),
^
x    ^
¯ij /x
     ¯jj must satisfy

                                         -1                                                       -1
                      ^ij
                      ¯
                      x          ^i
                                 w             ij (n0         0
                                                    ij ) jj (njj n
                                                                 ^ jj )   ¯t
                                                                          ^
                                                                          x ij           w
                                                                                         ^it            ij (n0         0 t
                                                                                                             ij ) jj (njj n
                                                                                                                          ^ jj )
                                                                        =                                                                        (OA.44)
                      ^
                      ¯jj
                      x          ^j
                                 w             jj (n0         0 ^ )
                                                    jj ) ij (nij n ij     ^
                                                                          ¯t
                                                                          x jj           ^j
                                                                                         w t                 0         0  ^t
                                                                                                        jj (njj ) ij (nij n ij )


                    ^
    By substituting r     ^
                          ~ij
                    ¯ij = r t                        ^
                              in expression (22) and r                                         ^
                                                     ¯jj = 1 into equation (OA.9) for (j, j ), x
                                                                                               ¯jj must satisfy

                                                                                             1-    ^j
                                                                   jj (n0
                                                                        jj n
                                                                           ^ jj ) (w
                                                                                   ^j )            E
                                ^
                                x
                                ¯jj =   ¯t
                                        ^
                                        x jj                             -1  (n0 n    t
                                                                                                                                                 (OA.45)
                                                                    t
                                                   0              w
                                                                  ^i        jj   jj ^ jj )              1-      ^i
                                                      ^
                                                      ¯t
                                                i xij x ij        ^j
                                                                  w t
                                                                            ij (n0 n^
                                                                                               0 ^ )w
                                                                                      t ) ij (nij n ij ^i  ^ ij N
                                                                                                           n
                                                                                 ij ij


                    ^ in expression (OA.41) into (OA.13), N
                    ¯
    By substituting F                                     ^i must satisfy
                     ij

                                                                m                                                       m
                                                                                                                                       -1
                                                   n0ij n^t
                                                          ij ij (n)                                        n0   ^ ij ij (n)
                                                                                                             ij n
             1                       ^t x
                                     n
                                  0 ij ij
                                         ¯t
                                         ^         0            ij (n)
                                                                         dn                  n    ^
                                                                                             ^ ij x
                                                                                                  ¯ij      0            ij (n)
                                                                                                                                 dn 
       ^i = 
       N     ^t -                yij                                           +        0
                                                                                       yij                                                       (OA.46)
                                         ^
                                         ¯t     n0   n
                                                     ^ t
                                                                m (n)
                                                                                                  ^
                                                                                                  ¯t    n0   n
                                                                                                             ^          m (n)          
             Ni             j        w tL
                                      ^i   i
                                                  ij ij         ij
                                                                  0 ^ t ) dn       j         w^i L i
                                                                                                          ij   ij       ij
                                                                                                                                    dn
                                                0           ij (nij n ij
                                                                                                        0                 0
                                                                                                                    ij (nij n^ ij )


                              ^i and w
    From (OA.10) and (OA.11), E      ^i must satisfy

                                                          ^ i = 0    ^
                                                                     ¯t         0 ^¯t
                                                          E     i w
                                                                  ^i L i + (1 - i )Ti ,                                                          (OA.47)

                                                              ^
                                                              ¯i =
                                                           ^i L
                                                           w                  0
                                                                             yij ^i n
                                                                                 N       ^
                                                                                    ^ ij x
                                                                                         ¯ij .                                                   (OA.48)
                                                                        j

     We now verify that the system (OA.43)­(OA.48) is satisfied by {w                   t
                                                                                           ^t     ^t     ^ t ^t             ^t
                                                                                       ^i ,n ij , x
                                                                                                  ¯ ij , Ni , Ej }i,j where Ni =
X^ t /x
      ^t ^ t        ^t              0 ^t
  ij ¯t n  ij and Ei =           i xij Xij . It is straight forward to check that (OA.43), (OA.44) and (OA.46) are
satisfied for {w  t
                     ^t     ¯t
                            ^      ^ t ^t            ^t         0 ^t
                 ^i ,n ij , x ij , Ni , Ej }. Since Ei =     i xij Xij , equation (OA.45) holds:

                                                                  1-
                                       jj (n0  ^t             t         ^t
                                            jj n jj )       w
                                                            ^j          Ej                                                ^t
                                                                                                                          Ej
        ¯t
        ^
        x jj                             -1  (n0 n
                                                                                                         ¯t
                                                                                                         ^
                                                                                                        =x jj                                ¯t
                                                                                                                                             ^
                                                                                                                                            =x jj .
                                 ^i
                                 w t                  t
                                                 jj ^ jj )                   t )1-                                   0     ^
                                                                                                                           ¯t   ^t  ^t
                                                                                             ^t                   i xij    x ij nij Ni
                                            jj
               i   x0  ^
                       ¯t
                    ij x ij      ^j
                                 w t
                                            ij (n0  ^t
                                                           ij (n0  ^t
                                                                ij n       ^i
                                                                     ij ) (w            ^t
                                                                                        n ij Ni
                                                 ij nij )




                                                                         OA - 9
                              ^       ^
                              ¯ t and T
     Using the definitions of L       ¯t , we can also show that equations (OA.47) and (OA.48) hold:
                                i      i


                                                                       ^t                                        t^
                                                                                                                  ¯t
                           0  t^¯t        0 ^¯t   0 t¯ ^ t + (1 - 0 ) Ei                               1 - 0
                                                                                                               ^i
                                                                                                               w  L i    ^it
                           iw^i Li + (1 - i )Ti = i w
                                                    ^i L i        i                                        i            =E
                                                                     1 - 0i                                     E^t
                                                                                                                  i

                                                                                                    0 ^t
                                                                                               j   yij Xij       t^
                                         0
                                        yij ^it n
                                            N   ^t   ¯t
                                                     ^
                                                  ij x ij =
                                                                         0 ^t
                                                                        yij Xij = w
                                                                                  ^it
                                                                                                              =w
                                                                                                               ^i ¯i.
                                                                                                                  L
                                                                                                   w
                                                                                                   ^it
                                    j                             j

                                                ^ t, X ^t = N     ^ tn t ^t
                                                                            ¯ij . Thus, given {n0            0
     Notice that, by the definition of N          i      ij        i ^ ij , x                          ij , Xij }i,j in the initial equilibrium,
{w t
      ^t     ¯t
             ^      ^t
  ^i ,n ij , x ij , Xij }i,j is an equilibrium vector of outcome changes implied by the set of exogenous shocks in
OA.42.
     Finally, we establish the second part of the proposition. Suppose that we also observe the change in the
price index for country j , P      ^ t . We now derive the change in the domestic revenue shifter r                      ^t
                                                                                                                         ¯jj that generates P ^t
                                    j                                                                                                           j
                                                                                  0      0
given observed trade outcomes in the initial equilibrium {nij , Xij }i,j and observed changes in wages and trade
outcomes between two equilibria, {w              t
                                                    ^t     ¯t
                                                           ^      ^t                                                         ^t   ^t    ^t ^ ¯t
                                                ^i ,n ij , x ij , Xij }i,j . Combining equation (OA.12) and n                  ij Ni = Xij /x ij ,
we get that
                                                                                   1-
                                                                            ^t
                                                                            P j
                                            ^ t
                                            r
                                            ¯jj =                                                                                      (OA.49)
                                                                       ij (n0     ^t              ^t
                                                             0     ^ t         ij n ij )   t  1-  X ij
                                                         i xij r   ~ij ij (n0 ) (w
                                                                                   ij
                                                                                         ^i )     ¯t
                                                                                                  ^
                                                                                                  x      ij


      ^
where r
      ~jj
        t      ^
          = 1, r t
               ~ij ^
                   r t ^t
                   ¯ij  ¯jj is given by (22) for i = j .
                       /r


A.5         Proof of the expressions in Section 3.3
                               ^j = w
Equation (23). If Ti = 0, then E    ^j and equation (11) for i = j is

                                                                            ^
                                                                            ¯                 -1
                                                       ii (nii n
                                                               ^ ii )       f ii        wi
                                                                        =                          ,
                                                         ii (nii )          ^
                                                                            r
                                                                            ¯ii         Pi

which immediately yields the expression in (23).


Equation (24). For the case of balanced trade with i = 1, equation (11) implies that

                                                                  ¯
                                         ii (nii )d ln nii = d ln f     ¯ii + ( - 1)d ln wi /Pi .
                                                                    ii /r


     Equation (14) implies that

                               d ln x
                                    ¯ii = d ln r
                                               ¯ii +     ii (nii )d ln nii
                                                                                                          ^i .
                                                                               - ( - 1)d ln wi /Pi + d ln E

     By summing these expressions, we get that

                                    d ln x          ¯
                                         ¯ii = d ln f ii + (     ii (nii )
                                                                                                          ^i
                                                                             - ii (nii )) d ln nii + d ln E




                                                                     OA - 10
      Thus,
                          d ln xii   =            d ln Ni + d ln nii + d ln x  ¯ii - d ln Ei
                                               ¯
                                     = d ln fii + d ln Ni + (1 + ij (nij ) - ij (nij )) d ln nij
                                            ¯                (1+ ij (nij )-ij (nij ))
                                     = d ln f ii + d ln Ni +         ij (nij )        ij (nij )d ln nij
                                                   ¯
      Using the fact that ii (nii )d ln nii = d ln f     ¯ii + ( - 1)d ln wi /Pi ,
                                                     ii /r


                              ¯                             1 + ij (nij )                            1       ¯
                 d ln xii /Ni fii = - ( - 1) 1 -                                  d ln wi /Pi +         d ln f ii /r
                                                                                                                   ¯ii
                                                              ij (nij )                              -1

      By the definition of ii (nii ) in (17),

                                           ¯                                       1       ¯
                              d ln xii /Ni fii = -ii (nii ) d ln wi /Pi +             d ln fii /r
                                                                                                ¯ii ,
                                                                                   -1
which immediately yields the expression in (24).

The constant elasticity benchmark.
Assume that that ij (n) = i and ij (n) = i for all n, i and j . By the definition of ij , we immediately
get that ij  i = ( - 1) 1 - 1+       i
                                       i
                                         . By equation (16), m   i (n) = (1 + i (n)) i (n) and, therefore,
 m
i (n) = (1 + i ) n . Consider the free entry condition in equation (OA.5):
                   i



                                                                                 nij
                          ¯i                                                         n i -i dn
                       wi F      =                          j       ¯ij 1 -
                                                                nij x           0
                                                                                -i    nij
                                                                              nij    0    n i dn
                                                                         1+   - 
                                                                 1+ i n     i    i           -i
                                 =       j       ¯ij 1 -
                                             nij x              1+ i -i n1+ i -i    =     1+ i -i           j       ¯ij .
                                                                                                                nij x

      The market clearing condition in (OA.1) implies that                             nij x        ¯ i /Ni and, therefore, Ni =
                                                                                           ¯ij = wi L
                                                                                   j
¯i
L        -i
F¯i    1+ i -i   .


A.6         Gains from Trade
We now compute the gains from trade in our model. We assume that ^
                                                                 ¯ij   for all i = j , and that
^
a    ^    ^
          ¯
     ¯i = fij = 
¯i = F          ^     ^
                      ¯ i = 1 for all i and j .
                ¯ii = L

Corollary 1. Consider an economy moving from the trade equilibrium to the autarky equilibrium with
^A = 0. The change in the real wage is given by (23) where n
T                                                          ^A       ^A
 i                                                           ii and Ni solve


                                        ii         ^A
                                               nii n ii          xii                   ^A
                                                                            ^ A ii nii n ii
                                                        =               ^A
                                                                        n   N
                                                                          ii i              ,                               (OA.50)
                                             ii (nii )           i               ii (nii )
                                                        m                                              m
                                                                                               ^A
                                                                       
                                                   nij ij (n)                              nii n ii ij (n)
                                        Xij        0    ij (n)
                                                                  dn                       0           ij (n)
                                                                                                                 dn
                         1 -                                         ^iA
                                                                     N        =1-                                     .     (OA.51)
                                                    nij m   ( n )                            ^A        m (n)
                                        j Xij            ij                              nii n         ij
                                 j                 0    ij (nij )
                                                                   d                     0
                                                                                              ii
                                                                                                   ij (nii n
                                                                                                              A
                                                                                                            ^ ii )
                                                                                                                   dn


    In order to compute the gains from trade using (23), we need to compute changes in nii when the economy
moves to autarky (i.e,  ^
                        ¯ij   for all i = j ). Equation (OA.50) captures the change in the profitability of
the domestic market that determines the change in the domestic survival rate of firms (given N^ A ). Equation
                                                                                               i
(OA.51) is the free entry condition that determines the change in the number of entrants when the country


                                                                 OA - 11
moves to autarky. The left hand size of (OA.51) is the profit/revenue ratio (inclusive of entry costs) that
firms have in different markets in the initial equilibrium. The right hand size is the profit/revenue ratio that
entrants have in the domestic market in the autarky equilibrium.


A.6.1         Proof of Corollary 1
To simplify the notation, we drop the superscript A and use ``hat'' variables to denote the change from
the initial equilibrium to the autarky equilibrium. We assume that             ^
                                                                               ¯ij   for all i = j , and that
^
a    ^
     ¯     ^
           ¯
¯i = Fi = fij =  ^     ^
                       ¯
                 ¯ii = Li = 1 for all i and j . We set the wage of i to be the numerarie, wi  1, so that w
                                                                                                         ^i = 1.
Equation (OA.12) implies that
                                              1-        ii (nii n
                                                                ^ ii )
                                          ^i
                                          P      = xii                 n    ^i
                                                                       ^ ii N                          (OA.52)
                                                         ii (nii )
   From equation (OA.8), we get that, for all i = j ,                        ij        ^ ij )   and, therefore, n
                                                                                  (nij n                        ^ ij = 0. In addition, it
implies that

                                                                                           1-
                                                                                  ^i
                                                                                  P
                                                              ii    (nii n
                                                                         ^ ii )
                                                                                =                                                          (OA.53)
                                                                   ii (nii )        E^i
                        ^i = i , (OA.52) and (OA.53) imply that
    Using the fact that E

                                                  ii    (nii n
                                                             ^ ii )   xii ii (nii n
                                                                                  ^ ii )      ^i .
                                                                    =                    n
                                                                                         ^ ii N                                            (OA.54)
                                                       ii (nii )      i ii (nii )

    From expression (OA.13),
                                                           m                                                       m              -1
                                                      nij ij (n)                                      nii n^ ii ij (n)
                                                     0     ij (n)
                                                                    dn                               0             ij (n)
                                                                                                                             dn
                    ^i = 1 -
                    N                           yij n m (n)                       +   yii n
                                                                                          ^ ii x
                                                                                               ^
                                                                                               ¯ii n n                            
                                                       ij  ij                                        ii ^ ii     m ij (n)
                                           j        0     ij (nij )
                                                                     dn                            0           ij (nii n^ ii ) dn

                                                            m                                                         m
                                                       nij ij (n)                                        nii n^ ii ij (n)
                       ^ i 1 -                        0        (n) dn                     ^i n          0             ij (n)
                                                                                                                                dn
                     1=N                         yij n ij   m (n)
                                                                                  +   yii N       ^
                                                                                             ^ ii x
                                                                                                  ¯ii n n           m    ( n )
                                                        ij  ij                                          ii ^ ii       ij
                                           j         0     ij (nij )
                                                                     dn                               0           ij (nii n^ ii ) dn

                        ^i n
                        N       ^
                           ^ ii x
                                ¯ii                       ^i n              i                        Xii Ei wi L ¯i
    Recall that x
                ^ii =       ^i        = 1/xii . Thus, yii N       ^
                                                                  ¯ii = yii x
                                                             ^ ii x              =                      ¯ i Xii Ei       = 1 and, therefore,
                           E                                                  ii                     wi L
                                                          m                                                    m
                                                     nij ij (n)                                   nii n^ ii ij (n)
                                                    0        (n) dn   ^i                          0            ij (n)
                                                                                                                        dn
                          1 -                  yij n ij   m (n)
                                                                      N            =1-          nii n
                                                                                                    ^ ii       m
                                                                                                             ij (n)
                                                                                                                             .
                                                      ij  ij
                                       j           0     ij (nij )
                                                                   dn                           0          ij ( n   n
                                                                                                                    ^
                                                                                                                  ii ii ) dn


A.7          Derivation of Equation (31)
By plugging (28) into (11)­(14) we have that


                                                                                         -1
                                    f                                    wi                          f                      f
  ln   ij   (nij ) = zij / +   
                             ~ ij + ij + ln wi                                                +  
                                                                                               ~ i + i - ln Pj-1 Ej -   
                                                                                                                      ~ j - j
                                                                        -1 a
                                                                           ¯i




                                                                       OA - 12
                                                                            1-
                                                                wi
           ¯ij - ln ij (nij ) = -
        ln x                     ~  zij -   
                                          ~ ij + ln                              -  
                                                                                  ~ j + ln Pj-1 Ej -   
                                                                                                     ~ j
                                                               -1 a
                                                                  ¯i

where                    + f ).
      ~   - 1 and   1/(~
   This implies that

                                                                                              -1
                          f                                                          wi                   f
             -     ~ ij + ij        = zij -  ln        ij   (nij ) +     ln wi      -1 a
                                                                                       ¯i          +~ i + i
                                                                                   f
                                                         -      ln Pj-1 Ej -   
                                                                             ~ j - j ,


                                                                           1-
                                                               wi
        -  
         ~ ij      ¯ij + 
              = ln x     ~  zij - ln ij (nij ) - ln                              -  
                                                                                  ~ j - ln Pj-1 Ej -   
                                                                                                     ~ j .
                                                              -1 a
                                                                 ¯i

    We can then write
                                 vij   =       zij -  ln ij (nij ) - i - j
                                                                                                                           (OA.55)
                                 vij   = ln x
                                            ¯ij +  ~  zij - ln ij (nij ) - i - j
    where
                                                        f                      
                                   vij  -        ~ ij
                                                      + ij         and vij  -~ ij ,

                                          -1
                               wi                     f                                        f
        i  -       ln wi                       +  
                                                ~ i + i            and j   ln Pj-1 Ej -   
                                                                                        ~ j -  j ,
                              -1 a
                                 ¯i

                                               1-
                                   wi                               
                      i  ln                          -  
                                                      ~ j       and j  ln Pj-1 Ej -   
                                                                                    ~ j .
                                  -1 a
                                     ¯i
    We obtain expression (31) by plugging the functional form assumptions in (29) into (OA.55). Finally,
                                     
notice that the definitions of j and j above immediately imply that

                                                    f    
                                                    j =  j - j .



B      Empirical Appendix
B.1      Sample Statistics in Table OA.1

B.2      Restricted Cubic Spline Implementation
We follow Harrell Jr (2001) in setting up our restricted cubic splines. Formally we use a restricted cubic
spline with knot values uk for k = 1, ..., K :

              f1 (ln n) = ln n
                                         3       (ln n-ln uk-1 )3                                3
                                                                + (ln uK -ln uk+1 )-(ln n-ln uk )+ (ln uk-1 -ln uk )
                            (ln n - ln uk )+ -                            (ln uk -ln uk-1 )
            fk+1 (ln n) =                                                       2                                      ,
                                                            (ln uK - ln u1 )

with the auxiliary function (n)+ = n if n > 0 and zero otherwise.


                                                        OA - 13
                Table OA.1: Data Availability
   Country       {x
                  ¯ij , nij , zij }        {ij }
Country Name     Origin Dest.         Origin Dest.    Developed
    AUS           43           32       3         0       1
    AUT           43           37       2         0       1
    BEL           43           36        3       0        1
    BGR           43           37       3         0       0
    BRA           43           31        3        0       0
    CAN           41           34       3         0       1
    CHE            0           37        0        0       1
    CHN           43           37       3         0       0
    CYP           24           36        1        0       1
    CZE           43           36        2       31       0
    DEU           37           37       2         0       1
    DNK           43           37        3        0       1
    ESP           43           36       3         0       1
    EST           43           36        3        0       0
     FIN          37           36        3        0       1
    FRA           43           37       3         0       1
    GBR           43           36       3         0       1
    GRC           43           36       3         0       1
    HRV           43           29       3         0       0
    HUN           37           36       3         0       0
    IDN            0           31       0         0       0
    IND            0           37       0         0       0
     IRL          37           37       3         0       1
    ITA           43           36        3        0       1
    JPN            0           36       0         0       1
    KOR           42           32        3        0       1
    LTU           43           35        3        0       0
    LUX           35           35        3        0       1
    LVA           38           36        3        0       0
    MEX           43           36       3         0       0
    MLT           42           34        3        0       1
    NLD           43           37       3         0       1
    NOR           43           36        3        0       1
    POL           43           36        2        0       0
    PRT           43           36       3         0       1
    ROU           43           36        3        0       0
    RUS            0           37       0         0       0
    SVK           42           36        2       36       0
    SVN           42           35       3         0       1
    SWE           40           37       3         0       1
    TUR           43           36       3         0       0
    TWN            0           29        0        0       1
    USA           39           37       2        36       1
  Count > 0       37           43       37       3       26
 Observations    1522                  103




                               OA - 14
                      Table OA.2: Constant Elasticity Gravity of Firm Exports

                            Dep. Var.:                       ln nij          ln x
                                                                                ¯ij          ln Xij
                                                              (1)             (2)              (3)
                      Panel A: Constant elasticity gravity estimation
                             Log of to Distan -1.148*** -0.778*** -1.927***
                                                 (0.0478)    (0.0420) (0.0708)
                               2
                             R                    0.913        0.691    0.870
                      Panel B: Implied structural parameters
                                                   ×           
                                                  -0.84      -0.56

Note. Sample of 1,524 origin-destination pairs in 2012 ­ see Table OA.1 of Appendix B.1. All specifications include origin and
destination fixed-effects. Implied structural parameters computed with ~ = 2.9 and  = 0.36 from column (3) of Table 1.
Standard errors clustered by origin-destination pair. *** p < 0.01



   In our main specification, we choose K = 4 knots. To determine the values ui , we follow Harrell Jr (2001)
and divide the data into the 5th, 35th, 65th, and 95th percentiles.


B.3       The Impact of Distance on the Extensive and Intensive Mar-
          gins of Firm Exports
B.3.1      Constant-Elasticity Gravity Equations
Table OA.2 presents the estimates of (34). Column (1) indicates that the exporter firm share falls sharply
with distance: a 1% higher bilateral distance leads to a 1.2% decline in exporter firm share. Column (2)
indicates that average sales also decline with distance. As pointed out by Fernandes et al. (2019), this
evidence is inconsistent with the lack of average revenue responses in the Melitz-Pareto model (Chaney, 2008).
Finally, column (3) reports an elasticity of bilateral trade flows to distance of -2, which is slightly lower
than the typical estimates in the literature reviewed by Head and Mayer (2014).
     In Panel B of Table OA.2, we use the expressions in (35) to recover   and . We use our baseline
calibration of ~  = 1.04 that sets   ~ =  - 1 = 2.9 from Hottman et al. (2016) and  = 0.36 from column
(3) of Table 1. The negative extensive margin elasticity implies that   < 0. Thus, in line with our model,
 < 0 whenever distance increases trade costs,  > 0. In addition, the implied value of indicates that the
average revenue potential of all exporters falls by 0.2% when the exporter firm share increases by 1%. Hence,
marginal exporters have a lower revenue potential than incumbent exporters in each market.


B.3.2      Piece-wise Linear Approximation of Baseline Estimates
In this section, we extend the specification in (34) by allowing the coefficients  and   to differ across country
pairs in different ranges of the support of nij . This specification sheds light on how the gravity elasticities
of the extensive and intensive margins of firms exports vary with the exporter firm share. Accordingly, it
illustrates the main features of the data behind our estimates of the non-linear elaticities reported in Figure 3.



                                                         OA - 15
                       Table OA.3: Constant Elasticity Gravity of Firm Exports

                                                                               (1)            (2)             (3)
                                                                              ln nij         ln x
                                                                                                ¯ij         ln Xij
        Log of Distance × nij  (P0 (n), P5 (n)]                             -0.992         -0.701         -1.693
                                                                            (0.0360)       (0.0469)       (0.0680)

        Log of Distance × nij  (P5 (n), P35 (n)]        -0.864                             -0.724         -1.588
                                                        (0.0399)                           (0.0479)       (0.0729)
        [1em] Log of Distance × nij  (P35 (n), P65 (n)] -0.778                             -0.702         -1.480
                                                        (0.0414)                           (0.0515)       (0.0774)

        Log of Distance × nij  (P95 (n), P100 (n)]                          -0.692         -0.667         -1.358
                                                                            (0.0456)       (0.0575)       (0.0848)
        R2                                                                    0.912          0.696          0.886
Note. Sample of 1,524 origin-destination pairs in 2012 ­ see Table OA.1 of Appendix B.1. All specifications include origin and
destination fixed-effects. The four quantiles of nij are defined by the knots used in the estimation of the semiparametric
specification in Figure 3, with Pc (n) denoting percentile c of the empirical distribution of nij . Standard errors clustered by
origin-destination pair. *** p < 0.01



     Table OA.3 reports estimates of the gravity elasticity over four ranges of the support of nij defined by
the same knots used to in our semi-parametric estimates in Figure 3. Column (1) shows that the extensive
margin elasticity is less sensitive to distance among country pairs with high nij . In contrast, column (2)
indicates that the intensive margin elasticity is roughly constant across country pairs with different levels of
nij . Finally, column (3) shows that, because of the declining extensive margin elasticity, bilateral trade flows
become less sensitive to distance among countries with high values of nij .


B.4        Robustness of Baseline Estimates in Section 5.4
In this section, we investigate the robustness of the baseline estimates of (n) and (n) presented in Section
5.4. First, we implement the inference procedure in Chen and Christensen (2018) for the estimation of NPIV
sieve estimators. Second, we show that results are similar when we use data for different years that have a
similar country coverage. Third, we show that results are similar when we ignore observations associated
with domestic sales. Fourth, we investigate how our results depend on the assumptions used to compute the
number of domestic entrants, Ni . Fifth, we report our estimates with alternative calibrations of the elasticity
of substitution,  .


B.4.1       Alternative Inference
In this section, we investigate the robustness of our standard estimates of (n) and (n). We estimate standard
errors with a criterion value estimated using the bootstrapped procedure in Chen and Christensen (2018).
This method accounts for the fact that the function basis used in estimation are intended to approximate the
true nonparametric functions (n) and (n). Our results show that the confidence intervals implied by the
method in Chen and Christensen (2018) are similar to those implied by the robust standard errors of the
parameter estimates.



                                                          OA - 16
 Figure OA.1: Semiparametric Gravity of Firm Exports ­ Alternative Inference Procedure
                                                                 (a) Elasticity of (n)                                                            (b) Elasticity of  (n)
                                                           0                                                                            0.1
                                                                                              Estimate
                                                                                              GMM Standard Errors                         0
                                                                                              CC Standard Errors
                                                         -0.5
                                                                                                                                        -0.1
                                 Elasticity of Epsilon




                                                                                                                    Elasticity of Rho
                                                                                                                                        -0.2
                                                          -1
                                                                                                                                        -0.3

                                                                                                                                        -0.4
                                                         -1.5
                                                                                                                                                    Estimate
                                                                                                                                        -0.5        GMM Standard Errors
                                                                                                                                                    CC Standard Errors
                                                          -2                                                                            -0.6
                                                                0.1%     0.5% 1%            5% 10%                                               0.1%       0.5% 1%            5% 10%
                                                                         Log Exporter Firm Share                                                            Log Exporter Firm Share


Note. Estimates obtained with GMM estimator in (33) in the 2012 sample of 1,522 origin-destination pairs described in
Table OA.1 of Appendix B.1. Estimates obtained with a cubic spline over three intervals (K = 3) for a single group (G = 1).
Calibration of ~ = 2.9. Thick lines are the point estimates and thin lines are the 95% confidence intervals computed with robust
standard errors for (n) and (n) . CC Standard Errors obtained using the bootstrapped procedure in Chen and Christensen
(2018).



B.4.2               Alternative Sample Years
Our baseline estimates use the sample of country pairs for 2012. Our data has a similar country coverage for
all years between 2010 and 2014. We thus estimate the model with alternative samples for 2010 and 2014.
Figures OA.2 and OA.3 show that results are broadly consistent with the baseline estimates obtained from
the sample for 2012.

                       Figure OA.2: Semiparametric Gravity of Firm Exports ­ 2010 Sample

                                                                                                                                                                            12
            0                                                                               0.1

                                                                                              0                                                                             10

          -0.5                                                                                                                                                                                            2012 Semiparametric
                                                                                   ln (n)
 ln (n)




                                                                                            -0.1
                                                                                                                                                                            8                             2010 Semiparametric

                                                                                            -0.2
                                                                                   (n ) /
 (n ) /




                                                                                                                                                                       ij




           -1                                                                                                                                                               6
                                                                                            -0.3
 ln




                                                                                   ln




                 2012 Semiparametric                                                                                                                                        4
                 2010 Semiparametric                                                        -0.4
          -1.5

                                                                                            -0.5                                                                            2
                                                                                                                                               2012 Semiparametric
                                                                                                                                               2010 Semiparametric
           -2                                                                               -0.6                                                                            0
                    0.1%     0.5%1%                             5% 10%   50%100%                        0.1%    0.5%1%                           5% 10%      50%100%             0.1%      0.5% 1%         5% 10%       50% 100%
                        Log Exporter Firm Share                                                            Log Exporter Firm Share                                                         Log Exporter Firm Share

                 (a) Elasticity of (n)                                                             (b) Elasticity of  (n)                                                               (c) Implied  (n)
Note. Estimates obtained with GMM estimator in (33). Estimates obtained with a cubic spline over three intervals (K = 3)
for a single group (G = 1). Calibration of ~ = 2.9. Thick lines are the point estimates and thin lines are the 95% confidence
intervals computed with robust standard errors for (n) and (n) and 1,000 bootstrap draws for (n).




                                                                                                           OA - 17
                       Figure OA.3: Semiparametric Gravity of Firm Exports ­ 2014 Sample

                                                                                                                                        12
            0                                                              0.1

                                                                             0                                                          10

          -0.5                                                             -0.1                                                                                       2012 Semiparametric




                                                                  ln (n)
 ln (n)




                                                                                                                                        8                             2014 Semiparametric
                                                                           -0.2




                                                                  (n ) /
 (n ) /




                                                                                                                                   ij
           -1                                                              -0.3                                                         6

                                                                           -0.4
 ln




                                                                  ln
                 2012 Semiparametric                                                                                                    4
          -1.5   2014 Semiparametric                                       -0.5
                                                                                                                                        2
                                                                           -0.6                          2012 Semiparametric
                                                                                                         2014 Semiparametric
           -2                                                              -0.7                                                         0
                    0.1%     0.5%1%        5% 10%       50%100%                      0.1%     0.5%1%        5% 10%       50%100%             0.1%      0.5% 1%         5% 10%        50% 100%
                        Log Exporter Firm Share                                         Log Exporter Firm Share                                        Log Exporter Firm Share

                 (a) Elasticity of (n)                                            (b) Elasticity of  (n)                                            (c) Implied  (n)
Note. Estimates obtained with GMM estimator in (33). Estimates obtained with a cubic spline over three intervals (K = 3)
for a single group (G = 1). Calibration of ~ = 2.9. Thick lines are the point estimates and thin lines are the 95% confidence
intervals computed with robust standard errors for (n) and (n) and 100 bootstrap draws for (n).



B.4.3               Baseline Sample Excluding Domestic Trade Observations
Our main estimation combines data on international trade with domestic sales. This requires not only nij
and zij for i = j , but also nii and zii . Importantly, domestic sales are a high fraction of observations in the
top knot where the trade elasticity is lower. To access whether these estimates depend on domestic sales, we
re-run our estimation procedure in an alternative sample without domestic trade observations. Figure OA.4
shows that this has only a small impact on our baseline estimates of the trade elasticity function.

Figure OA.4: Semiparametric Gravity of Firm Exports ­ Sample excluding domestic trade
observations

                                                                                                                                        12
            0                                                              0.4
                                                                                                                                                2012 Semiparametric
                      2012 Semiparametric                                           2012 Semiparametric
                      2012 Semiparametric - No Internal Trade                       2012 Semiparametric - No Internal Trade                     2012 Semiparametric - No Internal Trade
                                                                           0.2                                                          10
          -0.5
                                                                  ln (n)
 ln (n)




                                                                             0
                                                                                                                                        8
           -1
                                                                           -0.2
                                                                  (n ) /
 (n ) /




                                                                                                                                   ij




                                                                                                                                        6
                                                                           -0.4
          -1.5
 ln




                                                                  ln




                                                                                                                                        4
                                                                           -0.6
           -2
                                                                           -0.8                                                         2


          -2.5                                                              -1                                                          0
                    0.1%     0.5%1%        5% 10%       50%100%                      0.1%     0.5%1%        5% 10%       50%100%             0.1%      0.5% 1%         5% 10%        50% 100%
                        Log Exporter Firm Share                                         Log Exporter Firm Share                                        Log Exporter Firm Share

                 (a) Elasticity of (n)                                            (b) Elasticity of  (n)                                            (c) Implied  (n)
Note. Estimates obtained with GMM estimator in (33). Estimates obtained with a cubic spline over three intervals (K = 3)
for a single group (G = 1). Calibration of ~ = 2.9. Thick lines are the point estimates and thin lines are the 95% confidence
intervals computed with robust standard errors for (n) and (n) and 100 bootstrap draws for (n).



B.4.4               Alternative Measures of the Number of Entrants
In our data construction, we measure the share of successful entrants using one-year survival rates for
manufacturing firms. This accounts for the fact that not all entrant firms are successful in entry and may
leave the market (in the spirit of Melitz (2003)). We now conduct four robustness checks with respect to the
construction of nii . We first exclude all countries with imputed values of nii from our baseline sample. We

                                                                                        OA - 18
also re-estimate the elasticity functions under the alternative assumptions that nii is either one (survival rate
of 100%), the 2-year firm survival rate, or the 3-year firm survival rate.


Alternative sample excluding origin countries with imputed survival rate. In Figure OA.5, we
replicate our baseline estimation in a sample that excludes all observations for origin countries with imputed
values of the one-year survival rate. Results are roughly similar to our baseline estimates.

Figure OA.5: Semiparametric Gravity of Firm Exports ­ Sample excluding countries with
imputed survival rates

                                                                                                                                            12
            0                                                                0.4
                 2012 Semiparametric                                                2012 Semiparametric
                 2012 Semiparametric - No Imputed Survival Rates                    2012 Semiparametric - No Imputed Survival Rates         10
                                                                             0.2
          -0.5
                                                                    ln (n)
 ln (n)




                                                                                                                                            8
                                                                               0
                                                                    (n ) /
 (n ) /




                                                                                                                                       ij
           -1                                                                                                                               6

                                                                             -0.2
 ln




                                                                    ln




                                                                                                                                            4
          -1.5
                                                                             -0.4
                                                                                                                                            2
                                                                                                                                                 2012 Semiparametric
                                                                                                                                                 2012 Semiparametric - No Imputed Survival Rates
           -2                                                                -0.6                                                           0
                      0.1%     0.5%1%        5% 10%       50%100%                        0.1%     0.5%1%        5% 10%       50%100%              0.1%      0.5% 1%         5% 10%       50% 100%
                          Log Exporter Firm Share                                            Log Exporter Firm Share                                        Log Exporter Firm Share

                 (a) Elasticity of (n)                                              (b) Elasticity of  (n)                                               (c) Implied  (n)
Note. Estimates obtained with GMM estimator in (33). Estimates obtained with a cubic spline over three intervals (K = 3)
for a single group (G = 1). Calibration of ~ = 2.9. Thick lines are the point estimates and thin lines are the 95% confidence
intervals computed with robust standard errors for (n) and (n) and 100 bootstrap draws for (n).



Alternative sample with nii measured with survival rates over different horizons. We now
investigate how our baseline estimates change when we measure nii using 2-year and 3-year survival rates in
manufacturing. Figures OA.6 and OA.7 show that the estimated elasticity functions are almost identical in
both cases.

Figure OA.6: Semiparametric Gravity of Firm Exports ­ nii is two-year survival rate in
manufacturing

                                                                                                                                            12
            0                                                                0.1
                                                                                                                                                   2012 Semiparametric
                    2012 Semiparametric
                    2012 Semiparametric - 2-Year Survival Rates                                                                                    2012 Semiparametric - 2-Year Survival Rates
                                                                               0                                                            10

          -0.5
                                                                    ln (n)
 ln (n)




                                                                             -0.1
                                                                                                                                            8

                                                                             -0.2
                                                                    (n ) /
 (n ) /




                                                                                                                                       ij




           -1                                                                                                                               6
                                                                             -0.3
 ln




                                                                    ln




                                                                                                                                            4
                                                                             -0.4
          -1.5

                                                                             -0.5                                                           2
                                                                                       2012 Semiparametric
                                                                                       2012 Semiparametric - 2-Year Survival Rates
           -2                                                                -0.6                                                           0
                      0.1%     0.5%1%        5% 10%       50%100%                        0.1%     0.5%1%        5% 10%       50%100%              0.1%      0.5% 1%         5% 10%       50% 100%
                          Log Exporter Firm Share                                            Log Exporter Firm Share                                        Log Exporter Firm Share

                 (a) Elasticity of (n)                                              (b) Elasticity of  (n)                                               (c) Implied  (n)
Note. Estimates obtained with GMM estimator in (33). Estimates obtained with a cubic spline over three intervals (K = 3)
for a single group (G = 1). Calibration of ~ = 2.9. Thick lines are the point estimates and thin lines are the 95% confidence
intervals computed with robust standard errors for (n) and (n) and 100 bootstrap draws for (n).




                                                                                             OA - 19
Figure OA.7: Semiparametric Gravity of Firm Exports ­ nii is three-year survival rate in
manufacturing

                                                                                                                                        12
            0                                                              0.1
                                                                                                                                              2012 Semiparametric
                  2012 Semiparametric
                  2012 Semiparametric - 3-Year Survival Rates                                                                                 2012 Semiparametric - 2-Year Survival Rates
                                                                             0                                                          10

          -0.5




                                                                  ln (n)
 ln (n)




                                                                           -0.1
                                                                                                                                        8

                                                                           -0.2




                                                                  (n ) /
 (n ) /




                                                                                                                                   ij
           -1                                                                                                                           6
                                                                           -0.3
 ln




                                                                  ln
                                                                                                                                        4
                                                                           -0.4
          -1.5

                                                                           -0.5                                                         2
                                                                                   2012 Semiparametric
                                                                                   2012 Semiparametric - 3-Year Survival Rates
           -2                                                              -0.6                                                         0
                     0.1%     0.5%1%       5% 10%       50%100%                      0.1%     0.5%1%        5% 10%       50%100%             0.1%      0.5% 1%         5% 10%       50% 100%
                        Log Exporter Firm Share                                         Log Exporter Firm Share                                        Log Exporter Firm Share

                 (a) Elasticity of (n)                                            (b) Elasticity of  (n)                                            (c) Implied  (n)
Note. Estimates obtained with GMM estimator in (33). Estimates obtained with a cubic spline over three intervals (K = 3)
for a single group (G = 1). Calibration of ~ = 2.9. Thick lines are the point estimates and thin lines are the 95% confidence
intervals computed with robust standard errors for (n) and (n) and 100 bootstrap draws for (n).



Alternative sample with nii = 1 (survival rate of 100%). In Figure OA.8, we replicate our baseline
estimates under the assumption that all entrants produce for the domestic market (i.e., f     ¯ii = 0 and nii = 1).
Panel (a) shows that the estimates of (n) are robust to imposing nii = 1. Panel (b) indicates that point
estimates for the elasticity of (n) are slightly increasing, but are not statistically different from our baseline
estimates. The lower elasticity of (n) yields estimates of the trade elasticity that are close to 10 in the
bottom knot.

                             Figure OA.8: Semiparametric Gravity of Firm Exports ­ nii = 1

            0                                                              0.2                                                          14

                                                                           0.1
                                                                                                                                        12
          -0.5                                                               0
                                                                  ln (n)
 ln (n)




                                                                                                                                        10
                                                                           -0.1
                                                                                                                                        8
                                                                  (n ) /
 (n ) /




                                                                                                                                   ij




           -1                                                              -0.2
                                                                                                                                        6
                                                                           -0.3
 ln




                                                                  ln




          -1.5                                                             -0.4                                                         4

                 2012 Semiparametric                                       -0.5     2012 Semiparametric                                 2     2012 Semiparametric
                 2012 Semiparametric - 100% Survival Rates                          2012 Semiparametric - 100% Survival Rates                 2012 Semiparametric - 100% Survival Rates
           -2                                                              -0.6                                                         0
                     0.1%     0.5%1%       5% 10%       50%100%                      0.1%     0.5%1%        5% 10%       50%100%             0.1%      0.5% 1%         5% 10%       50% 100%
                        Log Exporter Firm Share                                         Log Exporter Firm Share                                        Log Exporter Firm Share

                 (a) Elasticity of (n)                                            (b) Elasticity of  (n)                                            (c) Implied  (n)
Note. Estimates obtained with GMM estimator in (33). Estimates obtained with a cubic spline over three intervals (K = 3)
for a single group (G = 1). Calibration of ~ = 2.9. Thick lines are the point estimates and thin lines are the 95% confidence
intervals computed with robust standard errors for (n) and (n) and 100 bootstrap draws for (n).



B.4.5               Alternative Calibrations of the Elasticity of Substitution
In our baseline specification, we follow Hottman et al. (2016) to specify  = 3.9. In Figure OA.9, we
investigate how our our estimates depend on the value of  . In particular, we implement our estimator for a
higher elasticity of  = 5. Our estimates for (n) are broadly similar, with a small upward level shift. Out
estimates for  (n) are slightly lower, but still close to the baseline of -0.2. Panel (c) shows that the implied
 (n) are nearly identical, with similar point estimates and confidence intervals.

                                                                                         OA - 20
                        Figure OA.9: Semiparametric Gravity of Firm Exports ­ Alternative values of 

                                                                                                                                                              12
                    0                                                                   0.4
                                                                                                          = 3.9 (Baseline)
                                                                                        0.2               =5                                                  10
          -0.5
                                                                                                                                                                                                    = 3.9 (Baseline)




                                                                               ln (n)
 ln (n)




                                                                                               0
                                                                                                                                                              8                                     =5
               -1
                                                                                        -0.2




                                                                               (n ) /
 (n ) /




                                                                                                                                                         ij
                                                                                                                                                              6
                                                                                        -0.4
          -1.5
 ln




                                                                               ln
                                = 3.9 (Baseline)                                                                                                              4
                                =5                                                      -0.6
               -2
                                                                                        -0.8                                                                  2


          -2.5                                                                            -1                                                                  0
                                0.1%          0.5%1%    5% 10%    50%100%                                 0.1%          0.5%1%    5% 10%    50%100%                0.1%       0.5% 1%         5% 10%            50% 100%
                                    Log Exporter Firm Share                                                   Log Exporter Firm Share                                         Log Exporter Firm Share

                         (a) Elasticity of (n)                                                     (b) Elasticity of  (n)                                                 (c) Implied  (n)
Note. Estimates obtained with GMM estimator in (33). Estimates obtained with a cubic spline over three intervals (K = 3)
for a single group (G = 1). Baseline calibration of   ~ =  - 1 = 2.9 and and alternative calibration of ~ =  - 1 = 4. Thick
lines are the point estimates and thin lines are the 95% confidence intervals computed with robust standard errors for (n) and
(n) and 100 bootstrap draws for (n).




B.5                         Counterfactual Analysis: Additional Results
B.5.1                           Gains From Trade: Comparison to the Literature
In Figure OA.10, we compare the baseline estimates in Figure 3 to calibrated elasticity functions obtained
from estimates in literature of parametric distributions of firm fundamentals.

                        Figure OA.10: Baseline Estimates and Parametric Distributions in the Literature

               0                                                                          0                                                                    8

                                                                                                                                                                                                    Pareto
                                                                                                                                                               7
                                                                                                                                                                                                    Truncated Pareto
             -0.5                                                                                                                                                                                   Log Normal
                                                                                        -0.5
                                                                                                                                                                                                    Constant Elasticity
                                                                               ln (n)
 ln (n)




                                                                                                                                                               6                                    Semiparametric
              -1

                                                                                         -1
                                                                                                                                                               5
                                                                               (n ) /
 ln (n ) /




                                                                                                                                                         ij




             -1.5

                                                                                                                                                               4
                                                                                        -1.5
                                                                               ln




              -2

                          Pareto                                                                    Pareto                                                     3

                          Truncated Pareto                                               -2
                                                                                                    Truncated Pareto
             -2.5         Log Normal                                                                Log Normal                                                 2
                          Constant Elasticity                                                       Constant Elasticity
                          Semiparametric                                                            Semiparametric
              -3                                                                        -2.5                                                                   1
                         0.1%          0.5%    1%      5%   10%   50%   100%                       0.1%          0.5%    1%      5%   10%   50%   100%             0.1%       0.5%   1%        5%    10%         50%      100%

                                  Log Exporter Firm Share                                                   Log Exporter Firm Share                                        Log Exporter Firm Share

                         (a) Elasticity of (n)                                                     (b) Elasticity of  (n)                                                 (c) Implied  (n)
Note. Pareto is the Melitz-Pareto model in Chaney (2008) with a trade elasticity of four. Truncated Pareto uses the productivity
distribution in Melitz and Redding (2015). Log-normal uses the baseline estimate of the productivity distribution in Head et
al. (2014). Constant elasticity and semiparametric specifications correspond to the baseline estimates in Section 5.4.


    We compute the ratio between the gains from trade implied by our semiparametric gravity specification
and the gains implied by specifications based on the assumption that firm productivity has either the
Truncated Pareto distribution in Melitz and Redding (2015) or the Log-normal distribution in Bas et al.
(2017). We use the parameter estimates reported on these papers. Figure OA.11 presents the cross-country
relationship between these ratios and initial trade outcomes.




                                                                                                              OA - 21
   Figure OA.11: Importance of Functional Form Assumptions for the Gains from Trade
                                                                1


                                                                                                                 NOR

                                                               0.9                                        DEU                             CHN
                                                                       IDNKORRUS                             ITA            NLD




                                   Relative Gains From Trade
                                                                          TWN ESP CZE
                                                                          JPN           CHE                    SWE
                                                                                                                AUT   BEL    DNK
                                                                       AUS              FRA
                                                                                        IRL
                                                                                         SVNFIN
                                                                   MEX        POLLTU GBREST                    SVK
                                                                               PRT
                                                                               CAN  LVA
                                                                                   USA
                                                               0.8        HUN
                                                                        IND
                                                                        ROU MLT
                                                                           HRV
                                                                           BGR
                                                                                                                                                       LUX
                                                                           TUR                                    NOR
                                                                           GRC                            DEU           NLD               CHN
                                                                                                             ITAAUT BEL
                                                                                                               SWE        DNK
                                                                           CYP
                                                                         BRA                 CZE
                                                                                               SVN
                                                                                              CHE FIN
                                                               0.7                     ESP
                                                                                       LTULVA
                                                                                           GBRIRL
                                                                                              FRA
                                                                                                EST            SVK                                     LUX
                                                                                TWN
                                                                                 KOR
                                                                                JPN  CAN
                                                                                     PRT USA
                                                                                      RUS
                                                                                    POL
                                                                                  MLT
                                                                             IDNBGR
                                                                                 HRV
                                                                             AUSHUN
                                                                              IND
                                                                         MEX  ROU
                                                                            GRC
                                                                            TUR
                                                               0.6          CYP


                                                                         BRA

                                                               0.5

                                                                                              Semiparametric/Truncated Pareto
                                                                                              Semiparametric/Log Normal
                                                               0.4
                                                                     0         0.01   0.02    0.03      0.04   0.05     0.06       0.07         0.08     0.09   0.1
                                                                                             Average Exporter Firm Share
Note. Gains from Trade is the percentage change in the real wage implied by moving from autarky to the observed equilibrium in
2012. For each specification, gains from trade are computed with the formula in Section 3.3 for n          ^i solving the system
                                                                                                  ^ ii and N
in Appendix A.6. Gains for semiparametric specification computed with the semiparametric estimates in Figure 3. Gains
for Truncated Pareto specification computed with elasticity functions implied by the productivity distribution in Melitz and
Redding (2015). Gains for Log-normal specification computed with elasticity functions implied by the productivity distribution
in Head et al. (2014). Vertical axis is the ratio between the gains from trade implied by our baseline semiparametric estimates
and those obtained with each parametric assumption.


     The diamond-shaped dots in Figure OA.11 show that the Truncated Pareto specification leads to much
higher gains from trade for all countries when compared to those implied by our baseline estimates. This
is a direct consequence of the low trade elasticities implied by the parametrization in Melitz and Redding
(2015) ­ see Figure OA.10. The square-shaped dots in Figure OA.11 show that the gains from trade are also
lower for the Log-normal specification. Again, this follows from the average trade elasticity implied by the
productivity distribution in Bas et al. (2017). Figure OA.10 shows that the implied trade elasticity in the
log-normal case is slightly lower than our baseline estimate for all values of the exporter firm share.


B.5.2       The Welfare Impact of Observed Changes in Trade Costs: Additional
            Results
This section complements the quantitative results in Section 6.2 regarding the welfare impact of changes in
trade costs among members of the European single market.


Summary statistics: changes in observed variables. Figure OA.12 depicts the change in the outcomes
used in the inversion of changes in economic fundamentals for each origin country. Panel (a) shows that
countries experienced vary different changes in their wage relative to the U.S. wage. We observe strong
wage gains in Eastern Europe, which are 50% higher than U.S. wage gains for several countries. For western
countries, wage gains are often small, with relative wages falling by 0.8% in Italy, 2.0% in the UK, and 10.2%
in Greece. These wage patterns contribute to the weak growth in relative revenue shifters that we observe in
                                                                                                            ^t
West Europe. Panel (b) reports the price index changes used to measure the domestic revenue shifters, r     ¯jj .
Relative to U.S. wage growth, the price index fell slightly in West Europe, but increased in East Europe.
    Panels (c)­(e) illustrate the changes in export outcomes for each origin country. For most countries, we
observe strong overall growth in total exports (panel (c)), firm average exports (panel (d)), and firm export
shares (panel (e)). Again, export growth was substantially stronger in East Europe than in West Europe.

                                                                                                     OA - 22
The different scales in panels (d) and (e) indicate that the growth in firm average exports was stronger than
the growth in firm export shares. In our model, this fact is an important force contributing to the observed
rises of both inverted fixed export costs and inverted revenue shifters ­ see the expressions in (36) and the
companion discussion.

                 Figure OA.12: Change in Outcomes by Origin Country, 2003-2012
                                   (a) Wage, w
                                             ^i                                           ^i
                                                                         (b) Price index, P
                                                       (1.75,2]                                    (1.1,1.5]
                                                       (1.5,1.75]                                  (1.05,1.1]
                                                       (1.25,1.5]                                  (1,1.05]
                                                       (1.05,1.25]                                 (.95,1]
                                                       (1,1.05]                                    (.85,.95]
                                                       [.75,1]                                     [.8,.85]
                                                       No data                                     No data




                            ^ ij
       (c) Average exports, X                                             ^
                                                (d) Average firm exports, x
                                                                          ¯ij                                         ^
                                                                                                                      ¯ ij
                                                                                         (e) Average firm entry share n
                                  (5,10]                                     (2.5,6]                                      (2,2.5]
                                  (3,5]                                      (2,2.5]                                      (1.4,2]
                                  (2,3]                                      (1.5,2]                                      (1.2,1.4]
                                  (1.75,2]                                   (1.4,1.5]                                    (1.1,1.2]
                                  (1.5,1.75]                                 (1.3,1.4]                                    (1,1.1]
                                  (1.25,1.5]                                 (1.2,1.3]                                    (.9,1]
                                  [1,1.25]                                   [0,1.2]                                      [0,.9]
                                  No data                                    No data                                      No data




Note: Each panel reports the origin's outcome in 2012 divided by the origin's outcome in 2003. For bilateral variables in panels
(c)-(e), we report the simple average of the ratio across all other destination countries j in the European single market (with
i = j ).



Comparison to the literature: alternative measures of trade cost shocks. We now compare the
welfare impact of shocks in bilateral trade costs measured with different methodologies. Figure OA.15 reports
the changes in real wages implied by three different approaches to measure trade cost shocks. In panel (a),
we use the baseline changes in bilateral trade costs, (¯ij )1- = r
                                                       ^         ^    ^
                                                                 ¯ij /r
                                                                      ¯ii , implied by Proposition 3. In panel (b),
we measure the changes in trade costs using observed tariff changes between countries ­ in our application,
we consider tariff changes caused by the EU enlargement, as in Caliendo et al. (2017). Finally, in panel (c),
we measure trade cost shocks using a non-parametric extension of the approach in Head and Ries (2001) that
imposes symmetry of trade cost shocks. Specifically, by assuming that (       ¯ij )1- = (
                                                                              ^          ¯ji )1- , we set trade cost
                                                                                         ^
shocks to
                                                                                                                1/2
                                                                                                       -1
                                      ^ij x
                                      x
                                      ¯   ^
                                          ¯ji    ij (nij ) ji (nji )   ij (nij n
                                                                               ^ ij ) ji (nji n
                                                                                              ^ ji )
         (¯ij )1- = (
          ^          ¯ji )1- =
                     ^                                                                                                ,   (OA.56)
                                      ^
                                      x   ^
                                          ¯jj
                                      ¯ii x      ii (nii ) jj (njj )   ii (nii n              ^ jj )
                                                                               ^ ii ) jj (njj n

                                                            OA - 23
as implied by the semiparametric equation of firm average exports in (14).
    Figures OA.13 and OA.14 compare the shocks measured with the different approaches. Panel (a) shows
great cross-country dispersion in our baseline inverted trade shocks ­ the standard deviation across origins
of the average log-change was 1.04. In Panel (b), tariff changes created much smaller changes in bilateral
revenue shifters that were on average positive for all origin countries ­ the average log-change was 0.075,
with a standard deviation of 0.11. Figure OA.14 indicates that tariff changes and our inverted shocks have
a correlation close to zero. Finally, panel (c) shows the average revenue shifters implied by the symmetric
shocks measured with (OA.56). Because it is ``approximately'' a bilateral average of our inverted trade
shocks, expression (OA.56) yields smaller increases (declines) in bilateral revenue shifters for East (West)
Europe. Figure OA.14 shows that, despite this attenuation bias, the two measures are positively correlated ­
their correlation is 0.56.
    Figure OA.15 reports the welfare changes implied by the three alternative ways of measuring trade cost
shocks. The comparison between panels (a) and (b) indicates that the welfare impact of the tariff changes is
much smaller than that of our inverted trade cost shocks. The average effect is 0.7% in panel (a), but only
0.3% in panel (b). This follows from the fact that tariff changes are much smaller and more homogeneous
than the inverted changes in trade costs. Lastly, when we use the symmetric trade cost shocks in panel (c),
we get smaller welfare losses in West Europe and smaller welfare gains in East Europe. This attenuation of
trade cost shocks is a natural implication by the symmetry assumptions (as discussed above).

Figure OA.13: Average Change in Bilateral Revenue Shifters in The European Single Market,
2003-2012 ­ Alternative Approaches to Measure Shocks
                        ^
          (a) Baseline, r    ^
                             ¯ii
                        ¯ij /r                  (b) Tariff change, (1+tariffij )1- (c) Head-Ries, (¯ij )1- = (
                                                                                                   ^          ¯ji )1-
                                                                                                              ^
                                    (2,15]                                      (2,15]                                      (2,15]
                                    (1.6,2]                                     (1.6,2]                                     (1.6,2]
                                    (1.2,1.6]                                   (1.2,1.6]                                   (1.2,1.6]
                                    (1,1.2]                                     (1,1.2]                                     (1,1.2]
                                    (.85,1]                                     (.85,1]                                     (.85,1]
                                    (.75,.85]                                   (.75,.85]                                   (.75,.85]
                                    (.6,.75]                                    (.6,.75]                                    (.6,.75]
                                    (.5,.6]                                     (.5,.6]                                     (.5,.6]
                                    [0,.5]                                      [0,.5]                                      [0,.5]




Note: Changes in variable trade costs recovered from changes in outcomes between 2003 and 2012. For each origin country i,
we report the simple average of the change in bilateral revenue shifter across all other destination countries j in the European
single market (with i = j ). In Panel (a), we set (       ¯ij )1- = r
                                                          ^          ^    ^
                                                                     ¯ij /r                  ^
                                                                          ¯ii for i = j with r
                                                                                             ¯ij computed using Proposition 3. In Panel
(b), we set ( ^
              ¯ij ) 1 -  = (1+tariffij )1 -    to be the change in tariffs between EU members, as in Caliendo et al. (2017). In Panel
(c), for i = j , we use (  ¯ij )1- = (
                           ^             ¯ji )1- given by the generalization of the approach in Head and Ries (2001) in expression
                                         ^
(OA.56).




                                                             OA - 24
Figure OA.14: Bin Scatter Plot - Comparison of Changes in Bilateral Revenue Shifters
Implied by Different Approaches

                                                 3
                                                                                                           ln rij Change - Symmetric Shocks
                                                                                                           ln rij Change - Tariffs
                                                                                                           45-degree line
                                                 2




                              Comparison Shock
                                                 1




                                                 0




                                                 -1




                                                 -2
                                                       -2           -1          0                 1                       2                   3
                                                                            ln rij/rii Change - Baseline


Note: Changes in variable trade costs recovered from changes in outcomes between 2003 and 2012. The horizontal axis is the
baseline shock (¯ij )1- = r
                ^          ^    ^
                           ¯ij /r        ^
                                ¯ii with r
                                         ¯ij computed using Proposition 3. The vertical axis is the change in bilateral revenue
shifter implied by an alternative approach. For tariff change, we set ( ¯ij )1- = (1+tariffij )1- to be the change in tariffs
                                                                        ^
between EU members, as in Caliendo et al. (2017). For symmetric shock, we use ( ¯ij )1- = (
                                                                                ^           ¯ji )1- given by the generalization
                                                                                            ^
of the approach in Head and Ries (2001) in expression (OA.56).




Figure OA.15: The Welfare Impact of Changing Bilateral Variable Trade Costs in The
European Single Market, 2003-2012 ­ Alternative Approaches to Measure Shocks
                        ^
          (a) Baseline, r    ^
                             ¯ii
                        ¯ij /r                                   (b) Tariff change, (1+tariffij )1- (c) Head-Ries, (¯ij )1- = (
                                                                                                                    ^          ¯ji )1-
                                                                                                                               ^
                                                      >4                                                    >4                                    >4
                                                      2-4                                                   2-4                                   2-4
                                                      1-2                                                   1-2                                   1-2
                                                      .75 - 1                                               .75 - 1                               .75 - 1
                                                      .5 - .75                                              .5 - .75                              .5 - .75
                                                      .25 - .5                                              .25 - .5                              .25 - .5
                                                      .1 - .25                                              .1 - .25                              .1 - .25
                                                      0 - .1                                                0 - .1                                0 - .1
                                                      <0                                                    <0                                    <0
                                                      No data                                               No data                               No data




Note: Real wage changes caused by changes in bilateral trade shifters between 2003 and 2012 among 30 countries in the
European single market. In Panel (a), we set (   ¯ij )1- = r
                                                 ^         ^    ^
                                                           ¯ij /r                  ^
                                                                ¯ii for i = j with r
                                                                                   ¯ij computed using Proposition 3. In Panel
(b), we set ^
            ¯ij to be the change in tariffs between EU members, as in Caliendo et al. (2017). In Panel (c), for i = j , we use
(¯ij )1- = (
 ^            ¯ji )1- given by the generalization of the approach in Head and Ries (2001) in expression (OA.56). For each
              ^
shock, we report minus the real wage change obtained with the baseline semiparametric estimates in Figure 3.




                                                                             OA - 25
