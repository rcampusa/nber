                                NBER WORKING PAPER SERIES




                          IDENTIFICATION IN MATCHING GAMES

                                           Jeremy T. Fox

                                        Working Paper 15092
                                http://www.nber.org/papers/w15092


                      NATIONAL BUREAU OF ECONOMIC RESEARCH
                               1050 Massachusetts Avenue
                                 Cambridge, MA 02138
                                      June 2009




Previous versions of these theorems circulated as part of the paper “Estimating Matching Games with
Transfers”, which now focuses only on estimation, not identification. I thank the National Science
Foundation, the NET Institute, the Olin Foundation, and the Stigler Center for generous funding. Email:
fox@uchicago.edu. The views expressed herein are those of the author(s) and do not necessarily reflect
the views of the National Bureau of Economic Research.

NBER working papers are circulated for discussion and comment purposes. They have not been peer-
reviewed or been subject to the review by the NBER Board of Directors that accompanies official
NBER publications.

© 2009 by Jeremy T. Fox. All rights reserved. Short sections of text, not to exceed two paragraphs,
may be quoted without explicit permission provided that full credit, including © notice, is given to
the source.
Identification in Matching Games
Jeremy T. Fox
NBER Working Paper No. 15092
June 2009
JEL No. C14,C3,C35,C71,D4,L22

                                               ABSTRACT

I study a many-to-many, two-sided, transferable-utility matching game. Consider data on matches
or relationships between agents but not on the choice set of each agent. I investigate what economic
parameters can be learned from data on equilibrium matches and agent characteristics. Features of
a production function, which gives the surplus from a match, are nonparametrically identified. In particular,
the ratios of complementarities from multiple pairs of inputs are identified. Also, the ordering of production
levels is identified.


Jeremy T. Fox
Department of Economics
University of Chicago
1126 East 59th Street
Chicago, IL 60637
and NBER
fox@uchicago.edu
1    Introduction
Matching games are a new and important area of empirical interest. Consider the classic example of marriage.
A researcher may have data on a set of marriages in each of a set of independent matching markets, say a set of
towns. The researcher observes characteristics of each man and each woman in each town, as well as the sets
of marriages that occurred. The researcher observes equilibrium outcomes, here marriages, and not choice sets,
so identification in this type of model will not be able to rely trivially on the analysis of single-agent demand
models. What type of parameters can be identified from these data?
  Economists have studied nonparametric or semiparametric identification in auction games of private infor-
mation (Elyakime, Laffont, Loisel and Vuong, 1994) as well as discrete games of complete information (Berry
and Tamer, 2006) and incomplete information (Bajari, Chernozhukov, Hong and Nekipelov, 2009). This previ-
ous literature is unified in using noncooperative Nash equilibrium as the solution concept. Matching games are
cooperative games and use pairwise stability instead of Nash equilibrium as the main solution concept. This is
the first paper to study identification in a new and empirically important class of games.
    I follow the classic works of Koopmans and Beckmann (1957), Shapley and Shubik (1972), and Becker
(1973) and model the formation of matches (say marriages) as the outcome to a competitive market. Agents
have preferences over partners and agents can exchange monetary transfers with their spouse. The equilibrium
concept is pairwise stability: in part, at an outcome to a marriage market, no man would prefer to pay the
transfer required to be able to marry any woman other than his actual wife in the proposed equilibrium. I
assume the researcher does not have access to data on the transfers. For marriage, transfers are a modeling
abstraction. For interfirm relationships, transfers may be private contractual details. Therefore, this paper
studies point identification under partial observability of the outcome variables in the model.
    Match data come from the outcome to a market, which intermingles the preferences of all participating
agents and finds an equilibrium. An agent may not match with its most preferred partner because that partner
is taken. Because agents on the same side of the market are rivals to match with potential partners, the failure
for a match to form does not mean that the match gives low production. Given this rivalry for partners, it
is not obvious what types of economic parameters are identified from having equilibrium outcome data from
matching markets. Identification asks the question of just what economic parameters can be learned from data
on who matches with whom? A production function gives the total output of a match. I prove that aspects
of match production functions can be identified in a transferable-utility setting using data on only equilibrium
matches. Identification relies on inequalities implied by the equilibrium concept, pairwise stability.
    I first study what I label derivative-based identification, as the features of production functions one can learn
about may involve derivatives. Derivative-based identification using qualitative match data arises because cer-
tain derivatives of match production functions govern sorting patterns in transferable-utility matching games.
For example, a cross-partial derivative of the production function represents the importance of complementari-
ties between a pair of characteristics, each from a different agent. Becker (1973) shows that complementarities
result in assortative matching. I extend the results of Becker in several dimensions. For example, I show how
to identify the ratio of complementarities in two pairs of agent-specific characteristics in a match production
function, say the relative importance of wealth and schooling. This allows a researcher to measure the relative
importance of complementarities on different pairs of characteristics. This is equivalent to a multivariate (mul-
tiple pairs of characteristics) analysis, while Becker’s analytical characterization of the sorting pattern requires
that each agent is distinguished by only a single characteristic.


                                                         1
   Second, I ask whether a researcher can identify the relative ordering of match production for different types
of matches. I learn whether match production is higher at one set of characteristics for the matched parties
than another set of characteristics. I extend identification results from the single-agent, multinomial choice
literature by Matzkin (1993). The extension is non-trivial because one cannot freely vary the choice set of a
single agent when using data that are the equilibria to matching games. In matching with transfers, one must
pay a potential partner to match with you, and the required payment involves the characteristics of rival agents.
I prove the identification of match production functions, up to a positive monotonic transformation, by varying
the exogenous distribution of the types of agents in a matching market.
   My identification arguments do not require data on objects that are not found in many datasets but are
important in matching models: the endogenous prices, the number of physical matches that an agent can make
(quotas), or continuous outcomes such as production levels, revenues and profits. Quotas are often a modeling
abstraction in many-to-many matching; not requiring data on such an abstraction is an advantage. Transfers,
production levels, revenues and profits are often not recorded at all (marriage) or not disclosed (interfirm
relationships).
   The identification arguments are for a fairly general class of matching games. I study many-to-many, two-
sided matching games. This means each potential agent may be involved in multiple matches with agents on
the other side of the market. This generality is essential to applications in industrial organization where, for
example, one supplier of goods may match to many retailers of those goods. I do not require a supplier’s
profit function to be additively separable across the characteristics of its multiple partners. I also prove separate
results for three different types of observable characteristics that may enter the payoff of a group of matches:
agent-specific characteristics, match-specific characteristics, and characteristics that vary for each group of
matches. Importantly, each agent, match or group of matches may have a vector of characteristics.
   In many-to-many matching games, I study the identification of production functions that can take as argu-
ments the characteristics of many partners at once. In many-to-many matching, pairwise stability is a weaker
solution concept than another solution concept, the core. One mathematical achievement of the paper is that all
identification results use only the restrictions from pairwise stability, which as its name indicates, allows only a
single pair of potential partners to consider deviating from the proposed equilibrium at once. This achievement
is important because the communication volume necessary to believe an equilibrium is in the core is large:
arbitrarily large groups of agents would need to coordinate their actions. Theorists are often comfortable spec-
ifying that a decentralized matching game’s outcome is pairwise stable, but assuming that the outcome is in the
core would be more controversial.
   The identification arguments are completely nonparametric: I do not impose that production functions and
the stochastic structure of the model are known up to a finite vector of parameters. The stochastic structure
of the model uses a rank order assumption that is inspired by the maximum-score literature on single-agent
multinomial choice (Manski, 1975; Matzkin, 1993; Fox, 2007). This maximum-score identification approach
allows me to work with inequalities that are derived from pairwise stability, rather than working with high-
dimensional integrals over match-specific unobservables. This allows me to focus on the matching-market
configurations that lead to identification. In the single-agent, multinomial-choice papers, a similar rank order
assumption is derived as a consequence of the payoff of each discrete choice having an i.i.d. unobservable
component. I discuss in some detail why an i.i.d. unobservable component to each match’s payoff does not
give the necessary rank order property in matching. I discuss alternative sufficient conditions. I also provide



                                                         2
simulation evidence about how much the rank order property is violated in models with i.i.d. unobservable
match-specific components.
    Another advantage of the maximum-score rank order assumption is that the identification arguments lead
to a computationally simple estimator. Matching markets can have hundreds or thousands of agents in them.
In Fox (2009), I present such a maximum-score estimator for matching games and show how it resolves two
curses of dimensionality in the number of agents in a matching market: a computational curse of dimensional-
ity from otherwise needing to compute or check equilibria and a data curse of dimensionality that might arise
from the need to nonparametrically estimate matching probabilities as a function of all agent characteristics in
a matching market. Simultaneously with this paper on identification, I have undertaken two empirical applica-
tions of the estimator. In Fox and Bajari (2009), we study matching between bidders and licenses for sale in
a FCC spectrum auction. In Fox (2009), I study matching between automotive parts suppliers and automotive
assemblers. In both cases, the datasets are fairly large and complementarities between multiple matches for the
same agent are essential aspects of the empirical investigation. Also, the various types of characteristics (agent,
match and group of matches) are all used in the empirical work. So the generality this paper strives for is used
in my empirical applications. More recently, Akkus and Hortacsu (2007), Levine (2008), Mindruta (2009), and
Yang, Shi and Goldfarb (2009) have conducted empirical work using the matching maximum-score estimator
in Fox (2009). The identification results here are directly relevant for the above empirical papers.
    No paper has performed a completely nonparametric analysis of any sort of matching game. Under many
non-nested assumptions with this paper, Choo and Siow (2006) provide a logit-based estimator for one-to-one
matching games using aggregate data. They identify surplus functions conditional on the parametric structure
of the logit model for the error terms. Dagsvik (2000) also uses the logit model. A literature has explored
parametric estimation in the non-nested Gale and Shapley (1962) matching games, i.e. games without en-
dogenous transfers (Boyd et al., 2003; Gordon and Knight, 2009; Sørensen, 2007). These papers do not study
identification.
    One advantage of studying one-to-one, two-sided matching games (such as marriage) is that a pairwise
stable match always exists and is unique with probability 1. Therefore, I present the intuition for the identifica-
tion strategies and results first for the example of marriage, in Section 2. Once the intuition for the results has
been presented, Section 3 introduces more general notation for many-to-many, two-sided matching games with
several types of observable characteristics. Section 4 presents sufficient conditions for the maximum-score-like
rank order property. These two sections mention existence and uniqueness issues that are not found in marriage
games. The last two sections present the main identification theorems. Section 5 discusses derivative-based
identification and Section 6 discusses the identification of orderings of production levels. The proofs of the
theorems are in the appendix.


2    One-to-one, two-sided matching games
This section presents informal results for the case of one-to-one, two-sided matching. One-to-one matching
was studied in Koopmans and Beckmann (1957), Shapley and Shubik (1972), and Becker (1973) and has been
summarized in Roth and Sotomayor (1990, Chapter 8). The results in this section focus on intuition because
there will be no formal definition of identification and hence no formal proofs. The formal details will be shown
for the many-to-many matching case in Sections 5 and 6.


                                                        3
2.1     Model setup
This section studies a market with two men, a and b, and two women, i and j. Each agent has two observable
characteristics: schooling and wealth. To simplify notation in this section, let agents be identified by their
characteristics. So in a duplication of notation, a = (a1 , a2 ), where the vector of man a’s characteristics is equal
to man a’s schooling a1 and wealth a2 . The same holds for man b and women i and j.
      Each person can be married only once, to a person of the opposite sex. A key object of interest in this
paper is the production from a match. If a marries i, they produce output f (a, i) = f ((a1 , a2 ) , (i1 , i2 )), which is a
function of the schooling of the man and woman and the wealth of both. Being single is allowed. If man a is
unmatched, write his output as f (a, 0), where we say he is matched to a dummy agent 0. The restriction to two
men and two women (or equal numbers of men and women) is for expositional convenience; the restriction
will not be present in the general results on many-to-many matching games.
      Becker (1973) shows that if each man and each woman has only one characteristic, say schooling but not
wealth, then, in a pairwise stable equilibrium, men and women will assortatively match if the schooling of men
and women are complements in production
                                                      ∂ 2 f (a, i)
                                                                   > 0.
                                                       ∂ a1 ∂ ii
Assortative matching means highly-schooled men match with highly-schooled women. Likewise, anti-assortative
matching occurs if schooling levels of men and women are substitutes in production. My setup is already more
general: each agent has a vector of characteristics a = (a1 , a2 ). Becker’s result does not apply to this case. No
previous matching theory paper provides an analytical characterization of the equilibrium sorting pattern using
simple production-function properties such as complementarities when agents have vectors of characteristics
and the exogenous distribution of agent characteristics is unrestricted. Numerical analysis is needed. One goal
of this paper is to extend Becker’s identification analysis to a host of cases where microeconomic theory has
not analytically characterized the equilibrium sorting pattern based on simple production-function properties.
    The focus on a production function f (a, i) as an object of interest can be motivated by a model where men
have utility functions over the characteristics of women, women have utility functions over the characteristics
of men, and men and women exchange monetary transfers, which enter additively separably into utility. The
researcher will not have data on the transfers. Details on this more primitive motivation will be given for the
general case below.


2.2     Data on multiple matching markets
The econometrician has access to data on {A, a, b, i, j} for each member of a population of matching markets.
Think of each market as a very small town with two men and two women; the researcher observes their charac-
teristics a, b, i and j. Likewise, the researcher observes the assignment A in each market. A is the set of matches
that we observe. For example, if a and i as well as b and j marry, A = {ha, ii , hb, ji}, where ha, ii is the match
between man a and woman i. If b and j are instead single, A = {ha, ii , hb, 0i , h0, ji}.
      Readers may be familiar with single-agent discrete-choice models, such as the parametric logit model or
the semiparametric maximum-score model. It might be helpful to think of matching by analogy to single-agent
choice: the independent variables are the agent characteristics a, b, i and j and the qualitative dependent variable
is the assignment A. Of course, the underlying data-generating process for A is an equilibrium model and not a
single-agent choice model.


                                                             4
    For the purposes of intuitive identification, assume that all characteristics a, b, i and j vary across markets
and are continuous random variables with (if needed) full support. Let the support be a product space for all
eight characteristics (recall each of the four agents has two characteristics), so that there is some matching
market with each combination of the eight characteristics. For conciseness, let X = {a, b, i, j}, or the eight
observable characteristics. For identification, the researcher has access to the population data on i.i.d. market
observations (X, A) and hence can identify the joint distribution of A and X . Let Pr (A | X) be the probability of
observing assignment A given agent characteristics X . Pr (A | X) is identifiable given the joint distribution of A
and X .


2.3       The rank order property and identification
For the case of one-to-one matching (this property will not generalize to many-to-many matching), Koopmans
and Beckmann (1957), Shapley and Shubik (1972), and Becker (1973) prove that any pairwise stable assign-
ment A will maximize the sum of production of all matches in the economy, or A will maximize ∑ha,ii∈A f (a, i),
where ha, ii is an arbitrary match in the feasible assignment A. An assignment is feasible for marriage if each
agent has at most one spouse and the spouse is of the opposite gender. As is common in empirical work, often
two markets with the same observable agent characteristics X will have different assignments A. The econo-
metric model should ideally allow a positive probability for observing any feasible assignment, or Pr (A | X) > 0
for all feasible A, given X . This is equivalent to the logit model’s property of giving positive probability to all
choices.
    The main property identification will be based upon is the rank order property. This is inspired by re-
lated conditions in the literature on maximum-score estimation of the single-agent, multinomial choice model
(Manski, 1975; Matzkin, 1993; Fox, 2007). Let A1 and A2 be two different feasible assignments for the same
matching market. A strong version of the rank order property states that Pr (A1 | X) > Pr (A2 | X) if and only
if ∑ha,ii∈A1 f (a, i) > ∑ha,ii∈A2 f (a, i). For example, focus on the two assignments where no agent is single. Let
A1 = {ha, ii , hb, ji} and A2 = {ha, ji , hb, ii}. Given observable agent characteristics in X and knowledge of f , the
property states that assignment A1 is more frequently observed if and only if

                                          f (a, i) + f (b, j) > f (a, j) + f (b, i) .                              (1)

For marriage, the rank order property is a stochastic extension of the deterministic idea from the theory literature
that the equilibrium assignment maximizes production and assignments that do not maximize production do
not occur. Under the rank order property, all assignments can occur, and their frequencies are rank ordered by
their sums of production.
    Let f 0 be the true production function and let f 1 be some other production function. Identification will
require us to find a set of market characteristics X where (1) holds for f = f 0 and

                                          f (a, i) + f (b, j) ≤ f (a, j) + f (b, i)                                (2)

holds for f = f 1 . The inequality (1) for f = f 0 implies that Pr (A1 | X) > Pr (A2 | X) in the population data,
while (2) for f = f 1 implies Pr (A1 | X) ≤ Pr (A2 | X) if f 1 happened to generate the data, which it does not.
Pr (A1 | X) > Pr (A2 | X) and Pr (A1 | X) ≤ Pr (A2 | X) are exclusive possibilities. Therefore, the production function



                                                              5
f 0 is (informally) identified if for any f 1 6= f 0 we can find a set of eight market observables X = {a, b, i, j} where
(1) holds for f = f 0 and (2) holds for f = f 1 . This particular X will be decisive because f 0 and f 1 give different
implications for the population data Pr (A | X).


2.4     Derivative-based identification
Qualitative data on who matches with whom in equilibrium will not be enough to identify production functions
in full generality. At a minimum, multiplying each f by a positive constant will preserve the inequality in (1).
Thus, this paper focuses on identifying features of f 0 .

2.4.1    Are two inputs complements or substitutes at a point?
                                                                                                          ∂ 2 f 0 (a,i)
The first feature of f 0 that that will be identifiable is the sign of                                     ∂ a1 ∂ i 1
                                                                                                                        ,   or whether the schooling levels of men
and women are complements or substitutes in production. Here a and i should be take as any arbitrary male
and female characteristics. This extends Becker (1973) in two ways: each a has two characteristics schooling
                                                                                     ∂ 2 f 0 (a,i)
and wealth, not just schooling, and the signs of                                      ∂ a1 ∂ i1
                                                                                                     can be positive for some couple characteristics (a, i)
                                                                     ∂ 2 f 0 (a,i)
and negative for other (a, i). The sign of                            ∂ a1 ∂ i1
                                                                                      will be learned for each a and i separately, and so the signs
will be known for all points of the support of f . Thus, the analysis does not rely on inputs being complements
or substitutes for all values (a, i).
                                                     ∂ 2 f 0 (a,i)
      For the sake of argument, let                   ∂ a1 ∂ i1
                                                                     > 0 and so, to show identification, let f 1 be some other production
                       ∂ 2 f 1 (a,i)
function where          ∂ a1 ∂ i1
                                       < 0. We will need to find some characteristics X = {a, b, i, j}, eight characteristics as
each element is a vector, where (1) holds for f = f 0 and (2) holds for f = f 1 .
    In what follows, assume each f is three-times differentiable, so that cross-partial derivatives are symmetric.
Then a cross-partial derivative can be expressed as the limit of a middle-difference quotient:

  ∂ 2 f (a, i)       f ((a1 + h, a2 ) , (i1 + h, i2 )) − f ((a1 + h, a2 ) , (i1 , i2 )) − f ((a1 , a2 ) , (i1 + h, i2 )) + f ((a1 , a2 ) , (i1 , i2 ))
               = lim                                                                                                                                   ,
   ∂ a1 ∂ i1     h→0                                                              h2
                                                                                                                                                               (3)
where h is the limit argument in the expression for the cross-partial derivative. The value of (a, i) where we
                                           ∂ 2 f 0 (a,i)
wish to identify the sign of                ∂ a1 ∂ i 1
                                                           is given. We will work with markets with observables X of the form X =
{(a1 , a2 ) , (a1 + h, a2 ) , (i1 , i2 ) , (i1 + h, i2 )}. In the previous notation for the two men and two women, a = (a1 , a2 ),
b = (a1 + h, a2 ), i = (i1 , i2 ), and j = (i1 + h, i2 ). Men a and b have identical observable characteristics except that
b has h more units of schooling than a. Likewise, women i and j are identical except that j has h more units of
schooling.
   The numerator of the middle-difference quotient in (3) for f = f 0 will be positive for sufficiently small h,
         2 0
because ∂∂ af ∂(a,i)
                i
                     > 0. Likewise for sufficiently small h > 0, the numerator of the middle-difference quotient in
               1   1
(3) for f = f 1 will be negative. Let h be sufficiently small so that both the previous statements hold. For f = f 0 ,
we can rearrange the positive numerator to give

            f ((a1 , a2 ) , (i1 , i2 )) + f ((a1 + h, a2 ) , (i1 + h, i2 )) > f ((a1 , a2 ) , (i1 + h, i2 )) + f ((a1 + h, a2 ) , (i1 , i2 )) .


This is just a special case of (1). Likewise, the opposite inequality will hold for f = f 1 , which is just a special
case of (2). Now let there be two hypothetical assignments, A1 = {ha, ii , hb, ji} and A2 = {ha, ji , hb, ii}. So,



                                                                                              6
by the above rank order property, f 0 implies Pr (A1 | X) > Pr (A2 | X) and f 1 implies the reverse, so we have
                                                                        ∂ 2 f 0 (a,i)
identification of f 0 and hence we learn the sign of                     ∂ a1 ∂ i1
                                                                                      .    We can use data on the equilibrium outcomes to
matching markets to learn whether two inputs or complements or substitutes in production.
     What is the economic intuition? Given the true f 0 and the alternative f 1 , we were able to find a set of
matching market observables X where f 0 and f 1 gave different predictions about the relative frequencies of two
assignments. Here, f 0 predicted that, in markets with this X , agents would assortatively match on schooling in
more markets than they would anti-assortatively match, while f 1 predicted anti-assortatively matching would
occur in more markets. We can look at the population data on Pr (A | X) to see which is more common.
     Note that this result does not allow a researcher to tell whether a pair of inputs are “more” complementary
                                                                     ∂ 2 f (a,i)               ∂ 2 f (c,k)
at (a, i) than some other point (c, k). For example,                  ∂ a1 ∂ i 1
                                                                                   = 5 and      ∂ c1 ∂ k1
                                                                                                             = 7 cannot be distinguished from any
other pair of positive values.

2.4.2      How important are complementarities for one pair of inputs compared to another pair?

Becker (1973) does not allow agents to have a vector of characteristics, here schooling and wealth. A natu-
ral question to ask is how much more important are complementarities between schooling levels of men and
women compared to complementarities between wealth levels of men and women? This is a horse race anal-
ysis: the multivariate model has multiple characteristics and we wish to identify the relative importance of
the different pairs of characteristics in match production. If the previous analysis is analogous to regressing a
dependent variable on one regressor, this analysis will be equivalent to regressing a dependent variable on two
regressors.
                                                                           ∂ 2 f 0 (a,i)              ∂ 2 f 0 (a,i)
     Say both schooling and wealth are complements:                         ∂ a1 ∂ i 1
                                                                                           > 0 and     ∂ a2 ∂ i 2
                                                                                                                      > 0. We will identify the ratio of
the complementarities of schooling to the complementarities of wealth, or

                                                              ∂ 2 f 0 (a, i) ∂ 2 f 0 (a, i)
                                                                            /               .
                                                                ∂ a1 ∂ i1      ∂ a2 ∂ i2

As before, the analysis is local: for a given value of male and female characteristics (a, i). We can establish these
ratios globally by varying (a, i). Also note that we are identifying the ratio of complementarities, which is an
                                                                                                      ∂ 2 f 0 (a,i)       ∂ 2 f 0 (a,i)
actual numerical value. This will be harder than identifying whether                                   ∂ a1 ∂ i 1
                                                                                                                      >    ∂ a2 ∂ i 2
                                                                                                                                        ,   which is a qualitative
comparison instead of a quantitative               value.1
     Let f 1 6= f 0 be some other production function. Because we can use the previous arguments to identify
                                                                                                                                                        ∂ 2 f 1 (a,i)
whether any pair of inputs are complements or substitutes, we can restrict attention to the case where                                                   ∂ a1 ∂ i 1
                                                                                                                                                                        >
        ∂ 2 f 1 (a,i)
0 and    ∂ a2 ∂ i 2
                        > 0 but, without loss of generality,

                                              ∂ 2 f 0 (a, i) ∂ 2 f 0 (a, i) ∂ 2 f 1 (a, i) ∂ 2 f 1 (a, i)
                                                            /              >              /               .
                                                ∂ a1 ∂ i1      ∂ a2 ∂ i2      ∂ a1 ∂ i1      ∂ a2 ∂ i2

We will need to embellish the running example and allow each matching market to have three men and three
women. Let the men be a, b, and c and let the women be i, j, and k. Let all men start at the baseline character-
istics a. Man a = (a1 , a2 ) is the baseline man. Let man b have h1 extra units of schooling, b = (a1 + h1 , a2 ). Let
                                2 0     2 0
   1 The identification of ∂∂ af ∂(a,i) / ∂∂ af ∂(a,i) seems parallel to the identification of marginal rates of substitution in single-agent choice.
                                1 i1           2 i2
The ratio of marginal utilities is preserved under positive monotonic transformations. However, the ratio of cross-partial derivatives is not
preserved under positive monotonic transformations.



                                                                            7
man c have h2 extra units of wealth, c = (a1 , a2 + h2 ). Likewise, i is the baseline for the three women. Woman j
has h1 extra units of schooling and woman k has h2 extra units of wealth. Now X = {a, b, c, i, j, k}.
      The formal argument using the limits of middle-difference quotients is somewhat technical and will appear
in the proof to Theorem 5.1 for the many-to-many matching case, below. For now, this omitted argument will
give particular values of h1 and h2 , the extra schooling and the extra wealth, where key inequalities hold. In
particular, under f = f 0 and these choices of h1 and h2 ,


   f ((a1 + h1 , a2 ) , (i1 + h1 , i2 )) + f ((a1 , a2 + h2 ) , (i1 , i2 )) + f ((a1 , a2 ) , (i1 , i2 + h2 ))

                                          > f ((a1 , a2 + h2 ) , (i1 , i2 + h2 )) + f ((a1 + h1 , a2 ) , (i1 , i2 )) + f ((a1 , a2 ) , (i1 + h1 , i2 )) ,


or, equivalently,
                                           f (b, j) + f (c, i) + f (a, k) > f (c, k) + f (b, i) + f (a, j) .

Meanwhile, under f = f 1 the reverse inequality will hold. What is going on? On the left side, there is the
total production from an assignment A1 = {hb, ji , hc, ii , ha, ki} where the man and woman with h1 extra units
of schooling (man b and woman j) marry. Also, the man and woman with h2 extra units of wealth (c and k)
each marry baseline individuals (i and a). On the right side, there is the total production from an assignment
A2 = {hc, ki , hb, ii , ha, ji} where the couple where both have h2 of extra wealth (c and k) marry but the man and
woman with h1 of extra schooling each marry a baseline person (b marries i and j marries a).
      We have found a set of observable characteristics X = {a, b, c, i, j, k} and two corresponding assignments
A1 = {hb, ji , hc, ii , ha, ki} and A2 = {hc, ki , hb, ii , ha, ji} where f 0 and f 1 give different implications for the com-
parison of total, deterministic production. So f 0 implies Pr (A1 | X) > Pr (A2 | X) and f 1 implies the reverse.
The economic intuition is easy to understand. Assignment A1 has assortative matching on schooling but anti-
assortative matching on wealth and A2 has assortative matching on wealth but anti-assortative matching on
schooling. If, at these choices for X , assortative matching on schooling and anti-assortative matching on wealth
occur in more markets than assortative matching on wealth and anti-assortative matching on schooling, then the
                                                 ∂ 2 f 0 (a,i) ∂ 2 f 0 (a,i)                  ∂ 2 f 1 (a,i) ∂ 2 f 1 (a,i)                  ∂ 2 f 0 (a,i) ∂ 2 f 0 (a,i)
true ratio of complementarities is                ∂ a1 ∂ i1
                                                              / ∂a ∂i          instead of      ∂ a1 ∂ i1
                                                                                                           / ∂a ∂i .        The value of    ∂ a1 ∂ i1
                                                                                                                                                        / ∂a ∂i
                                                                     2 2                                          2 2                                          2 2
is identified because f 1 was arbitrary.


2.5      Identification of orderings of production levels
The derivative-based identification analysis is sufficient for many matching empirical applications. However,
it is impossible to use the derivative-based analysis to tell apart two production functions with the same cross-
partial derivatives. Briefly let schooling be only the agent characteristic. The production functions f 1 (a1 , i1 ) =
                                                                     ∂ 2 f (a1 ,i1 )
− (a1 − i1 )2 and f 2 (a1 , i1 ) = 2a1 · i1 both have                  ∂ a1 ∂ i 1
                                                                                       = 2. For f 1 , f 1 (1, 1) = 0 and f 1 (2, 1) = −1. For f 2 ,
f 2 (1, 1)   = 2 and   f 2 (2, 1)   = 4. So     f 1 (1, 1)   >    f 1 (2, 1)    yet f 2 (1, 1) < f 2 (2, 1). Under f 1 , each man’s marriage’s
production is highest when the man matches with a woman with the same level of schooling. There is no single
ideal female schooling attainment for all men. Under f 2 , any man’s marriage’s surplus will be maximized by
matching with the most-educated woman.
      Now return to there being two characteristics, wealth and schooling, for each man and each woman. Iden-
tifying cross-partial derivatives does not tell us whether production is higher at one argument (a, i) than an-
other argument. For any two sets of characteristics for a pair of matches (a, i) and (b, j), we identify whether


                                                                                   8
f 0 (a, i) > f 0 (b, j) or the reverse. Ordering production function levels is helpful in distinguishing whether an
individual match characteristic such as schooling is actually a “good” that raises output.
    Matzkin (1993) proves the identification of utility functions for the single-agent multinomial-choice model.
Following Matzkin, restrict attention to a class of production functions where no two members are related by a
positive monotonic transformation. Let f 0 be the true production function and f 1 some alternative not related to
f 0 by a positive monotonic transformation. Matzkin proves there exists two points (a, i) and (b, j) where, without
loss of generality, f 0 (a, i) > f 0 (b, j) and f 1 (a, i) < f 1 (b, j). For the single-agent model, identification is then
proved using a rank order property: a consumer with utility function f 0 picks the product with characteristics
(a, i) more frequently than the product with characteristics (b, j). A consumer with utility function f 1 does the
reverse. Data on the frequency of choice will show f 1 is not the correct utility function.
    In the single-agent model, one can vary the characteristics of the choices facing the single agent. In a
matching market, an agent must pay the appropriate transfer to match with a partner, and that transfer is both
an outcome of the game and assumed to not be in the data. Therefore, I extend the mathematical arguments
in Matzkin to show the identification of the production function f by using only exogenous information on X ,
the collection of characteristics of all agents and potential matches in a matching market. In other words, I
work with the equilibrium structure of the game and variation in the exogenous market-level characteristics of
matches to show identification.
    We need to transform the inequality f (a, i) > f (b, j) for f = f 0 , or

                                                   f ((a1 , a2 ) , (i1 , i2 )) > f ((b1 , b2 ) , ( j1 , j2 )) ,                                              (4)

into an inequality that compares assignments A1 and A2 for the same market with observable characteristics X .
The problem is that agents with different characteristics appear on the left and right sides of f (a, i) > f (b, j).
Focusing on single people will resolve this dilemma. Add the payoff for each agent being single to each side
of (4). Adding identical terms to each side preserves the inequality:


   f ((a1 , a2 ) , (i1 , i2 )) + f ((a1 , a2 ) , 0) + f (0, (i1 , i2 )) + f ((b1 , b2 ) , 0) + f (0, ( j1 , j2 )) >

                                         f ((b1 , b2 ) , ( j1 , j2 )) + f ((a1 , a2 ) , 0) + f (0, (i1 , i2 )) + f ((b1 , b2 ) , 0) + f (0, ( j1 , j2 )) .   (5)

This inequality almost involves two assignments A1 and A2 to the same market, X . An issue is that a man with
characteristics a = (a1 , a2 ) appears on the left side twice, as does a woman i = (i1 , i2 ). Similarly, man b and
woman j appear twice on the right side. One commonly-used assumption in the theory literature, for example
Koopmans and Beckmann (1957) and Shapley and Shubik (1972), is that the payoff to being single is 0. If this
is the case, we can choose to set the production of certain unmarried agents in (5) to 0, giving

         f ((a1 , a2 ) , (i1 , i2 )) + f ((b1 , b2 ) , 0) + f (0, ( j1 , j2 )) > f ((b1 , b2 ) , ( j1 , j2 )) + f ((a1 , a2 ) , 0) + f (0, (i1 , i2 )) .


We could set all single matches to 0, but doing so would return us to (4). On the left side, we have an assignment
A1 = {ha, ii , hb, 0i , h0, ji} and on the right side we have an assignment A2 = {hb, ji , ha, 0i , h0, ii}. The production
function f 0 implies Pr (A1 | X) > Pr (A2 | X) and f 1 implies the reverse, for X = {a, b, i, j}.
    The economic intuition here is simple. If we wish to know whether or not f 0 (a, i) > f 0 (b, j), we merely
need to see the relative frequency of a and i being married and b and j being single compared to b and j being


                                                                               9
married and a and i being single. The couple with the higher marital production will be single less often.
Thus, we can learn the orderings of production functions: we can identify production functions up to positive
monotonic transformations.
      The need to use single people arises because the example used agent-specific characteristics. Identification
of orderings of production functions will be proved below for match-specific and group-of-matches-specific
characteristics. Those results will not rely on single people.


2.6      Uses of matching estimation in empirical work
Before starting with the many-to-many notation and results, I should stop and discuss the role of matching
estimation (and hence identification) in empirical work. One goal is to distinguish the role of the distribution
of exogenous agent characteristics from the role of the production function in the sorting pattern we see in the
data. For example, Choo and Siow (2006) find changes in the sorting patterns between broad types of men and
women across decades in the United States, and in part ask whether changes in match production functions or
changes in agent characteristics are behind the differences in sorting patterns.
      The identification results in this paper are specifically referenced in Fox and Bajari (2009). In that paper,
we estimate the production function for companies matching to geographic mobile-phone licenses in a FCC
spectrum auction. We use our estimates to measure the efficiency of the assignment in the auction (we do
not use the above production maximization arguments to motivate the inequalities). We use qualitative data
on which bidders win what packages of licenses. First, we use the derivative-based identification arguments
to cardinally measure the relative complementarities of higher-value bidders sorting to packages with greater
scale and the complementarities of packages of geographically nearby licenses being grouped together. Second,
we use the results on the orderings of production levels to argue that both of these types of bidder and license
characteristics are “goods” that raise output. This lets us use our production functions to measure (up to scale)
the total output from counterfactual assignments of bidders to licenses and to measure how much efficiency is
lost from the actual assignment in the auction.


3      Many-to-many matching games
The rest of the paper studies the general case of many-to-many matching without additive separability in an
upstream firm’s payoffs across multiple downstream-firm partners. These interactions in payoffs across part-
ners are the key behind many empirical issues, as my empirical work elsewhere has illustrated (Fox and Bajari,
2009; Fox, 2009). This section outlines a two-sided, many-to-many matching game without econometric er-
rors. Simpler models such as marriage are special cases. In the next section, I discuss how to extend these
models to introduce econometric error terms. The running example will be downstream firms (think automo-
tive manufacturers such as General Motors and Toyota) matching with upstream firms (for automotive parts
suppliers, think Bosch and Johnson Controls).
      Some theoretical results on one-to-one, two-sided matching with transferable utility have been general-
ized by Kelso and Crawford (1982) for one-to-many matching, Leonard (1983) and Demange, Gale and So-
tomayor (1986) for multiple-unit auctions, as well as Sotomayor (1992), Camiña (2006) and Jaume, Massó
and Neme (2008) for many-to-many matching with additive separability in payoffs across multiple matches.
These models are applications of general equilibrium theory to games with typically finite numbers of agents.


                                                         10
The identification strategy used in this paper can be extended to the cases studied by Kovalenkov and Wooders
(2003) for one-sided matching, Ostrovsky (2008) for supply chain, multi-sided matching, and Garicano and
Rossi-Hansberg (2006) for the one-sided matching of workers into coalitions known as firms with hierarchi-
cal production.2 Overall, this paper uses the term “matching game” to encompass a broad class of models,
including some games where the original theoretical analyses used different names.


3.1     Matching markets
Notationally, I drop the equivalence between agent indices and their characteristics because I will allow for all
of firm-, match- and group-specific characteristics.
      Several exogenous objects define a matching market. Let U be a finite set of upstream firms, indexed by
i. Let D be a finite set of downstream firms, indexed by a. Let Q : U ∪ D → N+ be the set of quotas, where
qda ∈ Q is the quota of a downstream firm a and qui ∈ Q is the quota of the upstream firm i. A quota represents
the maximum number of physical matches that a firm can have. Let X be the collection of all payoff-relevant
exogenous characteristics. I will be specific about the elements of X below. A matching market also has the
exogenous preferences of agents, which I will also discuss below.
      Let µ = ha, ii be a match between downstream firm a and upstream firm i. If qda > 1, a downstream firm, a,
say, may be part of multiple matches. As before, µ = ha, 0i refers to an unfilled quota slot for a downstream
firm and µ = h0, ii refers to an unfilled quota slot for an upstream firm. The space of individual matches is
(U ∪ {0}) × (D ∪ {0}). A matching-market outcome is a tuple (A, T ). An assignment A, or a finite collection of
matches for all agents in the market, is an element of the power set of (U ∪ {0}) × (D ∪ {0}). For any assignment
                                                  
A with N matches, A = {µ1 , µ2 , . . . , µN }, T = tµ1 ,tµ2 , . . . ,tµN is a set of transfers for all matches in A. Each tµ ∈ R
and represents a payment by a downstream firm to an upstream firm. I use the convention that the downstream
firm is sending positive transfers to the upstream firm, but the notation allows transfers to be negative. In a
market with 100 upstream-downstream relationships, A is a finite set of 100 relationships and T is a finite set of
100 transfers between each of the matched partners. Altogether, the combination of the exogenous (D,U, Q, X)
and endogenous (A, T ) elements of a matching market is the tuple (D,U, Q, X, A, T ).
   Given an outcome (A, T ), the payoff of i ∈ U is
                                                      ru (~x (i,Ciu (A))) +     ∑         tha,ii .                           (6)
                                                                              a∈Ciu (A)


Here, Ciu (A) is a collection of downstream firms i is matched to in assignment A and ru (·) is the structural
revenue function for upstream firms. The payoff at (A, T ) for a ∈ D for the match ha, ii ∈ A is rd (~x (i, {a})) − tha,ii .
I will now explain each of the elements of the notation that enters these payoffs.
    Ciu ⊆ D ∪ {0} is a coalition of downstream firms that may match with upstream firm i. Cu with no subscript
is an arbitrary collection of downstream firms. In a duplication of notation, if the assignment A is an argument
to the function Ciu (A), then
                                               
                                               {a ∈ D | ha, ii ∈ A}
                                               
                                                                               if {a ∈ D | ha, ii ∈ A} 6= 0/
                                   Ciu (A) ≡
                                               {0}
                                               
                                                                               if {a ∈ D | ha, ii ∈ A} = 0/


is the set of downstream firms matched to upstream firm i at the assignment A. Cd ⊆ U ∪ {0} and Cad (A) have
   2 Lucas   (1978) and Rosen (1982) are predecessors to Garicano and Rossi-Hansberg (2006).


                                                                     11
similar interpretations for downstream firms.
     A feasible assignment A is one that is under quotas for all agents. This means Ciu (A) ≤ qui ∀ i ∈ U and
Cad (A)   ≤ qda ∀ a ∈ D. Quotas ensure that firms are rivals to match with the most attractive partners on the other
side, as opposed to all firms choosing the most attractive partner.3
     This paper studies matching in characteristic space. Let ~x (i,Cu ) be the vector of characteristics correspond-
ing to the set of matches involving firm i ∈ U and the set of potential downstream firm partners in Cu .4 I will
consider three types of characteristics. First consider the case studied in Section 2, where each agent has a
fixed type, a vector ~xad for downstream firm a and a vector ~xiu for upstream firm i. For example, ~xad could be
the geographic location of a’s assembly plant, information on the cars manufactured by a, the markets a sells
to, etc. Likewise, ~xiu could be the geographic location of upstream firm i, the past experience of the upstream
firm, etc. Allowing types to be vectors is an important extension of existing theoretical work. In this case,
                                          
~x (i,Cu ) = cat ~xiu ,~xad1 , . . . ,~xadn , where Cu = {a1 , . . . , an }.5
     I also consider cases where covariates vary directly at the match ha, ii or group-of-matches Cu levels. For
                                                                                                        
                                                                   u,d                u,d                     u,d
match-specific characteristics, the long vector ~x (i,Cu ) = cat ~xha  ,ii
                                                                           , . . . ,~xha
                                                                                         n ,ii
                                                                                               , where each ~xha,ii is the vector
                                                                                             1
                                                                      u,d
of characteristics of the match ha, ii. An example of an element of ~xha,ii is a measure of whether two firms’
                                                                                                            group
inventory information systems are compatible. For group-specific characteristics, the vector ~x (i,Cu ) = ~x(i,C u)

is not a concatenation of shorter vectors for covariates that operate at the match ha, ii level. An example of
                                         group
group-specific characteristics is that ~x(i,C u ) might include the percentage of upstream firm i’s downstream-firm

partners that are located in countries with rigorous environmental regulations.
     X is the set of characteristics for all firms for firm-specific characteristics, all potential matches for match-
specific characteristics, and all potential groups of matches in a market, whether the matches are part of a
particular assignment or not. Formally,
                                                                                                                                
                                                   n o                                   n        o                         n         o
                                                                                            u,d                              group
                             {~xiu } ∪            ~xad  ∪ 
                     [                      [                         [              [                   [       [
         X =                                                                             ~xha,ii   ∪                        ~x(i,Cu )  ,
                   i∈U∪{0}               a∈D∪{0}                   i∈U∪{0} a∈D∪{0}                   i∈U∪{0} Cu ∈P(D∪{0})


where P (D ∪ {0}) is the power set of downstream firms. This set notation will allow me to hold one element of
X constant while varying other elements, which will be important in some proofs. All elements of X may not
be present in many applications. For example, an application may lack match-specific characteristics. In that
case, just treat the corresponding terms as the empty set, 0/ , in the definition of X .6
     All upstream firms have the same revenue function, ru (~x (i,Cu )), which gives the structural revenue of
upstream firm i for the potential downstream-firm partners in Cu . Downstream firm a has structural revenues
rd (~x (i, {a})) from its potential match ha, ii. I assume that the structural revenues of downstream firms are
additively separable across multiple upstream-firm partners: rd ~x Cd , {a} = ∑i∈Cd rd (~x (i, {a})), where Cd ⊆
                                                                              

U ∪ {0} is a collection of upstream firms.
     At a matching market outcome (A, T ), the total profits of i ∈ U are given by (6). The fact that transfers enter
    3 Quotas are not necessary; some other explanation such as decreasing returns to scale may explain why all matches do not occur.
    4I use the vector notation ~x for characteristics only. Later I will refer to the individual, scalar elements of ~x as, say, xk .
    5 The concatenation operator makes one long vector out of a set of shorter vectors. I use the concatenation operator because discussing

the properties of a production function using familiar ideas from the econometrics literature will be easier if a production function takes a
single vector of arguments, rather than a number of distinct vectors, as arguments.
    6 This definition of X does not require knowledge of quotas Q, which will later be said to be unmeasured. However, if quotas are

known, the researcher can disregard including in X any ~xgroup (i,Cu ) for a |Cu | > qui . The definition of X requires dummy arguments for
characteristics involving the partner of being unmatched, 0, for notational conciseness later.



                                                                                12
additively separably for both upstream and downstream firms allows us to focus on the following production
function.
Definition 3.1. The production function for (i,Cu ) for i ∈ U and Cu ⊆ D is

                                             f (~x (i,Cu )) ≡ ru (~x (i,Cu )) +    ∑     rd (~x (i, {a})) .
                                                                                  a∈Cu


For the Section 2 example of one-to-one matching with fixed types, f (~x (i, {a})) ≡ ru cat ~xiu ,~xad +rd cat ~xiu ,~xad .
                                                                                                                                                      

    I assume that the maximum quota for all upstream firms, maxi∈U qui , is known and finite. This means that
~x (i,Cu ) has a known maximum number of elements. For many-to-many matching, a maximum quota and the
additive separability of rd (~x (i, {a})) across multiple upstream-firm partners makes the set of arguments of f
finite.7 Additive separability for one side of the market is restrictive. Unfortunately, I know of no other way
to define a production function without relying on parametric assumptions. In an empirical application, a
researcher might be wiling to make parametric assumptions and choose a functional form for f so that nonlin-
earities in an upstream firm’s profits across its downstream-firm partners are distinguished from a downstream
firm’s nonlinearities across its upstream-firm partners.
    Sometimes I will view f (·) as an abstract function to be identified and estimated. In this case, I write f (~x),
where the argument ~x is an arbitrary vector of characteristics. When upstream firm i does not use all of its
quota, null arguments can be included in the argument vector ~x of f (~x) to refer to the unfilled match slots.


3.2     Pairwise stability
Because binding quotas prevent an agent from unilaterally adding a new partner without dropping an old
one, the equilibrium concept in matching games allows an agent to consider exchanging a partner. I use the
innocuous convention that upstream firms pick downstream firms.
Definition 3.2. A feasible outcome (A, T ) is a pairwise stable equilibrium when:

    1. For all ha, ii ∈ A, hb, ji ∈ A, hb, ii ∈
                                              / A, and ha, ji ∈
                                                              / A,


                 ru (~x (i,Ciu (A))) +       ∑           thc,ii + tha,ii ≥ ru (~x (i, (Ciu (A) \ {a}) ∪ {b})) +       ∑           thc,ii + t˜hb,ii ,   (7)
                                         c∈Ciu (A)\{a}                                                            c∈Ciu (A)\{a}

                                                                         
        where t˜hb,ii ≡ rd (~x (i, {b})) − rd (~x ( j, {b})) − thb, ji .

    2. For all ha, ii ∈ A,

                          ru (~x (i,Ciu (A))) +          ∑        thc,ii + tha,ii ≥ ru (~x (i,Ciu (A\ {a}))) +        ∑          thc,ii .
                                                  c∈Ciu (A)\{a}                                                  c∈Ciu (A)\{a}


    3. For all ha, ii ∈ A,
                                                                 rd (~x (i, {a})) − tha,ii ≥ 0.
    7 Consider an example with matches ha, ii, hb, ii and hb, ji. If the model allowed arbitrary nonlinearities in both upstream and down-

stream firms’ structural revenue functions, there would be a set of firms {a, b, i, j} with production f (~x (h{i, j} , {a, b}i)), even though a
and b, a and j as well as i and j have no direct links.




                                                                          13
                     / A where Ciu (A) < qui and Cad (A) < qda , there exists no t˜ha,ii ∈ R such that
   4. For all ha, ii ∈

                              ru (~x (i,Ciu (A))) +     ∑         thc,ii < ru (~x (i,Ciu (A) ∪ {a})) +     ∑         thc,ii + t˜ha,ii
                                                      c∈Ciu (A)                                          c∈Ciu (A)


          and
                                                              rd (~x (i, {a})) − t˜ha,ii ≥ 0.

Part 1 of the definition of pairwise stability says that upstream firm i prefers its current downstream firm
a instead of some alternative downstream firm b at the transfer t˜hb,ii that makes downstream firm b switch to
sourcing its supplies from i instead of its equilibrium upstream firm, j. Because of transferable utility, upstream
firm i can always cut its price and attract b’s business; at an equilibrium, it would lower its profit from doing so
if the new business supplanted the relationship with a. Part 1 is the main component of the definition of pairwise
stability that I will focus on in this paper. Parts 2 and 3 deal with matched agents not profiting by unilaterally
dropping a relationship and becoming unmatched. These are individual-rationality conditions: all matches
must give an incremental positive surplus. Finally, Part 4 involves two firms with free quota not wanting to
form a new match.
    I have not imposed sufficient conditions to ensure the existence of an equilibrium. In many-to-one, two-
sided matching with complementarities across matches on the same side of the market, Hatfield and Milgrom
(2005), Pycia (2008) and Hatfield and Kojima (2008) demonstrate that preference profiles can be found for
which there is no pairwise stable outcome.8 The counterexamples mean that general existence theorems do not
exist.9
    Many interesting matching empirical applications require investigating possibilities outside of the scope
of current existence theorems. I maintain the assumption that the data on an assignment represent part of an
equilibrium for the game.10 I discuss multiple equilibrium assignments below.


3.3        Using matches only: local production maximization
A matching-game outcome (A, T ) has two components: the assignment, sorting or matching A and the equilib-
rium transfers T . I consider using data on only A. This is because researchers often lack data on transfers, even
when the agents use transfers. Upstream and downstream firms exchange money, but the transfer values are
private, contractual details that are not released to researchers.
      I will exploit the transferable-utility structure of the game to derive an inequality that involves A but not
T . For upstream firms i and j, consider an example where Ciu (A) = {a} and Cuj (A) = {b}. The inequality (7)
   8 Pycia   (2007) has both existence and nonexistence results for matching markets without endogenous prices (Gale and Shapley, 1962).
   9 The   possibility that a pairwise stable equilibrium does not exist does not mean a decentralized matching market will unravel. Ko-
valenkov and Wooders (2003) and others study relaxed equilibrium concepts where it is easier to show existence, such as, for example,
imposing a switching cost to deviate from the proposed assignment.
   10 In the non-nested-with-matching literature on estimating normal-form Nash games, Ciliberto and Tamer (2008) throw out a particular

realization of the error term’s contribution to the likelihood if no pure-strategy equilibrium exists. Bajari, Hong and Ryan (2008) compute
all equilibria including mixed-strategy equilibria, as a mixed-strategy equilibrium is guaranteed to exist in a normal-form Nash game. In
matching, there is no notion of a mixed-strategy equilibrium, as quotas are binding for every realization of the game. In a mixed strategy,
players’ actions are random, so a woman in a marriage market with quota 1 could find herself married to two men because of a random
realization in a mixed-strategy equilibrium.
   More technically, Nash’s existence theorem relies on a fixed-point argument requiring continuous strategies, like mixed strategies.
Existence theorems in matching games rely on Tarski’s fixed-point theorem, which uses monotonic operators and hence requires structure
on preferences to ensure this monotonicity.



                                                                          14
becomes
                                                                                                                     
                         ru (~x (i, {a})) + tha,ii ≥ ru (~x (i, {b})) + rd (~x (i, {b})) − rd (~x ( j, {b})) − thb, ji ,                     (8)

after substituting in the definition of t˜hb,ii . Likewise, there is another inequality for upstream firm j’s deviation
to match with a instead of b:
                                                                                                                      
                        ru (~x ( j, {b})) + thb, ji ≥ ru (~x ( j, {a})) + rd (~x ( j, {a})) − rd (~x (i, {a})) − tha,ii .                    (9)

Adding (8) and (9), cancelling the transfers tha,ii and thb, ji that now are the same on both sides of the inequality,
and substituting the definition of a production function, Definition 3.1, creates the new inequality

                                     f (~x (i, {a})) + f (~x ( j, {b})) ≥ f (~x (i, {b})) + f (~x ( j, {a})) .


I call this a local-production-maximization inequality: “local” because only exchanges of one downstream firm
per upstream firm are considered, and “production maximization” because the implication of pairwise stability
says that the total output from two matches must exceed the output from two matches formed from an exchange
of partners.
    The local-production-maximization inequality suggests that interactions between the characteristics of
agents in production functions drive the equilibrium pattern of sorting in a market. As the same set of firms
appears on both sides of the inequality, terms that do not involve interactions between the characteristics of
firms difference out. In a one-to-one matching game, if f (~x (i, {a})) = βu0~xiu + βd0~xad , then a local production
maximization inequality is

                                      βu0~xiu + βd0~xad + βu0~xuj + βd0~xbd ≥ βu0~xiu + βd0~xbd + βu0~xuj + βd0~xad ,                      (10)

or 0 ≥ 0, so the definition has no empirical content. Theoretically, the uninteracted characteristics are valued
equally by all potential partner firms and are priced out in equilibrium.11
    More generally, the equilibrium concept of pairwise stability can be used to form a local-production-
maximization inequality.
Lemma 3.1. Given a pairwise stable outcome (A, T ), let B1 ⊆ A, let π be a permutation of the downstream-firm
partners in B1 , and let
                                                          B2 = {hπ ha, ii , ii | ha, ii ∈ B1 } .

Then the inequality
                                        ∑       f (~x (i,Ciu (A))) ≥       ∑       f (~x (i,Ciu ((A\B1 ) ∪ B2 )))                          (11)
                                     ha,ii∈B1                           ha,ii∈B2

holds.
All proofs are found in the appendix.12 The definition of a local-production-maximization inequality is similar
   11 For some policy questions, the cancellation of characteristics that are not interactions between the characteristics of multiple firms

is an empirical advantage. Many datasets lack data on all important characteristics of firms. If some of these characteristics affect the
production of all matches equally, the characteristics difference out and do not affect the assignment of upstream to downstream firms.
If the policy questions of interest are not functions of these unobserved characteristics, then differencing them out leads to empirical
robustness to missing data problems.
   12 A permutation π of the downstream firm partners applied to a set of matches {ha, ii , hb, ji , hc, ki} gives each upstream firm a new

downstream-firm partner. An example of a permutation is {hc, ii , ha, ji , hb, ki}. For simplicity of notation, I let π ha, ii = c give the index
of the new downstream firm partner c of the upstream firm i.



                                                                           15
to (11), except that no particular outcome (A, T ) needs to be stated. This definition will be used formally in the
identification proofs.
Definition 3.3. Let there be a set of matches B1 and let B2 be a permutation π of B1 , B2 = {hπ ha, ii , ii | ha, ii ∈ B1 } .
For each i where ha, ii ∈ B1 , let there be a set of downstream firms Ciu such that ha, ii ∈ B1 implies a ∈ Ciu . Call

                                        ∑       f (~x (i,Ciu )) ≥     ∑        f (~x (i, (Ciu \ {a}) ∪ {π ha, ii}))
                                     ha,ii∈B1                       ha,ii∈B1


a local-production-maximization inequality.13
    The definition of pairwise stability is powerful: the condition that no upstream firm wants to swap a sin-
gle downstream-firm partner for a single new partner at the equilibrium transfers implies local-production-
maximization inequalities involving large sets of matches B1 and B2 . The potential large size of B1 and B2 in
the lemma will be important for some of the nonparametric identification theorems below.14


4      Adding econometric error terms
4.1      Data on many independent matching markets
I will consider identification using data on the population of different matching markets. As before, a matching
market is described by (D,U, Q, X, A, T ). Data on the transfers T are often not available. Similarly, quotas, Q, are
often an abstraction of the matching model and are usually not found in datasets on upstream and downstream
firms. Therefore, I will explore identification using data on (D,U, X, A). From now on, I subsume D and U into
X in order to use more concise notation. The researcher then observes (A, X) across markets.15
      With data on the population of statistically independent and identically distributed as well as economically
unrelated matching markets, the researcher is able to identify Pr (A | X), the probability of observing assignment
A given that the market has characteristics X , as defined previously. To ensure that the model gives full support
to the data, I wish that Pr (A | X) > 0 for any physically feasible (matches of each agent under that agent’s
quota) assignment A.16 The probability Pr (A | X) will be induced by a stochastic structure S. In a model with
match-ha, ii-specific error terms, S ∈ S will represent the distribution of the error terms. Then
                                                                       h                    i
                                   Pr (A | X) ≡ Pr A | X; f 0 , S0 ≡ EQ|X Pr A | X, Q; f 0 , S0 ,


where Pr A | X, Q; f 0 , S0 is the probability of an assignment A being observed given the exogenous character-
                               

   13 The notation B is not strictly speaking needed for Definition 3.3. Later I use B and B when showing that an inequality satisfies
                     2                                                                       1        2
Definition 3.3.
   14 I have no proof that satisfying (11) for all pairs (B , B ) is a sufficient (as opposed to necessary) condition for A to be part of a
                                                            1 2
pairwise stable equilibrium (A, T ) in many-to-many matching games. Sotomayor (1999) implies that in a game where each firm’s payoffs
are additively separable across multiple matches, f (~x (i, {a, b})) = f (~x (i, {a})) + f (~x (i, {b})), then checking all sets with two matches
and their permutations, such as B1 = {ha, ii , hc, ji} and B2 = {hc, ii , ha, ji}, should be enough. Additively separability across multiple
matches rules out many interesting empirical applications.
   15 For the sake of brevity, I assume the researcher has data on all elements of X. By adding additional notation, one could extend the

nonparametric-identification results to the case where some elements of X are missing. For example, all of the agents in the market may
not be observed. See Fox (2007) for a related discussion on estimating the single-agent multinomial-choice model without data on all
available choices.
   16 This focus on allowing errors to affect the realization of A distinguishes this paper’s approach to matching games from the work on

estimating Nash games by Pakes, Porter, Ho and Ishii (2006), which does not allow for these errors in general normal-form Nash games
and so, except in a few cases such as ordered choice, does imply the analog to Pr (A | X) = 0 for some physically possible A’s.


                                                                           16
istics X , the exogenous quotas Q, the true match production function f 0 , and the true distribution of the error
terms S0 . The functions f 0 and S0 are unknown to the econometrician and are arguments to the endogenous-
variable data generating process Pr A | X, Q; f 0 , S0 , but they are fixed across markets and are not random vari-
                                                                  

ables. The matching model and any equilibrium-assignment selection rule together induce the distribution
Pr A | X, Q; f 0 , S0 . I will discuss primitive formulations of error terms in detail below. The quotas in Q are
                     

unmeasured, so the econometrician observes data on Pr A | X; f 0 , S0 ≡ EQ|X Pr A | X, Q; f 0 , S0 , where the
                                                                                                  

expectation over Q is taken with respect to its distribution conditional on X .17


4.2        The rank order property
I will rely on a rank order property to add econometric randomness to the matching outcomes.18 I first describe
a non-primitive rank order property for matching games. In Section 2, this was related to production maximiza-
tion in the entire economy. The general model allows many-to-many matching, where pairwise stability does
not give a link to economy-wide production, efficiency. The rank order property is stated as an assumption and
can be seen as a stochastic version of local production maximization.
Assumption 4.1. Let A1 be a feasible assignment for a market with characteristics X . Let B1 ⊆ A1 and let π be a
permutation of the downstream firm partners in B1 , giving B2 = {hπ ha, ii , ii | ha, ii ∈ B1 } . Let A2 = (A1 \B1 ) ∪ B2 .
Let S ∈ S be any distribution of the error terms and let f ∈ F be any production function. Assume that

                                             ∑       f (~x (i,Ciu (A1 ))) >     ∑        f (~x (i,Ciu (A2 )))                              (12)
                                          ha,ii∈B1                            ha,ii∈B2


if and only if
                                                     Pr (A1 | X; f , S) > Pr (A2 | X; f , S) .

Keep in mind that X , f and S are held fixed: the rank order property is an assumption about the stochastic
structure of the model.
      To understand the rank order property, consider a situation where A1 contains thousands of matches and
B1 = {ha, ii , hb, ji} contains only two matches. Then A2 = (A1 \B1 ) ∪ B2 is equal to A1 except that the matches
B2 = {hb, ii , ha, ji} form. Given X and Q, neither A1 or A2 may be a stable assignment to the matching model
without error terms. But A1 might dominate A2 in the deterministic model in that at least two agents in B2 would
prefer to match with each other instead of their assigned partners, leading to A1 . More generally, if the local-
production-maximization inequality (12) is satisfied, then some agents in B1 want to deviate in the deterministic
matching model. In a model with error terms, both A1 and A2 could be pairwise stable assignments to some
realizations of the unobserved components in the matching model. The assumption says that A1 will be more
likely to be a pairwise stable assignment to some realized model than A2 .
      As the quotas in Q are not observed in many empirical applications, a slightly more primitive version of
Assumption 4.1 is that (12) holds if and only if Pr (A1 | X, Q; f , S) > Pr (A2 | X, Q; f , S), for any valid Q. Then
taking expectations with respect to Q | X gives Assumption 4.1. Even if Q is unobserved, for the most part I
  17 The  transfers T do not need to be integrated out because T is a separate endogenous outcome from A.
  18 Maximum     score is a partial-identification approach. In single-agent discrete-choice problems with the payoff structure xa,i0 β + ε for
                                                                                                                                           a,i
agent i and choice a, S represents the distribution of error terms εa,i . S is not identified under the standard (rank order property) conditions
for the identification of β in either binary- or multinomial-choice problems (Manski, 1975, 1988). In matching, I will focus on identifying
f and not S.



                                                                        17
have only considered inequalities where the total number of matches of each agent in A1 and A2 is kept the
same.19 If unmatched agents are not considered in B1 and B2 and if A1 is a feasible assignment for Q, A2 is also
a feasible assignment for that Q.
      I feel the downside of the non-primitive nature of Assumption 4.1 is outweighed by the benefits it gives.
The assumption allows me to tap into the results on the nonparametric identification of orderings of utility
functions in Matzkin (1991, 1993). Rather than developing a completely new framework, Assumption 4.1
allows me to build on existing results on single-agent choice in order to focus on the novel complications from
working with equilibrium data on matches. This is the first paper to study nonparametric identification in any
type of matching game. Also and as mentioned in the introduction, this assumption leads to a maximum score
estimator that resolves two curses of dimensionality (one computational, one data) in the number of agents in
a matching market.


4.3      A sufficient condition for the rank order property
The remainder of Section 4 discusses the applicability of the rank order property, Assumption 4.1. It is logically
coherent to skip the remainder of this section and to continue reading with the identification results in Section
5.
      This subsection explores a sufficient condition for the rank order property in the context of models where
assignments have unobserved components in production. In this subsection, I assume that the outcome (A, T )
is in the core. The core is an equilibrium concept. A core outcome is robust to deviations by any group of
firms. If the group of all firms cannot improve its joint payoff, a core assignment must maximize the sum of
production for the entire matching economy. Consequently, the decentralized matching-market assignment can
be restated as a social planning problem.20
      There is a finite, although potentially large, number of assignments. The social planning problem is a single-
agent, unordered, discrete-choice problem of Manski (1975), where the single agent is the social planner. From
Manski’s work, we know the sufficient condition that will arise. For an assignment A, let its total production be
∑ha,ii∈A f ~x i,Ciu (A) + ψA , where ψA is an unobserved component of the production of assignment A. Let ψ
                       

be the vector of all ψA ’s. Let ψ have the density S and let ψ be independent of Q and X .21 Let Pr (A | Q, X; f , S)
be the probability A is the core assignment.
Lemma 4.1. Let the equilibrium concept be the core and let the density S exist, have full support and be
exchangeable in the elements of ψ . Then the rank order property, Assumption 4.1, holds.
This lemma was proved in Goeree, Holt and Palfrey (2005) and is a slight generalization of a result in Manski
(1975).22
   19 Unmatched agents 0 could be included in matches in B . For nonparametric identification, data on unmatched agents will not be
                                                                    1
needed, except for one theorem.
   20 The necessary conditions from pairwise stability are enough to nonparametrically identify production functions. Extra inequalities

from the stronger equilibrium concept the core will not be required. However, the social planning property ensures a unique assignment
with probability 1. If the total payoff to a match, say f (~x (i,Cu )) + ∑a∈Cu εha,ii , has a continuous distribution because of continuous
elements of ~x (i,Cu ) or εha,ii , then the event that two or more assignments solve the social planner’s problem has probability zero. Here the
probability is taken across markets. To eliminate the role of the equilibrium-assignment selection rule, this section considers only games
where the outcome is in the core.
   21 More generally, there is no need for the density S to be the same for all markets X. See Fox (2007) for more discussion of letting X be

a conditioning argument in S, for the single-agent, multinomial-choice case.
   22 An exchangeable joint density satisfies g (y , y , . . . , y ) = g (πy , πy , . . . , πy ) for any permutation π of any vector of arguments
                                                        1 2       n         1    2            n
(y1 , . . . , yn ).



                                                                      18
      The social-planner errors can be interpreted as errors in the deterministic model from finding the true
core solution. One could then view exchangeability of the joint density as a structural assumption on the
equilibrium-assignment selection process. Adding errors to a deterministic model is similar to the quantile-
response-equilibrium method of perturbing behavior (Goeree et al.). The social planning problem is a structural
assumption that does exactly generalize the intuition from the empirical matching literature (without error
terms) that assignments with, say, more assortative matching are more likely to occur.23


4.4     Match-specific error terms
In the literature on estimating perfect-information Nash games (Andrews, Berry and Jia, 2004; Bajari, Hong and
Ryan, 2008; Beresteanu, Molchanov and Molinari, 2008; Berry, 1992; Bresnahan and Reiss, 1991; Ciliberto
and Tamer, 2008; Galichon and Henry, 2008; Jia, 2008; Mazzeo, 2002; Tamer, 2003), a typical assumption is
                                                                              
that the payoff to an agent a from taking action i is r ~xa,i + εa,i , where ~xa,i are observable covariates and εa,i
is a player-a-and-action-i-specific shock. This payoff structure is borrowed from the literature on single-agent
discrete-choice models. In a perfect-information Nash game, the εa,i ’s are assumed to be common knowledge
for all players; only the econometrician lacks data on them. These errors are added to the model to be able to
fit any observed equilibrium.
      The analog of the practice for perfect-information Nash games in matching games (a non-nested class of
games) is match-specific error terms εha,ii .24 Let the total output of a set of downstream firm partners Cu for
upstream firm i be
                                                          f (~x (i,Cu )) +   ∑      εha,ii ,                                              (13)
                                                                             a∈Cu

where εha,ii is the match-εha,ii -specific error term, which is independent of all components of X and Q. Let
the stochastic structure S represent the distribution of εha,ii . Let the game’s outcome be in the core, again to
eliminate the need to discuss equilibrium-assignment selection rules. Then, in the perfect information world
where εha,ii is observed by all agents in the model but is not in the data,
                                                             Z
                                    Pr (A | X, Q; f , S) =       1 [A maximizes output | X, Q, ε] dS (ε) ,                                (14)
                                                             ε

where ε is the vector of error terms for all U · D possible matches as well as the option of being single for
each agent. Under this model, S can be chosen so that each physically feasible A will always have positive
probability.
      Unfortunately, the integrand in (14) has errors at the match and not assignment level, and the resulting
Pr (A | X, Q; f , S) does not have the nice properties for the single-agent multinomial choice model that Manski
   23 An exchangeable joint density for assignment-level errors is a sufficient but not necessary condition for the rank order property. Con-

sider the comparison of an assignment A1 = {h1, 1i , h2, 2i , h3, 0i , h0, 3i}, where downstream and upstream firms 3 are both unmatched,
to another assignment A2 = {h1, 2i , h2, 3i , h3, 1i} where all firms are matched. The local-production-maximization inequality in Assump-
tion 4.1 does not allow comparing A1 and A2 because A2 is not a rearrangement of downstream-firm partners from A1 : A2 does not
reallocate the former states of being unmatched. Therefore, the comparison of A1 and A2 is not relevant for the rank order property.
However, the model of a social planner with exchangeable errors makes predictions about the relative frequencies of A1 and A2 based
on their relative sums of production. For example, Lemma 4.1 says ∑ha,ii∈A1 f (~x (i,Ciu (A))) = ∑ha,ii∈A2 f (~x (i,Ciu (A))) if and only if
Pr (A1 | X; f , S) = Pr (A2 | X; f , S). This is despite the fact that in A1 match h3, 3i will often form if it gives more production than being
unmatched, so, in many realizations of uncertainty, A1 will not be be a stable assignment. Therefore, the rank order property is a weaker
assumption than a social planner with exchangeable assignment-level errors.
   24 Pairwise stability is equivalent to the core for one-to-one matching games and many-to-many matching games where payoffs are

additively separable across multiple matches. The core is a stronger solution concept for many-to-many matching games where payoffs
are not additively separable across multiple matches.


                                                                       19
(1975) found when, say, εa,i was i.i.d. across choices for the same agent. For matching, unlike single-agent
discrete choice, it is not a theorem that i.i.d. errors yield the rank order property for matching, Assumption
4.1. If the rank order property for matching is a natural, stochastic generalization of the core property found by
Becker (1973) and others, then i.i.d. errors is not a primitive condition for the stochastic structure S that gives
this natural generalization, exactly.
    All models are approximations to reality. If the true production function is thought to include i.i.d. match-
specific shocks as in (13) and therefore assignment probabilities are given by (14), then the rank order property
may actually be a pretty close approximation. After all, the transferable utility and price-taking structure of
the game does naturally imply that adding production functions is much more natural than in a noncooperative
Nash game. I now present simulation results that examine how closely a perfect-information matching game
with shocks as in (13) is approximated by the rank order property, a natural generalization of prior work on
matching games without econometric errors.
    Table 1 includes results from simulations that compute assignment probabilities for a one-to-one, two-sided
matching game where match production is f (~x (i, {a})) + εha,ii .25 The matching game has three upstream firms
and three downstream firms. The deterministic payoffs of the game are chosen so that ∑ha,ii∈A1 f (~x (i, {a})) =
∑ha,ii∈A2 f (~x (i, {a})) for two assignments, A1 and A2 . As A1 and A2 differ by rearrangements of one downstream
firm per upstream firm, the rank order property, Assumption 4.1, requires that Pr (A1 | X; f , S) = Pr (A2 | X; f , S).
Neither A1 or A2 is a deterministic stable assignment.26 The deterministic payoffs ∑ha,ii∈A1 f (~x (i, {a})) are
constructed so that deviation by agents in A2 is more attractive in an ease metric (two matched pairs could
exchange partners, leaving the third pair alone) to provide a more compelling test against the idea that the rank
order property is satisfied. The details of the game are in the notes to Table 1.
    Table 1 considers six distributions S for i.i.d. match-specific unobservables. The table uses a simulation of
the integral in (14) to compute Pr (A1 | X; f , S) − Pr (A2 | X; f , S), a measure of how far off the rank order property
is. The first line considers a standard normal distribution. As the variance is small and both A1 and A2 are not
stable assignments in the deterministic game, the assignment probabilities are individually small. However,
the difference Pr (A1 | X; f , S) − Pr (A2 | X; f , S) = −0.01514 is large relative to the magnitudes. The second line
increases the normal standard deviation to 6. Both assignment probabilities increase to around 0.079, but
the difference Pr (A1 | X; f , S) − Pr (A2 | X; f , S) decreases in absolute value to 0.00009. The third line increases
the standard deviation to 20; now the probabilities are around 0.065, although Pr (A1 | X; f , S) − Pr (A2 | X; f , S)
remains small, at 0.00011.
    I also investigate to what degree the previous simulations relied on normality. The final three experiments
in Table 1 consider asymmetric, mixed normal distributions with two modes. Again, it appears that the absolute
value of Pr (A1 | X; f , S) − Pr (A2 | X; f , S) is smaller when the standard deviation of the errors is higher.
    Table 1 implies that assignment probabilities that differ by exchanges of only one downstream firm for each
upstream firm are nearly rank ordered by their deterministic payoffs, when true payoffs include match-specific
stochastic components. In Fox (2009), I introduce a maximum-score estimator using this paper’s identification
results and present a Monte Carlo study that shows the estimator has good finite-sample performance when the
data are generated by matching games with match-specific unobservables.
  25 The    game is one-to-one matching, so Q is observed and the same for all markets.
  26 In   other words, neither A1 or A2 would solve the social planner’s assignment problem if all errors εha,ii were 0.




                                                                       20
4.5      Multiple equilibrium assignments
Assumption 4.1 may hold without equilibrium-assignment selection rules if the researcher is willing to specify
that the outcome to the game is in the core. As argued earlier, the equilibrium assignment will be generically
unique.
      Return to using pairwise stability as the only equilibrium concept. In a one-to-one matching game or a
many-to-many matching game with additive separability across multiple matches (Sotomayor, 1999), generi-
cally there will be only one equilibrium assignment. In more complex, many-to-many matching games, multi-
ple assignments may be pairwise stable. In a game with multiple equilibrium assignments, (14) becomes
                                     Z
            Pr (A | X, Q; f , S) =       1[A selected assignment | A stable, X, Q, ε] · 1 [A pairwise stable | X, Q, ε] dS (ε) .   (15)
                                     ε
                                          R
Let ϒ (A | X, Q; f , S) be equal to        ε 1 [A pairwise stable | X, Q, ε] dS (ε) .   Define A1 and A2 as in Assumption 4.1. For
a model with multiple equilibrium assignments, the rank order property, Assumption 4.1, will hold under
the following conditions: 1) ϒ (A1 | X, Q; f , S) > ϒ (A2 | X, Q; f , S) if and only if inequality (11) holds, and 2)
Pr (A1 | X, Q; f , S) > Pr (A2 | X, Q; f , S) if and only if ϒ (A1 | X, Q; f , S) > ϒ (A2 | X, Q; f , S). Part 1 says A1 will more
likely to be stable than A2 if A1 has a higher production after an exchange of one downstream firm for each
upstream firm in some set B1 ⊆ A1 . Part 2 says the equilibrium-assignment selection rule preserves the rank
ordering of stability: assignments that are more likely to be stable are more likely to occur. These conditions
together imply Assumption 4.1 and hence allow a unified framework to be used to study identification and
estimation of matching games, regardless of the number of stable assignments for each ε and X combination.
      The above assumptions are strong. In the literature on estimating Nash games, a non-nested class with
matching games, some researchers assume a particular selection rule when such a rule is easy to implement
(Jia, 2008) and others use a numerical procedure and report the first equilibrium the routine converges to
(Seim, 2006). Assumptions about an equilibrium assignment selection rule may be just as arbitrary as the
above approaches, but for now they are currently the only feasible alternative for matching games with large
numbers of agents and multiple equilibrium assignments.27


5      Derivative-based nonparametric identification
No previous paper has studied the nonparametric identification of matching games. In this section, I generalize
the identification results in Becker (1973) to the case of many-to-many matching with vectors of agent charac-
teristics, among other extensions. The intuition for some of these results has been given in Section 2 for the
case of one-to-one matching. Here, I eschew intuition and focus on stating general theorems precisely.
      As mentioned before, I will explore identification with market-level data on (A, X). Let (A, X) be statistically
independent across matching markets. With this data, I can identify both Pr (A | X) and G (X), the distribution of
X across markets.
  27 The literature on estimating parametric Nash games, a non-nested class with matching games, presents some more rigorous, but

computationally demanding, strategies for dealing with multiple equilibria. See Bajari, Hong and Ryan (2008) and Ciliberto and Tamer
(2008). I do not believe the nonparametric identification of other model components has been studied while simultaneously employing
these methods.




                                                                      21
5.1     Derivative-based identification preliminaries
I use an extension of a standard definition for point identification by Gourieroux and Monfort (1995, Section
3.4).
Definition 5.1. Let F be a class of production functions. Let f 0 ∈ F be the production function and let S0 ∈ S
be the stochastic structure in the data generating process.

    • f 0 is identified within the class of production functions F if there does not exist f 1 6= f 0 , f 1 ∈ F , stochas-
        tic structure S1 ∈ S , and some possibly empty set Y of market characteristics of probability 0 such that
                                                                      /Y.
        Pr A | X; f 1 , S1 = Pr A | X; f 0 , S0 for all (A, X) with X ∈
                                              


    • Let c (·) be a known function that produces either a scalar, vector, another function of ~x or a vector of
        functions of ~x. A feature of f 0 c f 0 is identified for the class of production functions F if there does not
                                                          

        exist f 1 ∈ F where c f 1 6= c f 0 , stochastic structure S1 ∈ S , and some possibly empty set Y of market
                                                     

                                                                                                                 /Y.
        characteristics of probability 0 such that Pr A | X; f 1 , S1 = Pr A | X; f 0 , S0 for all (A, X) with X ∈
                                                                                                                                       


The probability of a set Y is
                                    R
                                     Y      dG (X). I maintain the following assumption for derivative-based identification.

Assumption 5.1.

   1. Each f ∈ F is three-times differentiable in all of its arguments.

   2. X has support equal to the product of the marginal supports of the scalar elements of the vectors that
        comprise X . Each scalar element has continuous support on an open rectangle of R.

I make this assumption to focus on cross-partial derivatives, for example. These conditions can be relaxed.28
      The features of the production functions that govern sorting depend on how the characteristics that enter
~x (i,Cu ) vary. I will present results where characteristics vary at the levels of the firm i, the individual match
ha, ii, and the group Cu of downstream firms matching with one upstream firm. Keep in mind that a unit of
observation is a market. I use variation in market-level observables X for identification.


5.2     Derivative-based identification theorems
5.2.1    Derivative-based identification with firm-specific characteristics

First I consider firm-specific characteristics. Let there be K u characteristics for each upstream firm and K d
characteristics for each downstream firm. In this case, the vector
                                                                                                                                                   
                         ~x (i,Cu ) = cat       u
                                               xi,1            u
                                                    , . . . , xi,K      d
                                                                   u , xa ,1 , . . . , x
                                                                         1              a
                                                                                         d
                                                                                                    ,K d
                                                                                                                , . . . , xadn ,1 , . . . , xad   ,K d
                                                                                                                                                              ,
                                                                                                1                                             n


where Cu = {a1 , . . . , an } is a finite set of n downstream firms and where xa,e
                                                                               d is the eth out of the K d characteristics

of downstream firm a. Recall that ~x is an arbitrary characteristic vector of the form ~x (i,Cu ).
                                                                                                                                                 
Theorem 5.1. Let ~x (i,Cu ) = cat           u , . . . , xu
                                           xi,1          i,K u  , xad                       d
                                                                              ,1 , . . . , xa       d       , . . . , xadn ,1 , . . . , xad        d     . Let ~x be a given point
                                                                          1                 1 ,K                                            n ,K
of evaluation of f .
  28 While there are definitions such as increasing differences (Milgrom and Shannon, 1994) that encompass complementarities without
relying on differentiable f ’s and continuous support for the x’s, working with broader definitions makes the results harder to interpret and
to compare to Becker’s.


                                                                                 22
   1. Let x1 and x2 be scalar characteristics in ~x from two different firms, either one upstream firm and one
                                                                                                      ∂ 2 f 0 (~x)                                      ∂ 2 f 0 (~x)
        downstream firm or two downstream firms. Assume                                               ∂ x1 ∂ x2
                                                                                                                     6= 0. Then the sign of             ∂ x1 ∂ x2
                                                                                                                                                                       is identified.

   2. Let x1 and x2 be scalar characteristics in ~x from two different firms, and let x3 and x4 be two scalar
        characteristics from two different firms as well. The identities of the firms in the two pairs (x1 , x2 ) and
                                                                                     ∂ 2 f 0 (~x)                    ∂ 2 f 0 (~x)                                      ∂ 2 f 0 (~x) ∂ 2 f 0 (~x)
        (x3 , x4 ) can be the same or not. Assume                                    ∂ x1 ∂ x2
                                                                                                    6= 0 and         ∂ x3 ∂ x4
                                                                                                                                    6= 0. Then the ratio                           /
                                                                                                                                                                       ∂ x1 ∂ x2 ∂ x3 ∂ x4
                                                                                                                                                                                                   is
        identified.

The theorem is stated for a given point of evaluation ~x for clarity. As the theorem holds for all points of
evaluation with nonzero cross-partial derivatives, the theorem establishes the global identification of the listed
properties. The intuition behind Part 1 was presented in Section 2.4.1 and Section 2.4.2 presented the intuition
for Part 2.
    Part 1 shows that Becker’s result for the case of scalar types for men and women applies to each pair of
scalar characteristics for distinct firms. Part 1 also extends Becker to a local notion of identification: f ’s inputs
can be complements at some areas of support and substitutes at other areas.
    Becker studies only scalar types. Part 2 of the theorem shows the econometrician can go further and
identify the relative importance of the complementarities for two pairs of characteristics. This is perhaps the
most important result on identification in this paper. The econometrician can run a “horse race” where he or
she tries to measure the relative importance of several pairs of characteristics. This is not just an ordering of
                         ∂ 2 f 0 (~x)       ∂ 2 f 0 (~x)                                                                                                   ∂ 2 f 0 (~x) ∂ 2 f 0 (~x)
magnitudes, as in        ∂ x1 ∂ x2
                                        >   ∂ x3 ∂ x4
                                                         .   Rather, the ratio of the degree of complementarities,                                                     /
                                                                                                                                                           ∂ x1 ∂ x2 ∂ x3 ∂ x4
                                                                                                                                                                                     ,   can be
identified from qualitative data on who matches with whom.

5.2.2    Derivative-based identification with match-specific characteristics

The characteristics in ~x (i,Cu ) can be specific to the individual matches ha, ii. Now let Cu be a set of n downstream
firms and let
                                                                                                                                          
                                                                   u,d                  u,d                    u,d                  u,d
                                    ~x (i,Cu ) = cat              xha  ,ii,1
                                                                             , . . . , xha  ,ii,K
                                                                                                    , . . . , xha  ,ii,1
                                                                                                                         , . . . , xha  ,ii,K
                                                                                                                                                 ,
                                                                         1                   1                           n               n

                                                                         u,d
where there are K characteristics for each potential match ha, ii, with xha,ii,e being the eth such scalar character-
istic. Consider an application to international trade, where upstream firm i may be in a different country than
                                                      u,d
downstream firm a. The match-specific characteristic xha,ii,e may be the tariff rate that a’s country levies on i’s
exports. In this case, the feature of f that governs sorting is f ’s second derivatives.
                                                                                                                                                                                                                 
                                                                                                                                            u,d                   u,d                    u,d                 u,d
Theorem 5.2. Let the two scalars x1 and x2 be distinct elements of ~x (i,Cu ) = cat                                                        xha  ,ii,1
                                                                                                                                                      , . . . , xha ,ii,K
                                                                                                                                                                            , . . . ,  xha ,ii,1
                                                                                                                                                                                                 , .
                                                                                                                                                                                                   n
                                                                                                                                                                                                     . . , x
                                                                                                                                                                                                           nha ,ii,K
                                                                                                                                                                                                                       ,
                                                                                                                                                 1                     1
corresponding to different matches. Let ~x be a given point of evaluation of f .
                  ∂ 2 f 0 (~x)                                    ∂ 2 f 0 (~x)
   1. Assume        ∂ 2 x1
                                 6= 0. The sign of                  ∂ 2 x1
                                                                                 is identified.

                  ∂ 2 f 0 (~x)                   ∂ 2 f 0 (~x)                              ∂ 2 f 0 (~x) ∂ 2 f 0 (~x)
   2. Assume        ∂ 2 x1
                                 6= 0 and          ∂ 2 x2
                                                                6= 0. The ratio              ∂ 2 x1
                                                                                                       / ∂ 2x          is identified.
                                                                                                                2

Like with firm-specific characteristics, a researcher can measure the relative importance of sorting on various
                                                                          ∂ 2 f 0 (~x) ∂ 2 f 0 (~x) 29
characteristics in the production function,                                 ∂ 2 x1
                                                                                      / ∂ 2x .
                                                                                               2

   29 Some might think firm-specific characteristics are a special case of match-specific characteristics. Firm-specific characteristics in-

crease the difficulty of showing the identification of features of f 0 because the same firm characteristics must appear on the left and the
right sides of a local-production-maximization inequality. By contrast, hypothetical markets exist where the match-specific characteristics
for the matches ha, ii and ha, ji may take on any pair values, under Assumption 5.1.


                                                                                                 23
      Note that the proofs of the identification theorems are more general than the statements. The proofs do not
require strong properties on the characteristics not given special attention in the statement of the theorems. For
example, x1 and x2 could be match-specific, allowing Theorem 5.2 to be applied, while x3 –x6 could be firm
specific, requiring Theorem 5.1. The presence of the match-specific x1 and x2 does not invalidate applying
Theorem 5.1 to x3 –x6 .

5.2.3     Derivative-based identification with group-specific characteristics

Characteristics can be specific to a group of downstream firms and an upstream firm that the group matches
                                                                           
                        group       group                group
with. Let ~x (i,Cu ) =~x(i,C                                                                            u
                             u ) = x(i,Cu ),1 , . . . , x(i,Cu ),K , where there are K scalar group-(i,C )-specific characteristics,
                                               group
with the eth such scalar characteristic being x(i,C u ),e . An example of using the estimator in this paper for the

group-characteristic case is Fox and Bajari (2009), who model bidders matching to a package of geographic
licenses in a spectrum auction. A characteristic of a package of licenses is the extent of the geographic com-
plementarities among the licenses. Fox and Bajari use a measure like the gravity equation in international trade
to create a proxy for these geographic complementarities.
                                                                                                                                  
                                                                                  group       group                group
Theorem 5.3. Let the two scalars x1 and x2 be distinct elements of ~x (i,Cu ) = ~x(i,C u ) = x(i,Cu ),1 , . . . , x(i,Cu ),K ,

corresponding to different matches. Let ~x be a given point of evaluation of f .
                  ∂ 2 f 0 (~x)                              ∂ 2 f 0 (~x)
    1. Assume       ∂ 2 x1
                                 6= 0. The sign of            ∂ 2 x1
                                                                           is identified.

                  ∂ 2 f 0 (~x)              ∂ 2 f 0 (~x)                          ∂ 2 f 0 (~x) ∂ 2 f 0 (~x)
    2. Assume       ∂ 2 x1
                                 6= 0 and     ∂ 2 x2
                                                           6= 0. The ratio          ∂ 2 x1
                                                                                              / ∂ 2x          is identified.
                                                                                                       2

The proof of this theorem is omitted because the mathematical argument is nearly identical to the proof of
Theorem 5.2.


6       Nonparametric identification of orderings of production
Section 2.5 motivated why identifying orderings of production levels is distinct from derivative-based identifi-
cation. Here I focus on precise statements of general theorems.


6.1      Preliminaries for the identification of orderings of production
Positive monotonic transformations preserve rankings, so we must rule those transformations out.
Assumption 6.1. Let F be a class of production functions. For any two members of this class F , f 1 and f 2 ,
for no positive, strictly monotonic function m is it the case that f 1 (~x) = m ◦ f 2 (~x) for all ~x.
Matzkin (1993) presents classes of functions that rule out positive monotonic transformations. An example is
the class of least-concave functions.
      Recall that ~x is one long vector of scalar characteristics. Call the first, scalar element of this vector, x1 . Call
all other elements ~x−1 . The collection of market characteristics is X .
Assumption 6.2.




                                                                                     24
     • The conditional density of characteristic 1, g (x1 |~x−1 , X\~x), has an everywhere positive density in R.30

     • Each f ∈ F is continuous in its argument x1 and is either strictly increasing or strictly decreasing in x1 .

     • X has support equal to the product of the marginal supports of the scalar elements of the vectors that
        comprise X .

     • Each scalar element of a vector in X has either strictly discrete or strictly continuous support.

     • Each f ∈ F is continuous in any scalar element of ~x with continuous support.

The assumption allows all but one of the characteristics in ~x to have discrete or qualitative support.31 This as-
sumption replaces the earlier Assumption 5.1, which is only for the derivative-based identification theorems.32
     The technical use of Assumption 6.2 involves the lack of a positive monotonic transformation and its re-
lationship to a strict inequality. I state the argument in a separate lemma because the continuous-covariate
argument is used in the same way in the proofs of the three identification theorems on the orderings of produc-
tion.
Lemma 6.1. Let f 1 and f 2 be production functions in a class F satisfying Assumption 6.1. If Assumption 6.2
holds, then there exists two vectors ~xa and ~xb such that either

                                                 f 1 (~xa ) > f 1 (~xb ) and f 2 (~xa ) < f 2 (~xb )


or
                                                 f 1 (~xa ) < f 1 (~xb ) and f 2 (~xa ) > f 2 (~xb ) .

This lemma will be used where ~xa and ~xb are part of X for the same matching market.


6.2     Identifying orderings of production
Identification proofs in the single-agent maximum score tradition (Matzkin, 1993) typically amount mathemat-
ically to Lemmas 4.1 and 6.1. Consequently, the identification proof for each case focuses on an issue that
is new to matching games: embedding the inequalities from Lemma 6.1 in a local-production-maximization
inequality, meaning an inequality where each upstream firm switches at most one downstream firm at a time.
Thus, the proofs look for market characteristics X where the comparisons in Lemma 6.1 are decisive in rank
ordering the production of two larger, otherwise similar assignments, A1 and A2 . I consider group, match and
firm-specific characteristics separately. Identification is Definition 5.1 subject to the lack of a positive mono-
tonic transformation in Assumption 6.1. I list the theorems in increasing difficulty of the proofs.
   30 The notation X\~x means all elements of X other than those in the specified vector ~x. Recall ~x can include firm-, match- and group-

specific characteristics. This is a slight notational abuse as ~x is a long vector formed from the concatenation of subvectors, rather than the
set of such subvectors.
   31 The assumption that the support of x is R, rather than some compact subset of R, is made for convenience. Manski (1988) and
                                              1
Horowitz (1998) show how to relax the full support assumption for the identification of single-agent binary-choice models. A continuous
product quality could be a candidate for the continuous upstream product characteristic x1 .
   32 The identification arguments in this paper are not related to the identification-at-infinity arguments made in the literature on selection

and the related work on the special regressor estimator of Lewbel (2000). Identification based on special regressor arguments might
be possible if there are match-specific regressors with full support and independence from the error terms. Arguments exist to weaken
the full support assumptions (Magnac and Maurin, 2007). Special-regressor identification arguments do not lead to tractable estimators
for matching games. The Lewbel single-agent, multinomial-choice estimator requires multidimensional density estimation and therefore
suffers from a data curse of dimensionality in the number of choices.


                                                                         25
    Group-specific characteristics allow the arguments of production functions to move around more flexibly
than in the other cases.
                                                                           
                                group       group                group
Theorem 6.1. Let ~x (i,Cu ) = ~x(i,C u ) = x(i,Cu ),1 , . . . , x(i,Cu ),K . Then the production function is identified in the

class F .

    Match-specific characteristics make the identification proof more complex than before. The reason is that
the equilibrium concept of pairwise stability, Definition 3.2, involves only one unmatched pair deviating at
a time. To show identification, we must start with Lemma 6.1 and be able to construct local-production-
maximization inequalities where the coalition characteristics differ by the arguments corresponding to only
one match between an upstream and a downstream firm. Remember the production function requires a vector
of arguments for each match of an upstream firm. To apply this and the following theorems, the maximum
quota of an upstream firm must be known.
                                                                                                               
                                          u,d                   u,d                    u,d                 u,d
Theorem 6.2. Let ~x (i,Cu ) = cat        xha  ,ii,1
                                                    , . . . , xha ,ii,K
                                                                          , . . .
                                                                                 n
                                                                                  ,  xha ,ii,1
                                                                                               ,
                                                                                                n
                                                                                                 . . . , xha ,ii,K
                                                                                                                     . Also, let there be assignments
                                              1              1
A that contain as many groups of matches as the maximum quota of an upstream firm. The production function
is identified in the class F .

The theorem requires the matching market to be sufficiently large so that the comparisons needed for identifi-
cation can be formed. The matching market may need to allow several firms on each side of the market because
pairwise stability considers firms swapping only one partner at a time, while a production function can have as
its arguments the characteristics of the matches involving many downstream firms.
    An alternative way of identifying a production function involving the characteristics of the matches involv-
ing many downstream firms may be to use a solution concept such as the core. The core solution concept would
give inequalities where the researcher can have groups of downstream firms matched to the same upstream firm
deviating at once. An achievement of this paper is to show identification without relying on the crutch of a
stronger equilibrium concept: only pairwise stability is imposed. This is important, as the core is a very strong
equilibrium concept. Core outcomes are less likely to exist and believing that a many-to-many outcome is in the
core would require a lot of communication and coordination for the agents in a decentralized matching market.
I show that pairwise stability, which requires only communication between one upstream and one downstream
firm at a time, is enough for point identification in many-to-many matching games where production functions
are not additively separable in the characteristics of the matches for multiple downstream firms.
    Firm-specific characteristics require an additional normalization. As in the example in Section 2.5, the
value of being unmatched will be 0. Informally, identification considers the probabilities of assignments where
certain firms are unmatched.33 Firms that are more likely to be unmatched in an assignment are likely to have
lower contributions to production.
                                                                                                              
Theorem 6.3. Let ~x (i,Cu ) = catu , . . . , xu
                                xi,1                    d               d                  d                d
                                              i,K u , xa1 ,1 , . . . , xa1 ,K d , . . . , xan ,1 , . . . , xan ,K d   . Let the value of any
firm remaining unmatched be 0, or f ~xa = f ~xi = 0 for all i ∈ U , a ∈ D and f ∈ F . Further, let there be
                                         d           u
                                                      

assignments A that contain as many matched coalitions as three times the maximum quota of an upstream firm.
Then the production function is identified in the class F .
  33 Choo and Siow (2006) estimate a logit-based one-to-one matching model of marriage that requires data on the fraction of each

observable type of man or woman that is single.




                                                                      26
7     Conclusions
This paper discusses identification of production functions in matching games first studied by Koopmans and
Beckmann (1957), Shapley and Shubik (1972) and Becker (1973). These matching games allow endogenous
transfers that are additively separable in payoffs. Under a pairwise stable equilibrium, production functions
must satisfy inequalities that I call local production maximization: if an exchange of one downstream firm
per upstream firm produces a higher production level, than it cannot be individually rational for some agent.
For one-to-one matching games this condition is related to social efficiency, but for general many-to-many
matching games it is not.
    It is not obvious what types of economic parameters are identified from data on only who matches with
whom. The identification theorems cover both certain derivatives of production functions and orderings of
production levels. The derivative-based results generalize the work of Becker (1973) to the case of each agent
having a vector of types, many-to-many matching as well as production functions where pairs of inputs are not
complements over their entire supports. One can identify whether any two inputs or complements or substitutes.
Importantly, one can identify the value of the ratio of complementarities for two pairs of inputs, at any point.
Thus, one can run “horse race” analyses to identify the relative importance of different pairs of characteristics
in match production.
    The results on the ordering of production levels extend the single-agent work of Matzkin (1993) to match-
ing games, where agents cannot unilaterally choose partners and so identification requires working with the
equilibrium structure of the game. We can learn whether certain inputs are “goods” that always raise output.
We can distinguish between f 1 (a1 , i1 ) = − (a1 − i1 )2 and f 2 (a1 , i1 ) = 2a1 · i1 .
    The identification results are relevant for empirical work. In Fox and Bajari (2009), we use both of these sets
of identification theorems to measure the efficiency of a FCC spectrum auction compared to some counterfac-
tual outcomes. Without identification theorems, it would be unclear whether qualitative match data is sufficient
to identify some notion of efficiency. This paper shows qualitative match data can allow such measurements in
transferable utility matching games.


A      Proofs
A.1     Lemma 3.1: Pairwise stability implies local production maximization
Substitute t˜hb,ii into (7) and cancel the transfers ∑c∈Ciu (A)\{a} thc,ii to give
                                                                                                                             
            ru (~x (i,Ciu (A))) + tha,ii ≥ ru (~x (i, (Ciu (A) \ {a}) ∪ {b})) + rd (~x (i, {b})) − rd (~x ( j, {b})) − thb, ji .

                                                                         
Call this no-deviation inequality nd ha, ii , hb, ji , A,tha,ii ,thb, ji . If π ha, ii is the new downstream partner of i in the
permutation, let j (π ha, ii) be a function that gives the original partner of π ha, ii, in B1 . So hπ ha, ii , j (π ha, ii)i ∈




                                                                    27
                                                                                             
B1 . Now form ∑ha,ii∈B1 nd ha, ii , hπ ha, ii , j (π ha, ii)i , A,tha,ii ,thπha,ii, j(πha,ii)i . This gives


      ∑       ru (~x (i,Ciu (A))) +     ∑        tha,ii ≥
   ha,ii∈B1                           ha,ii∈B1

                                                       ∑       ru (~x (i, (Ciu (A) \ {a}) ∪ {π ha, ii})) +
                                                    ha,ii∈B1
                                                              n                                                                                    o
                                                     ∑         rd (~x (i, {π ha, ii})) − rd (~x ( j (π ha, ii) , {π ha, ii})) − thπha,ii, j(πha,ii)i .
                                                   ha,ii∈B1


By the definition of a permutation, each tha,ii for ha, ii ∈ B1 appears on both the left and right sides. The transfers
cancel. Similarly, each equilibrium rd (~x ( j (π ha, ii) , {π ha, ii})) appears on the right side with a negative sign and
each deviation rd (~x (i, {π ha, ii})) appears on the right side with a positive sign. Moving ∑ha,ii∈B1 rd (~x ( j (π ha, ii) , {π ha, ii}))
to the left side and substituting the definition of a production function, Definition 3.1, gives the local-production-
maximization inequality in the lemma.


A.2       Theorem 5.1: Derivative-based identification with firm-specific covariates
A.2.1     Part 1

The vector ~x is given in the statement of the theorem. To avoid confusion of the point ~x with the function
                                                                                                                   ∂ 2 f 0 (~y)
~x i,Ciu , I relabel the vector ~x as ~y inside this proof. I will focus on the case where
        
                                                                                                                   ∂ x1 ∂ x2
                                                                                                                                  > 0. The proof for the
                 ∂ 2 f (~y)
case where       ∂ x1 ∂ x2
                              < 0 is very similar.
                                                                  ∂ 2 f 1 (~y)
    For an arbitrary f 1 ∈ F , f 1 6= f 0 where                   ∂ x1 ∂ x2
                                                                                 < 0, by Definition 5.1, the definition of identification of a
feature of a function, I must show that there does not exist S1 corresponding to f 1 where Pr A | X; f 0 , S0 =
                                                                                                                                          

Pr A | X; f 1 , S1 for all (A, X) except perhaps a set of X of probability 0. By the key Assumption 4.1, a sufficient
                  

condition involves showing that there exists a continuum of market characteristics X with positive probability
and a corresponding matching situation where f 0 and f 1 give different implications for a local-production-
maximization inequality, of the form in Definition 3.3. At each of these markets X , there will be a particular
assignment A1 and another assignment A2 where, by Assumption 4.1, Pr A1 | X; f 0 , S0 > Pr A2 | X; f 0 , S0 while
                                                                                                                                               

Pr A1 | X; f 1 , S1 < Pr A2 | X; f 1 , S1 for any S1 ∈ S . Therefore, the conditions of Definition 5.1 will be satisfied.
                                        

    Let me explain the steps of the proof. First, I derive an appropriate local-production-maximization inequal-
ity and show that the inequality will be reversed if the production function is f 1 instead of f 0 . Second, I show
how I can embed the characteristics in the local-production-maximization inequality into a matching market
with characteristics X . Third, I show that I can locally vary all the characteristics in X to find a continuum of
markets X with the property of Pr A1 | X; f 0 , S0 > Pr A2 | X; f 0 , S0 while Pr A1 | X; f 1 , S1 < Pr A2 | X; f 1 , S1
                                                                                                                                                      

for any S1 ∈ S .
    First, I explore deriving a local-production-maximization inequality. Let ek = (0, . . . , 0, 1, 0, . . . , 0), where the
1 is in the kth position. Without loss of generality, let x1 be the first position of ~x and let x2 be the second
position. The definition of a cross-partial derivative is the limit of the middle difference quotient:

                                    ∂ 2 f (~y)       f (~y + he1 + he2 ) − f (~y + he1 ) − f (~y + he2 ) + f (~y)
                                               = lim                                                              .                                 (16)
                                    ∂ x1 ∂ x2 h→0                                h2




                                                                                   28
Let ν > 0 be given. By the definition of a limit, we can find h > 0 such that

                                      ∂ 2 f (~x) f (~y + he1 + he2 ) − f (~y + he1 ) − f (~y + he2 ) + f (~y)
                                                −                                                             < ν.
                                      ∂ x1 ∂ x2                              h2

     ∂ 2 f 0 (~y)
As   ∂ x1 ∂ x2
                    > 0, there will be a h0 > 0 such that the numerator of the middle difference quotient at f = f 0 is
positive, or
                                                                                        
                                     f 0 ~y + h0 e1 + h0 e2 − f 0 ~y + h0 e1 − f 0 ~y + h0 e2 + f 0 (~y) > 0,

or
                                                                                                      
                                        f 0 ~y + h0 e1 + h0 e2 + f 0 (~y) > f 0 ~y + h0 e1 + f 0 ~y + h0 e2 .                                                              (17)

     ∂ 2 f 1 (~y)
As   ∂ x1 ∂ x2
                    < 0, there exists h1 > 0 where

                                                                                                      
                                        f 1 ~y + h1 e1 + h1 e2 + f 1 (~y) < f 1 ~y + h1 e1 + f 1 ~y + h1 e2 .                                                              (18)

The argument for f 1 is symmetric to the argument for f 0 and is omitted. Set h = min h0 , h1 . The inequalities
                                                                                                                                                

(17) and (18) hold for any such h.
     Now let me argue that (17), and by a similar argument (18), is a local-production-maximization inequality:
it satisfies Definition 3.3. To do this I need to form B1 and B2 , as in the definition, and show how a hypothetical
swap of downstream firm partners could produce (17). Let B1 = {ha, ii , hb, ji} and B2 = {hb, ii , ha, ji}, where
these indices refer to arbitrary firms I am creating to show (17) satisfies Definition 3.3. Also, let there be
some Ciu and Cuj of sufficient size to reproduce the number of non-empty (0/ , representing unfilled matches)
                                                                                                                                                                      
elements of ~y. We require a ∈ Ciu , a ∈
                                       / Cuj , b ∈ Cuj , and b ∈
                                                               / Ciu . Then define ~x i,Ciu = ~y + he1 + he2 , ~x j,Cuj = ~y,
                                                                                                                                          
                                                       
~x i, Ciu \ {a} ∪ {b} = ~y + he1 and ~x j, Cuj \ {b} ∪ {a} = ~y + he2 . With π ha, ii = b and π hb, ji = a, inspection
                    

shows (17) satisfies Definition 3.3.
     Further, it is important to show that this exchange of partners can be accomplished with firm-specific
characteristics, as that is a maintained hypothesis in the theorem being proved. The theorem requires that x1
and x2 be from different firms. As only one upstream firm’s characteristics enter each production function, it is
without loss of generality to say that x2 is a characteristic of a downstream firm. To complete the argument that
(17) satisfies Definition 3.3 for the case of firm-specific characteristics, let downstream firms a and b have the
same baseline characteristics, except that firm a has he2 more of characteristic x2 than firm b. Using the notation
                                                                                                                   
~x (i,Cu ) = cat         u , . . . , xu
                        xi,1                   d
                                      i,K u , xd
                                                                 d
                                                   ,1 , . . . , xd   ,K d
                                                                                , . . . , xddn ,1 , . . . , xdd   ,K d
                                                                                                                              for Cu = {d1 , . . . , dn }, then xa,2
                                                                                                                                                                 d − he = xd ,
                                                                                                                                                                       2   b,2
                                               1                 1                                            n
where now a is one of the firms in Ciu . On the left of (17), the match ha, ii puts the downstream firm a with
he2 more x2 in either a direct partnership with an upstream firm i with h1 e1 more x1 than upstream firm j or
an indirect partnership with another downstream firm, say ci ∈ Ciu , with h1 e1 more x1 than the corresponding
                                                  u − he = xu or xd − he = xd .34
downstream firm c j in Cuj . In notation, either xi,1   1   j,1   ci ,1 1   c j ,1
     The matches hb, ii and ha, ji form on the right side of (17). The firm a with h2 e2 more of x2 is transferred
from the set of matches involving i with h1 e1 more x1 to the set of matches involving j without any more x1 .
Likewise, the downstream firm b without any more x2 matches to i and its downstream firm partners, which
together have h1 e1 more x1 than the matches involving j. The important requirement that is satisfied is that each
  34 Note some abuses of notation:    if x2 is the second characteristic of~x (i,Ciu ), I then say it is also the second characteristic of~xad , xa,2
                                                                                                                                                  d . This

is done for clarity: to keep “2” referring to the same variable whether I am referring to it as an element of the entire vector of production
function arguments ~x (i,Ciu ) or as an element of the vector of characteristics of firm a, ~xad .


                                                                                              29
move switches the characteristics of only the firm that is actually switching. Therefore, (17) satisfies Definition
3.3 for the case of firm-specific characteristics.
    The second step of the proof is that I will argue that I can embed B1 and B2 in an entire matching market.
Let B3 be a larger set of matches that includes the matches corresponding to the downstream firms in Ciu \ {a}
and Cuj \ {b}. The exact choice of B3 plays no role in the proof, other than to ensure Ciu \ {a} and Cuj \ {b} are large
enough given the number of non-empty elements (representing filled quota slots) in ~y. Then set A1 = B1 ∪ B3
and A2 = B2 ∪ B3 .
    Consider the set of the unique firm-specific characteristics in an inequality, here
                                                                                                                                                                
         n                           o         [ n                                      o   n                       o    [ n                              o
               u              u
    ζ=        xi,1 , . . . , xi,K u        ∪                 xdda ,1 , . . . , xdd ,K d           u              u
                                                                                              ∪ x j,1 , . . . , x j,K u    ∪      xdda ,1 , . . . , xdd      d
                                                                                                                                                                   .
                                                                                   a                                                                    a ,K
                                                a∈Ciu                                                                            a∈Cuj


Let there be some collection X of characteristics for all firms in the market. The choice of X plays no role in
the proof, except that ζ must be a subset of X .
    Assumption 4.1 and (17) imply Pr A1 | X; f 0 , S0 > Pr A2 | X; f 0 , S0 while Assumption 4.1 and (18) imply
                                                                                                                     

Pr A1 | X; f 1 , S1 < Pr A2 | X; f 1 , S1 for any S1 ∈ S .
                                        

    I now move to the third stage of the proof. Definition 5.1 requires a continuum of markets with characteris-
tics X with this property. Let v be the change of notation that makes ζ into one long vector, where all elements
enter as scalars. Likewise, let ~z be an arbitrary vector of length |v|. For ~z, let ~z1 , . . . ,~z4 be the equivalent of the
                                                                                                                      
four objects ~x i,Ciu , ~x j,Cuj , ~x i, Ciu \ {a} ∪ {b} and ~x j, Cuj \ {b} ∪ {a} . Switching from ~z to ~z1 , . . . ,~z4 and
                                                                                   

back is just a change of notation as the characteristics of all firms enter the long vector ~z.
    F contains only continuous functions, so


                                                              g (~z | f ) ≡ f (~z1 ) + f (~z2 ) − f (~z3 ) − f (~z4 )


is also a continuous function in ~z, for any f ∈ F . The definition of a continuous function g (z) states that g−1 (V )
is an open neighborhood of v whenever V is an open neighborhood of g (v). Because the inequalities are strict,
there is an open neighborhood V 0 around g v; f 0 where p > 0 for p ∈ V 0 and there is an open neighborhood V 1
                                                                                    

around g v; f 1 < 0 where p < 0 for p ∈ V 1 . Because the object v is the same in both the f 0 and f 1 constructions,
                     

W = g−1 V 0 ; f 0 ∩ g−1 V 1 ; f 1 6= 0/ and is itself an open neighborhood of v, as both g−1 V 0 ; f 0 and g−1 V 1 ; f 1
                                                                                                                      

are open sets by the definition of continuity and because topologies are closed under finite intersections.
    Divide any market characteristics X into X1 and X2 , where X1 is the set ζ for that X , where here the firm-
specific characteristics in ζ represent the characteristics of the corresponding firms given an arbitrary X (like
the argument ~z above) rather than terms involving the ~y from the statement of the theorem. Also, X2 = X\X1 ,
so X is a one-to-one change of variables (or just notation) of (X1 , X2 ). By Assumption 5.1, X has support
equal to the product of the marginal supports of the scalar elements of the vectors that comprise X . There-
fore, the probability that (X1 , X2 ) lies in W × Rs is strictly positive, where s is the number of elements of X2 .
By construction, all market characteristics (X1 , X2 ) in W × Rs satisfy Pr A1 | X; f 0 , S0 > Pr A2 | X; f 0 , S0 while
                                                                                                                                                                

Pr A1 | X; f 1 , S   1     < Pr A2 | X; f 1 , S         1     for any S1 ∈ S .
                                                         




                                                                                                30
A.2.2         Part 2

We are given a point ~y (relabeled from ~x in the statement of the theorem) and there is an arbitrary f 1 ∈ F where
∂ 2 f 0 (~y) ∂ 2 f 0 (~y)         ∂ 2 f 1 (~y) ∂ 2 f 1 (~y)
            /
∂ x1 ∂ x2 ∂ x3 ∂ x4
                            6=                /
                                  ∂ x1 ∂ x2 ∂ x3 ∂ x4
                                                            .   The goal in broad generality is the same as Part 1: show there exists a contin-
uum of X and two assignments A1 and A2 where Pr A1 | X; f 0 , S0 > Pr A2 | X; f 0 , S0 while Pr A1 | X; f 1 , S1 <
                                                                                                                                                                                                             

Pr A2 | X; f 1 , S          1     for any S1 ∈ S . The proof is more challenging than the proof of Part 1 because now we are
                              
                                                                                                               ∂ 2 f 0 (~y) ∂ 2 f 0 (~y)
trying to identify the value of some feature of f 0 , here                                                                 /
                                                                                                               ∂ x1 ∂ x2 ∂ x3 ∂ x4
                                                                                                                                         ,   rather than just the sign of some feature,
as before.
                                                          ∂ 2 f 0 (~y) ∂ 2 f 0 (~y)
      I will show that the term                                       /
                                                          ∂ x1 ∂ x2 ∂ x1 ∂ x3
                                                                                       is identified, where x1 is the same characteristic in the numerator
                                                                                                                                                                                   ∂ 2 f 0 (~y) ∂ 2 f 0 (~y)
and the denominator. Then, by Young’s / Clairaut’s / Schwarz’s theorem, arbitrary ratios                                                                                                       /
                                                                                                                                                                                   ∂ x1 ∂ x2 ∂ x3 ∂ x4
                                                                                                                                                                                                               can
                                                                    ∂ 2 f 0 (~y) ∂ 2 f 0 (~y)           ∂ 2 f 0 (~y) ∂ 2 f 0 (~y)
be identified by comparing, say,                                                /
                                                                    ∂ x1 ∂ x2 ∂ x1 ∂ x3
                                                                                                 to                 /
                                                                                                        ∂ x3 ∂ x4 ∂ x3 ∂ x1
                                                                                                                                  .       Cross-partial derivatives are symmetric if
the second-partial derivatives are continuous, which they are because Assumption 6.1 states f is three-times
differentiable.
                                                                                                ∂ 2 f 0 (~y)             ∂ 2 f 0 (~y)
      By Part 1 of theorem, we know the signs of                                                ∂ x1 ∂ x2
                                                                                                               and       ∂ x1 ∂ x3
                                                                                                                                        if they are nonzero, as Part 2 requires. If f 1
                                                     ∂ 2 f 1 (~y)
                                           ∂ 2 f 1 (~y)
implies different signs for                ∂ x1 ∂ x3
                                                        ,
                                                     ∂ x1 ∂ x2
                                                                    and                   then by Part 1 we can distinguish f 0 and f 1 . So we can restrict
                                            ∂ 2 f 0 (~y)                                              ∂ 2 f 1 (~y)                        ∂ 2 f 0 (~y)         ∂ 2 f 1 (~y)
attention to the case where the signs of ∂ x ∂ x                                          and         ∂ x1 ∂ x2
                                                                                                                     as well as           ∂ x1 ∂ x3
                                                                                                                                                         and   ∂ x1 ∂ x3
                                                                                                                                                                              are the same. I will first
                                                 1 2
                           2                   2
consider the case where ∂∂x f∂(~xy) > 0 and ∂∂x f∂(~xy)                                                                  f 0, f 1
                                                                                                                     
                                                                                          > 0 for f ∈                                   . The other cases are discussed at the end of
                            1 2                  1 3
the proof.
      The outline of the proof follows. The most novel step comes first: I find a key inequality that arises from the
numerator of the middle difference quotient, (16), and that has a different direction for f 0 and f 1 . For example,
this can be seen as a situation where f 0 would predict sorting on characteristics x1 and x2 while f 1 would predict
sorting on characteristics x1 and x3 when sorting on both pairs simultaneously is physically impossible. The
second step is that I show that this inequality is a local-production-maximization inequality. Some final steps
follow arguments in Part 1 and are omitted for brevity.
                                                                                                                                                               ∂ 2 f (~y)
      Let h1,2 be the limit argument from the middle difference quotient, (16), for                                                                            ∂ x1 ∂ x2
                                                                                                                                                                          .   Likewise, let h1,3 be the
                                     ∂ 2 f (~y)                                         ∂ 2 f 0 (~y) ∂ 2 f 0 (~y)             ∂ 2 f 1 (~y) ∂ 2 f 1 (~y)          
limit argument for                   ∂ x1 ∂ x3
                                                .   Consider the case                               /
                                                                                        ∂ x1 ∂ x2 ∂ x1 ∂ x3
                                                                                                                         >                /
                                                                                                                              ∂ x1 ∂ x2 ∂ x1 ∂ x3
                                                                                                                                                          and let h1,2,n            n∈N   be a sequence
                        
that converges to 0. Let h1,3,n                              n∈N      be a sequence
                                                                    s 
                                                                     1 ∂ 2 f 0 (~y) ∂ 2 f 0 (~y) ∂ 2 f 1 (~y) ∂ 2 f 1 (~y)
                                                                                                                           
                                                    h1,3,n = h1,2,n                /            +            /              .                                                                                  (19)
                                                                     2 ∂ x1 ∂ x2 ∂ x1 ∂ x3        ∂ x1 ∂ x2 ∂ x1 ∂ x3

 h1,3,n      n∈N    converges to 0 and

                                                          h21,3,n                 ∂ 2 f 0 (~y) ∂ 2 f 0 (~y) ∂ 2 f 1 (~y) ∂ 2 f 1 (~y)
                                                                                                                                                              
                                                                        1
                                                                      =                       /            +            /
                                                          h21,2,n       2         ∂ x1 ∂ x2 ∂ x1 ∂ x3        ∂ x1 ∂ x2 ∂ x1 ∂ x3

is the mean of the two ratios of cross-partial derivatives for all n ∈ N. This choice of h1,3,n ensures

                                                                                           2
                                                                ∂ 2 f 0 (~y) ∂ 2 f 0 (~y) h1,3,n   ∂ 2 f 1 (~y) ∂ 2 f 1 (~y)
                                                                            /            > 2     >             /                                                                                               (20)
                                                                ∂ x1 ∂ x2 ∂ x1 ∂ x3       h1,2,n   ∂ x1 ∂ x2 ∂ x1 ∂ x3

for all n ∈ N.




                                                                                                           31
               ∂ 2 f 0 (~y) ∂ 2 f 0 (~y)       ∂ 2 f 1 (~y) ∂ 2 f 1 (~y)
     Let τ =               /
               ∂ x1 ∂ x2 ∂ x1 ∂ x3
                                           −               /
                                               ∂ x1 ∂ x2 ∂ x1 ∂ x3
                                                                           and

                                                                                
                       f ~y + h1,2 e1 + h1,2 e2 − f ~y + h1,2 e1 − f ~y + h1,2 e2 + f (~y)
    ϒ h1,2 , h1,3 ; f =                                                                     ·
                                                        h21,2
                                                                                                                    !−1
                                                   f ~y + h1,3 e1 + h1,3 e3 − f ~y + h1,3 e1 − f ~y + h1,3 e3 + f (~y)
                                                                                                                                                                              (21)
                                                                                   h21,3

                                                                                                                                                                    ∂ 2 f (~y) ∂ 2 f (~y)
for f ∈ F . By the definition of a cross-partial derivative, (16), the ratio ϒ h1,2,n , h1,3,n ; f converges to
                                                                                                                                           
                                                                                                                                                                              /
                                                                                                                                                                    ∂ x1 ∂ x2 ∂ x1 ∂ x3
for f ∈ f 0 , f 1 as n → ∞ and h1,2,n , h1,3,n → (0, 0). Then there exists some n1 ∈ N where, for all n ≥ n1 , n ∈ N,
                                                                     
                         ∂ 2 f 0 (~y) ∂ 2 f 0 (~y)                                                     2 1            2 1
 ϒ h1,2,n , h1,3,n ; f 0 − ∂ x ∂ x / ∂ x ∂ x <                        and ϒ h1,2,n , h1,3,n ; f 1 − ∂∂ x f ∂(~xy) / ∂∂ x f ∂(~xy) < τ3 . The choice of distance
                                                                  τ
                                                                                                 
                                   1       2         1   3        3                                       1    2        1    3
τ
3   ensures that
                                                                            h2                              
                                                                               1,3,n
                                                     ϒ h1,2,n , h1,3,n ; f 0 > 2     > ϒ h1,2,n , h1,3,n ; f 1                                                                (22)
                                                                              h1,2,n

for all n ≥ n1 , n ∈ N. Define

                                                                                 
    ∆ h1,2 , h1,3 ; f = f ~y + h1,2 e1 + h1,2 e2 − f ~y + h1,2 e1 − f ~y + h1,2 e2 + f (~y) −
                                                                                                                             
                                                             f ~y + h1,3 e1 + h1,3 e3 − f ~y + h1,3 e1 − f ~y + h1,3 e3 + f (~y)


for f ∈ F . Choose h1,2 , h1,3 = h1,2,n , h1,3,n . Substituting the definition of ϒ h1,2,n , h1,3,n ; f into (22) and
                                                                                                                                                         

resulting algebra shows that, at h1,2 , h1,3 , the ratios h21,3,n /h21,2,n cancel in all terms and
                                                                      


     f 0 ~y + h1,2 e1 + h1,2 e2 − f 0 ~y + h1,2 e1 − f 0 ~y + h1,2 e2 + f 0 (~y)
                                                                   
                                                                              >1>
     f 0 ~y + h1,3 e1 + h1,3 e3 − f 0 ~y + h1,3 e1 − f 0 ~y + h1,3 e3 + f 0 (~y)
                                                     f 1 ~y + h1,2 e1 + h1,2 e2 − f 1 ~y + h1,2 e1 − f 1 ~y + h1,2 e2 + f 1 (~y)
                                                                                                                   
                                                                                                                                                                           (23)
                                                     f 1 ~y + h1,3 e1 + h1,3 e3 − f 1 ~y + h1,3 e1 − f 1 ~y + h1,3 e3 + f 1 (~y)

and so
                                                                                                       
                                                             ∆ h1,2 , h1,3 ; f 0 > 0 > ∆ h1,2 , h1,3 ; f 1 .

At this value h1,2 , h1,3 , f 0 and f 1 have different signs for a key term ∆ h1,2 , h1,3 ; f . The same style of argu-
                                                                                                                                      
                                                                                                      ∂ 2 f 0 (~y) ∂ 2 f 0 (~y)       ∂ 2 f 1 (~y) ∂ 2 f 1 (~y)
ments and the same choice of h1,3,n , (19), will apply to the case                                                /
                                                                                                      ∂ x1 ∂ x2 ∂ x1 ∂ x3
                                                                                                                                  <               /
                                                                                                                                      ∂ x1 ∂ x2 ∂ x1 ∂ x3
                                                                                                                                                                .   Only a few
inequalities are reversed.
                                                                  
     Now I will argue that ∆ h1,2 , h1,3 ; f can be used to form a local-production-maximization inequality. Re-
                                                             
arrange the inequality ∆ h1,2 , h1,3 ; f > 0 so that all signs are positive:

                                                            
    f ~y + h1,2 e1 + h1,2 e2 + f ~y + h1,3 e1 + f ~y + h1,3 e3 + f (~y) >
                                                                                                                                     
                                                                             f ~y + h1,3 e1 + h1,3 e3 + f ~y + h1,2 e1 + f ~y + h1,2 e2 + f (~y) .                            (24)

                                                                                       
Clearly this inequality is satisfied when ∆ h1,2 , h1,3 ; f > 0. The inequality (24) satisfies Definition 3.3 for
some choice of B1 and B2 . Let B1 = {ha, ii , hb, ji , hc, ki , hg, li} and B2 = {hg, ii , hc, ji , hb, ki , ha, li}, where the
permutation π is implied by the definitions of B1 and B2 . Also, let a ∈ Ciu , b ∈ Cuj , c ∈ Cku and g ∈ Clu . Let
                                           
~x i,Ciu = ~y + h1,2 e1 + h1,2 e2 , ~x j,Cuj = ~y + h1,3 e1 , ~x k,Cku = ~y + h1,3 e3 , ~x l,Clu = ~y, ~x i, Ciu \ {a} ∪ {g} = ~y +
                                                                                                                        




                                                                                      32
                             
h1,2 e1 , ~x j, Cuj \ {b} ∪ {c} =~y + h1,3 e1 + h1,3 e3 , ~x k, Cku \ {c} ∪ {b} =~y, and ~x l, Clu \ {g} ∪ {a} =~y + h1,2 e2 .
                                                                                                                              
                                                                                                           
Using the notation ~x i,Ciu = cat xi,1 u , . . . xu         d            d                 d              d           d −h e = xd ; either
                              
                                                  i,K u , xd ,1 , . . . xd ,K d , . . . , xdn ,1 , . . . xd ,K d
                                                                                              1
                                                                                                                   : xa,2   1,2 2  g,2
                                                                                                               1                                         n
 u − h e = xu or xd                  d                        u                     u             d                d
xi,1  1,2 1 l,1   mi ,1 − h1,2 e1 = xm ,1 for two firms mi ∈ Ci , mi 6= a and ml ∈ Cl , ml 6= g; xc,2 − h1,3 e3 = xb,2 ; and
                                                                        l
either xuj,1 − h1,3 e1 = xk,1
                          u or xd                   d                          u                       u
                                m j ,1 − h1,3 e1 = xmk ,1 for two firms m j ∈ C j , m j 6= b and mk ∈ Ck , mk 6= c. By inspection,
it can be seen that each match in B1 exchanges a downstream firm partner for a match in B2 . Meanwhile, each
set of arguments ~x i,Ciu on the right can be formed by an exchange of single downstream firm’s characteristics
                                                 

from a set of arguments on the left. Therefore, this construction satisfies Definition 3.3 for the case of firm-
specific characteristics.
        As in the proof of Part 1, I can embed B1 and B2 into a larger matching market. Next, Assumption 4.1 states
that if (24) holds for f ∈ F , then Pr (A1 | X; f , S) > Pr (A2 | X; f , S) for any S ∈ S . Above, we found h1,2 , h1,3
                                                                                                                                                                                                                      

where ∆ h1,2 , h1,3 ; f 0 > 0 and hence where (24) holds for the true f 0 . Likewise, as this point ∆ h1,2 , h1,3 ; f 1 < 0
                                                                                                                                                                                                             

and hence (24) does not hold for the alternative f 1 . Now we need to show that there exists a continuum of
markets X where Pr A1 | X; f 0 , S0 > Pr A2 | X; f 0 , S0 while Pr A1 | X; f 1 , S1 < Pr A2 | X; f 1 , S1 for any S1 ∈ S .
                                                                                                                                                                               

This part of the proof uses similar arguments as the corresponding proof of Part 1 and so is omitted for brevity.
        Recall that by Part 1 of the theorem we can focus on cases where the signs of the cross partials are the same
                                                           ∂ 2 f (~y)      ∂ 2 f (~y)      ∂ 2 f (~y) ∂ 2 f (~y)
for f 0 and f 1 . Before we restricted attention to the case          > 0, ∂ x ∂ x > 0 and ∂ x ∂ x > ∂ x ∂ x for f ∈ f 0 , f 1 .
                                                                                                                    
                                                           ∂x ∂x                                           1       2               1    3                     1     2         1   3
∂ 2 f (~y)         ∂ 2 f (~y)                                                                 ∂ 2 f (~y)                       ∂ 2 f (~y)
                                is without loss of generality,35 but                                                                        > 0 for f ∈ f 0 , f 1 are conditions with
                                                                                                                                                       
∂ x1 ∂ x2
              >    ∂ x1 ∂ x3                                                                  ∂ x1 ∂ x2
                                                                                                           > 0 and             ∂ x1 ∂ x3
some loss of generality. Now we need to argue that the above arguments go through for the other three cases:
∂ 2 f (~y)                      ∂ 2 f (~y)               ∂ 2 f (~y)             ∂ 2 f (~y)                                     ∂ 2 f (~y)                  ∂ 2 f (~y)
∂ x1 ∂ x2
              < 0 and           ∂ x1 ∂ x3
                                               > 0;      ∂ x1 ∂ x2
                                                                      > 0 and   ∂ x1 ∂ x3
                                                                                             < 0; as well as                   ∂ x1 ∂ x2
                                                                                                                                            < 0 and        ∂ x1 ∂ x3
                                                                                                                                                                         < 0. This is simple: in
                                                                                                                                             ∂ 2 f 0 (~y) ∂ 2 f 0 (~y)  ∂ 2 f 1 (~y) ∂ 2 f 1 (~y)
some of these new cases key inequalities may reverse direction, but as                                                                                   /
                                                                                                                                             ∂ x1 ∂ x2 ∂ x1 ∂ x3
                                                                                                                                                                         6=          /
                                                                                                                                                                        ∂ x1 ∂ x2 ∂ x1 ∂ x3
                                                                                                                                                                                                     for all
                                                                                                                                                                               2   0        2    0
                                                                                                                                                                  between ∂∂ x f ∂(~xy) / ∂∂ x f ∂(~xy) and
                                                                                                           
cases, the same arguments as above will show h1,2 , h1,3 can be chosen to lie in
                                                                                                                                                                                  1 2          1 3
∂ 2 f 1 (~y) ∂ 2 f 1 (~y)
            /
∂ x1 ∂ x2 ∂ x1 ∂ x3
                          .     One this is done, the above can all be repeated without much change.36


A.3             Theorem 5.2: Derivative-based identification, match-specific covariates
For conciseness, certain steps of the proof will be replaced with references to similar arguments in Theorem
5.1. Some notation, such as ~y, is also explained in Theorem 5.1.

A.3.1            Part 1

One definition of a second derivative is

                                                                  ∂ 2 f (~y)       f (~y + 2he1 ) − 2 f (~y + he1 ) + f (~y)
                                                                             = lim                                           ,                                                                                (25)
                                                                   ∂ 2 x1      h→0                   h2

where as in the proof of Theorem 5.1, e1 = (1, 0, 0, . . . , 0) is a vector of 0’s except in the first element. Because
            ∂ 2 f 0 (~y)          ∂ 2 f 1 (~y)
                                                 are limits, there will be some h = min h0 , h1 , where h0 and h1 are the respective limit
                                                                                                                       
both          ∂ 2 x1
                           and      ∂ 2 x1
                                                                                              2 0          2 0                                                                        2 0           2 0
   35 Inpart, there is no loss in generality because identifying ∂∂ x f ∂(~xy) / ∂∂ x f ∂(~xy) is equivalent to identifying its inverse, ∂∂ x f ∂(~xy) / ∂∂ x f ∂(~xy) .
                                                                            1 2           1 3                                                                 1 3            1 2
          2         2
  36 If ∂ f (~y) / ∂ f (~y) < 0 for f ∈ f 0 , f 1 , then (19) will involve the square root of a negative number. To fix this, let (19) involve the
                                              
        ∂ x1 ∂ x2 ∂ x1 ∂ x3
                           2       2                                            2 0             2 0             2 1             2 1                              2 0             2 0
absolute values of ∂∂x f∂(~xy) / ∂∂x f∂(~xy) for f ∈ f 0 , f 1 . For the case ∂∂ x f ∂(~xy) / ∂∂ x f ∂(~xy) > ∂∂ x f ∂(~xy) / ∂∂ x f ∂(~xy) , (29) will become ∂∂ x f ∂(~xy) / ∂∂ x f ∂(~xy) >
                                                    
                                   1   2         1   3                                                1    2           1   3            1    2       1   3                                  1   2         1       3
   h2             ∂ 2 f 1 (~y) ∂ 2 f 1 (~y)
− h21,3,n >       ∂ x1 ∂ x2 / ∂ x1 ∂ x3 .      Following the steps of the algebra in the earlier argument, the 1 in (23) will be a -1 and the pair of inequalities
    1,2,n
in (23) will reverse directions once both sides are multiplied by the -1. A different local-production-maximization inequality will arise, but
otherwise the argument is similar to the earlier argument.



                                                                                                      33
arguments for f 0 and f 1 , where both

                                                                      f 0 (~y + 2he1 ) + f 0 (~y) > 2 f 0 (~y + he1 )                                                       (26)

and
                                                                      f 1 (~y + 2he1 ) + f 1 (~y) < 2 f 1 (~y + he1 )                                                       (27)

hold.
      Now I will argue that (26) and by the same argument (27) are local-production-maximization equations,
Definition 3.3. Let B1 = {ha, ii , hb, ji} and B2 = {hb, ii , ha, ji}. Also let there be sufficiently large (to han-
                                                                                                                                                                            
dle ~y) sets Ciu and Cuj where a ∈ Ciu , a ∈
                                           / Cuj , b ∈ Cuj , and b ∈
                                                                   / Ciu . Also define ~x i,Ciu = ~y + 2he1 , ~x j,Cuj =
                                                                                                                                                       
                                                                                
~y, ~x i, Ciu \ {a} ∪ {b} = ~y + he1 and ~x j, Cuj \ {b} ∪ {a} = ~y + he1 . Using the match-specific characteris-
                         
                                                                                                     
                                  u,d                u,d                    u,d                u,d                u,d              u,d         u,d
 tics notation ~x (i,Cu ) = cat xhd   ,ii,1
                                            , . . . xhd  ,ii,K
                                                                 , . . . , xhd  ,ii,1
                                                                                      , . . . xhd  ,ii,K
                                                                                                      n
                                                                                                           , let xha,ii,1
                                                                                                                    n
                                                                                                                          − he1 = xha, ji,1
                                                                                                                                            = xhb,ii,1 and
                                                        1                   1
 u,d               u,d
xha,ii,1 − 2he1 = xhb, ji,1
                            . With π ha, ii = b and π hb, ji = a, inspection shows (17) satisfies Definition 3.3 for the case
of match-specific characteristics.
      The embedding of B1 and B2 in a matching market and the finding of a continuum of markets X with the
key property both follow similar arguments in the proof of Part 1 of Theorem 5.1.

A.3.2          Part 2

We are given a point ~y (relabeled from ~x in the statement of the theorem) and there is an arbitrary f 1 ∈ F where
∂ 2 f 0 (~y) ∂ 2 f 0 (~y)        ∂ 2 f 1 (~y) ∂ 2 f 1 (~y)                                                        ∂ 2 f (~y)             ∂ 2 f (~y)
                                                                                                                                                      > 0 for f ∈ f 0 , f 1 . The
                                                                                                                                                                 
  ∂ 2 x1
            / ∂ 2x          6=     ∂ 2 x1
                                             / ∂ 2x .        I first consider the case where                       ∂ 2 x1
                                                                                                                               > 0 and    ∂ 2 x2
                     2                                2
other cases are discussed at the end of the proof.
                                                                                                                                         ∂ 2 f (~y)
      Let h1 be the index for the approximation term on the right side of (25) for                                                        ∂ 2 x1
                                                                                                                                                      and let h2 be the index for
∂ 2 f (~y)                                      ∂ 2 f 0 (~y) ∂ 2 f 0 (~y)       ∂ 2 f 1 (~y) ∂ 2 f 1 (~y)          
 ∂ 2 x2
           .   Consider the case                  ∂ 2 x1
                                                            / ∂ 2x          >     ∂ 2 x1
                                                                                            / ∂ 2x          and let h1,n        n∈N   be a sequence that converges to 0.
                                                                     2                               2
Let h2,n         n∈N        be a sequence
                                                              s 
                                                               1 ∂ 2 f 0 (~y) ∂ 2 f 0 (~y) ∂ 2 f 1 (~y) ∂ 2 f 1 (~y)
                                                                                                                     
                                                  h2,n = h1,n                /            +            /              .                                                     (28)
                                                               2   ∂ 2 x1       ∂ 2 x2       ∂ 2 x1       ∂ 2 x2

 h2,n      n∈N    converges to 0 and

                                                       h22,n                ∂ 2 f 0 (~y) ∂ 2 f 0 (~y) ∂ 2 f 1 (~y) ∂ 2 f 1 (~y)
                                                                                                                                        
                                                                    1
                                                               =                        / 2          +            / 2
                                                       h21,n        2         ∂ 2 x1       ∂ x2         ∂ 2 x1       ∂ x2

is the mean of the two ratios of second partial derivatives for all n ∈ N. This choice of h2,n ensures

                                                                                        2
                                                             ∂ 2 f 0 (~y) ∂ 2 f 0 (~y) h2,n ∂ 2 f 1 (~y) ∂ 2 f 1 (~y)
                                                                 2
                                                                         / 2          > 2 >             / 2                                                                 (29)
                                                               ∂ x1         ∂ x2       h1,n   ∂ 2 x1       ∂ x2

for all n ∈ N.




                                                                                                   34
                 ∂ 2 f 0 (~y) ∂ 2 f 0 (~y)         ∂ 2 f 1 (~y) ∂ 2 f 1 (~y)
       Let τ =     ∂ 2 x1
                             / ∂ 2x          −       ∂ 2 x1
                                                               / ∂ 2x          and
                                      2                                 2

                                                                                                                                                          !−1
                                    f (~y + 2h1 e1 ) − 2 f (~y + h1 e1 ) + f (~y)                         f (~y + 2h2 e2 ) − 2 f (~y + h2 e2 ) + f (~y)
                 ϒ (h1 , h2 ; f ) =                                               ·                                                                                       (30)
                                                        h21                                                                   h22

                                                                                                                                                            ∂ 2 f (~y) ∂ 2 f (~y)
for f ∈ F . By the definition of a second partial derivative, (25), the ratio ϒ (h1 , h2 ; f ) converges to                                                  ∂ 2 x1
                                                                                                                                                                      / ∂ 2x
                                                                                                                                                                              2
for f ∈ f 0 , f 1 as n → ∞ and h1,n , h2,n → (0, 0). Then there exists some n1 ∈ N where, for all n ≥ n1 , n ∈ N,
                                                                      
                 ∂ 2 f 0 (~y) ∂ 2 f 0 (~y)                                                     2 1          2 1
 ϒ h1 , h2 ; f 0 − ∂ 2 x / ∂ 2 x                                 and ϒ h1 , h2 ; f 1 − ∂ ∂ f2 x(~y) / ∂ ∂ f2 x(~y) < τ3 . The choice of distance
                                                             τ
                                                                                                                                                               τ
                                            <                3                                                                                                  3   ensures
                              1               2                                                       1             2
that
                                                                                  h2                  
                                                                                     2,n
                                                                   ϒ h1 , h2 ; f 0 > 2 > ϒ h1 , h2 ; f 1                                                                  (31)
                                                                                    h1,n

for all n ≥ n1 , n ∈ N. Define

                   ∆ (h1 , h2 ; f ) = f (~y + 2h1 e1 ) − 2 f (~y + h1 e1 ) + f (~y) − ( f (~y + 2h2 e2 ) − 2 f (~y + h2 e2 ) + f (~y))


for f ∈ F . Choose (h1 , h2 ) = h1,n , h2,n for n ≥ n1 . Substituting the definition of ϒ (h1 , h2 ; f ) into (31) and
                                                                       

resulting algebra shows that at (h1 , h2 ), the ratios h22,n /h21,n cancel in all terms and

                        f 0 (~y + 2h1 e1 ) − 2 f 0 (~y + h1 e1 ) + f 0 (~y)     f 1 (~y + 2h1 e1 ) − 2 f 1 (~y + h1 e1 ) + f 1 (~y)
                          0                      0                   0
                                                                            >1> 1
                        f (~y + 2h2 e2 ) − 2 f (~y + h2 e2 ) + f (~y)           f (~y + 2h2 e2 ) − 2 f 1 (~y + h2 e2 ) + f 1 (~y)

and so
                                                                                                        
                                                                      ∆ h1 , h2 ; f 0 > 0 > ∆ h1 , h2 ; f 1 .

At this value h1,2 , h1,3 , f 0 and f 1 have different signs for a key term ∆ h1 , h2 ; f 0 . The same style of arguments
                                                                                                                                 
                                   ∂ 2 f 0 (~y) ∂ 2 f 0 (~y)   ∂ 2 f 1 (~y) ∂ 2 f 1 (~y)
will apply to the case               ∂ 2 x1
                                               / ∂ 2x             <
                                                                 ∂ 2 x1
                                                                           / ∂ 2 x . Only a few                inequalities are reversed.
                                                        2                           2 
       Now we can rearrange the                       inequality ∆ h1 , h2 ; f 0 > 0 , giving

                                  f (~y + 2h1 e1 ) + 2 f (~y + h2 e2 ) + f (~y) > f (~y + 2h2 e2 ) + 2 f (~y + h1 e1 ) + f (~y) .                                         (32)

We can show that this is a local-production-maximization inequality, Definition 3.3, for some choice of B1
and B2 . Let B1 = {ha, ii , hb, ji , hc, ki , hg, li} and B2 = {hg, ii , ha, ji , hb, ki , hc, li}, where the permutation π is im-
plied by the definitions of B1 and B2 . Also, let a ∈ Ciu , b ∈ Cuj , c ∈ Cku and g ∈ Clu . Let ~x i,Ciu = ~y + 2h1 e1 ,
                                                                                                                                          
                                                                                                                                                  
~x j,Cuj = ~y + h2 e2 , ~x k,Ck = ~y + h2 e2 , ~x l,Cl = ~y, ~x i, Ciu \ {a} ∪ {g} = ~y + h1 e1 , ~x j, Cuj \ {b} ∪ {a} =
                                             u                                   u
                                                                                                        

~y + h1 e1 , ~x k, Cku \ {c} ∪ {b} = ~y + 2h2 e2 , and ~x l, Clu \ {g} ∪ {c} = ~y. Using the match-specific character-
                                                                                                
                                                                                                     
                                    u,d                 u,d                    u,d               u,d               u,d                 u,d        u,d
 istics notation ~x (i,Cu ) = cat xhd   ,ii,1
                                              , . . . xhd ,ii,K
                                                                  , . . . ,  xhd ,ii,1
                                                                                       , . . . xhd ,ii,K
                                                                                                n
                                                                                                            , let xha,ii,1
                                                                                                                n
                                                                                                                           − 2h1 e1 = xhg,li,1 = xhb,ki,1 =
                                                         1                 1
 u,d         u,d        u,d        u,d                u,d         u,d        u,d                 u,d        u,d         u,d        u,d        u,d
xhb, ji,1
          = xhc,ki,1 = xhc,li,1 ; xha,ii,1 − h1 e1 = xha, ji,1
                                                               = xhg,ii,1 ; xhb,ki,2 − 2h2 e2 = xha,ii,2 = xha, ji,2
                                                                                                                     = xhc,li,2 = xhg,li,2 = xhg,ii,2 ;
     u,d                u,d         u,d
and xhb,ki,2 − h2 e2 = xhb, ji,2
                                 = xhc,ki,2 . By inspection, it can be seen that each match in B1 exchanges a downstream
firm partner for a match in B2 . Meanwhile, each set of arguments ~x i,Ciu on the right can be formed by re-
                                                                                                                          

placing the characteristics associated with a single match in a set of arguments ~x i,Ciu on the left. Therefore,
                                                                                                                                           

Definition 3.3 is satisfied.
       The remainder of the proof follows arguments in the proofs of Parts 1 and 2 of Theorem 5.1, and so is
omitted.



                                                                                           35
A.4       Lemma 6.1: Continuous characteristics for the identification of production or-
          derings
Without loss of generality, the goal of the proof is to show that the set
                                          n                                                                 o
                                     W 1 = (~xa ,~xb ) | f 1 (~xa ) > f 1 (~xb ) and f 2 (~xa ) < f 2 (~xb )


is non-empty. Let ~x = cat ((x1 ) ,~x−1 ).
     First we want to show that, again without loss of generality,
                                          n                                                                 o
                                     W 2 = (~xa ,~xb ) | f 1 (~xa ) ≥ f 1 (~xb ) and f 2 (~xa ) < f 2 (~xb )


is non-empty. Assume not. Then f 1 and f 2 induce the same ordering, or preference relation in utility theory.
The “only if” direction of Theorem 1.2 in Jehle and Reny (2000) shows that there must exist some positive,
strictly monotonic function m such that f 1 (~xa ) = m ◦ f 2 (~xa ) over the range of values taken on by f 2 . As this
contradicts Assumption 6.1, W 2 must be non-empty.
     We have shown W 2 is non-empty. Take a point (~xa ,~xb ) ∈ W 2 . Then add δ1 > 0 to the x1 element of ~xa . Because
f1   is strictly increasing in x1 , f 1 (~xa + e1 δ1 ) > f 1 (~xb ), where e1 = (1, 0, 0, . . . , 0) is a vector of length equal to the
length of ~xa . Because f 2 is continuous, there exists a δ2 > 0 where f 2 (~xa − e1 δ2 ) < f 2 (~xb ) is preserved. Let
δ = min {δ1 , δ2 }. The points ~xa + e1 δ and ~xb satisfy the requirements of the lemma.


A.5       Theorem 6.1: Identification of production orderings, group characteristics
Let f 0 , f 1 ∈ F , where f 0 is the production function to be identified and f 1 is an alternative where f 1 (~x) 6= m ◦
f 0 (~x) for all ~x any for any positive monotonic function m. The goal is to show there exists a continuum of X and
two assignments A1 and A2 where Pr A1 | X; f 0 , S0 > Pr A2 | X; f 0 , S0 while Pr A1 | X; f 1 , S1 < Pr A2 | X; f 1 , S1
                                                                                                                       

for any S1 ∈ S .
     Lemma 6.1 produces ~x1 and ~x2 such that f 0 (~x1 ) > f 0 (~x2 ) and f 1 (~x1 ) < f 1 (~x2 ) or f 0 (~x1 ) < f 0 (~x2 ) and f 1 (~x1 ) >
f 1 (~x2 ). Focus on the first case. An inequality such as f 0 (~x1 ) > f 0 (~x2 ) considers a group of matches centered
around an upstream firm on the left and another group of matches centered around an upstream firm on the
right. This is not a local-production-maximization inequality (Definition 3.3), which would require at least two
groups, each centered on an upstream firm, on both the left and the right.
     Consider a third set of characteristics, ~x3 . The exact value of ~x3 will not matter for the case of group-specific
characteristics. Add its production to both sides of the inequality f (~x1 ) > f (~x2 ) to give

                                                     f (~x1 ) + f (~x3 ) > f (~x2 ) + f (~x3 ) .                                        (33)

This inequality is satisfied for f = f 0 ; the opposite direction is satisfied for f = f 1 .
     I will now argue that this is a local-production-maximization inequality, Definition 3.3. Let B1 = {ha, ii , hb, ji}
and B2 = {hb, ii , ha, ji}. Also let there be sufficiently large (to handle ~y) sets Ciu and Cuj where a ∈ Ciu , a ∈
                                                                                                                   / Cuj , b ∈ Cuj ,
                                                                                                                               
      / Ciu . Also define ~x i,Ciu = ~x1 , ~x j,Cuj = ~x3 , ~x i, Ciu \ {a} ∪ {b} = ~x2 and ~x j, Cuj \ {b} ∪ {a} = ~x3 .
                                                                                                 
and b ∈
                                                                                                        
                                                                group                 group
Using the group-specific characteristics notation ~x (i,Cu ) = x(i,C u ),1 , . . . , x(i,Cu ),K , these four distinct groups can

have the four different covariate vectors listed. With π ha, ii = b and π hb, ji = a, inspection shows (33) satisfies


                                                                        36
Definition 3.3 for the case of match-specific characteristics.
     The remainder of the proof uses quite similar arguments to those in Part 1 of Theorem 5.1. The four groups
are embedded into a larger matching market. Then I show that there is a continuum of markets X with similar
properties. The main change to the argument is to allow for discrete covariates. I condition on the discrete
elements of X at all steps and vary only the continuous elements to show that the set of markets X has positive
probability. The case with f 0 (~x1 ) < f 0 (~x2 ) and f 1 (~x1 ) > f 1 (~x2 ) is similar: just reverse the local production
maximization inequalities.


A.6        Theorem 6.2: Identification of production orderings, match characteristics
Let f 0 , f 1 ∈ F , where f 0 is the production function to be identified and f 1 is an alternative where f 1 (~x) 6=
m ◦ f 0 (~x) for all ~x and for any positive monotonic function m. Lemma 6.1 produces ~x1 and ~x2 such that f 0 (~x1 ) >
f 0 (~x2 ) and f 1 (~x1 ) < f 1 (~x2 ) or f 0 (~x1 ) < f 0 (~x2 ) and f 1 (~x1 ) > f 1 (~x2 ). Focus on the first case. We will now construct
a local-production-maximization inequality.
                                                                                                                                              
                                                                           u,d                u,d                    u,d                u,d
     For match-specific characteristics, ~x (i,Cu ) = cat                 xha  ,ii,1
                                                                                     , . . . xha  ,ii,K
                                                                                                          , . . . , xha
                                                                                                                    m    ,ii,1
                                                                                                                               , . . . xha
                                                                                                                                   m        ,ii,K
                                                                                                                                                     . Let m =
                                                                                1                1
|Cu | be the number of downstream firms in the set Cu , and hence the number of matches involving upstream
firm i. Therefore, an alternative representation of ~x (i,Cu ) is as a tuple of vectors rather than a concatenation
                                                                                                             
                                                               u,d              u,d                  u,d
of vectors (one long vector). For this proof only, let ~x1 = ~xh1,1i , . . . ,~xhm,1i , where each ~xh1,1i for a = 1, . . . m
                                                                                        
                                                      u,d              u,d
is itself potentially a vector. Likewise, let ~x2 = ~xh1,2i , . . . ,~xhn,2i , where upstream firm 2 has n matches, each
with a vector of characteristics. To further simplify notation, expand the shorter of the two characteristics
collections ~x1 and ~x2 to have the same number of component matches by adding empty sets to the production
vector. Call the common number of component matches h = max {m, n}. If m = 2 and n = 3, ~x1 is expanded to be
                     
   u,d      u,d
 ~xh1,1i ,~xh2,1i , 0/ .
     Starting with an inequality f (~x1 ) > f (~x2 ), we can construct a series {~wc }h−1
                                                                                      c=1 of coalition characteristics that
add the same terms to both sides of f (~x1 ) > f (~x2 ) to create a local-production-maximization inequality of the
form
                                                             h−1                           h−1
                                                f (~x1 ) +   ∑     f (~wc ) > f (~x2 ) +   ∑     f (~wc )                                              (34)
                                                             c=1                           c=1

This inequality will be satisfied for f = f 0 , and will be satisfied with the < direction for f = f 1 .
     A local-production-maximization inequality must satisfy Definition 3.3. The main challenge is that each
group characteristic on the right side of the inequality must differ in only one vector of match-specific char-
acteristics from a characteristics vector on the left side. This is because the equilibrium concept of pairwise
stability does not allow more than one downstream firm to switch for each upstream firm. To show that (34)
is indeed a local-production-maximization inequality, we need to show that we can pick {~wc }h−1
                                                                                             c=1 so that each
term on the right side is only one match-specific characteristic vector separate from a term on the left side. The
general construction of an ~wc for c ≤ h − 1 is
                                                                                                       
                                                     u,d              u,d        u,d              u,d
                                             ~wc = ~xh1,1i , . . . ,~xhh−c,1i ,~xh1,2i , . . . ,~xhc,2i   .


The construction is motivated as follows. From Definition 3.3, let B1 = {hd0 , u0 i , hd1 , u1 i , . . . , hdh−1 , uh−1 i}
and B2 = {hd1 , u0 i , hd2 , u1 i , . . . , hd0 , uh−1 i}. The group centered around upstream firm u0 , with characteristics
          
~x u0 ,Cu0 = ~x1 , replaces one downstream firm, d0 ∈ Cu0 , with a new firm, d1 ∈ Cu1 . A valid new match-specific



                                                                          37
                                                                              u,d
value for u0 ’s new partner d1 is, by intentional choice, ~x (u0 , {d1 }) = ~xh1,2i , the first vector in ~x2 .37 This re-
                                                                                                                                                     
                                                                                       u,d             u,d       u,d
sults in a group of matches with characteristics ~w1 = ~x u0 , Cu0 \ {d0 } ∪ {d1 } = ~xh1,1i , . . . ,~xhh−1,1i ,~xh1,2i ap-
pearing on the right side of (34). Recall that we need to add the same terms on the left and right sides
                                                                                                        
to move from f (~x1 ) > f (~x2 ) to (34). So we add f (~w1 ) = f ~x u1 ,Cu1                                  on the left side. The group cen-
tered around upstream firm u1 replaces one downstream firm, d1 ∈ Cu1 , with d2 ∈ Cu2 . On the right side,
                                  u,d               u,d        u,d      u,d
                                                                                                                     
~w2 = ~x u1 , Cu1 \ {d1 } ∪ {d2 } = ~xh1,1i , . . . ,~xhh−2,1i ,~xh1,2i ,~xh2,2i  . As before, f (~w2 ) = f ~x u2 ,Cu2 appears on
the left side as well.
     This iterative process truncates. A hypothetical ~wh equals ~x2 , one of the original two vectors from the begin-
ning of the proof. Also, ~x1 equals a hypothetical ~w0 , the beginning of the iterative process. The above construc-
tion shows that each ~x (uc ,Cuc ) = ~wc on the left side exchanges one downstream firm dc to yield ~x (uc , (Cuc \ {dc }) ∪ {dc+1 }) =
~wc+1 on the right side. By inspection, each collection of characteristics ~x (uc , (Cuc \ {dc }) ∪ {dc+1 }) is differ-
                                                                                  u,d                                    u,d
ent from ~x (uc ,Cuc ) by the characteristics of one match: ~x (uc , {dc+1 }) = ~xhc+1,2i instead of ~x (uc , {dc }) = ~xhh−c,1i .
Therefore, (34) is a valid local-production-maximization inequality according to Definition 3.3.
     The remainder of the proof follows arguments similar to those in the conclusion of Part 1 of Theorem 5.1
and the extension to discrete covariates in Theorem 6.1. The case with f 0 (~x1 ) < f 0 (~x2 ) and f 1 (~x1 ) > f 1 (~x2 ) is
similar: just reverse the local production maximization inequalities.


A.7        Theorem 6.3: Identification of production orderings, firm characteristics
Let f 0 , f 1 ∈ F , where f 0 is the production function to be identified and f 1 is an alternative where f 1 (~x) 6=
m ◦ f 0 (~x) for all ~x and for any positive monotonic function m. Lemma 6.1 produces ~x1 and ~x2 such that f 0 (~x1 ) >
f 0 (~x2 ) and f 1 (~x1 ) < f 1 (~x2 ) or f 0 (~x1 ) < f 0 (~x2 ) and f 1 (~x1 ) > f 1 (~x2 ). Focus on the first case. We will now construct
a local-production-maximization inequality.
     We need to add the same terms to both sides of the inequality and then argue that the resulting inequality is
a local-production-maximization inequality, where each coalition on the left side is different from a coalition
on the right side only in the identity of one downstream firm. The challenge with firm-specific characteristics
is that the characteristics of firms remain the same on both sides of the inequality, and different characteristics
are in ~x1 and ~x2 .
                                                                                                                                                     
     The characteristics are firm specific: ~x (i,Cu ) = cat           u , . . . , xu
                                                                     xi,1                      d                d                 d                d
                                                                                     i,K u , xa1 ,1 , . . . , xa1 ,K d , . . . , xal ,1 , . . . , xal ,K d   .
                                                                                          
                                                                          d,1          d,1
In this proof only, I will use the notation f (~x1 ) = f ~x1u ,~x1 , . . . ,~xl              to represent the production of a group
                                                                                                                             
                                                                                               d,1
of matches with firm characteristics ~x1 . Here, ~x1u = x1,1       u , . . . , xu                             d         d
                                                                                1,K u and ~xa = xa,1 , . . . , xa,K d . In other words,
                                              
each argument of f ~x1u ,~x1d,1 , . . . ,~xld,1 is a vector of firm-specific characteristics. I put the 1 superscript on these
downstream firms to remind us that their characteristics are part of ~x1 . Also, let l be the maximum of the number
of downstream firms whose characteristics are in ~x1 and ~x2 ; vectors of empty sets can be added as arguments
                                                                                                                                                    
if the numbers of downstream firms in ~x1 and in ~x2 are not equal. Altogether, f (~x1 ) = f ~x1u ,~x1d,1 , . . . ,~xld,1 and
                                        
f (~x2 ) = f ~x2u ,~x1d,2 , . . . ,~xld,2 .
     The proposed rewriting of f (~x1 ) > f (~x2 ) to make it a local-production-maximization inequality by adding
the same terms to both sides of the inequality is
   37 Keep in mind that the characteristics are match-specific, so there is no requirement that the characteristics of a firm be the same on the

left and right sides.




                                                                             38
                l−1                                                 l            l−1                                                l           
   f (~x1 ) +   ∑     f ~x1u ,~x1d,1 , . . . ,~xad,1 + f (~x1u ) +   ∑     f ~xad,1 + ∑ f ~x2u ,~x1d,2 , . . . ,~xad,2 + f (~x2u ) +     ∑     f ~xad,2 >
                a=1                                                  a=1                  a=1                                            a=1
         l−1                                                  l            l−1                                                 l          
         ∑      f ~x1u ,~x1d,1 , . . . ,~xad,1 + f (~x1u ) +   ∑     f ~xad,1 + ∑ f ~x2u ,~x1d,2 , . . . ,~xad,2 + f (~x2u ) +      ∑    f ~xad,2 + f (~x2 ) .       (35)
         a=1                                                   a=1                  a=1                                            a=1


The inequality holds for f = f 0 and holds with the opposite sign (<) for f = f 1 .
    By inspection, one can loosely verify that (35) is almost, but not quite, a local-production-maximization
inequality, Definition 3.3, with firm-specific characteristics. The term ~x1 on the left exchanges ~xld,1 for the
                                                                                                      
option of being unmatched, 0, to add f ~x1u ,~x1d,1 , . . . ,~xl−1
                                                               d,1
                                                                   + f ~xld,1 on the right side. Following a pattern, each
                                                                                                                                                        
term f ~x1u ,~x1d,1 , . . . ,~xad,1 on the left side splits away the term ~xad,1 to leave a f ~x1u ,~x1d,1 , . . . ,~xa−1
                                                                                                                      d,1
                                                                                                                          + f ~xad,1 on the
                                                                                                                                                                     
right. Each term on the left involving the characteristics originally from ~x2 , for example f ~x2u ,~x1d,2 , . . . ,~xad,2 ,
                                                                                                
                             d,1
combines with an unmatched ~xa+1 to form f ~x2u ,~x1d,2 , . . . ,~xa+1
                                                                   d,2
                                                                       on the right side.
    The inequality (35) is not a local-production-maximization inequality. For example, look at the terms
                      
f ~x1u + ∑la=1 f ~xad,1 on the left side. These unmatched firms do not combine with other firms to make pairings
      

on the right side of (35). Therefore, as written (35) is not a local-production-maximization inequality according
to Definition 3.3. However, the statement of the theorem imposes a non-innocuous localization normalization,
                                                                            
which gives f ~x1u + ∑la=1 f ~xad,1 = 0 on the left and f ~x2u + ∑la=1 f ~xad,2 = 0 on the right. With this change,
                                                             

(35) becomes

                l−1                                 l−1                                                  l          
   f (~x1 ) +   ∑     f ~x1u ,~x1d,1 , . . . ,~xad,1 + ∑ f ~x2u ,~x1d,2 , . . . ,~xad,2 + f (~x2u ) +        ∑   f ~xad,2 >
                a=1                                   a=1                                                 a=1
                                            l−1                                                 l            l−1                             
                                             ∑    f ~x1u ,~x1d,1 , . . . ,~xad,1 + f (~x1u ) +   ∑     f ~xad,1 + ∑ f ~x2u ,~x1d,2 , . . . ,~xad,2 + f (~x2 ) ,      (36)
                                            a=1                                                  a=1                a=1


which by the above informal arguments is a local-production-maximization inequality. I intentionally do not
remove from (35) all production functions with zero production. Even though the production f ~x1u of sin-
                                                                                                                                                            

gleton matches is zero, these production functions are needed to show (36) satisfies the definition of a local-
production-maximization inequality, Definition 3.3.
    The above arguments were informal. I will now formally show that (36) satisfies Definition 3.3. There are
3l terms on the left side of (36). The number 3l explains the statement in the theorem, “Further, let there be
assignments A that contain as many matched coalitions as three times the maximum quota of an upstream firm.”
Let B1 = {hd1 , u1 i , . . . , hd3l , u3l i}, where the indexing hdc , uc i follows the order on the left side of (36), from left
to right. As I will show, many of these match partners will be 0, representing being unmatched. Now let

      B2 = {hdl+1 , u1 i , hdl+2 , u2 i , . . . , hd2l , ul i , hd2l+2 , ul+1 i , . . . , hd3l , u2l−1 i , hd2l+1 , u2l i , hd1 , u2l+1 i , . . . , hdl , u3l i} .

                                                                                                                                                                     
The match hdl+1 , u1 i ∈ B2 means that the upstream firm u1 , which on the left side has characteristics ~x u1 ,Cu1 =
~x1 , exchanges a downstream firm d1 for the downstream firm dl+1 ∈ Cul+1 . In this case, downstream firm d1 has
the characteristics ~xld,1 while dl+1 is actually a dummy partner, 0, representing being unmatched. For each index
c = 1, . . . , 3l , Table 2 lists the upstream firm characteristics, the characteristics for the group of all firms uc and
Cuc , downstream firm dc ’s characteristics for the match in B1 , the downstream-firm partner in the permutation


                                                                                      39
π creating B2 , the characteristics of that downstream-firm partner, and the characteristics of the entire group
of all firms uc and its downstream-firm partners after the switch. One can verify that the characteristics of
the firm π hdc , uc i in the fifth column are always the same as the characteristics of that downstream firm in the
third column. This is the key idea behind showing that (36) is a local-production-maximization inequality with
firm-specific characteristics: the characteristics of downstream firms remain the same after the permutation of
partners between B1 and B2 .
    The remainder of the proof follows arguments similar to those in the conclusion of Part 1 of Theorem 5.1
and the extension to discrete covariates in Theorem 6.1. The case with f 0 (~x1 ) < f 0 (~x2 ) and f 1 (~x1 ) > f 1 (~x2 ) is
similar: just reverse the local production maximization inequalities.


References
Akkus, Oktay and Ali Hortacsu, “The Determinants of Bank Mergers: A Revealed Preference Analysis,”
  March 2007. University of Chicago working paper.

Andrews, Donald, Steven T. Berry, and Panle Jia, “Confidence Regions for Parameters in Discrete Games
  with Multiple Equilibria, with an Application to Discount Store Locations,” 2004. working paper.

Bajari, Patrick, Han Hong, and Stephen Ryan, “Identification and Estimation of a Discrete Game of Com-
  plete Information,” 2008. working paper.

  , Victor Chernozhukov, Han Hong, and Denis Nekipelov, “Nonparametric and Semiparametric Analysis
  of a Dynamic Discrete Game,” April 2009. working paper.

Becker, Gary S., “A Theory of Marriage: Part I,” Journal of Political Economy, July-August 1973, 81 (4),
  813–846.

Beresteanu, Arie, Ilya Molchanov, and Francesca Molinari, “Sharp Identification Regions in Games,” June
  2008. working paper.

Berry, S. and E. Tamer, “Identification in models of oligopoly entry,” in Whitney Newey Richard K. Blundell
  and Torsten Persson, eds., Advances in Economics and Econometrics: Theory and Applications: Ninth World
  Congress, Cambridge University Press, 2006, chapter 2, p. 46.

Berry, Steven T., “Estimation of a Model of Entry in the Airline Industry,” Econometrica, 1992, 60 (4), 889–
  917.

Boyd, D., H. Lankford, S. Loeb, and J. Wyckoff, “Analyzing the Determinants of the Matching Public School
  Teachers to Jobs: Estimating Compensating Differentials in Imperfect Labor Markets,” 2003. working paper.

Bresnahan, Timothy F. and Peter C. Reiss, “Entry and Competition in Concentrated Markets,” The Journal
  of Political Economy, October 1991, 99 (5), 977–1009.

Camiña, Ester, “A Generalized Assignment Game,” Mathematical Social Sciences, 2006, 52 (2), 152–161.

Choo, Eugene and Aloysius Siow, “Who Marries Whom and Why,” The Journal of Political Economy,
  November 2006, 114 (1), 175–201.


                                                             40
Ciliberto, Federico and Elie Tamer, “Market Structure and Multiple Equilibria in Airline Markets,” October
  2008. working paper.

Dagsvik, John K., “Aggregation in Matching Markets,” International Economic Review, February 2000, 41
  (1), 27–57.

Demange, Gabrielle, David Gale, and Marilda A. Oliveira Sotomayor, “Multi-Item Auctions,” The Journal
  of Political Economy, August 1986, 94 (4), 863–872.

Elyakime, Bernard, Jean-Jaques Laffont, Patrice Loisel, and Quang Vuong, “First-Price Sealed-Bid Auc-
  tions with Secret Reservation Prices,” Annales d’Economie et de Statistique, 1994, 34 (0), 115–141.

Fox, Jeremy T., “Semiparametric estimation of multinomial discrete-choice models using a subset of choices,”
  RAND Journal of Economics, Winter 2007, 38 (4), 1002–1019.

  , “Estimating Matching Games with Transfers,” March 2009. working paper.

   and Patrick Bajari, “Measuring the Efficiency of an FCC Spectrum Auction,” 2009. working paper.

Gale, David and Lloyd Shapley, “College Admissions and the Stability of Marriage,” American Mathematical
  Monthly, 1962, 69.

Galichon, Alfred and Marc Henry, “Inference in Models with Multiple Equilibria,” 2008. working paper.

Garicano, Luis and Esteban Rossi-Hansberg, “Organization and Inequality in a Knowledge Economy,” The
  Quarterly Journal of Economics, November 2006, 121 (4), 1383–1435.

Goeree, Jacob K., Charles A. Holt, and Thomas R. Palfrey, “Regular Quantal Response Equilibrium,”
  Experimental Economics, December 2005, 8, 347–367.

Gordon, Nora and Brian Knight, “The Causes of Political Integration: An Application to School Districts,”
  Journal of Public Economics, 2009.

Gourieroux, Christian and Alain Monfort, Statistics and Econometric Models, Vol. 1 of Themes in Modern
  Econometrics, Cambridge, 1995.

Hatfield, John William and Fuhito Kojima, “Matching with Contracts: Comment,” American Economic
  Review, June 2008, 98 (3), 1189–1194.

   and Paul R. Milgrom, “Matching with Contracts,” The American Economic Review, September 2005, 95
  (4), 913–935.

Horowitz, Joel L., Semiparametric Methods in Econometrics, Vol. 131 of Lecture Notes in Statistics, Springer,
  1998.

Jaume, Daniel, Jordi Massó, and Alejandro Neme, “The Multiple-partners Assignment Game with Hetero-
  geneous Sells and Multi-unit Demands: Competitive Equilibria,” May 2008. working paper.

Jehle, Geoffrey A. and Philip J. Reny, Advanced Microeconomic Theory, Addison Wesley Longman, 2000.



                                                     41
Jia, Panle, “What Happens When Wal-Mart Comes to Town: An Empirical Analysis of the Discount Retailing
  Industry,” Econometrica, November 2008, 76 (6), 1263–1316.

Kelso, Alexander S. and Vincent P. Crawford, “Job Matching, Coalition Formation, and Gross Substitutes,”
  Econometrica, November 1982, 50 (6), 1483–1504.

Koopmans, Tjalling C. and Martin Beckmann, “Assignment Problems and the Location of Economic Ac-
  tivities,” Econometrica, January 1957, 25 (1), 53–76.

Kovalenkov, Alexander and Myrna Holtz Wooders, “Advances in the Theory of Large Cooperative Games
  and Application to Club Theory: the Side Payments Case,” in Carlo Carraro, ed., The Endogenous Formation
  of Economic Coalitions, Edward Elgar: Chelenham, 2003.

Leonard, Herman B., “Elicitation of Honest Preferences for the Assignment of Individuals to Positions,” The
  Journal of Political Economy, June 1983, 91 (3), 461–479.

Levine, Anna A., “Licensing and Scale Economies in the Biotechnology Pharmaceutical Industry,” June 2008.
  working paper.

Lewbel, Arthur, “Semiparametric qualitative response model estimation with unknown heteroskedasticity or
  instrumental variables,” Journal of Econometrics, 2000, 97, 145–177.

Lucas, Robert E., “On the Size Distribution of Business Firms,” Bell Journal of Economics, 1978, 9 (2),
  508–523.

Magnac, Thierry and Eric Maurin, “Identification and information in monotone binary models,” Journal of
  Econometrics, 2007.

Manski, Charles F., “Maximum Score Estimation of the Stochastic Utility Model of Choice,” Journal of
  Econometrics, 1975, 3, 205–228.

  , “Identification of Binary Response Models,” Journal of the American Statistical Association, September
  1988, 83 (403), 729–738.

Matzkin, Rosa L., “Semiparametric Estimation of Monotone and Concave Utility Functions for Polychoto-
  mous Choice Models,” Econometrica, September 1991, 59 (5), 1315–1327.

  , “Nonparametric identification and estimation of polychotomous choice models,” Journal of Econometrics,
  1993, 58, 137–168.

Mazzeo, Michael J., “Product Choice and Oligopoly Market Structure,” The RAND Journal of Economics,
  2002, 33 (2), 221–242.

Milgrom, Paul and Chris Shannon, “Monotone Comparative Statics,” Econometrica, 1994, 62 (1), 157–180.

Mindruta, Denisa, “Value Creation in University-Firm Research Collaborations: A Matching Approach,”
  February 2009. working paper.

Ostrovsky, Michael, “Stability in Supply Chain Networks,” American Economic Review, December 2008, 98
  (3), 897–923.


                                                     42
Pakes, Ariel, Jack Porter, Katherine Ho, and Joy Ishii, “Moment Inequalities and Their Application,” 2006.
  working paper.

Pycia, Marek, “Many-to-One Matching with Complementarities and Peer Effects,” April 2007. working paper.

  , “Non-Existence Result for Matching Games with Transfers,” March 2008. working paper.

Rosen, Sherwin, “Authority, Control, and the Distribution of Earnings,” Bell Journal of Economics, 1982, 13
  (2), 311–323.

Roth, Alvin E. and Marilda A. Oliveira Sotomayor, Two-Sided Matching: A Study in Game-Theoretic Mod-
  eling and Analysis Econometric Society Monographs, Cambridge University Press, 1990.

Seim, Katja, “An empirical model of firm entry with endogenous product-type choices,” The RAND Journal
  of Economics, 2006, 37 (3), 619–640.

Shapley, Lloyd S. and Martin Shubik, “The assignment game I: the core,” International Journal of Game
  Theory, 1972, 1, 111–130.

Sørensen, Morten, “How Smart is Smart Money? A Two-Sided Matching Model of Venture Capital,” Journal
  of Finance, December 2007, LXII (6), 2725–2762.

Sotomayor, Marilda, “The multiple partners game,” in Mukul Majumdar, ed., Equilibrium and dynamics:
  essays in honour of David Gale, Macmillan, 1992, chapter 17, pp. 322–336.

  , “The lattice structure of the set of the stable outcomes of the multiple partners assignment game,” Interna-
  tional Journal of Game Theory, November 1999, 28 (4), 567–583.

Tamer, Elie, “Incomplete Simultaneous Discrete Response Model with Multiple Equilibria,” Review of Eco-
  nomic Studies, 2003, 70 (1), 147–165.

Yang, Yupin, Mengze Shi, and Avi Goldfarb, “Estimating the Value of Brand Alliances in Professional Team
  Sports,” Marketing Science, 2009.




                                                      43
Table 1: Assignment probabilities for two assignments with equal deterministic production with i.i.d. match-
specific unobservables, by distribution

  # Firms                      Distribution                       Error standard        Pr (A1 | X; f , S)        Pr (A2 | X; f , S)     Pr (A1 | X; f , S) −
  U =D                      for i.i.d. errors, S                    deviation                                                             Pr (A2 | X; f , S)
      3                          N (0, 1)                                 1                 0.02126                   0.03640                  -0.01514
      3                          N (0, 36)                                6                 0.07897                   0.07888                   0.00009
      3                         N (0, 400)                                20                0.06554                   0.06543                   0.00011
      3       0.33 · N (0.5, 0.04) + 0.67 · N (−0.5, 0.123)              0.53              0.000098                  0.001791                  -0.00163
      3       0.33 · N (2.5, 0.04) + 0.67 · N (−2.5, 0.123)              2.44              0.047894                  0.045908                  0.001986
      3        0.33 · N (8.0, 4.0) + 0.67 · N (−6.0, 6.25)               6.98              0.033811                  0.033967                 -0.000156


     The rank order property says Pr A1 | X; f 0 , S − Pr A2 | X; f 0 , S = 0 for any S. Total match production is f (X (i, {a})) + εha,ii , with
                                                                         
the error’s distribution given in the table. The assignment is calculated using linear programming (Roth and Sotomayor, 1990, Chapter 8).
Each integral is simulated by using 1 million draws of the realizations for the collection of error terms for all matches and being single.
Given the number of replications, the differences in the table probably do not reflect simulation error.
  There are three upstream firms and three downstream firms in a one-to-one, two-sided matching game. The production of being un-
matched is 0. The deterministic match production levels for matching with the three downstream firms are {3, 1, 2.8} for upstream firm 1,
{1, 2.8, 1} for upstream firm 2, and {3, 1, 1} for upstream 3. I compute the probabilities for the assignments A1 = {h1, 2i , h2, 3i , h3, 1i},
with production 1 + 1 + 3 = 5, and A2 = {h1, 1i , h2, 3i , h3, 2i}, with production 3 + 1 + 1 = 5. I chose the example so that assignment A2
will be “more vulnerable” to a deviation to an assignment A3 = {h1, 1i , h2, 2i , h3, 3i} with deterministic production 3 + 2.8 + 2.8 = 8.6, as
only two matched pairs in A2 , rather than all three pairs in A1 , need to exchange partners to deviate to A3 .


  Table 2: Proof of Theorem 6.3: Demonstrating That (36) Is a Local-Production-Maximization Inequality
              (1)              (2)           (3)          (4)               (5)                                  (6)
 Index c ~x (uc , {0})    ~x (uc ,Cuc ) ~x (0, {dc }) π hdc , uc i ~x (0, {π hdc , uc i}) ~x (uc , (C
                                                                                                    cu  \  {d  c }) ∪ {π hdc , uc i})
    1         ~x1u             ~x1          ~xld,1       dl+1                0/                      ~x1u ,~x1d,1 , . . . ,~xl−1
                                                                                                                             d,1
                                                   
                   ~x1u                ~x1u ,~x1d,1             ~x1d,1                                                                             ~x1u
                                                                                                                                                          
     2                                                                          dl+2                     0/
     ..              ..                      ..                   ..               ..                        ..                                      ..
      .               .                       .                  .                .                         .                                      .             
      l            ~x1u                                 d,1
                                ~x1u ,~x1d,1 , . . . ,~xl−1       d,1
                                                                ~xl−1            d2l                     0/                                                     d,1
                                                                                                                                        ~x1u ,~x1d,1 , . . . ,~xl−2
                                                                                                                                                              
   l +1            ~x2u                 ~x2u ,~x1d,2              0/            d2l+2                  ~x2d,2                               ~x2u ,~x1d,2 ,~x2d,2
      ..             ..                      ..                   ..               ..                        ..                                      ..
       .              .                      .                   .                .                         .                                 .               
   2l − 1          ~x2u         ~x2u ,~x1d,2 , . . . ,~xl−1
                                                        d,2
                                                                  0/             d3l                   ~xld,2                     ~x2 = ~x2 ,~x1 , . . . ,~xld,2
                                                                                                                                          u     d,2
                                                                                                                                                      
                   ~x2u                     ~xu                                                        ~x1d,2                             ~x2u ,~x1d,2
                                                 
     2l                                                           0/            d2l+1
                                          2                                                                                                      
   2l + 1           0/                     ~xd,2                ~x1d,2           d1                    ~xld,1                                ~xld,1
                                          1                                                                                                      
   2l + 2           0/                     ~x2d,2               ~x2d,2           d2                    ~x1d,1                                ~x1d,1
      ..             ..                      ..                   ..               ..                        ..                                      ..
       .              .                  .                       .                .                         .                                  . 
     3l             0/                   ~xld,2                 ~xld,2           dl                      d,1
                                                                                                       ~xl−1                                       d,1
                                                                                                                                                 ~xl−1




                                                                          44
