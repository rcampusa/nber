                             NBER WORKING PAPER SERIES




                  COGNITIVE HUBS AND SPATIAL REDISTRIBUTION

                                   Esteban Rossi-Hansberg
                                     Pierre-Daniel Sarte
                                     Felipe Schwartzman

                                     Working Paper 26267
                             http://www.nber.org/papers/w26267


                    NATIONAL BUREAU OF ECONOMIC RESEARCH
                             1050 Massachusetts Avenue
                               Cambridge, MA 02138
                                  September 2019




We thank Mike Finnegan, Daniel Ober-Reynolds, and Jackson Evert for excellent research
assistance. We also thank David Albouy for useful comments. The views expressed here are
those of the authors and do not reflect those of the Federal Reserve Bank of Richmond, the
Federal Reserve System, or the National Bureau of Economic Research.

NBER working papers are circulated for discussion and comment purposes. They have not been
peer-reviewed or been subject to the review by the NBER Board of Directors that accompanies
official NBER publications.

© 2019 by Esteban Rossi-Hansberg, Pierre-Daniel Sarte, and Felipe Schwartzman. All rights
reserved. Short sections of text, not to exceed two paragraphs, may be quoted without explicit
permission provided that full credit, including © notice, is given to the source.
Cognitive Hubs and Spatial Redistribution
Esteban Rossi-Hansberg, Pierre-Daniel Sarte, and Felipe Schwartzman
NBER Working Paper No. 26267
September 2019
JEL No. E23,E24,H23,H71,J61,R13,R23

                                           ABSTRACT

In the U.S., cognitive non-routine (CNR) occupations associated with higher wages are
disproportionately represented in larger cities. To study the allocation of workers across cities, we
propose and quantify a spatial equilibrium model with multiple industries that employ CNR and
alternative (non-CNR) occupations. Productivity is city-industry-occupation specific and partly
determined by externalities across local workers. We estimate that the productivity of CNR
workers in a city depends significantly on both its share of CNR workers and total employment.
Together with heterogeneous preferences for locations, these externalities imply equilibrium
allocations that are not efficient. An optimal policy that benefits workers equally across
occupations incentivizes the formation of cognitive hubs, leading to larger fractions of CNR
workers in some of today's largest cities. At the same time, these cities become smaller to
mitigate congestion effects while cities that are initially small increase in size. Large and small
cities end up expanding industries in which they already concentrate, while medium-size cities
tend to diversify across industries. The optimal allocation thus features transfers to non-CNR
workers who move from large to small cities consistent with the implied change in the industrial
composition landscape. Finally, we show that the optimal policy reinforces equilibrium trends
observed since 1980. However, these trends were in part driven by low growth in real-estate
productivity in CNR-abundant cities that reduced welfare.

Esteban Rossi-Hansberg                            Felipe Schwartzman
Princeton University                              Research Department
Department of Economics                           Federal Reserve Bank of Richmond
289 Julis Romo Rabinowitz Building                PO Box 27622
Princeton, NJ 08544-1021                          Richmond, VA 23261
and CEPR                                          felipe.schwartzman@rich.frb.org
and also NBER
erossi@princeton.edu

Pierre-Daniel Sarte
Research Department.
Federal Reserve Bank of Richmond
PO Box 27622
Richmond, VA 23261
pierre.sarte@rich.frb.org
1       Introduction
        "Most of what we know we learn from other people (...) most of it we get for
        free." Robert E. Lucas Jr.
    Workers capable of doing the complicated cognitive non-routine tasks required in a mod-
ern economy are scarce. Acquiring the expertise to work as a doctor, manager, lawyer,
computer scientist or researcher requires many years of schooling, sustained effort, and indi-
vidual ability. These workers are a valuable input and so their allocation across industries
and locations is important for overall efficiency and welfare in an economy. The marginal
productivity of a worker depends on the local productivity of the industry where she works,
but also on the set of workers that work in the same city. Larger cities with a large frac-
tion of workers in cognitive non-routine (CNR) occupations offer learning and collaboration
opportunities that enhance the productivity of other workers. However, the abundance of
CNR workers also lowers their marginal product, particularly in industries that are less in-
tensive in these occupations. The interaction of these forces in equilibrium determines the
spatial polarization of workers and, relatedly, the spatial specialization of industries. Can
the economy allocate scarce CNR workers in a way that improves the lives of all workers?
Our aim is to study the allocation of occupations and industries across cities in the U.S. and
to characterize the optimal spatial allocation and the policies to implement it.1
    The need for optimal spatial policy is the direct implication of the presence of urban
externalities. Externalities that enhance the productivity of workers in larger cities have
been discussed, analyzed, and measured at least since Marshall (1920).2 It is natural to
hypothesize that these production externalities depend on the occupational composition of a
city. After all, CNR occupations require more interactions between knowledgeable workers.
As we show in detail in the next section, the patterns of occupational polarization and
wages across space in the U.S. suggest that this is indeed the case. First, in the absence
of technological differences or externalities across locations, decreasing returns to workers in
an occupation imply that relative CNR to non-CNR wages should decline with the share of
CNR workers. We find a large positive relationship even after controlling for a number of
observable worker characteristics.3 Why are CNR workers then making relatively more in
locations where they are abundant? A possible answer is that these locations specialize in
industries intensive in these occupations. The evidence, however, suggests that firms in CNR
abundant cities are even more intensive in CNR workers than suggested by their industrial
make up. What makes demand for these workers so high in these cities? Our take, and
an explanation that reconciles these various facts, is that the abundance of CNR workers
itself makes them more productive: a local occupation-specific externality. Estimating the
strength of these externalities is a central part of our analysis.
    The detailed quantitative assessment of optimal spatial policies we propose requires a
number of contributions. These fall along four main dimensions.
    1
     Figure 20 in the Appendix shows CNR shares across U.S. cities.
    2
     See Duranton and Puga (2004) for a review of the literature on externalities in cities.
   3
     General city amenities that would be equally appealing to both occupations are unlikely to be a deciding
factor in attracting the best workers to abundant cities. Indeed, we show that while real wages of CNR
workers increase with a city's CNR intensity, real wages of non-CNR workers do not. Therefore, amenities
alone are not driving the pattern of wages across space. For an alternative view, see Couture et al. (2018).

                                                     2
    First, we develop a spatial equilibrium model with multiple industries and occupations as
well as occupation-specific externalities. Multiple industries, costly trade, and input-output
linkages are all key features of the environment since the demand for different occupations
depends on the occupational intensity of the specific industries in each location. The frame-
work also features externalities that are allowed to depend on the share of workers in CNR
occupations and the total workforce in the city. Finally, it includes heterogeneous preferences
for locations that act as a form of migration costs.
    Second to arrive at an optimal spatial policy requires that we derive efficient allocations
in this setup. We choose to study the efficient allocation that benefit both occupations
equally. Implementing this allocation requires particular transfers between locations and
occupations, which we characterize.
    Third, the details of optimal transfers require that we quantify the model and estimate the
parameters that determine the endogenous component of city-industry-occupation specific
productivity. Thus, we first recover productivity across locations, industries, and occupa-
tion such that the equilibrium of our model matches observed data. We then parameterize
the relationship between productivity and the occupational composition and size of cities
and estimate this equation using an instrumental variables approach. As proposed in the
empirical literature (e.g. Card (2001) and Moretti (2004a)), we use past migration flows of
particular immigrant groups and the location of land-grant colleges as instruments. We also
present results using model-implied instrumental variables. Our strategy yields a robust set
of results comparable to the existing literature though, as an improvement, estimated here
directly from productivity measures recovered from the general equilibrium framework we
lay out. Our findings imply that the productivity of CNR and non-CNR workers depends
similarly on city size. In addition, the productivity of CNR workers depends strongly and
significantly on the share of CNR workers. We find less evidence that the productivity of
non-CNR workers depends on the composition of occupations.
    Finally, informed by these findings, we compute the optimal allocation and discuss its im-
plementation using particular policy tools. We also highlight important quantitative aspects
of this allocation through various counterfactual exercises.
    Our findings propose a new approach to spatial policy. They indicate that the spatial
allocation of workers and industries may be improved by reducing the size of large CNR
intensive cities while, at the same time, increasing their fraction of CNR workers. These
"cognitive hubs" take advantage of scarce CNR workers in the economy by clustering them
to maximize externalities. We find that in equilibrium, the social value of CNR workers is
82% larger than their private value. However, the industrial make up of cities, as well as
their location, does impose limits on the creation of cognitive hubs. Some large cities, such
as Miami or Las Vegas, remain non-CNR abundant since they are particularly productive in
industries where CNR workers are employed less intensively. Cognitive hubs end up scattered
geographically around the country to minimize transport cost with the cities with which they
trade the most.
    In order to increase the share of CNR workers while alleviating congestion in larger
cities, the optimal policy prescribes a re-allocation of non-CNR workers to smaller cities
with lower CNR shares. The end result is that under the optimal policy, the smallest cities
grow in size by playing to their strengths and expanding industries in which a large share
of their employment already resides. The corresponding growth of smaller cities also makes

                                              3
it possible for them to sustain more employment in non-tradable industries such as retail,
accommodation, and other services. Hence, contrary to some previous literature and much
of the public discourse, the economics of the problem suggest that, with the appropriate
transfers, small industrial cities in the U.S. should attract non-CNR workers and not try to
become the next San Jose. The concentration of CNR workers in a few "cognitive hubs"
should be encouraged, not scorned. Everyone can benefit from using CNR workers in the
most productive way possible.
    Naturally, implementing the optimal allocation requires a number of transfers and taxes
that depend on the location and occupation of an agent. As Fajgelbaum and Gaubert
(2018) discuss, spatial efficiency requires a flat wage tax on all individuals to correct for the
differences in the marginal utility of consumption generated by heterogeneous preferences
for location. In addition to this tax, in both our frameworks and theirs, implementing the
optimal allocation requires a set of transfers. These transfers insure that non-CNR workers
benefit equally from the optimal policy so that occupational inequality is mitigated despite
the creation of cognitive hubs. In our analysis, the base transfers to non-CNR workers
amount to $18,126 (in 2013 dollars) while CNR workers, who earn substantially more, end
up paying a base transfer of $16,856. One interpretation of this base transfer is that of
a "universal basic income" paid to all non-CNR workers. CNR workers still need to be
incentivized to move to CNR intensive cities, and non-CNR workers to move to non-CNR
intensive cities. Therefore, occupation and city-specific transfers are positively correlated
with city size for CNR workers and negatively correlated with city size and the CNR share
for non-CNR workers. Their exact value depends on the particular location and industrial
composition of each city. Ultimately, the policy amounts to a subsidy to non-CNR workers
to move to smaller cities with low CNR shares, and incentives to CNR workers to form even
more intensive "cognitive hubs" in today's largest cities.
    Perhaps surprisingly, a comparison of the current spatial equilibrium to that in 1980 re-
veals that the spatial allocation of workers has approached that implied by the optimal policy
(with current fundamentals). Specifically, since the 1980s, CNR workers have become not
only more abundant nationally but also increasingly concentrated in CNR intensive hubs,
many of which are large cities. This formation of cognitive hubs has taken place in parallel
with a well documented increase in wage inequality across space and occupations. Our quan-
titative framework implies that both processes were linked through local occupation-specific
externalities. Our analysis indicates that absent these spillovers, the spatial polarization of
workers would have been greatly mitigated, and the welfare gains received by CNR workers
smaller than those of non-CNR workers since CNR workers became more abundant nation-
ally over that time period.
    The analysis also makes clear that not all forces pushing towards the spatial polarization
of workers are necessarily welfare-enhancing. This is the case, for instance, of housing regu-
lations captured here through changes in the productivity of the real estate sector. The cost
of these regulations has been emphasized by, among others, Glaeser and Gyourko (2018),
Herkenhoff et al. (2018) and Hsieh and Moretti (2019). Relatively low real-estate productiv-
ity growth in CNR-intensive cities since 1980 has increased housing prices and led to more
polarized CNR hubs. These changes have thus brought the spatial distribution of occupa-
tions closer to that resembling the optimal allocation. In this case, however, since this more
spatially polarized distribution of workers resulted from reductions in measured real estate

                                               4
productivity in larger cities, "the cognitive hubs" led to declines in welfare.

Relationship to the Literature A substantial literature has pointed to increasing spatial
concentration of skilled workers (Berry and Glaeser (2005), Diamond (2016), and Giannone
(2017)), as well as increasing wage inequality across space and within cities (Baum-Snow
and Pavan (2013), and Autor (2019)), with the skill premium increasing the most in large
cities. Our paper speaks to the optimal policy reaction to those trends.
    We focus on production externalities as a key driving force behind those spatial patterns.
The estimation of those externalities is a central theme in urban and spatial economics.
A robust finding is the existence of a relationship between city size and productivity (see
Melo et al. (2009) for a meta analysis). While we allow for such agglomeration externalities,
our main focus is on externalities tied to the occupational composition of the city. This
is compatible with empirical evidence by Ellison et al. (2010) that industries with similar
occupational make-up tend to be spatially proximate. Given the correlation between occupa-
tional types and skill levels, our findings of strong spillovers stemming from the occupational
composition of cities mirrors findings by Moretti (2004a; 2004b) regarding the local external
effects of human capital.
    There has been ample research on the extent of spatial misallocation in the U.S. economy
and the degree to which it corresponds to heterogeneity in taxation policy (or its local
incidence), zoning laws, or other unspecified sources of distortions. Examples of papers in
that vein are Albouy (2009), Desmet and Rossi-Hansberg (2013), Ossa (2015), Fajgelbaum
et al. (2018), Colas and Hutchinson (2017), Hsieh and Moretti (2019) and, most recently
Herkenhoff et al. (2018).
    Our paper sheds light on place-based policies in that it highlights the optimal endogenous
expansion of different industries in different locations. A summary of the related literature
can be found in Neumark and Simpson (2015). Rather than evaluating exogenous policies,
we derive the optimal allocation in a quantitative spatial model with local externalities.
Our derivation of optimal policy thus generalizes that of Fajgelbaum and Gaubert (2018)
in an environment with input-output linkages and where trade is differentially costly across
industries. Two other recent papers that discuss the optimal distribution of city sizes are
Eeckhout and Guner (2015) and Albouy et al. (2019).
    We integrate industrial, occupational and spatial heterogeneity in a single coherent frame-
work. Other recent work that has emphasized the joint distribution of industrial and skill
composition within the U.S. are Hendricks (2011) and Brinkman (2014). As in Caliendo
et al. (2017), we allow for trade costs, thus capturing an explicitly spatial dimension, but
add to that framework by also allowing for occupational heterogeneity and local production
externalities. Finally, on a more technical note, our paper adds to the rapidly expanding
`quantitative spatial economics' literature that uses general equilibrium models to address
issues related to international, regional and urban economics. Redding and Rossi-Hansberg
(2017) provide a review of the main ingredients in these models.
    The rest of the paper is organized as follows. Section 2 presents stylized facts that consti-
tute prima-facie evidence for the presence of externalities among CNR workers within cities.
Section 3 presents our multi-industry spatial model with occupation specific externalities
within cities. Section 4 quantifies the model, including our estimation of the externality


                                               5
parameters. It also discusses the role of externalities in the equilibrium allocation. Section 5
presents the optimal allocation as well as the resulting transfers and their implementation.
Section 6 provides a decomposition of the impact of fundamental changes in the national
CNR employment share and in technology across sectors and cities between 1980 and the
recent data. Section 7 concludes. We relegate many of the model's details, additional ro-
bustness exercises and counterfactuals to the Appendix.


2       A Motivation for Occupation-Specific Externalities
The main question under consideration is whether there is a role for policy in altering the
observed spatial polarization of employment and, if so, what are its features? We now
provide some basic facts regarding the joint spatial distribution of wages and employment
for workers in different occupations that point to the existence of important occupational
externalities. Those facts constitute prima-facie evidence that the optimal policy may in fact
involve reinforcing existing patterns, with the appropriate transfers, rather than attenuating
them.
    We separate workers from 2011 to 2015 in two large occupational groups: those that are
intensive in cognitive non-routine (CNR) tasks and the others (non-CNR).4 We calculate
the average residual wages of workers in each occupation and each city after controlling for
observable worker socio-economic characteristics.5 This classification builds on the observa-
tion by Acemoglu and Autor (2011) that one can best understand wage inequality trends
through such a task based approach.
    Figure 1 shows that across U.S. cities, wages of workers employed in Cognitive Non-
Routine (CNR) occupations, relative to those of workers in other (non-CNR) occupations,
increase with the corresponding share of CNR workers in total employment. This suggests
that differences in relative wages across cities are, to a large degree, driven by differences in
relative demand for CNR workers.6 The size of the scatter-plot markers captures city size.
They indicate that large cities appear to also be CNR intensive.
    Focusing on CNR workers, the top panel of Figure 2 indeed shows that real wages of CNR
workers increase with the intensity of CNR employment across cities. Moreover, some of the
high real wage cities include places like San Francisco and New York that on average may
provide higher amenities to CNR workers (see Diamond (2016)). In those cities, therefore,
labor demand forces are seemingly pronounced enough to more than make up for the labor
supply inducing effects of local amenities, such as the variety of retail and entertainment
options. If workers differ in their preferences for where to live, the real wages depicted in
the top panel of Figure 2 reflect the compensating differential to the marginal CNR worker
in a given city.
    4
      Specifically, we follow Jaimovich and Siu (2018), and define CNR occupations to include occupations
with SOC-2 classifications 11 to 29 and non-CNR occupations to include SOC-2 classifications 35 to 55.
    5
      We include as control variables education, potential experience, race, gender, English proficiency, number
of years in the U.S., marital status, having had a child in the last year, citizenship status, and veteran status.
    6
      In particular, suppose that technologies were similar across cities, and that the share of CNR workers
were driven by the supply of those workers. Then, with decreasing marginal returns to worker type, increases
in the relative supply of CNR workers would lower their relative wages.



                                                        6
                                                                                               Slope: 0.41

           Log ratio of CNR to non-CNR wages
                                                                                               Correlation: 0.4
                                               0.2


                                               0.1


                                                 0


                                               -0.1


                                               -0.2


                                               -0.3
                                                      0.15   0.2   0.25   0.3   0.35   0.4   0.45     0.5     0.55
                                                                    CNR share of city employment
                                                 Figure 1: Occupational employment share and wage premium
        See text for details on definitions of the wage premium and occupation classification. Log
        wage premium is depicted as a deviation from employment weighted mean. Each observation
        refers to a CBSA. Marker sizes are proportional to total employment.



    Differences in the relative demand for CNR workers across cities can arise for several
reasons. First, differences in relative demand for CNR workers may arise from exogenous (or
historically determined) differences in industrial composition or regulations. Suppose that
the industry make up of a city, n, is the main determinant of its demand for CNR workers
relative to other types. Then, its wage bill share for CNR workers would be (approximately)
      CN R,j j
   j        n , where  CN R,j is the national wage bill share of CNR workers in industry j ,
       j
and n    is the wage bill of industry j as a share of that city's total wage bill. Figure 3
compares the wage-bill shares of CNR workers implied by the different industrial composition
of U.S. cities relative to those observed in the data. The black line is a 45 degree line. The
observed wage bill shares differ from, and in fact increase more than one-for-one with, those
implied by differences in industrial mix alone, thus ruling out industrial composition as a
sole determinant of labor demand across cities.7
    Differences in the relative demand for CNR workers across cities can also arise endoge-
nously if more productive workers within occupational types sort themselves into particular
cities. Baum-Snow and Pavan (2013) indeed argue that observable worker characteristics
are an important determinant of the city size wage premium. However, the fact that rela-
tive wages in Figure 1 are computed from residuals after controlling for observable worker
characteristics suggests that sorting along these characteristics is not the only driving force
   7
   The figure also rules out the production technology for different industries being well characterized by
Cobb-Douglas (i.e. the elasticity of substitution across worker types is likely not equal to 1).


                                                                                7
                          0.4                                              Slope: 0.47
                                                                           Correlation: 0.27
                          0.3
 Log real CNR wages

                          0.2

                          0.1

                            0

                          -0.1

                          -0.2

                          -0.3

                          -0.4
                                 0.15   0.2   0.25   0.3   0.35   0.4    0.45     0.5     0.55
                                               CNR share of city employment

                                                                           Slope: 0.06
                          0.4                                              Correlation: 0.04

                          0.3
 Log real non-CNR wages




                          0.2

                          0.1

                            0

                          -0.1

                          -0.2

                          -0.3

                          -0.4
                                 0.15   0.2   0.25   0.3   0.35   0.4    0.45     0.5     0.55
                                               CNR share of city employment
                                 Figure 2: Occupational employment share and real wages
See text for details on definitions of the wage premium and occupation classification. Real
wages are calculated using consumption price indices obtained from the model quantification
(See Section 4). Log real wages are depicted as a deviation from employment weighted mean.
Each observation refers to a CBSA. Marker sizes are proportional to total employment.




                                                           8
underlying that figure. Thus, if sorting is nevertheless part of an explanation driving the
positive relationship between the wage premia of CNR workers and the employment share
of those workers, it must be taking place along dimensions that are not easily observed.
However, assuming that differences in amenities are experienced in similar ways by CNR
and non-CNR workers, high productivity non-CNR workers would then also sort themselves
into cities with a high share of CNR workers. The bottom panel of Figure 2 suggests that
this is not, in fact, the case.8
     Finally, differences in relative demand for CNR workers may be explained by endoge-
nous differences in productivity, even when not from sorting, if these differences arise from
production externalities that predominantly affect CNR workers. First, to the extent that
production externalities also increase with the concentration of CNR workers in a given city,
it is then naturally the case that the demand for CNR workers would increase with the share
of employment in CNR occupations, as suggested by Figure 1. Second, if production exter-
nalities mainly enhance the productivity of CNR workers, then real wages of CNR workers
would increase with the share of CNR employment within cities, as in the top panel of Figure
2, but no such effect would be expected among non-CNR workers, as suggested by the bot-
tom panel of Figure 2. Third, and most importantly, Figure 3 shows that observed wage bill
shares of CNR workers increase more than one-for-one with those implied by differences in
industrial composition alone. This observation would be expected in an environment where
production externalities intensify the implications of industrial mix. Specifically, CNR work-
ers will concentrate, all else equal, in cities whose industrial composition is tilted towards
industries intensive in CNR workers. In the presence of production externalities, therefore,
this concentration would lead to increases in the productivity of CNR workers. If the elas-
ticity of substitution between worker types is higher than 1, one would then expect higher
wage shares for CNR workers in those cities relative to those given by industrial composition
alone.


3      A Quantitative Spatial Model with Multiple Indus-
      tries and Occupations
The economy has N cities and J sectors. We denote a particular city by n  {1, ..., N }
(or n ) and a particular sector by j  {1, ..., J } (or j ). Individuals are endowed with an
occupational type and cannot switch types. There are K occupational types, denoted by
k  {1, ..., K } (or k ), with aggregate number of workers Lk per type (total employment in
occupation k aggregated across industries and cities). Firms in all cities use multiple types
of labor but in potentially different proportions depending on the industry and the city.
Aggregate regional land and structures in region n are denoted by Hn . Labor of all types
moves freely across regions and sectors, while structures are region-specific. Some sectors
are tradable while others are not.
    Quantities in the economy may be associated with industries, cities, or occupations.
For notational convenience, we denote aggregates across a given dimension by omitting
   8
     The small relevance of sorting to explain differences in wages across cities has in fact been recently
verified in empirical work by Baum-Snow and Pavan (2011) and Roca and Puga (2017).


                                                    9
                                       0.8


                                      0.75


                                       0.7         Slope: 1.89
                                                   Correlation: 0.85

                                      0.65
         CNR wage bill share (data)




                                       0.6


                                      0.55


                                       0.5


                                      0.45


                                       0.4


                                      0.35


                                       0.3
                                             0.3      0.35    0.4       0.45   0.5        0.55   0.6   0.65   0.7   0.75   0.8
                                                                       CNR wage bill share (predicted)

                                             Figure 3: Occupational wage bill share: predicted vs actual
      See text for details on definitions of the wages and occupation classification. The predicted
      wage bill-shares are obtained by assuming that within-industry wage bill shares were equal
      to national averages (see text for details). Each observation refers to a CBSA. Marker sizes
      are proportional to total employment.



the corresponding index. Thus, for example, Lkj     n is the number of workers employed in
                                       k         kj
occupation k in industry j in city n, Ln = j Ln represents the number of workers employed
in occupation k in city n, Lk = n Lk  n represents all workers in occupation k , and L = kL
                                                                                           k

is simply total employment.

3.1    Individuals
Workers in each location n  {1, ..., N }, are endowed with labor of type k  {1, ..., K }, and
order consumption baskets according to Cobb-Douglas preferences with shares j over their
                                         kj
consumption of final domestic goods, Cn     :



                                                                                     10
                                          k               kj   j
                                         Cn =            Cn        ,
                                                j
         k
where Cn   is a consumption aggregator. Consumption goods consumed in city n are purchased
            j
at prices Pn  in sectors j  {1, ..., J }. Utility is homogeneous of degree one, so that j j = 1.
    Workers supply one unit of labor inelastically. The income of a worker of type k residing
in city n is

                                           k    k
                                          In = wn + k ,                                            (1)
        k
where wn  is the wage earned by a worker in occupation k in city n. The term k represents
the return per household on a national portfolio of land and structures from all cities,

                                                  rn Hn
                                       k = bk        n
                                                        ,
                                                 Lk
where rn is the rental rate on land and structures in that city, and bk denotes the share
of the national portfolio accruing to workers of occupational type k . In what follows, we
assume that bk is determined such that different worker types receive a share of the national
portfolio proportional to their share of wages in the total wage bill, so
                                                      k k
                                                    wn Ln
                                      bk =          n
                                                       k k
                                                           .
                                                k ,n wn Ln

    Agents of a given occupational type differ in how much they value living in different
cities. These differences are summarized by a vector a = {a1 , a2 , ..., aN }, with each entry an
scaling the utility value that an individual receives from living in city n. We associate the
elements an with the particular way in which different workers experience the amenities of
given cities. Conditional on living in city n, the problem of an agent employed in occupation
k and characterized by amenity vector a is

           k                                             j
          vn (a)       max an Akn
                                           kj
                                          Cn  (a)            , subject to        j kj
                                                                                Pn           k
                                                                                   Cn (a) = In ,
                      kj    J
                    {Cn (a)}j=1      j                                      j

where Ak n denotes an exogenous component of city-specific utility common to all individuals
of type k living in city n. All workers in a given occupation living in a given city will choose
                                                   kj        kj
the same consumption basket. It follows that Cn       (a) = Cn  for all a.
    Agents move freely across cities. The value of locating in a particular city n for an
individual employed in occupation k , with idiosyncratic preference vector a, is

                                  k     a n Ak  k
                                             n In
                                 vn (a) =         = an A k  k
                                                         n Cn .
                                            Pn
In equilibrium, workers move to the location where they receive the highest utility so that

                                     v k (a) = max vn
                                                    k
                                                      (a) ,
                                                     n




                                                    11
where v k (a) now denotes the equilibrium utility of an individual in occupation k with amenity
vector a. We assume that an is drawn from a Fr´  echet distribution independently across cities.
We denote by  the joint cdf for the elements of a across workers in occupation k , so that


                                   (a) = exp -               (an )-       ,
                                                         n

where the shape parameter  reflects the extent of preference heterogeneity across workers
employed in occupation k . Higher values of  imply less heterogeneity, with all workers
ordering cities in the same way when   . The assumption of a Fr´      echet distribution for
idiosyncratic amenity parameters implies closed form expressions for the fraction of workers
in each city:
                                                                                   
                                                                        Ak  k
                                                                         n Cn
                     Lk
                      n   = Pr    k
                                 vn (a)   >        k
                                              max vn   (a)    =                        k
                                                                                      L .              (2)
                                              n =n
                                                                   n      Ak  k
                                                                           n Cn


3.2     Firms
There are two types of firms: those producing intermediate goods and those producing final
goods. There is a continuum of varieties of intermediate goods which are aggregated into
a finite number of final goods corresponding to J sectors. Varieties of intermediate goods
are characterized by the sector in which they are produced, and by a vector of city-specific
productivity parameters, z = {z1 , z2 , ..., zN }, with each element zn scaling the productivity
of firms in city n producing that variety.
     Final goods are sold in the city where they are produced. Varieties of intermediate goods
are traded across cities. Because of transportation costs, the price earned by intermediate
goods producers need not be the same as the price paid by final goods producers. Intermedi-
ate goods producers operating in city n, sector j , producing a variety indexed by z, produce
               j
a quantity, qn   (z), for which they earn a price pj  n (z). Final goods producers operating in city
n, sector j , purchase a quantity Qj  n ( z ) of the variety  of intermediate goods indexed by z.

3.2.1   Intermediate Goods
Idiosyncratic productivity draws, z, arise from a Fr´echet distribution with shape parameter
. Draws are independent across goods, sectors, and regions. Specifically, if we let  be the
joint cdf of variety-specific productivity parameters across firms in industry j , then


                                   (z) = exp -               (zn )-       .
                                                         n

   Production of intermediate goods a variety indexed by z, in city n, and industry j , takes
place using the technology,
                                                                                j
                                                                                n
                                                                          j
                                                                  -1
                                                                       (1-n )
                                  j                          -1                                  j j
             j
            qn           j
               (z) = zn Hn (z)n               kj kj
                                              n Ln (z)
                                                                                           jj
                                                                                          Mn  (z)n     (3)
                                      k                                               j


                                                   12
         jj
where n      0 is the share of sector j input expenditures spent on materials from sector
                j                                                                           j
j in city n, n     0 is the share of value added in gross output in sector j , and n          is
the share of land and structures in value added in that sector. The production function is
constant returns to scale, J       jj         j                 kj
                             j =1 n = 1 - n . The variable n denotes a labor augmenting
                                                                                           j
productivity component that is city, industry, and occupation specific. We denote by Hn      (z)
the quantity of structures used by a firm producing a variety z in industry j operating in
             jj
city n, by Mn   (z) the quantity of material goods this firm uses from sector j , and by Lkj
                                                                                          n (z)
the workers of type k it employs.
    Importantly, given the evidence presented in Section 2, we allow kj
                                                                      n to reflect externalities
that depend on the composition of the labor force. In particular, we let

                                          kj  kj
                                          n = n (Ln ),

where Ln = {L1          K
             n , ...., Ln } summarizes the occupational make up of the labor force in city n.


3.2.2   Final Goods
A final goods firm operating in industry j in city n produces the quantity Qj
                                                                            n according to
the technology,
                                                                        
                                                          -1            - 1
                                                          

                            Qj
                             n =
                                              Qj
                                               nn (z)          d (z)          ,
                                          n

where Qjnn (z) represents its use of intermediate goods of variety z produced in city n .
    One unit of any intermediate good in sector j shipped from region n to region n requires
producing j nn  1 units in the origin n . Therefore, producers of final goods in each sector
solve

                         max
                         j
                              j j
                             Pn Qn -            j   j     j
                                                nn pn (z)Qnn (z) d (z) ,
                        Qnn (z)
                                          n

subject to Qj
            nn  (z)  0, where Pn j
                                   is the price of the final good in sector j , city n. Intermediate
goods in non-tradable sectors cannot be shipped between cities.
    Final goods firms purchase intermediate goods from the location in which the acquisition
                                                                  j
cost, including transportation costs, is the least. Denote by Xn    the total expenditures on final
                                                                                          j    j j
goods j by city n, which must equal of the value of final goods in that sector, Xn          = Pn Qn .
Because of zero profits in the final goods sector, total expenditures on intermediate goods
in a given sector are then also equal to the cost of inputs used in that sector. Following the
usual Eaton and Kortum (2002) derivations, given a final good j produced in city n, the
share of intermediate inputs imported from location n is

                                                               -
                                  j               j   j
                                                  nn xn
                                  nn    =                          -
                                                                       ,
                                               N
                                               n =1     j   j
                                                        nn xn

where

                                                 13
                                                                        j
                                                                        n
                                                                   j
                                                               1-n                      j j
                     r nj
                                                      k   1-    1-           J      j   n
                j     n              1               wn                            Pn
               xn =    j               j                                                      (4)
                     n
                                  1 - n      k
                                                     kj
                                                     n                      j =1
                                                                                   jj
                                                                                   n

is a cost index associated with the production of varieties in sector j , city n. In quantifying
                                                                    j
the model, we also allow for two non-tradable sectors for which nn     = 1.

3.3    Market Clearing Conditions
Within each city n, the number of workers employed in occupation k must equal the number
of those workers who choose to live in that city. Put alternatively,

                     Lkj
                      n (z)d(z) =
                                           k
                                           n (a)d(a),  n = 1, ..., N , k = 1, ..., K.         (5)
               j

       k
where n  (a)  {0, 1} denotes the location choice of households as a function of their type.
Market clearing for land and structures in each region imply that

                                    j
                                   Hn (z) d (z) = Hn , n = 1, ..., N.                         (6)
                             j

Final goods market clearing implies that

                                 Lk  kj
                                  n Cn +
                                                      jj
                                                     Mn  (z) d (z) = Qj
                                                                      n.                      (7)
                            k               j

Finally, intermediate goods market clearing requires that

                                     j
                                    qn (z) =         j    j
                                                     n n Qn n (z).                            (8)
                                                 n



4      Quantifying the Model
In the model we have laid out, any quantitative statement about efficient allocations will
necessarily depend on the parameterization of occupation-specific externalities. Estimating
these externalities in turn requires that we take the model to the data and recover produc-
tivity in different occupations, sectors, and cities such that the equilibrium of the model
matches these data. Observations used in the model inversion are thus matched by con-
struction. However, other predictions of the model with respect to recovered productivity or
tradable goods prices do not have easily observable counterparts. In fact, we show that the
properties of productivity and prices delivered by the model are comparable to those found
in different recent studies, effectively tying these studies within a single general equilibrium
framework.
    The model is mapped into 22 industries and the two large occupational groups (cognitive
non-routine and others) emphasized in Section 2. Of the 22 industries, two are non-tradable,

                                                     14
meaning that all local output is also used locally. The two non-tradable sectors include real-
estate services, which is the single user of land in each city, and a composite sector comprising
retail, construction, and utilities. Tradable industries include 10 manufacturing sectors and
10 service sectors. In quantifying the model, we focus on the period 2011 to 2015.
    The set of parameters needed to quantify our framework fall into two broad types: i) pa-
rameters that are constant across cities (but may vary across occupations and/or industries)
and ii) parameters that vary at a more granular level and require using all of the model's
equations (i.e. by way of model inversion) to match data that vary across cities, industries,
and occupations.
                                                                  j   jj
    To obtain an initial calibration for the share parameters n     , n  and j , we use an average
of the 2011 to 2015 BEA Use Tables, each adjusted by the same year's total gross output,
                                                     j
where we assume that tradable sectors have n           =  j that are constant across cities and
                jj
similarly for n    's.9
    We adopt the convention that all land and structures are managed by firms in the real
estate sector that then sell their services to other sectors. Accordingly, for all sectors other
than real estate, we reassign the gross operating surplus remaining after deducting equipment
investment to purchases from the real estate sector. These surpluses are in turn added to
the gross operating surplus of real estate.10 This convention implies that the share of land
                    j
and structures, n     , in the production of all sectors other than real estate is equal to zero.
    We set , the Fr´     echet parameter governing trade elasticities, to 10 or well within the
range of estimates of trade elasticities in the literature, between 3 to 17 (see Footnote 44 in
Caliendo and Parro (2015), as well as Head and Mayer (2014), section 4.2 for comprehensive
summaries of estimates). While estimates of  have been carried out at various levels of
disaggregation, these can vary somewhat widely for a given sector or commodity across
studies.11 For our purposes, this uncertainty is further compounded by the fact that trade
elasticities that are relevant for trade between countries may not be appropriate for trade
between regions or cities.
    As mentioned, we assume that two of the sectors ("real estate," as well "retail, construc-
tion, and utilities") are non-tradable, so that their transportation costs are treated as infinite.
For the tradable sectors, we follow Anderson et al. (2014) and assume that trade costs in-
                                                                                                  tj
crease with distance. Specifically, in order to ship one unit of good to city n, j    nn = (dnn )
units of the good need to be produced in city n , with dnn the distance between city n
and city n in miles.12 The parameter tj is industry specific. For commodities, we directly
estimate tj from the Commodity Flow Survey synthetic microdata using standard gravity
regressions based on model trade-shares. In the tradable services, we use the values obtained
by Anderson et al. (2014) using Canadian data.
   9
     Since the model does not allow for foreign trade, we adjust the Use Table by deducting purchases from
international producers from the input purchases and, for accounting consistency, from the definition of gross
output for the sector.
  10
     One can verify that those reassignments do not affect aggregate operational surplus (net of equipment
investment), aggregate labor compensation, and aggregate value added (net of equipment investment).
  11
     For example, while Caliendo and Parro (2015) estimate an elasticity of 7.99 for Basic Metals and 4.75
for Chemicals, Feenstra et al. (2018) estimate a elasticities of, respectively, 1.16 and 1.46 for those two
categories.
  12
     We assume that within city distance is equal to 20 miles.



                                                     15
    Ciccone and Peri (2005) summarize estimates for the elasticity of substitution between
skilled and unskilled labor in the literature as ranging between 1.36 and 2. Card (2001)
estimates the elasticity of substitution between occupations to be closer to 10. We adopt
  = 2 as a benchmark. Finally, we set  so that the average elasticity of employment with
respect to real wages in our model matches the estimate of 1.36 as in Table A.11, column 4,
of Fajgelbaum et al. (2018). This implies  = 2.02.13
                                                                                       k
    Given the parameters above, we use data on wages by occupation and location (wn      ), as
                                                                    kj
well as data on employment by occupation, industry and location (Ln ), to obtain equilibrium
values of productivity and amenities, kj         k                                    K
                                          n and An respectively. Data pertaining to wn , and
    kj
  Ln
       k j is available from the American Community Survey (ACS). The ACS also allows us
  k   Ln
to adjust wages for individual characteristics so that our data captures city wage premia
for each occupation. The Census provides measures of total employment, k Lk        j
                                                                                  n , from the
County Business Patterns (CBP) that better match BEA industry-level counts. We combine
total employment from the CBP with ACS data on employment shares to obtain Lkj         n . The
                                kj       k
exact procedure that yields n and An by way of model inversion is described in detail in
Appendix B.
    Table 1 compares the relationships between wages, employment, and employment com-
position across different cities highlighted in previous work relative to the data used in our
model inversion. The first three rows of the table show regression coefficients of log wages
for CNR workers, non-CNR workers, and the CNR wage premium, on different measures of
city employment and employment composition. The subsequent rows show similar regression
coefficients obtained in previous literature. The data we use implies relationships that are
consistent with those in other work. In particular, all wages increase with city size, more
so for skilled workers. A similar relationship holds for wages and city composition where
proportionally more skilled cities exhibit higher wages for all workers, more so for skilled
workers.14

4.1        Model-Implied Productivity, Amenities, and Prices
There exists a large literature that has estimated and studied the role of agglomeration ex-
ternalities. Much of this work has relied on a production function approach using measures
of output and factor inputs to estimate Total Factor Productivity (TFP), or using labor
productivity more directly, in exploring how productivity depends on the scale of city em-
ployment or its skill composition. There is also a literature that has sought to understand
how tradable goods prices vary with city size. We now show that our model-consistent TFP
measures and tradable prices compare favorably with previous empirical work in both liter-
atures but within a single general equilibrium framework. Moreover, the same framework
   13
      Here,  is somewhat larger than the value obatained by Fajgelbaum et al. (2018). This reflects the fact
that  is the elasticity of labor supply with respect to consumption rather than wages. Because Fajgelbaum
et al. (2018) abstract from non-wage income, they estimate values for the analogous parameter in their model
of between 0.75 and 2.25 depending on identification assumptions.
   14
      An exception is Moretti (2004a) who finds no statistically significant differences in the way that wages
of college educated workers and non-college educated workers vary with employment composition across
cities. Our findings, however, rely on a more recent time period where other work has found an increasingly
pronounced relationship between skill and city size (see Baum-Snow and Pavan (2013)).


                                                     16
can then be used directly to provide a quantitative assessment of optimal spatial policy.

                         Table 1: Wages, Employment, and City Composition

                                                                             LCNR     LCNR
                    Dependent Variable                        ln(Ln )   ln     n
                                                                             LnCNR
                                                                                       n
                                                                                       Ln
                                                                              n




                        CNR                                   0.070       0.332       1.474
                    ln wn
                                                             (0.003)     (0.021)     (0.089)
                        nCNR                                  0.049       0.218       0.973
                    ln wn
                                                             (0.002)     (0.017)     (0.072)
                          CNR
                         wn                                   0.021       0.114       0.501
                    ln    nCNR
                         wn                                  (0.001)     (0.008)     (0.036)

                                                                                      0.85
                    Moretti HS1                                 --           --
                                                                                     (0.06)
                                                                                      0.86
                    Moretti Some College                        --           --
                                                                                     (0.06)
                                                                                      0.74
                    Moretti College +                           --           --
                                                                                     (0.06)
                                                             0.0455
                    Roca & Puga wage log wage constant2                      --        --
                                                            (0.0080)
                                                                          0.26
                    Diamond log college wage3                   --                     --
                                                                         (0.11)
                                                                          0.18
                    Diamond log non-college wage4               --                     --
                                                                         (0.01)
                                                              0.065
                    Baum-Snow et al. log wage, 2005-20075                    --        --
                                                             (< 0.01)
                                                              0.029
                    Baum-Snow et al. log wage ratio6                         --        --
                                                            (< 0.003)
       1. Moretti (2004a) "Estimate the social return to higher education: evidence from longitudinal and
       repeated cross-sectional data", Table 5.
       2. Roca and Puga (2017) "Learning by Working in Big Cities", Table 1.
       3. Diamond (2016) "The Determinants and Welfare Implications of US Workers' Diverging Location
       Choices by Skill: 1980-2000", Figure 4.
       4. Diamond (2016), Figure 3
       5. Baum-Snow et al. (2018) "Why Has Urban Inequality Increased?", Table 1. Standard error reported
       as less than 0.01.
       6. Baum-Snow et al. (2018), Table 2. Standard error reported as less than 0.003.



4.1.1       Tradable Goods Prices and City Size
Recent work by Handbury and Weinstein (2014), using Nielsen home-scanned data on trad-
able goods bought in grocery stores, highlights that tradable consumer prices decrease with
city size. Prior to that study, the consensus view, based on more aggregated prices, was
that such prices instead increased with city size.15 Given the detailed nature of Nielsen
home-scanned prices, Handbury and Weinstein (2014) are able to control for product buyer
  15
     In principle, given that rents generally increase with city-size, tradable consumer prices might indeed
follow the same pattern to the degree that they are partially influenced by local rents as an input cost.


                                                       17
and retailer heterogeneity in a way that is not easily achieved with more aggregate prices.
Allowing for those controls reduces the elasticity of tradable goods bought in grocery stores
with respect to city size to zero. When Handbury and Weinstein (2014) further adjust local
price indices to reflect differences in the number of varieties of goods available in different
cities, they find that the price of tradable goods bought in grocery stores actually decreases
with city size, with an elasticity equal to -0.011 (Table 6). In addition, when calculating
this elasticity after purging the effect of local rents on retail costs, they obtain -0.017 (Table
9 in Working Paper version). In the presence of trade costs, such a declining relationship
indeed emerges when larger cities are generally more productive. It can hold for certain cat-
egories of goods even if the local scarcity of land means that the price of real estate services
is higher, thus driving up the general price level, in larger cities.
    Table 2 below summarizes the relationship between prices obtained in our model inversion
and city size. Similar to Handbury and Weinstein (2014), our general equilibrium framework
reveals a decreasing relationship between prices and city size and, in fact, across all tradable
sectors with an average elasticity of -0.012. In the Food and Beverage sector, our model
inversion reveals an elasticity of -0.010, virtually identical to that Handbury and Weinstein
(2014) for grocery products. Remarkably, our finding arises without direct observation of
prices. Instead they follow from supply and demand relationships within a structural trade
model where cities produce different goods and where trade across regions is costly. When
informed by the data described above, our model then implies that large cities are generally
more productive thus yielding smaller prices for tradable goods.

4.1.2   Amenities
We now turn to the occupation-specific amenities implied by the model inversion, Ak  n . The
relationship between relative amenities for CNR and non-CNR workers against the size and
composition of cities is depicted in Figure 4. Our findings conform to Diamond (2016) in
that cities with more CNR workers are also relatively more amenable to those same workers.
At the same time, larger cities are relatively more amenable to CNR workers helping account
for the concentration of CNR workers in large cities.
    Diamond (2016) provides evidence for a causal impact of local population composition
on amenities. In Appendix E, we show the effect of filtering out the component of amenities
that is endogenous to the local labor composition.16 While suppressing those endogenous
effects eliminates the positive relationship between the CNR share and relative amenities,
the relationship between relative residual amenities and city size becomes stronger. Intu-
itively, given the estimates in Diamond (2016), large non-CNR populations generate larger
congestion effects on CNR workers than on non-CNR workers. The bottom line, therefore, is
that our findings below regarding the optimality of concentrating CNR workers, computed
without endogenous amenities, are if anything conservative.
  16
    Here, we use the parameterization that Fajgelbaum and Gaubert (2018) obtain based on the estimates
by Diamond (2016).




                                                 18
                                                             Slope: 2.02
        0.4
                                                             Correlation: 0.96


        0.2


          0


       -0.2


       -0.4


       -0.6
          0.15    0.2    0.25     0.3        0.35    0.4   0.45     0.5       0.55
                           CNR share of city employment

                                                           Slope: 0.05
                                                           Correlation: 0.5
        0.4


        0.2


          0


       -0.2


       -0.4


       -0.6
              9     10       11         12          13     14        15          16
                                  log city employment
          Figure 4: Relative amenities and city size and composition
Ratio of occupational-specific amenity parameters for each city obtained from the model
quantification against employment share of CNR workers and log total employment. Each
observation refers to a CBSA. Marker sizes are proportional to total city employment.




                                             19
4.1.3    Total Factor Productivity
A substantive literature in urban economics has addressed the relationship between produc-
tivity and city size (i.e. "agglomeration economies"), as well as that between productivity
and employment composition. Baseline estimates of real Total Factor Productivity (TFP)
typically rely on Cobb-Douglas production functions that allow for different types of labor
to enter separately. Within the context of our model, we follow Caliendo et al. (2017) and
express measured TFP as

                                j
           j               n n Xn   j j     j   j      j
   ln T F Pn = ln     n
                            j     - n n ln Hn - n (1 - n )               kj ln Lkj
                                                                                n -
                                                                                          jj
                                                                                          n      jj
                                                                                             ln Mn  , (9)
                          Pn                                      k                   j

where  kj is the share of occupation k wages in sector j 's wage bill. In the model we have
laid out, and up to a first-order approximation (abstracting from selection effects induced
by trade), we have that for tradable sectors,
                                             j
                                     ln T F Pn           kj  j ln kj
                                                                  n ,
                                                    k

              j
where kj
      n           may thus be interpreted as the component of TFP in sector j and city n
                                                                                                j
associated with occupation k .17 In the remainder of the paper, we let Tn     kj
                                                                                 = kj  n     .
    Table 3 below shows the city in which TFP recovered from the model is highest by
industry. The results largely conform to intuition. Productivity in Computers and Electronic
Equipment is highest in San Jose, CA; Honolulu stands out for Accommodation; Anchorage
for Oil, Chemicals and Nonmetallic Minerals; and Seattle for Motor Vehicles (which includes
aircrafts). It is also interesting to note that the two largest cities in the country are also top
cities in several sectors, with New York dominating in most service sectors while Los Angeles
stands out in several manufacturing sectors.
    Table 4 compares estimates of productivity elasticities with respect to city size and em-
ployment composition obtained from our model inversion to those found in previous work.
In particular, we report elasticities with respect to city size from the meta analysis carried
out in Melo et al. (2009). As reported in Table 4, all results point to a positive relationship
between TFP and city size. Moreover, our findings fall within the range of reduced form
estimates found in the literature, with the possible exception of services. However, as in
previous literature, the elasticity of (tradable) services productivity with respect to city size
is substantially larger than that of manufacturing. To the extent that regional prices are
not readily available, the relationship between TFP and city size estimated in some of the
                                                                               j        j
existing literature captures variations in nominal TFP, that is ln T F Pn        + ln Pn  . In other
                                                               j
words, while our model inversion produces measures of Pn , the absence of local price data
can otherwise bias downward empirically estimated elasticities of TFP with respect to city
size. Indeed, our findings indicate that elasticities of real TFP with respect to city-size are
somewhat larger than those of nominal TFP.
  17
    See Appendix B for the details of this derivation. For non-tradable sectors, the city-specific share
parameters make it challenging to compare this term across-cities. Furthermore, our data does not allow us
to separate the productivity of the real-estate sector from the stock of housing.

                                                   20
                                                               j
                 Table 2: Elasticities of Final Goods Prices, Pn , w.r.t. Ln
                        Sector                                     Elasticity
                        Food and Beverage                           -0.010
                        Textiles                                     -0.022
                        Wood, Paper, and Printing                    -0.011
                        Oil, Chemicals, and Nonmetallic Minerals     -0.016
                        Metals                                       -0.014
                        Machinery                                    -0.005
                        Computer and Electronic                      -0.013
                        Electrical Equipment                         -0.003
                        Motor Vehicles (Air, Cars, and Rail)         -0.008
                        Furniture and Fixtures                       -0.009
                        Miscellaneous Manufacturing                  -0.013
                        Wholesale Trade                              -0.007
                        Transportation and Storage                   -0.007
                        Professional and Business Services           -0.018
                        Other                                        -0.011
                        Communication                                -0.002
                        Finance and Insurance                        -0.011
                        Education                                    -0.024
                        Health                                       -0.030
                        Accommodation                                -0.012
                        Real Estate                                    0.132
                        Retail, Construction and Utilities             0.047

                        Average                                      -0.003
                        Tradable Average                             -0.012
                        Manufacturing Average                        -0.011
                        Tradable Services Average                    -0.013


    We also compare our TFP regressions coefficients with respect to the share of CNR
workers to those estimated by Moretti (2004b) using a panel of firms (we use the CNR share
of employment, whereas he uses the college educated share of employment). Again, our TFP
measures are consistent with semi-elasticities that are of the same sign and comparable in
magnitude to those in Moretti (2004b). As before, the regression coefficients become larger
when deflated by the model-consistent regional price index.
    Table 5 shows the coefficients in Table 4 for tradable sectors disaggregated by industry.
We find that the positive relationship between TFP and city size holds uniformly across
all tradable sectors. In addition, we find that the semi-elasticity of TFP in Computer and
Electronics with respect to employment composition across cities is more than twice as large
as the average for manufacturing, replicating the finding by Moretti (2004b) for high-tech
sectors.

4.2    Estimating Production Externalities by Worker Type
So far, we have described the equilibrium levels of ocupation-specific productivity consistent
                                                             kj          j
with observed data on wages and sectoral employment, Tn          kj   n    . Having obtained
these productivity measures through the model inversion, we now turn to estimating their



                                                21
                            Table 3: City with Top TFP for each Industry
                          Industry                                      MSA
                          Food and Beverage                             Los Angeles, CA
                          Textiles                                      Los Angeles, CA
                          Wood, Paper, and Printing                     Minneapolis, MN
                          Oil, Chemicals, and Nonmetallic Minerals      Anchorage, AK
                          Metals                                        Los Angeles, CA
                          Machinery                                     Houston, TX
                          Computer and Electronic                       San Jose, CA
                          Electrical Equipment                          Los Angeles, CA
                          Motor Vehicles (Air, Cars, and Rail)          Seattle, WA
                          Furniture and Fixtures                        Los Angeles, CA
                          Miscellaneous Manufacturing                   Los Angeles, CA
                          Wholesale Trade                               New York, NY
                          Transportation and Storage                    New York, NY
                          Professional and Business Services            San Francisco, CA
                          Other                                         Los Angeles, CA
                          Communication                                 New York, NY
                          Finance and Insurance                         New York, NY
                          Education                                     New York, NY
                          Health                                        New York, NY
                          Accommodation                                 Honolulu, HI



   Table 4: Elasticities of TFP with respect to City Size and Employment Composition

                                                                                  LCN R
                                                           ln (Ln )                n
                                                                                   Ln


                                                      Real    Nominal      Real     Nominal

                         Average1                     0.039     0.027     0.794      0.616
                         Manufacturing Average        0.028     0.017     0.574      0.451
                         Tradable Services Average    0.052     0.038     1.062      0.819

                                                            0.031
                         Melo et. al. Economy2                                     --
                                                           (0.099)
                                                            0.040
                         Melo et. al. Manufacturing                                --
                                                           (0.095)
                                                            0.148
                         Melo et. al. Services                                     --
                                                           (0.148)
                                                  3
                          Moretti College Share                                 0.846
                                                              --
                            (Manufacturing)                                    (0.102)
       1. Excludes non-tradables
       2. Melo et al. (2009) "A Meta-analysis of estimates of urban agglomeration economies", Table 2. "By
       type of response variable" and "By industry group."
       3. Moretti (2004b) "Workers' Education, Spillovers, and Productivity: Evidence from Plant-Level Pro-
       duction Functions", Table 2. College share in other industries, Cobb-Douglass production, 1992.


relationship to the scale and population composition of cities.18
  18
     The empirical exercise focuses on tradable sectors, for which our model generates measures of produc-
tivity separate from local housing supply.


                                                      22
Table 5: Sectoral Elasticities of TFP with respect to city size and employment composition

                                                                                             LCN R
                                                                 ln(Ln )                      n
                                                                                              Ln


                                                             Real Nominal            Real      Nominal

                   Food and Beverage                         0.024       0.014       0.427        0.311
                   Textiles                                  0.029       0.007       0.276        0.246
                   Wood, Paper, and Printing                 0.024       0.012       0.576        0.285
                   Oil, Chemicals, and Nonmetalic Minerals   0.047       0.031       0.935        0.795
                   Metals                                    0.024       0.010       0.489        0.259
                   Machinery                                 0.018       0.014       0.424        0.359
                   Computer and Electronic                   0.056       0.043       1.458        1.203
                   Electrical Equipment                      0.015       0.013       0.398        0.348
                   Motor Vehicles (Air, Cars, and Rail)      0.023       0.014       0.532        0.384
                   Furniture and Fixtures                    0.017       0.008       0.168        0.277
                   Miscellaneous Manufacturing               0.032       0.020       0.626        0.491
                   Wholesale Trade                           0.044       0.037       0.906        0.811
                   Transportation and Storage                0.031       0.025       0.595        0.492
                   Professional and Business Services        0.053       0.035       1.135        0.817
                   Other                                     0.057       0.046       1.063        0.936
                   Communication                             0.040       0.037       0.878        0.829
                   Finance and Insurance                     0.062       0.051       1.353        1.133
                   Real Estate                               0.755       0.887       9.681       12.279
                   Education                                 0.075       0.051       1.624        1.091
                   Health                                    0.065       0.035       1.421        0.776
                   Accommodation                             0.038       0.027       0.588        0.484


    We assume that occupational spillovers have the same labor augmenting effect across
sectors. Hence, we let

                               kj                 Lk
                                                   n
                           ln Tn  =  R,k  j ln           +  L,k  j ln (Ln ) + ln Tn
                                                                                  kj
                                                                                     ,                    (10)
                                                  Ln
       kj
where Tn  is an exogenously determined component of technology. In turn, this term is given
by

                                         kj
                                     ln Tn  = ak    k j      kj   kj
                                               0 + aZ Z n + d + u n ,

where Zn is a vector of observable city/industry characteristics, dkj denotes a set of industry
dummies, and ukj n captures unobserved city-specific sources of natural advantages in the
production of sector j goods with workers of type k .
    Equation (10) allows for an agglomeration effect that depends on city size, through  L,k ,
and an additional effect related to the share of each worker type, through  R,k . The elasticity
of productivity with respect to the agglomeration of a given type k is19

                                    ln kj
                                        n    R,k     Lkn                      Lk
                                                                               n
                                          =      1 -                 +  L,k      .                        (11)
                                    ln Lk
                                        n            L n                      Ln
 19
      See Glaeser and Gottlieb (2008) for a discussion of the marginal implications those elasticities.


                                                       23
Therefore, when  L,k <  R,k , individuals in a given occupation, k , have a larger marginal
effect on that occupation in cities where those individuals are less represented. However,
there are also cross-occupational effects. Specifically, for k = k , we have that

                                       ln kj
                                           n      R,k
                                                              k
                                                         L,k Ln
                                             = -      -         ,                                          (12)
                                       ln Lk
                                           n                 Ln
which implies negative cross-occupational externalities when  L,k <  R,k . This congestion
effect increases with the share of workers in alternative occupations.
    The first column of Table 6 reports the coefficients from a simple OLS regression where
we allow for two-way clustered standard errors by city and industry. These coefficients
are positive and significant. They indicate that individual productivity is enhanced by the
presence of other workers of the same occupational group. The coefficients also indicate the
presence of congestion effects since cross-occupational externalities are negative. These OLS
estimates, however, are potentially biased since workers of a given type may choose to live
in cities where they are relatively most productive. This would induce a correlation between
                                                      kj
the exogenous component of worker productivity, Tn       , and the share of each type of worker
in a given city. Moreover, the estimates might be biased if there are omitted variables which
                            kj
are correlated with both Tn    and the occupational ratio.
    To help address the omitted variable bias, Table 6 explores the effects of adding various
controls to our basic OLS regression. Column 2 includes dummies for 9 census divisions
interacted with industry dummies.20 These should absorb many of the geographical and
historical components that may jointly determine amenities and productivity in different
places. Column 3 introduces the share of manufacturing workers in 1920 as a control.21
This aims to extract long standing factors that may influence the industrial composition
in individual places. Column 4 introduces geographic amenities constructed by the United
States Department of Agriculture (USDA) that include measures of climate, topography and
water area.22 These controls allow for the possibility that the same geographic character-
istics that may lead workers to choose certain cities may also influence their productivity.
Finally, column 5 adds controls for demographic characteristics of different cities, including
racial composition, gender split, the fraction of immigrant population, and age structure.23
Together, these controls help narrow down the identification of the externality coefficients to
the extent that more productive cities attract individuals of certain demographic make-up.
    The point estimates of the coefficients on CNR workers change only slightly with the
controls, while they increase the effect of labor market composition on non-CNR workers.
These controls help extract exogenous sources of productivity variation that affect individual
location decision. However, any residual variation in productivity may still be correlated with
  20
     They are 1. New England, 2. Mid-Atlantic, 3. East North Central, 4. West North Central, 5. South
Atlantic, 6. East South Central, 8. Mountain and 9. Pacific
  21
     Just as with our labor force variables of interest, this and other controls are likewise interacted with the
                      j
value added shares n    .
  22
     Geographic controls include average temperature for January and July, hours of sunlight in January,
humidity in July from 1941 to 1970, variation in topography, and percent of water area.
  23
     Demographic controls are, by city, the percent female, black, hispanic, and percent in the age bins 16-25
and 26-65 (observations related to the younger than 16 population are dropped from the sample, and the
age bin 66+ is omitted from the regression).


                                                       24
population levels and composition. In order to further account for those residual effects, we
adopt an instrumental variable strategy, drawing on the existing empirical literature for
candidate sources of exogenous variation. The key difference here is that we seek to explain
productivity measures extracted from a structural model directly.

                                                   Table 6: OLS Estimates

                                (1)                      (2)                   (3)                        (4)                        (5)

VARIABLES             CNR         non-CNR      CNR         non-CNR      CNR          non-CNR      CNR           non-CNR      CNR           non-CNR
         k
        Ln
j
n log ( Ln
           )         0.822***     0.636***    0.817***     0.673***    0.842***      0.689***    0.838***       0.667***    0.900***    0.681***
                      (0.13)       (0.23)      (0.12)       (0.20)        (0.12)       (0.22)      (0.12)          (0.21)     (0.12)       (0.22)
j
n log (Ln )          0.422***     0.345***    0.419***     0.343***    0.409***      0.345***   0.410***         0.343***  0.388***     0.322***
                      (0.05)       (0.04)      (0.05)       (0.04)        (0.05)       (0.04)      (0.05)          (0.04)     (0.05)       (0.04)
Jan. Temp                                                                0.0217      -0.0553**    0.0135        -0.0583**    0.00705    -0.0464**
                                                                          (0.03)       (0.03)      (0.03)          (0.02)     (0.03)       (0.02)
Jan. Hrs Sun                                                           0.0741***     0.0479*** 0.0720***        0.0490*** 0.0658***    0.0573***
                                                                          (0.01)       (0.01)      (0.01)          (0.01)     (0.02)       (0.02)
July Temp                                                             -0.0816***      -0.0265  -0.0756***         -0.0209 -0.0705***     -0.0398*
                                                                          (0.03)       (0.02)      (0.02)          (0.02)     (0.02)       (0.02)
July Humid                                                               -0.0225      -0.0156     -0.0163         -0.0127  -0.000596      -0.0260
                                                                          (0.02)       (0.03)      (0.02)          (0.03)     (0.02)       (0.02)
Topology                                                                -0.0272*     -0.0244**   -0.0259*       -0.0237** -0.0348***      -0.0174
                                                                          (0.01)       (0.01)      (0.01)          (0.01)     (0.01)       (0.01)
% Water Area                                                           0.0372***      0.00338   0.0380***        0.00370   0.0349***      0.00766
                                                                          (0.01)       (0.01)      (0.01)          (0.01)     (0.01)       (0.01)
% 1920 Mfg Workers                                                                               -0.00587        0.00816    -0.00195     0.00607
                                                                                                   (0.01)          (0.01)     (0.01)       (0.01)
% female                                                                                                                  -0.0497***   -0.0505***
                                                                                                                              (0.01)       (0.01)
% Black                                                                                                                      0.00174   0.0417***
                                                                                                                              (0.02)       (0.01)
% Hispanic                                                                                                                   0.0272*      0.00474
                                                                                                                              (0.02)       (0.02)
% Age 16-25                                                                                                                  0.00567       0.0177
                                                                                                                              (0.03)       (0.04)
% Age 26-65                                                                                                                   0.0260       0.0351
                                                                                                                              (0.03)       (0.03)

Industry FE             X              X         X         X           X            X               X               X          X              X
Census Division FE                               X         X           X            X               X               X          X              X
Observations          7,640           7,640    7,640     7,640       7,560        7,560           7,460           7,460      7,459          7,459
R-squared             0.599           0.764    0.649     0.797       0.659        0.804           0.661           0.808      0.663          0.811
                                                   Robust standard errors in parentheses
                                                     *** p<0.01, ** p<0.05, * p<0.1




4.2.1          Instrumenting for Employment Levels and Composition
In order to isolate the residual simultaneity between exogenous productivity variation and
labor allocation, we resort to variants of instruments proposed in the literature. Specifically,
we follow Ciccone and Hall (1996) and use population a century ago to capture historical
determinants of current population. We also follow Card (2001) and Moretti (2004a), and
use variation in early immigrant population and the presence of land-grant colleges to cap-
ture historical determinants of skill composition across cities. A detailed discussion of the
particular instruments is provided in Appendix B.
    Table 7 shows the estimation results with instrumental variables and all the controls. The
first column repeats the OLS results in the last column of Table 6, and the second column

                                                                      25
shows the corresponding two-stage-least-squares estimates. Those are similar to the OLS
estimates, being well within one standard error from one another. To evaluate the strength
of the instrumental variables, we follow the procedure in Sanderson and Windmeijer (2016)
to obtain separate first-stage F statistics for each of the endogenous variables.24 Since the
F-statistics are below the value of 10 recommended by Staiger et al. (1997), the estimates
may have some bias and incorrect standard errors. The literature on IVs then recommends
the use of limited information maximum likelihood (LIML) estimators. The third column
of Table 7 carries out the estimation using a continuously updated GMM estimator (GMM-
CUE), similar to a limited information maximum likelihood estimator but which allows for
clustered and heteroskedastic standard errors. The Stock and Yogo (2005) critical values in
the LIML model for a p-value of 5% to be 10% or better is 6.46, at or close to our obtained
values.
    To verify that our empirical strategy indeed identifies external effects, we carry out the
same regressions on data generated by a counterfactual allocation in which we set  R,k =
 L,k = 0 for all occupations k . The results are presented in Table 10 in the Appendix.
They confirm that the OLS estimates for the effect of occupation shares on productivity are
biased downward (the coefficients are now negative), whereas the estimates for the external
productivity effects related to population exhibit little bias. More importantly, the exercise
also shows that our IV's successfully eliminate most of those biases, especially so in the
GMM-CUE estimates.
    As a final measure of robustness, we carry out an estimation exercise using IV's implied
by the model. Recall that, in our framework, the size and composition of population in dif-
ferent locations is determined simultaneously by local productivity, amenities, input-output
linkages, and trade costs. Thus, we construct a counterfactual allocation where, for each
industry and occupation, we set productivity to be fully exogenous and equal to the av-
                                                          kj
erages, across cities, of the productivity parameters, Tn    . We then use the counterfactual
employment shares and totals implied by that exercise as instruments. The results, presented
in Table 11 in the Appendix, confirm the main findings. Namely, the effect of population
composition is larger than that of city size, and the compositional effect is larger for CNR
workers than for non-CNR's.

4.3     The Role of Externalities in Spatial Occupational Polarization
We adopt the GMM-CUE coefficients in the last column of Table 7 as our benchmark.
These coefficients imply that cross-occupational externalities are negative for CNR workers
in that  L,CN R is significantly smaller than  R,CN R . Hence, non-CNR workers create negative
congestion effects for CNR workers. In contrast, for non-CNR workers, the difference between
 R,nCN R and  L,nCN R is not significant indicating no clear evidence of congestion effects from
CNR workers to non-CNR workers.25
    The externality effects coming from the local occupational composition are also clearly
substantial. They imply, all else equal, that moving from Winston-Salem, NC with a share
  24
     This follows largely the intuition laid out by Angrist and Pischke (2008), that requires strong IVs to
predict the two endogenous variables independently from one another.
  25
     The p-value when testing the hypothesis that  R,k -  L,k is positive is equal to 0.017 for the case of
CNRs and equal to 0.34 for the case of non-CNRs.


                                                    26
                           Table 7: Instrumental Variables Estimate

                                     (1)                   (2)                   (3)
                                    OLS                   2SLS                  CUE
            VARIABLES           CNR    non-CNR        CNR    non-CNR        CNR    non-CNR
                     k
            j
            n log ( Ln
                    Ln
                       )       0.900***   0.681***   1.237***     0.258    1.338***     0.795
                                (0.12)     (0.22)     (0.38)     (0.50)     (0.38)     (0.50)
            j
            n log (Ln )        0.388***   0.322***   0.331***   0.286***   0.342***   0.354***
                                (0.05)     (0.04)     (0.06)     (0.04)     (0.06)     (0.04)

            Observations        7,459      7,459      7,459      7,459      7,459      7,459
            K.P. F                                    4.180      5.748      4.180      5.748
            S.W.F. Lkn Share                          6.429      8.964      6.429      8.964
            S.W.F. Ln                                 6.384      9.040      6.384      9.040
                                   Robust standard errors in parentheses
                                     *** p<0.01, ** p<0.05, * p<0.1


of CNR employment of 36 percent, corresponding to approximately the 75th percentile of
the distribution of CNR shares, to Austin, TX, with share of 42 percent, closer to the 94th
                        kj
percentile, increases Tn   for CNR workers by approximately 7 percent and reduces that of
non-CNR workers by close to 2.5 percent. Agglomeration externalities are similarly impor-
tant. Moving from a city near the 75th percentile, such as Trenton, NJ, with approximately
180 thousand workers, to one near the 87th percentile such as Rochester, NY, with approx-
imately 430 thousand, would imply a gain of close to 10% for both types of workers.
    In Section 2 we conjectured that occupational externalities account for salient patterns
in the data related to the polarization of occupations and wage inequality across cities.
Given the model, the recovered TFP measure obtained through its inversion, as well as the
externalities in TFP we estimated, we now verify this basic intuition.
    Counter-factual equilibrium allocations generated in the absence of externalities (i.e.,
 R,k =  L,k = 0 for all k ) are presented in Figures 5 and 6. Figure 5 shows that absent
externalities, the relationship between the share of CNR workers and the wage premium
indeed becomes negative, indicating that the relative abundance of CNR workers now de-
creases their relative compensation. Furthermore, Figure 6 shows that without externalities,
the equilibrium wage bill share increases less than one-for-one, as opposed to more than
one-for-one, with the wage bill share predicted by the industrial composition across cities.
To see why, note that absent production externalities induced by employment size and com-
position, productivity is pinned down exogenously. Therefore, CNR workers in a city that
has a comparative advantage in the production of CNR intensive goods will generally earn
higher wages. Firms in that city will consequently substitute CNR workers for non-CNR
workers and, given an elasticity of substitution between occupations greater than 1, see a
reduction in its CNR wage share.
    These exercises point to the patterns identified in Section 2 as being effectively driven
by occupation-specific elasticities. Given the significance of these externalities, the optimal
and equilibrium allocations differ. This in turn creates a role for optimal spatial policy to
which we turn next.


                                                     27
                                                                                                              Slope: -3.94
                                                                                                              Correlation: -0.75

          Log ratio of CNR to non-CNR wages
                                              0.5

                                              0.4

                                              0.3

                                              0.2

                                              0.1

                                                0

                                              -0.1

                                              -0.2

                                              -0.3
                                                     0.2    0.25      0.3   0.35      0.4       0.45          0.5        0.55   0.6
                                                                    CNR share of city employment
                                         Figure 5: Occupational share and wage premium - no externalities
       Counterfactual values obtained from assuming no externalities ( R,k =  L,k = 0), while
       keeping the exogenous part of productivity as originally quantified.



5     Optimal Allocation
5.1    The Planner's Problem
We now describe the optimal allocation and the policies that implement it. The planner's
problem takes as given that workers in different occupations can freely choose in which city
to live. Under this assumption, the expected utility of a worker of type k is given by
                                                                                                          1
                                                                                                          
                                                                         -1                       k 
                                                            vk =                              Ak
                                                                                               n Cn           ,
                                                                                      n

so that, given welfare weights for each occupation, k , the utilitarian planner solves
                                                                                                              1
                                                                                          N                   
                                                                            -1                         
                                                           W=       k                          Ak  k
                                                                                                n Cn              Lk .                (13)
                                                                k
                                                                                      n=1

The planner maximizes the expression in (13) subject to the availability of labor in each city
and occupation (2), the constraints on the use of labor in each occupation and city (5), the
constraints on the use of land and structures (6), the resource constraints associated with
final goods in each city and sector (7), the resource constraints associated with intermediate
goods across all varieties z in each industry j and city n (8), and the constraints that
household consumption of different goods and input flows be non-negative.

                                                                                 28
      Figure 6: Occupational wage bill share: predicted vs equilibrium - no exter-
      nalities
      Counterfactual values obtained from assuming no externalities ( R,k =  L,k = 0), while
      keeping the exogenous part of productivity as originally quantified.




   The key difference between the optimal and equilibrium allocations stems from a wedge
between the private and social marginal products of labor. Lemma 1 characterizes this
wedge.

Lemma 1. Let k    n denote the wedge between the private and the social marginal value of a
worker in occupation k in city n. Then

                                                   Lk j   kj
                                                    n  ln n (Ln )
                               k
                               n =
                                               k
                                              wn                  .                            (14)
                                       k ,j
                                                   Lkn   ln Lk
                                                             n


   This expression for the wedge points to the distortions that the planner is seeking to


                                                   29
correct. To focus ideas, consider our case with two occupations, k and k , where spillover
elasticities are the same in all sectors. In that case we have that

                                         ln kn (Ln )
                                                            k     k
                                                         k Ln  ln n (Ln )
                             k    k
                             n = wn                  + w n                .
                                           ln Lkn          Lk
                                                            n    ln Lk
                                                                     n

The estimated externality parameters in Table 7 imply, using equations (11) and (12),
that occupation k 's own elasticity,  ln k                k
                                            n (Ln ) / ln Ln , is positive while the cross-elasticity,
 ln k                k
      n (Ln ) / ln Ln , is negative. It follows that the wedge for any given occupation k in-
creases with its wage and decreases with the wage of occupation k . Hence, the planner
would like to increase the concentration of workers of a given occupation in places where
those workers are most productive, and in places where workers in other occupations are less
productive. The latter effect is stronger for CNRs than non-CNRs since  ln k        n (Ln ) / ln Ln
                                                                                                    k

is substantially larger when k = CNR. The end result is an increase in spatial polarization.
    Given these wedges, the optimal policy is then most intuitively framed in terms of a set of
taxes and subsidies that incentivize workers to move to cities where their spillovers are larger.
Put another way, the planner internalizes the wedge between the private and social marginal
productivity of workers. At the same time, a utilitarian planner also attempts to balance
gains between different type of workers. Proposition 1 provides an exact characterization of
this spatial policy.
Proposition 1. If the planner's problem is globally concave, the optimal allocation can be
achieved by a set of taxes and transfers such that

                                     k
                                Pn C n = (1 - tk    k   k     k   k
                                               L )(wn + n ) +  + R ,
               1
where tk
       L =    1+
                 ,   and Rk is such that

                                          k v k L k =             k k
                                                             Pn C n Ln .
                                                         n

    The proposition generalizes Proposition 2 in Fajgelbaum and Gaubert (2018) to a multi-
industry environment. Observe that industry superscripts, j , do not appear in Proposition 1.
In other words, the proposition establishes that the formulations in Fajgelbaum and Gaubert
(2018) may still be used when the environment is extended to include different industries
even when these are interdependent through input-output linkages.26 Of course, that is not
to say that the optimal allocation does not depend on local industry-specific productivity
(since they determine local employment and wages in both occupations), or that the optimal
allocation has no implications for the composition of industries across space. We show below
that under the optimal policy, large and small cities expand industries in which a large share
of their employment already resides, intensive in CNR and non-CNR workers respectively,
while medium-size cities generally diversify across industries.
    Proposition 1 tells us that the planner's solution for household consumption differs from
that implied by their budget constraint in two ways. First, the planner's solution depends on
  26
     One can show that when spillover elasticities are industry-specific, the formulas in Proposition 1 no
longer hold exactly. In that case, employment shares of different industries in different occupations are
sufficient to capture the role of industrial composition, independently of the details of input-output linkages.

                                                        30
                                                                                                   CNR worker spillovers
                                                                                                                           20000

                                                                                                                           10000

                                                                                                                               0

                                                                                                                           -10000

                                                                                                                           -20000
                                                                                                                                     0.2   0.3   0.4    0.5
                                                                                                                                    CNR share in data
                                                                                                                                     = 0.005 , ~ = 0.323




                                                                                                   CNR worker spillovers
                                                                                                                           20000

                                                                                                                           10000

                                                                                                                               0

                                                                                                                           -10000

                                                                                                                           -20000
                               < -11200                    [ -5580 , 0 )        [ 5580 , 11200 )                                      10    12     14     16
       CNR worker spillovers                                                                                                        Log population in data
       (deviation from mean)   [ -11200 , -5580 )          [ 0 , 5580 )         >= 11200                                              = 0.402 , ~ = 0.706
                  Population   12,000          3,909,000            7,805,000


                               Figure 7: CN
                                         n
                                            R
                                              (equilibrium values)
       CNn
            R
              captures the wedge between the social and the private marginal product of labor
       for CNR workers, as described in Lemma 1. Figure depicts deviation from employment
       weighted average (US$ 58,273). Each marker in the map refers to a CBSA. Marker sizes
       are proportional to total employment in each city.  and ~ are unweighted and population
       weighted correlations respectively.



                                                 k
the social marginal product of labor, given by wn  + k  n , rather than its private counterpart.
Second, in the planner's solution, consumption increases less than one-for-one with the (so-
cial) marginal product of labor. This second element is optimal because, given heterogeneity
in preferences for locations, households that choose to live in lower wage cities do so because
their marginal utility of consumption is higher in those cities.27

5.2     The Value of Social Wedges Across Cities and Occupations
The wedge between the social and private marginal product of labor, k          n , may be calcu-
lated for each city and occupation using equation 14. Figures 7 and 8 show the deviations
of those wedges from their (employment weighted) means for CNR and non-CNR workers,
respectively. The average wedge for CNR workers is itself fairly large, at $58,273 dollars per
worker, or 82 percent of the mean CNR wage. The average wedge for non-CNR workers is
more modest and negative, at -$8,345. The wedge of non-CNR workers is negative because
their presence in a given city is associated with a reduction in its share of CNR workers which
then lowers the productivity of those workers. On average, non-CNR workers generate a net
congestion effect. Together, these values imply an average gain of $66,619 from switching a
non-CNR for a CNR worker. This large value is the result of the relative scarcity of CNR
workers. Implying that using them productively makes a substantive difference. Further-
  27
     Fajgelbaum and Gaubert (2018) show that the heterogeneity in preferences induces the same optimal
tax as an isoelastic negative spillover in amenities.


                                                                31
                                                                                                 Non-CNR worker spillovers Non-CNR worker spillovers
                                                                                                                                                       20000

                                                                                                                                                       10000

                                                                                                                                                           0

                                                                                                                                                       -10000

                                                                                                                                                       -20000
                                                                                                                                                                 0.2   0.3   0.4    0.5
                                                                                                                                                                 CNR share in data
                                                                                                                                                                 = -0.934 , ~ = -0.941
                                                                                                                                                       20000

                                                                                                                                                       10000

                                                                                                                                                           0

                                                                                                                                                       -10000

                                                                                                                                                       -20000
                                      < -7720                [ -3860 , 0 )     [ 3860 , 7720 )                                                                    10    12     14     16
      Non-CNR worker spillovers                                                                                                                                 Log population in data
      (deviation from mean)           [ -7720 , -3860 )      [ 0 , 3860 )      >= 7720                                                                           = -0.63 , ~ = -0.652
                  Population       12,000        3,909,000         7,805,000


                                  Figure 8: nCN
                                            n
                                                R
                                                  (equilibrium values)
       nCN
         n
             R
               captures the wedge between the social and the private marginal product of labor
       for non-CNR workers, as described in Lemma 1. Figure depicts deviation from employment
       weighted average (US$ -8,345). Each marker in the map refers to a CBSA. Marker sizes
       are proportional to total employment in each city.  and ~ are unweighted and population
       weighted correlations respectively.



more, this large gain indicates that education and migration policies that create and attract
CNR workers can potentially have high social value. Here, however, we take the supply of
CNR and non-CNR workers as given.
    We find a strong positive correlation between CN    n
                                                           R
                                                             the wedge between the social and
private value of CNR workers, and city size (0.40). In contrast, the correlation between
this wedge and the CNR share across cities is close to zero (0.005). These findings indicate
that, given the concavity of external effects and the fact that there are diminishing returns
to each factor, high CNR cities already exploit CNR externalities to a large degree in the
decentralized equilibrium. However, the correlation with the CNR share becomes positive
(0.32) when weighted by city size. Thus, there nevertheless remain gains to be exploited in
larger, CNR intensive, cities. Externalities from CNR workers appear to be particularly large
in New York, Houston, and cities in California and and much less pronounced in Florida
and, more broadly, in the South and Mid-West (except, modestly, in Chicago).
                                    -CN R
    The overall patterns for non n        , the wedge between the social and private value of
non-CNR workers, are more pronounced in Figure 8. In particular, there exists a clear
negative relationship between the wedge of non-CNR workers and both city size and the
CNR share across cities. The social value of non-CNR workers relative to their private value
is positive in many smaller cities. This wedge is also relatively large in some larger cities such
as in Florida, Las Vegas, and Phoenix. These findings indicate that an optimal allocation
would encourage or incentivize non-CNR workers to move to smaller non-CNR abundant


                                                               32
cities. It is in those cities where they can make their largest contributions.

5.3    Quantifying the Optimal Allocation
In computing the optimal allocation, we set Pareto weights such that gains under the plan-
ner's solution are proportionately equal for both types of workers. Figures 9 and 10 show
the percentage change in employment in the optimal allocation relative to the equilibrium
allocation for CNR and non-CNR workers respectively. The results show that it is gener-
ally optimal for CNR workers to move to larger cities and for non-CNR workers to move to
smaller cities, thereby exacerbating the spatial polarization of occupations. This increased
spatial polarization follows from the spillover coefficient estimates in Section 4.2 which un-
derscore that both types of workers (but particularly those in CNR occupations) become
more productive when clustered with other workers of their own type.
    As Figure 9 shows, increases in CNR workers under the optimal allocation are particularly
large in cities like New York, San Francisco or San Jose, where the wedge between social and
private marginal products of labor for CNR workers is especially large. These cities, together
with other large cities including Chicago, Dallas, and Los Angeles, which are somewhat less
CNR intensive, become cognitive hubs under the optimal allocation. More generally, the
optimal policy creates cognitive hubs in larger cities that are already CNR abundant under




                                                                                                       Percentage change in
                                                                                                                              0.4

                                                                                                                              0.2




                                                                                                            CNR pop.
                                                                                                                              0.0

                                                                                                                              -0.2

                                                                                                                              -0.4
                                                                                                                                      0.2   0.3   0.4    0.5
                                                                                                                                     CNR share in data
                                                                                                                                      = 0.485 , ~ = 0.632
                                                                                                       Percentage change in




                                                                                                                              0.4

                                                                                                                              0.2
                                                                                                            CNR pop.




                                                                                                                              0.0

                                                                                                                              -0.2

                                                                                                                              -0.4
                                < -0.206                     [ -0.103 , 0 )        [ 0.103 , 0.206 )                                   10    12     14     16
       Percentage change in                                                                                                          Log population in data
       CNR pop.                 [ -0.206 , -0.103 )          [ 0 , 0.103 )         >= 0.206                                            = 0.65 , ~ = 0.837
                   Population   12,000           3,909,000             7,805,000




                  Figure 9: LCN
                             n
                                R
                                  (percentage change from data equilibrium)
       Percentage change in employment of CNR workers between equilibrium and optimal values.
       Each marker in the map refers to a CBSA. Marker sizes are proportional to total equilibrium
       employment in each city.  and      ~ are unweighted and population weighted correlations
       respectively.




                                                                   33
the decentralized equilibrium. Given that trade is costly, cities that gain CNR workers
are somewhat uniformly distributed in space according to overall economic activity. They
constitute cognitive hubs in that they absorb CNR workers and are now surrounded by
smaller cities with more non-CNR workers.
   Figure 10 illustrates that while the planner generally chooses to incentivize non-CNR
workers to move from large cities, a few large cities do nevertheless become more non-CNR
abundant under the optimal allocation. This is the case for cities such as Miami, Las Vegas,
Phoenix, and San Antonio where non-CNR workers have, in the decentralized equilibrium,
a social marginal product that is larger than their private marginal product. These cities
become new non-CNR centers. They specialize in non-CNR intensive industries, such as
accommodation and retail, and grow in size since the inflow of non-CNR workers is larger
than the exodus of CNR workers specified by the optimal allocation.
   While the share of CNR workers increases in large cities under the optimal allocation,
the top panel of Figure 11 also shows that these cities lose in overall population while
smaller cities increase in size. The same pattern holds for cities with large and small CNR
shares in the bottom panel of 11. New cognitive hubs, therefore, emerge along side growing
small and non-CNR abundant cities. Put another way, the city size distribution evens out
under the optimal allocation. This feature recognizes that while the productivity of CNR
workers increases with the number of those workers, congestion also increases with city size.




                                                                                                       Percentage change in
                                                                                                                              0.5




                                                                                                          Non-CNR pop.
                                                                                                                              0.0


                                                                                                                              -0.5


                                                                                                                              -1.0
                                                                                                                                      0.2   0.3   0.4    0.5
                                                                                                                                     CNR share in data
                                                                                                                                      = -0.68 , ~ = -0.785
                                                                                                       Percentage change in




                                                                                                                              0.5
                                                                                                          Non-CNR pop.




                                                                                                                              0.0


                                                                                                                              -0.5


                                                                                                                              -1.0
                                < -0.361                     [ -0.181 , 0 )        [ 0.181 , 0.361 )                                   10    12     14     16
       Percentage change in                                                                                                          Log population in data
       Non-CNR pop.             [ -0.361 , -0.181 )          [ 0 , 0.181 )         >= 0.361                                           = -0.657 , ~ = -0.719
                   Population   12,000           3,909,000             7,805,000




                 Figure 10: LnCN
                             n
                                 R
                                   (percentage change from data equilibrium)
      Percentage change in employment of non-CNR workers between equilibrium and optimal
      values. Each marker in the map refers to a CBSA. Marker sizes are proportional to total
      equilibrium employment in each city.  and   ~ are unweighted and population weighted
      correlations respectively.




                                                                   34
    Percentage change in population from     0.4                                                             Slope: -0.05
    data equilibrium to optimal allocation                                                                   Correlation: -0.69
                                             0.3

                                             0.2

                                             0.1

                                               0

                                             -0.1

                                             -0.2

                                             -0.3

                                             -0.4
                                                     9      10      11           12          13         14         15        16
                                                                         Log population in data


                                                                                                             Slope: -1.31
    Percentage change in population from




                                             0.5
    data equilibrium to optimal allocation




                                                                                                             Correlation: -0.86
                                             0.4

                                             0.3

                                             0.2

                                             0.1

                                               0

                                             -0.1

                                             -0.2

                                             -0.3

                                             -0.4
                                                    0.15   0.2   0.25      0.3        0.35        0.4    0.45       0.5     0.55
                                                                  CNR share of city employment

                                               Figure 11: City size changes between data and optimal allocation
                Each observation refers to a CBSA. Marker sizes are proportional to total employment.



In particular, as discussed above, non-CNR workers generate negative congestion effects
on the productivity of CNRs. Furthermore, heterogeneous location preferences imply that


                                                                                      35
attracting the marginal CNR worker to a given city becomes increasingly difficult.
    Along with cities becoming more even in size under the optimal allocation, we observe
that both small and large cities generally increase their degree of industrial specialization,
while medium-size cities tend to move towards greater industrial diversification. Figure 12
highlights this pattern using changes in the Gini coefficient associated with the distribution
of wage bill shares across industries. The figure illustrates how these changes vary with the
share of CNR employment and depicts a U-shaped pattern. In the efficient allocation, cities
with low and high CNR worker shares become more specialized. In contrast, cities with
intermediate CNR shares exhibit zero or negative changes in Gini coefficients, indicating
no change or greater industrial diversification in those locations. This finding emerges be-
cause concentrating occupations is more valuable in cities that are particularly productive
in industries intensive in a specific occupation. The planner's solution, therefore, prescribes
further expanding industries intensive in either CNR or non-CNR occupations in cities that
have a more extreme skill mix. Moreover, these cities tend to be at either end of the size dis-
tribution so that the U-shaped relationship shown in Figure 12 also holds, though somewhat
attenuated, with respect to population (see Figure 24 in the Appendix).
    As examples of how efficient allocations change the industrial composition landscape,
Figure 13 highlights two cities at either end of the CNR share distribution. At one end,
San Jose, CA, with close to 1 million workers, sees its share of CNR workers increase from



                                             0.15
    data equilibrium to optimal allocation
       Change in Gini coefficient from




                                              0.1


                                             0.05


                                                0


                                             -0.05


                                              -0.1


                                             -0.15
                                                 0.15   0.2   0.25   0.3    0.35    0.4   0.45   0.5      0.55
                                                                CNR share of city employment

   Figure 12: Changes in the Gini coefficient between the data and optimal allocation.
                      Each observation refers to a CBSA. Marker sizes are proportional to total employment. The
                      solid-black line is a cubic fit on the data. The Gini is constructed using the Lorenz curves
                      depicting within city wage bill and industry rank.



                                                                           36
50.8% to 91.2%. This change reflects an increase in industrial specialization, summarized
by a 0.11 change in the Gini coefficient and seen as an outward shift in its Lorenz curve
in the left panel of Figure 13. It captures in part an increase of 19 percentage points
in the employment share of San Jose's top industry, Professional and Business Services,
and a 15 percentage point increase in that industry's wage bill share. At the other end,
Harrisonburg, VA, with only 50,106 workers, sees instead its share of non-CNR workers
increase from 72.9% to 84.1%. This change stems from the planner emphasizing employment


                                       San Jose, CA                                                                                        Harrisonburg, VA
                        100                                                                                            100


                        80                                                                                             80
   Share of wage bill




                                                                                                  Share of wage bill
                        60                                                                                             60


                        40                                                                                             40


                        20                                                                                             20


                         0                                                                                              0
                              0   20     40                        60        80        100                                   0        20       40    60       80   100
                                       Industry Rank                                                                                        Industry Rank
                                                                                       South Bend, IN
                                                                   100


                                                                   80
                                              Share of wage bill




                                                                   60


                                                                   40


                                                                   20


                                                                    0
                                                                         0        20     40                            60        80         100
                                                                                       Industry Rank

                        Figure 13: Shift in the Lorenz curve between the data and optimal allocation.
                         Each marker refers to an industry, where the dashed gray line shows the Lorenz curve for
                         the data equilibrium and the blue line is for the optimal allocation.




                                                                                             37
in the industries in which Harrisonburg's non-CNR workers are already intensively employed;
hence, the Gini coefficient increases by 0.05. Under the optimal allocation, the employment
share in Harrisonburg's top industry, Non-Tradables (Retail, Construction, and Utilities),
increases by 2.0 percentage points while its wage bill sees a 3.2 percentage point rise.
     In the middle of the city size distribution, changes in the Gini coefficient associated with
wage bill shares across industries are generally close to zero or negative. In other words,
many of those medium-size cities either stay with or diversify their industrial mix. The
bottom panel of Figure 13, for example, shows an inward shift of the Lorenz curve for South
Bend, IN. South Bend, a city of around 121,220 workers, sees its Gini coefficient fall by
around 0.05 as its employment spreads out across more industries. The wage bill share of
its initial top industry, namely Health, declines by 3.8 percentage points, while the wage bill
share of its new top industry, Non-Tradables, increases by 1.9 percentage points.

5.3.1   Taxes and Transfers: Implementing the Optimal Allocation
Implementing the optimal allocation involves transfers specific to each occupation and city.
Including the transfers, total consumption is equal to total income in each city. These
transfers serve several functions. First, they incentivize agents to move as described above.
Namely, they incentivize CNR workers to move to cognitive hubs and non-CNR workers to
move to smaller towns. Second, they guarantee that relative welfare gains are the same
across occupations and locations. Thus, the planner compensates non-CNR workers for
moving to smaller and less productive or amenable cities by implementing transfers from
larger to smaller cities. These transfers in turn are mostly financed by CNR workers in
larger cities. Note, however, that since CNR workers gain from the policy as well, they do
not mind making the transfers. The net flow of resources received or paid by cities (i.e the
trade balance) is shown in Figure 14, calculated as the difference between local nominal per
                                              k k        k k
capita consumption and output,         k Pn C n L n - k wn Ln - rn Hn /Ln .
    As expected, the trade balance of cognitive hubs is large and negative. Cities such as
San Francisco and San Jose that are relatively large and very CNR intensive, specializing,
respectively, in professional and business services and computer and electronics, send net
payments of as much as $40,000 per resident, while some of the smaller cities, such as
Jacksonville, NC, specializing in accommodation and retail receive net transfers of close to
$20,000. These net transfers in some of the smaller cities amount to a form of basic income
paid to all non-CNR workers in small cities and financed (in net) by agents living in cognitive
hubs. Again, there are some exceptions as some relatively large cities such as Las Vegas end
up receiving net transfers since they become even larger centers of non-CNR employment.
    The pattern of spillover coefficients we estimated, together with our model, implies that
the optimal allocation exacerbates the extent of labor market polarization across space.
However, this pattern does not reveal why labor markets are already as polarized as they
are in the decentralized equilibrium. As indicated in Figure 4, larger cities are relatively
more amenable to CNR workers, a pattern that survives even if we exclude the endogenous
component of amenities highlighted by Diamond (2016). In Appendix E, we show that even
with that component excluded, the planner chooses to create cognitive hubs by concentrating
CNR workers in large cities.
    The overall gains in welfare from implementing the optimal allocation amount to 0.72%

                                               38
                                                                                                                25000




                                                                                                Trade balance
                                                                                                                    0

                                                                                                                -25000

                                                                                                                -50000

                                                                                                                -75000
                                                                                                                          0.2   0.3   0.4    0.5
                                                                                                                          CNR share in data
                                                                                                                          = -0.432 , ~ = -0.687
                                                                                                                25000




                                                                                                Trade balance
                                                                                                                    0

                                                                                                                -25000

                                                                                                                -50000

                                                                                                                -75000
                               < -17600                 [ -8810 , 0 )        [ 8810 , 17600 )                              10    12     14     16
          Trade balance                                                                                                  Log population in data
          (per capita)         [ -17600 , -8810 )       [ 0 , 8810 )         >= 17600                                     = -0.451 , ~ = -0.613
                  Population        12,000          3,909,000           7,805,000


                                   Figure 14: Trade balance per capita
       Trade balance is defined as the difference in the optimal allocation between the value con-
                                                      k k         k k
       sumed and value added in each city ( k Pn Cn    Ln - k wn   Ln - rn Hn ). Trade balance per
       capita are given by those values divided by Ln . Each marker in the map refers to a CBSA.
       Marker sizes are proportional to total equilibrium employment in each city.  and      ~ are
       unweighted and population weighted correlations respectively.



of GDP for workers in both occupations. These gains are almost double those found in
recent work by Bartelme et al. (2019) at 0.4% of GDP in a study of optimal industrial policy
in a multi-country trade model. One reason why gains are not even larger in our setup is
that the observed equilibrium allocation is already fairly polarized. In fact, in Section 6 we
try to account for what has lead to this fairly polarized state starting from the prevailing
conditions in 1980.
    To achieve equal welfare gains across occupations, the optimal transfer scheme has two
components. One that incentivizes agents to go to the `right' location and is related to
differences in k                                                                      k
                n across locations. The other is a fixed transfer by occupation (R ). This
fixed transfer guarantees that all workers obtain equal gains from moving to the planner's
allocation. This fixed transfer amounts to a negative transfer (a payment) of -$16,856 for
CNR workers and a positive transfer of $18,126 to all non-CNR workers. The latter can be
implemented as a universal basic income that is paid by CNR workers. This transfer may
then be considered as the redistribution that CNR workers are willing to accept to form the
cognitive hubs where they can thrive.
    The optimal transfers also involve a component that incentivizes CNR worker to move to
large, CNR abundant cities and for non-CNR workers to move to smaller cities with smaller
shares of CNR workers. This is achieved by giving large incentives to non-CNR workers
to move out of large, and more markedly, CNR abundant cities. Due to externalities that
are occupation-specific, this reallocation yields larger CNR productivity increases in CNR
abundant cities, which attracts CNR workers to these cities and eliminates the need for large

                                                                   39
                                                                                                                    10000




                                                                                                CNR net transfers
                                                                                                                        0


                                                                                                                    -10000


                                                                                                                    -20000
                                                                                                                              0.2   0.3   0.4    0.5
                                                                                                                              CNR share in data
                                                                                                                              = -0.474 , ~ = -0.653
                                                                                                                    10000




                                                                                                CNR net transfers
                                                                                                                        0


                                                                                                                    -10000


                                                                                                                    -20000
         CNR net transfers       < -4950                [ -2470 , 0 )         [ 2470 , 4950 )                                  10    12     14     16
         (per capita deviation                                                                                               Log population in data
         from mean)              [ -4950 , -2470 )      [ 0 , 2470 )          >= 4950                                         = -0.02 , ~ = -0.125
                    Population   12,000         3,909,000         7,805,000


                Figure 15: Optimal transfers to CNR workers (per CNR worker)
       Optimal transfers per CNR workers are defined as the difference in the optimal allocation
       between the value consumed and the income they would receive given optimal wages and
                                           CN R       CN R
       rents but absent the transfers (Pn Cn     - wn      - k ). Figure depicts deviation from
       employment weighted average (US$ -4,345). Each marker in the map refers to a CBSA.
       Marker sizes are proportional to total equilibrium employment in each city.  and    ~ are
       unweighted and population weighted correlations respectively.



net transfers to those workers. In fact, in a handful of the most CNR abundant cities, this
effect is so strong that the planner prefers to balance it with negative transfers to avoid
congestion.
    The optimal transfers are, of course, related to the k n wedges described in Figures 7 and
8, and further depicted in Figures 15 (for CNR workers) and 16 (for non-CNR workers).28
In the median city, after incentives are taken into account, CNR workers contribute $3,087.
This number in part reflects the fact that CNR workers are socially valuable (recall that
the wedge between the social and private value of CNR workers is as much as US$ 58,273).
Note that CNR workers do not need to be particularly incentivized to stay in the large,
CNR abundant, cities. In fact, as Figure 15 shows, transfers decrease slightly with CNR
share and city size. The increases in productivity, and therefore wages, that result from the
enhanced externalities in cognitive hubs is sufficient to attract these workers. CNR workers
are net-recipients of transfers in only 6% of locations but net payers in 94% of locations. On
the whole, payments from CNR workers range on net from US$704 (in the 10th percentile
city) to US$5,299 (in the 90th percentile).29
    Once incentive-based transfers are taken into account, non-CNR workers in the median
  28                                                    k    k               1
    More specifically, total transfers are equal to Pn Cn - wn - k = 1+ k         k
                                                                        n - 1+ wn + R .
                                                                                        k
  29
    Weighing by population net transfers to or from CNR workers range from a net contribution of close
to $690 (10th percentile) to a contribution of more than $10,000 (90th percentile), with the median net
contribution being close to $2,927.


                                                              40
                                                                                                   Non-CNR net transfers
                                                                                                                           20000

                                                                                                                               0

                                                                                                                           -20000

                                                                                                                           -40000

                                                                                                                           -60000
                                                                                                                                     0.2   0.3   0.4    0.5
                                                                                                                                     CNR share in data
                                                                                                                                     = -0.653 , ~ = -0.749




                                                                                                   Non-CNR net transfers
                                                                                                                           20000

                                                                                                                               0

                                                                                                                           -20000

                                                                                                                           -40000

                                                                                                                           -60000
       Non-CNR net transfers    < -14400                   [ -7210 , 0 )        [ 7210 , 14400 )                                      10    12     14     16
       (per capita deviation                                                                                                        Log population in data
       from mean)               [ -14400 , -7210 )         [ 0 , 7210 )         >= 14400                                             = -0.571 , ~ = -0.605
                  Population    12,000         3,909,000            7,805,000


          Figure 16: Optimal transfers to non-CNR workers (per non-CNR worker)
       Optimal transfers per non-CNR workers are defined as the difference in the optimal allocation
       between the value consumed and value added in each city attributed to non-CNR workers
             nCN R     nCN R
       (Pn Cn       - wn      - k ). Figure depicts deviation from employment weighted average
       (US$ 2,632). Each marker in the map refers to a CBSA. Marker sizes are proportional to
       total equilibrium employment in each city.  and  ~ are unweighted and population weighted
       correlations respectively.



city receive a net transfer of $9,657, ranging from $2,538 (in the 10th percentile city) to
as much as $11,786 (in the 90th percentile city). Note that non-CNR workers have to be
incentivized to move to smaller cities. However, because cognitive hubs offer a high wage to
non-CNR workers (since those are the most productive cities while also ending up with fewer
non-CNR workers), non-CNR workers in cognitive hubs pay a transfer as well to discourage
other non-CNR workers from joining them. This accounts for the wide range in non-CNR
transfers and reduces the average net burden on CNR workers.30


6     The Formation of Cognitive Hubs after 1980
The US economy has evolved towards the formation of cognitive hubs at least since the
1980s. Quantifying our model to 1980 data yields a set of fundamental characteristics of
the economy that allows us to study this phenomenon in detail. In order to compare the
spatial structure of the economy in 1980 to that in 2015, we want to abstract from aggre-
gate technology trends. Thus, we first build a `Baseline' economy that adds only aggregate
   30
      If we weight by population, transfers and contributions to non-CNR workers range from a net con-
tribution of about $7,081 to net receipts of $10,609 (90th percentile), with a median net receipt of about
$4,806.




                                                                41
changes in technology, population, and input shares to the 1980 economy.31 The Baseline
economy does not include any location-specific change in productivities across industries and
occupations or in amenities. It also does not include changes in aggregate CNR shares of
population. We study the role of these components by adding them gradually. As shown
in Figure 17, in this Baseline 1980 economy, US population is concentrated in cities where
the CNR share of employment was close to average. In the 2011-15 data, however, there is
greater dispersion around the (now larger) average. Figure 17 further shows the distribution
of CNR workers implied by the 2011-2015 planner's solution calculated above. Together,
the histograms imply that the increasing concentration of CNR workers was in the direction
implied by today's optimal allocation.


                                        70%
                                                                                    Baseline (1980)
                                        60%                                         2011-2015
                                                                                    Optimal (2011-2015)
            Share of total population




                                        50%

                                        40%

                                        30%

                                        20%

                                        10%

                                        0%
                                              -0.2   -0.1     0      0.1      0.2      0.3      0.4
                                                        CNR share (deviation from average)
           Figure 17: Distribution of population by CNR share in city of employment
         Share of population in cities with different ratio of CNR workers to total population. Bins
         refer to deviation from population weighted average.


    Given the move towards cognitive hubs over time, our model allows us to examine the
forces underlying this evolution and obtain a quantitative assessment of their welfare rele-
vance. We do this with a series of counter-factual exercises that clarify the importance of
different forces in driving national trends. Thanks to the structural model, we can also do
the same decomposition in the absence of externalities. Those exercises then provide us with
a measure of the relevance of local spillovers for observed spatial trends. Table 8 shows how
such a decomposition affects the welfare of CNR and non-CNR workers. The columns depict
welfare levels relative to the Baseline 1980 economy for each occupation. The lower panel
repeats the exercises for a world without externalities (i.e., where we set the externality
elasticity parameters to zero).
 31
      For details on the construction of this Baseline economy and other counterfactuals, see Appendix F.

                                                                      42
                              Table 8: Welfare Comparison, Relative to Baseline

                                                                                                 CNR-to-
                                                                                                 non-CNR
                                                                               CNR     non-CNR     Ratio

      Full Model
        1. 1980 parameters                                                     0.417    0.572     0.730
        2. (1) + current input shares                                          0.443    0.515     0.860
        3. (2) + national trends in technology and population                  0.927    1.081     0.857
        4. (3) + national skill biased technical change (Baseline)             1.000    1.000     1.000

              ratio of CNR to non-CNR welfare in Baseline                               1.906

         5.   (4)   +   change   in   occ. shares in employment                1.051    1.062     0.990
         6.   (5)   +   change   in   local technology (ex real estate)        1.072    1.083     0.991
         7.   (6)   +   change   in   real estate productivity                 1.049    1.064     0.986
         8.   (7)   +   change   in   amenities (2011-15 parameters)           1.046    1.065     0.982

         9. Optimal Allocation                                                 1.053    1.072     0.982

         10. 2011-15 parameters minus change in real estate productivity       1.059    1.074     0.987
         11. Optimal Allocation with parameters in (10)                        1.072    1.087     0.987


      Model without externalities
       12. 1980 parameters                                                     0.356    0.468     0.761
       13. (12) + current input shares                                         0.493    0.556     0.887
       14. (13) + national trends in technology and population                 0.936    1.055     0.887
       15. (14) + national skill biased technical change (Baseline)            1.000    1.000     1.000

              ratio of CNR to non-CNR welfare in Baseline                               3.953

         16.   (15)     +   change    in   occ. shares in employment           0.859    1.109     0.775
         17.   (16)     +   change    in   local technology (ex real estate)   0.854    1.116     0.766
         18.   (17)     +   change    in   real estate productivity            0.864    1.130     0.765
         19.   (18)     +   change    in   amenities (2011-15 parameters)      0.864    1.130     0.765

         20. Optimal Allocation                                                0.866    1.133     0.765

         21. 2011-15 parameters minus change in real estate productivity       0.849    1.108     0.766
         22. Optimal Allocation with parameters in (21)                        0.851    1.111     0.766


    The top row of the table shows that welfare in 1980 was lower for both groups and in all
scenarios as one would expect given underlying technological trends. The second row shows
the effects of changing einput shares. It is well documented that CNR intensive industries
have become a larger part of the US economy, leading to relative gains for CNR workers
as compared to non-CNR workers. The next step (rows 3 and 14) brings total population
and average technology in each city/industry to 2011-15 levels while keeping the relative
productivity of CNR and non-CNR workers at 1980 levels. Relative to the baseline (rows
4 and 15), CNR workers are worse off and non-CNR workers better off. The difference is
accounted for skill-biased technical change. Note that externalities amplify the effect of skill

                                                                   43
biased technical change.
    Rows 5 and 15 change the composition of employment to 2011-15 levels, with more CNR
workers and fewer non-CNR workers. Here, externalities play their largest role. Absent
externalities, the model would imply significant losses for CNR workers, as they become
more abundant, whereas standard neo-classical arguments would imply a reduction in their
relative wage. In effect, absent externalities, CNR workers would end up with welfare 14%
below the baseline counterfactual, while non-CNR worker's welfare would grow by 11%. In
contrast, with externalities, both CNR and non-CNR workers end up gaining about the same
as occupations become more polarized across space.
    Rows 6 and 16 add exogenous changes to local technology of non-real estate sectors
over and above what is implied by average national trends. It captures, for example, the fact
that computer and electronics output became particularly more productive in San Jose while
finance became particularly more productive in New York. As shown in Figure 18 those gains
were larger in cities that had high CNR shares in 1980. These location-specific technological
changes interact with externalities to increase the welfare of both types of workers.
    Rows 7 and 17 add changes in the productivity of the real estate sector. This exercise
encompasses the effects of two different underlying processes. On the one hand, real estate
productivity increased more in fast growing cities, as the stock of housing increased in order
to accommodate rising populations. On the other hand, as it has been increasingly recog-
nized (Glaeser and Gyourko (2018), Hsieh and Moretti (2019) and Herkenhoff et al. (2018)),
housing regulations have impeded development in some very productive areas. The table



                                                                                                  Log change in exog. prod.
                                                                                                                              1.0



                                                                                                     exclud. real estate
                                                                                                                              0.5

                                                                                                                              0.0

                                                                                                                              -0.5

                                                                                                                              -1.0
                                                                                                                                        0.2    0.3        0.4
                                                                                                                                      CNR share in 1980
                                                                                                                                       = 0.057 , ~ = 0.39
                                                                                                  Log change in exog. prod.




                                                                                                                              1.0
                                                                                                     exclud. real estate




                                                                                                                              0.5

                                                                                                                              0.0

                                                                                                                              -0.5

                                                                                                                              -1.0
    Log change in exog.               < -0.416               [ -0.208 , 0 )   [ 0.208 , 0.416 )                                          10   12     14         16
    productivity excluding real                                                                                                      Log population in 1980
    estate (deviation from mean)      [ -0.416 , -0.208 )    [ 0 , 0.208 )    >= 0.416                                                = -0.089 , ~ = 0.343
                   Population      4,000         5,080,000       10,156,000


    Figure 18: Change in the exogenous part of technology (all non-real estate sectors)
       Changes are relative to baseline counterfactual, averaged across all sectors except real estate.
       Each observation refers to a CBSA. Marker sizes are proportional to total city employment.
       Averages are taken with value added weights.  and          ~ are unweighted and population
       weighted correlations respectively.




                                                              44
shows that the net effect of those two forces would have been positive in the absence of ex-
ternalities, as housing development may have accommodated increasing population in high
growing locations. At the same time, their effect is negative once externalities are accounted
for since, as shown in Figure 19, housing productivity also lagged behind in CNR intensive
cities.




                                                                                                   Log change in exog. prod.
                                                                                                                               2




                                                                                                         for real estate
                                                                                                                               1

                                                                                                                               0

                                                                                                                               -1

                                                                                                                               -2
                                                                                                                                       0.2    0.3        0.4
                                                                                                                                     CNR share in 1980
                                                                                                                                     = -0.172 , ~ = -0.372




                                                                                                   Log change in exog. prod.
                                                                                                                               2




                                                                                                         for real estate
                                                                                                                               1

                                                                                                                               0

                                                                                                                               -1

                                                                                                                               -2
     Log change in exog.             < -0.998                [ -0.499 , 0 )    [ 0.499 , 0.998 )                                        10   12     14         16
     productivity for real estate                                                                                                   Log population in 1980
     (deviation from mean)           [ -0.998 , -0.499 )     [ 0 , 0.499 )     >= 0.998                                              = -0.233 , ~ = -0.514
                    Population      4,000        5,080,000        10,156,000




        Figure 19: Change in the exogenous component of technology in real estate.
       Changes are relative to baseline counterfactual.  and ~ are unweighted and population
       weighted correlations respectively.



    Finally, Rows 8 and 18 add the changes in amenities. In particular, Row 8 corresponds to
the 2011-15 equilibrium allocation. Changes in the spatial distribution of amenities appear
to add little to total welfare. That said, in considering the results presented in Table 8, it
is important to bear in mind that the particular sequence in which we added the changes
between 1980 and 2011-15 can have an effect on our results. We chose to present a sequence
that is intuitive to us, but the main findings highlighted above are robust to other sequences.
    We calculate optimal allocation under two scenarios. The first scenario, depicted in Rows
9 and 20, corresponds to that depicted in Section 5 above when externalities are included.
The second scenario assesses the role of housing policy in impeding optimal policy. In
particular, we calculate the optimal policy under the assumption that housing productivity
was distributed as in 1980 (the corresponding equilibrium counterfactual welfare is presented
in Rows 10 and 21 and the corresponding optimal allocation in Rows 11 and 22). We find
that the increment in welfare is more than 50% larger in that scenario than when starting
from the actual equilibrium. In other words, the optimal policy is less effective in some of

                                                               45
the cognitive hubs owing to observed changes in housing supply restrictions .


7    Conclusion
Our aim in this paper has been to understand the extent to which workers are misallocated
in space and the policies that might improve observed allocations. The main culprit of
spatial misallocation is the existence of large occupation-specific externalities combined with
potential distortions due to land use regulations. Our quantitative spatial model allowed
us to measure occupation-specific local productivity by industry which, together with a
relatively standard instrumental variable approach, led us to estimate these externalities for
CNR and non-CNR occupations.
    Our estimates suggest that both CNR and non-CNR workers become more productive in
large cities, but CNR productivity improves particularly when CNR workers are surrounded
by other CNR workers. These estimates, together with estimated local amenities by occu-
pation, exogenous productivity differences across industries and locations, and the full set
of input-output linkages and transport costs in the U.S. economy, determine the current
allocation of economic activity. We find that an optimal spatial policy can improve on this
allocation for both occupations by 0.72%. Housing and optimal transfer policies reinforce
each other. Hence, combining them (by reverting the spatial distribution of real estate pro-
ductivity to that of 1980) leads to welfare gains of close to 2.5% for CNR workers and 2%
for non CNR's.
    Since the 80's the U.S. economy has experienced increased skill and occupational polar-
ization across space. Large cities increasingly have more highly educated CNR workers that
earn more. In contrast, many medium and small cities have suffered an exodus of skilled
workers and experienced persistent population declines. These trends, amplified by local ex-
ternalities, were also associated with a rise in income inequality between occupations. This
growing gap between top and medium and small-sized cities has motivated policymakers and
city governments to advocate policies to attract CNR workers to smaller towns in order to
reverse their fortunes. Our analysis shows that, given appropriate transfers, these efforts
would be counterproductive.
    Our analysis underscores that while CNR workers are extremely useful, they are also
scarce. Furthermore, their productivity is tremendously enhanced by living with other CNR
workers. So attracting them to smaller towns with more mixed populations represents a
waste of resources. CNR workers are too valuable for society to be used in this way. A
better policy is to reinforce existing trends and let them concentrate in cognitive hubs while
incentivizing non-CNR workers to move and help smaller cities grow. Of course, some non-
CNR workers will always be needed in those hubs because of imperfect substitutability of
occupations in production. The result is smaller, more CNR intensive, cognitive hubs in
some of today's largest cities. We show that the resulting migration of non-CNR workers
that allows small towns to grow may be implemented with a baseline transfer to non-CNR
workers, reminiscent of a universal basic income, and a set of occupation-location specific
transfers. Overall, CNR workers transfer resources to non-CNR workers to generate equal
welfare gains.
    Our findings suggest that efforts to stop the spatial polarization of occupations are mis-


                                              46
guided. In fact, encouraging it further can yield benefits for everyone when accompanied
by the necessary transfers. Implementing these transfers, however, is critical. Otherwise,
cognitive hubs might use other indirect means of pushing out non-CNR workers such as, for
example, housing supply constraints, zoning restrictions, or a lack of investment in trans-
portation networks to aid commuting. Such efforts can generate occupational polarization
across space without Pareto gains for all workers. Implementing the necessary transfers
would not only help avoid those inefficient policies and benefit CNR workers, but it would
also improve the welfare of non-CNR workers and the many small and medium sized cities
where they would end up living, working, and producing.
    Our analysis abstracts from the role that spatial polarization might have on human
capital formation. In principle, the migration of CNR workers towards cognitive hubs may
be detrimental to smaller cities in a setting where the learning technology also features
meaningful externalities from CNR workers. At the same time, however, the transfers that
CNR workers are able and willing to make to non-CNR workers, given the productivity gains
they experience from living in cognitive hubs, might naturally be invested in education and
other training in the smaller cities. These transfers, if directed properly, have the potential
to ameliorate, or even reverse, the conceivably negative effects of spatial polarization on
human capital.




                                              47
References
Acemoglu, D. and D. Autor (2011). Skills, tasks and technologies: Implications for employ-
  ment and earnings. In Handbook of labor economics, Volume 4, pp. 1043­1171. Elsevier.
  2

Albouy, D. (2009). The unequal geographic burden of federal taxation. Journal of Political
  Economy 117 (4), 635­667. 1

Albouy, D., K. Behrens, F. Robert-Nicoud, and N. Seegert (2019). The optimal distribution
  of population across cities. Journal of Urban Economics 110, 102­113. 1

Altonji, J. G., T. E. Elder, and C. R. Taber (2005). Selection on observed and unob-
  served variables: Assessing the effectiveness of catholic schools. Journal of political econ-
  omy 113 (1), 151­184. B.3

Anderson, J. E., C. A. Milot, and Y. V. Yotov (2014). How much does geography deflect
 services trade? canadian answers. International Economic Review 55 (3), 791­818. 4, B.1,
 9, ??

Angrist, J. D. and J.-S. Pischke (2008). Mostly harmless econometrics: An empiricist's
 companion. Princeton university press. 24

Autor, D. H. (2019). Work of the past, work of the future. In Richard T. Ely Lecture given
 at Annual Meeting of American Economics Association, Atlanta, GA, January, Volume 4.
 1

Bartelme, D., A. Costinot, D. Donaldson, and R.-C. Andres (2019). The textbook case for
  industrial policy: Theory meets data. Technical report, CEPR Discussion Papers. 5.3.1

Baum-Snow, N., M. Freedman, and R. Pavan (2018). Why has urban inequality increased?
  American Economic Journal: Applied Economics 10 (4), 1­42. 1

Baum-Snow, N. and R. Pavan (2011). Understanding the city size wage gap. The Review of
  economic studies 79 (1), 88­127. 8

Baum-Snow, N. and R. Pavan (2013). Inequality and city size. Review of Economics and
  Statistics 95 (5), 1535­1548. 1, 2, 14

Berry, C. R. and E. L. Glaeser (2005). The divergence of human capital levels across cities.
  Papers in regional science 84 (3), 407­444. 1

Brinkman, J. (2014). The supply and demand of skilled workers in cities and the role of
  industry composition. 1

Caliendo, L. and F. Parro (2015). Estimates of the trade and welfare effects of nafta. The
  Review of Economic Studies 82 (1), 1­44. 4, 11




                                              48
Caliendo, L., F. Parro, E. Rossi-Hansberg, and P.-D. Sarte (2017). The impact of regional and
  sectoral productivity changes on the us economy. The Review of economic studies 85 (4),
  2042­2096. 1, 4.1.3, A.2.3, A.6

Card, D. (2001). Immigrant inflows, native outflows, and the local labor market impacts of
  higher immigration. Journal of Labor Economics 19 (1), 22­64. 1, 4, 4.2.1, B.3, B.3

Ciccone, A. and R. E. Hall (1996). Productivity and the density of economic activity. The
  American Economic Review 86 (1), 54. 4.2.1, B.3, B.3

Ciccone, A. and G. Peri (2005). Long-run substitutability between more and less educated
  workers: evidence from us states, 1950­1990. Review of Economics and statistics 87 (4),
  652­663. 4

Colas, M. and K. Hutchinson (2017). Heterogeneous workers and federal income taxes in a
  spatial equilibrium. Technical report. 1

Couture, V., C. Gaubert, J. Handbury, and E. Hurst (2018). Income growth and the distri-
  butional effects of urban spatial sorting. Technical report, Working Paper University of
  Chicago Booth. 3

Desmet, K. and E. Rossi-Hansberg (2013). Urban accounting and welfare. American Eco-
  nomic Review 103 (6), 2296­2327. 1

Diamond, R. (2016). The determinants and welfare implications of us workers' diverging
  location choices by skill: 1980-2000. American Economic Review 106 (3), 479­524. 1, 2,
  1, 4.1.2, 16, 5.3.1, E

Duranton, G. and D. Puga (2004). Micro-foundations of urban agglomeration economies. In
 Handbook of regional and urban economics, Volume 4, pp. 2063­2117. Elsevier. 2

Eaton, J. and S. Kortum (2002). Technology, geography, and trade. Econometrica 70 (5),
  1741­1779. 3.2.2, A.2.3

Eeckhout, J. and N. Guner (2015). Optimal spatial taxation: Are big cities too small? 1

Ellison, G., E. L. Glaeser, and W. R. Kerr (2010). What causes industry agglomeration?
  evidence from coagglomeration patterns. American Economic Review 100 (3), 1195­1213.
  1

Fajgelbaum, P. and C. Gaubert (2018). Optimal spatial policies, geography and sorting.
  Technical report, National Bureau of Economic Research. 1, 1, 16, 5.1, 27, E, 21

Fajgelbaum, P. D., E. Morales, J. C. Su´
                                       arez Serrato, and O. Zidar (2018). State taxes and
  spatial misallocation. The Review of Economic Studies 86 (1), 333­376. 1, 4, 13

Feenstra, R. C., P. Luck, M. Obstfeld, and K. N. Russ (2018). In search of the armington
  elasticity. Review of Economics and Statistics 100 (1), 135­150. 11

Giannone, E. (2017). Skilled-biased technical change and regional convergence. 1

                                             49
Glaeser, E. and J. Gyourko (2018, February). The economic implications of housing supply.
  Journal of Economic Perspectives 32 (1), 3­30. 1, 6

Glaeser, E. L. and J. D. Gottlieb (2008). The economics of place-making policies. Brookings
  Papers on Economic Activity 2008 (1), 155­253. 19

Handbury, J. and D. E. Weinstein (2014). Goods prices and availability in cities. The Review
  of Economic Studies 82 (1), 258­296. 4.1.1

Head, K. and T. Mayer (2014). Gravity equations: Workhorse, toolkit, and cookbook. In
  Handbook of international economics, Volume 4, pp. 131­195. Elsevier. 4

Hendricks, L. (2011).    The skill composition of us cities.   International Economic Re-
  view 52 (1), 1­32. 1

Herkenhoff, K. F., L. E. Ohanian, and E. C. Prescott (2018). Tarnishing the golden and
  empire states: Land-use restrictions and the us economic slowdown. Journal of Monetary
  Economics 93, 89­109. 1, 1, 6

Hsieh, C.-T. and E. Moretti (2019). Housing constraints and spatial misallocation. American
  Economic Journal: Macroeconomics . 1, 1, 6

Jaimovich, N. and H. E. Siu (2018). The trend is the cycle: Job polarization and jobless
  recoveries. The Review of Economics and Statistics . 4

Marshall, A. (1920). Principles of Economics (Revised ed.). London: Macmillan; reprinted
 by Prometheus Books. 1

Melo, P. C., D. J. Graham, and R. B. Noland (2009). A meta-analysis of estimates of urban
 agglomeration economies. Regional science and urban Economics 39 (3), 332­342. 1, 4.1.3,
 4

Moretti, E. (2004a). Estimating the social return to higher education: evidence from longi-
 tudinal and repeated cross-sectional data. Journal of econometrics 121 (1-2), 175­212. 1,
 1, 14, 1, 4.2.1, B.3, B.3

Moretti, E. (2004b). Workers' education, spillovers, and productivity: evidence from plant-
 level production functions. American Economic Review 94 (3), 656­690. 1, 4.1.3, 4

Neal, D. (1997). The effects of catholic secondary schooling on educational achievement.
  Journal of Labor Economics 15 (1, Part 1), 98­123. B.3

Neumark, D. and H. Simpson (2015). Place-based policies. In Handbook of regional and
  urban economics, Volume 5, pp. 1197­1287. Elsevier. 1

Ossa, R. (2015). A quantitative analysis of subsidy competition in the us. Technical report,
  National Bureau of Economic Research. 1

Redding, S. J. and E. Rossi-Hansberg (2017). Quantitative spatial economics. Annual Review
  of Economics 9, 21­58. 1

                                            50
Roca, J. D. L. and D. Puga (2017). Learning by working in big cities. The Review of
  Economic Studies 84 (1), 106­142. 8, 1

Sanderson, E. and F. Windmeijer (2016). A weak instrument f-test in linear iv models with
  multiple endogenous variables. Journal of Econometrics 190 (2), 212­221. 4.2.1

Staiger, D., J. H. Stock, et al. (1997). Instrumental variables regression with weak instru-
  ments. Econometrica 65 (3), 557­586. 4.2.1

Stock, J. H. and M. Yogo (2005). Testing for weak instruments in linear iv regression. Iden-
  tification and Inference for Econometric Models: Essays in Honor of Thomas Rothenberg ,
  80. 4.2.1




                                            51
Appendix
A     Model Details
A.1     Household Decisions
In a given occupation, all households living in the same city choose the same consumption
                         kj         kj
basket. It follows that Cn  (a) = Cn   for all a. Moreover, the demand for good j by workers
in occupation k living in city n is

                                               kj         Pn k
                                              Cn  = j      j Cn                           (15)
                                                          Pn
                       j   j
               J      Pn
where Pn =     j =1    j       is the ideal price index in city n.
                                                  k
   Agents move freely across cities. The value, vn  (a), of locating in a particular city n for
an individual employed in occupation k , with idiosyncratic preference vector a is

                                      k a n Ak  k
                                             n In
                                     vn (a) =     = an A k  k
                                                         n Cn .
                                            Pn
In equilibrium, workers move to the location where they receive the highest utility so that

                                         v k (a) = max vn
                                                        k
                                                          (a) ,
                                                      n
       k
where v (a) now denotes the equilibrium utility of an individual in occupation k with amenity
vector a. We assume that an is drawn from a Fr´   echet distribution. Draws are independent
across cities. We denote by  the joint cdf for the elements of a across workers in a given
occupation, with


                                     (a) = exp -               (an )-      ,
                                                          n
where the shape parameter  reflects the extent of preference heterogeneity across workers.
Higher values of  imply less heterogeneity, with all workers ordering cities in the same way
when   .
    Assuming that workers of different types can freely move between cities, the average
utility of a worker of type k is given by
                                                                               1
                                                                               
                                           -1                           
                                 vk =                          Ak  k
                                                                n Cn               ,      (16)
                                                          n

where (.) is the Gamma function.
    Combining this equation with equation (2) describing labor supply yields an expression
relating the value of each occupational type to consumption and employment in particular
locations:
                                                         1
                                                        -
                                          k      Lk
                                                  n
                                         v =                  Ak  k
                                                               n Cn .
                                                 Lk

                                                   52
A.2     Firms
A.2.1    Intermediate Goods Producers
Cost minimization implies that input demand satisfies:

                                 j
                            rn Hn  (z)    j j
                            j      j    = n n ,                                                                (17)
                           xn (z)qn (z)
                                                          k    1-
                                                        wn
                              k kj
                            wn Ln (z)                   nkj
                                                                            j     j
                            j     j        =                           1-   n 1 - n ,                          (18)
                           xn (z)qn (z)                       k
                                                             wn
                                                    k        k j
                                                             n
                             j   jj
                           Pn  Mn   (z)      jj
                            j     j        = n  ,                                                              (19)
                           xn (z)qn (z)

where xj
       n (z) is the Lagrange multiplier which in this case reflects the unit cost of production.
We can solve for xj n (z) by substituting optimal factor choices into the production function,

                                                                                     j
                                                                                     n
                                                                                j
                                                                            1-n
                                j                                  1-        1-             J            j j
                       xj    j  n                         k
                                                                                    
                j       n   Bn  rn                       wn                         
                                                                                                     j
                                                                                                         n
               xn (z)     =       j                                                                 Pn         (20)
                       zn   zn  Zn              k
                                                         kj
                                                         n                                 j =1


where xj
       n is a city and industry specific unit cost index such that

                                                         j                           j j
                                   j           j         n                          -n               j
                   j             j n -1     j -n                            jj                  j   -n
                  Bn   =    1-   n          n                               n                   n        .
                                                                   j

Given constant returns to scale and competitive intermediate goods markets, a firm produces
positive but finite amounts of a variety only if its price is equal to its unit production cost,

                                                                       xj
                                                                        n
                                          pj        j
                                           n (z) = xn (z) =               .                                    (21)
                                                                       zn

A.2.2    Final Goods
                    j
Let Qjn (z) =   n Qnn (z) denote the total amount of intermediate goods of variety z pur-
chased from different cities by a final goods producer in city n, sector j . Given that interme-
diate goods of a given variety produced in different cities are perfect substitutes, final goods
producers purchase varieties only from cities that offer the lowest unit cost,
                                             j   j
                                 Qjn (z) if nn pn (z) < minn                        =n   j   j
                                                                                         nn pn (z)
                  Qj
                   nn   (z) =                                                                            ,
                                 0       otherwise

where we abstract from the case where j        j                  j   j
                                           nn pn (z) = minn =n nn pn (z) since, given the
distributional assumption on z, this event only occurs on a set of measure zero.


                                                        53
                 j
   Denote by Pn    (z) the unit cost paid by a final good producer in city n and sector j for a
particular variety whose vector of productivity draws is z. Given that final goods firms only
purchase intermediate goods from the lowest cost supplier,

                                                                         j
                                                                         nn xn
                                                                              j
                            j
                           Pn (z) = min j   j
                                        nn pn (z) = min                           .       (22)
                                       n                        n          zn

For non-tradable intermediate goods, firms must buy those goods locally, so that if j is
non-tradable,

                                             xjnj
                                               Pn.(z) =                              (23)
                                              zn
Then, the demand function for intermediate goods of variety z in industry j and city n is
given by
                                                        j       -
                                                       Pn (z)
                                       Qj
                                        n   (z) =                   Qj
                                                                     n,                   (24)
                                                         ~
                                                        Pn j

      ~n
where P j
          the ideal cost index for final goods produced in sector j in city n,
                                                                      1
                                                                     1-
                                 ~nj              j     1-
                                 P     =         Pn   (z)    d (z)           .            (25)

    Since the production function for final goods is constant returns to scale, and the market
for final goods is competitive, a final goods firm produces positive but finite quantities of a
                                                                j
final good if its price is equal to its cost index, that is if Pn  ~j .
                                                                  =P n


A.2.3    Derivation of Prices
We follow Eaton and Kortum (2002) in solving for the distribution of prices. Given this
distribution and zero profits for final goods producers, when sector j is tradable, the price
of final goods in sector j in region n solves

                                       1-
                                  j
                                 Pn          =         j
                                                      Pn (z)1- d (z) dz,

                                                    j
which is the expected value of the random variable Pn (z)1- .
         j        j   xj
   Let Pnn  (z) = nnzn
                       n
                         denote the unit cost of a variety indexed by z produced in city n
and sold in n. Following the steps described in Caliendo et al. (2017), we have that
                                                                     j       
                                     j
                                 Pr Pnn (z)  p = 1 - e-nn p
      j                    -j
where nn = j       j
               nn xn
                                                                              j
                         . The price of variety z in city n and industry j , Pn (z), is the
                 j
minimum across Pnn (z). Its cdf is,
                                                                     j    
                                      j
                                  Pr Pn (z)  p = 1 - e-n p ,


                                                       54
                   j          j   j       -
where j n =    n nn =     n nn xn      (j n does not depend on n because we are integrat-
ing out the city dimension).
                                    j         j
          j (p) denote the cdf of P (z), Pr [P (z)  p]. Then, its associated pdf, denoted
    Let FPn                         n         n
                      j   
            j  -1 -n p .
  j (p), is  p
fPn         n    e       . As in Caliendo et al. (2017), we have that
                                                        1           1
                                      j                            -
                                     Pn =  ( ) 1- j
                                                  n                     ,
where  ( ) is the Gamma function evaluated at  = 1 + 1-
                                                      
                                                        
                                                         . The price of goods in tradable
sector j may then also be expressed as
                                                                             1
                                                    N                       -
                                            1                           -
                               j
                              Pn =  ( )    1-               j   j
                                                            nn xn                .
                                                   n =1

In a given non-tradable sector j ,   j
                                     nn   =  n = n, so that the equation reduces to
                                                             1
                                           j
                                          Pn =  ( ) 1- xj
                                                        n.


A.2.4    Trade Shares
       j
Let Xn     denote total expenditures on final goods j by city n, which must equal of the value
                                   j      j j
of final goods in that sector, Xn    = Pn  Qn . Recall that because of zero profits in the final
goods sector, total expenditures on intermediate goods in a given sector are then also equal
                                                      j j        j                        j
to the cost of inputs used in that sector, so that Pn  Qn = Pn     (z) Qj
                                                                        n (z) d (z). Let Xnn =
    j    j      j
  nn pn (z)Qnn (z)d(z) denote the value spent by city n on intermediate goods of sector j
                                      j
produced in city n . Further, let nn      denote the share of city n's expenditures on sector j
goods purchased from region n . Then,
                                                      j
                                              j      Xnn
                                              nn   =    j .
                                                     Xn
Observe that, since there is a continuum of varieties of intermediate goods, the fraction of
goods that firms in city n purchase from firms in city n is given by

                              j       j            j
                             ~nn  Pr Pnn (z)  min Pnn (z)                            .
                                                            n =n


Following the steps described in Caliendo et al. (2017), we have that

                                               j
                                  j            nn
                                 ~nn      =
                                               j n
                                                                   -
                                                        j   j
                                                        nn xn
                                          =                                 -
                                                   N
                                                   n =1      j   j
                                                             nn xn

                        j      j
   We can verify that ~nn  = nn  , that is, the share of goods that firms in city n purchase
from city n is equal to the share of the value of goods produced in city n in the bundle

                                                     55
purchased by firms in city n (see Eaton and Kortum (2002), Footnote 17). Observe also that
   N     j  j -         j -
                                   

   n =1 nn xn     = (Pn  )  ( ) 1- . Therefore, we may alternatively write the trade share
 j
nn    as
                                                                          1   -
                                         j
                               j        Xnn    j   j
                                               nn xn  ( )
                                                          1-
                               nn     =    j =        j
                                        Xn           Pn
                            j
   In non-tradable sectors, nn = 1.

A.3     Market Clearing and Aggregation at the Industry and City
        Level
Given the labor supply equation (2) and the definition Lkj
                                                        n =                   Lkj
                                                                               n (z)d(z), the labor market
clearing equation (5) may be rewritten as
                                                   
                                          Ak  k
                                           n Cn
                      Lkj
                       n    =L   k
                                                      k
                                                          ,  n = 1, ..., N , k = 1, ..., K.
                  j                   n       Ak  k
                                               n Cn
                       j        j
Given the definition  Hn=      Hn (z)d(z),         the market clearing equation for structures in each
city (6) may be rewritten as

                                               j
                                              Hn = Hn , n = 1, ..., N.
                                          j
                                                   j     j j
Given our definition of total final expenditures, Xn = Pn Qn , and the demand function for
consumption goods of sector j (15), the market clearing condition for final goods in each
city n and sector j (7) may be expressed in terms of sectoral and city aggregates,

                                     Lk j      k    j
                                      n  P n C n + Pn
                                                                    jj
                                                                   Mn     j
                                                                       = Xn .
                               k                               j
                    j    j     j             j    j
Finally, given that n n Xn = Xn n =   pj
                                       n (z)n n Qn n (z)d(z), the market clearing condition
for intermediate inputs (8) may be rewritten in terms of sectoral city aggregates as

                                                                                  j    j
                                     pj     j
                                      n (z)qn (z)d(z)                     =       n n Xn ,
                                                                              n
                   Total value of intermediate goods produced in city n
            j     j
where n n     n Xn is the total value of expenditures across all cities spent on intermediate
goods produced in city n.
   We can use this last aggregation relationship to obtain aggregate factor input demand
equations as follows,




                                                      56
                                                              k        1-
                                                            wn
                                                             kj
                     k kj    j     j                        n                        j    j
                    wn L n = n 1 - n                                        1-       n n Xn ,
                                                         K        wnk
                                                         k =1      k j
                                                                                 n
                                                                  n
                           j   j j                  j    j
                       rn Hn = n n                  n n Xn ,
                                               n
                   j    jj           jj            j    j
                  Pn   Mn       =    n             n n Xn .
                                           n

Finally, combining these factor demand equations yields the aggregate production function,
                                                                                     j
                                                                                     n
                                                                    j
                                                            -1
                                                                 (1-n )                               j j
                                                     1                          j                     n
              j    j                           kj 1-                          j n 
              n n Xn   =   xj
                            n
                                          kj
                                          n nL                               Hn                jj
                                                                                              Mn            .
          n                          k                                                   j


A.4     Definition of Equilibrium
                                                                                   j
Equilibrium for this system of cities is given by a set of final goods prices Pn     , wages in
                          k
different occupations, wn , rental rates, rn , intermediate goods prices paid by final goods
             j
producers, Pn  (z), intermediate goods prices received by intermediate goods producers, pjn (z),
                         kj                                j
consumption choices, Cn , intermediate input choices, Qn (z), intermediate input production,
 j                                jj
qn (z), demand for materials, Mn     (z), labor demand, Lkj
                                                          n (z), demand for structures, Hn (z),
                          k
and location decisions, n (a), such that:
    i) Workers choose consumption of each final good optimally, as implied by equation (15)
                                                                                              j   j
                                       j kj             k        k                    k      Pn
and the budget constraint,              =
                                    j Pn C n      =P n Cn       In ,
                                                        where Pn = j             and In is given
                                                                                              j

by equation (1).
    ii) Workers choose optimally where to live as implied by equation (2).
    iii) Intermediate input producers choose their demand for materials, labor and structures
optimally (as implied by factor demand equations (17), (18) and (19)), and produce positive
but finite amounts only if (21) holds, where xj  n in that equation is given by (20).
    iv) Final goods producers choose the origin of intermediate inputs optimally, implying
that a producer in city n and industry j imports a variety z from city n if and only if
j      j
 nn pn (z) = minn     j     j
                        nn pn (z) . The price that they pay for intermediate goods satisfies
(22) if the good is tradable and (23) if it is non-tradable.
    v) Final goods producers choose their intermediate input use optimally according to (24)
and produce positive but finite amounts only if (25) holds.
    vi) Market clearing conditions for employment (equation 5), land and structures (equation
6), final goods (equation 7), and intermediate goods (equation 8) hold.

A.5     Aggregate Equilibrium
                                                                             j
At the aggregate level, equilibrium is given by values for the prices Pn , Pn  , xj          k
                                                                                  n , rn , w n ,
                        k                                                                  j
aggregate quantities Cn   , Lkj   j    jj
                             n , Hn , Mn
                                                           j
                                          , expenditures, Xn , and expenditure shares, nn      ,
that satisfy the following equations

                                                       57
                                 Lkj
                                  n
                                             k
                                      j P n Cn +                              j
                                                                             Pn  jj
                                                                                Mn     j
                                                                                    = Xn (N J eqs.)                                (26)
                           k,j                                       j
                                                                                      
                                                                     Ak  k
                                                                      n Cn
                             Lk
                              n =              Lkj
                                                n =                                       L
                                                                                           k
                                                                                                (N K eqs.)                         (27)
                                           j                    n        Ak
                                                                          n
                                                                                   k
                                                                                  Cn

                                                          j
                                                         Hn = Hn (N eqs.)                                                          (28)
                                                    j

                                                                      j           j
                                                                     Pn
                                               Pn =                                      (N eqs.)                                  (29)
                                                            j
                                                                     j

                                          k    k                         n   rn Hn
                                     Pn C n = wn +                                          (N K eqs.)                             (30)
                                                                     k ,n ,j      Lk
                                                                                   n
                                                                                     j


                                             k      1-
                                          wn
                  k kj                   kj
                                         n Ln )
                                            (                   j     j                         j    j
                 wn Ln =                                 1-     n 1 - n                         n n Xn (N KJ eqs.)                 (31)
                                                k
                                               wn
                                     k                                                      n
                                          k j
                                          n (Ln )

                                             j   j j                     j    j
                                         rn Hn = n n                     n n Xn (N J eqs.)                                         (32)
                                                                 n

                                      j  jj   jj                             j    j
                                     Pn Mn  = n                              n n Xn          N J 2 eqs.                            (33)
                                                                 n
                                                                    1
                    
                                 1                              - - 
                        ( ) 1-                  j   j
                                                nn xn                                    if j is tradable
                    
             j                             n
            Pn =              1
                                                                                                                (N J eqs.)         (34)
                     ( )     1-      xj
                                      n                                               if j is non-tradable

                  j    j
                  n n Xn
             n
                                                                                                j
                                                                                                n
                                                                        j
                                                                -1
                                                                     (1-n )                                     j j
                                          1                                              j                      n
                                    kj 1-                                              j n 
        =   xj
             n
                            kj
                            n (Ln )Ln                                                 Hn                   jj
                                                                                                          Mn          (N J eqs.)   (35)
                       k                                                                            j

                                                                              -
                                         j                  j   j
                                                            nn xn
                                         nn    =                                      -
                                                                                           (N 2 J eqs.)                            (36)
                                                        n       j
                                                                nn           xj
                                                                              n

    This system of equations comprises 2N + 2N K + 4N J + N KJ + N J 2 + N 2 J equations
in the same number of unknowns.

    By substituting equation (33) into equation (26), adding over all industries (j ) and all
cities (n) and rearranging, we arrive at the National Accounting identity stating that aggre-
gate value added is equal to aggregate consumption expenditures in the economy,


                                                                         58
                                                       Lkj     k
                                                        n Pn C n =
                                                                                 j
                                                                                 n  j
                                                                                   Xn                                         (37)
                                               n,k,j                       n,j

At the same time, multiplying both sides of equation (30) by Lk  n , adding over city (n) and
                                        k
occupation (k ), and substituting out wn and rn Hn using equations (28), (31) and (32), yields
the same national accounting identity. The fact that we can arrive at that same identity
by manipulating different sets of equations implies that there is one redundant equation in
the system, leading to one too many unknowns relative to the number of equations. The
presence of a redundant equation is a feature of Walrasian systems. In order to pin down
the price level, therefore, we need to amend the system with an additional equation defining
the numeraire. Specifically, we set :

                                                                        ¯ ),
                                                         n ln(Pn ) = ln(P                                                     (38)
                                                   n,j

where n are a set of weights. When computing counterfactuals, we set those weights to be
                                                           k k
proportional to local nominal consumption: n  Pn k Cn       Ln . Finally, observe that if we
substitute the factor demand equations (31), (32), (33) into (35), we obtain the expression
for the unit cost index,
                                                                                    j
                                                                                    n
                                                                               j
                                                                           1-n
                                                   K         k    1-        1-           J            j j
                                           j                wn                                        n
                       xj
                        n   =    j
                                Bn       n
                                        rn                                                        j
                                                                                                 Pn         .                 (39)
                                     
                                                   k=1
                                                            kj
                                                            n                           j =1



A.6     TFP accounting
In the text, we define TFP in equation (9) as


        j              j    j              j   j j     j   j      j
ln T F Pn = ln         n n Xn        - ln Pn - n n ln Hn - n (1 - n )                             kj ln Lkj
                                                                                                         n -
                                                                                                                      jj
                                                                                                                      n        jj
                                                                                                                         d ln Mn  ,
                   n                                                                         k                    j

   where
                                                                        k kj
                                                       kj         n    wn Ln
                                                            =           k kj
                                                                 n,k   wn Ln
is the national share of occupation k in the wage bill across all occupations.
    From equation (35,)
                                                                                                  j
                                                                                   j              n
                                                                 -1
                                                                                 1-n         j
                                                                                                                      j j
                                                                                                                      n
                 j    j                                                -1                    n
                 n n Xn     =   xj
                                 n                  kj kj
                                                    n Ln
                                                                                        j
                                                                                       Hn                        jj
                                                                                                                Mn
           n                                                                                          j
                                               j                       1
                                  xn    1    j                        -
   Also, recall that we can write P j =
                                        j
                                           (nn ) , which picks up the role of selection effects
                                    n   nn
on productivity (see Caliendo et al. (2017)). We take a first order log-linear approximation
        j    j
of n n    n Xn around national averages to obtain


                                                                 59
                                                                                                                             -1

              j    j                   j    1     j    j      j                                                kj Lkj
d ln          n n Xn             d ln Pn   - d ln nn + n (1 - n )                                                                 -1   d ln Lkj       kj
                                                                                                                                             n + d ln n
        n
                                                                                                  k                (kj Lkj )
                                                                                                           k
                              j j       j                      jj       jj
                            + n n d ln Hn +                    n  d ln Mn  ,
                                                          j

                       -1                                                                             -1
         (kj Lkj )                                                                (kj   kj
                                                                                    n Ln )
where              -1 is the national average of                                                          -1   . From manipulating equation
                                                                                      kj kj
         k ( L )                                                                  k (n Ln )
             kj kj

(31), we can verify that:
                                                                    -1
                                                     kj kj
                                                     n Ln
                                                                                               k kj
                                                                                              wn Ln
                                                                         -1       =
                                                                                                   k Lk j
                                                                                                  wn
                                                 k       kj kj
                                                         n Ln
                                                                                              k       n


   If we log-linearize around a national weighted average across cities, where we weight
individual cities by their wage bill, we have that
                            -1
               kj Lkj                                 k kj
                                                     wn Ln                                 k kj
                                                                                          wn Ln                               k kj
                                                                                                                             wn Ln
                                 -1   =                                 ×             k
                                                                                                           =            n
                                                                                                                                         =  kj ,
                                                          k Lk j
                                                         wn                                    k kj
                                                                                              wn Ln                           k kj
                                                                                                                             wn Ln
               k   (kj Lkj )               n         k       n                    n ,k                                n ,k

   so that


                       j    j                   j  1     j    j      j
       d ln            n n Xn             d ln Pn - d ln nn + n (1 - n )                                             kj d ln Lkj       kj
                                                                                                                              n + d ln n
                   n
                                                                                                               k
                                          j j       j                       jj       jj
                                      +   n n d ln Hn          +            n  d ln Mn
                                                                    j

   Comparing to the expression for TFP, it follows that, up to a first order approximation,


                                      j           1     j    j      j
                            d ln T F Pn          - d ln nn + n (1 - n )                                     kj d ln kj
                                                                                                                    n
                                                                                                      k

which, abstracting from selection effects, reduces to

                                                 j   j      j
                                       d ln T F Pn = n (1 - n )                                kj d ln kj
                                                                                                       n
                                                                                          k


             kj             n         (1- j )n
                                             j                j j
                                                              n n
  Defining Tn    kj  n
                                                  kj
                                                 Hn                 it follows that for tradable sectors (in which case
j          j
n = 0 and n   =  j for all n),

                                                           j
                                                 d ln T F Pn =                     kj d ln Tn
                                                                                            kj

                                                                              k


                                                                         60
       or

                                 j
                         ln T F Pn =         kj ln Tn
                                                    kj
                                                       + constant independent of n
                                        k
                                          j
       For the purposes of comparing T F Pn across space, we can omit that constant.


B           Quantifying the Model and Model Inversion
We now provide additional detail on how we quantify the model. The set of parameters
needed to quantify our framework fall into broadly two types: i) parameters that are con-
stant across cities (but may vary across occupations and/or industries) and that are directly
available from statistical agencies, or that may be chosen to match national or citywide
averages, and ii) parameters that vary at a more granular level and require using all of the
model's equations (i.e. by way of model inversion) to match data that vary across cities,
industries, and occupations.

B.1         Details on Parameters That Are Constant Across Cities
                                          j    jj
Input use shares in gross output (n         , n   ) : To obtain an initial calibration for these
share parameters, we use an average of the 2011 to 2015 BEA Use Tables, each adjusted by
the same year's total gross output. The Use Table divides the value of the output in each
                 j    j         j
sector j , n ,n n  n Xn =    n Xn , into the value of input purchases from other sectors j ,
        j  jj                                 k kj                               j
   n,j Pn Mn , labor compensation,     n,k wn Ln , operational surplus,   n rn Hn , and taxes on
production and imports, - n sj       j
                                n Xn ,

                           j            j  jj             k kj             j
                          Xn =         Pn Mn  +          wn Ln +       rn Hn -       sj  j
                                                                                      n Xn .      (40)
                     n           n,j               n,k             n             n

Input purchases from other sectors are separated into purchases from domestic producers and
purchases from international producers. Since the model does not allow for foreign trade, we
adjust the Use Table by deducting purchases from international producers from the input
purchases and, for accounting consistency, from the definition of gross output for the sector.
    As in Caliendo et al. (2018), for all sectors, we augment material purchases to include
the purchases of equipment. Specifically, we subtract from the operational surplus of each
sector 17 percent of their value added and then add the same value back to materials.32 This
17 percent value is estimated by Greenwood et al. (1997) as the equipment share in output.
We then pro-rate the equipment share of value added to different materials in proportion to
their use within each sector.
    We interpret the remaining part of the gross operational surplus in a given sector as
compensation for services provided by real estate. We adopt the convention that all land
and structures are managed by firms in the real estate sector, which then sell their services
to other sectors. Accordingly, for all sectors other than real estate, we reassign the gross
  32
    When gross operation surplus amounts to less than 17 percent of value added, the entire operational
surplus is deducted.


                                                         61
operating surplus remaining, after deducting equipment investment, to purchases from the
real estate sector. These surpluses are in turn added to the gross operating surplus of real
estate.
    It follows that, for all sectors j other than real estate,
                                                              j
                                                          rn Hn = 0.
                                                  n

   and in each of those sectors,

                    real estate  real estate,j
                   Pn           Mn             = Purchases from real estate by j
                                                 +Operational Surplus of j
                                                 -Equipment Investment by j.

   In contrast, in the real estate sector,

                       real estate
                   rn Hn           = Total Operational Surplus across all j
               n
                                            -Total Equipment Investment across all j .

    One can verify that those reassignments do not affect aggregate operational surplus (net
of equipment investment), aggregate labor compensation, and aggregate value added (net of
equipment investment).
                                             j
    We assume that tradable sectors have a n   =  j , constant across cities and similarly for
 jj
n 's. The two non-tradable sectors have city specific parameters. Given these adjustments
to the Use Table, the share parameters for tradable sectors follow immediately,
                                    k kj                  j                       j   jj
                      j      n,k   wn Ln +          n rn Hn                     Pn  Mn
                      =                                     ,    j j =          n
                                                                                         j.             (41)
                                    n (1    +   sj
                                                 n )Xn
                                                      j                             j
                                                                            n (1 + sn )Xn
   Furthermore, we have that, for the non-tradable sectors,
                                                            k kj      j
                                       j              k   wn Ln + rn Hn
                                       n     =                          ,                               (42)
                                                          (1 + sj   j
                                                                n )Xn

where sj n is an ad-valorem subsidy for city n, sector j , which we introduce to account for
the fact that part of the sectoral value added calculated by the BEA is in fact paid out in
indirect taxes. Finally, since we do not observe use of materials by individual sectors in each
city, we assume that, the proportions of materials used in each city by nontradable sectors if
                                     j j                                                             j  j j
                                    n                                                               Pn Mn
fixed at the national averages     1-n  j   is the same for all cities and satisfies equals    n
                                                                                                     j  j j
                                                                                              n,j   Pn Mn
                                      jj                                j  jj
                                     n                                 Pn Mn
                                         j = ^j j =               n
                                                                        j  jj
                                   1 - n                         n,j   Pn Mn
                       j                    jj
   The calibration of n  and, therefore of n   , will require choosing additional parameters
as described below but consistent with the above equations.

                                                           62
Trade costs We assign trade costs to be a log-linear function of distance, that is,
                                                     t j
                                         j
                                         nn = (dnn )

where n,n is the amount of goods that need to be shipped from location n in order for one
unit of the good to be available in location n, and dn,n is the distance (in miles) between
the two locations.
   From equation (36) we can write
                                  j
                              log(nn ) = -tj log(dnn ) + cn + cn                              (43)

where cn and cn are n and n location-specific factors

                                        cn = - log(xj
                                                    n)

   and

                                                            -
                                cn = - log          j   j
                                                    nn xn
                                               n

    We assign trade costs to industries using three different methods. First, we assign two
industries (retail, construction and utilities, and real estate) to be non-tradable. Second,
we use the estimates in Table 1 of Anderson et al. (2014) to obtain gravity coefficients for
services. Third, we rely on equation (43) to obtain the gravity coefficients. In order to do this,
we use the 2012 Commodity Flow Survey Public Use Microdata File. We add up shipment
values by industry, origin and destination and then, for each industry, we regress the log of
those averages on log of average shipment distance between each origin and destination.
    The gravity coefficients used are summarized in Table 9, below.

B.2      Model Inversion for the Granular Parameters
                                            k                Lkj
From the ACS, we obtain data pertaining to wn , and            n
                                                                 k j.   The spatial distribution of
                                                             k Ln
CNR shares (Lk   n /Ln ) is depicted in Figure 20 below. The Census County Business Patterns
(CBP) provide us measures of total employment k Lk         j
                                                          n that better match BEA industry-
level counts, which we combine with the ACS data to obtain Lkj   n . From the BEA, we obtain
regional price parity (RPP) indices for each city, disaggregated into goods, services and rents.
As explained below, we use the level of rents and the relative price of goods and services,
providing us with 2(N - 1) additional restrictions (we deduct 2 since prices in any given city
are only defined relative to those in other cities). Furthermore, we can use the BEA Use
Tables to calculate the national share of income from land and structures in the production
of real estate, providing us with one additional equation. Lastly, as we explain in more detail
below, we can apply J normalizations to each sector.
    The data plus normalizations above impose N K + N KJ + 2N + J - 1 independent re-
strictions that allows us to solve for N K values for amenity parameters, Ak   n , N KJ scaling




                                               63
                             Table 9: Estimated Gravity coefficients (-tj )

  Industry                                                  Gravity Coefficient   Source
  Retail, Construction and Utilities                                -             Non-tradable
  Food and Beverage                                                -1.24          own estimate
  Textiles                                                         -0.88          own estimate
  Wood, Paper, and Printing                                        -1.36          own estimate
  Oil, Chemicals, and Nonmetalic Minerals                          -1.32
  Metals                                                           -1.20          own estimate
  Machinery                                                        -0.81          own estimate
  Computer and Electric                                            -0.77          own estimate
  Electrical Equipment                                             -0.64          own estimate
  Motor Vehicles (Air, Cars, and Rail)                             -0.90          own estimate
  Furniture and Fixtures                                           -1.18          own estimate
  Miscellaneous Manufacturing                                      -0.83          own estimate
  Wholesale Trade                                                 -0.563          Anderson et al.        (2014)
  Transportation and Storage                                      - 0.617         Anderson et al.        (2014)
  Professional and Business Services                              -0.928          Anderson et al.        (2014)
  Other                                                           -0.724          Anderson et al.        (2014)
  Communication                                                   -0.297          Anderson et al.        (2014)
  Finance and Insurance                                           - 0.678         Anderson et al.        (2014)
  Real Estate                                                       -             Non-tradable
  Education                                                        -1.01          Anderson et al.        (2014)
  Health                                                           -1.42          Anderson et al.        (2014)
  Accomodation                                                    -0.927          Anderson et al.        (2014)
       See text for own estimation details. Coefficients from Anderson et al. (2014) are extracted from Table 1


                        kj      j n n      j j
                                            n   n         j (1- j )
factors in production, Tn   (Hn  )     kjn         , (N - 1) shares of non-residential struc-
                                                real estate
tures in value added in the real estate sector, n           , (N - 1) shares of value added in
non-tradable output, and J - 1 independent values for consumption share parameters, j .33
    The steps below describe the model inversion.
   1. Computing consumption shares, j . We first add up equation (26) across n and
                                                                               j  j
      j . We then use the factor demand equations (31) and (32) to obtain n      Xn  =
                j        k kj
          n rn Hn + n,k wn Ln , and the national accounting identity (37) to substitute
              j         k
         out Xn 's and Cn 's from the aggregated equation (26):

         j                  j
                        rn Hn +          k kj
                                        wn Ln    +        j
                                                         Pn  jj
                                                            Mn  =              j
                                                                           rn Hn +          k kj
                                                                                           wn Ln +         j
                                                                                                          Pn  jj
                                                                                                             Mn    .
              j     n             n,k                j                 n             n,k             j

                                        j         j  jj
The ACS does not provide data on rn Hn    ,   j P n Mn  or their sum across cities. While
the BEA provides data on sectoral aggregates, those cover the whole country as opposed to
  33
   Furthermore, additional restrictions imposed on j and  j , specifically that j  [0, 1], and  j  [0, 1],
imply some overidentifying restrictions.

                                                          64
              CNR share of employment                < -0.115                    [ -0.0573 , 0 )          [ 0.0573 , 0.115 )
              in data (deviation from mean)          [ -0.115 , -0.0573 )        [ 0 , 0.0573 )           >= 0.115

                                   Population       12,000        3,909,000           7,805,000


                                   Figure 20: CNR share from 2011-2015
      Each marker in the map refers to a CBSA. Marker sizes are proportional to total equilibrium
      employment in each city.



                                                                            j                             j  jj
                                                                     n rn Hn                       n,j   Pn Mn
only MSA's. Thus, we rely instead on ratios,                             k   kj     and                    k Lkj
                                                                                                                      obtained from the
                                                                    n,k wn Ln                       n,k   wn  n
                                                                                             k kj
Use Tables, which we can then combine with data on                                    n,k   wn Ln and the above equation.
Specifically,
                                                         j                                            j  jj
                                                  n rn Hn                                     n,j    Pn Mn
                  j             k kj
                               wn Ln                             +1         +                                         k kj
                                                                                                                     wn Ln
                                                      k kj                                              k kj
                      n,j ,k                     n,k wn Ln                      j ,n,k             n,k wn Ln

                                                    j                    j       jj
                          k kj                n rn Hn               n,j Pn      Mn
              =          wn Ln                               +                              +1 ,
                                                  k kj                       k Lk j
                   n,k                     n,k wn Ln                  n,k   wn  n

or

                                                             j                                            jj
                                    j             k kj
                                                 wn Ln       H    +1 +                    k kj
                                                                                         wn Ln            M
                                        n,j ,k                                  j ,n,k
                                            k kj       j         jj
                               =           wn Ln       H     +   M    +1 ,
                                     n,k


where j          jj
        H and M denote, respectively, the ratio of national aggregate rental income and
the ratio of national aggregate material inputs usage from sector j to national aggregate

                                                             65
wage income in sector j which are consistent with the Use Tables. The J equations above
can be solved for J values of j . One can verify that any value of j obtained from those
                              j                                                             j
equations will satisfy    j  = 1. One complicating factor is that in each sector j , 
must live in [0, 1]. However, because of measurement inconsistencies between ACS and BEA
data, the procedure generates negative values of j in three out of 22 sectors. One of those
sectors ("Oil, Chemicals, and Nonmetallic Minerals") indeed has much of its employment
located outside of urban areas. We use information from the Use Tables to calibrate j in
that sector, setting it equal to 5.57 percent. The other two sectors ("Wood, Paper, and
Printing", and "Metals") are to a large degree producers of inputs for other industries, so
that we set their consumption shares to 0. To ensure that all equations hold while satisfying
                                jj
those restrictions, we allow M     's to deviate somewhat from those obtained from the Use
Tables. This requires adjusting  j and  j j for the tradable sectors, since those satisfy
                j                             j j
           1+
j =        j
                H
                  j   j j   , j j =        j
                                              M
                                                  j   j j   .
      1+   H+         M               1+   H +        M


  2. Expressing gross output and rental income from each sector and city as functions of
     share parameters and wage bills. Using the labor demand equations (31), we obtain

                                                                                   k kj
                                                                j    j           kwn Ln
                                                                n n Xn =           j    j.                    (44)
                                                       n
                                                                               1 - n n
                                   j          j
      In the non-tradable sectors, nn = 1 and n n = 0 for n = n so that

                                                                             k kj
                                                                 j         kwn  Ln
                                                                Xn =          j    j.
                                                                         1 -  n n
                                                             j
      For all sectors other than real estate, we have that n   = 0, so that rn H j
                                                                                 n = 0. For the
      real estate sector, we have from the first-order conditions in that sector that

                                                                    real estate
                                          real estate              n                      k k,real estate
                                      rn Hn           =                real estate
                                                                                         wn Ln            .
                                                                 1 - n               k

      Since real estate services are the only sector with positive rental income, this is also
      equal to the total rental income in each city.

  3. Computing the shares of land and structures in value added for the real estate sector,
      real estate                                               k
     n            . We use equations (30) to substitute out Pn Cn  in equations (26). We then
     apply the relationships from equation (44) to substitute out gross output in (31) to
     (33), and use the resulting equations to substitute out factor demands in (26). Given
     that in the non-tradable sectors ("real estate" and "retail, construction, and utilities"),
     expenditures are equal to gross output, this implies that, for j  {"real estate","retail,
     construction, and utilities"}, we have that




                                                                      66
                                      k kj
                      1         k   wn Ln
                        j            j
                   1 - n            n
                   = j           k k
                                wn Ln
                            k

                                Lk
                                 n k                   nreal estate
                                                                                   k k ,real estate
                   + j             b                                              wn Ln
                            k
                                Lk        n
                                                     1 - n real estate
                                                                              k
                                    j
                                1 - n
                   +        j            j
                                                  ^ jj
                                                                   k kj
                                                                  wn Ln ,
                        j
                            n   (1 -     n    )              k

                                         j
   where we are using the fact that n      = 0 for all sectors other than real estate. Given
   that we have two non-tradable sectors, this is a system of 2N equations, in N values
        j                  real estate
   for n  and N values of n            .
                                                            j
4. Computing individual values for nominal expenditures, Xn   , in tradable sectors. We use
                                         k
   equations (30) to substitute out Pn Cn in equations (26). We then apply the relation-
   ships from equation (44) to substitute out gross output in (31) to (33), and use the
   resulting equations to substitute out factor demands in (26). In the tradable sectors,
   this gives us


                        j
                       Xn = j              k k
                                          wn Ln
                                     k

                                          Lk
                                           n k                      nreal estate
                                                                                           k kj
                            + j              b                                            wn Ln
                                     k
                                          Lk             n
                                                                  1 - n real estate
                                                                                      k
                                                     k kj
                                     jj           k wn Ln
                            +        n
                                                     j    j
                                j             1   - n    n
                    j                                     j
   Given values for n from the previous step, values for Xn are then immediately deter-
   mined from the data.
5. Computing relative cost indices for tradable goods, x  ~j
                                                           n . For N (J - 2) tradable sectors
   (all but "real estate," as well as "retail, construction, and utilities"), we now solve for
                                                  j
   (N - 1)(J - 2) values of the cost index, xnxj , for each j  {1, ..., J } from the system
                                                                  n    n
   of (N - 1)(J - 2) independent equations,

                                          k kj                     N
                                         wn
                                          k Ln     j    j j
                                          j    j = n n x Xn ,
                                      1 - n n n =1
   where xj = {xj           j
                  1 , ..., xN } is the vector of unit production costs. This system comprises
   only (N - 1)(J - 2) independent equations since, for each j , adding up the right-hand-
   side and left-hand-side over n gives the same result on both sides irrespective of xj . At

                                                             67
                       j      j                                 j
       the same time n   n (x ) is homogeneous of degree 0 in x for each j in equation (36),
                                                       j
                                                      xn
                                                 ~j
       so that we can still solve for the ratio, x n    xj
                                                           . 34
                                                                      n   n


                                                  j
 6. Computing relative tradable consumer prices, Pn , in every sector and city. Substituting
      j
    ~n from the previous step into equation(34) and rearranging, we have that for the
    x
    tradable sectors,

                                                                                    1
                                                                                   -
                                                 1                        -
                                 j
                                Pn =  ( )       1-           j  ~j
                                                             nn x n                     ×            xj
                                                                                                      n,
                                                      n                                      n

       which gives a system of N (J - 2) equations. We can thus determine
                                                                                                            1
                                                                                                                -1
                                                  j                                                        -
                                               n xn                                                  -
                                       1
                        j
                        P   ( )
                                1-                    =              j
                                                                     n              j  ~j
                                                                                    nn x n
                                                                                                                
                                               Pj                             n

                                               j j
       for each j by imposing              n   n Pn= P j , where n j
                                                                     are model-consistent expenditure
                          j              j
       weights given by Xn  /         n Xn      obtained in step 4. We may then then obtain for all
       tradable j s
                                                                                             1
                                                                                            -
                                           j
                                     ~ j  Pn = j
                                     P                               j  ~j
                                                                                    -
                                       n       P                     nn x n                      .
                                          Pj                   n

       Note that data on P j is only available in changes from a base period. Thus, we define
       the base period to be 2011-2015, our benchmark period, and set P j = 1 in all sectors
                                                                     ~n
       in that period. For the remainder of the analysis, therefore, P j    j
                                                                         = Pn .

 7. Computing non-tradable consumer prices. In the non-tradable sectors, we have that
                 1
      j
    Pn  =  ( ) 1- xj n for all n and j , and for those sectors, we determine prices based on
    data from the Regional Price Parity (RPP) indices calculated by the BEA. We directly
                              1
    obtain values for  ( ) 1- xreal
                                  n
                                      estate
                                               Pn  real estate
                                                               from the RPP estimates of the price of
    real estate services in different cities. For the other non-tradables ("retail, construction,
                                                            1
                                    retail, etc.
    and utilities"), we choose Pn                =  ( ) 1- xretail,
                                                                 n
                                                                     etc.
                                                                          so that the price of services
    (other than real estate) relative to tradable goods in the model matches its counterpart
    in the RPP. To carry out this calculation, observe that the price index for services
                                                                                            j
                                                                               j    j   j Services j
                          Services                             j   Services        Pn
       can be defined by Pn        = j Services                       j
                                                                                                                where the service
       sectors include retail, etc., wholesale trade, transportation and storage, professional
       and business services, other, communication, finance and insurance, education, health,
       and accommodation. The price index for goods can be defined analogously where the
       goods sector includes all remaining sectors other than real estate.
                                                               j
34                                                    (xj
                                                        n)
     Numerically, the system is easier to solve for       j   j
                                                                from which we can easily obtain values for xj
                                                                                                            n 's.
                                                      n (xn )




                                                          68
8. Computing firm productivity in different sectors, j , and cities, n,                                                   associated with
   occupation k , kj
                  n . From equations (31), we have that


                                                                 k     1-
                                                               wn
                                                                kj
                                       k kj                    n                             k kj
                                      wn Ln =                               1-              wn Ln ,
                                                                    wnk
                                                           k         k j
                                                                                      k
                                                                    n

  which can rewrite as

                                                                                1-
                                                               k
                                                               n
                                                                 j
                                                                       k
                                                           k
                                                           kj
                                                                      wn
                                                           n
                               k kj                                                                  k kj
                              wn Ln     =                                            1-             wn Ln .
                                                                   k j
                                                               k n          k                  k
                                                   k            k j        wn
                                                               n

  Thus, for each city n and industry j , we can use K - 1 of those equations to solve for
  K - 1 ratios, ~ kj = kjn
                           k j . With some rearrangement, those can be written as
                  n               n
                              k

                                                                                          1
                                                            k
                                       ~ kj                wn         -1
                                                                                Lkj
                                                                                 n
                                                                                          -1

                                         n     =                                               1    .
                                                                                  kj           -1
                                                           k
                                                       k (wn          )          Ln
                                                                           -1




  From equations (45) (obtained by substituting the factor demand equations (31), (32)
  and (33) into equations (35)), and the value for rn Hn obtained in step 2, we obtain
                              j    j
                              n (1-n )
         j j                                           1
       Hnn n
                     k
                     n
                       j
                                          ( )- 1-                                                                                          (45)
                k
                                                                                                                 j
                                                                                                                 n
                                                                                                            j
                                                                j                                       1-n
                                                                n          K                   1-        1-           J          j j
           j                     j                                                      k
                                                                                                                
         Bn                     n               k kj                                 wn                         
                                                                                                                             j
                                                                                                                                 n
       = j j                       j           wn Ln                                                                        Pn         ,
        x
        ~n P                  1 - n                                                  ~ kj
                                                                                       n                        
                          j              k                                 k=1                                       j =1


                              1
  where we set  ( )- 1- = 1 since it is common to all sectors and cities and thus
  immaterial in any counterfactual exercise. Recall that the use of land and structures
  as inputs has been folded in the real estate sector that then sells real estate services
                             j
  to all other sectors (i.e. n = 0 in all sectors but real estate). Then, multiplying
                                                                                     j
                                                                                     n
  both sides of equation (45) by the ratios        ~ kj   gives N K (J - 1) values for the
                                                     n
  productivity of firms in different sectors, j , and cities, n, associated with occupation
       kj           j j
                j n n       n   n  j (1- j )
  k , Tn   (Hn   )     kj
                        n         , which, in the special case where one abstracts from
  differences in occupational composition across cities, reproduces measured regional and
  sectoral productivity in Caliendo et al. (2018).

9. Computing the idiosyncratic amenity distribution parameter  and amenity shifters Ak
                                                                                     n
   for each city n and occupation k

                                                               69
       To compute  we match the estimate for local labor supply elasticity with respect to
       local wage estimated by Fajgelbaum, Serrato and Zidar (2018) of 1.14. In our setup,
                                                               k
       for any occupation k and city n, this elasticity is  Pw n
                                                             n Cn
                                                                 k . The average elasticity is equal

       to 1.14 if  = 2.017. Given  , we can now back-out amenities from the labor supply
       equation 2.35

B.3      Instrumenting for Employment Level and Composition
In order to isolate the residual simultaneity between exogenous productivity variation and
labor allocation, we resort to variants of instruments proposed in the literature. Specifically,
we follow Ciccone and Hall (1996) and use population a century prior to our data period
to capture historical determinants of current population, and we follow Card (2001) and
Moretti (2004a), and use variation in early immigrant population and the presence of land-
grant colleges to capture historical determinants of skill composition of cities. We now discuss
the particular instruments in more detail.

Population in 1920 Ciccone and Hall (1996) argue for the validity of historical variables
as instruments under the assumption that, after allowing for the controls described above,
original sources of agglomeration only affect current population patterns through the pref-
erences of workers, and not through their effect on the residual component of productivity.
This reasoning motivates using population almost one hundred years prior to our data pe-
riod as an instrument and will also serve as motivation for the other instruments, described
below.

Irish immigration in 1920 Next, we use the fraction of Irish immigrants in the popula-
tion of each city in 1920. This instrument is motivated by Card (2001), who uses the location
of immigrant communities as an instrument for labor supply in different occupations. For
our purposes, we focus on the location of Irish immigrants following evidence reviewed by
Neal (1997), and further studied by Altonji et al. (2005), showing that attending catholic
schools substantially increases the likelihood of completing high school and college education.
We use as an instrument the fraction of Irish immigrants, rather than the overall catholic
population, because Irish immigrants represented the first wave of catholic immigration to
the U.S. and, therefore, historically were the first to invest in education. As additional vali-
dation for this instrument, we compile data on the current location of catholic colleges, and
observe that MSAs in which catholic colleges are present had in 1920 more than three times
the fraction of Irish immigrants as other locations.

The Presence of land-grant colleges Lastly, following Moretti (2004a), we also use as
an instrument the presence of a land-grant college within the city. Land-grant colleges were
established as a result of the Morrill Act of 1862, and extended in 1890, a federal act that
sought to give states the opportunity to establish colleges in engineering and other sciences.
  35
    For given k , labor supply is homogeneous of degree zero in Akn . This implies that amenities are only
                                                                                                     ~k
determined up to an arbitrary, occupation-specific scaling constant, that is, we can change An |k to An so
     ~k      k k
that An = m An without any observable implications.


                                                   70
Since the act is more than a century old, the presence of a land-grant college in the city is
unlikely to be related to unobservable factors affecting productivity in different cities over
our base period, 2011 - 2015. At the same time, as shown in Moretti (2004a), the presence
of land-grant colleges is generally correlated with the composition of skills across cities.

B.4      A check on the instruments: Estimates in Counterfactual
         without Externalities
Table 10 below shows the results from carrying out the same estimation exercises as in Table
7 using employment and productivity values obtained from a counterfactual equilibrium in
which externality elasticities,  R,k and  L,k , are set to zero but all other model parameters
are kept at their original levels.

      Table 10: Estimates with data generated by counterfactual without externalities

                                    (1)                           (2)                 (3)
                                   OLS                           2SLS                CUE

      VARIABLES            CNR       non-CNR            CNR       non-CNR   CNR       non-CNR
               k
      j
      n log ( Ln
              Ln
                 )       -1.054***        -0.109        -0.240     -0.860   -0.073     0.095
                           (0.30)         (0.48)        (0.73)     (0.93)   (0.72)     (0.92)
      j
      n log (Ln )          0.028          -0.034        -0.020     -0.065    0.004     0.003
                           (0.06)         (0.04)        (0.06)     (0.04)   (0.06)     (0.04)

      Observations         7,459          7,4597,459      7,459             7,459       7,459
      K.P. F                                   7.646      7.742             7.646       7.742
      S.W.F. Lkn Share                         12.18      12.29             12.18       12.29
      S.W.F. Ln                                14.84      17.10             14.84       17.10
                           Robust standard errors in parentheses
                             *** p<0.01, ** p<0.05, * p<0.1




B.5      Model-Implied IV
In this exercise, we estimate externalities using an IV implied by the model. This is obtained
by calculating the counter-factual allocation associated with an economy where, for any given
industry/occupation category, productivity is constant across cities, and using the resulting
counter-factual labor allocation as instruments.
    This instrument will correct for a reverse causality problem since, by construction, there
is no exogenous variation in productivity across cities. Table 11 below shows the estimates.
The F-statistics are very large, implying no need to explore GMM-CUE estimates. Moreover,
the coefficients present the same general pattern as our baseline estimates: occupational
externalities are generally stronger than those associated with total population.

                                                   71
                    Table 11: Externality estimates with Model Implied IV's

                                                     (1)                                (2)
                                                 OLS                                2SLS

                 VARIABLES                CNR             non-CNR             CNR         non-CNR

                         Lnk
                 j
                 n log ( L n
                             )           0.900***         0.681***           0.758***          0.390*
                                          (0.12)           (0.22)             (0.12)           (0.21)
                 j
                 n log (Ln )             0.388***         0.322***           0.407***         0.306***
                                          (0.05)           (0.04)             (0.05)           (0.04)

                 Observations       7,459      7,459      7,459                                7,459
                 R-squared          0.406      0.310      0.406                                0.308
                 K.P. F                                    611                                 331.8
                          k
                 S.W.F. Ln Share                           1216                                596.7
                 S.W.F. Ln                                 1749                                1492
                            Robust standard errors in parentheses
                              *** p<0.01, ** p<0.05, * p<0.1



C      The Planner's Problem
This section describes the solution to the planner's problem taking as given that workers
in different occupations can freely choose in which city to live. Under this assumption, the
expected utility of a worker of type k is given by equation (16). Given welfare weights for
each occupation, k , the utilitarian planner then solves
                                                                                   1
                                                                 N                 
                                               -1                               
                               W=        k                            Ak  k
                                                                       n Cn            Lk ,                    (46)
                                     k
                                                                n=1

                   k
where recall that Cn aggregates final goods from different sectors:

                                               k                kj   j
                                              Cn =             Cn        .                                     (47)
                                                      j

    The planner maximizes (46) subject to the resource constraints for final goods,
                                                                                                     
                                                                                         -1          - 1
                                                                                         

                 Lk  kj
                  n Cn +
                                      jj
                                     Mn  (z)d(z) =                           Qj
                                                                              nn (z)          d(z)         ,   (48)
             k                   j                                       n

where Qj  nn (z) are the purchases of intermediate goods produced in city n by final goods
firms in city n, the resource constraints for intermediate goods of all varieties z and industries
j produced in all cities n

                                                          72
                                     Qj      j      j          +
                                      n n (z)n n = qn (z), z  Rn ,                                          (49)
                                 n

where
                                                                                       j
                                                                                       n
                                                                                 j
                                                                              (1-n )
                    
                                                                         -1
                             j                                      -1                                j j
          j           j
         qn (z) = zn Hn (z)n                  kj       kj
                                              n (Ln ) Ln (z)
                                                                                                jj
                                                                                               Mn  (z)n ,
                                     k                                                     j


labor markets constraints in all locations,

                                                   Lkj           k
                                                    n (z)d(z) = Ln ,                                        (50)
                                          j

where labor supply in each city, Lk
                                  n , satisfies
                                                                 
                                                         Ak  k
                                                          n Cn
                                         Lk
                                          n    =                     k
                                                                    L ,                                     (51)
                                                     n    Ak  k
                                                           n Cn

the resource constraints in the use of land and structures,

                                                    j
                                                   Hn (z)d(z) = Hn ,                                        (52)
                                          j

as well as non-negativity constraints applying to both household consumption of different
goods and input flows:

                                          kj
                                         Cn   0 and Qj
                                                     n n (z)  0.

   From the resource constraint on local labor markets (50), and the labor supply condition
(51), it follows immediately that national labor markets clear (i.e., n,j Lkj            k
                                                                           n (z)d(z) = L ).


C.1     Solving the Planner's Problem
                                                                           k
We solve the Planner's problem for interior allocations, (i.e., where Cn     and Lkn are strictly
                                                                              j
greater than zero for all n and k ). For each city n and sector j , let Pn be the Lagrange
multiplier corresponding to the final goods resource constraint in city n, sector j (48), Pn the
multiplier corresponding to the aggregation of sectoral goods in each city (47), and pj n (z) the
multiplier corresponding to the intermediate goods resource constraints (49). For each city
                           k
n and occupation k , let wn  be the multiplier corresponding to regional labor market clearing
        k
(50), Wn   the multiplier corresponding to the definitions of employment in each occupation
and sector (51). Finally, for each city n, let rn denote the multiplier corresponding to market
clearing for structures (52).
    The first-order conditions associated with the planner's problem are:
                                                            k
                                          kj               Cn
                                         Cn  : Pn  j       kj
                                                                    j k
                                                                 = Pn Ln ,                                  (53)
                                                          Cn

                                                         73
which also defines an ideal price index,
                                                                             j         j
                                                Pn                          Pn
                                            Pn = k =                                        .                                                 (54)
                                                Ln                 j
                                                                            j

   In addition,

                                                                                        1
                                                                                                              
                   k            k      -1                                                            Ak  k
                                                                                                      n Cn                1 k
                  Cn      :                                    Ak
                                                                n
                                                                        k
                                                                       Cn                                                  k
                                                                                                                             L                (55)
                                                         n                                       n    Ak
                                                                                                       n
                                                                                                              k
                                                                                                             Cn          Cn
                                           N
                                                 k
                                                 n C
                                                     k
                        =      Lk
                                n Pn   -           k
                                                        k
                                                       Wn ,
                                           n =1
                                                 C n

where
                                               
                                                                            Lk
                              k
                              n  C     k                 k
                                                        Cn
                                                                  1-         n
                                                                            Lk
                                                                                    Lk
                                                                                     n if n = n
                                 k
                                           =                               Lk                                     .
                                Cn              -             k
                                                                            n
                                                                                    Lk
                                                                                     n          if n = n
                                                             Cn            Lk

   Also
                                                  J
                                       Lk
                                        n :
                                                         j kj
                                                        Pn       k
                                                           Cn - wn    k
                                                                   + Wn = 0.                                                                  (56)
                                                 j =1

where

 k    k
wn = wn                                                                                                                                            (57)
                                                                                                                      j
                                                                                                             j        n    J
                                    j                                                       -1       -1   (1-n )                        j j
                               j
                     zn       Hn (z)n        k        k
                                                      n
                                                        j
                                                             (Ln ) Lk
                                                                    n
                                                                      j
                                                                                 (z)                                              jj
                                                                                                                                 Mn  (z)n
                                                                                                                          j =1
          +                                                                                                                                   ~j
                                                                                                                                              p n (z) dz
              j
                                                                            Lk
                                                                             n


denotes the total social marginal value of an extra worker of type k in city n. On the
production side, efficient allocations dictate
                                                                        1
               
                                                       1              -
                Qj (z) > 0 if j pj (z) = Pn    j   j     N     j
                                                 (Qn )   n =1 Qnn (z)     d(z)
               
                     nn              nn n
   Qj nn (z) :                                         1              - 1      .  (58)
                                                         N              
                Qj (z) = 0 if j pj (z) > P j (Qj )             j
                                                         n =1 Qnn (z)     d(z)
               
                     nn              nn n      n   n

                                                    j                 j
This last equation delivers efficient trade shares, nn , and prices, Pn , using the usual Eaton
and Kortum derivations. In addition,
                                                                                       1-
                                                                     wn k

                                                j                   kj
                                               qn (z)             ( n Ln ))
                                                                       (
                  Lkj      j      j
                   n (z) : n (1 - n )                                                       1-   pj        k
                                                                                                  n (z) = wn d(z),                            (59)
                                            Lkj
                                             n (z)                      wnk
                                                              k        kj
                                                                       (
                                                                       n (Ln )      )

                                                                  74
                                                          j
                                     j       j j         qn (z) j
                                    Hn (z) : n n           j    pn (z) = rn d(z),                         (60)
                                                         Hn (z)
                                                          j
                                    jj       jj          qn (z)
                                   Mn  (z) : n           jj
                                                               pj
                                                                n (z)
                                                                              j
                                                                           = Pn d(z).                     (61)
                                                        Mn (z)
With the usual manipulations of these equations, one obtains
                                                                        xj
                                                                         n d(z)
                                      pj       j
                                       n (z)  pn (z)d(z) =                      ,                         (62)
                                                                            zn
where                                                                             j
                                                                              j
                                                                                  n
                                                                       -n
                                                                  1-  11 -
                                                         k                                      j j
                         j                              wn                                      n
               xj = B j  n
                     n rn
                                                                                            j
                                                                                           Pn         ,   (63)
                                                                                  
                n                                                                 
                                           k          kj
                                                      n (Ln )
                                                                                      j


     j
and Bn is defined as above.


D       Characterization of the Planner's Solution
In the decentralized equilibrium, the budget constraint of a household of type k in city n
satisfies
                                          k    k
                                     Pn C n = wn + k ,
                    rn Hn
where k = bk    n
                        Lk,j
                               . In contrast, we now show that the consumption of a household of
                 n ,j    n
type k in city n implied by the planner's solution satisfies
                                     k     
                                Pn C n =      w k + k + R k ,
                                         1+ n
                 k
and recall that wn is the social marginal product of labor associated with occupation k in
city n.

    Proof:
    Equation (55) may alternatively be expressed as
                                                                       N
                    Lk                                                                Lk
               k v k n
                     k
                               =   Lk
                                    n Pn   -        k
                                                         Lk  k
                                                          n Wn    +            k
                                                                                       n
                                                                                            Lk  k
                                                                                             n Wn ,
                    Cn                             Cn                 n =1
                                                                              Cn      Lk
where v k is defined in equation (16). Alternatively, we have that

                                                        Lk
                                k v k -                  n     k
                                                              Wn        k
                                                                 = Pn C n    k
                                                                          - Wn .
                                               n
                                                        Lk
                                           (1+ )(k +Rk )
                  k
Substituting for Wn from (56) in this last expression gives
                                    k     k        k
                               Pn C n =  wn - P n Cn + (1 +  ) (k + Rk )

                                                             75
or
                                                    k           
                                               Pn C n =          w k + k + R k .                                                      (64)
                                                               1+ n


   Observe that we can also use (56) to write k + Rk as a function of prices, wn
                                                                               k
                                                                                 , Pn , and
              k
consumption, Cn . In particular,

                                               k v k                                   Lk
                         k + R k =                   -                                  n         k
                                                                                                 wn        k
                                                                                                    - P n Cn .
                                               1+ 1+                     n
                                                                                       Lk
We can then obtain an expression for the total consumption expenditures of households of
type k by adding (64) across cities n, with the expression for k + Rk substituted in,

                                                  k v k L k =                      k k
                                                                              Pn C n Ln .                                             (65)
                                                                     n

Substituting out k v k back into the expression for k + Rk and rearranging, we obtain
                                                               k k
                                                          Pn C n Ln                      k          Lk
                                                                                                     n
                               k + R k =              n
                                                            k
                                                                    -                                      k
                                                                                                          wn .
                                                           L                       n
                                                                                        1+          Lk
                                        k k                      k k
Finally, note that           n,k   P n Cn Ln =        n,k       wn Ln + rn Hn , so that
                                                  1                                 
                  Lk (k + Rk ) =                    w k Lk -                          w k - wn
                                                                                             k
                                                                                               Lk
                                                                                                n+                        rn Hn       (66)
              k                            n,k
                                                 1+ n n                      n,k
                                                                                   1+ n                               n
                                       k
The individual values for  are determined to be such that equation (66) is satisfied.

D.1         The Social and Private Marginal Value of Workers of type k
            in city n (Proof of Lemma 1)
Solving the derivative in the equation defining the social value of workers of type k in city n
(57), we obtain

         k    k
       w
       ~n  - wn
                                                                                                          j
                                                                                                    j     n    J
                   j    j          j
                                   n             kj                            1- 1         1-   (1-n )                    j j
                  zn   Hn (z)              k     n    (Ln ) Lk
                                                             n
                                                               j
                                                                     (z)                                            jj
                                                                                                                   Mn  (z)n
                                                                                                              j =1
  =                                                                                                                              pj
                                                                                                                                  n (z)d(z)
        j
                                                                    Lk
                                                                     n


     where pj           ~j
            n (z)d(z) = p n (z). This expression is equivalent to


                                                           k        1-
                                                          wn
         k    k                   j  j               k j
                                                     n (Ln )                           k
                                                                                       n (Ln ) j
                                                                                        1j
       w
       ~n  - wn =            (1 - n )n                                   1-    kj          k
                                                                                              qn (z)pj
                                                                                                     n (z)d(z).
                       j,k
                                                                k
                                                               wn              n (Ln ) L   n
                                                 k        k j
                                                          n (Ln )



                                                                    76
   Rearranging and integrating equation (59) yields
                                                             k      1-
                                                           wn
                                                          kj
                   k kj        j  j                       n (Ln )                   j
                  wn Ln = (1 - n )n                                      1-        qn (z)pj
                                                                                          n (z)d(z),
                                                             wn k
                                                      k     k j
                                                            n (Ln )

so that the expression for the deviation of private from social marginal product of labor
simplifies further to

                                   k    k                    k   Lk j   kj
                                                                  n  ln n (Ln )
                                 w
                                 ~n  - wn =                 wn                  .                          (67)
                                                      j,k
                                                                 Lkn   ln Lk
                                                                           n



D.2     Implementation (Proof of Proposition 1)
We now discuss the implementation of the optimal policy. One possible implementation is
to combine a direct employment subsidy to firms that is specific to cities and occupations
(k                                                       k
    n ), a linear occupation-specific labor income tax (tL ), combined with occupation-specific
transfers (Rk ).
     With externalities in occupations, the social and private marginal products of labor differ.
The first step in the implementation of optimal allocations, therefore, is to subsidize firms in
                                                                      k
different locations to hire different occupation types. We define wn    to be the after-subsidy
wage associated with workers in occupation k living in city n such that
                                                     k    k
                                                    wn = wn + k
                                                              n,

where k n is a per-worker subsidy offered to firms in city n hiring workers of type k . With
these subsidized wages in place, we take advantage of various additional taxes and transfers
to implement optimal allocations. In particular, equation (1) becomes

                                 k
                                In = (1 - tk   k   k   k
                                           L )wn +  + R , (N K eqs.) .                                     (68)
where transfers have to be such that the government budget balances,

                                   Lk k
                                    nR =              tk  k k
                                                       L wn Ln -               (1 - tk  k k
                                                                                     L )n Ln .             (69)
                          n,k                   n,k                      n,k
                                                                   k
We also have that labor demand depends only on pre-subsidy wages, wn ,
                                           k    1-
                                        wn
               k kj                    kj
                                       n Ln )
                                          (                 j     j
              wn Ln (z) =                             1-    n 1 - n pj     j
                                                                     n (z)qn (z), (N KJ eqs.)              (70)
                                            k
                                           wn
                                   k    k j
                                        n   (Ln )
                                                                                   j
                                                                                   n
                                                                               j
                                                                           1-n
                                                           k        1-      1-                   j j
                              j                           wn                                     n
                  xj        j
                            n                                                               j
                       = B rn                                                              Pn          ,   (71)
                                                                                   
                   n
                                                    kj
                                                                                   
                                           k        n (Ln )                            j




                                                               77
Definition 1. An equilibrium with taxes and transfers is defined as the equilibrium without
                                                                 k
taxes and transfers but with the additional conditions that i) In  is given by equation (68),
ii) the first-order condition describing intermediate goods producers' labor demand is given
by (70), iii) the cost index xjn is given by (71), and iv) the government budget constraint
(69) is satisfied.
Proposition. Let

                                          1
                                  tk
                                   L =
                                         1+
                                                   Lk j   kj
                                                    n  ln n (Ln )
                                 k
                                 n =
                                               k
                                              wn
                                         kj
                                                   Lkn   ln Lk
                                                             n




    and Rk such that
                                     k v k L k =             k k
                                                        Pn C n Ln .
                                                    n
   Then, if the planner's problem is globally concave, the equilibrium with taxes and transfers
implements the optimal allocation.
Proof. 1) The first order condition for household consumption choice (15) is identical to the
first order condition for consumption in the planner's problem, (53). The modified budget
constraint for the household (68) implies a relationship between consumption and prices
identical to equation (64), which is derived from the first order conditions (55) and (56) in
the planner's problem. At the same time, the optimal location decision for the household,
(2) is identical to the free mobility constraint in the planner's choice (51) for a given set of
                 k
consumption Cn     .
    2) The first order condition for factor demand for intermediate input producers, (17),
(19) and (70) are identical to the first order conditions for the planner's problem (59), (60)
                                                          k
and (61) once one uses equation (67) to substitute w   ~n   out of (59).
    3) The condition that a producer in city n and industry j imports a variety z from city
n if and only if j        j            j     j
                     nn pn (z) = minn nn pn (z) is implied by the first order condition for the
                                                     j
planner's problem (58), given that Qj   n (z) =  n Qnn (z), p ~j               j
                                                                n (z)d(z) = pn (z).
    4) The first order condition associated with the optimal use of different varieties by final
                                                                      j
goods producers (24) is implied by (58) given that Qj  n (z) =                ~j
                                                                   n Qnn (z), p
                                                                                             j
                                                                                n (z)d(z) = pn (z),
       j                j   j
and Pn (z) = minn nn pn (z).
    5) The market clearing conditions for employment (equation 5), structures (equation 6),
final goods (equation 7) and intermediate goods (8) are identical to the resource constraints
faced by the planner, respectively, (50) combined with (51), (52), (48) and (49).


E     A Counterfactual Economy After Eliminating En-
      dogenous Amenities
We now verify whether the planner solution would be likely to change if one were to ad-
just local amenities to remove the components that Diamond (2016) argues are likely to be

                                                   78
endogenous. For that purpose, we carry out two counterfactual exercises. For both exer-
cises, we first extract the exogenous component of amenities as implied by the mapping of
Diamond's (2016) estimates into amenity spillovers described in Fajgelbaum and Gaubert
                                                                                 k   k
(2018). Specifically, we calculate a value of Ak,exo n     such that Ak,exo
                                                                       n        Lk
                                                                                 n
                                                                                     a  k
                                                                                       Cn = 1, with
  CN R,CN R           nCN R,CN R                CN R,nCN R               nCN R,nCN R
a           = 0.77, a               = -1.24, a              = 0.18 and a             = -0.43. In the
first exercise, we calculate a counterfactual equilibrium where the labor supply equations are
                                  k
                             k -
            k      (Ak,exo
                      n    Cn )
given by Ln =           k,exo k -
                                    k . In the second exercise, we calculate the optimal allocation
                   n (An     Cn )
in that counterfactual environment.
    Figures 21 below show the relationship between relative the exogenous part of amenities
implied by that exercise and city size and composition, further discussed in the text.
    Figure 22 shows how the distribution of CNR workers in the optimal allocation compares
with the counterfactual equilibrium. As in our baseline economy, the planner has an incentive
to increase labor market polarization by concentrating proportionately more CNR workers
in larger cities. Figure 23 shows that, as in our baseline analysis, this increased polarization
is matched by transfers from the large cities to the small ones.


F     Quantifying the Model for 1980 and Counterfactual
      Exercises
F.1     Quantifying the Model for 1980
In order to quantify the model for 1980, we follow similar steps as described in Section B,
with modifications to accommodate data constraints.
     Regional Price Parities data are not available for 1980. In the baseline model quan-
tification, we used those in order to calculate the productivity of the non-tradable sectors.
To obtain the productivity of the real estate sector in 1980, we match instead changes in
CoreLogic HPI data, available by county. As for the productivity of the non-tradable sector,
we assume that its spatial distribution does not change. In addition, the model inversion
exercise carried out for our 2011-15 benchmark does not pin down the national average level
of productivity for each industry, only its occupational and spatial variation. In order to
obtain the time variation of those levels, we choose average 1980 productivity levels to match
national level sectoral price series made available by the BEA.
     To obtain wages and the occupational composition of cities and industries, we use the
5% sample of the 1980 Census data which is comparable to the ACS. The 1980 Census has
data for 213 MSA's that account for approximately 85% of US employment in that year.
For the remaining MSA's, we impute wages and employment by occupation and by sector
by taking the predicted values of a regression of those variables on 1980 CBP employment
by sector and housing prices.




                                                79
        0.6
                                                              Slope: -0.74
                                                              Correlation: -0.2
        0.4

        0.2

          0

       -0.2

       -0.4

       -0.6

       -0.8

         -1
          0.15    0.2     0.25     0.3        0.35    0.4   0.45     0.5    0.55
                            CNR share of city employment

                                                            Slope: 0.12
        0.6                                                 Correlation: 0.68

        0.4

        0.2

          0

       -0.2

       -0.4

       -0.6

       -0.8

         -1
              9     10        11         12          13     14        15          16
                                   log city employment
Figure 21: Relative amenities and city size and composition (exogenous part)
Ratio of occupational-specific amenity parameters for each city obtained after extracting
the endogenous part of amenities implied by the parametrization used by Fajgelbaum and
Gaubert (2018). Each observation refers to a CBSA. Marker sizes are proportional to total
city employment.




                                              80
                                                                                                       Difference in CNR
                                                                                                                           0.6

                                                                                                                           0.4




                                                                                                              share
                                                                                                                           0.2

                                                                                                                           0.0

                                                                                                                           -0.2
                                                                                                                                        0.2   0.4    0.6
                                                                                                                                    CNR share in
                                                                                                                                    counterfactual
                                                                                                                                   = 0.704 , ~ = 0.825




                                                                                                       Difference in CNR
                                                                                                                           0.6

                                                                                                                           0.4




                                                                                                              share
                                                                                                                           0.2

                                                                                                                           0.0

                                                                                                                           -0.2
                                                                                                                                   11    12   13    14     15
                                < -0.274                    [ -0.137 , 0 )         [ 0.137 , 0.274 )                               Log population in
          Difference in CNR                                                                                                         counterfactual
          share                 [ -0.274 , -0.137 )         [ 0 , 0.137 )          >= 0.274                                        = 0.414 , ~ = 0.606
                   Population      44,000             1,816,000             3,587,000




Figure 22: Optimal LCN
                    n
                       R
                         /Ln with counterfactual amenities (change from counterfactual
equilibrium)
        Each marker in the map refers to a CBSA. Marker sizes are proportional to total equilibrium
        employment in each city.  and      ~ are unweighted and population weighted correlations
        respectively.



F.2      Details of Counterfactual Exercises
In the counterfactual exercises described in Section 6, we separate average changes in pro-
ductivity or amenities from their geographical and occupational dispersion.
    The first step is to study the consequences of changing factor shares. We focus on the
consequences of those changes to factor demand, while keeping unit costs in individual cities
and industries fixed. This exercise implies a set of alternative productivity parameters for
1980, which we then take as our base for comparison with the current period.36 Productivity
                                    kj     j n       n    n 37    j                j (1- j )
changes then refer to changes in Tn    = (Hn ) kj n         . The average change in produc-
tivity between 1980 and 2011-15 for a given industry is a Tornqvist type index: a geometric
weighted average of the changes in productivity across cities, with the weights given by the
value added by each city/industry as a fraction of total industry value added. Those shares
are first calculated separately for the 1980 and 2011-15 periods, and the weights correspond
  36
     One advantage of this procedure is that, given that changes in factor shares can be city-specific, implied
productivity changes may otherwise depend on scaling parameters adopted for the different inputs.
  37
     Specifically, when calculating the average change in productivity for a given sector j and occupation k
                                                                           k kj
             kj,counterfactual    j      kj 1       kj           kj      wn Ln
we set ln Tn                   = n    n n  j ln Tn     , where n    =        k  kj , and analogously for other
                                            n                            n w n Ln
averages.

                                                                     81
                                                                                                        (per capita, '000s)
                                                                                                                              15




                                                                                                          Net transfers
                                                                                                                               0

                                                                                                                              -15

                                                                                                                              -30
                                                                                                                                    0.0    0.2   0.4   0.6   0.8
                                                                                                                                       CNR share in
                                                                                                                                       counterfactual
                                                                                                                                      = -0.88 , ~ = -0.94




                                                                                                        (per capita, '000s)
                                                                                                                              15




                                                                                                          Net transfers
                                                                                                                               0

                                                                                                                              -15

                                                                                                                              -30
                                                                                                                                      11    12   13    14    15
                                    < -20500                    [ -10300 , 0 )      [ 10300 , 20500 )                                Log population in
       Net transfers (per capita)                                                                                                      counterfactual
                                    [ -20500 , -10300 )         [ 0 , 10300 )       >= 20500                                         = -0.587 , ~ = -0.741
                      Population     44,000         1,816,000           3,587,000




                    Figure 23: Optimal transfers in with counterfactual amenities
         Optimal transfers defined as the difference in the optimal allocation between the value con-
                                                         k
         sumed and value added in each city ( k Pn Cn      - k w - nk Lk n - rn Hn ). Each marker in
         the map refers to a CBSA. Marker sizes are proportional to total equilibrium employment
         in each city.  and ~ are unweighted and population weighted correlations respectively.



to the arithmetic average of those shares.38
    The model does not allow us to pin down an aggregate trend in amenities since changing
amenities in all cities by a common scaling parameter leaves the equilibrium unchanged.
We thus assume that there was no such trend so as to focus on the welfare implications of
endogenous changes in equilibrium variables. For the baseline economy, this implies keeping
a Tornqvist type index of amenities constant relative to the 2011-15 period: specifically,
we keep a weighted geometric average of changes in amenities equal to 1, with the weights
given by employment shares by city (again the shares are taken for the baseline and 2011-15
periods separately and the weights are given by an arithmetic average).




 38
      We carry out a similar calculation in order to obtain productivity trends by city/industry/occupation


                                                                    82
                                         0.15
data equilibrium to optimal allocation
   Change in Gini coefficient from




                                          0.1


                                         0.05


                                            0


                                         -0.05


                                          -0.1


                                         -0.15
                                                 9   10   11        12        13        14   15        16
                                                               Log population in data

Figure 24: Changes in the Gini coefficient between the data and optimal allocation.
                  Each observation refers to a CBSA. Marker sizes are proportional to total employment. The
                  solid-black line is a cubic fit of the data. The Gini is constructed using the Lorenz curves
                  depicting within city wage bill and industry rank.




                                                                         83
