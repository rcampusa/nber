                              NBER WORKING PAPER SERIES




      A METHOD TO ESTIMATE DISCRETE CHOICE MODELS THAT IS ROBUST
                         TO CONSUMER SEARCH

                                        Jason Abaluck
                                      Giovanni Compiani

                                      Working Paper 26849
                              http://www.nber.org/papers/w26849


                     NATIONAL BUREAU OF ECONOMIC RESEARCH
                              1050 Massachusetts Avenue
                                Cambridge, MA 02138
                                    March 2020




Thanks to Abi Adams, Judy Chevalier, Magne Mogstad, Barry Nalebuff, Aniko Oery, Nicholas
Ryan, Fiona Scott Morton, Raluca Ursu, Miguel Villas-Boas, and seminar participants at Yale,
SICS 2019, Marketing Science 2019, Caltech, QME 2019, University of Bologna, Northwestern,
and UT Austin for helpful comments and suggestions. Tianyu Han and Jaewon Lee provided
excellent research assistance. Jason blames any remaining errors on the widening partisan divide
in this country (the US) and the lackluster proofreading efforts of the economics Twitter
community. The views expressed herein are those of the authors and do not necessarily reflect the
views of the National Bureau of Economic Research.

NBER working papers are circulated for discussion and comment purposes. They have not been
peer-reviewed or been subject to the review by the NBER Board of Directors that accompanies
official NBER publications.

© 2020 by Jason Abaluck and Giovanni Compiani. All rights reserved. Short sections of text, not
to exceed two paragraphs, may be quoted without explicit permission provided that full credit,
including © notice, is given to the source.
A Method to Estimate Discrete Choice Models that is Robust to Consumer Search
Jason Abaluck and Giovanni Compiani
NBER Working Paper No. 26849
March 2020
JEL No. C5,C8,C9,D0,D6,D8

                                          ABSTRACT

We state a sufficient condition under which choice data alone suffices to identify consumer
preferences when choices are not fully informed. Suppose that: (i) the data generating process is a
search model in which the attribute hidden to consumers is observed by the econometrician; (ii) if
a consumer searches good j, she also searches goods which are better than j in terms of the non-
hidden component of utility; and (iii) consumers choose the good that maximizes overall utility
among searched goods. Canonical models will be biased: the value of the hidden attribute will be
understated because consumers will be unresponsive to variation in the attribute for goods that
they do not search. Under the conditions above and additional mild restrictions, an alternative
method of recovering preferences using cross derivatives of choice probabilities succeeds
regardless of the search protocol and is thus robust to whether consumers are informed. The
approach nests several standard models, including full information. Our methods suggest natural
tests for full information and can be used to forecast how consumers will respond to additional
information. We verify in a lab experiment that our approach succeeds in recovering preferences
when consumers engage in costly search.


Jason Abaluck
Yale School of Management
Box 208200
New Haven, CT 06520-8200
and NBER
jason.abaluck@yale.edu

Giovanni Compiani
University of California at Berkeley
2220 Piedmont Ave
Berkeley, CA 94720
gcompiani@berkeley.edu
1        Introduction
When consumers purchase cars, houses, food, insurance, schooling and much else, they are often imperfectly
informed about the attributes of relevant products in ways that substantially alter their choices (Allcott
and Knittel 2019; Woodward and Hall 2012; Abaluck and Gruber 2011; Allcott, Lockwood, and Taubinsky
2019; Hastings and Weinstein 2008). Given this, models which assume full information may generate wrong
conclusions about welfare and cannot be used to assess how choices would respond to more information.
However, despite the emergence of behavioral economics as a major subfield of economic analysis, most
work in applied economics continues to assume that choices are fully informed. We count 350 articles
published in the AER, QJE, JPE, ECTA or ReStud since 2015 that estimate discrete choice models. Of
these 350, 315 (90%) assume that consumers are fully informed.1
        We believe this occurs for three reasons. First, for some positive purposes, it is irrelevant whether
choices are informed since all that is required is to estimate how demand responds to price (Berry and
Haile 2014). For instance, price elasticities are sufficient to predict equilibrium prices after a counterfactual
merger between two firms.2 Second, the data necessary to directly measure consumers' beliefs is often
unavailable, and even when it is available, survey data is viewed with suspicion (Gul and Pesendorfer
2008). Full information is viewed as a parsimonious assumption in the absence of evidence to the contrary.
Third, choice data alone does not suffice to separately identify preferences and beliefs without further
assumptions (Manski 2002). Structural search models in which consumer beliefs can be identified (e.g.
Ursu (2018)) require assumptions regarding whether consumers take into account option value, whether
they solve an optimal stopping problem or "satisfice", distributional assumptions about prior beliefs and
search costs, and whether choices are simultaneous or sequential, among others. The empirical literature
suggests that canonical assumptions in all of these cases are often rejected by the data (respectively, Gabaix
et al. (2006), Schwartz et al. (2002), Jindal and Aribarg (2018), Honka and Chintagunta (2016)).
        In this paper, we state what we believe is a more plausible condition under which choice data alone
suffices to recover preferences whether consumers are fully or only partially informed. Importantly, this
condition does not require specifying the full structural search model. The approach relies on what we call
visible utility, the component of utility visible prior to search. The main restriction we impose on search is
that consumers never search items with lower visible utility and then leave unsearched items with higher
visible utility (a condition we make precise below). We show that if this condition is satisfied, there is
a function of choice probabilities which recovers preferences whether consumers are fully or partially in-
formed. Given preferences recovered by our approach, we show that it is possible to identify other primitives
of interests. For example, in a sequential search model `
                                                        a la Weitzman (1979), one can identify the distri-
bution of search costs and thus simulate counterfactuals in which search costs are altered by information
provision or other means. However, for many counterfactuals, such as simulating full information choices

    1
        The list of papers and their classification is available upon request from the authors.
    2
    Even among the 126 articles in our survey that conduct welfare analyses and thus must take a stand on whether consumers
are informed, 109 (86.5%) assume full information without testing this assumption.



                                                                   2
and evaluating the benefits of full information via better choices, search costs need not be recovered at all.
Preferences are identified--and thus can be estimated--without imposing a structural search model beyond
the visible utility assumption. Specifically, no additional assumptions about option value, optimization vs.
satisficing, simultaneous or sequential search, or distributional assumptions about beliefs and preferences
are necessary for identification. Our results also suggest straightforward tests of full information, which we
prove are powered within the large class of models covered by the visible utility assumption.
      One can think of our approach as a data-driven method of isolating consumers who maximize utility.
Consider the example of consumers purchasing items in a grocery store: nutritional information is accessible,
but at some cost. Consumers may fail to maximize utility if they do not pay the cost to examine labels.
In this case, visible utility represents utility from all non-nutrient sources, e.g. a combination of prices
and perceived taste. Our assumption states that if you bother to check the nutrition label for good j ,
you will also check the label for a good j that you would otherwise prefer were it equally nutritious.
This assumption implies that consumers who search the most nutritious good always choose the good that
maximizes utility among all options (which is not necessarily the most nutritious good). To see this, note
that if some other good has higher utility than the most nutritious good, it has higher visible utility and
thus is searched and then chosen by the consumer. Further, only consumers who search the most nutritious
good are sensitive to nutrient content for that good. Therefore, by looking at the sensitivity of choices to
the nutrient content of the most nutritious good we are able to isolate consumers that behave as if they
were fully informed; standard arguments then recover their preferences.
      To spell things out in more detail, consider first a J -good model with linear utility Uij = xj  + zj  +                   ij

where  > 0 and  >            0.3    In the text, we extend this result to allow vector-valued xj and zj , as well as
random coefficients and nonlinear utility. Suppose that consumer i observes xj and                       ij   for all goods, but
needs to engage in search to observe zj . On the other hand, the researcher observes xj , zj , and choice
probabilities sj , but not         ij .   With full information, we have sj = P (Uij  Uij j = j ) and we could
                                                        sj sj
estimate marginal rates of substitution using           zj / xj    = /; in other words, / is identified by whether
the choice probability for good j is more sensitive to zj or xj . If the underlying model is a search model in
which consumers are informed about zj only for some alternatives, then the standard approach will suffer
                              sj sj
from attenuation bias:        zj / xj       < |/|.4 Some consumers will be insensitive to zj variation not because
they don't value it, but because they are not aware of it; thus, the observed sensitivity of choices to zj will
understate consumers' valuation of zj .
      For each individual i and good j , we define visible utility as V Uij  xj  +               ij .   We call this quantity
"visible utility" because it defines the utility that i receives from good j based only on xj and                        ij ,   the
attributes of goods that consumers can observe without engaging in search. Visible utility has the property
that if V Uij  V Uij and zj  zj , then Uij  Uij . Given this definition, suppose consumer search is
characterized by the following assumptions:

  3
      We will show that the signs of  and  are identified, so assuming they are positive is without loss.
  4
      We prove this in Section 2.1.




                                                               3
   1. If i searches a good with visible utility V Uij , she also searches all goods j with V Uij  V Uij .

   2. Conditional on having utility u                                                         ¯)  0 where gij
                                    ¯ in hand, consumer i searches j if and only if gij (xj , u
         is decreasing in u
                          ¯.

   3. Consumers choose the good which maximizes utility among searched goods.

The first assumption states that if you search a good with a given level of visible utility, you always search
all goods with higher visible utility. This assumption would be satisfied if consumers searched in order of
visible utility but it is weaker (e.g. consumers might search the second ranked good in terms of visible
utility and then the first, provided they eventually search both). We relax this assumption in Section 3 by
allowing for variables (e.g. rank on a webpage) to affect search but not utility and by considering the case
where consumers form expectations about z based on x. The second assumption states that a consumer's
decision to search good j depends on j 's visible utility and on the utility u
                                                                             ¯ the consumer already has in
hand. If consumers search sequentially, then u
                                             ¯ is the highest utility uncovered so far in the search process.
Then, the assumption says that the goods searched so far only matter for the decision to continue searching
through the utility in hand. This rules out, for example, the case where consumers stop searching when
they uncover a high enough z . Note that our framework also allows for search protocols where consumers
decide which goods to inspect simultaneously. In this case, the function gij will only depend on j 's visible
utility (see Example 5). The third assumption simply says that you maximize utility conditional on the
goods you have searched.
       These assumptions are consistent with a broad class of search models. For example, in a Weitzman
(1979) search model where the priors and search costs are the same across goods (but the latter vary
across consumers), it is optimal to search the good with the highest visible utility and decide whether to
search the next good by comparing the expected benefits with search costs. These assumptions are also
consistent with many behavioral models: consumers may myopically decide whether to continue searching
by comparing utility in hand with expected utility of the next good (the "directed cognition" model of
Gabaix, Laibson, Moloche, and Weinberg (2006)), consumers might engage in satisficing, i.e. searching in
order of visible utility and stopping whenever utility in hand is good enough, or they might simultaneously
search all goods with visible utility above a certain threshold and then give up. One important special case
is when consumers search all goods, yielding a conventional full-information discrete choice model.
       Our main result (for the case with linear utility and no random coefficients) is that, if the above
                                 2 s1    2 s1
assumptions are met, then       z1 zj / z1 xj    = / for j = 1, where good 1 is defined as the good with the
largest value of the hidden attribute z (which, again, is known to the econometrician but not necessarily to
the consumer). This expression holds for any models where consumers search according to our assumptions
above, including the full information case. The intuition is as follows: under our assumptions, consumers
who search good 1 will always choose the good that maximizes utility among all options (although they
might not be fully informed).5 Therefore, z1 only impacts choices for consumers who maximize utility. By

   5
    Again, if some other good had higher utility than good 1, that good must have higher visible utility since good 1 has the
best z .


                                                             4
                          s1
examining how             z1   changes with attributes of rival goods, we are effectively learning about the impact of zj
and xj on choices for consumers who act as if they were fully informed. For these consumers, both of these
attributes impact choices only via Uj , and they do so in proportion to /. Since  is straightforwardly
identified by examining choices where zj = z for all j ,6 this means that preferences are identified. The
              2 s1    2 s1
quantity     z1 zj / z1 xj        thus provides robust estimates of marginal rates of substitution in the sense that it
works regardless of the search process that consumers engage in provided the assumptions above are met.
       How general is this result? Using additional derivatives of the share function, we can recover nonlinear
utility functions Uij = v (xj , zj ) +        ij .   Additionally, the approach extends to random coefficients on product
characteristics. Specifically, letting Uij = xj i + zj i +                  ij   we can recover the distribution of random
coefficients (i , i ) over a known grid. With a sufficiently long panel and time-invariant preferences, Uijt =
vi (xj , zj ) +   ijt ,   we can recover individual-specific, possibly nonlinear utility functions vi (xj , zj ). Thus, we
can allow for a similar degree of unobserved heterogeneity as other constructive results on discrete choice
demand with full information.7
       Our identification proof lends itself naturally to estimation and testing. If one can nonparametrically
estimate choice probabilities as a function of product attributes, then our results can be used to directly
recover preferences. For example, when the number of goods or attributes is not too large, one could
approximate the share functions via the method of sieves, which makes it possible to conveniently impose
natural restrictions such as monotonicity and exchangeability across goods. When the number of goods
is too large for nonparametric estimation, we suggest using "flexible logits," which allow attributes of
rival goods to directly enter utility for each alternative and thus flexibly parameterize the cross-derivatives
that identify preferences in our model. Given estimates of choice probabilities, one can use our result to
test for full information by checking whether our "search-robust" estimates of preferences are equal to
the conventional estimates based on first derivatives. Additionally, the visible utility assumption implies
bounds on observed choice probabilities and our model is overidentified; in the case of homogeneous, linear
                                      2 s1    2 s1
preferences, for example,            z1 zj / z1 xj     will be equal for all goods j = 1.
       To validate our approach, we attempt to recover preferences in a lab experiment where individuals
engage in costly search. Individuals choose from sets of three books with visible titles, authors, genre, star
ratings and prices, but hidden discounts that can only be observed at some cost. We place no restrictions
on which goods consumers search given these constraints. In particular, we do not constrain search to
satisfy the visible utility assumption. For each individual, we also observe treatments where consumers

   6
       We show this formally in Section 2.
   7
     Fox and Gandhi (2016) provide identification results for more general models allowing for both nonlinearity and flexible
heterogeneity but these results are non-constructive and assume utility maximization; we use their result to identify parameters
in corner cases where consumers maximize utility, but they otherwise are difficult to adapt to the more general case where
choice probabilities need not maximize utility. This is in contrast to the constructive methods in Fox, Kim, Ryan, and Bajari
(2012), who recover distributions satisfying the "Carleman condition," which implies that the distribution of preferences is
uniquely characterized by its moments. Alternatively, we recover weights for distributions supported on a known and fixed
grid, in line with the approach of Fox, Kim, Ryan, and Bajari (2011). Berry and Haile (2009) and Berry and Haile (2014)
also provide related results on nonparametric demand estimation. Their focus is on recovery of the conditional distribution of
utilities rather than the structural parameters of utility; the latter are essential for our task of assessing whether consumers
are informed about relevant attributes.



                                                                    5
choose given full information. As expected, conventional logit estimates using the costly search data give
attenuated coefficients on the discount variable relative to the full-information case. By contrast, our
search-robust estimates successfully recover full-information preferences. Estimated choice probabilities
also satisfy bounds implied by the visible utility assumption.
       Our result relates to several existing literatures. A large theoretical and empirical literature investigates
the formation of "consideration sets" (e.g. Roberts and Lattin (1991), Conlon and Mortimer (2013), Goeree
(2008), and Gaynor, Propper, and Seiler (2016)). These papers attempt to estimate preferences when
consumers may only consider some alternatives. Manzini and Mariotti (2014) and Abaluck and Adams
(2017) are particularly closely related in attempting to characterize when we can recover consideration
probabilities for alternative goods using choice data alone. This paper considers the complementary problem
of imperfect information at the level of attributes rather than goods. The recent theoretical literature on
this question includes Branco, Sun, and Villas-Boas (2012) and Ke, Shen, and Villas-Boas (2016). A few
papers, such as Mehta, Rajiv, and Srinivasan (2003), Honka and Chintagunta (2016) and Ursu (2018)
consider estimating utility by specifying full search models. We are, as far as we know, the first to provide
formal identification results for preferences for a class of models without the need to commit to a specific
structural search model.8
       An important assumption in our model is that the searched attributes are observable to the econometri-
cian, even if they are not known without searching to consumers. Ericson, Kircher, Spinnewijn, and Starc
(2015) consider the related problem of inferring risk preferences separately from risk types using insurance
choices. Their model differs from ours in that, in the special case they consider, the covariate "risk type"
is not observed by the econometrician either.
       A second related literature attempts to analyze whether consumers make informed choices by comparing
the choices of regular consumers to that of a more informed subgroup. Bronnenberg, Dub´
                                                                                      e, Gentzkow, and
Shapiro (2015) ask whether pharmacists make similar prescription drug choices to consumers, Handel and
Kolstad (2015) ask whether better informed consumers make different health insurance choices, and Johnson
and Rehavi (2016) study whether physicians treat differently when their patients are other physicians. Our
paper can be thought of as a data driven way of isolating a subgroup of consumers who maximize utility
(those who search the good with the highest value of the hidden attribute). Importantly, the subgroup we
identify is not necessarily informed in the sense of searching all available goods. What we know is that
they maximize utility among all options, meaning that their choices can be used to estimate preferences
even though they do not themselves know that they do so, as they cannot verify that they have searched
the good with the highest zj without searching all goods. This insight--that we can recover preferences by

   8
     There is one special case where the problem of imperfect information about attributes has been addressed in the existing
literature. This is the case in which all attributes can be expressed in dollar terms. For example, consumers should not care
whether a health insurance plan saves them $100 in premiums or out of pocket costs (see Abaluck and Gruber (2011)), or
whether a light bulb saves them money in upfront costs or shelf life (as in Allcott and Taubinsky (2015)). If one dollar-
equivalent attribute is assumed to be visible to consumers, it can provide a benchmark for how consumers should respond to
a hidden dollar-equivalent attribute. However, in many cases, attributes cannot easily be translated into dollars without first
estimating consumer preferences. In these cases, our results still allow one to recover preferences given imperfectly informed
consumers.



                                                              6
isolating consumers who maximize utility rather than those who are informed--is what makes possible the
surprising recovery of preferences from choices in cross-sectional data without auxiliary information.
         Section 2 lays out our formal framework and proves our identification results, Section 3 considers several
empirically important extensions such as endogenous attributes, Section 4 provides details of estimation
and simulation results, Section 5 reports results from our experiment, and Section 6 concludes.


2         Model
There are J  2 goods indexed by j = 1, ..., J with attributes xj observed by consumers and the econome-
trician and attribute zj observed by the econometrician but not necessarily by consumers.9 , 10 For simplicity,
we assume that xj is scalar for all j , but the identification argument immediately extends to the case of
vector-valued xj 's. Without loss of generality, we let good 1 be the good with the largest value of zj . Again,
for simplicity, we focus on the case where zj is scalar-valued. If there are multiple hidden attributes for
each good j , call them zkj , the same argument applies with good 1 defined as the good satisfying zk1  zkj
for all j and k .11 Let individual i's utility from alternative j be denoted by Uij (xj , zj ). In what follows, we
often omit the dependence of Uij on (xj , zj ) unless it is necessary to avoid confusion.
         We can always write: Uij = aij (xj ) + bij (xj , zj ) where bij (xj , 0) = 0 (to see this, define bij (xj , zj ) =
Uij (xj , zj ) - Uij (xj , 0)). Since in our setting aij (xj ) is the component of utility that is known to the
consumer before engaging in search, we label it "visible utility," V Uij .
         We make the following assumptions on the utility function.

Assumption 1. (i ) For all i and j , Uij is strictly monotonic in zj .
         (ii ) For all i, the function bij (xj , zj ) is not alternative-specific, i.e. bij (xj , zj ) = bi (xj , zj ) for all j , and
continuous in its first argument.

         The class of utility functions satisfying Assumption 1 is broad and subsumes most specifications com-
monly used in empirical work as special cases, including logit with possibly nonlinear-in-characteristics
utilities12 and mixed-logit. For instance, in a mixed-logit model, one may specify Uij = i xj + i zj +                             ij .

To map this specification into our notation, let aij (xj ) = i xj +                    ij ,     and bi (xj , zj ) = i zj . As another
example, consider the logit specification Uij = xj + zj + xj zj +                        ij .    This is subsumed in our notation
by letting aij (xj ) = xj +           ij ,   and bi (xj , zj ) = zj + xj zj .
         Next, we state the assumptions that characterize the class of search models we consider.

     9
    Our model also permits the more general case where attributes are potentially both good and individual-specific, but we
write xj and zj rather than xij and zij for notational simplicity.
    10
    Since our model only requires variation in x and z for two goods, any of the remaining J - 2 goods may be taken to be
the outside option.
    11
    Note that, while in the scalar zj case a good satisfying our definition of good 1 always exists (we can always rank options
based on their zj 's), this is not true of the vector-valued zj case. In this sense, the argument for the vector-valued zj case
is more demanding of the data. The multiple attributes case also requires that search reveals the value of all attributes
concurrently.
    12
         We allow for nonlinearities subject to Assumption 1(i ) being satisfied.


                                                                     7
Assumption 2. (i ) If consumer i searches a good with visible utility V Uij , she also searches all goods j
with V Uij  V Uij .
   (ii ) Conditional on having utility u                                                         ¯)  0 where
                                       ¯ in hand, consumer i searches j if and only if gij (xj , u
gij is decreasing in u
                     ¯.
   (iii ) Consumers choose the good which maximizes utility among searched goods.
   (iv ) Only the value of zj is unknown to consumers prior to search.

   We discuss these conditions at length in Section 2.5. To briefly clarify, Assumption 2(i ) states that if
you search a good j , you always search all goods with higher visible utility than j . This would be satisfied
if consumers searched in order of visible utility but it is weaker (e.g. consumers might search the second
ranked good in terms of visible utility and then the first, provided they eventually search both). Assumption
2(ii ) states that consumers decide whether or not to search a good based on their utility in hand and the
visible utility of the good they are considering searching. This rules out, for example, a search protocol
whereby one stops searching after discovering a large zj irrespective of utility in hand. We subscript the
function g by i to emphasize that the function may depend on any individual (unobserved) heterogeneity in
utility or search. For example, in a Weitzman search model, the stopping rule would depend on consumer
i's reservation value, which in turn depends on i's search cost. In addition, we subscript the g function by
j to indicate that g is allowed to vary with the identity of the good that is being considered as a candidate
for search. In particular, g could vary with any component of the visible utility of good j (but crucially
and intuitively not with zj ). Further, in a model where consumers pay a cost to search goods, the search
costs may vary across goods (at least provided the visible utility assumption 2(i ) still holds); this is again
captured by the j subscript. Assumption 2(iii ) simply states that consumers must search a good before
choosing it. Assumption 2(iv ) (implicit in the model already) states that the econometrician observes all
the information which is revealed by search.
   We pause here to highlight that Assumption 2 accommodates several commonly used models of search.

Example 1 (Sequential Search). Suppose that utility takes the form Uij = xj i + zj i +                   ij ,   consumers
search sequentially and consumer i must pay a cost ci every time she uncovers the z attribute for a good.
Further, assume that the consumer has the same prior Fz for all goods. Then, following Weitzman (1979),
the consumer will rank goods according to their reservation value rvij defined implicitly by

                                                                       
                                ci =           u - rvij dFUij (u) =         i (t - rvi ) dFz (t)                      (1)
                                        rvij                          rvi


                rvij -i xj -   ij
where rvi             i             and the last steps follows from a change of variable. We can interpret rvi as the
reservation value in units of z . To see this, note that consumer i ranks goods according to the visible utility
xj i +   ij   and for each good j she chooses to uncover zj if and only if the maximum utility secured so far
is lower than xj i + rvi i +           ij   . Once she stops searching, she maximizes utility among the searched goods.
Thus, Assumption 2 is satisfied with gij (xj , u
                                               ¯) = xj i + rvi i +                ij   -u
                                                                                        ¯.



                                                                 8
Example 2 (Directed Cognition Model). Suppose that utility takes the form Uij = xj i + zj i +                                            ij .

Further, as in the model of Gabaix, Laibson, Moloche, and Weinberg (2006), consumers rank goods in
terms of expected utility13 and myopically check whether searching the next good is worth the cost. The
directed cognition model has the same gij function as the Weitzman model,14 but the order of search (and
which goods are ultimately searched) may differ.

Example 3 (Satisficing). Suppose that consumer i searches in order of visible utility and stops whenever
                                                                                       ¯) = i - u
utility in hand is above a threshold i . Then Assumption 2 is satisfied with gij (xj , u        ¯.

Example 4 (Full Information). The full information model is subsumed within the previous example by
letting i =  for all i.

Example 5 (Simultaneous Search). Suppose that utility takes the form Uij = xj i + zj i +                                       ij   and that
consumer i simultaneously searches all goods that have visible utility above a threshold ~i . Then Assumption
2 is satisfied with gij (xj , u
                              ¯) = xj +             ij     -~i .

       Our results will not require the researcher to take a stand on the specific model of search that consumers
follow (provided that our assumptions are met). Therefore, as illustrated by the examples above, the
approach will be agnostic as to whether consumers search sequentially or simultaneously, are forward-
looking or myopic and have biased or unbiased beliefs, among other things.
                                                                                  bi
       Throughout the rest of the paper, we assume that                           zj   > 0, i.e. we treat zj as an attribute that customers
value in good j .15 We are now ready to state and prove a lemma that is at the core of our results.

Lemma 1. Let Assumptions 1 and 2 hold and let xj  [¯
                                                   x - , x
                                                         ¯ +  ] for all j , for some  > 0 sufficiently
small. If consumer i searches good 1 (i.e. the good with the highest value of z ), then i chooses the utility-
maximizing good.

Proof. If good 1 is searched but utility is not maximized, then for some unsearched j , Uij > Ui1 . Since
z1 > zj , by monotonicity, bi (¯
                               x, z1 ) > bi (¯
                                             x, zj ). By continuity of bi in its first argument, this implies that
for  sufficiently small, bi (x1 , z1 )  bi (xj , zj ).16                       Given this, Uij > Ui1 implies V Uij > V Ui1 . But by
Assumption 2(i ), this implies that good j is searched, which is a contradiction.
  13
    Note that we may assume without loss that E (zj ) = 0 for all j since the mean value of the hidden attribute (known by
rational consumers before search) is subsumed by visible utility.
  14
   The result that consumers in the fully rational Weitzman model decide whether to continue searching "as if" they were
myopic is one of the main insights of Weitzman (1979).
  15
    Conditional on Assumption 1(i ), this is without loss, since Assumption 2 implies that an increase in Uij can only induce
                                                                                                                        bi
consumer i to switch from not choosing j to choosing j , but never vice versa. Thus, by the chain rule, the sign of z     j
                                                                                                                            is
                            sj
identified by the sign of   zj
                                 , where sj is the choice probability function for good j from the data.
 16
    More formally, by continuity, for all  > 0 there exists  > 0 such that if |x1 - xj | < 2 , then bi (xj , zj ) - bi (x1 , zj )   .
Therefore, we have:

                                           bi (xj , zj )     =     bi (x1 , zj ) + bi (xj , zj ) - bi (x1 , zj )
                                                                   b i (x 1 , z j ) + 
                                                                   b i (x 1 , z 1 )
                                                             bi (x1 ,z1 )-bi (x1 ,zj )
where the last inequality follows by choosing                            2
                                                                                       .


                                                                                 9
Note that Lemma 1 does not imply that good 1 always maximizes utility if it is searched. Rather, it implies
that if good 1 is searched, the utility-maximizing good will also be searched (whether it is good 1 or not)
and thus the consumer will choose that good. Note that the lemma also does not mean that consumers
searching good 1 are fully informed (in a search model they typically will not be), but just that those
consumers act as if they were fully informed. When utility is linear, the same result holds under weaker
conditions on the variation in x across products.

Lemma 2. Let Uij = xj i + zj i +             ij   and let Assumption 2 hold. If consumer i searches good 1 (i.e. the
good with the highest value of z ), then i chooses the utility-maximizing good.

Proof. If good 1 is searched but utility is not maximized, then for some unsearched j , Uij > Ui1 . Since
z1 > zk for all k = 1, it must be that xj i +            ij   > x1 i +   i1 .   But by Assumption 2(i ), this implies that
good j is searched, which is a contradiction.

Lemmas 1 and 2 will have far-reaching implications. To understand them, it will be convenient to define
the choice probability for good j as:


                                   sj  P          Uij = max Uik for k  Gi          {j  Gi }                                 (2)
                                                         k


where Gi denotes the set of searched goods for individual i. Note that this probability is computed by
integrating over any individual-specific unobserved heterogeneity in utility or search. Therefore, sj is a
function of x  [x1 , · · · , xJ ] and z  [z1 , · · · , zJ ], but we will often omit the dependence from the notation.
Throughout the paper, the sources of unobserved heterogeneity will vary with the specific models we
consider, so the symbol P will denote integrals over different distributions depending on the context.
       Now, Lemmas 1 and 2 imply that z1 only impacts choice probabilities for individuals who maximize
                                      s1
utility. Therefore, looking at        z1   will isolate individuals who maximize utility and allow us to recover
preferences using standard arguments. To formalize this, note that Lemmas 1 and 2 imply we can write:

   s1 = P (Ui1  Uik k ) - P ({Ui1  Uik k }  {for some j = 1, V Uij  V Ui1 and gi1 (x1 , Uij )  0})                          (3)

       In other words, the probability that good 1 is chosen is the probability that good 1 is utility-maximizing
minus the probability that good 1 is not searched even though it is utility-maximizing.17 Failing to search
good 1 requires that there exists some other good j with V Uij  V Ui1 and utility high enough that
gi1 (x1 , Uij )  0.
       Our proof will use the fact that certain derivatives of the choice probability functions are linear in the
preference parameters we hope to recover with known (or recoverable) weights. We consider identification
for three specifications of utility that satisfy Assumption 1:

   1. Cross-sectional data where Uij = v (xj , zj ) +          ij

  17
       This follows because Lemmas 1 and 2 imply that if good 1 chosen (and thus searched), good 1 must maximize utility.



                                                                10
   2. Panel data where Uijt = vi (xjt , zjt ) +        ijt


   3. Cross-sectional data where Uij = xj i + zj i +                ij


   These cases are comparable in generality to existing constructive identification results for preferences in
full information discrete choice models, such as Fox, Kim, Ryan, and Bajari (2012). In each of these cases,
we assume that the unobservables are independent of the product characteristics (x, z). We will extend the
approach to deal with endogenous attributes in Section 3.3.


2.1       Case 1: Cross-sectional data with Uij = v (xj , zj ) +                   ij

We start from the case where utility takes the form Uij = v (xj , zj ) +                  ij   for an unknown function v . In
what follows, we use x and z to denote generic arguments of v and let                    i   [   i1 , . . . , iJ ].


Theorem 1. Let Assumption 2 hold and utility be given by Uij = v (xj , zj ) +                       ij   with v increasing in both
                                                                                2 s1
arguments and infinitely differentiable. Further, assume that                  z1 xj    (x , z )    = 0 for some (x , z ) and
j  = 1, s1 is infinitely differentiable and      i     (x, z). Then, v is identified up to an additive constant.

Proof. See Appendix A.1.

   This theorem applies to a broad class of utility functions. The cost of this level of generality is that it
requires the share function s1 to be infinitely differentiable. However, the marginal rates of substitution
are recovered under much weaker differentiability requirements.

Corollary 1. Let Assumption 2 hold and utility be given by Uij = v (xj , zj ) +                          ij   with v increasing and
differentiable in both arguments. Further, assume that s1 is twice differentiable and                          i    (x, z). Then, the
                                    v             v
marginal rates of substitution,     z   (x, z ) / x   (x, z ), can be recovered using:

                                 2 s1                  2 s1            v                v
                                      ( x, z )              ( x, z ) =   (x, z )          (x, z )                                 (4)
                                z1 zj                 z1 xj            z                x

                            2 s1
for all j = 1 such that    z1 xj   (x, z) = 0.

   We postpone the proof of Theorem 1 to Appendix A.1. Here, we focus on the special case with linear
utility and J = 2 goods to simplify the proof and facilitate intuition. In this case, the preference parameters
can be fully recovered by looking at second derivatives.

Lemma 3. Let utility be given by Uij = xj  + zj  +                  ij   and let Assumption 2 hold. Further, assume that
 2s
z1 x2
      1
          (x , z ) = 0 for some (x , z ), s1 is twice differentiable and          i    (x, z). Then,

                                          2 s1                  2 s1            
                                               (x , z )              (x , z ) =                                                   (5)
                                         z1 z2                 z1 x2            

In addition,  is identified by focusing on markets with zj = z for all j and thus  is also identified.



                                                               11
Proof. First, we prove equation (5). In order to ease notation, we often suppress the subscript i in what
follows. As above, good 1 is defined as the good with the highest value of zj . Further, we let  > 0 without
loss.18 Using Lemma 2, the probability of choosing good 1 can be written as:

                                      s1 = P (U1 > U2 ) - P ({U1 > U2 }  {G = 2})                                                 (6)

where, as above, G denotes the set of searched goods. This follows because (i) if good 1 is utility-maximizing,
you will always choose it unless you search only good 2; and (ii) you only choose good 1 if it is utility-
maximizing, since otherwise, good 2 must have higher visible utility, meaning it must be searched (and
chosen) if good 1 is searched.
           ~j  xj  + zj  , so that Uij = u
       Let u                             ~j +           ij ,   and let (x, z) = (x , z ). Our goal will be to show that both
                               s1                                                 2 s1        2 s1  u
                                                                                                    ~2          2 s1        2 s1  u
                                                                                                                                  ~2
z2 and x2 only impact          z1   via u
                                        ~2 . This, in turn, implies that         z1 z2   =   z1  u
                                                                                                 ~2 z2   and   z1 x2   =       ~2 x2 ,
                                                                                                                           z1  u
and the result in equation (5) follows. To establish this, note that we can write:

 P ({U1 > U2 }  {G = 2}) = P ({U1 > U2 }  {V U2 > V U1 }  {g1 (x1 , U2 )  0})
                                                                                                                                  (7)
                                    = P ({U1 > U2 }  {g1 (x1 , U2 )  0}) - P ({V U1 > V U2 }  {g1 (x1 , U2 )  0})

where the second line follows since V U1 > V U2 implies U1 > U2 and thus P ({V U1 > V U2 }  {g1 (x1 , U2 )  0}) =
P ({U1 > U2 }  {V U1 > V U2 }  {g1 (x1 , U2 )  0}). The second term in equation (7) is not a function of z1 .
The first term is only a function of x2 and z2 via u
                                                   ~2 . This, together with equation (6), is sufficient to show
                                           s1       P (U1 >U2 )       P ({U1 >U2 }{G =2})
that both z2 and x2 only impact            z1   =      z1         -           z1                 ~2 , thus proving equation (5).
                                                                                             via u
       Finally, we show that we can identify  using standard techniques by looking at choice sets where zj = z
for all j . To see this, note that when zj = z for all j then consumers maximize utility if and only if they
maximize visible utility. Since by assumption they always search the good with the highest visible utility,
it follows that they maximize utility. Thus, one can pin down  by looking at how the choice probabilities
vary with x conditional on zj = z for all j , just like in the full information case.19 Given (5) and ,
identification of  follows immediately.

       Finally, we note that in many models of interest the conventional way of identifying preferences based
on the ratio of first derivatives leads to understating consumers' taste for z . For this result, we further
                                   ¯) is weakly increasing in xj .20 For simplicity, consider the model with
assume that the function gij (xj , u

  18
       This is without loss, since the sign of  is immediately identified from the data (footnote 15).
  19
     There is one subtle exception to this argument. Suppose there is an outside option with utility normalized to 0, and we
wish to identify a fixed effect which gives the utility of all inside goods relative to the outside good. In this case, consumers do
not necessarily maximize utility when zj = z for all goods because consumers may decide to search none of the inside goods,
and they may do so even when the outside good has lower utility than some of the inside goods if search costs are sufficiently
high (in other words, an outside option may violate our assumption that consumers must search a good before they choose
it). When consumers search none of the inside goods, it is never possible to separately identify whether consumers do not
value the inside goods or have high search costs to examine any of the inside goods. It is possible to say something about the
utility of consumers who are induced to search at least one of the inside goods when price is low enough (for example), but
parametric assumptions are needed to make claims about the utility of consumers who never search any of the inside goods.
  20
       This condition is satisfied in all the search model considered above (Examples 1­5) when the coefficient on x in utility is



                                                                      12
linear utility Uij = xj  + zj  +        ij   u
                                             ~j +           ij                 ~  (~
                                                                 and  > 0. Let u   u1 , u
                                                                                        ~2 ) and

                        
                       Pj,   ~ , x)  P ({Uj > U-j }  {V U-j > V Uj }  {gij (xj , U-j )  0})
                          2 (u
                        
                       Pj,   ~ , x)  P ({U-j > Uj }  {V Uj > V U-j }  {gi-j (x-j , Uj )  0})
                          3 (u


              (u
For good 1, P1,3 ~ , x) = 0, but this is not necessarily true for other goods. More generally, sj = P (Uj >
          (u
U-j ) - Pj,             ~ , x).
           2 ~ , x) + Pj,3 (u
       Differentiating, we obtain:
                                                                            
            sj       P (Uj > U-j ) Pj,2                                   Pj,3
                  =               -      (u
                                          ~ , x) +                              (u
                                                                                 ~ , x)
            zj           u ~j       u
                                    ~j                                    u~j
                                                                                                              
            sj       P (Uj > U-j ) Pj, 2                                  Pj, 3           1 Pj,2           1 Pj,3
                  =               -      (u
                                          ~ , x) +                               ~ , x) -
                                                                                (u               (u
                                                                                                  ~ , x) +        (u
                                                                                                                   ~ , x)
            xj           u ~j       ~j
                                    u                                     u~j              xj               xj

                            Pj,2                 
                                               Pj,                                                                            
              P (Uj >U-j )                                           sj                     1 Pj,2                         1 Pj,3
Note that         u~j      - u
                             ~j    (u
                                    ~ , x) +   u~j
                                                   3
                                                       (u
                                                        ~ , x) =     ~j
                                                                     u      0.21 Further,    xj       ~ , x)  0 and
                                                                                                     (u                     xj       ~ , x) 
                                                                                                                                    (u
0 due to our assumptions about the function g .22 Therefore,

                                                                    sj
                                                                    zj        
                                                                    sj
                                                                                                                                         (8)
                                                                              
                                                                    xj


2.2       Case 2: Panel data where Uijt = vi (xjt , zjt ) +                       ijt

This case closely parallels the proof in the previous section. Now, rather than observing only sj (x, z), the
choice probabilities for each alternative as a function of the attributes, panel data allows us to observe
sij (x, z), the choice probabilities for each individual as (x, z) vary over a long period of time. Given these,
the following result holds:

Theorem 2. Let Assumption 2 hold and utility be given by Uijt = vi (xjt , zjt ) +                            ijt   with vi increasing in
                                                                                         2 si1
both arguments and infinitely differentiable. Further, assume that                      z1 xj    (x , z )   = 0 for some (x , z ) and
j  = 1, si1 is infinitely differentiable and            i    (x, z). Then, vi is identified up to an additive constant.

Corollary 2. Let Assumption 2 hold and utility be given by Uijt = vi (xjt , zjt ) +                         ijt   with vi increasing and
differentiable in both arguments. Further, assume that si1 is twice differentiable and                             i    (x, z). Then, the

positive and corresponds to the mild requirement that consumers are (weakly) more prone to searching a good the higher the
value of x for that good.
   21
      Increasing uj can only switch consumers from not choosing good j to choosing j but never the reverse. To see this, note
first that conditional on searching any given set of goods, increasing uj increases the probability good j is chosen. Second,
changing uj doesn't change the probability that good j is searched, which depends on gij (xj , U-j ) for each alternative good
which is searched. Third, changing uj never makes other goods more likely to be searched. Specifically, an alternative good k
is searched if and only if gik (xk , Uk )  0 for all goods k currently searched. This quantity is unchanged for k = j and weakly
                                                                                        sj
decreasing for k = j , so no good can become more likely to be searched. Therefore,  u   ~j
                                                                                              0.
  22
       Recall also that we assume  > 0 without loss.




                                                                         13
                                      vi
marginal rates of substitution,       z    (x, z ) / v
                                                     x (x, z ), can be recovered using:
                                                       i




                                 2 si1              2 si1            vi           vi
                                       (x, z)             ( x, z ) =    (x, z )      (x, z )
                                z1 zj              z1 xj             z            x

                           2 si 1
for all j = 1 such that   z1 xj      (x, z) = 0.

   The proofs of these two results exactly parallel the arguments in the previous section.


2.3   Case 3: Cross-sectional data where Uij = xj i + zj i +                         ij

The cases in the previous two sections assume either that we have panel data or that all individual hetero-
geneity is additively separable. Due to the difficulty of separately identifying preferences and search as well
as more practical difficulties with estimation, most empirical structural search models that we are aware
of do not allow for non-separable unobserved heterogeneity (see, e.g., Ursu (2018), Honka, Horta¸
                                                                                                csu, and
Vitorino (2017)).
   Of course, we would like to understand both from a theoretical perspective whether the assumption of
separable heterogeneity is required for identification and from a practical perspective whether our results
are applicable in such cases. The canonical case of non-separable heterogeneity that has been studied in
the literature and for which constructive identification results exist is that of the linear random coefficients
model. We maintain linearity and impose two additional assumptions.

Assumption 3. (i ) Utility is given by Uij = xj i + zj i +              ij .

   (ii ) The coefficients i and i take values on a known finite support, i.e. i  {1 , · · · , K } and i 
 1 , · · · , K   with probabilities given by ~k ,k  P {i = k }  i = k                          . Further, the elements of
 1 , · · · , K   all have the same sign and, without loss, we assume that they are positive.
   (iii ) The distribution of    i   is known (or independently identified) and the three random vectors i , (,  )
and (x, z) are mutually independent.

   Assumption 3(ii ) follows Fox, Kim, Ryan, and Bajari (2011) in assuming that the random coefficients
are supported on a finite and known grid of points. Given the restriction that 1 , · · · , K                 all have the
same sign, assuming that they are positive is without loss (see footnote 15). Assumption 3(iii ) maintains
knowledge of the distribution of all unobservables other than the random coefficients, consistent with recent
papers on identification and estimation of demand (e.g. Fox, Kim, Ryan, and Bajari (2012), Fox, Kim, and
Yang (2016)).

Theorem 3. Let Assumptions 2 and 3 hold. If the market share of good 1 is K K -time differentiable,
then the probability weights ~k ,k for k = 1, · · · , K , k = 1, · · · , K are identified.

Proof. See Appendix A.2.

   As it is clear from the statement of Theorem 3, allowing for heterogeneity across consumers in preferences
for attributes typically requires taking derivatives of order higher than two. Thus, identifying heterogeneous

                                                              14
preferences is more demanding of the data. When the sample size does not allow for direct application
of our result, a natural approach is to impose more structure by specifying a structural search model.
Theorem 3 may then be used to establish nonparametric identification of preferences within the specified
model of search.23


2.4      Alternative Approaches and Support Assumptions

So far we have not focused on the support assumptions required for identification. These are nonethe-
less essential to understand our contribution. Alternative approaches to identification exist which differ
principally in requiring much stronger support assumptions.
      For instance, one could assume that the data exhibits "at-infinity" variation to effectively go back to a
setting that is analogous to full information. As the visible utility for a subset of goods grows to infinity
(minus infinity), the probability of searching those goods goes to one (zero) under reasonable assumptions
on the search process. Using this, one could identify preferences using conventional arguments. However,
in practice, it is often implausible that any goods are searched with probability close to 1, so this strategy
would require substantial parametric extrapolation.
      In contrast, our proof requires much more plausible support assumptions. There is always a good which
maximizes zj when the latter is a scalar. To recover preferences in the homogeneous linear case, we only
need sufficient variation to estimate second derivatives of s1 at a single point. Of course, flexibly recovering
a nonparametric function v or nonparametric random coefficients requires substantially more variation,
requiring that we can estimate many higher order derivatives of choice probabilities. We discuss these
challenges further in Section 4.


2.5      Discussion of Search Model Assumptions

To reiterate, we consider search models satisfying the following assumptions:

  1. If consumer i searches a good with visible utility V Uij , she also searches all goods j with V Uij 
        V Uij .

  2. Conditional on having utility u                                                         ¯)  0 where gij
                                   ¯ in hand, consumer i searches j if and only if gij (xj , u
        is decreasing in u
                         ¯.

  3. Consumers choose the good which maximizes utility among searched goods.

  4. Only the value of zj is unknown prior to search.

As discussed above, a sufficient condition for the first assumption is that consumers search in order of
visible utility. In the Weitzman (1979) search model, consumers search goods in order of reservation utility,
which is a function of the visible attributes of those goods, the distribution of the hidden attribute zj , and
search costs. If zj is i.i.d. across goods and consumers have the same search cost for all goods, then it

 23
      See Section 4.3 for more on this point.


                                                       15
follows that consumers will search in order of visible utility.24 There are three reasons this might fail in the
Weitzman (1979) model: first, there may be more uncertainty about the hidden attribute for some goods
than others, and this might lead individuals to search such goods first. Second, unobservables might be
correlated across goods, and learning good news about good 1 might cause one to positively update about
good 2 and choose to search it before good 3 even if V U3 > V U2 . Third, search costs might vary across
goods, meaning that consumers prefer to search first goods with lower search costs even if the payoff is
potentially lower.
       While the restriction that priors be i.i.d. and search costs be constant across goods is sufficient for
Assumption 2(i ) (the first assumption above), this is not necessary. Priors may be heterogeneous but
consumers may be unsophisticated and fail to take into account option value, as in the directed cognition
model studied in Gabaix, Laibson, Moloche, and Weinberg (2006). Consumers searching for a laptop online
may enter some attributes into a search function and look at the items which rank highly according to
those attributes without regard for whether a lower item is worth searching first because its value is more
uncertain despite its lower average utility. Such examples also raise the natural concern that in many
settings, factors like the order in which items appear in search may impact search costs separately from
visible utility. Applications in the marketing literature often allow search costs to vary with observable
attributes, such as the position of a good in search Ursu (2018). In Section 3.1, we extend our main result
to these cases where some observable attributes impact search but not utility (thus violating the visible
utility assumption stated above). We can also relax the i.i.d. priors assumption by allowing consumers to
form beliefs about the hidden attribute as a function of observed attributes. In Section 3.2, we extend our
approach to the case where beliefs about zj are a linear function of observables.
                                                                                                ¯)  0 where u
       Our second assumption on search is that consumers search good j if and only if gij (xj , u           ¯
is utility in hand; we also impose the natural restriction that one is less likely to search as u
                                                                                                ¯ increases. This
assumption is satisfied in most search models we are aware of in the literature, including Weitzman search,
satisficing, simultaneously searching all goods with visible utility above a threshold, random search, and
directed cognition. One exception is a model in which consumers commit to searching the top k goods in
terms of visible utility prior to engaging in search. This model would violate the assumption because the
function which determines whether you search good j cannot be written only as a function of V Uj since
it will depend on the visible utility of all goods. We investigate the robustness of our approach to this
violation of our assumptions in the simulations of Section 4.25
       Our third assumption, that consumers choose the good which maximizes utility among searched goods,
embeds two separate ideas: the first is that consumers do not choose a good they have not searched, and the
second is that they maximize utility given the information available. To the degree that search can plausibly
be modeled as binary, the first assumption is relatively innocuous. In cases where the hidden attribute is

  24
       See Example 1.
  25
    Contrast this with a model where the decision to search depends only on the highest-utility good encountered so far.
Since gij (xj , Uij )  0 for the highest-utility good implies gij (xj , Uij )  0 for all goods searched so far, such models can be
accommodated by a gij function which depends separately on the utility of each good.



                                                               16
not easily available upon search, binary search may be implausible. For example, if the hidden attribute
is "school-value added," a consumer who searches more may learn about test scores and graduation rates,
but these are signals of the underlying variable. Our model is more suitable for cases where the covariates
included in the model are ones that consumers can observe directly given search. The assumption that
consumers maximize utility given the information available can also be relaxed. One could specify a positive
utility function that allows for consumer errors; as long as consumers maximize that positive utility function,
the weight that they would attach to the hidden attribute given full information will be revealed. It is
then up to the researcher whether to take this weight as the normative benchmark or whether to use some
external standard.
       The fourth assumption, that only the value of zj is unknown prior to search, is more demanding. A
consumer who clicks through to the product information page of an Amazon product might learn informa-
tion about the attributes of a good ("the battery is compatible with USB-c"), but they also might learn
information not observable to the econometrician ("one reviewer said the battery exploded into flames").
Our model does not accommodate cases where search reveals information not available to the econometri-
cian. To the degree that this is a concern, one should try to code all information that may be revealed to
the consumer upon search as attributes in the model. The viability of this strategy will of course vary from
case to case.


2.6      Testing Search Model Assumptions with and without Observable Search

Our proof so far has proceeded as if search were not observed; that is, we observe final choices as a function
of x and z but we do not observe which specific goods were searched. Datasets increasingly contain some
information on what is searched: for example, in online clickstream data, one observes not only which
product was purchased, but also which products were clicked on en route to purchase (e.g. Ursu (2018)).
In many settings, it is plausible to assume that such clicks reveal which products were searched.
       Can preferences be identified without resorting to our approach or an explicit search model in these
cases? One might naively assume that our identification results would be unnecessary in such cases; given
data on which products were searched, perhaps preferences can be estimated conditional on search without
resorting to the assumptions we require here.
       This is not generally the case because the unobservable component of utility may also drive the search
decision. One example would be if search depends on . In such cases, goods with undesirable observables
that are searched likely have an especially high realization of . Thus, it will appear from conditional choice
probabilities as though the observable attributes are not so bad when in practice, individuals dislike those
attributes but this dislike is offset by a large . A second reason unobservable components of utility might
impact search is if preferences are unobservably heterogeneous (random coefficients). Even if search does
not depend on , preferences cannot generally be recovered using only conditional choices unless IIA is
satisfied.26
  26
    To see why heterogeneous preferences create a problem, imagine products have quality ratings from 1-5. There are two
types of consumers, one type that cares about quality and one type that does not. The type that cares about quality is


                                                          17
    Thus, with heterogeneous preferences, the existing literature requires specifying a search model in order
to estimate preferences even when search is observed. Our approach avoids the need to do this under the
assumptions we have outlined. Once our approach is used to identify preferences, clickstream data can be
used to conduct additional overidentifying tests if we assume that the distribution of                    ij   is known. In the
linear case, visible utility is given by V Uij = xj i +             ij .   As shown in Lemma 3, examining choices with
equal values of the hidden attribute is sufficient to identify the distribution of i . Given i , the known
distribution of    ij ,   and the number of goods searched |Gi |, we can thus compute:

                              P (j  Gi |x, z) =        P (|Gi | = k |x, z)P (j  Gi ||Gi | = k, x, z)                          (9)
                                                   k

since the first probability on the RHS is observed and the second is pinned down by the model assumptions
(specifically, the fact that with k goods searched, those k goods must be the k goods with the highest
visible utility). Checking (9) against the observed search probabilities provides a test of the model.
    Even when we do not observe auxiliary information on which goods are searched, the assumptions in
our model can be jointly tested by checking whether the observed choice probabilities are consistent with
bounds implied by the estimated preferences and assumed search rule.
    To construct an upper-bound on choice probabilities, note that a good j cannot be chosen if there is
an alternative good with higher visible utility and higher utility. Thus, we have:

                               sj (x, z)  1 - P (Uik  Uij and V Uik  V Uij for some k )                                      (10)

The latter probability can be directly computed from knowledge of preferences and the distribution of .
    To construct a lower-bound, note that the probability of choosing good j is at least as large as the
probability that good j maximizes both utility and visible utility. That is:

                                  sj (x, z)  P (Uij  Uik and V Uij  V Uik for all k )                                        (11)

Once again, this probability can be computed given knowledge of preferences and the distribution of . We
can then check whether our estimated choice probabilities are consistent with these bounds.
    Finally, our model is overidentified. For example, in the case of linear utility and homogeneous prefer-
                                   2 s1    2 s1
ences, we have shown that         z1 zj / z1 xj   = / for all alternative goods j = 1 and values of (x, z). This
provides a number of overidentifying restrictions which could be used to further test the model.

indifferent about quality over the 4-5 range, but values quality over the 1-4 range sufficiently that quality differences outweigh
any other differences observable to consumers. Suppose that quality is observable to consumers (x) but price is only observed
conditional on search (z ). Quality conscious consumers only search goods with quality of at least 4. Other consumers will
search all goods. If we estimate preferences conditional on search, we will wrongly conclude that no one cares about quality:
quality conscious consumers don't care about quality given the goods they have searched (quality ranging from 4-5) and non-
quality conscious consumers don't care about quality at all. To estimate preferences correctly, we would have to jointly model
the decision of which goods to search and preferences conditional on searching.




                                                               18
2.7   Testing for Full Information

In the homogeneous preferences case of Section 2.1, our results suggest a natural test for full information.
Under the null hypothesis of full information, sj = P (Uj  Uk k ) and therefore:

                                    2 s1    2 s1   sk sk   v v
                                         /       =   /   =  /                                                  (12)
                                   z1 zj z1 xj     zk xk   z x

for all j = 1 and all k, k . On the contrary, when consumers are unaware of zj for some goods, then the
ratios of first derivatives need not be equal to the ratios of the second derivatives. For example, equation
                  s1 s1         2 s1    2 s1
(8) showed that   z1 / x1      z1 zj / z1 xj   in the class of search models we consider. Since both the ratios of
first derivatives and the ratios of second derivatives in (12) are estimable from the data, this immediately
leads to a test based on the discrepancy between the two sets of ratios. More specifically, given estimators
of the share functions, one can compute a Wald test-statistic based on the discrepancy between the two
sets of ratios and reject the null hypothesis of full information if the statistic exceeds a critical value.
    Note that this test is valid even if our assumptions on the search process fail to hold since with full
information the two sets of ratios will be equal regardless. When our assumptions on the search process
do hold, we expect the test to have power, since the first derivative ratio will be attenuated relative to the
true preferences, which are recovered by the cross-derivative ratio.


3     Extensions
In this section, we consider three extensions to the baseline model: the first two relax the visible utility
assumption, while the third deals with the case of endogenous attributes.


3.1   Allowing for variables affecting search but not utility

One important case in which the visible utility assumption 2(i ) is likely to fail is when factors exist which
impact search costs but not utility. An example might be search position for online purchases. Arguably,
search position impacts the order in which people search but has no direct impact on utility conditional on
searching (Ursu 2018). In this case, consumers might first search items with higher search position even if
they do not have higher visible utility. For example, if we randomly assign search order, this is likely to
impact choices even though we are not changing the utility of each item conditional on search.
    Our model from Section 2.1 can be extended to deal with cases where the factors which impact search
but not utility are observable and the sign of their impact on search probabilities is known (such as position
in search). Denote the variable which perturbs search but not utility by rj , suppose that rj is observed and
that higher values of rj make a good weakly more likely to be searched. Now, rather than assuming that
goods are searched based on V Uij alone, we assume that goods are searched based on m(V Uij , rj ) where
m is strictly increasing in both V Uij and rj .
    We formalize this, together with two additional restrictions, in the following assumption.



                                                          19
Assumption 4. (i ) If consumer i searches j , then i also searches all j s.t. m V Uij , rj                m (V Uij , rj ),
where m is strictly increasing in both arguments;
   (ii ) There is at least one good j = 1 such that rj > r1 ;
   (iii ) The support of (x, z) (r1 , . . . , rJ ) has positive Lebesgue measure for all (r1 , . . . , rJ ).

   Assumption 4(iii ) is substantive: for identification purposes, we consider variation in product charac-
teristics holding fixed product search position. In practice, search position is likely to vary as a function of
observables (e.g. products are sorted in order of price). However, because of the discrete nature of search
position, we are likely to see variation conditional on search position and this is the variation we will use
to identify our model.
   Violations of the visible utility assumption due to search position will cause Lemma 1 to no longer hold
as stated: the good with the highest value of zj can be searched, another good j may have higher utility
(and thus higher visible utility), but good j may not be searched because it has lower search position.
However, an extension of Lemma 1 will still hold in this case, which then allows us to prove identification
of preferences.

Lemma 4. Let Assumptions 1, 2(ii)-2(iv), and 4 hold and let xj  [¯
                                                                 x - , x
                                                                       ¯ +  ] for all j , for some  > 0
sufficiently small. Then, if consumer i searches good 1 (i.e. the good with the highest value of z ), then i
chooses the good which maximizes utility among all goods with rj  r1 .

Proof. Suppose there was a good j with rj  r1 and Uij > Ui1 that consumer i does not search. We can
follow the proof of Lemma 1 to show that V Uij > V Ui1 . By Assumption 4(i ), this implies that good j is
searched, which is a contradiction.

   In other words, if higher search position only makes a good more likely to be searched, then goods with
higher visible utility and higher search position will always be searched if good 1 is searched. Given this
Lemma, we can apply a modification of the identification argument in Theorem 1 after conditioning on
the subset of goods with higher search position than good 1 (defined as usual as the good with the largest
value of zj ). We state the result here and prove it in the Appendix.

Theorem 4. Let the assumptions of Lemma 4 hold and let utility be given by Uij = v (xj , zj ) +                     ij   with
                                                                                                 2 s1
v increasing in both arguments and infinitely differentiable. Further, assume that              z1 xj    (x , z )   = 0 for
some (x , z ) and j  = 1, s1 is infinitely differentiable and           i    (x, z). Then, v is identified up to an
additive constant.

Proof. See Appendix A.3.


3.2   Allowing for consumers' expectations on z to depend on x

Another reason why the visible utility assumption 2(i ) might fail is that consumers could form expectations
about z based on x. For instance, if x is price and z is quality, consumers might infer that more expensive
products tend to be higher quality. As a consequence, if they value quality to a sufficient degree relative to

                                                           20
price, they may search a high-priced product and not search a low-priced product even if the former has a
lower visible utility than the latter.
       In our proofs so far, we have assumed that consumers do not update about zj given xj . We now show
that we can identify preferences given consumer beliefs about zj given xj in a linear model. Further, under
additional assumptions, we will show that we can identify /, the relative value of the hidden attribute,
even when beliefs are unknown. In other words, we can do so without taking a stand on whether consumers
have rational expectations and form beliefs based on the empirical relationship between zj and xj or naively
update.
       Consider the linear model Uij = xj  + zj  +           ij   and re-write it as

                                 Uij   = xj  + (zj - E (zj |xj ))  + E (zj |xj )  +           ij

                                       = 0 + xj ( + 1 ) + z
                                                          ~j  +                ij


where the second equality assumes that consumers use the linear projection E (zj |xj ) = 0 + 1 xj and we
    ~j  zj - E (zj |xj ). Visible utility is then given by 0 + xj ( + 1 ) +
let z                                                                                              ij   and consumers learn the
deviation from their expectation on zj , z
                                         ~j , upon searching. For the moment, we assume that 1 is known
to the researcher. Note that 0 is not identified, but also does not generally impact choices since it enters
utility as an additive constant.27 Given 1 , we can identify the ranking of goods in terms of z
                                                                                              ~ and we label
good 1 as the good with the largest value of z
                                             ~. Then, an argument analogous to that in Lemma 3 yields
                        28
identification of   +1 .       We can also recover  + 1 in a manner that parallels our usual identification of
 (Lemma 3). When z
                 ~j = z
                      ~ for all j , consumers who search based on our visible utility assumption always
maximize utility, and thus we can directly estimate  + 1 as the coefficient on xj for those consumers (we
provide a formal proof in Appendix A.4.1). Therefore, this gives separate identification of  and  given
1 .
       When 1 is unknown, we can identify / if we know its sign and make a further support assumption.
Suppose that the sign of 1 is known (e.g. higher priced goods have weakly higher quality). Without loss,
we assume 1 > 0. In addition, suppose that there exist choice sets in which a good has both the highest
value of z and the lowest value of x. Even when 1 is unknown, this good is known to maximize z
                                                                                             ~; thus,
we can label it by 1. Note that we cannot differentiate with respect to z
                                                                        ~ as in the case above since 1 and
thus z
     ~ is unknown. However, with good 1 defined appropriately, Corollary 1 shows that cross-derivatives
with respect to z1 , zj , xj for j = 1 identify / (specifically, consumers who search the good with the
highest value of z
                 ~ will always maximize utility, and so their sensitivity to xj and zj identifies their true
preferences). The quantity / is not sufficient to simulate choices with full information, since we cannot

  27
     There is one exception to the above claim, which is the case when there is an outside option for which the x and z attributes
are not defined, so that a systematic bias in beliefs about the distribution of zj given xj would change the relative value of
all the inside goods relative to that outside option. This might mean that the relative utility of the outside option cannot
be separately identified from 0 ; the model could still be estimated, but the normative interpretation of fixed effects might
change.
  28                                        
    In Lemma 3, we showed identification of  by taking derivatives of s1 w.r.t. z1 , z2 , x2 . Similarly, here we obtain identifi-
           
cation of +1 by taking derivatives of s1 wrt z
                                             ~1 , z
                                                  ~2 , x2 .


                                                                  21
tell how responsive consumers would be to xj were choices fully-informed. However, it is sufficient to
identify the relative value placed on the hidden attribute as well as to conduct tests for full information as
in Section 2.7.


3.3         Endogenous attributes

So far, we have assumed that the observed product attributes are independent of all unobservables. This
is restrictive, especially in settings in which product attributes -- notably price -- are chosen by firms
who might know more about consumer preferences relative to what is captured by the observed data. As
highlighted by a large literature (e.g. Berry, Levinsohn, and Pakes (1995)), this typically leads to correlation
between the attributes chosen by firms and product-level unobservables.
          Here we consider an extension of our model that allows for endogenous product attributes. We specify
the utility that consumer i gets from good j as

                                          Uij = xj + i zj + i pj + j +           ij                                          (13)

where pj denotes the endogenous characteristic and j is a product-specific characteristic that is known
by consumers before search, but is not observed by the researcher.29 If firms also know j when choosing
pj , then the two will typically be correlated, thus leading to endogeneity of pj . We consider both the case
where pj is part of visible utility and that in which consumers need to search good j to uncover pj (as well
as possibly other non-endogenous attributes zj ). If pj is price, the first scenario corresponds to settings
such as e-commerce where typically price is visible on the results page and does not require any further
clicking by the user. On the other hand, the second scenario covers cases in which price is itself the object
of consumer search (there is a large literature on this, particularly in relation to the often observed price
dispersion for relatively homogeneous goods; see, e.g., Stahl (1989), Hong and Shum (2006) and Horta¸
                                                                                                    csu
and Syverson (2004)). In what follows, we will show identification of preferences for each of these two cases.
          To this end, we introduce two mutually exclusive variants of assumption 2(ii ). Let j = xj + j for all
j.

Assumption 5. (i ) The attribute pj is part of the visible utility of good j . Conditional on having utility
u                                                             ¯)  0 where gij is decreasing in u
¯ in hand, consumer i searches j if and only if gij (j , pj , u                                ¯.
          (ii ) The attribute pj is uncovered by consumers only upon searching good j . Conditional on having
utility u                                                        ¯)  0 where gij is decreasing in u
        ¯ in hand, consumer i searches j if and only if gij (j , u                                ¯.

          Like Assumption 2(ii ), Assumption 5 states that consumers decide whether to search good j based on

     29
    Note that the utility specification in (13) allows for random coefficients on both zj and pj , but not on xj . This is stronger
than needed, since the identification argument below only requires that xj and j enter the demand functions via a linear
index. Thus, another possible specification is

                                          Uij = ~ i (xj + j ) + i zj + i pj +    ij


The latter is weaker, but also less common in the discrete choice literature, so we focus on model (13) in what follows.



                                                                22
utility in hand and the visible utility of j . Letting  = (1 , · · · , J ), we may write the share of good j as

                                                     sj = j (, z, p)                                                       (14)

for some function j . Repeating this for all j and stacking the equations, we obtain a demand system of
the form

                                                      s =  (, z, p)                                                        (15)

                                                                                                    J
where s = (s1 , · · · , sJ ). We also define the share of the outside option as s0  1 -             j =1 sj ,   with associated
function 0 (, z, p). We establish nonparametric identification of this demand system by invoking results
from Berry and Haile (2014) (henceforth, BH).30 Specifically, the results in BH yield identification of (j )J
                                                                                                            j =1
for every unit (individual or market) in the population. This means that all the arguments of  are known,
which immediately implies (nonparametric) identification of  itself. Once  is identified, one may apply
our results in Section 2.3 to identify the distribution of the preference parameters , i and i . Note that,
while knowledge of  is sufficient for several counterfactuals of interest (e.g. computing equilibrium prices
after a potential merger or tax), the preference parameters are required to predict how choices and welfare
would change if consumers were given full information, among other things. In this sense, our approach
complements the identification results in BH within the class of search models we consider.
       To prove identification of  , we first note that model (14) satisfies the index restriction in BH's As-
sumption 1. Second, we assume that we have excluded instruments w which, together with the exogenous
attributes, satisfy the following mean-independence restriction

                                              E (j |x, z, w) = 0 for all j                                                 (16)

almost surely (Assumption 3 in BH) and assume that the instruments shift the endogenous variables
(market shares and endogenous attributes p) to a sufficient degree (as in BH's Assumption 4). Finally, we
verify that the demand system satisfies the "connected substitutes" restriction defined in BH's Assumption
2. To this end, we prove the following result.

Lemma 5. Let utility be given by (13) with             i   supported on RJ and let Assumptions 2(i), 2(iii), 2(iv), and
either 5(i) or 5(ii) hold. Then, for all j, k = 1, · · · , J with j = k , j is (i) strictly increasing in j and (ii)
strictly decreasing in k .

Proof. See Appendix A.5 for the proof.

       Lemma 5 implies that the goods are connected substitutes in  (see Definition 1 in BH), which in turn
allows us to prove identification of  by invoking Theorem 1 in BH.31 Since Lemma 5 holds under either

  30
       See also Berry, Gandhi, and Haile (2013).
  31
       Note that the proof of Theorem 1 in BH only uses the fact that goods are connected substitutes in  , not in -p.



                                                                23
Assumption 5(i ) or 5(ii ), we obtain identification of preferences both in the case where pj is part of the
visible utility of good j and in the case where pj is only uncovered upon searching j . Moreover, Theorem
1 of BH implies that one can invert the demand system  for the indices  and write

                                                           -1
                                                  xj + j = j  (s, z, p)                                                    (17)

for all j . Equations (17) and (16) naturally lead to a nonparametric instrumental variable approach to
         -1
estimate j  (and thus j ).32


4         Estimation
Our identification result shows that preferences can be recovered given knowledge of the choice probability
function for good 1, denoted by s1 (x, z). To this end, note that the model implies the following conditional
moment restrictions

                                          E (yj - sj (x, z) |x, z) = 0          j                                          (18)

where yj is a dummy variable equal to 1 if a consumer chooses good j .33
         Thus, methods designed to estimate conditional moment restriction models can be used. Of course, the
performance of an estimator will depend on how flexibly it captures the derivatives that identify preferences
in our approach.
         Here, we consider two approaches to estimating s1 (x, z): (i) an approximation via Bernstein polynomials
which is viable when the number of goods and attributes is small; and (ii) a "flexible logit" model which
is more ad hoc, but scales better as the number of goods increases.
         Throughout this section, we focus on the linear homogeneous case of Uij = xj  + zj  +              ij .   Our result in
                                                              2s       2s
Section 2.1 shows that / can be recovered from               z1 zj / z1 xj
                                                                   1        1
                                                                                for j = 1. As discussed in Section 2.3, the
model with linear, homogeneous preferences is the current standard in the empirical literature on search.
         In more general non-linear or random coefficients models, our identification arguments require recovery
of higher-order derivatives and thus might not directly translate into viable estimation strategies in small
to medium sample sizes or with a large number of goods. In these cases, the best way forward might be to
parametrically specify a full structural search model and estimate it via standard methods, e.g. MLE. We
would then view our identification results as providing reassurance that preferences are indeed identified,
something that had not been previously established in the literature (see Section 4.3 and Appendix A.7 for
more on this). Additionally, given the estimated structural search model, if it satisfies the visible utility
assumption, the tests in Section 2.6 could be used to check consistency with the data.

    32                                         -1
    Compiani (2019) proposes to approximate j      using Bernstein polynomials. We use a similar approach in Section 4 to
estimate the demand function for the case without endogeneity.
    33
    Here, we focus on the case where data on individual-level choices are available, as in the experiment of Section 5. However,
our identification approach could also be applied to aggregate (i.e. market share) data as long as one can consistently estimate
the share functions sj .


                                                              24
4.1       Approximation via Bernstein polynomials

Following Compiani (2019), one can approximate the demand function via Bernstein polynomials. This
allows the researcher to impose natural restrictions on the demand functions via linear (and thus easy-to-
enforce) constraints on the coefficients to be estimated. Specifically, we impose monotonicity in x and z
(sj increasing in xj and zj and decreasing in x-j and z-j ) as well as exchangeability across goods.34 The
purpose of these restrictions is twofold. First, they discipline the estimation routine in the sense that they
help obtain reasonable estimates of quantities of interest (e.g. negative price elasticities). Second, they help
partially alleviate the curse of dimensionality that arises as the number of goods increases. We estimate
the Bernstein coefficients by minimizing a quadratic form based on the restrictions in (18) subject to the
constraints.35


Simulation Results To test the performance of our approach, we consider several simulations. In all
simulations, we generate N = 20, 000 choices with utility given by:

                                                  Uij = xij + zij +          ij                                     (19)

with  =  = 1, xij i.i.d N (0, 1), zij i.i.d. N (0, 1), and            ij   i.i.d. Type 1 extreme value.
       We simulate data from four data generating processes, three of which satisfy the assumptions of our
theorem and one of which does not. These are:

   1. Weitzman search, with search costs c  LogN ormal(-2, 2.25)

   2. Satisficing, searching in order of visible utility until utility-in-hand is at least T  LogN ormal(-0.35, 2.25)

   3. Search all goods with visible utility above a threshold given by c  N (-1, 16) (if no goods are above
         the threshold, search and choose the good with the highest visible utility)

   4. Randomly search k  {1, . . . , J } goods, where the searched goods are the k highest in terms of visible
         utility

DGPs 1-3 satisfy our assumptions. By contrast, DGP 4 violates Assumption 2(ii ) because the decision of
whether to search a good does not just depend on that good's visible utility, but on the visible utilities of
all goods.
       Table 1 reports results from the Bernstein approximation of the cross-derivative ratio which identifies
                                                           sj /zj
/. For comparison, we also report estimates of             sj /xj ,   which would recover / with full information. In
all cases, the estimates based on first-derivatives are attenuated relative to the true values. This occurs for
the reason discussed in Section 2.1: consumer insensitivity to variation in z for goods that are not searched
biases the coefficients towards zero. In contrast, the confidence intervals from Bernstein estimation of the

  34
     See Compiani (2019) for a formal definition of exchangeability. In words, a demand system is exchangeable if it only
depends on the attributes of the goods (in our case xj and zj ), but not their identity.
  35
       Compiani (2019) provides more details on the implementation of the estimator.


                                                              25
cross-derivative ratio include the true values in DGPs 1-3, and are fairly precise for the J = 3 case. For
DGP 4, where the assumptions of our model do not hold, the coefficient is attenuated for J = 3, although
the point estimates remain much closer to the true values the first-derivative estimates.

                                             Table 1: Bernstein Approximation

                                                              Number of Goods
                                              2                                                   3
             DGP        First-Derivatives         Cross-Derivatives       First-Derivatives           Cross-Derivatives
              1               0.610                     0.977                   0.403                       0.997
                             (0.024)                   (0.304)                 (0.012)                     (0.076)
                  2           0.691                     1.280                   0.361                       0.935
                             (0.024)                   (0.538)                 (0.014)                     (0.068)
                  3           0.527                     0.870                   0.330                       0.872
                             (0.021)                   (0.190)                 (0.010)                     (0.071)
                  4           0.444                     0.801                   0.206                       0.626
                             (0.018)                   (0.301)                 (0.010)                     (0.075)
                  Note: Across all rows, the data the sample size is N = 20, 000 and the data in
                  each row is generated by the corresponding DGP described in the main text. In all
                  cases, the true value is 1 and standard errors are in parentheses.



4.2    "Flexible Logit"

With a large number of goods, nonparametric methods face a curse of dimensionality, and thus it be-
comes necessary to place some parametric structure on the problem. In this section, we develop one such
parametric approximation which performs well in simulations for a relatively large number of goods.
    To motivate our parametric approach to estimating s1 (x, z), note that full-information logit models
typically impose strong restrictions on the structure of the derivatives of choice probabilities. Specifically,
          +
if uij = vj            and                                        is a differentiable function of x and z , then for
                                  is i.i.d. extreme value where vj
                  ij         ij                                                                    j     j

qj  {xj , zj }:

                                                                      
                                                  sj         sj vj   vj
                                                        =      q   =    sj (1 - sj )
                                                  qj         vj  j   qj
                                                                        
                                                 sj          sj vj     vj
                                                        =      q   = -    sj sj
                                                 qj          vj  j     qj
                                                                 v 
                                             2 sj              vj  j
                                                        = -          sj sj (1 - 2sj )                                          (20)
                                            zj qj              qj zj
                                                                                                        
                                                                                                       vj    v 
                                                                2 s1       2
                                                                          s1           s1     s1
for j = j . Thus, in a conventional logit model,               z1 zj   / z 1 x
                                                                                   =   zj   / x  =     zj   / xj for all j = 1, and
                                                                               j              j                j
                                                        
                                                       vj
                         s1 s1              vj
this further equals      z1 / x1     when   qj    =    qj   for all j, j . We would like to estimate a model of s1 which
is sufficiently flexible that ratios of first-derivatives differ from ratios of second cross-derivatives, as will
generally occur if consumers engage in search. To allow for this additional flexibility, we let the utility for

                                                                  26
good 1 depend directly on attributes of rival goods as follows:

              v1 = v
                   ~(x1 , z1 ) + b1 z1 +          (k wz 1k zk + 2k wx1k xk + wz 2k k zk z1 + wx2k 2k xk z1 )                  (21)
                                            k=1


where v
      ~(x, z ) is a differentiable function of x and z , wz 1k , wx1k , wz 2k and wx2k are known weights, and b1 ,
k , 2k , k and 2k are coefficients to be estimated. Further, we let vk = v
                                                                         ~(xk , zk ) for k = 1. In Appendix
A.6, we describe one way of choosing the weights which we find works well in simulations, and for which the
ratio of second derivatives (which recovers /) is a particularly convenient function of model parameters.
We note that the parameters in (21) do not have the usual interpretation (i.e. we are not positing that the
actual utility of good 1 depends on the attributes of good k for k = 1). Instead, (21) is simply a flexible
function of (x, z) that captures the second derivatives of s1 well.

Simulation Results           For each of the DGPs described in Section 4.1, we consider simulations with J 
{2, 3, 5, 10}. Additionally, we report estimates from the flexible logit model as well as the naive logit model.
We bootstrap the standard errors using 250 repetitions.
   Results from these simulations are reported in Table 2. The table shows estimates of / from a
conditional logit model with no adjustment for imperfect information, as well as the cross-derivative ratio
estimates from the flexible logit model. In the naive logit model, the coefficient is attenuated, typically
biased towards zero by 30-50%. The flexible logit model performs substantially better, with 95% confidence
intervals including the true estimates in DGPs 1-3. Perhaps surprisingly, the flexible logit model also
performs well for DGP 4; the confidence intervals include the true values for 2 and 5 goods, and have less
bias than the naive logit model for 5 and 10 goods.

               Table 2: Estimator based on cross-derivatives ratio (flexible logit) vs naive logit

                                                              Number of Goods
                             2                            3                         5                         10
        DGP        Naive         Flexible     Naive           Flexible    Naive         Flexible    Naive          Flexible
         1         0.6590         1.0214      0.6330           1.0671     0.6050         0.9633     0.5770          0.8986
                  (0.0158)       (0.1208)    (0.0122)         (0.1259)   (0.0095)       (0.1254)   (0.0089)        (0.1053)
          2        0.7403         0.9976      0.6194           1.0854     0.4587         1.0407     0.2909          1.0004
                  (0.0162)       (0.1034)    (0.0135)         (0.1300)   (0.0102)       (0.1578)   (0.0083)        (0.2603)
          3        0.5424         1.1177      0.5945           1.0286     0.6543         0.9017     0.7246          0.8822
                  (0.0149)       (0.1716)    (0.0117)         (0.1469)   (0.0099)       (0.1071)   (0.0106)        (0.0733)
          4        0.4543         1.1358      0.5568           0.9614     0.6691         0.8015     0.7887          0.8151
                  (0.0140)       (0.1906)    (0.0118)         (0.1659)   (0.0105)       (0.1012)   (0.0104)        (0.0679)
          Note: Across all rows, the data the sample size is N = 20, 000 and the data in each
          row is generated by the corresponding DGP described in the main text. "Naive" refers
          to estimates of / from a conventional logit model, and "Flexible" refers to estimates
          from the flexible logit model. In all cases, the true value is 1 and standard errors are in
          parentheses.


                                                                  27
4.3   When Should You Estimate a Search Model?

Our results can be used to identify preferences under the assumptions we outline without estimating a
full search model. In this section, we discuss for which counterfactuals preference estimation is sufficient.
Additionally, we discuss how our results can be used to aid in estimation of search costs given a fully
specified search model or for specification testing after such a search model is estimated.
   One important class of counterfactuals asks: how would consumers choose if search costs were reduced?
For intermediate values of search costs, this question would require an explicit search model. On the other
hand, in many cases, we want to know how consumers would choose with zero search costs. This question
can be answered given knowledge of preferences and available choice sets without a search model. Given
the implied choice probabilities, we can also evaluate the benefits of perfect information via better choices
by comparing full information choices with status quo choices.
   A full normative evaluation of an information intervention would also directly include search costs:
information may benefit consumers both by helping them make better choices and by helping them make
choices more easily, and search costs quantify the value of making choices more easily. Structural search
models can aid in identification of these search costs. Of course, this exercise is intrinsically challenging
because such structural estimates are often sensitive to the specific assumptions made about the search
process. Back of the envelope estimates of search costs based on survey data or other information on the
time consumers spend choosing may be more credible than structural estimates.
   Nonetheless, if search costs are of interest either to conduct counterfactuals with intermediate levels of
search costs or for normative purposes, our model can be used to identify search costs given preferences
and an underlying structural search model. In Appendix A.7, we give an explicit example of how search
costs can be recovered in a Weitzman model once preferences are known. Intuitively, when preferences are
known, we know how consumers would respond to the hidden attribute with zero search costs, and thus
we can trace out the distribution of search costs from the observed responsiveness of choice probabilities
to the hidden attribute.
   A final reason to estimate a full structural search model is to impose plausible parametric restrictions on
the data necessary for estimation in finite samples. Our identification proof shows that, in principle, these
parametric restrictions are unnecessary for identification. Our simulations suggest that in realistic samples,
our results can be used to directly recover preferences in models with linear utility and homogeneous
preferences over observables. However, estimation of the higher-order derivatives of choice probabilities
necessary to nonparametrically identify the distribution of random coefficients may not be possible given
the data available. In such cases, a natural approach is to specify a structural search model with random
coefficients in order to place some parametric structure on these higher-order derivatives. This requires
taking an explicit stand on the underlying search model. Nonetheless, once the model has been estimated
and preferences recovered, the results in Section 2.6 can be used to conduct specification tests for the
internal consistency of our estimates. If these tests reject, an alternative search model may fit the data
better.



                                                     28
5         Experimental Validation
Our identification proof and simulation results show that preferences can be estimated regardless of whether
consumers are fully informed, provided the underlying model is a search model satisfying the stated as-
sumptions. Of course, the theorem does not tell us whether those assumptions are likely to be satisfied in
practice.
         In this section, we test in a lab experiment whether we can recover preferences in a setting where
consumers engage in costly search. Unlike in our simulations, the search protocol is unknown to us and
not restricted to satisfy the assumptions of our model. We nonetheless show that we are able to correctly
recover preferences using our "search-robust" estimation technique.


5.1        Set-up

We selected 1,000 books for sale on Amazon Kindle chosen from a wide variety of genres. For each book,
we observe its average rating on the site "Goodreads.com" as well as the average rating from Amazon.com,
the number of reviews on Goodreads, and the price of the book for Amazon Kindle.
         In our experiment, conducted via Mechanical Turk, each participant made 40 choices from sets of 3
randomly selected books. For all books, participants could see a photo of the cover, the title, author and
genre, as well as the Goodreads rating and the number of ratings. Prices were randomized to integers from
$11-$15 (equally likely). All books were then further discounted by an integer amount from $0-$10 (equally
likely). All users were given a $25.00 bank at the start of each choice, from which any costs incurred were
deducted. There were a total of 93 participants, yielding 3,720 choices.
         The discount is our key variable of interest. For 10 of the 40 choices, users could see all discounts and
thus could see the net price of all options at no cost. For 30 of the 40 choices, discounts were hidden and
users had to pay a cost to see the discount for any given book.36 The cost per click was constant for each
user across the 30 choices, and randomly chosen from {$0.10, $0.25, $0.35, $0.50}. For the 30 choices with
hidden information, users could only choose books after they clicked to reveal the discount and had to
choose at least one book. One of the 40 choices made by each user was randomly chosen to be realized,
and users received the chosen book as well as any money left over from the original $25.00.
         Figure 1 shows a sample product selection screen from a choice where discounts were hidden. In this
case, the user clicked to reveal the discount of the second book and could either choose that book or
continue by revealing the discounts for additional books. Note that the user could search books in any
order she wished.
         The 10 choices where all information is revealed are our benchmark for the "truth". The goal is then
to test whether the relative weight on discounts and prices that we estimate in the cases where discounts
are costly to observe matches the relative weight we see when discounts are visible to everyone. Further,
because both discounts and prices are in dollar terms, and because they are randomized (and so not signals

    36
    The full information and costly information choice situations were randomly ordered, so that the 10 "full information"
choices were intermixed with the costly information choices.


                                                           29
                       Figure 1: Lab Experiment: Sample Product Selection Screen




of quality), there is a second benchmark: if consumers are rational, the weight on discounts and prices
should be equal.
   In other words, we will model choices using:

                              Uij = price ·  - discount ·  + rating · 2 +    ij                         (22)

Fully informed and rational consumers should have  =  . Our goal will be to show that we can recover
these fully informed preferences using the choices of beneficiaries for whom revealing discounts is costly.


5.2   Estimation Results

Columns 1 and 2 of Table 3 show results from estimating a conditional logit model on consumer choices
for the 10 choice situations (per consumer) where all information is revealed (Full Info) and the 30 choice
situations where consumers must pay to reveal information (Costly Info). With full information, consumers
place equal weight on prices and (negative) discounts, so they pass our test of rationality. In other words,
they care only about the final price of the product. By contrast, when discounts are costly to reveal, the
coefficient on the discount variable is attenuated. This is because consumers are insensitive to variation in
discounts for books whose prices they do not reveal. The ratio of the two coefficients is 0.974 in the full
information treatment and 0.682 in the costly information treatment.
   Following Section 4.1, we estimate the demand function s1 (x, z) via Bernstein polynomials. The main
                                                2
                                                 si 1  2
result of this procedure is an estimate of Ej [ z     /  si1 ] = / where the expectation averages over all
                                                  1 zj z1 xj




                                                     30
                   Table 3: Conditional Logit and Cross-Derivative Estimation Results

                    Variable              Full Info   Costly Info   Cross-Derivative Ratio
                      Price               -0.386***    -0.302***                -
                                            (0.038)      (0.018)
                   Discount (-)           -0.376***    -0.206***                -
                                            (0.020)      (0.009)
                      Rating               0.591***     0.421***                -
                                            (0.190)      (0.099)
               Discount (-) / Price        0.986***     0.683***             1.032***
                                            (0.093)      (0.044)              (0.102)
                        N                    930          2790                 2790


              Note: tables show estimation results from a conditional logit model estimated
              on the full information and costly information treatments in columns 1 and 2,
              and estimation of the cross-derivative ratio based on Bernstein polynomials in
              column 3. The minus sign indicates that discount multiplied by -1 so that the
              coefficient on discount should equal that of price with full information. Stan-
              dard errors on the ratio of the discount and price coefficients are computed us-
              ing 250 bootstrap draws. denotes significance at the 1% level,  at 5% level,
              and  at 10%.

goods other than good 1. This estimate is given by 1.032 (0.102). In other words, using data only on
choices when information is costly, we successfully recover informed preferences. The confidence interval is
sufficiently tight to exclude the logit estimates in the costly information treatment.
   As in most real-world settings, visible utility is not observable to the econometrician: while we can see
attributes of the goods in question, we do not know how individuals will weigh these attributes, nor do we
know their preferences for specific genres or book titles and images. The assumption that consumers search
according to the visible utility assumption is substantive and could be violated in numerous ways: users
might always reveal discounts for the lowest priced book first or they might search in the order in which
books are displayed. Nonetheless, our "robust" estimation approach succeeds in recovering the preferences
consumers reveal with full information.
   As discussed in Section 2.6, while the visible utility assumption cannot be verified directly, it can be
tested indirectly. One such test is to compute bounds on the choice probabilities for each set of observables
consistent with the visible utility assumption. We operationalize this test as follows: first, we estimate ,
the coefficient on price, using a conditional logit model, but using only choices from beneficiaries who face
little variation in discounts (we use the first quartile of the variance of the discount variable within each
choice set). Second, given , we use our estimates of / based on the Bernstein approximation to recover
 . Third, we assume that       ij   are i.i.d. type I extreme value. Given these assumptions, we can compute
the upper and lower bounds described in Section 2.6 for each individual via simulation. We sort the data
by the lower bound, bin the data into 100 quantiles, and graph in each quantile the mean of the upper and


                                                        31
lower bounds, as well as the choice probabilities estimated via Bernstein polynomials.
    Figure 2 shows the results of this exercise. We can see that the bounds in the experimental data have
some bite: the range between the lower bound and the upper bound ranges from 15 to 30 percentage points.
The estimated choice probabilities in nearly all cases lie within this range. These probabilities thus appear
broadly consistent with the visible utility assumption.

        Figure 2: Choice Probabilities, Upper and Lower Bounds from Visible Utility Assumption




6    Conclusion
We prove that it is possible to estimate preferences using only data on attributes and choices in cross-
sectional data even when consumers must search to acquire information about product attributes. This
result holds in a broad class of search models: those in which consumers search according to the "visible
utility" assumption and in which the searched attribute is visible to the econometrician even if unknown
to consumers.
    The functions of choice probabilities which identify preferences in our model are "robust" in the sense
that they work in both full information and search models. For example, in the case of homogeneous
preferences, if the ratio of cross-derivatives does not agree with the ratio of first derivatives, one can reject
the full information model as misspecified even if the assumptions we make about search do not hold. If
those further conditions hold, the ratio of cross-derivatives will recover preferences while the ratio of first
derivatives will not. The comparison between the two gives a (powered) test of full-information.
    Because our conditions allow preferences to be recovered when consumers are imperfectly informed, our
results allow a wide range of inquiries that are impossible using conventional methods. Prior to conducting


                                                       32
an information intervention, choice data can be used to estimate counterfactually how consumers would
choose were they fully informed. If preferences are not informed, the preferences consumers would have if
they were informed can be used to conduct a more defensible welfare analyses.
   Preferences can (sometimes) be identified in structural search models, but such models require making
many explicit assumptions about how consumers search. Do consumers consider option value or are they
myopic? Do they solve an optimal stopping problem or search until they find a good enough option? Is
search sequential or simultaneous? If search costs vary across consumers, what is their statistical distri-
bution? Our approach attempts to avoid these complexities by instead relying on a sufficient condition
satisfied in a broad class of search models that can be falsified by the available data via bounds on choice
probabilities and overidentification tests.
   Of course, our assumptions are not guaranteed to hold and must be assessed on a case by case basis.
However, it is important to keep in mind the alternatives. If the choice is between the visible utility
assumption and the assumption that consumers are fully informed, the former may be closer to correct
even if neither is exactly satisfied. Likewise, if the true search process is unknown and the choice is between
the visible utility assumption and many untested structural assumptions about search, visible utility may
be more parsimonious and leads to clear, testable predictions.
   Our assumptions are sufficient for identification but not necessary. This raises several questions for
future research: can our methods be extended to recover preferences when consumers do not search in
order of visible utility? Likewise, can preferences be recovered if there is an " in the box": in other words,
if search reveals both attributes observable to the econometrician and observable only to consumers?
   Increasingly, empirical analyses relax the assumption that consumers make informed choices. Typically,
behavioral welfare analysis is done using auxiliary data, restrictions on preferences, or by testing whether
consumers choose differently when provided with information. Despite this, absent data to the contrary,
the default assumption in most economic analysis remains that consumers make informed choices. Our
result suggests this need not be the case. Even with no auxiliary data, researchers can use observed choices
both to test whether choices are informed and to recover what preferences would be were consumers more
informed. This removes the (often compelling) excuse that while consumers may not be informed, assuming
informed choices is the only constructive way to proceed given the data available.




                                                      33
References
 Abaluck, J. and A. Adams (2017). What do consumers consider before they choose? identification from
    asymmetric demand responses. Technical report, National Bureau of Economic Research.

 Abaluck, J. and J. Gruber (2011). Choice inconsistencies among the elderly: evidence from plan choice
    in the medicare part d program. The American economic review 101 (4), 1180­1210.

 Allcott, H. and C. Knittel (2019). Are consumers poorly informed about fuel economy? evidence from
    two experiments. American Economic Journal: Economic Policy 11 (1), 1­37.

 Allcott, H., B. Lockwood, and D. Taubinsky (2019). Regressive sin taxes, with an application to the
    optimal soda tax. Technical report, National Bureau of Economic Research.

 Allcott, H. and D. Taubinsky (2015). Evaluating behaviorally motivated policy: Experimental evidence
    from the lightbulb market. American Economic Review 105 (8), 2501­38.

 Armstrong, M. (2017). Ordered consumer search. Journal of the European Economic Association 15 (5),
    989­1024.

 Berry, S., A. Gandhi, and P. Haile (2013). Connected substitutes and invertibility of demand. Econo-
    metrica 81, 2087­2111.

 Berry, S., J. Levinsohn, and A. Pakes (1995). Automobile prices in market equilibrium. Econometrica:
    Journal of the Econometric Society , 841­890.

 Berry, S. T. and P. A. Haile (2009). Nonparametric identification of multinomial choice demand models
    with heterogeneous consumers. Technical report, National Bureau of Economic Research.

 Berry, S. T. and P. A. Haile (2014). Identification in differentiated products markets using market level
    data. Econometrica 82 (5), 1749­1797.

 Branco, F., M. Sun, and J. M. Villas-Boas (2012). Optimal search for product information. Management
    Science 58 (11), 2037­2056.

 Bronnenberg, B. J., J.-P. Dub´
                              e, M. Gentzkow, and J. M. Shapiro (2015). Do pharmacists buy bayer?
    informed shoppers and the brand premium. The Quarterly Journal of Economics 130 (4), 1669­1726.

 Choi, M., A. Y. Dai, and K. Kim (2018). Consumer search and price competition. Econometrica 86 (4),
    1257­1281.

 Compiani, G. (2019). Market counterfactuals and the specification of multi-product demand: a nonpara-
    metric approach. Working Paper .

 Conlon, C. T. and J. H. Mortimer (2013). Demand estimation under incomplete product availability.
    American Economic Journal: Microeconomics 5 (4), 1­30.

 Ericson, K. M., P. Kircher, J. Spinnewijn, and A. Starc (2015). Inferring risk perceptions and prefer-
    ences using choice from insurance menus: theory and evidence. Technical report, National Bureau of
    Economic Research.

                                                    34
Fox, J. T. and A. Gandhi (2016). Nonparametric identification and estimation of random coefficients in
   multinomial choice models. The RAND Journal of Economics 47 (1), 118­139.

Fox, J. T., K. i. Kim, S. P. Ryan, and P. Bajari (2011). A simple estimator for the distribution of random
   coefficients. Quantitative Economics 2, 381­418.

Fox, J. T., K. i. Kim, S. P. Ryan, and P. Bajari (2012). The random coefficients logit model is identified.
   Journal of Econometrics 166 (2), 204­212.

Fox, J. T., K. i. Kim, and C. Yang (2016). A simple nonparametric approach to estimating the distribution
   of random coefficients in structural models. Journal of Econometrics 195 (2), 236­254.

Gabaix, X., D. Laibson, G. Moloche, and S. Weinberg (2006). Costly information acquisition: Experi-
   mental analysis of a boundedly rational model. American Economic Review 96 (4), 1043­1068.

Gaynor, M., C. Propper, and S. Seiler (2016). Free to choose? reform, choice, and consideration sets in
   the english national health service. American Economic Review .

Goeree, M. S. (2008). Limited information and advertising in the us personal computer industry. Econo-
   metrica 76 (5), 1017­1074.

Gul, F. and W. Pesendorfer (2008). The case for mindless economics. The foundations of positive and
   normative economics: A handbook 1, 3­42.

Handel, B. R. and J. T. Kolstad (2015). Health insurance for "humans": Information frictions, plan
   choice, and consumer welfare. The American Economic Review 105 (8), 2449­2500.

Hastings, J. S. and J. M. Weinstein (2008). Information, school choice, and academic achievement:
   Evidence from two experiments. The Quarterly journal of economics 123 (4), 1373­1414.

Hong, H. and M. Shum (2006). Using price distributions to estimate search costs. RAND Journal of
   Economics 37 (2), 257­275.

Honka, E. and P. Chintagunta (2016). Simultaneous or sequential? search strategies in the us auto
   insurance industry. Marketing Science 36 (1), 21­42.

Honka, E., A. Horta¸
                   csu, and M. A. Vitorino (2017). Advertising, consumer awareness, and choice: Evi-
   dence from the us banking industry. RAND Journal of Economics 48 (3), 611­646.

Horta¸
     csu, A. and C. Syverson (2004). Product differentiation, search costs, and competition in the mutual
   fund industry: a case study of s&p 500 index funds. Quarterly Journal of Economics 119 (2), 403­456.

Jindal, P. and A. Aribarg (2018). The value of price beliefs in consumer search.

Johnson, E. M. and M. M. Rehavi (2016). Physicians treating physicians: Information and incentives in
   childbirth. American Economic Journal: Economic Policy 8 (1), 115­41.

Ke, T. T., Z.-J. M. Shen, and J. M. Villas-Boas (2016). Search for information on multiple products.
   Management Science 62 (12), 3576­3603.




                                                   35
Manski, C. F. (2002). Identification of decision rules in experiments on simple games of proposal and
   response. European Economic Review 46 (4-5), 880­891.

Manzini, P. and M. Mariotti (2014). Stochastic choice and consideration sets. Econometrica 82 (3), 1153­
   1176.

Mehta, N., S. Rajiv, and K. Srinivasan (2003). Price uncertainty and consumer search: A structural
   model of consideration set formation. Marketing science 22 (1), 58­84.

Roberts, J. H. and J. M. Lattin (1991). Development and testing of a model of consideration set com-
   position. Journal of Marketing Research , 429­440.

Schwartz, B., A. Ward, J. Monterosso, S. Lyubomirsky, K. White, and D. R. Lehman (2002). Maximizing
   versus satisficing: Happiness is a matter of choice. Journal of personality and social psychology 83 (5),
   1178.

Stahl, D. (1989). Oligopolistic pricing with sequential consumer search. American Economic Re-
   view 79 (4), 700­712.

Ursu, R. M. (2018). The power of rankings: Quantifying the effect of rankings on online consumer search
   and purchase decisions. Marketing Science 37 (4), 530­552.

Weitzman, M. L. (1979). Optimal search for the best alternative. Econometrica: Journal of the Econo-
   metric Society , 641­654.

Woodward, S. E. and R. E. Hall (2012). Diagnosing consumer confusion and sub-optimal shopping effort:
   Theory and mortgage-market evidence. American Economic Review 102 (7), 3249­76.




                                                   36
Appendix A: Additional Proofs
In this appendix, we collect the proofs not included in the main text. Throughout, we let J  {1, . . . , J }
                                            f
and use the notational convention           x0
                                                 (x) = f (x) x for any function f .


A.1     Proof of Theorem 1

We let 2 = j  and (0, 0) = (x , z ) for notational convenience (the proof is unchanged for other values of
j  and (x , z )).
    We show that the derivatives of the share functions identify the derivatives of v at a point and thus the
entire function up to a constant. Fix any (x, z ) in the domain of v and consider a Taylor expansion of v
around the point (0,0):

                                            v0    v0           1     n v0    ¯ n-n
                        v (x, z ) = v0 +       x+    z + ... +      ¯ xn-n
                                                                            zn x ¯ + ...                               (23)
                                            x     z            n! z n     ¯

                               n v0            nv
where v0  v (0, 0) and    z n ¯ xn-n ¯        ¯ xn-n
                                            z n    ¯    (0, 0) for all n  1, n  n. To recover v (x, z ), it is sufficient to
                             n v0
recover all derivatives     ¯ xn-n
                          z n       ¯.   First, we map this into the notation of Assumption 1 as follows:

                                    Uij = v (xj , 0) +        ij   + v (xj , zj ) - v (xj , 0)
                                                   ai (xj )                  b(xj ,zj )


Note that we can directly recover v (x, 0) by the following argument. When z = 0, b(x, 0) = 0 which
means that consumers who search the highest visible utility good (which is guaranteed by Assumption
2(i )) maximize utility and we can identify v (x, 0), a function of x only, using standard techniques. By
differentiating v (x, 0) and evaluating at x = 0, we can recover all of the terms that contain no z 's, i.e.
nv
xn (0, 0).
    To recover derivatives of v with respect to z , we will use Lemma 1. Specifically, we will take xj 
                                                                                                       s1
 x - , x
[¯     ¯ +  ] for all j , where x
                                ¯ and  are defined in Lemma 1, and use the fact that                   z1   can be written
as a function of terms which only depend on x2 and z2 via U2 . To formalize this, we let J1  {2, . . . , J },
                                                                           0 = v (x , 0) and v0 = v 0 , . . . , v 0 . Then,
vj  v (xj , zj ) for all j , and v  (v1 , . . . , vJ ). Similarly, we let vj       j               1             J
by (3) we can write for all (x, z) with z1  zj for all j :

        s1 = P (U1  Uk k ) -                      P ({U1  Uk k }  {V Uj  V U1 for at least one j  S}
                                    SJ1 ,S =

               {g1 (x1 , Uj )  0 for all j  S}  {g1 (x1 , Uj )  0 for all j  J1 \S})                                   (24)
                                          S
               P4 (v) -                  P5 v, v0 , x1
                            SJ1 ,S =




                                                                     37
Further, for every S  J1 , S = , we have

 S
P5 = P ({U1  Uk k }  {g1 (x1 , Uj )  0 for all j  S}  {g1 (x1 , Uj )  0 for all j  J1 \S}) -
       P ({U1  Uk k }  {V U1  V Uj for all j  S}
         {g1 (x1 , Uj )  0 for all j  S}  {g1 (x1 , Uj )  0 for all j  J1 \S})
    = P ({U1  Uk k }  {g1 (x1 , Uj )  0 for all j  S}  {g1 (x1 , Uj )  0 for all j  J1 \S}) -
       P ({V U1  V Uj for all j  S}  {g1 (x1 , Uj )  0 for all j  S}  {g1 (x1 , Uj )  0 for all j  J1 \S})
      S               S          0
     P5,1 (v, x1 ) - P5,2 v-1 , v , x1


where v-1  (v2 , . . . , vJ ). The first equality follows from basic set algebra while the second follows from
the fact that for all j  S and all k  J1 \S , (i) V U1  V Uj implies U1  Uj since z1  zj for all j  J1 ;
and (ii) g1 (x1 , Uk )  0  g1 (x1 , Uj ) implies Uk  Uj , which (together with the implication in (i)) implies
U1  Uk . Thus the event U1  Uk k  J1 is implied by the other events inside the probability and can be
dropped.
              S does not depend on z . Thus, omitting the function arguments, we have
   Note that P5,2                   1

                                                                        S
                                                                       P5
                                      s1          P4 v1                  ,1 v1
                                              =         -                                                   (25)
                                      z1          v1 z1                v1 z1
                                                            SJ1 ,S =


Differentiating again with respect to z2 gives:

                                                                               S
                                                                            2 P5
                             2 s1              2 P4 v1 v2                        ,1 v1 v2
                                        =                 -                                                 (26)
                            z1 z2             v1 v2 z1 z2                  v1 v2 z1 z2
                                                                SJ1 ,S =


Differentiating equation (25) with respect to x2 gives:

                                                                               S
                                                                            2 P5
                            2 s1               2 P4 v1 v2                       ,1 v1 v2
                                        =                 -                                                 (27)
                           z1 x2              v1 v2 z1 x2                  v1 v2 z1 x2
                                                                SJ1 ,S =


Combining (26) and (27), we obtain

                                                                     v2
                                                2 s1    2 s1         z2
                                                     /           =   v2
                                                                                                            (28)
                                               z1 z2 z1 x2           x2

                                                         2 s1
Since this equation holds for all (x, z) such that      z1 x2   = 0 and we already showed that we can recover
v                                 v
x (0, 0),   we can also recover   z (0, 0).
   Next, note that, fixing zk = 0 for all k = 1, . . . , J and xj = 0 for all j = 2 in (25), we can write

                                                  s1
                                                     = k (l(x2 ))                                           (29)
                                                  z1




                                                          38
where
                                                                                                                                   
                                                                                       S
                                                                                      P5
                 v       P4                                                             ,1
   k (v2 ) : v2     (0)     (v (0), v2 , v (0) , . . . , v (0)) -                          (v (0) , v2 , v (0) , . . . , v (0) , 0)
                 z1      v1                                                           v1
                                                                          SJ1 ,S =

                                                                                                  n s1
and l (x2 ) : x2  v (x2 , 0). So by the chain rule we have that, for n > 1,                     z1 x2n-1   is a linear function of
the (n - 1)-th derivative of k with slope depending on the first derivative of l and intercept depending on
derivatives of l and derivatives of k of order strictly less than n - 1. Further, by the above, all derivatives
of l are known. Thus, we have a system of equations that can be uniquely solved for the derivatives of k
by recursion.37
                                    s1
      Next, we differentiate        z1   once with respect to z2 and n - 2 times with respect to x2 . Similar to the
above, we can write

                                                       s1
                                                          = k (v (x2 , z2 ))                                                      (30)
                                                       z1

                                                                                                                             n s1
where now note that z2 is no longer fixed at 0. Again by the chain rule we have that, for n  3,                          z1 z2 xn   -2
                                                                                                                                  2
                                                       n-1 v
evaluated at (0, 0) is a linear function of           z2 xn -2 (0, 0)   with slope coefficient depending on k (v (0, 0)) and
                                                          2
intercept depending on lower-order derivatives of v as well as derivatives of k .38 Because all derivatives of
                                                                                     n-1 v
k are known by the argument above, we can iteratively solve for                     z2 xn -2 (0, 0)   for all n  3.
                                                                                        2
      The remaining terms in the Taylor expansion can be recovered by an analogous argument. Specifically,
for any n  3, m  2, by differentiating (30) m times wrt z2 and again n - m - 1 times wrt x2 , one can write
      n s1                                             n-1 v
    m xn-m-1
z1 z2
                    as a linear function of        z2m xn-m-1 (0, 0) with known, nonzero slope              and known intercept.
         2                                               2
                                                               n-1 v
This system can then be solved             iteratively for z m  n-m-1 (0, 0) for all n > m  2.
                                                             2 x2
      Therefore, we know all the coefficients in the Taylor-expansion of v (x, z ) except the constant v (0, 0),
i.e. we can recover v (x, z ) up to a constant.


A.2       Proof of Theorem 3

Note that the analog of equation (24) in the random coefficients model holds for any given value of  and
 > 0, so that we can write:
                                                                                                        
                           K    K
                                                                         S
                  s1 =                P6 (v (k , k )) -                 P7 v (k , k ) , v0 (k ) , x1  ~k ,k                       (31)
                          k =1 k =1                         SJ1 ,S =

 37
      Here, we use the fact that, by assumption, the first derivative of l is nonzero.
 38                2 s1
      Note that   z1 x2
                          (0, 0) = k (v (0, 0)) l (0), so we have k (v (0, 0)) = 0 by assumption.




                                                                   39
                                                                                                 0 (k )  x  ,
where vj (k , k )  xj k + zj k , v (k , k )  (v1 (k , k ) , . . . , vJ (k , k )), and similarly vj        j k

v0 (k )  v1
          0 (k ) , . . . , v 0 (k ) . Differentiating (31), we have, for all integers n  n
                            J                                                            ~  0:

                      K     K       1+n P6 (v (k , k )) -                   S       v (k , k ) , v0 (k ) , x1 ; k , k
   1+n s1                                                         SJ1 ,S = P7
    ~ xn-n
    n      ~
             =                                                             ~ xn-n
                                                                           n    ~
                                                                                                                              ~k ,k (32)
z1 z2    2     k
                                                                       z1 z2  2
                       =1   k =1


Next, we evaluate (32) at a value of (x, z) such that xj = x
                                                           ¯ and zj = z
                                                                      ¯j for all j . Note that at such (x, z),
P6 no longer depends on k , k . Using this and letting x ¯=z ¯ = 0 for notational convenience (the proof is
unchanged for any other values), we may re-write (32) as

                                    K    K                             K   K                                        S
   1+n s1              1+n P6                   n-n~ n
                                                     ~ +1                         n-n
                                                                                    ~ n
                                                                                      ~ +1                     1+n P7 0, 0, 0; k , k
    ~ xn-n
    n      ~
             =              n (0)               k   k     ~k ,k   -               k   k    ~k ,k
                                                                                                                             n
z1 z2    2
                      v1 v2                                                             
                                                                                                                      v1 v2
                                    k =1 k =1                         k =1 k =1                    SJ1 ,S =
                                                                                                                                                (33)
                                                                                                              K
                                                                                                                    [ak,n,n
                                                                                                                          ~ + bk,n,n
                                                                                                                                   ~ fk,n ] k
                                                                                                              k=1


                                                                                                    1+n P6    n-n~ n
                                                                                                                   ~ +1
                                                                        ~ 
where we let K  K K and let k represent the double index (k , k ), ak,n,n                          v1 v2 n (0)k
                                                                                                                
                                                                                                                  k 
                                                                                                                        , bk,n,n
                                                                                                                               ~     
                                                           S 0,0,0;
                                                      1+n P7
n-n
  ~ n
    ~ +1                                                            k ,k
k
    k
         are known scalars, and fk,n                            n
                                                            v1 v2              and k  ~k ,k are unknown scalars.
      Setting n = K - 1 and stacking the equations corresponding to n
                                                                    ~ = 0, . . . , K - 1, we get

                                                     q = A + B (f   )

where q is a known column K -vector, A, B are known K -by-K matrices, and f   denotes the column
vector given by the element-by-element product of f = (f1,K -1 , . . . , fK,K -1 ) and   (1 , . . . , K ) . We
re-write this system of equations in a way that highlights which objects depend on z  (z1 , . . . , zJ ) as
follows

                                           q (z = 0) = A + B (f (z = 0)   )

Note that A depends on z only through z1 - zj (i.e. it exhibits a lack of nominal illusion property) and we
leave that dependence implicit. Now consider increasing zj by z for all j relative to the baseline z = 0.
Then we can write

                                         q (z = z) = A + B (f (z = z)   )

Combining the last two systems, we get

                             q (z = z) - q (z = 0) = B [(f (z = z) - f (z = 0))   ]

If B is full rank,39 we obtain identification of (f (z = z) - f (z = 0))   . Also, note that, for all k ,

 39
      Note that this condition is immediately verifiable since the points in the support of  and  are chosen by the researcher.


                                                                  40
             fk,K -1 (z=z)-fk,K -1 (z=0)
limz 0                    z              is the     directional derivative of fk,K -1 in the direction 1 = (1, . . . , 1) and
                        J   fk,K -1
thus is    equal to j =1 zj (z = 0) if              fk,K -1 is differentiable. Therefore, we can write
                                                                                                   
                                                                                J
                                   q (z = z) - q (z = 0)                              f
                               lim                               = B                     (z = 0)   
                               z 0         z                                          zj
                                                                               j =1


                                                                                      J    f
Because the lhs is identified, this shows that we can identify                        j =1 zj   (z = 0)   .
       Next, for j  J , we can take another derivative wrt zj in (33) and write

                                                                       f
                                      q(j ) (z = 0) = A(j )  + B(j )      ( z = 0)                                        (34)
                                                                       zj

for known K -by-K matrices A(j ) , B(j ) and a known column K -vector q(j ) (z = 0). Note that B(j ) = B
for all j  J and so we can write
                                                                                              
                           J                         J                     J
                                                                                 f
                                 q(j ) (z = 0) =           A(j )   + B              (z = 0)                               (35)
                                                                                 zj
                          j =1                      j =1                  j =1


                      J    f                                                                                          J
From above,           j =1 zj    (z = 0)   is identified. This implies that  is identified if the matrix              j =1 A(j )
is invertible.40


A.3        Proof of Theorem 4 (when Observables Impact Search but not Utility)

Note that if good 1 doesn't maximize utility in R, good 1 will never be chosen. If some other good in R
has higher utility, it has higher visible utility and will be searched before good 1. Then, by Lemma 4, we
can write for all (x, z) with z1  zj and all j :

s1 = P (U1  Uk k  R) -                         P ({U1  Uk k  R}  {m(V Uj , rj )  m(V U1 , r1 ) for at least one j  S}
                                    SJ1 ,S =

         {g1 (x1 , Uj )  0 for all j  S}  {g1 (x1 , Uj )  0 for all j  J1 \S})                                                     (36)
                                       S        0
         P4new (v) -                  P5new v, v , x1 , r
                          SJ1 ,S =

  40
       Again, this condition is immediately verifiable given the support points for  and  chosen by the researcher.




                                                                 41
where v and v0 are defined as in the proof of Theorem 1 (Appendix A.1) and r  (r1 , . . . , rJ ). Further, for
every S  J1 , S = , we have
 S
P5 new = P ({U1  Uk k  R}  {g1 (x1 , Uj )  0 for all j  S}  {g1 (x1 , Uj )  0 for all j  J1 \S}) -

           P ({U1  Uk k  R}  {m(V U1 , r1 )  m(V Uj , rj ) for all j  S}
             {g1 (x1 , Uj )  0 for all j  S}  {g1 (x1 , Uj )  0 for all j  J1 \S})
        = P ({U1  Uk k  R}  {g1 (x1 , Uj )  0 for all j  S}  {g1 (x1 , Uj )  0 for all j  J1 \S}) -
           P ({m(V U1 , r1 )  m(V Uj , rj ) for all j  S}  {g1 (x1 , Uj )  0 for all j  S}  {g1 (x1 , Uj )  0 for all j  J1 \S})
          S                     S             0
         P5new,1 (v, x1 , r) - P5new,2 v-1 , v , x1 , r


where v-1  (v2 , . . . , vJ ). This argument exactly parallels the argument in Appendix A.1, except now we
have additionally used the fact that U1  Uj for all j  R, since (i) if j  S , then m(V U1 , r1 )  m(V Uj , rj )
implies V U1  V Uj , which in turn implies U1  Uj ; (ii) if j / S , then g1 (x1 , Uj )  0  g1 (x1 , Uk ) for all
                                 S
k  S implies Uj  Uk . Note that P5                                 S
                                  new,2 does not depend on z1 and P5new,1 (v, x1 , r) only depends on xj
and zj via vj for j = 1, so the remainder of the argument in Appendix A.1 applies.


A.4      Identification of a model where consumers form expectations on zj based on xj

A.4.1      Identification of  + 1

Note that if z
             ~j = 0 for all j , then consumers always maximize utility. Thus, seeing how choice probabilities
change with x conditional on z
                             ~j = 0 for all j should help identify  + 1 . Because the event z
                                                                                            ~j = 0 involves
xj , we need to differentiate choice probabilities with respect to xj on the envelope satisfying the condition
~j = 0 for all xj . Formally, fix any j  J and choose (xk , zk ) so that zk = 0 + 1 xk (which implies z
z                                                                                                     ~k = 0)
for all k = j . For every  > 0, let ( )  0 + (xj +  ) 1 - zj , so that zj + ( ) - E (zj |xj +  ) = 0. Note
that ( ) is known to the econometrician. Denoting by x-j = (xk )k=j and similarly for z-j , we have

           sj (xj + , x-j , zj + ( ), z-j ) - s (x, z)
                                                                                                                       (37)
                                
           P ((xj +  ) ( + 1 ) + ij  xk ( + 1 ) +                 ik k )   - P (xj ( + 1 ) +   ij     xk ( + 1 ) +    ik k )
    =
                                                                     
   0       
  -
  - -
              P (xj ( + 1 ) +         ij    xk ( + 1 ) +     ik   k )                                                  (38)
           xj

where the first equality follows from the fact that all consumers always maximize utility at the chosen
values of (x, z). Now note that (i) the expression in (37) is known for all  > 0; and (ii) at x = 0, the term
in (38) factors into ( + 1 ) and a term that only depends the distribution of                   i.    Thus, evaluating the
last display at x = 0 yields identification of ( + 1 ) under a parametric assumption on                    i.


A.5      Proof of Lemma 5 which shows identification with endogeneity

First, assume that pj is part of the visible utility of good j and Fix (j , pj , zj ) for all j . To prove claim (i),
we show that an increase in j can only induce a consumer to switch from not choosing j to choosing j but


                                                            42
never vice versa, and that a positive mass of consumers will switch to choosing j . To see this, consider the
case where consumer i initially searches j , which happens if and only if gij (j , pj , Uik )  0 for all k such
that V Uik  V Uij . Let   0 be the change in j . Since gij is increasing in its first argument, we have
gij (j + , pj , Uik )  0 for all k such that V Uik  V Uij +  and thus i will still search j . Moreover, since
gij is decreasing in its last argument, if gik (k , pk , Uij )  0 for some k such that V Uik  V Uij (i.e. if k
is initially not searched), then gik (k , pk , Uij + )  0 (i.e. k is also not searched after the change in j ),
which means that the set of goods searched by i never becomes larger. Next, note that if Uij  Uik for all
k in the set of searched goods Gi , then Uij +   Uik for all k  Gi . Further, since              i   is supported on all of
RJ , there is a positive mass of consumers for which Uik  Uij for some k  Gi , but Uij +   Uik for all
k  Gi . An analogous argument proves claim (ii).
   Since the argument above does not rely on the fact that pj is part of the visible utility of good j , the
conclusion also holds for the case in which pj is only uncovered upon searching good j .


A.6    Derivation of Flexible Logit Weights and Choice Probabilities

In this section, we derive the relevant derivatives of choice probabilities for the flexible logit model described
in the text. In this model:

            v1 = v
                 ~(x1 , z1 ) + b1 z1 +         (k wz 1k zk + 2k wx1k xk + wz 2k k zk z1 + wx2k 2k xk z1 )              (39)
                                         k=1


and vk = v
         ~(xk , zk ) for k = 1 where b1 , k , 2k , k and 2k are coefficients to be estimated which allow
greater flexibility in how derivatives with respect to z1 vary with attributes of rival goods. The weights
                                                                                           2 s1    2 s1
wx1k , wz 1k , wx2k and wz 2k are chosen so that, given the logit functional form,        z1 zj / z1 xj     can be constant
across goods as our structural model implies when these weights are regarded as constant in derivatives.
With these weights, we have the following derivatives (where we use the notation v
                                                                                 ~j to refer to the function




                                                              43
v
~ evaluated at (xj , zj ):

                v1           v
                             ~1
                        =       + b1 +                (wz 2k k zk + wx2k 2k xk )
                z1           z
                                              k=1
               s1            s1 v1   v ~1
                        =          =      s1 (1 - s1 )
               x1            v1 x1    x
               s1            s1 v1   v1
                        =          =      s1 (1 - s1 )
               z1            v1 z1   z1
               s1            s1 vij     s1 vi1         v
                                                       ~j
                        =            +             =-     s1 sj + [wx1j 2j + wx2j 2j z1 ]s1 (1 - s1 )
               xj            vij xj    vi1 xj          x
               s1            s1 vij     s1 vi1         v
                                                       ~j
                        =            +             =-     s1 sj + [wz 1j j + wz 2j j z1 ]s1 (1 - s1 )
               zj            vij zj    vi1 zj          z

              2 s1            2 s1 v1 s1  2 v1
                        =                 +
             z1 xj           v1 xj z1 v1 z1 xj
                             v1            s1
                        =       (1 - 2s1 )    + s1 (1 - s1 )wx2j 2j
                             z1            xj
              2 s1            2 s1 v1 s1  2 v1
                        =                +
             z1 zj           v1 zj z1 v1 z1 zj
                             v1            s1
                        =       (1 - 2s1 )    + s1 (1 - s1 )wz 2j j
                             z1            zj
                                                                                                                                                 (40)

And also:
                             v1               s1
 2 s1    2 s1                z1 (1    - 2s1 ) z  + s1 (1 - s1 )wz 2j j
                                                  j
      /                =     v1              s1
z1 zj z1 xj                  z1 (1   - 2s1 ) x  + s1 (1 - s1 )wx2j 2j
                                                  j

                              v1                        v
                                                        ~j
                              z1 (1   - 2s1 ) -         z   s1 sj + [wz 1j j + wz 2j j z1 ]s1 (1 - s1 ) + s1 (1 - s1 )wz 2j j
                       =                              v
                                                      ~j
                                                                                                                            (41)
                             v1
                             z1 (1   - 2s1 ) -        x    s1 sj + [wx1j 2j + wx2j 2j z1 ]s1 (1 - s1 ) + s1 (1 - s1 )wx2j 2j

                                                                sj                                - s1 )                  (1-s1 )
If we define the weights: wx1j = wz 1j =                       1-s1    and wx2j = wz 2j = [ z1 (1
                                                                                                s        +           (v1 /z1 )(1-2s1 )sj ]
                                                                                                                                           -1        =
                                                                                                            j
(1-2s1 )sj                               -1       (v1 /z1 )(1-2s1 )sj
  1-s1
                1
             v1 /z1   + (1 - 2s1 )z1          =         1-s1                  (1 + (1 - 2s1 )z1 (v1 /z1 ))-1 , then:

                                                               v
                                                               ~j                   (1-s1 )                     - s1 )          (1-s1 )
  2 s1    2 s1
                              v1
                              z1 (1   - 2s1 )s1 sj         -   z      +  j wz 1 j     sj      + j wz 2j [ z1 (1
                                                                                                              s        +   (v1 /z1 )(1-2s1 )sj   ]
                                                                                                                j
       /                =                                      v
                                                               ~j
 z1 zj z1 xj                 v1
                                      - 2s1 )s1 sj         -                        (1-s1 )
                                                                                              + j wx2j [ z1 (1 -s1 )            (1-s1 )
                             z1 (1                             x      + j wx1j        sj                     s  j
                                                                                                                     +     (v1 /z1 )(1-2s1 )sj   ]
                              v1                                 v
                                                                 ~j
                              z1 (1    - 2s1 )s1 sj          -   z    + j + j
                        =                                      v
                                                               ~j
                             v1
                             z1 (1    - 2s1 )s1 sj         -   x      + 2j + 2j
                               v~j
                              - z      + j +  j
                        =     v~j
                                                                                                                                                 (42)
                             - x      + 2j + 2j



                                                                         44
Thus, we have:

                                                                                      v~j
                                                   2 s1    2 s1                      - z      + j + j
                                                        /              =             v~j
                                                                                                                                          (43)
                                                  z1 zj z1 xj                       - x       + 2j + 2j

                                  sj                                                      (1-2s1 )sj
where wz 1j = wx1j =             1-s1    and wx2j = wz 2j = (v1 /z1 )                       1-s1       (1 + (v1 /z1 )(1 - 2s1 )z1 )-1 . Given a
linear specification of v
                        ~, v
                           ~(xj , zj ) = xj a1 + zj a2 , this implies that the above ratio is a constant for each j .
       Estimation of the model with these weights is infeasible since the levels of the choice probabilities s1
and sk , as well as the derivatives v1 /z1 are unknown ex ante and thus we do not know the weights. We
estimate the model via a two-step process where s1 and sk are estimated using a naive logit model (where
utility for each good is a linear function of xj and zj ), these estimates are used to construct weights, and
then the model in equation (21) is estimated treating these weights as constants.41
       To recover estimates of / from the flexible logit model, we use the ratio in equation (43). With the
                                                                             -a2 +j +j
linear specification of v
                        ~, this ratio is given by                      =    -a1 +2j +2j            . In cases where the identity of goods is
not meaningful (e.g. "good 2" does not refer to the same good across different choice sets and there are no
alternative-specific fixed effects), we can further impose k =  , 2k = 2 , k =  and 2k = 2 , which gives
                             
a single estimate of         .


A.7        Recovery of Search Costs Given Preferences in the Weitzman Model

Suppose that utility is given by Uij = xj  + zj  +                         ij   and that consumers search sequentially according to
the model of Weitzman (1979).
   As shown in Armstrong (2017),42 the optimal search strategy is for consumers to behave as if they were
                                                                 ~ij = xj  + min {zj , rvi }  + ij , where
choosing among options in a static model with utilities given by U
rvi denotes i's reservation value in units of z (see Example 1). Thus, dropping i subscripts, ordering goods
so that z1  z2  . . .  zJ , and letting

Et  { :       k   -   1    (x1 - xk ) , k = 2, ..., J - t - 1}{ :                     h   -   1    (x1 - xh )  + (rv - zh ) , h = J - t, ..., J }

we can write

                           s1 = P (x1  + min {z1 , rv }  +                      1    xk  + min {zk , rv }  +         k   k )
                                 = P(         k   -   1    (x1 - xk )  k ) P (rv  zJ )
                                     J -2
                                 +                P ({  Et }  {zJ -t  rv  zJ -t-1 }) dFrv (rv )
                                        t=0
                                 + P(         k   -   1    (x1 - xk )  + (z1 - zk )  k ) P (rv  z1 )

  41
    Since v1 /z1 is estimated imprecisely from the naive logit, when 1 + (v1 /z1 )(1 - 2s1 )z1 is close to 0 (leading to very
large weights), we set v1 /z1 = 0 when the former term falls below 1 in absolute value.
  42
       See also Choi, Dai, and Kim (2018).




                                                                           45
where Frv denotes the cdf of rv and the second equality assumes that search costs (and thus rv ) are
independent of . Therefore, we have

                     s1           
                            =        P(    k   -   1    (x1 - xk )  + (z1 - zk )  k ) P (rv  z1 )                      (44)
                     z1           z1

Given identification of (,  ) by the argument in Section 2.1, the first term on the rhs of (44) is identified
given parametric assumptions on the distribution of . Thus, P {rv  z1 } is identified. Repeating the
argument for all z1 , one can trace out the entire distribution of rv . Since c, the search cost for consumer
i, is a known transformation of rv ,43 the distribution of c is also identified.
       Equation (44) also lends itself to a different argument that does not require making a parametric
assumption on the distribution of , but instead relies on "at-infinity" variation. Note that the first term
on the rhs of (44) is invariant to increasing all zj 's by the same amount. Thus, we can write

                                         s1
                                         z1 (z + )            P (rv  z1 + )
                                           s1
                                                          =                                                            (45)
                                           z1 (z)
                                                                P (rv  z1 )

where  is a J -vector with all elements equal to some . Letting   -, the numerator on the rhs of
(45) goes to 1, which yields identification of P (rv  z1 ). Repeating the argument for all z1 , one can trace
out the entire distribution of rv and recover the distribution of c as above.




  43
   This assumes that the prior Fz used by consumers in forming expectations are known to the researcher, as in the case
where consumers have rational expectations and Fz coincides with the observed distribution of z across goods and/or markets.


                                                               46
