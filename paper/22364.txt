                              NBER WORKING PAPER SERIES




           TERM STRUCTURE OF UNCERTAINTY IN THE MACROECONOMY

                                       Jaroslav Borovička
                                       Lars Peter Hansen

                                      Working Paper 22364
                              http://www.nber.org/papers/w22364


                     NATIONAL BUREAU OF ECONOMIC RESEARCH
                              1050 Massachusetts Avenue
                                Cambridge, MA 02138
                                     June 2016




We would like to thank John Heaton and Vadim Linetsky for helpful comments. Spencer Lyon
and Victor Zhorin provided excellent research assistance. The views expressed herein are those of
the authors and do not necessarily reflect the views of the National Bureau of Economic
Research.

NBER working papers are circulated for discussion and comment purposes. They have not been
peer-reviewed or been subject to the review by the NBER Board of Directors that accompanies
official NBER publications.

© 2016 by Jaroslav Borovička and Lars Peter Hansen. All rights reserved. Short sections of text,
not to exceed two paragraphs, may be quoted without explicit permission provided that full
credit, including © notice, is given to the source.
Term Structure of Uncertainty in the Macroeconomy
Jaroslav Borovička and Lars Peter Hansen
NBER Working Paper No. 22364
June 2016
JEL No. C10,C32,C58,E44,G12,G32

                                        ABSTRACT

Dynamic economic models make predictions about impulse responses that characterize how
macroeconomic processes respond to alternative shocks over different horizons. From the
perspective of asset pricing, impulse responses quantify the exposure of macroeconomic
processes and other cash flows to macroeconomic shocks. Financial markets provide
compensations to investors who are exposed to these shocks. Adopting an asset pricing vantage
point, we describe and apply methods for computing exposures to macroeconomic shocks and the
implied compensations represented as elasticities over alternative payoff horizons. The outcome
is a term structure of macroeconomic uncertainty.


Jaroslav Borovička
Department of Economics
New York University
19 W. 4th Street, 6th Floor
New York, NY 10012
and NBER
jaroslav.borovicka@nyu.edu

Lars Peter Hansen
Department of Economics
The University of Chicago
1126 East 59th Street
Chicago, IL 60637
and NBER
lhansen@uchicago.edu
Contents
1 Introduction                                                                                                                                         3

2 Mathematical framework                                                                                                                               4

3 Asset pricing over alternative investment horizons                                                                                                   6
  3.1 One-period pricing . . . . . . . . . . . . . . . . . . . . . . . . . .                              . . . . . . .               .   .   .   .    6
      3.1.1 One-period shock elasticities . . . . . . . . . . . . . . . .                                 . . . . . . .               .   .   .   .    7
  3.2 Multi-period investment horizon . . . . . . . . . . . . . . . . . .                                 . . . . . . .               .   .   .   .    9
  3.3 A change of measure and an impulse response for a multiplicative                                    functional .                .   .   .   .   10
  3.4 Long-horizon pricing . . . . . . . . . . . . . . . . . . . . . . . . .                              . . . . . . .               .   .   .   .   10
  3.5 Non-Gaussian frameworks . . . . . . . . . . . . . . . . . . . . . .                                 . . . . . . .               .   .   .   .   13

4 Relation to impulse response functions                                                                                                              13
  4.1 Lognormality . . . . . . . . . . . . . . . .    .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   14
      4.1.1 Impulse response functions . . . .        .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   14
      4.1.2 Shock elasticities . . . . . . . . . .    .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   15
      4.1.3 Long-term pricing revisited . . . .       .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   16
  4.2 Continuous-time diffusions . . . . . . . . .    .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   17
      4.2.1 Haussmann–Clark–Ocone formula             .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   18
      4.2.2 Shock elasticities for diffusions . .     .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   19

5 Discrete-time formulas and approximation                                                                                                            20
  5.1 Exponential-quadratic framework . . . . . . . . . . . .                     . . . . .           .   .   .   .   .   .   .   .   .   .   .   .   21
      5.1.1 Shock elasticities . . . . . . . . . . . . . . . . .                  . . . . .           .   .   .   .   .   .   .   .   .   .   .   .   22
  5.2 Perturbation methods . . . . . . . . . . . . . . . . . .                    . . . . .           .   .   .   .   .   .   .   .   .   .   .   .   23
      5.2.1 Approximating state vector dynamics . . . . .                         . . . . .           .   .   .   .   .   .   .   .   .   .   .   .   23
  5.3 Approximating the evolution of a stationary increment                       process             .   .   .   .   .   .   .   .   .   .   .   .   25
      5.3.1 Approximating shock elasticities . . . . . . . .                      . . . . .           .   .   .   .   .   .   .   .   .   .   .   .   26
  5.4 Related approaches . . . . . . . . . . . . . . . . . . . .                  . . . . .           .   .   .   .   .   .   .   .   .   .   .   .   26
  5.5 Recursive utility investors . . . . . . . . . . . . . . . .                 . . . . .           .   .   .   .   .   .   .   .   .   .   .   .   26

6 Continuous-time approximation                                                                                                                       27
  6.1 An associated partial differential equation     . . . . .           .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   27
  6.2 Martingale decomposition and a change of        measure             .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   27
  6.3 Long-term pricing . . . . . . . . . . . . .     . . . . .           .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   29
  6.4 Boundary conditions . . . . . . . . . . . .     . . . . .           .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   30

7 Models with financial constraints in continuous time                                              31
  7.1 Stochastic discount factors . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 32
  7.2 He and Krishnamurthy (2013) . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 32


                                                  1
         7.2.1 Households and specialists . . . . . . . . . . .                           .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   32
         7.2.2 Financial friction . . . . . . . . . . . . . . . .                         .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   33
         7.2.3 Equilibrium dynamics . . . . . . . . . . . . .                             .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   34
         7.2.4 Stochastic discount factor and cash flows . .                              .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   34
         7.2.5 Shock elasticities and term structure of yields                            .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   37
   7.3   Brunnermeier and Sannikov (2014) . . . . . . . . . .                             .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   38
         7.3.1 Households and experts . . . . . . . . . . . .                             .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   38
         7.3.2 Financial friction . . . . . . . . . . . . . . . .                         .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   39
         7.3.3 Equilibrium dynamics . . . . . . . . . . . . .                             .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   39
         7.3.4 Stochastic discount factor and cash flows . .                              .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   40
         7.3.5 Shock elasticities and term structure of yields                            .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   40

8 Directions for further research                                                                                                                                 43

A Exponential-quadratic framework                                                                                                                                 45
  A.1 Definitions . . . . . . . . . . . . .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   45
  A.2 Concise notation for derivatives .      .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   46
  A.3 Conditional expectations . . . . .      .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   47
  A.4 Iterative formulas . . . . . . . . .    .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   48
  A.5 Coefficients Φ∗i . . . . . . . . . .    .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   48

B Shock elasticity calculations                                                                 49
  B.1 Shock elasticities under the convenient functional form . . . . . . . . . . . . . . . . . 49
  B.2 Approximation of the shock elasticity function . . . . . . . . . . . . . . . . . . . . . 50




                                                          2
1    Introduction
Impulse response functions quantify the impact of alternative economic shocks on future economic
outcomes. In so doing, they provide a way to assess the importance of alternative sources of fluc-
tuations. Building on the insights of Yule (1927) and Slutsky (1927), Frisch featured an important
line of research on the “impulse and propagation problem” aimed at answering the question asking
what are the sources of fluctuations and how they are propagated over time. An impulse, captured
formally by the realization of a random shock, has an impact on an economic time series in all of
the subsequent time periods. Response functions depict the intertemporal responses. Sims (1980)
showed how to apply this approach in a tractable way to multivariate time series with a vector of
underlying shocks, and he exposed the underlying challenges for identification. Subsequent research
developed nonlinear counterparts to impulse response functions.
    Macroeconomic shocks also play an important role in asset pricing. By their very nature,
macroeconomic shocks cannot be diversified and investors exposed to those shocks require compen-
sations. The resulting market-based remunerations differ depending how cash flows are exposed
to the alternative macroeconomic shocks. We call the compensations risk prices, and there is a
term structure that characterizes these prices as a function of the investment horizon. In this
chapter we study methods for depicting this term structure and illustrate its use by comparing
pricing implications across models. This leads us to formalize the exposure and pricing counterpart
to impulse response functions familiar to macroeconomists. We call these objects shock-exposure
and shock-price elasticities. Our calculations require either an empirical-based or model-based
stochastic discount factor process along with a representation of how alternative cash flows with
macroeconomic components respond to shocks.
    There is an alternative way to motivate the calculations that we perform. A common character-
ization of risk aversion looks at local certainty equivalent calculations for small variance changes in
consumption. We deviate in two ways. First, when making small changes, we do not use certainty
as our benchmark but rather the equilibrium consumption from the stochastic general equilibrium
model. This leads us to make more refined adjustments in the exposure to uncertainty. Second,
movements in consumption at future dates could be induced by any of the macroeconomic shocks
with occurrences at dates between tomorrow and this future date. Thus, similar to Hansen et al.
(1999) and Alvarez and Jermann (2004), we have a differential measure depending on the specific
shock and the dates of the impacts.
    Empirical finance often focuses on the measurement of risk premia on alternative financial assets.
In our framework, these risk premia reflect the exposure to uncertainty and the compensation for
that exposure. Risk premia change when exposures change, when the prices of those exposures
change or both. We use explicit economic models to help us quantify these two channels by which
risk premia are determined, but a more empirically-based approach could also be applied provided
that the uncertainty prices for shocks could be inferred. While there are interesting challenges in
identification to explore, we will abstract from those challenges in this chapter.
    Our chapter:


                                                  3
    • defines and constructs a term structure of shock-exposure and shock-price elasticities appli-
      cable to nonlinear Markov models;

    • compares these constructions to impulse response functions commonly used in macroeco-
      nomics;

    • describes computational approaches pertinent for discrete-time and continuous-time models;

    • applies the methods to continuous-time macroeconomic models with financing frictions pro-
      posed by He and Krishnamurthy (2013) and Brunnermeier and Sannikov (2014).


2    Mathematical framework
We introduce a framework designed to encompass a large class of macroeconomic and asset pricing
general equilibrium models. There is an underlying stationary Markov model that is used to capture
the stochastic growth of a vector of time series of economic variables. The Markov model emerges as
the “reduced form” of a solution to a dynamic stochastic equilibrium model of the macroeconomy.
Modeling stationary growth rates allows for inclusion of shocks that have permanent effects and
nontrivial long-horizon implications for risk compensations. We provide a range of illustrative
applications of this framework throughout the chapter, and we devote Sections 7 to a more extensive
exploration of nonlinear continuous-time models with financial constraints.
    We start with a probability space (Ω, F, P ). On this probability space, there is an n-dimensional,
stationary and ergodic Markov process X = {Xt : t ∈ N} and a k-dimensional process W of inde-
pendent and identically distributed shocks. Unless otherwise specified, we assume that each Wt is
a multivariate standard normal random variable. We will have more to say about discrete states
and shocks that are not normally distributed in Section 3.5.
    The Markov process is initialized at X0 . Denote F = {Ft : t ∈ N} the completed filtration
generated by the histories of W and X0 . We suppose that X is a solution to a law of motion

                                         Xt+1 = ψ (Xt , Wt+1 )                                     (1)
                                    Yt+1 − Yt = φ (Xt , Wt+1 )

The state vector Xt contains both exogenously specified states and endogenous ones. We presume
full information in the sense that the shock Wt+1 can be depicted in terms of (Xt , Yt+1 − Yt ). In
more general circumstances we would incorporate a solution to a a filtering problem if we are to
match an information structure to (X, Y ), a filtering problem that is perhaps solved by economic
agents.
    Consistent intertemporal pricing together with the Markov property lead us to use a class of
stochastic processes called multiplicative functionals. These processes are built from the underlying
Markov process and will be used to model cash flows and stochastic discount factors. Since many
macroeconomic time series grow or decay over time, we use the state vector X to model the growth


                                                  4
rate of such processes. In particular, let the dynamics of a multiplicative functional M be defined
as1
                                 log Mt+1 − log Mt = κ (Xt , Wt+1 ) .                           (2)

The components of Y are examples of multiplicative functionals. Since X is stationary, the process
log M has stationary increments. A revealing example is the conditionally linear model

                                     κ (Xt , Xt+1 ) = β (Xt ) + α (Xt ) · Wt+1

where β (x) allows for nonlinearity in the conditional mean, and α (x) introduces stochastic volatil-
ity.
     We denote G a generic cash-flow process and S the equilibrium determined stochastic discount
factor process, both modeled as multiplicative functionals. While we adopt a common mathematical
formulation for both, G is expected to grow and S is expected to decay over time, albeit in stochastic
manners.
     Equilibrium models in macroeconomics and asset pricing build on the premise of utility-maximizing
investors trading in arbitrage-free markets. Arbitrage-free pricing implies the existence of a strictly
positive stochastic discount factor process S that can be used to infer equilibrium asset prices.
Stochastic discount factors provide a convenient way to depict the observable implications of asset
pricing models.2 In this chapter, we consider a stochastic discount factor process that compounds
the one-period stochastic discount factors in order to value multiperiod claims.

Definition 2.1. A stochastic discount factor S is a positive (with probability one) stochastic process
such that for any t, j ≥ 0 and payoff Gt+j maturing at time t + j, the time-t price is given by
                                                                              
                                                             St+j
                                      Qt [Gt+j ] = E                    Gt+j | Ft .                                  (3)
                                                              St

    Notice that this definition does not restrict the date zero stochastic discount factor, S0 . This
initialization may be chosen in a convenient manner. If markets are complete, then this stochastic
discount factor is unique up to the initialization. Equations of the type (3) arise from investors’
optimality conditions in the form of Euler equations. In an equilibrium model with complete
markets, the stochastic discount factor is typically equated with the marginal rate of substitution
of an unconstrained investor. The identity of such a person can change over time and across
states. In some models with incomplete markets, the stochastic discount factor process ceases to be
unique. There are different shadow prices for non-traded risk exposures but a common pricing of the
exposures with explicit compensations in financial markets. With other forms of trading frictions,
the pricing equalities can be replaced by pricing inequalities, still expressed using a stochastic
discount factor.
    In our framework, we will suppose that equilibrium stochastic discount factors inherit the
   1
     Multiplicative functionals are often initialized to be at one, or equivalently log M0 = 0. We will abuse this jargon
a bit by allowing ourselves other possible initiations.
   2
     See Hansen and Richard (1987) for an initial discussion of stochastic discount factors.


                                                           5
multiplicative functional structure. Market frictions, portfolio constraints and other types of market
imperfections will then introduce distortions into formula (3). We will study such distortions in
models with financial constraints in Section 7.
    Notice that definition (3) of the stochastic discount factor involves an expectations operator.
This expectations operator in general represents investors’ beliefs about the future. Here, we
have imposed rational expectations by assuming that investors’ beliefs are identical to the data-
generating probability measure P . This measure is that implied by historical evidence or by the
fully specified model. Investors’ beliefs, however, may differ from P and there exists alternative
approaches to modeling these deviations in interesting ways. While the modeling of investors’
beliefs is an important building block of the asset pricing framework, in this chapter we abstract
from these considerations and impose rational expectations throughout the text.


3     Asset pricing over alternative investment horizons
We price cash flows exposed to macroeconomic uncertainty and modeled as multiplicative processes.
Consider a generic cash flow process G, say the dividend process or an equilibrium consumption
process. We start with a baseline payoff Gt maturing in individual periods t = 0, 1, 2, . . . and
parameterize stochastic perturbations of this process. In particular, we derive measures that cap-
ture the sensitivity of expected payoff to exposure to alternative macroeconomic shocks, and the
sensitivity of the associated risk compensations. We follow the convention in empirical finance by
depicting compensations in terms of expected returns per unit of some measure of riskiness. The
compensations differ depending upon which shock we target when we construct stochastic pertur-
bations. The method relies on a comparison of the pricing of payoff Gt relative to another payoff
that is marginally more exposed to risk in a particular way.
   The cash flows G arising from equilibrium models will often have the form of multiplicative
processes (2). A special case of such cash flows are payoffs that are positive functions of the
Markov state, ψ (Xt ). These payoffs will be featured prominently in our subsequent analysis.

3.1   One-period pricing
We are interested in the pricing of payoffs maturing at different horizons but we start with a simple
one-period conditionally lognormal environment. This environment will provide an explicit link to
familiar calculations in asset valuation. Suppose that

                                     log G1 = βg (X0 ) + αg (X0 ) · W1
                            log S1 − log S0 = βs (X0 ) + αs (X0 ) · W1

where G1 is the payoff to which we assign values and S1 is the one-period stochastic discount factor
used to compute these values. The one-period return on this investment is the payoff in period one




                                                  6
divided by the period-zero price:
                                                                   
                                                               G1
                                  .    G1                      G0
                               R1 =            = h         i.
                                      Q0 [G1 ]  E SS10 G1
                                                          | X
                                                       G0    0


The logarithm of the expected return can then be calculated explicitly as:
                                                                                                  
                                            G1                               S1        G1
        log E [R1 | X0 = x] = log E                  | X0 = x − log E                           | X0 = x       (4)
                                            G0                               S0        G0
                                          |αs (x)|2
                             = −βs (x) −            − αs (x) · αg (x).
                               |       {z     2 }|        {z        }
                                 risk-free rate     risk premium

This compensation is expressed in terms of expected returns as is typical in asset pricing. Notice
that we are using logarithms of proportional risk premia as a starting point.
    Imagine applying this calculation to a family of such payoffs parameterized in part by αg . The
vector αg defines a vector of exposures to the components of the normally distributed shock W1 .
Then −αs is the vector of shock “prices” representing the compensation for exposure to these
shocks.
    The risk prices in this conditionally lognormal model have a familiar conditional linear structure
known from one-period factor models. In these models, the so called factor loadings αg on the
individual shocks W1 are multiplied by factor prices −αs . The total compensation in terms of an
expected return is thus the product of the quantity of risk (risk exposure), and the price per unit of
this risk. There are analogous simplifications for continuous-time diffusion models since the local
evolution in such models is conditionally normal.
    In a nonlinear multiperiod environment, this calculation ceases to be straightforward. We would,
however, still like to infer measures of the quantity of risk and the associated price of the risk. We
therefore explore a related derivation that will yield the same results in this one-period lognormal
environment but will also naturally extend to a nonlinear setup and multiple-period horizons.

3.1.1   One-period shock elasticities

We parameterize a family of random variables H1 (r) indexed by r using

                                                                r2
                               log H1 (r) = rν (X0 ) · W1 −        |ν (X0 )|2                                  (5)
                                                                2

where r is an auxiliary scalar parameter. The vector of exposures αh (X0 ) is normalized to
                                          h          i
                                         E |ν (X0 )|2 = 1.

With this normalization,
                                         E [H1 (r) |X0 ] = 1.

                                                      7
Even when shocks are not normally distributed, we shall find it convenient to construct H1 (r) to
have a unit conditional expectation.
   Given the baseline payoff Gt , form a parameterized family of payoffs G1 H1 (r) given by

                                                                              r2
        log G1 − log G0 + log H1 (r) = [αg (X0 ) + rν (X0 )] · W1 + βg (X0 ) − |ν (X0 )|2 .
                                       |        {z         }                  2
                                       new shock exposure

The new cash flow G1 H1 (r) has shock exposure αg (X0 ) + rν (X0 ) and is thus more exposed to the
vector of shocks W1 in the direction ν (X0 ). By changing r we alter the magnitude of the exposure
in direction ν (X0 ). By choosing different vectors ν (X0 ), we alter the combinations of shocks whose
impact we want to investigate. A typical example of an ν (X0 ) would be a coordinate vector ej with
a single one in j-th place. In that case, we infer the pricing implications of the j-the component of
the shock vector W1 . In some applications it may be convenient to make ν (X0 ) explicitly depend
on X0 . For instance, Borovička et al. (2011) propose scaling of ν with X0 in models with stochastic
volatility.
    The payoffs G1 H1 (r) imply a corresponding family of logarithms of expected returns as in
equation (4):
                                                                                        
                                        G1                                 S1  G1
 log E [R1 (r) | X0 = x] = log E                 H1 (r) | X0 = x − log E          H1 (r) | X0 = x .
                                        G0                                 S0  G0

We are interested in comparing the expected return of the payoff G1 H1 (r) relative to G1 =
G1 H1 (0). Since our exposure direction ν (X0 ) has a unit standard deviation, by differentiating
with respect to r we compute an elasticity

     d
        log E [R1 (r) | X0 = x]|r=0
     dr                                                                                                     
         d           G1                                        d               S1        G1
     =      log E         H1 (r) | X0 = x                  −      log E                            H1 (r) | X0 = x             .
         dr          G0                           r=0          dr              S0        G0                              r=0

This elasticity measures the sensitivity of the expected return on the payoff G1 to an increase in
exposure to the shock in the direction ν (x). The calculation leads us to define the counterparts of
quantity and price elasticities from microeconomics:

  1. The one-period shock-exposure elasticity
                                                                                 
                                 d                    G1
                     εg (x, 1) =    log E                      H1 (r) | X0 = x                = αg (x) · ν (x)
                                 dr                   G0                                r=0

     measures the sensitivity of the expected payoff G1 to an increase in exposure in the direction
     ν (x).




                                                               8
  2. The one-period shock-price elasticity
                                                                                                                                  
                   d           G1                                              d                   S1        G1
      εp (x, 1) =    log E        H1 (r) | X0 = x                            −    log E                                  H1 (r) | X0 = x
                  dr           G0                                        r=0   dr                  S0        G0                                r=0
                = −αs (x) · ν (x)

      measures the sensitivity of the compensation, in units of expected return, for this exposure.

Notice that the shock-exposure elasticity recovers the exposure vector αg (x), and individual com-
ponents of this vector can be obtained by varying the choice of the direction of the perturbation
ν (x). Similarly, the shock-price elasticity recovers the vector of prices −αs (x) associated with the
risks embedded in the shock W1 .
    In this one-period case, we replicated a straightforward decomposition of the expected return
(4) into quantities and prices of risk. Now we move to the characterization of the asset pricing
implications over longer horizons.

3.2   Multi-period investment horizon
Consider the parameterized payoff Gt H1 (r) with a date-zero price E [St Gt H1 (r) | X0 = x]. This is
a payoff maturing at time t that has the same growth rate as payoff Gt except period one when
the growth rate is stochastically perturbed by H1 (r). The logarithm of the expected return (yield
to maturity) is
                                                                                                                              
                           .                   Gt                                             St         Gt
 log E [R0,t (r) | X0 = x] = log E                      H1 (r) | X0 = x − log E                                      H1 (r) | X0 = x .
                                               G0                                             S0         G0

Following our previous analysis, we construct two elasticities:

  1. shock-exposure elasticity
                                                                                               
                                                d                  Gt
                                    εg (x, t) =    log E                     H1 (r) | X0 = x
                                                dr                 G0                                 r=0


  2. shock-price elasticity
                                                                                                                          
                    d               Gt                                       d               St         Gt
      εp (x, t) =      log E                 H1 (r) | X0 = x             −      log E                            H1 (r) | X0 = x
                    dr              G0                             r=0       dr              S0         G0                             r=0
                                                                                                                                       (6)

These elasticities are functions of the investment horizon t, and thus we obtain a term structure
of elasticities. The dependence on the current state X0 = x incorporates possible time-variation in
the sensitivity of expected returns to exposure to shocks.




                                                               9
3.3   A change of measure and an impulse response for a multiplicative functional
Notice that the shock elasticities defined in the previous subsection have a common mathematical
structure expressed using the multiplicative functionals M = S and M = SG. Given a multiplica-
tive functional M , we define
                                                                                     
                                         d                 Mt
                              ε (x, t) =    log E                     H1 (r) | X0 = x             (7)
                                         dr                M0                               r=0

Taking the derivative in (7), we obtain
                                                             h                    i
                                                                  Mt
                                                         E         W1 | X0 = x
                                                                  M0
                                    ε (x, t) = ν (x) ·        h             i                   (8)
                                                                Mt
                                                             E M 0
                                                                    | X 0 = x
                                                                       
                                                                        Mt
Thus a major ingredient in the computation is the covariance between M    0
                                                                             and W1 conditioned
on X0 .
    The random variable H1 (r) given by (5) is positive and has expectation equal to unity condi-
tioned on X0 . Multiplication by the this random variable has the interpretation of changing the
probability distribution of W1 from having mean zero to having a mean given by rν(X0 ). Thus
given a multiplicative process M
                                                                               
                         Mt                                     Mt
                E                 H1 (r) | X0 = x = E H1 (r)E           | X0 , W1 | X0
                         M0                                     M0
                                                                                  
                                                    e       Mt
                                                  =E E           | X0 , W1 | X0 = x
                                                            M0

where Ee presumes that the random vector W1 is distributed as a multivariate normal with mean
rν(x) consistent with our multiplication by H1 (r).

3.4   Long-horizon pricing
Shock elasticities depict the term structure of risk as we change the maturity of priced payoffs.
To aid our understanding of the overall shape of the term structure of elasticities, we characterize
the long-horizon limits of these shock elasticities. We provide a characterization for a general
multiplicative process that takes the form of a factorization. A multiplicative process is a product
of a geometric constant growth or decay process, a positive martingale and a ratio of a function of
the Markov state in date zero and date t. Since the factorization is applicable to any member of
a general class of multiplicative processes, we apply it to both stochastic discount factor processes
and positive cash flow processes.
    As in Hansen and Scheinkman (2009) and Hansen (2012), we use Perron–Frobenius theory to
provide a factorization of multiplicative processes. Given a multiplicative process M , solve the




                                                             10
equation                                                       
                                          Mt
                                 E                 e (Xt ) | X0 = x = exp (ηt) e (x)                               (9)
                                          M0
for an unknown function e (x) that is strictly positive and an unknown number η. The solution is
independent of the choice of the horizon t.
    Consider the pair (e, η) that solves (9) and form

                                          ft .                     
                                          M              e (Xt ) Mt
                                             = exp (−ηt)              .                                           (10)
                                          f0
                                          M              e (X0 ) M0

                       f is a martingale under P , since
The stochastic process M
                    h            i                                                   
                    ft+1 | Ft          exp [−η (t + 1)] Mt f       Mt+1
                  E M                =                      M0 E        e (Xt+1 ) | Ft =
                                            e (X0 )      M0         Mt
                                                  e (Xt ) Mt f     ft .
                                     = exp (−ηt)             M0 = M
                                                  e (X0 ) M0

Consequently, expression (10) can be reorganized as

                                               Mt                    ft
                                                             e (X0 ) M
                                                  = exp (ηt)                                                      (11)
                                               M0                    f0
                                                             e (Xt ) M

This formula provides a multiplicative decomposition of the multiplicative functional M into a
                                                                                               f.
deterministic drift exp (ηt), a stationary function of the Markov state e (x) and a martingale M
This martingale component will be critical in characterizing long-term pricing implications.
   Associated with the martingale M   f is a probability measure Pe such that for every measurable
function Z of the Markov process between dates zero and t,
                                                    
                                     E Mft Z | X0 = x = E
                                                        e (Z | X0 = x)


where E e (· | X0 = x) is the conditional expectation operator under the probability measure Pe.3
    In finite state spaces, equation (9) can be posed as a matrix problem with a solution that is an
eigenvector with positive entries.

Example 3.1. In a finite-state Markov chain environment, equation (9) is a standard eigenvalue
problem. Let realized value of the Xt be represented as alternative coordinate vectors. Suppose the
ratio MMt+1
         t
            satisfies
                                       Mt+1
                                             = (Xt+1 )′ MXt
                                        Mt
for some square matrix M. In the same way, represent the one-period transition probabilities as a
   3
    In order to completely define the measure Pe , we also need to specify the unconditional probability distribution.
For instance, Mf0 can be initiated to make Pe stationary. Since all pricing results in this chapter utilize conditional
probability distributions, we abstract from these considerations here.




                                                            11
matrix P. For t = 1, equation (9) becomes a vector equation

                                            (P ∗ M) e = exp (η) e

where the operator ∗ depicts elementwise multiplication, (P ∗ M)ij = Pij Mij . When

                                               ∞
                                               X
                                                       λj (P ∗ M)j
                                               j=0


has all strictly positive entries for some 0 < λ < 1, the Perron–Frobenius theorem implies the
existence of a unique normalized strictly positive eigenvector e associated with the largest eigenvalue
exp (η) of the matrix P ∗ M. Then e(Xt ) in formula (9) is e · Xt .

    In continuous state spaces, this factorization may not yield a unique strictly positive solution
e (x). Hansen and Scheinkman (2009) and Borovička et al. (2015) provide selection criteria based
on the stochastic stability of the probability measure implied by the martingale component to
guarantee uniqueness. Stochastic stability ensures that we have a valuable way to compute limiting
approximations once we change measures. Here, we will assume that we have selected such a
solution.4
    Factorization (11) leads to a characterization of long-horizon limits for the shock elasticities.
Using this factorization in expression (7), we obtain

                                                       e [b
                                                       E  e (Xt ) W1 | X0 = x]
                                  ε (x, t) = ν (x) ·
                                                         e [b
                                                         E  e (Xt ) | X0 = x]
             .
where eb (x) = 1/e (x). Under technical assumptions, we find that5

                                                          e [W1 | X0 = x] .
                                   lim ε (x, t) = ν (x) · E
                                   t→∞

   Factorization (11) leads to a characterization of long-horizon limits for the shock elasticities.
Using this factorization in expression (7), we obtain

                                                       e [b
                                                       E  e (Xt ) W1 | X0 = x]
                                  ε (x, t) = ν (x) ·
                                                         e
                                                         E [b
                                                            e (Xt ) | X0 = x]
             .
where eb (x) = 1/e (x). Under technical assumptions the long-maturity limit for the shock elasticity
is given by
                                                       e [W1 | X0 = x] .
                                lim ε (x, t) = ν (x) · E
                                   t→∞

The sensitivity of long-horizon payoffs to current shocks is therefore determined by the martingale
components of the stochastic discount factor and the cash flow, and their implications for the
  4
     Our formulation presumes an underlying Markovian structure. See Qin and Linetsky (2014b) for a more general
starting point and an analogous factorization.
   5
     See Hansen and Scheinkman (2012) for a version of this result for a continuous-time diffusion model.


                                                         12
expectations of shock W1 as captured by the implied change in probability measures.

3.5   Non-Gaussian frameworks
While we have made special reference to normally distributed shocks, our mathematical structure
does not require this. We have featured perturbations H1 (r) that are positive and expectations one.
Risk prices in financial economics are denominated in terms of expected mean compensation per unit
of risk. With normally distributed shocks, we measure risk in units of standard deviations. Provided
that we adopt an interpretable way to denominate risk prices for other distributions, our methods
continue to apply beyond the conditionally Gaussian framework. For instance, Zviadadze (2016)
constructs shock elasticities in a stochastic environment with autoregressive gamma processes.
    Another example are regime-shift models that may include both normally distributed shocks
along with uncertain regimes. Exposure to macroeconomic regime-shift risk is of interest and can
be characterized using shock elasticities by structuring appropriately the random variable H1 (r).
These switches can be exogenous (e.g., exogenously modeled periods of low or high growth and
volatility) or endogenous (e.g., interest rate at the zero lower bound, financial sector in a period
of binding financial constraints, or regime changes in government policies). We develop shock
elasticities for regime-shift risk in Borovička et al. (2011).
    For Markov chain models used to capture the regime shift dynamics of exogenous shocks see
David (2008), Chen (2010) or Bianchi (2015) for some recent examples in the asset pricing literature
and Liu et al. (2011) and Bianchi et al. (2013) in macroeconomic modeling. Regime switches are
also utilized to model time-variation in government policies, see Sims and Zha (2006), Liu et al.
(2009) and Bianchi (2012) for regime switching in monetary policy rules, Davig et al. (2010, 2011)
and Bianchi and Melosi (2015) for fiscal policy applications and Chung et al. (2007) and Bianchi
and Ilut (2015) for a combination of both. Farmer et al. (2011) and Foerster et al. (2014) ana-
lyze solution and estimation techniques in Markov chain models in conjunction with perturbation
approximation methods. In Borovička and Hansen (2014), we introduce a tractable exponential-
quadratic framework that permits semi-analytical formulas for shock elasticities and encompasses
a large class of models solved using perturbation techniques.


4     Relation to impulse response functions
Impulse responses to specific structural shocks are a common way of representing the dynamic
properties of macroeconomic models. As we mentioned previously, this idea goes back at least to
Frisch (1933). Our elasticity computations change exposures of cash flows to shocks and explore
the consequences for valuation. These constructs are closely related and in some circumstances
are mathematically identical to impulse response functions. We explore these connections in this
section.
    To relate our elasticity calculation to an impulse response function, consider the conditional




                                                13
expectation                                                           
                                                Mt
                                       E                 | X0 , W1 = w
                                                M0
for alternative choices of w. Changing the value of w gives rise to the impulse response of Mt to
a shock at date one. Instead of conditioning on alternative realized values of the shock at date
one, as we have seen our computations are equivalent to changing the date zero distribution of W1 .
A similarity in perspectives emerges because this distributional change could include a mean shift
in the distribution for W1 . In practice, empirical macroeconomists typically study expectations
of the logarithms of macroeconomic time series, often using linear models. For asset pricing it is
important that we work with expectations of levels of macroeconomic quantities and cash flows,
and account for nonlinearities. To compute shock elasticities we are lead to study the impact on
the logarithm of the conditional expectation of Mt as developed in formula (7). In the remainder
of this section, we consider two special cases in which the link to impulse functions is particularly
close.

4.1     Lognormality
When M is a lognormal process, the impulse response functions for log M matches exactly our
shock elasticity as we will now see.
   A linear vector-autoregression (VAR) model is special case of the framework (1). Specifically
X is a linear vector-autoregression with autoregression coefficient matrix µ̄ and shock exposure
matrix σ̄:
                                     Xt+1 = µ̄Xt + σ̄Wt+1 .                                 (12)

We assume that the absolute values of eigenvalues of the matrix µ̄ are strictly less than one.
Analogously, we introduce a multiplicative process M (constructed in general form in (2)) with
evolution:
                            log Mt+1 − log Mt = β̄ · Xt + ᾱ · Wt+1 .                     (13)

The shock Wt+1 is distributed as a multivariate standard normal. With this construction of the
multiplicative process M , we first study the responses of log M .

4.1.1    Impulse response functions

Let ν(x) = ν̄ where ν̄ is a vector with norm one. In typical applications, ν̄ is a coordinate vector.
The impulse response function of Yt for the linear combination of shocks chosen by the vector ν̄ is
given by

        E [log Mt − log M0 | X0 = x, W1 = ν̄] − E [log Mt − log M0 | X0 = x, W1 = 0] = ν̄ · ̺¯t .

where the coefficients satisfy the recursions implied by (12) and (13). From (13), we have the
recursion:
                                                         ′
                                        ̺¯t+1 − ̺¯t = ζ̄t β̄                              (14)

                                                         14
with initial condition ̺¯1 = ᾱ, and from (12):

                                                                 ζ̄t+1 = µ̄ζ̄ t                                             (15)

with initial condition ζ̄1 = σ̄. Solving these recursions gives:

                                            ζ̄t = µ̄t−1 σ̄                                                                  (16)
                                                       h                   ′
                                           ̺¯t = ᾱ + (I − µ̄)−1 I − µ̄t−1 σ̄ β̄.

The impulse response function in the linear model is thus a sequence of deterministic coefficients
ν̄ · ̺¯t . The first term, ᾱ · ν̄, represents the immediate response arising from realization ν̄ of the
current shock while the remaining terms capture the subsequent propagation of the shock through
the dynamics of state vector X as it influences log M in the future.

4.1.2     Shock elasticities

Consider now our elasticity calculation. Write log Mt as its moving-average representation:

                                                       t−1
                                                       X
                                          log Mt =             ̺¯j · Wt−j + E (log Mt | F0 ) ,
                                                       j=0


or equivalently

                                               t
                                               X
                   log Mt − log M0 =                 ̺¯j · Wt−j+1 + E (log Mt − log M0 | X0 )
                                               j=1
                                               t−1
                                               X
                                          =          ̺¯j · Wt−j+1 + ̺¯t · W1 + E (log Mt − log M0 | X0 ) .
                                               j=1


Since the shocks Wt are independently distributed as a multivariate standard normals over time,
                                                                           
                                                        t−1
          Mt                                               1X
 E                 | X0 = x, W1 = w = exp                           ̺¯j · ̺¯j  exp (¯
                                                                                      ̺t · W1 ) exp (E [log Mt − log M0 | X0 ])
          M0                                               2
                                                               j=1


Using formula (8), we compute:
                                     h               i
                                          Mt
                                 E         W1 | X0 = x
                                          M0             E [exp (¯
                                                                 ̺t · W1 ) W1 | X0 = x]
                    ε (x, t) =        h           i =                                 = ̺¯t
                                        Mt
                                     E M0 | X0 = x             E  [exp (¯
                                                                        ̺t · W1 )]


The second equality follows by observing that

                                                            exp (¯
                                                                 ̺t · W1 )
                                                           E [exp (¯
                                                                   ̺t · W1 )]


                                                                       15
is strictly positive and has conditional expectation one. Multiplication by this random variable is
equivalent to changing the distribution of W1 from a multivariate standard normal to a multivariate
normal with mean ̺¯t . To summarize, in this lognormal case, the shock elasticities do not depend on
the Markov state and they coincide with the impulses responses measured by ν̄ · ̺¯t for t = 1, 2, . . ..
    Consider in particular the shock-price elasticity (6). Notice that this shock-price elasticity
consists of the difference of shock elasticities for G and SG, and thus we are lead to compute impulse
response functions for log G and log S + log G. The additivity of the construction implies that the
impulse response function coefficients for the latter are ν̄ · ̺¯s,t + ν̄ · ̺¯g,t , and thus the resulting
shock-price elasticity corresponds to the impulse response function of − log S, with coefficients
−ν̄ · ̺¯s,t .

4.1.3    Long-term pricing revisited

In this example, as discussed in Hansen et al. (2008) there is a close link between the factorization
described in Section 3.4 and the additive decompositions of linear time series. Beveridge and Nelson
(1981) and Blanchard and Quah (1989) extracted a martingale component in linear models and
used it to characterize the impact of permanent shocks.6
    Consider solving                                 
                                  M1
                             E          e (X1 ) | X0 = x = exp (η) e (x)
                                  M0
for the pair (e, η), where the evolution of M is given by (13). In this special case, a straightforward
calculation using formulas for lognormals gives:
                                                                   
                                                X∞
                                  log e(x) = E    β̄ · Xt+j |Xt = x
                                                    j=0

                                            = (β̄)′ (I − µ̄)−1 x,

and7
                                           1
                                        η = |ᾱ′ + β̄ ′ (I − µ̄)−1 σ̄|2 .
                                           2
    Under the change of measure associated with the martingale M f in the multiplicative factoriza-
tion, W1 has a mean equal to
                                       σ̄ ′ (I − µ̄′ )−1 β̄ + ᾱ

which is independent of the state vector. Notice that this is also the limiting value of ̺¯t as given
in (16). In this lognormal example
                                                                                       
              log Mt+1 − log Mt + log e(Xt+1 ) − log e(Xt ) = β̄ ′ (I − µ̄′ )−1 σ̄ + ᾱ′ Wt+1
  6
     Hansen (2012) constructs an additive decomposition of log M in a continuous-time version of our nonlinear
framework.
   7
     If we were to include a constant included in the evolution of log M , this would be added to η.




                                                       16
where the right-hand side gives the permanent shock to log M as constructed in Beveridge and
Nelson (1981) and Blanchard and Quah (1989). In VAR analyses, transitory shocks are typically
constructed as linear combinations of Wt+1 that are uncorrelated with this permanent shock. On
the other hand log e(Xt+1 ) and its innovation are typically correlated with the permanent shock.
    This simple connection between permanent shocks and permanent components to pricing ceases
to hold in more general nonlinear environments. Hansen (2012) has a more complete discussion
of the relation between the permanent component to log M and the martingale component to M
outside this lognormal specification.

4.2   Continuous-time diffusions
In this subsection, we focus on a framework with uncertainty modeled using Brownian shocks, and
apply it to models with financial constraints in Section 7. While the Brownian information setup
is not without loss of generality, it provides tools for a pedagogically transparent treatment and
shows the close connection between shock elasticities and impulse responses. In Borovička et al.
(2011) we also consider jumps in the form of regime shifts in continuous-time Markov chains and
applications to consumption-based asset pricing models.
    Let X be a Markov diffusion on X ⊆ Rn :

                                     dXt = µ(Xt )dt + σ(Xt )dWt

with initial condition X0 = x. Here, µ(x) is an n-dimensional vector and σ(x) is an n × k matrix for
each vector x in Rn . In addition W is a k-dimensional Brownian motion. We use this underlying
Markov process to construct a multiplicative process M via:
                                             Z     t                Z       t
                         log Mt = log M0 +             β(Xu )du +               α(Xu ) · dWu      (17)
                                               0                        0

where β(x) is a scalar and α(x) is a k-dimensional vector, or, in differential notation,

                                 d log Mt = β (Xt ) dt + α (Xt ) · dWt .                          (18)

Thus Mt depends on the initial conditions (X0 , M0 ) = (x, m) and the innovations to the Brownian
motion W between dates zero and t. Let {Ft : t ≥ 0} be the (completed) filtration generated by
the Brownian motion between time zero and time t along with any initial information captured
by F0 .
    As before, stochastic discount factors and cash flows in this environment are specific versions
of a multiplicative process M . This multiplicative process is exposed to two types of risk. The first
source of risk exposure is the ‘local’, or infinitesimal, risk in term α(Xu ) · dWu in (17). The second
source of risk comes from the time-variation in Xt and the state dependence of coefficients β (x)
and α (x), and is manifested over longer horizons.




                                                        17
4.2.1      Haussmann–Clark–Ocone formula

There is a natural counterpart to a moving-average representation for diffusions. Importantly,
the moving-average coefficients are, in general, state dependent. They entail computing so-called
Malliavin derivatives of the date-u shock to the process log Mt for t ≥ u, denoted Du log Mt . We
do not develop Malliavin differentiation as a formal mathematical construct but instead proceed
heuristically.8 This calculation of a Malliavin derivative gives the random response to a shock at
date u and is only restricted to be t-measurable where t ≥ u. By forming the date-u conditional
expectation we get the expected response as of the date of the shock. The computation is localized
by making the time interval over which the shock acts on the process log Mt arbitrarily small, which
allows for the formal construction of a derivative.
    The calculation of Du log Mt has two uses analogous to the lognormal example we examined
earlier. First, the (random) impulse response function for log M

               ̺t (X0 ) = ν(X0 ) · E (D0 log Mt | F0 ) = ν(X0 ) · E [D0 (log Mt − log M0 ) | X0 ]

for t ≥ 0 where ν(X0 ) determines which conditional linear combination of the shocks is subject
to an impulse. The resulting responses depend on conditioning information captured by X0 , in
contrast to lognormal models in which responses depend only on the horizon t ≥ 0. Relatedly
we obtain the Haussmann–Clark–Ocone formula for the process log M that cumulates the impact
shocks at various dates as a stochastic integral:
                                     Z       t
                          log Mt =               E (Du log Mt | Fu ) · dWu + E (log Mt | F0 ) .
                                         0

where we may think of E (Du log Mt | Fu ) as the counterpart to a coefficient vector in a moving-
average representation. These random variables satisfy recursions analogous to (14) and (15). For
a more detailed construction, see Borovička et al. (2014).
   We use the rules of Malliavin differentiation (analogous to more familiar forms of differentiation):

                                                     Du Mt = Mt Du log Mt ,

implying that the impulse response function for the process M is

                 ν(X0 ) · E (D0 Mt |F0 ) = ν(X0 ) · E (Mt D0 log Mt |F0 )
                                                                                         
                                                            Mt
                                         = M0 ν(X0 ) · E          D0 (log Mt − log M0 ) |X0
                                                            M0

for t ≥ 0.
  8
      For a textbook treatment of Malliavin calculus see Di Nunno and Øksendal (2009) or Nualart (2006).




                                                               18
4.2.2   Shock elasticities for diffusions

The construction of shock elasticities in Section 3 perturbs the cash flow by exposing it to a specified
shock in the next period. In the continuous-time model, we devise a perturbation of M over a short
time interval [0, r] and then study the implications as r ց 0. The resulting construction exploits
the local linearity of continuous-time models with Brownian shocks.
   Specifically, we construct the process H r such that
                                      Z       r∧t                            Z       r∧t
                                                                         1
                          log Htr =                 ν (Xu ) · dWu −                        |ν (Xu )|2 du.
                                          0                              2       0

where r ∧ t = min {r, t}. Notice that this process is exposed to the Brownian shock on the time
interval [0, r], with exposure vector ν (x), and stays constant after r. We assume that ν (x) is
restricted so that the process H r is a martingale. We use H r to construct the perturbed process
M H r:
                                                Z t               Z
                                                                1 r∧t
                   log Mt + log Htr = log M0 +       β(Xu )du −        |ν (Xu )|2 du
                                                  0             2   0
                                         Z t                Z r∧t
                                       +     α(Xu ) · dWu +       ν (Xu ) · dWu
                                                      0                                0

Notice that on the interval [0, r], the exposure of the perturbed process to the Brownian shock is

                                               [α(Xu ) + ν (Xu )] · dWu .

As r ց 0, we are perturbing log M over an arbitrarily small interval.
   As in Borovička et al. (2014), we define the shock elasticity for M at horizon t as
                                                                                                
                                            1                           Mt
                             ε (x, t) = lim log E                                Htr   | X0 = x
                                        rց0 r                           M0

and show that this limit can be expressed as
                                                                    
                                                   Mt
                                               D0 M  0
                                                      E |  X  0  = x
                           ε(x, t) = ν(x) ·   h                    i
                                                Mt
                                            E M    0
                                                       |  X  0  =  x
                                             h                                
                                                Mt
                                            E M  0
                                                      D  0  log  M t  | X 0 = x
                                   = ν(x) ·       h                      i      .                                                (19)
                                                       Mt
                                                E M       0
                                                               | X 0  =  x
                                                                                                       h                   i
                                                                                                            Mt
The first equality in (19) is a limiting version of (8) divided by E                                        M0       | X0 = x since the
                                                              Mt
Haussmann–Clark–Ocone formula applied to                      M0   has a contribution
                                                                  
                                                        Mt
                                          E          D0    | X0 = x dW0
                                                        M0


                                                               19
                                                                                                             
                                                                Mt                                Mt
for the date zero increment. The limiting covariance between M    0
                                                                    and dW  0 is therefore E   D0 M0 | X0 = x  .
From the second equality in (19), these elasticities coincide with the diffusion counterpart to impulse
responses D0 (log Mt − log M0 ) for log Mt − log M0 weighted by
                                                                 
                                                             Mt
                                                             M0
                                                   h                      i
                                                        Mt
                                               E        M0       | X0 = x

when averaging over future outcomes. For the lognormal model, the weighting is inconsequential. In
Borovička et al. (2011), we provide details of this derivation and some related calculations including
the following alternative formula relavent for computation:
                                                                       
                             .            ′   ∂           Mt
                     ε(x, t) = ν(x) · σ(x)       log E         | X0 = x + α(x) .                                 (20)
                                              ∂x          M0

    The shock-elasticity formula (20) has a natural interpretation. The sensitivity of the multi-
plicative process M to a shock in the next instant consists of two terms. The term α (x) represents
the direct impact of the Brownian shock on the evolution of M in expression (18). The partial
derivative with respect to x capture the sensitivity of the conditional expectation to movements in
the state vector, and it is multiplied by the exposure matrix σ (x) to express the sensitivity with
respect to the shock vector W . The use of the derivative of the logarithm in (18) justifies the term
shock elasticity. The instantaneous short term elasticity is α(x) · ν(x).9


5     Discrete-time formulas and approximation
In the preceding sections, we developed formulas for shock-price and shock-exposure elasticities
for a wide class of models driven by a state vector with Markov dynamics (1). We now present a
tractable implementation that, when applicable, makes the computations straightforward to apply.
The discussion draws on methods developed in Borovička and Hansen (2014).10 We also provide
Matlab software implementing the solution methods described in this section including a toolkit
that computes shock elasticities for models solved using Dynare.11
    We start by introducing a convenient exponential-quadratic framework that we use for modeling
the state vector X and the resulting multiplicative processes. In this framework, conditional expec-
tations of multiplicative processes and the shock elasticities are available in a convenient functional
form. We then consider a special class of approximate solutions to dynamic macroeconomic models
constructed using perturbation methods. We show how to approximate the equilibrium dynamics,
additive and multiplicative functionals, and the resulting shock elasticities. By construction, the
dynamics of these approximate solutions will be nested within the exponential-quadratic framework.
   9
     The instantaneous shock-price elasticity is −αs (x) · ν(x) which coincides with the notion of a risk price vector
that represents the compensation for exposure to Brownian increments.
  10
     See Nakamura et al. (2016) for another discrete-time implementation of these methods.
  11
     Dynare is a freely available Matlab/Octave toolkit for solving and analyzing dynamic general equilibrium models.
See http://www.dynare.org. Our software is available at http://borovicka.org/software.html.


                                                             20
5.1    Exponential-quadratic framework
We study dynamic systems for which the state vector can be partitioned as X = (X1′ , X2′ )′ where
the two components follow the laws of motion:

                  X1,t+1 = Θ10 + Θ11 X1,t + Λ10 Wt+1
                  X2,t+1 = Θ20 + Θ21 X1,t + Θ22 X2,t + Θ23 (X1,t ⊗ X1,t )
                                +Λ20 Wt+1 + Λ21 (X1,t ⊗ Wt+1 ) + Λ22 (Wt+1 ⊗ Wt+1 ) .                      (21)

We restrict the matrices Θ11 and Θ22 to have stable eigenvalues. Notice that the restrictions
imposed by the triangular structure imply that the process X1 is linear, while the process X2 is
linear conditional on the evolution of X1 .
    The class of multiplicative functionals M that interest us satisfies, for Y = log M , the restriction

                  Yt+1 − Yt = Γ0 + Γ1 X1,t + Γ2 X2,t + Γ3 (X1,t ⊗ X1,t )                                   (22)
                                   +Ψ0 Wt+1 + Ψ1 (X1,t ⊗ Wt+1 ) + Ψ2 (Wt+1 ⊗ Wt+1 ) .

In what follows we use a 1 × k2 vector Ψ to construct a k × k symmetric matrix sym [matk,k (Ψ)]
such that12
                              w′ (sym [matk,k (Ψ)]) w = Ψ (w ⊗ w) .

This representation will be valuable in some of the computations that follow. We use additive
functionals to represent stochastic growth via a technology shock process or aggregate consumption,
and to represent stochastic discounting used in representing asset values.
    The system (21)–(22) is rich enough to accommodate stochastic volatility, which has been
featured in the asset pricing literature and to a lesser extent in the macroeconomics literature. For
instance, the state variable X1,t can capture a linear process for conditional volatility, and X2,t the
conditional growth rate of cash flows. The coefficient Ψ1 in (22) then determines the time-variation
in the conditional volatility of the growth rate of M , while Λ21 in (21) impacts the conditional
volatility of the changes in the growth rate. In Section 5.2, we will map the solution obtained using
perturbation approximations into this framework as well.
    A virtue of parameterization (21)–(22) is that it gives quasi-analytical formulas for our dynamic
elasticities. The implied model of the stochastic discount factor has been used in a variety of
reduced-form asset pricing models. Later we will use an approximation to deduce this dynamical
system.
    We illustrate the convenience of this functional form by calculating the logarithms of conditional
expectations of multiplicative functionals of the form (22). Consider a function that is linear-
  12
    In this formula matk,k (Ψ) converts a vector into a k × k matrix and the sym operator transforms this square
matrix into a symmetric matrix by averaging the matrix and its transpose. Appendix A introduces convenient
notation for the algebra underlying the calculations in this and subsequent sections.




                                                      21
quadratic in x = (x′1 , x′2 )′ :

                                      log f (x) = Φ0 + Φ1 x1 + Φ2 x2 + Φ3 (x1 ⊗ x1 )                            (23)

Then conditional expectations are of the form:
                                                        
                        Mt+1
           log E                   f (Xt+1 ) | Xt = x           = log E [exp (Yt+1 − Yt ) f (Xt+1 ) | Xt = x]
                         Mt
                                                                = Φ∗0 + Φ∗1 x1 + Φ∗2 x2 + Φ∗3 (x1 ⊗ x1 )
                                                                = log f ∗ (x)                                   (24)

where the formulas for Φ∗i , i = 0, . . . , 3 are given in Appendix A. This calculation maps a function
f into another function f ∗ with the same functional form. Our multi-period calculations exploit
this link. For instance, repeating these calculations compounds stochastic growth or discounting.
Moreover, we may exploit the recursive Markov construction in (24) initiated with f (x) = 1 to
obtain:                                    
                           Mt
                  log E          | X0 = x = Φ∗0,t + Φ∗1,t x1 + Φ∗2,t x2 + Φ∗3,t (x1 ⊗ x1 )
                           M0
for appropriate choices of Φ∗i,t .

5.1.1    Shock elasticities

To compute shock elasticities given in (8) under the convenient functional form, we construct:
                        h               i  h  h         i              i
                    E        Mt
                              W1 | X0 = x
                             M0             E M 1
                                               M0  E Mt
                                                     M1  | X1   W 1 | X0 = x
                         h           i =     h                     i .
                           Mt                     M1  Mt
                        E M0 | X0 = x         E M0 E M1 | X1 | X0 = x

Notice that the random variable:
                                                                                  
                                                               M1               Mt
                                                               M0       E       | X1
                                                                                M1
                                         L1,t =       h                               i                     (25)
                                                           M1        Mt
                                                  E        M0        M1     | X1 | X0 = x

has conditional expectation one. Multiplying this positive random variable by W1 and taking
expectations is equivalent to changing the conditional probability distribution and evaluating the
conditional expectation of W1 under this change of measure. Then under the transformed measure,
using a complete-the-squares argument we may show that W1 remains normally distributed with
a covariance matrix that is no longer the identity and a mean conditioned on X0 = x that is
affine in x1 . The formulas are given in Appendix B. Thus the shock elasticity function ε (x, t)
can be computed recursively using formulas that are straightforward to implement. We show in
Appendix B that the resulting shock elasticity function is also affine in the state x1 .




                                                                    22
5.2     Perturbation methods
In macroeconomic models, the equilibrium Markov dynamics (1) is typically ex-ante unknown and
needs to be solved for from a set of equilibrium conditions. We now describe a solution method
for dynamic general equilibrium models that yields a solution in the form of an approximate law of
motion that is a special case of the exponential-quadratic functional form analyzed in Section 5.1.
This solution method, based on Holmes (1995) and Lombardo and Uhlig (2014), constructs a
perturbation approximation where the first- and second-order terms follow the restricted dynamics
(21).
    For the purposes of approximation, we consider a family of models parameterized by q and
study first- and second-order approximations around this limit system in which q = 0. For each q,
we consider the system (equations

                        0 = E (g [Xt+1 (q) , Xt (q) , Xt−1 (q) , qWt+1 , qWt , q] | Ft ) .                   (26)

The q = 0 equation system is one without shocks, and more generally small values q will make the
shocks less consequential. There are well-known saddle-point stability conditions on the system
(26) that lead to a unique equilibrium of the linear approximation (see Blanchard and Kahn (1980)
or Sims (2002)) and we assume that these are satisfied. Following Holmes (1995) and Lombardo
and Uhlig (2014), we form an approximating system by deducing the dynamic evolution for the
pathwise derivatives with respect to q and evaluated at q = 0. Our derivation will be admittedly
heuristic as is much of the related literature in macroeconomics.
   To build a link to the parametrization in Section 5.1, we feature a second-order expansion:

                                                                  q2
                                      Xt (q) ≈ X0,t + qX1,t +        X2,t .
                                                                  2

where Xm,t is the m-th order, date t component of the stochastic process. We abstract from
the dependence on initial conditions by restricting each component process to be stationary. Our
approximating process will similarly be stationary.13 The expansion leads to laws of motion for the
component processes X1,· and X2,· . The joint process (X1,· , X2,· ) will again be Markov, although
the dimension of the state vector under the approximate dynamics doubles.

5.2.1    Approximating state vector dynamics

While Xt (q) serves as a state vector in the dynamic system (26), the state vector itself depends
on the parameter q. Suppose that Ft is the σ-algebra generated by the infinite history of shocks
{Wj : j ≤ t}. For each dynamic system, we presume that the state vector Xt (q) is Ft measurable
and that in forecasting future values of the state vector conditioned on Ft it suffices to condition
on Xt . Although Xt (q) depends on q, the construction of Ft does not. We now construct the
  13
     As argued by Lombardo and Uhlig (2014), this approach is computationally very similar to the pruning approach
described by Kim et al. (2008) or Andreasen et al. (2010).




                                                       23
dynamics for each of the component processes. The result will be a recursive system that has the
same structure as the triangular system (21).
   Define x̄ to be the solution to the equation:

                                             x̄ = ψ(x̄, 0, 0),

which gives the fixed point for the deterministic dynamic system. We assume that this fixed point
is locally stable. That is ψx (x̄, 0, 0) is a matrix with stable eigenvalues, eigenvalues with absolute
values that are strictly less than one. Then set

                                                X0,t = x̄

for all t. This is the zeroth-order contribution to the solution constructed to be time-invariant.
    In computing pathwise derivatives, we consider the state vector process viewed as a function
of the shock history. Each shock in this history is scaled by the parameter q, which results in a
parameterized family of stochastic processes. We compute derivatives with respect to this param-
eter where the derivatives themselves are stochastic processes. Given the Markov representation
of the family of stochastic processes, the derivative processes will also have convenient recursive
representations. In what follows we derive these representations.
    Using the Markov representation, we compute the derivative of the state vector process with
respect to q, which we evaluate at q = 0. This derivative has the recursive representation:

                                   X1,t+1 = ψq + ψx X1,t + ψw Wt+1

where ψq , ψx and ψw are the partial derivative matrices:

                        . ∂ψ                  . ∂ψ                   . ∂ψ
                     ψq =    (x̄, 0, 0),   ψx =     (x̄, 0, 0),   ψw =     (x̄, 0, 0).
                          ∂q                    ∂x′                    ∂w′

In particular, the term ψw Wt+1 reveals the role of the shock vector in this recursive representation.
Recall that we have presumed that x̄ has been chosen so that ψx has stable eigenvalues. Thus
the first derivative evolves as a Gaussian vector autoregression. It can be expressed as an infinite
moving average of the history of shocks, which restricts the process to be stationary. The first-order
approximation to the original process is:

                                            Xt ≈ x̄ + qX1,t .

In particular, the approximating process on the right-hand side has x̄ + q(I − ψx )−1 ψq as its
unconditional mean.
   We compute the pathwise second derivative with respect to q recursively by differentiating
the recursion for the first derivative. As a consequence, the second derivative has the recursive




                                                    24
representation:

       X2,t+1 = ψqq + 2 (ψxq X1,t + ψwq Wt+1 ) +                                                    (27)
                    +ψx X2,t + ψxx (X1,t ⊗ X1,t ) + 2ψxw (X1,t ⊗ Wt+1 ) + ψww (Wt+1 ⊗ Wt+1 )

where matrices ψij denote the second-order derivatives of ψ evaluated at (x̄, 0, 0) and formed using
the construction of the derivative matrices described in Appendix A.2. As noted by Schmitt-Grohé
and Uribe (2004), the mixed second-order derivatives ψxq and ψwq are often zero using second-order
refinements to the familiar log approximation methods.
    The second-derivative process X2,· evolves as a stable recursion that feeds back on itself and
depends on the first derivative process. We have already argued that the first derivative process X1,t
can be constructed as a linear function of the infinite history of the shocks. Since the matrix ψx has
stable eigenvalues, X2,t can be expressed as a linear-quadratic function of this same shock history.
Since there are no feedback effects from X2,t to X1,t+1 , the joint process (X1,· , X2,· ) constructed in
this manner is necessarily stationary.
    The dynamic evolution for (X1,· , X2,· ) is a special case of the the triangular system (21) given
in Section 5.1. When the shock vector Wt is a multivariate standard normal, we can utilize results
from Section 5.1 to produce exact formulas for conditional expectations of exponentials of linear-
quadratic functions in (X1,t , X2,t ). We exploit this construction in the subsequent subsection. For
details on the derivation of the approximating formulas see Appendix A.

5.3   Approximating the evolution of a stationary increment process
Consider the approximation of a parameterized family of multiplicative processes with increments
given by:
                         log Mt+1 (q) − log Mt (q) = κ[Xt (q), qWt+1 , q]

and an initial condition log M0 . We use the function κ in conjunction with q to parameterize
implicitly a family of additive functionals. We approximate the resulting additive functionals by

                                                                q2
                             log Mt ≈ log M0,t + q log M1,t +      log M2,t
                                                                2

where the processes on the right-hand side have stationary increments.
   Following the steps of our approximation of X, the recursive representation of the zeroth-order
contribution to Y is
                                                                   .
                               log M0,t+1 − log M0,t = κ(x̄, 0, 0) = κ̄;

the first-order contribution is

                            log M1,t+1 − log M1,t = κq + κx X1,t + κw Wt+1

where κx and κw are the respective first derivatives of κ evaluated at (x̄, 0, 0); and the second-order


                                                   25
contribution is

log M2,t+1 − log M2,t = κqq + 2 (κxq X1,t + κwq Wt+1 ) +
                           +κx X2,t + κxx (X1,t ⊗ X1,t ) + 2κxw (X1,t ⊗ Wt+1 ) + κww (Wt+1 ⊗ Wt+1 )

where the κij ’s are the second derivative matrices constructed as in Appendix A.2. The resulting
component additive functionals are special cases of the additive functional given in (22) that we
introduced in Section 5.1.

5.3.1    Approximating shock elasticities

We could compute corresponding second-order approximations for the elasticities of multiplicative
processes. Alternatively, since the approximating processes satisfy the structure given in section
5.1, we have the formulas that we described earlier at our disposal and the supporting software.
See Borovička and Hansen (2014) for further discussion.

5.4     Related approaches
There also exist ad-hoc approaches which mix orders of approximation for different components of
the model or state vector. The aim of these methods is to improve the precision of the approxi-
mation along specific dimensions of interest, while retaining tractability in the computation of the
derivatives of the function ψ. Justiniano and Primiceri (2008) use a first-order approximations but
augment the solution with heteroskedastic innovations. Benigno et al. (2010) study second-order
approximations for the endogenous state variables in which exogenous state variables follow a condi-
tionally linear Markov process. Malkhozov and Shamloo (2011) combine a first-order perturbation
with heteroskedasticity in the shocks to the exogenous process and corrections for the variance
of future shocks. These solution methods are designed to produce nontrivial roles for stochastic
volatility in the solution of the model and in the pricing of exposure to risk. The approach of
Benigno et al. (2010) or Malkhozov and Shamloo (2011) give alternative ways to construct the
functional form used in Section 5.1.

5.5     Recursive utility investors
The recursive utility preference specification of Kreps and Porteus (1978), Epstein and Zin (1989)
warrant special consideration. By design, this specification of preferences avoids presuming that
investors reduce intertemporal, compound consumption lotteries. Instead investors may care about
the intertemporal composition of risk. It is motivated in part by an aim to allow for risk aversion
to be altered without changing the elasticity of intertemporal substitution. Anderson et al. (2003),
Maenhout (2004) and others extend the literature on risk-sensitive control by Jacobson (1973),
Whittle (1990) and others and provide a “concern for robustness” interpretation of the utility
recursion. Under this alternative interpretation the decision maker explores the potential misspec-
ification of the transition dynamics as part of the decision-making process. This perspective yields


                                                26
a substantially different interpretation of the utility recursion. In establishing these connections
in the control theory and economics literatures, it is sometimes advantageous to parameterize the
utility recursion in a manner that depends explicitly on the parameter q. Borovička and Hansen
(2013) and Bhandari et al. (2016) explore the resulting implications for approximations analogous
to those studied here. Among other things, they provide a rationale for the first-order adjust-
ments for recursive utility as suggested by Tallarini (2000), and they show novel ways in which
higher-order adjustments are more impactful.


6     Continuous-time approximation
Many interesting macroeconomic models specified in continuous time, including those we analyze
in Section 7, require the application of numerical solution techniques. In the construction of shock
elasticities, the central object of interest is the conditional expectation of M in (19). Consider the
more general problem                                                
                                        .        Mt
                                 φt (x) = E           φ0 (Xt ) | X0 = x .                         (28)
                                                 M0
with a given function φ0 . The conditional expectation of M is obtained by setting φ0 (x) ≡ 1.

6.1   An associated partial differential equation
For the purposes of computation, we evaluate φt recursively. Given φt−∆t for small ∆t, exploit-
ing the time homogeneity of the underlying Markov process and applying the Law of Iterated
Expectations gives:                                              
                                       M∆t
                         φt (x) = E           φt−∆t (X∆t ) | X0 = x
                                        M0
Itô’s lemma applied to the product in the conditional expectation gives the linear, second-order
partial differential equation:
                                                         
                      ∂               1      2         ∂
                         φt =     β + |α (x)| φt +        φt · (µ + σα ) +                       (29)
                      ∂t              2                ∂x
                                                  
                                  1         ∂
                                 + tr σ ′        φt σ
                                  2       ∂x∂x′

with terminal condition φ0 where tr(·) denotes the trace of the matrix argument. Equation (29)
is a generalization of the Kolmogorov backward equation for multiplicative processes of the type
(17). The resulting partial differential equation can be solved using standard numerical techniques
for differential equations.

6.2   Martingale decomposition and a change of measure
To study the long-run implications for pricing, we proposed the extraction of a martingale compo-
nent from the dynamics of the stochastic discount factors and cash flows by solving the Perron–
Frobenius equation (9) for the strictly positive eigenfunction e (x) and the associated eigenvalue η .

                                                 27
In the Markov diffusion setup we localize this problem by computing

                                    E [Mt e(Xt )| X0 = x] − exp(ηt)e(x)
                                lim                                     = 0.
                                t→0                  t

Defining the infinitesimal operator

                                             . d
                                      Bf (x) =    E [Mt f (Xt )| X0 = x]
                                               dt                           t=0

we have                                                                  
                                      1 2                 ∂f  1         2
                                                                     ′ ∂ f
                        Bf =       β + |α| f + (σα + µ) ·    + tr σσ
                                      2                   ∂x 2        ∂x∂x′
and we can write the limiting Perron–Frobenius equation as

                                                      Be = ηe                                                   (30)

which is a second-order partial differential equation for the function e (x) and a number η. Equa-
tion (30) is known as the Sturm–Liouville equation. Notice that it is identical to the partial
differential equation (29) when we are looking for an unknown discounted stationary function
φt (x) = exp (ηt) e (x) with initial condition φ0 (x) = e (x). As before, there are typically multiple
strictly positive solutions to this equation. Hansen and Scheinkman (2009) show that there is at
most one such solution that preserves stochastic stability of the state vector X. We implicitly
assume that we always choose such a solution.14
    In line with the discussion from Section 3.4, we can now define the martingale M  f as15

                                           ft .
                                           M              e (Xt ) Mt
                                              = exp (−ηt)            .                                          (31)
                                           f
                                           M0             e (X0 ) M0

Applying Itô’s lemma, we find that

                                          ft = α              1
                                    d log M    e (Xt ) · dWt − |e
                                                                α (Xt )| dt
                                                              2

with                                                                   
                                                  ′ ∂
                                      α
                                      e (x) = σ (x)    log e (x) + α (x) .
                                                    ∂x

This implies that under the probability measure Pe, the Brownian motion evolves as

                                             dWt = α           ft
                                                   e (x) dt + dW
  14
     See also Borovička et al. (2015), Qin and Linetsky (2014a), Qin et al. (2016), Walden (2014) or Park (2015) for
problems closely related to solving for the eigenvalue-eigenfunction pair (η, e).
  15
      We note that the solution obtained using the localized version of the Perron–Frobenius problem may yield a
process Mf that is only a local martingale. See Hansen and Scheinkman (2009) and Qin and Linetsky (2014b) for
details and additional assumptions that assure M f is a martingale. We will assume that such conditions are satisfied
in the discussion that follows.



                                                         28
where Wf is a Brownian motion under Pe. It also implies that we can write the dynamics of the
state vector under the change of measure as

                          dXt = [µ (Xt ) + σ (Xt ) α                      ft .
                                                   e (Xt )] dt + σ (Xt ) dW

   Inverting equation (31), we obtain the analog of the martingale decomposition in discrete time:

                                         Mt                    ft
                                                       e (X0 ) M
                                            = exp (ηt)            .                             (32)
                                         M0                    f0
                                                       e (Xt ) M

    To implement the factorization of the multiplicative functional M , we compute the strictly pos-
itive eigenfunction e (x) and the associated eigenvalue η by solving the Perron–Frobenius problem
(30). Since analytical solutions are often not available, we must rely on numerical methods. Pryce
(1993) gives various numerical solution techniques for this problem. Notice that since there are
typically infinitely many strictly positive solutions e (x), it is necessary determine which of these
solutions is the relevant one.
    An alternative approach is to utilize the time-dependent PDE (29) and exploit the fact that η
is the principal eigenvalue, i.e., one associated with the most durable component. In that case, one
can start with an initial condition φ0 (x) that serves as a guess for the eigenfunction, and iterate
on (29) to solve for φt (x) as t → ∞. For large t, the solution should behave as

                                           φt (x) ≈ exp (ηt) e (x)

and thus
                         ∂                         1
                    η=      log φt (x)         ≈      [log φt+∆t (x) − log φt (x)]
                         ∂t              t→∞       ∆t                                t→∞

and since the eigenfunction is only determined up to scale, we can use any proportional rescaling
of φt as e (x) ≈ exp(−ηt)φt (x)|t→∞ .

6.3   Long-term pricing
We now apply the decomposition (32) in the shock elasticity formula (19) to obtain:
                                                                                
                   .            ′   ∂              ∂      e      1
           ε(x, t) = ν(x) · σ(x)       log e (x) +    log E           | X0 = x + α(x) .
                                    ∂x             ∂x         e (Xt )

Taking the limit as t → ∞, the conditional expectation in brackets converges to a constant provided
that we select a martingale that induces a probability measure under which X is stochastically
stable. See Hansen and Scheinkman (2009) and Hansen (2012) for further discussion. Therefore,
                                                                         
                                                       ∂     ′
                           lim ε (x, t) = ν (x) · σ(x)    log e (x) + α(x) .
                          t→∞                          ∂x




                                                        29
6.4      Boundary conditions
The construction of shock elasticity functions requires solving the conditional expectations of M , for
instance, by solving the partial differential equation (29). This requires proper specification of the
boundary conditions not only in terms of the terminal condition φ0 (x) but also at the boundaries
of the state space for the state vector Xt . The boundary behavior of the diffusion X is a central
and often economically important part of the equilbrium, as we will see in the models with financial
frictions discussed in Section 7. In those models, the state variable is a univariate diffusion and
there are well understood characterizations of the boundary behavior based on the classical Feller
boundary classification.16 The textbook treatment of the boundary conditions for problem (28)
typically abstracts from the impact of the multiplicative process M . While a detailed discussion
of the boundary characterization is beyond the scope of this chapter, we briefly discuss how the
inclusion of M can alter the analysis. In what follows, we utilize the martingale decomposition
introduced in Section 3.4 and draw connections to the treatment of boundaries for scalar diffusions.
    We represent the conditional expectation (32) using a Kolmogorov equation under the change
of measure induced by M f. Using the martingale factorization (32) we write (28) as
                                      "                                   #
                                   .                    ft
                                                e (X0 ) M
                            φt (x) = E exp (ηt)            φ (X ) | X0 = x .
                                                        f0 0 t
                                                e (Xt ) M

Define                                                        
                      .           φt (x)  e   φ0 (Xt )            e [ψ0 (Xt ) | X0 = x]
               ψt (x) = exp (−ηt)        =E            | X0 = x = E                                           (33)
                                  e (x)       e (Xt )
with the initial condition ψ0 (x) = φ0 (x) /e (x). This converts the boundary condition problem
into a standard Kolmogorov backward equation (equation (28) with M ≡ 1), albeit under the
probability measure Pe. Under Pe, the diffusion X satisfies the law of motion

                          dXt = µ                      ft .
                                 e (Xt ) dt + σ (Xt ) dW
                                                       ∂
                         e (x) = µ (x) + σ (x) σ ′ (x)
                         µ                                log e (x) + σ (x) α (x)
                                                       ∂x

and the associated generator
                                                           2   
                                      e       ∂f  1      ′ ∂ f
                                      Bf = µ
                                           e·    + tr σσ
                                              ∂x 2        ∂x∂x′

corresponds to the generator of a diffusion with infinitesimal variance σ 2 (x) and infinitesimal mean
e (x) under Pe.
µ
    The boundary characterization under Pe and the associated boundary conditions for ψt (x) follow
from formulas from Section 6.4. The character of the boundary can change under Pe, although a
reflecting boundary remains reflecting to preserve local equivalence of measures P and Pe. Observe
  16
     See the seminal work by Feller (1952, 1957). Karlin and Taylor (1981), Borodin and Salminen (2002) or Linetsky
(2008) offer summarizing treatments.



                                                        30
that equation (33) introduces a relationship between the conditional expectation given by φt (x)
and the eigenfunction e(x). For instance, when the boundary point xb is reflecting, the appropriate
boundary condition is17
                                         ∂
                                           ψt (x)      = 0.
                                        ∂x        x=xb

When both φt (x) and e(x) are strictly positive at the boundary, this implies that

                                     ∂                          ∂
                                        log φt (x)          =      log e (x)
                                     ∂x              x=xb       ∂x             x=xb

equalizing logarithmic slopes of the conditional expectation (28) and the eigenfunction e(x) at the
boundary.


7        Models with financial constraints in continuous time
Recently, there has been renewed interest in nonlinear stochastic macroeconomic models with fi-
nancing restrictions. The literature was initiated by Bernanke and Gertler (1989) and Bernanke
et al. (1999), and it has been revived and extended since the advent the financial crisis. Continuous-
time models have been featured in He and Krishnamurthy (2013), Brunnermeier and Sannikov
(2014), Di Tella (2015), Moreira and Savov (2016), Adrian and Boyarchenko (2012), or Klimenko
et al. (2016). Differential equation methods give the equilibrium solutions, and the resulting dynam-
ics exhibit quantitatively substantial nonlinearity. The nonlinearity emerges because of financing
constraints that bind only in a specific part of the state space.18
    To preserve tractability, models typically assume a low-dimensional specification of the state
space. In this section, we analyze two such models, He and Krishnamurthy (2013) and Brunnermeier
and Sannikov (2014). Both models utilize frameworks that are judiciously chosen to lead to a scalar
endogenous state variable that follows the diffusion

                                         dXt = µ (Xt ) dt + σ (Xt ) dWt .                                          (34)

The endogenous state represents the allocation of wealth between households and financial experts,
capturing the capitalization of the financial sector relative to the size of the economy. When the
capitalization is low, the financial constraint is binding, and asset valuations are more sensitive to
aggregate shocks.
   Both papers also feature an exogenous process that introduces aggregate risk into their model
economies. He and Krishnamurthy (2013) construct an endowment economy with a permanent
shock to the aggregate dividend. On the other hand, Brunnermeier and Sannikov (2014) feature
endogenous capital accumulation with a a shock to the quality of the capital stock. In this section,
we utilize the continuous-time tools developed in Section 6 to study the state-dependence in asset
    17
    This assumes that the so called scale measure is finite at the boundary, see, e.g., Borodin and Salminen (2002).
    18
    See Bocola (2016) or Bianchi (2016) for discrete-time models solved using global to account for financing constraint
that binds only occasionally.


                                                          31
pricing implications of the two models. We refer the reader to the respective papers for a detailed
discussions of the underlying economic environments.

7.1     Stochastic discount factors
Stochastic discount factors and priced cash flows in the models we analyze can be written as special
cases of multiplicative functionals introduced in Section 4.2:

                                 d log St = β (Xt ) dt + α (Xt ) · dWt .                                        (35)

with coefficients β(x) and α(x) determined in equilibrium. In an arbitrage-free, complete market
environment, there exists a unique stochastic discount factor that represents the prices of the traded
securities.
    In economies with financial market imperfections and constraints, this ceases to be true. There
are two key features that are of interest to us. First, financial markets in these economies are
segmented, and different investors can own specific subsets of assets. This implies the existence of
alternative stochastic discount factors for individual investors that have to agree only on prices of
assets traded between investors. Second, assets are valuable not only for their cash flows but also
because their ownership can relax or tighten financing constraints faced by individual investors.
Given the potential for these constraints to be binding, asset values include contributions from the
shadow prices of these constraints.

7.2     He and Krishnamurthy (2013)
He and Krishnamurthy (2013) construct an economy populated by two types of agents, specialists
and households. There are two assets in the economy, a safe asset earning an infinitesimal risk-free
rate rt and a risky asset with return Rt that is a claim on aggregate dividend
                                                 
                                              1 2             .
                         d log Dt =       gd − σd dt + σd dWt = β̄d dt + ᾱd dWt .                              (36)
                                              2

7.2.1    Households and specialists

Households have logarithmic preferences and therefore consume a constant fraction of their wealth,
Cth = ρAht , where ρ is the time-preference coefficient. A fraction λ of households can only invest
into the safe asset, while a fraction 1 − λ invests a share αht of their wealth through an interme-
diary managed by the specialists who holds a portfolio with return dR    et . Aggregate wealth of the
households therefore evolves as
                                                                                                        
                  dAht   = ℓDt −   ρAht        dt +   Aht rt dt   +   αht   (1 −   λ) Aht        e
                                                                                                dRt − rt dt .

where ℓDt is households’ income, modeled as a constant share ℓ of the dividend.




                                                            32
   Specialists are endowed with CRRA preferences over their consumption stream Ct with risk
aversion coefficient γ and trade both assets. Their stochastic discount factor is
                                                            −γ
                                        St              Ct
                                           = e−ρt                  .                             (37)
                                        S0              C0

This stochastic discount factor also prices all assets traded by specialists. The law of motion for
their wealth is given by                                             
                            dAt = −Ct dt + At rt dt + At dR et − rt dt .

    The intermediary combines all wealth of the specialists At with the households’ wealth invested
through the intermediary αht (1 − λ) Aht and invests a share αt of the combined portfolio into the
risky asset. The return on the intermediary portfolio then follows

                                    et = rt dt + αt (dRt − rt dt) .
                                   dR

The risky asset market clears, so that the wealth invested into the risky asset equals the market
price of the asset, Pt                                  
                                  αt At + αht (1 − λ) Aht = Pt .

7.2.2   Financial friction

The critical financial friction is introduced into the portfolio choice of the household. Motivated
by a moral hazard problem, the household is not willing to invest more than a fraction m of the
specialists’ wealth through the intermediary, which defines the intermediation constraint

                                       αht (1 − λ) Aht ≤ mAt .                                   (38)

Because of logarithmic preferences, the portfolio choice αht of the household is static. The household
is also not allowed to sell short any of the assets, so that it solves
                             h                i     2    h                 i
                               et − rt dt | Ft − 1 αht V ar dR
                    max αht E dR                             et − rt dt | Ft
                   αh
                    t ∈[0,1]
                                                 2

subject to the intermediation constraint (38).
    The parameter m determines the tightness of the intermediation constraint. This constraint
will be endogenously binding when the wealth of the specialists becomes sufficiently low relative to
the wealth of the household. In that case, risk sharing partially breaks down and the specialists will
have to absorb a large share of the risky asset in their portfolio. As an equilibrium outcome, risk
premia increase and the wealth of the specialists becomes more volatile, which in turn induces larger
fluctuations of the right-hand side of the constraint (38). Without the intermediation constraint,
the model reduces to an endowment economy populated by agents solving a risk-sharing problem
with portfolio constraints.



                                                 33
7.2.3   Equilibrium dynamics

The equilibrium in this model is conveniently characterized using the wealth share of the specialists,
    .
Xt = At /Pt ∈ (0, 1), that will play the role of the single state variable with endogenously determined
dynamics (34) where the coefficients µ (x) and σ (x) are given by the relative wealth accumulation
rates of households and specialists, and the equilibrium price of the claim on the risky cash flow.
He and Krishnamurthy (2013) show that both boundaries {0, 1} are entrance boundaries.
    Given the homogeneity in the model, we can write the consumption of the specialists as
                                                                                     
                                                                  C h Ah Pt
                        Ct   = Dt (1 + ℓ) −     = Dt (1 + ℓ) − th t
                                                    Cth
                                                                  At Pt Dt
                             = Dt [(1 + ℓ) − ρ (1 − Xt ) π (Xt )]

where π (x) is the price-dividend ratio for the claim on the dividend stream. The price-dividend
ratio is determined endogenously as part of the solution to a set of differential equations. Given a
solution for the price-dividend ratio π (x), we construct the stochastic discount factor (37).
    The top row of Figure 1 shows the drift and volatility coefficients of the state variable process
X, and the associated stationary density. When the specialists’ wealth share Xt is low (below
x∗ = 0.091), the intermediation constraint binds. As Xt → 0, the intermediation capacity of the
specialists decreases, which increases the expected return on the risky asset, thereby increasing the
rate of wealth accumulation of the specialists. On the other hand, when Xt → 1, the economy is
unconstrained, risk premia are low, and situation reverses. The drift coefficient µ (x) in the top left
panel reflects these effects.
    In the moment when the constraints start binding (to the left of the point x∗ = 0.091), volatility
σ(x) of the experts’ wealth share starts rising. Ultimately, this volatility has to decline to zero as
Xt → 0 to prevent the experts’ wealth share from hitting the zero boundary with a positive
probability, but the volatility of experts’ wealth level keeps rising as we approach the boundary.

7.2.4   Stochastic discount factor and cash flows

Aggregate dividend Dt in (36) follows a geometric Brownian motion with drift. This directly implies
a constant shock-exposure elasticity
                                           εd (x, t) = σd .

Time-variation in expected returns on the claim on the aggregate dividend thus must come solely
from the time-variation in prices of risk. In particular, the consumption process of specialists is:
                                                                             
                             Ct         Dt        (1 + ℓ) − ρ (1 − Xt ) π (Xt )
                                =                                                 .               (39)
                             C0         D0        (1 + ℓ) − ρ (1 − X0 ) π (X0 )

Notice that the consumption of specialists has the same long-term stochastic growth as the aggregate
dividend process. Since the dividend process D is a geometric Brownian motion, we immediately




                                                          34
                    drift and volatility for Xt                                     stationary density for Xt
   0.05                                                             12
                                                        µ(x)
                                                        σ(x)        10

  0.025                                                              8

                                                                     6

     0                                                               4

                                                                     2

−0.025                                                               0
          0   0.2         0.4        0.6          0.8          1          0   0.2        0.4        0.6         0.8         1

               shock-exposure elasticity for Ct                                shock-price elasticity for for Ct
    0.4                                                             0.8
                                    short-horizon εc (x, 0)                                       short-horizon εp (x, 0)
                                    long-horizon εc (x, ∞)                                        long-horizon εp (x, ∞)
    0.3                                                             0.6


    0.2                                                             0.4


    0.1                                                             0.2


     0                                                               0
          0   0.2         0.4       0.6           0.8          1          0   0.2        0.4       0.6          0.8         1
                        state Xt = At /Pt                                              state Xt = At /Pt


Figure 1: Dynamics of the experts’ wealth share Xt = At /Pt (horizontal axis), shock-exposure and
shock-price elasticities for the He and Krishnamurthy (2013) model. Top left panel shows the drift
and volatility coefficients for the evolution of Xt , while top right panel the stationary density for
Xt . Panels in the bottom row show the short- and long-horizon shock elasticity for the experts’
consumption process Ct . The intermediation constraint (38) binds in the interval Xt ∈ (0, 0.091),
and x∗ = 0.091 corresponds to the 35.3% quantile of the stationary distribution of Xt .


obtain the martingale factorization of C with

                                    ec (x) = [(1 + ℓ) − ρ (1 − x) π (x)]−1
                                           ηc = gd
                                        et = exp (−ηc t) Dt
                                        C

where C e is the martingale component of C. Analogously, the stochastic discount factor of the
specialists (37) is decomposed as

                                     es (x) = [(1 + ℓ) − ρ (1 − x) π (x)]γ
                                                            1
                                         ηs = −ρ − γgd + σd2 γ (γ + 1)
                                                            2
                                         Set = exp [(−ηs − ρ) t] (Dt )−γ


                                                               35
                shock-exposure elasticity for Ct                                         shock-price elasticity for Ct
0.25                                                                 0.5
                                                                                                  x = 0.050 (5th percentile)
 0.2                                                                 0.4                          x = 0.091 (35.3th percentile)
                                                                                                  x = 0.270 (95th percentile)
0.15                                                                 0.3

 0.1                                                                 0.2

0.05                                                                 0.1

   0                                                                  0
       0   10   20   30    40 50 60 70         80    90   100              0   10   20     30    40 50 60 70             80   90   100
                          maturity (years)                                                      maturity (years)


Figure 2: Shock-exposure and shock-price elasticities for the He and Krishnamurthy (2013) model.
Individual lines correspond to alternative choices of the current state, the experts’ wealth share
X0 = x. The blue solid line represents the state in which the intermediation constraint (38) starts
binding (x = 0.091, corresponding to the 35.3% quantile of the stationary distribution of Xt . The
red dashed line corresponds to the 5% quantile of the stationary distribution of Xt (intermediation
constraint tightly binding) while the red dotted line corresponds to the 95% quantile.


where Se is the martingale component.
    These factorization results indicate a simple form for the long-horizon limits of the shock elas-
ticities. The consumption and dividend processes share the same martingale component, and thus,
assuming ν (x) = 1, their shock-exposure elasticities imply

                                          lim εc (x, t) = lim εd (x, t) = σd .
                                         t→∞                    t→∞

Similarly, the shock-price elasticities for the two cash-flow processes have the common long-horizon
limit
                                            lim εp (x, t) = γσd .
                                                    t→∞

    As we have just verified, the intermediation constraint does not have any impact on prices of
long-horizon cash flows. Long-horizon shock elasticities behave as in an economy populated only
by unconstrained specialists with risk aversion γ who consume the whole dividend stream Dt . The
intermediation constraint only affects the stationary part es (x) of the stochastic discount factor.19
As a consequence, long-term risk adjustments in this model are the same as those implied by a
model with power utility function and consumption equal to dividends. The financing constraint
induces deviations in short-term risk prices, which we now characterize.




                                                                36
                              yield for Dt                                                             yield for Ct
  0.1                                                                     0.15

0.08
                                                                           0.1
0.06

0.04
                                                                          0.05
0.02

   0                                                                        0
        0   10   20   30     40   50    60      70   80   90   100               0   10   20   30     40    50   60       70   80   90   100

                           yield for the bond                                                       excess yield for Ct
  0.1                                                                     0.15
                                                                                                        x = 0.050 (5th percentile)
0.08                                                                                                    x = 0.091 (35.3th percentile)
                                                                                                        x = 0.270 (95th percentile)
                                                                           0.1
0.06

0.04
                                                                          0.05
0.02

   0                                                                        0
        0   10   20   30    40 50 60 70              80   90   100               0   10   20   30    40 50 60 70               80   90   100
                           maturity (years)                                                         maturity (years)


Figure 3: Yields and excess yields for the He and Krishnamurthy (2013) model. Parametrization
and description as in Figure 2.


7.2.5       Shock elasticities and term structure of yields

The blue solid lines in the bottom row of Figure 1 represent the long-horizon shock-exposure and
shock-price elasticities. These results are contrasted with the infinitesimal shock-exposure and
shock-price elasticities, depicted with red dashed lines, that are equal to the volatility coefficients
αc (x) and αs (x) in the differential representation (35) for the experts’ consumption process (39)
and stochastic discount factor process (37), respectively.
    Figure 2 depicts these shock elasticities evaluated at three different points in the state space.
These elasticities were computed numerically.20 A remarkable feature of the model is the following.
The short-horizon consumption cash flows are more exposed to risk as revealed by a larger shock-
price elasticity in the constrained region of the state space (x = 0.05). This finding is reversed
for long-horizon cash flows, showing that the term structure of risk prices is much more strongly
downward sloping for low values of the state variable. Since the state variable responds positively
   19
      Without the intermediation constraint and the debt constraint (λ = 0), the economy reduces to a complete-market
risk-sharing problem between households and specialists and will converge in the long-run to a homogeneous-agent
economy populated only by households when γ > 1.
   20
      We solved equation (29) for M = C and M = SC, with φ0 (x) = 1 using an implicit finite difference scheme. We
used the solution for π(x) constructed using the code from He and Krishnamurthy (2013).


                                                                     37
to shocks, low realizations of the state variable are the consequence of adverse shocks in the past.
    Figure 3 explores the implications for yields on dividends and experts’ consumptions for alter-
native payoff horizons computed as logarithms of expected returns to the respective payoffs. While
the yields on dividends and experts’ consumption are initially increasing in maturity, this is all the
more so when x is low. The yields are monotone over all horizons except when x is low, in which
case the yields eventually decline a bit. The same effect is even more pronounced for the risk-free
yield curve except the eventual decline is even more slight. Excess yields are therefore downward
sloping for the experts’ consumption process, and are lower for longer maturities for low values of
x in contrast to high values.21

7.3     Brunnermeier and Sannikov (2014)
Brunnermeier and Sannikov (2014) construct a model with endogenous capital accumulation, popu-
lated by two types of agents, households and experts. The experts have access to a more productive
technology for output and new capital than the households. The state variable of interest is the
wealth share of experts, defined as
                                                   Nt
                                            Xt =
                                                 Qt Kt
where Nt is the net worth of the experts, and Qt Kt is the market value of capital. The equilibrium
stock of capital evolves as
                                  d log Kt = βk (Xt ) dt + ᾱk dWt

where the rate of accumulation of aggregate capital, βk (Xt ), is determined by the wealth share of
experts along with a standard local lognormal adjustment. The shock dWt alters the quality of the
capital stock.

7.3.1    Households and experts

In the baseline model, both households and experts have linear preferences and differ in their time-
preference coefficients, r and ρ, respectively, assuming that ρ > r. In particular, the preferences
for experts are given by                 Z                 
                                                        ∞
                                              E             e−ρt dCut | F0
                                                    0

where Cut is cumulative consumption and as such is restricted to be a non-decreasing process. In
contrast, the cumulative consumption of the household can have negative increments. The linearity
in their preferences implies a constant equilibrium rate of interest r.
  21
     For empirical evidence and modeling of the downward sloping term structure of risky yields see van Binsbergen
et al. (2012), van Binsbergen et al. (2013), Ai et al. (2013), Belo et al. (2015), Hasler and Marfè (2015), Lopez et al.
(2015), or van Binsbergen and Koijen (2016).




                                                              38
7.3.2   Financial friction

In the model, experts are better at managing the capital stock, making it more productive. This
creates a natural tendency to move the capital from the hands of the households to the hands of the
experts, who in turn issue financial claims on this capital to the households. Absent any financial
frictions, the experts would instantly consume the total value of their own net worth (given their
higher impatience and linear utility), and accept households’ capital under management by issuing
equity claims.
    Brunnermeier and Sannikov (2014) assume that experts cannot issue any equity and have to
finance all capital purchases using risk-free borrowing. This naturally creates a leveraged portfolio
on the side of the experts. When the wealth share of experts Xt decreases, they can intermediate
households’ capital only by increasing their leverage, and the price of capital Q (Xt ) has to fall in
order to generate a sufficiently high expected return on capital for the experts to hold this leveraged
portfolio.

7.3.3   Equilibrium dynamics

In equilibrium, the expected return on capital has to balance the hedging demand on the side of the
experts with the supply of capital from households. Experts’ hedging motive (limited willingness
to hold a leveraged portfolio) arises from the fact that a leveraged portfolio generates a low return
after an adverse realization of the shock dWt which, at the same time, decreases Xt and therefore
increases the future expected return on capital.
    On the other hand, when the wealth share of experts Xt increases, the price of capital Q (Xt )
increases, and the expected return falls. Define the marginal value of experts’ wealth Θt = θ (Xt )
through                                      Z                    
                                                   ∞
                                  Θ t Nt = E           e−ρ(s−t) dCs | Ft
                                               t

where dC is the cumulative consumption process of the experts. Linearity of preferences implies
that experts’ consumption is zero as long as Θt > 1. As Xt increases, it reaches an endogenously
determined threshold x̄ for which θ (x̄) = 1. At this point, the marginal utility of wealth equals
the marginal utility of consumption, and experts consume out of their wealth. Consequently, the
equilibrium dynamics for the wealth share of experts is given by

                               dXt = µ (Xt ) dt + σ (Xt ) dWt − Xt dζt .

where µ (x) and σ (x) are endogenously determined coefficients that depend on relative rates of
                                                                                         .
wealth accumulation of experts and households, and the consumption rate of experts dζt = dCt /Nt >
0 only if Xt = x̄. Formally, the right boundary for the stochastic process Xt behaves as a reflecting
boundary. See Brunnermeier and Sannikov (2014) for the construction of µ and σ.




                                                   39
7.3.4    Stochastic discount factor and cash flows

We now turn to the study of asset pricing implications in the model. To construct the shock
elasticities, we construct the coefficients β(x) and α(x) for the evolution of the stochastic discount
factor and priced cash flows modeled as multiplicative functionals (35).
    The marginal utility of wealth implies the following stochastic discount factor of the experts:

                                              St            θ (Xt )
                                                 = exp(−ρt)         .
                                              S0            θ (X0 )

The coefficients βs (x) and αs (x) in the equation for the evolution of the stochastic discount factor
functional can be constructed by applying Ito’s lemma to this expression taking account of the
functional dependence given by θ(x) and the evolution of X. Observe that this stochastic discount
factor does not contain a martingale component. Nevertheless, since the equilibrium local risk-free
interest rate is r,
                                          St                  θ (Xt )
                                  exp(rt)    = exp [(r − ρ)t]         ,
                                          S0                  θ (X0 )
must be a positive local martingale. As such, its expectation conditioned on date t information
could decline in t implying that long-term interest rates could be higher and in fact converge to
ρ. More generally, from the standpoint of valuation, the fat right tail of the process θ(Xt ) could
have important consequences for valuation even in the absence of a martingale component for the
stochastic discount factor process.
    As a priced cash-flow, we consider the aggregate consumption flow process C a given by

                                Cta = [ae ψ (Xt ) + ah [1 − ψ (Xt )] − ι (Xt )] Kt                                (40)

where ι(x) is the aggregate investment rate, ψ(x) is the fraction of the capital stock owned by the
experts, and ae > ah are the output productivities of the experts and households, respectively. Thus
Cta is equal to aggregate output net of aggregate investment. Aggregate consumption is therefore
given as a stationary fraction of aggregate capital. Thus aggregate consumption flow and capital
stock processes share a common martingale component.22

7.3.5    Shock elasticities and term structure of yields

The top left panel in Figure 4 depicts the drift and volatility coefficients for the state variable Xt .
At the right boundary x̄, the experts accumulated a sufficiently large share of capital and start
consuming. Given their risk neutrality, the boundary behaves as a reflecting boundary. At the
left boundary, the situation is notably different. Experts’ ability to intermediate capital is limited
by their own net worth, and hence their portfolio choice corresponds to an effectively risk averse
  22
    Brunnermeier and Sannikov (2014) also consider an extension where experts and households are endowed with
logarithmic utilities. In that case consumption of both households and experts are given as constant fractions of their
respective net worth, and the stochastic discount factor of the experts inherits the martingale component from the
reciprocal of the aggregate capital process.



                                                          40
                    drift and volatility for Xt                                    stationary density for Xt
  0.15                                                             12
                                                      µ(x)
                                                      σ(x)         10

   0.1                                                              8

                                                                    6

  0.05                                                              4

                                                                    2

    0                                                               0
         0    0.1          0.2         0.3         0.4                   0   0.1          0.2        0.3          0.4

              shock-exposure elasticity for Cta                              shock-price elasticity for for Cta
   0.4                                                             0.6
                                    short-horizon εc (x, 0)                                      short-horizon εp (x, 0)
                                    long-horizon εc (x, ∞)                                       long-horizon εp (x, ∞)

   0.2                                                             0.4



    0                                                              0.2



 −0.2                                                               0
         0    0.1          0.2        0.3          0.4                   0   0.1          0.2        0.3          0.4
                     state Xt = Nt /(Qt Kt )                                        state Xt = Nt /(Qt Kt )


Figure 4: Dynamics of the experts’ wealth share Xt = Nt /(Qt Kt ) (horizontal axis), shock-exposure
and shock-price elasticities for the Brunnermeier and Sannikov (2014) model. Top left panel shows
the drift and volatility coefficients for the evolution of Xt , while top right panel the stationary
density for Xt . Panels in the bottom row show the short- and long-horizon shock elasticity for
the aggregate consumption process C a . The intermediation constraint binds in the interval Xt ∈
(0, 0.25), and x∗ = 0.25 corresponds to the 15% quantile of the stationary distribution of X.


agent. The left boundary is natural and nonattracting.
    The existence of a stationary distribution, depicted in the second panel of Figure 4, arises from
a combination of two forces. Experts are more impatient, so whenever they accumulate a sufficient
share of capital, they start consuming, which prevents them from taking over the whole economy.
On the other hand, when their wealth share falls, their intermediation ability becomes scarce, the
expected return on capital rises, and they use their superior investment technology to accumulate
wealth at a faster rate than households.
    The stationary density has peaks at each of the two boundaries. The positive drift coefficient
µ (x) implies that there is a natural pull toward the right boundary, creating the peak in the density
there. However, whenever a sequence of shocks brings the economy close to the left boundary,
solvency constraints imply that it takes time for experts to accumulate wealth again, and the
economy spends a long period time in that part of the state space. Economically, most times are
‘good’ times when intermediation is fully operational, with rare periods of protracted ‘financial


                                                              41
                 shock exposure elasticity for Cta                                           shock price elasticity for Cta
  0.4                                                                    0.4
                                                                                                      x = 0.052 (5th percentile)
  0.3                                                                                                 x = 0.247 (14.5th percentile)
                                                                         0.3                          x = 0.465 (95th percentile)
  0.2
                                                                         0.2
  0.1

                                                                         0.1
   0

−0.1                                                                       0
        0   10   20   30    40 50 60 70          80   90     100               0   10   20     30    40 50 60 70              80   90   100
                           maturity (years)                                                         maturity (years)


Figure 5: Shock exposure and shock price elasticities for the Brunnermeier and Sannikov (2014)
model. Individual lines correspond to alternative choices of the current state, the experts’ wealth
share X0 = x. The blue solid line represents the state in which the intermediation constraint starts
binding (x = 0.247), corresponding to the 14.5% quantile of the stationary distribution of Xt . The
red dashed line corresponds to the 5% quantile of the stationary distribution of Xt (intermediation
constraint tightly binding) while the red dotted line corresponds to the 95% quantile.

                            yield for Cta                                                             bond yield
 0.1                                                                     0.1

0.08                                                                    0.08

0.06                                                                    0.06

0.04                                                                    0.04
                             x = 0.052 (5th percentile)
0.02                         x = 0.247 (14.5th percentile)              0.02
                             x = 0.465 (95th percentile)
   0                                                                      0
       0    10   20   30    40 50 60 70          80   90     100               0   10   20     30    40 50 60 70              80   90   100
                           maturity (years)                                                         maturity (years)


Figure 6: Yields and excess yields for the Brunnermeier and Sannikov (2014) model. Parametriza-
tion and description as in Figure 5.


crises’.
    The bottom row of Figure 4 plots the shock elasticities for the aggregate consumption process
(40). Observe that the short-horizon exposure elasticity is negative in a part of the state space,
making aggregate consumption countercyclical there. The long-horizon elasticities are noticeably
higher, and particularly high when the intermediation constraint binds. The discontinuity at Xt =
x∗ is caused by the change in consumption behavior in the moment when the intermediation
constraint starts binding.
    Given that the stochastic discount factor has no martingale component, the long-horizon shock-
price elasticity is zero. On the other hand, the short-horizon price of risk varies strongly with the


                                                                   42
wealth share of the experts. This state dependence is also confirmed in Figure 5 which plots the
shock elasticity functions for selected points in the state space. Shock-exposure elasticities for
the aggregate consumption process {Cta : t ≥ 0} increase with maturity, while the shock-price
elasticities vanish as t → ∞. Notice that there is a sign reversal in the exposure elasticities
for aggregate consumption. The shock-exposure elasticities are initially negative but eventually
become positive in the middle part of the state space, mirroring the bottom left panel of Figure 4.
This pattern emerges because of the equilibrium investment responses over short horizons lead to
more substantial longer-term consumption responses in the constrained states. Nevertheless, the
shock-price elasticities are positive for all horizons and states that we consider.
    Finally, Figure 6 plots the yields on risk-free bonds and claims on horizon-specific cash flows
from aggregate consumption. In line with the non-monotonicity of the shock-exposure elasticities
across states in Figure 4, the short-maturity yields are also non-monotonic, being lowest, and in
fact lower than the risk-free rate, in the center of the distribution of the state Xt .


8    Directions for further research
In this chapter, we developed dynamic value decompositions (DVD’s) for the study of intertem-
poral asset pricing implications of dynamic equilibrium models. We constructed shock elasticities
as building blocks for these decompositions. The DVD methods are distinct but potentially com-
plementary to the familiar Campbell and Shiller (1988) decomposition. Campbell and Shiller use
linear VAR methods to quantify the impact of (discounted) “cash flow shocks” and “expected re-
turn shocks” on price-dividend ratios. In general these shocks are correlated and are themselves
combinations of shocks that are fundamental to structural models of the macroeconomy. Our aim is
to explore pricing implications of models in which alternative macroeconomic shocks are identified
and their impact quantified. We replaced linear approximation with local sensitivity analysis, and
we characterized how cash flows are exposed to alternative macroeconomic shocks and what the
corresponding price adjustments are for these exposures. We showed that shock elasticities are
mathematically and economically related to impulse response functions. The shock elasticities rep-
resent sensitivities of expected cash flows to alternative macroeconomic shocks and the associated
market implied compensations when looking across differing investment horizons.
    We apply these DVD methods to a class of dynamic equilibrium models that feature financial
frictions and segmented markets. The methods uncover the ways financial frictions contribute to
pricing of alternative cash flows and to the shape of the term structure of macroeconomic risk
prices.
    There are two extensions of our analysis that require further investigation. First risk prices
are only well-defined relative to an underlying probability distribution. In this chapter we have
not discussed the consequences for pricing when investors inside our models use different prob-
ability measures than the data-generating measure presumed by an econometrician. Typically,
researchers invoke an assumption of rational expectations to connect investor perceptions with the
data generation. More generally, models of investors that allow for subjective beliefs, learning,


                                                43
ambiguity aversion or concerns about model misspecification alter how we interpret market based
compensations for exposure to macroeconomic fluctuations. For instance, see Hansen (2014) for
further discussion. Incorporating potential belief distortions into the analysis should be a valuable
extension of these methods.
    Second, we left aside empirical and econometric aspects of the identification of shocks and
measurement of risk premia. The empirical finance literature has made considerable progress
in the characterization and measurement of the term structure of risk premia in various asset
markets. The challenge for model building is to connect these empirical facts to specific sources of
macroeconomic risks and financial market frictions of model economies. Our methodology suggests
a way to make these connections, but further investigation is required.
    Finally, we refrained from the discussion of implications for policy analysis. Financial frictions
create economic externalities that can potentially be rectified by suitable policy actions. Since asset
prices enter these financial constraints, understanding their behavior is an important ingredient to
meaningful policy design. Forward looking asset prices provide both a source of information about
private sector beliefs and an input into the regulatory challenges faced in the conduct of policy.
Our methods can help to uncover asset pricing implications for alternative potential policies.




                                                  44
Appendix
A     Exponential-quadratic framework

Let X = (X1′ , X2′ )′ be a 2n × 1 vector of states, W ∼ N (0, I) a k × 1 vector of independent Gaussian shocks,
and Ft the filtration generated by (X0 , W1 , . . . , Wt ). In this appendix, we show that given the law of motion
from equation (21)

                      X1,t+1    = Θ10 + Θ11 X1,t + Λ10 Wt+1                                                     (41)
                      X2,t+1    = Θ20 + Θ21 X1,t + Θ22 X2,t + Θ23 (X1,t ⊗ X1,t ) +
                                    +Λ20 Wt+1 + Λ21 (X1,t ⊗ Wt+1 ) + Λ22 (Wt+1 ⊗ Wt+1 )

and a multiplicative functional Mt = exp (Yt ) whose additive increment is given in equation (22):

                    Yt+1 − Yt     = Γ0 + Γ1 X1,t + Γ2 X2,t + Γ3 (X1,t ⊗ X1,t ) +                                (42)
                                      +Ψ0 Wt+1 + Ψ1 (X1,t ⊗ W1,t+1 ) + Ψ2 (Wt+1 ⊗ Wt+1 ) ,

we can write the conditional expectation of M as
                                                                                        
                   log E [Mt | F0 ] = Γ̄0    t
                                                 + Γ̄1   t
                                                             X1,0 + Γ̄2   t
                                                                              X2,0 + Γ̄3   t
                                                                                               (X1,0 ⊗ X1,0 )   (43)
          
where Γ̄i t are constant coefficients to be determined.
    The dynamics given by (41)–(42) embed the perturbation approximation constructed in Section 5.2 as
a special case. The Θ and Λ matrices needed to map the perturbed model into the above structure are
constructed from the first and second derivatives of the function ψ(x, w, q) that captures the law of motion
of the model, evaluated at (x̄, 0, 0):

                                Θ10 = ψq         Θ11 = ψx           Λ10 = ψw
                                Θ20 = ψqq         Θ21 = 2ψxq          Θ22 = ψx         Θ23 = ψxx
                                Λ20 = 2ψwq         Λ21 = 2ψxw             Λ22 = ψww

where the notation for the derivatives is defined in Appendix A.2.


A.1    Definitions
To simplify work with Kronecker products, we define two operators vec and matm,n . For an m × n matrix
H, vec (H) produces a column vector of length mn created by stacking the columns of H:

                                      h(j−1)m+i = [vec(H)](j−1)m+i = Hij .

For a vector (column or row) h of length mn, matm,n (h) produces an m×n matrix H created by ‘columnizing’
the vector:
                                      Hij = [matm,n (h)]ij = h(j−1)m+i .

We drop the m, n subindex if the dimensions of the resulting matrix are obvious from the context.




                                                               45
For a square matrix A, define the sym operator as

                                                             1
                                                 sym (A) =     (A + A′ ) .
                                                             2
Apart from the standard operations with Kronecker products, notice that the following is true. For a row
vector H1×nk and column vectors Xn×1 and Wn×1

                                                                               ′
                                          H (X ⊗ W ) = X ′ [matk,n (H)] W

and for a matrix An×k , we have
                                                                   ′
                                               X ′ AW = (vecA′ ) (X ⊗ W ) .                            (44)

Also, for An×n , Xn×1 , Kk×1 , we have

                                               (AX) ⊗ K     = (A ⊗ K) X
                                               K ⊗ (AX) = (K ⊗ A) X.

Finally, for column vectors Xn×1 and Wk×1 ,

                                         (AX) ⊗ (BW ) = (A ⊗ B) (X ⊗ W )

and
                                                                        n
                                       (BW ) ⊗ (AX) = [B ⊗ A•j ]j=1 (X ⊗ W )

where
                                           n
                                 [B ⊗ A•j ]j=1 = [B ⊗ A•1 B ⊗ A•2 . . . B ⊗ A•n ] .


A.2     Concise notation for derivatives
Consider a vector function f (x, w) where x and w are column vectors of length m and n, respectively. The
first-derivative matrix fi where i = x, w is constructed as follows. The k-th row [fi ]k• corresponds to the
derivative of the k-th component of f

                                                                 ∂f (k)
                                               [fi (x, w)]k• =          (x, w) .
                                                                  ∂i′
   Similarly, the second-derivative matrix is the matrix of vectorized and stacked Hessians of individual
components with k-th row
                                                                        ′
                                                        ∂ 2 f (k)
                                   [fij (x, w)]k• = vec           (x, w)    .
                                                        ∂j∂i′
It follows from formula (44) that, for example,
                                                              ′
                ′       ∂ 2 f (k)                ∂ 2 f (k)
               x                  (x, w) w = vec           (x, w) (x ⊗ w) = [fxw (x, w)]k• (x ⊗ w) .
                        ∂x∂w′                    ∂w∂x′




                                                            46
A.3     Conditional expectations
Notice that a complete-the squares argument implies that, for a 1 × k vector A, a 1 × k 2 vector B, and a
scalar function f (w),

        E [exp (B (Wt+1 ⊗ Wt+1 ) + AWt+1 ) f (Wt+1 ) | Ft ] =                                          (45)
                                                                              
                             1 ′
                 = E exp      W    (matk,k (2B)) Wt+1 + AWt+1 f (Wt+1 ) | Ft
                             2 t+1
                                                                                       
                                            −1/2       1                           −1 ′
                 = |Ik − sym [matk,k (2B)]|      exp     A (Ik − sym [matk,k (2B)]) A Ẽ [f (Wt+1 ) | Ft ]
                                                       2

where ˜· is a measure under which
                                                                                        
                                                        −1                            −1
                       Wt+1 ∼ N (Ik − sym [matk,k (2B)]) A′ , (Ik − sym [matk,k (2B)])     .

   We start by utilizing formula (45) to compute

        Ȳ (Xt ) =         log E [exp (Yt+1 − Yt ) | Ft ] =
                   =       Γ0 + Γ1 X1,t + Γ2 X2,t + Γ3 (X1,t ⊗ X1,t ) +
                                                                                                 
                                                  ′              ′      1 ′
                           + log E exp Ψ0 + X1t [matk,n (Ψ1 )] Wt+1 + Wt+1 [matk,k (Ψ2 )] Wt+1 | Ft
                                                                          2
                   =       Γ0 + Γ1 X1,t + Γ2 X2,t + Γ3 (X1,t ⊗ X1,t ) −
                             1                                 1                           −1
                           − log |Ik − sym [matk,k (2Ψ2 )]| + µ′ (Ik − sym [matk,k (2Ψ2 )]) µ
                             2                                 2
with µ defined as
                                                 µ = Ψ′0 + [matk,n (Ψ1 )] X1,t .

   Reorganizing terms, we obtain

                                     Ȳ (Xt ) = Γ̄0 + Γ̄1 X1,t + Γ̄2 X2,t + Γ̄3 (X1,t ⊗ X1,t )             (46)

where
                                  1                                 1
             Γ̄0       =     Γ0 −   log |Ik − sym [matk,k (2Ψ2 )]| + Ψ0 (Ik − sym [matk,k (2Ψ2 )])−1 Ψ′0
                                  2                                 2
                                                               −1
             Γ̄1       =     Γ1 + Ψ0 (Ik − sym [matk,k (2Ψ2 )]) [matk,n (Ψ1 )]                             (47)
             Γ̄2       =     Γ2
                                 1   h                                                        i′
                                                    ′                          −1
             Γ̄3       =     Γ3 + vec [matk,n (Ψ1 )] (Ik − sym [matk,k (2Ψ2 )]) [matk,n (Ψ1 )] .
                                 2
   For the set of parameters P = (Γ0 , . . . , Γ3 , Ψ0 , . . . , Ψ2 ), equations (47) define a mapping

                                                              P̄ = Ē (P) ,

with all Ψ̄j = 0. We now substitute the law of motion for X1 and X2 to produce Ȳ (Xt ) = Ỹ (Xt−1 , Wt ). It




                                                                   47
is just a matter of algebraic operations to determine that

                     Ỹ (Xt−1 , Wt ) =      log E [exp (Yt+1 − Yt ) | Ft ] =
                                       =    Γ̃0 + Γ̃1 X1,t−1 + Γ̃2 X2,t−1 + Γ̃3 (X1,t−1 ⊗ X1,t−1 )
                                            +Ψ̃0 Wt + Ψ̃1 (X1,t−1 ⊗ Wt ) + Ψ̃2 (Wt ⊗ Wt )

where

                             Γ̃0   =   Γ̄0 + Γ̄1 Θ10 + Γ̄2 Θ20 + Γ̄3 (Θ10 ⊗ Θ10 )                                      (48)
                             Γ̃1   =   Γ̄1 Θ11 + Γ̄2 Θ21 + Γ̄3 (Θ10 ⊗ Θ11 + Θ11 ⊗ Θ10 )
                             Γ̃2   =   Γ̄2 Θ22
                             Γ̃3   =   Γ̄2 Θ23 + Γ̄3 (Θ11 ⊗ Θ11 )
                            Ψ̃0    =   Γ̄1 Λ10 + Γ̄2 Λ20 + Γ̄3 (Θ10 ⊗ Λ10 + Λ10 ⊗ Θ10 )
                                                                   h             in 
                            Ψ̃1    =   Γ̄2 Λ21 + Γ̄3 Θ11 ⊗ Λ10 + Λ10 ⊗ (Θ11 )•j
                                                                                        j=1

                            Ψ̃2    =   Γ̄2 Λ22 + Γ̄3 (Λ10 ⊗ Λ10 ) .

This set of equations defines the mapping
                                                                 
                                                       P̃ = Ẽ P̄ .


A.4     Iterative formulas
We can write the conditional expectation in (43) recursively as
                                                                                 
                                                                        Mt
                            log E [Mt | F0 ] = log E exp (Y1 − Y0 ) E      | F1 | F0 .
                                                                        M1

    Given the mappings Ē and Ẽ, we can therefore express the coefficients P̄ in (43) using the recursion
                                                                      
                                                 P̄t = Ē P + Ẽ P̄t−1

where the addition is by coefficients and all coefficients in P̄0 are zero matrices.


A.5     Coefficients Φ∗i
In the above calculations, we constructed a recursion for the coefficients in the computation of the conditional
expectation of the multiplicative functional M . A single iteration of this recursion can be easily adapted
to compute the coefficients Φ∗i , i = 0, . . . 3, in the conditional expectation in equation (24) for an arbitrary
function log f (x).

   1. Associate log f (xt+1 ) = Y (xt+1 ) from equation (46), i.e., set Γi , i = 0, . . . , 3, in equation (46) equal
      to the desired Φi from equation (23). These are the coefficients in set P.
                                  
   2. Apply the mapping Ee P , i.e., compute Γ      e i , i = 0, . . . , 3 and Ψ
                                                                               e i , i = 0, 1, 2 using (48). This yields the
      function log fe(xt , wt+1 ) ≡ log f (xt+1 ), with coefficient set P    e

   3. Add to these coefficients Γ e i and Ψ
                                          e i the corresponding coefficients Γi and Ψi of Yt+1 − Yt from equation
                                                  
      (42), i.e., form coefficient set P + Ee P .


                                                            48
                                      
    4. Apply the mapping E P + Ee P , i.e., compute (47) where on the right hand side the coefficients
       Γi and Ψi (coefficient set P) are replaced with coefficients computed in the previous step, i.e., set
               
       P + Ee P .

    5. The resulting coefficients Γi , i = 0, . . . , 3, are the desired coefficients Φ∗i .


B       Shock elasticity calculations

In this appendix, we provide details on some of the calculations underlying the derived shock elasticity
formulas for the convenient functional form from Section 5.1.1. In particular we show, using a complete-the-
squares argument, that under the transformed measure generated by the random variable L1,t from (25) the
shock W1 remains normally distributed with a covariance matrix:
                                                                                   −1
                        e t = Ik − 2 sym matk,k Ψ2 + Φ∗
                        Σ                                          ∗
                                                      2,t−1 Λ22 + Φ3,t−1 (Λ10 ⊗ Λ10 )      .

where Ik is the identity matrix of dimension k.23 We suppose that this matrix is positive definite. The
conditional mean vector for W1 under the change of measure is:

                                          e [W1 | X0 = x] = Σ
                                          E                 e t [µt,0 + µt,1 x1 ] ,

where E e is the expectation under the change of measure and the coefficients µt,0 and µt,1 are given in the
following derivation.
     Thus the shock elasticity is given by:

                                        ε (x, t)       = ν(x) · E [L1,t W1 | X0 = x]
                                                               e t [µt,0 + µt,1 x1 ] .
                                                       = ν(x)′ Σ

The shock elasticity function in this environment depends on the first component, x1 , of the state vector.
Recall from (21) that this component has linear dynamics. The coefficient matrices for the evolution of the
second component, x2 , nevertheless matter for the shock elasticities even though these elasticities do not
depend on this component of the state vector.


B.1       Shock elasticities under the convenient functional form
To calculate the shock elasticities in Section 5.1.1, utilize the formulas derived in Appendix A to deduce the
one-period change of measure
                                                                                         
                                                       Mt                     Mt
                    log L1,t = log M1 + log E             | X1 − log E M1 E      | X1 | X0 = x .
                                                       M1                     M1

In particular, following the set of formulas (48), define
                                                                                            ′
                 µ0,t   =  Ψ1 + Φ∗1,t−1 Λ1,0 + Φ∗2,t−1 Λ20 + Φ∗3,t−1 (Θ10 ⊗ Λ10 + Λ10 ⊗ Θ10 )
                                                                           h             in 
                                           ∗             ∗
                 µ1,t   = matk,n Ψ1 + Φ2,t−1 Λ21 + Φ3,t−1 Θ11 ⊗ Λ10 + Λ10 ⊗ (Θ11 )•j
                                                                                             j=1
                                                                       
                 µ2,t   = sym matk,k Ψ2 + Γ̄2 Λ22 + Γ̄3 (Λ10 ⊗ Λ10 ) .
  23
       This formula uses the result that (Λ10 W1 ) ⊗ (Λ10 W1 ) = (Λ10 ⊗ Λ10 ) (W1 ⊗ W1 ).



                                                                49
Then it follows that

                                                           ′                ′
                  log L1,t       =     (µ0,t + µ1,t X1,0 ) W1 + (W1 ) µ2,t W1 −
                                         1                             ′        ′           
                                       − log E exp (µ0,t + µ1,t X1,0 ) W1 + (W1 ) µ2,t W1 | F0 .
                                         2
Expression (45) then implies that

                                                     e [W1 | F0 ] =
                                 E [L1,t W1 | F0 ] = E
                                                                                −1
                                                       = (Ik − 2µ2,t )               (µ0,t + µ1t X1,0 ) .

The variance of W1 under the ˜· measure satisfies
                                                                               
                          e t = Ik − 2sym matk,k Ψ2 + Γ̄2 Λ22 + Γ̄3 (Λ10 ⊗ Λ10 ) −1 .
                          Σ


B.2    Approximation of the shock elasticity function
In Section 5.3.1, we constructed the approximation of the shock elasticity function ε (x, t). The first-order
approximation is constructed by differentiating the elasticity function under the perturbed dynamics

                             d              E [Mt (q) W1 | X0 = x]
           ε1 (X1,0 , t) =      ν(X0 (q)) ·                                                = ν (x̄) · E [Y1,t W1 | X0 = x] .
                             dq              E [Mt (q) | X0 = x]                     q=0


The first-derivative process Y1,t can be expressed in terms of its increments, and we obtain a state-independent
function                                                                        ′
                                                         t−1
                                                         X           j−1
                                   ε1 (t) = ν (x̄) · E      κx (ψx )    ψw + κw 
                                                               j=1

where κx , ψx , κw , ψw are derivative matrices evaluated at the steady state (x̄, 0).
   Continuing with the second derivative, we have

                                      d2                E [Mt (q) W1 | X0 = x]
       ε2 (X1,0 , X2,0 , t) =           2
                                           ν(X0 (q)) ·                             =
                                     dq                    E [Mt (q) | X0 = x] q=0
                                             n h                                 i                           o
                                                         2
                             =       ν (x̄) · E (Y1,t ) W1 + Y2,t W1 | F0 − 2E [Y1,t W1 | F0 ] E [Y1,t | F0 ] +
                                                   
                                            ∂ν
                                     +2        (x̄)   X1,0 · E [Y1,t W1 | F0 ] .
                                           ∂x′

However, notice that
                                                                                               ′
                   h                     i         Xt−1                  Xt−1
                             2                                  j                     j−1
                E (Y1,t ) W1 | F0            =   2     κx (ψx ) X1,0       κx (ψx )    ψw + κw 
                                                       j=0                             j=1
                                                                                       ′
                                                     t−1
                                                     X
                                                                    j−1
                       E [Y1,t W1 | F0 ] =                 κx (ψx )        ψw + κw 
                                                     j=1
                                                 t−1
                                                 X
                          E [Y1,t | F0 ] =             κx (ψx )j X1,0
                                                 j=0




                                                                 50
and thus                    h               i
                                    2
                           E (Y1,t ) W1 | F0 − 2E [Y1,t W1 | F0 ] E [Y1,t | F0 ] = 0.

The second-order term in the approximation of the shock elasticity function thus simplifies to
                                                                            
                                                                     ∂ν
               ε2 (X1,0 , X2,0 , t) = ν (x̄) · E [Y2,t W1 | F0 ] + 2     (x̄) X1,0 · E [Y1,t W1 | F0 ] .
                                                                     ∂x′

The expression for the first term on the right-hand side is
                                                                 
                                     t−1
                                     X
       E [Y2,t W1 | F0 ] = E              (Y2,j+1 − Y2,j ) W1 | F0  = 2matk,n (κxw ) X1,0 +
                                     j=0
                                   t−1 h
                                   X                                                 h               ii
                                            ′      j−1                      j                 j−1
                              +2           ψw (ψx′ )     matn,n (κxx ) (ψx ) + matk,n κx (ψx )    ψxw X1,0
                                   j=1
                                       j−1 h
                                   t−1 X
                                   X                           h                 i       i
                                             ′       k−1                j−k−1          k
                              +2            ψw (ψx′ )    matn,n κx (ψx )      ψxx (ψx ) X1,0 .
                                   j=1 k=1


    To obtain this result, notice that repeated substitution for Y1,j+1 − Y1,j into the above formula yields a
variety of terms but only those containing X1,0 ⊗ W1 have a nonzero conditional expectation when interacted
with W1 .




                                                            51
References
Adrian, Tobias and Nina Boyarchenko. 2012. Intermediary Leverage Cycles and Financial Stability.
 Federal Reserve Bank of New York Staff Report No. 567.

Ai, Hengjie, Mariano Massimiliano Croce, Anthony Diercks, and Kai Li. 2013. Production-Based
  Term Structure of Equity Returns.

Alvarez, Fernando and Urban J. Jermann. 2004. Using Asset Prices to Measure the Cost of Business
  Cycles. Journal of Political Economy 112 (6):1223–1256.

Anderson, Evan W., Lars Peter Hansen, and Thomas J. Sargent. 2003. A Quartet of Semigroups for
 Model Specification, Robustness, Prices of Risk, and Model Detection. Journal of the European
 Economic Association 1 (1):68–123.

Andreasen, Martin M., Jesús Fernández-Villaverde, and Juan F. Rubio-Ramı́rez. 2010. The Pruned
 State Space System for Non-Linear DSGE Models: Asset Pricing Applications to GMM and
 SMM. Unpublished manuscript.

Belo, Frederico, Pierre Collin-Dufresne, and Robert S. Goldstein. 2015. Dividend Dynamics and
  the Term Structure of Dividend Strips. Journal of Finance 70 (3):1115–1160.

Benigno, Gianluca, Pierpaolo Benigno, and Salvatore Nisticò. 2010. Second-Order Approximation
  of Dynamic Models with Time-Varying Risk. NBER Working paper W16633.

Bernanke, Ben S. and Mark Gertler. 1989. Agency Costs, Net Worth, and Business Fluctuations.
  American Economic Review 79 (1):14–31.

Bernanke, Ben S., Mark Gertler, and Simon Gilchrist. 1999. The Financial Accelerator in a Quan-
  titative Business Cycle Framework. In Handbook of Macroeconomics: Volume 1, chap. 21, 1341–
  1393. Elsevier B.V.

Beveridge, Stephen and Charles R. Nelson. 1981. A New Approach to Decomposition of Economic
  Time Series into Permanent and Transitory Components with Particular Attention to Measure-
  ment of the ‘Business Cycle’. Journal of Monetary Economics 7:151–174.

Bhandari, Anmol, Jaroslav Borovička, and Paul Ho. 2016. Identifying Ambiguity Shocks in Business
  Cycle Models Using Survey Data.

Bianchi, Francesco. 2012. Regime Switches, Agents’ Beliefs, and Post-World War II U.S. Macroe-
  conomic Dynamics. Review of Economic Studies 67 (2):380–405.

———. 2015. Rare Events, Financial Crises, and the Cross-Section of Asset Returns.

Bianchi, Francesco and Cosmin Ilut. 2015. Monetary/Fiscal Policy Mix and Agents’ Beliefs.



                                               52
Bianchi, Francesco and Leonardo Melosi. 2015. Modeling the Evolution of Expectations and Un-
  certainty in General Equilibrium. Forthcoming in International Economic Review.

Bianchi, Francesco, Cosmin Ilut, and Martin Schneider. 2013. Uncertainty Shocks, Asset Supply
  and Pricing over the Business Cycle.

Bianchi, Javier. 2016. Efficient Bailouts? Forthcoming in American Economic Review.

van Binsbergen, Jules, Wouter Hueskes, Ralph S.J. Koijen, and Evert B. Vrugt. 2013. Equity
  Yields. Journal of Financial Economics 110 (3):503–519.

van Binsbergen, Jules H. van and Ralph S. J. Koijen. 2016. The Term Structure of Returns: Facts
  and Theory. Forthcoming in Journal of Financial Economics.

van Binsbergen, Jules H. van, Michael W. Brandt, and Ralph S. J. Koijen. 2012. On the Timing
  and Pricing of Dividends. American Economic Review 102 (4):1596–1618.

Blanchard, Olivier Jean and Charles M. Kahn. 1980. The Solution of Linear Difference Models
  under Rational Expectations. Econometrica 48 (5):1305–1312.

Blanchard, Olivier Jean and Danny Quah. 1989. The Dynamic Effects of Aggregate Demand and
  Supply Disturbances. The American Economic Review 79 (4):655–673.

Bocola, Luigi. 2016. The Pass-Through of Sovereign Risk. Forthcoming in Journal of Political
  Economy.

Borodin, Andrei N. and Paavo Salminen. 2002. Handbook of Brownian Motion: Facts and Formulae.
  Springer Verlag, 2nd ed.

Borovička, Jaroslav and Lars Peter Hansen. 2013. Robust Preference Expansions.

———. 2014. Examining Macroeconomic Models through the Lens of Asset Pricing. Journal of
 Econometrics 183 (1):67–90.

Borovička, Jaroslav, Lars Peter Hansen, Mark Hendricks, and José A. Scheinkman. 2011. Risk-Price
  Dynamics. Journal of Financial Econometrics 9 (1):3–65.

Borovička, Jaroslav, Lars Peter Hansen, and José A. Scheinkman. 2014. Shock Elasticities and
  Impulse Responses. Mathematics and Financial Economics 8 (4):333–354.

———. 2015. Misspecified Recovery. Forthcoming in Journal of Finance.

Brunnermeier, Markus K. and Yuliy Sannikov. 2014. A Macroeconomic Model with a Financial
  Sector. American Economic Review 104 (2):379–421.

Campbell, John Y. and Robert J. Shiller. 1988. Stock Prices, Earnings, and Expected Dividends.
  The Journal of Finance 43 (3):661–676.


                                               53
Chen, Hui. 2010. Macroeconomic Conditions and the Puzzles of Credit Spreads and Capital Struc-
 ture. Journal of Finance 65 (6):2171–2212.

Chung, Hess, Troy Davig, and Eric M. Leeper. 2007. Monetary and Fiscal Policy Switching. Journal
  of Money, Credit and Banking 39 (4):809–842.

David, Alexander. 2008. Heterogeneous Beliefs, Speculation, and the Equity Premium. The Journal
  of Finance 63 (1):41–83.

Davig, Troy, Eric M. Leeper, and Todd B. Walker. 2010. “Unfunded Liabilities” and Uncertain
  Fiscal Financing. Journal of Monetary Economics 57 (5):600–619.

———. 2011. Inflation and the Fiscal Limit. European Economic Review 55 (1):31–47.

Di Nunno, Giulia and Bernt Øksendal. 2009. Malliavin Calculus for Lévy Processes with Applica-
  tions to Finance. Springer Verlag.

Di Tella, Sebastian. 2015. Uncertainty Shocks and Balance Sheet Recessions. Forthcoming in
  Journal of Political Economy.

Epstein, Larry G. and Stanley E. Zin. 1989. Substitution, Risk Aversion, and the Temporal Behavior
  of Consumption and Asset Returns: A Theoretical Framework. Econometrica 57 (4):937–969.

Farmer, Roger E.A., Daniel F. Waggoner, and Tao Zha. 2011. Minimal State Variable Solutions to
  Markov-Switching Rational Expectations Models. Journal of Economic Dynamics and Control
  35 (12):2150–2166.

Feller, William. 1952. The Parabolic Differential Equations and the Associated Semi-Groups of
  Transformations. Annals of Mathematics, Second Series 55 (3):468–519.

———. 1957. On Boundaries and Lateral Conditions for the Kolmogorov Differential Equations.
 Annals of Mathematics, Second Series 65 (3):527–570.

Foerster, Andrew, Juan Rubio-Ramirez, Daniel F. Waggoner, and Tao Zha. 2014. Perturbation
  Methods for Markov-Switching DSGE Models. NBER Working paper W20390.

Frisch, Ragar. 1933. Propagation Problems and Impulse Problems in Dynamic Economics. In
  Economic Essays in Honour of Gustav Cassel, 171–205. Allen and Unwin.

Hansen, Lars Peter. 2012. Dynamic Valuation Decomposition within Stochastic Economies. Econo-
  metrica 80 (3):911–967. Fisher–Schultz Lecture at the European Meetings of the Econometric
  Society.

———. 2014. Nobel Lecture: Uncertainty Outside and Inside Economic Models. Journal of Political
 Economy 122 (5):945 – 987.



                                               54
Hansen, Lars Peter and Scott F. Richard. 1987. The Role of Conditioning Information in Deducing
  Testable Restrictions Implied by Dynamic Asset Pricing Models. Econometrica 50:587–614.

Hansen, Lars Peter and José A. Scheinkman. 2009. Long Term Risk: An Operator Approach.
  Econometrica 77 (1):177–234.

Hansen, Lars Peter and José A. Scheinkman. 2012. Pricing Growth-Rate Risk. Finance and
  Stochastics 16:1–15.

Hansen, Lars Peter, Thomas J. Sargent, and Jr. Tallarini, Thomas D. 1999. Robust Permanent
  Income and Pricing. The Review of Economic Studies 66 (4):873–907.

Hansen, Lars Peter, John C. Heaton, and Nan Li. 2008. Consumption Strikes Back? Measuring
  Long-Run Risk. Journal of Political Economy 116:260–302.

Hasler, Michael and Roberto Marfè. 2015. Disaster Recovery and the Term Structure of Dividend
  Strips.

He, Zhiguo and Arvind Krishnamurthy. 2013. Intermediary Asset Pricing. American Economic
  Review 103 (2):732–770.

Holmes, Mark H. 1995. Introduction to Perturbation Methods. Springer.

Jacobson, David H. 1973. Optimal Stochastic Linear Systems with Exponential Performance Cri-
  teria and Their Relation to Deterministic Differential Games. IEEE Transactions for Automatic
  Control AC-18:1124–131.

Justiniano, Alejandro and Giorgio E. Primiceri. 2008. The Time-Varying Volatility of Macroeco-
  nomic Fluctuations. The American Economic Review 98 (3):604–641.

Karlin, Samuel and Howard M. Taylor. 1981. A Second Course in Stochastic Processes. Academic
 Press.

Kim, Jinill, Sunghyun Kim, Ernst Schaumburg, and Christopher A. Sims. 2008. Calculating and
  Using Second-Order Accurate Solutions of Discrete Time Dynamic Equilibrium Models. Journal
  of Economic Dynamics and Control 32 (11):3397–3414.

Klimenko, Nataliya, Sebastian Pfeil, Jean-Charles Rochet, and Gianni De Nicolò. 2016. Aggregate
  Bank Capital and Credit Dynamics.

Kreps, David M. and Evan L. Porteus. 1978. Temporal Resolution of Uncertainty and Dynamic
  Choice Theory. Econometrica 46 (1):185–200.

Linetsky, Vadim. 2008. Spectral Methods in Derivatives Pricing. In Handbooks in Operations
  Research and Management Science, Vol. 15, chap. 6, 213–289. Elsevier B.V.



                                              55
Liu, Zheng, Daniel F. Waggoner, and Tao Zha. 2009. Asymmetric Expectation Effects of Regime
  Switches in Monetary Policy. Review of Economic Dynamics 12 (2):284–303.

———. 2011. Sources of Macroeconomic Fluctuations: A Regime-Switching DSGE Approach.
 Quantitative Economics 2 (2):251–301.

Lombardo, Giovanni and Harald Uhlig. 2014. A theory of pruning. Working Paper Series 1696,
  European Central Bank.

Lopez, Pierlauro, David Lopez-Salido, and Francisco Vazquez-Grande. 2015. Nominal Rigidities
  and the Term Structures of Equity and Bond Returns.

Maenhout, Pascal J. 2004. Robust Portfolio Rules and Asset Pricing. Review of Financial Studies
 17 (4):951–983.

Malkhozov, Aytek and Maral Shamloo. 2011. Asset Prices in Affine Real Business Cycle Models.

Moreira, Alan and Alexi Savov. 2016. The Macroeconomics of Shadow Banking. Forthcoming in
 Journal of Finance.

Nakamura, Emi, Dmitriy Sergeyev, and Jón Steinsson. 2016. Growth-Rate and Uncertainty Shocks
  in Consumption: Cross-Country Evidence. Tech. rep., Columbia University.

Nualart, David. 2006. The Malliavin Calculus and Related Topics. Springer Verlag, 2nd ed.

Park, Hyungbin. 2015. Ross Recovery with Recurrent and Transient Processes.

Pryce, John D. 1993. Numerical Solution of Sturm–Liouville Problems. Clarendon Press.

Qin, Likuan and Vadim Linetsky. 2014a. Long Term Risk: A Martingale Approach. Mimeo,
  Northwestern University.

———. 2014b. Positive Eigenfunctions of Markovian Pricing Operators: Hansen–Scheinkman Fac-
 torization and Ross Recovery. Mimeo, Northwestern University.

Qin, Likuan, Vadim Linetsky, and Yutian Nie. 2016. Long Forward Probabilities, Recovery and
  the Term Structure of Bond Risk Premiums. Mimeo, Northwestern University.

Schmitt-Grohé, Stephanie and Martı́n Uribe. 2004. Solving Dynamic General Equilibrium Models
  Using a Second-Order Approximation to the Policy Function. Journal of Economic Dynamics
  and Control 28 (4):755–775.

Sims, Christopher. 1980. Macroeconomics and Reality. Econometrica 48 (1):1–48.

Sims, Christopher A. 2002. Solving Rational Expectations Models. Computational Economics
  20 (1–2):1–20.



                                              56
Sims, Christopher A. and Tao Zha. 2006. Were There Regime Switches in U.S. Monetary Policy.
  The American Economic Review 96 (1):54–81.

Slutsky, E. 1927. The summation of random causes as the source of cyclic processes. Problems of
  economic conditions 3 (1).

Tallarini, Thomas D. 2000. Risk-sensitive Real Business Cycles. Journal of Monetary Economics
  45 (3):507–532.

Walden, Johan. 2014. Recovery with Unbounded Diffusion Processes.

Whittle, Peter. 1990. Risk Sensitive and Optimal Control. West Suffix, England: John Wiley and
 Sons.

Yule, G. Udny. 1927. On a Method of Investigating Periodicities in Disturbed Series, with Special
  Reference to Wolfer’s Sunspot Numbers. Philosophical Transactions of the Royal Society 226:267–
  298.

Zviadadze, Irina. 2016. Term Structure of Consumption Risk Premia in the Cross Section of
  Currency Returns. Forthcoming in Journal of Finance.




                                               57
