                               NBER WORKING PAPER SERIES




     TESTS FOR PRICE ENDOGENEITY IN DIFFERENTIATED PRODUCT MODELS

                                           Kyoo il Kim
                                           Amil Petrin

                                       Working Paper 19011
                               http://www.nber.org/papers/w19011


                     NATIONAL BUREAU OF ECONOMIC RESEARCH
                              1050 Massachusetts Avenue
                                Cambridge, MA 02138
                                     May 2013




The views expressed herein are those of the authors and do not necessarily reflect the views of the
National Bureau of Economic Research.

NBER working papers are circulated for discussion and comment purposes. They have not been peer-
reviewed or been subject to the review by the NBER Board of Directors that accompanies official
NBER publications.

© 2013 by Kyoo il Kim and Amil Petrin. All rights reserved. Short sections of text, not to exceed two
paragraphs, may be quoted without explicit permission provided that full credit, including © notice,
is given to the source.
Tests for Price Endogeneity in Differentiated Product Models
Kyoo il Kim and Amil Petrin
NBER Working Paper No. 19011
May 2013
JEL No. C3,L0

                                           ABSTRACT

We develop simple tests for endogenous prices arising from omitted demand factors in discrete choice
models. Our approach only requires one to locate testing proxies that have some correlation with the
omitted factors when prices are endogenous. We use the difference between prices and their predicted
values given observed demand and supply factors. If prices are exogenous, these proxies should not
explain demand given prices and other explanatory variables. We reject exogeneity if these proxies
enter significantly in utility as additional explanatory variables. The tests are easy to implement as
we show with several Monte Carlos and discuss for three recent demand applications.


Kyoo il Kim
Department of Economics
University of Minnesota
4-129 Hanson Hall
1925 4th Street South
Minneapolis, MN 55455
kyookim@umn.edu

Amil Petrin
Department of Economics
University of Minnesota
4-101 Hanson Hall
Minneapolis, MN 55455
and NBER
petrin@umn.edu
1       Introduction
Characteristic-based models of demand are widely used for estimating elasticities and substitution
patterns in differentiated product markets. When relevant product attributes are not observed by
the practitioner, price can be correlated with the unobserved portion of consumers’ utility for that
product: producers charge more and consumers are willing to pay more for products with more
of the omitted attribute, holding all else constant. The positive correlation between price and the
unobserved portion of utility biases estimates of price elasticities upwards. This problem arises for
both aggregate (i.e., market-level) data and disaggregate (i.e., customer-level) data, and has been
documented empirically for CAT scanners (Trajtenberg (1989)), automobiles (Berry, Levinsohn, and
Pakes (1995) and Petrin (2002)), cable television choices (Goolsbee and Petrin (2004) and Crawford
(2000)), cereals (Nevo (2001)), yogurt and ketchup (Villas-Boas and Winer (1999)), and margarine
and orange juice (Chintagunta, Dube, and Goh (2005)).
     The literature has responded to these findings in three distinct ways. The first is to integrate
out the unobserved attributes. The challenge here is that one must specify the distribution of the
demand errors conditional on observed characteristics and price. This is generally regarded as a
difficult object to model.
     The second has been to invert out the demand errors and then directly condition on them.
Usually this is done by inverting the market share equations (Berry (1994), Berry et al. (1995),
Gandhi, Kim, and Petrin (2011)). A drawback for these inversions is that they are computationally
complex to program and time-consuming, and are also subject to propagated numerical errors from
the inversion (see e.g. Dube, Fox, and Su (2012) and Knittel and Metaxiglou (2008)). One can also
invert the demand error from the pricing equation but this requires stronger assumptions (Petrin
and Train (2010), Kim and Petrin (2010)).
     The final approach is to assert that there is no endogeneity problem conditional on the set of
observed controls. For example, in some applications researchers observe household-level panels
repeatedly choosing from the same choice sets over time. In this case one can include fixed effects
directly in the estimation for goods whose physical characteristics are not changing over time. In
some data sets many of the promotional activities are also known, like when the product is on
display or promotion. Conditional on all of these factors some researchers then proceed as if there
were no problem or that it is so small given the observed factors that it is not empirically relevant.1
     In this paper we develop a class of asymptotic tests that are easy to implement in standard
regression packages and have reasonable power against the “exogenous prices” hypothesis. Our
approach tests for an unobserved attribute by constructing a proxy for it that exploits the attribute’s
correlation with price, which is the source of the econometric problem (Petrin and Train (2010)).
We develop control function type tests in the spirit of Smith and Blundell (1986), Rivers and Vuong
    1
    See Chintagunta, Dube, and Goh (2005) for suggestive evidence that even data with this detail still suffers from
omitted attributes.




                                                         2
(1988), and Villas-Boas and Winer (1999).2
    A major advantage of our testing approaches is their simplicity. In the simplest format, all of
the tests use least squares (or nonparametric regression) in an initial stage to obtain the proxies
that enter the control functions. The proxies are calculated as the difference between product price
and its predicted value given the relevant demand and/or supply factors that the econometrician
observes. Our procedure then includes the controls directly in the maximization of the likelihood
function and tests their significance, rejecting “exogenous prices” if they enter significantly. The
controls can enter additively or interactions between price and the controls can be included to look
for non-separability.
    Our Monte Carlo results build in correlation between price and the unobserved attribute by
setting prices according to the standard inverse-elasticity rule, where demand depends in part on
the unobserved attribute. Our simplest test specifications correctly identify the price endogeneity
problem in almost every case.
    We describe approaches to implementing the tests for three of the recent demand exercises
mentioned above, where prices are shown to be endogenous. Each of these exercises uses a different
kind of data, including aggregate (market-level) data (BLP), household-level cross-sectional data
(Goolsbee and Petrin (2004)), and household-level panel data (CDG). Our empirical application
applies the test to the cable and satellite dish demand specification from Goolsbee and Petrin
(2004) and rejects price exogeneity.3
    Our work is related to recent developments in nonparametric identification of the unobserved
attribute in the discrete choice demand models (see Berry and Haile (2010) and Berry, Gandhi,
and Haile (2011)). One could develop a test for price endogeneity by using this nonparametrically
recovered unobserved attribute and combining it with more recent conditional mean tests or speci-
fication tests in general. There have been two main approaches in the literature. One approach is
to use smoothed conditional mean functions (e.g. Härdle and Mammen (1993), Fan and Li (1996),
Horowitz and Spokoiny (2001), Kitamura, Tripathi, and Ahn (2004) among others) and a second
approach is to formulate a conditional mean restriction as a dense set of unconditional mean restric-
tions (e.g. Bierens (1990) and his other works, Stinchcombe and White (1998), Andrews (1997),
Chen and Fan (1999), Li, Hsiao, and Zinn (2003), Song (2010) among others). These approaches
may have better power properties and also be less sensitive to parametric assumptions. We leave
them as future research and in this paper we focus on the classical tests based on parametric demand
model settings that are most commonly used by practitioners, such as the random coefficient logit
demand model.
    The paper proceeds as follows. Sections 2 describes differentiated products demand models
and the endogeneity problem. Sections 3-5 describes the theory of the tests and their empirical
   2
     The linear control function case is described in Heckman (1978) and Hausman (1978). The first use of the term
“control function” of which we are aware is in Heckman and Robb (1985) in the context of selection models.
   3
     In the separate work (Kim and Petrin (2010)) we effectively run a variant of this test for the automobile demand
specification from BLP and the margarine demand specification from CDG.



                                                         3
implementation. Sections 6-7 includes the Monte Carlos and the empirical example. Then we
conclude in Section 8. Technical details are added in Appendix.


2       Demand and Omitted Attributes
The problem of omitted attributes arises naturally within characteristics-based demand approxima-
tions. At the core of these approaches is a desire for parsimony; an unrestricted constant-elasticity-
of-demand system with J goods can have J 2 or more parameters (for example). Characteristics’
based approaches achieve parsimony in two ways. They assume that demands for J goods can be
approximated by K << J characteristics of the goods, where the K factors serve as the basis for
utility. They also assume that consumers only derive utility from the characteristics of the actual
good that they purchase.
    We analyze the specification problem that arises when the K factors used by the econometrician
exclude relevant characteristics. We operate in the generalized random coefficients setting from
Gandhi, Kim, and Petrin (2011) that allows for a non-separable error, with utility that consumer i
derives from product j in market m is given as
                       XK                                      XK
        Uimj = cij +          xmjk βik − αi pmj + βiξ ξmj +              γik xmjk ξmj + γip pmj ξmj + ǫimj ,   (1)
                        k=1                                        k=1

with xmjk and pmj being characteristics and price and the outside good 0 normalized to Uim0 =
ǫim0 .4 In this setup coefficients are varying across individual observations according to (e.g.)
                                                     XL
                                     cij   = cj0 +             cjl dil + σc ωic
                                                       l=1
                                                      XL
                                     βik = βk0 +      βkl dil + σk ωik
                                                  l=1
                                                XL
                                      αi = α0 +      αl dil + σp ωip
                                                         l=1

where a vector of characteristics di (L × 1) can include demographics or other observed charac-
teristics of i and ωi = (ωic , ωi1 , . . . ωiK , ωip ) denotes a vector of unobserved consumer tastes for
the characteristics and the price (i.e., random shocks that generate the random coefficients), which
follows a known distribution such as standard normals.5 The idiosyncratic consumer-product spe-
cific shock ǫim = (ǫim1 , ǫim2 , . . . , ǫimJ )′ is independent across individuals i = 1, 2, . . . , N with joint
distribution denoted by fǫ (·) that is known up to a finite vector of parameters.
     ξmj is a product-specific characteristic known to both consumers and producers in the market
but unobserved to the econometrician. We isolate it from the other characteristics because the
specification question asks whether ξmj enters utility for product j (i.e. whether βiξ 6= 0, γik 6= 0,
    4
      Gandhi, Kim, and Petrin (2011) show that in the automobile data from Berry, Levinsohn, and Pakes (1995)
allowing for these interactions leads to an increase in price elasticities of 60% on average.
    5
      The market index m can index for the same market observed repeatedly over time, a cross-section of markets at
a given point in time, or a combination of the two.




                                                        4
or γip 6= 0). For notational simplicity let θ collect all the parameters in the model (1).6 Letting
(X, p) be the J × (K + 1) matrix of the entire set of characteristics with arbitrary row (Xj′ , pj ),
ξ = (ξ1 , . . . , ξJ )′ , and Pimj (θ) the probability of i choosing j conditional on (X, p, ξ, d), and assuming
that ǫ and ω are independent each other and from (X, p, ξ, d), the choice probability Pimj (θ) is given
by                                    ˆ
                       Pimj (θ) =        1{Uimj > Uimk ∀k 6= j|X, p, ξ, di , θ}dFǫ (ǫ)dFω (ω)                                (2)

where Fǫ (·) and Fω (·) denote the distributions of ǫ and ω, respectively.
   The error term in utility is given by
                                        XK
                       eimj = βiξ ξmj +        γik xmjk ξmj + γip pmj ξmj + ǫimj .
                                                      k=1

When price is in part determined by the omitted attribute, which one can think of as the product-
market demand error, price is endogenous if βiξ 6= 0. For example, if sellers charge higher prices when
their products have more desirable omitted characteristics, the price will be positively correlated
with the demand error, biasing price elasticities upwards. When the interaction terms γik 6= 0 or
γip 6= 0, the econometric problem becomes more complicated, as there are two or more terms in the
error that are not independent of price.7
     There have been two main approaches in estimation to deal with an unobserved demand attribute
that is correlated with price. We illustrate them with the conditional likelihood function for this
problem, given as

                                                      1 XM XNm XJ
                     log LN (Y |X, p, ξ, d, θ) =                     Yimj log Pimj (θ),
                                                      N  m=1 i=1 j=0
             P
where N = M     m=1 Nm and Yimj is an indicator variable that equals one if i is observed to choose j
at a market m.8 The first approach is to integrate out the unobserved attribute. This requires one
to specify the distribution of the demand errors conditional on observed characteristics and price -
Fξ|X,p (ξ|X, p) - and then integrate them out in the calculation of the choice probability given in (2).
The challenge is in the specification of Fξ|X,p (ξ|X, p). It requires that one first know Fp|X,ξ (p|X, ξ),
the distribution of the vector of market prices conditional on all observed and unobserved product
characteristics, and then that one be able to recover Fξ|X,p (ξ|X, p) from Fp|X,ξ (p|X, ξ).
    The second approach is to condition directly on the unobserved vector ξ by inverting it out
of the demand equations following Berry, Levinsohn and Pakes (1995) (or the generalization of it
in Gandhi, Kim, and Petrin (2011) when γik 6= 0 or γip 6= 0). While these approaches allow the
   6
      For fixed parameter models (the coefficients do not vary across i), we have θ = (c′ , β ′ , α, βξ , γ ′ , γp )′ and for
heterogeneous coefficients models in addition to these (mean) parameters, θ also includes the standard deviations (σ =
(σc , σ1 , . . . , σK , σp )) of the random coefficients and other coefficients on demographics or other observed characteristics
of households.
    7
      Here we focus on the endogeneity of price but other observable attributes can also be correlated with the unob-
served demand factor. Indeed the rejection of the price exogeneity in our test can arise due to the endogeneity of
other attributes. We view all of these as an evidence for the endogeneity or the omitted attribute.
    8
      When only the aggregate (market-level) data is available, we replace Yimj with smj , the market share of product
j at a market m and let Pmj (θ) be the choice probability.


                                                               5
researcher to avoid specifying Fξ|X,p (ξ|X, p), they are computationally complex to program and
time-consuming, and are also subject to propagated numerical errors from the inversion, which can
lead to non-convergence in the estimation step, as noted recently in the literature (e.g. Dube, Fox,
and Su (2012) and Knittel and Metaxiglou (2008)). We now turn to explaining our computationally
fast and simple tests which inform the researcher if he/she needs to worry about the presence of an
unobserved demand attribute.


3       Using Proxies to Test if Unobserved Attributes Enter Utility
In this section we develop test statistics - Wald and LM tests - that use proxies for the unobserved
attributes to test for their presence in utility. Our testing philosophy is easiest to understand if we
start by treating the unobserved attribute as if it were observed but omitted from the specification.
For expositional convenience we assume that the taste for the omitted attribute is common across
individuals, so βiξ = βξ , γi = γ, and γip = γp for all i.9
    We refer to our test as the price endogeneity test because the null hypothesis presumes ξ does
not enter utility either in an additive and non-additive utility manner:

                                        H0 : βξ = 0, γ = 0, and γp = 0.                                          (3)

We then deem prices as exogenous if this null hypothesis is true.10 Both the Wald and the LM
formulation of the test of either hypothesis would be consistent under the alternative. In the former
case the terms related to the omitted attribute would be statistically significant in the unconstrained
specification. In the latter case where the constrained model is estimated without the omitted
attribute terms, the residual (Yimj − Pimj (θ)) from this setup would be significantly correlated with
these omitted terms.11
    Since the omitted attribute is not observed, we propose feasible tests that are analogs to the
aforementioned tests but are instead based on using a proxy for the unobserved attribute. Letting
ξ̃mj denote the proxy for ξmj , consistency of the tests only requires that - under the alternative -
there is some dependence between ξmj and ξ̃mj ′ for at least one j ′ , typically for j ′ = j.
    We exploit the source of the endogeneity problem to develop a proxy that should satisfy this
condition. Specifically, letting Zm = (Xm , Z2m ), where Z2m denotes the supply-side factors observ-
able to econometrician, equilibrium prices pmj are in part determined by the demand shocks ξm
conditional on Zm :
                                       Cov(pmj , ξmj ′ |Zm ) 6= 0                                    (4)
    9
     Extensions allowing for the heterogeneous coefficients on the omitted attribute and/or the interaction terms are
straightforward using more parameters.
  10
     If one only wanted to test for unobserved attributes that entered utility linearly then this null would become
  1
H0 : βξ = 0.
  11
     For the test of (3) with observed ξ one can use classical asymptotic tests such as Wald, LM, conditional mean
tests in nonlinear models, see e.g. Newey (1985) and Newey and McFadden (1994).




                                                         6
where the covariance is typically largest for j ′ = j. For our proxies we use the mean-squared
projection residuals of pmj on Zm :

                                            ξ̃mj = pmj − E[pmj |Zm ],                                              (5)

as ξ̃m = (ξ̃m1 , . . . , ξ˜mJ )′ from (5) will not generally be independent of ξmj .12 In Section 5.1, we
provide a more technical discussion of the conditions under which the tests are consistent.
    Our approach then replaces the unobserved ξmj in utility with some chosen functions of ξ̃m ,
denoted as vj (ξ̃m ), where vj (·) can be a vector function and v(·) = (v1 (·), . . . , vJ (·))′ . In practice
one can let vj (ξ̃m ) = ξ˜mj , or one can include ξ˜mj as the leading term when vj (·) is a vector.
We approximate ξ̃mj with ξ̂mj , the difference between pmj and the estimated Ê[pmj |Zm ]: ξˆmj =
pmj − Ê[pmj |Zm ], j = 1, . . . , J. We then replace ξmj with a function of ξˆm , vj (ξ̂m ) (in the simplest
case we choose vj (ξ̂m ) = ξ̂mj ). We discuss estimation of E[pmj |Zm ] for a variety of data generating
processes in Section 4.

3.1    The Wald test
The Wald test includes the controls directly in the estimated specification. Letting λ denote the
parameter on the controls, the utility is specified for estimation as
               XK                                       XK
 Ũimj = cij +      xmjk βik − αi pmj + λ′j vj (ξ̃m ) +      ek′ vj (ξ̃m )xmjk + γ
                                                             γ                   ep′ vj (ξ̃m )pmj + ǫimj , (6)
                    k=1                                              k=1

with vj (ξ̃m ) as the control functions. Under the null hypothesis of exogenous prices the coefficients
λ = (λ′1 , . . . , λ′J )′ ,13 γ    γ1′ , . . . , γ
                              e = (e             eK′ )′ , and γ
                                                              ep are equal to zero because ξ̃m does not affect the
demand given (xm , pm , di ). Therefore we test for the price endogeneity due to the unobserved
attribute by testing the null hypotheses

                                          e 0 : λ = 0, γe = 0, and γep =0.
                                          H                                                                        (7)

This is the feasible version of the test in (3).
    For the formulation of the Wald statistic let θe = (ϑ′ , λ′ , γ
                                                                  e′ , γep′ )′ , where ϑ denotes all parameters
excluding (λ′ , γ    ep′ )′ , and write the sample ML objective function that is used to estimate θe as
                e′ , γ
                                         XM       XNm XJ
                                   e =
                     log LN (ξ̃m , θ)                                                        e
                                                                     Yimj log Pimj (v(ξ̃m ), θ)/N .
                                            m=1      i=1       j=0

                                                     b
Then we obtain the unconstrained parameter estimates θeU that solve the sample analog equations
                              b                                                b
              ∂ log LN (ξ̂m , θeU )   1 XM XNm XJ         ∂ log Pimj (v(ξ̂m ), θeU )
                                    ≡                Yimj                            =0
                     ∂ θe             N  m=1 i=1 j=0                ∂ θe
  12
      If the dependence of pmj on ξm conditional on Zm is not reflected in their conditional covariance - if they are
related by higher moments - then the test using the simple proxy (control) ξ˜m may not reject the null even when
the price is endogenous. If one suspected this were there are alternative ways of obtaining the controls robust to this
situation (e.g., Matzkin (2003), Altonji and Matzkin (2005), and Imbens and Newey (2003)).
   13
      One can restrict λ1 = . . . = λJ depending on applications.


                                                           7
where the conditional choice probability Pimj (v(ξ̂m ), θ) e is obtained based on the specification of
                                                                                                        ′ ′ ′
                                                                                                b′ , γb
utility in (6) but with v(ξ̂m ) replacing v(ξ̃m ). The Wald tests ask whether the coefficients (λ        b
                                                                                                      e ,γ
                                                                                                         ep )
      b
from θeU are statistically different from zero. The test statistic is
                                                        ′ ′    −1 b′ b′ b′ ′
                                                      b
                                                 b′ , γ
                                      TeM,N = N (λ       b
                                                         ep )VeM,N
                                                      e ,γ              e ,γ
                                                                   (λ , γ  ep )

where VeM,N is a consistent estimator of the asymptotic variance matrix of the ML estimator
        ′ ′ ′
      b
      e , γb
 b′ , γ
(λ         ep ) that accounts for the estimated controls. TeM,N follows the asymptotic χ2 distribu-
tion with the degree of freedom equal to the dimension of (λ′ , γ         ep′ )′ . We derive the asymptotic
                                                                     e′ , γ
distribution of the test statistics in Section 5. For definition of VeM,N see Theorem 5.1.
     The Wald approach is attractive for three reasons. The test statistic is easy to compute, requir-
ing no additional calculation beyond standard likelihood function output, and significance of the
coefficients is equivalent to rejecting price exogeneity. The resulting estimates may be suggestive of
the direction and magnitude of the bias arising from the price endogeneity. Finally, the point esti-
mates can be used as starting values for the more complicated correction approaches. Good starting
values can be helpful when the objective function is non-linear in parameters, there are a large num-
ber of parameters, or there are possibly multiple local maxima, which are often characteristics of
these alternative approaches.

3.2    The LM test: Constrained Approach
The LM test imposes λ = 0, γ        e = 0, and γ ep = 0 during estimation and then tests to see if the score
function, which is the derivative of the likelihood with respect to the parameter θ-       e evaluated at the
constrained estimates -, is large in absolute value. From a practical standpoint the LM test is useful
because it does estimation in the constrained case, which can reduce the computational cost when
the number of parameters being tested is large. We start with the test for the price endogeneity
and then develop the test for non-additivity.
    Again let θe = (ϑ′ , λ′ , γe′ , γ
                                    ep′ )′ and let D = dim((λ′ , γ    ep′ )). Then let θeR be the constrained
                                                                 e′ , γ
parameter θeR = (ϑ′ , 0′D )′ where 0D denotes a D × 1 vector of zeros. The maximum likelihood
estimator in the constrained case uses the sample analogs to the D population moments
                                     XJ                   ∂ log Pimj (v(ξ̃m ), θeR )
                                   E[              Yimj                              ] = 0.
                                           j=0                     ∂ϑ
                                    b
The constrained parameter estimates θeR = (ϑ̂′ , 0′D )′ solve the sample analog equations
                             b                                                b
             ∂ log LN (ξ̂m , θeR )   1 XM XNm XJ         ∂ log Pimj (v(ξ̂m ), θeR )
                                   ≡                Yimj                            = 0.                            (8)
                    ∂ϑ               N  m=1 i=1 0=1               ∂ϑ
The LM test is based on the average value of the derivative of the likelihood with respect to θe
evaluated at the constrained parameter estimates:
                               e
                ∂ log LN (ξ̂m ,θ)              1   PM       PNm PJ                                   e
                                                                                 ∂ log Pimj (v(ξ̂m ),θ)
                                           ≡        m=1        i=1    j=0 Yimj                                  .
                        e
                       ∂θ         e b
                                  θ= θeR       N                                          ∂θe             b
                                                                                                        θ=θeR


                                                                8
                                                                b
                                                 ∂ log LN (ξ̂m ,θeR )                        e
                                                                              ∂ log LN (ξ̂m ,θ)
With abuse of notation, we often write                    e             =                       e b
                                                                                                         and also others similarly.
                                                        ∂θ                           ∂ θe       θ= θeR
   Now construct a nonrandom matrix H (with the number of rows equal to the dimension of
(λ′ , γ     such that H θe = 0 becomes the null hypothesis of the price exogeneity (7). Then by
      e′ , γep′ )′ )
                       b               e = − ∂ log LN (ξ̂m ,θ̃) . Then the LM test statistic for price
construction we have H θeR = 0. Let Γ(
                                    b θ)
                                                                      e θe′
                                                                    ∂ θ∂
endogeneity is given by
                                             b                                                    b
                  g          ∂ log LN (ξ̂m , θeR ) b be −1 ′ e −1 be      b be −1 ∂ log LN (ξ̂m , θeR )
                  LM M,N = N                       Γ(θ R ) H VM,N (θ R )H Γ(θR )
                                    ∂ θe′                                                ∂ θe
             b                                                                   √                             be
                                                                                     bb
where VeM,N (θeR ) is a consistent estimator of the asymptotic variance matrix of NH Γ(θeR )−1 ∂ log LN (eξ̂m ,θR ) .
                                                                                                      ∂θ
   Under the null hypothesis of (7), LM  g M,N follows the same asymptotic χ2 distribution with the
corresponding Wald test statistic. See Theorem 5.2 below for this result and also for the construction
          b
of VeM,N (θeR ).


4       Proxy Estimation Across Data Generating Processes
The purpose of estimating E[pmj |Zm ] is to recover the proxy ξˆmj = pmj − Ê[pmj |Zm ]. This step can
be done by least squares using polynomials of Zm as regressors or by nonparametric series estimation
(e.g. Newey (1997)). For the Wald test to have power vj (ξ̂m ) cannot be perfectly collinear with
Xmj and pmj . For the LM test to have power the score associated with the coefficients on vj (ξ̂m )
should not be perfectly collinear with the scores associated with the coefficients on Xmj and pmj .
A sufficient condition is that a variable excluded from Xmj in the instruments set is correlated with
prices (e.g., either characteristics of other products if they are assumed to be exogenous or other
observed supply-side factors).
    The power of the test is increasing in Cov(ξmj , vj (ξ̂m )), which is determined by the variation that
is used to estimate E[pmj |Zm ] and the restrictions placed on E[pmj |Zm ] during estimation. This
variation comes from one or more of the following sources: within market at a given time, across
markets at a given time, or within/across markets over time. To make the discussion concrete,
we illustrate specification and estimation of E[pmj |Zm ] with recent demand applications that make
use of different sources of variation: Goolsbee and Petrin (2004), who look at cable and satellite
television demand, Berry, Levinsohn, and Pakes (1995), who look at automobiles, and Chintagunta,
Dube, and Goh (2005), who look at margarine.
    In Goolsbee and Petrin (2004), almost 30,000 households are observed in over 300 geographically
distinct television markets, and four alternatives are available to households in every market: (1)
antenna only, (2) expanded basic cable service, (3) expanded basic cable with a premium service
added, such as HBO, and (4) satellite dish. The price endogeneity problem arises because unobserved
factors like service or average channel quality are correlated with price but not observed by the
authors. With over 300 variants of each type of product, e.g. expanded basic cable, one can
separately estimate E[pmj |Zm ] for each product using the cross-market variation (allowing the

                                                               9
coefficients of each function to differ for each type of product). Zm includes Xmj and may include
all of the other characteristics of other products in the market, and any other relevant demand and
cost factors.
     Berry, Levinsohn, and Pakes (1995) observe over 100 market-level observations on prices, quan-
tities, and characteristics of automobiles sold in the U.S. for every year from 1971 to 1990. The price
endogeneity problem arises because, with only five included characteristics, additional unobserved
quality (e.g.) is correlated with price. With the automobile data, very few observations are avail-
able on the same nameplate (i.e. the same product) over time, because cars enter, exit, and change
quickly. Unlike the television case, this means some restrictions on E[pmj | Zm ] across vehicles will
be necessary. Some possibilities include restricting parameters to be the same across: all products
and all years, all products within the same year, similar products within a year, or similar products
across years.
     A second difference with the television case is that the number of potential arguments entering
E[ pmj | Zm ] may be quite large; in one extreme case, every product’s characteristics may affect
every product’s price. In a multi-product multi-competitor market Pakes (1994) suggests a parsi-
monious approach that includes three regressors for each characteristic: the characteristic itself, the
sum of the characteristic across own-firm products (excluding that product), and the sum of the
characteristic across rival firm products.
     Chintagunta, Dube, and Goh (2005) (CDG) observe weekly purchase histories of 992 households
between January 1993 and March 1995 collected using checkout-counter scanners. The market for
margarine is similar to that for television in the sense that there are only four choices in their
data: Blue Bonnet, I Can’t Believe It’s Not Butter, Parkay, and Shedd’s. However, unlike television
demand, the physical characteristics of the products are not changing over time. Instead, the price
endogeneity problem arises because weekly retail prices covary with demand-shifting marketing-mix
variables which may not be observed by the econometrician, including: whether the product is
on display, whether it is featured, changes in its shelf-space, the availability of coupons (in-store
or not), or promotions in complementary or substitute categories. CDG observe wholesale prices,
which affect retail prices but do not enter into consumer utility conditional on the retail price. Thus
one could use the residual from the regression of product’s retail price at time t on an intercept
and its wholesale price at time t. If Cov(pmj , ξmj |Zm ) > 0, a large residual is suggestive of more
marketing-mix activities.


5    Asymptotic Distributions of Test Statistics
In this section we derive the asymptotic distributions of the Wald test and the LM test statistics.
Our asymptotic experiment is mainly in the number of markets M as M → ∞ while Nm (the
number of individuals in each market) can be finite or tend to infinity. In both cases note, however,
           P
that N = M    m=1 Nm also tends to infinity as M → ∞. We derive the asymptotic distribution of




                                                  10
the Wald test statistic accounting for the estimated controls.14 The controls ξ̂m are obtained from
regressions of Pm on Zm as
                                 ξ˜mj = pmj − Z′ πj , j = 1, . . . , J
                                                             m

where Zm = Zm or Zm can also include higher order terms of Zm . We can also extend this
(and results below) to nonparametric series estimation but the estimated standard errors under the
parametric regression will be equivalent to those that would be obtained under the nonparamet-
ric regression given approximation anyway (e.g. Newey (1997)), so we present our results in the
parametric flexible regression context.
               √                   1 PM        ′ −1 √1
                                                        PM      ′ ξ̃
                                                                                   √
    Note that M (b  πj − πj0 ) = ( M  m=1 Zm Zm )    M    m=1 Z m    mj and we let      πj − πj0 ) →d
                                                                                     M (b
̟j where (̟1 , . . . , ̟J ) follow a joint normal distribution. We write ξ̃mj (π) = pmj − Z′m πj , ξ̂mj =
ξ̃mj (π̂), and ξ̃mj = ξ˜mj (π0 ) for j = 1, . . . , J.
     The regularity conditions below that validate the asymptotic distributions and the consistency
of the variance matrix estimators are fairly standard (see Newey and McFadden (1994) for example).
We collect a set of sufficient conditions that render the asymptotic χ2 distribution of TeM,N here and
                                                                       p
also that of LMg M,N . We let π = (π ′ , . . . , π ′ )′ and let ||A|| = tr(A′ A) for a matrix or a vector A.
                                         1           J
                                1 PM              ′                        1 PM       2      ′
Also let ΣZZ = plimM →∞ M            m=1 Zm Zm and Σξ̃ 2 ZZ = plimM →∞ M        m=1 ξ̃mj Zm Zm .
                                                                 j



Assumption 5.1 (i) {pm , Zm }m≤M are independently distributed across m and {Yim1 , . . . , YimJ , di }m≤M
                                                                                                       i≤Nm
are independently and identically distributed across i and are independently distributed across m;
(ii) E[||ξ̃m ||4 ] < ∞ and E[||Zm ||4 ] < ∞ for all m; (iii) ΣZZ is nonsingular.
                                 √
   Then under Assumption 5.1 M (b     πj − πj0 ) →d ̟j ∼ N (0, Σ−1           −1
                                                                ZZ Σξ̃j2 ZZ ΣZZ ) for all j by the
Lindeberg-Feller CLT. We let θe0 denote the true value of θ.
                                                          e

                              b              b
Assumption 5.2 (i)(a) θeU →p θe0 , (b) θeR →p θe0 under the null (7); (ii) θe0 is in the interior of Θ;             e
                     e is twice continuously differentiable in θe on some neighborhood Θ
(iii) Pimj (v(ξ̃m ), θ)                                                                          e 0 of θe0 (Θ
                                                                                                             e 0 ⊂ Θ);
                                                                                                                   e
                                                           ∂ 2 log P     (v(ξ̃  (π)), e
                                                                                      θ)
                     e is Lipschitz in ξ̃m for all j; (v)
(iv) Pimj (v(ξ̃m ), θ)                                               imj      m
                                                                                         is continuous in (θ, e π) for
                                                                              e θe′
                                                                            ∂ θ∂
                                            ′ , p′ , ξ˜′ , d )′ and E[ ∂ log LN (ξem ,θe0 ) ] is nonsingular
                                    fmi = (Xm
all w ∈ W, W denotes the support of W            m m i                        e e′                 ∂ θ∂ θ
                                                                                 e
                                                          ∂ log Pimj (v(ξ̃m (π)),θ)
for all M large enough; (vi) E[supθ∈         e 0 ,π∈Π0 ||
                                           e Θ                       e θe′
                                                                   ∂ θ∂
                                                                                    ||] < ∞ for all j and m where Π0
                                                                                                e 4
                                                                        ∂ log Pimj (v(ξ̃m (π)),θ)
denotes some neighborhood of π0 ; (vii) E[supθ∈        e Θ e 0 ,π∈Π0 ||            ∂θe            || ] < ∞ for all j and m;
        2                     e
       ∂ log Pimj (v(ξ̃m (π)),θ)                                                                          2                 e 2
(viii)                                              e π) for all w ∈ W and E[ sup || ∂ log Pimj (v(ξ̃m (π)),θ)
                                 is continuous in (θ,                                                                        || ]   <
               e
             ∂ θ∂vj ′ (ξ̃m )                                                                                  e
                                                                                                            ∂ θ∂vj ′ (ξ̃m )
                                                                                         e Θ
                                                                                         θ∈ e 0 ,π∈Π0
∞ for all j, j ′ , and m.

    To obtain the asymptotic distribution of the Wald test statistic we first derive the asymptotic
distribution of the unconstrained ML estimator that uses the estimated controls.
  14
     Our asymptotic distributions here do not include simulation errors to approximate (e.g.) the distribution of
random coefficients. If one uses simulations to approximate the distribution of random coefficients, one can add an
additional variance term that arises from the simulation as in BLP.



                                                             11
Lemma 5.1 Suppose Assumptions 5.1 and 5.2 hold.
      √ b                                                                                       ∂ log LN (ξ̃m ,θe0 )
Then M (θeU − θe0 ) →d N (0, Γ−1              M          −1
                               0 (Γ0 ·limM →∞ N +V1 )Γ0 ) where Γ0 = limM →∞ E[−                        e θe′        ],
     P                                                                                                ∂ θ∂
                            ′                             N,M e ˜
V1 = j,k Λ0j Cov(̟j , ̟k )Λ0k , and Λ0j = limM →∞ E[Λj (θ0 , ξm )]
                                                                              e ∂v (ξ̃ ) ∂ ξ̃
           e ξ˜m ) ≡ PM PNm PJ′′ Y ′′ PJ′
                                                     ∂ 2 log Pimj ′′ (v(ξ̃m ),θ)
with ΛN,M                                                                         j′ m       mj
      j   (θ,         m=1     i=1  j =0   imj   j =1         e                   ∂ ξ̃     ∂πj /N.
                                                                    ∂ θ∂vj ′ (ξ̃m )      mj


See Appendix A.1 for the proof.
                                                                                                     b
    To obtain a consistent estimator of the variance matrix, we use Γ      b = − ∂ log LN (ξ̂m ,θeU ) for Γ0 and
                                                                                         e θe′
                                                                                       ∂ θ∂
     P      N,M   b                    N,M   b
Vb1 = j,k Λj (θeU , ξˆm )Cov(̟
                         d j , ̟k )Λ
                                       k    (θeU , ξˆm ) for V1 where Cov(̟
                                                        ′                 d j , ̟k ) is obtained from

                      XM                    X                               X
                                                     M                             M
     d
     Cov(̟j , ̟k ) = (            ′
                              Zm Zm /M ) −1                             ′
                                                          ξ̂mj ξ̂mk Zm Zm /M (           Zm Z′m /M )−1 .
                             m=1                         m=1                               m=1

When one assumes homoskedasticity across m and zero correlations of ξ̃mj across products j 6= k,
                       P
V1 can simplify to V1 = Jj=1 Λ0j (ΣZZ )−1 E[ξ̃mj
                                              2 ]Λ′ .
                                                  0j
   Next we derive the asymptotic distribution of the Wald test statistic.

Theorem 5.1 Suppose Assumptions 5.1 and 5.2 (i)(a) and (ii)-(viii) hold. Then for the Wald
                                    ′ ′    −1 b′ b′ b′ ′
statistic we have TeM,N = N (λ    b
                             b′ , γ  b
                                     ep )VeM,N
                                  e ,γ                 ep ) →d χ2 (dim((λ′ , γ
                                                    e ,γ
                                               (λ , γ                             ep′ )′ )) with VeM,N = H Γ
                                                                             e′ , γ                        b−1 (Γ+
                                                                                                                b
Vb1 )Γ
   N
   M
       b H where
        −1   ′


                                      be
                b = − ∂ log LN (ξ̂m , θ U ) ,
                Γ
                              e θe′
                            ∂ θ∂
                     X N,M
          Vb1 (θ̃) =                    d j , ̟k )ΛN,M (θ̃, ξˆm )′ , V̂1 = Vb1 (b
                        Λj (θ̃, ξˆm )Cov(̟                                      θeU ),
                                                   k
                     j,k
                   XM XNm XJ                      XJ ∂ 2 log Pimj ′′ (v(ξ̃m ), θ) e ∂vj ′ (ξ̃m ) ∂ ξ̃mj
 ΛN,M  e ξ̃m ) = 1
      (θ,                                Y imj ′′                                                       , and
  j                                                                e j ′ (ξ̃m )
                 N   m=1   i=1   j ′′ =0             j ′ =1      ∂ θ∂v               ∂ ξ̃mj ∂πj
                  XM                 X                                X
                                            M                                   M
 d
 Cov(̟j , ̟k ) = (        ′
                      Zm Zm /M )−1                              ′
                                                  ξ̂mj ξ̂mk Zm Zm /M (             Zm Z′m /M )−1 .
                           m=1                       m=1                               m=1


   Proof. Note that we use the nonrandom matrix H such that H θe = 0 represents the null
hypothesis of the price exogeneity (7). Then with the variance-covariance matrix estimator of
√     b
  N H θeU as VeM,N = H Γ
                       b−1 (Γ
                            b + Vb1 N )Γ
                                       b −1 H ′ , we obtain
                                         M
                                                                                   −1
                 b ′ b′ b′ e −1 b′ b′ b′ ′             be ′     −1 b M                    b
       e             e ,γ
       TM,N = N (λ , γ  ep )VM,N (λ , γ                       b
                                         ep ) = M · (H θU ) H Γ (Γ
                                      e ,γ                               b   b −1 ′
                                                                       + V1 )Γ H        H θeU .
                                                                     N

Therefore, by the continuous mapping theorem, TeM,N →d χ2 with the degree of freedom equal
to the dimension of (λ′ , γ
                          e′ , γ
                               ep′ )′ (i.e. the number of rows in H) because Lemma 5.1, Γ          b →p Γ 0 ,
                               √       n                            o −1/2   b
and Vb1 →p V1 implies Z ≡ M H Γ                 b M + Vb1 )Γ
                                           b−1 (Γ
                                                  N
                                                           b −1 H ′        H θeU →d N (0, I) and TeM,N is the
quadratic function of Z.
    Next we show that the LM test statistic has the same asymptotic distribution of the correspond-
ing Wald test statistic.

                                                          12
Theorem 5.2 Suppose Assumptions 5.1 and 5.2(i)(b) and (ii)-(viii) hold. Then for the LM statistic
we have
                           b                                                    b
g          ∂ log LN (ξ̂m , θeR ) b be −1 ′ e −1 be      b be −1 ∂ log LN (ξ̂m , θeR )
LM M,N = N                       Γ(θ R ) H VM,N (θ R )H Γ(θR )                        →d χ2 (dim((λ′ , γ
                                                                                                       e′ , γ
                                                                                                            ep′ )′ ))
                  ∂ θe′                                                ∂ θe
             b         bb         bb             b N b be −1 ′
where VeM,N (θeR ) = H Γ(θeR )−1 (Γ(θeR ) + Vb1 (θeR ) M )Γ(θ R ) H .

    See Appendix A.2 for the proof.

5.1     Test Consistency
Here we further discuss the test consistency of price endogeneity. The Wald test is consistent as long
                      ′ ′ ′
as plimM →∞ (λb′ , γb  b
                       ep ) 6= 0 under the alternative against (7) i.e. plimM →∞ TeM,N = ∞ under the
                    e ,γ
alternative. Therefore the Wald test is consistent under the alternative as long as the unobserved
attribute that is correlated with price enters utility and the proxy is correlated with the unobserved
attribute.
    The LM test is more involved. To understand the consistency of the LM test, we first need to re-
                                                  P            e = 1 implies PJ Pimj (·, θ)                      e
                                                                                                 e ∂ log Pimj (·,θ)
formulate the LM statistic as below. Note that Jj=0 Pimj (·, θ)                   j=0                      e        =
                                                                                                          ∂θ
                                       e       P
                                               M NP m PJ                                  e
                                                                          e ∂ log Pimj (·,θ)
0. We therefore can write ∂ log LeN (·,θ) = N1           (Yimj − Pimj (·, θ))       e        . Define
                                     ∂θ             m=1 i=1 j=0                                      ∂θ


                                                  e = Yimj − Pimj (·, θ)
                                            uimj (θ)                  e

                   b                               b
and also let uimj (θeR ) = Yimj − Pimj (v(ξ̂m ), θeR ) with abuse of notation. Then                          the LM test statistic
can be written as
                                                                            !
                           P
                           M NP m P
                                  J                       be
                                                                       b
                 N 1
                                     ∂ log P imj (v(ξ̂m ), θ R )              bb
                                                                 uimj (θeR ) Γ(θeR )−1 H ′ Ve −1
                                                                                                         be     b be −1
                          N                        ∂ θe′                                            M,N (θ R )H Γ(θ R )
      g M,N =                 m=1 i=1 j=0
      LM                                                                                             !
                                                  P P
                                                  M N m P
                                                        J
                                                                      b ∂ log Pimj (v(ξ̂m ),bθeR )
                                       ×    1
                                            N                   uimj (θeR )         e                    .
                                                m=1 i=1 j=0                               ∂θ


                                                             ∂ log Pimj (v(ξ̃m ),θe0 )
Recall that θe0 denotes the true value of θ.
                                          e Then                                         must be uncorrelated with uimj (θe0 )
                                                                      ∂ θe
because θe0 solves the moment condition
                                                       M Nm X
                                                            J
                        ∂ log LN (ξ̃m , θe0 )        1 XX                 ∂ log Pimj (v(ξ̃m ), θe0 )
               0 = E[                         ] = E[          uimj (θe0 )                            ]                         (9)
                               ∂ θe                  N     m=1 i=1 j=0             ∂ θe

and this is not equal to zero for any θe 6= θe0 . Therefore the LM statistic looks at the covariance
                              b
          ∂ log Pimj (v(ξ̂m ),θeR )
between               e             and uimj (θêR ) to detect the violation of this moment condition, which
                   ∂θ
plays the role of an evidence against the null hypothesis.
                                P                         e
                                      ∂ log Pimj (v(ξ̃m ),θ)                                 e = 1 P P E[him (v(ξ̃m ), θ)].
                                                                   e and let E[him (v(ξ̃m ), θ)]
                                                                                                   M Nm
                                                                                                                       e
    Let him (v(ξ̃m ), θ̃) = Jj=0                 e           uimj (θ)                            N
                                             ∂θ                                                                  m=1 i=1
                                e = 0 when θe = θe0 , so the LM test uses him (v(ξ̃m ), θ̃) to detect a
Again note that E[him (v(ξ̃m ), θ)]

                                                              13
violation of θe = θe0 , which is equivalent to the violation of the population moment condition (9).
                                   be
Further denote θeR A = plim
                             M →∞ θ R under the alternative hypothesis against (7). Then, the main
substantive condition for test consistency as we show in Theorem A.1 in Appendix A.3 is that we
require
                                      lim ||E[him (v(ξ̃m ), θeR
                                                              A
                                                                     6 0
                                                                )]|| =                         (10)
                                            M →∞

for some function v(ξ̃m ) when prices are endogenous (i.e., the alternative hypothesis is true).15 This
means that for the test consistency v(ξ̃m ) should be chosen such that it can detect the nonzero
                     ∂ log Pimj (v(ξ̃m ),θeR
                                           A)
correlation between                           and uimj (θeA ) under the alternative hypothesis. Theorem A.1
                                                                  R
                                    ∂ θe
in Appendix A.3 spells out the exact conditions under which the LM test is consistent.
Remark 1 To further understand how the LM test works, without loss of generality, let the 0-th
good                                                                                     e =
  PJbe the outside good (i.e., ξm0 = 0, xm0 = 0, pm0 = 0, and Uim0 = ǫim0 ). From uim0 (θ)
            e it follows that
− j=1 uimj (θ),
 XJ                        e
            ∂ log Pimj (·, θ)            XJ ∂ log Pimj (·, θ)
                                                           e             XJ ∂ log Pim0 (·, θ)
                                                                                           e
                                    e =
                              uimj (θ)                              e −
                                                              uimj (θ)                              e
                                                                                              uimj (θ)
      j=0          ∂ θe                   j=1      ∂ θe                     j=1     ∂ θe
                                         XJ ∂ log(Pimj (·, θ)/P
                                                            e im0 (·, θ))
                                                                       e
                                       =                                        e
                                                                          uimj (θ).
                                          j=1             ∂ θe
Define the part of the mean utility for the product j that is common across consumers as δmj (ξ̃m ).
Then in particular we have
XJ                               b                 J
                                                   X                  b                    b
          ∂ log Pimj (v(ξ̂m ), θeR )       be        ∂{Pimj (v(ξ̂m ), θeR )/Pim0 (v(ξ̂m ), θeR )}/∂δmj
                                     uimj (θ R ) =                                                                          (11)
    j=0        ∂(λ′ , γ
                      e′ , γ
                           ep′ )                                         b                    b
                                                    j=1  P (v(ξ̂ ), θe )/P (v(ξ̂ ), θe )
                                                                      imj   m       R   im0      m        R
                                                                                                                              b
                                                 × {vj (ξ̂m ) , xmj1 vj (ξ̂m ) , . . . , xmjK vj (ξ̂m ) , pmj v(ξ̂m )′ }uimj (θeR ),
                                                              ′                 ′                     ′


which is the sum of the products of the omitted attributes (including interaction terms) and the
residuals scaled by “hazard rates” (normalized w.r.t. the outside good) of purchases with respect to
the mean utilities. Therefore the LM test rejects if the omitted attribute can significantly account for
any of the purchase decision residual (i.e., if their correlation is significant). Indeed (11) simplifies to
PJ ∂ log Pimj (v(ξ̂m ),bθeR )       b        P                                                                                 b
   j=0     ∂(λ′ ,e
                 γ ′ ,e
                      γp′ )   uimj (θeR ) = Jj=1 {vj (ξ̂m )′ , xmj1 vj (ξ̂m )′ , . . . , xmjK vj (ξ̂m )′ , pmj v(ξ̂m )′ }uimj (θeR )
for the multinomial choice logit model (i.e., ǫ follows the type I extreme value distribution) without
random coefficients. Therefore in the simple logit case the LM test seeks the correlation between
                                                                                                b
the controls {vj (ξ̂m )′ , xmj1 vj (ξ̂m )′ , . . . , xmjK vj (ξ̂m )′ , pmj v(ξ̂m )′ } and uimj (θeR ) to detect a violation
of the moment condition (9).


6     Monte Carlo Experiments
We construct Monte Carlo data for different situations with an unobserved attribute correlated with
price. A product is sold in each of several markets and its attributes and price vary by markets.
   15
      Note that in (10) we allow for non-identically distributed data (e.g., the distributions of prices and/or
the unobserved attributes are different across markets). If the data is iid across i and m, (10) simplifies to
||E[him (v(ξ˜m ), θR
                   A
                     )]|| 6= 0.


                                                                  14
Each consumer lives in one market and either buys or does not buy the product offered in that
market. The utility that consumer i who lives in market m obtains from the product is

                               Uim = β0 + βi xm + βξ ξm − αpm + ǫim ,

where xm is a product attribute that is observed by the researcher, ξm is a product attribute that
is not observed by the researcher, and pm is the price of the product. βi , the random coefficient on
xm , is distributed N (βx , σx2 ), and ǫi is distributed as logit. Given these assumptions the share of
consumers buying the product in market m is given by

                                       exp(β0 + βi xm + βξ ξm − αpm )
                                   ˆ
                          sm =                                           dF (βi )
                                     1 + exp(β0 + βi xm + βξ ξm − αpm )

where F (βi ) denotes the distribution function of the random coefficient.
   We first examine four different monte carlo cases with only the specification for marginal cost
varying across the cases (we add two cases of exogenous prices later). They are designed to generate
a wide range of correlations between price and the unobserved factor while maintaining a reasonable
range of prices and market shares. Price is set at a markup over marginal cost based on static profit
maximization:
                                                        sm
                                       pm = mcm −             .
                                                     ∂sm /∂pm
In all specifications below xm enters marginal cost, as do two other variables which do not affect
demand: wm , which is a cost-shifter observed by the researcher, and am , which is a cost shock that
is not observed. Cases 1-4, in order, are given as:

                            [1] mcm = 10 + xm + ξm + wm + am
                            [2] mcm = 10 + xm + wm + am
                            [3] mcm = 10 + exp(xm + ξm + wm + am )
                            [4] mcm = 10 + exp(xm + wm + am ).

In two of the four specifications ξm does not enter marginal costs, which unambiguously lowers
Corr(pm, ξm ). In two cases cost factors enter marginal costs linearly, and in two cases they enter
exponentially. Each of the random variables xm , ξm , wm , and am is assumed to be an i.i.d. N (0, 0.5)
deviate. All parameters of the utility and cost functions are set equal to 1, except for the intercepts,
which equal 10, and the variance in taste for xm , which is equal to 0.5.
     To evaluate whether the Wald test does not overreject the hypothesis of the exogenous price
when the null hypothesis is true, we also generate the demand data without an unobserved attribute
(i.e. βξ = 0). We consider two additional specifications of the marginal costs:

                               [5] mcm = 10 + xm + wm + am
                               [6] mcm = 10 + exp(xm + wm + am ).


                                                  15
    The researcher is assumed to observe 20 purchase decisions per market for 200 markets, which
are used to construct the estimate for sm . The researcher does not observe ξm and am in each
market, instead seeing only xm , wm , and pm , and OLS is used to estimate the residuals ξ̂m =
pm − Ê[pm |xm , wm ]. While it makes the test less powerful we assume the researcher mistakenly adds
a random coefficient, which is typical in many specifications. This adds a new parameter σ, the s.d.
of the additional error term, and leads to estimation of the utility function given by
                            Ũim = β0 + βi xm + λξ̂m − αpm + σιm + ǫim ,                            (12)
where ιm is distributed N (0, 1).
    The demand parameters are estimated using maximum likelihood in two ways. First we exclude
ξ̂m from the specification to see how much bias the price endogeneity generates. We then follow
the Wald approach from Section 3.1, including ξ̂m directly in the likelihood function and testing
its coefficient λ for significance. For the standard errors from the Wald approach we bootstrap,
repeating estimation 500 times (that is, on 500 different datasets, each with 200 markets) and
using the variance of the parameter estimates across these 500 cases to construct estimates of the
distribution of parameters under the null and alternative hypotheses.
    Table 1 summarizes the Monte Carlo data. Reported statistics are calculated for each sample
of 200 markets, and then are averaged over the 500 iterations. The first four columns are the
endogenous price specifications and the last two columns are the exogenous price specifications.
Prices range from approximately 10 to 14. For the linear marginal cost specifications the 10%-90%
range for shares is from 0.11 to 0.38 and for the exponential specifications they range from 0.02 to
0.19. Corr(pm , ξm ) is respectively 0.55, 0.15, 0.40, and 0.03 for endogenous prices and 0 for the
exogenous price cases. The correlations are substantially higher in specifications 1 and 3 where the
unobserved demand attribute affects costs.
    Table 2 reports the parameter estimates for the approach without ξ̂m and for the Wald-type test
specification from Section 3.1. The average of the parameter estimates and their standard deviation
across the 500 iterations are reported first for the specification without ξ̂m . Next, the six parameters
associated with the Wald test specification are reported, where the two new parameters are σ, the
standard deviation of the additional error term, and λ, the coefficient on ξ̂m . Test results for the
null hypothesis that λ = 0 are reported at the bottom. We discuss each case in turn.

6.1     Endogenous Prices
6.1.1    Case 1: Linear marginal costs

Case 1 has marginal costs linear in all of the demand and cost factors. The average correlation
between price and the unobserved attribute is 0.55. The constrained approach is severely biased
downward, with the price coefficient estimated to be 0.51, half of the true value of 1 (the standard
deviation is 0.03). The other estimates are similarly biased down to almost half of their true values.
   When ξ̂m is included in the specification, λ enters with a coefficient of 0.62 and a standard
deviation of 0.10. The test rejects the null hypothesis in every one of the 500 replications at a size

                                                   16
of 0.01. The average estimate of the price coefficients across the iterations is equal to 0.99, with a
standard deviation 0.09. The other averaged point estimates are similarly close to their true values.

6.1.2    Case 2: Unobserved demand attribute does not affect (linear) marginal cost

Case 2 has linear marginal costs, but ξm excluded, lowering the correlation between price and ξm
to 0.15. The constrained model continues to perform poorly, with the point estimate for the price
coefficient on average equal to 0.74 (with standard deviation 0.06). Other parameter estimates are
similarly biased down. λ enters with a coefficient that is on average equal to 0.39, and the test
rejects in over 99% of the 500 cases at the 0.01 significance level.

6.1.3    Case 3: Exponential marginal costs

Case 3 defines marginal cost to be exponential in all demand and cost factors. Since the cost
variables do not enter utility, in some markets the high prices lead to very low demand; on average
7% of markets have demand shares less than 1%. The non-linearity causes the correlation between
price and the unobserved demand attribute to fall to 0.40 (relative to the linear case of 0.55).
    The constrained estimates are again severely biased downward. The average point estimate on
price is 0.63 and the standard deviation is 0.03, and other coefficients exhibit similar problems. The
Wald-type test again easily identifies the specification problem, rejecting at 0.01 significance level
in over 99% of cases. The Wald estimate for the price coefficient is on average 0.81 with standard
deviation 0.09.

6.1.4    Case 4: Unobserved demand attribute does not affect (exponential) marginal
         cost

Case 4 defines marginal cost to be exponential in demand and cost factors with ξm excluded. With
non-linearity in costs this exclusion causes the correlation between price and the unobserved demand
attribute falls to 0.03.
    The price coefficient in the constrained approach is again biased down. The test continues to
identify the unobserved attribute problem, rejecting at significance level 0.01 in 85% of cases and
at 0.10 level 93% of cases. The Wald-test specification has a price coefficient of 0.94 vs. 1, and the
other coefficients are respectively 9.2 vs 10, 1.0 vs 1.0, and 0.41 vs 0.5.

6.2     Exogenous Prices
6.2.1    Case 5: Linear marginal costs

In this case both estimation approaches produce estimates very close to their true values. Thus,
the Wald-type test does not reject the price exogeneity as expected. Here we are interested in the
actual size of the test. Table 2 shows that the size of test is very close to the significance level.
Under the null hypothesis (our DGP), the Wald-type test shows 1.2 % rejection of 500 cases with



                                                 17
0.01 significance level and 9.4 % rejection with 0.10 significance level. Therefore the Wald-type test
does not overreject the null when the null hypothesis is true.

6.2.2     Case 6: Exponential marginal costs

In this case too both estimation approaches produce all estimates very close to their true values.
Under the null hypothesis, the Wald-type test has 1.2 % rejection of 500 cases with 0.01 signifi-
cance level and 9.0 % rejection with 0.10 significance level. Therefore the Wald-type test does not
overreject in this case too.


7        Demand for Television
Our empirical application applies the test to the model of demand for households’ choice among
television reception options from Goolsbee and Petrin (2004), who emphasize the importance of
omitted attributes. We estimate both the constrained model (without the attribute) and the Wald-
type test specification described in Section 3.1, where ξˆm are included directly as new regressors in
the likelihood function.

7.1      Data and Demand Specification
The data and specification are very similar to Goolsbee and Petrin (2004) and Petrin and Train
(2010). The data come from two sources: Forrester Technographics 2001 and Warren Publishing’s
2001 Cable and Television Factbook. We restrict our analysis to a subsample of the 30,000 house-
holds from the original work, using 11,810 households that reside in 172 geographically distinct
television markets. Each market contains only one cable franchise, and four alternatives are avail-
able to households: (1) antenna only, (2) expanded basic cable service, (3) expanded basic cable
with a premium service added, such as HBO, and (4) satellite dish.
    Estimated utility is given as
                                  X5
                Ũimj = αpmj +              θg pmj 1ig + β0′ xmj + γj′ di + σιi cj + λj ξ̂mj + ǫimj .
                                      g=2


xmj are the observed characteristics of the product and includes a product intercept term. ξˆmj is
the proxy and has λj as its coefficient. The price effect varies across five income groups, with the
lowest income group taken as the base and the binary variable 1ig indicating whether household i is
in income group g.16 Demographic variables for household i are given by di and enter each choice
j with a separate coefficient vector γj . A random coefficient is included to allow for correlation
in unobserved utility over the three non-antenna alternatives: cj = 1 if j is one of the three non-
antenna alternatives and cj = 0 otherwise, ιi is an i.i.d. standard normal deviate, and σ is its
    16
     The price coefficient for a household in the lowest income group is α while that for a household in group g > 1
is α + θg .




                                                         18
standard deviation, reflecting the degree of correlation among the non-antenna alternatives. ǫimj is
i.i.d. extreme value.17
     In the Forrester survey, respondents reported the type of television medium that they have.18
The Forrester survey also provides the demographic information they use, including family income,
household size, education, and type of living accommodations. Finally, the survey includes an
identifier for the household’s television market, which links households to their cable franchise
provider (whether they subscribe to cable or not).
     The cable system information comes from Warren Publishing’s 2001 Television and Cable Fact-
book. The attributes we include, which vary over markets, are the channel capacity of a cable
system, the number of pay channels available, whether pay per view is available from that cable
franchise, the price of expanded basic service, the price of premium service, and the number of over-
the-air channels available. Many of the cable operators are owned by multiple system operators
(MSO’s) like AT+T and Time-Warner, and we include MSO dummy variables, one for each of the
two cable choices for each operator. Satellite prices do not vary geographically, and the price of
antenna-only is assumed to be zero.19 More complete details are provided in Goolsbee and Petrin
(2004).

7.2    Estimation of the control
We estimate the controls product by product using the cross-market variation from the 172 different
observations on each product. However, since price does not vary across geographic location for
antenna-only and satellite, we do not construct proxies for these products. We obtain the control
term for expanded basic by regressing its price on all of the product attributes listed above for
the product choices available in the market. In addition we include Hausman (1997)-type price
instruments, one for expanded basic and premium each. The price instrument for market m is
calculated as the average price in other markets that are served by the same multiple system
operator as market m, and is intended to reflect common costs of the multiple system operator.
The premium control term is constructed in a similar manner.
  17
     The error specification in Goolsbee and Petrin (2004) is more flexible; they use a multivariate normal specification
in place of the logit error.
  18
     Specifically, they report whether they have cable or satellite, and the amount they spend on premium television.
Respondents are classified as having premium if they reported that they have cable and spend more than $10 per
month on premium viewing, which is the average price of the most popular premium channel, HBO. We classified
respondents as choosing expanded basic if they reported that they have cable and they spend less than $10 per month
on premium viewing.
  19
     For the price of satellite, we use $50 per month plus an annual $100 installation and equipment cost.




                                                           19
7.3    Results
Table 3 gives the estimated parameters and standard errors for the two approaches.20 The first
column of Table 3 gives the constrained model while the second column includes ξˆmj as new regres-
sors. The coefficients on the expanded basic and premium controls are reported first, followed by
the base price coefficient. Both controls enter significantly (i.e. we reject exogenous prices) and with
a positive sign, identifying the price endogeneity problem and suggesting that products with large
proxies possess desirable attributes omitted from the specification. Inclusion of the controls also
raises the magnitude of the estimated base price coefficient by 500%, from -0.02 to -0.09, consistent
with bias associated with a positive correlation between the unobserved attributes and prices.


8     Conclusion
In applications of differentiated product models all of the relevant product attributes may not be
observed by the econometrician. In this case price may be positively correlated with the unobserved
portion of consumers’ utility for that product: producers charge more and consumers are willing
pay more for products with more of the omitted attribute, holding all else constant. This positive
correlation biases estimates of price elasticities upwards, and evidence of it has been found in many
applications spanning a wide range of markets and differing data types. The problem can be
exacerbated when the interaction of price and the omitted attribute enters the consumer utility.
    In this paper we develop a class of asymptotic tests for the price endogeneity. Our tests can
allow for the non-additive separability between price and the omitted attribute. They are easy
to implement in standard regression packages and have reasonable power against the “exogenous
prices” hypothesis. The tests include control function type tests of specification.
    A major advantage of our testing approaches is their simplicity. They all use least squares or
nonparametric regression in an initial stage to obtain the proxies, followed by a second stage of
likelihood function maximization. The control function test includes the controls directly in the
maximization of the likelihood function and tests for their significance.
    We describe approaches to implementing the tests for three of the recent demand exercises
mentioned above, where prices are shown to be endogenous. Each of these exercises uses a dif-
ferent kind of data, including aggregate (market-level) data (Berry, Levinsohn, and Pakes (1995)),
household-level cross-sectional data (Goolsbee and Petrin (2004)), and household-level panel data
   20
      We bootstrap to account for the additional variance from estimating the expected price. Specifically, we add
a new term to the standard estimate of variance of the parameters. We calculate the new term by first drawing a
bootstrapped sample of prices and observed demand and supply factors from the 172 markets. We then estimate
Ê[pmj |Zm ] and calculate the implied (new) controls, and then re-estimate the model with these controls. We repeat
this process and then compute the the variance in parameter estimates over the bootstrapped price samples, adding
this variance to the traditional formulas. The adjustment is important for the standard errors of the base price
coefficient, the coefficients for the residuals, and the coefficients of the product attributes, which increase between
50-100%. Karaca-Mandic and Train (2002) provide a formula for the asymptotic standard errors in this type of
two-step estimation; they find that in our application the formula gives standard errors that are very similar to those
obtained with the bootstrap procedure.



                                                          20
(Chintagunta, Dube, and Goh (2005)). Our Monte Carlos draw on a formulation where prices are set
according to a non-linear in characteristics, inverse-elasticity rule. Our simplest test specifications
identify the price endogeneity problem in almost every case.




                                                  21
                                                Table 1
                            Summary of Data Generated in Monte Carlo Samples
                               True values: α = 1, β0 = 10, βx = 1, σx = 0.5
 Case                        [1]          [2]           [3]            [4]                [5]           [6]
 Price Range
    Mean                    11.31          11.33             12.75         12.57         11.32         12.57
    10%-90%              10.17-12.45    10.36-12.28       11.41-14.60   11.49-14.03   10.37-12.27   11.49-14.03

 Share Range
   Mean                       0.22          0.23              0.09          0.10          0.23          0.10
   10%-90%                 0.11-0.34     0.10-0.38         0.01-0.16     0.02-0.19     0.12-0.35     0.02-0.17
   % of markets with
       shares < 0.01         0.0%         0.0%              7.4%          5.7%           0.0%         5.4%
       shares < 0.10         5.8%         10.0%             57.1%         53.5%          5.8%         51.0%

 Corr(pm , ξm )              0.55          0.15              0.40          0.03          0.00          0.00
 Marginal Costs
   Linear                    Yes           Yes               No            No            Yes           No
   Exponential               No            No                Yes           Yes           No            Yes
   Include ξm                Yes           No                Yes           No            No            No
Cases [1]-[4] are with an omitted attribute (βξ = 1) and Cases [5]-[6] are with no omitted attribute
(βξ = 0). Reported numbers are the statistics for each of the samples with 200 markets averaged over the
500 Monte Carlo iterations.




                                                     22
                                                Table 2
            Constrained Model and Wald-type Test Specification for Monte Carlo Data
                       200 markets, 20 observations per market, 500 iterations
                          True values: α = 1, β0 = 10, βx = 1, σx = 0.5
      Case                                  [1]       [2]    [3]       [4]       [5]     [6]
        Constrained Model
        α                                  0.51     0.74    0.63      0.86      1.00    1.00
                                         (0.03)    (0.06)  (0.03)    (0.05)    (0.01)  (0.01)
        β0                                 4.56     7.17    5.52      8.40      9.97    9.98
                                         (0.38)    (0.69)  (0.43)    (0.66)    (0.09)  (0.09)
        βx                                 0.51     0.74    0.65      0.88      1.00    1.00
                                         (0.06)    (0.09)  (0.07)    (0.09)    (0.02)  (0.02)
        σx                                 0.23     0.24    0.12      0.22      0.34    0.44
                                         (0.45)    (0.49)  (0.33)    (0.41)    (0.25)  (0.13)
        Wald Test/Control Function
        α                                  0.99     1.01    0.81      0.94      1.00    1.00
                                         (0.09)    (0.26)  (0.08)    (0.09)    (0.01)  (0.01)
        β0                                 9.90     10.13   7.69      9.20      9.98    9.98
                                         (1.11)    (2.48)  (0.95)    (1.02)    (0.12)  (0.09)
        βx                                 0.99     1.01    0.99      1.00      1.00    1.00
                                         (0.12)    (0.25)  (0.13)    (0.14)    (0.02)  (0.02)
        σx                                 0.44      0.52   0.26      0.41      0.41    0.45
                                         (0.23)    (0.40)  (0.19)    (0.25)    (0.11)  (0.09)
        σ                                  0.28      0.53   0.55      0.60      0.05    0.05
                                         (0.20)    (0.69)  (0.35)    (0.45)    (0.04)  (0.04)
        Test statistic: λ                  0.62     0.39    0.25      0.08      0.00    0.00
                                         (0.10)    (0.15)  (0.07)    (0.07)    (0.01)  (0.01)
        Rejection rate at:
        size=0.01                         100%     99.2%   99.6%     85.2%      1.2%    1.2%
        size=0.10                         100%     99.4%   99.6%     93.2%      9.4%    9.0%
Cases [1]-[4] are with an omitted attribute (βξ = 1) and Cases [5]-[6] are with no omitted attribute
(βξ = 0). Average parameter estimate and standard deviation (in parentheses) across 500 iterations.
For the size of tests, 500 iterations are used to estimate the distribution of λ under the null hypothesis
(estimates not reported here).




                                                   23
                                                Table 3
                                         TV Reception Choice
                       Constrained Approach and the Wald-type Test Specification
     Alternatives: 1. Antenna only, 2. Expanded Basic cable, 3. Premium cable, 4. Satellite Dish
     Variables enter alternatives in parentheses and are zero in other alternatives.
     Explanatory variable                                   Constrained              Wald-type Test
                                                              Approach                 Specification
                                                              (Standard errors in parentheses)
     Control for expanded-basic cable price (2)                                        .0805 (.0416)
     Control for premium cable price (3)                                               .0873 (.0418)
     Price, in dollars per month (1-4)                    -.0202 (.0047)              -.0969 (.0400)
     Price for income group 2 (1-4)                        .0149 (.0024)               .0150 (.0025)
     Price for income group 3 (1-4)                        .0246 (.0030)               .0247 (.0031)
     Price for income group 4 (1-4)                        .0269 (.0034)               .0269 (.0035)
     Price for income group 5 (1-4)                        .0308 (.0036)               .0308 (.0038)
     Number of cable channels (2,3)                       -.0023 (.0011)               .0026 (.0029)
     Number of premium channels (3)                        .0375 (.0163)               .0448 (.0233)
     Number of over-the-air channels (1)                   .0265 (.0090)               .0222 (.0111)
     Whether pay per view is offered (2,3)                 .4315 (.0666)               .5813 (.1104)
     Education level of household (2)                     -.0644 (.0220)              -.0619 (.0221)
     Education level of household (3)                     -.1137 (.0278)              -.1123 (.0280)
     Education level of household (4)                     -.1965 (.0369)              -.1967 (.0372)
     Household size (2)                                   -.0494 (.0240)              -.0518 (.0241)
     Household size (3)                                    .0160 (.0286)               .0134 (.0287)
     Household size (4)                                    .0044 (.0357)               .0050 (.0358)
     Household rents dwelling (2-3)                       -.2471 (.0867)              -.2436 (.0886)
     Household rents dwelling (4)                         -.2129 (.1562)              -.2149 (.1569)
     Single family dwelling (4)                            .7622 (.1523)               .7649 (.1523)
     Alternative specific constant (2)                     1.119 (.2668)               2.972 (1.057)
     Alternative specific constant (3)                     .1683 (.3158)               2.903 (1.487)
     Alternative specific constant (4)                    -.2213 (.4102)               4.218 (2.386)
     Error components, standard deviation (2-4)            .5087 (.6789)               .5553 (.8567)
     Log likelihood at convergence                             -14660.84                   -14635.47
     Number of observations: 11810
For each of the seven largest multiple system operators we include separate indicators for expanded
basic and for premium.




                                                24
                                                          Appendix

A     Asymptotic Distributions of Test Statistics
A.1     Proof of Lemma 5.1
                                                                                                                b
                                                                                                 ∂ log LN (ξ̂m ,θeU )
Proof. The unconstrained ML estimator solves the first order condition                                                  = 0. Define
                                                                                                        ∂ θe
                                  e                                                     e
   e π) =
b θ,
Γ(          − ∂ log LNe(ξ̃em′ (π),θ)         e π) =
                                       , Γ0 (θ,         limM →∞ E[− ∂ log LNe(ξ̃em′ (π),θ) ],      e = Γ(
                                                                                                b θ)
                                                                                                Γ(        e π̂), and Γ0 =
                                                                                                       b θ,
                     ∂ θ∂ θ                                                ∂ θ∂ θ
                                                         √
                                                         b
Γ0 (θe0 , π0 ). The asymptotic distribution of M (θeU − θe0 ) is obtained from the asymptotic expansion
of
                              (                                                                               )
√ b                             √ ∂ log LN (ξ̃m , θe0 ) √      ∂ log L N  (ξ̂ m , e0 ) ∂ log LN (ξ̃m , θe0 )
                                                                                  θ
   M (θeU −θe0 ) = Γ  b (θe )
                       −1   ∗
                                  M                     + M(                          −                      ) +op (1),
                                            ∂ θe                       ∂ θe                   ∂ θe
                                                                                                                (13)
which is obtained from the element-by-element mean value expansions of the first order condition
               b                                             b
∂ log LN (ξ̂m ,θeU )
                     = 0 around θe0 where θe∗ lies between θeU and θe0 . Therefore the asymptotic variance
         ∂ θe
    √ b
of M (θeU − θe0 ) contains two variance terms that are from (i) the ML estimation and (ii) the
estimation of the controls.
     Note that under Assumptions 5.1, 5.2 (i)(a), (v), and (vi), by the uniform law of large numbers
and the continuity, we obtain
                                                   b θe∗ ) →p Γ0
                                                   Γ(                                                           (14)

because

                 b θe∗ ) − Γ0 ≤ Γ(
                 Γ(             b θe∗ ) − Γ0 (θe∗ , π̂) + Γ0 (θe∗ , π̂) − Γ0

                                   ≤          sup      Γ( e π) − Γ0 (θ̃, π) + Γ0 (θe∗ , π̂) − Γ0 = op (1)
                                                       b θ,                                                                    (15)
                                        e Θ
                                        θ∈ e 0 ,π∈Π0


where the first term in (15) converges to zero by the uniform LLN under Assumption 5.2 (vi) and the
second term in (15) converges to zero because of the continuity of Γ0 (which is implied by Assumption
5.2 (v) and (vi) due to the dominated convergence theorem) and because (θe∗ , π̂) →p (θe0 , π0 ).
    To derive the variance term due to the second term inside {·} bracket in (13), we approximate
the second term in (13) using a first order mean value expansion,
                                                          !
      √       ∂ log LN (ξ̂m , θe0 ) ∂ log LN (ξ̃m , θe0 )
        M                          −                                                              (16)
                     ∂ θe                  ∂ θe
         M Nm XJ          J                                        J
       1 XX              X  ∂ 2 log Pimj ′′ (v(ξ̃m (π̂ ∗ )), θe0 ) X ∂vj ′ (ξ̃m (π̂ ∗ )) ∂ ξ̃mj (π̂ ∗ ) √
  =              Yimj ′′                                                                                     πj − πj0 )
                                                                                                          M (b
       N                               e j ′ (ξ̃m )
                                     ∂ θ∂v                                 ∂ ξ̃mj            ∂πj
          m=1 i=1 j =0
              ′′         ′             j =1                                  j=1
       +op (1)

where π̂ ∗ lies between π̂ and π0 .

                                                                25
                 e ξ˜m ) =              PM     PNm PJ                         PJ                                  e ∂v ′ (ξ̃m ) ∂ ξ̃m
                                                                                         ∂ 2 log Pimj ′′ (v(ξ̃m ),θ)
    Define ΛN,M
            j   (θ,                 1
                                    N    m=1      i=1       j ′′ =0 Yimj ′′     j ′ =1            e
                                                                                                                      j
                                                                                                                     ∂ ξ̃mj      ∂πj
                                                                                                                                     j
                                                                                                                                         . Then
                                                                                                ∂ θ∂v ′ (ξ̃m )
                                                                                                     j
we can rewrite (16) as
                √        ∂ log LN (ξ̂m , θe0 ) ∂ log LN (ξ̃m , θe0 )
                    M(                        −                      )
                                ∂ θe                  ∂ θe
                J
                X                                                             X
            =          ΛN,M
                        j   (θe0 , ξ˜m (π̂ ∗ ))̟j + op (1) →d N (0,                  Λ0j Cov(̟j , ̟k )Λ′0k ) = N (0, V1 )
                 j=1                                                          j,k

where Λ0j = limM →∞ E[ΛN,M       j    (θe0 , ξ̃m )] and the asymptotic normality result holds by the continuous
mapping theorem and by the Lindeberg-Feller CLT under Assumption 5.1. In the above we can
show ΛN,M
       j  (θe0 , ξ˜m (π̂ ∗ )) →p Λ0j by following similar steps to (14) under Assumptions 5.1 and 5.2.
             √                     e
   Then by M ∂ log LNe(ξ̃m ,θ0 ) →d N (0, Γ0 · limM →∞ M           N ) (due to the Lindeberg-Feller CLT under
                             ∂θ
Assumption 5.2 (vii)), (14), the Slutsky theorem, and the continuous mapping theorem, from (13)
we obtain
                             √ b                                          M
                                M (θeU − θe0 ) →d N (0, Γ−1  0 (Γ0 · lim     + V1 )Γ−1
                                                                                    0 ).                   (17)
                                                                    M →∞ N




A.2     Asymptotic Distribution of the LM test
Proof. We show that the feasible LM test statistic has the same asymptotic distribution with the
corresponding Wald test statistic.
                                                               be
    Element-by-element mean value expansions of ∂ log LN (ξ̂m ,θR ) around θe0 yield
                                                                              ∂ θe

     √ ∂ log LN (ξ̂m , b      θeR ) √ ∂ log LN (ξ̂m , θe0 ) ∂ log LN (ξ̂m , θe∗ ) √ be
        M                          = M                      +                      M (θR − θe0 ) + op (1)     (18)
                         ∂ θe                   ∂ θe                 e θe′
                                                                   ∂ θ∂
                               b                         b
where θe∗ lies between θeR and θe0 . Note that H(θeR − θe0 ) = 0 by construction of H. Write Γ(           b θe∗ ) =
                    e∗
                                                b θe∗ )−1 to both sides of (18), it follows that
− ∂ log LNe (eξ̂′m ,θ ) . Then by multiplying H Γ(
       ∂ θ∂ θ

                                                    b
                √
                        b θe∗ )−1   ∂ log LN (ξ̂m , θeR )
                    M H Γ(
                                           ∂ θe
                √
                        b θe∗ )−1   ∂ log LN (ξ̂m , θe0 )           √            ∂ log LN (ξ̂m , θe0 )
           =        M H Γ(                                  + op (1) =M HΓ−1   0                        + op (1)
                                           ∂ θe                                         ∂ θe            !
                √                ∂ log LN (ξ̃m , θe0 )    ∂ log LN (ξ̂m , θe0 ) ∂ log LN (ξ̃m , θe0 )
           =        M HΓ0−1                            +(                      −                       ) + op (1)
                                        ∂ θe                     ∂ θe                   ∂ θe
by the similar argument with (14) and the Slutsky theorem. Therefore, under the null hypotheses
    √                               b                                                  √
(7), M H Γ(b θe∗ )−1 ∂ log LN (ξ̂m ,θeR ) follows the same asymptotic distribution with M H(b
                                                                                            θeU − θe0 ) and
                            ∂ θe
we obtain from (17)
                                               b
                √
                     bb        ∂ log LN (ξ̂m , θeR )                       M
                 M H Γ(θeR )−1                       →d N (0, HΓ−1
                                                                0  (Γ0 lim   + V1 )Γ−1 ′
                                                                                    0 H )                                                  (19)
                                      ∂ θe                            M →∞ N


                                                                 26
by the Lindeberg-Feller CLT and the continuous mapping theorem and because Γ(   bbθeR ) →p Γ0 , Γ(
                                                                                                b θe∗ ) →p
                   bb
Γ0 . Then by (19), Γ(
                                         b
                      θeR ) →p Γ0 , Vb1 (θeR ) →p V1 , and the continuous mapping theorem it follows
that
                            b                                                         b
 g          ∂ log LN (ξ̂m , θeR ) b be −1 ′ e −1 be        b be −1 ∂ log LN (ξ̂m , θeR )
 LM M,N = N                       Γ(θR ) H VM,N (θ R )H Γ(θR )
                   ∂ e′
                     θ                                                         ∂ θe
                                                   ′
          √                                   b                                                        −1
                   b  be −1 ∂ log LN (ξ̂m , θeR )          b be −1 b be M             b   be b be −1 ′
        =     M H Γ(θR )                               · H Γ(θR ) (Γ(θ R )          + V1 (θ R ))Γ(θ R ) H
                                      ∂ θe                                   N
                                                   
          √                                  be 
                   bb         ∂ log LN (ξ̂m , θ R )
        ×    M H Γ(  θeR )−1                          → χ2 (dim((λ′ , γ
                                                                      e′ , γ
                                                                           ep′ )′ )).
                                     ∂ θe           d

               g M,N follows the same asymptotic distribution of the Wald test statistic TeM,N
   Therefore, LM
under the null hypothesis of the price exogeneity.

A.3     Consistency of the LM test

                      e =   1   PM     PNm                                         e           1   P P
                                                                                                   M N m
                                                                                                                             e
Define hM,N (v(ξ̃m ), θ)    N    m=1     i=1 him (v(ξ̃m ), θ̃) and E[him (v(ξ̃m ), θ)] =       N             E[him (v(ξ̃m ), θ)].
                                                                                                   m=1 i=1
Assume the following to show the consistency of the LM test.

                       b
Assumption A.1 (i) θeR →p θeR  A under the alternative hypothesis against (7); (ii)-(viii) each corre-

sponding Assumption 5.2 (ii) to (viii) holds replacing θe0 with θeR     e 0 with Θ
                                                                  A and Θ        e A where Θ
                                                                                           e A denotes
a neighborhood of θeR
                    A.


                                                                   g M,N is consistent
Theorem A.1 Suppose Assumptions 5.1 and A.1 hold. Then the LM test LM
                                eA      6 0.
under limM →∞ ||E[him (v(ξ̃m ), θR )]|| =

   Proof. Under the alternative hypothesis against (7), using a mean value expansion, we obtain
                                          M Nm                                                   √
       √                 b            1 XX                                                        M
        M hM,N (v(ξ̂m ), θeR ) =     √                           eA                     eA
                                                  (him (v(ξ̃m ), θR ) − E[him (v(ξ̃m ), θR )]) × √         (20)
                                       N m=1 i=1                                                   N
                                       √
                                     + M (hM,N (v(ξ̂m ), θeRA
                                                              ) − hM,N (v(ξ̃m ), θeR
                                                                                   A
                                                                                     ))                    (21)
                                       ∂hM,N (v(ξ̂m ), θe ) √ be
                                                         A∗                    √
                                     +           ′
                                                              M (θR − θeRA
                                                                           ) + M E[him (v(ξ̃m ), θeR A
                                                                                                       )], (22)
                                              ∂θ
                        b
where θeA∗ lies between θeR and θeR
                                  A . Now we analyze each term one by one below.

   For (21) applying the mean value expansion around π0 , we obtain

          √                                                  ∂hM,N (v(ξ̃m (π ∗ )), θeR
                                                                                     A) √
           M (hM,N (v(ξ̂m ), θeR
                               A
                                 ) − hM,N (v(ξ̃m ), θeR
                                                      A
                                                        )) =                                 π − π0 )
                                                                                          M (b                       (23)
                                                                      ∂π ′
                                                               ∂hM,N (v(ξ̃m (π ∗ )),θeR
                                                                                      A)
where π ∗ lies between π
                       b and π0 . Let ΓπA = limM →∞ E[                  ∂π               ].   We then have

                                                      27
                             √
                                 M (hM,N (v(ξ̂m ), θeR
                                                     A
                                                       ) − hM,N (v(ξ̃m ), θeR
                                                                            A
                                                                              )) = Γ′πA ̟ + op (1)
                                                            ∂him (v(ξ̃m (π)),θeR
                                                                               A)
by Assumption 5.1 and because under E[supπ∈Π0 ||                    ∂π            ||2 ] < ∞ for m (which holds
                                           ∂h              ∗   eA
                                                  (v(ξ̃m (π )),θR )
under Assumption A.1 (viii)), we have M,N ∂π                        →p ΓπA by the uniform Law of Large
                      ∂h               eA
                            (v(ξ̃ (π)),θR )
numbers and because E[ M,N ∂πm              ] is continuous at π = π0 (which is implied by Assumption
A.1 (viii) due to the dominated convergence theorem).
   Next to analyze the first term in (22) let the inverse of the asymptotic variance matrix of
                                b
the unconstrained estimator θeU be B = Γ0 (Γ0 · limM →∞ M            −1
                                                             N + V1 ) Γ0 and define a matrix M =
I − B −1/2 H ′ (HB −1 H ′ )−1 HB −1/2 . Then the asymptotic distribution of the constrained estimator
be               √ b
θR is given by M (θeR − θeA ) →d N (0, B −1/2 MB −1/2 ) ≡ Z2A (see p. 2217-2220 of Newey and
                                          R
McFadden (1994)). Then we obtain

                                   ∂hM,N (v(ξ̂m ), θeA∗ ) √ be
                                                           M (θ R − θeR
                                                                      A
                                                                        ) = Γ′θA Z2A + op (1)
                                          ∂θe′

          √ b                                        ∂hM,N (v(ξ̂m ),θeA∗ )
where      M (θeR − θeR
                      A) → Z
                          d  2A and ΓθA = limM →∞ E[          e            ] because under Assumption
                                                                               ∂θ
                                   ∂hM,N (v(ξ̂m ),θeA∗ )
A.1 (vi)-(v), we have                                      →p ΓθA by the uniform Law of Large numbers, because
                                          ∂ θe
     ∂hM,N (v(ξ̃m (π)),θeR )
E[                    is continuous at θeR = θeR
                             ]                 A and π = π (which is implied by Assumption A.1
                                                          0
             ∂ θe
(vi)-(v) due to the dominated convergence theorem), and because θeA∗ →p θeR     A and π̂ → π .
                                                                                          p 0
                                                                         eA    4
    Next we consider the term in (20). Note that under E[||him (v(ξ̃m ), θR )|| ] < ∞ for all m (which
holds under Assumption A.1 (vii)), by the Lindeberg-Feller CLT, we have

               XM         X Nm                                                        √
                                       (him (v(ξ̃m ), θeR
                                                        A
                                                          ) − E[him (v(ξ̃m ), θeR
                                                                                A
                                                                                  )])/ N →d Z1A ≡ N (0, VhA )
                    m=1          i=1
                               P     PNm                    eA                     eA                      eA
where VhA = limM →∞ N1 M         m=1   i=1 E[{him (v(ξ̃m ), θR ) − E[him (v(ξ̃m ), θR )]} · {him (v(ξ̃m ), θR ) −
E[him (v(ξ̃m ), θeR
                  A )]}′ ]. Combining these results, we obtain

                                         √
     √                      be             M                            √
       M hM,N (v(ξ̂m ), θ R ) = Z1A √ + Γ′πA ̟ + Γ′θA Z2A + M E[him (v(ξ̃m ), θeR             A
                                                                                                )] + op (1)
                                           N
                                             √
                                 = Op (1) + M E[him (v(ξ̃m ), θeR  A
                                                                     )].
                         √               b
Therefore, we obtain || M hM,N (v(ξ̂m ), θeR )|| → ∞ if limM →∞ ||E[him (v(ξ̃m ), θeR
                                                                                    A )]|| =
                                                                                           6 0 under the
alternative against (7). This implies LM M,N → ∞ under the alternative if limM →∞ ||E[him (v(ξ̃m ), θeR
                                      g                                                                 A )]|| =
                                                                                                               6
0. Therefore the LM test for price endogeneity is consistent.




                                                                  28
References
Altonji, J., and R. Matzkin (2005), “Cross Section and Panel Data Estimators for Nonseparable
Models with Endogenous Regressors,” Econometrica, 73, 1053-1102.

Andrews, D. (1997), “A Conditional Kolmogorov Test,” Econometrica, 65, 1097-1128.

Berry, S. (1994), “Estimating Discrete Choice Models of Product Differentiation,” RAND Journal
of Economics, 25, 242-262.

Berry, S., A. Gandhi, and P. Haile (2011), “Connected Substitutes and Invertibility of Demand,”
Working Paper.

Berry, S., and P. Haile (2010), “Identification in Differentiated Products Markets Using Market
Level Data,” Working Paper.

Berry, S., J. Levinsohn, and A. Pakes (1995), “Automobile Prices in Market Equilibrium,” Econo-
metrica, 63, 841-889.

Bierens, H. (1990), “A Consistent Conditional Moment Test of Functional Form,” Econometrica, 58,
1443-1458.

Chen, X., and Y. Fan (1999), “Consistent Hypothesis Testing in Semiparametric and Nonparametric
Models for Econometric Time Series,” Journal of Econometrics, 91, 373-401.

Chintagunta, P., J. Dube, and K. Goh (2005), “Beyond the endogeneity bias: The effect of unmea-
sured brand characteristics on household-level brand choice models,” Management Science, 51(5),
832-849.

Crawford, G. (2000), “The Impact of the 1992 Cable Act on Household Demand and Welfare,”
RAND Journal of Economics, 31, 422-449.

Dubé, J.P., J. Fox, and C.L. Su (2012), “Improving the Numerical Performance of Static and
Dynamic Aggregate Discrete Choice Random Coefficients Demand Estimation,” Econometrica,
80(5), 2231-2267.

Fan, Y., and Q. Li (1996), “Consistent Model Specification Tests: Omitted Variables, Parametric
and Semiparametric Functional Forms,” Econometrica, 64, 865-890.

Gandhi, A., K. Kim, and A. Petrin (2011), “Identification and Estimation in Discrete Choice Demand
Models when Endogenous Variables Interact with the Error,” Working Paper.

Goolsbee, A., and A. Petrin (2004), “The Consumer Gains from Direct Broadcast Satellites and the
Competition with Cable TV,” Econometrica, 72(2), 351-382.



                                               29
Hardle, W., and E. Mammen (1993), “Comparing Nonparametric versus Parametric Regression
Fits,” Annals of Statistics, 21, 1926-1947.

Hausman, J. (1978), “Specification Tests in Econometrics,” Econometrica, 46, 1251-1272.

Hausman, J. (1997), “Valuation of New Goods under Perfect and Imperfect Competition,” in The
Economics of New Goods, ed. by R. Gordon, and T. Bresnahan. University of Chicago Press,
Chicago.

Heckman, J. (1978), “Dummy Endogenous Variables in a Simultaneous Equation System,” Econo-
metrica, 46, 931-959.

Heckman, J., and R. Robb (1985), “Alternative Methods for Evaluating the Impacts of Interventions:
An Overview,” Journal of Econometrics, 30, 239-267.

Horowitz, J., and V. Spokoiny (2001), “An Adaptive, Rate Optimal Test of a Parametric Mean
Regression Model against a Nonparametric Alternative,” Econometrica, 69, 599-631.

Imbens, G., and W. Newey (2003), “Identification and Estimation of Triangular Simultaneous Equa-
tions Models Without Additivity,” Working Paper.

Karaca-Mandic, P., and K. Train (2002), “Standard Error Correction in Two-Step Estimation with
Nested Samples,” Working Paper, Department of Economics, University of California, Berkeley.

Kim, K., and A. Petrin (2010), “Control Function Corrections for Unobserved Factors in Differen-
tiated Product Models,” Working Paper.

Kitamura, Y., G. Tripathi, and H. Ahn (2004), “Empirical Likelihood-based Inference in Conditional
Moment Restriction Models,” Econometrica, 72, 1667-1714.

Knittel, C. R. and K. Metaxoglou (2008), “Estimation of Random Coefficient Demand Models:
Challenges, Difficulties and Warnings,” Working Paper, MIT.

Li, Q., C. Hsiao, and J. Zinn (2003), “Consistent Specification Tests for Semiparametric/ Nonpara-
metric Models Based on Series Estimation Methods,” Journal of Econometrics, 112, 295-325.

Matzkin, R. (2003), “Nonparametric Estimation of Nonadditive Random Functions,” Econometrica,
71.

Nevo, A. (2001), “Measuring Market Power in the Ready-to-Eat Cereal Industry,” Econometrica,
69, 307-342.

Newey, W. (1997), “Convergence Rates and Asymptotic Normality of Series Estimators,” Journal
of Econometrics, 79, 147-168.



                                               30
Newey, W., and D. McFadden (1994), “Large Sample Estimation and Hypothesis Testing,” The
Handbook of Econometrics, Volume 4, Elsevier.

Newey, W. K. (1985), “Maximum Likelihood Specification Testing and Conditional Moment Tests,”
Econometrica, 53(5), 1047-1070.

Pakes, A. (1994), “Dynamic structural models, problems and prospects: mixed continuous discrete
controls and market interaction,” in Advances in Econometrics, Sixth World Congress, Volume II,
ed. by C. Sims, pp. 171-259, New York. Cambridge.

Petrin, A. (2002), “Quantifying the Benefits of New Products: The Case of the Minivan,” Journal
of Political Economy, 110, 705-729.

Petrin, A., and K. Train (2010), “A Control Function Approach to Endogeneity in Consumer Choice
Models,” Journal of Marketing Research, 47, 370-379.

Rivers, D., and Q. Vuong (1988), “Limited Information Estimators and Exogeneity Tests for Simul-
taneous Probit Models,” Journal of Econometrics, 39, 347-366.

Smith, R., and R. Blundell (1986), “An Exogeneity Test for a Simultaneous Equation Tobit Model
with an Application to Labor Supply,” Econometrica, 54, 679-686.

Song, K. (2010), “Testing Semiparametric Conditional Moment Restrictions Using Conditional Mar-
tingale Transforms,” Journal of Econometrics, 154, 74-84.

Stinchcombe, M., and H. White (1998), “Consistent Specification Testing When the Nuisance Pa-
rameters Present Only Under the Alternative,” Econometric Theory, 14, 295-325.

Trajtenberg, M. (1989), “The Welfare Analysis of Product Innovations, with an Application to
Computed Tomography Scanners,” Journal of Political Economy, 97, 444-479.

Villas-Boas, J., and R. Winer (1999), “Endogeneity in Brand Choice Models,” Management Science,
45, 1324-1338.




                                              31
