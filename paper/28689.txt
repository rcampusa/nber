                             NBER WORKING PAPER SERIES




           PRIORITY-BASED ASSIGNMENT WITH RESERVES AND QUOTAS

                                    Atila Abdulkadirolu
                                      Aram Grigoryan

                                     Working Paper 28689
                             http://www.nber.org/papers/w28689


                    NATIONAL BUREAU OF ECONOMIC RESEARCH
                             1050 Massachusetts Avenue
                               Cambridge, MA 02138
                                    April 2021




We thank Jay Sethuraman, Tayfun Sonmez and Microeconomic Theory Seminar participants at
Duke for helpful comments and discussions. We gratefully acknowledge funding from the Laura
and John Arnold Foundation. The views expressed herein are those of the authors and do not
necessarily reflect the views of the National Bureau of Economic Research.

NBER working papers are circulated for discussion and comment purposes. They have not been
peer-reviewed or been subject to the review by the NBER Board of Directors that accompanies
official NBER publications.

© 2021 by Atila Abdulkadirolu and Aram Grigoryan. All rights reserved. Short sections of text,
not to exceed two paragraphs, may be quoted without explicit permission provided that full
credit, including © notice, is given to the source.
Priority-based Assignment with Reserves and Quotas
Atila Abdulkadirolu and Aram Grigoryan
NBER Working Paper No. 28689
April 2021
JEL No. D47,I39

                                          ABSTRACT

We study priority-based assignment problems with distributional and diversity objectives. Our
work provides an axiomatic characterization of a general class of choice rules which are based on
type-specific reserves and quotas. The choice rules in the class differ by the order in which
applicants are considered for units reserved for different types. We show that a particular
reserves- and quotas-based choice rule, where all applicants are first considered for units reserved
for their own types, uniquely minimizes priority violations in this class.


Atila Abdulkadirolu
Department of Economics
Duke University
213 Social Sciences Building
Durham, NC 27708
and NBER
atila.abdulkadiroglu@duke.edu

Aram Grigoryan
Duke University
1607 Jackson Street
Durham, NC 27701
aram.grigoryan@duke.edu
    Priority-based Assignment with Reserves and Quotas

                       Atila Abdulkadiroglu and Aram Grigoryan

                                            April 2021



                                              Abstract

          We study priority-based assignment problems with distributional and diversity ob-
       jectives. Our work provides an axiomatic characterization of a general class of choice
       rules which are based on type-specific reserves and quotas. The choice rules in the class
       differ by the order in which applicants are considered for units reserved for different
       types. We show that a particular reserves- and quotas-based choice rule, where all ap-
       plicants are first considered for units reserved for their own types, uniquely minimizes
       priority violations in this class.




1      Introduction

Allocation of scarce resources commonly involves priority-based rationing. Priorities are
decided on the basis of merit, needs, property rights or some other legal or ethical consid-
eration. For example, schools prioritize pupils based on neighborhood or sibling enrollment
status, colleges prioritize students based on academic performance and health official priori-
tize patients based on urgency or medical condition. An assignment violates an individual's
priority, if she prefers another object to her assignment and the object is assigned to a lower
priority individual. Avoiding priority violations is a major policy goal in all applications
above as such violations are perceived unfair, illegal or unethical.
    
    Abdulkadiroglu: Department of Economics, Duke University and National Bureau of Economic Research
(NBER), aa88@duke.edu; Grigoryan: Department of Economics, Duke University, ag404@duke.edu. We
thank Jay Sethuraman, Tayfun S¨
                              onmez and Microeconomic Theory Seminar participants at Duke for helpful
comments and discussions. We gratefully acknowledge funding from the Laura and John Arnold Foundation.

                                                  1
A purely priority-based assignment completely eliminates priority violations. However, such
a solution may result in undesirable distributional outcomes. For example, when a school
district grants a high priority to neighborhood children, priority-based assignment may re-
sult in high-income families attending best-performing schools, which are potentially located
in affluent neighborhoods, while low-income families may end up in worst-performing ones
(Ryan and Heise, 2002). Additionally, school districts are typically restricted by court-
ordered desegregation guidelines and seek to achieve a diverse student body (Armor and
Rossell, 2002). Therefore, in a school district with racially segregated neighborhoods, a
neighborhood priority-based rationing would produce racially segregated schools, violating
districts' policies and court orders. Likewise, schools may require to maintain student bal-
ance across ability range, with sufficient representation of students with low, middle or high
reading scores (Abdulkadiroglu et al., 2005). Diversity is also a major consideration for
college admissions. A purely merit-based admission is opposed by advocates of affirmative
action policies, who argue that racial minorities and other marginalized groups face dis-
crimination and are historically shut out of education opportunities (Maxwell and Garcia,
2019). Finally, in pandemic rationing a priority-based assignment may fail to guarantee
vaccines to individuals representing multiple and conflicting ethical considerations, such in-
dividuals with disabilities, highest survival probabilities, health workers or representatives
of disproportionately affected groups (Pathak et al., 2020a; Persad et al., 2020).

To address distributional concerns, priority-based assignment problems are commonly con-
trolled by reserves and quotas for different groups. Reserves guarantee a certain number
of objects for the members of a group. Quotas bound the number of objects allocated to
the members of a group by a certain number. Reserves and quotas are commonly applied
for race-neutral or race-based affirmative action policies in public school assignment (Ab-
dulkadiroglu and S¨
                  onmez, 2003; Hafalir et al., 2013; Dur et al., 2018) or college admissions
(Abdulkadiroglu, 2005; Aygun and B´
                                  o, 2020). For example, exam schools in Chicago reserve
a certain proportion of seats for representatives of different income groups (Dur et al., 2020;
Ellison and Pathak, 2021). COVID-19 vaccine allocation is another application of a reserves
system. Vaccine allocation guideline of the National Academy of Sciences, Engineering and
Medicine (NASEM, 2020) recommends reserving 10 percent of vaccines for people from hard-
hit areas, defined by a socioeconomic vulnerability index. Many US states that have adopted
reserves for vaccine allocation.1

Reserves and quotas do not uniquely pin down the assignment: there are many assignments
  1
    Details on reserves systems for COVID-19          vaccine   allocation   can   be   found   here:
https://www.covid19reservesystem.org/policy-impact.


                                               2
that respect given reserves and quotas. Consider the following example. There is a single
school with two seats and three applicants. The school's objective is to guarantee at least
one seat for an applicant from a low-income group. To achieve this goal, the school reserves a
seat for low-income applicants and the remaining seat goes to the general pool. We will refer
to them as reserved seat and open seat, respectively. Otherwise, the school assigns seats in a
priority order which may reflect the applicants' exam scores or neighborhood/sibling status.
Suppose that the first and third highest priority applicants are from a low-income group,
whereas the second highest priority applicant is not. If applicants are considered for the
open seat first, then the open seat goes to the highest priority applicant, who is a low-income
applicant. The remaining seat is reserved, so it goes to the remaining low-income applicant.
The resulting assignment violates the priority of the second highest priority applicant. Now
suppose that applicants are first considered for the reserved seat. In that case the highest
priority applicant will be assigned to the reserved seat, and the second highest priority
applicant will be assigned to the open seat. No applicant's priority is violated in that case.

As the example demonstrates the amount of priority violations depends on the order in
which the applicants are considered for different seats. Our work aims at providing axiomatic
foundation for pinning down the `right' order and the corresponding reserves- and quotas-
based rule. We first study a single school's decision of choosing the set of applicants to be
admitted to the school. This problem is particularly relevant when allocation of different
units are administered in a decentralized manner. Examples include public school admissions
systems where each school admits from its applicant independently of other schools (e.g. New
York City High School Admissions prior to 2003, Abdulkadiroglu et al. (2009)), decentralized
college admissions (Che and Koh, 2016) and administration of COVID-19 vaccine during
the pandemic where US jurisdictions/states receive there vaccines in proportion to their
populations and allocate vaccines based on their own guidelines (Galston and Kamarck,
2021).

Formally, a choice rule of a school selects a subset of from each set of applicants. We char-
acterize a class of choice rules which we call generalized reserves-and-quotas rules. These
rules differ by the order in which applicants are considered for seats reserved for different
types. Most of the rules that have been studied in the literature (e.g., Abdulkadiroglu (2005),
Hafalir et al. (2013), S¨
                        onmez and Switzer (2013), Echenique and Yenmez (2015), Dur et al.
(2018), Kominers and S¨
                      onmez (2016) and Pathak et al. (2020a)) are in this class. As the class
is large, many of the generalized reserves-and-quotas rules potentially result in unnecessary
priority violations. As a solution, we show that the choice rule where applicants are first
considered for seats reserved for their types, which we call regular reserves-and-quotas rule,

                                              3
uniquely minimizes priority violations among all generalized reserves-and-quotas rules. Our
characterization result counterpoints the advocacy for implementing alternative rules which
may result in distributional outcomes that favor certain types, such as benefiting low-income
public school applicants (Dur et al., 2020), assigning more students to neighborhood schools
(Dur et al., 2018) or allocating more vaccines or scarce medical supplies to reserves bene-
ficiaries (Pathak et al., 2020a). We show that the improved distributional outcomes only
happen at the expense of creating more priority violations. Such violations are not justified
or explained in any sense. Our result potentially suggests that improved distributional out-
comes should be achieved not through alternative implementations, but through the regular
reserves-and-quotas rule with potentially larger reserves or smaller quotas. In addition to its
axiomatic foundation, the benefit of the latter approach is transparency in meeting policy
goals. The regular reserves-and-quotas rule directly addresses the policy maker's fairness
and distributional objectives: namely, it minimizes priority violations among non-wasteful
assignments that respect the reserves and quotas. Therefore, unlike the alternatives, any
remaining priority violation is fully explained by reserves and quotas policy.

Many priority-based assignment problems such as public school assignment or college ad-
missions feature multiple alternatives and the final assignment is determined in centralized
clearinghouses. In the second part of our paper we analyze assignment problems in this cen-
tralized environment. Assignments are a commonly achieved through a sequential algorithm,
such as Deferred Acceptance (DA) (Gale and Shapley, 1962), where at each step applicants
apply to their most preferred schools among those that have not rejected them, each school
accepts a subset of applicants using some choice rule and rejects the rest. Our characteri-
zation results for the decentralized setting do not necessarily extend to the centralized one.
Due to the dynamic nature of the application process, creating more priority violations in
some earlier step may prevent creating more priority violations in later steps. Thus, the
final assignment may not necessarily minimize priority violations when all schools apply the
regular reserves-and-quotas rule at each step. We extend our axiomatic framework to the
setting with multiple alternatives and study the possibility of minimizing priority violations
in certain classes of assignments. We show that these problems are NP-hard, and therefore
computationally intractable.

We supplement our theoretical results with simulations analysis to quantify the amount of
priority violations under different choice rules. We consider a school choice setup with an
affirmative action policy where each school reserves a proportion of its seats for applicants
from low- and high-income groups. We obtain considerably less priority violations under the
regular reserves-and-quotas rule compared to the alternative choice rule studied in the liter-

                                              4
ature (Dur et al., 2018, 2020). The results therefore suggest that the theoretical predictions
for the single school problem are robust to the environment with multiple schools.

The remainder of this work is organized as follows. Section 2 reviews the related literature.
Section 3 introduces the model. Section 4 provides an axiomatic characterization of general-
ized reserves-and-quotas rules. Section 5 characterizes the regular reserves-and-quotas rule
as priority violations minimizer and priority rank maximizer. Section 6 discusses the impli-
cations for centralized assignment with multiple alternatives. Section 7 reports simulation
results. Proofs are in Appendix A.



2    Related Literature

Affirmative action in school choice has been studied by Abdulkadiroglu and S¨
                                                                            onmez (2003).
Their model uses type-specific quotas for promoting diversity. Kojima (2012) gives an ex-
ample where imposing quotas on majority students may have a perverse effect of hurting
minority students. This happens when a rejected majority student at one school applies
and displaces a minority student at another school. Hafalir et al. (2013) show by computer
simulations that the adverse effects of the quotas rule is a likely phenomenon, rather than an
exception. As an alternative solution, the authors propose a reserves-based rule. Kominers
and S¨
     onmez (2016) study a class of reserves-based rules that generalize the one in Hafalir
et al. (2013). Under those rules, certain number of units are reserved for each type and
applicants receive higher priority at their corresponding units. Applicants are considered
for different units and are accepted based on unit-specific priority order. Axiomatic char-
acterizations of these generalized reserves rules have been given by Pathak et al. (2020a)
and Delacr´
          etaz (2020). The authors use an axiom which requires the assignment to respect
unit-specific priorities. However, in many priority-based assignment problems respecting
unit-specific priority rankings is not a direct policy objective but a means to achieve desir-
able distributional outcomes. Instead, these problems typically feature a baseline priority
ranking which is common across all units (Abdulkadiroglu, 2005; Hafalir et al., 2013; Ehlers
et al., 2014; Echenique and Yenmez, 2015). Our characterization result uses axioms which
directly incorporate policy objectives such as bounding the number of baseline priority vio-
lations and meeting the distributional constraints.

The question of which generalized reserves-and-quotas rule should be used has received
wide attention in academia and practice (Dur et al., 2018; Pathak et al., 2020b,a). The


                                              5
regular reserves-and-quotas corresponds to the generalized reserves-and-quotas rule where
applicants are first considered for units reserved for their types. Papers like Dur et al.
(2018) and Pathak et al. (2020b) argue that the beneficiaries may be better-off under an
alternative implementation where reserves beneficiaries are first considered for non-reserved
units instead. Our characterization result counterpoint the objections for the regular reserves
rule and the advocacy for other rules in the literature. In particular, it implies that the
improved distributional outcomes of the alternative rules in papers like Dur et al. (2018) and
Pathak et al. (2020b) can only happen at the expense of creating more priority violations.

Our work is related papers that provide axiomatic foundation for the regular reserves-and-
quotas rule. In a setting without quotas, such results have been provided by Echenique and
Yenmez (2015), S¨
                onmez and Yenmez (2019a), S¨
                                           onmez and Yenmez (2019b) and Grigoryan
(2020). The first paper uses an axiom called saturated priority compatibility, which says that
an individual can cause a priority violation only if the number of individuals of her type who
receive a unit is weakly smaller than the reserves.2 Imamura (2020) generalizes the charac-
terization by Echenique and Yenmez (2015) to an environment with quotas. S¨
                                                                          onmez and
Yenmez (2019a) and S¨
                    onmez and Yenmez (2019b) study a setting with complex types and
without quotas, and characterize a version of the regular reserves-and-quotas rule with an
axiom of priority rank maximality, i.e., choosing the set of individuals with highest priorities.
In a setting with quotas, we give two characterizations of the regular reserves-and-quotas
rule with axioms of priority violations minimality and a stronger version of priority rank
maximality than the ones in S¨
                             onmez and Yenmez (2019a) and S¨
                                                           onmez and Yenmez (2019b).
Our axioms directly incorporate the policy objectives of reducing priority violations and
choosing highest priority individual whenever possible. Like our paper, Grigoryan (2020)
characterizes the regular reserves-and-quotas rule with an axiom of priority violations mini-
mality. However, the author studies a setting with weak priorities and without quotas. None
of the papers above discusses the implication of their characterization results for centralized
assignment problems with multiple schools.

Finally, our work is related to papers that study computational complexity of assignment
problems with distributional constraints, such as Bir´
                                                     o et al. (2010) and Hamada et al. (2016).
Both papers show that minimizing priority violations in the class of reserves-respecting
assignments is NP-hard. However, their models and NP-hardness results differ from ours.
First and most importantly, we model reserves as soft lower bounds, i.e., we allow that
the number of applicants of a certain types is smaller than the corresponding type-specific
  2
      Dogan (2017) corrects the characterization result of Echenique and Yenmez (2015).



                                                     6
reserves, as long as no applicant of that type prefers that school to her assignment. In
             o et al. (2010) and Hamada et al. (2016) model reserves as hard lower bounds.3
contrast, Bir´
Second, we also prove NP-hardness of minimizing priority violations for a proper subclass
of reserves-respecting assignments, namely, those eliminate priority violations among same
type applicants.



3       The Model

There is a finite set of applicants A and a single school S with capacity q . For a given
subset of applicants A  A, the school is facing a decision of choosing some of the applicants
in A, without exceeding its capacity. Formally, a choice rule of the school is a mapping
C : 2A  2A such that for any A  A, C (A)  A and |C (A)|  q .

The school orders applicants according to a priority ranking              which is a complete, transitive
and anti-symmetric binary relation on A. Applicants are categorized into different types
according to mapping  : A  T , where T is a finite set. For a subset A  A, let

                                        At = a  A :  (a) = t

be the set of type-t applicants in A.

For a subset A  A, we say that a's priority is violated at C (A), if a  A \ C (A) and there
is a  C (A) with a        a . In that case, we say that a causes a priority violation for a.



4       Generalized Reserves-and-Quotas Rules

In this section, we provide an axiomatic foundation for a general class of reserves- and
quotas-based choice rules. The axioms reflect the policy objectives of promoting diversity
and restricting priority violations.

Let vectors (rt )tT and (qt )tT denote the reserves and quotas, respectively. Assume                 tT   rt 
q       tT   qt .

To define the class of generalized reserves-and-quotas rules, we first divide school S into T +1
    3
    Bir´
       o et al. (2010) allow some schools not to meet the lower bounds if and only if the school is closed and
accepts no applicant.

                                                      7
different slots {st }tT {0} , where each st has a capacity rt and s0 has a capacity q -                 tT   rt .
We abuse notation to define S = {st }tT {0} . Priority ranking                t   of slot st is such that all
type-t applicants have higher priorities than non-type-t applicants, and otherwise it agrees
with    .

For each A  A, an application order               a,A   of a  A is a complete, transitive and anti-
symmetric binary relation on S . For any s, s  S , s                a,A   s denotes that s has a higher
                                                 4
position in application order of a than s .

For given applicant orders (      a,A )aA,AA ,   we describe the corresponding generalized reserves-
and-quotas rule C g . For any A  A, C g (A) is determined as follows.

Step k = 0. Meeting Quotas.
For each t  T , all slots reject any type-t applicant that does not have one of the qt highest
priorities among type-t applicants.

Step k  1. Application Steps.
Each applicant a  A applies to the highest rank slot according to                    a,A   among those that
have not rejected her yet. For each t  T , slot st considers all its applicants, tentatively
accepts the highest       t   priority ones up to its capacity rt and rejects the rest. If there is a
rejection, proceed to Step k + 1. Otherwise, the procedure terminates and its output C g (A)
equals to the union over t  T of applicants tentatively assigned to st at the end of Step k .

Before providing axiomatic foundation for the generalized reserves-and-quotas rules, we pro-
vide an example demonstrating that different application orders may result in different sets
of chosen applicants with different degrees of priority violations.

Example 1. Suppose A = {a1 , a2 , a3 },  (a1 ) =  (a3 ) = t = t =  (a2 ), a1                       a2        a3 ,
q = qt = qt = 2, rt = 1 and rt = 0.

In other words, there are three applicants considered for admission at a school with two seats.
Applicants a1 and a3 are of the same type t, which may be thought of as the low-income status.
Applicants a2 is of high-income type t . Lower indexed applicants have higher priorities. The
school has an affirmative action policy in the form a unit reserves for low-income type t.

By the description of generalized reserves-and-quotas rules, the school is divided into three
slots st , st and s0 . Since st has a capacity of rt = 0, we may ignore that slot. Let us call st
   4
    Kominers and S¨  onmez (2016) only consider cases when a,A is constant for all a  A. This restriction
eliminates certain desirable reserves-and-quotas rules, such as the regular one which we introduce in the next
section.

                                                        8
and s0 the reserved slot and the open slot, respectively.

Consider two application orders:


  1. applicants first apply to the open seat, then to the reserved seat,

  2. applicants first apply to the reserved seat, then to the open seat.


Under the first application orders, all applicants are first considered for the open slot. The
open accepts a1 and rejects the remaining two applicants. The rejected applicants apply to
the reserved slot and a3 is accepted since she is the only remaining low-income applicant.
Thus, the chosen applicants under the first application orders are a1 and a3 .

Now consider the second application orders. All applicants are first considered for the reserved
slot, who accepts a1 and rejected the remaining applicants. The rejected applicants apply to
the open slot and a2 is accepted as the highest priority remaining applicant. The chosen
applicants under the second application orders are a1 and a2 .


We now characterize the class of generalized reserves-and-quotas rule with four axioms. The
first axiom guarantees that at least rt and no more than qt seats for representatives of each
type t  T .

Axiom 1 (Reserves- and quotas-respecting). A choice rule is reserves- and quotas-
respecting if for any A  A and t  T ,

                              min{|At |, rt }  C (A)  At  qt .


The second axiom says that the school accepts applicants unless there are no empty seats
or type-specific quotas are binding. In the literature, this property is also called acceptant
(Echenique and Yenmez, 2015) or capacity-filling (Dogan et al., 2020).

Axiom 2 (Non-wasteful). A choice rule C is non-wasteful if for any A  A,

                    a  A \ C (A) and |C (A)| < q imply C (A) (a) = q (a) .


The third axiom says that priority violations occur only between students of different types.

Axiom 3 (Within-type priority compatibility). A choice rule C is within-type priority
compatible if for any A  A, whenever a causes priority violation for a at C (A), then
 (a) =  (a ).

                                               9
Our next axiom limits the number of priority violations that each type can cause.

Axiom 4 (Beyond-reserves priority compatibility). A choice rule C is beyond-reserves
priority compatible if for any A  A and t  T ,

                      a  At : a causes priority violation at C (A)        rt .


In other words, Axiom 4 guarantees that the number of type-t applicants that cause priority
violations is bounded by the corresponding reserves rt for type-t. Our first result characterizes
the entire class of generalized reserves-and-quotas rules with Axioms 1-4.

Theorem 1. A choice rule satisfies Axioms 1-4 if and only if it is a generalized reserves-
and-quotas rule.

Axioms 1-4 may not be strong enough to preclude some potentially undesirable choice rules.
For example, the generalized reserves-and-quotas rule corresponding to the first applica-
tion orders in Example 1 chooses a1 and a3 , violating the priority of a2 . In contrast, the
generalized reserves-and-quotas rule corresponding to the second application orders chooses
applicants a1 and a2 and no applicant's priority is violated. This motivates our next sec-
tion's analysis of choosing the `right' application orders and the corresponding generalized
reserves-and-quotas rule. We show that particular application orders induce a choice rule
that minimizes priority violations among all reserves- and quotas-respecting and non-wasteful
choice rules.



5     Regular Reserves-and-Quotas Rules

A choice rule C is the regular reserves-and-quotas rule for reserves and quotas vectors
r and q , if for any A  A, C (A) is determined as follows:

    1. Select up to rt of highest priority applicants of each type t. Let A  A denote the set
      of all selected applicants.

    2. From the remaining applicants A \ A , accept highest priority applicants up to the
      capacity without violating type-specific quotas.

We say an application order        a,A   is regular if

                           s (a)    a,A   s, s  S \ {s (a) }, a  A  A.

                                                    10
Proposition 1. A choice rules is the regular reserves-and-quotas rule if and only if it is a
generalized reserves-and-quotas rule for some regular application orders.


The only restriction regularity puts on application orders is that each type-t applicant first
applies to the slot reserved for her type. The order in which applicants apply to the open slot
and the slots reserved for other types does not affect the outcome. As a corollary of Theorem
1 and Proposition 1, we conclude that regular reserves-and-quotas rule satisfies Axioms 1-4.
We provide two characterizations of regular reserves-and-quotas rules that single them out
among all choice rules satisfying the axioms above.

A choice rule C creates less priority violations than choice rule C if at any A  A, the
number of applicants whose priority is violated at C (A) is weakly smaller than the number
of applicants whose priority is violated at C (A). A choice rule C is priority violations
minimal in the class  of choice rules, if C   and it creates less priority violations than
any choice rule in .

Theorem 2. Regular reserves-and-quotas rule is priority violations minimal in the class of
choice rules satisfying Axioms 1 and 2.


We say a choice rule C priority dominates choice rule C if for any a, a A  A,

                   a  C (A) \ C (A) and a  C (A) \ C (A) implies a       a.

In other words, priority domination says that if from each of the chosen sets we remove
applicants that appear in both of them, any applicant in the first set has a higher priority
than any applicant in the second one. A choice rule C is priority rank maximal in the
class  of choice rules, if C   and it priority dominates any choice rule in .

Theorem 3. Regular reserves-and-quotas rule is the unique priority rank maximal choice
rule in the class of choice rules satisfying Axioms 1-3.


In the class of non-wasteful choice rules, priority rank maximality implies priority violations
minimality. Therefore, the regular reserves-and-quotas rule is the unique priority violations
minimal rule in the class of choice rules satisfying Axioms 1-3, and consequently, in the class
of generalized reserves-and-quotas rules.

The results above provide an axiomatic foundation for using the regular reserves-and-quotas
rule. A potential argument for applying an alternative generalized reserves-and-quotas rule

                                              11
instead of the regular one is that the former may potentially achieve better distributional
outcomes for certain groups. Consider Example 1. The second application order in the
example corresponds to the regular reserves-and-quotas rule. Let us refer to the generalized
reserves-and-quotas rule corresponding to the first application order as alternative rule. The
alternative rule assigns more low-income applicants compared to the regular reserves-and-
quotas rule. However, this potentially `improved' distribution outcome comes at the expense
of violating a2 's priority under the alternative rule. This violation cannot be explained and
can easily be avoided by changing the application order. Instead, the same distributional
outcome can be achieved by increasing low-income reserves from one to two and applying
the regular reserves-and-quotas rule. In contrast to the alternative rule, the violation of a2 's
priority is fully explained. a3 is chosen over a2 , because the reserves would not be respected
otherwise.

That the outcome of some generalized reserves-and-quotas rule can also be achieved by the
regular reserves-and-quotas rule is not peculiar to the example above, but rather a general
phenomenon.

Proposition 2. For any set of reserves and quotas, consider an arbitrary reserves- and
quotas-respecting, non-wasteful and within-type priority compatible choice rule C and a subset
A  A. Let C r be the regular reserves-and-quotas rule corresponding to the reserves vector
rt = C (A)  At . Then, C r (A) = C (A).


Since generalized reserves-and-quotas rules are reserves- and quotas-respecting, non-wasteful
and within-type priority, this result holds for generalized reserves-and-quotas rules as well.
Proposition 2 follows from that within-type priority compatibility of C implies that the choice
rule selects rt highest priority type-t applicants for each t  T . Also, non-wastefulness of C
implies that it selects applicants up to the school's capacity, unless type specific quotas are
binding. When reserves are (rt )tT , C r also selects rt highest priority type-t applicants for
each t  T . Thus, the set of selected applicants coincide under both choice rules.

The example and Proposition 2 potentially suggest that the regular reserves-and-quotas rule
resolves the conflict between distributional objectives and respecting priorities in the most
transparent way. Alternative generalized reserves-and-quotas rules may create `unexplained'
priority violations, while the regular reserves-and-quotas rule can achieve the same distribu-
tional outcomes, and any remaining priority violation is explained by the choice of reserves
and quotas.



                                               12
6    Multiple Schools

In this section we assume |S | > 1. A choice rule Cs : 2A  2A for each s  S is defined as
before, i.e., it satisfies Cs (A)  A and Cs (A)  qs for all A  A, where qs is the capacity of
school s. A preference ranking Pa of applicant a is a complete, transitive and anti-symmetric
binary relation on S . We assume that            sS   qs  |A|. This is without loss of generality as
we can add a school that no applicant prefers and that has unlimited capacity.

An assignment is a mapping µ : A  S , such that µ-1 (s)  qs for all s  S . Each
school has type-specific reserves rs = (rst )tT satisfying         tT   rst  qs . Let r = (rs )sS . For
simplicity, assume there are no type-specific quotas, i.e., qst = qs for all t  T . We extend
the following axioms to assignments.

Axiom 5. An assignment µ is reserves-respecting if for any a  A and s  S , sPa µ(a)
implies that µ-1 (s)  A (a)  rs (a) .

Axiom 6. An assignment µ is non-wasteful if for any a  A and s  S , sPa µ(a) implies
µ-1 (s) = qs .

Axiom 7. An assignment µ is within-type priority compatible if for any a  A and
s  S , sPa µ(a) implies that a    s   a for all a  µ-1 (s)  I (a) .

The classes of assignments satisfying Axioms 5-7 is large. In particular, it includes the set of
stable assignments in a setting with distributional constraints (e.g., Abdulkadiroglu (2005),
Hafalir et al. (2013)). Within those assignments, we are interested in ones that minimize or
reduce priority violations. We say that the priority of applicant a is violated at µ, if there
is an s  S such that sPa µ(a) and a          s   a for some a  µ-1 (s). We say an assignment
µ is priority violations minimal in the class of assignments M if µ  M and for every
µ  M the number of applicants whose priority is violated at µ is weakly smaller than the
number of applicants whose priority is violated under µ . Multiple schools complicate the
problem of finding priority violations minimal assignments.

Theorem 4. Finding a priority violations minimal assignment in the class of assignments
satisfying Axioms 5 and 6 is an NP-hard problem, even when there are only two types.

Theorem 5. Finding a priority violations minimal assignment in the class of assignments
satisfying Axioms 5-7 is an NP-hard problem.

In practice, an assignment is typically found by applying the following Deferred Acceptance
(DA) algorithm.

                                                  13
Deferred Acceptance (DA)

Step k  1. Each applicant applies to her most preferred school that has not rejected her
yet. Let As denote the applicants who apply to school s. Each s  S tentatively accepts
applicants in Cs (As ) and rejects the rest. If there is a rejection, proceed to Step k + 1.
Otherwise, the procedure terminates and tentative acceptances are finalized.

Notice that the outcome of the DA is reserves-respecting, non-wasteful and within-type
priority compatible when all schools use a reserves-respecting, non-wasteful and within-type
priority compatible choice rules, respectively. In particular, all these properties are satisfied
when all schools apply the regular reserves-and-quotas rule.

As our NP-hardness results suggest, the outcome of DA where all schools apply the regular
reserves-and-quotas rule is not priority violations minimal in the class of assignments satisfy-
ing Axioms 5 and 6 (and 7). This is true even when all applicants share common preferences
and all schools share common priorities.5 We discuss these complications in Appendix C.
We provide simulations results for evaluating the performance of the regular reserves-and-
quotas rule in terms of reducing priority violations compared to an alternative alternative
generalized reserves-and-quotas rule. Simulations show that the superior performance of
the regular reserves-and-quotas rule established in Section 5 generalizes to the setting with
multiple schools.



7       Simulations

The previous section highlights the complications related to analytical comparisons of the
DA outcome under different choice rules. Therefore, we implement these comparisons in
a simulated public school assignment environment. Our simulations feature 17,000 appli-
cants and 200 schools (programs). Preferences and priorities are generated to resemble a
real public school assignment data from a US school district. Each school grants highest
priority to applicants who have a sibling attending the school, the second highest priority to
applicants residing in the school's neighborhood, and the lowest priority to remaining appli-
cants. Schools use a common random tie-breaker to obtain strict ranking over applicants.
Recall that our notion of priority violation considers only original priorities, not the random
tie-breakers. Each school reserves proportion  of seats for low-income applicants and equal
    5
    We show in the Appendix that a positive result can be obtained in this rather restrictive environment
only of we change the way we count priority violations.


                                                   14
proportion  of seats for high-income ones. The remaining seats are not reserved for anyone
and we refer to those as open seats. We report results for   {0.2, 0.3, 0.4}.

Applicants' income groups are determined as follows. First, we run DA without reserves
and quotas to determine overdemanded schools, i.e., those that reject an applicant during
the algorithms' implementation.6 For each applicant we draw a number  uniform randomly
from the unit interval. The applicants' income level is  +  if the applicant lives in a
neighborhood of an overdemanded school and  if she does not. Thus, the average income
of applicants in neighborhoods of overdemanded schools is  and the average income of
applicants not in neighborhoods of overdemanded schools is normalized to zero. We report
results for   {0.1, 0.2, 0.5}.

School assignment is determined by the DA algorithm. We consider two choice rules: the
regular reserves-and-quotas rule and an alternative rule. As described in Section 5, under
the regular reserves-and-quotas applicants are considered for seats reserved for their types
first. Under the alternative rule, applicants are considered for seats reserved for their types
last. We run 100 simulations for each parameter value. Table 1 reports average number of
priority violation instances. Standard errors are in the parentheses.

Most importantly, simulations reveal that the regular reserves-and-quotas rule creates sub-
stantially less priority violations compared to the alternative one.

For example, when only 20% of seats are reserved for low- and high-income applicants each,
i.e.  = 0.2, and neighborhoods with over-demanded schools have an average income that
is 0.1 higher than the average of the remaining neighborhoods, i.e.  = 0.1, the average
number of applicants whose priority is violated under the regular reserves-and-quotas is
0.05. In comparison, this number under the alternative rule is 30.36. The number of priority
violations instances are increasing in the reserves' size . This direction is intuitive as
under larger reserves, or equivalently, stricter distributional constraints, schools accept more
applicants based on their types, as opposed to priorities.

Second, these numbers are higher for larger income parameter  . This is because with
larger  , more of the low-income applicants are residing outside of neighborhoods with over-
demanded schools. Therefore, reserves play a larger role in determining the assignment
to over-demanded schools, and consequently, there more applicants' priorities are violated.
  6
    In our simulations, the number of applicants living at a neighborhood of an overdemanded school is
7,240.



                                                 15
                                        Regular Reserves-
                                                               Alternative Rule
                                        and-Quotas Rule




0.2                     0.1                   0.05                  30.36
                                             (0.30)                (11.00)

                        0.2                   0.31                  57.00
                                             (1.31)                (15.62)

                        0.5                   26.00                225.31
                                             (16.76)               (39.20)

0.3                     0.1                   0.50                  51.43
                                             (1.12)                (14.78)

                        0.2                   3.25                 100.35
                                             (4.23)                (18.94)

                        0.5                  174.11                452.08
                                             (40.47)               (56.91)

0.4                     0.1                  10.37                  76.50
                                             (8.00)                (20.12)

                        0.2                   40.18                165.15
                                             (17.07)               (25.67)

                        0.5                  546.32                703.87
                                             (55.58)               (50.31)



 Table: (DA) Average Number of Applicants Whose Priority is Violated
Table 1: Average Number of Applicants Whose Priority is Violated




                                   16
However, the conclusion that the regular reserves-and-quotas rule creates substantially less
priority violations persists across the parameter space.



8      Conclusion

We study priority-based assignment with reserves and quotas. There are three main contri-
butions. First, we characterize generalized reserves-and-quotas rules with four axioms that
reflect the policy maker's objectives of respecting priorities and achieving diversity. Sec-
ond, we show that there is a unique choice rule that selects highest priority applicants and
minimizes priority violations among all generalized reserves-and-quotas rules. Our findings
provide axiomatic foundation for the regular reserves-and-quotas rule. Third, we study pri-
ority violations minimization in two-sided markets with multiple schools and quantify the
performance of the regular reserves-and-quotas rule compared to an alternative rule through
simulations.



References
Abdulkadiroglu, Atila. 2005. College Admission with Affirmative Action. International
    Journal of Game Theory, 33, 535­549.

Abdulkadiroglu, Atila, and S¨
                            onmez, Tayfun. 2003. School Choice: A Mechanism Design
    Approach. American Economic Review, 93(3), 729­747.

Abdulkadiroglu, Atila, Pathak, Parag A., and Roth, Alvin E. 2005. The New York City High
    School Match. American Economic Review, Papers and Proceedings, 95(2), 364­367.

Abdulkadiroglu, Atila, Pathak, Parag A., and Roth, Alvin E. 2009. Strategy-Proofness
    versus Efficiency in Matching with Indifferences: Redesigning the New York City High
    School Match. American Economic Review, 99(5), 1954­1978.

Abdulkadiroglu, Atila, Che, Yeon-Koo, and Yasuda, Yosuke. 2011. Resolving conflicting
    preferences in school choice: The "Boston" mechanism reconsidered. American Economic
    Review, 101(1), 399­410.

Armor, David J., and Rossell, Christine H. 2002. Desegregation and resegregation in the
    public schools. New perspectives on race and ethnicity in America 252.


                                             17
Aygun, Orhan, and B´
                   o, In´
                        acio. 2020. College admission with multidimensional privileges:
  The Brazilian affirmative action case. Working Paper.

Becker, Gary S. 1973. A theory of marriage: Part I. Journal of Political Economy, 81(4),
  813­846.

Bir´
   o, P´
       eter, Fleiner, Tam´
                         as, Irving, Robert W., and Manlove, David F. 2010. The College
  Admissions Problem with Lower and Common Quotas. Theoretical Computer Science,
  411(34-36), 3136­3153.

Bodoh-Creed, Aaron L., and Hickman, Brent R. 2018. College assignment as a large contest.
  Journal of Economic Theory, 175, 88­126.

Bulow, Jeremy, and Levin, Jonathan. 2006. Matching and Price Competition. American
  Economic Review, 96, 652­668.

Che, Yeon-Koo, and Koh, Youngwoo. 2016. Decentralized College Admissions. Journal of
  Political Economy, 124(5), 1285­1338.

Delacr´
      etaz, David. 2020. Processing Reserves Simultaneously. Working Paper.

Dogan, Battal. 2017. How to Control Controlled School Choice: Comment. American
  Economic Review, 107(4), 1362­1364.

Dogan, Battal, Dogan, Serhat, and Yildiz, Kemal. 2020. On capacity-filling and substitutable
  choice rules. Mathematics of Operations Research.

Dur, Umut, Kominers, Scott Duke, Pathak, Parag A., and S¨
                                                        onmez, Tayfun. 2018. Reserve
  Design: Unintended Consequences and the Demise of Boston's Walk Zones. Journal of
  Political Economy, 6(6), 2457­2479.

Dur, Umut, Pathak, Parag A., and S¨
                                  onmez, Tayfun. 2020. Explicit vs. Statistical Targeting
  in Affirmative Action: Theory and Evidence from Chicago's Exam Schools. Journal of
  Economic Theory, 187.

Echenique, Federico, and Yenmez, Bumin M. 2015. How to control controlled school choice.
  American Economic Review, 105(8), 2679­2694.

Ehlers, Lars, Hafalir, Isa E., Yenmez, Bumin M., and Yildirim, Muhammed A. 2014. School
  Choice with Controlled Choice Constraints: Hard Bounds versus Soft Bounds. Journal of
  Economic Theory, 153, 648­683.


                                            18
Ellison, Glenn, and Pathak, Parag A. 2021. The Efficiency of Race-Neutral Alternatives
  to Race-Based Affirmative Action: Evidence from Chicago's Exam Schools. American
  Economic Review, 111(3), 943­975.

Gale, David, and Shapley, Lloyd S. 1962. College Admissions and the Stability of Marriage.
  American Mathematical Monthly, 69, 9­15.

Galston,    William     A.,     and    Kamarck,       Elaine.      2021.      The    COVID-
  19   vaccine:     What      can   states   learn   from   each     other?         Brookings,
  https://www.brookings.edu/blog/fixgov/2021/02/19/the-covid-19-vaccine-what-can-states-
  learn-from-each-other/.

Garey, Michael R., and Johnson, David S. 1979. Computers and Intractability: A Guide to
  the Theory of NP-Completeness. A Series of Books in the Mathematical Sciences. San
  Francisco, Calif.: W. H. Freeman and Co.

Grigoryan, Aram. 2020. Effective, Fair and Equitable Pandemic Rationing. Working Paper.

Hafalir, Isa E., Yenmez, M. Bumin, and Yildirim, Muhammed A. 2013. Effective Affirmative
  Action in School Choice. Theoretical Economics, 8(2), 325­363.

Hamada, Koki, Iwama, Kazuo, and Miyazaki, Shuichi. 2016. The Hospitals/residents Prob-
  lem with Lower Quotas. Algorithmica, 74(1), 440­465.

Imamura, Kenzo. 2020. Meritocracy versus diversity. Working Paper.

Kojima, Fuhito. 2012. School choice: Impossibilities for Affirmative Action. Games and
  Economic Behavior, 75(2), 685­693.

Kominers, Scott Duke, and S¨
                           onmez, Tayfun. 2016. Matching with Slot-specific Priorities:
  Theory. Theoretical Economics, 11(2), 683­710.

Maxwell, Connor, and Garcia, Sara. 2019. 5 reasons to support affirmative action in college
  admissions. https://www.americanprogress.org/issues/race/news/2019/10/01/471085/5-
  reasons-support-affirmative-action-college-admissions/.

NASEM. 2020. National Academies of Sciences, Engineering and Medicine, A framework
  for equitable allocation of vaccine for the novel coronavirus.

Pathak, Parag A., S¨              ¨
                   onmez, Tayfun, Unver, Utku M., and Yenmez, Bumin M. 2020a. Fair
  Allocation of Vaccines, Ventilators and Antiviral Treatments: Leaving no Ethical Value
  Behind in Health Care Rationing. Working Paper.

                                               19
Pathak, Parag A., Rees-Jones, Alex, and S¨
                                         onmez, Tayfun. 2020b. Reversing Reserves. Work-
  ing Paper.

Persad, Govind, Peek, Monica E., and Emanuel, Ezekiel J. 2020. Fairly prioritizing groups
  for access to COVID-19 vaccines. Journal of the American Medical Association, 324(16),
  1601­1602.

Ryan, James E., and Heise, Michael. 2002. The Political Economy of School Choice. The
  Yale Law Journal, 111(8), 2043­2136.

S¨
 onmez, Tayfun, and Switzer, Tobias B. 2013. Matching with (branch-of-choice) contracts
  at the United States military academy. Econometrica, 81(2), 451­488.

S¨
 onmez, Tayfun, and Yenmez, Bumin M. 2019a. Affirmative action in India via vertical and
  horizontal reservations. Working Paper.

S¨
 onmez, Tayfun, and Yenmez, Bumin M. 2019b. Affirmative Action with Overlapping Re-
  serves. Working Paper.




                                            20
A      Proofs of Main Results

A.1     Proof of Theorem 1

The proof has two parts. Part 1 shows that any choice rule satisfying Axioms 1-4 is a
generalized reserves-and-quotas rule for some application orders. Part 2 shows that any
generalized reserves-and-quotas rule satisfies Axioms 1-4.

Part 1. Suppose C satisfies Axioms 1-4. Consider an arbitrary A  A. Since the choice rule
is (reserves- and) quotas- respecting and within-type priority compatible, for each t  T , it
never selects any type-t who does not have one of the qt highest priorities among type-t
applicants. Thus, without loss of generality, we may restrict attention to the case where
|At |  qt for all t  T . Also, since C is non-wasteful, we may assume |A|  q .

For each t  T , let At  At be the set of type-t applicants who cause priority violations at
C (A). Since C is beyond-reserves priority compatible, |At |  rt for any t  T . If |At |  rt ,
    ¯t = C (A)  At . Otherwise, let A
let A                               ¯t  C (A)  At be such that |A  ¯t | = rt and A  A¯t . For
                                                                                  t
an applicant a  A, we construct the application order             a,A   as follows:


    · If a  A
            ¯ (a) or a  A \ C (A), then s (a)       a,A   s for any s  S .

    · If a  C (A) \ A
                    ¯ (a) , then s   a,A   s (a) for any s  S .

    · The order between any two slots in S \ {s (a) } is arbitrary.


Let C g denote the generalized reserves-and-quotas rule corresponding to the constructed
application orders. In what follows we show that C g = C .

Since the DA outcome is independent of the order of applications, suppose applicants in
C (A) apply before applicants in A \ C (A). Note that since |C (A)|  q , all applicants in C (A)
will be accepted by some slot in S . Consider an arbitrary a  A \ C (A). It is sufficient to
show that a is rejected by all slots. By construction of application orders, a first applies to
s (a) . Since C is reserves-respecting and a  A \ C (A), there are at at least r (a) type  (a)
applicants in C (A). Moreover, since C is within-type priority compatible, all these applicants
have a higher priority than a. In particular, applicants in A¯ (a) have higher priority than a.
By construction of application orders, these applicants apply to s (a) before any other slot.
Therefore, at least r (a) applicants with higher priorities than a are tentatively assigned to
s (a) at the time when she applies there. Hence, a is rejected by s (a) .

                                                   21
We now show that a is rejected from all slots s  S \ {s (a) }. By definition, no applicant in
         ¯t causes a priority violation. Thus, all those applicants have higher priorities than
C (A)\tT A
a. Since a  A \ C (A) and C is non-wasteful, |C (A)| = q . Therefore, all slots s  S \ {s (a) }
are tentatively filled with higher priority applicants than a, and a is rejected by all of them.

Part 2. Consider an arbitrary A  A and application orders (               a,A )aA .   Let C g be the
generalized reserves-and-quotas rule corresponding to these application orders. We verify
that C g satisfies Axioms 1-4.

Respecting reserves: Consider an arbitrary A  A. That C g (A)  At  qt for all t  T is
immediate from the description of C g . Moreover, since type-t applicants have the highest         t
                                                                                       g
priority at st , at least rt of them are guaranteed to be accepted by st . Thus, |C (A)  At | 
min |At |, rt .

Non-wastefulness: Non-wastefulness is immediate from the description of the generalized
reserves-and-quotas rule.

Within-type priority compatibility: Suppose a causes priority violation for a at A. By
contradiction, suppose  (a) =  (a ). Then, a      t   a for all t  T . This contradicts that C g (A)
chooses a , but not a.

Beyond-reserves priority compatibility: By contradiction, suppose there is a set of type-t
applicants At causing priority violations at A such that |At | > rt . Let a be the highest
priority applicant in A \ C (A). Then, each a  At causes priority violation for a. Let
At  At be the set of applicants who are assigned to st . Since |At |  rt , there exists an
a  At \ At . This contradicts that a is selected over a at C g (A).



A.2     Proof of Proposition 1

Let C g be a generalized reserves-and-quotas rule corresponding to some regular application
order. We show that C g equals the regular reserves-and-quotas rule C r .

Consider an arbitrary A  A with |At |  qt for all t  T and |A|  q . It is immediate that
both C g and C r are non-wasteful. Therefore,

                                    |C g (A)| = q = |C r (A)|.                                   (1)

Let A be the set of applicants selected at the first stage of the implementation of C r . First,
we show that A  C g (A). Consider an arbitrary a  A . By description of C r , a is one

                                                22
of the r (a) highest priority type applicants in A (a) , and therefore, she is one of the r (a)
highest       (a)   priority applicants at s (a) . Thus, in Step 1 of C g , a applies to s (a) and is never
rejected by the school. This establishes that a  C g (A).

Now, by contradiction, suppose C g (A) = C r (A). By equation 1, there is an applicant a 
C r (A) \ C g (A). Since A  C g (A), it should be that a / A . Therefore, a is selected at the
second stage of C r 's implementation. By description of C r , a is one of the min |A|, q -
    tT   min |At |, rt     highest priority applicants in A \ A . This contradicts that a is not
selected at C g (A).



A.3        Proof of Theorem 2

Let C r be the regular reserves-and-quotas rule. We show that C r is priority violations minimal
in the class of reserves- and quotas-respecting and non-wasteful choice rules.

That C r is reserves- and quotas-respecting and non-wasteful is immediate from its description.
Let C be an arbitrary reserves- and quotas-respecting and non-wasteful choice rule. Consider
an arbitrary A  A with |A|  q . Since both C r and C are non-wasteful,

                               C r (A) = min q,         min |At |, qt      = C (A) .                    (2)
                                                   tT

Let a      a denote that a          a or a = a . Also, let a
                                                           ¯ and a
                                                                 ¯ be the lowest priority applicants in
C r (A) and C (A), respectively. Then, by equation 2, the number of applicants whose priority
is violated at C r (A) and C (A) is            a  A : a         a
                                                                ¯     - C r (A) + 1 and      a  A : a
a
¯    - C (A) + 1, respectively. Thus, by equation 2, it is sufficient to show that a
                                                                                   ¯               a
                                                                                                   ¯.

By contradiction, suppose a              ¯ for all a  C (A). Since C is reserves-respecting, there are at
                                         a
least min |At |, rt type-t applicants in A for each t  T . Thus, a
                                                                 ¯ cannot be selected at the
first stage of C r 's implementation, since then she would have a weakly higher priority than at
                                     ¯ is selected at the second stage of C r 's implementation.
least one individual in C (A). Thus, a
For any a  C (A) \ C r (A), it should be that C r (A) (a) = q (a) , since otherwise a
                                                                                    ¯ would not
                                                    r
have been selected over a at the second stage of C 's implementation. Let T :=  (a) : a 
C (A) \ C r (A) . Then,

             min q,           min |At |, qt     = C (A)             qt +   C (A) :  (a)  T \ T
                         tT                                  tT


                              =        qt +   a  C r (A)  C (A) :  (a)  T \ T
                                  tT


                                                        23
                    =         C r (A)t +     a  C r (A)  C (A) :  (a)  T \ T
                        tT

                               C r (A) = min q,            min |At |, qt   ,
                                                      tT

where the second equality follows from that a  C (A) :  (a)  T \ T                 = a  C r (A) C (A) :
 (a)  T \ T     by definition of T . Thus,

                         C (A) =           qt +   a  C (A) :  (a)  T \ T       ,
                                    tT

and consequently,
                         C (A)  At = qt = C r (A)  At for all t  T .                                (3)
Moreover, by definition of T ,

                             C (A)  At  C r (A)  At for all t  T \ T .                              (4)

Equations 2-4 imply that

                               C r (A)  At = C (A)  At for all t  T.

Since C r selects the highest priority applicants of each type, this contradicts that a           a
                                                                                                  ¯ for
all a  C (A).



A.4     Proof of Theorem 3

We shows that C r is the unique priority rank maximal rule in the class of reserves- and
quotas-respecting, non-wasteful and within-type priority compatible choice rules.

That C r is within-type priority compatible is immediate from its description. Let C be
an arbitrary reserves-respecting, quotas respecting, non-wasteful and within-type priority
compatible choice rule. To establish Part 2, it is sufficient to show that C r priority dominates
C . Uniqueness would follow from the definition of priority rank maximality.

Consider an arbitrary A  A with |At |  qt for all t  T and |A|  q . Without loss of
generality, suppose C r (A) = C (A). Since both C r and C are non-wasteful,

                                           C r (A) = q = C (A) .

Thus, C r (A) = C (A) implies that there are a, a  A such that

                              a  C r (A) \ C (A) and a  C (A) \ C r (A).

                                                    24
Since C is reserves-respecting and a / C (A), there are at least r (a) applicants in C (A) (a) .
Moreover, since C is within-type priority compatible, all r (a) highest priority applicants in
A (a) are in C (A). Therefore, a is not one of the r (a) highest priority type applicants in A (a) .
Similarly, since C r is reserves-respecting, a is not one of the r (a ) highest priority applicants
in A (a ) . Hence, neither a nor a is selected at the first stage of C r ' implementation. Since
a is selected over a at the second stage of C r 's implementation and C r (A) (a ) < q (a ) , we
conclude that a        a.



A.5        Proof of Theorem 4

Complexity theory categorizes problems into classes based on the amount of computational
resources needed to solve them. NP-hard problems are commonly considered as the class of
computationally intractable problems. This is because there are no known polynomial time
algorithms for solving NP-hard problems, and it is widely conjectured and believed that none
exists. A typical way of proving NP-hardness of a problem is constructing a polynomial time
reduction from a well-known NP-hard problem. A reduction transforms one problem to
another in a way that solving the second problem solves the first problem.

We prove the NP-hardness of finding a priority violations minimal reserves-respecting and
non-wasteful assignment by constructing a polynomial time reduction from the Complete
Bipartite Subgraph (CBS ) problem. For a given bipartite graph (V1 , V2 , E ) and an integer
k  min |V1 |, |V2 | , the CBS problem asks whether there are subsets U1  V1 and U2  V2
such that |U1 | = k , |U2 |  k and (u1 , u2 )  E for all u1  U1 and u2  U2 . This problem is
NP-hard (Garey and Johnson, 1979).

Consider an arbitrary CBS instance (V1 , V2 , E ) and k . We construct the corresponding tuple
 A, S, T, , r, (    s )sS , (Pa )aA     as follows:


      · A = AAA       ¯, where A = {avn }vV2 ,n=1,2,...,N , N > |V1 | is some large number,7 |A| = k ,
         ¯| = |V1 | - k , and A, A and A
        |A                             ¯ are pairwise disjoint.

        For each v  V2 , we may think of applicants in {avn }n=1,2,...,N as N copies of each
        other. For any m, n = 1, 2, . . . , N , we say applicants avn  A and aum  A are distinct
        if v = u.

      · S = {sv }vV1  {s
                       ¯},
  7
      E.g., N = |V1 | + 1 would work.


                                                      25
   · Capacities are                             
                                                |A|        if s = s
                                                                  ¯,
                                         qs =
                                                1          otherwise.

   · T = {t, t } and for all a  A,
                                                  
                                                  t        if a  A,
                                          (a) =
                                                  t        otherwise.

   · rst = 0 and rst = 1 for all s  S \ {s
                                         ¯}.

   · Schools have common priorities          satisfying

                                                  a
                                                  ¯    a     a

              ¯A
      for all a ¯, a  A and a  A.

   · Preferences satisfy

         ­ for each sv  S \ {s
                             ¯} and aun  A,

                                       ¯Pau sv if and only if (v, u)  E,
                                       s

         ­ for each sv  S \ {s         ¯  A,
                             ¯} and a  A

                                                       sv P a s
                                                              ¯.


All unspecified aspects of the tuple A, S, T, , r, (        s )sS , (Pa )aA   are arbitrary.

We first prove the following claim.

Claim 1. An assignment is priority violations minimal (in some class of assignments) only
if it minimizes the number of distinct applicants in A whose priority is violated.

The proof of the Claim 1 is straightforward. Notice that for each v  V2 , applicants in
{avn }n=1,2,...,N are identical, i.e., the priority of one of them is violated if and only if all their
priorities are violated. Thus, priority violations for applicants in A  A         ¯ are of secondary
importance since their number is bounded by N . Therefore, any priority violations mini-
mizing assignment should minimize the number of distinct applicants in A whose priority is
violated.

Thus, to establish NP-hardness of finding priority violations minimal reserves-respecting and
non-wasteful assignment it is sufficient to prove the following claim.

                                                  26
Claim 2. There are subsets U1  V1 , U2  V2 such that |U1 | = k , |U2 |  k and (u1 , u2 ) 
E for all u1  U1 , u2  U2 if and only if there is a reserves-respecting and non-wasteful
assignment such that the number of distinct applicants in A whose priority is violated is
weakly smaller than |V2 | - k .


We now prove Claim 2. Fix and arbitrary reserves-respecting and non-wasteful assignment
µ. Note that all schools in S \ {s¯} have a single seat reserved for type-t applicants, and
there are exactly |V2 | = S \ {s
                               ¯} type-t applicants (namely those in A  A  ¯). Moreover, all
these applicants prefer schools in S \ {s
                                        ¯} to s
                                              ¯. Therefore, all schools in S \ {s
                                                                                ¯} are filled with
applicants in A  A ¯. Consequently, all applicants in A are assigned to s  ¯.

Applicants in A have higher priorities than applicants in A, and lower priorities than ap-
         ¯. Therefore, only applicants in A can cause priority violations for applicants in
plicants A
A. More precisely, the priority of a  A is violated at µ if and only if µ(a)Pa s
                                                                               ¯ for some
a  A. Equivalently, the priority of a  A is not violated at µ if and only if s
                                                                             ¯Pa µ(a) for all
a  A. By construction of preferences, the last condition holds if and only if (v, u)  E for
all u  U1  V1 , where v is the index corresponding to applicant a and U1 is the set of indices
corresponding to schools µ(a) : a  A . Thus, |U1 | = |A| = k . Denoting by U2  V2 the
set of indices of applicants in A whose priority is not violated, we have that (u1 , u2 )  E for
all u1  U1 and u2  U2 . Hence, |U2 |  k if and only if the number of distinct applicants in
A whose priority is violated is weakly smaller than |V2 | - k . This completes the proof of the
claim, and therefore, of Theorem 4.



A.6      Proof of Theorem 5

Like with Theorem 4, we prove Theorem 5 by constructing a polynomial time reduction from
the CBS problem.

Consider an arbitrary CBS instance (V1 , V2 , E ) and k . We construct the corresponding tuple
 A, S, T, , r, (   s )sS , (Pa )aA   as follows:


   · A = A  A, where A = {avn }vV2 ,n=1,2,...,N , N > |V1 | is some large number, A =
      {av }vV1 , and A and A are disjoint.
      For any m, n = 1, 2, . . . , N , we say applicants avn  A and aum  A are distinct if
      v = u.


                                                   27
   · S = {sv }vV1  {s}  {s
                         ¯}.

   · Capacities are                 
                                     |A| - k = |V1 | - k           if s = s,
                                    
                                qs = |A|                           if s = s
                                                                          ¯,
                                    1                              otherwise.

   · T = {t}  {tv }vV1 and for all a  A,
                                      
                                      t               if a  A,
                                (a) =
                                      t
                                         v            if a = av , v  V1 .

   · rsv t = rsv tu = 0 for all v, u  V1 , v = u and rsv tv = 1.

   · Schools have common priorities         satisfying

                                                  a      a

     for all a  A and a  A.

   · Preferences satisfy

        ­ for each sv  S \ {s, s
                               ¯}, and aun  A, s
                                               ¯Pau s, and

                                      ¯Pau sv if and only if (v, u)  E,
                                      s

        ­ for sv , su  S \ {s, s
                               ¯}, v = u, and av  A,

                                              sPav sv Pav s
                                                          ¯Pav su ..


All unspecified aspects of the tuple A, S, T, , r, (         s )sS , (Pa )aA   are arbitrary.

The proof of the following claim is analogous to that of Claim 1.

Claim 3. An assignment is priority violations minimal (in some class of assignments) only
if it minimizes the number of distinct applicants in A whose priority is violated.


Thus, to establish NP-hardness of finding priority violations minimal reserves-respecting,
non-wasteful and within-type priority compatible assignment it is sufficient to prove the
following claim.


                                                 28
Claim 4. There are subsets U1  V1 , U2  V2 such that |U1 | = k , |U2 |  k and (u1 , u2 )  E
for all u1  U1 , u2  U2 if and only if there is a reserves-respecting, non-wasteful and within-
type priority compatible assignment µ such that the number of distinct applicants in A whose
priority is violated is weakly smaller than |V2 | - k .


We now prove Claim 4. Fix and arbitrary reserves-respecting, non-wasteful and within-type
                                                                   ¯ to s and s
priority compatible assignment µ. Since all applicants in A prefer s          ¯ has enough
seats to accommodate all applicants, no applicant in A will be assigned to s at the non-
wasteful assignment µ. Moreover, applicants in A rank school s as a first choice. Therefore,
s is entirely filled with applicants in A at the non-wasteful assignment µ. However, the
school has only |A| - k seats. Thus, exactly k of the applicants in A are not assigned to s
at any non-wasteful assignment. Moreover, each applicant av  A ranks sv  S \ {a, a
                                                                                 ¯} as
most preferred choice after s, and the school has a single seat reserved for that applicant.
Thus, any applicant in A that is not assigned to s is assigned to the single reserved seat
of the corresponding school at any reserves-respecting allocation. The remaining schools in
S \ {s, s
        ¯} are filled by applicants in A.

Consider an applicant a  A whose priority is violated at µ. Since µ is within-type priority
compatible, it should be that the priority violation is respect to in S \ {s, s
                                                                              ¯} where some
          ¯ is assigned. That is, the priority of a  A is violated if and only if µ(a)Pa s
applicant A                                                                              ¯ for
some a  A. Equivalently, the priority of a  A is not violated at µ if and only if s
                                                                                  ¯Pa µ(a) for
all a  A. By construction of preferences, the last condition holds if and only if (v, u)  E
for all u  U1  V1 , where v is the index corresponding to applicant a and U1 is the set of
indices corresponding to schools µ(a) : a  A . Thus, |U1 | = |A| = k . Denoting by U2  V2
the set of indices of applicants in A whose priority is not violated, we have that (u1 , u2 )  E
for all u1  U1 and u2  U2 . Hence, |U2 |  k if and only if the number of distinct applicants
in A whose priority is violated is weakly smaller than |V2 | - k . This completes the proof of
the claim, and therefore, of Theorem 5.



B      Independence of Axioms in Theorem 1

When any of the Axioms 1-4 is relaxed, we provide examples of choice rules that are not
generalized reserves-and-quotas rules and satisfy the remaining three axioms.


    · Consider the choice rule C that only accepts up to rt highest priority applicants of each

                                                29
      type t  T . Then, C satisfies Axioms 1,3 and 4, but not 2.

    · Consider the choice rule C that accepts up to q of highest priority applicants. Then, C
      satisfies Axioms 2,3 and 4, but not 1.

    · Suppose A = {a1 , a2 }, a1      a2 ,  (a1 ) =  (a2 ) = t and rt = qt = q = 1. Consider the
      choice rule C that chooses a2 whenever she is available and chooses a1 whenever a2 is
      not available, but a1 is. Then, the rule satisfies Axioms 1,2 and 4, but not 3.

    · Suppose A = {a1 , a2 }, a1          a2 ,  (a1 ) = t = t =  (a2 ) and rt = rt = 0 and
      qt = qt = q = 1. Consider the choice rule C that chooses a2 whenever she is available
      and chooses a1 whenever a2 is not available, but a1 is Then, the rule satisfies Axioms
      1,2 and 3, but not 4.



C      Additional Results for Multiple Schools

Suppose all applicants have a common preference ranking P and all schools have a common
priority ranking     . We show that the outcome of DA where all schools apply the regular
reserves-and-quotas rule may not be priority violations minimal in the class of reserves-
respecting and non-wasteful (and within-type priority compatible) assignments even for this
simple case with common preferences and priorities.

Example 2. Suppose A = {a1 , a2 , a3 , a4 }, S = {s1 , s2 }, qs1 = 1, qs2 = 2,  (a1 ) = t1 =
 (a2 ) =  (a4 ) = t2 =  (a3 ) = t3 , s1 P s2 , a1    a2   a3 , rs1 t2 = rs2 t2 = 1 and rs2 t1 = rs2 t3 =
rs1 t3 = 0. The last two conditions say that the single seat at school s1 and one of the seats
in s2 are reserved for type-t2 applicants. If all schools apply the regular reserves-and-quotas
rule, DA will proceed as follows:
Step 1. All applicants apply to s1 . The school accepts a2 as she is the highest priority
type-t2 applicant.
Step 2. All rejected applicants apply to s2 . The school accepts a1 and a4 as they are the
highest priority and the remaining highest priority type-t2 applicants, respectively.

Now consider an alternative reserves-respecting and non-wasteful (and within-type priority
compatible) assignment where a2 is assigned to s1 , and a3 and a4 are assigned to s2 . Then,
the only applicant whose priority is violated is a1 . Thus, the outcome of DA where all schools
apply the regular reserves-and-quotas rule is not priority violations minimal in the class of
reserves-respecting and non-wasteful (and within-type priority compatible) assignments.

                                                    30
The example above is peculiar: it relies on the fact that we define priority violations mini-
mality by the number of individuals whose priority is violated. However, at the alternative
assignment in Example 2 the priority of a1 is violated with respect to both schools s1 and
s2 . This motivates our analysis of alternative priority violations minimality notions. We
say that an applicant-school pair (a, s) is a priority violations instance is s  S such
that sPa µ(a) and a     s   a for some s  S and a  µ-1 (s). We say an assignment µ is
priority violation instances minimal in the class of assignments M if µ  M and for
every µ  M the number of priority violation instances is weakly under µ than under µ .
In that case we can state the following positive result.

Proposition 3. In the setting with common preferences and priorities, the outcome of the
DA where all schools apply the regular reserves-and-quotas rule is priority violation instances
minimal in the class of assignments satisfying Axioms 5 and 6 (and 7).


Proof. Suppose schools are indexed by preferability, i.e. s1 P s2 P s3 ..., etc. Let K be such
that
                                    K -1                K
                                           qsk < A            qsk .
                                     k=1                k=1

The condition implies that sK is the least preferred school that fills a seat at a reserves-
respecting and non-wasteful (and within-type priority compatible) assignment.

Let µ be the outcome of the DA algorithm where all schools apply the regular reserves-
and-quotas rule. The feasibility of µ is immediate from the description of regular reserves-
and-quotas rule and the DA algorithm.For an integer an k , let aµ
                                                                k denote the lowest priority
applicant that is assigned to sk or a more preferred school at µ. Then, the number of priority
violation instances at µ is
                              K                                 k
                                    aA:a         aµ
                                                  k-1    -            qsj + 1 .
                              k=1                              j =1


Also let µ be an arbitrary feasible allocation and let aµ
                                                        k the lowest priority applicant that
is assigned to sk or a more preferred school at µ . Then, the number of priority violation
instances at µ
                              K                                 k
                                    aA:a         aµ
                                                  k-1    -            qsj + 1 .
                              k=1                              j =1

Thus, to show that there are weakly less priority violations instances at feasible assignment µ
than at feasible assignment µ , it is sufficient to show that aµ
                                                               k          aµ
                                                                           k for all k  {1, 2, ..., K - 1}.



                                                31
By contradiction, suppose aµ aµ                    µ             ~
                           k  k . Denote sl := µ(ak ). Also, let A := a  A : µ(a)P sl+1
    ~ := a  A : µ (a)P sl+1 . By feasibility of µ and µ ,
and A
                                                     l
                                            ~| =
                                           |A                     ~ |.
                                                           qsl = |A                                    (5)
                                                    j =1


By equation 5 and by that aµ  ~ , we have A
                                          ~ \A
                                             ~ = . Then, a                      aµ     aµ              µ
                           k /A                                                  k      k . Note that ak is
                     l
not one of the       j =1 r (ak ) highest priority applicants in A (ak ) . This is true, since otherwise,
                              µ                                      µ

                          µ
by feasibility of   µ , ak would be assigned to a school weakly more preferred to sl at µ . Thus,
aµ
 k is selected by school sl over a at the second stage of the regular reserves-and-quotas rule's
implementation. This contradicts a            aµ
                                               k.



Although restrictive, the assumption of common preferences and priorities is a standard
simple case. The assumption is heavily used for tractability in various contexts, such as
college admissions, school choice and labor market (e.g., Becker (1973), Bulow and Levin
(2006), Abdulkadiroglu et al. (2011), Bodoh-Creed and Hickman (2018)). The following
examples demonstrate that Proposition 3 no longer holds once we relax the assumptions of
common preferences or common priorities.

Example 3 (Relaxing Common Preferences). Suppose A = {a1 , a2 , a3 , a4 }, S = {s1 , s2 , s3 },
qs1 = qs2 = 1, qs3 = 4, T = {t1 , t2 , t3 },  (a1 ) = t1 =  (a2 ) = t2 =  (a3 ) =  (a4 ) = t3 ,
rt2 s2 = 1 and reserves are zero otherwise. Applicant a1 prefers s1 to s3 to s2 , a2 prefers s1
to s2 to a3 , and a3 and a4 prefer s2 to s3 to s1 . Schools have a common priority ranking
a3    a4    a1      a2 .

If all schools apply the regular reserves-and-quotas rule, DA will proceed as follows:
Step 1. Applicants a1 and a2 apply to s1 . The school accepts a1 and rejects a2 . Applicants
a3 and a4 apply to s2 . The school admits a3 and rejects a4 .
Step 2. Applicant a2 applies to s2 . The school's single seat is reserved for a2 , therefore the
school accepts a2 and rejects a3 . Applicant a4 applies to s3 and is accepted by the school.

Step 3. Applicant a3 applies to s3 and is accepted by the school.

The assignment is finalized at µ(a1 ) = s1 , µ(a2 ) = s2 and µ(a3 ) = µ(a4 ) = s3 . There are
four priority violations instances at µ: (a3 , s1 ), (a4 , s1 ), (a3 , s2 ) and (a4 , s2 ).

Now suppose s1 accepts a2 instead of a1 in Step 1 of DA. Then, in Step 2, a1 would apply
to s3 and a3 and a4 would apply to s2 . The latter would reject a4 , who would apply and get
assigned to s3 at Step 3. The resulting assignment would be µ (a1 ) = µ (a4 ) = s3 , µ (a2 ) = s1

                                                         32
and µ (a3 ) = s2 , which is reserves-respecting and non-wasteful (and within-type priority
compatible). There are only three priority violation instances at µ : (a1 , s1 ), (a3 , s1 ) and
(a4 , s1 ).

Example 4 (Relaxing Common Priorities). Suppose A = {a1 , a2 , a3 , a4 }, S = {s1 , s2 , s3 },
qs1 = qs2 = 1, qs3 = 4,T = {t1 , t2 , t3 },  (a1 ) = t1 =  (a2 ) = t2 =  (a3 ) =  (a4 ) = t3 , rt2 s2 = 1
and reserves are zero otherwise. All applicants prefer s1 to s2 to s3 . School s1 's priority
ranking is a1    s1   a2   s1   a3   s1   a4 , s2 's priority ranking is a1   s2   a3   s2   a4   s2   a2 , and s3 's
priority ranking is arbitrary.

If all schools apply the regular reserves-and-quotas rule, DA will proceed as follows:
Step 1. All applicants apply to s1 . The school accepts a1 and rejects the rest.
Step 2. All rejected applicants apply to s2 . The schools' single seat is reserved for a2 .
Therefore, the school admits a2 and rejected the rest.
Step 3. a3 and a4 apply to s3 , and both are accepted.
The assignment is finalized at µ(a1 ) = s1 , µ(a2 ) = s2 and µ(a3 ) = µ(a4 ) = s3 . There are two
priority violations instances at µ: (a3 , s2 ) and (a4 , s2 ).

Now suppose s1 accepts a2 instead of a1 in Step 1 of DA. Then, in Step 2, a1 would apply
to s2 and get accepted by the school. In Step 3 a3 and a4 would apply to s3 . The resulting
assignment would be µ (a1 ) = s2 , µ (a2 ) = s1 and µ (a3 ) = µ (a4 ) = s2 , which is reserves-
respecting and non-wasteful (and within-type priority compatible). There is a unique priority
violations instance at µ : (a1 , s1 ).




                                                        33
