                              NBER WORKING PAPER SERIES




          REVEALED PREFERENCE ANALYSIS OF SCHOOL CHOICE MODELS

                                        Nikhil Agarwal
                                        Paulo J. Somaini

                                       Working Paper 26568
                               http://www.nber.org/papers/w26568


                     NATIONAL BUREAU OF ECONOMIC RESEARCH
                              1050 Massachusetts Avenue
                                Cambridge, MA 02138
                                   December 2019




We thank Yinghua He, Margaux Luflade, Yusuke Narita and Peng Shi for helpful comments. A
special thanks to Parag Pathak for his contributions to the research described in this article, and
for his collaboration and guidance. Agarwal acknowledges the support from the Alfred P. Sloan
Foundation (FG-2019-11484). The views expressed herein are those of the authors and do not
necessarily reflect the views of the National Bureau of Economic Research.

NBER working papers are circulated for discussion and comment purposes. They have not been
peer-reviewed or been subject to the review by the NBER Board of Directors that accompanies
official NBER publications.

© 2019 by Nikhil Agarwal and Paulo J. Somaini. All rights reserved. Short sections of text, not to
exceed two paragraphs, may be quoted without explicit permission provided that full credit,
including © notice, is given to the source.
Revealed Preference Analysis of School Choice Models
Nikhil Agarwal and Paulo J. Somaini
NBER Working Paper No. 26568
December 2019
JEL No. D47,I21

                                         ABSTRACT

Preferences for schools are important determinants of equitable access to high-quality education,
effects of expanded choice on school improvement and school choice mechanism design.
Standard methods for estimating consumer preferences are not applicable in education markets
because students do not always get their first choice school. This review describes recently
developed methods for using rich data from a school choice mechanism to estimate student
preferences. Our objectives are to present a unifying framework for these methods and to help
applied researchers decide which techniques to use. After laying out methodological issues, we
provide an overview of empirical results obtained using these models and discuss some open
questions.


Nikhil Agarwal
Department of Economics, E52-460
MIT
50 Memorial Drive
Cambridge, MA 02142
and NBER
agarwaln@mit.edu

Paulo J. Somaini
Stanford Graduate School of Business
Knight Management Center
655 Knight Way E372D
Stanford, CA 94305
and NBER
soma@stanford.edu
                                                                                                               2

1       Introduction
Empirical models have been used to study a wide range of questions including socio-economic
heterogeneity in preferences for schools, allocative and redistributive effects of school choice,
determinants of unequal enrollment at high-quality schools and schools' incentives to im-
prove quality. This literature has been spurred by increasingly available administrative data
on school and college applications, especially from settings that use formal school choice
mechanisms. Detailed knowledge of the rules used to assign students combined with micro-
data from applications to assignments provide a unique window into determinants of school
demand.
But estimating these models also requires methods that are well-tailored to the specific
institutional details. Unlike traditional consumer settings, education markets typically do
not use prices as the main clearing mechanisms ­ public schools do not levy tuition, and
universities do not increase their tuition until the number of students that seek admission
exactly equals planned enrollment. Empirical approaches for estimating student preferences
must therefore be sensitive to the systems for rationing or admitting students to public
schools and colleges.
This review article develops a unified framework for analyzing empirical models of student
preferences for schools and provides a brief overview of empirical results based on these
models.1 We hope to both guide applied researchers in their modeling decisions and to
present some open issues.
Empirical school choice models are specific about how student preferences translate to de-
cisions or outcomes. The researcher either observes the decisions, such as a rank-order lists
submitted to a choice mechanism, or outcomes, such as final enrollment. These decisions and
outcomes are endogenously determined and, as in other settings with interacting agents, also
influenced by the behavior of other agents. The objective is to use data on these endogenous
variables to estimate the distribution of student preferences and study how it depends on the
sets of student and school characteristics observed in the data.
This revealed preference approach is directly motivated by the real-world influence of the
theory of school choice mechanisms in practical design. These designs use students' stated
preferences in order to find fair and efficient assignments. Their success therefore depends
on the ability to extract information about preferences, and places trust in the decisions that
students and parents make. This same ability and trust provides a basis for the revealed
preference approach that we develop in this article.
    1
    A separate literature uses quasi-experimental variation embedded in school assignment mechanisms to
study the causal effects of attending particular school types (see Hastings et al., 2009; Deming, 2011; Ab-
dulkadiroglu et al., 2011a, 2017a). In the interest of space, our review does not discuss these studies, although
they represent an important and innovative use of school assignment data. We believe that combining this
quasi-experimental variation with empirical models of choice is a fruitful avenue for future research.
                                                                                           3

The most appropriate method for this task depends on the available data and the model of
behavior that best suits the empirical setting. For example, a researcher needs to specify
whether or not parents and students understand the mechanism and report their preferences
truthfully. Once a model of behavior has been specified, a revealed preference argument
can be used to make inferences on preferences from data on student decisions or outcomes.
Such arguments must be tailored to the available data, the school choice mechanism used
to assign students and assumptions on student behaviour. In some cases, for example when
rational expectations is in doubt, it may be necessary to collect further information. The
differences in the most suitable approach emphasize the need for models that are sensitive
to the institutional environment.
The revealed preference arguments directly suggest estimation methods. Most models provide
a (non-parametric) likelihood function. In other cases, we obtain bounds on the likelihood.
An applied researcher can use this information to estimate the parameters of a preference
model. Available estimators range from classical maximum likelihood or method of moments
to likelihood-based Bayesian methods or moment inequalities. Yet certain estimators are bet-
ter suited to specific versions of the model. We discuss the trade-offs between computational
convenience and the microeconomic properties of the parametric and economic assumptions
before describing some remaining challenges.
After laying out the methodological approaches, we discuss the research on empirical ques-
tions for which school choice models are important. An extensive literature that is not
easily summarized, studies education policy issues, including equitable access to schools and
whether school choice encourages school improvement (see Hoxby, 2003, for a survey). Esti-
mates of student preferences allow us to better understand whether inequality results from
residential location or heterogeneity in choices conditional on location, and whether choices
are sensitive to school value-added. These estimates also speak to whether school choice
can push schools to improve: a finding that students would not flock to higher value-added
schools under greater choice would weigh against such an argument.
A separate theoretical literature focuses on the student assignment problem, studying trade-
offs among efficiency, fairness and incentive properties (Abdulkadiroglu and Sonmez, 2003).
Such research has found mechanisms that are on the frontier of managing these trade-offs.
This literature has had a large practical impact, resulting in several theory-based school
choice reforms (see Pathak, 2017).
Empirical school choice models provide a complementary quantitative counterpart by analyz-
ing which trade-offs are most important. Such a data-driven approach is particularly attrac-
tive when theory does not yield tractable or unambiguous answers. The empirical literature
has shown which trade-offs have proven to be quantitatively large and has identified further
areas of potential improvement. This progress has been primarily based on a model in which
students make optimal choices, though a more recent push has been made towards relaxing
this assumption with empirical approaches that incorporate surveys or weaker restrictions on
                                                                                                      4

behavior. The recent approaches hold the promise of improving our understanding of how
students interact with formal school choice mechanisms.
This literature uses estimated preferences for both positive and normative analyses. The
ability to make welfare statements requires the assumption that students and parents are
well-informed about the characteristics of various schools in the district and a social welfare
function. But, even without these two assumptions, estimated preferences may continue to
be useful for predicting assignments under alternative systems if the information about school
characteristics is held fixed.
This review is structured as follows. Section 2 lays out the random utility model that will
be used throughout the paper and describes two illustrative choice mechanisms. Section 3
deploys a unified framework to present revealed preference approaches for uncovering infor-
mation on preferences. The arguments depend on the data, the school choice mechanism and
the desired model of behavior. Section 4 discusses identification of the model, parametric
assumptions, and methods for testing and estimation. Section 5 reviews empirical findings.


2       Model
We consider a school assignment mechanism in which students indexed by i  I are assigned
to schools indexed by j  J = {1, . . . , J }. Denote the outside option with school 0. Each
school has qj seats, with q0 = .


2.1     Preferences

Student preferences are specified using a random utility model. Specifically, student i's
(indirect) utility for assignment to school j is given by vij . The typical objective is to
identify and estimate the joint distribution of the vector of random utilities vi = (vi1 , . . . , viJ )
conditional on a set of observable characteristics. Let vi0 denote the utility of the outside
option or a default school.
A common approach (Abdulkadiroglu et al., 2017b, for example) is to specify a distance-
metric utility function
                          vij = v (xj , zi , j , i , ij ) - dij ,                   (1)
where xj is a row-vector of characteristics for school j observed in the dataset, zi is a column-
vector of student i's observed characteristics, j is a school-specific unobserved characteristic,
i is a column-vector capturing student-specific idiosyncratic tastes for program characteris-
tics and ij captures idiosyncratic tastes for programs.2 In the absence of tuition payments
    2
    Recent results in Allen and Rehbeck (2017) show how to generalize this specification to allow for a
separable, but non-linear specification for distance.
                                                                                                             5

in the public school context, this specification quantifies preferences for schools in terms of
"willingness to travel." The additive separable form in distance with a normalized co-efficient
embeds a scale normalization. In addition to quasi-linearity, this particular specification also
assumes that, all else equal, distance to school is undesirable.
The model also needs a location normalization. If the model includes an outside option, then
it is common to normalize vi0 = 0. Studies that omit the outside option must impose an alter-
native location normalization on the mean utility for a reference school (see Abdulkadiroglu
et al., 2017b, for example).
Further, existing approaches for identification and estimation impose the assumption that

                                      (i , i )  dij |zi , {xj , j }J
                                                                   j =1 ,


where i = (i1 , . . . , iJ ). It assumes that unobserved tastes for schools are conditionally
independent of distance to school given observed student and school characteristics as well
as school unobservables. This assumption is violated if students systematically reside near
the schools for which they have idiosyncratic tastes. The approach may provide reasonable
approximations in settings with rich micro-data on students. Nonetheless, relaxing this
assumption to incorporate residential sorting is a fruitful avenue for future research.
In addition, parametric assumptions on the functional form for v (·) and the distribution of
the unobserved preference terms (i , ij ) enable computational tractability and assist estima-
tion in finite samples. The most convenient forms depend on the mechanism analyzed, the
estimation method and the size of the choice set. One tractable and flexible parametric form
assumes that
                                         j

                                                  zi + i ) - dij + ij ,
                               vij =xj  + j +xj (¯                                                         (2)
where i and ij have distributions known up to finite dimensional parameters and               ¯ is a
matrix conformable with xj and zi . We collect these and the other unknown parameters of
the model, namely (,    ¯ , 1 , . . . , J ) and parameters governing the distribution of ij , in the
vector . The revealed preference and identification results described below are for the more
general specification in equation (1) and are applicable to alternative parametrizations.3
The model includes three implicit restrictions. First, a student's utility only depends on their
own assignment, and not the assignment of others. This rules out preferences for attending
school with specific peers. It is possible to include statistics describing the students enrolled
at school j in previous years within xj to capture preferences for student body composition.
   3
    Although the identification results discussed below pertain to the distribution of vi conditional on school
fixed effects j and the observables xj , zi and di , most empirical approaches estimate  using a parametric
form similar to the one in equation (2). Strictly speaking, showing identification of  requires that the
representation of any conditional distribution of vi is unique in this parametric family. This issue is beyond
the scope of this paper, although it has been studied for general random utility models.
                                                                                                         6

However, with rare exceptions (Epple et al., 2018, for example), existing empirical approaches
abstract away from equilibrium sorting based on preferences for peers.
Second, welfare statements based on the willingness to travel metric make inter-personal
comparisons of utility in a non-transferable unit of measurement. This property prohibits
justifying utilitarian welfare metrics based on the Kaldor-Hicks criterion. Nonetheless, it is
possible to evaluate the proportion of students who prefer various mechanisms or assignments
without making interpersonal comparisons of utility.
Finally, the model abstracts away from costs of acquiring information about schools and
typically assumes that preferences are well formed. An exception is Narita (2018), which
considers the possibility that preferences evolve after students receive an initial assignment.


2.2     School Choice Mechanisms

Centralized school choice mechanisms match students to schools using priorities or exam
scores and applications in the form of a ranked list of schools. Let Ri  R denote student i's
submitted rank-order list, where Rik denotes the school ranked in position k . The mechanism
can restrict the number of schools that a student can rank. Denote student i's priority or
exam score for the various schools with the vector ti = (ti1 , . . . , tiJ )  T . The priority groups
may be fine so that tij  R or coarse so that tij takes on finitely many values. In the latter
case, a tie-breaker is usually used to order students with the same priority score. We assume
that priority type captures all aspects that differentiate two students from the perspective of
the mechanism, except for the tie-breaker.
                                           N
A mechanism  : RN × T N  J                maps the tuple (R, t) = ((R1 , . . . , RN ) , (t1 , . . . , tN ))
containing all students' rank-order lists and priorities to assignments, µ. If the mechanism is
does not have a tie-breaking lottery, then the assignment µ specifies the school (if any) where
each student is placed. Its i-j -component, denoted µij , is set to 1 if student i is assigned to
school j and 0 otherwise. This assignment is produced using the rank order list submitted by
each student together with their priorities and tie-breakers. When the mechanism includes
a tie-breaker, the i-j -component of the assignment µij is the probability that i is assigned to
j conditional on (R, t). We assume that the mechanism  produces a feasible matching so
that no school is assigned more students than its capacity, that is, i µij  qj for all schools
j .4
We assume that the analyst knows the mechanism used and that each student's priority
type ti is observed. The most suitable approach for estimating the model will depend on
the available data and the properties of the mechanism in use. In some cases, it is sufficient
   4
    In the case when a tie-breaker is used, the assignment µ is a convex combination of assignments µk in
which for each k , the i-j -component, µk
                                        ij is either zero or one.
                                                                                               7

for the analyst to observe the assignment µ, and not the underlying rank order lists R. We
discuss each case in detail in the following sections.
The formulation makes two implicit assumptions that can be directly verified based on knowl-
edge of the mechanism. All school choice mechanisms that we are aware of satisfy both these
properties. First, assignments do not directly depend on the utilities vi ; indeed, assignments
only depend on the submitted rank order lists and priorities (Ri , ti ). This assumption can be
verified based on the knowledge of the district's student assignment mechanism. Of course, a
student's rank-order list may not reflect their true preferences. Second, the mechanism treats
any two students of the same priority-type symmetrically, which implies equal treatment of
equals.

Example 1. (Student-Proposing) Deferred Acceptance Mechanism. This popular
school choice mechanism is based on the celebrated Deferred Acceptance Algorithm from
Gale and Shapley (1962) and uses submitted rank-order lists to assign students using the
following procedure:

Step 0:     If priorities are coarse so that two students may be tied at a school, then a tie-
            breaker i is generated. This tie-breaker can either be a single number that is
            applied to all schools or a vector of school-specific tie-breakers.

Step 1:     Each student i applies to their highest ranked school Ri1 . At each school j , appli-
            cations from students with the highest priority for that school, up to the capacity
            qj , are tentatively held. Ties between students, if any, are resolved according to
            the value of i generated in step 0. The schools reject the remaining students.

Step k > 1: In a general step k , students whose applications were rejected in step k - 1 apply
           to their highest-ranked school that has not yet rejected them. At each school j ,
           the previously held applications are considered along with students who apply
           in round k . The highest-priority students' applications, up to capacity, are ten-
           tatively held, with ties resolved according to the value of i generated in step 0.
           The remaining applicants are rejected.

            The algorithm terminates in step k if no students are rejected or if all rejected
            students have applied to each of their ranked schools. Student assignments µij
            are finalized at the schools where their applications are currently held if either
            terminal condition is satisfied. Otherwise, the algorithm proceeds to step k + 1.

It will be useful to incorporate student i 's priority at school j into the score eij . In the
Deferred Acceptance (DA) mechanism, the score eij is determined by a function fj (ti , ij )
that depends lexicographically on priority ti and tie-breaker ij . Abdulkadiroglu et al. (2015);
Azevedo and Leshno (2016) show that the DA generates an allocation determined by a vector
                                                                                              8

of cutoff priorities pj such that each student i is allocated to the highest-ranked school for
which eij  pj . The cutoff is set so that (i) no school has more students than it has capacity
for and (ii) no student who desires an assignment at school j is denied one unless the school
is full.
It is easy to see that these two properties are satisfied if the cutoff for school j is given by
the student with the lowest score that is assigned to the school if the school does not have
spare capacity and the lowest possible score otherwise. With this definition for the cutoffs
pj , each student is assigned to the highest-ranked school in the set

                                   S (ei , p) = {j : eij  pj } .

This set consists of the schools for which a student with the score ei is eligible.
The student-proposing DA has two theoretically appealing properties. First, it is strategy-
proof (Dubins and Freedman, 1981); that is, submitting a rank-order list that coincides with
one's ordinal preferences is a weakly dominant strategy. Second, the resulting assignment
is stable if students submit truthful reports. In this context, stability requires that there is
no student i and school j such that: (i) i strictly prefers j over the school to which they
is assigned and (ii) if school j does not have spare capacity, then i has a higher score than
another student assigned to j .
Example 2. Immediate Acceptance Mechanism (also known as the Boston Mech-
anism)

Step 0:     If student priority types are coarse so that two students may be tied at a school,
            then a tie-breaker i is generated. This tie-breaker can either be a single number
            that is applied to all schools or a vector of school-specific tie-breakers.

Step 1:     Each student i applies to their highest-ranked school Ri1 . At each school j , the
            students with the highest priority for that school, up to the capacity qj , are
            assigned. Ties between students, if any, are resolved according to the tie-breaker
            generated in step 0. The schools reject the remaining students. The remaining
            capacities of schools with fewer applications than capacity are computed and
            stored in qj 1 .

Step k > 1: In a general step k > 1, students whose applications were rejected in step k - 1
           apply to the school ranked Rik . At each school j , the students with the highest
           priority for that school up to the capacity remaining after step k - 1, denoted
           qjk-1 , are assigned. Ties are resolved according to the tie-breaker in step 0.
           The remaining applicants are rejected. The remaining capacities of schools with
           fewer assigned students than total capacity are computed and stored in qjk . The
           algorithm terminates in step K , denoting the maximum number of schools that
           can be ranked by a student.
                                                                                                   9

The Immediate Acceptance (IA) mechanism also has a pivotal student who is rejected from
a school. The pivotal student's score determines the cutoff pj for that school. However, in
IA, the score eij is equal to fj (Ri , ti , ij ) where fj is a lexicographic function of the position
in which school j appears in the report Ri , followed by the priority ti and finally the tie-
breaker. Agarwal and Somaini (2018) show that this mechanism also assigns students to the
highest-ranked school in the set S (ei , p). Unlike DA, this set depends both on the cutoffs p
and directly on rankings submitted by the student through ei .
An important difference between the DA and IA is that the latter prioritizes students based
on submitted rank-order lists. Specifically, a student who ranks a school higher than does
another student effectively receives priority over the latter. This feature of the mechanism
generates incentives to manipulate rankings, as it is in each student's interest to avoid ranking
too many competitive schools. Moreover, students have an incentive to "cash" their neigh-
borhood or sibling priority if the school is competitive by ranking it highly lest the school
be over-subscribed by the time students that rank it second or third are considered. As a
result, IA is not strategy-proof and may not produce a stable assignment even if students
report their preferences truthfully.
In fact, many other commonly used school choice mechanisms can be represented in this
fashion. Agarwal and Somaini (2018) define a large class of mechanims called Report-Specific
Priority + Cutoff mechanisms. As the name suggests, these mechanisms use the submitted
report to modify a student's priority. In general, eij = fj (Ri , ti , ij ) where the function
fj modifies the priority ti depending on the report Ri , and ij is the tie-breaker for school
j . Each school has a cutoff priority, denoted pj , and each student is placed in the highest-
ranked school in the set S (ei , p) = {j : eij  pj }. The cutoff is set so that (i) no school
has more students than it has capacity for and (ii) no student who desires an assignment
at school j is denied one unless the school is full. Other mechanisms that belong to this
class include Serial Dictatorship; the Chinese Parallel Mechanism (Chen and Kesten, 2013);
the Pan London Admissions Scheme (Pennell et al., 2006); First-Preferences, first used in
England (Pathak and Sonmez, 2008); the Taiwan assignment mechanism (Dur et al., 2018)
and the New Haven mechanism (Kapor et al., 2017). Each mechanism differs in the use of a
different function fj for the score.



3     Approaches to Revealed Preference Analysis
In this section, we discuss how to use properties of the school choice mechanism and as-
sumptions on behavior to interpret data on assignments or reports. First, we consider the
implications of data on assignments under the assumption of stability. Second, we examine
data on truthfully reported rank-order lists. Finally, we discuss how to interpret reports in
strategic environments under various behavioral assumptions.
                                                                                                10

3.1    Using Stability
In many settings, it may be reasonable to assume that the final assignment is stable. This
assumption yields useful revealed preference relations based only on assignment data and
allows some flexibility regarding the mechanism and behavioral assumptions that generate
the assignments. The arguments require that the researcher and the student both know their
(ex-post) eligibility scores eij for each student and school, that these scores do not depend
on submitted reports or lotteries, and that the school cutoffs pj are predictable by both
students and schools. This assumption simplifies the analysis relative to approaches that
must simultaneously estimate preferences for both sides of the market (see Agarwal, 2015;
Menzel, 2015; Diamond and Agarwal, 2017, for example).
This approach is used by Fack et al. (2019) to study high school admissions in Paris, which
are determined by a deferred acceptance mechanism, and by Akyol and Krishna (2017) to
study Turkish high schools that use an entrance exam to make admissions decisions. This
assumption can also be used to study higher education settings that use a single centralized
exam. For example, Bucarey (2018) uses stability to estimate preferences for colleges in
Chile.
Assuming that assignments are stable, if student i is assigned to school j , then we can infer
that vij > vij for every other school j in i's choice set S (ei , p) = {j : eik  pj }. This follows
because each student is assigned to their most preferred option for which their eligibility
score eij exceeds the cutoff pj .
To see what can be learned using this assumption, consider an example with only two schools,
1 and 2, and an outside option 0. Figure 1 shows five different regions of utilities denoted
by Roman numerals. Each region implies different ordinal preferences except for region V,
which pools the cases when vi0 > vi1 > vi2 and vi0 > vi2 > vi1 . A student who is eligible
in both schools will be assigned to school 1 if their utilities belong to either region I or II.
Therefore, the share of students assigned to school 1 amongst those eligible for both schools
is an estimate of the total probability accumulated by the distribution of v in regions I and
II. Similarly, the share assigned to school 2 is an estimate of the total probability in regions
III and IV.
A student eligible only for school 1 can either be assigned to that school or remain unassigned.
In the former case, we can infer that vi0 < vi1 which is the darkly-shaded region in figure 2.
In the later case, we infer vi1 < vi0 which is shaded lightly. The share of students assigned
to school 1 amongst these students is an estimate of the total probability in regions I, II and
III of figure 1.
These arguments are similar to those for standard discrete choice models but differ crucially
in that not all students are assigned to their first choice schools. In standard discrete choice
models, the fraction of consumers that buy good j equals the fraction of consumers for which
good j provides the highest utilities. In this context, student choice sets are constrained
                                                                     11
      Figure X



                                     2

                        IV                        III

                                 Assigned to 2


                                                  II

                                         (0,0)                   1
                                                 Assigned to 1
                     Assigned to 0

                         V                         I




   Figure 1: Revealed Preferences ­ Stability ­ Full Choice Set
      Figure X



                                     2




                                          Assigned to 1
                 Assigned to 0

                                         (0,0)                   1




Figure 2: Revealed Preferences ­ Stability ­ Restricted Choice Set
                                                                                                       12

by their eligibility, making this implication invalid. It is important to apply the revealed
preference argument conditional on the set of schools that each is eligible for.
Assignments provide no information about preferences for schools that are not in a student's
choice set. Learning about the full distribution of ordinal preferences for students with a
priority score of ei will require extrapolation, by using data from students with larger choice
sets. Fack et al. (2019) perform this extrapolation by assuming that unobserved determinants
on preferences in equation (1) are conditionally independent of the eligibility score given the
observables included in the model. Formally, the assumption requires that

                                   (i , i )  ei |zi , di , {xj , j }J
                                                                    j =1 .


The assumption may be a reasonable approximation if zi contains a rich set of student
characteristics but can be violated, for example if eligibility scores are correlated with both
unobserved student ability and unobserved preference parameters.
Under these assumptions, it is in fact possible to recover the distribution of ordinal preferences
in the two school case. To consider this, it is illustrative to continue the two-school example
detailed above. We obtained estimates of the probabilities of regions I, II , III and IV by
adding up the share of students that were assigned to schools 1 or 2 conditional on having
a full choice set. We also obtained an estimate of the probability of regions I, II and III by
calculating the share of students assigned to 1 when only school 1 was in the choice set. The
difference between these two probabilities is therefore an estimate of the probability of region
IV. This argument can be repeated to obtain the probability mass in each of the five regions
that partitions the space of utilities. While this argument shows identification of ordinal
preferences in the two school case, a general result describing what can be learned in settings
with more schools is open for future research.


3.2     Truthful Reports

An important goal in the theoretical literature on school choice is to design mechanisms that
are strategy-proof (Abdulkadiroglu and Sonmez, 2003). In such a mechanism, no student can
benefit by submitting a list that does not rank schools in order of their true preferences. One
motivation for this objective is to level the playing field among agents who are sophisticated
and sincere in their behavior (see Pathak and Sonmez, 2008). Strategy-proofness of a school
choice mechanism can also assist an empirical strategy if agents understand it and follow this
recommendation.5 Specifically, if j = Rik and j = Rik are the schools ranked in positions k
   5
     Evidence from both experiments and the field suggests that students are more likely to report their
preferences truthfully when interacting with a strategy-proof mechanism (Chen and Sonmez, 2006; de Haan
et al., 2016). Nonetheless, comprehending that a mechanism is strategy-proof may be complicated (Li, 2017)
and some students are liable to mistakenly submit rankings that are not truthful (Hassidim et al., 2016;
Shorrer and Sovago, 2017; Rees-Jones, 2018).
                      Figure X
                                                                                                            13


                                                      2


                                                           Rank 2 > 1


                                      Rank 2 only                         Rank 1 > 2



                                                          (0,0)                        1
                                     Do Not Rank
                                                                  Rank 1 only




                        Figure 3: Revealed Preferences ­ Truthful Reports

and k , respectively, then we can infer that

                                                 vij > vij .

It is less clear how to treat schools that are not ranked on the list. One approach is to assume
that students rank all schools that are acceptable, i.e. preferable to the outside option. In
this case, if j is the lowest-ranked school, then vij > vi0 > vij if j is not ranked.6 In this
model, the various rank-order lists partition the space of utilities, as shown in figure 3, for
when J = 2. The five regions in the figure correspond to the various ways in which two
schools can be ranked when including the possibility that only one school or an empty list is
submitted.
Observe that the rank-order lists provide richer information about preferences than can stan-
   6
     An alternative is to avoid a revealed preference comparison between the ranked schools to the outside
option (see Abdulkadiroglu et al., 2017b, for example). In this case, the researcher does not include an
outside option in the model and therefore, does not assume that vij < vi0 if j is not ranked. Instead, if j is
ranked and j is not, then the researcher only deduces that vij > vij . Fack et al. (2019) distinguish between
these two approaches. Specifically, they term this alternative weak truth-telling (WTT) and call the baseline
described in the main text strict truth-telling (STT). WTT is justifiable if either the number of schools that
can be ranked is exogenously given, or if a student ranks schools up to the point that the probability of being
rejected by all the ranked schools is zero. However, WTT is violated if the rank order list is truncated at
the point that the next best school is less preferable to the outside option. The arguments in the main text
apply with minor modifications to the WTT case after the outside option has been removed from the choice
set.
                                                                                              14

dard discrete choice models in which a consumer picks only their favorite product. Specif-
ically, if a consumer picks option 1 in a standard discrete choice setting, then we can only
deduce that the consumer's utilities are in either the region labelled "Rank 1" or "Rank 1>2"
in figure 3, but we cannot distinguish between these two regions. The richer information in
ordered lists can help identify heterogeneity in preferences (Beggs et al., 1981; Berry et al.,
2004). In the school choice context, students often rank many more schools, allowing for
very rich specifications for the distribution of utilities (see Abdulkadiroglu et al., 2017b, for
example). Allowing for such heterogeneity is important for accurately estimating the value
of improving assignments.
Assuming that agents report their true preferences can be justified for DA on theoretical
grounds if there is no limit on the number of schools that a student can rank and all students
have a non-zero chance of getting assigned to any of the ranked schools. Otherwise, it may
be optimal for the student to omit some schools from their rank-order list (Haeringer and
Klijn, 2009). It is straightforward to modify the approach to restrict attention to the set
of schools for which each student is eligible. This modification assumes that the students
understand this is the precise set of schools for which they may be eligible. But even in this
case, students may optimally avoid ranking too many competitive schools if the number of
schools that can be ranked is small.
To avoid relying on truth-telling, Fack et al. (2019) argue that assuming stability is more
robust than assuming truthful preference reporting when rank-order list length is limited.
They argue that stability is particularly attractive if the number of students is large relative
to the number of schools. In this case, they show that the uncertainty in the cutoffs p is
small, allowing the students to very accurately predict the set of schools for which they
will be eligible. If students behave optimally, only a negligible fraction of students will not
be assigned to their most preferred option in the feasible set. At the same time, students
will not list schools that are very unlikely to be acheivable, generating significant biases in
approaches based on truthful reporting. Artemov et al. (2017) formalize this point by showing
that stability is a robust equilibrium prediction even when agents do not report truthfully
because many of these apparent "mistakes" may not affect final assignments. This theory is
consistent with the finding that most of the "mistakes" identified in the literature (Hassidim
et al., 2016; Shorrer and Sovago, 2017; Rees-Jones, 2018) do not have a substantial impact
on final assignments because most students only omit options that they were unlikely to be
assigned to in any case. Of course, relying on stability alone has the drawback of providing
less information on preferences and requiring the stronger assumptions for extrapolation
discussed in the previous subsection.
                                                                                              15

3.3     Strategic Behavior

The previous subsections developed empirical approaches for the specific cases in which either
the submitted rank-order lists are truthful or the final assignments are stable. However, there
are many school districts that do not use strategy-proof or stable matching mechanisms. For
example, the commonly used Immediate Acceptance mechanism prioritizes students who rank
a school higher on their list and rewards strategic behavior. Evidence from the laboratory and
real-world examples suggests that students do respond to these incentives. This observation
has been made in lab studies (Chen and Sonmez, 2006), using survey data (de Haan et al.,
2016) and using signs of strategic reporting in administrative data (Agarwal and Somaini,
2018).
This section generalizes the approaches discussed above to accomodate such assignment mech-
anisms. The cases of truthful reporting and stable outcomes are special cases. The approach
is first developed using a model in which agents behave according to a Bayesian Nash Equi-
librium. Given that this approach accords a high degree of agent sophistication, an active
literature attempts to introduce models with behavioral biases and heterogeneous ability to
game the system. We discuss these extensions after developing the baseline approach based
on equilibrium play.


3.3.1   Beliefs and Behavior

In the baseline model, agents have private information about their preferences and rational
beliefs about their chances of getting assigned to various schools as a function of the sub-
mitted rank-order list. Agents know the mechanism being used and correctly conjecture the
distribution of reports submitted to the mechanism by other agents. Dropping the depen-
dence on the priority type ti for notational simplicity, an agent with utility vector vi follows
the strategy  (vi )  R. The agent's belief in this case are given by

                        LRi = E [ (Ri , R-i ) |Ri ,  ]
                            =      (Ri , R-i )          Ri (vi ) fV (vi ) dv-i ,             (3)
                                                 i =i


where fV is the probability density function (PDF) of the vector of utilities, and R (v ) is
the probability that an agent with utility vector v submits rank-order list R. The term
Ri (vi ) fV (vi ) denotes the PDF that agent i submits the report Ri . This formulation
implicitly assumes that agent preference-types are independent and identically distributed
from the perspective of agent i.
By varying the rank-order list, an agent can implicitly choose different assignment probabili-
ties. Given an utility vector vi , the expected utility from submitting the rank-order-list Ri is
                                                                                               16

vi · LRi . We assume that each agent submits the report that maximizes her expected utility.
That is, agent i report Ri only if

                                         vi · LRi  vi · LR                                     (4)

for all R  R. Below, we develop an empirical strategy based on this revealed preference
inequality.
This formulation is based on assuming that agents understand the rules of the mechanism
and the competitive environment they face. Uncertainty in assignment arises both because
of the tie-breaker, if any, and reports about other agents in the marketplace. As discussed
in section 2.2, many mechanisms admit lower-dimensional statistics such as school-specific
eligibility thresholds that suffice for forming expectations about assignment probabilities (see
Azevedo and Leshno, 2016; Agarwal and Somaini, 2018).


3.3.2     A Revealed Preference Argument

An important step in the revealed preference arguments in the previous sections was to derive
a set of utility types that are consistent with an observed outcome. Section 3.1 was based
on the assignment, while section 3.2 used the reported rank-order list. Agarwal and Somaini
(2018) uses equation (4) to provide a similar path forward in the case of strategic behavior.
We briefly explain this argument below.
Let CRi be the set of utilities for which the report Ri maximizes expected utility; that is,
vi · (LRi - LR )  0 for all R  R. Therefore, when student i submits the reports Ri , they
reveals that their utility vi belongs to the set CRi . Therefore, the rank order lists submitted
by the students can be used to estimate the fraction of students with preferences in each of
these regions. This implication will be used in the estimation methods described in section
4.
Figure 4 illustrates these sets for a simplified case with two schools. In this example, vR,R
represents utilities for which the student is indifferent between submitting R and R . Simi-
larly, a student with utilities given by vR,R is indifferent between R and R . The students
with utility vectors in the set CR (weakly) prefer R to the other reports.
Notice that each set CR in the figure is convex and defined by the utility vectors for which
an agent is indifferent between the report R and another report R . This structure is com-
putationally useful when estimating the model because the revealed preference sets can be
characterized using a small number of vectors. In fact, this structure generalizes to more than
two schools because it is implied by the linearity of the expected utility underlying equation
(4).7
  7
      The set CR is given by the convex cone   vi  RJ : vi · LRi  0 , where LRi is a J × (|R| - 1)
                     Figure X
                                                                                                    17


                                                  2
                                                           ,


                                                                 
                                           
                                                                        ,


                                                      (0,0)                    1


                                                                


                                             ,




                      Figure 4: Revealed Preferences ­ Strategic Behavior

3.3.3     Extensions

The equilibrium approach outlined above assumes that agents have correct forecasts about
the assignment probabilities in the year for which they submit their applications, but agents
may not be able to accurately predict these probabilities. For example, school districts may
publish only aggregate admissions chances that are not specific to a student's priority-type.
Moreover, the available statistics may derive from previous years' data. Motivated by these
concerns, Agarwal and Somaini (2018) estimate the model under two alternative assumptions
on belief formation: coarse beliefs and adaptive expectations.

Coarse Beliefs: In a model with coarse beliefs, agents do not understand the role of prior-
    ities in the mechanism. While subsumed in the notation, the probabilities in equation
    (3) depend on the priority-type ti . The coarse expectations model assumes that agent
    beliefs are given by
                                         LR =    st LR,t ,
                                                      t

        where st is the share of agents with priority type t and LR,t is the vector probable as-
        signments to the various schools when an agent of priority-type t submits the report R.
        Each of the assignment probabilities LR,t are computed as in the rational expectations
        case.
dimensional matrix with columns given by LRi - LR for R = Ri . This definition can be used to show that
CRi is a convex cone and int (CR  CR ) =  only if LR = LR .
                                                                                              18

Adaptive Expectations: In an adaptive expectations model, LR is computed using the
    distribution of reports from previous years, thereby substituting the term in equation
    (3) governing the distribution of reports, i =i Ri (vi ) fV (vi ), with the analogous
    quantities from the previous year.

An additional concern with the baseline approach based on equilibrium behavior is that not
all agents may have equally accurate perceptions of the mechanism and/or their admission
chances at various schools. This varied understanding leads to suboptimal behavior and vio-
lations of the revealed preference implications we have derived. Unfortunately, as we discuss
in section 4.5, testing for rational behavior is not possible in typical data environments.
Although we cannot test for it, the ability to game the system can also have distributional
consequences (see Pathak and Sonmez, 2008). Motivated by these concerns, some papers
have specified models in which agents vary in sophistication or have surveyed participants to
consider models with a distribution of beliefs for the assignment probabilities LRi .

Heterogeneous Sophistication: Specifically, motivated by the theoretical framework of
    Pathak and Sonmez (2008), Calsamiglia et al. (2017) and Agarwal and Somaini (2018)
    consider models in which agents are either sincere or sophisticated. Sincere agents
    report their preferences truthfully even though it is suboptimal to do so while sophis-
    ticated agents correctly understand the assignment probabilities LR . One could also
    consider adding more behavioral types, for example, agents with adaptive expectations.
    The assignment probabilities associated with each behavioral type can be computed fol-
    lowing the type-appropriate procedures.

Eliciting Beliefs about Assignment Probabilities: One disadvantage of the aforemen-
      tioned approaches is that the analyst must specify a belief formation model without
      direct empirical evidence on the most appropriate model in a given school district.
      Kapor et al. (2017) fill this gap by conducting extensive surveys that directly ask par-
      ticipants about their beliefs. Their results show that agents differ substantially in their
      understanding of both the mechanism and the competitiveness of various schools. The
      paper develops an empirical approach that combines survey responses about admis-
      sion chances and preference with administrative data to estimate both preferences and
      beliefs.


3.4    Incomplete Models of Behavior

The approaches described above are based models in which an agent's report or final assign-
ment is specified as a known function of the utilities. In the case of truthful reporting, the
rank-order lists include all schools starting from the most preferred to the least preferred.
In the case of strategic behavior, the utility vectors specify the optimal choice of assignment
                                                                                               19

probabilities LR . Finally, relying on stability is equivalent to eliciting a report consisting of
the most preferred school in the student's choice set. In all cases, we used a theoretical model
to derive restrictions on preferences.
A natural question is whether much of the preference analysis is possible under weaker as-
sumptions on behavior. He (2014) and Hwang (2016) develop approaches based on behavioral
assumptions that use a subset of intuitive restrictions of optimal or truthful behavior but
are less restrictive because they do not impose all implications. This approach results in an
incomplete model of behavior.
As an example, consider a district that uses the Immediate Acceptance Mechanism. Assume
that students have correct beliefs about which schools are more competitive than others. In
terms of the cutoffs described in section 2.2, students know which schools will have higher
ex-post cutoffs. That is, whether or not pj will exceed pj after the assignment has been
computed but not their precise values. For simplicity, assume that there are no priorities and
that either a single tie-breaker is used or tie-breakers for each school are drawn independently.
In this setting, it is not optimal for a student to rank a competitive school j above a less
competitive school j unless the student prefers school j to school j . The reason is that if
a student prefers j to j , then replacing j with j increases their chances of assignment at a
more preferred school. Therefore, if we observe student i rank school j in position k , then we
can infer that vij exceeds vij for all schools j that are less competitive than j and are either
ranked below j or unranked. But notice that the model only allows for partial comparions.
Specifically, if a competitive school j is not ranked, we cannot directly infer whether or
not vij exceeds vij if j is less competitive than j . Making this inference requires a model,
similar to the one developed in section 3.3, based on quantitative comparisons between the
competitiveness of schools j and j '.
Figure 5 illustrates an example with two schools, only one of which a student may rank. If a
student does not rank a school, then they is assigned to a default school other than these two.
In this example, school 2 is more competitive than school 1. A student who prefers only one of
these schools to the default option should only rank that school. This observation determines
the behavior for students with utility vectors in the lower-right or upper-left quadrants. The
model also has unambiguous revealed preference implications for agents who submit the null
rank: their vector of utility is in the lower-left orthant. The upper-right quadrant indicates
that if a student prefers school 1 over school 2, then they should rank school 1 because it
is less competitive and preferable. However, if school 2 is preferred over school 1, then the
model is silent about which school should be ranked. This makes the model incomplete as
defined by Tamer (2003) and Manski (1988).
We now derive a set of restrictions implied by revealed preference relations. This approach
adapts arguments from Ciliberto and Tamer (2009) and Pakes (2010). Specifically, consider a
model that defines a set of reports that a student can submit given their utility vi . We focus
                   Figure X
                                                                                              20

                                                2


                                                     Rank Either
                                Rank 2                 School


                                                            Rank 1

                                                    (0,0)                 1

                                No Ranks




                    Figure 5: Revealed Preferences ­ Incomplete Models

on models that do not place any other restrictions on (the frequency with) which reports are
chosen from within this set.
We say that report R is rationalizable for vi under the model if R belongs the set of permissible
                                                                                             
reports. Let CR be the set of utilities vi such that R is rationalizable for vi and let CR     be
                                                                                    
the set of utilities such that R is the only rationalizable report. By definition, CR is a subset
of CR .
In the example of figure 5, R1 or "rank 1" is rationalizable for the entire solid shaded area,
while R2 or "rank 2" is rationalizable by the entire hashed region. Both reports are permissible
                                                                            
for utilities in the intersection of the two regions. This implies that CR   2
                                                                               is the upper-left
quadrant and CR2 is the entire hashed region.
As opposed to the previous models, we only obtain partial information about preferences in
this case. Specifically, the fraction that report R is at least as large as the fraction with
                      
utilities in the set CR   because R is the only rationalizable report for students with utilities
in this set. And, the fraction that report R is no larger than the fraction of students with
utilities in the set CR , because students with utility vectors not in this set should not report
R. We will use this information to partially identify the parameters governing the preference
distribution.
                                                                                                21

4     Identification and Estimation
We now show how to use the arguments in section 3 to identify and estimate the random
utility model presented in section 2. Each approach for interpreting school choice data arrived
at restrictions on the vector of utilities implied by an agent's choice or assignment. Except for
the incomplete model of behavior, (almost) every utility vector corresponds to a unique report
or assignment. Specifically, we partitioned the set of utilities into regions {C1 , ..., CK }. Each
Ck is a convex subset defined by a collection of linear inequalities on vi so that Ck contains
all vectors of utilities that rationalize the report Rk (or assignment to school k ). This allows
us to determine the probability of the observed outcome or report given agent i's observable
characteristics and the model's parameters:

                                  P (vi  Ck |xj , zi , j , di ; FV ) ,                         (5)

where FV governs the distribution of utilities conditional on the covariates.
The incomplete model of behavior also yields similar restictions that we will further develop
later. But, the equality between the probability of observing report k and the expression
above does not hold because the model admits more than one possible choice for many
                                                                                     
vectors of vi . Nonetheless, as hinted at in the previous section, the sets Ck and Ck  bound
the expression in equation (5).
In all cases, the sets described above capture the available information about utilities from
reports or outcomes. Under stability, truthful reporting or the incomplete model discussed
above, the sets associated with each allocation or report can be derived directly from the
revealed preference arguments. If reports are strategic, as in the model developed in section
3.3, the sets Ck are constructed from assignment probabilities that need to be estimated.
This section proceeds by discussing how to estimate these probabilities and the sets Ck (and
  
Ck ) in a first step. Then, we discuss how to estimate the preference parameters for the
complete models of behavior in a second step. Finally, we consider incomplete models of
behavior.


4.1    Estimating Assignment Probabilities

The first objective is to estimate the vector of assignment probabilities LR for each report
R. Because these probabilities only depend on reports and the mechanism, these estimates
can be obtained separately from the preference parameters in most of the models discussed
earlier. We start by considering the case in which agents have correct beliefs about the
assignment probabilities. That is, we would like to estimate the assignment probabilities
from various reports in a Bayesian Nash Equilibrium.
                                                                                                       22

At first blush, this object is extremely high dimensional because LR is a J -dimensional
vector for each R and the number of possible reports is given by the number of ways J
schools can be ranked in K positions, where K is the maximum length of the rank-order
lists. However, the problem is much simpler for the class of Report-Specific Priority + Cutoff
mechanisms described in section 2. In these mechanisms, the probability that i is assigned
to j if i reports Ri is given by

                   LR,ti ,j = P (eij  pj and eij < pj if j is ranked above j ) ,

where eij = fj (R, ti , ij ) constructs the eligibility score by combining the report, student
priority and the tie-breaker. The dependence of LR on the priority-type ti has been re-
introduced for clarity.
The key unknowns in the expression above are the cutoffs pj because distribution of the
tie-breaker and the function f are known to the researcher. Agarwal and Somaini (2018)
develop a resampling estimator similar to those used in the auctions literature (Guerre et
al., 2000; Hortacsu and McAdams, 2010; Cassola et al., 2013) for this task. This estimator
constructs bootstrapped samples of students with their reports and priority draws in order to
compute an assignment and the corresponding cutoffs. This bootstrap distribution of cutoffs
is used to estimate LR . In a market with many students relative to the number of schools, the
cutoffs pj converge to a limit because aggregate uncertainty in the agents' submitted reports
vanishes and any given student has a negligible effect on the cutoffs. In any finite sample,
each student faces uncertainty because of their tie-breaker's draw and because of the specific
reports submitted by the other agents.8
Assignment probabilities for the cases of coarse expectations, adaptive expectations and
heterogeneous sophistication introduced in section 3.3 can be computed analogously. The
ability to estimate assignment probabilities relies on the assumption that there is no unob-
served heterogeneity in beliefs. This assumption also rules out correlation between beliefs
and preferences.


4.2     Identification for Complete Models using Variation in Distance

This subsection describes how variation in the preference shifter d within a market, fixing
zi and (xj , j ) for every school j , can be used to learn about the distribution of utilities.
Quasi-linearity of distance in equation (1) implies that vi = ui - di where ui = (ui1 , . . . , uiJ )
and uij = v (xj , zi , j , i , ij ). The distribution of ui conditional on a given value of zi and
(xj , j ) for every school in the market describes the distribution of utilities conditional on
   8
    In some cases, researchers assume away finite sample uncertainty due to the reports submitted by other
agents (Calsamiglia et al., 2017; Fack et al., 2019). This approximation has only a minor effect on the
assignment probabilities when the number of students is large relative to the number of schools.
                    Figure X
                                                                                               23




                               2


                                                                   



                           2
                                                           


                                                    



                        (0,0)                          1                1

                  Figure 6: Identification of the Distribution of Preferences

observables. Agarwal and Somaini (2018) derive conditions on the sets Ck that guarantee
the non-parametric identification of the distribution of ui assuming that

                                   (i , i )  di |zi , {xj , j }J
                                                               j =1 .


The identification argument can be illustrated using figure 6. Consider a report or allocation
k and the set Ck associated with it. By the model's revealed preference implications, the
probability that a student reports or is assigned to k is equal to the probability that ui
belongs to the set Ck + di , denoted P (ui - di  Ck ). This set is represented in the figure
by the lightly shaded region with d as a vertex. Similarly, by focusing on the set of students
with di  {di , di , di }, we can determine the probability that a student has utilities in
the corresponding regions (see figure 6). By appropriately adding and subtracting these
probabilities, we can learn the proportion of students with utilities in the parallelogram
defined by (d, d , d , d ). This allows us to learn the total weight the distribution of ui places
on such parallelograms of arbitrarily small size. It turns out that we can identify the density
of distribution around any point by focusing on variation in the neighborhood around it.
While this argument is non-parametric, it becomes necessary in empirical applications with
finite datasets to parametrize the distribution of preferences due to the high-dimensional
nature of the non-parametric problem. Below, we describe some of the most commonly
used methods and discuss the types of models for which they are applicable or particularly
tractable.
                                                                                                           24

4.3     Estimating Preference Parameters

We now describe some of the most commonly used parametrization and estimation methods.
Logit models are particularly convenient in cases where the allocation is stable or reports are
truthful. In these models, choice probabilities have a tractable closed form. In the case of
strategic reports, the sets that rationalize different choices have less structure, and the logit
models do not necessarily yield closed-form expressions. Another disadvantage of the logit
model is the difficulty of relaxing the independence of irrelevant alteratives property. Both
these issues can be solved using probit models, which can be used in any of the complete
models and allow for random co-efficients to be introduced relatively easily. These models'
convenience arises from the possibility of employing Bayesian estimation techniques that do
not even require computing choice probabilities.


4.3.1   Logit Models

Section 3 shows that both stability and truthful reporting imply pairwise inequalities among
components of the utility vectors. In the case of stability, the utility of the school to which
student i is assigned is higher than the utility of all other schools for which i is eligible.
Similarly, in the case of truthful reporting, the utility of the highest-ranked school exceeds
that of the second-highest, which in turn exceeds that of the third-highest. Moreover, the
utilities of the unranked schools are lower than those of the lowest-ranked school. Perhaps
the most tractable parametrization of utilities for these two models results from the logit
random utility model. This model uses the special case of equation (2) in which

                                     vij = j + xj ¯ zi - dij + ij                                          (6)

and vi0 = i0 , where ij follows an extreme-value type I distribution with location parameter 0
and scale parameter  . In addition to the distributional assumption on ij , this specification
excludes the terms i . Fack et al. (2019) used this parametric form to estimate high school
preferences in Paris under both stability and truth-telling.
When final assignments are stable, the probability that student i is assigned to school j ,
conditional on the observable characteristics and the model's parameters, is given by
                                                             1
                                                       exp   
                                                                 (j + xj ¯ zi - dij )
   P (i is assigned to j |xj , zi ; ) =                                     1
                                                                                                       ,   (7)
                                          1+   k   1 {k  S (ei , p)} exp    
                                                                                (k + xk ¯ zi - dik )

where ei is the observed eligbility score vector for student i and p is the eligibility cutoff
vector.
This formula is similar to the logit choice probabilities from the standard discrete choice
model (McFadden, 1973; Train, 2009). The only difference is that the summation in the
                                                                                                             25

denominator only includes terms for schools that are achievable by the student.
The functional form described is also useful for the case in which rank-order lists are assumed
to be truthful and the ranked schools are preferred to the outside option. Under the param-
eterization described in equation (6), the probability that student i submits the rank-order
list Ri = (Ri1 , . . . , RiKi ), where Rik is the school ranked k and Ki is the number of schools
ranked, is given by
                                                            1
                                   Ki                 exp   
                                                                (Rik + xRik ¯ zi - diRik )
  P (i submits Ri |xj , zi ; ) =                                                  1
                                                                                                             .
                                   k=1   1+   j   1 {j = Rik for k < k } exp      
                                                                                      (j + xj ¯ zi - dij )
                                                                                           (8)
This probability is therefore the product of choice probabilities identical to those derived
from the logit discrete choice model. The term corresponding k = 1 is the probability that
the school ranked first, Ri1 , has the highest utility. Similarly, the term corresponding to k
is the probability that the school ranked in position k has the highest utility amongst the
schools not ranked any higher. The product structure of the closed form solution depends
on the parametric assumptions in the logit model, specifically its independence of irrelevant
alternatives (IIA) property.
The IIA property of the logit model described above is an important limitation as it does
not allow students to have unobserved tastes for observed school characteristics. In many
contexts, we expect that a student who ranks a school with, say, good math outcomes at
the highest position will also rank other schools with good math outcomes near the top of
their list. Such patterns motivate introducing the random co-efficients i in equation (2). In
these models, students with a high co-efficient on a particular school characteristic will tend
to rank many schools with high values of that characteristic.
A challenge with specifications that include random co-efficients is that closed-form expres-
sions for the probabilities are not typically available. Estimation techniques for these models
typically require simulation, even in the simpler discrete choice context. For example, one ap-
proach is to estimate the mixed logit model using simulated maximum likelihood. The model
assumes a distribution for i and maintains the extreme-value type I assumption on ij . Con-
ditional on a realization of i , the probability of choice k is given by P (vi  Ck |xj , zi , i ; ),
which follows the functional form of equations (7) and (8) for the stable and truthful case. If
i is assumed to be distributed i  N (0,  ) with density  (·;  ), as is common practice
(Berry et al., 1995), then

                P (vi  Ck |xj , zi ; ,  ) =         P (vi  Ck |xj , zi ,  ; )  ( ;  ) d.                     (9)

Provided that the number of random coefficients is small, this expression can be computed
by numerical integration or Monte Carlo simulation. The parameters in  and  can be
estimated by simulated maximum likelihood of simulated method of moments, but a very
                                                                                                   26

large number of draws is recommended for the former.9
Logit models are not particularly useful for strategic reports. As we saw above, the set of
utilities that rationalize the different reports do not correspond to the sets describing ordinal
preferences. As a result, an analytic closed form, which is the main advantage of the logit
model, is not available.


4.3.2   Probit Models

In this section we argue that Probit models are convenient for estimation based either on
stability or any of the other complete models of behavior, irrespective of whether reports are
truthful or strategic. Probit models do not provide a closed-form solution to the probability
of a particular report or allocation. Instead, they can be estimated using Bayesian techniques
that do not require computing these probabilities.
These models assume following distributional assumptions on i and ij defined in equation
(2):
                                                              2
                      i  N (0,  )         and     ij  N 0,      .
This model can be estimated via Gibbs' sampling with appropriate conjugate prior distribu-
tions. The Gibbs' sampler iterates between drawing the parameters of the model (including
the random co-efficients) conditional on simulated utilities vij and drawing the utilities vij
conditional on the parameters.10 This procedure requires a tractable solution for the dis-
tribution of the utility of each school vij conditional on the parameters of the model, the
random co-efficients i and the utility of the remaining schools vij for j = j . Because utili-
ties are jointly normal in probit models, vij |vij , i ,  is normally distributed, and vij |vij , i , 
conditional on a particular choice has a truncated normal distribution.
This Bayesian technique yields estimates that are asymptotically equivalent to the maximum
likelihood estimator (van der Vaart, 2000, Theorem 10.1 (Bernstein-von Mises)). Moreover,
the sampling method yields both the point estimates and confidence sets simultaneously.
These features have made the model popular for discrete choice models in the marketing
literature (McCulloch and Rossi, 1994). Recall that estimation under stability amounts to a
discrete choice model with individual specific choice sets.
Abdulkadiroglu et al. (2017b) discusses how to implement the Gibbs' sampler in the case
of truthful reporting. They employ this approach to estimate high school preferences in
New York City, where students can list up to 12 out of several hundred school programs.
The district's size results in an extremely large number of possible reports. The analysis
  9
     Pathak and Shi (2019) develop an alternative approach, based on Hamiltonian Monte Carlo, that is
computationally more tractable than mixed logit for a school choice application.
  10
     Drawing the utilities in this second step is known as data augmentation.
                                                                                            27

stresses one attractive feature of the Gibbs' sampler in the case of truthful reports: it is
computationally tractable even with a large number of potential choices.
Agarwal and Somaini (2018) uses the Gibbs' Sampler for strategic reports. The key insight is
that drawing vij |vij , i ,  conditional on a particular choice reduces to drawing from a trun-
cated normal with truncation points determined by differences in assignment probabilities
between the chosen report and every alternative. That is, the truncation points depend on
LRi - LR for all R other than the report Ri , which was chosen by i. This feature of the
conditional distributions enables estimation using a Gibbs' sampler.
Yet, the Gibbs' sampling procedure can be computationally burdensome when applied to
the strategic reports model if the number of possible reports is large. For example, if a
student can rank K out of J schools, then the number of possible rank-order lists exceeds the
number of K -permutations of J . In some cases, many of the constraints are redundant and
can be eliminated using a linear programming solver. However, this approach still requires
computing a large number of differences LRi - LR .
One solution to this problem is to theoretically derive the set of deviations from the report
Ri that are necessary and sufficient for optimality. Larroucau and Rios (2019) develop this
approach under the assumption that admission chances across schools are independent. In
this case, the set of alternative reports to be considered are characterized by one-shot swaps.
This observation vastly simplifies computation as the number of alternatives that need to
be considered are now on the order K × J , which is much smaller than the total number of
possible reports. A more general solution to this problem is unknown.


4.3.3   Other Parametrizations and Simulated Maximum Likelihood

A general alternative when the simplifications above are not available is to use a simulation
estimator. For example, some researchers have used simulated maximum likelihood methods.
This approach simulates the right-hand side of equation (5) by drawing utilities many times
given the parameter vector  and computing the optimal reports for each draw to calculate
the probability that any given Ri is optimal. This procedure has two problems. The first
is the well-known issue that simulated maximum likelihood is biased unless the number of
simulations is much larger than the number of choices (Train, 2009, Chapter 10). This creates
a computational burden in school choice settings with many possible reports. The second
challenge is that computing the optimal report, or even verifying that a report is optimal,
can be hard if there are many schools because one must, in principle, check many potential
deviations.
Addressing the second problem with simulation methods requires a tractable algorithm for
computing optimal reports in environments with many choices. Currently, there are two
existing approaches to this problem. The first, from Calsamiglia et al. (2017), is applicable
                                                                                              28

to a broad class of mechanisms when there is limited or no uncertainty about various schools'
cutoffs. It uses a backwards induction method to check whether a particular report is optimal
for a given utility vector by starting from the lowest-ranked school and working up to the
highest-ranked school. This approach checks whether the school ranked in each position is
the optimal one to rank given that the student was rejected from all schools ranked at a
higher position.
The second approach, devised by Ajayi and Sidibe (2017), accommodates uncertainty in
school cutoffs and formulates the student's problem as a portfolio choice problem and ap-
proximates the solution using the marginal improvement algorithm from Chade and Smith
(2006). While this solution is not guaranteed to be optimal, it produces rank-order lists with
very similar schools listed. Ajayi and Sidibe (2017) use approximate solutions in a simulated
method of moments approach to estimate the preference parameters.


4.4    Incomplete Models

An alternative to the likelihood-based techniques discussed above is to develop approaches
that use the method of moments. The technique is particularly useful for incomplete models
of behavior.
We begin by describing the moment equality methods for the complete models of behavior.
Specifically, the approaches for stable assignments, truthful reporting and strategic reporting
yield the following moment equality restrictions:

                    E [ 1 {Ri = R} - P (vi  CR |xj , zi , j ; )| xj , zi , j ] = 0,

where 1 {Ri = R} denotes the event that student i submits rank-order list Ri ;  parametrizes
the distribution of preferences; and expectations are taken over individuals. Because the
expectation of the indicator is equal to the second term when  is equal to the true value,
this moment equality holds at 0 for each value of R and each value of the exogeneous
variables (xj , zi , j ). The identification condition requires that there are no other values of
 under which this moment condition is satisfied. The moment condition presented here is
analogous to that for the standard discrete choice models.
During estimation, the typical practice is to convert the conditional moment equality to un-
conditional versions by interacting the moment function with the observed characteristics. In
principle, the parameters can be estimated by simulating the probability P (vi  CR |xj , zi , j ; )
if it is hard to compute in closed form (McFadden, 1989; Pakes and Pollard, 1989). The
method of simulated moments is consistent with a finite number of simulated draws even
though simulated maximum likelihood is not (see Train, 2009, Chapter 10). Therefore, this
particular formulation solves the first problem with the aforementioned simulated maximum
                                                                                                         29

likelihood. Accordingly, this approach can be more tractable than simulated maximum like-
lihood in the case of strategic reporting and a large number of choices.11
Instead of delivering moment equalities, the incomplete model of ranking behavior presented
in section 3.4 delivers moment inequalities. This approach is used in several papers (see
He, 2014; Hwang, 2016; Fack et al., 2019, for example). Specifically, the revealed preference
arguments imply the following inequalities on the probability of reports:

                  
           P vi  CR i
                      |xj , zi , j ; FV  P (Ri |xj , zi , j )  P (vi  CRi |xj , zi , j ; FV ) .        (10)

Both these inequalities follow from set inclusion. The first inequality follows from the fact
             
that if vi  CR i
                 , then the agent must submit report Ri as it is the only rationalizable report.
The second inequality follows from the fact that if agent i reports Ri , then vi must belong
to CRi because Ri must be rationalizable for vi .12
In the example illustrated in figure 5, the shaded region below the 45-degree line belongs to
                                                    
CR 1
     , the hashed upper-right quadrant belongs to CR 2
                                                       and the region that is both shaded and
hashed belongs to both CR1 and CR2 . The inequalities derived for the two-school example
are a special case of those discussed above.
The analogous moment restrictions are:

                                           
                     E 1 {Ri = R} - P vi  CR i
                                               |xj , zi , j ;  xj , zi , j  0
                      E [ P (vi  CRi |xj , zi , j ; ) - 1 {Ri = R}| xj , zi , j ]  0.

To convert these conditional restrictions into unconditional moment inequalities, we can
interact the moment functions with a function h (xj , zi , j ) of the exogenous variables that
takes on only positive values (Ciliberto and Tamer, 2009; Pakes, 2010). The objective function
will search for values of  that minimize the deviations from these moment restrictions.
The identified set of parameters consists of all values of  that satisfy the moment restrictions
described above. This set can include more than one value of  precisely because the model
of behavior is incomplete.


4.5     Testing for Optimal Behavior

Each of the approaches for estimating preferences that we have discussed above requires the
analyst to pick a model of behavior, or a model that determines final outcomes. But, mis-
specification of the model can result in biased estimates. For example, approaches that are
  11
     A challenge in implementing the simulated method of moments in this formulation is that the resulting
objective function may not be smooth, creating potential problems with standard derivative-based optimizers.
This issue is important for the simulated maximum likelihood procedure as well.
  12                                                                            
     It is possible that one of these inequalities is trivial, for example, if CR is the empty set.
                                                                                                         30

based on optimal behavior may be substantially biased if many agents make mistakes. This
observation motivates research on whether agents behave optimally.
However, a challenge in engaging in this exercise is that typical administrative datasets do
not allow the researcher to test for optimality. Agarwal and Somaini (2018) show that it
is possible to rationalize any rank-order list submitted to a mechanism as being optimal
provided there is a non-zero probability of assignment to each of the ranked schools. In other
words, there exist utilities for which any given rank-order list is optimal.
This barrier to testing for optimality can be circumvented in a few ways. The first approach is
to assess this assumption using surveys from the field. For example, Rees-Jones (2018) surveys
recent applicants for medical residency positions in the US and finds that only about 5% of
applicants reported non-truthful preferences in an attempt to strategize in an environment
where doing so is suboptimal.13 In contrast, Kapor et al. (2017) find significant biases
in their survey of students from New Haven about their beliefs about admission chances.
This finding suggests that agents may not behave optimally in a mechanism with significant
strategic incentives unless detailed information is readily available.
A challenge with large scale field experiments or surveys is their expense and the ability to
precisely control the environment and interpret the responses. To the extent that the results
are generalizable to the field, lab experiments offer a second approach that can circumvent
these issues. This approach has been taken, for example, by Featherstone and Niederle
(2016) and Li (2017) to study behavior in the Immediate Acceptance the Deferred Acceptance
mechanisms.
A third approach is to impose restrictions on preferences to test for specific models of behav-
ior. Hassidim et al. (2016) use this strategy to document mis-representation of preferences
in a setting where a program (school) can be ranked both with and without a scholarship
option. They find that just under 20% of applicants either fail to rank the scholarship option
or rank it below the regular option. This behavior is not optimal if the chance of getting
a scholarship is non-zero since the programs are otherwise identical. Consistent with the
idea that scholarship positions are omitted primarily by applicants with with low chances
of receiving one, Hassidim et al. (2016) also find that the incorrect ranking affects the final
outcomes of only a handful of applicants.
Another way to impose restrictions on preferences is to base the test on parametric assump-
tions on utility. This approach is taken in Fack et al. (2019), which uses a logit model when
testing for stability versus truth-telling. A drawback of this approach is that the parametric
assumptions can bias the test in favor of economic models that place fewer restrictions on
the data. Intuitively, there always exist ordinal preferences that are consistent with truth-
telling that are also consistent with stability. But, truth-telling places more restrictions on
  13
    Rees-Jones (2018) reports that another 12% of applicants do not report their "true preferences," but for
unclear reasons such as locational or dual-career constraints. The paper focuses on the 5% number as the
headline to be conservative.
                                                                                                          31

the data than stability, potentially leading to a rejection due to a mis-specified parametric
model instead of an incorrect economic model.
Taken together, testing models of behavior requires either restrictions on preferences or in-
formation not available in typical administrative data.14



5      Review of Empirical Findings

5.1     Education Policy

School demand has important implications for effective school choice and equalitable access
to high quality edication. The vast literature studying these issues is vast and not easily
summarized (see Hoxby, 2003, for a survey). Instead, we discuss research that estimates
models of student preferences to shed light on school choice's effects on who acquires high-
quality education.
A common finding in the literature is that student preferences are correlated with both
proximity to school and measures of school performance. This preference for proximity can
limit access to high-quality schools due to residential location (Burgess et al., 2015). The
literature also finds significant heterogeneity in preferences across both socio-economic groups
and baseline academic achievement levels. Students from higher-income families are typically
willing to travel further to attend schools with better outcomes (Hastings et al., 2009; Burgess
et al., 2015). These results suggest that residential sorting contributes to inequality in the
quality of schools accessed by different socio-economic groups.
Demand for schools can also affect the pressure for school improvement (Hoxby, 2003). For
example, Hastings et al. (2009) estimate a higher elasticity of demand for schools with good
educational outcomes than for schools with lower outcomes. This finding suggests that dis-
parate pressures to improve schools following greater choice may lead to further stratification
of school quality.
Motivated by these results, Neilson (2013) augments the demand framework with a supply-
side model in which schools choose quality in order to maximize profits. The model is used to
study the effects of a voucher reform on access to quality schools. In a similar vein, Dinerstein
and Smith (2019) use a choice model to study private schools' responses to reduced demand
following increased funding and improvement in the public school sector. These studies do
not have micro-data on applications and surmount this limitation by assuming that each
student is assigned to their most preferred school. Such an approach abstracts away from
  14
    The aforementioned results in Agarwal and Somaini (2018) also admit one more strategy for testing
optimal behavior that, to the best of our knowledge, has not been previously used. Specifically, variation in
the assignment probabilities that can be excluded from preferences could falsify optimal behavior because a
single preference distribution has to rationalize the resulting variation in behavior.
                                                                                            32

rationing that might occur if there is excess demand. Therefore, incorporating a supply-side
model with the types of school assignment models discussed above is a promising area for
future research.
Choices and the school assignment mechanism can also influence educational mobility. Ayaji
(2017) finds that students from low-performing elementary schools are less likely to apply to
selective secondary schools, partly because of proximity priority. However, the school choice
environment is also a contributor, as students from lower-performing schools do not navigate
the mechanisms as effectively, reducing their chances of being admitted into selective schools.
The emphasis placed on proximity in preferences suggests that school districts should pay
attention to the geographical distribution of high-quality schools. The decisions on where
to invest in new schools or which schools to close should therefore consider the resulting
assignment of students. Epple et al. (2018) model the problem of a school district superin-
tendent who must decide which schools to close when confronted with a contracting student
population. An important component of the model is a demand-side in which students weigh
proximity, school quality and peer characteristics when choosing a school.
The student preferences described above are typically based on peer characteristics or student
outcomes rather than value added. Therefore, it is unclear whether demand-side pressures
align with increasing quality as measured by value-added. Abdulkadiroglu et al. (2017c) show
that while mean preferences for schools correlate with both high-achieving peers and value-
added, they do not significantly correlate with value-added once controls for peer quality
have been included.
But, estimates of value-added can also be biased if choice induces selection into schools by
unobserved academic ability. In the context of higher education, Akyol and Krishna (2017)
estimate a value-added model that corrects for selection induced by application decisions and
university entrace exam scores, assuming the latter are a noisy measure of true ability. They
find that selectivity and value-added are only loosely correlated as student preferences are
influenced by a number of other factors. This result suggests that traditional value-added
measures may not be significantly biased.


5.2    Mechanism Design

A separate, now well-developed literature empirically investigates the trade-offs among vari-
ous school choice systems. These results provide a quantitative analog to the vast theoretical
literature (Abdulkadiroglu and Sonmez, 2003; Pathak, 2017) studying the school assignment
problem from a mechanism design perspective.
One role of empirical work is to weigh in when theory does not provide unambiguous an-
swers. For example, consider the choice between IA and DA. While DA is celebrated for its
incentives properties, Abdulkadiroglu et al. (2011b) show the mechanism may not efficiently
                                                                                            33

sort students if they agree on which schools are preferable, but differ in their intensity of
preferences. By comparison, strategic incentives in an IA mechanism encourage students to
apply to a competitive school only if they strongly prefer it; however, this potential advan-
tage of IA requires that students understand and respond optimally to these incentives. In
fact, IA could disadvantage students who are not sophisticated in their preference reporting
(Pathak and Sonmez, 2008).
The empirical literature has shed light on the two mechanims' welfare effects and the extent to
which students understand the mechanisms. This trade-off has been estimated using models
in which behavior is described by equilibrium play (Agarwal and Somaini, 2018); a mix of
sincere and sophisticated players (Calsamiglia et al., 2017; Agarwal and Somaini, 2018); weak
restrictions on beliefs (He, 2014; Hwang, 2016) and heterogeneous beliefs estimated using
survey data (Kapor et al., 2017). The papers largely find that the average student welfare is
higher under IA if students' behavior is described by equilibrium play, but the difference is
small at best (Kapor et al., 2017; Agarwal and Somaini, 2018). Survey evidence also suggests
that many students are mistaken about their admission chances or the mechanism used (He,
2014; Kapor et al., 2017), and that these biases can result in overstating the potential,
although already small, advantages of IA (Kapor et al., 2017; Agarwal and Somaini, 2018).
Empirical approaches have also been used to investigate variants of the DA mechanism dis-
cussed the theoretical literature. For example, de Haan et al. (2016) compare a DA mecha-
nism with a single tie-breaker to one in which a student receives independent tie-breakers for
each schools. This comparison has been a longstanding open theoretical question (Pathak
and Sethuraman, 2011; Ashlagi and Nikzad, 2017). Another example is a DA variant devised
by Che et al. (2019) to obtain assignments that are both approximately efficient and stable
in large markets.
Practical experience with implementing school choice mechanisms has also revealed new issues
that can be addressed using empirical work. An example is the problem of a school district
that has to manage transportation costs and therefore offers students a menu of school choice
options as opposed to unrestricted choice. Estimates from the models described above have
been used to predict and guide the assignments that result from various menu designs (Shi,
2015, 2019). A related open question is the extent to which choice models accurately predict
the assignments following such reforms (Pathak and Shi, 2019).
Other papers have investigated how to manage the choices a student can submit. In principle,
the DA mechanism's desirable incentives rely on placing no restrictions on the number of
schools that can be ranked (Haeringer and Klijn, 2009). However, with rare exceptions,
choice mechanisms limit the number of schools that can be ranked. Ajayi and Sidibe (2017)
argue that these limitations can constrain welfare substantially and result in redistribution.
Part of the concern with limiting the length of rank-order lists is that uncertainty about
admissions chances leads students to rank too many competitive schools, resulting in some
                                                                                            34

being left out. Luflade (2017) studies a sequential implementation that is possible when stu-
dents are ordered according to a single exam score. In this system, students with high scores
are approached first and asked to submit preferences with a limit on the number of options
that can be ranked. Then, lower-priority students are approached and are given information
about the remaining seats. This implementation can help students across the score distribu-
tion. While students with low scores benefit from better information about available seats,
students with higher scores benefit from a fallback option if they mistakenly rank only com-
petitive schools. The sequential implementation reduces uncertainty and improves welfare
even with a small number of rounds.
Perhaps the primary goal of a school choice system coordinated via a mechanism is to increase
allocative efficiency, but comparing such systems with decentralized ones requires data on a
system without a formal school choice system. Such data are hard to come by. Abdulka-
diroglu et al. (2017b) use the implementation of the New York City High School assignment
system to quantify the welfare effects of centralized school assignment. They find that, fol-
lowing the reform that centralized the assignment process, students were placed at more
desirable schools and were more likely to enroll in their assigned school. They also found
that exits from the public school system fell following this reform. Their analysis compared
the new DA-based system to the old system and alternatives motivated by matching theory.
On a scale ranging from a no-choice neighborhood assignement to the utilitarian optimal, the
new system realized 80% of the potential gains, whereas the old system achieved one-third
at most. Other ordinal mechanisms studied in the theoretical literature were within a few
percentage points, suggesting that the primary gains arise from coordinating assignments.


5.3    Information, Beliefs and Behavior

Many of the issues discussed above depend on the information available to students (or
parents acting on their behalf), how they process the information to form beliefs and the way
those beliefs ultimately translate to behavior. For example, preferences may not be welfare
relevant if students are not familiar with the schools when deciding where to apply. Similarly,
school choice is ineffective at improving schools if students do not know which schools are
good.
There are several studies that show students are not perfectly informed about school quality.
For example, Hastings and Weinstein (2008) use a field experiment to show that providing
families with information about school performance changes choice behavior: more students
apply to higher-performing schools. The finding emphasizes the need for greater information
provision if school choice is to pressure lower-performing schools to raise their standards.
This reasoning also raises questions about the type of information that should be provided
if performance does not perfectly correlate with test score gains or value-added.
                                                                                             35

Allende et al. (2019) propose a framework for extrapolating from experiments that com-
pare the estimated effects of information provision on assignments to large-scale information
interventions. There are two important issues to consider. First, these interventions steer stu-
dents toward specific schools, creating or increasing excess demand. This brings the method
for rationing slots at the schools into focus. Second, schools may endogenously respond by
changing their investment in quality and adjusting school capacity. Allende et al. (2019) con-
sider these two issues in the Chilean context, using a model in which schools adjust quality
and tuition to maximize profits while ensuring that demand exactly matches the number of
seats available prior to the intervention. Therefore, school characteristics adjust so that all
students are ultimately placed in their first-choice schools. An important area of research is
to better understand school objectives and to use detailed application data to better capture
the rationing of school seats.
Information available to students about the choice environment also has important con-
sequences for designing these systems. Some mechanisms require students to have detailed
information and respond to the resulting incentives. Indeed, the potential for further improve-
ments to student welfare beyond a Pareto-optimal assignment produced by the strategy-proof
top-trading cycles mechanism may require more complicated mechanisms that elicits cardi-
nal information (Abdulkadiroglu et al., 2017b). A particular concern with very involved
choice systems is that heterogeneity in the ability to effectively navigate the system may
have important redistributive consquences (Pathak and Sonmez, 2008).
Even if students understand the choice system, they must evaluate many schools in order
to choose effectively. This task can be daunting in districts with many schools, making
it possible for formal choice mechanisms to result in ex-post mismatch. In fact, students
and parents may be tempted to obtain initial assignments only invest time investigating
a school after they have been assigned to it. Indeed, Narita (2018) documents significant
cases of preference reversals in which students in New York appeal the assignment obtained
through the main mechanism. Another cause for concern is that one out of every ten students
unexpectedly remained unassigned after the main rounds of the New York City school choice
mechanism (Abdulkadiroglu et al., 2017b). These students were placed by an administrator,
usually to the closest school with available space.
These issues highlight the importance of organizing aftermarkets that enable students to trade
if they learn that they are mismatched. Thinking about the design of aftermarkets requires
a deeper understanding of the process through which students acquire information about
schools. Taken together, these findings indicate that students' need for better information
about the school system and the assignment process is an important complement to reforming
choice systems.
                                                                                             36

6    Conclusion
Estimating models of school demand differs from evaluating standard consumer choice be-
cause education markets typically involve rationing: not all students get admitted to their
top choice school. Capacity constraints, not demand, often determine total enrollment.
We describe recently developed methods for using rich data derived from formal student
assignment systems to estimate models of student preferences. The choice of technique
depends on the properties of the school choice mechanism in place, the available data and
the assumptions a researcher is willing to make on student behavior.
These newly devised methods have yielded a wealth of insights into educational markets. One
consistent finding is that student preferences are correlated with both proximity to school
and measures of school performance. This suggests that proximity is an important barrier
to access. Moreover, students from disadvantaged backgrounds are less likely to apply to
selective secondary schools, partly because of stronger preferences for proximity.
These results suggest that different pressures to improve schools after students are granted
greater choice may lead to further stratification of school quality. And, schools located in
areas with disadvantaged students may improve less, further exacerbating inequality in access
to high-quality education. These arguments emphasize the need for school districts to pay
attention to the geographical distribution of high-quality schools.
The models have also been used to investigate the trade-offs among various school choice sys-
tems. An important result is that the benefits of centralizing allocations dwarf the differences
across well-coordinated mechanisms. Within coordinated systems, a common conclusion is
that average student welfare is higher under the IA mechanism if students' behavior is de-
scribed by equilibrium play. This difference is small at best and further shrink or disappear
altogether if agents fail to behave optimally or have biased beliefs about their assignment
probabilities.
There are several fruitful areas for improving the approaches described above. First, existing
models hold residential choice fixed. Evidence suggests that school district boundaries are an
important determinant of residential decisions (Black, 1999; Bayer et al., 2007). It would be
valuable to extend the framework presented in this paper to jointly consider within-district
residential choice and school choice. Second, the methods abstract away from peer effects.
While summary measures of peer quality can be included as school characteristics, endogene-
ity in the determination of peer quality compromises the interpretation of the estimates for
counterfactual or equilibrium calculations.
Perhaps an important open question is the extent to which preferable assignments also result
in preferable outcomes. While some studies mentioned in our review have measured the
correlations between choices and school value-added, it is unknown whether improved school
quality cause increases demand. Further, the evidence of positive selection into schools based
                                                                                             37

on heterogeneous and idiosyncratic effects on test-score gains (Walters, 2018), does not resolve
the question of whether allowing for choice enables better sorting on test-score gains relative
to top down solutions. These questions deserve further research.
There are also many open avenues for using student preference models to guide education
policy. These include guiding investment in school infrastructure and quality; managing
transportation investments to expand access to high-quality schools; investigating the ef-
fects of school competition in the presence of rationing and understanding how the choice
environment can be improved to provide more equitable access.



References
Abdulkadiroglu, Atila and Tayfun Sonmez, "School Choice: A Mechanism Design
 Approach," The American Economic Review, 2003, 93 (3), 729 ­ 747.

  , Joshua Angrist, S. M. Dynarski, T. J. Kane, and Parag A. Pathak, "Account-
  ability and Flexibility in Public Schools: Evidence from Boston's Charters And Pilots,"
  The Quarterly Journal of Economics, jul 2011, 126 (2), 699­748.

  , Joshua D. Angrist, Yusuke Narita, and Parag A. Pathak, "Research Design
  Meets Market Design: Using Centralized Assignment for Impact Evaluation," Economet-
  rica, 2017, 85 (5), 1373­1432.

  , Nikhil Agarwal, and Parag A. Pathak, "The Welfare Effects of Coordinated School
  Assignment: Evidence from the NYC High School Match," American Economic Review,
  2017, 107 (12), 3635­89.

  , Parag Pathak, Jonathan Schellenberg, and Christopher Walters, "Do Parents
  Value School Effectiveness?," American Economic Review, forthcoming, 2017.

  , Yeon-Koo Che, and Yosuke Yasuda, "Resolving Conflicting Preferences in School
  Choice: The Boston Mechanism Reconsidered," American Economic Review, 2011, 101
  (1), 399­410.

  , , and , "Expanding "Choice" in School Choice," American Economic Journal: Mi-
  croeconomics, 2015, 7 (1), 1­42.

Agarwal, Nikhil, "An Empirical Model of the Medical Match," American Economic Review,
 2015, 105 (7), 1939­78.

   and Paulo Somaini, "Demand Analysis Using Strategic Reports: An Application to a
  School Choice Mechanism," Econometrica, 2018, 86 (2), 391­444.
                                                                                     38

Ajayi, Kehinde and Modibo Sidibe, "An Empirical Analysis of School Choice under
 Uncertainty," 2017.

Akyol, Pelin and Kala Krishna, "Preferences, selection, and value added: A structural
 approach," European Economic Review, 2017, 91, 89­117.

Allen, Roy and John Rehbeck, "Identification of Average Demand Models," Economet-
 rica, forthcoming, 2017.

Allende, Claudia, Francisco Gallego, and Christopher Neilson, "Approximating the
 Equilibrium Effects of Informed School Choice," 2019.

Artemov, Gregory, Yeon-Koo Che, and Yinghua He, "Strategic Mistakes: Implica-
 tions for Market Design Research," 2017.

Ashlagi, Itai and Afshin Nikzad, "What matters in school choice tie-breaking? How
 competition guides design," 2017.

Ayaji, K, "School Choice and Educational Mobility: Lessons from Secondary School Appli-
 cations in Ghana," 2017.

Azevedo, Eduardo M. and Jacob Leshno, "A Supply and Demand Framework for Two-
 Sided Matching Markets," Journal of Political Economy, 2016, 124 (5), 1235­1268.

Bayer, Patrick, Fernando Ferreira, and Robert McMillan, "A Unified Framework
 for Measuring Preferences for Schools and Neighborhoods," Journal of Political Economy,
 2007, 115 (4), 588­638.

Beggs, S, S Cardell, and J Hausman, "Assessing the potential demand for electric cars,"
 Journal of Econometrics, 1981, 17 (1), 1­19.

Berry, Steven T., James Levinsohn, and Ariel Pakes, "Automobile Prices in Market
 Equilibrium," Econometrica, 1995, 63 (4), 841 ­ 890.

  , , and , "Differentiated Products Demand Systems from a Combination of Micro and
  Macro Data: The New Car Market," Journal of Political Economy, 2004, 112 (1), 68­105.

Black, S. E., "Do Better Schools Matter? Parental Valuation of Elementary Education,"
  The Quarterly Journal of Economics, 1999, 114 (2), 577­599.

Bucarey, Alonso, "Who Pays for Free College? Crowding Out on Campus," 2018.

Burgess, Simon, Ellen Greaves, Anna Vignoles, and Deborah Wilson, "What Par-
 ents Want: School Preferences and School Choice," The Economic Journal, 2015, 125
 (587), 1262­1289.
                                                                                       39

Calsamiglia, Caterina, Chao Fu, and Maia Guell, "Structural Estimation of a Model of
 School Choices: the Boston Mechanism vs. Its Alternatives," Journal of Political Economy,
 forthcoming, 2017.

Cassola, Nuno, Ali Hortaçsu, and Jakub Kastl, "The 2007 Subprime Market Crisis
 Through the Lens of European Central Bank Auctions for Short Term Funds," Economet-
 rica, 2013, 81 (4), 1309­1345.

Chade, Hector and Lones Smith, "Simultaneous Search," Econometrica, 2006, 74 (5),
 1293­1307.

Che, Yeon-Koo, Olivier Tercieux, Eduardo Azevedo, Eric Budish, Julien Combe,
 Olivier Compte, Tadashi Hashimoto, Yash Kanoria, Fuhito Kojima, Scott
 Kominers, Sangmok Lee, Bobak Pakzad-Hurson, Debraj Ray, Al Roth, and
 Rajiv Sethi, "Efficiency and Stability in Large Matching Markets," Journal of Political
 Economy, 2019, 127 (5), 2301­42.

Chen, Yan and Onur Kesten, "From Boston to Chinese parallel to deferred acceptance:
 Theory and experiments on a family of school choice mechanisms," Discussion Papers,
 Research Unit: Market Behavior, 2013.

   and Tayfun Sonmez, "School choice: an experimental study," Journal of Economic
  Theory, 2006, 127 (1), 202­231.

Ciliberto, Federico and Elie Tamer, "Market Structure and Multiple Equilibria in Airline
  Markets," Econometrica, 2009, 77 (6), 1791­1828.

de Haan, Monique, Pieter A Gautier, Hessel Oosterbeek, and Bas van der
  Klaauw, "The Performance of School Assignment Mechanisms in Practice," 2016.

Deming, David J., "Better Schools, Less Crime?," The Quarterly Journal of Economics,
 nov 2011, 126 (4), 2063­2115.

Diamond, W. and N. Agarwal, "Latent indices in assortative matching models," Quan-
 titative Economics, 2017, 8 (3).

Dinerstein, Michael and Troy Smith, "Quantifying the Supply Response of Private
 Schools to Public Policies," 2019.

Dubins, L.E. and D.A. Freedman, "Machiavelli and the Gale-Shapley Algorithm," The
 American Mathematical Monthly, 1981, 88 (7), 485­494.

Dur, Umut, Parag A. Pathak, Fei Song, and Tayfun Sonmez, "The Taiwan Assign-
 ment Mechanism," NBER Working Paper Series, 2018, 25024.
                                                                                      40

Epple, Dennis, Akshaya Jha, and Holger Sieg, "The superintendent's dilemma: Man-
 aging school district capacity as parents vote with their feet," Quantitative Economics,
 2018, 9 (1), 483­520.

Fack, Gabrielle, Julien Grenet, and Yinghua He, "Beyond Truth-Telling: Preference
  Estimation with Centralized School Choice and College Admissions," American Economic
  Review, 2019, 109 (4), 1486­1529.

Featherstone, Clayton and Muriel Niederle, "Improving on Strategy-proof School
  Choice Mechanisms: An Experimental Investigation," Games and Economic Behavior,
  2016, 100, 353­375.

Gale, David and Lloyd S. Shapley, "College admissions and the stability of marriage,"
 The American Mathematical Monthly, 1962, 69 (1), 9­15.

Guerre, Emmanuel, Isabelle Perrigne, and Quang Vuong, "Optimal Nonparametric
 Estimation of First-Price Auctions," Econometrica, 2000, 68 (3), 525­574.

Haeringer, Guillaume and Flip Klijn, "Constrained school choice," Journal of Economic
 Theory, 2009, 144 (5), 1921­1947.

Hassidim, Avinatan, Assaf Romm, and Ran I. Shorrer, "'Strategic' Behavior in a
 Strategy-Proof Environment," SSRN Electronic Journal, 2016.

Hastings, Justine S. and Jeffrey M. Weinstein, "Information, School Choice, and Aca-
 demic Achievement: Evidence from Two Experiments," Quarterly Journal of Economics,
 2008, 123 (4), 1373­1414.

  , Thomas J. Kane, and Douglas O. Staiger, "Heterogeneous Preferences and the
  Efficacy of Public School Choice," 2009.

He, Yinghua, "Gaming the Boston School Choice Mechanism in Beijing," 2014.

Hortacsu, Ali and David McAdams, "Mechanism Choice and Strategic Bidding in Di-
 visible Good Auctions: An Empirical Analysis of the Turkish Treasury Auction Market,"
 Journal of Political Economy, 2010, 118 (5), 833­865.

Hoxby, Caroline, "School Choice and School Productivity. Could School Choice Be a Tide
 that Lifts All Boats?," The Economics of School Choice, 2003, pp. 287­342.

Hwang, Sam Il Myong, "A Robust Redesign of High School Match," 2016.

Kapor, Adam, Christopher Neilson, and Seth Zimmerman, "Heterogeneous Beliefs
 and School Choice Mechanisms," American Economic Review, forthcoming, 2017.
                                                                                       41

Larroucau, Tomas and Ignacio Rios, "Do Short-List Students Report Truthfully? Strate-
  gic Behavior in the Chilean College Admissions Problem, with Ignacio Ríos," 2019.

Li, Shengwu, "Obviously Strategy-Proof Mechanisms," American Economic Review, 2017,
  107 (11), 3257­3287.

Luflade, Margaux, "The value of information in centralized school choice systems," 2017.

Manski, Charles F., Analog estimation methods in econometrics, Chapman and Hall, 1988.

McCulloch, Robert and Peter E Rossi, "An exact likelihood analysis of the multinomial
 probit model," Journal of Econometrics, 1994, 64 (1-2), 207­240.

McFadden, Daniel, "Conditional Logit Analysis of Qualitative Choice Behavior," 1973,
 pp. 105 ­ 142.

  , "A Method of Simulated Moments for Estimation of Discrete Response Models without
  Numerical Integration," Econometrica, 1989, 57 (5), 995 ­ 1026.

Menzel, Konrad, "Large Matching Markets As Two-Sided Demand Systems," Economet-
 rica, 2015, 83 (3), 897­941.

Narita, Yusuke, "Match or Mismatch? Learning and Inertia in School Choice," 2018.

Neilson, Christopher, "Targeted Vouchers, Competition Among Schools, and the Aca-
 demic Achievement of Poor Students," 2013.

Pakes, A., "Alternative Models for Moment Inequalities," Econometrica, 2010, 78 (6), 1783­
 1822.

Pakes, Ariel and David Pollard, "Simulation and the Asymptotics of Optimization Es-
 timators," Econometrica, 1989, 57 (5), 1027 ­ 57.

Pathak, Parag A., "What Really Matters in Designing School Choice Mechanisms," in
 Bo Honore, Ariel Pakes, Monika Piazzesi, and Larry Samuelson, eds., Advances in Eco-
 nomics and Econometrics, Cambridge: Cambridge University Press, 2017, pp. 176­214.

   and Jay Sethuraman, "Lotteries in student assignment: An equivalence result," Theo-
  retical Economics, 2011, 6 (1).

Pathak, Parag A and Peng Shi, "How Well Do Structural Demand Models Work? Coun-
 terfactual Predictions in School Choice," Journal of Econometrics, forthcoming, 2019.

Pathak, Parag A. and Tayfun Sonmez, "Leveling the Playing Field: Sincere and So-
 phisticated Players in the Boston Mechanism," American Economic Review, 2008, 98,
 1636­1652.
                                                                                     42

Pennell, H., A. West, and A. Hind, "Secondary School Admissions in London," 2006.

Rees-Jones, Alex, "Suboptimal behavior in strategy-proof mechanisms: Evidence from the
 residency match," Games and Economic Behavior, mar 2018, 108, 317­330.

Shi, Peng, "Guiding School-Choice Reform through Novel Applications of Operations Re-
  search," Interfaces, apr 2015, 45 (2), 117­132.

  , "Optimal Priority-Based Allocation Mechanisms," SSRN Electronic Journal, jul 2019.

Shorrer, Ran I. and Sandor Sovago, "Obvious Mistakes in a Strategically Simple College-
  Admissions Environment," SSRN Electronic Journal, 2017.

Tamer, Elie, "Incomplete Simultaneous Discrete Response Model with Multiple Equilibria,"
  The Review of Economic Studies, 2003, 70, 147­165.

Train, Kenneth E., "Discrete Choice Methods with Simulation," Cambridge Books, 2009.

van der Vaart, A. W., Asymptotic Statistics, Cambridge University Press, 2000.

Walters, Christopher, "The Demand for Effective Charter Schools," Journal of Political
 Economy, 2018, 126 (6), 2179­2223.
