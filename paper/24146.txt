                                NBER WORKING PAPER SERIES




                       AUGMENTING MARKETS WITH MECHANISMS

                                            Samuel Antill
                                            Darrell Duffie

                                        Working Paper 24146
                                http://www.nber.org/papers/w24146


                      NATIONAL BUREAU OF ECONOMIC RESEARCH
                               1050 Massachusetts Avenue
                                 Cambridge, MA 02138
                                    December 2017




We are grateful for expert research assistance from Yu Wu, for very helpful conversations with
Bruno Biais, Piotr Dworczak, Romans Pancs, and Haoxiang Zhu, for useful feedback from
Stanford faculty attending a preliminary presentation of this work on December 8, 2017, for
discussions of this paper by Kerry Back at the NBER Asset Pricing Conference, Anton Tsoy at
the 2018 Western Finance Association Meeting, and Yunzhi Hu at the NSF/CEME
Decentralization Conference, as well as commenters at the Penn Market Design Conference, the
Erasmus Liquidity Conference, the 2018 North American Summer Meeting of the Econometric
Society and seminar presentations at ITAM, Stanford University, NYU, Harvard University,
Johns Hopkins University, Goethe University, Cambridge University, the University of Chicago,
and MIT. We are also grateful to anonymous referees for very helpful expositional suggestions.
This material is based upon work supported by the National Science Foundation Graduate
Research Fellowship under Grant No. DGE-114747. The views expressed herein are those of the
authors and do not necessarily reflect the views of the National Bureau of Economic Research.

NBER working papers are circulated for discussion and comment purposes. They have not been peer-
reviewed or been subject to the review by the NBER Board of Directors that accompanies official
NBER publications.

© 2017 by Samuel Antill and Darrell Duffie. All rights reserved. Short sections of text, not to exceed
two paragraphs, may be quoted without explicit permission provided that full credit, including © notice,
is given to the source.
Augmenting Markets with Mechanisms
Samuel Antill and Darrell Duffie
NBER Working Paper No. 24146
December 2017, Revised June 2020
JEL No. D47,D82,G14

                                         ABSTRACT

We explain how the common practice of size-discovery trade detracts from overall financial
market efficiency. At each of a series of size-discovery sessions, traders report their desired
trades, generating allocations of the asset and cash that rely on the most recent exchange price.
Traders can thus mitigate exchange price impacts by waiting for size-discovery sessions. This
waiting causes socially costly delays in the rebalancing of asset positions across traders. As the
frequency of size-discovery sessions is increased, exchange market depth is further lowered by
the traders' reduced incentive to bid aggressively on the exchange, further delaying the
rebalancing of positions, and more than offsetting the gains from trade that occur at each of the
size-discovery sessions.


Samuel Antill
Graduate School of Business
Stanford University
655 Knight Way
Stanford, CA 94305-7298
santill@stanford.edu

Darrell Duffie
Graduate School of Business
Stanford University
Stanford, CA 94305-7298
and NBER
duffie@stanford.edu
1       Introduction
In financial markets, investors with large trading interests recognize that their trades can move
the market-clearing price against themselves. These investors strategically avoid price-impact
costs by executing large orders slowly. The result is that, in equilibrium, the asset is reallocated
across traders more gradually than is socially optimal. This concern is exacerbated, under
post-crisis regulations, by the higher costs for intermediary dealer banks of absorbing large
customer orders onto their own balance sheets. Trade venue operators have introduced size-
discovery sessions that allow market participants to lower their price-impact costs by using trade
protocols such as workups and dark pools that set the terms of trade based on the fixed price
set on the exchange. We show that, at least in our model setting, overall allocative efficiency is
reduced by augmenting price-discovery exchange markets with size discovery. This is true even
for size-discovery mechanism designs that efficiently reallocate the asset at every session.
    It is already well understood from the work of Vayanos (1999), Rostek and Weretka (2015),
and Du and Zhu (2017) that traders bid less aggressively in a financial market in order to
strategically lower their price impacts, causing socially costly delays in rebalancing positions
across traders.1 In our model, price discovery occurs on an exchange that is modeled as a
sequential-double-auction market, along the lines of Du and Zhu (2017). Each auction is a
demand-function submission game, in the sense of Wilson (1979) and Klemperer and Meyer
(1989).
    We examine the welfare implications of augmenting exchange trade with size-discovery trade.
At each of a sequence of size-discovery sessions, as in common practice, the terms of trade are
based on the most recent exchange price. Because this price is frozen for the purpose of size-
discovery trade, price impacts are avoided. As an example, we show that size discovery can
be based on a simple dark-pool mechanism that uses the most recent exchange price. We also
provide a non-linear strategy-proof mechanism design for size discovery.2
    At each size-discovery session, traders are induced by the mechanism design to truthfully
report their excess inventories of the asset to the platform operator, which then allocates trans-
fers of cash and the asset. In equilibrium, each session is ex-post individually rational and
incentive compatible, budget balanced, and reallocates the asset perfectly efficiently among
traders. This seeming contradiction of Myerson and Satterthwaite (1983) is possible because of
the information available to the size-discovery platform operator through the prior equilibrium
    1
    Sannikov and Skrzypacz (2016) study a similar setting with heterogeneous traders. They also consider
mechanism design, but solely as an analytical device to solve for the equilibrium of a conditional double-auction
model.
  2
    Specifically, our results hold for a class of non-linear mechanisms that contains the Vickrey-Clarke-Groves
mechanism associated with the equilibrium value functions.



                                                       1
exchange price. As the mean frequency of size-discovery sessions is increased, traders reduce
their exchange order submissions, relying more on upcoming size-discovery sessions because of
their lower price-impact costs. Exchange market depth is therefore reduced, further increasing
the incentive to shade exchange order submissions. Traders also shade their exchange order
submissions in order to reduce the impact of their exchange trades on the expected price that
will be used to set the terms of trade at the next size-discovery session. Overall, the significant
expected gains from trade that occur at each size-discovery session are more than offset by the
effect of reduced exchange trading. Indeed, every trader is made worse off, ex ante, by the pres-
ence of size discovery. If, however, a size-discovery venue is available, traders will participate
whenever a size-discovery session is held.
    Even if the size-discovery mechanism designer has enough information to avoid reliance on
exchange prices to set the terms of trade, we show that welfare cannot be improved by adding
size discovery, except for a size-discovery session that is run before the exchange market opens,
as shown by Duffie and Zhu (2017), who analyzed workup, a form of size discovery that is
heavily used in dealer-dominated markets, such as those for treasuries and swaps. Duffie and
Zhu (2017) also showed that workup is not a fully efficient form of size discovery because traders
under-report the sizes of their positions (or equivalently, under-submit trade requests), relative
to socially optimal order submissions, due to a winner’s-curse effect. As a mechanism design, the
workup protocol places strong restrictions on the allowable forms of messages and transfers.
Our modeled size-discovery trade protocols are based on mechanism designs that reallocate
the asset with maximal efficiency. After each size-discovery session, however, traders’ asset
inventories are hit by new supply and demand shocks over time that cause a desire for further
rebalancing.
    In our model, augmenting the exchange market with size-discovery sessions has no social
value, because the allocative benefits of size-discovery sessions are more than fully offset by a
corresponding reduction in gains from trade on the exchange market. While one might imagine
that this relatively discouraging result is caused by a size-discovery mechanism design that is
“too efficient,” we show that overall allocative efficiency is not helped by impairing the efficiency
of the size-discovery protocol (at least within a given class of mechanisms) in order to better
support exchange market depth and trade volumes.
    For tractability, we assume that traders have symmetric quadratic inventory holding costs
and that size-discovery sessions are held at Poisson arrival times. Despite this narrow model
parameterization, the underlying intuition for our welfare result seems relatively general. It
is natural that size discovery increases the incentive of individual traders to delay socially
beneficial exchange trading. Traders wait for size-discovery sessions in order to mitigate their
price-impact costs. But a price impact is merely a wealth transfer, not a welfare cost. Thus,


                                                 2
size discovery represents a coordination failure. Venue operators offer size discovery because
of its popularity. But this popularity is based on private gains of price-impact avoidance that
do not contribute to social gains. For example, whatever a buyer loses through price impact
is gained by sellers. At the same time, size discovery detracts from a public-good externality,
exchange market depth.
    Although our results could be useful to regulators who are considering whether to limit or
even prohibit size-discovery trading, this paper does not take a normative approach to overall
market design. We are examining the social efficiency of market designs that are popular in
practice, namely price-discovery exchange markets augmented by size-discovery sessions that
set terms of trade based on exchange prices. We do not rule out improvements in overall
market design that might be achieved by replacing exchange markets with some alternative
approach to trade. We take the presence of exchange markets as given. We also do not consider
the augmentation of exchange markets with alternatives to size discovery, perhaps based on
mechanism designs that make use of multi-period price and trade data. We merely characterize
the costs associated with the common practice of point-in-time size-discovery sessions, at least
insofar as it is possible for us to do this with a tractable theoretical model.
    Section 2 offers some background on size-discovery practice and a summary of prior related
literature. Section 3 contains our basic model and main results. Section 4 offers some additional
equilibrium properties of the model related to welfare, the perfect Bayes property, robustness
to some alternative preference specifications, and ex-post optimality.
    Finally, Section 5 offers a discussion of some additional market-design and policy implica-
tions. Here, we consider the potential of a purposeful reduction in the allocative efficiency of
size-discovery sessions, with the goal of improving exchange market depth and gains from trade.
At least in the setting that we consider, this does not help overall market efficiency. We exam-
ine conditions under which eliminating the exchange market and relying only on size discovery
alone can improve efficiency. We also consider the competing incentives of exchange operators
and size-discovery operators, as well as the coordination failure associated with the lack of
incentive of size-discovery operators to consider the impact of their platforms on the depth of
price-discovery exchange markets. We raise the potential for policy intervention, including the
implications of the recent European Union “double-cap” rules on dark-trade venues.


2    Background
The potential harm to the exchange price-formation process caused by size-discovery venues has
been an issue of debate among practitioners and policy makers, and is also a point of contention



                                               3
in academic research.3 In January 2018, the European Union4 added rules associated with the
Markets in Financial Instruments Directive II (MiFiD II) that place a cap on the volume of
trade transacted in dark pools, in order to “not unduly harm price formation.” This “double
cap” effectively restricts aggregate dark-pool volume to 8% of total trade volume in affected
instruments, and the fraction of trade on any dark pool to 4% of total volume.5 Similar caps
or other restrictions on dark-pool trading have been implemented by regulations in Canada
and Australia. However, regulators have expressed concern that the effectiveness of this rule
may be reduced by exemptions for systematic internalizers (another form of size discovery) and
for large trades.6 Indeed, Johann, Putnins, Sagade, and Westheide (2019) find that dark-pool
bans have simply diverted trade from dark pools to “quasi-dark” trading mechanisms, and
have caused a relatively low amount of trade volume to return to exchange markets. They
find a negligible impact of dark-pool caps on market liquidity and short-term price efficiency.
European Securities and Markets Authority (2020) found that the double volume cap (DVC)
limits on dark trading in Europe have led to an increase in periodic-auction trading, which
was intended to avoid the DVC limits. Similar findings were reported by French and German
official studies.7
    The most common forms of size discovery used in current market practice are workups,
matching sessions, and block-crossing dark pools. As of late 2017, according to Rosenblatt
Securities, dark pools account for about 15% of U.S. equity trading volume.8 In the market
for U.S. Treasury securities, workup is heavily used on the two dominant inter-dealer electronic
trade platforms, BrokerTec and eSpeed. Fleming and Nguyen (2015) estimate that workup
accounts for 43% to 56% of total trading volume on the largest Treasuries trade platform,
BrokerTec. Once a trade is executed on BrokerTec’s limit-order book at some price, a workup
session can be opened for potential additional trading at the same “frozen” price. The original
buyer and seller and other platform participants may submit additional buy and sell orders
   3
     See, for example, CFA Institute (2012) and the discussions of Zhu (2014) and Ye (2016).
   4
     The exact implementation dates of each piece of MiFiD II vary, see https://www.fca.org.uk/markets/
mifid-ii.
   5
     Article 5 restricts the waivers of Article 4 such that “the percentage of trading in a financial instrument
carried out on a trading venue under those waivers shall be limited to 4% of the total volume of trading in
that financial instrument on all trading venues across the Union over the previous 12 months,” and “overall
Union trading in a financial instrument carried out under those waivers shall be limited to 8% of the to-
tal volume of trading in that financial instrument on all trading venues across the Union over the previous
12 months.” See http://eur-lex.europa.eu/legal-content/EN/TXT/?uri=uriserv:OJ.L_.2014.173.01.
0084.01.ENG for the text of Regulation (EU) No 600/2014.
   6
     As of June 2018, systemic internalizers account for 30% to 40% of total market share based on the French
market. https://www.ft.com/content/cca902f4-70a1-11e8-92d3-6c13e5c92914?
   7
     See Association Française des Marchés Financiers (2019) and German Ministry of Finance (2019). These
studies seem to view periodic auctions as failing to contribute to price formation.
   8
      See “Let There be Light, Rosenblatt’s Monthly Dark Liquidity Tracker,” September 2017, at http://
rblt.com/letThereBeLight.aspx?year=2017.


                                                       4
that are executed by time priority at this workup price. Trade on the central-limit-order book
is meanwhile suspended.9
    Matching sessions are a feature of some electronic platforms for trading corporate bonds10
and credit default swaps (CDS). The markets for corporate bonds and CDS are distinguished
by much lower trade frequency than those for treasuries and equities. Matching sessions, corre-
spondingly, are less frequent and of longer duration. A distinctive feature of matching sessions
is that the fixed price is typically chosen by the platform operator.11 Collin-Dufresne, Junge,
and Trolle (2020) find that matching sessions and workups account for 71.3% of trade volume
for the most popular CDS index product, known as CDX.NA.IG.5yr, a composite of 5-year
CDS referencing 125 investment-grade firms, and 73.5% of trade volume for the corresponding
high-yield index product.
    Trade platforms for interest-rate swaps also commonly incorporate workup or matching-
session mechanisms, as described by BGC (2015), GFI (2015), Tradeweb (2014), and Tradition
(2015). The importance of workup for the interest-rate swap market is discussed by Wholesale
Markets Brokers’ Association (2012) and Giancarlo (2015).
    Empirical evidence regarding the impact on exchange market performance of size-discovery
trade is mixed, and limited to equity markets. Size discovery is used far more heavily in bond
and swap markets. Degryse, De Jong, and van Kervel (2015) examine trading in Dutch equities
across lit (exchange) and unlit trading venues, finding that a one-standard-deviation increase
in dark trading activity for a particular stock reduces their metric of lit market depth in that
stock by 5.5%. Nimalendran and Ray (2014) also find that dark trading is associated with
greater price impact in lit markets. Hatheway, Kwan, and Zheng (2017) add to the evidence
that dark venues harm exchange market liquidity. Using a natural experiment induced by an
SEC rule change, however, Farley, Kelley, and Puckett (2017) find no effect of dark trading on
exchange market depth. In these studies, dark trading includes not only size-discovery trade,
but also other forms of trade that do not have pre-trade price transparency, or that involve
hidden trades such as “iceberg” orders. Buti, Rindi, and Werner (2011) estimate that dark
pools can actually improve exchange inside-quote depth.12 The SEC’s Division of Trading and
   9
     For more details on BrokerTec’s workup protocol, see Fleming and Nguyen (2015), Fleming, Schaumburg,
and Yang (2015), and Schaumburg and Yang (2016). Liu, Wang, and Wu (2015) provide additional evidence
on workups in the GovPX dataset, which focuses on off-the-run Treasury securities.
  10
     According to SIFMA (2016), matching sessions are provided by Codestreet Dealer Pool (pending release),
Electronifie, GFI, Latium (operated by GFI Group), ICAP ISAM (pending release), ITG Posit FI, Liquidity
Finance, and Tru Mid.
  11
     GFI, for example, chooses a matching-session price that is based, according to SIFMA (2016), on “GFI’s
own data (input from the internal feeds), TRACE data, and input from traders.” On the CDS index trade
platform operated by GFI, the matching price “shall be determined by the Company [GFI] in its discretion,
but shall be between the best bid and best offer for such Swap that resides on the Order Book.”
  12
     The inside-quote depth is the number of shares available at the best bid and best offer on the limit order



                                                      5
Markets (2013) provide a more detailed summary of empirical evidence regarding the impact
of dark trade on exchange markets.
    In prior work on mechanism design in dynamic settings, Bergemann and Välimäki (2010)
show that a generalization of the Vickrey-Clarke-Groves pivot mechanism can implement ef-
ficient allocations in dynamic settings with independent private values. Similarly, Athey and
Segal (2013) and Pavan, Segal, and Toikka (2014) study optimal mechanism designs in dynamic
settings with independent types. As opposed to this prior research, we focus on a market setting
in which agents cannot be obliged13 to participate in mechanism sessions or to abstain from
trading on existing exchanges.
    Dworczak (2020) precedes this paper in considering a mechanism design problem in which
the designer cannot prevent agents from participating in a separate market. Beyond that like-
ness of perspective, the problems addressed by our respective models are quite different. Ollár,
Rostek, and Yoon (2017) address a design problem associated with double-auction markets,
but focus instead on information revelation within the market, rather than an augmentation
of the double-auction market with mechanism-based sessions. Du and Zhu (2017) and Budish,
Cramton, and Shim (2015) consider the optimal frequency of batch auctions as a market-design
approach. Pancs (2014) analyzed the implications of workup for its ability to mitigate front-
running.14


3     Augmenting price discovery with size discovery
This section presents the main model and results. We consider a stochastic market game
consisting of a continually operating “price-discovery” exchange market that is augmented
with randomly timed size-discovery sessions. On the exchange, modeled as a sequential double-
auction market, investors strategically avoid price impact, causing a socially inefficient delay in
the rebalancing of asset positions across traders. The social costs of the strategic avoidance of
exchange price impact are well covered by the results of Vayanos (1999), Rostek and Weretka
book.
   13
      Specifically, we always impose an ex-post participation condition that, at every mechanism session, all
traders prefer participation to the outside option of not entering this mechanism and trading in a double-
auction market until the next mechanism. In contrast, Pavan, Segal, and Toikka (2014) force agents to commit
at time zero to participate in all future mechanisms (or post an arbitrarily large bond to be forfeited in the event
of exit), and Bergemann and Välimäki (2010) force agents to forgo all future mechanism participation in order
to sit out one mechanism event. Athey and Segal (2013) provide conditions under which efficient allocations
can be reached without participation constraints, but only if agents are arbitrarily patient relative to the most
extreme (finite) realization of uncertainty.
   14
      The seller in Panc’s model has private information about the size of his or her desired trade. The buyer is
either a “front-runner” or a dealer. If the seller cannot sell the entire large position in workup, he would need
to liquidate the remainder by relying on an exogenously given outside demand curve.



                                                         6
(2015), Du and Zhu (2017), and Duffie and Zhu (2017). Our main result is that the popular
practice of augmenting exchange markets with size discovery does not mitigate these social
costs, at least in our model setting, even though all traders wish to use size discovery if it is
available and even though each size-discovery session achieves a socially efficient reallocation of
the asset.
   The continuous-time presentation of our results is chosen for its expositional simplicity. Ap-
pendix F offers a discrete-time analogue. Although the discrete-time setting generates messier
looking results, it allows us to demonstrate a standard equilibrium robustness property, Perfect
Bayes. The equilibrium behavior of the discrete-time model converges to that of the continuous-
time model as the length of a time period shrinks to zero.


3.1     Preliminaries
We fix a probability space (Ω, F, P), the time domain [0, ∞), and an information filtration
F = {Ft : t ≥ 0} of sub-σ-algebras of F satisfying the usual conditions.15 The market is
populated by n ≥ 3 risk-neutral traders exchanging a divisible asset. The asset payoff π is
a finite-variance random variable with mean v. The payoff π is revealed publicly and paid
to traders at a random time T that is exponentially distributed with parameter r. Thus
E(T ) = 1/r. There is no further incentive to trade once the asset dividend is paid at time T ,
which is therefore the end time of the model.
    For purposes of submitting demands to the exchange, trader i has information given by
a sub-filtration Fi = {Fti : t ≥ 0} of F. The traders have symmetric information about
the asset payoff. Specifically, the conditional distribution of π given Ft is constant until the
payoff time T , so that no trader ever learns anything about π until the market ends. Traders
may, however, have asymmetric information about their respective asset positions at each time.
Price fluctuations are thus driven only by rebalancing demands, and not by learning about
ultimate asset payoffs. This informational setting is more relevant for markets such as those
for stock index products, major currencies, and fixed income products such as swaps and
government bonds. For example, there is typically symmetric information about the payoff of
a U.S. Treasury bill, but the price of a U.S. Treasury bill fluctuates randomly over time, partly
caused by shocks to the allocation of the bills across market participants.
  15
    Given our probability space, the “usual conditions” on the filtration are precisely defined in, for example,
Protter (2005). These conditions are that the filtration is complete, increasing, and right-continuous.




                                                       7
3.2     Trader excess inventories
The “excess inventory” of the asset held by trader i at time t is denoted zti . A trader’s excess
inventory in this model can be viewed as the trader’s total asset position net of the trader’s
desired asset position, so that all traders would ideally wish to achieve an excess inventory of
zero. The respective initial excess inventories of the asset for the n traders are given by a list
z0 = (z01 , z02 , . . . , z0n ) of finite-variance random variables, with z0i measurable with respect to F0i .
Each trader i can use the exchange market and size-discovery platform to change their excess
inventory zti by trading, as we now describe in detail.


3.3     The exchange market
In the continually operating exchange market, trader i submits an Fi -progressively measurable16
demand function Di : Ω×R+ ×R → R. Thus, in state ω at time t, if the outcome of the auction
price is p, trader i would buy the asset at the quantity “flow” rate Di (ω, t, p). Given an exchange
                                                                     RT
market price process φ, the total asset purchase of trader i is thus 0 Di (t, φt ) dt, assuming that
this integral exists. (As is typical for notational simplification, we suppress the state ω from
the expression.) A demand function Di for trader i is said to be admissible if, for each square-
integrable17 price process φ, the resulting demand process {Di (t, φt ) : t ≥ 0} is also square
                                                                                  RT
integrable, thus implying that the total expected exchange purchase cost E[ 0 Di (t, φt )φt dt] is
well defined.
    We only consider equilibria in which demand functions are of the form

                                      Di (ω, t, p) = a + bp + czti (ω),                                   (1)

for constants a, b < 0, and c that do not depend on the trader i, state ω, or time t, and where
zti is the excess inventory of trader i at time t, as explained in Section 3.2. To be clear, the
traders are not restricted to demand functions that take the simple form (1), but we will show
that in equilibrium each trader optimally chooses a demand function that is implemented by a
function of this affine form (1) if he or she assumes that the other traders do so. We focus on
equilibria that are symmetric, in the sense that the constants a, b, and c are the same for each
trader i. There may exist asymmetric linear equilibria, or nonlinear equilibria. For tractability
we focus exclusively on “symmetric affine equilibria,” those with demand functions of the form
(1), with the same coefficients. Because the excess-inventory process z i and the price process φ
  16
      A function X : Ω × R+ × R → R is progressively measurable with respect to Fi if it is measurable on
the product space (Ω × R+ × R, F ⊗ B(R+ ) ⊗ B(R)), where B( · ) denotes the Borel σ-algebra, and if, for any
Fi -adapted measurable process φ, the process (ω, t) 7→ X(ω, t, φ(ω, t)) is adapted.
                                                                               R     
   17                                                                             T
      A process u is square integrable if u is progressively measurable and E 0 u2t dt < ∞.


                                                      8
are naturally assumed to be observed by trader i, the demand function (1) is Fi -progressively
measurable, as required. Furthermore, we will show that, in equilibrium, z i and φ are square-
integrable processes, so that any demand function Di of the form (1) is also square integrable,
thus admissible.
    The exchange trade protocol is a double auction. That is, at time t, trades are executed
at a market-clearing price φt satisfying i Di (t, φt ) = 0, if such a price exists. For the special
                                        P

case (1) of symmetric affine demand functions, the dependence of the unique clearing price on
any given trader’s demand is characterized by the following lemma.

Lemma 1. Fix a trader j and time t. Suppose the affine demand function (1) is submitted by
every trader i 6= j. For any candidate demand d ∈ R by trader j, there is a unique price p
satisfying d + i6=j (a + bp + czti ) = 0. This clearing price is
              P


                                                           −1
                            p = Φ(a,b,c) (d; Zt−j ) ≡            d + (n − 1)a + cZt−j ,
                                                                                     
                                                                                                                (2)
                                                        b(n − 1)

where Zt−j ≡              zti .
                P
                   i6=j


    Thus, for any non-degenerate affine demand function used by n − 1 of the traders, there is
a unique market-clearing price corresponding to each quantity chosen by the remaining trader.
The proof is a straightforward calculation.18 Under the conditions of Lemma 1, from the
strategic viewpoint of trader i, it is therefore equivalent whether to submit a demand function
Di which, at each state ω and time t, is a demand schedule p 7→ Di (ω, t, p), or alternatively to
take the affine demand functions {Dj : j 6= i} of the other traders as given and to submit a
demand process D̂i : Ω × R → R that executes the quantity D̂ti at the price Φ(a,b,c) (D̂ti ; Zt−i ). An
equilibrium consistency condition is that these are outcome-equivalent, in that, for all (ω, t),

 D̂i (ω, t) = Di (ω, t, Φ(a,b,c) (D̂i (ω, t); Z −i (ω, t))) = a+bΦ(a,b,c) (D̂i (ω, t); Z −i (ω, t))+cz i (ω, t). (3)

    Trader i submits exchange demands strategically, bearing in mind the costly impact on the
clearing price Φ(a,b,c) d; Zt−i of his or her demand d. But this price impact is merely a wealth
                               

transfer among traders that has no direct social cost. In particular, it is not socially efficient
for traders to internalize their price-impact costs, as shown by Vayanos (1999), Rostek and
Weretka (2015), and Du and Zhu (2017).
  18
     Because b 6= 0, the following statements are equivalent: (i) d + i6=j (a + bp + czti ) = 0, (ii) −b(n − 1)p =
                                                                     P
                                                          
d + (n − 1)a + cZt−j , and (iii) p = − d + (n − 1)a + cZt−j /[b(n − 1)].




                                                            9
3.4    Excess inventory costs
As a motive for trade, the excess asset inventory of trader i is randomly shocked over time
with additional units of the asset. The cumulative shock to the excess inventory of trader
i by time t is Hti , for some finite-variance Fi -adapted Lévy process H i that is a martingale
with respect to F and thus with respect to the information filtration Fi of trader i. A simple
example is a Brownian motion with zero drift. The defining property of a Lévy process is
that it has iid increments over any set of equally long disjoint time intervals. Without loss of
generality, we take H0i = 0. The excess inventory shock processes H = (H 1 , . . . , H n ) need not
be independent, nor identically distributed, across traders, but we assume that H, T , π, and z0
are mutually independent. We assume that ni=1 H i is also a Lévy process with respect to F.
                                                 P

We let Zt ≡ i z0i + Hti denote the aggregate excess inventory.
              P

    Traders suffer costs associated with unwanted levels of inventory, whether too large or too
small. One may think in terms of a market maker that is attempting to run a matched book
of positions, but which may accept customer positions over time that shock its inventory. The
market maker may then trade so as to lay off excess inventories with other market makers.
    The market practitioners Almgren and Chriss (2001) proposed a simple model of excess
inventory costs for financial firms that is now popular among other practitioners and also in
the related academic research literature, by which the rate of excess inventory cost to trader
i at time t is γ(zti )2 , for some fixed coefficient γ > 0. With this cost model, trader i bears
                                                             RT
an expected total cost of future undesired inventory of E[ 0 γ(zti )2 dt]. The first-best (socially
optimal) allocation of the asset is that minimizing the total of the traders’ excess inventory
costs, which is the equal allocation given by zti = Z̄t , where Z̄t ≡ Zt /n is the average excess
inventory. The equal allocation remains socially optimal if the quadratic excess inventory cost
function z 7→ γz 2 is replaced with any convex even function, however we have been able to
obtain clearly stated results only for the quadratic special case.
    Although financial firms have no “psychic” aversion to risk, broker-dealers and asset-management
firms do have extra costs for holding excess inventory in illiquid or risky assets. These costs can
be related to regulatory capital requirements, collateral requirements, financing costs, agency
costs associated with a lack of transparency of the quality of the asset to higher-level firm
managers or clients, as well as the expected cost of being forced to suddenly raise liquidity
by quickly disposing of remaining inventory into an illiquid market. Although it has not been
given a structural micro-foundation, the quadratic holding-cost model that we use is common
in dynamic market-design models, including those of Vives (2011), Rostek and Weretka (2012),
Du and Zhu (2017), and Sannikov and Skrzypacz (2016).




                                              10
3.5     Size discovery
Size-discovery sessions are held at each of the event times τ1 , τ2 , . . . of a Poisson process N
with mean arrival rate λ > 0. The session-timing process N is independent of the other
primitive random variables, {H, T , π, z0 }. The k-th size-discovery session is announced at time
τk after exchange demand submissions have been made and the exchange price φ(τk ) has been
determined. That is, at time τk , the traders’ exchange demands are submitted and the exchange
price is determined before the traders are aware19 that there will be a size-discovery session.
Once the size-discovery session is announced, trader i either declines to participate in the session
or provides an excess-inventory report to the size-discovery platform. That is, the strategy of
trader i at the k-th session has an outcome in the space M = R ∪ {ν}, where the choice ν
denotes non-participation and any choice in R is a participating excess-inventory report. The
information filtration used by trader i for making size-discovery decisions is that generated by
both20 Fi and N . Traders are free to misreport their privately observed inventories. A reported
excess inventory is restricted to having finite variance. A truthful excess-inventory report from
trader i is given by µik = z i (τk ). If any trader i declines to participate, in that µik = ν, the
size-discovery platform does nothing – there are no transfers of cash or assets to any trader,
and the exchange market continues operating until the next size-discovery session is announced,
and so on. This formulation implies that our equilibrium condition of the optimality of truthful
reporting for the size-discovery strategy µi of trader i also includes the individual rationality
(IR) condition that trader i is actually willing to participate in excess-inventory reporting at
all size-discovery sessions. The size-discovery allocations are based on mechanism designs that
we describe in this section, and whose properties are developed in Appendix A.
    In practice, the timing of size-discovery sessions varies significantly across markets. For
example, workup sessions in BrokerTec’s market for Treasury securities occur at an average
frequency of about 600 times a day for the 2-year note, and about 1400 times a day for the 5-
year note, according to statistics provided by Fleming and Nguyen (2015). These size-discovery
sessions account for approximately half of all trade volume in Treasury securities on BrokerTec,
which is by far the largest trade platform for U.S. Treasurys, accounting for an average of
over $30 billion in daily transactions for each of the 2-year, 5-year, and 10-year on-the-run
Treasury notes. Consistent with our model, BrokerTec workup sessions are held at randomly
  19
     Specifically, for all t, Fti and {Nu − Nt : u ≥ t} are independent, but the left-continuous process N̂ , defined
by N̂t = lims↑t Ns , is adapted to Fi . This means that Fi does not satisfy the usual condition of right continuity,
but this does not matter for our analysis.
  20                                                                                                 i
     That is, the choice µik : Ω → M of trader i at the k-th session time is required to be F τk -measurable,
         i
where F t is the completion of the σ-algebra generated by Fti and {Ns : s ≤ t}. Our stochastic integrals are
                                                 i
defined with respect to the bigger filtration {F t : t ≥ 0}, which satisfies all of the usual conditions, including
right-continuity.


                                                         11
spaced times. As opposed to our model, however, the times of BrokerTec workup sessions
are not exogenous — they are chosen by market participants. In the corporate bond market,
“matching sessions,” another form of size discovery, occur with much lower frequency, such as
once per week for some bonds. The matching sessions on Electronifie, a corporate bond trade
platform, are triggered automatically by an algorithm that depends on the current order book
and the unfilled portion of the last order-book trade. Again, this differs from our simplifying
assumption that size-discovery reallocation sessions occur at independent exogenously chosen
times.
    A key feature of size-discovery mechanisms such as dark pools, workups, and matching
sessions, is that the size-discovery price terms are “frozen” when the size-discovery session is
held. In this way, price impacts are mitigated.21
    The role of the exchange price φt in our mechanism designs is analogous to that for con-
ventional forms of size discovery used in practice, such as workups and dark pools. In a dark
pool, as explained by Zhu (2014), the per-unit price is set by protocol to the immediately
preceding mid-price in a designated limit-order-book market. In BrokerTec’s Treasury-market
workup sessions, as explained by Fleming and Nguyen (2015), the frozen price used for workup
compensation is fixed at the last trade price in the immediately preceding order-book market
operated by the same platform provider. In matching sessions, the frozen price is set based on
an estimate of prevailing prices in recent trades. Thus, in dark pools, workup, and other forms
of size discovery used in practice, and also in this setting for our model, there is an incentive
for traders to bid strategically in the exchange market so as to avoid worsening their expected
cash compensation terms in the next size-discovery session, through their impact on exchange
prices. As we will show, this additional strategic incentive for shading exchange market bids
delays the rebalancing of positions across traders, causing a strict reduction in welfare relative
to a market with no size discovery.
    A size-discovery mechanism design consists of an asset transfer Y : Mn → Rn and a cash
transfer T : Mn × R → Rn that, given the already-determined exchange market price p, map
a vector µ of agent choices to a vector Y (µ) of asset transfers and a vector T (µ, p) of cash
transfers, respectively. In the event of the non-participation choice µi = ν for at least some
trader i, we take T (µ, p) = Y (µ) = 0.
  21
    Not all dark pools are designed primarily for the purpose of mitigating price impacts for large orders.
Drawing from an industry report by Rosenblatt Securities, Ye (2016) notes that “In May 2015, among the 40
active dark pools operating in the US, there are 5 dark pools in which over 50% of their Average Daily Volumes
are block volume (larger than 10k per trade). Those pools can be regarded as “Institutional dark pools,” and
they include Liquidnet Negotiated, Barclays Directx, Citi Liquifi, Liquidnet H20, Instinet VWAP Cross, and
BIDS Trading.” Other objectives of dark pool users include a reduction in the leakage of private information
motivating trade, and the avoidance of bid-ask spread costs. Some broker-dealers use their own dark pools to
internalize order executions among their clients.



                                                     12
    For purely technical reasons, we require Y and T to be measurable, and, when restricted to
the domain Rn × R that is based on participating excess-inventory reports, Y to be bounded by
a function that is Lipschitz, and T to be bounded by a second-order polynomial in (µ, p). All
of the specific size-discovery mechanisms that we consider in this paper satisfy these technical
requirements.
    We next consider two different mechanism designs for size discovery that achieve truthful
reporting and a socially efficient asset reallocation at each size-discovery session. A third size-
discovery mechanism, based on a common design for dark pools, is analyzed in Appendix
C.4. All three of these mechanisms assign budget-balanced cash transfers and exactly balanced
asset transfers given any possible vector of reports. In equilibrium, traders facing any of these
mechanisms find it individually rational to participate and incentive compatible to truthfully
report. There are likely to be other mechanism designs with these properties.

3.5.1   A dark-pool mechanism

The dark-pool mechanism design (Y, TD ) for size discovery assigns trades that are compensated
at a frozen price. The frozen price is given by the last exchange price. Formally, for any
(µ, p) ∈ Rn × R, the dark-pool size-discovery mechanism assigns trades and cash payments,
respectively, given by
                                                 Pn
                                         i            j=1   µj
                                       Y (µ) =                   − µi                          (4)
                                                   n
                                    TD (µ, p) = −p Y i (µ).
                                     i
                                                                                               (5)

    For expositional simplicity, (4) specifies additive rationing. In practice, dark pools commonly
specify proportional rationing, by which the heavy side of the market is rationed in proportion
to the sizes of individual orders on the heavy side. For example, with proportional rationing,
on the event that the total of buy orders exceeds the total quantity Q of sell orders, buyer
i is assigned the product of Q and the fraction of the total quantity of buy orders that were
submitted by buyer i. Appendix C.4 shows that our results are unchanged with proportional
rationing. Specifically, we consider a game in which size-discovery participants report a desired
trade size, which is proportionally rationed and then cleared at the frozen price given by the
last exchange price. We show that the resulting equilibria are allocatively identical to those for
the two size-discovery mechanisms considered in this section, linear-rationing dark pools and
linear-quadratic size discovery.
    Given truthful reporting, the asset transfer (4) generates the efficient post-session excess
inventory Z̄t for every trader. Truthful reporting is incentive compatible in the equilibria


                                                 13
that we consider. Intuitively, when agents take the previously determined exchange price as
frozen, thus not internalizing their own price impacts, they trade to an efficient allocation.
This idea is familiar from the allocative model of Walras (1877) and the implications of the
First Welfare Theorem. The dark-pool mechanism is exactly budget balanced because the total
asset reallocation i Y i (µ) is zero and Walras’ Law applies, in that the total cash transfer
                     P
P i
   i TD (µ, p) = 0 is always zero.


3.5.2      A linear-quadratic size-discovery mechanism

An alternative mechanism design (Y, TQ ) for size discovery that also induces truthful reporting
and a socially efficient allocation is given by the asset transfer, at any (µ, p) ∈ Rn × R, specified
by equation (4) and, for any fixed strictly negative constant κ0 , the linear-quadratic cash transfer

                                                           n
                                                                      !2
                                                           X                            p2
                      TQi (µ, p) = pµi + κ0 −nβ(p) +             µj        − pβ(p) +          ,           (6)
                                                           j=1
                                                                                       4κ0 n2

      where
                                                                          
                                            rv            −r     1
                                     β(p) =    +p            +                 .                          (7)
                                            2γ            2γ   2κ0 n2
The first term of the cash transfer TQi (µ, p) is the product of the frozen exchange price p and
the excess-inventory report µi . When combined with the quadratic second term, truth telling
is induced. The constant final term ensures that this design is budget feasible, in that the total
payment i TQi (µ, p) to the traders is at most zero for any trader reports, and is equal to zero
          P

in equilibrium. Appendix A demonstrates these and other properties of this mechanism design,
and states a particular choice for κ0 for which the cash transfers coincide with the Vickrey-
Clarke-Groves (VCG) mechanism22 transfers, making the mechanism strategy proof. Thus,
although more complicated than the dark-pool mechanism, the linear-quadratic mechanism is
more robust to noise in trader reporting.


3.6       Equilibrium
Given a size-discovery mechanism design (Y, T ), a symmetric equilibrium for the associated
stochastic game is defined by a collection (a, b, c) of affine demand-function coefficients with
the following properties:

  1. For each j, suppose trader j conjectures that all other traders use the strategy: (i)
 22
      This well-studied mechanism is based on the work of Vickrey (1961), Clarke (1971), and Groves (1973).


                                                      14
      exchange demands specified by the affine demand function with coefficients (a, b, c); (ii)
      participation in size discovery with truthful excess-inventory reporting. Then the same
      strategy is optimal for trader j.

   2. If each trader submits exchange demands specified by the affine demand function with
      coefficients (a, b, c), then the exchange market clears.


“Individual rationality” means the optimality for each agent of participating in size-discovery
and exchange-market trading whenever these protocols are offered, based on all current informa-
tion. We calculate and verify equilibria by solving each agent’s equilibrium stochastic control
problem for optimal exchange demands and size-discovery reporting, including participation
decisions, as follows.
    As we have noted, Lemma 1 implies that, given the affine demand functions of other traders,
it is equivalent from the viewpoint of trader i whether to choose a demand function Di :
Ω × R+ × R → R or to choose a square-integrable demand process D : Ω × R+ → R that
sets the clearing price Φ(a,b,c) (Dt ; Zt−i ). In a symmetric equilibrium with demand coefficients
(a, b, c), the problem faced by trader i can thus be reduced to choosing an admissible demand
process Di and an admissible sequence µi = {µi1 , µi2 , . . .} of size-discovery actions solving the
stochastic control problem
                                         sup E[J i (D, µ, 0) | F0i ],                            (8)
                                                       (D,µ)

where, for any time t0 ,
                                               Z           T         2                                  
              i
             J (D, µ, t0 ) =     zTD,µ π   −                       D,µ
                                                                γ zt                               D,µ
                                                                           + Φ(a,b,c) (Dt ; Zt − zt )Dt dt
                                                       t0
                                                               X
                                           +                         T i ((µk , µ−i                          D,µ
                                                                                 k ), Φ(a,b,c) (Dτk ; Zτk − zτk )),
                                                   {k: t0 <τk < T }


subject to
                                               Z       t                         X
                           ztj   =   z0j   +               D̂sj ds + Htj +                    Y j ((µk , µ−i
                                                                                                          k ))
                                                   0                         {k: t0 <τk <t}
                                               Z       t                         X
                       ztD,µ = z0i +                       Ds ds + Hti +                      Y i ((µk , µ−i
                                                                                                          k )),
                                               0                             {k: t0 <τk <t}

                                                              
taking µjk = z j (τk ) and D̂tj = a + bΦ(a,b,c) Dt ; Zt − ztD,µ + cztj .
   First, we consider equilibria for the linear-quadratic size-discovery mechanism (Y, TQ ). An
equilibrium with symmetric affine demand functions is characterized by demand-function co-

                                                                        15
efficients (a, b, c) with the property that, for each trader i, the stochastic control problem (8)
is solved by the demand function Di of (1) and the individual rationality of size-discovery
participation with truthful excess-inventory reports µik = z i (τk ). The individual rationality of
exchange market participation is automatically satisfied because non-participation at any time
is outcome-equivalent to the choice of zero demand.
    In equilibrium, the continuation value of trader i is shown in Appendix B to be

       V i (zti , Zt ) = E[J i (Di , µi , t) | Fti ]
                                                      
                                         γ 2       2γ                                2
                     = θi (λ, b) + vZ t − Z t + v − Z̄t zti − Z t − K(λ, b) zti − Z t ,
                                                                 
                                                                                               (9)
                                         r          r

where Z t = Zt /n and

                                      γ         λ
                      K(λ, b) =            −          ,                                       (10)
                                   r(n − 1) 2b(n − 1)
                                   1 γ σZ2
                                                      2
                                                                  ρi     2γ ρi
                                                                             
                                                      σZ    2
                       θi (λ, b) =         − K(λ, b)     + σi − 2      −         ,            (11)
                                   r r n2             n2          n       r n

with σZ2 = var( i H1i ), σi2 = var(H1i ), and ρi = cov(Z1 , H1i ). An explicit solution for the
                  P

equilibrium coefficient b is provided below.
    We will show that the symmetric affine equilibria for the dark-pool size-discovery de-
sign (Y, TD ) coincide precisely with those for linear-quadratic size-discovery mechanism design
(Y, TQ ). We also find that the maximal mean frequency λ̄ of size discovery (whether dark-pool
or linear-quadratic) is the unique positive solution of the equation
                                                   q
                                           3λ̄ +       8λ̄(r + λ̄) = (n − 2)r.                (12)

That is, with λ > λ̄, the relatively quick prospect of a size-discovery session would cause so
much bid shading on the exchange market that there is actually no market-clearing price. Of
course, beyond the lack of existence of exchange market equilibrium, this would also imply that
the size-discovery platform loses access to necessary price information.
     For 0 < λ ≤ λ̄, we will show that there are exactly two symmetric affine equilibria. The
demand function of one of these equilibria has a bigger slope |b| than that of the other. This
equilibrium therefore has higher order flow and greater market depth (lower price impact)
than the other. The following proposition characterizes these equilibria and calculates the
equilibrium associated with higher order flow, which is the more efficient of the two equilibria.
Even for this more efficient equilibrium, we show that size discovery makes every trader worse
off.


                                                             16
       Proofs of the following two propositions are provided in Appendices B and C, respectively.

Proposition 1. Fix any κ0 < 0 and the associated linear-quadratic size-discovery mechanism
design (Y, TQ ). If λ > λ̄, there is no equilibrium with demand functions of the symmetric affine
form (1). If 0 < λ ≤ λ̄, there exist precisely two such equilibria. If λ = 0, that is, with no
size discovery, there is a unique such equilibrium. Each of these equilibria has the following
properties.

   1. At time t, the exchange price is given by

                                                                        2γ
                                                φt = P (Z̄t ) ≡ v −        Z̄t .                                   (13)
                                                                         r
   2. For λ = 0, and for the more efficient of the two equilibrium in the case of λ > 0 (that
      with larger |b|, and producing the higher continuation value for all traders), the traders’
      value functions are given by (9) and the demand-function coefficients (a, b, c) are given by

                        a = −vb                                                                                    (14)
                                                            s                                
                                                                              2
                            −r2  3λ                               λ             4λn 
                         b=      − + (n − 2) +                       − (n − 2) −       <0                          (15)
                            8γ     r                               r              r
                              2γ
                         c=      b.                                                                                (16)
                               r

   3. For 0 < λ ≤ λ̄ and the more efficient of the two equilibria, market depth |b| and the
      value function V i of each trader i are strictly decreasing in the mean frequency λ of size-
      discovery sessions.23



Proposition 2. For any mean frequency λ of size-discovery, the symmetric equilibria in affine
demand functions for the linear-rationing dark-pool size-discovery mechanism (Y, TD ) coincide
with those for the linear-quadratic size-discovery design (Y, TQ ). That is, for any λ > λ̄,
there are no such equilibria, and otherwise the equilibria for (Y, TD ) and (Y, TQ ) have the same
demand-function coefficients (a, b, c), the same exchange market price process φ given by (13),
and, for each trader i, the same value function V i specified by (9) and excess-inventory process
zi.
  23
   That is, for the equilibrium with the larger absolute size of demand function coefficient |b|, the equilibrium
demand function price coefficient bλ is strictly increasing in λ on the domain [0, λ̄]. The pointwise strict
monotonicity of the value function V i in λ for this equilibrium then follows from the fact that the constant
K(λ, bλ ) of (10) is positive and strictly monotonically increasing in λ, which implies that θi (λ, bλ ) is also strictly
monotonically decreasing in λ.

                                                           17
    Appendix C.4 provides an analogous result for the case of proportional-rationing dark pools,
as commonly used in practice, for which the equilibria again have the same demand-function
coefficients (a, b, c), the same exchange market price process φ, and for each trader i, the same
value function V i and excess-inventory process z i .
    In equilibrium, whether with linear-quadratic size discovery or with dark-pool size discovery
(whether based on linear or proportional rationing), traders are strategic about their influence
on the expected terms of trade in subsequent size-discovery sessions through the impacts of
their exchange trading on the exchange market price. For example, a trader with a negative
excess inventory reduces exchange demands by even more than in the equilibrium without
size discovery. Focusing on the particular equilibrium defined by (14)-(16), as λ increases, the
expected total volume of trade in the double-auction market declines, given the incentive to wait
and achieve lower expected execution costs in the next size-discovery session, and also given the
incentive to shade bids in order to improve the expected terms of trade in size discovery. All
traders are made worse off. If size-discovery sessions are run “too frequently,” in that λ > λ̄,
these strategic incentives to shade bids become so powerful that the exchange market breaks
down (that is, no affine market-clearing optimal demand functions exist).
    These same strategic incentives give rise to multiple equilibria in the presence of size dis-
covery. Each trader is more willing to submit large orders if other traders are submitting large
orders, since the resulting market depth reduces price impact. Size discovery heightens this
strategic complementarity because there are now direct exchange price impacts and spillover
effects into the terms of trade for size discovery. The combined strategic complementarity in-
duces multiple equilibria: one in which traders coordinate to produce low market depth and
reduced exchange trading and another with higher market depth and more aggressive exchange
trading.
    Proposition 2 states that the two size-discovery mechanisms that we consider generate the
same equilibria. Intuitively, both mechanisms lead to the same efficient allocations by definition.
Traders that already have the efficient allocation z i = Z̄ when a size-discovery session occurs
must receive a cash transfer of zero in equilibrium, and by a straightforward calculation this
observation implies that both mechanisms lead to the same equilibrium cash transfers.24 It is
then intuitive that equilibrium exchange-trading strategies do not depend on which mechanism
is used. We formalize this intuition in Appendix C.
    We emphasize that traders optimally participate in size discovery and report truthfully in
any equilibrium. If we had relaxed our definition of equilibrium so as to include mutual best
  24
   By equation (6), if traders report truthfully, then the transfer to trader i given an exchange price p is the
sum of pz i and a linear-quadratic function f whose arguments are Z and p. The transfer to trader i is zero
when z i = Z̄, in which case f (Z) = −Z̄p.



                                                      18
responses involving no participation by any trader in size discovery, then there would have
been one additional equilibrium, with symmetric affine exchange trading and no size-discovery
participation, for any λ > 0. This equilibrium is of course equivalent to the symmetric affine
equilibrium with no size-discovery venue (λ = 0).
    Likewise, we do not consider equilibria with nonlinear exchange trading strategies. Such
equilibria might exist even when λ > λ̄. We only prove that for λ > λ̄, there are no constants
(a, b, c) that characterize an equilibrium in affine trading strategies. With affine exchange
trading strategies, zero exchange trading volume is inconsistent with the existence of a market-
clearing price. Thus, there cannot be an equilibrium with zero exchange trading volume, given
our definitions.


3.7    Intuition
In this section, we provide intuition for the key message of Propositions 1 and 2, that size
discovery reduces welfare. Here, we use only informal arguments. The formal result, stated in
Proposition 1, is proved in Appendix B.
    In equilibrium, each size-discovery session efficiently reallocates the asset among the traders.
However, in equilibrium, size discovery entails two welfare costs. First, traders are less willing
to incur price-impact costs on the exchange because they will later have the chance to re-
duce inventory imbalances with no direct price-impact costs at the next size-discovery session.
Traders therefore submit smaller orders than they would in the absence of size discovery, lead-
ing to slower reallocation of the asset on the exchange. This harms welfare through increased
excess-inventory costs. Second, traders further reduce the magnitudes of their exchange trades
in order to mitigate the impact of the exchange trades on the upcoming size-discovery terms
of trade, which depend on prior exchange prices. This further reduces welfare by increasing
excess-inventory holding costs. In this section, to explain the intuition for our result as simply
as possible, we ignore the second of these two welfare-cost channels and merely show that the
first cost is exactly offset by the efficiency gain associated with aggressive trade in size-discovery
sessions. It follows that, when combined, the two sources of welfare cost associated with size
discovery must outweigh the welfare gains.
    In order to focus on the first welfare cost, we simplify our setting so as to cut the link
between the terms of trade in size discovery and the exchange price-setting mechanism. To this
end, for any demand-function coefficients (a, b, c), we let

                                                          a + cZ̄t
                                       φ(a,b,c) (Zt ) ≡                                          (17)
                                                            −b



                                                  19
denote the equilibrium exchange price, as a function of the mean excess inventory, Z̄t . Rather
than the original control problem (8), trader i now chooses exchange demands D and size-
discovery reports µ to maximize the conditional expectation of
                                              Z   T         2                                
                i
              J (D, µ, t0 ) =   zTD,µ π   −               D,µ
                                                       γ zt                                 D,µ
                                                                  + Φ(a,b,c) (Dt ; Zt − zt )Dt dt
                                               t0
                                                      X
                                          +                 T i ((µk , µ−i
                                                                        k ), φ(a,b,c) (Zτk )).
                                              {k: t0 <τk < T }


    In this simplified setting, traders know that if they deviate from equilibrium exchange
orders and thus move the market-clearing price, their size-discovery transfers will be unaffected,
because size discovery will be based on the equilibrium price (17) rather than on the resulting off-
equilibrium market-clearing price. Although artificial, this simplifies our analysis by removing
the second welfare cost of size discovery mentioned above. That is, in this artificial setting,
traders are no longer concerned that their exchange trades will affect future size-discovery
transfers.
    We now show informally that the first of the welfare costs of size discovery is precisely
offset by its benefits. Specifically, we show that if there exists an equilibrium with demand
coefficients (a, b, c) for some fixed size-discovery frequency λ, then there exists an equilibrium
with the same value functions for any frequency λ0 ≤ λ̄. To see this, fix some λ and demand-
function coefficients (a, b, c) that comprise an equilibrium. Truthful reporting is optimal in
equilibrium, so under either of the size-discovery mechanisms considered in the previous section,
the equilibrium size-discovery cash transfers are

                                              φ(a,b,c) (Zτk )(zτik − Z̄τk ).

Size-discovery allocations are efficient. The Hamilton-Jacobi-Bellman (HJB) equation for opti-
mal demand submission by trader i is therefore

                                    σi2                 σ2
 0 = −γ(z i )2 + r(vz i − V (z i , Z)) + Vzz (z i , Z) + Z VZZ (z i , Z) + ρi VzZ (z i , Z)
                                     2                   2
   + sup{−Φ(a,b,c) (D; Z − z )D + Vz (z , Z)D} + λ V (Z̄, Z) − V (z i , Z) + φ(a,b,c) (Z)(z i − Z̄) .
                            i           i
                                                                                                   
      D


The distinction with our main model setting is that, here, artificially, the exchange demand D
has no effect on size-discovery terms of trade. The first-order condition in the HJB maximization
problem is
                       Vz (z i , Z) = Φ0(a,b,c) (D; Z − z i )D + Φ(a,b,c) (D; Z − z i ).     (18)

Because (a, b, c) constitutes an equilibrium, this first-order condition is solved by the solution

                                                            20
Di to the fixed-point problem

                                 Di = a + bΦ(a,b,c) (Di ; Z − z i ) + cz i .

A straightforward calculation shows that

                                                 Di = c(z i − Z̄),                                          (19)

so the exchange clearing price is indeed

                                   Φ(a,b,c) Di ; Z − z i = φ(a,b,c) (Z).
                                                        
                                                                                                            (20)

   Combining (18), (19), and the definition of Φ0(a,b,c) (D; Z − z i ), we have

                                                                     c
                              Vz (z i , Z) = φ(a,b,c) (Z) −               (z i − Z̄).
                                                                 b(n − 1)

Integration with respect to z i leaves the indirect utility

                                                       c   (z i )2       c
                 V (z i , Z) = φ(a,b,c) (Z)z i −                   +          z i Z̄ + f (Z),
                                                   b(n − 1) 2        b(n − 1)

for some f (Z) that does not depend on z i . Then,

                                                                            c                      2
                V (Z̄, Z) − V (z i , Z) + φ(a,b,c) (Z)(z i − Z̄) =                      z i − Z̄        .
                                                                        2b(n − 1)

It follows from algebra that

                                             i               i −c2
                 sup{−Φ(a,b,c) (D; Z − z )D + Vz (z , Z)D} =          (z i − Z̄)2 .
                  D                                          b(n − 1)

So, for any equilibrium demand coefficients (a, b, c), the HJB equation reduces to

                                               σi2                σ2
         0 = −γ(z i )2 + r(vz i − V (z i , Z)) +   Vzz (z i , Z) + Z VZZ (z i , Z) + ρi VzZ (z i , Z)
                                               2                   2
                     c2                        c                    2
                           (z i − Z̄)2 + λ                z i − Z̄ .
                                                                  
                −                                                                                           (21)
                  b(n − 1)                 2b(n − 1)




                                                        21
Now, for any alternative size-discovery frequency λ0 , we let

                                                               λ0 − λ
                                                c0 = c +
                                                                  2
                                                       b
                                                b0 = c0
                                                       c
                                                       a
                                                a0 = c0 .
                                                       c

From simple algebra,

                                      c0         (c0 )2         c        c2
                            λ0              −           = λ          −         .
                                 2b0 (n − 1) b0 (n − 1)     2b(n − 1) b(n − 1)

It follows that for any λ0 ∈ [0, λ̄], the same value functions V i solve the reduced HJB equation
(21) after substituting the new size-discovery frequency λ0 and the new demand coefficients
(a0 , b0 , c0 ). In this simplified setting, the optimality of truthful reporting depends on the value
functions and the price function φ(a,b,c) , but it is easy to calculate that φ(a,b,c) = φ(a0 ,b0 ,c0 ) , so
truthful reporting remains optimal. Since c0 /b0 = c/b by definition, the exchange demands
defined by (a0 , b0 , c0 ) satisfy the first-order condition (18).
     This informal argument implies that the equilibrium value functions in this simplified setting
do not depend on the mean size-discovery frequency λ.25 That is, changing λ has no effect on
welfare. This analysis ignores the second equilibrium channel by which size discovery harms
welfare, the reduction of exchange order aggressiveness in order to improve the expected terms
of trade in the upcoming size-discovery session. Any increase in λ exacerbates this second
welfare cost, simply because it increases the likelihood that the next size-discovery session will
be based on the current exchange price. The net effect of an increase in λ is therefore a reduction
in welfare, which is shown rigorously in Appendix B.


4        Further properties
This section further interprets our model.
  25
       We provide a formal proof of this result in Appendix D.




                                                          22
4.1    Welfare
Because traders maximize their expected total payoffs, welfare in this setting can be captured
as the sum of the traders’ continuation values, which is
                      n                               n                                        n
                      X
                                i
                                                      X                       nγ 2             X            2
         Ŵ (zt ) ≡         V       (zti , Zt )   =         θi (λ, b) + vZt −    Z t − K(λ, b)     zti − Z t .   (22)
                      i=1                             i=1
                                                                               r               i=1


In the more efficient equilibrium defined by (14)-(16), welfare is strictly monotonically declining
in the mean frequency λ of size discovery. That is, for the more efficient equilibrium, welfare gets
strictly lower as the frequency of size-discovery sessions is increased, until size-discovery sessions
are so frequent that the exchange price-discovery market breaks down. In particular, welfare
is strictly lower with size discovery than without size-discovery, the case of λ = 0. Indeed, as
stated by Proposition 1, for each λ > 0, in the better equilibrium, each trader’s value is strictly
declining in the frequency λ of size discovery. Although it is individually rational for traders
to participate in size-discovery if it is available, all traders would strictly prefer to commit to a
market design in which size discovery is not available.
    Indeed, reducing size-discovery is better for every trader, regardless of the initial cross-
sectional distribution z0 of the asset. That is, for any mean size-discovery frequencies λ ≤ λ̄
and λ0 < λ, the equilibrium (defined by (14)-(16)) associated with λ0 Pareto dominates that
associated with λ.


4.2    Ex-post optimality
Extending from the results of Du and Zhu (2017), our equilibrium strategies are ex-post optimal.
That is, for each trader i, the equilibrium strategy (Di , µi ) also solves the complete-information
version of problem (8), in which the information filtration of trader i is artificially replaced
with the complete-information filtration F, thus revealing the inventories of all of the other
agents. This property follows from the fact that even if equilibrium is redefined by relaxing
the measurability restrictions on agent strategies to F-measurability, the equilibrium optimal
strategies are unaffected.


4.3    Perfect Bayes
Although we are working here for expositional simplicity in a continuous-time setting, each
equilibrium that we propose may safely be considered to be a Perfect Bayesian Equilibrium.
That is, in light of the ex-post optimality property, beliefs about other traders’ inventories
are irrelevant. This is tied down rigorously in a discrete-time analogue of our model found


                                                                    23
in Appendix F. In discrete time, the ex-post optimality property implies subgame perfection
for the complete-information game. Moreover, the primitive parameters of the discrete-time
model and the associated discrete-time equilibrium bidding behavior converge to those for the
continuous-time model as the length of a time interval shrinks to zero. This convergence was
shown by Duffie and Zhu (2017) for a simpler version of this model, and applies also in the
current setting.


4.4     Equivalent behavior for alternative preference models
With respect to equilibrium behavior, our model is equivalent26 to one in which there is no
shock Hti to the level of excess inventory, but there is instead a Lévy process η i determining
the net rate of benefit at time t to trader i for asset position zti of ηti zti − γ(zti )2 .
    Our model is also behaviorally equivalent to an infinite-horizon model in which traders
discount payoffs at the time preference rate r and the asset pays dividends continuously at
the exogenous rate rv, rather than a final lump-sum dividend with mean v. This equivalence
follows from an inspection of the HJB equation used in Appendix B to prove the optimality27
of traders’ candidate equilibrium trading and reporting strategies.


5      Alternative market designs and further implications
This section considers alternative market designs, and some implications of our findings.


5.1     The benefit of an initializing size-discovery session
If the initial aggregate excess inventory Z0 is observable, an obvious strict improvement in wel-
fare is obtained by an initializing size-discovery session. For example, Duffie and Zhu (2017)
  26
     To see this equivalence, suppose that η is an exogenous Lévy process, and consider a model with no
exogenous excess-inventory shocks in which a trader with position process y, determined only by the trader’s
initial position and trades, benefits at time t at the rate ηt yt − γyt2 . This preference model induces the same
behavior as that associated with the benefit rate
                                                                 2
                                            η2
                                                      
                                                             ηt
                              ηt yt − γyt2 − t = −γ yt −            = −γ(yt + Hti )2 ,
                                            4γ               2γ
       i                                       2
 R Ht = −ηt /(2γ), because the extra term ηt /(4γ) merely translates the total value by the constant
where
    T
E 0 ηt2 dt /(4γ). This preference model induces the same behavior as that for our basic model in which
there is a cost γ(zti )2 for a position process zti = yt + Hti that is determined by trade and by an exogenous Lévy
excess-inventory shock process Hti . By similar arguments, our model is also behaviorally equivalent to a model
that includes both an excess-inventory shock process and a preference shock process.
  27
     Verification of optimality follows from the HJB equation and “transversality” arguments similar to those in
Appendix B.


                                                        24
showed an improvement in welfare through a workup session at time zero, before the market
opens. Workup, however, does not efficiently reallocate the initial inventories. Appendix A
shows that a size-discovery session at time zero can in principle achieve a perfect initial alloca-
tion, if the mechanism designer is given information about the initial aggregate excess inventory
Z0 . We have shown, however, that welfare is not improved by running size discovery after time
zero, even though the traders’ inventories are perfectly reallocated at each size-discovery ses-
sion. The benefits of size discovery are offset by the dampening of order flow on the exchange
market caused by the prospect of future size-discovery sessions.


5.2     Does reducing the efficiency of size discovery help?
One might be drawn to conjecture that the mechanism designs for size discovery that we
have analyzed are simply “too efficient.” Indeed, the allocative efficiency and low effective
price impacts of our size-discovery mechanism designs offer such an attractive alternative for
executing trades, relative to submitting orders into the price-discovery market, that all of the
benefits of adding size discovery are more than offset by lost gains from trade in the exchange
market.
    Given this tension, one might hope to impair the efficiency of the size-discovery design just
enough to raise overall expected gains from trade. By this line of enquiry, one would look for
a loss of size-discovery efficiency that is more than offset by a gain in price-discovery allocative
efficiency through an improvement of market depth.
    We have discovered that this approach does not work, at least among linear-quadratic
schemes for size discovery. In Appendix G, we calculate a mechanism design in which the
              i
imbalance zt−    − Z̄t in the excess inventory of trader i is not completely eliminated in the
size-discovery session. Instead, only a specified fraction ξ of this imbalance is erased by size
discovery. For this analysis, we take the simpler case in which the aggregate excess-inventory
process Z is observable to the size-discovery platform operator.28 In this setting, any size-
discovery efficiency parameter ξ between 0 and 1 can be supported in equilibrium. As shown
in Appendix G, all traders’ value functions, and thus overall welfare, are invariant to the
size-discovery efficiency parameter ξ. That is, welfare is the same whether one runs perfect
reallocation mechanisms (ξ = 1), arbitrarily imperfect size-discovery mechanisms (0 < ξ < 1),
or no size-discovery mechanisms at all. For the case in which Zt is unobservable, our unreported
numerical analysis shows that welfare is strictly lower with impaired size-discovery mechanisms
than with no mechanisms at all.
  28
   We also slightly modify our notion of budget balance. Given the equilibrium strategies, the mechanism is
budget balanced with probability 1, but this might not be the case for arbitrary off-equilibrium reports.




                                                    25
5.3    Eliminating the exchange market
It is natural to ask whether simply getting rid of the price-discovery exchange market and
running only size-discovery sessions could improve welfare, relative to a setting with only price
discovery. Even if such a radical redesign of markets could be realistically contemplated, in
all of the cases that we have studied, the size-discovery scheme must either violate individual
rationality or rely unrealistically on information about the aggregate market supply Zt .
    In Appendix H, we take the setting of Section 3 except that (i) there is no exchange (price-
discovery) market and (ii), given the lack of price information for setting the terms of trade
in size discovery, the aggregate excess inventory Zt is assumed to be observable to the size-
discovery platform operator. We show that there is a unique equilibrium for the associated
dynamic game, and that the first-best allocation is achieved in the limit as the frequency of
size-discovery sessions approaches infinity.
    For the more realistic case of unobservable Zt , we show in Appendix I that an altered version
of our linear-quadratic size-discovery mechanism, run continuously (non-stop), can achieve the
first-best allocation in equilibrium. However, in the more realistic case in which the platform
operator cannot directly observe the aggregate supply Zt , it is impossible to make participation
in this mechanism individually rational. Other mechanisms might be able to do better. For
example, in unreported results, we have found that the dynamic pivot mechanism of Bergemann
and Välimäki (2010) achieves the efficient allocation in a discrete-time version of our primitive
model setting. However, the notion of individual rationality associated with that mechanism is
highly restrictive in practical market settings. Here, in order for participation to be individually
rational, a trader who fails to participate in any mechanism session must be permanently banned
from future mechanism sessions.
    In summary, even if it were practically feasible to eliminate exchange markets, it seems
difficult to replace exchange trading with efficient forms of size discovery without some form of
forced participation.


5.4    Size discovery can arise as a coordination failure
Our results imply that there may be a tenuous relationship between the operators of size-
discovery and price-discovery platforms, respectively. Barring “omniscient” alternative infor-
mation sources, size-discovery platform operators rely heavily on lit-exchange price discovery
to set the terms of trade in size discovery. However, a size-discovery venue operator can draw
volume away from price-discovery markets by holding frequent size-discovery sessions. The
CFA Institute (2012) addresses general concerns in this area, summarizing with a comment
that “The results of our analysis show that increases in dark pool activity and internalization


                                                26
are associated with improvements in market quality, but these improvements persist only up
to a certain threshold. When a majority of trading occurs in undisplayed venues, the benefits
of competition are eroded and market quality will likely deteriorate.”
    The conflicting incentives of independent lit-exchange and size-discovery venue operators
could in some cases lead toward integration of the sponsors of price-discovery platforms and
size-discovery platforms for trading the same asset, along the lines of BrokerTec, which operates
both of these protocols for treasuries trading on the same screen-based platform.29 If, however,
an operator of price-discovery and size-discovery platforms were to place tight volume restric-
tions on its size-discovery platform in order to maintain the depth of its price-discovery plat-
form, a competing platform operator could enter and attract volume into its own size-discovery
platform. For example, suppose an integrated operator were to allow traders to participate in
size-discovery sessions only to the extent that they contribute to exchange market depth. A
competing platform operator could then open an alternative size-discovery venue with no such
restriction. The entering size-discovery platform operator could earn rents, for example in the
form of fees or profits on cross-services, because it is often strictly beneficial for traders to par-
ticipate in size-discovery sessions. (In our model, any trader i whose current excess inventory zti
is not equal to the average excess inventory Z̄t has a strictly positive private benefit associated
with participation in a size-discovery session held at time t.) The entering service provider does
not internalize the costs to an incumbent exchange operator of lost volume-related fees, nor to
market participants for reduced allocative efficiency. That is, competition among trade venue
operators can lead to a coordination failure.
    As we noted in the introduction, regulators have attempted to cure market-coordination
failures that they associate with size discovery. In 2018, for example, the European Union
placed strict caps on volumes of trade executed in dark pools. Johann, Putnins, Sagade,
and Westheide (2019), however, found that these rules have been evaded with “quasi-dark”
trading mechanisms. These include internal crossing, by which a broker-dealer matches its own
customers’ buy and sell orders internally at the exchange price, rather than sending these orders
to the exchange. As another implicit form of size-discovery trade that is permitted by Section
17a-7 of the Investment Company Act of 1940, a mutual fund management firm is permitted to
trade assets between the different funds that it manages, at the “independent current market
price.”
    Zhu (2014) has shown that in a setting with asymmetric information about asset payoffs,
there tends to be a selection bias by which relatively informed investors migrate toward price-
  29
    Even in this case, however, Schaumburg and Yang (2016) point to some interference arising from price
information arriving during size-discovery sessions from the simultaneous operation of Treasury futures trading
on the Chicago Mercantile Exchange.



                                                      27
discovery markets and relatively less informed investors migrate toward dark pools. This seems
to suggest support for robust trade volumes on both types of venues. On the other hand,
Zhu (2014) addresses the case of dark pools that promote this selection effect with delays in
dark-pool order execution caused by rationing, because rationing discourages informed investors
who want to act quickly on their information. As we have pointed out, dark-pool rationing
is a relatively crude mechanism design for size-discovery. Although we have not analyzed the
implications in our setting of adding asymmetric information about asset payoffs, one may
anticipate from our results that more efficient mechanism designs than those currently used
in dark pools would be less discouraging to informed investors. This could call into question
the robustness of a market design that allows size-discovery venues to free-ride on the price
information coming from lit exchanges, while also having a significant ability to draw volume
away from lit exchanges.



References
Almgren, R., and N. Chriss. 2001. Optimal execution of portfolio transactions. Journal of Risk
  3:5–40.

Arrow, K. 1979. The property rights doctrine and demand revelation under incomplete infor-
  mation. In M. Boskin, ed., Economics and Human Welfare. Academic Press, Cambridge,
  Massachusetts.

Association Française des Marchés Financiers. 2019. Impact of the mifir volume
  cap mechanism on the microstructure of european equity markets.        AMAFI,
  Paris.    https://www.google.com/url?sa=t&rct=j&q=&esrc=s&source=web&cd=&ved=
  2ahUKEwjqpten8_fpAhVKFzQIHdtGCpAQFjAAegQIAxAB&url=http%3A%2F%2Fwww.amafi.
  fr%2Fdownload%2Fpages%2Fd1UWBwfYFt17f4sypgw1Nu11BP82vhbbgaPWbHOV.pdf&usg=
  AOvVaw1fgDR6rsH-s9rokQJe31Vd.

Athey, S., and I. Segal. 2013. An efficient dynamic mechanism. Econometrica 81:2463–85.

Bergemann, D., and J. Välimäki. 2010. The dynamic pivot mechanism. Econometrica 78:771–
  89.

BGC. 2015. BGC Derivative Markets, L.P. Rules. https://www.cftc.gov/sites/default/
 files/groups/public/@otherif/documents/ifdocs/orgsefbgcexhibitm160128.pdf.

Budish, E., P. Cramton, and J. Shim. 2015. The high-frequency trading arms race: Frequent
  batch auctions as a market design response. Quarterly Journal of Economics 130:1547–621.

                                              28
Buti, S., B. Rindi, and I. M. Werner. 2011. Diving into dark pools. Working Paper, Fisher
  College of Business, Ohio State University. https://papers.ssrn.com/sol3/papers.cfm?
  abstract_id=1630499.

CFA Institute. 2012. Dark pools, internalization, and equity market quality. White paper, CFA
  Institute. https://www.cfapubs.org/doi/pdf/10.2469/ccb.v2012.n5.1.

Clarke, E. 1971. Multipart pricing of public goods. Public Choice 2:19–33.

Collin-Dufresne, P., B. Junge, and A. B. Trolle. 2020. Market structure and transaction costs
  of index CDSs. Journal of Finance forthcoming https://doi.org/10.1111/jofi.12953.

d’Aspremont, C., and L.-A. Gérard-Varet. 1979. Incentives and incomplete information. Journal
  of Public Economics 11:25–45.

Degryse, H., F. De Jong, and V. van Kervel. 2015. The impact of dark trading and visible
  fragmentation on market quality. Review of Finance 19:1587–622.

Division of Trading and Markets. 2013. Equity market structure literature review, Part I:
  market fragmentation. U.S. Securities and Exchange Commission, https://www.sec.gov/
  marketstructure/research/fragmentation-lit-review-100713.pdf.

Du, S., and H. Zhu. 2017. What is the optimal trading frequency in financial markets? Review
 of Economic Studies 84:1606–51.

Duffie, D., and H. Zhu. 2017. Size discovery. The Review of Financial Studies 30:1095–150.

Dworczak, P. 2020. Mechanism design with aftermarkets: Cutoff mechanisms. Econmetrica
 forthcoming.

European Securities and Markets Authority. 2020. Consultation paper mifid ii/ mifir review
  report on the transparency regime for equity and equity-like instruments, the double volume
  cap mechanism and the trading obligations for shares. ESMA, Paris.

Farley, R., E. Kelley, and A. Puckett. 2017. Dark trading volume and market quality: A natural
  experiment. Working paper, University of Tennessee, Knoxville. http://www1.villanova.
  edu/content/dam/villanova/VSB/assets/marc/marc2018/SSRN-id3088715.pdf.

Fleming, M., and G. Nguyen. 2015. Order flow segmentation and the role of dark trad-
  ing in the price discovery of U.S. treasury securities. Working Paper, Federal Re-
  serve Bank of New York. https://www.newyorkfed.org/medialibrary/media/research/
  staff_reports/sr624.pdf.

                                             29
Fleming, M., E. Schaumburg, and R. Yang. 2015.          The evolution of workups
  in the U.S. treasury securities market.  Liberty Street Economics, Federal Re-
  serve Bank of New York. http://libertystreeteconomics.newyorkfed.org/2015/08/
  the-evolution-of-workups-in-the-us-treasury-securities-market.html.

Fudenberg, D., and J. Tirole. 1991. Game theory. Cambridge, Massachusetts: MIT press.

German Ministry of Finance. 2019.    Necessary amendments and revisions to sec-
 ondary market provisions in MiFID and MiFIR. Position paper, German Ministry
 of Finance. https://www.bundesfinanzministerium.de/Content/DE/Standardartikel/
 Themen/Internationales_Finanzmarkt/Positionspapiere-Mifid-Mifir.html.

GFI. 2015.     GFI Swaps Exchange LLC rulebook.         GFI Technical Report.
 https://www.cftc.gov/sites/default/files/stellent/groups/public/@otherif/
 documents/ifdocs/exhibitm1rulebookgfiswaps.pdf.

Giancarlo, J. C. 2015.     Pro-reform reconsideration of the CFTC swaps trading
  rules: Return to Dodd-Frank.     Commodity Futures Trading Commission Technical
  Report. https://www.cftc.gov/sites/default/files/idc/groups/public/@newsroom/
  documents/file/sefwhitepaper012915.pdf.

Groves, T. 1973. Incentives in teams. Econometrica 41:617–31.

Hatheway, F., A. Kwan, and H. Zheng. 2017. An empirical analysis of market segmentation on
  U.S. equity markets. Journal of Financial and Quantitative Analysis 52:2399–427.

Johann, T., T. Putnins, S. Sagade, and C. Westheide. 2019. Quasi-dark trading: The ef-
  fects of banning dark pools in a world of many alternatives. U.S. Securities and Exchange
  Commission, http://www.fmaconferences.org/Glasgow/Papers/working_paper.pdf.

Klemperer, P. D., and M. A. Meyer. 1989. Supply function equilibria in oligopoly under uncer-
  tainty. Econometrica 57:1243–77.

Liu, S., J. Wang, and C. Wu. 2015. Liquidity frictions, trading and volatility: Evidence
  from the us treasury market. Washington State University, Working paper. http://www.
  fmaconferences.org/Sydney/Papers/TradingandVolatility_LiuWangWu_FMAAsia.pdf.

Myerson, R. B., and M. A. Satterthwaite. 1983. Efficient mechanisms for bilateral trading.
 Journal of economic theory 29:265–81.

Nimalendran, M., and S. Ray. 2014. Informational linkages between dark and lit trading venues.
  Journal of Financial Markets 17:230–61.

                                             30
Ollár, M., M. Rostek, and J. H. Yoon. 2017. Privacy in markets. Working paper, Department
  of Economics, University of Wisconsin, Madison. https://papers.ssrn.com/sol3/papers.
  cfm?abstract_id=3071374.

Pancs, R. 2014. Workup. Review of Economic Design 18:37–71.

Pavan, A., I. Segal, and J. Toikka. 2014. Dynamic mechanism design: A Myersonian approach.
  Econometrica 82:601–53.

Protter, P. 2005. Stochastic integration and differential equations, second edition. Heidelberg:
  Springer.

Rostek, M., and M. Weretka. 2012. Price inference in small markets. Econometrica 80:687–711.

———. 2015. Dynamic thin markets. Review of Financial Studies 28:2946–92.

Sannikov, Y., and A. Skrzypacz. 2016.  Dynamic trading: Price inertia and front-
  running.    Working paper, Graduate School of Business, Stanford University.
  https://economics.uchicago.edu/sites/economics.uchicago.edu/files/uploads/
  PDF/sannikov_dynamic_trading.pdf.

Schaumburg, E., and R. Yang. 2016. The workup, technology, and price discovery in the
  interdealer market for U.S. treasury securities. Liberty Street Economics, Federal Re-
  serve Bank of New York. http://libertystreeteconomics.newyorkfed.org/2016/02/
  the-workup-technology-and-price-discovery-in-the-interdealer-market-for-us-treasury-se
  html.

SIFMA. 2016.         SIFMA electronic bond trading report:     US corporate & mu-
  nicipal securities.     Technical Report, Securities Industry and Financial Mar-
  kets       Association.         https://www.sifma.org/wp-content/uploads/2017/05/
  sifma-electronic-bond-trading-report-us-corporate-and-municipal-securities.
  pdf.

Tradeweb. 2014. Market regulation advisory notice – work-up protocol. Tradeweb Tech-
  nical Report. http://www.tradeweb.com/uploadedFiles/Tradeweb/Content/About_Us/
  Regulation/DW%20SEF%20MRAN%20-%20Work-Up%20Protocol%20(12.29.14)v2.pdf.

Tradition. 2015. Tradition SEF platform supplement. Tradition Technical Report. http://
  www.traditionsef.com/assets/regulatory/rulebooks/Rulebook-2015-05.pdf.

Vayanos, D. 1999. Strategic trading and welfare in a dynamic market. The Review of Economic
  Studies 66:219–54.

                                              31
Vickrey, W. 1961. Counterspeculation, auctions and competitive sealed tenders. Journal of
  Finance 16:8–37.

Vives, X. 2011. Strategic supply function competition with private information. Econometrica
  79:1919–66.

Walras, L. 1877. Eléments d’economie politique pure, fourth edition. Lausanne: L. Corbas.

Wholesale Markets Brokers’ Association. 2012. Comment for proposed rule 77 FR 38229.
 WMBA Technical Report. https://comments.cftc.gov/publiccomments/ViewComment.
 aspx?id=58343.

Wilson, R. 1979. Auctions of shares. Quarterly Journal of Economics 93:675–89.

Ye, L. 2016. Understanding the impacts of dark pools on price discovery. Working paper, The
  Chinese University of Hong Kong, Shenzhen. https://arxiv.org/pdf/1612.08486.pdf.

Zhu, H. 2014. Do dark pools harm price discovery? Review of Financial Studies 27:747–89.




                                             32
Appendices

       The appendices provide auxiliary results and proofs.


A         A mechanism design for size discovery
Our dynamic trading game involves continual exchange trading punctuated by occasional size-
discovery sessions. This appendix focuses on a static setting and on a linear-quadratic (LQ)
class of mechanism designs for size-discovery sessions. This mechanism design is tractable when
inserted into the dynamic setting of our main model. We show that this LQ class of mechanism
designs contains a mechanism that is efficient, budget balanced, strategy proof, and ex-post
individually rational.
    Our mechanism designer, say a trade platform operator, elicits reports from each of the n
traders about their asset positions, and based on those reports makes cash and asset transfers.
For the purposes of this appendix, we will initially assume that the platform operator can
observe the current aggregate inventory,30 or equivalent information. In our main application,
this equivalent information is obtained from the immediately prior exchange price. Without
loss of generality, we take t = 0, and denote Z0 simply as Z.
    A report from trader i is a random variable ẑ i that is measurable with respect to the
information set F0i of trader i. Given a list ẑ = (ẑ 1 , . . . , ẑ n ) of trader reports, a reallocation is
a list y = (y 1 , . . . , y nP) of finite-variance random variables that is measurable with respect to31
{Z, ẑ} and satisfies ni=1 y i = 0.
    Anticipating the form of post-mechanism indirect utility for the equilibrium of our eventual
model of a dynamic market, we assume that the value to trader i of a given reallocation y is
E[V i (z0i + y i , Z̄) | F0i ], where Z ≡ Z/n and V i : R2 → R is of the form
                                                                                     2
                        V i (z i , Z̄) = ui (Z̄) + β0 + β1 Z        zi − Z − K zi − Z ,
                                                                         
                                                                                                           (23)

where ui : R → R is a real-valued measurable function to be specified such that ui (Z̄) has a
finite expectation and β0 , β1 , and K are real numbers, with K > 0, that do not depend on i.
    In our application, the value V i (z i , Z̄) is measured in units of wealth, allowing us to use
a simple additive welfare criterion. A reallocation is thus welfare maximizing given a list ẑ of
reports if it solves                           " n                       #
                                                 X
                                    sup E            V i (z0i + y i , Z̄) ,
                                        y ∈ Y(ẑ,Z)     i=1

where Y(ẑ, Z) is the set of reallocations. A reallocation is said to be perfect if it is welfare
maximizing for the case in which the reports are perfectly revealing,32 for example when ẑ i = z0i .
From the quadratic costs of asset dispersion across traders reflected in the last term of V i (z i , Z̄),
it is immediate that a reallocation y is perfect if and only if z0i + y i = Z for all i.
  30
     We use the terms “inventory” and “excess inventory” interchangeably.
  31
     That is, z is measurable with respect to the sub-σ-algebra of F generated by {ẑ, Z}.
  32
     A report ẑ i from trader i is perfectly revealing if z0i is measurable with respect to {Z, ẑ i }.



                                                           33
    We will now derive a mechanism that achieves a perfect reallocation. Specifically, a mech-
anism is a function that maps Z and a list ẑ of reports to a reallocation denoted Y (ẑ) =
(Y 1 (ẑ), . . . , Y n (ẑ)) and a list T (ẑ, Z) = (T 1 (ẑ, Z), T 2 (ẑ, Z), . . . , T n (ẑ, Z)) of real-valued “cash”
transfers with finite expectations. In the game induced by a mechanism (Y, T ), ẑ is an equilib-
rium if, for each trader i, the report ẑ i solves

                                                  sup U i ((µ, ẑ −i )),
                                                    µ


where, for any list ẑ of reports,

                               U i (ẑ) = E V i (z0i + Y i (ẑ), Z̄) + T i (ẑ, Z) | F0i ,
                                                                                       
                                                                                                                   (24)

and where we adopt the standard notation by which for any x ∈ Rn and w ∈ R,

                                (w, x−i ) ≡ (x1 , x2 , . . . , xi−1 , w, xi+1 , . . . , xn ).

In words, each trader i takes the strategies of the other traders as given and chooses a report ẑ i
depending only on the information available to trader i that maximizes the conditional expected
sum of the reallocated asset valuation and the cash transfer.
   For any constant κ0 < 0 and any Lipschitz-continuous functions κ1 : R → R and κ2 :
R → R of the commonly observed aggregate inventory Z, we will consider the properties of the
mechanism Mκ defined by the asset reallocation
                                                 Pn      j
                                                  j=1 ẑ
                                      Y i (ẑ) =           − ẑ i                            (25)
                                                   n
and the cash transfer
                                                                 n
                                                                              !2
                                                                 X                                    κ21 (Z)
                Tκi (ẑ, Z) = κ1 (Z)ẑ i + κ0 n κ2 (Z) +               ẑ j        + κ1 (Z)κ2 (Z) +           .    (26)
                                                                 j=1
                                                                                                      4κ0 n2

     The first term of (26) is analogous to compensation at a fixed marginal price of κ1 (Z).
In Section 3.6, where we embed our size-discovery mechanism into a dynamic market game,
the “frozen price” κ1 (Z) is, in equilibrium, almost surely equal to the immediately preceding
exchange market price P (Z̄).
     Departing from forms of size discovery that are used in practice, we include the non-linear
second term of (26) in order to force trader i to internalize some of the quadratic cost of an
uneven cross-sectional distribution of the asset. The sum of the final two terms in (26) comprise
a fixed participation fee, which ensures that the platform operator does not lose money. That
                                the mechanism Mκ always leaves a weakly positive profit for the
is, for any list ẑ of reports, P
                                  n    i
platform operator because         i=1 Tκ (ẑ, Z) ≤ 0. In Section 3.6, we show that the dark-pool
mechanism, which simply posts a fixed price of κ1 (Z), has equivalent equilibrium allocative
properties. Unlike the simpler dark-pool mechanism, however, the linear-quadratic mechanism
Mκ is strategy proof, as we will now demonstrate.
     The following proposition characterizes equilibrium for the mechanism reporting game. The


                                                            34
proposition also shows that for a carefully chosen κ0 , each trader can actually ignore the re-
porting strategies of other traders.

A.1         Equilibrium of the mechanism design
Proposition 3. Consider a mechanism of the form Mκ , defined by any κ0 < 0, and any
Lipschitz-continuous κ1 ( · ) and κ2 ( · ).

   1. Suppose trader i anticipates that, for each j 6= i, trader j will submit the report ẑ j =
      z0j . There is a unique solution to the optimal report problem for trader i induced by the
      mechanism Mκ . This solution is ẑ i = z0i almost surely, if and only if

                                              −κ1 (Z) + ( n−1
                                                                            
                                                           n
                                                              ) β 0 + β 1 Z
                              κ2 (Z) = −Z +                                   .             (27)
                                                         2κ0 n
         That is, Mκ is a direct revelation mechanism if and only if κ2 (Z) is given by (27).

   2. Suppose κ2 (Z) is given by (27). If trader i anticipates the report ẑ j = z0j for each j 6= i,
      then the truthful report z ∗i = z0i is ex-post optimal, that is, optimal whether or not we
      take the special case in which trader i observes33 z0−i .

   3. For the list z ∗ = (z ∗1 , . . . , z ∗n ) of such truthful reports, the reallocation Y (z ∗ ) of (25) is
      perfect. That is, z0i + Y i (z ∗ ) = Z for all i.

   4. For any κ1 ( · ), for κ2 (Z) given by (27), and for κ0 = −K(n − 1)/n2 , the mechanism Mκ
      is strategy proof. That is, the truthful report z ∗i = z0i is a dominant strategy, being an
      optimal report for trader i regardless of the conjecture by trader i of the reports ẑ −i of the
      other traders.

   Proof: Fix a continuation value function V i for trader i, given by (23). In equilibrium,
trader i achieves the value

                           sup E V i (z0i + Y i (ẑ), Z̄) + Tκi (ẑ, Z) | F0i .
                                                                            
                                                                                         (28)
                                   ẑ i


    Fix reports ẑ j = z0j for j 6= i. Substituting (23) into (28), the quantity inside the expectation
of (28) is
                                                                                        2
                    ui (Z̄) + β0 + β1 Z̄ z0i + Y i (ẑ) − Z̄ − K z0i + Y i (ẑ) − Z̄
                                                              

                                              n
                                                      !2
                                            X
                                                    j                 i              κ21 (nZ̄)
                        + κ0 nκ2 (nZ̄) +         ẑ      + κ1 (nZ̄)(ẑ + κ2 (nZ̄)) +           .   (29)
                                             j=1
                                                                                      4κ0 n2

       We can write                         Pn
                                    i             j=1   ẑ j              Z − z0i   n−1 i
                                 Y (ẑ) =                      − ẑ i =           −    ẑ .
                                     n                                      n        n
                                              i
The terms in (29) that depend on ẑ sum to
  33
       To be able to observe z0−i means that z0−i is measurable with respect to F0i .


                                                                  35
                               2
                  n−1 i       n−1              2                            2
                                     z0i − ẑ i + κ0 nκ2 (Z) + Z − z0i + ẑ i + κ1 (Z)ẑ i .
                    
     β0 + β1 Z̄ −    ẑ − K
                   n           n

     The first derivative of this expression with respect to ẑ i is
                                         2
                     n−1              n−1
                                                z0i − ẑ i + 2κ0 (nκ2 (Z) + Z − z0i + ẑ i ) + κ1 (Z).
                                                         
      β0 + β1 Z̄ −            + 2K
                        n               n

The second derivative of (29) with respect to ẑ i is negative because K > 0 and κ0 < 0. It follows
that the unique solution of this first-order condition is the unique optimal report. Substituting
ẑ i with ẑ i = z0i in the first derivative and then equating the result to 0 implies that
                                                   
                                             n−1
                         0 = β0 + β1 Z̄ −             + 2κ0 (nκ2 (Z) + Z) + κ1 (Z).
                                                n

Thus, for any fixed κ1 ( · ) and κ0 , we find that

                                                      −κ1 (Z) + ( n−1
                                                                                                    
                                                                   n
                                                                      ) β0 + β1 Z
                                        κ2 (Z) = −Z +                                                                        (30)
                                                                 2κ0 n

is the unique choice for κ2 (Z) with the property that trader i optimally reports ẑ i = z0i . Since
this report maximizes the quantity inside the expectation of (28), it maximizes the objective
function, state by state. This reporting strategy therefore constitutes an ex-post equilibrium
of the mechanism game. At the equilibrium reports, we have
                                   Pn       j
                                     j=1 ẑ
                                              − ẑ i = − z0i − Z̄ .
                                                                 
                                      n
Thus, z0i + Y i (ẑ) = Z̄, as desired.
  For the special case in which
                                             −K(n − 1)
                                                       ,    κ0 =
                                                  n2
we can define Q ≡ j6=i ẑ j /n and calculate that
                 P

      n
                   !2
      X                                                        2
κ0          ẑ j        − K z0i + Y i ((ẑ i , ẑ −i )) − Z̄
      j=1
                                                                                                           2
                               2          i 2                i
                                                                                        2            n−1
               = κ0 (nQ) + κ0 (ẑ ) + 2κ0 nQẑ − K                     z0i   + Q − Z̄        −K                   (ẑ i )2
                                                                                                       n
                                      n−1 i i           
                              + 2K       ẑ z0 + Q − Z̄
                                       n
                                                                                            2
                               2          i 2
                                                                       2             n−1                         n−1 i i
                                                      z0i                                         (ẑ i )2 + 2K
                                                                                                                               
               = κ0 (nQ) + κ0 (ẑ ) − K                     + Q − Z̄         −K                                      ẑ z0 − Z̄ .
                                                                                       n                           n


                                                                    36
It is thus clear from equation (29) that the optimal report does not depend on Q. In this case,
ẑ i = z0i is therefore a dominant strategy.

   By the ex-post optimality property stated in Part 2 of the proposition, it is a Nash equilib-
rium34 of the complete-information game (in which all traders know z0 ) for traders to submit
the list z ∗ of reports. For the special case κ0 = −K(n − 1)/n2 , this is the unique Nash equilib-
rium because, for any trader i, the report z ∗i is a dominant strategy and because of the strict
concavity of U i ((µ, ẑ −i )) with respect to µ.

A.2        Individual rationality
We now consider whether trader i could do better by not entering the mechanism at all. From
this point, we always fix κ2 ( · ) as specified by (27). For arbitrary κ0 and κ1 ( · ), the mechanism
Mκ need not be individually rational. That is, there could be realizations of (z0i , Z) at which
trader i would strictly prefer V i (z0i , Z̄) over the expected equilibrium value to trader i. However,
because the platform operator observes Z, he or she can choose κ1 (Z) so as to ensure that all
traders strictly prefer to participate in the mechanism, except in the trivial case in which the
initial allocation is already perfect. That our equilibrium is budget balanced, efficient, incentive
compatible, and individually rational might at first seem surprising given the results of Myerson
and Satterthwaite (1983). Our equilibrium properties are possible because of the reliance of
the mechanism on Z for additional information.

Proposition 4. Fix κ2 ( · ) as in (27), let κ1 (Z) = β0 + β1 Z, and let κ0 be arbitrary. For the
equilibrium reports z ∗ of the mechanism Mκ , we have
                                                                                2
                                    U i (z ∗ ) = V i (z0i , Z̄) + K z0i − Z          .                (31)

With probability one, trader i weakly prefers this equilibrium value to the value V (z0i , Z̄) of the
initial inventory z0i . That is,

                        U i (z ∗ ) = V i (z0i + Y i (z ∗ ), Z̄) + Tκi (z ∗ , Z) ≥ V i (z0i , Z̄).     (32)

The inequality is strict unless z0i = Z. Provided that the probability distribution of z0 has full
support, this inequality holds with probability one if and only if κ1 (Z) = β0 + β1 Z.

       Proof: Fix a continuation value as above, and let κ1 (Z) = β0 + β1 Z̄. We see that

                                                                  κ1 (Z)
                                             κ2 (Z) = −Z −               ,                            (33)
                                                                  2κ0 n2
  34
    Likewise, this is also a Bayesian Nash equilibrium of the incomplete-information game, after specifying
beliefs about other traders’ inventories.




                                                          37
and thus the transfer to trader i is
                             n
                                    !2
                           X                                    κ2 (Z)
            κ0 nκ2 (Z) +        ẑ j + κ1 (Z)(ẑ i + κ2 (Z)) + 1 2
                            j=1
                                                                4κ0 n
                                          2
                                                                               κ21 (Z)
                                                                         
                               κ1 (Z)                      i        κ1 (Z)
               = κ0 −Z −               + Z + κ1 (Z) z0 − Z −                 +
                               2κ0 n                                2κ0 n2     4κ0 n2
                  κ2 (Z)                      κ2 (Z) κ2 (Z)
               = 1 2 + κ1 (Z)(z0i − Z̄) − 1 2 + 1 2
                  4κ0 n                       2κ0 n       4κ0 n
                           i
                                   
               = κ1 (Z) z0 − Z̄
               = β0 + β1 Z̄ z0i − Z̄ .
                                       


    From Proposition 3, trader i has the equilibrium post-reallocation inventory Z̄. The equi-
librium utility of trader i is then simply

                     ui (Z̄) + κ1 (Z) z0i − Z̄ = ui (Z̄) + β0 + β1 Z̄ z0i − Z̄ .
                                                                            


Comparing this with V i (z0i , Z), the result follows from the fact that K > 0.
    For the uniqueness of κ1 ( · ), we note that for the IR condition to hold with probability 1,
by continuity, it must hold in the event that z0i = Z̄ for all i. In this case, the change in utility
for any trader is just the transfer received by that trader. By the definition of the transfers,
straightforward algebra shows that for any vector ẑ of reports,

                                                                     !2                                        
           n                     n                       n
           X                     X                       X                                                κ21 (Z) 
                 Tκi (ẑ, Z) =         κ0 nκ2 (Z) +           ẑ j           + κ1 (Z)(ẑ i + κ2 (Z)) +
           i=1                   i=1                     j=1
                                                                                                          4κ0 n2
                                                               n
                                                                              !              !2
                                √                              X                    κ1 (Z)
                           = −n  −κ0              nκ2 (Z) +            ẑ j       − √             .
                                                               j=1
                                                                                   2 −κ0 n

   Plugging in the choice of κ2 ( · ) suggested in Proposition 3 and using the equilibrium
truthtelling property that ẑ i = z0i , we have
              n
                                                                                          !2
                                                   −κ1 (Z) + ( n−1
                                                                               
              X                            √                       ) β0 + β1 Z     κ1 (Z)
                    Tκi (ẑ, Z) = −n           −κ0              n
                                                                                 − √         ,
              i=1
                                                               2κ0                2 −κ0 n

which is nonnegative if and only if κ1 (Z) = β0 + β1 Z, completing the proof.
    In summary, if the aggregate inventory Z is known to all traders and to the size-discovery
platform operator, then the budget-balanced mechanism Mκ can implement a perfect reallo-
cation in an ex-post individually rational equilibrium.35 Proposition 4 also implies that the
  35
    As remarked to one of us by Romans Pancs, a Vickrey-Clarke-Groves (VCG) pivot mechanism can also
implement a perfect reallocation in an ex-post equilibrium in this setting. We focus on these transfers because
they are tractable in our dynamic game, and as demonstrated by the results of this appendix, there is no sense in
which VCG or the AGV mechanism of Arrow (1979) and d’Aspremont and Gérard-Varet (1979) could improve


                                                          38
equilibrium payoffs do not depend upon the choice of κ0 . For κ1 ( · ) and κ2 ( · ) as specified in
Proposition 4, some algebra shows that the equilibrium cash transfer to trader i is

                                κ1 (Z) z0i − Z = β0 + β1 Z z0i − Z .
                                                                
                                                                                              (34)
The mechanism designer is thus free to choose any κ0 < 0, because the choice of κ0 has no
impact on equilibrium transfers or allocations. Result 4 of Proposition 3 nevertheless indicates
the strategy-proofness advantage of the particular choice κ0 = −K(n − 1)/n2 .

A.3      Relationship with the Vickrey-Clarke-Groves mechanism
We now show how our mechanism relates to the VCG mechanism.36 Since the VCG mechanism
is defined in terms of value functions, we use the equilibrium value functions from Proposition
1. We adopt the notation of Fudenberg and Tirole (1991), Chapter 7. In this notation, the
type θi of trader i is her excess inventory z0i . For the purpose of this exercise, we assume the
platform designer has inferred the average inventory Z̄ from the market-clearing price. Let
J denote this inference, and suppose the platform designer has simply replaced Z̄ with J in
the equilibrium value functions, ignoring the relationship between J and the vector θ of excess
inventories. Then for any decision x, the equilibrium value for trader i is
                                                   
                                     γ 2        2γ                                   2
             V (x, θ) = ai + vJ − J + v − J θi + xi − J − K θi + xi − J .
               i
                                                                  
                                     r           r

    The efficient allocation x∗ (θ) still gives everyone an allocation of θi + x∗i (θ) =
                                                                                          P i
                                                                                            i θ /n,
although this is not necessarily equal to J. In this case, fixing a trader j,
                                                    P k           !        P k        !2
                                      γ          2γ          θ̂                  θ̂
        V j (x∗ (θ̂), θ̂) = aj + vJ − J 2 + v − J          k
                                                                −J −K          k
                                                                                    −J .
                                      r           r        n                   n

upon the mechanism outcome.
  36
     We thank an anonymous referee for suggesting this analysis.




                                                     39
   Now, fix some i 6= j and rewrite this expression as
                              P k            !         P k         !2
             γ 2         2γ          k θ̂                  k θ̂
  aj + vJ − J + v − J                      −J −K                 −J
             r            r          n                     n
               i                        !2
           2γ    θ̂    K X k
   = v− J           − 2        θ̂ − nJ       + f (θ̂−i )
            r    n     n    k
               i                                         !2
           2γ    θ̂    K X k
   = v− J           − 2        θ̂ + nβ(p) − nβ(p) − nJ          + f (θ̂−i )
            r    n     n    k
               i                           !2                            !
           2γ    θ̂    K    X                       2K   X
   = v− J           − 2        θ̂k − nβ(p) − 2               θ̂k − nβ(p) (nβ(p) − nJ) + f (θ̂−i )
            r    n     n    k
                                                    n    k
               i                           !2
           2γ    θ̂    K X k                        2K
   = v− J           − 2        θ̂ − nβ(p) − 2 θ̂i (nβ(p) − nJ) + f (θ̂−i ),
            r    n     n    k
                                                    n

where f (θ̂−i ) collects terms that do not depend on θ̂i and β(p) is any constant that does not
depend on θ̂i . It follows that the VCG transfer for trader i is
                                                                  !2
                X                           K(n − 1) X
                      V j (x∗ (θ̂), θ̂) = −     2
                                                       θ̂k − nβ(p) + θ̂i Θ + f (θ̂−i ),
                 j6=i
                                              n      k


where
                                       
                          n−1        2γ   2K(n − 1)
                       Θ=          v− J −           (nβ(p) − nJ) .
                           n          r      n2

      Now, in the equilibrium of Proposition 1, we know that p = v − (2γ/r)J, so plugging this
in,
                                                                             
                           n−1    2K(n − 1)                        r(v − p)
                        Θ=     p−                        nβ(p) − n                .
                            n        n2                               2γ

      Plug in κ0 = −K(n − 1)/(n2 ) and
                                                                  
                                        rv           −r     1
                                 β(p) =    +p           +
                                        2γ           2γ   2κ0 n2

to see that Θ = p, and thus the VCG mechanism coincides with our mechanism at the strategy-
proof choice. Our mechanism simply sets f (θ̂−i ) to satisfy ex-post individual rationality and
budget balance. Again, this is possible because the platform designer has already inferred the
aggregate inventory. This shows that our linear-quadratic mechanism, which works for any
negative constant κ0 , coincides with the VCG mechanism associated with the equilibrium value
functions for a particular κ0 . When we say our mechanism is strategy proof, we mean it in the
well-known sense that this VCG mechanism is strategy proof, given the platform designer has

                                                40
the correct inference J.


B       Proof of Proposition 1
The proof of the main result of the paper, Proposition 1, proceeds in steps.
    First, we characterize all of the possible equilibrium value functions. We prove the exchange
demand process implied by demand coefficients (a, b, c) is admissible if and only if r + λ − 2c >
0. We will show that c < 0 in all of our equilibria, implying admissibility is satisfied. We
then calculate closed-form solutions for the value functions implied by any candidate demand
coefficients (a, b, c) satisfying the admissibility condition.
    Next, we use the HJB equation for the stochastic control problem faced by trader i to
narrow the set of possible equilibria. The candidate value functions are all linear quadratic and
thus twice continuously differentiable, so this HJB is a necessary condition for the candidate
strategies to be optimal. Subsection B.3 of this appendix is a lengthy derivation of the explicit
coefficients of the candidate value functions V i and the equilibrium demand coefficients that
are consistent with the HJB equation. We show there are two candidate equilibria which
satisfy the HJB equation, one of which is the candidate value function V i of (9) with the
claimed equilibrium demand coefficients (a, b, c) of Proposition 1. Subsection B.3 also proves
the monotonicity properties related to λ and other properties stated by Proposition 1.
    Finally, we perform a standard martingale-based verification argument of optimality of the
candidate optimal strategy for trader i, assuming all other traders adopt their candidate optimal
strategies. For this, we show that the candidate value V i (z0i , Z0 ) is equal to the expected total
payoff of the candidate optimal strategy, and is greater than or equal to the expected payoff
of any admissible strategy. This implies that the candidate optimal strategy is in fact optimal,
and completes the proof of equilibrium.

B.1     Equilibrium value functions
In this section, we calculate closed-form solutions for the value functions that result from all
traders truthfully reporting and using an affine demand process with coefficients (a, b, c), as
they must in any equilibrium by definition. We ignore until the next section whether such
strategies are optimal.

B.1.1    A technical lemma
In this section we prove a technical lemma that will be useful in all subsequent proofs.

Lemma 2. Let c 6= 0 be an arbitrary constant, and let Z̄t and σZ2 be defined as in the text.
Then, for any t,             Z t
                                                  1 − e−ct
                                           
                                    −cs
                           E      e Z̄s ds = Z̄0           ,                           (35)
                                0                     c
and             "Z                   2 #
                       t
                                             (1 − e−ct )2 2 σZ2 e−2ct (2ct − 4ect + e2ct + 3)
            E              e−cs Z̄s ds     =             Z̄0 + 2                              .   (36)
                   0                             c2           n              2c3


                                                       41
   As c → 0, these expectations converge to the expectations of the limiting integrands, and in
particular                     "Z
                                     t       2 #
                                                             σ 2 t3
                             E         Z̄s ds     = Z̄02 t2 + Z2 .                         (37)
                                   0                         n 3
Proof: Fixing s, because E[(Z̄s )2 ] = Z̄02 + (σZ2 /n2 )s by assumption, we can apply Hölder’s
inequality to find that
                                                              r
                                                                     σ2
                                          q 
                        E |e Z̄s | ≤ e−cs E (Z̄s )2 = e−cs Z̄02 + Z2 s.
                          −cs                       
                                                                     n
It follows that, for any t,
                                                                            r
                               t                                 t
                                                                                           σZ2
                         Z                                   Z
                                         −cs                          −cs
                                   E[|e        Z̄s |] ds ≤           e          Z̄02 +         s ds < ∞.
                           0                                 0                             n2
   We may thus apply the Fubini-Tonelli theorem to write that
             Z t          Z t                      Z t
                   −cs
                                    −cs                              1 − e−ct
           E      e Z̄s ds =      E e Z̄s ds = Z̄0       e−cs ds = Z̄0          ,
               0                0                      0                  c

where we have used the fact that, from the definition of Ht , we have E[Z̄s ] = Z̄0 . Henceforth,
for brevity we refer toRthis as the “Hölder’s inequality and Fubini-Tonelli theorem argument.”
                         t
    Now, define Wt = 0 e−cs Z̄s ds. By Ito’s lemma,
                                    Z    t                               Z tZ       s
                                                 −cs
                     Wt2   =2                Ws e      Z̄s ds = 2                       e−cs Z̄s e−cu Z̄u du ds.
                                     0                                    0     0

   By the Lévy property, E[Z̄u (Z̄s − Z̄u )] = 0. An application of the “Hölder’s inequality and
Fubini-Tonelli theorem argument” implies that
         Z t Z s                     Z tZ s
                   −cs   −cu
       E          e Z̄s e Z̄u du ds =                E[e−cs Z̄s e−cu Z̄u ] du ds
           0   0                             0   0
                                           Z tZ s
                                       =             E[e−cs e−cu (Z̄s − Z̄u + Z¯u )Z̄u ] du ds
                                           Z0 t Z0 s
                                       =             E[e−cs e−cu Z̄u2 ] du ds
                                           Z0 t Z0 s
                                                                          σZ2
                                                                              
                                                      −cs −cu       2
                                       =             e e         Z̄0 + 2 u du ds
                                             0   0                        n
                                                    −ct 2         2 −2ct
                                           (1 − e ) 2 σZ e                   (2ct − 4ect + e2ct + 3)
                                       =                  Z̄0 +                                      .
                                                2c2              n2                 4c3
    Finally, starting at the penultimate line of the above system and plugging in c = 0, we
arrive at                        "Z           2 #
                                       t
                                                               σ 2 t3
                               E         Z̄s ds     = Z̄02 t2 + Z2 .                   (38)
                                     0                         n 3

                                                                     42
      This proves the technical lemma. We now address admissibility.

B.1.2          Admissibility
In this section, we show that if there were a symmetric affine equilibrium with 2c ≥ r + λ,
then one trader would be using an inadmissible strategy, meaning that the value achieved in
the stochastic control problem (8) would be negative infinity or undefined. In order to see this,
fix candidate demand coefficients (a, b, c). Then each trader demands the asset at the flow rate
Dt = a + bφt + czti , so the market-clearing price must be

                                                                                             a + cZ̄t
                                                                                 φt =                 .
                                                                                               −b
Plugging this price back into trader demands, we can write

                                                                              Dt = c(z − Z̄t ).

Let T1 denote the minimum of T and the first jump time of N . It follows that if all traders
follow this strategy, the inventory of trader i at any time t < T1 is
                                            Z t
                                  i
                                 zt = z0 + c (zsi − Z̄s ) ds + Hti .
                                       i
                                                                                        (39)
                                                                                       0

   Applying Ito’s lemma for semimartingales to e−ct zti , and multiplying both sides by ect , one
can show37 that                       Z t                    Z t
                                           −cs
                       i    ct i   ct
                      zt = e z0 − e c     e Z̄s ds + e    ct
                                                                 e−cs dHsi .                 (40)
                                                                                 0                                   0
                                              hR                     i
                                                 T1
    We now show that E 0 (zsi )2 ds is finite if and only if 2c < r + λ. We first must compute
a few quantities. Fix a time t < T1 . Because e−cs is square integrable, the last term in the
expression for zti is a martingale, so by Lemma 2,

                                                               E(zti ) = ect z0i + Z̄0 (1 − ect ).

      Next, we evaluate                                        Z        t                        Z    t                
                                                                              −cs                          −cs
                                                           E                 e       Z̄s ds                e     dHsi       .
                                                                     0                             0
               Rt                      Rt
    Let At ≡ 0 e−cs Z̄s ds and Bt ≡ 0 e−cs dHsi . Note that [A, B]t = 0 since A is a continuous
finite-variation process, so by Ito’s lemma for semimartingales,

                                  d(At Bt ) = At dBt + Bt dAt = At e−ct dHti + Bt e−ct Z̄t dt,

or
         Z     t                  Z   t                        Z     t             Z     s                                      Z   t                   Z   s
                   −cs                        −cs                            −cs                 −cu                                        −cs
                   e     Z̄s ds           e         dHsi   =             e                   e         Z̄u du dHsi      +               e         Z̄s           e−cu dHui ds.
           0                      0                              0                   0                                          0                       0
 37
      This is exactly the derivation of the solution of the Ornstein-Uhlenbeck process.

                                                                                             43
                                                                Rs
   Since Hti is a martingale and                                    0
                                                                        e−cu Z̄u du is square integrable by Lemma 2, we have
                        Z          t                       Z       t                              Z    t                   Z    s                  
                                            −cs                             −cs                                   −cs                  −cu
                   E                    e         Z̄s ds                e           dHsi       =E             e         Z̄s            e     dHui   ds .
                                0                               0                                     0                        0

   Applying the “Hölder’s inequality and Fubini-Tonelli theorem argument” this expectation
is                             Z t       Z s             
                                    −cs          −cu    i
                                   e E Z̄s     e dHu ds,
                                                                0                              0

where, by another application of Itô’s formula for semimartingales and a well known result on
the quadratic covariation of semimartingales,
           Z t            Z t Z s                   Z t             Z t
                −cu                 −cu                        −cs
       Z̄t     e dHu =i                     i
                                   e dHu dZ̄s +                    i
                                                          Z̄s e dHs +     e−cu d[H i , Z̄]u .
            0                                     0         0                                             0                                  0
                                             Rs
   Since the integrands                       0
                                                   e−cu dHui and Z̄s e−cs are square integrable, we have
                        t                                                   t                                           t
                                                                                                                                   ρi     ρi
                 Z                                            Z                                               Z
                            −cu                                                     −cu
          E Z̄t             e           dHui           =E                       e              i
                                                                                          d[H , Z̄]u =                      e−cu      du = (1 − e−ct ).
                    0                                                   0                                          0               n      nc

   Putting this together,
           Z t           Z t         Z t
                  −cs          −cs             ρi                 ρi
         E       e Z̄s ds          i
                              e dHs =      e−cs (1 − e−cs ) ds =     2
                                                                       (1 − e−ct )2 .
              0            0            0      nc                2nc

    Next, applying Itô isometry for martingales, and recalling that [H i , H i ]t = σi2 t because H i
is square integrable, we have
                      "Z                2 # Z t
                             t
                                                                 −σi2 −2ct
                    E          e−cs dHsi     =    e−2cs σi2 ds =     (e    − 1).
                           0                   0                  2c

   Combining these pieces,
                     "                                                            2 #    "Z             2 #!
                                                             Z      t                          t
     E[(zti )2 ] = e2ct E                     z0i − c                   e−cs Z̄s ds     +E       e−cs dHsi                                                 (41)
                                                                0                                                     0
                                                                  Z       t                   Z      t                     
                                2ct                                             −cs                           −cs
                        +e E                          z0i   −c                  e     Z̄s ds                  e         dHsi                               (42)
                                                                        0                            0
                                                                             σ 2 (2ct − 4ect + e2ct + 3)
                = e2ct (z0i )2 + 2ect z0i Z̄0 (1 − ect ) + (1 − ect )2 Z̄02 + Z2                                                                           (43)
                               2                             i            n            2c
                                −σ                               ρ
                    + e2ct         i
                                     (e−2ct − 1) + e2ct              2
                                                                       (1 − e−ct )2 .                                                                      (44)
                                 2c                             2nc




                                                                                               44
   Applying the independence of T , Nt and Hti , as well as Tonelli’s theorem, we have
                    Z T 1          Z ∞                  Z t
                             i 2                  −(r+λ)t
                  E        (zs ) ds =    (r + λ)e             E[(zsi )2 ] ds dt
                      0                0                   0
                                      Z ∞Z t
                                             E (r + λ)e−(r+λ)s (zsi )2 ds dt,
                                                                         
                                    ≤
                                           0   0

where we have used the fact that T1 is distributed exponentially with parameter r + λ. From
(41), we see that this quantity is finite if and only if 2c < r + λ. This is true regardless of z0i .
By a straightforward application of monotone convergence, as long as 2c < r + λ, this implies
that           Z T                    Z Tn                   Z Tn         
                      i 2                       i 2                      i 2
             E      (zs ) ds = E lim          (zs ) ds = lim E         (zs ) ds < ∞.
                  0                 n→∞    0                    n→∞             0

    We have thus shown that 2c < r + λ is a necessary condition for admissibility, and it is a
sufficient condition for the expected holding costs to be finite. It turns out this is sufficient for
the value function to be well defined, as we prove in the next section, implying it is a sufficient
condition for admissibility.

B.1.3    Linear-quadratic form of the value function
We are now ready to characterize the set of value functions that could possibly be consistent
with an equilibrium. Fix symmetric affine equilibrium demand coefficients (a, b, c). As above,
the associated equilibrium market-clearing price φt is

                                                   a + cZ̄t
                                           φt =             ,
                                                     −b
and thus a + bφt + czti = c(zti − Z̄t ). Thus, the trading costs paid by trader i in an equilibrium
with demand coefficients (a, b, c) is
                                   Z T                          
                                            i           a + cZ̄s
                                         c(zs − Z̄s )              ds.
                                     0                    −b

   Recall that the cash transfer of trader i at a given (µ, p) ∈ Rn × R is
                                                        n
                                                                   !2
                                                        X                            p2
                   TQi (µ, p) = pµi + κ0   −nβ(p) +           µj        − pβ(p) +          ,    (45)
                                                        j=1
                                                                                    4κ0 n2

where                                                                  
                                        rv             −r     1
                                 β(p) =    +p             +                 .                   (46)
                                        2γ             2γ   2κ0 n2
   Plugging in µj = ztj for all j and p = (a + cZ̄t )(−b), we see that in equilibrium the transfer
takes the form
                              R0 + R1 Zt + R2 Zt2 + R3 Zt zti + R4 zti ,



                                                   45
for constants R0 through R4 that depend on κ0 , a, b, c. These calculations motivate the following
lemma, which we use in the proof of Proposition 1 as well as our extensions, that gives the
closed-form solution for the value function in any candidate equilibrium.

Lemma 3. Fix any exchange demand-function coefficients (a, b, c) with 2c < r + λ and transfer
coefficients R0 − R4 . Let
                                Z t                      Z T
                       i    i          i             i
                                                             Z̄s − zsi dNs
                                                                     
                      zt = z0 +     c zs − Z̄s ds + Ht +
                                     0                           0

denote the corresponding equilibrium inventory process for trader i, and let

                          T R (z, Z) = R0 + R1 Z + R2 Z 2 + R3 Zz i + R4 z i

denote the corresponding equilibrium cash transfers. Then
             Z T                                          Z T                 
          i            i 2      i           a + cZ̄s
   E πzT +        (−γ(zs ) − c(zs − Z̄s )              ds) +     T (zs , Zs ) dNs = V (z0i , Z0 ),
                                                                  R i
               0                              −b              0

where
                        V (z, Z) = α0i + α1 z + α2 Z̄ + α3 z 2 + α4 Z̄ 2 + α5 z Z̄,              (47)
and
                                         −γ
                             α3 =
                                     r + λ − 2c
                                                  c2
                                                                      
                                         1
                             α5 =                     − 2α3 c + λnR3
                                     r+λ−c b
                                     1 c2
                                                                        
                                                                       2
                             α4 =           + (λ − c)α5 + λα3 + λn R2
                                     r −b
                                         1              ac       
                             α1 =                rv +       + λR4
                                     r+λ−c               b         
                                     1 ca
                             α2 =           + (λ − c)α1 + λnR1
                                     r −b
                                                     σZ2      ρi
                                                                      
                                     1
                             α0i =          2
                                        α3 σi + α4 2 + α5 + λR0 .
                                     r               n        n

Proof: Given the α coefficients, we have

              (r + λ) α0i + α1 z + α2 Z̄ + α3 z 2 + α4 Z̄ 2 + α5 z Z̄
                                                                        

                                         σZ2                 ρi             a + cZ̄
                    = rvz − γz 2 + α4        + α 3 σ 2
                                                     i + α 5    − c(z − Z̄)
                                         n2                  n                −b
                                                                    i
                         + c(z − Z̄)(α1 + 2α3 z + α5 Z̄) + λ(α0 + α1 Z̄ + α2 Z̄ + α3 Z̄ 2
                         + α4 Z̄ 2 + α5 Z̄ 2 + R0 + R1 Z + R2 Z 2 + R3 Zz + R4 z).




                                                    46
    Let Yt = 1{T ≤t} and V (z, Z) be defined as above. Let
                                                  i
                                                   zt
                                            X = Zt 
                                                 
                                                   Yt

and U (X) = U (z, Z, Y ) = (1 − Y )V (z, Z) + Y vz. Then, by Ito’s lemma for semimartingales,
for any t, we have
                    Z t                                               Z t
                                       i                        i                         i
U (Xt ) − U (X0 ) =     (1 − Ys− )Vz (zs− , Zs− ) + Ys− v dzs +           (1 − Ys− )VZ (zs− , Zs− ) dZs
                     0+                                                0+
                         1 t                                               1 t
                           Z                                                 Z
                                                i                i i c                             i
                      +        (1 − Ys− )Vzz (zs− , Zs− ) d[z , z ]s +           (1 − Ys− )VZZ (zs−  , Zs− ) d[Z, Z]cs
                         2 0+                                              2 0+
                         Z t
                                              i
                      +      (1 − Ys− )VzZ (zs−  , Zs− ) d[z i , Z]cs
                          0+
                          X
                                                                           i
                      +        U (Xs ) − U (Xs− ) − [(1 − Ys− )Vz (zs−       , Zs ) + Ys− v]∆zsi
                                   0≤s≤t
                                   X
                                                          i
                               −           (1 − Ys− )VZ (zs− , Zs )∆Zs ,                                    (48)
                                   0≤s≤t

where we have used the fact that
                    Z t
                          ∂      i
                                                  X ∂
                                                              i
                            U (zs− , Ys− ) dYs =          U (zs− , Ys− )∆Ys ,
                     0+  ∂Y                      0≤s≤t
                                                       ∂Y

and the fact that [z i , Y ]c = [Z, Y ]c = [Y, Y ]c = 0.
   Now, we note that
                                                                                          2
                                                                      ∆Zs            ∆Zs        Zs− ∆Zs
             V   (zsi , Zs )   −V     i
                                    (zs− , Zs− )   =   α1 ∆zsi   + α2     + α4                  + 2α4
                                                                       n              n           n2
                                                                                            i ∆Zs
                                                         + α3 (∆zsi )2 + 2α3 zs−
                                                                              i
                                                                                 ∆zsi + α5 zs−
                                                                                               n
                                                                             ∆Z  s
                                                         + α5 Z̄s− ∆zsi + α5       ∆zsi ,
                                                                               n
while
                                        i               ∆Zs             i
                                                                                      
                                   VZ (zs− , Zs− )∆Zs =       α2 + α5 zs−  + 2α4 Z̄s−
                                                         n
                                   Vz (zs− , Zs− )∆zs = ∆zsi α1 + α5 Z̄s− + 2α3 zs−
                                        i           i                            i
                                                                                    
                                                                                      .
Thus, the total contribution to the sum in (48) from jumps in zsi or Zs is given by
                                         2                              !
                                      ∆Zs                       ∆Z s
                      (1 − Ys− ) α4          + α3 (∆zsi )2 + α5      ∆zsi
                                       n                         n



                                                                  47
because the term −Ys− v∆zsi is cancelled by the same term in U (Xs ) − U (Xs− ).
   We note that jumps in z i arise from jumps in both H i and N . By independence, ∆N ∆H i =
∆N ∆Z = ∆Y ∆Z = ∆Y ∆z i = 0 with probability 1. In summary, we can write the sum as
    X
                i       i
                                   
        ∆Ys vzs−  − V (zs− , Zs− )
   0≤s≤t
                                          2                                                               !
                                     ∆Zs                                                   ∆Zs
               + (1 − Ys− ) α4                  + α3 (∆Hsi )2 + α3 ∆Ns (zs−
                                                                         i
                                                                            − Z̄s− )2 + α5     ∆Hsi             .
                                      n                                                     n

   It will be convenient to write
        X                                                      Z   t
                                   i               2                                  i
                                                                                         − Z̄s− )2 dNs
                                                       
             (1 − Ys− )   α3 ∆Ns (zs−   − Z̄s− )           =           (1 − Ys− )α3 (zs−
       0≤s≤t                                                   0
                                                               Z   t
                                                                                i
                                                           =     (1 − Ys− )α3 (zs− − Z̄s− )2 (dNs − λ ds)
                                                               0
                                                                  Z t
                                                                                      i
                                                                +     (1 − Ys− )λα3 (zs− − Z̄s− )2 ds.
                                                                         0

   Finally, we note that
        Z t                        Z t
                  i            i                            i
             Vz (zs− , Zs− ) dzs =     (α1 + α5 Z̄s− + 2α3 zs− ) dzsi
          0+                        0+
                                   Z t
                                                            i
                                                               ) (c − λ)(zsi − Z̄s ) ds
                                                                                      
                                 =     (α1 + α5 Z̄s− + 2α3 zs−
                                    0+
                                        Z t
                                                                  i
                                     +      (α1 + α5 Z̄s− + 2α3 zs−   ) dHsi
                                         0+
                                        Z t
                                                                  i            i
                                     +      (α1 + α5 Z̄s− + 2α3 zs−   )(Z̄s − zs− ) d(Ns − λ ds).
                                           0+

   We let
                                                           σZ2                  ρi
            χs = c(zsi − Z̄s )(α1 + α5 Z̄s− + 2α3 zs−
                                                   i
                                                      ) + α4   +  α 3 σ 2
                                                                        i + α 5
                                                           n2                   n
                    − λ(zs − Z̄s )(α1 + α5 Z̄s− + α3 (zs− + Z̄s− )) + r(vzs − V (zsi , Zs )).
                         i                             i                    i




                                                           48
Plugging in VZZ = 2α4 /n2 , Vzz = 2α3 , VzZ = α5 /n, and evaluating (48) at t = T , we can write
                         Z   T           Z   T
                                                                    i
 U (XT ) − U (X0 ) =          χs ds +      (α1 + α5 Z̄s− + 2α3 zs−    ) dHsi
                           0+           0+
                              Z T
                                                          i
                            +     (α1 + α5 Z̄s− + 2α3 zs−   )(Z̄s − zsi ) d(Ns − λ ds)
                               0+
                              Z T                                       Z T
                                       i          2                          1            i
                                                                                                       
                            +     α3 (zs− − Z̄s− ) (dNs − λ ds) +                α2 + α5 zs− + 2α4 Z̄s− dZs
                               0                                          0+ n
                                             Z T                                   !
                                                                      X
                            + α3 −σi2 T +         d[H i , H i ]cs +       (∆Hsi )2
                                                     0+                       0≤s≤T
                                                                                                 !
                                                     Z   T
                              α4                                              X
                             + 2     −σZ2 T      +           d[Z, Z]cs   +           (∆Zs )  2
                              n                      0+                      0≤s≤T
                                           Z T                                  !
                               α5                               X
                             +     −ρi T +      d[Z, H i ]cs +       (∆Zs ∆Hsi )
                                n           0+                 0≤s≤T
                               Z T
                                     i        i
                                                        
                             +     vzs− − V (zs− , Zs− ) (dYs − r ds),                                                         (49)
                                 0

where we have replaced Ys− = 0 for s ≤ T , by definition. Also, we have used the fact that
[z i , z i ]c = [H i , H i ]c and [z i , Z]c = [H i , Z]c , since z i is the sum of Hti and a finite-variation process
that is a quadratic pure-jump semimartingale. (See (Protter, 2005).)
       For any deterministic T , it is well known from the theory of Lévy processes that
   "                                                   !#         "                                       !#
                                         X                                                  X
E         −σi2 T + [H i , H i ]cT +           (∆Hsi )2       =E        −σZ2 T + [Z, Z]cT +        (∆Zs )2
                                 0≤s≤T                                                               0≤s≤T
                                                                    "                                                              !#
                                                                                  Z   T                       X
                                                             =E         −ρi T +           d[Z, H i ]cs +             (∆Zs ∆Hsi )
                                                                                     0+                      0≤s≤T

                                                             = 0.

For the case of an exponentially distributed T that is independent of {Z, H i }, we may apply
law of iterated expectations (conditioning on T ) to show that these expectations are still zero.
   Now, we let G∞ i
                    be the σ-algebra generated by the path of {Hti , Zt }∞
                                                                         t=0 , which is independent




                                                                49
of T by assumption. Then
    Z T                                     
            i        i     i
 E       [vzs− − V (zs− , Zs− )] (dYs − r ds)
      0
                                    Z T                                                  
                                                i          i       i                    i
                              =E E          [vzs− − V (zs− , Zs− )] (dYs − r ds) G∞
                                          0
                                     Z T                                                          
                                                    i            i     i             i      i i   i
                              = E E −r           [vzs− − V (zs− , Zs− )] ds + vzT − V (zT , ZT ) G∞
                                             0
                                    Z ∞            Z t                                
                                                −rt            i          i      i
                              = E −r         re          [vzs− − V (zs− , Zs− )] ds dt
                                          0            0
                                             Z ∞                                    
                                                       −rt       i        i   i
                                                                                 
                                        +E          re       vzt − V (zt , Zt ) dt
                                                0
                                    Z ∞
                                                                          ∞ −rt
                                                                          Z              
                                                  i          i       i
                              = E −r           vzs− − V (zs− , Zs− )            re dt ds
                                          0                                 s
                                             Z ∞                                    
                                                       −rt       i        i   i
                                                                                 
                                        +E          re       vzt − V (zt , Zt ) dt
                                                0
                                    Z ∞                                           
                                                i          i       i
                                                                        −rs
                              =E −           vzs− − V (zs− , Zs− ) re ds
                                        0
                                             Z ∞                                    
                                                       −rt       i        i   i
                                                                                 
                                        +E          re       vzt − V (zt , Zt ) dt = 0,
                                                           0
                                                                                          R∞Rt
where
R ∞ R ∞the fourth equality follows from a change of order       of integration from 0 0 ds dt to
 0    s
         dt ds. Finally, we have already shown that E[(zsi )2 ], E[(zsi )], E[(Z̄s )2 ], and E[(Z̄s )] are
all integrable. It then follows from Hölder’s inequality that E[zsi Z̄s ] is also integrable. Then
(α1 + α5 Z̄s + 2α3 zsi ) and α2 + α5 zsi + 2α4 Z̄s are square-integrable processes. So, for any t,
           Z   t                                              Z   t                               
                                           i                             1
                                              ) dHsi                                i
                                                                                                 
       E            (α1 + α5 Z̄s− +   2α3 zs−              =E              α2 + α5 zs− + 2α4 Z̄s− dZs = 0,
            0+                                                      0+   n


since H i and Z are martingales. The same result holds after replacing t by T , by applying the
law of iterated expectations after conditioning on the independent exponentially distributed
time T . We have thus shown that taking an expectation in equation (49) gives
                                                     Z T      
                            E[U (XT ) − U (X0 )] = E      χs ds .
                                                                            0+

Because α0 through α5 satisfy the system of equations specified at the beginning of this proof,
we have                                             Z T       
                           E[U (XT ) − U (X0 )] = E      χ̄s ds ,
                                                                            0+




                                                               50
where
                                 a + cZ̄s
           χ̄s = c(zsi − Z̄s )            + γ(zsi )2 − λ(R0 + R1 Zs + R2 Zs2 + R3 Zs zsi + R4 zsi ).
                                   −b
   Using the definitions of U, T , and R0 through R4 , as well as the fact that E[vzTi ] = E[πzTi ],
we can rearrange to find that
                            Z T         
          i              i
      V (z0 , Z0 ) = E πzT +      χ̄s ds
                               0+
                            Z T                                                    
                         i              i       a + cZ̄s      i 2      R i
                   = E πzT +      −c(zs − Z̄s )          − γ(zs ) + λT (zs , Zs ) ds
                               0+                 −b
                            Z T                                       Z T                 
                         i              i       a + cZ̄s      i 2            R i
                   = E πzT +      −c(zs − Z̄s )          − γ(zs ) ds +     T (zs , Zs ) dNs ,
                               0                  −b                    0




which completes the proof.

B.2     HJB conditions for optimality and individual rationality
Here, we state the Hamilton-Jacobi-Bellman (HJB) equation, as a conjectured necessary condi-
tion on the candidate value function V i associated with the stochastic control problem of trader
i. This conjectured condition is simply an aid to our later verification proof of the optimality of
the candidate optimal demand policy, of the individual rationality condition for participation
in size-discovery sessions, and of truthful inventory reporting in those sessions. We do not need
to show that the HJB condition is appropriate or necessary for optimality, although both of
these are in fact verified in the final verification step, which follows later in this sub-section.
We also do not claim, yet, that the function V i specified by (9) is actually the continuation
value function of trader i, although this also will also be shown later in the verification step.
    For the purposes of this proof, we suppose that trader i can observe the aggregate inventory
Zt . We show the corresponding optimal strategy depends only on the information actually
available to trader i (which does not include Zt ). The resulting strategy is therefore optimal
even when restricted to the information actually available to trader i.
    First, at any given state (z i , Z) ∈ R2 , consider the optimization problem faced by trader i if a
size-discovery session has just been declared. At that point, we suppose that the exchange price
has already been fixed at some arbitrary level p, which for now is left as a free variable. Given
the candidate continuation value function V i , the candidate value for entering the size-discovery
session is
                   V i (z i , Z, p) ≡ sup V (z i + Y i ((µ, z −i )), Z) + TQi ((µ, z −i ), p).   (50)
                                       µ∈M

   The HJB equation for optimal exchange demand d ∈ R at any state (z i , Z) is

                                           σi2                σ2
 0 = r(z i v − V (z i , Z)) − γ(z i )2 +       Vzz (z i , Z) + Z VZZ (z i , Z) + ρi VzZ (z i , Z) + sup G(d), (51)
                                           2                   2                                     d




                                                        51
where

    G(d) = −Φ(a,b,c) (d; Z − z i )d + Vzi (z i , Z)d + λ V i (z i , Z, Φ(a,b,c) (d, Z − z i )) − V i (z i , Z) .
                                                                                                              


The HJB equation reflects the fact that exchange demands are submitted before observing
whether a size-discovery session will immediately follow, and reflect the influence of the de-
mand d on the exchange price Φ(a,b,c) (d, Z − z i ) that would be used in size discovery, if it did
immediately follow. Size-discovery sessions arrive at mean rate λ. Final asset payoffs arrive at
mean rate r.
Proposition 5. Fix κ0 < 0. For any demand coefficients (a, b, c) with 2c < r + λ, let V (a,b,c)
denote the candidate equilibrium value function defined by equation (47) in Lemma 3, for the
R0 − R4 that correspond to κ0 , a, b, c. The candidate value function V (a,b,c) solves the HJB
equation (51) if and only if the following conditions hold:

  1. The coefficient b is real and given by one of the following two values:
                                            s                                 
                        2
                                                                 2
                      r                3λ                    3λ      8λ(r + λ) 
                  b=        −(n − 2) +     ±     −(n − 2) +         −             .                                (52)
                      8γ                 r                     r          r2


  2. The coefficients a, c are given by equations (14,16).

    If these conditions hold, the candidate value function V i : R2 → R specified by (9) solves
the HJB equation (51). At any given state (z i , Z), and at the price p = P (Z̄), the solution
to the associated size-discovery problem (50) is µi = z i , that is, to participate and to report
truthfully. The supremum for the exchange demand optimization problem (51) is attained at
a + bP (Z̄) + cz i , consistent with the given demand function coefficients (a, b, c).
    Finally, there exist two real negative solutions to equation (52) if λ ≤ λ̄, and the corre-
sponding c coefficients given by ( (16)) satisfy 2c < r + λ. There are no real solutions to (52) if
λ > λ̄.

   A proof of this proposition is left to subsection B.3. Exploiting Proposition 5, we will then
use a standard verification argument in subsection B.4 to show that, under the conditions of
Proposition 5, V i (z0i , Z0 ) is equal to the value of the candidate equilibrium strategy (Di , µi ),
and dominates the value of any other strategy, completing the proof of equilibrium.

B.3     Proof of Proposition 5
We turn to a proof of Proposition 5. This involves a lengthy calculation of the coefficients
(a, b, c) of the demand function and the coefficients (α, R) of the linear-quadratic candidate
form of the value function V i satisfying the properties stated by Proposition 5.
    Based on the given form (47) of the candidate value function V i , we note that for any real
number y, V i (z i + y, Z) differs by only a constant from

                                       (α1 + α5 Z̄)y + α3 y 2 + 2α3 z i y.                                         (53)

                                                        52
   In the HJB equationP (51),  from the fact that the total of the other traders’ candidate
equilibrium reports is j6=i z = Z − z i , trader i gets a cash transfer at given demand d ∈ R of
                             j


                                                        2                           p2d
                       κ0 −nβ(pd ) + Z − z i + µi            + pd (µi − β(pd )) +          ,        (54)
                                                                                    4κ0 n2

where pd = Φ(a,b,c) (d; Z − z i ), and an asset transfer given a report µi of

                                                        Z − zi n − 1 i
                                 Y i ((µi , z −i )) =         −     µ.
                                                          n      n
   Assuming temporarily the IR condition that µi 6= ν, the optimization problem faced by
trader i is equivalent to maximizing the sum of (i) the quantity −Φ(a,b,c) (d; Z − z i )d + Vz (z i , Z)d
and (ii) the product of λ with
                                                                                          2
                                             Z − zi n − 1 i           Z − zi n − 1 i
                                                                 
                   i    i
         E(pd , Z, z , µ ) ≡ (α1 + α5 Z̄)            −     µ + α3            −         µ
                                               n         n               n         n
                                       Z − zi n − 1 i
                                                        
                                   i
                           + 2α3 z            −        µ + κ0 (−nβ(pd ) + Z − z i + µi )2
                                         n        n
                                                  p2d
                           + pd (µi − β(pd )) +        .
                                                4κ0 n2

   The first-order condition for optimality of µi is

           ∂E(pd , Z, z i , µi )     n−1                    2(n − 1)2       i     n − 1 Z − zi
                                 = −      (α1 +  α  5 Z̄) +           α 3 µ   − 2      α3
                 ∂µi                   n                       n2                   n     n
                                       n−1
                                     −       2α3 z i + 2κ0 (−nβ(pd ) + µi + Z − z i ) + pd = 0.
                                         n
The second-order condition is satisfied if α3 < 0 and κ0 < 0. For the candidate equilibrium
strategy µi = z i , we have

      ∂E(pd , Z, z i , µi )    n−1                2(n − 1)α3
               i
                            =−     (α1 + α5 Z̄) +            (−Z̄) + 2κ0 (−nβ(pd ) + Z) + pd .
            ∂µ                  n                     n
   For notational simplicity, from this point we write simply p for the price pd at the given
demand d. Plugging in
                                              −bp − a
                                       Z=n            ,
                                                 c
which must hold in a symmetric equilibrium, and writing β(p) = −â − b̂p, we have

             ∂E(p, Z, z i , µi )
                                                          
                                    n−1            −bp − a      2(n − 1)α3 bp + a
                      i
                                 =−       α1 + α5             +
                   ∂µ                n                c             n         c
                                                                
                                                         −bp − a
                                    + 2κ0 nâ + nb̂p + n           + p.
                                                            c


                                                        53
The candidate equilibrium strategy µi = z i is therefore optimal provided that

                         n−1       α5 a  2(n − 1)α3 a              2naκ0
                    0=−       α1 −        +              + 2κ0 nâ −
                           n      c            nc                   c
                       n − 1 α5 b    2(n − 1)α3 b              b
                    0=             +              + 2κ0 n b̂ −      + 1,
                         n    c           nc                   c


or equivalently,
                                                                    
                          a   1      n−1        α5 a  2(n − 1)α3 a
                      â = −       −       α1 −        +
                          c 2nκ0       n          c           nc
                                                              
                          b  1     n − 1 α5 b     2(n − 1)α3 b
                      b̂ = −                    +              +1 .
                          c 2nκ0     n     c           nc


   These equations imply that

                                 a + cZ̄
                   ζ ≡ nâ + nb̂         +Z
                                  −b                               
                          1       n−1          α5 a  2(n − 1)α3 a
                     =−        −           α1 −       +
                        2κ0         n            c          nc
                                                                        
                             1     a + cZ̄     n − 1 α5 b     2(n − 1)α3 b
                        −                                   +              +1 .
                            2κ0      −b          n      c          nc

Evaluating this expression for ζ at p = −(a + cZ̄)/b, we have
                                                                       
                    −1        n−1        n − 1 a + bp 2(n − 1)α3 a + bp
               ζ=         p−        α1 +      α5        +                 .                (55)
                   2κ0          n          n        c         n    c

    Now, consider the IR condition associated with the HJB equation (51), that the optimal
choice for µi is an actual inventory report, as we have considered so far, rather than the non-
participation choice ν. From (51), this IR condition is that the sum of the cash transfer at
the optimal inventory report and the change in utility, V (Z̄, Z) − V (z i , Z), must be weakly
positive. This must hold at all possible z ∈ Rn , even if all traders have the average inventory
Z̄ when entering the size-discovery session. In particular, the sum of the cash transfers must
be weakly positive in this case, but is always weakly negative by budget balance, so the cash
transfers must sum to 0. In general, the sum of the cash transfers is
                                                  n
                                                       !               !2
                              √                  X               p
                        −n      −κ0 −nβ(p) +         µj − √               .
                                                 j=1
                                                             2n   −κ 0




                                               54
So, if the transfers are to sum to 0, it must be that
                                                n
                                                     !
                            √                  X                   p
                              −κ0 −nβ(p) +         µj −           √    =0
                                                      j=1
                                                                2n −κ0

and                                         !                                      !
                                 n                                      n
                                 X                 p                    X                   p
             |κ0 | −nβ(p) +            µj       −    = −κ0   −nβ(p) +         µj       −      = 0.   (56)
                                 j=1
                                                  2n                    j=1
                                                                                           2n

Recall from equation (55) that at the equilibrium strategies and the choice for β(p) that is
consistent with optimality, we have
                  n                                                           
                  X
                        j−1            n−1      n − 1 a + bp 2(n − 1)α3 a + bp
        −nβ(p) +     µ =            p−     α1 +      α5     +                    .
                 j=1
                         2κ0            n         n     c        n        c

Thus, for the IR condition µi 6= ν to hold, combined with (56), it must be that
                                                                             
                1 n−1          n−1        n − 1 a + bp 2(n − 1)α3 a + bp
                          p−        α1 +       α5       +
                2     n          n          n       c           n        c
                                                                           
                        1 n−1         n−1        n−1          2(n − 1)α3
                     =             p−       α1 −      α5 Z̄ −            Z̄
                        2      n        n          n               n
                     = 0.

    Put differently, for the equilibrium strategies to satisfy the IR condition, we need the con-
dition

                                            p = α1 + (α5 + 2α3 )Z̄.                                  (57)

We conjecture and later verify that (57) holds in equilibrium. Given this, we see that, in
equilibrium,
                                            n
                                          X          −p
                                 −nβ(p) +      µj =       .
                                           j=1
                                                    2κ0 n

   Likewise, we see that

                               a + cZ̄
         − β(p) + µi = â + b̂         + zi
                                 −b
                                                                               
                  i          1         n−1       n − 1 a + bp 2(n − 1)α3 a + bp
              = z − Z̄ −            p−      α1 +      α5     +
                           2κ0 n         n         n     c        n        c
                             p
              = z i − Z̄ −        .
                           2κ0 n2




                                                      55
   Now, if we plug β(p) = −â − b̂p into the definition of E(p, Z, z i , µi ), we arrive at

                                        Z − zi n − 1 i
                                                           
                i   i
       E(p, Z, z , µ ) = (α1 + α5 Z̄)           −        µ
                                           n        n
                                  Z − zi n − 1 i 2                  Z − zi n − 1 i
                                                                                      
                                                                i
                           + α3 (         −       µ ) + 2α3 z               −        µ
                                    n          n                      n          n
                                                                                        p2
                           + κ0 (n(â + b̂p) + Z − z i + µi )2 + p(µi + (â + b̂p)) +        .
                                                                                      4κ0 n2

   The partial derivative of E(p, Z, z i , µi ) with respect to p is then
                                                                                                 p
         Ep (p, Z, z i , µi ) = 2κ0 nb̂(n(â + b̂p) + Z − z i + µi ) + (µi + (â + 2b̂p)) +           .
                                                                                               2κ0 n2

   Plugging in the candidate µi = z i and the fact from above that â + b̂p = −Z̄ − p/(2κ0 n2 ),
we have
                                                                    
                     i   i             −p            i         p           p
          Ep (p, Z, z , µ ) = 2κ0 nb̂       + b̂p + z − Z̄ −       2
                                                                       +       2
                                                                                 = z i − Z̄.
                                      2κ0 n                  2κ0 n       2κ0 n

    Finally, for the candidate equilibrium reports and exchange demands, the associated cash
transfers are
                    n
                           !2
                                               p2       p2                                p2
                                                                                    
                   X
                         j         i                                 i          p
   κ0 −nβ(p) +         µ      + p(µ − β(p)) +        =        + p  z   − Z̄ −          +
                   j=1
                                              4κ0 n2   4κ0 n2                 2κ0 n2     4κ0 n2
                                                            = p(z i − Z̄)
                                                                a + cZ̄ i
                                                            =          (z − Z̄),                          (58)
                                                                  −b
which implies that

                                                 R0 = 0
                                                       a
                                                 R1 =
                                                      nb
                                                        c
                                                 R2 = 2
                                                      nb
                                                        c
                                                 R3 =
                                                      −nb
                                                       a
                                                 R4 =     .
                                                      −b
   The HJB optimization problem (51) to solve is equivalent to

            sup −Φ(a,b,c) (d; Z − z i )d + Vz (z i , Z)d + λE(Φ(a,b,c) (d; Z − z i ), Z, z i , µi ).      (59)
             d,µi




                                                      56
   Taking derivatives with respect to d and µi , respectively, we need the first-order conditions

                                                        ∂Φ(a,b,c) (d; Z − z i )
                    0 = − Φ(a,b,c) (d; Z − z i ) − d                            + Vz (z i , Z)
                                                                  ∂d
                              ∂Φ(a,b,c) (d; Z − z i )
                         +λ                           Ep (Φ(a,b,c) (d; Z − z i ), Z, z i , µi )
                                        ∂d
and
                                  0 = Eµi (Φ(a,b,c) (d; Z − z i ), Z, z i , µi ).
   We conjecture and later verify that the solution to these first-order conditions is a maximum.
To prove the result, these equalities must hold at d = a + bp + cz i , implying that

                                                                  a + cZ̄
                                       Φ(a,b,c) (d; Z − z i ) =           ,
                                                                    −b
and at µi = z i . We recall that

                                     ∂Φ(a,b,c) (d; Z − z i )      −1
                                                             =          .
                                               ∂d              b(n − 1)

From the above, the second equation is satisfied at p = −(a + cZ̄)/b and at the conjectured µi
as long as

                         n−1       α5 a  2(n − 1)α3 a              2naκ0
                    0=−       α1 −        +              + 2κ0 nâ −                                    (60)
                           n      c            nc                   c
                       n − 1 α5 b    2(n − 1)α3 b              b
                    0=             +              + 2κ0 n b̂ −      + 1,                                (61)
                         n    c           nc                   c

where we have written β(p) as β(p) = −â − b̂p. For the first-order condition on the demand d,
we need
                 1                                                    λ
       −p +            (a + bp + cz i ) + (α1 + 2α3 z i + α5 Z̄) −          Ep (p, Z, z i , µi ) = 0.
              b(n − 1)                                             b(n − 1)

   We showed that, at equilibrium, Ep = z i − Z̄. Plugging this in, and using Z̄ = (−bp − a)/c,
we see that
                                                                                     
           1                i               i     −bp − a          λ       i    −bp − a
 −p +           (a + bp + cz ) + α1 + 2α3 z + α5            −             z −             = 0.
       b(n − 1)                                      c         b(n − 1)            c




                                                        57
Gathering terms,
                                     1         b      λ
                         0 = −1 +         − α5 −
                                 (n − 1)       c c(n − 1)
                               1                  λ
                         0=          c + 2α3 −
                            b(n − 1)           b(n − 1)
                                                    
                               1                  −a         λ     a
                         0=          a + α1 + α5        −            .
                            b(n − 1)               c      b(n − 1) c

Rearranging,

                                 0 = −(n − 2)c − α5 (n − 1)b − λ                           (62)
                                 c = −2α3 b(n − 1) + λ,                                    (63)

while from the derivation of the linear-quadratic value function, we have
                                    −γ
                            α3 =
                                 r + λ − 2c
                                             c2
                                                              
                                     1
                            α5 =                − 2α3 c + nλR3 ,
                                 r+λ−c b


where R3 is the coefficient on Zz in the cash transfer. From the last section, in equilibrium we
have R3 = c/(−nb) and thus the relevant system of equations is
                                        −γ
                                α3 =
                                     r + λ − 2c
                                                 c2
                                                                 
                                         1                    λc
                                α5 =                − 2α3 c −      .
                                     r+λ−c b                   b


   Multiplying both sides of the equation for α5 by b(n − 1), we have
                                  1
                α5 b(n − 1) =         (c2 (n − 1) − 2α3 b(n − 1)c − λc(n − 1)),
                                r+λ−c
and plugging in the above, we have
                                                    nc
                                  α5 b(n − 1) =         (c − λ),
                                                  r+λ−c




                                                  58
so
                                                    
                                        nc
                   0 = −(n − 2)c −            (c − λ) − λ
                                     r+λ−c
                   0 = −(n − 2)c(r + λ − c) − nc(c − λ) − λ(r + λ − c)
                   0 = −2c2 + c(−(n − 2)(r + λ) + nλ + λ) − λ(r + λ)
                   0 = −2c2 + c(−(n − 2)r + 3λ) − λ(r + λ)
                                          p
                       (−(n − 2)r + 3λ) ± (−(n − 2)r + 3λ)2 − 8λ(r + λ)
                   c=                                                   .
                                                4
    It is clear that either both of the roots or neither of the roots are real. By the Déscartes rule
of signs, if both are real, they are either both positive, or neither are positive. In particular,
assuming that (−(n − 2)r + 3λ)2 − 8λ(r + λ) > 0 so that both roots exist, if we can show one
is negative then they both are negative. If −(n − 2)r + 3λ < 0, then the smaller root must be
negative and we are done. If −(n − 2)r + 3λ ≥ 0, then the larger root is positive so both roots
are positive. Thus we see we need that −(n−2)r +3λ < 0 and (−(n−2)r +3λ)2 −8λ(r +λ) ≥ 0,
which can be concisely written as
                                                        p
                                  −(n − 2)r + 3λ ≤ − 8λ(r + λ).

     Define
                         F (c, λ) = −2c2 + c(−(n − 2)r + 3λ) − λ(r + λ).
For each fixed λ, an equilibrium is determined by any c < 0 satisfying F (c, λ) = 0. The
condition that c < 0 is equivalent to b < 0, which ensures that the second-order condition
above holds.
   We have that Fcc = −4 < 0 and limc→−∞ F = limc→∞ F = −∞. Thus, as c increases from
negative infinity to infinity, Fc crosses from positive to negative exactly once, at

                                              −(n − 2)r + 3λ
                                       c0 =                  .
                                                    4
    Since there are two roots, we see the derivative Fc must be positive at the smaller root c(λ)
and negative at the larger root c(λ), so c(λ) < c0 < c(λ). Fix a λ ∈ (0, λ̄) and consider small,
disjoint neighborhoods around (λ, c(λ)) and (λ, c(λ)). Applying the implicit function theorem
to each of these functions,
                                  ∂c    Fλ    −r − 2λ + 3c
                                     =−    =−              .
                                  ∂λ    Fc        Fc
    Since c < 0 in either equilibrium, the numerator is always negative. We just showed that Fc
is positive at the smaller root and thus that ∂c(λ)
                                                  ∂λ
                                                      > 0, so that c increases monotonically in λ.
Also, since c < 0, it is clear that 2c < r + λ so the corresponding demand process is admissible.
    Now, recall that
                                        (r + λ − 2c)α3 = −γ,



                                                  59
which, combined with equation (63), implies that

                 c(r + λ − 2c) = −2α3 b(n − 1)(r + λ − 2c) + λ(r + λ − 2c)
                 c(r + λ − 2c) = 2γb(n − 1) + λ(r + λ − 2c).

   Using the above quadratic equation for c, this can be rewritten

          c(r + λ) − (c(−(n − 2)r + 3λ) − λ(r + λ)) = 2γb(n − 1) + λ(r + λ − 2c)
                     c(r + λ) − (c(−(n − 2)r + 3λ)) = 2γb(n − 1) − 2λc
                                          cr(n − 1) = 2γb(n − 1)
                                                      2γ
                                                  c=     b,                                    (64)
                                                       r
which implies that
                                               s                                      
                      2
                                                                      2
                     r             3λ                           3λ            8λ(r + λ) 
              b=         −(n − 2) +    ±            −(n − 2) +             −               .
                     8γ              r                            r               r2

   We note that
                           2
                                          λ2 6λ(n − 2)
             
               3λ             8λ(r + λ)                                 8λ
                  − (n − 2) −      2
                                        =   2
                                               −           + (n − 2)2 −
                r                r        r          r                   r
                                                       2
                                             λ                4λn
                                        =      − (n − 2) −        .
                                             r                 r

Thus, we have shown that
                                                    s                     
                               2
                                                                     2
                          −r            3λ               λ             4λn 
                     b=        (n − 2) −    ±               − (n − 2) −       .
                          8γ              r               r              r

   Further, since c < 0 and c = 2γb/r, we have b < 0, and since c increases monotonically in
λ so does b. Using the relation that c = 2γb/r and equation (63), we have
                                         c−λ            γ         λ
                              α3 =                =−         +          .                      (65)
                                       −2b(n − 1)    r(n − 1) 2b(n − 1)




                                                    60
   Using (62), we now have

                                 0 = −(n − 2)c − α5 (n − 1)b − λ
                                     −(n − 2)c − λ
                                α5 =
                                        b(n − 1)
                                      n − 2 2γ        λ
                                   =−           −
                                      n−1 r       b(n − 1)
                                     −2γ
                                   =      − 2α3 .                                             (66)
                                      r
   Recall that
                                      1            ac      
                              α1 =            rv +     + λR4 ,
                                    r+λ−c            b
where, based on the transfers, R4 = −a/b, so
                                                           
                                      1             ac aλ
                               α1 =            rv +    −      .
                                    r+λ−c            b    b

From the first-order condition for auction demand,
                                                     
                                 1                 −a        λ     a
                        0=            a + α1 + α5       −            .
                             b(n − 1)               c     b(n − 1) c

   Plugging in                                                   
                                      −2γ              c−λ
                                 α5 =     −2                          ,
                                       r             −2b(n − 1)
we have
                                                     2γ a
                                         0 = α1 +         ,
                                                      r c
implying that
                                               a
                                         α1 = − .                                             (67)
                                               b
   Now, plugging this into the above, we have
                                        1
                               α1 =         (rv + −cα1 + λα1 ),
                                      r+λ−c

from which it is clear that α1 = v and a = −bv. Returning to the coefficients â, b̂ defining β(p),
since
                                          a        r
                                             = −v
                                           c      2γ
and
                                             b    r
                                               =    ,
                                             c   2γ




                                                61
we have
                                                                           
                           a      1         n−1        α5 a  2(n − 1)α3 a
                    â =      −          −         α1 −       +
                           c 2nκ0             n          c           nc
                                                             
                           −vr         1       n−1            2γ     r
                      =          −           −        v−v
                            2γ      2nκ0         n             r    2γ
                           −vr
                      =         ,
                            2γ
                                                                       
                           b      1       n − 1 α5 b     2(n − 1)α3 b
                    b̂ =      −                        +               +1
                           c 2nκ0           n      c           nc
                            r        1
                      =        − 2 .
                           2γ 2n κ0
   Returning to the system of value function coefficients, it remains to calculate

                               1 c2
                                                                  
                                                                2
                         α4 =         + (λ − c)α5 + λα3 + λn R2
                               r −b
                                                           
                               1 ca
                         α2 =         + (λ − c)α1 + λnR1
                               r −b
                                            σZ2       ρi
                                                               
                          i    1      2
                         α0 =     α3 σi + α4 2 + α5 + λR0 .
                               r            n         n

   Plugging in the equilibrium formulas for R2 , R1 , and R0 , we have

                                 1 c2
                                                                  
                                                                cλ
                            α4 =         + (λ − c)α5 + λα3 +
                                 r −b                            b
                                                           
                                 1 ca                   aλ
                            α2 =         + (λ − c)v +
                                 r −b                    b
                                                 2
                                                         ρi
                                                           
                             i   1       2     σZ
                            α0 =     α3 σi + α4 2 + α5        .
                                 r             n          n

   Using the definitions of a, b, c, we thus have
                                                                    
                          1       2γ              −2γ               cλ
                    α4 =       − c + (λ − c)          − 2α3 + λα3 +
                          r        r               r                 b
                          1
                    α2 = (cv + (λ − c)v + −vλ),
                          r




                                                62
implying that α2 = 0 and that
                                                               
                             1              −2γ               2γλ
                        α4 =     2cα3 + λ       − 2α3 + λα3 +
                             r               r                 r
                             1              γ
                           = (2c − λ)α3 = + α3 .
                             r              r


   Finally, this implies that

                  1 γ σZ2
                                 2
                                                   ρi
                                                    
             i                    σZ      2
           α0 =            + α3       + σ i + α5
                  r r n2          n2                n
                    2           2              i
                                                        2γ ρi
                                                             
                  1 γ σZ          σZ      2    ρ
               =           + α3       + σi − 2       −
                  r r n2          n2           n         r n
                    2                                   2
                                                                          ρi     2γ ρi
                                                                                      
                  1 γ σZ             γ             λ          σZ    2
               =           + −              +                    + σi − 2      −         .
                  r r n2         r(n − 1) 2b(n − 1)           n2          n       r n

   Note that
                                          σZ2     2     ρi
                                              + σ i − 2
                                          n2            n
is the variance of Z1 /n − H1 conditional on Z0 , and is thus positive, so α0i declines in λ because
                            i

b < 0 and because b increases with λ.

B.3.1    Confirming conjectures
All that remains is to check that the conjectured conditions are true. First, we must verify the
equilibrium condition
                                     p = α1 + (α5 + 2α3 )Z̄.                                (68)
We see from the definitions of a, b, and c that

                                          a + cZ̄      2γ
                                     p=           = v − Z̄,
                                            −b          r
as hypothesized, while from the definition of α5 , α3 we have
                                                      −2γ
                                         2α3 + α5 =       ,
                                                       r
so (68) indeed holds.
    Next, we must confirm that the equilibrium exchange process and reporting process that
satisfy the first-order conditions for the optimization (59) correspond to a maximum. Recall




                                                 63
that
                                                                           2
                                 Z − zi n − 1 i         Z − zi n − 1 i
                                                    
        i     i
E(φ, Z, z , µ ) ≡ (α1 + α5 Z̄)          −    µ + α3           −          µ
                                   n       n              n         n
                            Z − zi n − 1 i                                                   φ2
                                          
                        i
                + 2α3 z           −       µ + κ0 (−nβ(φ) + Z − z i + µi )2 + φ(µi − β(φ)) +        .
                              n       n                                                     4κ0 n2

   Direct calculation shows
              ∂E(φ, Z, z i , µi )     n−1                    2(n − 1)2       i     n − 1 Z − zi
                                  = −      (α1 +  α  5 Z̄) +           α 3 µ   − 2      α3
                   ∂µi                  n                       n2                   n     n
                                        n−1
                                      −       2α3 z i + 2κ0 (−nβ(φ) + µi + Z − z i ) + φ,
                                          n


                                     ∂ 2 E(φ, Z, z i , µi )   2(n − 1)2
                                                            =           α3 + 2κ0 ,
                                            ∂ 2 µi               n2


                                        ∂ 2 E(φ, Z, z i , µi )
                                                               = −2κ0 nβ 0 (φ) + 1,
                                              ∂µi ∂φ


                            ∂ 2 E(φ, Z, z i , µi )                                        1
                                     2
                                                   = 2κ0 n2 (β 0 (φ))2 − 2β 0 (φ) +
                                   ∂ φ                                                  2κ0 n2
                                                       1               2      0
                                                                                   2
                                                   =          1   − 2n   κ0 β   (φ)   .
                                                     2κ0 n2
    We have that κ0 < 0 by assumption, and we see from equation (65) that α3 ≤ −γ/(r(n−1)).
It follows that
                                    ∂ 2 E(φ, Z, z i , µi )
                                                           < 0.
                                           ∂ 2 µi
   Now, define
                                                               −rκ0 n 1 1
                                        Θ ≡ 2κ0 nβ 0 (φ) =           + > .
                                                                 γ    n n
   Noting that
                                        ∂Φ(a,b,c) (D; Z − z i )      −1
                                                                =          > 0,
                                                  ∂D              b(n − 1)
we see that
            ∂ 2 E(Φ(a,b,c) (D; Z − z i ), Z, z i , µi )   ∂ 2 E(φ, Z, z i , µi )        −1
                               2
                                                        =          2
                                                                                 (              )2
                             ∂ D                                  ∂ φ              b(n − 1)
                                                              1              2        0
                                                                                            2      −1
                                                        =       2
                                                                   1 −   2n    κ  0 β   (φ)    (          )2 < 0.
                                                          2κ0 n                                  b(n − 1)



                                                            64
   The full optimization is
                                                 sup Q(d, µi , z, Z)                                            (69)
                                                 d,µi

where

    Q(d, µi , z i , Z) = −Φ(a,b,c) (d; Z − z i )d + Vz (z i , Z)d + λE(Φ(a,b,c) (d; Z − z i ), Z, z i , µi ).   (70)

   It is clear from the above that
                       ∂ 2 Q(d, µi , z i , Z)     ∂ 2 E(Φ(a,b,c) (d; Z − z i ), Z, z i , µi )
                                              = λ                                             < 0.              (71)
                              ∂ 2 µi                               ∂ 2 µi
   We also have that
          ∂ 2 Q(d, µi , z i , Z)       0                 i       ∂ 2 E(Φ(a,b,c) (d; Z − z i ), Z, z i , µi )
                                 = −2Φ (a,b,c) (d; Z − z   ) + λ
                 ∂ 2d                                                              ∂ 2d
                                                                  2 2
                                                                       ∂ E(φ, Z, z i , µi )
                                                    
                                      2                     1
                                 =            +λ
                                   b(n − 1)           −b(n − 1)               ∂ 2φ
                                                                 2
                                      2                     1            1               2      0
                                                                                                     2
                                 =            +λ                                 1 −  2n   κ0 β   (φ)    < 0.
                                   b(n − 1)           −b(n − 1) 2κ0 n2

   We now prove that the second-order condition for a maximum holds at the optimum: the
quantity
           2                                                                    2
             ∂ Q(D, µi , z i , Z)
                                   2
                                    ∂ Q(D, µi , z i , Z)
                                                           2
                                                            ∂ Q(D, µi , z i , Z)
                                                          −
                   ∂ 2D                  ∂ 2 µ2                 ∂D∂µi

is positive. First, note that

                        ∂ 2 Q(D, µi , z i , Z)    ∂ 2 E(Φ(a,b,c) (D; Z − z i ), Z, z i , µi )
                                               =λ
                              ∂D∂µi                               ∂D∂µi
                                                                         2              i    i
                                                    0                 i ∂ E(φ, Z, z , µ )
                                               = λΦ(a,b,c) (D; Z − z )
                                                                              ∂φ∂µi
                                                      λ
                                               =              (1 − Θ) .
                                                 −b(n − 1)

   From the above,

                         ∂ 2 Q(D, µi , z i , Z)     ∂ 2 E(Φ(a,b,c) (D; Z − z i ), Z, z i , µi )
                                                = λ
                                ∂ 2 µi                                ∂ 2 µi
                                                       2(n − 1)2
                                                                            
                                                =λ                  α3 + 2κ0 ,
                                                           n2




                                                          65
so this is equivalent to showing that
                                 2
                                                                 2(n − 1)2
                                                                               
            2               1         1        2    0
                                                         2
                 +λ                      1 − 2n κ0 β (φ)      λ            α3 + 2κ0
        b(n − 1)        −b(n − 1) 2κ0 n2                            n2
                             2
               λ
    −                (1 − Θ) > 0.
          −b(n − 1)

   Pulling out λ2 /(b(n − 1))2 which is positive, this has the same sign as
                                                                                    2
                                                       2(n − 1)2
                                                                       
          2b(n − 1)     1             2    0
                                              2
                    +          1 − 2n κ0 β (φ)                   α3 + 2κ0   − 1−Θ
              λ       2κ0 n2                               n2
                                                                               2
                                                 2(n − 1)2
                                                                 
            2b(n − 1)     1              2
        =             +         (1 − nΘ)                   α3 + 2κ0     − 1−Θ     .    (72)
                λ       2κ0 n2                      n2

   Now, suppose that Θ ≤ 1. We know that Θ > 1/n by definition, implying that

                                                         (n − 1)2
                                       (1 − Θ)2 <                 .
                                                            n2
   By definition of α3 in equation (65),

                            2(n − 1)2                     2(n − 1)2
                                                     
                                            2b(n − 1)
                                        α 3             >           ,
                               n2               λ            n2

and thus                                                                    2
                           2(n − 1)2
                                                                
                                              2b(n − 1)
                                           α3                 −       1−Θ        > 0.
                              n2                  λ
  It follows that the expression (72) is positive since the remaining terms are all positive.
Now, suppose that Θ > 1. In this case,
                                                      2
                          1                      1
                              2
                                        2
                                (1 − nΘ) 2κ0 =     − Θ > (1 − Θ)2
                        2κ0 n                    n

so that
                                 1
                                      (1 − nΘ)2 2κ0 − (1 − Θ)2 > 0.
                               2κ0 n2
   Again, this implies (72) is positive since all the remaining terms are positive. We have thus
shown for all possible values of Θ that the expression (72) is positive, which means we have
confirmed the conjecture that the solution to the first-order conditions maximizes (59).

B.3.2       Individual rationality
Finally, we must confirm the optimality of participation in the size-discovery sessions. Specifi-
cally, we must check that the equilibrium value achieved in the optimization (59) is higher than




                                                    66
the highest value achievable in the optimization

                                  sup −Φ(a,b,c) (d; Z − z i )d + Vz (z i , Z)d                           (73)
                                   d

that results from setting µi = ν and not participating in size discovery. We first calculate a
simplified expression for the equilibrium value achieved in (59). Recall that

                                          D = a + bφ + cz i = c(z i − Z̄)
                                          φ = α1 + (α5 + 2α3 )Z̄
                                  Vz (z i , Z) = α1 + 2α3 z i + α5 Z̄.

    Thus, on the equilibrium path,

                        −Φ(a,b,c) (D; Z − z i )D + Vz (z i , Z)D = 2cα3 (z i − Z̄)2 .

    Also, on the equilibrium path, at each size-discovery session trader i achieves a post-size
discovery inventory of Z̄. From equation (58), the equilibrium cash transfer is given by

                    a + cZ̄ i
                           (z − Z̄) = φ(z i − Z̄) = α1 + (α5 + 2α3 )Z̄ (z i − Z̄).
                                                                      
                      −b
    It follows that on the equilibrium path,

E(Φ(a,b,c) (D; Z − z i ), Z, z i , µi ) = V (Z̄, Z̄) − V (z i , Z̄) + α1 + (α5 + 2α3 )Z̄ (z i − Z̄)
                                                                                         

                                        = α1 + α5 Z̄ (Z̄ − z i ) + α3 Z̄ 2 − α3 (z i )2 − Z̄ − z i α1 + (α5 + 2α3 )Z̄
                                                                                                                    
                                                        2
                                        = −α3 z i − Z̄ .

    Putting this together, the supremized quantity inside the HJB (59) equals
                                                                  2
                                         α3 (−λ + 2c) z i − Z̄         .

   We now show the optimized value of the HJB (73) corresponding to no size discovery
participation is smaller for all (z i , Z̄). The first-order condition for (73) is

                     −Φ0(a,b,c) (D; Z − z i )D − Φ(a,b,c) (D; Z − z i ) + Vz (z i , Z) = 0.

    The second-order condition is satisfied since b < 0 for the equilibrium b. Plugging in values,
this is
               D        1
                              D + (n − 1)a + c(Z − z i ) + α1 + 2α3 z i + α5 Z̄ = 0.
                                                        
                    +
            b(n − 1) b(n − 1)

    Recall from equation (67) that α1 = −a/b, so this simplifies to
                               1
                                     2D + c(Z − z i ) + 2α3 z i + α5 Z̄ = 0.
                                                     
                            b(n − 1)


                                                      67
     Let D̂ denote the solution to this first-order condition:
                                   c             b(n − 1)
                             D̂ = − (Z − z i ) −          (2α3 z i + α5 Z̄).
                                   2                2
     We see that
                                      i          1     
                                                                                i
                                                                                  
                    Φ(a,b,c) (D̂; Z − z ) = −            D̂ + (n − 1)a + c(Z − z )
                                              b(n − 1)
                                              a c(Z − z i ) 2α3 z i + α5 Z̄
                                          =− −               +              .
                                              b 2b(n − 1)            2

     It follows that
                                                                     a c(Z − z i ) 2α3 z i + α5 Z̄
                                                                                                  
         i                        i                        i
     Vz (z , Z) − Φ(a,b,c) (D̂; Z − z ) = α1 + α5 Z̄ + 2α3 z − − −                 +
                                                                     b 2b(n − 1)           2
                                                                        i     i
                                                                                      
                                                               c(Z − z ) 2α3 z + α5 Z̄
                                        = α5 Z̄ + 2α3 z i − −             +
                                                               2b(n − 1)         2
                                                        i          i
                                          α5 Z̄ + 2α3 z     c(Z − z )
                                        =                 +           ,
                                                 2          2b(n − 1)

and thus
                                                   
              Vz (z i , Z) − Φ(a,b,c) (D̂; Z − z i ) D̂
                  α5 Z̄ + 2α3 z i c(Z − z i )
                                                                                         
                                                         c        i b(n − 1)       i
             =                     +                   − (Z − z ) −          (2α3 z + α5 Z̄)
                          2            2b(n − 1)         2             2
                                                              2
                               α5 Z̄ + 2α3 z i c(Z − z i )
                             
             = −b(n − 1)                       +                 .
                                        2           2b(n − 1)

     Now, we use equations (66) and (64) to write
                                                         2γ   c
                                          α5 + 2α3 = −      =− ,
                                                          r   b
so
             c Z − zi                 Z̄ − z i
                      = −(2α3 + α5 )(            + Z̄)
             b n−1                     n−1
                          1                                            1
                             (2α3 z i + α5 z i ) − (α5 Z̄ + 2α3 Z̄) −
                                                                                        
                      =                                                   α5 Z̄ + 2α3 Z̄ .
                        n−1                                           n−1




                                                   68
   It follows that
                                               2
                   α5 Z̄ + 2α3 z i c(Z − z i )
                 
      − b(n − 1)                  +
                          2         2b(n − 1)
                                                                                          2
         −b(n − 1)                i     1            i            i
                                                                        
      =              α5 Z̄ + 2α3 z +          2α3 (z − Z̄) + α5 (z − Z̄) − (α5 Z̄ + 2α3 Z̄)
             4                        n−1
                                              2
         −b(n − 1)             1                           2
      =              2α3 +         (2α3 + α5 )     z i − Z̄ .
             4               n−1

   Next, recall from equation (65) that

                                                γ         λ
                                    α3 = −           +          .
                                             r(n − 1) 2b(n − 1)

   It follows that
                          1                     2γ       λ        2γ
                 2α3 +       (2α3 + α5 ) = −         +        −         ,
                         n−1                 r(n − 1) b(n − 1) r(n − 1)


and pulling out b(n − 1), this is
                                                   2
                                  −1         4γb                2
                                           −     +λ    z i − Z̄
                               4b(n − 1)      r
                                     −1                        2
                               =            (−2c + λ)2 z i − Z̄ .
                                  4b(n − 1)


   Finally, note from the first equality in equation (65) that

                                                     c−λ
                                            α3 =
                                                   −2b(n − 1)

and thus that
                                           c−λ
                                |α3 | = |           |
                                         −2b(n − 1)
                                          2c − λ        λ
                                      =|             +        |
                                         −4b(n − 1) 4b(n − 1)
                                          2c − λ
                                      >|            |,
                                         −4b(n − 1)

where the last line follows from the fact that both terms inside the absolute value are negative:




                                                    69
b < 0, c < 0 from the calculations of the previous section. It follows that
                                                              −1
                                      α3 (2c − λ) >                  (−2c + λ)2 .
                                                           4b(n − 1)

Since the equilibrium value of the quantity inside the HJB equation (59) is
                                                                           2
                                                   α3 (−λ + 2c) z i − Z̄        ,

and the best achievable value in the HJB (73) corresponding to µi = ν is
                                           −1                        2
                                                  (−2c + λ)2 z i − Z̄ ,
                                        4b(n − 1)

we have shown that µi = ν is suboptimal, relative to the equilibrium strategy. It follows that
µi = z i , D = a + bφ + cz i maximizes the HJB equation in Proposition 5.
   In summary, we have shown that for the coefficients (a, b, c) given by (14)-(16), the value
function V i specified by (9) solves the HJB equation (51). Moreover, the optimization problems
posed in the HJB equation are solved by the exchange demand d = a + bp + cz i for p = P (Z̄),
and by the individual rationality of participation in size-discovery sessions with the truthful
report µi = z i . This completes the proof of Proposition 5.

B.4        Verification of optimality of candidate equilibrium strategies
In this section, we fix κ0 < 0 and λ ≤ λ̄, as well as demand function coefficients (a, b, c)
satisfying the conditions of Proposition 5, including 2c < r + λ. We fix the corresponding
candidate value function V for trader i specified by Proposition 5. We fix some admissible
demand process D, and report process µ, by which the inventory of trader i at any time t < T ,
including the jumps that occur at size-discovery sessions, is
                                 Z t                  X
                       D,µ   i
                     ẑt = z0 +      Ds ds + Hti +            Y i ((µk , zτ−i
                                                                           k
                                                                              )).
                                               0                  {k: t0 <τk ≤t}


       We define

                                      Ut = 1t<T V (ẑtD,µ , Zt ) + 1t≥T vztD,µ .                                 (74)

    For the remainder of this verification proof, we fix the filtration {F t : t ≥ 0}. Let µ̃ be the
process that is defined on the k-th stochastic interval (τk−1 , τk ], for any k, by µ̃t = µk , and let
µ̂ be the optional projection38 of µ̃. Because µ̂(τk ) = µk , we can re-write the sum
                            X
                                    TQi ((µk , zτ−i
                                                 k
                                                    ), Φ(a,b,c) (Dτk ; Zτk − zτD,µ
                                                                               k
                                                                                   ))
                             {k: t0 <τk ≤T }

  38
    The intuition is that µ̂t is essentially the same, for t ∈ (τk−1 , τk ], as E(µk | F t ). See Protter (2005), pages
367-369.



                                                             70
as the integral                       Z     T
                                                TQi ((µ̂t , zt−i ), Φ(a,b,c) (Dt ; Zt − ztD,µ )) dNt
                                        0

and likewise for {k: t0 <τk <T } Y i ((µk , zτ−i
                       P
                                              k
                                                 )).
   Following the steps of the derivation of the value function, Itô’s Formula implies that
                                                     Z T       
                                     E(UT − U0 ) = E      ζ̃s ds ,
                                                                               0

where39
                                             σZ2               ρi
   ζ̃s = Ds (α1 + α5 Z̄s + 2α3 zsD,µ ) + α4      + α σ
                                                    3 i
                                                       2
                                                         + α 5
                                             n2                n
             + λY ((µ̂s , zs ))(α1 + α5 Z̄s + 2α3 zs + α3 Y ((µ̂s , zs−i ))) + r(vzsD,µ − V (zsD,µ , Zs )).
                 i         −i                      D,µ         i


       Because V satisfies the HJB equation (51), we have
                                 Z T                                                
                                                              D,µ           D,µ 2
                E(UT − U0 ) ≤ E       Ds Φ(a,b,c) (Ds ; Zs − zs ) + γ(zs ) ds
                                   0
                                     Z T                                               
                                            i          −i                        D,µ
                                 −E       TQ ((µ̂s , zs ); Φ(a,b,c) (Ds ; Zs − zs )) dNs .
                                                          0

Rearranging,
                                                        Z    T                                                             
                V   (z0i , Z0 )   ≥E       πzTD,µ    +            −Ds Φ(a,b,c) (Ds ; Zs −   zsD,µ )   −   γ(zsD,µ )2   ds
                                                          0
                                                Z   T                                                            
                                     +E                  TQi ((µ̂s , zs−i ); Φ(a,b,c) (Ds ; Zs
                                                                                 −               zsD,µ )) dNs
                                            0
                                             Z T                                                    
                                        D,µ                                     D,µ        D,µ 2
                                  = E πzT +       −Ds Φ(a,b,c) (Ds ; Zs − zs ) − γ(zs ) ds
                                               0
                                                                                                    
                                              X
                                     + E           TQi ((µk , zτ−i
                                                                 k
                                                                    ), Φ(a,b,c) (Dτk ; Zτk − zτD,µ
                                                                                               k
                                                                                                   )) .
                                                  {k: t0 <τk <T }


Because V satisfies the HJB equation (51), this relationship holds with equality for the conjec-
tured equilibrium strategy, so this conjectured equilibrium strategy is optimal and V is indeed
the value function, as proposed by Proposition 5. Combining with the results of the previous
subsection, this completes the proof of Proposition 1.
  39
    In the definition of ζ̃, we have used the fact that ẑ D,µ = z D,µ for almost every (ω, t), so that ẑ D,µ and z D,µ
                                                    RT
can be used interchangeably without affecting E( 0 ζ̃s ds).




                                                                        71
C      Proof of Proposition 2
In this section, we provide a proof of Proposition 2, showing that the dark-pool size-discovery
mechanism leads to the same equilibria as the linear-quadratic mechanism. We take the setup of
Proposition 1, but consider size-discovery transfer and reallocation functions defined in Section
3.5.1.

C.1     Potential equilibrium value functions
In this section, we characterize the potential equilibrium value functions. In any equilibrium,
each trader submits an affine demand function of the form (1) for some coefficients (a, b, c):

                                   Di (ω, t, p) = a + bp + czti (ω).
    It follows that in any equilibrium, the exchange price must be

                                                  a + cZ̄t
                                           φt =            .                                    (75)
                                                    −b
   Also, by our equilibrium definition, in any equilibrium the dark-pool mechanism produces
the efficient allocation, so the mechanism allocates Z̄ − z i units of the asset to each trader. The
dark-pool cash transfer function is TDi (µ, p) = −p Y i (µ), so combining these facts, in equilibrium
the mechanism cash transfer must equal
                                                  
                                          a + cZ̄t
                                                     (z i − Z̄).
                                             −b
    From equation (58), we see this implies that for any fixed (a, b, c), the equilibrium cash trans-
fers are the same for this dark-pool mechanism as they are for the linear-quadratic mechanism
(TQ , Y ). In particular, the equilibrium dark-pool cash transfers can be written as

                               R0 + R1 Zt + R2 Zt2 + R3 Zt zti + R4 zti

for the same same coefficients

                                             R0 = 0
                                                   a
                                             R1 =
                                                  nb
                                                    c
                                             R2 = 2
                                                  nb
                                                    c
                                             R3 =
                                                  −nb
                                                   a
                                             R4 =     .
                                                  −b
    We note that this fact does not rely on the exact form of Y i . Applying Lemma 3, for any
(a, b, c) the candidate equilibrium value functions for the dark-pool mechanism are thus exactly
the same as the candidate equilibrium value functions for the linear-quadratic mechanism. It


                                                  72
just remains to show that the only (a, b, c) consistent with equilibrium are those stated in
Proposition 1.

C.2         An intermediate optimization problem
The following lemma summarizes a key result for the proof of Proposition 2.

Lemma 4. Fix some candidate coefficients (a, b, c) with b < 0 and some trader i. Let V (z, Z)
denote the linear-quadratic equilibrium value function for trader i implied by the coefficients
(a, b, c) by Lemma 3. Then the solution (D∗ , y∗i ) to
                                                                                               
                        i          i                 i i          i                         i i
sup {−Φ(a,b,c) (D; Z − z )D + Vz (z , Z)D + λ V (z + y , Z) − V (z , Z) − Φ(a,b,c) (D; Z − z )y },
D,y i
                                                                                                             (76)
satisfies

                                     D∗ = a + bΦ(a,b,c) (D∗ ; Z − z i ) + cz i                               (77)
                                      y∗i           i
                                            = Z̄ − z ,

for all z i , Z if and only if (a, b, c) are those given in Proposition 1. If (a, b, c) are those given
in Proposition 1, the solution (D∗ , y∗i ) is unique.

   Proof: Fix coefficients (a, b, c) with b < 0 and a trader i. First, note the first derivative of
the above objective with respect to y i is

                            λ Vz (z i + y i , Z) − Φ(a,b,c) (D; Z − z i ) ,
                                                                         
                                                                                               (78)

while the second derivative is λVzz (z i + y i , Z). The first derivative with respect to D is

        − Φ0(a,b,c) (D; Z − z i )D − Φ(a,b,c) (D; Z − z i ) + Vz (z i , Z) − λΦ0(a,b,c) (D; Z − z i )y i ,   (79)

while the second derivative is −2Φ0(a,b,c) (D; Z − z i ). Finally, the cross partial is

                                               −λΦ0(a,b,c) (D; Z − z i ).

    The Hessian of the objective is thus

                              λVzz (z i , Z)        −λΦ0(a,b,c) (D; Z − z i )
                                                                             
                                                                                .
                          −λΦ0(a,b,c) (D; Z − z i ) −2Φ0(a,b,c) (D; Z − z i )

    Now, suppose that D∗ , y∗i satisfy (77). Note that

                                      D = a + bΦ(a,b,c) (D; Z − z i ) + cz i

if and only if
                                               −1
                                                     D + (n − 1)a + cZ −j + cz i ,
                                                                         
                            D =a+b
                                            b(n − 1)

                                                          73
which holds if and only if
                                       −1
      bΦ(a,b,c) (D; Z − z i ) = b            a + bΦ(a,b,c) (D; Z − z i ) + cz i + (n − 1)a + cZ −j ,
                                                                                                  
                                    b(n − 1)

which in turn holds if and only if

                                                                   a + cZ̄
                                        Φ(a,b,c) (D; Z − z i ) =           .
                                                                     −b
   Now, since the objective is differentiable, the optimal D∗ , y∗i must satisfy the first-order
conditions implied by the derivatives (78), (79). Plugging in the above equation and the value-
function coefficients α1 through α5 implied by the coefficients (a, b, c) according to Lemma 3,
we can write the first-order condition implied by (78) as

                                                                         a + cZ̄
                                Vz (Z̄, Z) = 2α3 Z̄ + α1 + α5 Z̄ =               .
                                                                           −b
Rearranging, this holds if and only if
                                                          a
                                                       α1 =                                              (80)
                                                          −b
                                                          c
                                               2α3 + α5 =    .                                           (81)
                                                          −b
    Likewise, plugging in the value-function coefficients α1 through α5 implied by the coefficients
(a, b, c) according to Lemma 3, the derivative in equation (79) can be rearranged as

      − Φ0(a,b,c) (D; Z − z i )D − Φ(a,b,c) (D; Z − z i ) + Vz (z i , Z) − λΦ0(a,b,c) (D; Z − z i )y i
                                                                                i
                                                                                  
                    D          a + cZ̄                              λ    Z̄ − z
            =             −            + 2α3 z i + α1 + α5 Z̄ +                     .
                 b(n − 1)        −b                                    b(n − 1)

   Plugging in the above conditions (80)-(81), this derivative is equal to
                                                                  i
                                                                    
                             D                         λ   Z̄ − z
                                   + 2α3 z i − Z̄ +
                                                   
                                                                      .
                          b(n − 1)                       b(n − 1)

Using the fact that a + bφ + cz i = c(z i − Z̄) in equilibrium (see equation (75)), this is equal to
                                                                    
                              i              c                 λ
                            (z − Z̄)               + 2α3 −             .
                                        b(n − 1)            b(n − 1)

   The first-order condition implied by equation (79) thus holds if and only if

                                           c = −2α3 b(n − 1) + λ.                                        (82)




                                                       74
   Now, from the derivation of the linear-quadratic value function in Lemma 3, we have
                                            2                 
                                      1      c
                           α5 =                − 2α3 c + nλR3 .
                                 r+λ−c b

From the last section, in equilibrium we have R3 = c/(−nb) and thus
                                              2              
                                       1      c            λc
                              α5 =               − 2α3 c −      .
                                    r+λ−c b                 b

   Multiplying both sides by b(n − 1), we have
                                  1
                                      c2 (n − 1) − 2α3 b(n − 1)c − λc(n − 1) .
                                                                            
                α5 b(n − 1) =
                                r+λ−c
Plugging in equation (82),
                                               nc
                                  α5 b(n − 1) =   (c − λ) .                                   (83)
                                            r+λ−c
   Multiplying both sides of (81) by b(n − 1),

                             2α3 b(n − 1) + α5 b(n − 1) = −c(n − 1),

and plugging in equations (82) and (83),
                                       nc
                                λ+         (c − λ) + c(n − 2) = 0.
                                     r+λ−c
    This is precisely the same equation for c as that in the proof of Proposition 1. Thus, if
D∗ , y∗i satisfy (77), then c is one of the two values from Proposition 1. By Lemma 3, each value
of c implies a particular value of α3 (the same as that shown in Proposition 1). By equation
(82), any (c, α3 ) pair implies a particular value of b, and by equation (63) this must be the same
value for b as in Proposition 1. By Lemma 3,
                                             1           ac       
                                   α1 =             rv +     + λR4 ,
                                         r+λ−c             b
where, based on the transfers, R4 = −a/b. Thus,
                                                         
                                      1            ac aλ
                               α1 =           rv +    −     .
                                    r+λ−c           b   b

   Plugging in equation (80), which also holds in the proof of Proposition 1 (see equation (67)),
                                                              
                               a         1            ac aλ
                                 =               rv +    −       ,
                              −b    r+λ−c              b     b

which implies a unique value of a for any given b, c. In summary, if D∗ , y∗i satisfy (77), then c
must be one of the two values from Proposition 1, and b, a must be the corresponding values
from Proposition 1.

                                                  75
   Next, suppose that (a, b, c) are as specified by Proposition 1. Going backward through the
same steps, this means the first-order conditions are satisfied by the values D∗ , y∗i satisfying
(77). We rewrite the Hessian as         "             #
                                                    λ
                                          λα3 b(n−1)
                                            λ       2   ,
                                                 b(n−1)    b(n−1)

which has determinant
                                                λ2α3       λ2
                                                      − 2         .
                                              b(n − 1) b (n − 1)2
The determinant has the same sign as

                                                2α3 b(n − 1) − λ.

If condition (82) holds, this in turn has the same sign as −c. Since we’ve assumed a value of c
from Proposition 1, we have that the determinant of the Hessian is strictly positive. Because
the value of c specified in Proposition 1 implies the negative value of α3 from Proposition 1,
the trace is negative. Under these conditions, the Hessian is negative definite everywhere and
the values D∗ , y∗i satisfying (77) produce the unique local maximum in the objective.

C.3      Completing the proof
In this subsection, we characterize the set of demand coefficients (a, b, c) with the property that
the corresponding candidate equilibrium value functions given by Lemma 3 satisfy the HJB
equation characterizing optimality. Fix some candidate coefficients (a, b, c). Fixing trader i and
assuming all traders other than trader i use the equilibrium strategy corresponding to (a, b, c),
the HJB equation of trader i is

                     i 2         i        i   σi2      i       σZ2
          0 = −γ(z ) + r(vz − V (z , Z)) + Vzz (z , Z) +           VZZ (z i , Z) + ρi VzZ (z i , Z)          (84)
                                              2                 2
               + sup {−Φ(a,b,c) (D; Z − z i )D + Vz (z i , Z)D + λΘ},
                    D,µ


where

                     Θ = V (z i + Y i (µ), Z) − V (z i , Z) − Φ(a,b,c) (D; Z − z i )Y i (µ).

   We claim that if (a, b, c) take the values proposed by Proposition 1, then the corresponding
equilibrium strategy solves the optimization in this HJB equation. Suppose, for a proof by
contradiction, that this were false. Then there exists some D0 , µ0 such that the objective

−Φ(a,b,c) (D0 ; Z −z i )D0 +Vz (z i , Z)D0 +λ V (z i +Y i (µ0 ), Z)−V (z i , Z)−Φ(a,b,c) (D0 ; Z −z i )Y i (µ0 )
                                                                                                                 


is larger than the value corresponding to the equilibrium strategy. But at the equilibrium
strategy, Y i (µ) = Z̄ − z i , so this contradicts Lemma 4. Since, at the values (a, b, c) from
Proposition 1, the HJB optimization problem is solved by the equilibrium strategy, we can



                                                          76
reduce the HJB equation to

                                               σi2                σ2
0 = −γ(z i )2 + r(vz i − V (z i , Z)) +            Vzz (z i , Z) + Z VZZ (z i , Z) + ρi VzZ (z i , Z)
                                               2                  2                                                          
                 ∗          i   ∗          i        ∗                             i                     ∗             i   ∗
  − Φ(a,b,c) (D ; Z − z )D + Vz (z , Z)D + λ                   V (Z̄, Z) − V (z , Z) − Φ(a,b,c) (D ; Z − z )µ                     .

    Since the equilibrium size-discovery transfers in Proposition 1 are also equal to

                                               −Φ(a,b,c) (D∗ ; Z − z i )µ∗ ,

by equation (58), this is the same HJB equation as that of Proposition 1. The same verification
argument thus shows that the candidate equilibrium strategy is optimal.
    Finally, suppose the fixed (a, b, c) values are not those from Proposition 1. Then by Lemma
4, there exists some D0 , y 0 such that the objective

  −Φ(a,b,c) (D0 ; Z − z i )D0 + Vz (z i , Z)D0 + λ V (z i + y 0 , Z) − V (z i , Z) − Φ(a,b,c) (D0 ; Z − z i )y 0
                                                                                                                 


is higher than that achieved by the candidate equilibrium strategy. Since, fixing the equilibrium
truth-telling report of any trader i 6= j, the function Y i (µ) is surjective, there exists a report
µ0 with Y i ((µ0 , z −i )) = y 0 such that the objective

        − Φ(a,b,c) (D0 ; Z − z i )D0 + Vz (z i , Z)D0
                     V (z i + Y i ((µ0 , z −i )), Z) − V (z i , Z) − Φ(a,b,c) (D0 ; Z − z i )Y i ((µ0 , z −i ))
                                                                                                                  
            +λ

is higher than that achieved by the candidate equilibrium strategy. Thus, if (a, b, c) are not as
specified by Proposition 1, the candidate equilibrium strategy does not solve the HJB equation.
Since the candidate equilibrium value function is twice-continuously differentiable, standard
verification arguments show the HJB equation is a necessary condition for optimality. It follows
that the candidate equilibrium is not an equilibrium, completing the proof.

C.4      Extension to proportional dark-pool rationing
Here, we extend all of our conclusions about the equilibrium properties of augmenting exchange
trading with size discovery to the commonly used dark-pool size-discovery mechanism defined
by proportional rationing of heavy-side order submissions (Zhu, 2014).
    In the last proof, we did not actually use the form of the size-discovery allocation function
Y , beyond the property that if each trader truthfully reports µi = z i , then the reallocation
  i

function Y i generates the efficient allocation. We can therefore adapt all of the arguments used
in our demonstration of equilibrium for Proposition 1 to the size-discovery design in which the
asset reallocation function is instead YP , defined by
                                                                                  j 
                                                                   P
                                                                        i µj ≤0 µ
                                 
                     i         i                                    j:µ
                   YP (µ) ≡ µ      1{µi Pj µj ≤0} + 1{µi Pj µj >0} P              j
                                                                                      .      (85)
                                                                    j:µi µj >0 µ


    This reallocation function YP represents proportional rationing, as used in practice in stan-

                                                             77
dard dark pools. For example, if trader i reports a request for P      µi ≥ 0 units of the asset and
if the total net requested demand is weakly negative, in that j µj ≤ 0, then the order of
trader i is entirely filled, with trader i receiving µi . Likewise, if trader            i
                                                                        P j i requests µ ≤ 0 units
of the asset and the total net demand is weakly positive, in that j µ ≥ 0, then the demand
is entirely filled, in that trader i again receives µi . However,
                                                               P if the trader is on the heavy side,
in that µi 6= 0 shares the same sign as the total demand j µj 6= 0, then the demand of trader
i order is proportionally rationed, matching total sales to total purchases.
    With this proportional dark-pool allocation function YP , if each trader i reports the demand
µ = Z̄ − z i , the resulting allocation is efficient, the total net demand is zero, and all orders
  i

are filled. This proportional-rationing dark-pool size-discovery trade protocol uses the cash
allocation function TP analogous to that used for the linear-rationing size-discovery model,
defined by
                                         TPi (µ, p) = −pYPi (µ).
    Now, we can define equilibrium for the proportional size-discovery mechanism as a collection
of demand coefficients (a, b, c) such that if each trader j 6= i uses the strategy

                                  Dj (ω, t, p) = a + bp + cztj (ω)
                                                 −a − bφτk
                                           µjk =            − zτjk ,                             (86)
                                                      c
then trader i finds it optimal to use the same strategy. This equilibrium definition is identical
to that for the model whose properties are characterized by Proposition 1, for the cases of
linear-rationing dark-pool size discovery and linear-quadratic size discovery, with the exception
that for proportional dark-pool rationing traders use the size-discovery report of equation (86)
rather than truthful reporting. Given the proportional-rationing asset reallocation function
defined above, this leads to efficient reallocations because µjk = Z̄τk − zτjk at the equilibrium
price. Because the proof of Proposition 2 did not actually use the specific functional form of
YPi , identical arguments used in the proof of equilibrium imply that the coefficients (a, b, c)
correspond to an equilibrium in this modified setting if and only if the coefficients are those
specified by Proposition 1. Moreover, the resulting allocations and equilibrium value functions
are identical to those of Proposition 1.


D      The model with observable total inventory
In this appendix, as opposed to situation examined in the main model, the aggregate inventory
Zt is assumed to be observable by the size-discovery operator. Our size-discovery sessions use
the mechanism design (Y, Tκ ) of Appendix A, restricting attention to the affine functions κ1 ( · )
and κ2 ( · ) of Zt that exploit the properties of Propositions 3 and 4. We will calculate intercept
and slope coefficients of both κ1 ( · ) and κ2 ( · ) that are consistent with the resulting endogenous
continuation value functions. In equilibrium, these coefficients imply the transfer function given
in Section 3.7. The model setup is otherwise unchanged.
    We will show that equilibrium exchange-market demand behavior in this new setting is of
the same affine form that we found in the main model, but has different demand coefficients.
    The demand process Di and size-discovery reports {µi1 , µi2 , . . .} of each trader i imply that

                                                 78
the inventory process of trader i is
                                                                                                      Pn
                                                    t                                                          µjk
                                         Z                                             X                 j=1
                    zti   =    z0i   +                  Dsi   ds +    Hti   +                                        − µik .     (87)
                                            0                                                              n
                                                                                {k:τk <min(t,T )})


    Our notion of equilibrium implies market clearing, rational conjectures of other traders’
strategies, and individual-trader optimality, including the incentive compatibility of truth-
telling and individual rationality of participation in all size-discovery sessions. Appendix F
analyzes the discrete-time version of this model, showing that the analogous equilibrium is
Perfect Bayes.
    The definition of individual-trader optimality in this dynamic game is relatively obvious from
the main model, but is now stated for completeness. Taking as given the demand coefficients
(a, b, c) used by other traders and the mechanism design (Y, Tκ ) for size-discovery sessions,
trader i faces the problem of choosing a demand process Di and report process µi that solve
the problem
                                        sup Ei0 JAi (D, µ) ,
                                                         
                                                                                               (88)
                                                                  D,µ

where Ei0 denotes expectation conditional on F0i and
                                                              Z   T
                 JAi (D, µ)       =   zTD,µ π −  γ(ztD,µ )2 + Φ(a,b,c) (Dt ; Zt − ztD,µ )Dt dt
                                              X0
                                            +    Tκi ((µk , zτ−i
                                                              k
                                                                 )), Zτk ),
                                                        {k:τk <T }


where
                                        Z       t                                     X
                   ztj    =   z0j   +               D̂sj ds + Htj +                                 Y j ((µk , zτ−i
                                                                                                                 k
                                                                                                                    )), Zτk ),   (89)
                                            0                                   {k:τk <min(t,T )}
                                        Z       t                                    X
                 ztD,µ    =   z0i   +               Ds ds + Hti +                                   Y i ((µk , zτ−i
                                                                                                                 k
                                                                                                                    )), Zτk ),   (90)
                                         0                                  {k:τk <min(t,T )}

                                                                 
taking  D̂tj
           = a+bΦ(a,b,c) Dt ; Zt −                       ztD,µ
                                        +cztj . Here again, the equilibrium strategies are ex-post
optimal in the sense described in Section 4. That is, in any equilibrium and for any trader i,
if we relax the information requirement on (D, µ) by allowing observation of all other traders’
excess-inventory positions, trader i would have the same optimal policy.

Proposition 6. Suppose that λ < r(n − 2). Let κ0 < 0 be arbitrary, and fix the mechanism
design (Y, Tκ ) specified by (25) and (26), where

                                                          2γ Z̄t                                               κ1 (Zt )
                         κ1 (Zt ) = v −                          ,                   κ2 (Z) = −Z t −                    .
                                                            r                                                  2κ0 n2

  1. Among equilibria in the dynamic game associated with the sequential-double-auction mar-
     ket augmented with size-discovery sessions, there is a unique equilibrium with symmetric

                                                                            79
      affine double-auction demand functions. In this equilibrium, the double-auction demand
      function Dti of trader i in state ω at time t is given by

                                       −rλ + r2 (n − 2)
                                                                        
                             i                                    2γ i
                           Dt (ω, p) =                     v − p − zt (ω) .              (91)
                                               4γ                  r

      That is, the coefficients (a, b, c) of the demand function are

                    [−rλ + r2 (n − 2)]v                rλ − r2 (n − 2)                  λ − r(n − 2)
               a=                       ,      b=                      ,          c=                 .
                           4γ                                4γ                              2

  2. The market-clearing double-auction price process φ is given by φt = κ1 (Zt ).

  3. The mechanism design (Y, Tκ ) achieves the perfect post-session allocation z i (τk ) = Z(τk )
     for each trader i at each session time τk .

  4. For each trader i, the equilibrium continuation value V i (zti , Zt ) at time t is invariant to
     the mean frequency λ of size-discovery sessions. In particular, augmenting the exchange
     market with size discovery has no impact on any trader’s value. The value function is
     given by
                                                       
                                        γ 2        2γ                                   2
              V (zt , Zt ) = θi + vZ t − Z t + v − Z̄t zti − Z t − K zti − Z t ,
                i i
                                                                       
                                                                                                (92)
                                        r           r

      where
                                                           γ
                                              K=                 ,                                       (93)
                                                        r(n − 1)
                                        γ σZ2          σZ2           ρi         2γ ρi
                                                                                     
                                1                              2
                           θi =               −K           + σ i − 2          −             .            (94)
                                r       r n2           n2            n           r n

    To prove Proposition 6, we note that that proof of admissibility in Section B carries over
exactly to this setting, so a strategy is admissible if and only if 2c < r + λ. Also, the proof that
the value functions must take the linear-quadratic form in equation (47) carries over exactly,
although the R0 − R4 constants might be different. Given the value functions, we use individual
rationality to restrict the possible mechanism-transfer coefficients, and characterize the optimal
mechanism reports in the equilibrium. Next, we calculate the unique value function and affine
coefficients consistent with the HJB equation. Finally, we verify that the candidate value
function and these coefficients indeed solve the Markov control problem. Throughout, we write
V (z, Z) in place of V i (z, Z).

D.1     The mechanism-transfer coefficients
Fix a symmetric equilibrium. Recall the mechanism transfers for a session are given by
                                 n
                                       !2
                                X                                     κ2 (Zτ )
                κ0 nκ2 (Zτk ) +     µjk + κ1 (Zτk )(µik + κ2 (Zτk )) + 1 k2 .
                                j=1
                                                                       4κ0 n


                                                   80
   For the purpose of this proof, we will treat κ1 ( · ) and κ2 ( · ) as arbitrary affine functions,
and then show the particular choices of κ1 ( · ) and κ2 ( · ) stated by the proposition are the
unique functions consistent with equilibrium. From the above, this transfer function with
the conjectured reports leads to a linear-quadratic equilibrium value function V (z, Z). Thus,
maximizing V (z + y, Z) with respect to y is equivalent to maximizing

                                α1 (z i + y) + α3 (z i + y)2 + α5 Z̄(z i + y),

which in turn is equivalent to maximizing

                                       (α1 + α5 Z̄ + 2α3 z i )y + α3 y 2 .

   Then, when trader i chooses a report µik , it must be that this choice maximizes, suppressing
subscripts from the notation for simplicity,

               (α1 + α5 Z̄ + 2α3 z i )Y i ((µ, z −i )) + α3 Y i ((µ, z −i ))2 + Tκi ((µ, z −i ), Z).

The associated first-order condition is
                                                                                                       !
  n−1                           2(n − 1)α3 i                                          X
−     (α1 + α5 Z̄ + 2α3 z i ) −           Y ((µ, z −i )) + κ1 (Z) + 2κ0 nκ2 (Z) + µ +      zj              = 0.
   n                                n                                                 j6=i


Plugging in Y i , we have

                                             2(n − 1)α3 −(n − 1)µ Z − z i
                                                                         
                 n−1                    i
               −     (α1 + α5 Z̄ + 2α3 z ) −                     +
                  n                              n          n       n
                                                  i
                                                       
                  + κ1 (Z) + 2κ0 nκ2 (Z) + µ − z + Z = 0

    The second-order condition is satisfied because κ0 and α3 are strictly negative. Since κ2 is
affine, write κ2 (Z) = â + b̂Z. The report µ = z i satisfies this first-order condition if

               n−1                2(n − 1)α3                                
             −     (α1 + α5 Z̄) −            Z̄ + κ1 (Z) + 2κ0 nâ + nb̂Z + Z = 0.
                n                     n
With this,
                                                                    Ξ
                                          (nâ + nb̂Z + Z) =           ,
                                                                   2κ0
where
                                                  n−1
                               Ξ = −κ1 (Z) +          (α1 + (α5 + 2α3 )Z̄).
                                                   n
Thus,
                                                                       Ξ
                                     κ2 (Z) = â + b̂Z = −Z̄ +              ,
                                                                      2κ0 n




                                                        81
implying an equilibrium change in utility of

             Ξ2                               κ2 (Z)
                                        
                                     Ξ
                  + κ1 (Z) −Z̄ +           + 12
             4κ0                   2κ0 n      4n κ0
                        + (κ1 (Z) − α1 − α5 Z̄)z i + (α1 + α5 Z̄)Z̄ − α3 (z i )2 + α3 Z̄ 2 .

This change in utility must be weakly positive for any z and Z. If all traders have z = Z̄, then
we need that
                                                                         2
               Ξ2                       κ21 (Z)
                                                 
                                Ξ                       Ξ       κ1 (Z)
                    + κ1 (Z)           + 2 =− √              + √            ≥ 0,
               4κ0             2κ0 n    4n κ0        2 −κ0 2n −κ0

which implies that κ1 (Z) = α1 + (α5 + 2α3 )Z̄. Plugging this in, we see that

                                                  Ξ                 α1 + (α5 + 2α3 )Z̄
                   â + b̂Z + z i = z i − Z̄ +         = z i − Z̄ −                    .
                                                 2κ0 n                    2κ0 n2

                                 Pn
   So, we see that nκ2 (Z) +        j=1   ẑ j = −(α1 + (α5 + 2α3 )Z̄)/(2κ0 n), and thus the equilibrium
transfer to trader i is
          (α1 + (α5 + 2α3 )Z̄)2
                                                                                    
                                                        i       (α1 + (α5 + 2α3 )Z̄)
                                + (α1 + (α5 + 2α3 )Z̄) z − Z̄ −
                 4n2 κ0                                                2κ0 n2
                      (α1 + (α5 + 2α3 )Z̄)2
                   +
                              4n2 κ0
          = (α1 + (α5 + 2α3 )Z̄) z i − Z̄ .
                                         


   It follows that the equilibrium change in utility for trader i from the mechanism is

             (α1 + (α5 + 2α3 )Z̄) z i − Z̄ + (α1 + α5 Z̄)(Z̄ − z i ) + α3 (Z̄)2 − α3 (z i )2
                                          

                         = 2α3 Z̄z i − α3 (Z̄)2 − α3 (z i )2
                         = −α3 (z i − Z̄)2 ≥ 0,

where the final inequality relies on the fact that α3 is negative in an equilibrium. Putting this
together, as long as κ1 (Z) = α1 + (α1 + (α5 + 2α3 )Z̄)Z̄ and κ2 (Z) = â + b̂Z are given as above,
then in equilibrium all traders find the mechanism ex-post individually rational each time it is
run, and the strategy µi = z i is ex-post optimal. This is true only if κ1 (Z) and κ2 (Z) take the
specified forms.                                                                
   Finally, since the equilibrium transfers are (α1 + (α5 + 2α3 )Z̄) z i − Z̄ , we see that the
coefficients {Rm } in
                              R0 + R1 Zt + R2 Zt2 + R3 Zt zti + R4 zti ,




                                                      82
are given by

                                             R0 = 0
                                                     α1
                                             R1 = −
                                                      n
                                                     α5 + 2α3
                                             R2 = −
                                                         n2
                                                   α5 + 2α3
                                             R3 =
                                                        n
                                             R 4 = α1 .

   Recall from the previous section that
                                        −γ
                                α3 =
                                     r + λ − 2c
                                                  c2
                                                                    
                                         1
                                α5 =                 − 2α3 c + λnR3
                                     r+λ−c b
                                         1            ac       
                                α1 =             rv +     + λR4 .
                                     r+λ−c              b


Thus, plugging in R3 , R4 , and rearranging, we have
                                            −γ
                                   α3 =
                                             − 2c
                                        r + λ
                                                c2
                                                                  
                                          1
                                   α5 =            − 2α3 c + 2λα3
                                        r−c b
                                          1         ac 
                                   α1 =        rv +       .
                                        r−c           b



D.2     Solving the HJB equation
From the above, the value function takes the form

                     V (z i , Z) = α0i + α1 z i + α2 Z̄ + α3 (z i )2 + α4 Z̄ 2 + α5 z i Z̄.

The associated HJB equation, analogous to, but simpler than, (51), is

                                                 σi2                σ2
        0 = −γ(z i )2 + r(vz i − V (z i , Z)) +      Vzz (z i , Z) + Z VZZ (z i , Z) + ρi VzZ (z i , Z)
                                                 2                   2
               + sup{−Φ(a,b,c) (D; Z − z i )D + Vz (z i , Z)D
                 D,µ

               + λ V (z i + Y i ((µ, z −i )), Z) − V (z, Z) + Tκi ((µi , z −i ), Z) }.
                                                                                   


   From the previous subsection, we know that fixing the truthful candidate equilibrium reports


                                                      83
z −i of the other traders, the report µ = z i achieves the supremum in the HJB equation for any
D, as long as
                                                      α1 + (α5 + 2α3 )Z̄
                            κ2 (Z) = â + b̂Z = −Z̄ −                    .
                                                            2κ0 n2
    Since Vz = α1 +2α3 z i +α5 Z̄, we can follow steps identical to those of the proof of Proposition
5, and see that as long as b < 0, the unique demand that achieves the maximum in the HJB
equation is
                  1
             D = − [(n − 1)a + n(−bp − a) − cz i + b(n − 1) α1 + 2α3 z i + α5 Z̄ ].
                                                                                
                  2
   Plugging in Z = n(−bp − a)/c, we have
                                                                         
              1                          i                   i     −bp − a
       D = − (n − 1)a + n(−bp − a) − cz + b(n − 1) α1 + 2α3 z + α5            .
              2                                                       c

   Recall from the previous section that, after plugging in equilibrium transfers,
                                          −γ
                                 α3 =
                                           − 2c
                                      r + λ
                                              c2
                                                                
                                        1
                                 α5 =            − 2α3 c + 2λα3
                                      r−c b
                                        1         ac 
                                 α1 =        rv +       .
                                      r−c           b


   Then, matching coefficients in the expression for D, we have
                        1
                   c = − [−c + 2b(n − 1)α3 ]
                        2                                          
                        1                     1                     b
                   b = − −nb + b(n − 1)            2α3 b − c − λ2α3
                        2                    r−c                    c
                                                                      
                        1                 1                 −a
                   a = − −a + b(n − 1)          rv + 2λα3 ( ) + 2α3 a .
                        2               r−c                  c




                                                 84
This implies that

                                 c = −2b(n − 1)α3
                                                                           
                                                                   b
                    (r − c)(n − 2) = 2α3 b(n − 1) − c(n − 1) − λ2α3 (n − 1)
                                                                   c
                          r(n − 2) = −2c + λ
                                     λ − r(n − 2)
                                 c=
                                          2
                                       −γ
                               α3 =
                                     r(n − 1)
                                     rλ − r2 (n − 2)
                                 b=                  .
                                           4γ
   From this, we see that b is strictly negative, satisfying the second-order condition, if and
only if λ < r(n − 2).
   Next, we have
                        1                                a               
                 a=          −b(n − 1)rv + 2λα3 b(n − 1) − 2α3 ab(n − 1)
                      r−c                                 c
                        1
                   =       (−b(n − 1)rv + −λa + ca)
                      r−c 
                                rλ − r2 (n − 2)
                                                                            
                         2                                    −λ − r(n − 2)
                   =          −                 (n − 1)rv + a                 .
                      rn − λ          4γ                            2


Noting that
                                 λ + r(n − 2)     2r(n − 1)
                                              +1=           ,
                                    rn − λ         rn − λ
we see that
                                           (rλ − r2 (n − 2)) v
                                    a=−                        .
                                                  4γ
From this, we see that a = −vb and c = 2γb/r, so

                                           a + cZ̄t      2γ
                                    φt =            = v − Z̄t
                                             −b           r
and
                                          1        ac 
                                    α1 =      rv +
                                         r−c         b
                                          1
                                       =     (rv − vc) = v.
                                         r−c




                                                85
   Likewise,
                                      2                  
                                   1   c
                    α5 + 2α3 =            − 2α3 c + 2λα3 + 2α3
                                  r−c b
                                                                        
                                   1   2γ
                              =           c + 2α3 (r − c) − 2α3 c + 2λα3
                                  r−c r
                                                             
                                   1   2γ
                              =           c + 2α3 (r + λ − 2c)
                                  r−c r
                                               
                                   1   2γ             −2γ
                              =           c − 2γ =         .
                                  r−c r                 r


It follows that
                                    −2γ         −2γ      2γ
                             α5 =       − 2α3 =     +          .
                                     r           r    r(n − 1)
   Plugging α1 , α5 , and α3 into the equilibrium κ2 (Z), we see that

                                              α1 + (α5 + 2α3 )Z̄
                               κ2 (Z) = −Z̄ −
                                                     2κ0 n2
                                              v − 2γ
                                                   r
                                                     Z̄
                               κ2 (Z) = −Z̄ −        2
                                                        .
                                               2κ0 n


   Likewise,
                                                                2γ
                            κ1 (Z) = α1 + (α5 + 2α3 )Z̄ = v −      Z̄.
                                                                 r
   Recalling that R1 = −α1 /n and α1 = v, we have
                                                          
                                 1 ca
                            α2 =        + (λ − c)α1 + λnR1
                                 r −b
                                 1
                               = (cv + (λ − c)v − λα1 ) = 0.
                                 r


   Recalling that
                                             α5 + 2α3  2γ
                                    R2 = −        2
                                                      = 2,
                                                n      rn




                                                86
we have
                                1 c2
                                                                   
                                                                 2
                        α4 =            + (λ − c)α5 + λα3 + λn R2
                                r −b
                                                                          
                                1 −2γ
                            =            c + (λ − c)α5 + λα3 − λ(α5 + 2α3 )
                                r     r
                                                                      
                                1 −2γ
                            =            c − c(α5 + 2α3 ) + (2c − λ)α3
                                r     r
                                1
                            =     ((2c − λ − r)α3 + rα3 )
                                r               
                                1           γ        γ(n − 2)
                            =       γ−             =           .
                                r        (n − 1)     r(n − 1)


   Finally, since R0 = 0, we have

                                  σZ2    ρi
                                                
                i   1      2
               α0 =    α3 σi + α4 2 + α5 + λR0
                    r             n      n
                                    2
                                         ρi
                                           
                    1      2      σZ
                  =    α3 σi + α4 2 + α5
                    r             n      n
                                      γ(n − 2)  σZ2                           ρi
                                                                                      
                    1     −γ                                    −2γ      2γ
                  =             σi2 +                +              +                      ,
                    r r(n − 1)        r(n − 1) n2                r    r(n − 1) n

   which simplifies to the expression in Proposition 6.

D.3       Completing the verification
We have shown that in a symmetric equilibrium, the traders’ value functions are linear-quadratic
and in particular must be twice continuously differentiable. The HJB equation of the previous
subsection is thus a necessary condition, and there is a unique candidate linear-quadratic equi-
librium that satisfies this equation. We have shown that if each trader follows the suggested
affine strategy, they indeed get their candidate value function as a continuation value. It re-
mains to show that each trader prefers this to any other strategy. The verification argument
is completely analogous to that associated with the main model, given in Appendix B.4, so
simply sketched here for brevity.
      Fix the a, b, c, κ0 , κ1 ( · ), κ2 ( · ) of the previous subsection, and the corresponding constants
α0i , α1 − α5 for some trader i. We fix some admissible demand process D, and size-discovery
reports µ, by which the inventory of trader i at time t, including the jumps associated with
size-discovery sessions, is
                                                Z t              Z t
                              (D,µ)
                            ẑt            i
                                      = z0 +          i       i
                                                    Ds ds + Ht +     Y i ((µ̂s , zs−i )) dNs ,        (95)
                                        0                  0

where µ̂ is the optional projection of the report process.


                                                   87
    We define

                                          Ut = 1t<T V (ẑtD,µ , Zt ) + 1t≥T vẑtD,µ .

Following the steps of the derivation of the value function, we can show that under the laws of
motion implied by D and µ,
                                                  Z T        
                                 E(UT − U0 ) = E        ζ̂s ds ,
                                                                     0

where
                                               σZ2                ρi
    ζ̂s = Ds (α1 + α5 Z̄s +    2α3 ẑsD,µ )
                                        + α4 2 + α3 σi + α52
                                               n                  n
           + λY i ((µ̂s , zs−i ))(α1 + α5 Z̄s + 2α3 ẑsD,µ + α3 Y i ((µ̂s , zs−i ))) + r(vẑsD,µ − V (ẑsD,µ , Zs )).


    Since α0 through α5 satisfy the HJB equation,
                    Z T                                             Z                      T                                  
    E[UT − U0 ] ≤ E                               D,µ       D,µ 2
                         Ds Φ(a,b,c) (Ds ; Zs − ẑs ) + γ(ẑs ) ds −                            Tκi ((µ̂s , zs−i ), Zs ) dNs       .
                           0                                                            0

    Rearranging,
                                                                                                                                      
                               Z    T                                                             X
V (z0i , Z0 ) ≥ E πẑTD,µ −            Ds Φ(a,b,c) (Ds ; Zs − ẑsD,µ ) + γ(ẑsD,µ )2 ds +                   Tκi ((µk , zτ−i
                                                                                                                          k
                                                                                                                             ), Zτk ) .
                                0                                                               {k:τk <T }


Because this relationship holds with equality for the conjectured affine strategy and truthful
size-discovery reporting, this candidate equilibrium strategy is optimal.


E       Numerical illustration
Figure 1 illustrates the implications of augmenting the exchange market with size discovery.
The figure shows simulated excess-inventory sample paths of two of the n = 10 traders, with and
without size discovery. The graphs of the asset positions shown in heavy line weights correspond
to the market with size discovery. Those paths shown in light line weights correspond to the
market with no size-discovery sessions (that is, with λ = 0). In the market augmented with size
discovery, the first such session is held at about time t = 10, and causes a dramatic reduction
in excess-inventory imbalances, bringing the excess inventories of all traders to the perfectly
efficient level, the cross-sectional average excess inventory Z(τ1 ) = −0.05. However, because
traders shade their exchange bids more with the prospect of upcoming size-discovery sessions,
from roughly time 110 until time 680, the market without size discovery performed dramatically
better, ex post, than the market with size discovery.




                                                              88
                       5
                                                                                                                           efficient inventory
                                                                                                                           auction with mechanism for agent 1
                       4                                                                                                   auction with mechanism for agent 2
                                                                                                                           only double auctions for agent 1
                                                                                                                           only double auctions for agent 2
                       3                                                                                                   mechanism occurences


                       2


                       1


                       0




           inventory
                       -1


                       -2




89
                       -3


                       -4


                       -5
                            0   100       200          300           400          500          600           700          800               900                 1000
                                                                               time period



     Figure 1: Inventory sample paths with and without price-based size discovery. This figure plots the excess-inventory sample paths of
     two of the n = 10 traders, with and without size-discovery mechanisms, based on the equilibrium characterized by Proposition 1. For each trader,
     the excess-inventory shock process is an independent Brownian motion with standard-deviation parameter σi = 0.05. The aggregate excess-inventory
     is an independent Brownian motion with standard-deviation parameter σZ = 0.15. The other parameters are mean asset payoff v = 0.5, mean rate
     of arrival of asset payoff r = 0.1, inventory-cost coefficient γ = 0.1, initial aggregate market excess inventory Z0 = −0.5, an initial excess inventory
     of trader 1 of z01 = −2.5, and an initial excess inventory of trader 2 of z02 = 2.5. For the sample path corresponding to an equilibrium without
     size-discovery mechanisms, we take λ = 0. For the other sample path, we assume a mean frequency λ = 0.1167 = 0.99λ̄ of size-discovery sessions.
     The graphs of the asset positions are shown in heavy line weights for the market with efficient size-discovery mechanisms, and in light line weights
     for the market with no size-discovery sessions.
F     Discrete-time results
In this appendix, we analyze discrete-time versions of the model. The focus is the existence
of a subgame perfect equilibrium in each complete-information game, which corresponds to
a Perfect Bayes equilibrium of each incomplete-information game. We also show convergence
results for the main model of Section 3 and for the model found in Appendix D. All these results
are presented informally, with focus on the calculation of the equilibrium, but these arguments
can all be made fully rigorous.
    The primitive setting, other than mechanisms, is identical to Duffie and Zhu (2017). Specif-
ically, n > 2 traders trade in each period k ∈ {0, 1, 2, ...}, where trading periods are separated
by clock time ∆ so that the k-th auction occurs at time k∆.
    In each period k, each trader i submits an auction order xik (pk ) for how many units of asset
they wish to purchase if the auction price is pk . We focus on affine equilibria in which each
trader chooses
                                     xik (pk ) = a + bpk + czik ,
where zik is the excess inventory of trader i when entering period k, for some constants a, c
and b 6= 0. If n − 1 traders use such a strategy with the same constants a, b, c, then there is a
unique market-clearing price Φ(a,b,c) (D, Z − z) for any demand D submitted by trader i, which
is given by
                                              (n − 1)a + c(Zk − zik ) + D
                        Φ(a,b,c) (D, Z − z) =                             .
                                                       −b(n − 1)
   Each trader also submits a contingent mechanism report ẑik (pk ). With probability q, a
mechanism occurs, and in that event trader i receives a net reallocation
                                           Pn
                                    i         j=1 ẑjk
                                  Y (ẑ) =             − ẑik
                                               n
and a cash transfer that will be described shortly, and that might depend upon pk . With
probability 1 − q, a double auction occurs, and each trader receives xik (pk ) units of the asset
                                                                  +
at a cost pk xik (pk ). If trader i ends period k with inventory zik , then in between periods k and
k + 1, they receive flow expected utility
                              γ
                             − (1 − e−r∆ )(zik
                                            + 2
                                               ) + v(1 − e−r∆ )(zik
                                                                 +
                                                                    ),
                              r
which can be motivated as in Duffie and Zhu (2017). Let 1M k equal 1 if and only if a mechanism
occurs in period k, and let 1cM k = 1 − 1M k . Then, in any equilibrium in which mechanisms
implement efficient allocations, the equilibrium inventory evolves as

                       zi,k+1 = wi,k+1 + 1M k Z̄k + 1cM k (1 + c)zi,k − cZ̄k ,
                                                                            


where {wi,k+1 } is a sequence of i.i.d zero-mean finite-variance random variables.




                                                90
F.1     Observable Zt
Suppose the aggregate inventory Zk is observable, and that transfers are given by
                                        n
                                               !2
             i
                                       X                                      κ1 (Zk )2
           Tκ (ẑ, Z) = κ0 nκ2 (Zk ) +     ẑjk + κ1 (Zk )(ẑik + κ2 (Zk )) +           .
                                       j=1
                                                                               4κ0 n2

  Just as in the continuous-time proof, at the equilibrium reports for affine κ1 ( · ), κ2 ( · ), this
must take the form
                          R0 + R1 Zk + R2 Zk2 + R3 Zk zik + R4 zik .
   We solve for a subgame perfect equilibrium in which trader i submits the demand

                                     xik (pk ) = a + bpk + czik ,

and the report
                                            ẑik (pk ) = zik .
In such an equilibrium, the continuation value V (z, Z) must be linear quadratic. Specifically,
the continuation value is
                                              "∞            #
                                               X
                                 V (z, Z) = E      e−r∆k π̃k ,
                                                     k=0

where
                                                      γ       −r∆                   −r∆
                                                                                                 
  π̃k = q R0 + R1 Zk +   R2 Zk2+ R3 Zk zik + R4 zik − (1 − e              2
                                                                   )(Z̄k ) + v(1 − e      )(Z̄k )
                                                       r
                                   γ                                                              
          + (1 − q) −xik (pk )pk − (1 − e−r∆ )(xik (pk ) + zik )2 + v(1 − e−r∆ )(xik (pk ) + zik ) .
                                    r
    We are given that zi0 = z, Z0 = Z, ni=1 xik (pk ) = 0, and
                                        P

                                            Pn               !
                                              j=1 ẑjk
              zi,k+1 = wi,k+1 + 1M k zik +             − ẑik + 1cM k (zik + xik (pk )) .
                                                n

   Fix the conjectured equilibrium a, b, c with truth-telling (ẑik = zik ), so that

                     zi,k+1 = wi,k+1 + 1M k Z̄k + 1cM k (1 + c)zi,k − cZ̄k .
                                                                           
                                                                                                 (96)

   The expression for V (z, Z) can be decomposed into a linear combination of discounted sums




                                                   91
of moments of zik , Zk . We calculate these now. Straightforward calculation shows that
                        "∞           #
                         X                   Z0
                     E       e−r∆k Zk =            = S0 Z0
                         k=0
                                         1 − e−r∆
                        "∞           #
                         X
                              −r∆k 2        Z02       σZ2 e−r∆
                     E       e    Zk =         −r∆
                                                   +        −r∆
                                                                = S0 Z02 + S1 ,
                         k=0
                                         1−e         1−e


where σZ2 ≡ var( ni=1 wi,k+1 ). Subtracting Z̄i,k+1 from both sides of equation (96), rearranging,
                P
and taking an expectation gives

                          E[zi,k+1 − Z̄k+1 ] = (1 − q)(1 + c)E[zi,k − Z̄k ].

   Some calculations then show that
         "∞            #
          X                      zi0 − Z̄0           Z̄0
       E      e−r∆k zik =      −r∆
                                                 +         = S2 (zi0 − Z̄0 ) + S0 Z̄0 ,
          k=0
                           1−e     (1 + c)(1 − q) 1 − e−r∆


provided that |e−r∆ (1 + c)(1 − q)| < 1. Subtracting Z̄i,k+1 from both sides of equation (96),
then multiplying both sides by Z̄i,k+1 , and taking an expectation gives
                                         i
                                               σZ2
                                                   
                                2         ρ
              E[zi,k+1 Zk+1 − Z̄k+1 ] =     − 2 + (1 − q)(1 + c)E[zi,k Z̄k − Z̄k2 ],
                                          n    n

where ρi = E[wi,k+1 ( ni=1 wi,k+1 )].
                       P
    Then we see that
    "∞                #    "∞                         #
     X                      X                                   S1
         e−r∆k zik Z̄k = E      e−r∆k zik Z̄k − Z̄k2 + S0 Z̄02 + 2
                                                    
  E
     k=0                    k=0
                                                                n
                                                      ∞
                                                −r∆
                                                      X                                                S1
                      = zi0 Z̄0 −   Z̄02   +e               e−r∆(k−1) E[zik Z̄k − Z̄k2 ] + S0 Z̄02 +
                                                      k=1
                                                                                                       n2
                                                    S1
                      = zi0 Z̄0 − Z̄02 + S0 Z̄02 + 2
                                       "∞           n
                                                     i       2
                                                                                                 #
                                        X               ρ   σ
                          + e−r∆ E          e−r∆k ( − Z2 ) + (1 − q)(1 + c)E[zi,k Z̄k − Z̄k2 ]
                                        k=0
                                                        n   n
                                                  i    σ2
                                         e−r∆ ( ρn − nZ2 )
                                                                                                   
                                     2                             −r∆                        2  S1
                      = zi0 Z̄0 − Z̄0 +                    + (1 − e      (1 − q)(1 + c)) S0 Z̄0 + 2
                                             1 − e−r∆                                            n
                                                       "∞                #
                                                         X
                          + (1 − q)(1 + c)e−r∆ E            e−r∆k zik Z̄k .
                                                                 k=0




                                                            92
   Rearranging delivers
                                                                                                               i       σ2
                              "   ∞
                                                      #                                                e−r∆ ( ρ − Z )
                                  X                                   S1 zi0 Z̄0 −              Z̄02+ 1−en−r∆n2
                          E             e−r∆k zik Z̄k = S0 Z̄02 +        +
                                  k=0
                                                                      n2   1 − (1 −                q)(1 + c)e−r∆
                                                          = S2 zi0 Z̄0 + (S0 − S2 )Z̄02 + S3 .

   Finally, squaring both sides of equation (96) and taking an expectation shows that
                                  2
                                           ρi
                                                    
            h             2 i     σZ             2                   2
                                                                          h            2 i
         E zi,k+1 − Z̄k+1      =      −  2    + σ i   + (1 − q)(1 + c)  E   zi,k − Z̄k      ,
                                   n2      n

where σi2 = E[wi,k+1
               2
                     ].
  Then,
                                                                                2
                                                                               σZ        i
             ∞
                                                                 2        (        −2 ρn +σi2 )e−r∆
                                                                               n2
             X                     2   zi,0 − Z̄0 +                                 1−e−r∆
                                                                                                                                 2
                 e−r∆ E[ zi,k − Z̄k ] =                                                                = S4 zi,0 − Z̄0                + S5 ,
             k=0
                                           1 − e−r∆ (1 −                           q)(1 + c)2

provided that |S4−1 | = |1 − e−r∆ (1 − q)(1 + c)2 | < 1. It follows that
   ∞                                                                                                                                           
   X
             −r∆      2
                                                 2                                                                                        S1
                                                                                                 S2 )Z̄02                       S0 Z̄02
                                                                                                                   
         e         E[zi,k ]   = S4 zi,0 − Z̄0         + S5 + 2 S2 zi0 Z̄0 + (S0 −                           + S3 −                        + 2       .
   k=0
                                                                                                                                           n

   In summary, letting
                                                          1
                                                 S0 =
                                                     1 − e−r∆
                                                      σ 2 e−r∆
                                                 S1 = Z −r∆
                                                     1−e
                                                                      1
                                                 S2 =
                                                           1 − e−r∆ (1 − q)(1 + c)
                                                                       i            σ2
                                                         e−r∆ ( ρn − nZ2 )
                                                 S3 = S2
                                                           1 − e−r∆
                                                                    1
                                                 S4 =      −r∆
                                                      1−e        (1 − q)(1 + c)2
                                                                σ2             i
                                                        ( Z2 − 2 ρn + σi2 )e−r∆
                                                 S5 = S4 n
                                                              1 − e−r∆




                                                                      93
and assuming |S2−1 |, |S4−1 | are strictly less than 1, we have
     "∞           #
      X
          −r∆k
   E     e     zik = S2 (zi0 − Z̄0 ) + S0 Z̄0
          k=0
    "   ∞
                              #
        X
            −r∆k
E             e      zik Z̄k = S2 zi0 Z̄0 + (S0 − S2 )Z̄02 + S3
        k=0
         "∞                   #
          X
    E             e−r∆k Z̄k = S0 Z̄0
         " k=0
            ∞
                              #
          X                                  S1
    E             e−r∆k Z̄k2 = S0 Z̄02 +
                                             n2
         "k=0
           ∞
                              #                                                                                                  
          X                                         2                                                                       S1
                  e−r∆ zi,k
                        2
                                                                                          S2 )Z̄02                S0 Z̄02
                                                                                                        
    E                             = S4 zi,0 − Z̄0        + S5 + 2 S2 zi0 Z̄0 + (S0 −                 + S3 −                 + 2       .
           k=0
                                                                                                                             n

    Suppose that
                                   V (z, Z) = α0i + α1 z + α2 Z̄ + α3 z 2 + α4 Z̄ 2 + α5 z Z̄.
Then the utility for inventory (z, Z) immediately after an auction or mechanism is
                                                         "                                  #
                  γ                                                            X
   V + (z, Z) = − (1 − e−r∆ )(z)2 + v(1 − e−r∆ )z + E e−r∆ V (z + wi,k+1 , Z +     wi,k+1 )
                  r                                                            i
                  γ       −r∆      2           −r∆
              = − (1 − e       )(z) + v(1 − e      )z
                  r
                                             σZ2      ρi
                                                                                           
                      −r∆    i        2                                 2        2
                  +e       α0 + α3 σi + α4 2 + α5 + α1 z + α2 Z̄ + α3 z + α4 Z̄ + α5 z Z̄
                                             n        n
                                    γ            
              = u(Z) + e−r∆ α3 − (1 − e−r∆ ) (z − Z̄)2 + (v(1 − e−r∆ ) + e−r∆ α1 )z
                                     r
                     
                       −r∆           −r∆      γ            
                  + e      α5 + 2(e      α3 − (1 − e−r∆ )) z Z̄.
                                               r
   We have thus shown that the continuation value maximized in the mechanism takes the
form found in Appendix A, with

                                       β0 = (v(1 − e−r∆ ) + e−r∆ α1 )
                                                                    γ       
                                       β1 = e−r∆ α5 + 2 e−r∆ α3 − (1 − e−r∆ ) .
                                                                     r
   To meet the individual-rationality restriction, transfers in the mechanism thus must be run
with κ1 (Zk ) = β0 + β1 Z̄k . From Proposition 3 , in the equilibrium of the mechanism game that
we seek (with observable Z), each trader submits ẑik = zik as long as

                                                                      −(β0 + β1 Z̄k )
                                              κ2 (Zk ) = −Z̄k +                       ,
                                                                         2κ0 n2



                                                                 94
so that
                                              X             −(β0 + β1 Z̄k )
                                nκ2 (Zk ) +        ẑik =                   .
                                               i
                                                               2κ0 n
   Returning to the continuation value, in equilibrium      at each mechanism event, trader i
receives the cash transfer κ1 (Zk )(zik − Z̄) = β0 + β1 Z̄k (zik − Z̄). The equilibrium price must
be pk = −(a + cZ̄)/b and the equilibrium double-auction demand is xik = c(zik − Z̄k ). Thus,
plugging in, the candidate equilibrium continuation value is
                                                 "∞           #
                                                  X
                                    V (z, Z) = E     e−r∆k π̂k ,
                                                      k=0

where
                                              γ      −r∆        2            −r∆
                                                                                         
          π̂k = q (β0 + β1 Z̄k )(zik − Z̄k ) − (1 − e     )(Z̄k ) + v(1 − e       )(Z̄k )
                                              r                                               
                                              a + cZ̄k γ           −r∆                       2
                  + (1 − q) −c(zik − Z̄k )            − (1 − e         )((1 + c)zik − cZ̄k )
                                                 −b     r
                  + (1 − q) v(1 − e−r∆ )((1 + c)zik − cZ̄k ) .
                                                              



   Collecting terms,
                                                                   "∞               #
                                  h ca                      i     X
          V (z, Z) = qβ0 + (1 − q)      + v(1 − e−r∆ )(1 + c) E           e−r∆k zik
                                      b                              k=0
                                   2                            "X    ∞
                                                                                           #
                                     c     γ
                   + qβ1 + (1 − q)      + 2 (1 − e−r∆ )(1 + c)c E            e−r∆k zik Z̄k
                                      b    r                             k=0
                                                  "∞             #
                    γ                              X
                   − (1 − e−r∆ )(1 − q)(1 + c)2 E      e−r∆k zik
                                                              2
                                                                   + (Z).
                    r                              k=0

   Plugging in the definitions found above, it follows that
                      h ca                      i
α1 = S2 qβ0 + (1 − q)       + v(1 − e−r∆ )(1 + c)
                          b
       γ      −r∆
α3 = − (1 − e     )(1 − q)(1 + c)2 S4
       r               2                          
                         c      γ      −r∆                γ
α5 = S2 qβ1 + (1 − q)       + 2 (1 − e     )(1 + c)c − (1 − e−r∆ )(1 − q)(1 + c)2 (2(S2 − S4 )).
                          b     r                         r




                                                     95
   Recalling the expressions for β0 , S2 , the formula for α1 implies that

    β0 = v(1 − e−r∆ ) + e−r∆ α1
                   −r∆               e−r∆                          ca         −r∆
                                                                                            
        = v(1 − e        )+                           qβ0 + (1 − q)[ + v(1 − e     )(1 + c)] .
                            1 − e−r∆ (1 − q)(1 + c)                  b


So, conjecturing and later verifying that 1 − e−r∆ (1 − q)(1 + c) − qe−r∆ 6= 0, we have

                                      1 − e−r∆ (1 − q)(1 + c)
                                                                 
                          β0 =                                      τc ,
                                  1 − e−r∆ (1 − q)(1 + c) − qe−r∆

where
                                          e−r∆ (1 − q)      h ca                       i
               τc = v(1 − e−r∆ ) +                               + v(1 − e −r∆
                                                                               )(1 + c)  .
                                     1 − e−r∆ (1 − q)(1 + c) b

   A similar calculation shows that
                                         2                            
           −r∆            −r∆              c       γ      −r∆
    β1 = e     S2 qβ1 + e     S2 (1 − q)      + 2 (1 − e       )(1 + c)c
                                           b       r
               e−r∆ γ                                                       γ         
            −         (1 − e−r∆ )(1 − q)(1 + c)2 (2(S2 − S4 )) + 2 e−r∆ α3 −   1 − e−r∆ .
                  r                                                          r
and thus

                                            β1 = ζa (τd + τe ),

where
                 1 − e−r∆ (1 − q)(1 + c)
        ζa =
             1 − e−r∆ (1 − q)(1 + c) − qe−r∆
                              2                           
              −r∆             c      γ       −r∆
        τd = e    S2 (1 − q)      + 2 (1 − e      )(1 + c)c
                               b      r
               e−r∆ γ        −r∆                2
                                                                  
                                                                    −r∆     γ       −r∆
                                                                                         
        τe = −        (1 − e     )(1 − q)(1 + c) (2(S2 − S4 )) + 2 e    α3 − (1 − e     ) .
                 r                                                          r
  Putting this all together, the continuation value for trader i in a symmetric equilibrium,
immediately after an auction or mechanism is run, is
                     γ
  V + (z, Z) = u(Z) − (1 − e−r∆ )[(1 − q)(1 + c)2 S4 e−r∆ + 1](z − Z̄)2 + (β0 + β1 Z̄)(z − Z̄).
                     r
   Plugging in the definition of S4 , this simplifies slightly to

               +                − γr (1 − e−r∆ )
           V (z, Z) = u(Z) +     −r∆                2
                                                      (z − Z̄)2 + (β0 + β1 Z̄)(z − Z̄).
                             1−e      (1 − q)(1 + c)


                                                    96
     Trader i can choose any quantity x to purchase at the price
                                        1
                           Φ(x) =             ((n − 1)a + c(Z − z) + x) .
                                    −b(n − 1)

   With observable Z, the order size x is irrelevant to the payoff and continuation value in the
event of a mechanism. Thus a trader with pre-trade position z maximizes
                              1
                     −x             ((n − 1)a + c(Z − z) + x) + V + (z + x, Z)
                          −b(n − 1)

     Differentiating this expression with respect to x leaves
                                                      2γ
                          x                            r
                                                         (1 − e−r∆ )
             −Φ(x) +            + (β0 + β1 Z̄) −                          (z + x − Z̄),
                       b(n − 1)                  1 − e−r∆ (1 − q)(1 + c)2

which must be 0 with Φ = φ, Z̄ = (−a − bφ)/c, and x = a+bφ+cz. The second-order condition
is met if and only if b < 0. This also implies x = c(z − Z̄), so

                                                                    a + bφ
                              (z + x − Z̄) = (1 + c)z + (1 + c)            .
                                                                       c
     Plugging this in and gathering coefficients on φ, z, 1, we have
                                                 2γ
                             1     bβ1            r
                                                    (1 − e−r∆ )                b
                 0 = −1 +        −       −       −r∆                 2
                                                                       (1 + c)
                           n−1      c      1−e        (1 − q)(1 + c)           c
                                      2γ        −r∆
                         c             r
                                         (1 − e     )
                 0=           −      −r∆
                                                            (1 + c)
                     b(n − 1) 1 − e       (1 − q)(1 + c)2
                                                        2γ
                        a              a               r
                                                           (1 − e−r∆ )              a
                 0=           + β0 − β1 −               −r∆                2
                                                                             (1 + c) .
                     b(n − 1)           c        1−e        (1 − q)(1 + c)          c

    We seek a, b, c, β1 , β0 such that these three equations and the two equations defining β0 , β1
all hold. Let ω be the larger root of

                               e−r∆ ω 2 + (n − 1)(1 − e−r∆ )ω − 1 = 0,

so                                                p
                          −(n − 1)(1 − e−r∆ ) +(n − 1)2 (1 − e−r∆ )2 + 4e−r∆
                    ω=                                                       .
                                              2e−r∆
     Then, in Duffie and Zhu (2017), where q = 0, we can set
                           rv                      r
                     a=       (1 − ω),     b=−       (1 − ω),        c = −(1 − ω),
                           2γ                     2γ
and see that
                                                       1−e−r∆ ω 2
                             (1 + c)(1 − e−r∆ )     n−1         1
                                   −r∆        2
                                                =    −r∆   2
                                                             =     .
                             1−e       (1 + c)    1−e    ω     n−1


                                                  97
   It follows that the above system holds with β0 = v, β1 = −2γ/r. Now, let ω̂ be the larger
root of
                         e−r∆ (1 − q)ω̂ 2 + (n − 1)(1 − e−r∆ )ω̂ − 1 = 0,
so that                                         p
                       −(n − 1)(1 − e−r∆ ) +      (n − 1)2 (1 − e−r∆ )2 + 4(1 − q)e−r∆
               ω̂ =                                                                    .
                                                 2(1 − q)e−r∆
   This implies that, letting a, b, c be as before but replacing ω with ω̂,
                                                          1−e−r∆ (1−q)ω̂ 2
                          (1 + c)(1 − e−r∆ )            n−1              1
                            −r∆               2
                                                =     −r∆           2
                                                                      =     .
                        1−e     (1 − q)(1 + c)    1−e     (1 − q)ω̂     n−1

    It is straightforward to show that a, b, c defined with ω̂, and β0 = v, β1 = −2γ/r once again
solve the above system. We now must verify that they satisfy the definitions of β0 , β1 . Note
that under the conjectured values,
                 h ca                      i
                      + v(1 − e−r∆ )(1 + c) = v q + (1 − q)[−(1 + c) + 1 + (1 − e−r∆ )(1 + c)]
                                                                                              
  qβ0 + (1 − q)
                    b
                                             = v 1 − e−r∆ (1 + c)(1 − q) ,
                                                                         


from which it can be seen that β0 = v is consistent with the earlier system. We noted above
that
        γ
                 −r∆                2    −r∆  γ       −r∆
                                                                  − γr (1 − e−r∆ )
        − (1 − e     )(1 − q)(1 + c) S4 e    − (1 − e     ) =                          .
         r                                    r               1 − e−r∆ (1 − q)(1 + c)2

   Plugging this into the definition of β1 , we have

                                             β1 = ζa (τd + τf ),

where ζa and τd are defined above and

                   e−r∆ γ                                                   − γr (1 − e−r∆ )
          τf = −          (1 − e−r∆ )(1 − q)(1 + c)2 (2(S2 − S4 )) + 2                          .
                     r                                                 1 − e−r∆ (1 − q)(1 + c)2

   Rearranging, we see that

                   e−r∆ γ                                            − γr (1 − e−r∆ )
                          (1 − e−r∆ )(1 − q)(1 + c)2 (2S4 ) + 2
                     r                                          1 − e−r∆ (1 − q)(1 + c)2
                                                     γ
                                      = 2(1 − e−r∆ ) [e−r∆ (1 − q)(1 + c)2 S4 − S4 ],
                                                     r
where e−r∆ (1 − q)(1 + c)2 S4 − S4 = −1.
  Pulling together terms involving S2 and noting (1 + c)c − (1 + c)2 = −(1 + c), we have
                                   2                                       
                     −r∆              c    γ       −r∆                    −r∆ γ
          β1 = ζa e      S2 (1 − q)     − 2 (1 − e     )(1 + c) − 2(1 − e    ) .
                                      b    r                                  r


                                                     98
   Multiplying and dividing the last term by S2 , we arrive at

                                              c2
                                                                  
                              −r∆                    γ       −r∆ r∆
                    β1 = ζa e     S2 (1 − q) − 2 (1 − e         )e     .
                                              b      r


Applying the definition of S2 ,
                                                  2
                                                                           
                                     e−r∆ (1 − q) cb − 2 γr (1 − e−r∆ )er∆
                              β1 =                                             .
                                       1 − e−r∆ (1 − q)(1 + c) − qe−r∆

   Finally, we can plug in the conjectured a, b, c, so that c2 /b = (2γ/r)c, and rearrange to find

                             γ e−r∆ −(1 − q)c + (1 − e−r∆ )er∆
                                                                    
                                                                          γ
                     β1 = −2          −r∆                       −r∆
                                                                      = −2 .
                              r 1−e       (1 − q)(1 + c) − qe             r

   Thus the conjectured equilibrium is an equilibrium (filling in the implied α0i , α2 , α4 ). Finally,
note that
                                                    p
      1 − ω̂   (n − 1)(1 − e−r∆ ) + 2(1 − q)e−r∆ − (n − 1)2 (1 − e−r∆ )2 + 4(1 − q)e−r∆
             =                                                                                  .
        ∆                                    2(1 − q)e−r∆ ∆

   Suppose that q = λ∆, so this becomes
                                                 p
   1 − ω̂   (n − 1)(1 − e−r∆ ) + 2(1 − λ∆)e−r∆ − (n − 1)2 (1 − e−r∆ )2 + 4(1 − λ∆)e−r∆
          =                                                                            .
     ∆                                    2(1 − λ∆)e−r∆ ∆

   We multiply the denominator and numerator by er∆ and obtain
                                              p
      1 − ω̂   (n − 1)(er∆ − 1) + 2(1 − λ∆) − (n − 1)2 (1 − er∆ )2 + 4(1 − λ∆)er∆
             =                                                                    .
        ∆                                 2(1 − λ∆)∆

The derivative of this expression with respect to ∆ is

[2(1 − 2λ∆)]−1 (n − 1)(rer∆ ) − 2λ
                                    
                                         −.5                                                    
     (n − 1)2 (1 − er∆ )2 + 4(1 − λ∆)er∆      −2rer∆ (n − 1)2 (1 − er∆ ) + 4r(1 − λ∆)er∆ − 4λer∆
 −                                                                                                 .
                                              4(1 − 2λ∆)

The limit of this expression as ∆ → 0 is

                        1                      (4)−.5 (4r − 4λ)   (n − 2)r − λ
                          ((n − 1)r − 2λ) − .5                  =              .
                        2                              2               2
By l’Hôpital’s Rule,
                                         −(1 − ω̂)   −(n − 2)r + λ
                                     lim           =               ,
                                     ∆→0    ∆             2


                                                    99
which is the instantaneous demand in the continuous-time model. It is immediate that a, b
converge to their corresponding limits, and since the strategies converge as ∆ → 0, so too must
the continuation values, for properly defined shocks.

F.2     Unobservable Zt
Let the transfer function TQi be defined exactly as in the continuous-time model. As in the proof
for the continuous-time model, in an equilibrium with truth-telling and affine δ, cash transfers
take the form
                              R0 + R1 Zk + R2 Zk2 + R3 Zk zik + R4 zik .
   The value function is thus linear-quadratic, so, just as in the previous section, the equilibrium
value function immediately after an auction or mechanism V + (z, Z) is linear quadratic in (z, Z)
and thus can be rewritten

                           V + (z, Z) = υ0 + υ1 z + υ2 Z̄ + υ3 z 2 + υ4 Z̄ 2 + υ5 z Z̄,

for some constants υ0 , . . . , υ5 . Then, following the steps of Appendix B.3, maximizing

                                V + (z + Y i ((ẑ i , ẑ −i )), Z) + TQi ((ẑ i , ẑ −i ); p)

is equivalent to maximizing
                                                                                          2
                                             Z − zi n − 1 i              Z − zi n − 1 i
                                                                     
                   i   i
          E(p, Z, z , ẑ ) ≡ (υ1 + υ5 Z̄)           −          ẑ + υ3         −       ẑ
                                               n          n                n      n
                                            Z − zi n − 1 i
                                                               
                                        i
                               + 2υ3 z            −          ẑ + κ0 (−nβ(p) + Z − z i + ẑ i )2
                                              n          n
                                                       2
                                                     p
                               + p(ẑ i − β(p)) +          .
                                                   4κ0 n2

Following the same steps taken in the proof of Proposition 1, we can show that Ep = z − Z̄ when
evaluated at the equilibrium p and ẑ i = z i , for the β(p) = −â − b̂p, consistent with equilibrium.
Also, the equilibrium transfers must be

                                          (υ1 + (υ5 + 2υ3 )Z̄)(z i − Z̄),

so it is straightforward to show the formulas for β0 , β1 from the previous section apply here as
well, for possibly different coefficients (a, b, c).
    Returning now to the discrete-time first-order condition, the argument to be maximized
when trader i submits an order x and report ẑ i is in this case
                                                                       
                        1
       (1 − q) −x              ((n − 1)a + c(Z − z) + x) + V (z + x, Z) + qE(p, Z, z i , ẑ i ).
                                                              +
                    −b(n − 1)

Taking a derivative with respect to x, setting this derivative equal to 0, and using the result



                                                           100
that Ep = z − Z̄ at the equilibrium p, ẑ, we have
                                                   q
                                 (1 − q)τg −            (z − Z̄) = 0,
                                               b(n − 1)

where
                                                      2γ
                          x                            r
                                                         (1 − e−r∆ )
           τg = −p +            + (β0 + β1 Z̄) −                          (z + x − Z̄).
                       b(n − 1)                  1 − e−r∆ (1 − q)(1 + c)2
Plugging in x = a + bp + cz, Z̄ = (−a − bp)/c, and x = a + bp + cz, the second-order condition
is met if and only if b < 0. This also implies that x = c(z − Z̄), so

                                                                 a + bp
                             (z + x − Z̄) = (1 + c)z + (1 + c)          .
                                                                   c
   The above can thus be rewritten
                                                              
                                             q          a + bp
                             (1 − q)τh −             z+          = 0,
                                         b(n − 1)         c

where
                                               2γ
                                                  (1 − e−r∆ )
                                                                                                    
          a + bp + cz           −a − bp         r                                             a + bp
τh = −p +             + β0 + β1         −                                  (1 + c)z + (1 + c)          .
            b(n − 1)               c      1 − e−r∆ (1 − q)(1 + c)2                              c

   Gathering terms in p, z, 1, we have
                                                                               !
                                           2γ          −r∆
                        1     bβ1           r
                                              (1  −  e     )                 b         q
    0 = (1 − q) −1 +        −       −      −r∆                    2
                                                                    (1 + c)      −
                      n−1      c      1−e       (1 − q)(1 + c)               c     c(n − 1)
                                                               !
                                 2γ
                    c             r
                                    (1 − e−r∆ )                            q
    0 = (1 − q)          −      −r∆                  2
                                                       (1 + c) −
                b(n − 1) 1 − e       (1 − q)(1 + c)                   b(n − 1)
                                                                                   !
                                                 2γ         −r∆
                   a              a               r
                                                    (1 −  e     )                a         qa
    0 = (1 − q)          + (β0 − β1 ) −          −r∆                   2
                                                                         (1 + c)     −            .
                b(n − 1)          c       1−e        (1 − q)(1 + c)              c      bc(n − 1)

    We seek a, b, c, β1 , β0 such that these three equations and the two equations defining β0 , β1
all hold. Conjecture that for some ω̃ ∈ (0, 1), there is an equilibrium with
                         rv                       r
                    a=      (1 − ω̃),     b=−       (1 − ω̃),       c = −(1 − ω̃).
                         2γ                      2γ
Starting with the coefficients on z, this means we need
                                                                !
                                         2γ
                                2γ        r
                                            (1 − e−r∆ )                       2γq
              0 = (1 − q)            −                     ω̃       +                    .
                             r(n − 1) 1 − e−r∆ (1 − q)ω̃ 2              r(n − 1)(1 − ω̃)




                                                 101
    Multiplying through by r/(2γ), we have

                                          (1 − e−r∆ )ω̃
                                                           
                                 1                                    q
                0 = (1 − q)          −      −r∆           2
                                                              +                 .              (97)
                              (n − 1) 1 − e     (1 − q)ω̃       (n − 1)(1 − ω̃)

   Suppose there exists some ω̃ ∈ (0, 1) satisfying this equality. Straightforward calculation
then shows that plugging in β0 = v, β1 = −2γ/r, the coefficients on p, 1 above are all 0.
   Following the steps in the last section, in any equilibrium, we then have
                                                                    
                                  −r∆          c2     γ       −r∆ r∆
                                e       (1 − q) b − 2 r (1 − e   )e
                          β1 =                                         .
                                   1 − e−r∆ (1 − q)(1 + c) − qe−r∆

    Plugging in the conjectured a, b, c, we have

                            e−r∆ − 2γ  (1 − q)(1 − ω̃) − 2 γr (1 − e−r∆ )er∆
                                                                             
                                    r
                       β1 =                                                    .
                                      1 − e−r∆ (1 − q)ω̃ − qe−r∆

    For β1 = −2γ/r to be consistent, it must be that

              1 − e−r∆ (1 − q)ω̃ − qe−r∆ = e−r∆ (1 − q)(1 − ω̃) + (1 − e−r∆ )er∆ .
                                                                                


But this conditions holds for any ω̃. Likewise, conjecturing that β0 = v, at the conjectured
a, b, c, we have
                       h ca                      i
         qβ0 + (1 − q)      + v(1 − e−r∆ )(1 + c) = qv + (1 − q)[v(1 − ω̃) + v(1 − e−r∆ )ω̃]
                          b
                                                   = v 1 − (1 − q)ω̃e−r∆ .
                                                                        



Thus β0 = v is consistent with
                                    −r∆                ca          −r∆
                                                                                
                                   e    qβ0 + (1 − q)[    + v(1 − e    )(1 + c)]
               β0 = v(1 − e−r∆ ) +                      b
                                                                                  .
                                             1 − e−r∆ (1 − q)(1 + c)

   We have thus shown that, as long as ω̃ satisfies (97), the conjectured a, b, c satisfy the first-
order condition and comprise a subgame perfect equilibrium. In unreported numerical exercises,
we find that for sufficiently small ∆ there exists a root ω̃ such that −(1 − ω̃)/∆ is equal to the
order-flow coefficient c from Proposition 1, up to machine precision.


G      The impaired mechanism
In this section, we consider an alternate mechanism designed to reduce a fraction ξ of the
excess inventory at each implementation. For simplicity, we consider only the case of observable




                                                 102
aggregate inventory Zt . The size-discovery allocations and cash transfers are defined by
                                               Pn      j
                                                              !
                                                 j=1 µ
                                  Y i (µ) = ξ            − µi                                        (98)
                                                  n

and
                                               !2
          i
                                      X
                                           j                  i    (2ξ − ξ 2 )κ21 (Z)
        T (µ, Z) = κ0 nκ2 (Z) + ξ   µ     + κ1 (Z)(ξµ + κ2 (Z)) +
                                  j
                                                                        4n2 κ0
                                                                                   !2 
                       1−ξ  i                                  X         ξκ1 (Z) 
                 + nκ0      (ξµ + κ2 (Z))2 − (n − 1)κ2 (Z) + ξ       µj +                ,
                        ξ                                       j6=i
                                                                           2κ0 n

for a constant κ0 < 0 and affine κ1 ( · ) and κ2 ( · ). It is worth noting that the sum of these
transfers may not be weakly negative for any reports µ. However, we show that, in all the
equilibria that we consider, the transfers sum to zero with probability one.

G.1      Sketch of proof of equilibrium
We provide a sketch of a proof for an alternative version of Proposition 6: For any ξ ∈ (0, 1],
there exists a unique symmetric equilibrium such that, each time the mechanism is run, all
traders reduce a fraction ξ of their inventory imbalance z i − Z̄. The market-clearing price and
value functions are identical to those of Proposition 6, and the exchange demands are identical
after replacing λ with λ(2ξ − ξ 2 ). The mechanism reports are still truth-telling: µik = zτik .
Proof sketch: In any such equilibrium, each trader reports z i , so that

                                          Y i (µ) = ξ(Z̄ − z i )

and the transfers are
                                                                (2ξ − ξ 2 )κ21 (Z)
      T i (µ, Z) = κ0 (nκ2 (Z) + ξZ)2 + κ1 (Z)(ξz i + κ2 (Z)) +
                                                                    4n2 κ0
                                  "                                                          2 #
                            1−ξ                                                      ξκ 1 (Z)
                     + nκ0          (ξz i + κ2 (Z))2 − (n − 1)κ2 (Z) + ξ(Z − z i ) +
                              ξ                                                       2κ0 n
                                                                   (2ξ − ξ 2 )κ21 (Z)
               = κ0 (nκ2 (Z) + ξZ)2 + κ1 (Z)(ξz i + κ2 (Z)) +                         + τa τb ,
                                                                       4n2 κ0
where
                                                     
                          1−ξ                 ξκ1 (Z)
                 τa = nκ0      ξZ + nκ2 (Z) +
                            ξ                  2κ0 n
                                                                      
                          i                                i    ξκ1 (Z)
                 τb = ξz + κ2 (Z) − (n − 1)κ2 (Z) + ξ(Z − z ) +            .
                                                                 2κ0 n



                                                    103
   For any affine κ1 , κ2 , the transfer can be expressed as

                                   R0 + R1 Zt + R2 Zt2 + R3 Zt zti + R4 zti ,

for constants R0 , . . . , R4 . Receiving such transfers at independent Poisson arrival times must
lead to a linear-quadratic value function, as in the proofs the previous propositions. That is,
the equilibrium continuation value function V for trader i must be of the form

                        V (z i , Z) = α0i + α1 z i + α2 Z̄ + α3 (z i )2 + α4 Z̄ 2 + α5 z i Z̄.                 (99)

   Fixing the assumed equilibrium reports z j for other traders, trader i chooses µ to maximize

        (α1 + α5 Z̄)Y i ((µ, z −i )) + α3 Y i ((µ, z −i ))2 + 2α3 Y i ((µ, z −i ))z i + T i ((µ, z −i ), Z),

where, writing κ2 (Z) = â + b̂Z,

                                                                                        (2ξ − ξ 2 )κ21 (Z)
  T i ((µ, z −i ), Z) = κ0 (ξµ + nâ + nb̂Z + ξ(Z − z i ))2 + κ1 (Z)(ξµ + â + b̂Z) +
                                                                                             4n2 κ0
                                                                                                  !2 
                            1−ξ  i                                            X          ξκ1 (Z) 
                      + nκ0         (ξz + â + b̂Z)2 − (n − 1)(â + b̂Z) + ξ         zj +                .
                              ξ                                                 j6=i
                                                                                            2κ0n


   The first-order condition is
               n−1                            2(n − 1)α3 ξ i
           −       ξ(α1 + α5 Z̄ + 2α3 z i ) −             Y ((µ, z −i )) + ξκ1 (Z)
                n                                  n
                                                                1−ξ
                + 2κ0 ξ(ξµ + nâ + nb̂Z + ξ(Z − z i )) + 2nκ0 ξ        (ξz i + â + b̂Z) = 0.
                                                                  ξ

   Plugging in µ = z i and Y i ((µ, z −i )) = ξ(Z̄ − z i ), and then dividing through by ξ, we have

                        n−1                           2(n − 1)α3
                    −       (α1 + α5 Z̄ + 2α3 z i ) −            ξ(Z̄ − z i ) + κ1 (Z)
                         n                                n
                                                          1−ξ
                         + 2κ0 (nâ + nb̂Z + ξZ) + 2nκ0        (ξz i + â + b̂Z) = 0.
                                                            ξ

   It is clear that the terms involving z i cancel if and only if κ0 = (n − 1)α3 /n2 . Given this,




                                                        104
the unique â, b̂ solving this must satisfy

                         n−1                  2(n − 1)α3
                  0=−          (α1 + α5 Z̄) −             ξ(Z̄) + κ1 (Z)
                           n                       n
                           2(n − 1)α3                         2(n − 1)α3 1 − ξ
                         +        2
                                       (nâ + nb̂Z + ξZ)) +                    (â + b̂Z),
                                n                                  n       ξ
                                                                 
                           nξ                                n−1
            â + b̂Z =                −κ1 (Z) + (α1 + α5 Z̄)
                       2(n − 1)α2                              n
                                                           
                         ξ                           n−1
                     =        −κ1 (Z) + (α1 + α5 Z̄)          .
                       2nκ0                            n

   Manipulating the formula for transfers, we can write the equilibrium transfer to trader i,
given µi = z i for all i, as

                                                               (2ξ − ξ 2 )κ21 (Z)
                κ0 (nκ2 (Z) + ξZ)2 + κ1 (Z)(ξz i + κ2 (Z)) +                      + τa τb .
                                                                   4n2 κ0
   Defining κ1 ( · ) so that
                                                       ξκ1 (Z)
                                    ξZ + nκ2 (Z) +             = 0,
                                                        2κ0 n
this transfer simplifies to

                                                                   (2ξ − ξ 2 )κ21 (Z)
                   κ0 (nκ2 (Z) + ξZ)2 + κ1 (Z)(ξz i + κ2 (Z)) +                       .
                                                                       4n2 κ0
   The sum of the transfers across all traders is
                               2
                                                         (2ξ − ξ 2 )κ21 (Z)
                                                   
                       ξκ1 (Z)               ξκ1 (Z)
                nκ0               − κ1 (Z)             +                    = 0.
                        2κ0 n                 2κ0 n           4nκ0

   Some calculation shows that the above choice for κ1 ( · ) uniquely ensures that the transfers
sum to zero with probability 1, which must be the case for IR and budget balance to hold.
Plugging in the formula for κ2 ( · ), we see that we need the conditions
                                                                  
                                    ξ                          n−1       ξκ1 (Z)
                      0 = ξZ +          −κ1 (Z) + (α1 + α5 Z̄)        +
                                  2κ0                           n         2κ0 n
                                                                     
                      0 = 2κ0 nZ + −nκ1 (Z) + (α1 + α5 Z̄)(n − 1) + κ1 (Z)
                                           2κ0 n
                 κ1 (Z) = (α1 + α5 Z̄) +         Z
                                           n−1
                        = α1 + (α5 + 2α3 )Z̄.

   This is the unique choice for κ1 (Z) consistent with budget balance and ex-post IR.




                                                 105
    The HJB equation is

                                             σi2                σ2
            rV (z i , Z) = −γ(z i )2 + rvz +     Vzz (z i , Z) + Z VZZ (z i , Z) + ρi VzZ (z i , Z)
                                              2                  2
                            + sup {−Φ(a,b,c) (D; Z − z i )D + Vz (z i , Z)D
                              D,µ

                            + λ V (z i + Y i (µ, z −i ), Z) − V (z i , Z) + T i ((µ, z −i ), Z) }.
                                                                                               


    We just showed that because V is linear-quadratic, at the unique candidate equilibrium
reallocations we must have

    V (z + Y i (µ, z −i ), Z) − V (z, Z) = (α1 + α5 Z̄)ξ(Z̄ − z) + α3 ξ 2 (Z̄ − z)2 + 2α3 ξz(Z̄ − z).

    By the above, the equilibrium transfer is
                  2
                                                        (2ξ − ξ 2 )κ21 (Z)
                                                  
          ξκ1 (Z)                 i         ξκ1 (Z)
     κ0              + κ1 (Z) ξ(z − Z̄) −             +                    = κ1 (Z)ξ(z i − Z̄).
           2κ0 n                             2κ0 n          4n2 κ0

   Plugging in κ1 (Z) = α1 + (α5 + 2α3 )Z̄ and summing the transfer and the change in contin-
uation value gives

      (α1 + α5 Z̄)ξ(Z̄ − z) + α3 ξ 2 (Z̄ − z)2 + 2α3 ξz(Z̄ − z) − (α1 + α5 Z̄ + 2α3 Z̄)ξ(Z̄ − z)
                            = α3 ξ 2 (Z̄ − z)2 − 2α3 ξ z 2 + Z̄ 2 − 2z Z̄
                                                                          

                            = −α3 (2ξ − ξ 2 )(Z̄ − z)2 .

    Plugging this in, the reduced HJB equation is

             i             i 2        i σi2     i      σZ2
        rV (z , Z) = −γ(z ) + rvz + Vzz (z , Z) +            VZZ (z i , Z) + ρi VzZ (z i , Z)
                                         2               2
                                                                                              2
                   + sup {−Φ(a,b,c) (D; Z − z )D + Vz (z i , Z)D − λ(2ξ − ξ 2 )α3 z i − Z̄ }.
                                             i
                      D

This is exactly the HJB equation found in the proof of Proposition 6, after replacing λ with
λ∗ = λ(2ξ − ξ 2 ).


H      Only size discovery: observable Zt
In the main text of the paper, we showed that augmenting a price-discovery market with future
size-discovery sessions never increases welfare, and strictly reduces welfare if the size-discovery
platform operator relies on the price-discovery market for information about aggregate inven-
tory imbalances. It is then natural to ask whether simply getting rid of the price-discovery
market, and running only size-discovery sessions, could improve welfare, relative to a setting
with price discovery. When stand-alone size discovery is feasible and is run sufficiently fre-
quently, and the aggregate excess inventory Zt is observable, it strictly improves welfare, and
indeed is strictly preferred by each trader individually. From a practical viewpoint, however,
it could be difficult to arrange for the abandonment of price-discovery markets. Moreover,

                                                    106
the size-discovery sessions that we analyze might be difficult to implement in practice without
information coming out of the price-discovery market.
    In this appendix, we consider a pure size-discovery market, for an economy with observable
aggregate inventory. We exploit the same perfect-reallocation size-discovery sessions developed
earlier. As before, these sessions are run at the event times of an independent Poisson process
N with mean arrival rate λ > 0.
    Again, traders submit mechanism report processes µ = (µ1 , . . . , µn ). The resulting excess-
inventory process z i of trader i is then determined by
                                                         Pn     j
                                                           j=1 µk
                                                X
                             i     i    i
                            zt = z0 + Ht +                        − µik                     (100)
                                                            n
                                              {k:τk <min(T ,t)}


    There is no exchange market price to be observed, but the aggregate inventory Zt is assumed
to be common knowledge for all t. The size-discovery mechanism design (Y, Tκ ) uses the asset
reallocation determined by (25). We again apply the cash-transfer function Tκ defined by (26)
for some coefficient κ0 < 0, with
                                                             2γ
                                              κ1 (Zt ) = v − Z t                                (101)
                                                              r
and
                                                             κ1 (Zt )
                                           κ2 (Zt ) = −Z t −          .                         (102)
                                                              2κ0 n2
    By the same reasoning provided in Appendix A, one can show these are the unique affine
choices for κ1 (·) and κ2 (·) such that an equilibrium exists. Moreover, we must restrict at-
tention to affine κ1 ( · ), κ2 ( · ) in this dynamic setting in order to guarantee a linear-quadratic
continuation-value function.
    We seek a truth-telling equilibrium of the dynamic reporting game, in which each trader
optimally chooses to report µjk = z j (τk ) and in which mechanism participation is always in-
dividually rational. The exact stochastic control problem solved by each trader is an obvious
simplification of the control problem of Appendix D. The next proposition confirms that this
equilibrium exists and provides a calculation of the continuation value for each trader.

Proposition 7. For any κ0 < 0, consider the size-discovery session mechanism design (Y, Tκ )
of (25)-(26), with (101)-(102). The truth-telling equilibrium, that with reports µik = zτik , exists
and has the following properties.

  1. At each session time τk , each trader i achieves the efficient post-session position z i (τk ) =
     Z(τk ), almost surely.

  2. For each trader i, the equilibrium continuation value VMi (zti , Zt ) at time t is
                                               γ 2                          γ           2
                 VMi (zti , Zt ) = θ̃i + vZ t − Z t + κ1 (Zt ) zti − Z t −     zti − Z t ,
                                                                        
                                               r                           r+λ
      where
                                        γ σZ2             σZ2           ρi         2γ ρi
                                                                                        
                                1                γ                2
                          θ̃i =             2
                                              −               + σ i − 2          −             .
                                r       rn      r+λ       n2            n           r n

                                                   107
    As the mean frequency λ of reallocation sessions approaches infinity, the equilibrium welfare
approaches the first-best welfare Wf b (Z). This follows from the fact that the equilibrium total
expected holding costs associated with excess inventory, relative to the holding costs at first
best, approaches zero40 as λ → ∞. This is immediate from the fact that the quadratic coefficient
γ/(r + λ) of the indirect utility VMi approaches zero as λ → ∞. These properties hold for any
choice of κ0 < 0, but setting κ0 = −γ(n − 1)/(n2 (r + λ)) makes each trader indifferent to
instantaneous deviations by other traders.41

H.1      Proof of Proposition 7
The proof is extremely similar to that of Proposition 6, so we leave some details to the reader.
We write V (z, Z) rather than VMi (z, Z) for brevity. For any affine κ1 ( · ) and κ2 ( · ), the transfers
in equilibrium take the form

                                  R0 + R1 Zt + R2 Zt2 + R3 Zt zti + R4 zti ,

for some constants R0 through R4 . In any symmetric equilibrium, the value function
                                                                              
                                          Z T                X
                V (z0i , Z0 ) = E πzTi +     −γ(zsi )2 ds +   Tκi (µik , Zτk )
                                                 0                  {k:τk <T }


takes the form
                          V (z, Z) = α0i + α1 z + α2 Z̄ + α3 z 2 + α4 Z̄ 2 + α5 z Z̄,
where
                                          −γ
                                α3 =
                                        r+λ
                                           1
                                α5 =           (λnR3 )
                                        r+λ
                                        1
                                α4 =      (λα5 + λα3 + λn2 R2 )
                                        r
                                           1
                                α1 =           (rv + λR4 )
                                        r+λ
                                        1
                                α2 =      (λα1 + λnR1 )
                                        r
                                                       σZ2    ρi
                                                                    
                                        1
                                α0i =            2
                                             α3 σi + α4 2 + α5 + λR0 ,
                                        r              n       n
  40
     This convergence is also intuitively obvious from the fact that δti ≡ (zti − Z t )2 jumps to zero at each of
the event times of N . The duration of time between these successive perfect reallocations has expectation 1/λ,
which goes to zero. Between these perfect reallocations, δti has a mean that is continuous in t and grows in
expectation at a bounded rate.
  41
     Formally, if we consider the static mechanism report game with the continuation value corresponding to
Proposition 7, for this κ0 truth-telling is a dominant strategy.




                                                      108
and where R0 through R4 are the previously defined transfer coefficients. To see this, note that
given the α coefficients, we have

                                                                         σ2                ρi
(r + λ) α0i + α1 z + α2 Z̄ + α3 z 2 + α4 Z̄ 2 + α5 z Z̄ = rvz − γz 2 + α4 Z2 + α3 σi2 + α5
                                                       
                                                                         n                 n
                   i                          2        2      2                     2
            + λ(α0 + α1 Z̄ + α2 Z̄ + α3 Z̄ + α4 Z̄ + α5 Z̄ + R0 + R1 Z + R2 Z + R3 Zz + R4 z).

    Let Yt = 1{T ≤t} and V (z, Z) be defined as above, and let Ut = (1 − Yt )V (zti , Zt ) + Yt vzti .
Following the steps of the proof of Proposition 6, letting

             σZ2        2       ρi
   χs = α4       + α  σ
                     3 i  + α 5    − λ(zsi − Z̄s )(α1 + α5 Z̄s− + α3 (zsi + Z̄s )) + r(vzsi − V (zsi , Zs )),
             n2                 n
we can show that
                                                            Z    T          
                                      E(UT − U0 ) = E                 χs ds .
                                                              0

Because α0i through α5 satisfy the system of equations specified at the beginning of this proof,
we have                                          Z T       
                                 E(UT − U0 ) = E      χ̄s ds ,
                                                              0

where
                       χ̄s = γ(zsi )2 − λ(R0 + R1 Zs + R2 Zs2 + R3 Zs zsi + R4 zsi ).
   Using the definitions of U, T , and R0 through R4 , as well as the fact that E(vzTi ) = E(πzTi ),
we can rearrange to find that
                                       Z T        
                     i               i
                 V (z0 , Z0 ) = E πzT +      χ̄s ds
                                          0+
                                       Z T                               
                                     i              i 2    i
                              = E πzT +      −γ(zs ) + λTκ (µ̂s , Zs ) ds
                                          0+
                                       Z T               Z T                    
                                     i              i 2           i
                              = E πzT +      −γ(zs ) ds +      Tκ (µ̂s , Zs ) dNs ,
                                                0                        0




where µ̂ is the optional projection of the report process. This shows that the value function
V (z, Z) takes the form suggested above. The same arguments used in Appendix D now go
through (up to these different α coefficients), so it must be that

                                       κ1 (Z) = α1 + (α5 + 2α3 )Z̄.

and the equilibrium reports are optimal provided that

                                                             α1 + (α5 + 2α3 )Z̄
                             κ2 (Z) = â + b̂Z = −Z̄ −                          .
                                                                   2κ0 n2


                                                      109
                                                                           
     Once again the equilibrium transfers are (α1 + (α5 + 2α3 )Z̄) z i − Z̄ , so the coefficients Rm
in
                                R0 + R1 Zt + R2 Zt2 + R3 Zt zti + R4 zti ,
are given by

                                           R0 = 0
                                                   α1
                                           R1 = −
                                                    n
                                                   α5 + 2α3
                                           R2 = −
                                                       n2
                                                 α5 + 2α3
                                           R3 =
                                                      n
                                           R 4 = α1 .

     From the above, we have that
                                             −γ
                                    α3 =
                                           r+λ
                                              1
                                    α5 =         (λnR3 )
                                           r+λ
                                           1
                                    α4 =     (λα5 + λα3 + λn2 R2 )
                                           r
                                              1
                                    α1 =         (rv + λR4 )
                                           r+λ
                                           1
                                    α2 =     (λα1 + λnR1 ).
                                           r


     So, plugging in R1 , R2 , R3 , R4 , and rearranging, we have
                                  −γ
                         α3 =
                                r+λ                 
                                1           2λ    −γ
                         α5 =     (2λα3 ) =
                                r            r r+λ
                                                                    
                                1                              λ   γ
                         α4 =     (λα5 + λα3 − λ(α5 + 2α3 )) =
                                r                              r r+λ
                                1
                         α1 =     (rv) = v
                                r
                                1
                         α2 =     (λα1 − λα1 ) = 0.
                                r


     With these choices for α1 through α5 , and with

                                                    σZ2    ρi
                                                             
                                  i  1        2
                                α0 =     α3 σi + α4 2 + α5      ,
                                     r              n      n

                                                   110
we can define the value function

                        V (z i , Z) = α0i + α1 z i + α2 Z̄ + α3 (z i )2 + α4 Z̄ 2 + α5 z i Z̄.

This value function solves the associated HJB equation

                                                 σi2                σ2
         0 = −γ(z i )2 + r(vz i − V (z i , Z)) +     Vzz (z i , Z) + Z VZZ (z i , Z) + ρi VzZ (z i , Z)
                                                  2                  2
                + sup {λ V (z i + Y i ((µ, z −i )), Z) − V (z i , Z) + Tκi ((µ, z −i ), Z) }.
                                                                                          
                    µ


    Plugging in α1 , α3 , α5 , we have
                                                                   2γ
                                                    κ1 (Z) = v −      Z̄
                                                                    r
and
                                                     v − 2γ
                                                          r
                                                            Z̄
                                              κ2 (Z) = −Z̄ −2
                                                               .
                                                      2κ0 n
    The last part of the verification, demonstrating that alternative strategies do weakly worse,
is exactly the same as in the verification proof of Appendix D, and thus omitted. Rearranging
the coefficients α0i through α5 above gives the proposed expression for V , completing the proof.


I     Only size discovery: unobservable Zt
This appendix demonstrates that a version of our mechanism can achieve the first-best alloca-
tion in our dynamic setting, even when Zt is unobserved, if the mechanism is run continuously
and there is no exchange market. However, as we will show, it is not individually rational for
participants to enter this mechanism. We only provide a sketch of this proof, since the technical
details are similar to the proofs in the previous appendices.
    A size-discovery reporting process in this setting is a finite-variance progressively measurable
process ẑ. If the traders’ respective reporting processes are ẑ = (ẑ 1 , . . . , ẑ n ), then the excess
inventory of trader i is
                                      zti = z0i + Y i (ẑt ) + Hti ,                                  (103)
where                                                      Pn     j
                                                i           j=1 ẑt
                                              Y (ẑt ) =− ẑti .                              (104)
                                                n
   We assume that trader i is continuously compensated, where the flow payment is deter-
mined by some measurable transfer function T̃κi : Rn → R that is bounded by a second-order
polynomial. Thus, each trader i takes the reporting strategies ẑt−i of the other traders as given,
and chooses a report process z̃ to solve
                                            Z T                                
                     i i                 z̃         i           −i        z̃ 2
                   V (z0 , Z) = sup E zT π +      T̃κ ((z̃t , ẑt )) − γ(zt ) dt              (105)
                                         z̃                 0




                                                           111
subject to
                                                      ztz̃ = z0i + Y i ((z̃t , ẑt−i )) + Hti .                (106)
   We now simplify the problem. By conditioning on everything except π and applying the
tower property, by independence we may rewrite the objective as
                                     Z T                               
                                z̃          i           −i        z̃ 2
                         sup E zT v +     T̃κ ((z̃t , ẑt )) − γ(zt ) dt .
                                                 z̃             0

   By conditioning on everything except T and applying the tower property, by independence
we may rewrite this as
                  Z ∞               Z ∞        Z u                                  
                           −ru z̃           −ru       i           −i        z̃ 2
            sup E      rve zu du +       re         T̃κ ((z̃t , ẑt )) − γ(zt ) dt du .
                     z̃             0                           0              0

   Applying a change of order of integration, this is
                  Z ∞                 Z ∞                                     Z ∞                 
                          −ru z̃                  i         −i             z̃ 2            −ru
          sup E        rve zu du +            T̃κ ((z̃t , ẑt )) − γ(zt )               re      du dt
            z̃      0                   0                                            t
                    Z ∞                  Z ∞                                                  
                             −ru z̃                   i           −i            z̃ 2     −rt
                                                                                             
          = sup E        rve zu du +                T̃κ ((z̃t , ẑt )) − γ(zt )        e       dt
               z̃     0                     0
                    Z ∞                                                  
                          −rt       z̃    i          −i              z̃ 2
          = sup E        e      rvzt + T̃κ ((z̃t , ẑt )) − γ(zt ) dt .
                          z̃            0

   Define νt ≡ z0i + Hti , which does not depend on z̃t . Then plugging in (106) to this new
objective gives
            Z ∞                                                                                      
                   −rt            i          −i        i           −i              i          −i    2
     sup E       e       rv[νt + Y ((z̃t , ẑt ))] + T̃κ ((z̃t , ẑt )) − γ([νt + Y ((z̃t , ẑt ))]) dt .
       z̃            0

   By additivity, if z̃(ω, t) solves, at each (ω, t), the problem
                                                                                                          
          sup e−rt rv[νt + Y i ((z̃t , ẑt−i ))] + T̃κi ((z̃t , ẑt−i )) − γ([νt + Y i ((z̃t , ẑt−i ))])2     (107)
               z̃t

then the process z̃ solves the dynamic optimization problem. Now, we let
                                 i
                               Vstatic (z i , Z) = uistatic (Z) + (β0 + β1 Z̄)(z i − Z̄) − K(z i − Z̄)2
                                              β0 = rv
                                              β1 = −2γ
                                              K=γ
                                  uistatic (Z) = rv Z̄ − γ Z̄ 2 .

   Because multiplying by ert does not change the optimization, problem (107) is strategically
equivalent to
                              i
                       sup Vstatic (νt + Y i ((z̃, ẑt−i )), Zt ) + T̃κi ((z̃, ẑt−i )).
                                            z̃



                                                                       112
   Let

                                      κ0 ≡ −K(n − 1)/n2 = −γ(n − 1)/n2
                                  κ1 (Z) ≡ κ1

for any constant κ1 . Then it is immediate from Appendix A that if we define


                                             −κ1 (Z) + ( n−1
                                                          n
                                                             )(β0 + β1 Z̄)
                              κ2 (Z) = −Z̄ +
                                                        2κ0 n
                                               n−1
                                       −κ1 + ( n )rv
                                     =
                                            2κ0 n
                                        −nκ1 + (n − 1)rv
                                     =−                     = κ2
                                             2γ(n − 1)

and                                                                      !2
                                                          n
                                                          X                              κ21
                      T̃κi (ẑ)         i
                                  = κ1 ẑ + κ0   n κ2 +         ẑ   j
                                                                              + κ1 κ2 +        ,
                                                          j=1
                                                                                        4κ0 n2

then it is a strictly dominant strategy for each trader to report z̃t = νt = z0i + Hti . Further, just
as in the main text of the paper, the sum of the transfers in each instant is weakly negative:
                    n                  n                     n
                                                                     !2
                   X                  X                     X                    κ2
                       T̃κi (ẑ) = κ1     ẑ j + nκ0 n κ2 +      ẑ j + nκ1 κ2 + 1
                   i=1                j=1                   j=1
                                                                                4κ0 n
                                                                n
                                                                          !!2
                                     1                        X
                                 =          κ1 + 2κ0 n nκ2 +         ẑ j
                                   4κ0 n                       j=1




and in equilibrium, each trader has excess inventory

                             zti = z0i + Y i (ẑt ) + Hti
                                         Pn         j
                                     i       j=1 ẑt
                                 = z0 +                − ẑti + Hti
                                         Pn   n
                                                     j        j
                                     i       j=1 (z0 + Ht )
                                 = z0 +                         − (z0i + Hti ) + Hti
                                                    n
                                 = Z̄t

almost everywhere. We have thus shown that the continuously run mechanisms achieve the
first-best allocation while remaining budget balanced.
    We now show that participation in this mechanism is not individually rational. Note that




                                                      113
at the equilibrium strategy, trader i’s expected payoff is
                             Z ∞                                       
                                    −rt             i                 2
                          E       e      rv Z̄t + T̃κ (ẑt ) − γ(Z̄t ) dt ,
                                                  0
                 Pn        j
where, since         j=1 ẑt   = Zt , we have
                 ∞
                                                                                             κ21
            Z                                                                                   
                      −rt                                   −rt                        2
        E            e      T̃κi (ẑt ) dt       =E e                 κ1 ẑti
                                                                + κ0 (n κ2 + Zt ) + κ1 κ2 +         dt
             0                                                                              4κ0 n2
                                                    Z ∞                       Z ∞                      
                                                           −rt    i     i           −rt              2
                                                 =E       e κ1 (z0 + Ht ) dt +     e κ0 (n κ2 + Zt ) dt
                                                      0                          0
                                                                    κ21
                                                                       
                                                      1
                                                    +    κ1 κ2 +          .
                                                      r          4κ0 n2

   Because H i is a martingale,
     Z ∞                                          Z ∞
                            κ1 z0i                                                κ21
                                                                                     
           −rt i                     2κ0 nκ2 Z0          −rt  2      1
   E      e T̃κ (ẑt ) dt =        +            +E      e κ0 Zt dt +     κ1 κ2 +          .
       0                     r            r          0               r           4κ0 n2

Thus the expected total profit of trader i is

                                                      κ1 z0i           n2 κ0 − γ 2
                                                             + Z0 ι0 +          Z0 + ι1 ,
                                                       r                  rn2
for some constants ι0 , ι1 . If trader i could completely exit the mechanism, the associated
expected payoff would be
                                   Z T           
                               i                           γ
                           E zT π −      γ(zt ) dt = vz0i − (z0i )2 + ι2 ,
                                            i 2
                                      0                    r

for a constant ι2 . From this, trader i strictly prefers not to participate in the mechanism
whenever (z0i , Z0 ) is in a specific subset of R × Rn with strictly positive Lebesgue measure.




                                                                                114
