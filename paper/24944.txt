                             NBER WORKING PAPER SERIES




                                 SHIFT-SHARE DESIGNS:
                                THEORY AND INFERENCE

                                        Rodrigo Adão
                                        Michal Kolesár
                                       Eduardo Morales

                                     Working Paper 24944
                             http://www.nber.org/papers/w24944


                    NATIONAL BUREAU OF ECONOMIC RESEARCH
                             1050 Massachusetts Avenue
                               Cambridge, MA 02138
                                   August 2018




We thank Kirill Borusyak, Peter Egger, Gordon Hanson, Bo Honoré, and seminar participants at
Carleton University, Princeton University, Yale University, the Globalization & Inequality BFI
conference, IDB, GTDW, Unil, EESP-FGV, PUCRio, and the Princeton-IES conference for very
useful comments. We thank Juan Manuel Castro Vincenzi for excellent research assistance. We
thank David Autor, David Dorn and Gordon Hanson for sharing their code and data. All errors
are our own. The views expressed herein are those of the authors and do not necessarily reflect
the views of the National Bureau of Economic Research.

NBER working papers are circulated for discussion and comment purposes. They have not been
peer-reviewed or been subject to the review by the NBER Board of Directors that accompanies
official NBER publications.

© 2018 by Rodrigo Adão, Michal Kolesár, and Eduardo Morales. All rights reserved. Short
sections of text, not to exceed two paragraphs, may be quoted without explicit permission
provided that full credit, including © notice, is given to the source.
Shift-Share Designs: Theory and Inference
Rodrigo Adão, Michal Kolesár, and Eduardo Morales
NBER Working Paper No. 24944
August 2018
JEL No. C13,C26,F16,F22

                                         ABSTRACT

We study inference in shift-share regression designs, such as when a regional outcome is
regressed on a weighted average of observed sectoral shocks, using regional sector shares as
weights. We conduct a placebo exercise in which we estimate the effect of a shift-share regressor
constructed with randomly generated sectoral shocks on actual labor market outcomes across
U.S. Commuting Zones. Tests based on commonly used standard errors with 5% nominal
significance level reject the null of no effect in up to 55% of the placebo samples. We use a
stylized economic model to show that this overrejection problem arises because regression
residuals are correlated across regions with similar sectoral shares, independently of their
geographic location. We derive novel inference methods that are valid under arbitrary cross-
regional correlation in the regression residuals. We show that our methods yield substantially
wider confidence intervals in popular applications of shift-share regression designs.

Rodrigo Adão                                    Eduardo Morales
Booth School of Business                        Department of Economics
University of Chicago                           Princeton University
5807 South Woodlawn Avenue                      291 Julis Romo Rabinowitz Building
Chicago, IL 60637                               Princeton, NJ 08544
and NBER                                        and NBER
rodrigo.adao@chicagobooth.edu                   ecmorales@princeton.edu

Michal Kolesár
Department of Economics
278 Julis Romo Rabinowitz Building
Princeton University
Princeton, NJ 08544-1021
mkolesar@princeton.edu




A supplemental appendix is available at http://www.nber.org/data-appendix/w24944
A Code repository is available at https://github.com/kolesarm/BartikSE
1     Introduction
We study inference in shift-share designs: regression specifications in which one studies the impact of
a set of shocks, or “shifters”, on units differentially exposed to them, and whose differential exposure
depends on a set of weights, or “shares”. Specifically, shift-share regressions have the form

                                                                  S                           S
                 Yi = βXi + Zi0 δ + ei ,       where      Xi ≡   ∑ wis Xs ,       and        ∑ wis = 1.                 (1)
                                                                 s =1                        s =1

For example, in an investigation of the impact of sectoral demand shifters on regional employment
changes, Yi corresponds to the change in employment in region i, the shifter Xs is a measure of the
change in demand for the good produced by sector s, and the share wis may be measured as the initial
share of region i’s employment in sector s. Other observed characteristics of region i are captured by
the vector Zi , which includes the intercept, and ei is the regression residual.1
     Shift-share specifications can be very appealing in many contexts: they are simple to apply and
have the potential to both circumvent complicated endogeneity issues and provide estimates of treat-
ment effects that are robust to different microfoundations. As a result, such specifications have been
applied in numerous influential studies, including Bartik (1991), Blanchard and Katz (1992), Card
(2001) and Autor, Dorn and Hanson (2013). At the same time, two types of concerns have been
raised: first, the designs may not be appropriate in the presence of cross-regional general equilibrium
effects, and second, the estimand’s policy relevance is unclear when the effects of the shifters Xs are
heterogeneous across sectors and regions. In this paper, we put these concerns aside and focus on a
different question: how do we perform inference in shift-share regressions?
     We find that usual standard error formulas may substantially understate the true variability of
OLS estimators of β in eq. (1). To illustrate the empirical importance of this problem, we conduct a
placebo exercise. As outcomes, we use 2000–2007 changes in employment rates and average wages
for 722 Commuting Zones in the United States. We build a shift-share regressor by combining actual
sectoral employment shares in 1990 with randomly drawn sector-level shifters for 396 4-digit SIC
manufacturing sectors. We construct in this way many placebo samples that differ exclusively in the
randomly drawn sectoral shifters. For each sample, we compute the OLS estimate of β in eq. (1) and
test if its true value is zero. Since the shifters are randomly generated, their true effect is indeed
zero. Valid 5% level significance tests should therefore reject the null of no effect in at most 5%
of the placebo samples. We find however that usual standard errors—clustering on state as well
as heteroscedasticity-robust unclustered errors—are much smaller than the true standard deviation
of the OLS estimator and, as a result, lead to severe overrejection. Depending on the labor market
outcome used as the Yi variable in eq. (1), the rejection rate for 5% level tests can be as high as 55% if
heteroscedasticity-robust standard errors are used and 45% for standard errors clustered on state, and
it is never below 17%. In other words, suppose that 100 researchers received data on our randomly
generated shocks, but were told instead that these are actual sectoral shocks of interest, such as
    1 For
        simplicity of exposition, we refer to the unit of observation at which the outcome variable is measured as a region,
and the unit of observation at which the shifter is measured as a sector. However, our results apply to any regression
admitting the representation in eq. (1).



                                                             1
changes in trade flows, tariffs, or immigrant employment. Ideally, at most 5 of them would report
statistically significant, false-positive results. However, if these researchers were to use standard
inference procedures, up to 55 of them would find a statistically significant effect of the randomly
generated shocks on labor market outcomes across U.S. Commuting Zones. The overrejection is even
more severe when 2- and 3-digit SIC codes are used to define the sectors, so that the total number of
sectors is smaller.
    To explain the source of this overrejection problem, we introduce a stylized economic model. Our
model features multiple regions, each of which produces output in multiple sectors. The key ingre-
dients of our stylized model are a sector-region labor demand and a regional aggregate labor supply.
We assume that labor demand in each sector-region pair has an elasticity with respect to wages that
is sector-specific and an intercept that, crucially, aggregates several sector-specific components (e.g.
sectoral productivities and demand shifters for the corresponding sectoral good). Aggregate labor-
supply in each region is upward-sloping and depends on a region-specific intercept.2
    We use a potential outcome framework to represent the impact of a particular sector-specific labor
demand shock on changes in regional employment predicted by the model. Letting Yi (x1 , . . . , xS )
denote changes in aggregate employment in region i if the shock of interest is exogenously set to
(x1 , . . . , xS ), our model implies that

                                                                         S
                                        Yi (x1 , . . . , xS ) = Yi (0) + ∑ wis xs β is ,                                  (2)
                                                                        i =1


where Yi (0) = Yi (0, . . . , 0) is region i’s employment change if the shock of interest equals zero for all
sectors, and Yi = Yi (X1 , . . . , XS ) is the employment change for the realized shocks (X1 , . . . , XS ).
    A key insight of our model is that the potential outcome Yi (0) includes a shift-share component
that, using the same shares wis , measures the impact on region i of all sector-level shocks other than
the shock of interest Xs . The regression residual ei in eq. (1) will generally inherit the structure of
the potential outcome Yi (0), and will thus account for shift-share components that aggregate all un-
observed sector-level shocks using the same shares wis that enter the construction of the regressor Xi .
Consequently, whenever two regions have similar shares, they will not only have similar exposure to
the shifters Xs , but will also tend to have similar values of the residuals ei . While traditional infer-
ence methods allow for some forms of dependence between the residuals, such as spatial dependence
within a state, they do not directly address the possible dependence between residuals generated by
similarity in the shares. This is why, in our placebo exercise, traditional inference methods underes-
timate the variance of the OLS estimator of β, creating the overrejection problem.
    Motivated by the findings of our placebo exercise, we study the properties of the OLS estimator
of β in eq. (1) under repeated sampling of the sector-level shocks Xs , conditioning on the realized
   2 InAppendix A, we show that a special case of the model in Adão, Arkolakis and Esposito (2018) microfounds the
labor supply and labor demand functions that we assume. In this microfoundation, every region produces a differentiated
variety of each sectoral good, varieties are freely traded across regions, labor is the only factor of production, and workers
are both immobile across regions and equally productive in all sectors within a region. In Online Appendix C, we provide
alternative microfoundations that feature (a) sector-specific capital, as in Jones (1971) and Kovak (2013), and (b) workers
with idiosyncratic sectoral productivities, as in Galle, Rodríguez-Clare and Yi (2017), Lee (2017) and Burstein, Morales and
Vogel (2018a). We also discuss in this Online Appendix the implications of allowing for labor mobility across regions.



                                                               2
shares wis , controls Zi , and residuals ei . This sampling approach is natural given our interest in the
causal effect of the shifters Xs : we are interested in what would have happened if the sector-level
shock of interest had taken different values, holding everything else constant. The key assumption
we impose is that, conditional on the controls Zi and the shares wis , the shifters Xs are as good
as randomly assigned and independent across sectors. Given this assumption, we show that the
regression estimand β in eq. (1) corresponds to a weighted average of the heterogeneous parameters
β is in eq. (2), and derive novel confidence intervals that are valid in samples with a large number of
regions and sectors under any correlation structure of the regression residuals across regions.3,4 Our
standard error formula essentially forms sectoral clusters whose variance depends on the variance
of a weighted sum of the regression residuals ei , with weights that correspond to the shares wis . To
gain intuition on this formula, it is useful to consider the special case in which each region is fully
specialized in one sector (i.e. for every i, wis = 1 for some sector s); in this case, our procedure is
identical to using the usual clustered standard error formula, but with clusters defined as groups of
regions specialized in the same sector. This is in line with the rule of thumb that one should “cluster”
at the level of variation of the regressor of interest.5
    We illustrate the finite-sample properties of our novel inference procedure by implementing it on
the same placebo samples that we use to illustrate the bias of usual standard error formulas. Our new
formulas deliver estimates that are close to the true standard deviation of the OLS estimator across
the placebo samples; consequently, when applied to perform significance tests, they yield rejection
rates that are close to the nominal significance level. As predicted by the theory, our standard error
formula remains accurate in the presence of a state-level term in the regression residuals, and no
matter whether the shifters Xs are homoskedastic or heteroskedastic. When the number of sectors
is small or a sector is significantly larger that the other ones, our method overrejects relative to the
nominal significance level, but it still attenuates the overrejection problem in comparison to usual
standard error formulas.
    In the final part of the paper, we illustrate the implications of our new inference procedure for
three popular applications of shift-share regressions. First, we the study of the effect of changes in
sector-level Chinese import competition on labor market outcomes across U.S. Commuting Zones, as
in Autor, Dorn and Hanson (2013). Second, we use changes in sector-level national employment to
estimate the elasticity of regional employment to regional average wages, as in Bartik (1991). Lastly,
we use changes in the stock of immigrants from various origin countries to investigate the impact
of immigration on employment and wages across occupations and Commuting Zones in the United
States, as in the literature pioneered by Altonji and Card (1991) and Card (2001).
    In these applications, our proposed confidence intervals are substantially wider than those implied
   3 Software   implementing our confidence intervals is available at https://github.com/kolesarm/BartikSE.
   4 This  result is similar to that in Barrios et al. (2012), who consider cross-section regressions estimated at an individual
level when the variable of interest varies only across groups of individuals. They show that, as long as the shifter of interest
is as good as randomly assigned and independent across these individuals’ groups, standard errors clustered on groups
are valid under any correlation structure of the residuals.
    5 In an extension, we also provide confidence intervals that are valid when the shifters X are independent only across
                                                                                                   s
“clusters” of sectors, allowing thus for any correlation of these shifters across sectors belonging to the same “cluster”. We
also extend our methodology to settings in which the shift-share regressor is not the treatment of interest but an instrument
in an instrumental variables estimator.



                                                               3
by state-clustered or heteroscedasticity-robust standard errors. In particular, the 95% confidence
intervals for the estimated effects of Chinese competition on local labor markets increase by 20%–70%,
although these effects remain statistically significant. We obtain similar increases in the length of the
95% confidence interval for the estimated impact of immigration shocks, which are 20%–120% wider
than those implied by traditional methods. In contrast, our confidence intervals for the labor supply
elasticity estimated using the procedure in Bartik (1991) are almost identical to those constructed
using standard approaches; intuitively, the sectoral shifter used in this application—the change in
national employment by sector—soaks up most sectoral shocks affecting the outcome variable and,
consequently, no shift-share structure is left in the regression residuals.6
    Shift-share designs have been applied to estimate the effect of a wide range of shocks. Since the
applications are too numerous to comprehensively enumerate, let us list a few selective examples. In
seminal papers, Bartik (1991) and Blanchard and Katz (1992) use shift-share strategies to analyze the
impact on local labor markets of shifters measured as changes in national sectoral employment. More
recently, shift-share strategies have been applied to investigate the local labor market consequences
of various observable shocks, including international trade competition (Topalova, 2007, 2010; Kovak,
2013; Autor, Dorn and Hanson, 2013; Dix-Carneiro and Kovak, 2017; Pierce and Schott, 2017), credit
supply (Greenstone, Mas and Nguyen, 2015), technological change (Acemoglu and Restrepo, 2017,
2018), and industry reallocation (Chodorow-Reich and Wieland, 2018). Shift-share regressors have
also been used to study the impact of the same shocks on other outcomes, such as political prefer-
ences (Autor et al., 2017a; Che et al., 2017; Colantone and Stanig, 2018), marriage patterns (Autor,
Dorn and Hanson, 2018), crime levels (Dix-Carneiro, Soares and Ulyssea, 2017), and innovation (Ace-
moglu and Linn, 2004; Autor et al., 2017b). Shift-share regressors have been extensively used as well
to estimate the impact of immigration on labor markets, as in Card (2001) and many other papers
following his approach; see reviews of this literature in Lewis and Peri (2015) and Dustmann, Schön-
berg and Stuhler (2016). Furthermore, recent papers have explored versions of shift-share strategies
to estimate the effect on firms of shocks to outsourcing costs and foreign demand (Hummels et al.,
2014; Aghion et al., 2018). In addition to using shift-share designs to estimate the overall impact of
a shifter of interest, other work has used these designs as part of a more general structural estima-
tion approach; see Diamond (2016), Adão (2016), Galle, Rodríguez-Clare and Yi (2017), Burstein et al.
(2018b), Bartelme (2018). Baum-Snow and Ferreira (2015) review additional applications of shift-share
instrumental variables in the context of urban economics.7 Independently of the aim of the researcher
when estimating a shift-share regression, and of the interpretation of the estimand β in eq. (1), usual
standard errors formulas will generally be biased and, as long as the restrictions we impose on the
data generating process hold, our novel inference procedures will be asymptotically valid.
    Our paper is related to three other papers studying the statistical properties of shift-share specifi-
   6 To illustrate this point, we estimate the same inverse labor supply elasticity using instead the shift-share instrument in

Autor, Dorn and Hanson (2013). The sector shifter in this case—changes in trade flows from China to developed countries
other than the U.S.—leaves in the regression residual other sectoral shocks affecting U.S. labor markets; consequently, our
confidence intervals are in this case 20%–250% wider than those implied by traditional inference procedures.
   7 Several papers use a shift-share approach that treats the shifters as unobserved, and for this reason uses the shares

directly as regressors. This approach has been applied to investigate the impact of technological shifters (Autor and Dorn,
2013), credit supply shifters (Huber, 2018), and immigration shifters (Card and Dinardo, 2000; Monras, 2015). We treat the
sectoral shares Xs as observed and leave the extension to the unobserved case to future work.


                                                              4
cations. First, Goldsmith-Pinkham, Sorkin and Swift (2018) focus on the case in which the shift-share
regressor is used as an instrumental variable. Within this setting, these authors study the usage of the
full vector of shares (wi1 , . . . , wiS ) as an instrument for the endogenous treatment, and they conclude
that this approach requires that this vector of shares be as good as randomly assigned conditional on
the shifters, and independent across regions or clusters of regions. Given our interest in exploring the
impact of a specific set of shifters, rather than the impact of a set of shares, this approach is not attrac-
tive in our setting. That said, there may be other settings in which this approach is more appealing.
Second, Borusyak, Hull and Jaravel (2018), also focusing on the use of a shift-share regressor as an
instrumental variable, show that it is a valid instrument if the set of shifters is as good as randomly
assigned conditional on the shares, and discuss consistency of the instrumental variables estimator in
this context. Our approach to inference follows their identification insight; this way of thinking about
the shift-share design is also natural given our economic model. Third, Jaeger, Ruist and Stuhler
(2018) study complications with the shift-share instrument when it is correlated over time and there
is a sluggish adjustment of the outcome variable to changes in it.
      The rest of this paper is organized as follows. Section 2 presents the results of a placebo exercise
illustrating the properties of inference procedures previously used in the literature on shift-share
designs. Section 3 introduces our stylized economic model and maps its implications into a potential
outcome framework. Section 4 establishes the asymptotic properties of the OLS estimator of β in
eq. (1), and provides a consistent estimator of its standard error. Section 5 presents the results of a
placebo exercise in which we illustrate the performance of our novel inference procedures. Section 6
revisits the conclusions from several prior applications of shift-share regression analysis, and Section 7
concludes. Appendix A includes a microfoundation for the stylized economic model introduced in
Section 3, and Appendix B contains proofs for all propositions in Section 4. Additional results are
collected in Online Appendices C, D and E.


2     Overrejection of usual standard errors: placebo evidence
In this section, we implement a placebo exercise to evaluate the finite-sample performance of the
two inference methods most commonly applied in shift-share regression designs: (a) Eicker-Hubert-
White—or heteroskedasticity-robust—standard errors, and (b) standard errors clustered on groups
of regions geographically close to each other. In our placebo, we regress observed changes in U.S.
regional labor market outcomes on a shift-share regressor that is constructed by combining actual data
on initial sectoral employment shares for each region with randomly generated sector-level shocks.
We describe the setup in Section 2.1 and summarize the results in Section 2.2.


2.1     Setup and Data

We generate 30, 000 placebo samples indexed by m. Each of them contains N = 722 regions and
S = 397 sectors. We identify each region i with a U.S. Commuting Zone (CZ), and each sector s with
either a 4-digit SIC manufacturing industry or an aggregated non-manufacturing sector. We index
manufacturing industries by s = 1, . . . , S − 1 and the non-manufacturing sector by s = S.


                                                     5
       Using the notation introduced in eq. (1), each placebo sample m has identical values of the shares
{wis }iN,S                        N
       =1,s=1 , the outcomes {Yi }i =1 , and the non-manufacturing shifter XS ; the placebo samples differ
exclusively in the vector of shifters for the manufacturing sectors (X1m , . . . , XSm−1 ). Specifically, the
shares correspond to employment shares in 1990, the outcomes correspond to changes in employment
rates and average wages for different subsets of the population between 2000 and 2007, and the
shifter for the non-manufacturing sector is always set to zero, XS = 0. The vector of shifters for the
manufacturing sectors (X1m , . . . , XSm−1 ) is drawn i.i.d. from a normal distribution with zero mean and
variance var(Xsm ) = 5 in each placebo sample m. Because the shifters are independent of both the
outcomes and the shares, the parameter β is zero in every placebo sample m (note it doesn’t matter
what the dependence structure between the outcomes and shares themselves is).
    For each placebo sample m, given the observed outcome Yi , the generated shift-share regressor
  m
Xi and a vector of controls Zi including only an intercept, we compute the OLS estimate of β,
the heteroskedasticity-robust standard error (which we label as Robust), and the standard error that
clusters CZs in the same state (with label St-cluster).
    Our main source of data on employment shares is the County Business Patterns, and our measures
of changes in employment rates and average wages are based on data from the Census Integrated
Public Use Micro Samples in 2000 and the American Community Survey for 2006 through 2008.
Given these data sources, we construct our variables following the procedure described in the Online
Appendix of Autor, Dorn and Hanson (2013).8


2.2      Results

Table 1 presents the median and standard deviation of the empirical distribution of the OLS estimates
of β across the 30,000 placebo samples, along with the median length of the different standard error
estimates, and rejection rates for 5% significance level tests of the null hypothesis H0 : β = 0.
       The shifters have no effect on the outcomes and column (1) of Table 1 shows that, up to simulation
error, the average of the estimated coefficients is indeed zero for all outcomes. Column (2) reports
the standard deviation of the estimated coefficients. This dispersion is the target of the estimators
of the standard error of the OLS estimator.9 Columns (3) and (4) report the median standard error
for Robust and St-cluster procedures, respectively, and show that both standard error estimators are
downward biased relative to the standard deviation of the OLS estimator. On average across all
outcomes, the median magnitude of the heteroskedasticity-robust and state-clustered standard errors
are, respectively, 41% and 30% lower than the true standard deviation.
       The downward bias in the Robust and St-cluster standard errors translates into a severe overrejec-
tion of the null hypothesis H0 : β = 0. Since the true value of β equals 0 by construction, a correctly
behaved test statistic should generate a rejection rate of 5%. Columns (5) and (6) in Table 1 show
that traditional standard error estimators yield much higher rejection rates. For example, when the
outcome variable is the CZ’s employment rate, the rejection rate for a 5% significance level for the
null hypothesis H0 : β = 0 is 49.1% and 38.3% when Robust and St-cluster standard errors are used,
   8 We  are very grateful to the authors for sharing their code and datasets with us.
   9 Figure D.1 in Online Appendix D.2 reports the empirical distribution of the OLS estimates when the dependent variable
is the change in each CZ’s employment rate. Its distribution resembles a normal distribution centered around β = 0.


                                                            6
   Table 1: Standard errors and rejection rate of the hypothesis H0 : β = 0 at 5% significance level.

                                                         Estimate              Median std. error                Rejection rate
                                                   Mean        Std. dev       Robust       St-cluster       Robust        St-cluster
                                                    (1)           (2)           (3)            (4)            (5)            (6)
   Panel A: Change in the share of working-age population
   Employed                         −0.01    2.00      0.74                                    0.92         49.1%           38.3%
   Employed in manufacturing        −0.01    1.88      0.60                                    0.77         55.6%           44.4%
   Employed in non-manufacturing      0.01   0.94      0.58                                    0.67         23.0%           17.4%
   Panel B: Change in average log weekly wage
   Employed                         −0.02   2.68                                1.02           1.34         47.2%           34.1%
   Employed in manufacturing        −0.03   2.93                                1.69           2.11         26.4%           16.8%
   Employed in non-manufacturing −0.02      2.65                                1.05           1.33         45.4%           33.5%
    Notes: For the outcome variable indicated in the first column, this table indicates the median and standard deviation of the OLS
    estimates across the placebo samples (columns (1) and (2)), the median standard error estimates (columns (3) and (4)), and the
    percentage of datasets for which we reject the null hypothesis H0 : β = 0 using a 5% significance level test (columns (5) and (6)).
    Robust is the Eicker-Huber-White standard error, and St-cluster is the standard error that clusters CZs in the same state. Results
    are based on 30,000 simulation draws.



respectively. These rejection rates are very similar when the dependent variable is instead the change
in the average log weekly wage.
    These results are quantitatively important. To see this, consider the following thought-experiment.
Suppose we were to provide our 30, 000 simulated samples to 30, 000 researchers without disclosing
to them the origin of the data. Instead, we would tell them that the shifters correspond to changes in
a sectoral shock of interest—for instance, trade flows, tariffs, national employment or the number of
foreign workers employed in an industry. If these researchers set out to evaluate the impact of these
shocks on U.S. CZs using standard inference procedures with a 5% significance level test, then over a
third of them would conclude that our computer generated shocks had a statistically significant effect
on the evolution of employment rates between 2000 and 2007.
    The following remark summarizes the results of our placebo exercise.10

Remark 1. In shift-share regressions, traditional inference methods suffer from a severe overrejection problem
and yield confidence intervals that are too short.

    To develop some intuition on the source of this overrejection problem, note that the standard error
estimators commonly applied in shift-share regression designs assume that the regression residuals
are either independent across all regions (for Robust), or between geographically defined regional
groups (for St-cluster). Given that shift-share regressors are correlated across regions with similar sec-
toral employment shares {wis }Ss=1 , these methods generally lead to a downward bias in the standard
error estimate whenever regions with similar sectoral employment shares {wis }Ss=1 also tend to have
similar regression residuals. In the next section, we consider the implications of a stylized economic
model, and show that such correlations between the regression residuals are likely to arise because
  10 In Section 5, we extend our analysis to a number of modifications of this baseline setup, including alternative definitions

of sectors and regions, allowing for a non-zero shock to the non-manufacturing sector, and allowing for correlations between
the shocks to different sectors. The overrejection problem is always at least as severe as in this baseline setup.


                                                                    7
regions are generally exposed to unobserved sector-level shocks, in addition to the observed shocks
Xs . Consequently, whenever a researcher is running a shift-share regression, both heteroskedasticity-
robust and state-clustered standard errors will generally be biased downwards.


3     Stylized economic model
This section presents a stylized economic model mapping sector-level shocks to labor market out-
comes for a set of regional economies. The aim of the model is twofold. First, we show that the
impact of sectoral shifters on regional labor market outcomes have a shift-share structure, with het-
erogeneous effects across regions and sectors. Second, we show that unobserved sectoral shifters
introduce correlation in the regression residuals across regions with similar observed shares. We de-
scribe the model fundamentals in Section 3.1, discuss its main implications for the impact of sectoral
shocks in Section 3.2, and map these implications to a potential outcome framework in Section 3.3.


3.1     Environment

We consider an economy with multiple sectors s = 1, . . . , S and multiple regions i = 1, . . . , J. We
assume that the labor demand in sector s and region i, Lis , is given by

                                log Lis = −σs log ωi + log Dis ,            σs > 0,                     (3)

where ωi is the wage rate in region i, σs is the sector-specific labor demand elasticity, and Dis are
region- and sector-specific labor demand shifters. The shifter Dis may account for multiple sectoral
components. Since our analysis focuses on the impact of one particular sectoral component, we
decompose Dis into an observed shifter of interest, χs , other (potentially unobserved) shifters that
vary at a sectoral level and are grouped into µs , and a residual region- and sector-specific shifter ηis .
That is, without loss of generality, we write

                                   log Dis = ρs log χs + log µs + log ηis .                             (4)

      We assume that the labor supply in region i is given by

                                   log Li = φ log ωi + log vi ,           φ > 0,                        (5)

where φ is the labor supply elasticity, and vi is a region-specific labor supply shifter.
      Workers are assumed to be immobile across regions, but freely mobile across sectors. Thus, we
define the equilibrium as the wages {ωi }iJ=1 that satisfy the following market clearing condition:

                                               S
                                       Li =   ∑ Lis ,       i = 1, . . . , J.                           (6)
                                              s =1

      There are multiple microfoundations that are consistent with the labor demand in eq. (3) and the
labor supply in eq. (5). For our purposes, the different labor demand microfoundations are important


                                                        8
only to the extent that they affect the interpretation of the sector- and region-specific labor demand
shifter Dis . For example, one could assume that labor is the only factor of production and that every
region i is a closed economy and, in this case, Dis may account both for demand shifters for sector-
specific goods and for sector-specific productivity shifters. Similarly, as we show in Appendix A, we
may also allow goods to be freely traded across regions and assume that a subset of the J regions are
small open economies; in this case, the shifter Dis for these small open economies will account for
the world price of sector s, which will itself capture the impact of foreign demand and productivity
shocks. We also show in Appendix A that the labor supply in eq. (5) may be derived as the outcome of
the utility maximization problem of individuals who, conditional on being employed, are indifferent
about the sector of employment, but have heterogeneous disutilities of being employed at all.


3.2       Labor market impact of sectoral shocks

We assume that, in any period, our model characterizes the labor market equilibrium in every region
i = 1, . . . , J and that, across periods, changes in the labor market outcomes {ωi , Li }iJ=1 are due to
changes in the sectoral shifter of interest, {χs }Ss=1 , other potential sectoral shifters {µs }Ss=1 , sector- and
region-specific shifters {ηis }iJ,S                                        J
                                 =1,s=1 , and labor supply shifters, { vi }i =1 . Specifically, in every period,
the values of these shifters correspond to draws from an unknown joint distribution F (·):

                                      ({χs , µs }Ss=1 , {ηis }iJ,S             J
                                                                =1,s=1 , { vi }i =1 ) ∼ F (·).                             (7)

      We use ẑ = log(zt /z0 ) to denote log-changes in a variable z between some initial period t = 0 and
any other period t. Up to a first-order approximation around the initial equilibrium, eqs. (3) to (6)
imply that the change in employment in region i is

                                            S
                                   L̂i =   ∑ lis0 [ βis χ̂s + λi µ̂s + λi η̂is ] + (1 − λi ) v̂i ,                         (8)
                                           s =1

                                                                                           −1
where lis0 is the initial employment share of sector s in region i, λi ≡ φ φ + ∑s lis0 σs
                                                                          
                                                                                               , and β is ≡ ρs λi .
      According to eq. (8), the impact of sectoral shifters on equilibrium employment in region i depends
both on the initial sectoral employment shares {lis0 }Ss=1 , and the region- and shifter-specific elasticities
{ β is , λi }Ss=1 . Consequently, the employment change in eq. (8) includes several components with a
shift-share structure: the “share” term is always the initial employment share in a sector lis0 , and the
“shift” term is either the sectoral shock of interest, χ̂s , or alternative labor demand shocks, µ̂s . This
structure with multiple shift-share terms, some of them observed and others potentially unobserved,
is central to understanding the results presented in Section 2.
      Notice also that, even conditional on the initial employment share lis0 , the impact of a sector s
shifter on region-i’s employment may be heterogeneous across sectors and regions: β is may vary
across i and s.11 While standard datasets will usually contain information on the initial employment
shares for every sector and region {lis0 }iJ,S
                                            −1,s=1 , each parameter β is is not generally known or directly
  11 In
      our model, β is does not vary across regions or sectors if and only if all sectors have the same labor demand elasticity,
σs = σ, and shock pass-through, ρs = ρ.


                                                                 9
observed, and thus, the impact of the sectoral shifters need to be estimated.
      We summarize this discussion in the following remark:

Remark 2. The change in regional employment will generally combine multiple shift-share terms, and the
shifter effects depend on parameters that are heterogeneous across sectors and regions.

      The property that the impact of a shifter in sector s on employment in region i may be written as
lis0 β is that underlies Remark 2 does not depend on the particular microfoundation of the labor demand
and labor supply expressions in eqs. (3) and (5). The only difference across these microfoundations
is how β is depends on the structural parameters of each microfounded model.
      Besides the illustrative example of a possible microfoundation described in Appendix A, we pro-
vide alternative microfoundations in Online Appendices C.2 and C.3. Specifically, we show in Online
Appendix C.2 that eq. (8) is consistent with a Jones (1971) model featuring sector-specific inputs of
production. In Online Appendix C.3, we show that eq. (8) also arises in a Roy (1951) model in which
workers have heterogeneous preferences for being employed in the different sectors.
      We also extend our model in Online Appendix C.4 to allow for migration across regions. In this
case, the change in regional employment L̂i in any given region i = 1, . . . , J depends not only on the
region’s own shift-share terms included in eq. (8), but also on an endogenous component, common
to all regions, that combines the shift-share terms corresponding to all regions i = 1, . . . , J. Thus, in
the presence of migration, lis0 β is is the partial effect of the shifter χ̂s on local employment that ignores
cross-regional spillovers; consequently, it will only capture the differential effect of the sector-specific
shock χ̂s on region i relative to all other regions. However, once we condition on fixed effects that
absorb these cross-regional spillovers, Remark 2 remains valid for the model with migration.


3.3     From theory to inference

We build on the insights of Section 3.2 to propose a general framework to estimate the effect of shifters
on an outcome of interest that varies at a different level than these shifters. For concreteness, we refer
to the level at which the shifters vary as sectors, and the level at which the outcome varies as regions,
but our results do not depend on these particular labels.
      To make precise what we mean by “the effect of shifters on an outcome”, we use the potential
outcome notation, writing Yi (x1 , . . . , xS ) to denote the potential (counterfactual) outcome that would
occur in region i if the shocks to the S sectors were exogenously set to {xs }Ss=1 . Consistently with
eq. (8), we assume that the potential outcomes are linear in the shocks,

                                                      S                          S
                     Yi (x1 , . . . , xS ) = Yi (0) + ∑ wis xs β is ,   where   ∑ wis = 1,                   (9)
                                                     i =1                       s =1


and Yi (0) ≡ Yi (0, . . . , 0) denotes the potential outcome in region i when all shocks {xs }Ss=1 are set to
zero. According to eq. (9), increasing xs by one unit while holding the shocks to the other sectors
constant, leads to an increase in region i’s outcome of wis β is units. This is the treatment effect of xs
on Yi (x1 , . . . , xS ). The actual (observed) outcome is given by Yi = Yi (X1 , . . . , XS ), which depends on



                                                             10
the realization of the shifters X1 , . . . , XS . To map eq. (8) into eq. (9), define

                                                                       S
                   Yi = L̂i , wis = lis0 , xs = χ̂s ,    Yi (0) =     ∑ lis0 λi (µ̂s + η̂is ) + (1 − λi ) v̂i .      (10)
                                                                     s =1


Observe that Yi (0) aggregates all shifters other than the sectoral shifter of interest χ̂s .
    In the rest of the paper, we assume that we observe data for N regions and S sectors on the sectoral
shifters Xs , the regional outcomes Yi , and the region-sector shares wis .12,13 We are interested in the
properties of the OLS estimator β̂ of the coefficient on the shift-share regressor Xi = ∑Ss=1 wis Xs in a
regression of Yi onto Xi . To help us focus on the key conceptual issues, we abstract away from any
additional covariates or controls for now, and assume that Xs and Yi have been demeaned, so that we
can omit the intercept in a regression of Yi on Xi (see Section 4.2 for the case with controls). The OLS
estimator of the coefficient on Xi in this simplified setting is given by

                                                             ∑iN=1 Xi Yi
                                                      β̂ =               ,                                           (11)
                                                             ∑iN=1 Xi2

and we can write the regression equation as

                                                                      S                   S
                          Yi = βXi + ei ,        where       Xi ≡    ∑ wis Xs ,         ∑ wis = 1,                   (12)
                                                                     s =1               s =1


where β denotes the population analog of β̂.
    The definition of the estimand β and the properties of the estimator β̂ will depend on: (a) what
the population of interest is; and (b) how we think about repeated sampling. For (a), we define
the population of interest to be the observed set of N regions, as opposed to focusing on a large
superpopulation of regions from which the N observed regions are drawn. Consequently, we are
interested in the parameters { β is }iN,S                                          N,S
                                      =1,s=1 and the treatment effects { wis β is }i =1,s=1 themselves, rather
than the distributions from which they are drawn, which would be the case if we were interested in a
superpopulation of regions.14 For (b), given our interest on estimating the ceteris paribus impact of a
specific set of shocks X1 , . . . , XS , we consider repeated sampling of these shocks, while holding fixed
the shares wis , the parameters β is , and the potential outcomes Yi (0).
    Given our assumptions on the population of interest and on the type of repeated sampling, the
estimand β is defined as the population analog of eq. (11) under repeated sampling of the shocks Xs :

                            ∑iN=1 E[ Xi Yi | F0 ]
                       β=                         ,     with          F0 = {Yi (0), β is , wis }iN,S
                                                                                                 =1,s=1 ,            (13)
                            ∑iN=1 E[ Xi2 | F0 ]
  12 We can think of the N observed regions as a subset of the J regions existing worldwide and whose labor market

equilibrium is described in Sections 3.1 and 3.2.
  13 For simplicity, we assume that we have data on the shifters X directly, rather than possibly noisy estimates of them.
                                                                       s
  14 This definition of the population of interest is common in applications of the shift-share approach. For example, the

abstract of Autor, Dorn and Hanson (2013) reads: “We analyze the effect of rising Chinese import competition between
1990 and 2007 on U.S. local labor markets”. Similarly, the abstract of Dix-Carneiro and Kovak (2017) reads: “We study the
evolution of trade liberalization’s effects on Brazilian local labor markets” (emphases added).




                                                              11
and, given eqs. (9) and (12), the regression error ei is then defined as the residual

                                                                    S
                                     ei = Yi − Xi β = Yi (0) + ∑ wis Xs ( β is − β),                                      (14)
                                                                   i =1

where β is defined as in eq. (13).
    Thus, the statistical properties of the regression residual ei depend on the properties of the po-
tential outcome Yi (0), the shifters {Xs }Ss=1 , the shares {wis }iN,S
                                                                   =1,s=1 , and the difference between the
parameters { β is }iN,S
                    =1,s=1 and the estimand β. Importantly, the potential outcome Yi (0) will generally
incorporate terms that have a shift-share structure analogous to that of the regressor of interest, Xi .
Specifically, as illustrated in eq. (10), the model introduced in Section 3.1 implies that Yi (0) includes
a weighted average of unobserved sectoral labor-demand shocks, ∑Ss=1 lis0 λi µ̂s . Hence, if two regions
i and i0 have similar shares {lis0 }Ss=1 and {li00 s }Ss=1 , they will tend to have similar regressors Xi and Xi0
and similar potential outcomes Yi (0) and Yi0 (0). It then follows from eq. (14) that the residuals ei and
ei0 will be correlated.15
    We summarize this discussion in the following remark.

Remark 3. Correctly performing inference for the coefficient on a shift-share regressor β requires taking into
account that the regression residuals will generally inherit the same shift-share structure.

    Remark 3 has important implications for estimating the variability of β̂ across samples. In partic-
ular, traditional inference procedures do not account for correlation in ei among regions with similar
shares and, therefore, tend to underestimate the variability of β̂. As we discuss in all remaining
sections of the paper, this is the main reason for the overrejection problem described in Section 2.


4    Asymptotic properties of shift-share regressions
In this section, we formulate the statistical assumptions that we impose on the data generating pro-
cess (DGP), present asymptotic results that we derive using these assumptions, and use the model
introduced in Section 3.1 to provide an economic interpretation for these assumptions. We first con-
sider in Section 4.1 the simple case in which there is a single regressor with a shift-share structure
and no controls, as in Section 3.3. We introduce controls in Section 4.2. Section 4.3 considers further
extensions. All proofs and technical details are in Appendix B.
    Following the notation introduced in Section 3.3, we write sector-level variables (such as the
shocks Xs ) in script font style and region-level aggregates (such as Xi ) in normal style. To compactly
state our assumptions and results, we use standard matrix and vector notation. In particular, for a
(column) L-vector Ai that varies at the regional level, A denotes the N × L matrix with the ith row
given by Ai0 . For an L-vector As that varies at the sectoral level, A denotes the S × L matrix with the
sth row given by As0 . If L = 1, then A and A are an N-vector and an S-vector, respectively. Let W
denote the N × S matrix of shares, so that its (i, s) element is given by wis , and let B denote the N × S
matrix with (i, s) element given by β is .
   15 As we discuss in Section 4.2, when controls are included, this conclusion will still hold unless the controls account for

all sectoral shocks other than {Xs }Ss=1 that affect the outcome.


                                                              12
4.1     No controls

We study here the statistical properties of the OLS estimator in eq. (11). We assume that, conditionally
on the matrix of shares W, the shocks are as good as randomly assigned in that they are independent
of the potential outcomes Yi (x1 , . . . , xS ). Formally, given the definition of the potential outcomes in
eq. (9), we assume
                                              (Y ( 0 ) , B ) ⊥
                                                             ⊥ X | W.                                  (15)

In the next subsection, we weaken this assumption by assuming that the shocks are as good as
randomly assigned conditionally on some controls.
      As discussed in Section 3.3, we consider the statistical properties of β̂ under repeated sampling
of the shocks X, and condition on the realized values of the shares and on the potential outcomes.
This approach is analogous to the randomization-style inference in the literature on inference in
randomized controlled trials (see Imbens and Rubin, 2015, for a review); it leverages the random
assignment assumption in eq. (15), and ensures that the standard errors that we derive will remain
valid under any dependence structure between the shares wis across sectors and regions, and under
any correlation structure of the potential outcomes Yi (0), or equivalently, of the regression errors
ei , across regions. In particular, this approach allows (but does not require) the residual to have a
shift-share structure.
      We consider asymptotics with the number of sectors going to infinity, S → ∞, and assume that
N → ∞ as S → ∞. Formally, the number of regions N thus depends on S, but we keep this
conditioning implicit. We do not restrict the ratio N/S, so that the number of regions may grow
at a faster rate than the number of sectors. The assumptions needed for the propositions below
are collected in Appendix B.1. The key assumption underlying our approach to inference is that
the shocks (X1 , . . . , XS ) are independent across s conditional on the shares W (see Assumption 1(ii)
in Appendix B.1). In contrast, Yi (0) and the shares wis can be correlated in an arbitrary manner
across i. We also do not require X, or any other variables, to be identically distributed—the sectors
and regions may be heterogeneous.
      The main regularity condition that we need is that each sector is asymptotically negligible in the
sense that maxs ns /N → 0, where ns = ∑iN=1 wis is the aggregate “size” of sector s in the population
of interest (see Assumption 2(ii) in Appendix B.1). It generalizes the standard consistency condition
in the clustering literature that the largest cluster be asymptotically negligible. To see the connection,
consider the special case with “concentrated sectors”, in which each region i specializes in one sector
s(i ). Then wis = 1 if s = s(i ) and wis = 0 otherwise, and ns is the number of regions that specialize
in sector s. In this case, Xi = Xs(i) , so that, if eq. (15) holds, β̂ is equivalent to an OLS estimator
in a randomized controlled trial in which the treatment varies at a cluster level; here the sth cluster
consists of regions that specialize in sector s. The condition maxs ns /N → 0 then reduces to the
assumption that the largest cluster be asymptotically negligible.

Proposition 1. Suppose Assumptions 1 and 2 in Appendix B.1 hold. Then

                                  ∑iN=1 ∑Ss=1 πis β is
                             β=                        ,        and     β̂ = β + o p (1),              (16)
                                   ∑iN=1 ∑Ss=1 πis

                                                           13
             2 var(X | W ).
where πis = wis     s

    This proposition gives two results. First, it shows that the estimand β in eq. (13) can be expressed
as a weighted average of the region- and sector-specific parameters { β is }iN,S
                                                                             =1,s=1 , with weights that
are increasing in the shares and variance of the shock. Second, it shows that the OLS estimator β̂
converges to this estimand as S → ∞. The special case with concentrated sectors is again useful to
understand Proposition 1. Fully concentrated sectors imply that ∑Ss=1 πis β is = var(Xs(i) | W ) β is(i)
and, therefore, the first result in Proposition 1 reduces to the standard result from the randomized
controlled trials literature with cluster-level randomization (with each “cluster” defined as all regions
specialized in the same sector) that the weights are proportional to the variance of the shock.
    The estimand β does not in general equal a weighted average of the heterogeneous treatment
effects. As discussed earlier, the effect on the outcome in region i of increasing the value of the sector
s shock in one unit is equal to wis β is ; the total effect of increasing the shifters simultaneously in
every sector by one unit is ∑Ss=1 wis β is . Consequently, for a set of region- and sector-specific weights
{ξ is }iN,S
        =1,s=1 , the corresponding weighted average treatment effect is


                                                             ∑iN=1 ∑Ss=1 ξ is wis β is
                                                   τξ ≡                                ,
                                                                ∑iN=1 ∑Ss=1 ξ is

and a weighted total average treatment effect is τζT = ∑iN=1 ζ i ∑Ss=1 wis β is , where {ζ i }iN=1 are regional
weights that sum to one. If β is is constant across i and s, β is = β, then β = τζT , and τξ can be
consistently estimated as τ̂ξ = β̂ ∑iN=1 ∑Ss=1 ξ is wis / ∑iN=1 ∑Ss=1 ξ is . On the other hand, if β is varies across
regions and sectors, then it is not clear in general how to exploit knowledge of the estimand β defined
in eq. (16) to learn something about τξ or τζT . A special case in which it is possible to consistently
estimate τξ arises when Xs is homoscedastic and ξ is = wis ; in this case, a consistent estimate is given
by τ̂ξ = β̂ ∑iN=1 ∑Ss=1 wis
                         2 σ̂2 / N
                                ∑i=1 ∑Ss=1 wis σ̂2 , where σ̂2 is a consistent estimate of var(Xs ).16
    Under slight strengthening of the regularity conditions (see Assumption 3 in Appendix B.1), we
obtain the following distributional result:

Proposition 2. Suppose Assumptions 1, 2 and 3 hold, and suppose that
                                                                                                     !
                                                                       N
                                                    1
                                     VN =
                                                 ∑Ss=1 n2s
                                                             var      ∑ Xi ei | Y (0), B, W
                                                                      i =1


converges in probability to a non-random limit, where ns = ∑iN=1 wis . Then
                                                                                                
                                   N                                              VN
                                                ( β̂ − β) = N 0,                             2  + o p (1).
                                                                                                 
                              q
                                  ∑Ss=1   n2s                                1
                                                                             N   ∑iN=1   Xi2
  16 In general, one could consistently estimate τ or τ T by imposing a mapping between β and structural parameters
                                                  ξ     ζ                                          is
and obtaining consistent estimates of these structural parameters. However, since this mapping will vary across models,
the consistency of such estimator will not be robust to alternative modeling assumptions, even if all these modeling as-
sumptions predict an equilibrium relationship like that in eq. (8); e.g. see expressions for β is in Appendix A and in Online
Appendices C.2 and C.3.



                                                                     14
   This proposition shows that β̂ is asymptotically normal, with a rate of convergence equal to
                                                                                                     √
N (∑Ss=1 n2s )−1/2 . If the sector sizes ns are all equal to N/S, the rate of convergence is equal to S.
However, if the sizes are unequal, the rate may be slower.
    According to Proposition 2, the asymptotic variance formula has the usual “sandwich” form. Since
Xi is observed, to construct a consistent standard error estimate, it suffices to construct a consistent
estimate of VN , the middle part of the sandwich. Suppose that β is is common across regions and
sectors, β is = β, then it follows from eq. (15) and the assumption that (X1 , . . . , Xs ) are independent
across s that17
                                         ∑Ss=1 var(Xs | W ) R2s                         N
                                  VN =
                                                ∑Ss=1 n2s
                                                                ,          Rs =       ∑ wis ei .                       (17)
                                                                                      i =1

Replacing var(Xs | W ) by Xs2 , and ei by the regression residual êi = Yi − Xi β̂, we obtain the standard
error estimate
                                                q
                                                    ∑Ss=1 Xs2 R̂2s                N
                                    b ( β̂) =
                                    se
                                                    ∑iN=1 Xi2
                                                                     ,   R̂s =   ∑ wis êi .                           (18)
                                                                                 i =1

To gain intuition for the expression in eq. (18), consider the case with concentrated sectors such that
the formula becomes ∑Ss=1 Xs2 R̂2s = ∑Ss=1 (∑iN=1 I{s(i ) = s} Xi êi )2 . In this special case, the standard
error formula in eq. (18) reduces to the usual cluster-robust standard error, allowing for arbitrary
correlation across regions specialized in the same sector.18
    When regions are not fully specialized in a sector, the standard error in eq. (18) accounts for
the fact that regions with similar sectoral composition will generally have similar errors; only in the
special case in which the regression error ei = Yi (0) has no sectoral component (so there are no
unobserved sector-level shocks), it will be the case that cov( Xi ei , X j e j ) = 0 for i 6= j. In contrast, the
usual heteroscedasticity-robust standard error fails to account for this correlation. Standard errors
clustered by groups of regions defined by their geographical proximity will also generally fail to
account for this correlation. In fact, they will only capture it if and only if all regions are fully
specialized in a single sector and the sector of specialization is the same for regions belonging to the
same geographically defined cluster.

Remark 4. In the expression for VN in eq. (17), the only expectation is taken over Xs —we do not take any
expectation over the shares wis or the residuals ei . This is because our inference is conditional on the realized
values of the shares and on the potential outcomes. In terms of the regression in eq. (12), this means that
we consider properties of β̂ under repeated sampling of Xi = ∑s wis Xs conditional on the shares wis and on
the residuals ei (as opposed to, say, considering properties of β̂ under repeated sampling of the residuals ei
conditional on Xi ). As a result, our standard errors allow for arbitrary dependence between the residuals ei .
  17 The standard error formula that we provide remains valid if β is heterogeneous across regions and sectors, as long as
                                                                   is
some mild restrictions on the form of heterogeneity apply; see Appendix B.6 for a discussion.
  18 Thus, in the case with concentrated industries, the usual approach to inference that considers repeated sampling of e ,
                                                                                                                          i
holding the regressors constant, would deliver the same standard error formula if one assumed that ei were independent
across locations specializing in different industries.




                                                                15
4.1.1   Discussion of assumptions

In general, in order to identify a relationship as causal, one needs a random assignment assump-
tion. In order to do inference and apply a central limit theorem, one needs an independence-type
assumption.19 In our case, the key identifying assumption is that the shifters {Xs }Ss=1 are as good as
randomly assigned conditional on the shares {wis }S,N
                                                  s=1,i =1 (see eq. (15)). This identification assump-
tion has been previously suggested by Borusyak, Hull and Jaravel (2018). For inference, we also
require that the shocks are independent across sectors. As illustrated through the economic models
described in Appendix A and Online Appendix C, these assumptions generally imply restrictions on
the stochastic process of economic fundamentals. How strong these restrictions are will depend on
the specific context. For example, in a world in which all N regions of interest are closed economies,
the only sectoral shocks are either productivity or preference shocks, and the shifters of interest are
the former, these assumptions require that, conditional on the shares, the productivity shocks are:
(a) independent of preference shocks; and (b) independent across sectors. In Section 4.2, we illus-
trate how to relax assumption (a) by incorporating controls into the regression specification and, in
Section 4.3.2, we show how to relax it by using instrumental variables. Additionally, we show in
Section 4.3.1 how to relax assumption (b) by allowing for a non-zero correlation in the sectoral shocks
of interest within clusters of sectors.
    Goldsmith-Pinkham, Sorkin and Swift (2018) investigate a different approach to identification
based on the assumption that the shares (wi1 , . . . , wiS ) are as good as randomly assigned conditional
on the shifters Xs . For inference, this approach requires that the shares (wi1 , . . . , wiS ) be independent
across regions or clusters of regions. However, as illustrated through the stylized economic model
presented in Section 3, these shares are generally equilibrium objects and, consequently, they are
unlikely to be as good as randomly assigned. For instance, in the case of the environment described
in Section 3.1, under the assumption that σs = σ for all sectors, it holds that lis0 = Dis0 /(∑Sk=1 Dik
                                                                                                     0 ),

where Dis0 is the labor demand shifter of sector s in region i in the initial equilibrium. However, as
shown in eqs. (4), (10) and (14), the regression residual ei accounts for changes in certain variables
that also affect the demand shifter Dis0 and, consequently, lis0 will generally be correlated with ei unless
changes in those variables are independent of their past initial levels.20 Furthermore, as the demand
shifters Dis0 are likely to depend on terms that vary by sector (see eq. (4)), the labor shares lis0 will
generally be correlated across all regions i = 1, . . . , N for a given sector s, complicating the task of
deriving valid inference procedures in this setting.
    The results in Propositions 1 and 2 also require the assumption that maxs ns /N → 0. In terms of
the economic model introduced in Section 3, this assumption imposes that no one sector dominates
the others in terms of initial employment at the national level; i.e. ∑iN=1 lis0 is not too large for any one
sector. As we illustrate in Section 5.2, this condition is satisfied for the U.S. when only manufacturing
sectors are taken into account; it would not hold if the non-manufacturing sector is included as one of
  19 For example, for inference on average treatment effects, which is commonly the goal when running a regression, one

assumes that the treatment is as good as randomly assigned conditional on controls, and typically also that the data on
individuals is i.i.d., which implies that the treatment is independent across individuals conditional on the controls.
  20 Importantly, the correlation between the shares { w }S
                                                          is s=1 and the regression residuals ei does not affect the consistency
of the OLS estimator of β if the shifters Xs are as good as randomly assigned conditional on the shares wis .



                                                              16
the S sectors incorporated into the analysis (unless the distribution of Xs for the non-manufacturing
sector is degenerate at zero).21
      Finally, Propositions 1 and 2 also require the number of sectors and the number of regions to go to
infinity. Shift-share designs are however sometimes used in settings in which the number of regions
or the number of sectors is small. Through placebo exercises, we illustrate in Section 5 the finite-
sample properties of the standard error estimator introduced in eq. (18): our estimates are very close
to the true standard deviation of the estimator β̂ for sample sizes employed in typical applications.


4.2     General case with controls

In many applications of shift-share regression designs, a K-vector of regional controls Zi is included
in the regression specification. We now study the properties of the OLS estimator of the coefficient
on Xi in a regression of Yi onto Xi and Zi . To this end, let Z denote the N × K matrix with i-th row
given by Zi0 , and let Ẍ = X − Z ( Z 0 Z )−1 Z 0 X denote an N-vector whose i-th element is equal to the
regressor Xi with the controls Zi partialled out (i.e. the i-th residual from regressing X onto Z). Then,
by the Frisch–Waugh–Lovell theorem, β̂ is equivalent to

                                                        ∑iN=1 Ẍi Yi   Ẍ 0 Y
                                                 β̂ =                =         ,                                         (19)
                                                        ∑iN=1 Ẍi2     Ẍ 0 Ẍ

and the OLS estimator of the coefficient on Zi is equivalent to

                                               δ̂ = ( Z 0 Z )−1 Z 0 (Y − X β̂).

      The controls Z may play two roles. First, controls may be included to increase the precision of β̂.
Second, and more importantly, they may be included to proxy for latent sector-level shocks {Zs }Ss=1
that have an independent effect on the outcome Y and are correlated with the shifters {Xs }Ss=1 . In
the presence of such shocks, the shifters are only as good as randomly assigned conditional on them,
and it is necessary to control for them in order to prevent omitted variable bias.
      To account for the two possible roles that controls may play, we assume that the controls Zi admit
the decomposition
                                                           S
                                                  Zi =    ∑ wis Zs + Ui .                                                (20)
                                                          s =1

If the kth component Zik of Zi is included for precision, then Zsk = 0 for all s = 1, . . . , S, and Zik is
included because Yi (0) and Uik are correlated. This is the case, for instance, if Yi (0) and Uik contain
regional shocks that are independent of the sectoral shifters of interest X. If, on the other hand, Zik
is included to proxy for a latent shock Zs , then Uik represents the measurement error in Z when
controlling for Z and Zik is a perfect only if Uik = 0.
  21 When   analyzing the impact of international trade on regional labor market outcomes, it is standard to either set
the shock of the non-manufacturing sector to zero (Topalova, 2007, 2010; Autor, Dorn and Hanson, 2013; Hakobyan and
McLaren, 2016) or to remove the non-manufacturing sector from the analysis and rescale the shares of all manufacturing
sectors so that they add up to one (Kovak, 2013). Either of these approaches will satisfy the restriction that maxs ns /N → 0.




                                                                 17
    With this setup, we replace eq. (15) with the assumption that

                                            (U, Y (0), B) ⊥
                                                          ⊥ X | Z, W,                                      (21)

where Z denotes the S × K matrix with sth row given by Zs0 , and U denotes the N-vector with i-th
element given by Ui .
    To facilitate the interpretation of the condition in eq. (21), it is useful to consider a projection
of the regional potential outcomes onto the sectoral space. For simplicity, consider the case with
constant effects, β is = β, and suppose Ui = 0. Project Yi (0) onto the sector-level controls Zs , so that
we can write Yi (0) = ∑Ss=1 wis Zs0 κ + ηi . Then eq. (21) holds if the residuals ηi in this projection are
independent of X—if there are any other unobserved sector-level shocks that affect the outcomes
(and are therefore in ηi ), these must be unrelated to (Xs , Zs ).
    To ensure that it suffices to include the controls in the regression linearly (instead of having to
control for them non-parametrically), we additionally assume that the expectation of Xs conditional
on Zs is linear in Zs ,
                                                 E[Xs | Z, W ] = Zs0 γ,                                    (22)

where γ is a K-vector that equals 0 if and only if the scalar Xs is mean independent of the K-vector
Zs . We then obtain the following generalization of Proposition 1:

Proposition 3. Suppose Assumptions 2 and 4 in Appendix B.1 hold, and that Ui0 γ = 0 for i = 1, . . . , N.
Then,
                                   ∑iN=1 ∑Ss=1 πis β is
                              β=                        ,        and   β̂ = β + o p (1),                   (23)
                                    ∑iN=1 ∑Ss=1 πis
             2 var(X | W, Z ).
where πis = wis     s

    The only difference with to Proposition 1 is that the weights πis now reflect the variance of Xs
conditional on Z and W, rather than just conditional on W. An additional assumption is the require-
ment that Ui0 γ = 0 for all i. Effectively, this requires that, for each control k, either Uik = 0 for all i,
so that Zik is a perfect proxy for the sector-level variables Z1k , . . . , ZSk , or else γk = 0, so that Zsk is
unrelated to Xs —the proxy need not be perfect in this case, since it is not necessary to control for Zsk
in the first place (including Zik in the regression only affects the precision, but not the consistency,
of β̂). If Ui0 γ 6= 0, then there will be omitted variable bias due to inadequately controlling for the
confounders Z. This is analogous to the classic linear regression result that measurement error in a
control variable leads to a bias in the estimate of the coefficient on the variable of interest.
    To state the asymptotic normality result, we need to define the residual ei in the regression equa-
tion Yi = Xi β + Zi0 δ + ei . To this end, let

                                          δ = E[ Z 0 Z ]−1 E[ Z 0 (Y − Xβ)]

denote the population regression coefficient on Zi . We then define the regression residual as ei =
Yi − Xi β − Zi0 δ and obtain the following generalization of Proposition 2:



                                                            18
Proposition 4. Suppose Assumptions 2, 3, 4 and 5 in Appendix B.1 hold, and that Ui0 γ = 0 for i = 1, . . . , N.
Suppose also that                                                                                               !
                                         1
                            VN =
                                   ∑Ss=1 n2s
                                                var     ∑ ( Xi −      Zi0 γ)ei    | Y (0), B, U, Z, W
                                                         i

converges in probability to a non-random limit, and let ns = ∑iN=1 wis . Then
                                                                                               !
                                     N                                          VN
                               q               ( β̂ − β) = N 0,                           2       + o p (1).
                                                                            1
                                   ∑Ss=1 n2s                                N   ∑i Ẍi2

    Relative to Proposition 2, the only difference is that Xi in the definition of VN is replaced by
Xi − Zi0 γ, and that Xi is replaced by Ẍi in the outer part of the “sandwich.”
    To construct a consistent standard error estimate, similarly to the case without controls, it suffices
to construct a consistent estimate of VN , the middle part of the sandwich. We derive the standard
error formula under the assumption that β is = β for all i, s.22 Under this assumption, it follows from
eq. (21) and the assumption that (X1 , . . . , Xs ) are independent across s that

                           ∑Ss=1 var(X̃s | W, Z ) R2s                            N
                    VN =
                                   ∑Ss=1 n2s
                                                      ,               Rs =      ∑ wis ei ,          X̃s = Xs − Zs0 γ.
                                                                                i =1

A plug-in estimate of Rs can be constructed by replacing ei with the estimated regression residuals
êi = Yi − Xi β̂ − Zi δ̂. To construct an estimate of the variance var(X̃s | W, Z ), we first project the
consistent estimate Ẍi of Xi − Zi0 γ onto the sectoral space by regressing it onto the shares Wi ,

                                                  b = (W 0 W )−1 W 0 Ẍ,
                                                  X                                                                     (24)

                                                      b 2 . This leads to the standard error estimate
and we then estimate the variance var(X̃s | W, Z ) by X
                                                q
                                                    ∑Ss=1 X
                                                          b s2 R̂2s                        N
                                    b ( β̂) =
                                    se
                                                      ∑iN=1 Ẍi2
                                                                        ,       R̂s =     ∑ wis êi .                   (25)
                                                                                          i =1

    The next remark summarizes these steps:

Remark 5. To construct the standard error estimate in eq. (25):

   1. Obtain the estimates β̂ and δ̂ by regressing Yi onto Xi = ∑s wis Xs and the controls Zi . The estimate êi
      corresponds to the estimated regression residuals.

   2. Construct Ẍi , the residuals from regressing Xi onto Zi . Compute X
                                                                         b s , the regression coefficients from
      regressing Ẍ onto W. This requires the share matrix W to be full rank, which itself requires N > S.

Plug the estimates êi , Ẍi , and X
                                   b s into the standard error formula in eq. (25).
  22 Wediscuss in Appendix B.6 the restrictions under which our standard error formula remains valid when the effects are
heterogeneous.




                                                                   19
    Consider again the case with concentrated sectors. Suppose that Ui = 0 for all i, so that the
regression of Yi onto Xi and Zi is identical to the regression of Yi onto Xs(i) and Zs(i) . Then, the
standard error formula in eq. (25) reduces to the usual cluster-robust standard error, with clustering
on the sectors s(i ).
    It has been shown that the cluster-robust standard error is generally biased due to estimation noise
in estimating ei , which can lead to undercoverage, especially in cases with few clusters (see Cameron
and Miller, 2014 for a survey). Since the standard error in eq. (25) can be viewed as generalizing the
cluster-robust formula, similar concerns arise in our setting. We therefore also consider a modification
b β0 ( β̂) of se
se            b ( β̂) that imposes the null hypothesis when estimating the regression residuals to reduce
                                                                                       b β0 ( β̂) for testing
the estimation noise in estimating ei . In particular, to calculate the standard error se
the hypothesis H0 : β = β 0 against a two-sided alternative at significance level α, one replaces êi with
êβ0 ,i , the residual from regressing Yi − Xi β 0 onto Zi (that is, êβ0 ,i is an estimate of the residuals with
the null imposed). The null is rejected if the absolute value of the t-statistic ( β̂ − β 0 )/se  b β0 ( β̂) exceeds
z1−α/2 , the 1 − α/2 quantile of a standard normal distribution (1.96 for α = 0.05). To construct a
confidence interval (CI) with coverage 1 − α, one collects all hypotheses β 0 that were not rejected. It
follows from simple algebra that the endpoints of this CI are a solution to a quadratic equation, so
that they are available in closed form—one does not have to numerically search for all the hypotheses
that were not rejected. The next remark summarizes this procedure.

Remark 6 (Confidence interval with null imposed). To test the hypothesis H0 : β = β 0 with significance
level α, or equivalently, to check whether β 0 lies in the confidence interval with confidence level 1 − α:

   1. Obtain the estimate β̂ by regressing Yi onto Xi = ∑s wis Xs and the controls Zi . Obtain the restricted
      regression residuals êβ0 ,i as the residuals from regressing Yi − Xi β 0 onto Zi .

   2. Construct Ẍi , the residuals from regressing Xi onto Zi . Compute X
                                                                         b s , the regression coefficients from
      regressing Ẍ onto W (this step is identical to step 2 in Remark 5).

Compute the standard error as
                                              q
                                                  ∑Ss=1 X
                                                        b s2 R̂2
                                                               β 0 ,s
                                                                                           N
                               b β0 ( β̂) =
                               se
                                                    ∑iN=1 Ẍi2
                                                                        ,    R̂ β0 ,s =   ∑ wis êβ ,i .
                                                                                                    0
                                                                                                                   (26)
                                                                                          i =1


Reject the null if |( β̂ − β 0 )/se
                                 b β0 ( β̂)| > z1−α/2 . A confidence set with coverage 1 − α is given by all nulls that
are not rejected, CI1−α = { β 0 : |( β̂ − β 0 )/se
                                                 b β0 ( β̂)| < z1−α/2 }. This set is an interval with endpoints given by
                                     s
                                                 b ( β̂)2
                                                 se                              ∑Ss=1 X
                                                                                       b s2 R̂s ∑i wis Ẍi
                          β̂ − A ±       A2 +                  ,            A=                             ,       (27)
                                                Q/( Ẍ 0 Ẍ )2                              Q

where Q = ( Ẍ 0 Ẍ )2 /z21−α/2 − ∑Ss=1 X
                                        b s2 (∑i wis Ẍi )2 and se
                                                                b ( β̂) and R̂s are given in eq. (25).

                                                                                  b β0 ( β̂) and se
    Since in both êi and êβ0 ,i are consistent estimates of the residuals, both se             b ( β̂) are
consistent estimates of the standard error and, consequently, yield tests and confidence intervals that
are asymptotically valid. The next proposition formalizes this result.

                                                                  20
Proposition 5. Suppose that the assumptions of Proposition 4 hold, and that β is = β. Suppose also that N ≥
S, W is full rank, and that either maxs ∑i |((W 0 W )−1 W 0 )si | is bounded, or else that Ui = 0 for i = 1, . . . , N.
Define Xb as in eq. (24), and let R̂s = ∑iN=1 wis ẽi , where ẽi = Yi − Xi β̃ − Z 0 δ̃, and β̃ and δ̃ are consistent
                                                                                         i
estimators of δ and β. Then
                                              ∑Ss=1 X
                                                    b s2 R̂2s
                                                              = VN + o p (1).                                          (28)
                                               ∑Ss=1 n2s
    The additional assumption of Proposition 5 is that either maxs ∑i |((W 0 W )−1 W 0 )si | is bounded
or, else, Ui = 0 for all i. This assumption ensures that the estimation error in X
                                                                                 b s that arises from
having to back out the sector-level shocks Zs from the controls Zi is not too large. If the sectors are
concentrated, then ((W 0 W )−1 W 0 )si = I{s(i ) = s}/ns , so that maxs ∑i |((W 0 W )−1 W 0 )si | = 1, and the
assumption always holds.
                                  b β0 ( β̂) and se
    Although both standard errors se             b ( β̂) are consistent (and one could further show that
the resulting confidence intervals are asymptotically equivalent), they will in general differ in finite
samples. In particular, it can be seen from the formula in Remark 6 that the confidence interval with
the null imposed is not symmetric around β̂, but its center is shifted by A.23 As we show in Section 5,
this recentering tends to improve the finite-sample coverage properties of the confidence interval. On
the other hand, the confidence interval tends to be longer on average than that in Remark 5.

4.2.1   Discussion of assumptions

The role that controls play in our framework is twofold. First, the k-th element of the vector Zi may
proxy for the impact on region i of an unobserved sectoral shock (Z1k , . . . , ZSk ). In the context of the
model in Section 3, regional labor market outcomes are not only affected by the sectoral shifters of
interest (χ1 , . . . , χS ), but also by other sectoral shocks accounted for by the composites (µ1 , . . . , µS ),
as illustrated in eq. (4). When the regression of Yi on Xi does not include a vector of controls Zi ,
consistent estimation of β requires assuming that the vector of sectoral shocks of interest (χ1 , . . . , χS )
is independent of all other sectoral shocks (µ1 , . . . , µS ). On the other hand, if we control for the
impact of the sectoral shocks (µ1 , . . . , µS ) on regional labor market outcomes through a regional
control Zi = ∑Ss=1 wis µs , then the OLS estimator β̂ will be consistent even if (µ1 , . . . , µS ) are not
independent of the sectoral shocks of interest (χ1 , . . . , χS ).
    Second, each element of the vector Zi may proxy for regional shocks that, although independent
of the sectoral shocks of interest Xs , have an effect on the outcome variable and, thus, enter the
regression residual ei in eq. (12). Controlling for these shocks is not necessary for the consistency
of β̂, but including them increases its precision. An example of such a shock in the context of the
model in Section 3 is the region-specific labor supply shifter vi , as long as {vi }iN=1 are independent of
the shocks of interest {Xs }Ss=1 . If this independence condition does not hold, then it is important to
control for these labor supply shocks in order to ensure consistency of β̂.
    Even if all other sectoral shocks are independent of the shifters of interest, including controls that
proxy for them in the regression will reduce the correlation between residuals of regions with simi-
  23 This is analogous to the differences in likelihood models between confidence intervals based on the Lagrange multiplier

test (which imposes the null and is not symmetric around the maximum likelihood estimate) and the Wald test (which does
not impose the null and yields the usual confidence interval).


                                                            21
lar shares, and it may therefore attenuate the overrejection problem of traditional inference methods
documented in Section 2. In the limit, if the controls soak up all sectoral shocks, so that the residuals
ei are independent across i, the usual heteroscedasticity-robust confidence intervals will give correct
coverage, and our confidence intervals will be asymptotically equivalent to them. However, since our
inference methods are valid whether or not there is shift-share structure in the residuals, we recom-
mend that researchers always use them, in line with the practice of always clustering the standard
errors if the regressor of interest only varies at a group level.


4.3     Extensions

We now discuss two extensions of the basic setup: first, we weaken the assumption that (X1 , . . . , Xs )
are independent across s. Second, we consider using the shift-share regressor Xi as an instrument.


4.3.1    Clusters of sectors

Suppose that the sectors can be grouped into larger units, which we refer to as “clusters”, with
c(s) ∈ {1, . . . , C } denoting the cluster that sector s belongs to; e.g., s may be a four-digit industry code,
while c(s) is a three-digit code. With this structure, we replace here the assumption that the shocks Xs
are independent across sectors (Assumption 1(ii) in Appendix B.1 for the case without controls, and
Assumption 4(ii) for the general case) with the assumption that, conditional on Z and W, the shocks
Xs and Xk are independent if c(s) 6= c(k ) (for the case without controls, we just take Z to be a vector
of ones). Also, we replace the assumption that the largest sector makes an asymptotically negligible
contribution to the asymptotic variance (Assumption 2(ii) in Appendix B) with the assumption that,
as C → ∞, the largest cluster makes an asymptotically negligible contribution to the asymptotic
variance; i.e. maxc ñ2c / ∑Cd=1 ñ2d → 0, where ñc = ∑Ss=1 I{c(s) = c}ns is the total share of cluster c.
   Under this setup, by generalizing the arguments in Section 4.2, one can show that, as C → ∞,
                                                                                              !
                                        N                                      VN
                                 q                   ( β̂ − β) = N 0,                    2       + o p (1),
                                                                           1
                                      ∑Cc=1   ñ2c                         N   ∑i Ẍi2

and, assuming that β is = β, the term VN is now given by

               ∑Cc=1 ∑s,t I{c(s) = c(t) = c} E[X̃s X̃t | W, Z ] Rs Rt                                 N
        VN =
                                     ∑Cc=1 ñ2c
                                                                      ,                       Rs =   ∑ wis ei ,       X̃s = Xs − Zs0 γ.
                                                                                                     i =1


In other words, instead of treating X̃s Rs as independent across s, the asymptotic variance formula
clusters them. As a result, we replace the standard error estimate in eq. (25) with
                                 q
                                     ∑Cc=1 ∑s,t I{c(s) = c(t) = c}X
                                                                  b s R̂s X
                                                                          b t R̂t                               N
                     b ( β̂) =
                     se
                                                         ∑iN=1 Ẍi2
                                                                                              ,        R̂s =   ∑ wis êi ,                (29)
                                                                                                               i =1


with X
     b s defined as in Remark 5. Confidence intervals with the null imposed can be constructed as in
Remark 6, replacing êi with êβ0 ,i in the formula in eq. (29), and using this formula instead of that in

                                                                      22
eq. (26).


4.3.2   Instrumental variables regression

Consider the problem of estimating the effect of a regional treatment variable Y2i on an outcome
variable Y1i using a shift-share regressor Xi = ∑s wis Xs as an instrument. We maintain the assumption
that there is a K-vector of latent sectoral controls Zs such that the regression specification includes a
vector regional controls Zi that have the structure in eq. (20) and such that eq. (22) holds.
    We assume that the effect of Y2i onto Y1i is linear and constant across regions, so that the potential
outcome when Y2i is exogenously set to y2 is given by

                                                  Yi1 (y2 ) = Yi1 (0) + y2 α,

where α is the treatment effect of Y2i on Y1i for every region i. The observed outcome is thus Y1i =
Y1i (Y2i ). In analogy with eq. (9), we denote the region-i treatment level that would occur if the region
received shocks (x1 , . . . , xS ) as

                                                                           S
                                        Y2i (x1 , . . . , xS ) = Y2i (0) + ∑ wis xs β FS .                   (30)
                                                                          i =1


The observed treatment level is Y2i = Y2i (X1 , . . . , XS ). For simplicity, we assume that β FS does not
vary across sectors or regions. Finally, we assume that, conditional on Z, the shocks X are as good
as randomly assigned and satisfy the exclusion restriction, so that the following restriction holds:

                                             (U, Y1 (0), Y2 (0)) ⊥
                                                                 ⊥ X | Z, W.                                 (31)

This restriction allows Y1i (0) and Y2i (0) to be correlated; thus, the observed treatment level Y2i may
be correlated with the potential outcomes (i.e. endogenous), even conditional on the controls Zi .
    Both the reduced-form regression of Yi1 onto Xi and Zi and the first-stage regression of Y2i onto
Xi and Zi fit into the setup of Section 4.2. Thus, by generalizing the arguments in Section 4.2, we can
derive the joint asymptotic distribution of the reduced-form and first-stage coefficients on Xi :

                                          ∑iN=1 Ẍi Y1i                            ∑iN=1 Ẍi Y2i
                                β̂ RF =                        and       β̂ FS =                 .
                                           ∑iN=1 Ẍi2                               ∑iN=1 Ẍi2

Since the IV estimate of α is given by

                                                          ∑iN=1 Ẍi Y1i  β̂
                                                  α̂ =      N
                                                                        = RF ,                               (32)
                                                          ∑i=1 Ẍi Y2i   β̂ FS

we can obtain the asymptotic distribution of α̂ by the delta method. To state the result, we define
the reduced-form and first-stage regression errors, e1i = Y1i − Zi0 δRF − Xi β RF and e2i = Y2i − Zi0 δFS −
Xi β FS , where δRF = E[ Z 0 Z ]−1 E[ Z 0 (Y1 − Xβ RF )] and δFS = E[ Z 0 Z ]−1 E[ Z 0 (Y2 − Xβ FS )], and it thus
follows from eq. (31) that the population reduced-form coefficient on Xi is given by β RF = β FS α.


                                                                23
Then, as long as β FS 6= 0, so that the shift-share instrument is relevant, it holds
                                                                                          
            N
                                             1
                                          ∑Ss=1   n2s
                                                        ∑Ss=1 var(X̃s | Z, W ) R2s                                         N
      q               (α̂ − α) = N 0,
                                                         ( N1 ∑i Ẍi2 )2 β2FS
                                                                                            + o p (1),          Rs =     ∑ wis (e1i − e2i α).
          ∑Ss=1 n2s                                                                                                       i =1


This suggests the standard error estimate
                                        q                            q
                                             ∑Ss=1 X b s2 R̂2s           ∑Ss=1 X
                                                                               b s2 R̂2s                   N
                             b (α̂) =
                             se
                                        | β̂ FS | ∑iN=1 Ẍi2
                                                                 =
                                                                      |∑iN=1 Ẍi Y2i |
                                                                                           ,     R̂s =    ∑ wis ê∆,i ,                      (33)
                                                                                                          i =1

     b s constructed as in Remark 5, and ê∆ = Y1 − Y2 α̂ − Z 0 ( Z 0 Z )−1 Z 0 (Y1 − Y2 α̂) corresponds to the
with X
estimate of the residual in the structural equation, e1i − e2i α.24 The difference between the IV standard
error formula in eq. (33) and the OLS version in eq. (25) is analogous to the difference between IV
and OLS heteroscedasticity-robust standard errors: êi is replaced in the numerator by the estimate
of the structural residual ê∆,i , and the denominator is scaled by the first-stage coefficient. The IV
analog of the standard error estimate with the null H0 : α = α0 imposed estimates the residual as ( I −
Z 0 ( Z 0 Z )−1 Z 0 )(Y1 − Y2 α0 ), and the resulting confidence interval is a generalization of the Anderson
and Rubin (1949) confidence interval (which assumes that the structural errors are independent). As
a result, this confidence interval will remain valid even if the shift-share instrument is weak.
      Faced with the problem of estimating the treatment effect α in a setting in which the instrument
has a shift-share structure, our approach to identification follows Borusyak, Hull and Jaravel (2018),
who impose an assumption analogous to that in eq. (31), and also discuss the extension to a setting
in which β FS is allowed to vary across sectors and regions and α is allowed to vary across regions. In
contrast, Goldsmith-Pinkham, Sorkin and Swift (2018) consider replacing the shift-share instrument
Xi with the full vector of shares (wi1 , . . . , wiS ). Importantly, there are settings in which Xi satisfies the
exclusion restriction but the full vector (wi1 , . . . , wiS ) does not, and is thus not a valid instrument.25
Intuitively, this is the case when the residual in the structural equation e∆ has a shift-share structure.
Our independence restriction in eq. (31) allows for this possibility and, consequently, we adopt the
approach that has been standard since Bartik (1991) and use the shift-share Xi as an instrument.


5      Performance of new methods: placebo evidence
In Section 5.1, we revisit the placebo exercise in Section 2 to illustrate the finite-sample properties of
the standard error estimators introduced in Section 4. In Sections 5.2 to 5.4, we consider several exten-
sions to illustrate the sensitivity of our standard errors to assumptions underlying their validity and
to show that the overrejection problem affecting commonly used inference procedures is persistent.
    24 Sincethe IV regression uses a single constructed instrument, ê∆ is numerically equivalent to ê1i − ê2i α̂, where ê1 and
ê2 are the reduced-form and first-stage residuals.
   25 For an online discussion by Tim Bartik on this point, see https://blogs.worldbank.org/impactevaluations/

comment/5042#comment-5042. See also Borusyak, Hull and Jaravel (2018) for a discussion of different identification as-
sumptions in this setting.




                                                                          24
        Table 2: Median standard errors and rejection rates for H0 : β = 0 at 5% significance level.

                                                              Estimate            Median eff. s.e.           Rejection rate
                                                        Mean        Std. dev      AKM         AKM0        AKM           AKM0
       Panel A: Change in the share of working-age population
       Employed                         −0.01    2.00     1.90                                 2.21        7.9%          4.8%
       Employed in manufacturing        −0.01    1.88     1.77                                 2.05        8.3%          4.7%
       Employed in non-manufacturing      0.01   0.94     0.89                                 1.03        8.5%          4.8%
       Panel B: Change in average log weekly wage
       Employed                         −0.02   2.68                               2.57        2.99        8.3%          5.1%
       Employed in manufacturing        −0.03   2.93                               2.75        3.18        9.0%          4.6%
       Employed in non-manufacturing −0.02      2.65                               2.55        2.96        8.3%          5.1%
          Notes: For the outcome variable indicated in the first column, this table indicates the median effective standard error
          (Median eff. s.e.) across the simulated datasets, and the percentage of datasets for which we reject the null hypothesis
          H0 : β = 0 using a 5% significance level test. AKM is the standard error in Remark 5; and AKM0 is the confidence
          interval in Remark 6. 30,000 simulation draws.



5.1    Baseline specification

We first consider the performance of the standard error estimator in eq. (25) (which we label AKM),
and the standard error and confidence interval in eqs. (26) and (27) (with label AKM0), in the baseline
placebo samples described in Section 2. As these samples include no controls, we fix the matrix Z to
be a column of ones when implementing the formulas in eqs. (25) and (27).
      For the AKM and AKM0 inference procedures, Table 2 presents the median length of the standard
errors and rejection rates for 5% significance level tests of the null hypothesis H0 : β = 0. In the case of
AKM0, since the standard error depends on the null being tested, the table reports the median across
the placebo samples of the “effective standard error”, defined as the length of the 95% confidence
interval divided by 2 × 1.96. For AKM, the “effective standard error” is the actual standard error.
      The table shows that our proposed methods perform well. The median standard error based on
AKM is slightly lower than the true standard deviation of the estimator β̂, by about 5% on average
across all outcomes. The median effective standard error of AKM0 is slightly larger than the standard
deviation of β̂, by about 10% on average.26 The implied rejection rates are close to the 5% nominal
rate: the AKM procedure has a rejection rate that is between 7.9% and 9% and the AKM0 procedure
has a rejection rate that is always between 4.6% and 5.1%.
      As discussed in Section 4.2, AKM and AKM0 are asymptotically equivalent. The differences in
rejection rates between AKM and AKM0 in Table 2 are thus due to differences in finite-sample per-
formance. It has been noted in other contexts (see Lazarus et al., 2018) that confidence intervals that
impose the null can lead to improved finite-sample size control relative to the usual confidence inter-
vals that do not do so. The better size control of the AKM0 procedure is consistent with these results.
Intuitively, imposing the null reduces the estimation noise in the estimated regression residuals and,
consequently, helps reduce the finite-sample bias that arises in estimating the asymptotic variance.
 26 For
      the placebo exercise that uses the change in the employment rate as outcome variable, Figure D.2 in Online
Appendix D.2 presents histograms representing the empirical distribution of the effective standard errors.



                                                                    25
5.2     Alternative number of sectors and correlated sectoral shocks

As discussed in Section 4, the inference procedures described in Remarks 5 and 6 generate tests and
confidence intervals that are valid in large samples if: (a) the number of sectors goes to infinity; (b)
all sectors are asymptotically “small”; and (c) the sectoral shocks are independent across sectors. On
the other hand, the inference procedures remain valid under (d) heteroscedastic sectoral shocks, and
(e) arbitrary correlation structure of the residuals ei across regions. We test how sensitive different
inference procedures are to assumptions (a) and (b) in panels A and B, respectively, of Table 3. Panels
C and D demonstrate the robustness of AKM and AKM0 to (d) and (e). We investigate robustness
to violations of assumption (c) in Table 4. In all these tables, we focus on the change in the share of
working-age population employed as the outcome variable of interest.
      In Panel A of Table 3, we change the baseline placebo specification described in Section 2 by
changing the definition of sector. The results show that the overrejection problem affecting standard
inference procedures is worse when the number of sectors decreases: the rejection rates for Robust
and St-cluster standard errors reach 70.8% and 57%, respectively, when the 396 4-digit SIC sectors are
substituted by the 20 2-digit SIC sectors in the analysis. In line with the findings in the literature on
clustering with a few clusters, the rejection rates for AKM also increase to 13.1%, but those for AKM0
remain very close to the nominal 5% significance level.
      In Panel B, we modify the baseline placebo setup in that we set the variance of the shock assigned
to the non-manufacturing sector to a positive number; specifically, we set its variance to 5, the same as
for the remaining sectoral shocks. All methods perform poorly in this case. The reason is that, across
the CZs in our analysis, the non-manufacturing sector accounts on average for 77.5% of employment,
with a minimum employment share of 38%. This demonstrates that it is important in practice for all
sectors included in the analysis to be small.
      Panel C investigates the robustness of our results to heteroscedasticity in the sector-level shocks.
Specifically, we set the variances σs2 = var(Xs | W ) by taking draws from a uniform distribution with
support [2, 7]. Thus, the mean variance of the sector-level shocks is equal to 5, as in the baseline
placebo, but it now varies across sectors. We then simulate repeated samples of sector-level shocks
where, in each simulation draw m, we take independent draws Xsm from a normal distribution with
zero mean and the randomly drawn variance σs2 , which is held constant across all placebo samples.
Comparing the results for Robust and St-cluster to those in the first row of Table 1, and those for AKM
and AKM0 to those in the first row of Table 2, we observe that allowing for heteroscedasticity in the
sector-level shocks does not affect our main results.
      Finally, in panel D, we explore the impact of having the residuals of CZs that belong to the same
state to be correlated for reasons other than their employment sectoral composition. Specifically, for
each of the 30,000 placebo samples we build, we generate a random variable ηk for each state k,
imposing the distribution ηk ∼ N (0, 6). We then modify the outcomes Yi by adding the random draw
ηk(i) to the actual change in employment rate, where k(i ) denotes the state that CZ i belongs to. Since
St-cluster now captures part of the correlation structure in the residuals, the overrejection problem is
less severe: it goes down from 38.3% to 30.1%. Importantly, as the validity of the inference procedures
AKM and AKM0 does not rely on any assumptions about the correlation structure of the residuals,


                                                     26
Table 3: Rejection rate of H0 : β = 0 at 5% significance level: sensitivity to departures from baseline
specification

                                                Robust        St-cluster          AKM          AKM0
                      Panel A: Different sectoral aggregation
                      2-digit (S = 20)   70.8%      57.0%                         13.1%           5.4%
                      3-digit (S = 136) 54.6%       42.7%                          7.8%           4.8%
                      4-digit (S = 398) 48.6%       37.7%                          7.8%           4.5%
                      Panel B: Simulated non-manufacturing shocks
                                        92.0%   89.5%       77.5%                               76.7%
                      Panel C: Heteroskedastic sector-level shocks
                                        48.4%      37.4%        7.4%                              4.9%
                      Panel D: Simulated state-level shocks
                                       42.6%       30.1%                          7.6%            4.6%
                        Notes: All estimates in this table use the total employment share in each CZ
                        as the outcome variable Yi . The first row indicates the inference procedure
                        employed to compute the share of the 30,000 simulated datasets for which
                        we reject the null hypothesis H0 : β = 0 using a 5% significance level. Robust
                        is the Eicker-Huber-White standard error; St-cluster is the standard error that
                        clusters CZs in the same state; AKM is the standard error in Remark 5; AKM0
                        is the test in Remark 6.



their rejection rates are not affected.
   Table 4 reports the results of a placebo exercise in which we account for shifters that are correlated
across sectors. Specifically, instead of assuming that the sectoral shocks Xsm are independent across
s, we draw the random vector (X1m , . . . , XSm−1 ) from the distribution

                                            (X1m , . . . , XSm−1 ) ∼ N (0, Σ) ,                           (34)

where Σ is a (S − 1) × (S − 1) covariance matrix with Σsk = (1 − ρ)σ I{s = k } + ρσ I{c(s) = c(k )}
and, for every s, c(s) indicates the “cluster” that industry s belongs to. In panels A, B, and C, these
clusters correspond to the 3-, 2-, and 1-digit SIC sector that industry s belongs to, respectively. As in
the baseline, we set the shock for the non-manufacturing sector to zero, XS = 0.
   Panel A of Table 4 shows that introducing correlation within 3-digit SIC sectors has a moderate
effect on the rejection rates of both the traditional methods and the version of the AKM and AKM0
methods that assume that the sectoral shocks are independent (described in Remarks 5 and 6). For
all values of the correlation within 3-digit sectors, rejection rates close to 5% are obtained with the
versions of AKM and AKM0 that allow for arbitrary shock correlation within 2- and 3-digit aggregate
sectors (described in Section 4.3.1). As shown in Panel B, the overrejection problem affecting both tra-
ditional inference procedures and the version of our novel procedures that assumes independence of
sectoral shocks is more severe when these sectoral shocks are correlated at the 2-digit level. However,
the last two columns of Table 4 show that, in this case, the versions of AKM and AKM0 that allow for
correlation in sectoral shocks at the 2-digit level perform very well, achieving a rejection rate close
to 5%. Finally, Panel C shows that the overrejection problem is much more severe in the presence of


                                                             27
        Table 4: Rejection rate of H0 : β = 0 at 5% significance level: correlation in sectoral shocks

  Sector Cluster:                                       Independent                 3-digit SIC                  2-digit SIC
                        Robust       St-cluster        AKM         AKM0          AKM          AKM0          AKM            AKM0
  Panel A: Simulated shocks with correlation within 3-digit SIC sectors
  ρ = 0.25        47.2%     30.4%      5.6%     6.0%     4.5%      4.8%                                      4.8%           5.0%
  ρ = 0.50        49.2%     32.4%      6.8%     7.7%     4.4%      4.8%                                      4.6%           .05%
  ρ = 0.75        51.0%     33.8%      8.1%     9.0%     4.5%      4.9%                                      4.7%           5.2%
  ρ = 1.00        52.6%     35.6%      9.5%    10.6%     4.5%      4.9%                                      4.9%           5.2%
  Panel B: Simulated shocks with correlation within 2-digit SIC sectors
  ρ = 0.25        56.6%     38.8%     14.1%     16.0%    12.3%     14.0%                                     5.3%           5.3%
  ρ = 0.50        62.0%     43.0%     22.2%     25.0%    17.9%     20.6%                                     5.8%           5.3%
  ρ = 0.75        66.4%     46.9%     28.8%     32.5%    22.2%     25.8%                                     6.2%           5.4%
  ρ = 1.00        68.6%     48.0%     33.3%     37.0%    24.9%     28.9%                                     6.6%           5.5%
  Panel C: Simulated shocks with correlation within 1-digit SIC sectors
  ρ = 0.25        78.5%     65.5%     47.9%    52.0%     46.0%     51.0%                                    35.4%           43.3%
  ρ = 0.50        84.5%     73.0%     63.7%    67.3%     60.8%     65.6%                                    45.0%           54.6%
  ρ = 0.75        87.8%     76.6%     73.2%    75.9%     69.8%     73.9%                                    51.3%           61.1%
  ρ = 1.00        90.0%     78.4%     81.0%    83.3%     76.8%     80.6%                                    55.5%           66.1%
   Notes: All estimates in this table use the total employment share in each CZ as the outcome variable Yi . The second row indicates
   the inference procedure employed to compute the share of the 30,000 simulated datasets for which we reject the null hypothesis
   H0 : β = 0 using a 5% significance level. The first row indicates the clustering of sector-level shocks in AKM and AKM0. Robust
   is the Eicker-Huber-White standard error; St-cluster is the standard error that clusters CZs in the same state; AKM is the standard
   error in Remark 5 for independent shocks and in eq. (29) for clustering; AKM0 is the test in Remark 6 for independent shocks and
   in the last sentence of Section 4.3.1 for clustering.



high correlation in sector-level shocks within the two 1-digit level aggregate sectors.
      We summarize the conclusions from Tables 3 and 4 in the following remark.

Remark 7. In shift-share regressions, overrejection of typical standard error formulas is more severe when there
is a small number of large sectors. In this case, the methods we provide significantly attenuate the overrejection
problem, but may still overreject relative to the nominal significance level when the number of sectors is very
small. Our methods perform well when the residuals have a state-level component and when the shocks are
heteroscedastic. When the shifters are not independent across sectors, it is important to allow for clustering of
the shifters at the appropriate level.


5.3     Confounding sector-level shocks: omitted variable bias and solutions

In Online Appendix D.1, we investigate the consequences of violations of the assumption that the
shifters (X1 , . . . , XS ) are independent of other sectoral shocks affecting the outcome variable of in-
terest. We also consider the properties of two solutions to this problem: (i) the inclusion of regional
controls as a proxy for sector-level unobserved shocks (discussed theoretically in Section 4.2), and
(ii) the use of a shift-share instrumental variable constructed as a weighted average of exogenous
sector-level shocks (discussed theoretically in Section 4.3.2).
      Our simulations illustrate that confounding sector-level shocks introduce bias in the OLS estimator


                                                                  28
of the coefficient on the shift-share regressor of interest. In such cases, as discussed in Section 4.2,
region-level controls eliminate the bias only if they are a perfect proxy for the sector-level confounding
shock. Otherwise, an IV approach is needed. Our results also illustrate that, even when the estimator
β̂ is consistent, traditional inference methods suffer from a severe overrejection problem and yield
confidence intervals that are too small; in contrast, the inference procedures we propose yield the
correct test size and confidence intervals with the right coverage.


5.4     Other extensions

Online Appendix D.2 explores how sensitive our results are to alternative definitions of the units at
which the outcome variable and the shifters are measured. When using counties (instead of CZs) as
the regional unit of analysis, Table D.3 shows that rejection rates are very similar to those in Tables 1
and 2. Table D.4 reports the results of a placebo exercise based on a shift-share covariate with shifters
that vary at the occupation level, using occupation employment shares in 1990 and randomly drawn
shifters for 331 occupations. In this case, the overrejection problem of traditional methods is even
more severe. AKM attenuates the problem, but still yields rejections rates higher than the nominal
significance level. In contrast, AKM0 yields the correct test size.


6     Empirical applications
We now apply our inference procedures to three empirical applications. First, the study of the effect of
Chinese competition on local labor market in Autor, Dorn and Hanson (2013). Second, the estimation
of the elasticity of labor supply in Bartik (1991). Finally, the estimation of the impact of immigration
on employment and wages across occupations and regional markets in the United States, as in the
literature reviewed by Lewis and Peri (2015) and Dustmann, Schönberg and Stuhler (2016).


6.1     Effect of Chinese exports on U.S. labor market outcomes

Autor, Dorn and Hanson (2013), henceforth referred to as ADH, explore the impact of exports from
China on labor market outcomes across U.S. Commuting Zones. Specifically, they present IV esti-
mates based on eq. (32), where Yi1 is the ten-year equivalent change in a labor-market outcome in
CZ i in either 1990–2000 or 2000–2007, wis is the CZ i employment share in the 4-digit SIC sector s
in the initial year of the corresponding period (either 1990 or 2000), Yi2 is a weighted average of the
change in sectoral U.S. imports from China normalized by U.S. total employment in the correspond-
ing sector, and Xi is analogous to Yi2 with the only difference that, instead of using U.S. imports from
China as shifters, it uses imports from China by other high-income countries. We use the data sources
described in Section 2.1 and we include in all regression specifications the largest set of controls Zi
included in ADH; see, e.g., column (6) of Table 3 in ADH.
      Table 5 reports 95% CIs computed using different methodologies for the specifications in Tables 5
to 7 in ADH. Panels A, B, and C present the IV, reduced-form and first-stage estimates, respectively.
These correspond to α̂, β̂ RF and β̂ FS , respectively, in the notation introduced in Section 4.3.2.



                                                     29
    Table 5: Effect of Chinese exports on U.S. commuting zones—Autor, Dorn and Hanson (2013)

                    Change in the employment share                                    Change in avg. log weekly wage
                     All                Manuf.          Non-Manuf.                   All              Manuf.             Non-Manuf.
Panel A: 2SLS Regression
β̂             −0.77          −0.60                         −0.18                −0.76                 0.15                 −0.76
Robust     [−1.10, −0.45] [−0.78, −0.41]                 [−0.47, 0.12]       [−1.23, −0.29]        [−0.81, 1.11]        [−1.27, −0.25]
St-cluster [−1.12, −0.42] [−0.79, −0.40]                 [−0.45, 0.10]       [−1.26, −0.26]        [−0.81, 1.11]        [−1.28, −0.24]
AKM        [−1.25, −0.29] [−0.85, −0.35]                 [−0.54, 0.18]       [−1.36, −0.16]        [−0.80, 1.10]        [−1.41, −0.12]
AKM0       [−1.72, −0.39] [−1.02, −0.36]                 [−0.85, 0.13]       [−1.76, −0.19]        [−1.49, 1.03]        [−1.97, −0.21]
Panel B: OLS Reduced-Form Regression
β̂             −0.49          −0.38         −0.11                                −0.48                 0.10                 −0.48
Robust     [−0.71, −0.27] [−0.48, −0.28] [−0.31, 0.08]                       [−0.80, −0.16]        [−0.50, 0.69]        [−0.83, −0.13]
St-cluster [−0.64, −0.34] [−0.45, −0.30] [−0.27, 0.05]                       [−0.78, −0.18]        [−0.51, 0.70]        [−0.81, −0.15]
AKM        [−0.81, −0.16] [−0.52, −0.23] [−0.35, 0.13]                       [−0.87, −0.09]        [−0.50, 0.69]        [−0.92, −0.04]
AKM0       [−1.25, −0.24] [−0.68, −0.25] [−0.64, 0.08]                       [−1.26, −0.12]        [−1.15, 0.60]        [−1.46, −0.13]
Panel C: 2SLS First-Stage
β̂                                                                        0.63
Robust                                                                [0.46, 0.80]
St-cluster                                                            [0.45, 0.81]
AKM                                                                   [0.53, 0.73]
AKM0                                                                  [0.54, 0.84]
Notes: N = 1, 444 (722 CZs × 2 time periods). Observations are weighted by the start of period CZ share of national population. All
regressions include the full vector of baseline controls in ADH. 95% confidence intervals are reported in square brackets. Robust is the
Eicker-Huber-White standard error; St-cluster is the standard error that clusters of CZs in the same state; AKM is the standard error in
eq. (29) with 3-digit SIC clusters; AKM0 is the confidence interval with 3-digit SIC clusters described in the last sentence of Section 4.3.1.



    In all panels, state-clustered CIs are very similar to the heteroskedasticity-robust ones. This sug-
gests that there is not much correlation in residuals within states. In contrast, our proposed confi-
dence intervals are wider than those implied by state-clustered standard errors. For the IV estimates
reported in Panel A, the average increase across all outcomes in the length of the 95% CI is 23% with
the AKM procedure and 66% with the AKM0 procedure. When the outcome variable is the change in
the manufacturing employment rate, the length of the 95% CI increases by 27% with the AKM proce-
dure and by 68% with the AKM0 procedure.27 In light of the lack of impact of state-clustering on the
95% CI, the wider intervals implied by our inference procedures indicate that cross-region residual
correlation is driven by similarity in sectoral compositions rather than by geographic proximity.
    Panel B of Table 5 reports CIs for the reduced-form specification. In this case, the increase in the
CI length is slightly larger: across outcomes, it increases on average by 53% for AKM and 130% for
AKM0. The smaller relative increase in the CI length for the IV estimate α̂ relative to its increase for
the reduced-form estimate β̂ RF is a consequence of the fact that all inference procedures yield very
  27 The AKM and AKM0 estimates reported in Table 5 account for correlation in the shifters across periods and across

4-digit SIC sectors included in the same 3-digit SIC sector. Table E.2 in Online Appendix E.1 shows that similar increases
in the length of the 95% CIs are implied by AKM and AKM0 when we assume that sectoral shifters are: (a) independent
across 4-digit SIC sectors and periods; (b) independent across 4-digit SIC sectors but possibly correlated across periods.



                                                                     30
similar CIs for the first-stage estimate β̂ FS , as reported in Panel C.
      As discussed in Section 5, the differences between the AKM (or the AKM0) CIs and state-clustered
CIs are related to the importance of shift-share components in the regression residual. The results
in Panel C suggest that, once we account for changes in sectoral imports from China to other high-
income countries, there is not much sectoral variation left in the first-stage regression residual; i.e.,
there are no other sectoral variables that are important to explain the changes in sectoral imports from
China to the U.S.28 To investigate this claim, Table E.3 in Online Appendix E.1 reports the rejection
rates implied by a placebo exercise analogous to that described Section 5 when the outcome variable
in the placebo exercise is the same as that in the first-stage specification reported in Panel C of Table 5.
Panel A in Table E.3 shows that, when no controls are included, traditional methods still suffer from
severe overrejection problems and our methods yield the correct test size. However, as shown in
Panels B and C in Table E.3, the problem is greatly attenuated when controlling for the instrumental
variable and other controls used in ADH. This indicates that the instrumental variable and additional
controls included in ADH soak most of the cross-CZ correlation in the ADH treatment variable.
      Overall, Table 5 shows that, despite the wider confidence intervals obtained with our procedures,
the qualitative conclusions in ADH with respect to the effect of U.S. imports from China on CZs labor
market outcomes remain valid at usual significance levels. However, the increase in the length of
the 95% confidence interval indicates that there is more uncertainty regarding the magnitude of the
impact of Chinese import exposure on U.S. labor markets. In particular, the AKM0 confidence interval
is much wider than that based on state-clustered standard errors; furthermore, it is asymmetric
around the point estimate, indicating that the negative impact of the China shock could have been
two to three times larger than the effect implied by the point estimates.29


6.2     Estimation of labor supply elasticity

In our second application, we estimate the labor supply elasticity φ using the following estimating
equation:
                                            ∆ log Ei = φ∆ log ωi + Zi δ + ei ,                                              (35)

where ∆ log Ei denotes changes in the employment rate in CZ i, ∆ log ωi denotes changes in nominal
wages in i, Zi is the same vector of controls used in Section 6.1 (i.e. the vector of controls listed in
column (6) of Table 3 of ADH), and ei is the regression residual. We use the data sources described
in Section 2.1 to measure the outcome, covariate and controls in eq. (35).
      As illustrated through the model in Section 3, the residual ei accounts for changes in local supply
shocks, ∆ log νi , not controlled for by the vector Zi . These unobserved supply shocks will impact
changes in both local average wages and employment rates; thus, ∆ log ωi and ei will be correlated
  28 Intuitively, this is similar to what we would observe in a regression in which the regressor of interest varies at the state

level, and we control for all state-specific covariates affecting the outcome variable: state-clustered standard errors would
be similar to heteroskedasticity-robust standard errors, since there is no within-state correlation left in the residuals.
  29 It follows from Remark 6 (see the expression for the quantity A) that the asymmetry comes from the correlation between

the regression residuals R̂s and the shifters cubed. In large samples, this correlation is zero and the AKM and AM0 CIs are
asymptotically equivalent. The differences between CIs in Table 5 thus reflect differences in their finite-sample properties.
This notwithstanding, the placebo exercise presented in Section 5 shows that both inference procedures yield close to
correct rejection rates in a sample with the same number of regions and sectors as used in ADH.


                                                               31
                                    Table 6: Estimation of labor supply elasticity

                                               First-Stage              Reduced-Form                    2SLS
                                                ∆ log ωi                   ∆ log Ei                    ∆ log Ei
                    Panel A: Bartik IV
                                        29.66                                33.85                       1.14
                        Robust      [20.31, 39.01]                       [24.00, 43.70]              [0.90, 1.38]
                        St-cluster  [17.62, 41.71]                       [20.70, 47.00]              [0.84, 1.44]
                        AKM         [20.50, 38.83]                       [22.75, 44.96]              [0.86, 1.42]
                        AKM0        [17.02, 38.73]                       [21.33, 47.29]              [0.89, 1.71]
                    Panel B: ADH IV
                                        −0.48                               −0.72                        1.49
                      Robust       [−0.80, −0.16]                       [−1.04, −0.39]               [0.79, 2.19]
                      St-cluster   [−0.78, −0.18]                       [−0.93, −0.50]               [0.78, 2.21]
                      AKM          [−0.87, −0.09]                       [−1.19, −0.24]               [0.63, 2.35]
                      AKM0         [−1.26, −0.12]                       [−1.85, −0.35]               [0.89, 4.85]
                      Notes: N = 1, 444 (722 CZs × 2 time periods). Observations are weighted by the start of
                      period CZ share of national population. All regressions include the full vector of baseline
                      controls in ADH. 95% confidence intervals in square brackets. Robust is the Eicker-Huber-
                      White standard error; St-cluster is the standard error that clusters of CZs in the same state;
                      AKM is the standard error in eq. (29) with 3-digit SIC clusters; AKM0 is the confidence
                      interval with 3-digit SIC clusters described in the last sentence of Section 4.3.1.



and the OLS estimator of φ in eq. (35) will generally be biased. To circumvent this problem, a popular
approach is the use of shift-share instrumental variables. In this section, we implement this strategy
with two different sector-level shifters: (i) the national employment growth, as in Bartik (1991); and
(ii) the increase in imports from China by a set of high-income countries that does not include the
United States, as in Autor, Dorn and Hanson (2013).30
    Table 6 presents first-stage, reduced-form and IV estimates associated to the estimation of the
parameter φ in eq. (35). Panels A and B report results using the Bartik (1991) instrumental variable
and the ADH instrumental variable, respectively. In both cases, the estimates of φ are similar: 1.14 in
Panel A and 1.49 in Panel B. In Panel A, our proposed CIs are wider than heteroskedasticity-robust
CIs, but tighter than state-clustered CIs. For Panel B, the AKM and AKM0 CIs are respectively 20%
and 250% wider than those obtained with state-clustered standard errors. As discussed in Section 6.1,
such differences are related to the shift-share component of the residuals. Our results suggest that the
shift-share IV that exploits national employment growth as shifter absorbs the bulk of this component,
leaving little correlation left for our inference procedures to correct. In contrast, the ADH shift-share
IV absorbs a lower fraction of the shift-share component of the residuals, implying that our procedure
has a larger impact on the length of the 95% confidence interval.
  30 For simplicity, in the case of Bartik (1991), we assume that the national employment growth itself is as good as randomly

assigned, instead of thinking of it as a proxy for a randomly assigned national-level shock. The latter would create
additional consistency and inference issues. See Goldsmith-Pinkham, Sorkin and Swift (2018) and Borusyak, Hull and
Jaravel (2018) for a discussion of some of these consistency issues; the discussion in Section 4.3.2 may be extended to
address the corresponding inference issues.




                                                                   32
                  Table 7: Effect of immigration on occupations and commuting zones

                                  Change in log                  Change in avg. log weekly wage
                              native employment             All workers High-Skill                  Low-Skill
                                          (1)                      (2)               (3)                 (4)
                Panel A: 2SLS Regression
                β̂              −0.74                          −0.07               0.14              −0.24
                Robust      [−1.05, −0.43]                  [−0.22, 0.09]      [0.00, 0.29]      [−0.42, −0.06]
                St-cluster  [−1.16, −0.31]                  [−0.34, 0.20]     [−0.06, 0.35]       [−0.52, 0.04]
                AKM         [−1.17, −0.31]                  [−0.38, 0.25]     [−0.13, 0.42]       [−0.60, 0.12]
                AKM0        [−1.49, −0.11]                  [−0.39, 0.71]     [−0.12, 0.88]       [−0.71, 0.45]
                Panel B: OLS Reduced-Form Regression
                β̂             −0.19          −0.02                               0.04               −0.06
                Robust     [−0.27, −0.11]  [−0.05, 0.02]                      [−0.00, 0.08]      [−0.10, −0.02]
                St-cluster [−0.33, −0.05]  [−0.08, 0.05]                      [−0.03, 0.10]      [−0.11, −0.01]
                AKM        [−0.37, −0.01]  [−0.09, 0.06]                      [−0.05, 0.12]       [−0.13, 0.01]
                AKM0       [−0.88, −0.02]  [−0.07, 0.39]                      [−0.02, 0.47]       [−0.12, 0.27]
                Panel C: 2SLS First-Stage
                β̂                                                    0.26
                Robust                                            [0.19, 0.32]
                St-cluster                                        [0.16, 0.36]
                AKM                                               [0.13, 0.38]
                AKM0                                              [0.13, 0.74]
                 Notes: N = 108, 300 (722 CZs × 50 occupations × 3 time periods). Models are weighted by start
                 of period occupation-region share of national population. All regressions include occupation and
                 period dummies. 95% confidence intervals in square brackets. Robust is the Eicker-Huber-White
                 standard error; St-cluster is the standard error that clusters of CZs in the same state; AKM is the
                 standard error in Remark 5; and AKM0 is the confidence interval in Remark 6.



6.3     Effect of immigration on U.S. local labor markets

As a third application, we estimate the impact of immigration on labor market outcomes across
occupations and regions in the United States. To this end, we estimate the following linear model

                                                                  0
                                         ∆Yoit = β∆ImmShareoit + Zoit δ + eoit ,                                       (36)

where, for occupation o of CZ i between year t and t − 10, ∆Yoit is the change in a labor market
outcome for native workers and ∆ImmShareoit is the change in the share of immigrants in total em-
ployment. In our application, Zoit is a control vector that includes occupation and period fixed effects.
      The OLS estimator of β in eq. (36) is likely to be inconsistent because the sorting decision of
immigrants across occupations and regions is likely driven by the same demand shocks affecting
the sorting decision of native workers. Since Card (2001), a large literature addresses these concerns
exploiting shift-share instruments built using data on changes in the national stock of immigrants
from different origin countries. Specifically, we use a version of this instrument that takes the form



                                                                33
                                                                   Imm j,t − Imm j,t−10
                                 ∆Xiot ≡    ∑ ImmShareoi1980,j         Imm j,1980
                                                                                        ,                               (37)
                                             j

where, for occupation o in CZ i, ImmShareoi1980,j is the share of immigrants of origin country j in total
employment in 1980, and Imm j,t is the total number of immigrants of origin j in the U.S. in year t.
      We build a dataset for 50 occupations, 722 U.S. CZs, 57 origin countries, and three periods.31 The
information on employment and average wages are from the Census Integrated Public Use Micro
Samples for 1970–2000 and the American Community Survey for 2008–2012. For each variable, we
construct separate measures for low-skilled workers, defined as those with at most a high school
diploma, and high-skilled workers, defined as those with at least one year of college.
      Table 7 reports the results. Column (1) indicates that an increase in the immigrant share is associ-
ated a decline in native employment across occupations and regions. For all inference methods, the
estimated effect is significant at 5%. However, our proposed methods yield wider confidence inter-
vals, which are as much as 123% wider than those obtained with commonly used inference methods.
Columns (2)–(4) indicate that, for wage outcomes, the increase in the length of confidence intervals is
even stronger: on average across these three columns, the AKM and AKM0 CIs are respectively 27%
and 119% wider than that obtained with state-clustered standard errors.32


7      Concluding remarks
This paper studies inference in shift-share designs. We show that standard economic models predict
that changes in regional outcomes depend on observed and unobserved sector-level shocks through
several shift-share covariates. Our model thus implies that the residual in shift-share regressions
is likely to be correlated across regions with similar sectoral composition, independently of their
geographic location, due to the presence of unobserved sectoral shifters affecting the outcome. Such a
correlation is ignored by inference procedures typically used in shift-share regressions, such as when
standard errors are clustered on geographic units. To illustrate the importance of this shortcoming,
we implement a placebo exercise in which we study the effect of randomly generated sector-level
shocks on actual changes in labor market outcomes across CZs in the United States. We find that
traditional inference procedures severely overreject the null hypothesis of no effect. We derive two
novel inference procedures that yield correct rejection rates.
      It has become standard practice to report cluster-robust standard errors in regression analysis
whenever the variable of interest varies at a more aggregate level than the unit of observation. This
practice guards against potential correlation in the residuals that arises whenever the residuals contain
unobserved shocks that also vary at the same level as the variable of interest. In the same way, we
recommend that researchers report confidence intervals in shift-share designs that allow for a shift-
share structure in the residuals, such as one of the two confidence intervals that we propose.

    31 See
         Appendix F of Burstein et al. (2018b) for a list of occupations and Table E.4 of Online Appendix E.2 for the list of
origin countries. We consider the periods 1980–1990, 1990–2000 and 2000–2012.
  32 Table E.5 in Online Appendix E.2 reports results of the estimation of eq. (36) with data aggregated at the CZ-level. In

this case, we obtain similar qualitative results, but confidence intervals are slightly wider.


                                                             34
References
Acemoglu, Daron and Joshua Linn, “Market Size in Innovation: Theory and Evidence from the
  Pharmaceutical Industry,” Quarterly Journal of Economics, 2004, 119 (3), 1049–1090.

      and Pascual Restrepo, “Robots and jobs: Evidence from US labor markets,” MIT mimeo, 2017.

      and    , “Demographics and Automation,” MIT mimeo, 2018.

Adão, Rodrigo, “Worker Heterogeneity, Wage Inequality, and International Trade: Theory and Evi-
  dence from Brazil,” University of Chicago mimeo, 2016.

  , Costas Arkolakis, and Federico Esposito, “Spatial linkages, Global Shocks, and Local Labor
  Markets: Theory and Evidence,” University of Chicago mimeo, 2018.

Aghion, Philippe, Antonin Bergeaud, Matthieu Lequien, and Marc J. Melitz, “The impact of exports
  on innovation: Theory and evidence,” Technical Report 2018.

Altonji, Joseph G and David Card, “The Effects of Immigration on the Labor Market Outcomes of
  Less-skilled Natives,” in “Immigration, Trade, and the Labor Market,” University of Chicago Press,
  1991, pp. 201–234.

Anderson, James E., “A Theoretical Foundation for the Gravity Equation,” The American Economic
  Review, 1979, 69 (1), 106–116.

      and Eric van Wincoop, “Gravity with Gravitas: A Solution to the Border Puzzle,” The American
  Economic Review, 2003, 93 (1), 170–192.

Anderson, Theodore W. and Herman Rubin, “Estimation of the Parameters of a Single Equation in a
  Complete System of Stochastic Equations,” The Annals of Mathematical Statistics, 1949, 20 (1), 46–63.

Arkolakis, Costas, Arnaud Costinot, and Andrés Rodríguez-Clare, “New Trade Models, Same Old
  Gains?,” American Economic Review, 2012, 102 (1), 94–130.

Armington, Paul S., “A Theory of Demand for Products Distinguished by Place of Production,” Staff
  Papers, 1969, 16 (1), 159–178.

Autor, David H. and David Dorn, “The Growth of Low-Skill Service Jobs and the Polarization of the
  US Labor Market,” American Economic Review, August 2013, 103 (5), 1553–97.

  ,     , and Gordon H. Hanson, “The China Syndrome: Local Labor Market Effects of Import Com-
  petition in the United States,” American Economic Review, 2013, 103 (6), 2121–2168.

  ,     , and    , “When Work Disappears: Manufacturing Decline and the Falling Marriage-Market
  Value of Young Men,” American Economic Review: Insights, 2018, forthcoming.

  ,      ,   , and Kaveh Majlesi, “Importing Political Polarization? The Electoral Consequences of
  Rising Trade Exposure,” University of Zurich mimeo, 2017.


                                                  35
  ,     ,   , Gary Pisano, and Pian Shu, “Foreign Competition and Domestic Innovation: Evidence
  from U.S. Patents,” University of Zurich mimeo, 2017.

Barrios, Thomas, Rebecca Diamond, Guido W. Imbens, and Michal Kolesár, “Clustering, Spatial
  Correlation, and Randomization Inference,” Journal of the American Statistical Association, 2012, 107
  (498), 578–591.

Bartelme, Dominick, “Trade Costs and Economic Geography: Evidence from the U.S.,” University of
  Michigan mimeo, 2018.

Bartik, Timothy J., Who Benefits from State and Local Economic Development Policies?, Kalamazoo, MI:
  W.E. Upjohn Institute for Employment Research, 1991.

Baum-Snow, Nathaniel and Fernando Ferreira, “Causal inference in urban and regional economics,”
  in “Handbook of Regional and Urban Economics,” Vol. 5, Elsevier, 2015, pp. 3–68.

Blanchard, Olivier and Lawrence F Katz, “Regional Evolutions, Brooking Papers on Economic Ac-
  tivity,” Economic Studies Program, The Brookings Institution, 1992, 23 (1), 76.

Borusyak, Kirill, Peter Hull, and Xavier Jaravel, “Quasi-experimental Shift-share Research Designs,”
  Technical Report 2018. arXiv:1806.01221 [econ.EM].

Burstein, Ariel, Eduardo Morales, and Jonathan Vogel, “Changes in Between-Group Inequality:
  Computers, Occupations, and International Trade,” University of California Los Angeles mimeo, 2018.

  , Gordon Hanson, Lin Tian, and Jonathan Vogel, “Tradability and the Labor-Market Impact of
  Immigration: Theory and Evidence from the U.S.,” University of California Los Angeles mimeo, 2018.

Cameron, Colin A. and Douglas L. Miller, “A Practitioner’s Guide to Cluster-Robust Inference,”
  Journal of Human Resources, 2014, 50 (2), 317–372.

Card, David, “Immigrant inflows, native outflows, and the local labor market impacts of higher
  immigration,” Journal of Labor Economics, 2001, 19 (1), 22–64.

      and John Dinardo, “Do Immigrant Inflows Lead to Native Outflows?,” American Economic Review,
  2000, 90 (2), 360–367.

Che, Yi, Yi Lu, Justin R. Pierce, Peter K. Schott, and Tao Zhigang, “Did Trade Liberalization with
  China Influence U.S. Elections?,” Yale University mimeo, 2017.

Chodorow-Reich, Gabriel and Johannes Wieland, “Secular Labor Reallocation and Business Cycles,”
  Harvard University mimeo, 2018.

Colantone, Italo and Piero Stanig, “The Trade Origins of Economic Nationalism: Import Competition
  and Voting Behavior in Western Europe,” American Journal of Political Science, 2018, forthcoming.

Diamond, Rebecca, “The Determinants and Welfare Implications of US Workers’ Diverging Location
  Choices by Skill: 1980-2000,” American Economic Review, 2016, 106 (3), 479–524.

                                                    36
Dix-Carneiro, Rafael and Brian K. Kovak, “Trade Liberalization and Regional Dynamics,” American
  Economic Review, October 2017, 107 (10), 2908–46.

  , Rodrigo Soares, and Gabriel Ulyssea, “Economic Shocks and Crime: Evidence From The Brazil-
  ian Trade Liberalization,” American Economic Journal: Applied Economics, 2017, forthcoming.

Dustmann, Christian, Uta Schönberg, and Jan Stuhler, “The Impact of Immigration: Why Do Stud-
  ies Reach Such Different Results?,” Journal of Economic Perspectives, 2016, 30 (4), 31–56.

Galle, Simon, Andrés Rodríguez-Clare, and Moises Yi, “Slicing the Pie: Quantifying the Aggregate
  and Distributional Effects of Trade,” University of California Berkeley mimeo, 2017.

Goldsmith-Pinkham, Paul, Isaac Sorkin, and Henry Swift, “Bartik Instruments: What, When, Why,
  and How,” Technical Report 24408, National Bureau of Economic Analysis, 2018.

Greenstone, Michael, Alex Mas, and Hoai-Luu Nguyen, “Do Credit Market Shocks Affect the Real
  Economy? Quasi-Experimental Evidence from the Great Recession and ’Normal’ Economic Times,”
  Princeton University mimeo, 2015.

Hakobyan, Sushanik and John McLaren, “Looking for Local Labor Market Effects of NAFTA,”
  Review of Economics and Statistics, 2016, 98 (4), 728–741.

Huber, Kilian, “Disentangling the Effects of a Banking Crisis: Evidence from German Firms and
  Counties,” American Economic Review, March 2018, 108 (3), 868–98.

Hummels, David, Rasmus Jørgensen, Jakob Munch, and Chong Xiang, “The wage effects of off-
  shoring: Evidence from Danish matched worker-firm data,” American Economic Review, 2014, 104
  (6), 1597–1629.

Imbens, Guido W. and Donald B. Rubin, Causal Inference for Statistics, Social, and Biomedical Sciences:
  an Introduction, New York, NY: Cambridge University Press, 2015.

Jaeger, David A., Joakim Ruist, and Jan Stuhler, “Shift-Share Instruments and the Impact of Immi-
  gration,” CUNY University mimeo, 2018.

Jones, Ronald W., “A Three-Factor Model in Theory, Trade and History,” in Jagdish Bhagwati, Ronald
  Jones, Robert Mundell, and Jaroslav Vanek, eds., Trade, Balance of Payments and Growth, North-
  Holland, 1971.

Kovak, Brian K, “Regional effects of trade reform: What is the correct measure of liberalization?,”
  American Economic Review, 2013, 103 (5), 1960–76.

Lazarus, Eben, Daniel J. Lewis, James H. Stock, and Mark W. Watson, “HAR Inference: Recom-
  mendations for Practice,” Harvard University mimeo, 2018.

Lee, Eunhee, “Trade, Inequality, and the Endogenous Sorting ofHeterogeneous Workers,” University
  of Maryland mimeo, 2017.


                                                    37
Lewis, Ethan and Giovanni Peri, “Immigration and the Economy of Cities and Regions,” in Gilles
  Duranton, J. Vernon Henderson, and William C. Strange, eds., Handbook of Regional and Urban
  Economics, Vol. 5A, UK: North Holland, 2015, pp. 625–685.

Monras, Joan, “Immigration and Wage Dynamics: Evidence from the Mexican Peso Crisis,” CEMFI
  mimeo, 2015.

Pierce, Justin R. and Peter K. Schott, “Trade Liberalization and Mortality: Evidence from US Coun-
  ties,” Yale University mimeo, 2017.

Roy, Andrew D., “Some Thoughts on the Distribution of Earnings,” Oxford Economic Papers, 1951, 3
  (2), 135–146.

Topalova, Petia, “Trade Liberalization, Poverty and Inequality: Evidence from Indian Districts,” in
  Ann Harrison, ed., Globalization and Poverty, University of Chicago Press, 2007, pp. 291–336.

  , “Factor Immobility and Regional Impacts of Trade Liberalization: Evidence on Poverty from
  India,” American Economic Journal: Applied Economics, 2010, 2 (4), 1–41.




                                                  38
Appendices
A     Microfoundation for stylized economic model in Section 3
Appendices A.1 and A.2 provide a microfoundation for the stylized economic model summarized in
Section 3.1. Appendix A.3 performs an analysis analogous to that in Section 3.2 for the case of the
microfoundation described in Appendices A.1 and A.2.


A.1   Environment

We consider a model with multiple sectors s = 1, . . . , S and multiple regions i, j = 1, . . . , J. Regions
are partitioned into countries indexed by c, and we denote the set of regions located in a country c by
Jc . Region i has a population of Mi individuals who cannot move across regions.


Production.    Each sector s in region i has a representative firm that produces a differentiated good.
The quantity Qis produced by sector s in region i is produced using labor with productivity Ais ,

                                                           Qis = Ais Lis ,                                      (A.1)

where Lis denotes the number of workers employed by the representative firm in this sector-region
pair. Regions thus differ in terms of their sector-specific productivity Ais .


Preferences for consumption goods.                 Every individual has identical nested preferences over the
sector- and region-specific differentiated goods. Specifically, we assume that individuals have Cobb-
Douglas preferences over sectoral composite goods,

                                                                     S
                                                                   ∏
                                                                                      γs
                                                     Cj =                     Cjs           ,                   (A.2)
                                                                   s =1

where Cj is the utility level of a worker located in region j that obtains utility Cjs from consuming
goods in sector s, and Cjs is a CES aggregator of the sector s goods produced in different regions:

                                        "                            # σ σ−s 1
                                             J              σsσ−1        s

                                Cjs =       ∑       cijs       s                 ,              σs ∈ (1, ∞),    (A.3)
                                            i =1


where cijs denotes the consumption in region j of the sector s good produced in region i. This
preference structure has been previously used in Armington (1969), Anderson (1979) and multiple
papers since (e.g. Anderson and van Wincoop, 2003; Arkolakis, Costinot and Rodríguez-Clare, 2012).


Preferences for sectors and non-employment.                          Workers have the choice of being employed in one
of the sectors s = 1, . . . , S of the economy or opting for non-employment, which we index as s = 0.
Conditional on being employed, all workers have identical homogeneous preferences over their sector


                                                                     39
of employment, but workers differ in their preferences for non-employment. Specifically, conditional
on obtaining utility Cj from the consumption of goods, the utility of a worker ι living in region j is
                                            
                                            u(ι)C        if employed in any sector s = 1, . . . , S,
                                                      j
                            U (ι | Cj ) =                                                                                            (A.4)
                                            C
                                                 j        if not employed (s = 0).

We assume that u(ι) is i.i.d. across individuals ι according to a Pareto distribution with scale param-
eter νi and shape parameter φ, so that the cumulative distribution function of u(ι) is given by
                                                  −φ
                                                  u
                                    Fu (u) = 1 −       ,                    u ∈ [νi , ∞),     φ > 1.                                 (A.5)
                                                  νi

If a worker living in region j chooses to be employed, she will earn wage ω j (as workers are indifferent
about the sector of employment and can move freely across sectors, wages must be equalized across
sectors in equilibrium). If a worker chooses to not be employed, she receives a benefit b j .33 We denote
the total number of employed workers in region j by L j , and the employment rate in j as Ej ≡ L j /M j .


Market structure.          Goods and labor markets are perfectly competitive.


Trade costs.       We assume that there are no trade costs, which implies that the equilibrium price of
the good produced in a region is the same in every other region; i.e. pijs = pis for j = 1, . . . , J. Thus,
for every sector s there is a composite sectoral good that has identical price Ps in all regions; i.e.

                                                                       S
                                                      ( Ps )1−σs =    ∑ ( pis )1−σ ,    s
                                                                                                                                     (A.6)
                                                                      s =1


and the final good’s price is P = ∏Ss=1 ( Ps )γs .


A.2     Equilibrium

We now characterize the equilibrium wage ω j and total employment L j of all regions j = 1, . . . , J.


Consumption.           We first solve the expenditure minimization problem of an individual residing in
region j. Given the sector-level utility in eq. (A.3) and the condition that pijs = pis for j = 1, . . . , J, all
regions j have identical spending shares xis on goods from region i, given by
                                                                           1−σs
                                                                      pis
                                                          xis =                     .                                                (A.7)
                                                                      Ps
   33 We assume that benefits are paid by a national government that imposes a flat tax χ on all income earned in country
                                                                                                 c
c. The budget constraint of the government is thus ∑ j∈ Jc {χc (ω j Ej + b j (1 − Ej )) M j } = ∑ j∈ Jc {b j (1 − Ej ) M j }. Alternatively,
we could think of the option s = 0 as home production and assume that workers that opt for home production in region j
obtain b j units of the final good, which they consume. This alternative model is isomorphic to that in the main text.




                                                                    40
Labor supply.    Every worker maximizes the utility function in eq. (A.4) in order to decide whether
to be employed. Consequently, conditional on the wage ωi and the non-employment benefit bi , the
employment rate in region i is Ei = Pr [ui (ι)ωi > bi ] = 1 − Pr [ui (ι) < bi /ωi ]. It therefore follows from
eq. (A.5) that

                                                   φ
                                     L i = v i ωi ,        vi ≡ Mi (νi /bi )φ .                         (A.8)

Note that this labor supply equation is analogous to that in eq. (5).


Producer’s problem.      In perfect competition, firms must earn zero profits and, therefore,

                                                               ωi
                                                       pis =       .                                    (A.9)
                                                               Ais

Goods market clearing.      Given that labor is the only factor of production and firms earn no profits,
the income of all individuals living in region i is Wi ≡ ∑s ωi Lis , and world income is W ≡ ∑i Wi .
We normalize world income to one, W = 1. Given preferences in eq. (A.2), all individuals spend a
share γs of their income on sector s, so that world demand for the differentiated good s produced in
region i is xis γs . Goods market clearing requires world demand for good s produced in region i to
equal total revenue of the representative firm operating in sector s in region i, ωi Lis . Thus, using the
expression in eq. (A.7), we obtain

                                        Lis = (ωi )−σs ( Ais Ps )σs −1 γs .                            (A.10)

Note that this labor demand equation is analogous to that in eq. (3), with the region- and sector-
specific demand shifter Dis defined as

                                              Dis = ( Ais Ps )σs −1 γs .

If, without loss of generality, we split the region- and sector-specific productivity Ais into a sector
component As and a residual Ãis , Ais = As Ãis , and we further consider Ps as our sectoral shock of
interest, we can decompose Dis as in eq. (4), with

                                                χs = Ps ,                                              (A.11)
                                                ρs = σs − 1,                                           (A.12)
                                                µs = ( As )σs −1 γs ,                                  (A.13)
                                                ηis = ( Ãis )σs −1 .                                  (A.14)


Labor market clearing.     Given the sector- and region-specific labor demand in eq. (A.10), total labor
demand in region i is
                                               S
                                       Li =   ∑ ( ωi ) − σ s
                                                               ( Ais Ps )σs −1 γs .                    (A.15)
                                              s =1




                                                          41
Labor market clearing requires labor supply in eq. (A.8) to equal labor demand in eq. (A.15):

                                                           S
                                         v i ( ωi ) φ =   ∑ ( ωi ) − σs
                                                                          ( Ais Ps )σs −1 γs .                    (A.16)
                                                          s =1


Equilibrium.     Given technology parameters { Ais }iJ,S                                          S
                                                      =1,s=1 , preference parameters {( σs , γs )}s=1 , labor
supply parameters {vi }iJ=1 , and normalizing world income to equal 1, W = 1, we can use eqs. (A.6),
(A.9) and (A.16) to solve for the equilibrium wage in every world region, {ωi }iJ=1 , the equilibrium
price of every sector-region specific good { pis }iJ,S                                            S
                                                    =1,s=1 , and the sectoral price indices { Ps }s=1 . Given
these equilibrium wages and sectoral price indices, we can use eq. (A.15) to solve for the equilibrium
level of employment in every region, { Li }iJ= J .


A.3   Labor market impact of sectoral shocks

As in Section 3.2, we assume that, in every period, our model characterizes the labor market equilib-
rium in every region of the world economy. Across periods, we assume that the parameters {σs }Ss=1
and φ are fixed and that all changes in the labor market outcomes {ωi , Li }iJ=1 are generated by changes
in technology { Ais }iJ,S                                  S                                     J
                       =1,s=1 , sectoral preferences { γs }s=1 and labor supply parameters { vi }i =1 .
   We focus in this section on understanding how changes in these exogenous parameters affect the
labor market equilibrium in a set of “small” regions whose share in world output is approximately
zero for all sectors, i.e., xis ≈ 0 for s = 1, . . . , S, with xis defined in eq. (A.7). We assume that all
small regions of interest belong to the same country c and that they correspond to the set N regions
discussed in Section 3.1.
   As illustrated in Online Appendix C.1, the “small region” assumption applied to all N regions of
interest implies that the sectoral price index Ps of every sector s will not depend on the technology
and labor supply parameters of these N regions; i.e., { Ps }Ss=1 does not depend on { Ais }Ss=1,i∈ Jc and
{vi }i∈ Jc . Thus, from the perspective of any one of these regions, changes in sectoral prices operate as
exogenous shocks. Furthermore, as illustrated in eqs. (A.15) and (A.16), these sectoral prices mediate
the impact of all foreign technology and labor supply shocks on the labor market equilibrium of every
region in country c.
     Consequently, across periods, our microfounded model implies that the changes in labor mar-
ket outcomes in all N regions of country c, {ωi , Li }i∈ Jc , are generated by changes in sectoral prices
{ Ps }Ss=1 , changes in an aggregate of all other sectoral shocks, {( As )σs −1 γs }Ss=1 , changes in labor sup-
ply parameters of all regions in country c, {vi }i∈ Jc , and changes in the sector- and region-specific
technology parameters, {( Ãis )σs −1 }iS∈ Jc ,s=1 .


Isomorphism.      Up to a first-order approximation around the initial equilibrium, eqs. (A.15) and (A.16)
imply that
                          S   h                                                                  i
                 L̂i =   ∑ is
                          l 0
                                β is P̂s + λ i (( σs − 1 ) Â s + γ̂ s ) + λ i (( σs − 1 )  ˆ ) + (1 − λ ) v̂ ,
                                                                                           Ã is        i    i    (A.17)
                         s =1




                                                                 42
                                                                                     −1
with β is = (σs − 1)λi and λi defined as in Section 3.2; i.e. λi ≡ φ φ + ∑s lis0 σs
                                                                    
                                                                                         . Given the equiva-
lences in eqs. (A.11) to (A.14), the expression in eq. (A.17) is identical to that in eq. (8). Consequently,
the environment described in Appendices A.1 and A.2 does indeed provide a microfoundation for
the equilibrium relationship in eq. (8).


B        Proofs and additional details for Section 4
Since Propositions 1 and 2 are special cases or Propositions 3 and 4, we only prove Propositions 3,
4 and 5. Before proving these results in Appendices B.3, B.3 and B.5, we collect some auxiliary
Lemmata used in the proofs in Appendix B.2, and collect the assumptions that we impose on the DGP
in Appendix B.1. Finally, Appendix B.6 discusses inference when the effects β is are heterogeneous.
Throughout this appendix, we use the following notation. We use the notation AS  BS to denote
AS = O( BS ), i.e. there exists a constant C independent of S such that AS ≤ CBS . We denote the
σ-field generated by (Y (0), B, W, U, Z ) by F0 = σ(Y (0), B, W, U, Z ). Define wst = ∑iN=1 wis wit , X̃s =
Xs − Zs0 γ, and σs2 = var(Xs | F0 ) = var(Xs | Z, W ). Finally, let ns = ∑iN=1 wis .


B.1      Assumptions

We first list and discuss the assumptions needed for the results in Section 4.1. We impose some reg-
ularity conditions on the DGP for (Y (0), B, W, X ) that generate the observed data (Y, X, W ). Unless
stated otherwise, all limits are taken as S → ∞.

Assumption 1.

    (i) {(Y (0), B, W, X ) ∈ R NS × R NS ×S × R NS ×S × RS }∞
                                                            S=1 is a triangular array of random variables
         with N = NS → ∞ as S → ∞ that satisfies eq. (15), and ∑iN=1 E[Yi (0)] = 0. The observed data
         consists of the tuple (Y, X, W ), with Yi = Yi (X1 , . . . , XS ), such that eq. (9) holds.

  (ii) Conditional on W, the shocks X1 , . . . , XS are mean zero, independent across s, with fourth
         moments that exist and are bounded uniformly over s.

 (iii)   1
         N ∑iN=1 E[ Xi2 | W ] =     1
                                    N   ∑iN=1 ∑Ss=1 var(Xs | W )wis
                                                                 2 converges in probability to a strictly positive

         non-random limit.

Assumption 2.

    (i) Conditional on W, the second moments of Yi (0) exist, and are bounded uniformly over i. The
         support of β is is bounded.

  (ii) maxs ns /N → 0, where ns = ∑Ss=1 wis denotes the total share of sector s.

     By modeling the data as a triangular array, Assumption 1(i) allows the distribution of the data to
change with the sample size.34 The assumption that Yi (0) and Xs are mean zero is made to simplify
   34 In other words, to allow the distribution of the data to change with the sample size S, we implicitly index the data by

S. Making this index explicit, for each S, the data is thus given by the array {(YiS (0), β isS , wisS , XsS ) : i = 1, . . . , NS , s =
1, . . . , S}.


                                                                  43
the exposition in this section by allowing us to drop the intercept from the regression of Yi on Xi , and
is relaxed in Section 4.2. Assumption 1(iii) is a standard regularity condition ensuring that the shocks
X have sufficient variation so that the denominator of β̂, scaled by N, does not converge to zero. The
bounded support condition on β is in part (i) of Assumption 2 is made to keep the proofs simple and
can be relaxed.
    For the estimator in eq. (11) to be asymptotically normal, we need to strengthen Assumption 1(ii)
and Assumption 2 slightly:

Assumption 3.

  (i) maxs n2s / ∑St=1 n2t → 0.

 (ii) Conditional on W, the eighth moments of Xs are bounded uniformly over s, and the fourth
         moments of Yi (0) are bounded uniformly over i.

    Part (i) ensures that the contribution of each sector to the asymptotic variance, which, according
to the standard error formula below, is of the order O(n2s ), is asymptotically negligible. For instance,
                                                                                                √
while the estimator β̂ is consistent for β when the largest sector share is of the order O( N/ S) and
the remaining sector shares are of the order O( N/S), Assumption 3 rules this case out; β̂ will not
generally be asymptotically normal in this case due to failure of the Lindeberg condition.
    Next, we state and discuss the assumptions needed for the results in Section 4.2. The next as-
sumption generalizes Assumption 1 to allow for controls:

Assumption 4.

  (i) {(Y (0), B, W, U, X, Z ) ∈ R NS × R NS ×S × R NS ×S × R NS ×K × RS × RS×K }∞
                                                                                 S=1 is a triangular array
         of random variables with N = NS → ∞ as S → ∞ that satisfies eqs. (21) and (22). The observed
         data consists of the tuple (Y, X, Z, W ), with Yi = Yi (X1 , . . . , XS ), such that eqs. (9) and (20) hold.

 (ii) Conditional on W and Z, the shocks X1 , . . . , XS are independent across s, with fourth moments
         that exist and are bounded uniformly over s.

 (iii)   1
         N ∑iN=1 ∑Ss=1 var(Xs | W, Z )wis
                                       2 converges in probability to a strictly positive non-random limit,

         and Z 0 Z/N converges in probability to a positive definite non-random limit.

 (iv) Conditional on W, the second moments of Ui and Zs exist and are bounded uniformly over i
         and s.

    Parts (i), (ii) and (iii) are straightforward generalizations of parts (i), (ii) and (iii) of Assumption 1.
Part (iv) imposes very mild restrictions on U and Z.
    Let δ̌ = ( Z 0 Z )−1 Z 0 (Y − Xβ) denote the regression coefficient in a regression of Y − Xβ on Z, that
is, the regression coefficient on Zi in a regression in which β̂ is restricted to equal to the true value β.

Assumption 5.

  (i) Conditional on W, the fourth moments of Zs , and Ui exist and are bounded uniformly over s
         and i.

                                                          44
  (ii) √ N         (δ̌ − δ) = O p (1)
          ∑s n2s

    Part (i) strengthens Assumption 4(iv). Part (ii) is a high-level assumption that implies δ̂ converges
at least as fast as β̂; otherwise the error in estimating δ could dominate the asymptotic variance of β.


B.2    Auxiliary results

Lemma 1. {AS1 , . . . , ASS }∞
                             S=1 be a triangular array of random variables. Fix η ≥ 1, and let A Si =
∑Ss=1 wis ASs , i = 1 . . . , NS . Suppose E[|ASs | | W ] exists and is bounded uniformly over S and s. Then
                                                   η

E[| ASi |η | W ] exists and is bounded uniformly over S and i.

Proof. By Hölder’s inequality,

                              "                             η         #                   ! η −1
                                     S        η −1    1                            S                S
                                    ∑ wis wis ASs                                 ∑ wis            ∑ wis E|ASs | W |
              η                                                                                                      η
  E[| ASi | | W ] = E                           η     η
                                                                |W ≤
                                    s =1                                          s =1             s =1
                                                                                                          S
                                                                                                        ∑ wis E|ASs | W | ≤ max
                                                                                                                         η                            η
                                                                                               =                                E[ASs | W ],
                                                                                                                             s
                                                                                                        s =1

which yields the result.

Lemma 2. { AS1 , . . . , ASNS }∞                                                           2
                               S=1 be a triangular array of random variables. Suppose E [ ASi | W ] exists and
is bounded uniformly over S and i. Then N −2 ∑Ss=1 E (∑iN=1 wis ASi )2 | W → 0, provided Assumption 2(ii)
                                                                           

holds.

Proof. By Cauchy-Schwarz inequality,
                                        !2           
          S             N                                         S       N   N
                                                            1
  N −2   ∑ E  ∑ wis ASi                             W ≤
                                                            N2   ∑ ∑ ∑ wis w js E[ A2Si | W ]1/2 E[ A2Sj | W ]1/2
         s =1          i =1                                      s =1 i =1 j =1

                                                                                                                     S       N   N                         S
                                                                                                               1
                                                                                                          
                                                                                                               N2   ∑∑           ∑ wis w js = N −2        ∑ n2s
                                                                                                                    s =1 i =1 j =1                        s =1


The result follows from the fact that N −2 ∑Ss=1 n2s ≤ maxs ns /N, which converges to zero by Assump-
tion 2(ii).

Lemma 3. let { AS1 , . . . , ASNS , BS1 , . . . , BSNS , AS1 , . . . , ASS }∞
                                                                            S=1 be a triangular array of random variables
such that E[ A4Si | W ], E[ BSi
                             4 | W ], and E [A 2 | W ] exist and are bounded uniformly over S, i and s. Then
                                              Ss
(∑s n2s )−1 ∑i,j,s wis w js ASi BSj ASs = O p (1).

Proof. Let RS = (∑s n2s )−1 ∑i,j,s wis w js ASi BSj ASs . Then by Cauchy-Schwarz inequality,

                            1
  E[| RS | | W ] ≤
                           ∑s n2s
                                    ∑ wis w js E[| ASi BSj ASs | | W ]
                                    i,j,s
                            1                                                                                                         1
                                     ∑ wis w js E[| BSj |                                                                                     ∑ wis w js = 1.
                                                            4
                       ≤                                         | W ]1/4 E[| ASi |4 | W ]1/4 E[ASs
                                                                                                 2
                                                                                                    | W ]1/2 
                           ∑s n2s   i,j,s                                                                                            ∑s n2s   i,j,s


                                                                                  45
The result then follows by Markov inequality and the dominated convergence theorem.


B.3     Proof of Proposition 3

Let EW denote expectation conditional on W. We first show that

         1 0   1
         N
           XZ=
               N             ∑ wis Zs0 γZi + o p (1)                                                                                                   (B.1)
                                 i,s
         1 0   1                               1
         N
           XX=
               N             ∑ σs2 wss + N ∑ Zs0 γZt0 γwst + o p (1)                                                                                   (B.2)
                                 s                 s,t
         1 0   1                                   1
         N
           ZY=
               N             ∑ Zi Yi (0) + N ∑ Zi wit Zt0 γβit + o p (1)                                                                               (B.3)
                                  i                      i,t
         1 0   1                                                           1                              1
         N
           XY=
               N             ∑ wis wit (Zs0 γ)(Zt0 γ) βit + N ∑ wis2 σs2 βis + N ∑ wis (Zs0 γ)Yi (0) + o p (1).                                        (B.4)
                             i,s,t                                                 i,s                         i,s


Consider (B.1). We have

                            1 0   1                                                1                                     1
                            N
                              XZ=
                                  N            ∑ Xs ∑ wis Zi =                     N     ∑ X̃s ∑ wis Zi + N ∑ wis Zs0 γZi .
                                               s               i                         s          i                        i,s


It therefore suffices to show that
                                                               1
                                                               N   ∑ X̃s ∑ wis Zi = o p (1).                                                           (B.5)
                                                                   s           i

The left-hand side has mean zero conditional on W, with the variance of the kth row given by
                                                   !                                                      !2                                  !2
                    1                                       1                                                    1
           var
                    N      ∑ wis X̃s Zik | W              = 2
                                                           N           ∑ EW σs2 ∑ wis Zik                       2
                                                                                                                N            ∑ EW ∑ wis Zik        .
                           i,s                                         s                       i                               s       i

                                                            2 ] = E [(                 2
By Lemma 1, Assumption 4(iv), and the Cr -inequality, EW [ Zik     W ∑s wis Zsk + Uik ) ] is bounded,
so that by Lemma 2, the right-hand side converges to zero. Equation (B.5) then follows by Markov
inequality and the dominated convergence theorem.
   Next, consider eq. (B.2). We have

  1 0   1                                          2                                 1
  N
    XX=
        N          ∑ Xs Xt wis wit =               N   ∑ X̃s X̃t wst + N ∑(Xs2 − E[Xs2 | Zs , W ])wis2
                   i,s,t                               s<t                                   i,s
                                                                           2                                  1                    1
                                                                       +
                                                                           N   ∑ Zs0 γX̃t wst + N ∑ σs2 wss + N ∑ Zs0 γZt0 γwst .                      (B.6)
                                                                               s6=t                                  s                 s,t


We will show that the first three summands are of the order o p (1). All three summands are mean zero
since they are mean zero conditional on F0 , so by Markov inequality and the dominated convergence
theorem, it suffices to show that their variances, conditional on W, converge to zero. To that end,
                                       !
         2                                     4                                               1
  var
         N   ∑ X̃s X̃t wst | W             =
                                               N2      ∑ EW [σs2 σt2 ]w2st                    N2   ∑ w2st
             s<t                                       s<t                                          s,t



                                                                                    46
                                                                                                                    1                                 1
                                                                                                                ≤
                                                                                                                    N2           ∑ wis w js =         N2       ∑ n2s → 0.         (B.7)
                                                                                                                                 i,j,s                         s


where the last inequality follows from ∑s wis w js ≤ ∑s wis = 1, and the convergence to 0 follows
by Assumption 2(ii). The variance of the second summand can be bounded by
                                                                                                   !                                     !2
                              1                                                                            1                                      1
                      var
                              N    ∑(Xs2 − E[Xs2 | Zs , W ])wis2 | W                                      2
                                                                                                          N    ∑ ∑ wis2                       ≤
                                                                                                                                                  N2   ∑ n2s ,
                                   i,s                                                                          s            i                             s


which converges to zero by Assumption 2(ii). Finally, variance of the third summand in eq. (B.6) can
be bounded by

                                                     !                                                              !2
            2                                                 4
  var
            N   ∑        Zs0 γX̃t wis wit       |W          ≤ 2
                                                             N          ∑    EW σt2        ∑       |Zs0 γ|wis wit
                i,s6=t                                                   t                 s,i
                                                                                                                                                                                  !2
                                                                                                                      1
                                                                                                                     2
                                                                                                                     N              ∑ EW ∑ wis ∑                    wit |Zt0 γ|        .
                                                                                                                                     s            i             t


By Lemma 1, the second moment of ∑t wit |Zt0 γ| is bounded, so by Lemma 2, the right-hand side
converges to zero.
   Next, consider eq. (B.3). We can decompose

                                  1 0   1                                             1                             1
                                  N
                                    ZY=
                                        N             ∑ Zi wis X̃s βis + N ∑ Zi Yi (0) + N ∑ Zi wit Zt0 γβit .
                                                       i,s                                     i                            i,t


We will show that the first summand is o p (1). Since it has mean zero, by Markov inequality, it suffices
to show that the variance of each row k conditional on W converges to zero. Now,

                                                !                                                          !2
            1                                          1
  var
            N   ∑ Zik wit X̃t βit | W                = 2
                                                      N             ∑   EW σs2       ∑ Zik wis βis
                i,t                                                 s                 i
                                                                                                                                                                         !2
                                                                                                                          1
                                                                                                                         2
                                                                                                                         N               ∑ EW ∑ wis |Zik |                    → 0,
                                                                                                                                         s             i


where the convergence follows by Lemma 2, since as observed above, EW [| Zik |2 ] is bounded. Finally,
consider eq. (B.4). Decompose

  1                      1                                          1
  N   ∑ Xi Yi =          N   ∑ X̃s ∑ wis Yi (0) + N ∑                           wis wit X̃s X̃t β it
        i                     s           i                             i,s<t
                                                1                                          1
                                          +
                                                N   ∑        wis wit X̃s X̃t β it +
                                                                                           N       ∑ (Zs0 γ)X̃t ∑ wis wit βit
                                                    i,s>t                                          s6=t                 i
                                  1                                                        1
                              +
                                  N      ∑ X̃s (Zt0 γ) ∑ wis wit βit + N ∑ wis2 (Xs2 − E[Xs2 | Zs , W ]) βis
                                         s6=t                   i                                  i,s




                                                                                          47
                                                       1                                                    1                              1
                                                  +
                                                       N   ∑ wis wit (Zs0 γ)(Zt0 γ) βit + N ∑ wis2 σs2 βis + N ∑ wis (Zs0 γ)Yi (0).
                                                           i,s,t                                                  i,s                              i,s


We will show that all summands except for the last three are o p (1). Since they are all mean zero
conditional on F0 , it suffices to show that their variances conditional on W converge to zero. The
variance of the first summand is bounded by

                                                   !                                                       !2
         1                                               1
  var
         N    ∑ X̃s ∑ wis Yi (0) | W                   = 2
                                                        N          ∑    EW σs2       ∑ wis Yi (0)
               s             i                                      s                 i
                                                                                                                                                                 !2
                                                                                                                    1
                                                                                                                   2
                                                                                                                   N         ∑ EW ∑ wis Yi (0)                        →0
                                                                                                                             s                 i


by Lemma 2. The variance of the second summand is bounded by
                                                                !                                                           !2
                       1                                              1                                                               1
          var
                       N     ∑       wis wit X̃s X̃t β it | W       = 2
                                                                     N         ∑ EW σs σt ∑ wis wit βit                          
                                                                                                                                      N2       ∑ w2st → 0,
                             i,s<t                                             s<t                     i                                       s<t


where the convergence to zero follows by arguments analogous to those in (B.7). The variance of the
third summand converges to zero by analogous arguments. Variance of the fourth summand satisfies

                                                             !                                                                             !2
         1                                                           1
  var
         N    ∑      (Zs0 γ)X̃t       ∑ wis wit βit | W            ≤
                                                                     N    ∑    EW σs2          ∑   |(Zt0 γ)|      ∑ wis wit | βis |
              s6=t                      i                                  s                   t                    i
                                                                                                                                                                         !2
                                                                                                             1
                                                                                                           
                                                                                                             N          ∑ EW ∑ wis ∑                     wit |(Zt0 γ)|        ,
                                                                                                                        s            i              t


which converges to by Lemma 2, since by Lemma 1, the second moment of ∑t wit |(Zt0 γ)| is bounded.
Variance of the fifth summand converges to zero by analogous arguments. Finally, variance of the
sixth summand satisfies
                                                                                 !                                               !2
                   1                                                                   1                                                       1
        var
                   N   ∑ wis2 (Xs2 − E[Xs2 | Zs , W ]) βis | W                        2
                                                                                      N            ∑ EW ∑ wis2 βis                       
                                                                                                                                               N2        ∑ n2s → 0,
                       i,s                                                                         s                i                                    s


which yields (B.4). We now use eqs. (B.1), (B.2), (B.3) and (B.4) to derive the result. Since Ui0 γ =
0, Equation (B.1) implies Z 0 X/N = Z 0 Zγ/N + o p (1). Consequently, since by Assumption 4(iii),
( Z 0 Z/N )−1 = o p (1),

              1 0      1       1                          1                                                                   1
              N
                Ẍ Ẍ = X 0 X − X 0 Z ( Z 0 Z )−1 Z 0 X =
                       N       N                          N                               ∑ σs2 wss + o p (1) =               N   ∑ πis + o p (1),                       (B.8)
                                                                                           s                                         i,s


and, since Z 0 Y/N = o p (1),

                                      1 0     1          1                  1
                                      N
                                        Ẍ Y = X 0 Y − γ0 Z 0 Y + o p (1) =
                                              N          N                  N                              ∑ πis βis + o p (1).
                                                                                                            i,s



                                                                                 48
Combining Assumption 4(iii) with the preceding two displays then yields the result.


B.4    Proof of Proposition 4

Let r N = 1/ ∑s n2s , and let EW denote expectation conditional on W. Note that γ0 Ui = 0 implies
Zγ = WZγ. Therefore, Ẍ admits the decomposition

            Ẍ = ( I − Z ( Z 0 Z )−1 Z 0 ) X = ( I − Z ( Z 0 Z )−1 Z 0 )( X − Zγ) = ( I − Z ( Z 0 Z )−1 Z 0 )W X̃.

Using this decomposition, we obtain

               0                  1/2 0       0       1/2 0 0
        r1/2
         N ( Ẍ Ẍ )( β̂ − β ) = r N Ẍ (Y − X β ) = r N X̃ W (Y − Xβ − Z δ̌ )
                                       0 0                  1/2 0 0
                                = r1/2
                                   N X̃ W (Y − Xβ − Zδ ) − r N X̃ W Z ( δ̌ − δ )
                                                                X̃ 0 W 0 Z
                                   N ∑ X̃s wis ei −
                                = r1/2
                                                                    N                                N ∑ X̃s wis ei + o p (1).
                                                                           (r N N 2 )1/2 (δ̌ − δ) = r1/2
                                          s,i                                                            s,i


where the last line follows by Assumption 5(ii) and (B.5). It follows from eq. (B.8) and Assump-
tion 4(iii) that ( Ẍ 0 Ẍ/N )−1 = (1 + o p (1))( N −1 ∑i,s πis )−1 , so that

                         N                                     1
                                                           N ∑i,s πis N ∑
                                  ( β̂ − β) = (1 + o p (1)) −1       r1/2 X̃s wis ei + o p (1).
                     (∑s ns )
                          2   1/2
                                                                         s,i


Therefore, it suffices to show


                                           N ∑ X̃s wis ei = N (0, plim VN ) + o p (1).
                                          r1/2
                                                  s,i


Define Vi = Yi (0) − Zi0 δ + ∑t wit Zt0 γ( β it − β), and

                              as =   ∑ wis Vi ,                               bst =   ∑ wis wit ( βit − β).
                                      i                                                i


Then we can write ei = Vi + ∑t wit X̃t ( β it − β), and, using the fact that 0 = ∑i,s πis ( β is − β) = ∑s σs2 bss ,
we can decompose
                                                                                                    !
                 r1/2
                  N     ∑ X̃s wis ei =     r1/2
                                            N      ∑ X̃s ∑ wis         Vi + ∑ wit X̃t ( β it − β)          N ∑ Ys ,
                                                                                                        = r1/2
                        s,i                             s   i                 t                               s


where
                                                                             s −1
                                     Ys = X̃s as + (X̃s2 − σs2 )bss +         ∑ X̃s X̃t (bst + bts ).
                                                                             t =1

Observe that Ys is a martingale difference array with respect to the filtration Fs = σ(X1 , . . . , Xs , F0 ).
By the dominated convergence theorem and the martingale central limit theorem, it suffices to show
that r2N ∑Ss=1 EW [Ys4 ] → 0 so that the Lindeberg condition holds, and that the conditional variance




                                                                      49
converges,
                                                                  S
                                                         rN       ∑ E[Ys2 | Fs−1 ] − VN = o p (1).
                                                               s =1

To verify the Lindeberg condition, by the Cr -inequality, it suffices to show that

                                     r2N ∑ EW [X̃s4 a4s ] → 0,                                        r2N ∑ EW [(X̃s2 − σs2 )4 bss
                                                                                                                                4
                                                                                                                                   ]→0
                                            s                                                                 s
                                                             !4                                                                           !4
                                         s −1                                                                            s −1
                 r2N    ∑ EW ∑ X̃s X̃t bst                            → 0,                          r2N   ∑ EW ∑ X̃s X̃t bts                    → 0.
                        s                t =1                                                             s              t =1

                                                                  4                             4
Note that since ∑s |∑t wit Zt0 γ( β it − β)|  ∑s |∑t wit Zt0 γ| , it follows from Lemma 1, Assumption 3(ii),
Assumption 5(i), and the Cr inequality that the fourth moment of Vi exists and is bounded. Therefore,
by arguments as in the proof of Lemma 2, ∑s EW [ a4s ]  ∑s n4s , so that

                  r2N ∑ EW [X̃s4 a4s ] = r2N ∑ EW [ E[X̃s4 | F0 ] a4s ]  r2N ∑ EW [ a4s ]  r2N ∑ n4s → 0
                            s                                 s                                               s                      s


by Assumption 3(i), since ∑s n4s ≤ maxs n2s /r N . Second, since β is is bounded by Assumption 2(i),
          2 ≤ n , so that
bss  ∑i wis   s


                        r2N ∑ EW [(X̃s2 − σs2 )4 bss
                                                  4
                                                     ]  r2N ∑ EW [(X̃s2 − σs2 )4 n4s ]  r2N ∑ n4s → 0.
                                s                                                  s                                             s

Third, by similar arguments

                                         !4                                                                      !4       
                 s −1                                                                          s −1
  r2N ∑ EW       ∑ X̃s X̃t bst                  = r2N ∑ EW E[X̃s4 | F0 ] E                    ∑ X̃t bst               | F0 
      s          t =1                                    s                                     t =1
                                                                                                                                           !4
                                                                                                                        s −1
                                                                                                       r2N ∑            ∑ ∑ wis wit            ≤ r2N ∑ n4s → 0.
                                                                                                                  s     t =1 i                         s

                                             4
                             −1
The claim that r2N ∑s EW ∑st=  1 X̃s X̃t b ts    → 0 follows by similar arguments.
   It remains to verify that the conditional variance converges. Since VN can be written as
                                                                       !
             1
  VN =
          ∑Ss=1 n2s
                        var         ∑(Xi − Zi0 γ)ei | F0                   = r N ∑ E[Ys2 | F0 ]
                                     i                                                 s
                                                                           "                                                                                 #
                                                                                                                                     s −1
                                                             = r N ∑ E (X̃s as + (X̃s2 − σs2 )bss )2 | F0 + ∑ σs2 σt2 (bst + bts )2 ,
                                                                                                                                
                                                                       s                                                                 t =1


we have
                                                 r N ∑ E[Ys2 | Fs−1 ] − VN = 2D1 + D2 + 2D3 ,
                                                     s




                                                                                       50
where
                                                                                                     s −1
                                  D1 = r N ∑(σs2 as + E[X̃s3 | F0 ]bss ) ∑ X̃t (bst + bts ),
                                                     s                                               t =1
                                                                s −1
                                  D2 = r N ∑ σs2                ∑ (X̃t2 − σt2 )(bst + bts )2 ,
                                                     s          t =1
                                                                s −1 t −1
                                  D3 = r N ∑ σs2                ∑ ∑ X̃t X̃u (bst + bts )(bsu + bus ).
                                                     s          t =1 u =1


It therefore suffices to show that D j = o p (1) for j = 1, 2, 3. Since E[ D j | F0 ] = 0, it suffices to show
that var( D j | W ) = EW [var( D j | F0 )] → 0. Since bst + bts  wst , and since EW [| as at |]  ns nt , and
|bss |  wss ≤ ns , it follows that
                                                                                                    !2 
                                                 S
  var( D1 | W ) = r2N ∑ EW σt2                 ∑            (bst + bts )(σs2 as + E[X̃s3 | F0 ]bss ) 
                            t                 s = t +1
                                                                                          !2                                                   !2
                                                                       S
                                               r2N      ∑           ∑         wst ns          ≤   r2N   max n2s
                                                                                                          s
                                                                                                                      ∑ ∑ wst                        = r N max n2s → 0,
                                                                                                                                                            s
                                                         t       s = t +1                                                 t          s


where the convergence to zero follows by Assumption 3(i). By similar arguments, since wst ≤ ns

                                                                                                   !2                                               !2
                                                                  S                                                                  S
  var( D2 | W ) = r2N ∑ EW (X̃t2 − σt2 )2                        ∑          σs2 (bst + bts )2              r2N ∑                  ∑         w2st
                            t                                  s = t +1                                               t           s = t +1
                                                                                                                                               !2
                                                                                                                               S
                                                                                                         ≤ r2N ∑              ∑ ns wst               ≤ r N max n2s → 0.
                                                                                                                                                            s
                                                                                                                 t            s =1


Finally,

                                                                                                                 !2
                                 S                               S
  var( D3 | W ) =     r2N   ∑ ∑          EW σt2 σu2             ∑          σs2 (bst   + bts )(bsu + bus )
                            t u = t +1                        s = u +1
                                                                                           !2
                                                         S                 S
                                      r2N ∑          ∑                ∑        wst wsu            ≤ r2N     ∑        wst wsu wvt wvu ≤ r N max n2s → 0,
                                                                                                                                                            s
                                              t u = t +1             s = u +1                               s,t,u,v


where the last line follows the fact that since ∑s wst = nt and wst ≤ ns ,


   ∑        wst wsu wvt wvu ≤ max ns
                                 s
                                            ∑        wsu wvt wvu = max ns ∑ nu nv wvu
                                                                                      s
  s,t,u,v                                  s,t,u,v                                             u,v

                                                                                                                 ≤ max n2s ∑ nv wvu = max n2s /r N .
                                                                                                                              s          u,v                    s


Consequently, D j = o p (1) for j = 1, 2, 3, the conditional variance converges, and the theorem follows.




                                                                                  51
B.5    Proof of Proposition 5

Let θ̂ = ( β̂, δ̂0 )0 , θ = ( β, δ), Mi = ( Xi , Zi0 )0 , r N = 1/ ∑Ss=1 n2s , and let

                                                                           V̂N = r N ∑ X
                                                                                       b s R̂2s .
                                                                                            s


Since VN = r N ∑s σs2 R2s , we can decompose this estimator as

                          V̂N = r N ∑(X
                                      b s2 − X̃s2 ) R̂2s + r N ∑ X̃s2 ( R̂2s − R2s ) + r N ∑(X̃s2 − σs2 ) R2s + VN .                                                     (B.9)
                                             s                                 s                                      s


We’ll show that the first three terms are o p (1). Since êi = ei + Mi0 (θ − θ̂ ), with ei = Yi (0) − Zi0 δ, we
can decompose

             R̂2s =   ∑ wis w js êi êj = R2s + 2 ∑ w js wis Mi0 (θ − θ̂ )ej + ∑ wis w js Mi0 (θ − θ̂ ) M0j (θ − θ̂ ).                                                (B.10)
                          i,j                                    i,j                                  i,j


Therefore, the second term in eq. (B.9) satisfies
                                                 "                                    #                               "                                       #
    rN ∑      X̃s2 ( R̂2s       −   R2s )   = 2 rN ∑          w js wis X̃s2 e j Mi0       (θ − θ̂ ) + (θ − θ̂ )   0
                                                                                                                          rN ∑        wis w js X̃s2 M j Mi0       (θ − θ̂ )
         s                                            s,i,j                                                                   s,i,j

                                            = O p (1)(θ − θ̂ ) + (θ − θ̂ )0 O p (1)(θ − θ̂ ) = o p (1),

where the second line follows from Lemma 3. Second, the variance of the third term in eq. (B.9) can
be bounded by

      var(r N ∑(Xs2 − σs2 ) R2s | W ) = r2N ∑ E[(Xs2 − σs2 )2 R4s | W ]  r2N ∑ E[ R4s | W ]  r2N ∑ n4s → 0
                      s                                                s                                                  s                             s


since r2N ∑s n4s ≤ maxs n2s / ∑t n2t → 0 by Assumption 3(i). Since

                                E[r N ∑(Xs2 − σs2 ) R2s | W ] = E[r N ∑ E[(Xs2 − σs2 ) | F0 ] R2s | W ] = 0,
                                             s                                                 s


it follows by Markov inequality and the dominated convergence theorem that r N ∑s (Xs2 − σs2 ) R2s =
o p (1).
    It remains to show that the first term in eq. (B.9) is o p (1). Let γ̂ = ( Z 0 Z )−1 Z 0 X. Since WX = X
and Z = WZ + U, it follows that

       b = (W 0 W )−1 W 0 Ẍ = (W 0 W )−1 W 0 ( X − Z ( Z 0 Z )−1 Z 0 X ) = X − (W 0 W )−1 W 0 Z ( Z 0 Z )−1 Z 0 X
       X
              = X − (W 0 W )−1 W 0 Z (γ̂ − γ) − (W 0 W )−1 W 0 Zγ
              = X̃ − (W 0 W )−1 W 0 Z (γ̂ − γ)
              = X̃ − Z (γ̂ − γ) − (W 0 W )−1 W 0 U (γ̂ − γ).

Let U = (W 0 W )−1 W 0 U, and denote the sth row by Us0 . Since Usk
                                                                 4 = ( ((W 0 W )−1 W 0 ) U )4 , it follows
                                                                      ∑i                si ik




                                                                                          52
by the Cauchy-Schwarz inequality that

               4
            E[Usk | W ] ≤ max E[(∑((W 0 W )−1 W 0 )si Uik )4 | W ]  max(∑|((W 0 W )−1 W 0 )si |)4 ,
                                s                                              s
                                       i                                           i

which is bounded assumption of the proposition. Therefore, the fourth moments of Us are bounded
uniformly over s. Consequently,

                      r N ∑ (X
                             b s2 − X̃s2 ) R̂2s = (γ̂ − γ)0 r N ∑ Zs R̂2s − (γ̂ − γ)0 r N ∑ Us R̂2s
                            s                                       s                     s
                                                           0                   0
                                              = (γ̂ − γ) O p (1) − (γ̂ − γ) O p (1)
                                              = o p (1),

where the second line follows by applying Lemma 3 after using the expansion in eq. (B.10), and the
third line follows since by eq. (B.1) and Assumption 4(iii), γ̂ = γ + o p (1).


B.6   Inference under heterogeneous effects

For valid (but perhaps conservative) inference under heterogeneous effects, we need to ensure that
that when β is 6= β, eq. (28) holds with inequality, that is,

                                             ∑Ss=1 X
                                                   b s2 R̂2s
                                                             ≥ VN + o p (1).                                    (B.11)
                                              ∑Ss=1 n2s

To discuss conditions under which this is the case, observe that the “middle-sandwich” in the asymp-
totic variance sandwich formula, VN , as defined in Proposition 4, can be decomposed into three terms:

         var ∑s X̃s Rs | F0
                                
  VN =
                ∑Ss=1 n2s
    ∑s E[X̃s2 R2s | F0 ] ∑s E[X̃s Rs | F0 ]2 ∑s6=t E[(X̃s Rs − E[X̃s Rs | F0 ])(X̃t Rt − E[X̃s Rs | F0 ]) | F0 ]
=                       −                   +                                                                    .
        ∑Ss=1 n2s            ∑Ss=1 n2s                                   ∑Ss=1 n2s

where, as before Rs = ∑s wis ei , and ei = Yi (0) − Zi0 δ + ∑s Xs wis ( β is − β). Under homogeneous effects,
Rs is non-random conditional on F0 , and the second and third term are equal to zero, since in this
case E[X̃s Rs | F0 ] = E[X̃s | F0 ] Rs = 0, and E[X̃s Rs X̃t Rt | F0 ] = Rs Rt E[X̃s X̃t | F0 ] = 0 if s 6= t.
Therefore, only the first term remains, and the standard error estimator consistently estimates this
term by Proposition 5.
    It can be shown that the proposition remains valid under regularity conditions if the effects β is
are heterogeneous, so that to ensure valid inference under heterogeneous effects, one needs to ensure
that the sum of the second and third term is weakly negative. This is the case under several different
settings. We now discuss two of them.
    First observe that since E[X̃s Rs | F0 ] = E[ X̃s ∑St=1 Xt wit ( β it − β) | F0 ] = σs2 wis ( β is − β), the second




                                                               53
term equals
                                                                             2
                                                  ∑Ss=1 ∑iN=1 πis ( β is − β)
                                              −                                    ,
                                                            ∑Ss=1 n2s
             2 σ2 as in the statement Proposition 3. The term is always negative, and it reflects the
where πis = wis s
variability of the treatment effect. It makes the variance estimate that we propose conservative if the
third term equals zero. This is analogous to the result that the robust standard error estimator is
conservative in randomized trials, and that the cluster-robust standard error estimator is conservative
in cluster-randomized trials (see, for example Imbens and Rubin, 2015, Chapter 6). The third term
reflects the correlation between Xs Rs and Xt Rt , and it has no analog in cluster-randomized trials.
Indeed, the term can be written as

                               1
                              ∑s n2s
                                       ∑ σs2 σt2 ∑ wis wit ( βit − β)w js w jt ( β js − β).
                                       s6=t          i,j


In the example with “concentrated sectors”, which is the analog of the cluster-randomized setup if
there are no covariates, the term is thus zero, since in that case wis wit = 0 for s 6= t. Our standard
errors are thus valid, although conservative, in this case. Another sufficient condition for validity
of inference is that β is and β jt are uncorrelated if t 6= s, in which case it follows from the display
above that the third term converges to zero. Numerical work, not reported here, indicates that the
correlation between β is and β jt needs to be quite high and depend on the shares wis in order for
the third term to dominate the second term. We therefore expect our inference to remain valid for
empirically relevant distributions of the effects β is .




                                                              54
