                               NBER WORKING PAPER SERIES




                             MACRO, MONEY AND FINANCE:
                             A CONTINUOUS TIME APPROACH

                                    Markus K. Brunnermeier
                                       Yuliy Sannikov

                                       Working Paper 22343
                               http://www.nber.org/papers/w22343


                     NATIONAL BUREAU OF ECONOMIC RESEARCH
                              1050 Massachusetts Avenue
                                Cambridge, MA 02138
                                     June 2016




This article was written for the Handbook of Macroeconomics. We are grateful to comments by
various participants of the Princeton Initiative: Macro, Money and Finance, and especially to
Zhiguo He, Lunyang Huang, Ji Huang, Falk Mazelis, Sebastian Merkel, Greg Phelan, and
Christian Wolf, as well as to the editors John Taylor and Harald Uhlig. The views expressed
herein are those of the authors and do not necessarily reflect the views of the National Bureau of
Economic Research.

At least one co-author has disclosed a financial relationship of potential relevance for this
research. Further information is available online at http://www.nber.org/papers/w22343.ack

NBER working papers are circulated for discussion and comment purposes. They have not been
peer-reviewed or been subject to the review by the NBER Board of Directors that accompanies
official NBER publications.

© 2016 by Markus K. Brunnermeier and Yuliy Sannikov. All rights reserved. Short sections of
text, not to exceed two paragraphs, may be quoted without explicit permission provided that full
credit, including © notice, is given to the source.
Macro, Money and Finance: A Continuous Time Approach
Markus K. Brunnermeier and Yuliy Sannikov
NBER Working Paper No. 22343
June 2016
JEL No. C63,E32,E41,E44,E51,G01,G11,G20

                                          ABSTRACT

This paper puts forward a teaching manual for how to set up and solve a continuous time model
that allows one to analyze endogenous (1) level and risk dynamics. The latter includes (2) tail risk
and crisis probability as well as (3) the Volatility Paradox. Concepts such as (4) illiquidity and
liquidity mismatch, (5) endogenous leverage, (6) the Paradox of Prudence, (7) undercapitalized
sectors (8) time-varying risk premia, and (9) the external funding premium are part of the
analysis. Financial frictions also give rise to an endogenous (10) value of money.


Markus K. Brunnermeier
Princeton University
Department of Economics
Bendheim Center for Finance
Princeton, NJ 08540
and NBER
markus@princeton.edu

Yuliy Sannikov
Department of Economics
208 Fisher Hall
Princeton University
Princeton, NJ 08544
sannikov@gmail.com
Contents
1 Introduction                                                                                            3
  1.1 A Brief History of Macroeconomics and Finance . . . . . . . . . . . . . . . .                       5
  1.2 The Case for Continuous Time Macro Models . . . . . . . . . . . . . . . . .                         7
  1.3 The Nascent Continuous Time Macro-finance Literature . . . . . . . . . . .                          8

2 A Simple Real Economy Model                                                                              9
  2.1 Model Setup . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .                  9
  2.2 A Step-by-Step Approach . . . . . . . . . . . . . . . . . . . . . . . . . . . .                     10
  2.3 Observations . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .                15

3 A Model with Price Effects and Instabilities                                                            17
  3.1 Optimal Portfolio Choice with General Utility Functions . . . .         .   .   .   .   .   .   .   18
  3.2 Model with Heterogeneous Productivity Levels and Preferences .          .   .   .   .   .   .   .   23
  3.3 The 4-Step Approach . . . . . . . . . . . . . . . . . . . . . . . .     .   .   .   .   .   .   .   24
  3.4 Method 1: The Shooting Method . . . . . . . . . . . . . . . . .         .   .   .   .   .   .   .   27
  3.5 Method 2: The Iterative Method . . . . . . . . . . . . . . . . .        .   .   .   .   .   .   .   33
  3.6 Examples of Solutions: CRRA Utility . . . . . . . . . . . . . . .       .   .   .   .   .   .   .   38

4 A Simple Monetary Model                                                                                 42
  4.1 Model with Idiosyncratic Capital Risk and Money . . . . . . . . . . . . . . .                       43
  4.2 The 4-Step Approach . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .                   44
  4.3 Observations and Limit Case . . . . . . . . . . . . . . . . . . . . . . . . . . .                   46

5 Critical Assessment and Outlook                                                                         49




                                               2
1     Introduction
The recent financial crisis in the US and the subsequent Euro Crisis are vivid reminders
of the importance of financial frictions in understanding macroeconomic trends and cycles.
While financial markets are self-stabilizing in normal times, economies become vulnerable
to a crisis after a run up of (debt) imbalances and (credit) bubbles. In particular, debt,
leverage, maturity and liquidity mismatch tend to rise when measured volatility is low.
Vulnerability risk tends to build up in the background, and only materializes when crises
erupt, a phenomenon referred to as the “Volatility Paradox.”
    Adverse feedback loops can make the market spiral out of balance. The dynamics of an
economy with financial frictions are highly non-linear. Small shocks lead to large economic
dislocations. In situations with multiple equilibria, runs on financial institutions or sudden
stops on countries can occur even absent any fundamental trigger. Empirically, these phe-
nomena show up as fat tails in the distribution of real economic variables and asset price
returns.
    Our research proposes a continuous time method to capture the whole endogenous risk
dynamics and hence goes beyond studying simply the persistence and amplification of an
individual adverse shock. Instead of focusing only on levels, the first moments, the second
moments, and movements of risk variables are all an integral part of the analysis, as they drive
agents’ consumption, (precautionary) savings and investment decisions. After a negative
shock, we do not assume that the economy returns to the steady state deterministically,
but rather uncertainty might be heightened making the length of the slump stochastic. As
agents respond to the new situation, they affect both the risk and the risk premia.
    Endogenous risk is time-varying and depends on illiquidity. Liquidity comes in three
flavors. Technological illiquidity refers to the irreversibility of physical investment. Instead
of undoing the initial investment, another option is to sell off the investment. This is only
reasonable when market liquidity is sufficiently high. Finally, with sufficient funding liquidity
one can issue claims against the payoffs of the assets. Incentive problems dictate that these
claims are typically short-term debt claims. Debt comes with the drawback that risk is
concentrated in the indebted sector. In addition, short-term debt leads to liquidity risk
exposure. Agents may be forced to fire-sell their assets if they cannot undo the investment,
market liquidity is low and funding is restricted, e.g. very short term. In short, when there
is a liquidity mismatch between technological and market liquidity on the asset side and
funding liquidity on the liability side of the balance sheet, the economy is vulnerable to


                                               3
instability.
    Models with financial frictions necessarily have to encompass multiple sectors. Finan-
cial frictions prevent funds from flowing to undercapitalized sectors, create debt overhang
problems, and/or preclude optimal ex-ante risk sharing. This is in contrast to a world with
perfect financial markets in which only aggregate risk matters, as all agents’ marginal rate
of substitutions are equalized in equilibrium and consequently aggregation to a single repre-
sentative agent is possible. In models with financial frictions and heterogeneous agents the
wealth distribution matters.
    Importantly, financial frictions also give rise to the value of money. Money is a liquid store
of value and safe asset. This approach provides not only a complementary perspective to
New Keynesian models, in which price and wage rigidities are the primary drivers of money
value, but also enables the revival of the traditional literature on “money and banking”.1
    Ultimately, economic analysis should guide policy. It is important to go beyond partial
equilibrium analysis since general equilibrium effects can be subtle and counterintuitive.
A model has to be tractable enough to conduct a meaningful welfare analysis to evaluate
various policy instruments. A welfare analysis lends itself to study the interaction of various
policy instruments.
    In sum, the goal of this chapter is to put forward a manual for how to set up and
solve a continuous time macro-finance model. The tractability that continuous time offers
allows us to study a host of new properties of fully solved equilibria. This includes the full
characterization of endogenous (1) level and risk dynamics. The latter includes (2) tail risk
and crisis probability as well as (3) the Volatility Paradox. In addition, it should help us
think about (4) illiquidity and liquidity mismatch, (5) endogenous leverage, (6) Paradox of
Prudence, (7) undercapitalized sectors, (8) time-varying risk premia, and (9) the external
funding premium. From a welfare perspective we would like to ask normative questions
about the (10) inefficiencies of financial crises and (11) the effects of policies using various
instruments.
    We start with a brief history of macro and finance research since the Great Depression
in the 1930s. We then put forward arguments in favor of continuous time modeling before
surveying the ongoing continuous time literature. The main part of the paper builds up a step
by step outline how to solve continuous time models starting with the simplest benchmark
and enriching the model by adding more building blocks.
  1
      See e.g. Chandler (1948).




                                                4
                                  History: Macro & Finance

                                timeline                   Verbal Reasoning (qualitative)
                                                                     Fisher, Keynes, …
                                                 Macro                                         Finance
                                            Growth theory                                Portfolio theory
                                              Dynamic (cts. time)                          Static
                                              Determinisitc                                Stochastic


                                            Introduce stochastic                         Introduce dynamics
                                              Discrete time                                Continuous time
                                                Brock-Mirman Stokey-Lucas                    Options        Black Scholes
      Brunnermeier & Sannikov




                                                Kydland-Prescott                             Term structure CIR
                                                DSGE models                                  Agency theory Sannikov


                                                      Cts. time macro with financial frictions                               3




Figure 1: Methods in Macroeconomic and Financial Research since the Great Depression

1.1           A Brief History of Macroeconomics and Finance
Macroeconomics as a field in economics was born during the great depression in the 1930s.
At that time economists like Fisher (1933), Keynes (1936), Gurley and Shaw (1955), Minsky
(1957) and Kindleberger (1978) stressed the importance of the interaction between financial
instability and macroeconomic aggregates. In particular, certain sectors in the economy
including the financial sector can become balance sheet impaired and can drag down parts
of the economy. Patinkin (1956) and Tobin (1969) also emphasized that financial stability
and price stability are intertwined and hence that macroeconomics, monetary economics and
finance are closely linked.
    As economics became more analytical and model-based, macroeconomics and finance
went into different directions. See Figure 1. Hicks’s (1937) IS-LM Keynesian macro model is
both static and deterministic. Macroeconomic growth models, most prominently the Solow
(1956) growth model, are dynamic and many of them are in continuous time. However,
they exclude stochastic elements: risk and uncertainty play no role. In contrast, the formal
finance literature starting with Markowitz (1952) portfolio theory focused exclusively on risk.
These models are static models and ignore the time dimension.
    In the 1970s and early 1980s macroeconomists introduced stochastic elements into their

                                                                               5
dynamic models. Early “fresh water” models that included time and stochastic elements were
Brock and Mirman’s (1972) Brock and Mirman’s (1972) stochastic growth model and real
business cycle models à la Kydland and Prescott (1982). The influential graduate text book
of Stokey and Lucas (1989) provided the necessary toolkit for a fully microfounded dynamic
and stochastic analysis. The “salt water” New Keynesian branch of macro introduced price
rigidities and studied countercyclical policy in rational expectations models, Taylor (1979)
and Mankiw and Romer (1991). The two branches merged and developed DSGE models
which were both dynamic, the D in DSGE, and stochastic, the S in DSGE. However, unlike in
many of the earlier growth models, time is discrete in real business cycle and New Keynesian
DSGE models à la Woodford (2003). Most DSGE models capture only the log-linearized
dynamics around the steady state. The log-linearized theoretical analysis squared nicely
with its empirical counterpart, the linear Vector Autoregression Regression (VAR) estimation
technique pioneered by Sims (1980).
    Finance also experienced great breakthroughs in the 1970s. Stochastic Calculus (Ito
calculus), which underlies the Black and Scholes (1973) option pricing model, revolutionized
finance. Besides option pricing, term structure of interest rate models like Cox et al. (1985)
were developed. More recently, Sannikov (2008) developed continuous time tools for financial
contracting, which allow one to capture contracting frictions in a tractable way.
    Our line of research is the next natural step. It essentially merges macroeconomics and
finance using continuous time stochastic models. In terms of financial frictions, it builds on
earlier work by Bernanke et al. (1999) (BGG), Kiyotaki and Moore (1997) (KM), Bianchi
(2011), Mendoza (2010) and others. Our approach replicates two important results from the
linearized versions of classic models of BGG and KM, that (1) temporary macro shocks can
have a persistent effect on economic activity by making borrowers “undercapitalized” and
(2) price movements amplify shocks. In KM, the leverage is limited by an always binding
collateral constraint. In Bianchi (2011) and Mendoza (2010) it is occasionally binding. Our
approach focuses mostly on incomplete market frictions, where the leverage of potentially
undercapitalized borrowers is usually endogenous. In particular, it responds to the magnitude
of fundamental (exogenous) macroeconomic shocks and the level of financial innovations that
enable better risk management. Interestingly, leverage responds to a much lesser extent to the
presence of endogenous tail risk. Equilibrium leverage in normal times is a key determinant
of the probability of crises.




                                              6
1.2    The Case for Continuous Time Macro Models
As economists we have no hesitation in assuming a continuous action space in order to
ensure nice first order optimality conditions that are free of integer problems. In the same
vain we typically assume a continuum of agents to guarantee an environment with perfect
competition and (tractable) price taking behavior.
    Assuming a continuous time framework has two advantages: it is often more tractable and
might conceptually be a closer representation of reality. In terms of tractability, continuous
time allows one to derive more analytical steps and more closed form characterizations of
the equilibrium before resorting to a numerical analysis. For example, in our case one can
derive explicit closed form expressions for amplification terms. The reason is that only the
slope of the price function, i.e. the (local) derivative w.r.t. state variables, is necessary to
characterize amplification. In contrast, in discrete time settings the whole price function is
needed, as the jump size may vary. Also, instantaneous returns are essentially log-normal,
which makes it easy to take expectations. It is also easy to derive the portfolio choice problem
and to link returns to net worth dynamics via the budget constraint. In discrete-time models
this feature can only be achieved through a (Campbell-Shiller) log-linear approximation. It
is therefore not surprising that the term structure literature uses continuous time models.
Admittedly, some of these features are due to the continuous nature of certain stochastic
processes, like Brownian Motions and other Ito Processes. Hereby, one implicitly assumes
that agents can adjust their consumption or portfolio continuously as their wealth changes.
The feature that their wealth never jumps beyond a specific point, e.g. the insolvency point,
greatly simplifies the exposition.
    Conceptually, in certain dimensions a continuous time representation might also square
better with reality. People do not consume only at the end of the quarter, even though data
come in quarterly. Discrete time models implicitly assume linear time aggregation within a
quarter and a non-linear one across quarters. In other words, the intertemporal elasticity of
consumption within a quarter is infinite while across quarters it is given by the curvature of
the utility function. Continuous time models treat every time unit the same. Similarly, it
is well-known that for multivariate models mixing data with different degrees of smoothness
(such as consumption data and financial data) can seriously impair inference.
    The biggest advantage of our continuous time approach is that it allows a full char-
acterization of the whole dynamical system including the risk dynamics instead of simply
a log-linearized representation around the steady state. Note that impulse response func-
tions capture only the expected path after a shock that starts at the steady state. Also,

                                               7
the stationary distribution can be bi-modal and exhibit large swings, unlike stable normal
distributions that log-linearized models imply.


1.3     The Nascent Continuous Time Macro-finance Literature
This chapter builds on Brunnermeier and Sannikov (2014).2 It extends this work by allowing
for more general utility functions, precautionary savings and for endogenous equity issuance.
Work by Basak and Cuoco (1998) and He and Krishnamurthy (2012), (2013) on intermediary
asset pricing are part of the core papers in this literature. Isohätälä et al. (2014) study a
partial equilibrium model. DiTella (2013) introduces exogenous uncertainty shocks that can
lead to balance sheet recessions even when contracting based on aggregate state variables is
possible.
    Phelan (2014) considers a setting in which banks issue equity and leverage can be pro-
cyclical. Adrian and Boyarchenko (2012) achieve procyclical leverage by introducing liquid-
ity preference shocks. Adrian and Boyarchenko (2013) consider the interaction between two
types of intermediaries: banks and non-banks. Huang (2014) studies shadow banks, which
circumvent regulatory constraints but are subject to an endogenous enforcement constraint.
In Moreira and Savov (2016)’s macro model shadow banks issue money-like claims. In down-
turns they scale back their activity. This slows down the recovery and creates a scarcity in
collateral. Klimenko et al. (2015) show that regulation that prohibits dividend payouts is
typicially superior to very tight capital requirements. In Moll (2014) capital is misallocated
since productive agents are limited by collateral constraints to lever up.
    Several papers also tried to calibrate continuous time macro-finance models to recent
events. For example, He and Krishnamurthy (2014) do so by including housing as a second
form of capital. Mittnik and Semmler (2013) employ a multi-regime vector autoregression
approach to capture the non-linearity of these models.3
    In international economics, these methods are employed in Brunnermeier and Sannikov
(2015b). In a two good, two country model, the overly indebted country is vulnerable to
sudden stops, and hence capital controls might improve welfare. Maggiori (2013) models
risk sharing across countries which are at different stages of financial development.
   2
     For an alternative survey on continuous time macro models, see e.g. Isohätälä et al. (2015).
   3
     Note that in the estimation of DSGE models, Fernandez-Villaverde and Rubio-Ramiro (2010) show
that parameter estimates and the moments generated by the model depend quite sensitively on whether a
linearized DSGE is estimated via Kalman filtering or whether the true DSGE model is estimated via particle
filtering.



                                                    8
    Models with financial frictions also open up an avenue for new models in monetary
economics thereby reviving the field “money and banking”. In “The I Theory of Money”
money is a bubble like in Samuelson (1958) or Bewley (1977). Inside money is created
endogenously by the intermediary sector, and monetary policy and macroprudential policy
interact. Achdou et al. (2015) provide a solution algorithm for Bewley models with uninsur-
able endowment risk in a continuous time setting. In Drechsler et al. (2014) banks are less
risk averse and monetary policy affects risk premia. Werning (2012) studies the zero lower
bound problem in a tractable deterministic continuous time New Keynesian model.
    Rappoport and Walsh (2012) set up a discrete time macro model, which has similar eco-
nomic results, and which converges in the continuous-time limit to the model of Brunnermeier
and Sannikov (2014).


2     A Simple Real Economy Model
We start first with a particularly simple model to illustrate how equilibrium conditions -
utility maximization and market clearing - translate into an equilibrium characterization.
This simple model trivializes most of the issues we are after, e.g. the model has no price
effects or endogenous risk. We do get some interesting takeaways, such as that risk premia
spike in crises. After establishing the conceptual framework for what an equilibrium is, we
move on to tackle more complex models.


2.1    Model Setup
This model is a variation of Basak and Cuoco (1998). The economy has a risky asset in
positive net supply and a risk-free asset in zero net supply. There are two types of agents
- experts and households. Only experts can hold the risky asset - households can only lend
to experts at the risk-free rate rt , determined endogenously in equilibrium. The friction is
that experts can finance their holdings of the risky asset only through debt - by selling short
the risk-free asset to households. That is, experts cannot issue equity. We assume that all
agents are small, and behave as price-takers. That is, unlike in microstructure models with
noise traders, agents have no price impact.




                                              9
Technology. Net of investment, physical capital, kt , generates consumption output at the
rate of
                                   (a − ιt )kt dt,

where a is a productivity parameter and ιt is the reinvestment rate per unit of capital. The
production technology is constant returns to scale.
   The productive asset (capital), kt , evolves according to

                                 dkt
                                     = (Φ(ιt ) − δ) dt + σ dZt ,                            (2.1)
                                  kt

where Φ(ιt ) is an investment function with adjustment costs, such that Φ(0) = 0, Φ0 >
0 and Φ00 ≤ 0. Thus, in the absence of investment, capital simply depreciates at rate δ.
The concavity of Φ(·) reflects decreasing returns to scale, and for negative values of ιt ,
corresponds to technological illiquidity - the marginal cost of capital depends on the rate of
investment/disinvestment.
   The aggregate amount of capital is denoted by Kt , and qt is the price of capital. Hence,
the aggregate net worth in the economy is qt Kt . If Nt is the aggregate net worth of experts,
then the aggregate net worth of households is qt Kt − Nt .
   Experts’ wealth share is denoted by

                                               Nt
                                       ηt =         ∈ [0, 1].
                                              qt Kt

Preferences. For tractability, all agents are assumed to have logarithmic utility with dis-
count rate ρ, of the form           Z ∞             
                                           −ρt
                                  E       e log ct dt ,
                                          0

where ct is consumption at time t.


2.2    A Step-by-Step Approach
Definition. An equilibrium is a map from histories of macro shocks {Zs , s ≤ t} to the
price of capital qt , risk-free rate rt , as well as asset holdings and consumption choices of all
agents, such that

  1. agents behave to maximize utility and


                                                 10
  2. markets clear.

    To find an equilibrium, we need to write down equations that the processes qt , rt , etc.
have to satisfy, and that characterize how these processes evolve with the realizations of
shocks Z. It will be convenient to express these relationships using a state variable. Here the
relevant state variable, which describes the distribution of wealth, is the fraction of wealth
owned by the experts, ηt . When ηt drops, experts become more balance sheet constrained.
    We solve the equilibrium in three steps. First, we postulate some endogenous processes.
As a second step, we use the equilibrium conditions, i.e. utility maximization and market
clearing, to write down restrictions qt and rt need to satisfy. In this simple model, we will
be able to express qt and rt as functions of ηt in closed form. Third, we need to derive the
law of motion of the state variable, the wealth share ηt .
    Step 1: Postulate Equilibrium Processes. The first step is to postulate certain
endogenous price processes. For example, suppose that the price per unit of capital qt
follows an Ito process
                                 dqt
                                     = µqt dt + σtq dZt ,                        (2.2)
                                 qt
which, of course, is endogenous in equilibrium.
   An investment in capital generates, in addition to the dividend rate (a−ι)kt dt, the capital
gains at rate
                                           d(kt qt )
                                                     .
                                             kt qt
Ito’s Lemma for the product of two stochastic processes can be used to derive this process.


 Ito’s Formula for Product. Suppose two processes Xt and Yt follow

                      dXt                            dYt
                          = µX       X
                             t dt + σt dZt     and       = µYt dt + σtY dZt .
                      Xt                             Yt

 Then the product of two processes follows

                       d(Xt Yt )
                                 = (µX    Y    X Y           X    Y
                                     t + µt + σt σt ) dt + (σt + σt ) dZt .             (2.3)
                        Xt Yt




                                               11
   Using Ito’s Lemma, the investment in capital generates capital gains at rate

                     d(kt qt )
                               = (Φ(ιt ) − δ + µqt + σσtq ) dt + (σ + σtq ) dZt .
                      kt qt

Then capital earns the return of

                          a − ιt
                drtk =           dt + (Φ(ιt ) − δ + µqt + σσtq ) dt + (σ + σtq ) dZt .   (2.4)
                            qt        |                    {z                      }
                          | {z }                 d(kt qt )
                                                           , the capital gains rate
                         dividend yield            kt qt



Thus, generally a part of the risk from holding capital is fundamental, σ dZt , and a part is
endogenous, σtq dZt .

Remarks

   • For general utility functions one also has to postulate the stochastic discount factor
     process or equivalently a process for the marginal utility or the consumption process
     dct /ct . For details see Section 3.1.

   • Note that in monetary models like Brunnermeier and Sannikov (2015, 2016) one also
     has to postulate a process pt for the value of money which can be stochastic due to
     inflation risk. In Section 4 we present a simple monetary model.

Step 2: The Equilibrium Conditions. Equilibrium conditions come in two flavors:
Optimality conditions and market clearing conditions.
    Optimal internal investment rate. Note that the rate of internal investment ιt does not
affect the risk of capital. The optimal investment rate that maximizes the expected return
satisfies the first-order condition
                                                   1
                                         Φ0 (ιt ) = .                                 (2.5)
                                                   qt
   Optimal consumption rate. Logarithmic utility has two convenient properties, which we
derive formally for a more general case in Section 3.1. These two properties help reduce the
number of equations that characterize equilibrium. First, for agents with log utility

                                     consumption = ρ · net worth                         (2.6)

that is, they always consume a fixed fraction of wealth (permanent income) regardless of the
risk-free rate or risky investment opportunities. The consumption Euler equation reduces to

                                                  12
a particularly simple form.
   Optimal portfolio choice. The optimal risk exposure of a log-utility agent in the optimal
portfolio choice problem depends on the attractiveness of risky investment, measured by the
Sharpe ratio, defined as expected excess returns divided by the standard deviation. Formally,
the equilibrium condition is

                   Sharpe ratio of risky investment = volatility of net worth,                      (2.7)

where the volatility is relative (measured as percentage change per unit of time).4
    Goods Market clearing. We use equations (2.6) and (2.7) to formalize equilibrium condi-
tions, and characterize equilibrium. First, from condition (2.6), the aggregate consumption
of all agents is ρqt Kt , and aggregate output is (a − ι(qt ))Kt , where investment ι is an increas-
ing function of q defined by (2.5). From market clearing for consumption goods, these must
be equal, and so
                                          ρqt = a − ι(qt )                                     (2.8)

is the equilibrium price of the risky capital. The aggregate consumption of experts must
be ρNt = ρηt qt Kt , and the aggregate consumption of households is ρ(1 − ηt )qt Kt . Condition
(2.8) alone leads to a constant value of the price of capital q. That is, µqt = σtq = 0.


  Example 1. Suppose the investment function takes the form

                                                   log(κι + 1)
                                          Φ(ι) =               ,
                                                        κ

  where κ is the adjustment cost parameter. Then Φ0 (0) = 1. Higher κ makes function Φ more
  concave, and as κ → 0, Φ(ι) → ι, a fully elastic investment function with no adjustment costs.
  Then the optimal investment rate is ι = (q − 1)/κ, and the market-clearing condition (2.8)
  leads to the price of
                                                   1 + κa
                                              q=          .
                                                   1 + κρ
  The price converges to 1 as κ → 0, i.e. the investment technology is fully elastic. The price q
  converges to a/ρ as κ → ∞.

   4
    For example, if the annual volatility of S&P 500 is 15% and the risk premium is 3% (so that the Sharpe
ratio is 3%/15% = 0.2), then a log utility agent wants to hold a portfolio with volatility 0.2 = 20%. This
corresponds to a weight of 1.33 on S&P 500, and -0.33 on the risk-free asset.



                                                   13
    Second, we can use condition (2.7) for experts to figure out the equilibrium risk-free
rate. We first look at the return on risky and risk-free assets to compute the Sharpe ratio
of risky investments. We then look at balance sheets of experts to compute the volatility of
their wealth. Finally, we use equation (2.7) to get the risk-free rate.
    Because q is constant, the risky asset earns a return of

                                     a−ι
                          drtk =         dt            + (Φ(ι) − δ) dt + σ dZt ,
                                       q                 |        {z         }
                                     | {z }                  capital gains rate
                                   ρ, dividend yield


and the risk-free asset earns rt . Note that the dividend yield equals ρ by the goods market
clearing condition. Hence, the Sharpe ratio of risky investment is

                                           ρ + Φ(ι) − δ − rt
                                                             .
                                                  σ

   Note that since the price-dividend ratio is constant any change in the risk premium must
come from the variation in the risk free rate rt .
   Because experts must hold all the risky capital in the economy, with value qt Kt (house-
holds cannot hold capital), and absorb risk through net worth Nt , the volatility of their net
worth is
                                         qt Kt     σ
                                               σ= .
                                          Nt       ηt
Using (2.7),
                    σ    ρ + Φ(ι) − δ − rt                                         σ2
                       =                               ⇒     rt = ρ + Φ(ι) − δ −      .      (2.9)
                    ηt          σ                                                  ηt

    Step 3: The Law of Motion of ηt . To finish deriving the equilibrium, we need to
describe how shocks Zt affect the state variable ηt = Nt /(qt Kt ). First, since ηt is a ratio, the
following formula will be helpful for us:


 Ito’s Formula for Ratio. Suppose two processes Xt and Yt follow

                      dXt                                    dYt
                          = µX       X
                             t dt + σt dZt             and       = µYt dt + σtY dZt .
                      Xt                                     Yt

 Then ratio of two processes follows

                   d(Xt /Yt )
                              = (µX    Y     Y 2    X Y           X    Y
                                  t − µt + (σt ) − σt σt ) dt + (σt − σt ) dZt .           (2.10)
                    Xt /Yt


                                                        14
    Second, it is convenient to express the laws of motion of the numerator and denominator
of ηt in terms of total risk and the Sharpe ratio given by (2.9). Specifically,

                    dNt            σ    σ       σ
                        = rt dt +           dt + dZt − ρ dt                  and
                    Nt             ηt ηt        ηt       |{z}
                                  |{z} |{z}           consumption
                                     risk Sharpe


                     d(qt Kt )                  σ
                               = rt dt + |{z}
                                           σ        dt + σ dZt −      ρ dt      .
                      q t Kt                    ηt                   |{z}
                                          risk |{z}              dividend yield
                                               Sharpe

In the latter equation, we subtract the dividend yield from the total return on capital to
obtain the capital gains rate.
   Using the formula for the ratio,

          dηt
              = (rt + σ 2 /ηt2 − ρ − rt − σ 2 /ηt + ρ + σ 2 − σ 2 /ηt ) dt + (σ/ηt − σ) dZt
          ηt

                                     (1 − ηt )2 2     1 − ηt
                                 =       2
                                               σ dt +        σ dZt .                          (2.11)
                                        ηt              ηt

    Step 4: Expressing q(η) as a function of η is not necessary in this simple model,
since q is a constant.


2.3    Observations
Several key observations about equilibrium characteristics are worth pointing out. Variable
ηt fluctuates with macro shocks - a positive shock increases the wealth share of experts. This
is because experts are levered. A negative shock erodes ηt , and experts require a higher risk
premium to hold risky assets. Experts must be convinced to keep holding risky assets by
the increasing Sharpe ratio
                                    σ    ρ + Φ(ι) − δ − rt
                                      =                    ,
                                   ηt            σ
which goes to ∞ as ηt goes to 0. Strangely, this is achieved due to the risk-free rate rt =
ρ + Φ(ι) − δ − σ 2 /ηt going to −∞, rather than due to a depressed price of the risky asset,
as illustrated in the top right panel of Figure 2.


                                                   15
                                                                                  0.1
                   1.6
                   1.4                                                             0




                                                          r t , risk-free rate
                   1.2
                                                                                 -0.1
                    1
               q




                   0.8
                                                                                 -0.2
                   0.6
                   0.4                                                           -0.3
                   0.2
                    0                                                            -0.4
                         0   0.2   0.4   0.6   0.8   1                                  0   0.2   0.4   0.6   0.8   1



               0.025                                                              0.1

                0.02                                                             0.08

               0.015                                                             0.06

                0.01                                                             0.04

               0.005                                                             0.02

                    0                                                              0
                         0   0.2   0.4   0.6   0.8   1                                  0   0.2   0.4   0.6   0.8   1




Figure 2: Equilibrium in the simple real model,
a = .11, ρ = 5%, σ = .1, and Φ = log(κι + 1)/κ with κ = 10.




                                                     16
    Because qt is constant, as illustrated in the top left panel, there is no endogenous risk,
no amplification and no volatility effects. Therefore, in this model, assumptions that allow
for such a simple solution also eliminate any price effects that we are so interested in. We
have to work harder to get those effects.
    Besides the absence of price effects, in this model it is also the case that in the long run the
expert sector becomes so large that it overwhelms the whole economy. To see this, note that
the drift of ηt is always positive. This feature is typical of models in which one group of agents
has an advantage over another group - in this case only experts can invest in the risky asset.
It is possible to prevent the expert sector from becoming too large through an additional
assumption. For example, Bernanke et al. (1999) assume that experts are randomly hit by
a shock that makes them households. Alternatively, if experts have a higher discount rate
than households, then a greater consumption rate prevents the expert sector from becoming
too large.
    The main purpose of this section was to show how equilibrium conditions can be trans-
lated into formulas that describe the behavior of the economy. Next, we can consider more
complicated models, in which the price of the risky asset qt reacts to shocks. We also de-
velop a methodology that allows for agents to have more complicated preferences and for a
nontrivial distribution of assets among agents.


3     A Model with Price Effects and Instabilities
We now illustrate how our step approach can be used to solve a more complex model, which
we borrow and extend from Brunnermeier and Sannikov (2014). We will be able to get a
number of important takeaways from the model:

    1. Equilibrium dynamics are characterized by a relatively stable steady state, where the
       system spends most of the time, and a crisis regime. In the steady state, experts are
       adequately capitalized and risk premia fall. The experts’ consumption offsets their
       earnings - hence the steady state is formed. Experts have the capacity to absorb most
       macro shocks, hence prices near the steady state are quite stable. However, an un-
       usually long sequence of negative shocks causes experts to suffer significant losses, and
       pushes the equilibrium into a crisis regime. In the crisis regime, experts are undercap-
       italized and constrained. Shocks affect their demand for assets - market liquidity at
       the macro level can dry up -, and thus affect prices of the assets that experts hold.


                                                17
      This creates feedback effects, which generate fire-sales and endogenous risk. Volatility
      is endogenous and also feeds back in agents’ behavior.

   2. High volatility during crisis times may push the system into a very depressed region,
      where experts’ net worth is close to 0. If that happens, it takes a long time for the
      economy to recover. Thus, the system spends a considerable amount of time far away
      from the steady state. The stationary distribution may be bimodal.

   3. Endogenous risk during crises makes assets more correlated.

   4. There is a “Volatility Paradox” , because risk-taking is endogenous. If the aggregate
      risk parameter σ becomes smaller, the economy does not become more stable. The
      reason is that experts allow greater leverage, and pay out profits sooner, in response
      to lower fundamental risk. Due to greater leverage, the economy is prone to crises
      even when exogenous shocks are smaller. In fact, endogenous risk during crises may
      actually be higher when σ is lower.

   5. Financial innovations, such as securitization and derivatives hedging, that allow for
      more efficient risk-sharing among experts, may make the system less stable in equilib-
      rium. The reason, again, is that risk-taking is endogenous. By diversifying idiosyn-
      cratic risks, experts tend to increase leverage, amplifying systemic risks.

   Before going into details how we can extend our simple real economy model from section
2 to display these additional features, we take a detour to discuss the classic problem of
optimal consumption and portfolio choice in continuous time.


3.1     Optimal Portfolio Choice with General Utility Functions
We start with a brief description of how to extend the optimal consumption and portfolio
choice conditions (such as (2.6) and (2.7)) to the case of a general utility function. The key
result is that any asset, which an agent can hold, can be priced from the agent’s marginal
utility of wealth θt . The first-order condition for optimal consumption is θt = u0 (ct ), so the
marginal utility of wealth is also the marginal utility of consumption (unless the agent is “at
the corner”).5
   5
     If the agent is risk-neutral, then his marginal utility of consumption is always 1, but the agent may
choose to not consume if his marginal utility of wealth is greater than 1.




                                                   18
    If the agent has discount rate ρ then ξt = e−ρt θt is the stochastic discount factor (SDF)
to price assets. We can write
                                    dξt
                                        = −rt dt − ςt dZt ,                                (3.1)
                                     ξt
where rt is the (shadow) risk-free rate and ςt is the price of risk dZt .
  For any asset A that the agent can invest in, with return

                                       drtA = µA       A
                                               t dt + σt dZt ,


we must have
                                           µA            A
                                            t = rt + ςt σt .                                       (3.2)

   Equations (3.1) and (3.2) are simple, yet extremely powerful.
   Martingale Method. To derive equation (3.2) consider a trading strategy of investing
1 dollar into asset A at time 0 and keep on reinvesting any dividends the asset might pay
out. Denote the value of this strategy at time t by vt (then v0 = 1, obviously). Clearly, its
capital gains rate is
                                         dvt
                                             = drtA .
                                         vt
For an arbitrary s ≤ t consider an investor who can only trade at s and t. That is, he faces
a simple two-period portfolio problem. The Euler equation for the standard two-period
portfolio problem is                       
                                       ξt
                             vs = Es      vt ⇒ ξs vs = Es [ξt vt ].
                                       ξs
That is, ξt vt must be a martingale on the time domain {s, t}. For an investor who can trade
continuously ξt vt must be a martingale for any t, since we picked s, t arbitrarily. Next, by
Itô’s formula

    d(ξt vt )
              = (µξt + µvt + σtξ σtv )dt + (σtξ + σtv )dZt = (−rt + µA       A         A
                                                                     t − ςt σt )dt + (σt − ςt )dZt .
     ξt vt

This is a martingale if and only if the drift vanishes, i.e. equation (3.2) holds.
   Derivation via Stochastic Maximum Principle. One can also derive the pricing
equations and consumption rule using the stochastic maximum principle. Let us consider an
agent who maximizes                 Z          ∞    
                                       E            e−ρt u(ct ) dt ,
                                            0



                                                     19
and whose net worth follows
                                                                            !
                                      X
                  dnt = nt rt dt +              xA    A              A
                                                 t ((µt − rt ) dt + σt dZt )     − ct dt,
                                        A


with initial wealth n0 > 0 and where xA
                                      t are portfolio weights on various assets A. Investment
opportunities are stochastic and exogenous, i.e. they do not depend on the agent’s strategy.
   The stochastic maximum principle allows us to derive first-order conditions for maxi-
mization from the Hamiltonian. Introducing a multiplier ξt on nt (i.e. marginal utility of
wealth) and denoting the volatility of ξt by −ςt ξt , the Hamiltonian is written as
                                        X                                        X
            H = e−ρt u(c) + ξt {(rt +            xA (µA
                                                      t − rt ))nt − c} − ςt ξt        xA σtA nt .
                                            A
                                 |                   {z              }           |A    {z       }
                                                  drift of nt                    volatility of nt


    By differentiating the Hamiltonian with respect to controls, we get the first-order condi-
tions, and by differentiating it with respect to the state nt , we get the law of motion of the
multiplier ξt .
    The first-order condition with respect to c is

                                            e−ρt u0 (ct ) = ξt ,

which implies that the multiplier on the agent’s wealth is his discounted marginal utility of
consumption. The first-order condition with respect to the portfolio weight xA is

                                     ξt (µA                 A
                                          t − rt ) − ςt ξt σt = 0,


which implies (3.2).
   In addition, the drift of ξt is
                                                −Hn = −ξt rt ,

where we already used the first-order conditions with respect to xA to perform cancellations.
It follows that the law of motion of ξt is

                                     dξt = −ξt rt dt − ςt ξt dZt ,

which corresponds to (3.1).


                                                       20
   Value Function Derivation for CRRA Utility. Macroeconomists are most familiar
with this method. With CRRA utility, the agent’s value function takes a power form

                                                 u(ωt nt )
                                                           .                                          (3.3)
                                                    ρ

This form comes from the fact that if the agent’s wealth changes by a factor of x, then his
optimal consumption at all future states changes by the same factor - hence ωt is determined
so that u(ωt )/ρ is the value function at unit wealth. Marginal utility of consumption and
marginal utility of wealth are equated if c−γ
                                           t  = ωt1−γ n−γ
                                                       t /ρ, or

                                           ct         1−1/γ
                                              = ρ1/γ ωt     .                                         (3.4)
                                           nt

For log utility, γ = 1 and this equation implies that ct /nt = ρ as we claimed in (2.6).
   For γ 6= 1, by expressing ωt as a function of the consumption rate ct /nt , we find that the
agent’s continuation utility is
                                            c−γ
                                             t nt
                                                  .                                       (3.5)
                                            1−γ
This remarkable expression shows that the agent’s net worth and consumption rate are
sufficient to compute the agent’s welfare, and no additional information about the agent’s
stochastic investment opportunities is needed.
    Given the agent’s (postulated) consumption process of

                                      dct
                                          = µct dt + σtc dZt ,
                                      ct

by Ito’s Lemma, marginal utility c−γ follows

                       d(c−γ
                                                       
                          t )         c   γ(γ + 1) c 2
                         −γ   =    −γµt +         (σt )   dt − γσtc dZt .                             (3.6)
                        ct                   2

Substituting this into (3.2), we obtain the following relationship for the pricing of any risky
asset relative to the risk-free asset:

                                       µA
                                        t − rt
                                               = γσtc = ςt .                                          (3.7)
                                         σtA

                                           dξt                 d(c−γ
                                                                  t )
Recall that ξt = e−ρt u0 (ct ) and hence   ξt
                                                 = −ρ −         c−γ
                                                                      .   Minus the drift of the SDF is the
                                                                 t




                                                    21
risk-free rate, i.e.
                                                       γ(γ + 1) c 2
                                    rt = ρ + γµct −            (σt ) .                               (3.8)
                                                          2
    Two special cases with particularly nice analytical solutions deserve special attention.

  Example with CRRA and Constant Investment Opportunities. With constant investment op-
  portunities, then ωt is a constant, hence (3.4) implies that σtc = σtn , just like in the logarithmic
  case. Hence, (3.7) implies that
                                             µA
                                              t −r
                                                    = γσtn ,
                                               σtA
                                             | {z }
                                                ς

  i.e. the volatility of net worth is the Sharpe ratio divided by the risk aversion coefficient γ. Note
  that this property also holds when ωt is not a constant as long as it evolve deterministically.
      Now, the agent’s net worth follows

                                  dnt          ς2     ς      ct
                                      = r dt +    dt + dZt −    dt,
                                  nt           γ      γ      nt

  and, since consumption is proportional to net worth, (3.8) implies that

                     ς2          γ(γ + 1) ς 2                                           ς2
                                                                                          
                          ct                                   ct     γ−1
           r =ρ+γ r+    −      −                           ⇒      =ρ+              r−ρ+          .
                     γ    nt        2     γ2                   nt      γ                2γ

  Hence, consumption ratio increases with better investment opportunities when γ > 1 and falls
  otherwise.



  Example with Log Utility. We can verify that the consumption and asset-pricing relationships
  for logarithmic utility of equation. Note from (3.4) follows directly (2.6),

                                                ct = ρnt .

  Since the SDF is ξt = e−ρt /ct = e−ρt /(ρnt ) (for any ωt ) it follows that σtn = σtc = ςt (i.e. minus
  the volatility of ξt ). Hence, (3.2) implies that

                                             µA
                                              t − rt
                                                     = σtn ,
                                               σtA

  where the left hand side is the Sharpe ratio, and the right hand side is the volatility of net
  worth.


                                                      22
3.2     Model with Heterogeneous Productivity Levels and Prefer-
        ences
In order to study endogenous risk, market illiquidity, fire-sales etc., we now assume that
the household sector can also hold physical capital, but households are assumed to be less
productive. Specifically, their productivity parameter a < a, and hence their willingness to
pay for capital, is lower than that of experts. In this generalized setting, experts now have
only two ways out when they become less capitalized and want to scale back their operation:
fire-sell the capital to households at a possibly large price discount (market illiquidity) or
“uninvest’’ and suffer adjustment costs (technological illiquidity).
    Less productive households earn a return of

                            a − ιt
                  drkt =           dt + (Φ(ιt ) − δ + µqt + σσtq ) dt + (σ + σtq ) dZt                (3.9)
                              qt        |                    {z                      }
                            | {z }                 d(qt kt )
                                                                   , the capital gains rate
                           dividend yield                 q t kt



when they manage the physical capital. The households’ return differs from that of experts,
(2.4), only in the dividend yield that they earn.
    We generalize the model in several other ways. (i) We enable experts to issue some
(outside) equity, even though they cannot be 100% equity financed. Specifically, we suppose
that experts must retain at least a fraction χ ∈ (0, 1] of equity. (ii) We generalize the
model by including a force that prevents experts from “saving their way out” away from the
constraints. In particular, we assume that experts could have a higher discount rate ρ than
that of households, ρ. (iii) Equipped with the results derived in Subsection 3.1 we generalize
experts’ and households’ utility functions from log to CRRA with risk aversion coefficient
γ.6
    To summarize, experts and households maximize, respectively
                           Z     ∞                                   Z      ∞               
                                      −ρt                                          −ρt
                       E              e     u(ct ) dt,   and E                     e     u(ct ) dt.
                              0                                            0


We denote the fraction of capital allocated to experts by ψt ≤ 1 and the fraction of equity
retained by experts by χt ≥ χ.
   6
    Brunnermeier and Sannikov (2014) explicitly consider the case of risk-neutral experts and households.
Experts are constrained to consume nonnegative quantities, but households can consume both positive and
negative amounts. This assumption leads to the simplification that the risk-free rate in the economy rt
always equals the households’ discount rate ρ.



                                                         23
    We want to characterize how any history of shocks {Zs , s ≤ t} maps to equilibrium prices
qt and rt , asset allocations ψt and χt , and consumption so that (1) all agents maximize utility
through optimal consumption and portfolio choices and (2) markets clear. Agents optimize
portfolios subject to constraints (no short-selling of capital and a bound on equity issuance
by experts). For example, households can invest in capital, the risk-free asset, and experts’
equity, and optimize over portfolio weights on these three assets (with a nonnegative weight
on capital). Thus, the solution is based on a classic problem in asset pricing. Note also
that because the required returns are different between households and experts, the experts’
inside equity will generally earn a different return from the equity held by households -
experts will earn “management fees” that households do not earn.7


3.3     The 4-Step Approach
We can solve for the equilibrium in four steps. First, postulate processes for prices and
stochastic discount factor. Second, write down the consumption-portfolio optimization and
market-clearing conditions. These conditions imply a stochastic law of motion of the price
qt , the required risk premia for experts and households ςt and ς t , together with variables ψt
and χt . Third, focusing on the experts’ balance sheets we write down the law of motion of
expert’s wealth share
                                                 Nt
                                           ηt =        ,
                                                q t Kt
as a percentage of the whole wealth in the economy. As before, Kt is the total amount
of capital in the economy. Fourth, we look for a Markov equilibrium, and characterize
equations for qt , ψt , etc., as functions of ηt . We solve these equations numerically either as
a system of ordinary differential equations (using the shooting method) or as a system of
partial differential equations in time, via a procedure analogous to value function iteration
in discrete time.
    Step 1: Postulating Equilibrium Processes. As before we postulate the equilibrium
prices process for physical capital.

                                         dqt
                                             = µqt dt + σtq dZt .
                                         qt
   7
    This is not a universal assumption in the literature. For example, He and Krishnamurthy (2013) assume
that returns are equally split between experts and households, so that rationing is required to prevent
households from demanding more expert equity than the total supply of expert equity.



                                                   24
Furthermore, as experts and household have different investment opportunities, we postulate
two stochastic discount factor (SDF) processes, one for experts and one for households.

                        dξt                                      dξ t
                            = −rt dt − ςt dZt ,         and             = −rt dt − ς t dZt ,
                        ξt                                        ξt

respectively. Note that since both can trade the risk-free asset the drift of both SDF processes
has to be the same.
   Step 2: Equilibrium Conditions. Note that since both experts and households can
trade the risk-free asset the drift of both SDF processes has to be the same, i.e. rt = rt .
Moreover, (3.2) implies the following asset-pricing relationship for capital held by experts:
                        a−ιt
                         qt
                               + Φ(ιt ) − δ + µqt + σσtq − rt
                                                                       = χt ςt + (1 − χt )ς t ,       (3.10)
                                          σ + σtq

where χt is the inside equity share, i.e. the fraction of risk held by experts.
     The required return on capital held by experts depends on the equilibrium capital struc-
ture that experts use. If experts require a higher risk premium than households, then χt = χ,
i.e. experts will issue the maximum equity they can. Thus, we have8

                                 χt = χ if ςt > ς t ,         otherwise ςt = ς t .

Under this condition, we can replace χt with χ in (3.10).
  An asset-pricing relationship for capital held by households is
                                  a−ιt
                                   qt
                                         + Φ(ιt ) − δ + µqt + σσtq − rt
                                                                               ≤ ς t,                 (3.11)
                                                    σ + σtq

with equality if ψt < 1, i.e. households hold capital in positive amounts. Note that house-
holds may choose not to hold any capital, and if so, then the Sharpe ratio they would earn
from capital could fall below that required by the asset-pricing relationship.
   It is useful to combine (3.10) and (3.11), eliminating µqt and rt , to obtain

                                            (a − a)/qt
                                                       ≥ χ(ςt − ς t ),                                (3.12)
                                              σ + σtq
   8
     We can rule out the case that ςt < ς t and χt = 1 : experts cannot face lower risk premia than households
if households hold zero risk.



                                                         25
with equality if ψt < 1.
   The required risk premia can be tied to the agents’ consumption processes via (3.24) in
the CRRA case and to the agents’ net worth processes in the special logarithmic case. Under
the baseline risk-neutrality assumptions of Brunnermeier and Sannikov (2014), ς = 0 when
households are risk-neutral and financially unconstrained - i.e. they can consume negatively.
   We will use these conditions to characterize qt , ψt , χt , etc. as functions of ηt . Before we
do that, though, we must derive an equation for the law of motion of ηt = Nt /(qt Kt ).
   Step 3: The Law of Motion of ηt . It is convenient to express the laws of motion of
the numerator and denominator of ηt by focusing on risks and risk premia. Specifically, the
experts’ net worth follows

                  dNt           χt ψt                                     Ct
                      = rt dt +       (σ + σtq ) (    ςt     dt + dZt ) −    dt.
                  Nt              ηt                |{z}                  Nt
                                |      {z     } risk premium
                                         risk


To derive the evolution of qt Kt , note that the capital gains rate is the same for both type
of agents. Thus, we can just aggregate the individual laws of motion to an aggregate law of
motion. After replacing the term Φ(ιt ) − δ + µqt − σσtq − rt using (3.10), we obtain

             d(qt Kt )                                                    a − ιt
                       = rt dt + (σ + σtq ) (χςt + (1 − χ) ς t ) dt + dZt −       dt.
              qt Kt                                                          qt

This is the total return on capital (e.g. that held by experts) minus the dividend yield.
   Using the already familiar formula (2.10) for a ratio of two stochastic processes, we have
                                             
  dηt                           a − ιt   Ct              χt ψt − ηt
      = µηt dt + σtη dt =              −          dt +              (σ + σtq ) ((ςt − σ − σtq ) dt + dZt ) +
   ηt                             qt     Nt                  ηt

                                     (σ + σtq )(1 − χ)(ςt − ς t ) dt.                                  (3.13)

    Step 4: Converting the Equilibrium Conditions and Laws of Motion (3.13)
into Equations for q(η), θ(η), ψ(η), χ(η) etc. The procedure to convert the equilibrium
conditions and the law of motion of ηt into numerically solvable equations for q(η), ψ(η),
etc., depends on the underlying assumptions on the agents’ preferences. (The log-utility case
is the easiest to solve.) In each case, we have to use Ito’s Lemma, which allows us to replace
terms such as σtq , σtθ , µqt etc. with expressions containing the derivatives of q and θ, in order
to arrive at solvable differential equations for these functions in the end.


                                                     26
   For example, using Ito’s Lemma we can tie the volatility of qt with the first derivative of
q(η) as follows

                              σtq q(η) = q 0 (η) (χt ψt − ηt )(σ + σtq ) .                 (3.14)
                                                 |        {z          }
                                                                 ησtη

   Rewriting equation (3.14) yields a closed form solution for the amplification mechanism.


                                                     χt ψt
                                                         ηt
                                                             −1
                                  σtη   =                         q 0 (ηt )
                                                                               σ         (3.15)
                                            1−   [ χηt ψt t − 1] q(η  t )/ηt




     The numerator χηt ψt t −1 captures the leverage ratio of the expert sector. The amplification
increases with the leverage ratio, the leverage effect. The denominator captures the “loss
spiral”. Mathematically, it reflects an infinite geometric series. The impact of the loss
                                                                                   q0
spiral increases with the product of the leverage ratio and price elasticity, q/η     . The latter
measures “market illiquidity”, the percentage price impact due to a percentage decline in ηt .
Market illiquidity arises from the technological specialization of capital, measured here by
the difference a − a between the experts’ and households’ productivity parameters. Market
illiquidity interacts with technological illiquidity, captured by the curvature of Φ(·).
     There are various methods to solve the equilibrium equations. Below, we discuss two
methods that have been used in practice. One method involves ordinary differential equa-
tions (ODE) - we refer to it as the “shooting method” and illustrate it using the risk-neutral
preferences of Brunnermeier and Sannikov (2014). The second method involves partial dif-
ferential equations, and is reminiscent of value function iteration in discrete time.


3.4    Method 1: The Shooting Method
This method involves converting the equations above into a system of ODEs. Before we
dive into this, in order to understand how this can be done, we review a very simple and
well-known model to illustrate the gist of what we have to do. The model illustrates the
pricing of a perpetual American put.




                                                     27
 Example 3. Consider the problem of pricing a perpetual option to abandon an asset for an
 amount K. Given a risk-free rate of r and volatility σ, if the asset pays no dividends, its value
 follows a geometric Brownian motion

                                          dVt
                                              = r dt + σ dZt                                   (3.16)
                                          Vt

 under the risk-neutral measure.
     Under the risk-neutral measure, the expected return of any security must be r. Thus, if the
 put value Pt follows dPt = µPt Pt dt + σtP Pt dZt , then we must have

                                                 r = µPt .                                     (3.17)

     Suppose we would like to calculate how the put value Pt depends on the value of the assets
 Vt . Then we face a problem that is completely analogous to the model with financial frictions
 we described in this section. We have a law of motion of the state variable Vt and a relationship
 (3.17) that the stochastic evolution of Pt has to satisfy, and we would like to characterize Pt as
 a function of Vt .
     How can we do this? Easy. Using Ito’s Lemma

                                                        1
                                µPt Pt = rVt P 0 (Vt ) + σ 2 Vt2 P 00 (Vt ),
                                                        2

 and so (3.17) becomes
                                      rV P 0 (V ) + 12 σ 2 V 2 P 00 (V )
                                   r=                                    .                     (3.18)
                                                  P (V )
 If function P (V ) satisfies this equation, then the process Pt = P (Vt ) will satisfy (3.17). We are
 able to go from an equation like (3.17) to a differential equation (3.18) by assuming that the
 value of the put is a function of the value of the asset.
     We can solve the second-order ordinary differential equation (ODE) (3.18) if we have two
 boundary conditions. We have P (V ) → 0 as V → ∞ since the put becomes worthless if it is
 never exercised. We also have P (V ) − (K − V ) ≥ 0, since P (V ) must equal the intrinsic value
 at the point where the put is exercised.



    Our problem is similar: we have an equation for the stochastic law of motion of the
state variable (3.13), as well as the equilibrium conditions that processes q(ηt ), ψ(ηt ), etc.
must satisfy. Certainly, the equations are more complicated than those of the put-pricing
problem, and the law of motion of ηt is endogenous. However, the mechanics of solving these

                                                    28
equations is the same - we have to use Ito’s Lemma.
    Here we illustrate the derivation of an appropriate set of ordinary differential equations, as
well as the “shooting” method for solving them, using the risk-neutral model of Brunnermeier
and Sannikov (2014). Assume that experts and households are risk neutral, and while experts
must consume non-negatively, households can have both positive and negative consumption.
Then the required risk premium of households is ς t = 0. The required risk premium of experts
is −σtθ , where θt is the marginal utility of the experts’ wealth that follows

                                      dθt
                                          = µθt dt + σtθ dZt .
                                       θt

    We would like to construct differential equations to solve for the functions q(η), θ(η) and
ψ(η). The equations will be of second order in q(η) and θ(η), i.e. we will design a procedure
to compute q 00 (η) and θ00 (η), as well as ψ(η), from η, q(η), q 0 (η) and θ(η), θ0 (η). Note also
that, since households demand no risk premium, i.e. ς t = 0, experts will issue the maximum
allowed fraction of equity to households, so χt = χ at all times.
    In this case q(η) is an increasing function that satisfies the boundary condition

                                                      a−ι
                                   q(0) = max                   ,
                                               ι   r − Φ(ι) + δ

the Gordon growth formula for the value of capital when it is permanently managed by
households. Any expert can get infinite utility if he can buy capital at the price of q(0), so

                                           lim θ(η) = ∞.                                    (3.19)
                                          η→0


Function θ(η) is decreasing: the marginal value of the experts’ net worth is declining as η
rises, and investment opportunities become less valuable. Experts refrain from consumption
whenever θ(η) > 1, and consume only at point η ∗ where θ(η ∗ ) = 1, i.e. the marginal value
of the experts’ net worth is exactly 1. That point becomes the reflecting boundary of the
system. That is, the system does not go beyond the reflecting boundary and is rather thrown
back. In addition, at the reflecting boundary η ∗ functions q(η) and θ(η) must satisfy

                                       q 0 (η ∗ ) = θ0 (η ∗ ) = 0.




                                                   29
   Now to the differential equations. Equation (3.14) implies that

                                                              σ
                                     σ + σtq =        q 0 (η)
                                                                              ,                           (3.20)
                                                 1−   q(η)
                                                              (χψt   − ηt )

and by Ito’s Lemma,
                                            θ0 (η)  (χψt − ηt )σ
                                    σtθ =                               .                                 (3.21)
                                            θ(η) 1 − q0 (η) (χψt − ηt )
                                                       q(η)

Therefore, plugging these expressions into the asset-pricing equation (3.12), we obtain

                               a−a       θ0 (η)           (χψ − η)σ 2
                                    ≥ −χ                                           2 .                   (3.22)
                               q(η)      θ(η)
                                                
                                                              q 0 (η)
                                                      1−      q(η)
                                                                      (χψ   − η)

Assuming that q 0 (η) > 0 and θ0 (η) < 0, the right-hand side is increasing from 0 to ∞ as
χψ − η rises from 0 to q(η)/q 0 (η). Thus, we have to set ψ = 1 whenever it is possible to
do so (i.e. χ − η < q(η)/q 0 (η)) and this is consistent with inequality (3.22). Otherwise we
determine ψ by solving the quadratic equation (3.22), in which we replace the ≥ sign with
equality.
   After that, we can find σtq from (3.20), σtθ from (3.21), µηt and σtη from (3.13) (where
we set Ct = 0 since experts consume only at the boundary η ∗ ), µqt from the asset-pricing
condition
                    a − ιt
                           + Φ(ιt ) − δ + µqt + σσtq − r = χ(σ + σtq )(−σtθ ),
                      qt
µθt from the pricing condition for the risk-free asset

                                                µθt = ρ − r,

and q 00 (η) as well as θ00 (η) from Ito’s formula,

                                1                                                 1
       µqt q(η) = µηt ηq 0 (η) + (σtη )2 η 2 q 00 (η) and µθt θ(η) = µηt ηθ0 (η) + (σtη )2 η 2 θ00 (η).
                                2                                                 2

    Solving the system of ODEs numerically. We can use an ODE solver in Matlab,
such as ode45, to solve the system of equations. We need to perform a search, since our
boundary conditions are defined at two endpoints of [0, η ∗ ], and we also need to deal with
a singularity at η = 0. The following algorithm performs an appropriate search and deals
with the singularity issue, effectively, by solving the system of equations with the boundary

                                                     30
condition θ(0) = M, for a large constant M, instead of (3.19):9
       Algorithm. Set

                                    a−ι
                   q(0) = max                 ,       θ(0) = 1 and θ0 (0) = −1010 .
                             ι   r − Φ(ι) + δ

Perform the following procedure to find an appropriate boundary condition q 0 (0). Set qL = 0
and qH = 1015 . Repeat the following loop 50 times. Guess q 0 (0) = (qL + qH )/2. Use Matlab
function ode45 to solve for q(η) and θ(η) on the interval [0, ?) until one of the following
events is triggered, either (1) q(η) reaches the upper bound

                                                          a−ι
                                      qmax = max                    ,
                                                  ι    r − Φ(ι) + δ

(2) the slope θ0 (η) reaches 0 or (3) the slope q 0 (η) reaches 0. If integration has terminated
for reason (3), we need to increase the initial guess of q 0 (0) by setting qL = q 0 (0). Otherwise,
we decrease the initial guess of q 0 (0), by setting qH = q 0 (0).
    At the end, θ0 (0) and q 0 (0) reach 0 at about the same point, which we denote by η ∗ .
Divide the entire function θ by θ(η ∗ ).10 Then plot the solutions.


    Properties of the Solution. Let us interpret the solution of the risk-neutral model.
Point η ∗ plays the role of the steady state of our system. The drift of ηt is positive everywhere
on the interval [0, η ∗ ), because the expert sector, which is more productive than the household
sector, is growing in expectation. Thus, the system is pushed towards η ∗ by the drift.
    It turns out that the steady state is relatively stable, because volatility is low near η ∗ . To
see this, recall that the amount of endogenous risk in asset prices, from (3.14), is given by

                                           q 0 (η) (χψt − ηt )σ
                                   σtq =                               .
                                           q(η) 1 − q0 (η) (χψt − ηt )
                                                       q(η)


From the boundary conditions, q 0 (η ∗ ) = 0, so there is no endogenous risk near η ∗ .
    However, below η ∗ , endogenous risk increases as q 0 (η) becomes larger. As prices react
to shocks, fundamental risk becomes amplified. As we see from the expression for σtq , this
amplification effect is nonlinear, since q 0 (η) enters not only the numerator, but also the
   9
    Footnote 10 below explains why it actually does not to matter what exact value one sets for θ(0).
  10
     We can do this because whenever functions θ and q satisfy our system of equation, so do functions Θθ
and q for any constant Θ. Because of that, also, it is immaterial what we set θ(0) to 1.


                                                      31
                                  1.6                                                      1

                                  1.4                                                     0.8

                                  1.2                                                     0.6




                                                                                    ση
               q
                                   1                                                      0.4

                                  0.8                                                     0.2

                                                                                           0
                                        0    0.2         0.4         0.6     0.8                0   0.2   0.4   0.6   0.8
                                                          η                                                η


                                  10                                                      0.1

                                   8                                                     0.08
                expert leverage




                                   6                                                     0.06




                                                                                    σq
                                   4                                                     0.04

                                   2                                                     0.02

                                   0                                                       0
                                        0   0.2    0.4         0.6     0.8    1                 0   0.2   0.4   0.6   0.8
                                                         η                                                 η




         Figure 3: Equilibrium with σ = 25% (black), 10% (blue) and 2.5% (red).

denominator. This happens due to the feedback effect: an initial shock causes ηt to drop,
which leads to a drop in qt , which hurts experts who are holding capital and leads to a
further decrease in ηt , and so on.
    Of course, far in the depressed region the volatility of ηt , σtη ηt , becomes low again in this
model. This leads to a bimodal stationary distribution of ηt in equilibrium.11
   Volatility paradox refers to the phenomenon that systemic risk can build up in quiet
environments. We can illustrate this phenomenon through comparative statics on σ or the
degree of the experts’ equity constraint χ. One may guess that the system becomes much
more stable as σ or χ decline.
   This is not the case, as illustrated in Figure 3 for parameters ρ = 6%, r = 5%, a = 11%,
                                                                      √
a = 5%, δ = 3% and an investment function of the form Φ(ι) = κ1 ( 1 + 2κι − 1), κ = 10,
χ = 1 and various values of σ. (The investment technology in this example has quadratic
adjustment costs: an investment of Φ + κΦ2 /2 generates new capital at rate Φ.)
   The volatility paradox shows itself in a number of metrics. As exogenous risk declines,
  11
    One can prove that the stationary distribution is bimodal analytically by analyzing the asymptotic
properties of the solutions near η = 0 and using the Kolmogorov forward equations that characterize the
stationary density - see Brunnermeier and Sannikov (2014) for details.


                                                                                   32
                           1.6                                             1

                           1.4                                            0.8

                           1.2                                            0.6




                                                                    ση
                q

                                   1                                      0.4

                           0.8                                            0.2

                                                                           0
                                       0   0.2   0.4   0.6   0.8                0   0.2   0.4   0.6   0.8
                                                  η                                        η


                                   5                                      0.1

                                   4                                     0.08
                 expert leverage




                                   3                                     0.06



                                                                    σq
                                   2                                     0.04

                                   1                                     0.02

                                   0                                       0
                                       0   0.2   0.4   0.6   0.8                0   0.2   0.4   0.6   0.8
                                                  η                                        η




             Figure 4: Equilibrium with χ = 1 (red), 0.5 (blue) and 0.25 (black).


   • maximal endogenous risk σtq may increase (as σ drops from 25% to 10% in Figure 3)

   • the volatility σtη near η = 0 rises (and this result can be proved analytically)

   • from the steady state η ∗ it takes less time for volatility σ + σtq to double

   • from the steady state, it may take less time to reach the peak of the crisis η ψ , where
     experts start selling capital to households.12

    Figure 4 takes the same parameters and σ = 20%, but varies χ. As χ falls, expert net
worth at the steady state η ∗ drops significantly, and the volatility σtη in the crisis regime
rises.


3.5     Method 2: The Iterative Method
Here we describe the iterative method of finding the equilibrium, by solving a system of par-
tial differential equations back in time away from a terminal condition. Specifically, imagine
  12
    As σ declines, the system spends less time in the crisis region, so some measures of stability improve,
but the amount of time spent in crisis does not converge to 0 as σ → 0.


                                                                   33
an economy that lasts for a finite time horizon [0, T ]. Given a set of terminal conditions
at time T, we would like to compute the equilibrium over the time horizon [0, T ]. The it-
erative method is based on the premise that as we let T → ∞, behavior at time 0 should
converge to the equilibrium of the infinite-horizon economy. Computation uses the equilib-
rium conditions that express the drifts of various processes, and uses those drifts to obtain
time derivatives for the corresponding functions of the state space. The iterative method is
analogous to value function iteration in discrete time.
    We illustrate the method here based on a model with CRRA utility

                                                        c1−γ
                                               u(c) =        .
                                                        1−γ

Equilibrium conditions (3.10) and (3.8) provide two equations that express the drift of the
price qt , as well as the drifts of aggregate consumption of experts Ct and households C t .
We also have another asset-pricing condition (3.12), which does not contain any drift terms.
In the end we have three functions but only two drift conditions. As a result, the time
dimension of our computation involves only two functions - the value functions of experts
and households - and the third function, the price, is found for each time point through a
separate procedure.13
    Our procedure is literally the analogue of value function iteration (but with multiple
agents affecting the evolving stochastic state). It is convenient to derive directly the equations
that value functions must satisfy. The value functions of experts and households can be
presented in the form

                                Kt1−γ        vt     Nt1−γ             Kt1−γ
                             vt       =                        and vt       .
                                1−γ     (ηt qt )1−γ 1 − γ             1−γ

Since the marginal utilities of consumption and wealth must be the same, we have

                     vt              vt −γ                        (ηt qt )1/γ−1          (ηt qt )1/γ
       Ct−γ =                Nt−γ =       K      ⇒      Ct = Nt                   = Kt                 .   (3.23)
                (ηt qt ) 1−γ        η t qt t                           1/γ
                                                                      vt                   vt
                                                                                             1/γ


  13
     If we used the shooting method to find the equilibrium with CRRA utilities, we would have a system
of second-order differential equations for the value functions, and a first-order differential equation for the
price.




                                                      34
Hence, the risk premia of households and experts are given by

                                                                                              ησtη
     ςt =   γσtC   =   −σtv   +    σtη   +   σtq   + γσ       and ς t =   γσtC   =   −σtv   −      + σtq + γσ.   (3.24)
                                                                                              1−η

   Since
                                              t
                                                      C 1−γ                     K 1−γ
                                         Z
                                                  e−ρs s ds +e−ρt             vt t
                                                      1−γ                       1−γ
                                         |0          {z     }                 | {z }
                                                   utility flow           continuation utility

is by standard dynamic programming arguments a martingale and

               d(Kt1−γ )
                                                                     
                                                           γ(1 − γ) 2
                         =           (1 − γ)(Φ(ιt ) − δ) −         σ    dt + (1 − γ)σ dZt ,
                Kt1−γ                                          2

we have

  Ct1−γ       Kt1−γ      Kt1−γ
                                                                                                 
                                                 v                         γ(1 − γ) 2   v
        − ρvt       + vt                        µt + (1 − γ)(Φ(ιt ) − δ) −         σ + σt (1 − γ)σ = 0.
  1−γ         1−γ        1−γ                                                   2

Using (3.23), we obtain

                        (ηt qt )1/γ−1                                       γ(1 − γ) 2
           µvt = ρ −           1/γ
                                             − (1 − γ)(Φ(ιt ) − δ) +                σ − σtv (1 − γ)σ.            (3.25)
                              vt                                                2

Likewise,

                   ((1 − ηt )qt )1/γ−1                                           γ(1 − γ) 2
     µtv   =ρ−                 1/γ
                                                   − (1 − γ)(Φ(ιt ) − δ) +               σ − σtv (1 − γ)σ.       (3.26)
                              vt                                                     2

Given µvt and µtv , we obtain partial differential equations for the functions v(η, t) and v(η, t)
using Ito’s Lemma, and they are as follows:

                                                                  (σtη η)2
                        µvt v(η, t)      =   µηt η    vη (η, t) +          vηη (η, t) + vt (η, t) and            (3.27)
                                                                     2

                                                                     (σtη η)2
                           µvt v(η, t) = µηt η v η (η, t) +                   v ηη (η, t) + v t (η, t).          (3.28)
                                                                        2



   Description of the Procedure


                                                                   35
   Below we outline the procedure of how we solve for the equilibrium using equations (3.27)
and (3.28). There are three parts.

   • The terminal conditions v(η, T ) and v(η, T )

   • The static step: finding capital price q(η), allocations ψ(η) and χ(η), volatilities and
     drifts at a given time point t given the value functions v(η, t) and v(η, t), and

   • The time step: finding v(η, t − ∆t) and v(η, t − ∆t) from prices, allocations, volatilities
     and drifts at time t.

   The terminal conditions. Our terminal conditions specify the utilities of the repre-
sentative expert and household, as functions of the experts’ wealth share ηt . We have not
performed a detailed theoretical study of acceptable terminal conditions, but in practice any
reasonable guess works well for a wide range of parameters.
   For example, if we set qT = 1 and CT /KT = aηT , then (3.23) implies that

                    vT = ηT (aηT )−γ   and v T = (1 − ηT ) (a(1 − ηT ))−γ .              (3.29)


    The static step. Suppose we know value functions through v(η, t) and v(η, t). Let us
describe how we can compute the price qt and characterize equilibrium dynamics at time t.
    There are three regions. When η is close enough to 0, then the experts’ risk premia are so
much higher than those of households that ψt < 1, i.e. households hold capital, and equation
(3.12) holds. In this region experts issue the maximal allowed equity share to households, so
χt = χ, since the households’ risk premia are lower. In the middle region, ψt = 1, i.e. only
experts hold capital, but the experts’ risk premia are still higher than those of households
so χt = χ. Finally, when η ≥ χ, the capital is allocated efficiently to experts (i.e. ψt = 1)
and risk can shared perfectly between households and experts by setting χt = ηt . In the last
region, (3.15) implies that σ η = 0, so there is no endogenous risk, and risk premia of experts
and households are both equal to ςt = ς t = γσ by (3.24).
    In the region where ψt < 1 we solve for q(η), ψ(η) and σ + σtq from a system of the
following three equations, which ultimately gives us a first-order ODE in q(η). We obtain
the first by combining (3.12) and (3.24) together with evolution of η equation (3.13), we




                                              36
have
                                      v 0 (η) v 0 (η)
                                                                
                    a−a                                     1
                        =χ                   −        +            (χψt − η)(σ + σtq )2 .                     (3.30)
                     qt               v(η)     v(η)     η(1 − η)
                                    |                        {z                      }
                                                                             η
                                                                 v        σ
                                                                σt −σtv + 1−η
                                                                           t  (σ+σtq )


The second we obtain from (3.14) and Ito’s Lemma,

                                                             q 0 (η)
                                                                    
                                                 q
                                       (σ + σ ) 1 − (χψ − η)           = σ.                                   (3.31)
                                                             q(η)

Finally, from (3.23) and an analogous condition for households, the market-clearing condition
for output is

                         (ηt qt )1/γ        ((1 − ηt )qt )1/γ
                              1/γ
                                        +              1/γ
                                                                     = aψ + a(1 − ψ) − ι(q(η)).               (3.32)
                             vt                      vt
                         |                  {z                   }
                                       (Ct +C t )/Kt

Once ψt reaches 1, condition (3.30) is no longer relevant. From then on, we set ψt = 1, find
q(η) from (3.32) and σ + σtq from (3.31). Once ηt reaches χ, we enter the last region. There
we set ψt = 1, χt = ηt , compute q(η) from (3.32) and set σtq = 0.
    Once we know function q(η) in all three regions, we can find the volatility of ηt from
(3.13) and the volatilities of vt and v t from Ito’s Lemma, i.e.

                         χt ψt − ηt                                  v 0 (η) η                 v 0 (η) η
                 σtη =              (σ + σtq ),              σtv =          σ η,   and σtv =          σ η.    (3.33)
                             ηt                                      v(η) t                    v(η) t

We find the required risk premia ςt and ς t from (3.24) and the drift of ηt from (3.13), i.e.
                                                  !
                                          1/γ−1
                   a − ιt (ηt qt )
         µηt =                                         + σtη (ςt − σ − σtq ) − (σ + σtq )(1 − χ) ςt − ς t .
                                                                                                         
                         −      1/γ
                     qt       vt

Finally, we solve for the drifts of vt and v t from (3.25).
    The time step. Once we have all characteristics of the equilibrium at a given time
point t, we can solve for the value functions at an earlier time step t − ∆t from equations
(3.27) and (3.28). These are parabolic equations, which can be solved using either explicit
or implicit methods.
    Summary. Set terminal conditions for value functions v(η, T ) and v(η, T ) according to
(3.29) on a grid over η. Divide the interval [0, T ] into small subintervals. Going backwards

                                                                     37
in time, for each subinterval [t − ∆t, t] perform the static step and then the time step. That
is, from value functions v(η, t) and v(η, t) find the drift and volatility of η as well as the
drifts of v and v using the following procedure (static step). Start from an initial condition
near (η = 0, ψ = 0) (perturb the condition to avoid division by 0). Solve (3.30), (3.31) and
(3.32) (as a first-order ordinary differential equation for q(η)) until ψ reaches 1. Then set
ψ = 1 and use (3.32) to find q(η) and (3.31) to find σ q . Throughout, use χt = max(χ, η).
With functions (of η) q, σ q , ψ and χ obtained in this way, compute volatilities from (3.33),
ςt and ς t from (3.24), µηt from (3.13) and the drifts of vt and v t from (3.25). Then (this is
the time step) solve the partial differential equations (3.27) and (3.28) for v and v backward
in time over the interval [t − ∆t, t], using fixed functions µvt , µtv , µηt and σtη of η computed
by the static step. Continue until time 0. We get convergence when T is sufficiently large.

    Remark. The static step alone is sufficient to solve for the equilibrium prices, allocations
and dynamics in a model with logarithmic utility (i.e. γ = 1), since in this case we know
that (Ct + C t )/(qt Kt ) = ρη + ρ(1 − η) and expert and household risk premia are ςt = σtN =
χt ψt /ηt (σ + σtq ) and ς t = (1 − χt ψt )/(1 − ηt )(σ + σtq ). Hence, equations (3.30) and (3.32)
become

  a−a    χψt − η
      =χ          (σ + σtq )2      and (ρη + ρ(1 − η))qt = aψ + a(1 − ψ) − ι(q(η)).         (3.34)
   qt    η(1 − η)

Equation (3.31) remains the same.
   For logarithmic utility, however, we do not immediately obtain the agents’ value functions.
Those can be found using an extra step.


3.6    Examples of Solutions: CRRA Utility
In this section, we illustrate solutions generated by our code, using the iterative method, and
what we learn from them. We use baseline parameters ρ = 6%, r = 5%, a = 11%, a = 3%,
δ = 5%, σ = 10%, χ = 0.5, γ = 2 and an investment function of the form Φ(ι) = log(κι+1)/κ
with κ = 10. We then study how several parameters, specifically a, σ, χ and γ affect the
equilibrium.
    Figure 5 illustrates the equilibrium for the baseline set of parameters. Notice that capital
price qt has a kink - the kink separates the crisis region near η = 0 where ψt < 1, i.e.
households hold some capital, and the normal region where experts hold all capital in the
economy.


                                                38
                 1.6                                           0.06
                 1.5                                           0.05
                 1.4                                           0.04
                 1.3
             q
                                                               0.03
                 1.2                                           0.02
                 1.1                                           0.01
                  1                                              0
                       0      0.2   0.4   0.6   0.8   1               0   0.2   0.4   0.6   0.8   1


                 0.1                                           0.04
             0.08
                                                               0.03
             0.06
                                                               0.02
         q




             0.04
             0.02                                              0.01
                                                                                  *
                  0
                                                                 0
             -0.02
                       0      0.2   0.4   0.6   0.8   1               0   0.2   0.4   0.6   0.8   1




                           Figure 5: Equilibrium for the baseline set of parameters.

    Here, point η ∗ where the drift of ηt becomes 0 plays the role of a steady state of the
system. In the absence of shocks, the system stays still at the steady state and in response
to small shocks, drift pushes the system back to the steady state. Moving away from the
crisis regime, at η ∗ risk premia decline sufficiently so that the experts’ earnings are exactly
offset by their slightly higher consumption rates.
    Above η = χ = 0.5 is the region of perfect risk sharing, where the volatility of η is zero.
Since the drift in that region is negative, the system never ends up there (and if the initial
condition is η0 > χ, then ηt drifts deterministically down to χ).
    Figure 6 shows the effect of σ on the equilibrium dynamics. We bound the horizontal
axis at η = χ = 0.5, since the system never enters the region η > χ. The steady state η ∗
declines as σ falls, as risk premia decline in the normal regime, until η ∗ coincides with the
boundary of the crisis region for low σ (this happens for σ = 0.01 in Figure 6). We also
observe the volatility paradox: as σ declines, endogenous risk σtq does not have to fall, and
may even rise.
    But what happens as σ → 0? Does endogenous risk disappear altogether, and does the
solution converge to first best? It turns out that no: in the limit as σ → 0, the boundary of
the crisis region η ψ converges not to 0 but to a finite number.


                                                          39
        1.6
                                                 0.06

        1.4                                      0.05
                                                 0.04
        1.2
    q

                                                 0.03
                                                 0.02
         1
                                                 0.01
        0.8                                         0
              0   0.1   0.2   0.3   0.4   0.5           0   0.1   0.2   0.3   0.4   0.5


    0.15
                                                 0.04

        0.1                                      0.03
q




                                                 0.02
    0.05
                                                 0.01

         0                                          0

              0   0.1   0.2   0.3   0.4   0.5           0   0.1   0.2   0.3   0.4   0.5




        Figure 6: Equilibrium for σ = .1 (blue), .05 (red) and .01 (black).

        1.6
                                                 0.07
                                                 0.06
        1.4
                                                 0.05
        1.2                                      0.04
    q




                                                 0.03
         1                                       0.02
                                                 0.01
        0.8                                        0
              0   0.1   0.2   0.3   0.4   0.5           0   0.1   0.2   0.3   0.4   0.5



        0.3                                      0.05
    0.25                                         0.04
        0.2                                      0.03
q




    0.15
                                                 0.02
        0.1
                                                 0.01
    0.05
                                                   0
         0
              0   0.1   0.2   0.3   0.4   0.5           0   0.1   0.2   0.3   0.4   0.5




         Figure 7: Equilibrium for χ = .5 (blue), .2 (red) and .1 (black).


                                            40
                                                            0.1
           1.5
                                                          0.08
            1                                             0.06
       q




                                                          0.04
           0.5
                                                          0.02

            0                                                 0
                 0    0.1   0.2    0.3    0.4                     0   0.1     0.2    0.3     0.4



                                                          0.08
           0.8

           0.6                                            0.06
       q




           0.4                                            0.04

           0.2                                            0.02

            0                                                 0
                 0    0.1   0.2    0.3    0.4                     0   0.1     0.2    0.3     0.4




                 Figure 8: Equilibrium for a = .03 (blue), -.03 (red) and -.09 (black).

    Likewise, what happens if financial frictions become relaxed, and experts are able to hold
capital while retaining a smaller portion of risk? It is tempting to conjecture that as financial
frictions become relaxed, the system becomes more stable. Yet, as the bottom left panel of
Figure 7 demonstrates, endogenous risk σtq rises sharply as χ declines.14
    It turns out that a crucial parameter that affects system stability is the household produc-
tivity parameter a. The level of endogenous risk in crises depends strongly on the illiquidity
of capital - the difference between parameter a and a that determines how much less house-
holds value capital, in the event that they have to buy it, relative to experts. Figure 8
illustrates the equilibrium for several values of a. Note that endogenous risk in crises rises
sharply as a drops. However, the dynamics in the normal regime and the level of η ∗ have
extremely low sensitivity to a - only dynamics in the crisis regime are extremely sensitive.
This is a surprise. While expert leverage responds endogenously to fundamental risk σ in the
normal regime it does not respond strongly to endogenous tail risk. In fact, for logarithmic
  14
    Of course, there is a discontinuity at both σ = 0 and χ = 0. As financial frictions disappear altogether,
the crisis region disappears.


                                                     41
              2                                           0.08
             1.8
                                                          0.06
             1.6
             1.4                                          0.04
         q




             1.2
              1                                           0.02
             0.8
                                                             0
                   0      0.1   0.2    0.3   0.4   0.5            0   0.1   0.2   0.3     0.4   0.5


                                                          0.05
         0.12
                                                          0.04
             0.1
         0.08                                             0.03
     q




         0.06                                             0.02
         0.04                                             0.01
         0.02
                                                             0
              0
                                                          -0.01
                   0      0.1   0.2    0.3   0.4   0.5            0   0.1   0.2   0.3     0.4   0.5




                       Figure 9: Equilibrium for γ = 2 (blue), 5 (red) and 0.5 (black).

utility it is possible to prove analytically that the dynamics in the normal regime do not
depend on a at all (but here we illustrate the dynamics for γ = 2).
    Finally, let us consider risk aversion γ. There are several effects. Lower risk aversion leads
to a smaller crisis region (but with greater endogenous risk), and lower steady state η ∗ as
the risk premia become lower. In this example, higher risk aversion leads to a higher price
of capital, as risk creates a precautionary savings demand.


4     A Simple Monetary Model
So far we focused on a real model with a single risky asset, physical capital and a risk-free
asset. Now, building on Brunnermeier and Sannikov’s (2015a) “I Theory of Money’’ we
introduce instead of the (real) risk-free asset, another asset, money. In general, money has
three roles: it is a unit of account, it facilitates transactions, and it serves as a store of value
(safe asset). Here, we focus on its role as a store of value, which arises in our setting due to
incomplete markets frictions. Unlike in New Keynesian models, which focus on the role of


                                                     42
money as a unit of account and rely on price and wage rigidities as the key frictions, prices
are fully flexible in our model.
    In this section focuses on the following:
  1. Money can have positive value despite the fact that it never pays any dividend. That
     is, money is a bubble.

  2. Money helps agents to share risks in an economy that is plagued by financial frictions.
     Hence, having a nominal store of value instead of a real short-term risk-free bond alters
     the equilibrium risk dynamics.

  3. The “Paradox of Prudence” coined in Brunnermeier and Sannikov (2015a) arises. Ex-
     perts hold money to self-insure against idiosyncratic shocks, an action which is micro-
     prudent but macro-imprudent. By selling capital to achieve a greater portfolio weight
     on money, experts depress aggregate investment and growth, leading to lower returns
     on all assets (including money). The Paradox of Prudence is in the risk space what
     Keynes’ Paradox of Thrift is for the consumption-savings decision. The Paradox of
     Thrift describes how each person’s attempt to save more paradoxically lowers overall
     aggregate savings.


4.1    Model with Idiosyncratic Capital Risk and Money
Let us return to the Basak-Cuoco model of Section 2 with experts holding physical capital
and households who cannot, i.e. a = −∞. We introduce the following two modifications:
(i) Capital has in addition to aggregate risk also idiosyncratic risk. (ii) There is no risk-free
asset, but there is money in fixed supply. Agents can long and short it and want to hold it
to self-insure against idiosyncratic risk.
    More formally, we assume as before that each expert operates a linear production tech-
nology, akt , with productivity a, but now they also face idiosyncratic risk σ̃dZ̃t in addition
to aggregate risk σdZt . That is a single expert’s capital kt evolves according to

                            dkt /kt = (Φ(ιt ) − δ)dt + σdZt + σ̃dZ̃t .

The shock dZt is the same for the whole economy, while the shock dZ̃t is expert-specific and
orthogonal to dZt . Idiosyncratic shocks cancel out in the aggregate.
   Since idiosyncratic risk is uninsurable due to markets incompleteness, experts also want
to hold money. Money is an infinitely divisible asset in fixed supply, which can be traded

                                               43
without frictions. Since money does not pay off any dividends it has value in equilibrium
only because agents want to self-insure against idiosyncratic shocks to their capital holdings.
In other words, money is a bubble, like in Samuelson (1958) and Bewley (1980). Unlike in
Bewley (1980), our idiosyncratic shocks are not endowment shocks, but investment shocks
like in Angeletos (2007). We assume that idiosyncratic risk of the dividend-paying capital
                       √
is large enough, σ̃ > ρ, so that money, which does not pay dividends, still has value in
equilibrium. This is unlike Diamond (1965) who introduces physical capital in Samuelson’s
OLG model and Aiyagari (1994) who introduces capital in Bewley’s incomplete markets
setting. In those models, the presence of capital crowds out money as a store of value.15
    Experts can invest in (outside) money and capital, while households like in Section 2
only hold money. We also assume for simplicity that all agents have logarithmic utility with
time preference rate ρ.16
    As before let us follow our four step approach to solve the model.


4.2     The 4-Step Approach
Step 1: Postulate Price and SDF Processes. In this monetary setting we now have to
postulate not only a process for the price of capital, but also for the “real price” of money.
We denote (without loss of generality) the value of the total money stock in terms of the
numeraire (the consumption good) by pt Kt . We normalize the total value of the money
stock by Kt to emphasize that, everything else being equal, the value of money should be
proportional to the size of the economy.

                                         dqt
                                             = µqt dt + σtq dZt ,
                                          qt
                                         dpt
                                             = µpt dt + σtp dZt ,
                                         pt

   In addition, like in Section 3 we postulate the processes for individual experts’ and
households’ stochastic discount factors:

                     dξt                                        dξ t
                         = −rt dt − ςt dZt − ς˜t dZ̃t     and          = −rt dt − ς t dZt ,
                     ξt                                          ξt
  15
     We assume that money is intrinsically worthless, and so along with the equilibrium in which money has
value, there is also an equilibrium in which money has no value. However, in a perturbation of the model,
in which agents get small utility from holding money (e.g. because money facilitates transactions), only the
equilibrium with full value of money survives.
  16
     Solving this model with CRRA models using the results on page 22 in Section 3.1 is a worthwhile exercise.


                                                     44
where rt and rt are the (real) shadow risk-free interest rates of experts and households,
respectively. Note that shadow risk free rates need not be identical, since no real risk-free
asset is traded. Note also that experts require a risk premium not only for the aggregate
risk ςt but also for the idiosyncratic risk they have to bear ς˜t .
    We will show that there exists an equilibrium in which the wealth share ηt evolves deter-
ministically and so do the prices qt and pt . Hence, for simplicity we set σtq = σtp = 0. Under
this conjecture the return on physical capital accruing to experts is

                              a − ιt
                     drtk =          dt + (Φ(ιt ) − δ + µqt )dt + σdZt + σ̃dZ̃t
                                qt

and world stock of money pt Kt earns the (real) return of

                               drtM = (Φ(ιt ) − δ + µpt ) dt + σdZt ,

where ιt is the investment rate in global capital.
    Step 2: Equilibrium Conditions. First, note that the optimal investment rate is
determined by qt through Φ0 (ιt ) = 1/qt . Second, the optimal consumption rate of all agents
is simply ρ times their net worth, since the utility of all agents is logarithmic with time
preference rate ρ. Hence, aggregate demand for the consumption good is ρ(qt + pt )Kt .
Given total supply of consumption goods after investing, we have the following goods market
equilibrium condition:
                                  ρ(qt + pt )Kt = (a − ι)Kt .

     Next, we solve the experts’ and households’ portfolio problems. Notice that, given the
returns drtM and drtk on capital and money, the only two assets traded in this economy, all
agents have exposure σ dZt to aggregate risk. At the same time, experts also have exposure
xt σ̃ dZ̃t to their individual idiosyncratic shocks, where xt is the experts’ portfolio weight on
capital. Hence, the required risk premia of these log-utility agents are

                                   ςt = ς t = σ   and ς˜t = xt σ̃.

   The experts’ and households’ asset pricing equations for money, respectively, are

                           Et [drtM ]        Et [drtM ]
                                      − rt =                    σ2 .
                                                        − rt = |{z}
                               dt                dt
                                                                =ςt σ=ς t σ




                                                  45
Thus, rt = rt : even though there is no risk-free real asset in this economy, both agent types
would agree on a single real risk-free real interest rate.
   The experts’ asset pricing equation for physical capital is

                                     Et [drtk ]
                                                − rt = ςt σ + ς˜t σ̃,
                                        dt

reflecting the fact that experts are also exposed to idiosyncratic risk for which they earn an
extra risk premium. Hence,
                                  Et [drtk ] Et [drtM ]
                                            −           = xt σ̃ 2 .                       (4.1)
                                     dt          dt
    Capital market clearing implies that

                                             qt Kt        1 qt
                                 xt =                   =            ,                         (4.2)
                                        ηt (pt + qt )Kt   ηt pt + qt

   Step 3: Evolution of η. Experts’ aggregate net worth Nt evolves according to

                         dNt
                                                           ςt dt − ρ dt,
                                       σ dt + dZt ) + xt σ̃˜
                             = rt + σ(|{z}
                         Nt
                                           ςt


given their exposures to aggregate and idiosyncratic risk, and since idiosyncratic risk cancels
out in the aggregate. The law of motion of aggregate wealth is

                    d((qt + pt )Kt )
                                                                     ςt dt − ρ dt,
                                     = rt + σ(σ dt + dZt ) + ηt xt σ̃˜
                     (qt + pt )Kt

                Nt
where ηt = (qt +p t )Kt
                        is the experts’ net worth share and ηt xt = qt /(pt + qt ) is the exposure to
idiosyncratic risk in the world portfolio. Hence,
                                                                    2
                        dηt                                   qt          1 − ηt 2
                            = x2t (1 − ηt )σ̃ 2 dt =                            σ̃ dt.         (4.3)
                        ηt                                 pt + qt          ηt2

    Step 4: Derive ODEs for the postulated price processes q and p as a function of the
state variable η. We omit this step as it is similar to the previous section.


4.3    Observations and Limit Case
The increase in experts’ wealth share ηt , or equivalently the decline of households’ wealth
share, 1 − ηt , results in part from the fact that experts earn a risk premium from taking on

                                                   46
idiosyncratic risk. The higher the idiosyncratic risk σ̃ 2 , the faster experts’ wealth share rises
towards 100%. Interestingly, it is the fact that experts are unable to share idiosyncratic risk
which makes them richer over time compared to households.
    Money allows for some sharing of idiosyncratic risk, since the experts’ exposure to id-
iosyncratic risk of xt σ̃ is less than what it would have been without money, i.e. σ̃/ηt , as long
as xt < 1/ηt or pt > 0.

Comparison with Real Model. It is instructive to contrast the settings of this section
with that of Section 2, where households hold the real risk-free asset instead of money. The
evolution η follows now (4.3) instead of (2.11). Note that in both settings the experts’
wealth share drifts towards 100%. However, there are crucial differences. In the setting with
nominal money, aggregate risk is shared fully between experts and households. Hence, both
groups receive a risk premium and therefore aggregate risk does not impact the wealth share
in the model with money. In contrast, in the real model experts hold all the aggregate risk
and hence only they earn a risk premium, leading to a positive drift in η. More importantly,
aggregate risk sharing with money makes the evolution of experts’ wealth share deterministic.
In contrast, in the real model that experts’ wealth share is necessarily stochastic, as revealed
by (2.11).

The Only Experts Case. Finally, we are able to derive a closed form solution for the
absorbing state η = 1 to which the system drifts. When the state η = 1 is reached µq (1) =
µp (1) = 0 and thus experts’ asset pricing equation (4.1) and capital market clearing (4.2)
can be combined and simplified as follows

                            1 a−ι   E[drk − drM ]/dt         q
                             2
                                  =          2
                                                     = xt =                                  (4.4)
                           σ̃ q           σ̃                p+q

Combining equation (4.4) with the goods market clearing condition

                                     ρ(p + q)Kt = (a − ι)Kt                                  (4.5)

and the optimal investment rate
                                                 q−1
                                            ι=       ,                                       (4.6)
                                                  κ




                                                 47
                                    1
for the functional form Φ(ι) =      κ
                                        log(κι + 1) one obtains the “money equilibrium,” in which
money is a bubble with                                      √
                                     1 + κa            σ̃ − ρ
                               q=       √     and p = √        q.
                                   1 + κ ρσ̃                ρ
                                                  √
The “money equilibrium” exists as long as σ̃ > ρ.
    In addition, there exists a “moneyless equilibrium”, obtained by setting p = 0 and solving
(4.5) with (4.6) to obtain
                                         1 + κa
                                   q0 =          and p0 = 0.
                                         1 + κρ
Equation (4.4) is no longer relevant because money is no longer an asset in which agents can
put their wealth.
    Note that the price of capital for the “moneyless” equilibrium is the same as in the
real economy of Section 2. The growth rate of the economy in both equilibria is given by
g = κ1 log q − δ. In the money equilibrium, q is lower and so is overall economic growth, but
experts have to bear less risk.

Financial Deepening. Financial deepening or innovation that lower the amount of id-
iosyncratic risk households have to bear also lowers the value of money, p. However, it
increases the price of capital q and with it, the investment rate, ι, and the overall economic
growth rate g. Surprisingly, q + p declines. That is, financial deepening lowers total wealth
in the economy.

The Paradox of Prudence. The Paradox of Prudence arises when experts try to lower
their risk by tilting their portfolio away from real investment and towards safe asset, money.
Scaling back risky asset holding can be micro-prudent, but macro-imprudent. As experts
try to lower their (idiosyncratic) risk exposure, the price of capital falls in Brunnermeier and
Sannikov (2015a). This behavior lowers overall economic growth and with it the real return
on money holdings. Since each individual expert takes prices and rates of return as given,
they do not internalize this pecuniary externality. As shown in Brunnermeier and Sannikov
                                                                                 √
(2015a), money holdings in this model are inefficiently high if σ̃(1−κρ) > 2 ρ. Our Paradox
of Prudence is analogous to Keynes’ Paradox of Thrift, but the former is about changes in
portfolio choice and risk, while the latter refers to the consumption-savings decision.17
  17
    Keynes’ Paradox of Thrift states that an increase in the savings propensity can paradoxically lower
aggregate savings. An increase in savings propensity lowers consumption demand. If the increased savings
are “parked in (bubbly) money” instead of additional real investments, aggregate demand becomes depressed.



                                                   48
5     Critical Assessment and Outlook
The economy with two types of agents gives rise to a number of general ideas - we describe
these broader ideas in this section. We would like to make the point that continuous time has
the capacity to build upon many ideas present in the literature, with fuller and less stylized
models, and to drive a deeper understanding of financial frictions in the macroeconomy in
new ways. We comment on how the methodology we presented above can be extended,
and used fruitfully, in higher-dimensional state spaces. We also comment on the issues of
uniqueness of equilibria and the characterization of the full set of equilibrium possibilities
when multiple equilibria exist.
    One key idea is that the wealth distribution in the economy matters. In the models we
solved in Sections 2 and 3, the wealth distribution is characterized by a single state variable,
the wealth share of experts ηt . When ηt is low, experts become undercapitalized. More
generally, other sectors can become undercapitalized. Mian and Sufi (2009) argue that a big
drag on the economy in the recent financial crisis has been the fact that many households
are undercapitalized. Caballero et al. (2008) discuss how during Japan’s lost decade it was
the corporate sector that became undercapitalized. The general message here is that the
wealth distribution across sectors matters for the level of economic activity - asset allocation
- as well as the rates of earnings and risk exposures of various sectors. These earnings and
risk exposures in turn drive the stochastic evolution of the wealth distribution.
    The idea that the wealth distribution drives economic cycles is not new in the literature.
Kiyotaki and Moore (1997) and Bernanke et al. (1999) consider the fluctuations of the wealth
of a class of agents near the steady state. Of course, continuous-time methods facilitate a full
solution of this type of a model. He and Krishnamurthy (2013) consider a model similar to
the ones we presented here, but without asset misallocation and with a somewhat different
assumption of the earnings of the households’ holdings of expert equity.18
    More broadly, several papers introduce the idea of intergenerational wealth distribu-
tion. This idea exists already in Bernanke and Gertler (1999), where the wealth of old
entrepreneurs affects wages in the labor market, which in turn impact the accumulation
of wealth by young entrepreneurs. Myerson (2012) builds a model with T generations of
bankers, in which the wealth distribution evolves in cycles, causing cycles in real activities.
This lowers aggregate income. Saving a fraction of now lower income can lower overall dollar savings.
  18
     In that model, households earn more than their required return, and therefore there is rationing of
experts’ shares. Effectively, the alternative assumption gives households some market power, which inter-
mediaries do not have. This leads to a lower intermediary earnings rate and a slower recovery from crisis.



                                                   49
When the wealth of old bankers is high, risk premia are low, and hence earnings of young
bankers are low. Wealth distribution across sectors also matters. Brunnermeier and San-
nikov (2015b) develop a rather symmetric model, in which there are two sectors that produce
two essential goods, and either one of the sectors can become undercapitalized. Brunner-
meier and Sannikov (2012) discuss the idea that multiple sectors can be undercapitalized,
and that monetary policy can affect “bottlenecks” through its redistributive consequences.
They envision an economy in which multiple assets are traded, and agents within various
sectors hold specific portfolios, backed by a specific capital structure. Brunnermeier and
Sannikov (2015a) provide formal backing of these ideas using a three-sector model, in which
traded assets include capital, money and long-term bonds, and monetary policy can affect
the prices of these assets (and hence affect the sectors that hold theses assets) in various
ways.
    This leads us to the obvious question about the capacity of continuous-time models to
develop these complex ideas. Can continuous-time methods successfully handle models with
multiple state variables, which describe e.g. the distribution of wealth across sectors together
with the composition of productive capital? We believe that yes - we are highly optimistic
about the potential of continuous-time models. Certainly, the curse of dimensionality still
exists. However, models with as many as four state variables should be solvable through a
system of partial differential equations in a matter of minutes, if not faster, through the use
of efficient computational methods. The authors of this chapter have some experience with
computation, and on a personal level many possibilities seem feasible now which appeared
out of reach five years ago. To gauge computational speed, DeMarzo and Sannikov (2016)
solve a model with three state variables, using a system of two partial differential equations.
In addition the procedure involves an integration step somewhat reminiscent of the “static
step” of the procedure in subsection 3.5. With 201 × 51 × 51 grid points, the procedure using
the explicit(!) method takes only a minute to compute the optimal contract. The implicit
method of solving partial differential equations, which we use to compute the examples in
subsection 3.6 is significantly faster. For example, when solving a partial differential equation
of the parabolic type in two dimensions (all equations for computing the value function using
the iterative method are parabolic), with N grid points in space, one needs O(N 2 ) grid points
in time to ensure that the computational procedure is stable, when using the explicit method.
In contrast, when using the implicit method, stability does not depend on the length of the
time step, i.e. the time step can be kept constant when greater resolution is required along
the space dimension. Hence, we believe that by making a claim that models with four state


                                               50
variables are feasible to solve, we are in fact quite conservative.
    We think that the iterative method, based on value function iteration for each type of
agent, should prove quite fruitful. This method is based on backward induction starting
from a terminal condition on the state space. At each new time interval, we start with value
functions computed for the end of the interval. These value functions determine the agents’
incentives through their continuation values from various portfolio choices. As a result, we
can determine at each time point the allocations of assets and risk consistent of equilibrium
- this is the “static step” - and hence we can compute the value function one period earlier.
We see this method as fairly general and suitable for multiple dimensions.
    In contrast, the shooting method aims at solving for the fixed point - equilibrium value
functions and allocations in an infinite-horizon economy - up front. The straightforward
extension of this method to multidimensional state spaces may be difficult to implement, as
one would have to guess functions that match boundary conditions on the entire periphery of
the state space, instead of just two endpoints. Nevertheless, procedures that use variations
of policy iteration may lead to an efficient way of solving for a fixed point.
    What makes continuous-time models particularly tractable is that transitions are local
(when shocks are Brownian) - hence it is possible to determine the agents’ optimal decisions
and solve for their value functions by evaluating only first and second derivatives. In discrete
time, with discrete transitions, the agents’ decisions at any point may depend on entire value
functions.
    What about environments with so many dimensions that the straightforward discretiza-
tion of the state space makes computation infeasible, due to the curse of dimensionality?
Here, we are curious about the idea of describing state variables through certain essential
moments - following the suggestions of Krusell and Smith (1998). We have not processed
this possibility sufficiently to comment on it in the chapter, but generally we are very eager
to know about ways to choose moments that describe the state space in a meaningful way
for a given model. We should say, however, that continuous time can be helpful here as well,
for describing continuation values and prices as functions of moments.
    We finish this section by discussing the question of equilibrium uniqueness in the model we
presented and in more complex models we envision. First, consider a finite-horizon economy
that we are solving for via an iterative procedure. The procedure has two steps - the time
step of value function iteration and the static step that determines prices and allocation.
The time step cannot be a source of nonuniqueness - given continuation values, transition
probabilities and payoff flows, the value function one period earlier is fully determined. The


                                              51
static step may or may not lead to nonuniqueness. In the model of Section 3 there are
multiple nonstationary equilibria. For example, at any time point, the price of capital qt can
jump. If qt jumps up by 10% then the risk-free asset must have an instantaneous return of
10% as well to ensure that the markets for capital and the risk-free asset clear. Of course,
by the market-clearing condition for output (3.32), the price of capital qt must correspond
to the allocation of capital ψt ∈ [0, 1]. The allocation itself must be justified by the local
volatility of capital, so that all agents have incentives to hold their portfolios. However, the
possibility of jumps opens up room to many possibilities.
    We compute the Markov equilibrium, in which prices and allocations are functions of η. If
so, then the price of capital q(ηt ) must satisfy the differential equation that follows from (3.30)
and (3.31). Notice that there are two values of σ + σtq consistent with the quadratic equation
(3.30), positive and negative. We select the positive value, since otherwise amplification is
negative, in the sense that a positive fundamental shock would result in a drop in the value
of capital. Hence, the equilibrium we compute is the unique Markov equilibrium, in which
the return on capital is always positively correlated with fundamental shocks to capital.
    In more general models, we envision that some of the same forces are present. We also
anticipate that, when there are multiple equilibria, it may be of interest to characterize
the whole set of equilibria via an appropriate recursive structure. To answer this question,
one may need to construct/compute a correspondence from the state space to the vector of
equilibrium payoffs of all agent types. We envision that this correspondence can be found
recursively by solving for the boundaries of attainable equilibrium payoff sets backwards in
time, but the details of this procedure are certainly work in progress.


References
Achdou, Yves, Jiequn Han, Jean-Michel Lasry, Pierre-Louis Lions, and Ben-
 jamin Moll, “Heterogeneous Agent Models in Continuous Time,” 2015. Working Paper,
 Princeton University.

Adrian, Tobias and Nina Boyarchenko, “Intermediary Leverage Cycles and Financial
 Stability,” 2012. Working Paper, Federal Reserve Bank of New York.

   and     , “Intermediary Balance Sheets,” FRB of New York Staff Report, 2013, (651).

Aiyagari, S. Rao, “Uninsured Idiosyncratic Risk and Aggregate Saving,” Quarterly Journal
 of Economics, 1994, 109 (3), 659–684.



                                                52
Angeletos, George-Marios, “Uninsured Idiosyncratic Investment Risk and Aggregate
 Saving,” Review of Economic Dynamics, 2007, 10 (1), 1–30.

Basak, Suleyman and Domenico Cuoco, “An Equilibrium Model with Restricted Stock
 Market Participation,” 1998.

Bernanke, Ben, Mark Gertler, and Simon Gilchrist, “The Financial Accelerator in a
 Quantitative Business Cycle Framework,” in John B. Taylor and Michael Woodford, eds.,
 Handbook of Macroeconomics, Vol. 1, Elsevier, 1999, chapter 21, pp. 1341–1393.

Bewley, Truman F., “The Permanent Income Hypothesis: A Theoretical Formulation,”
 Journal of Economic Theory, 1977, 16 (2), 252–292.

  , “The Optimum Quantity of Money,” in John H. Kareken and Neil Wallace, eds., Models
  of Monetary Economies, Federal Reserve Bank of Minneapolis, 1980, pp. 169–210.

Bianchi, Javier, “Overborrowing and Systemic Externalities in the Business Cycle,” Amer-
  ican Economic Review, 2011, 101 (7), 3400–3426.

Black, Fischer and Myron Scholes, “The Pricing of Options and Corporate Liabilities,”
  Journal of Political Economy, 1973, 81 (3), pp. 637–654.

Brock, William and Leonard Mirman, “Optimal Economic Growth and Uncertainty:
 The Discounted Case,” Journal of Economic Theory, 1972, 4 (3), 479–513.

Brunnermeier, Markus K. and Yuliy Sannikov, “Redistributive Monetary Policy,” in
 “Jackson Hole Symposium,” Vol. 1 Federal Reserve Bank of Kansas City Kansas City, KS
 2012, pp. 331–384.

   and , “A Macroeconomic Model with a Financial Sector,” American Economic Review,
  2014, 104 (2), 379–421.

   and    , “The I Theory of Money,” 2015. Working Paper, Princeton University.

   and , “International Credit Flows and Pecuniary Externalities,” American Economic
  Journal: Macroeconomics, 2015, 7 (1), 297–338.

   and , “On the Optimal Inflation Rate,” American Economic Review, 2016, 106 (5),
  484–489.

Caballero, Ricardo J., Takeo Hoshi, and Anil K. Kashyap, “Zombie Lending and
 Depressed Restructuring in Japan,” American Economic Review, December 2008, 98 (5),
 1943–77.

Chandler, Lester V., The Economics of Money and Banking, Harper Brothers Publishers,
 New York, 1948.


                                          53
Cox, John C., Jonathan E. Ingersoll, and Stephen A. Ross, “A Theory of teh Term
 Structure of Interest Rates,” Econometrica, 1985, 53 (2), 385–408.

DeMarzo, Peter and Yuliy Sannikov, “Learning, Termination and Payout Policy in
 Dynamic Incentive Contracts,” 2016. Working Paper, Princeton University.

Diamond, Peter A., “National Debt in a Neoclassical Growth Model,” American Economic
 Review, 1965, 55 (5), 1126–1150.

DiTella, Sebastian, “Uncertainty Shocks and Balance Sheet Recessions,” 2013. Working
 paper, Stanford University.

Drechsler, Itamar, Alexi Savov, and Philipp Schnabl, “A model of monetary policy
 and risk premia,” 2014. Working Paper, National Bureau of Economic Research.

Fernandez-Villaverde, Jesus and Juan F. Rubio-Ramiro, “Macroeconomics and
  Volatility: Data, Models, and Estimation,” 2010. Working Paper, University of Penn-
  sylvania.

Fisher, Irving, “The Debt-Deflation Theory of Great Depressions,” Econometrica, 1933, 1
  (4), 337–357.

Gurley, John G. and E. S. Shaw, “Financial Aspects of Economic Development,” Amer-
 ican Economic Review, 1955, 45 (4), 515–538.

He, Zhiguo and Arvind Krishnamurthy, “A Model of Capital and Crises,” Review of
 Economic Studies, 2012, 79 (2), 735–777.

  and    , “Intermediary Asset Pricing,” American Economic Review, 2013, 103 (2), 732–70.

   and , “A Macroeconomic Framework for Quantifying Systemic Risk,” 2014. Working
  Paper, National Bureau of Economic Research.

Hicks, John, “Mr. Keynes and the ‘Classics’: A Suggested Interpretation,” Econometrica,
 1937, 3 (2), 147–159.

Huang, Ji, “Banking and Shadow Banking,” 2014. Working Paper, Princeton University.

Isohätälä, Jukka, , Nataliya Klimenko, and Alistair Milne, “Post-crisis macrofi-
  nancial modelling: continuous time approaches,” in “Handbook of Post-Crisis Financial
  Modelling” 2015. forthcoming.

  , Alistair Milne, and Donald Roberston, “The Net Worth Trap: Investment and
  Output Dynamics in the Presence of Financing Constraints,” 2014. Working Paper.

John, M. Keynes, The General Theory of Employment, Interest and Money, London:
  Macmillan, 1936.

                                          54
Kindleberger, Charles P., Manias, Panics, and Crashes: A History of Financial Crises,
 Basic Books, 1978.

Kiyotaki, Nobuhiro and John Moore, “Credit Cycles,” Journal of Political Economy,
 1997, 105 (2), 211–248.

Klimenko, Nataliya, Sebastian Pfeil, and Jean-Charles Rochet, “Bank Capital and
 Aggregate Credit,” 2015. Working Paper, University of Zürich.

Krusell, Per and Jr. Smith Anthony A., “Income and Wealth Heterogeneity in the
 Macroeconomy,” Journal of Political Economy, 1998, 106 (5), 867–896.

Kydland, Finn E. and Edward C. Prescott, “Time to Build and Aggregate Fluctua-
 tions,” Econometrica, 1982, 50 (6), pp. 1345–1370.

Maggiori, Matteo, “Financial Intermediation, International Risk Sharing, and Reserve
 Currencies,” 2013. Working Paper, NYU.

Mankiw, Gregory and David Romer, New Keynesian Economics, Vol. 1: Imperfect
 Competition and Sticky Prices, MIT Press, Cambridge, MA, 1991.

Markowitz, Harry, “Portfolio Selection,” The Journal of Finance, 1952, 7 (1), pp. 77–91.

Mendoza, Enrique G., “Sudden Stops, Financial Crisis, and Leverage,” American Eco-
 nomic Review, December 2010, 100, 1941–1966.

Mian, Atif and Amir Sufi, “The Consequences of Mortgage Credit Expansion: Evidence
 from the US Mortgage Default Crisis,” Quarterly Journal of Economics, 2009, 124 (4),
 1449–1496.

Minsky, Hyman P., “Central Banking and Money Market Changes,” Quarterly Journal
 of Economics, 1957, 71 (2), 171–187.

Mittnik, Stefan and Willi Semmler, “The Real Consequences of Financial Stress,”
 Journal of Economic Dynamics and Control, 2013, 37 (8), 1479–1499.

Moll, Benjamin, “Productivity Losses from Financial Frictions: Can Self-financing Undo
 Capital Misallocation?,” The American Economic Review, 2014, 104 (10), 3186–3221.

Moreira, Alan and Alexi Savov, “The macroeconomics of shadow banking,” The Journal
 of Finance, 2016.

Myerson, Roger B., “A Model of Moral Hazard Credit Cycles,” Journal of Political Econ-
 omy, 2012, 120 (5), 847–878.

Patinkin, Don, Money, Interest, and Prices: An Integration of Monetary and Value The-
 ory, Row, Peterson, 1956.

                                          55
Phelan, Gregory, “Financial Intermediation, Leverage, and Macroeconomic Instability,”
 2014. Working Paper, Williams College.

Rappoport, David and Kieran Walsh, “A Discrete-Time Macroeconomic Model with a
 Financial Sector,” 2012. Mimeo, Yale University.

Samuelson, Paul A., “An Exact Consumption-Loan Model of Interest with or without the
  Social Contrivance of Money,” Journal of Political Economy, 1958, 66 (6), 467–482.

Sannikov, Yuliy, “A Continuous-Time Version of the Principal-Agent Problem,” The Re-
  view of Economic Studies, 2008, 75 (3), 957–984.

Sims, Christopher A., “Macroeconomics and Reality,” Econometrica, 1980, 48 (1), 1–48.

Solow, Robert M., “A Contribution to the Theory of Economic Growth,” The Quarterly
  Journal of Economics, 1956, 70 (1), pp. 65–94.

Stokey, Nancy and Robert Lucas, Recursive Methods in Economics Dynamics, Harvard
  University Press, 1989.

Taylor, John B., “Estimation and Control of a Macroeconomic Model with Rational Ex-
  pectations,” Econometrica, 1979, 47 (5), 1267–1286.

Tobin, James, “A General Equilibrium Approach to Monetary Theory,” Journal of Money,
  Credit and Banking, 1969, 1 (1), 15–29.

Werning, Iván, “Managing a Liquidity Trap: Monetary and Fiscal Policy,” 2012. Working
 Paper, MIT.

Woodford, Michael, Interest and Prices: Foundations of a Theory of Monetary Policy,
 Princeton University Press, Princeton, NJ, 2003.




                                         56
