                                NBER WORKING PAPER SERIES




   A THEORY OF MACROPRUDENTIAL POLICIES IN THE PRESENCE OF NOMINAL
                            RIGIDITIES

                                           Emmanuel Farhi
                                            Iván Werning

                                        Working Paper 19313
                                http://www.nber.org/papers/w19313


                      NATIONAL BUREAU OF ECONOMIC RESEARCH
                               1050 Massachusetts Avenue
                                 Cambridge, MA 02138
                                     August 2013




This paper was first circulated under the title "On the Inefficiency of Financial Market Equilibria in
Macroeconomic Models with Nominal Rigidities". We thank Fernando Alvarez, Adrien Auclert, Markus
Brunnermeier, Gauti Eggertsson, Olivier Jeanne, Guido Lorenzoni, Nobuhiro Kiyotaki, Anton Korinek,
John Geanakoplos, Ben Moll, Herakles Polemarchakis, Tomas Sargent, Jean Tirole, Jaume Ventura,
for useful comments. We thank seminar and conference participants at various seminars and conferences.
Ben Hebert provided outstanding research assistance. The views expressed herein are those of the
authors and do not necessarily reflect the views of the National Bureau of Economic Research.

NBER working papers are circulated for discussion and comment purposes. They have not been peer-
reviewed or been subject to the review by the NBER Board of Directors that accompanies official
NBER publications.

© 2013 by Emmanuel Farhi and Iván Werning. All rights reserved. Short sections of text, not to exceed
two paragraphs, may be quoted without explicit permission provided that full credit, including © notice,
is given to the source.
A Theory of Macroprudential Policies in the Presence of Nominal Rigidities
Emmanuel Farhi and Iván Werning
NBER Working Paper No. 19313
August 2013, Revised May 2015
JEL No. D5,D6,D62,E3,E4,E5,E58

                                             ABSTRACT

We propose a theory of monetary policy and macroprudential interventions in financial markets. We
focus on economies with nominal rigidities in goods and labor markets and subject to constraints on
monetary policy, such as the zero lower bound or fixed exchange rates. We identify an aggregate demand
externality that can be corrected by macroprudential interventions in financial markets. Ex post, the
distribution of wealth across agents affects aggregate demand and output. Ex ante, however, these
effects are not internalized in private financial decisions. We provide a simple formula for the required
financial interventions that depends on a small number of measurable sufficient statistics. We also
characterize optimal monetary policy. We extend our framework to incorporate pecuniary externalities,
providing a unified approach to both externalities. Finally, we provide a number of applications which
illustrate the relevance of our theory.


Emmanuel Farhi
Harvard University
Department of Economics
Littauer Center
Cambridge, MA 02138
and NBER
efarhi@harvard.edu

Iván Werning
Department of Economics, E17-234
MIT
77 Massachusetts Avenue
Cambridge, MA 02139
and NBER
iwerning@mit.edu
A Theory of Macroprudential Policies in the Presence
              of Nominal Rigidities∗
                             Emmanuel Farhi                     Iván Werning
                           Harvard University                         MIT

                                                June 2015



       We propose a theory of monetary policy and macroprudential interventions in financial mar-
       kets. We focus on economies with nominal rigidities in goods and labor markets and subject
       to constraints on monetary policy, such as the zero lower bound or fixed exchange rates. We
       identify an aggregate demand externality that can be corrected by macroprudential interven-
       tions in financial markets. Ex post, the distribution of wealth across agents affects aggregate
       demand and output. Ex ante, however, these effects are not internalized in private financial
       decisions. We provide a simple formula for the required financial interventions that depends
       on a small number of measurable sufficient statistics. We also characterize optimal monetary
       policy. We extend our framework to incorporate pecuniary externalities, providing a unified
       approach to both externalities. Finally, we provide a number of applications which illustrate
       the relevance of our theory.



1     Introduction
During the period known as the Great Moderation, a soft consensus emerged suggesting that
macroeconomic stabilization should be handled first and foremost by monetary policy. This con-
sensus has been shattered by the Great Recession. A new set of policies aimed at supplementing
monetary policy is gaining traction in policy circles. These so-called macroprudential policies in-
volve interventions in financial markets, in the form of taxes or quantity restrictions. Economists
are still searching for a comprehensive theoretical model that encompasses both monetary and
macroprudential policies. The goal of this paper is to provide such a framework.
    ∗ Wethank Fernando Alvarez, Adrien Auclert, Markus Brunnermeier, Gauti Eggertsson, Olivier Jeanne, Guido
Lorenzoni, Nobuhiro Kiyotaki, Anton Korinek, John Geanakoplos, Ben Moll, Herakles Polemarchakis, Tomas Sar-
gent, Jean Tirole, Jaume Ventura, for useful comments. We thank seminar and conference participants at various
seminars and conferences. Ben Hebert provided outstanding research assistance.




                                                      1
    One of the dominant existing theoretical justifications for macroprudential policies is based
on pecuniary externalities, which were first shown to arise when a simple friction, market in-
completeness, is introduced into the Arrow-Debreu framework (see e.g. Hart, 1975; Stiglitz, 1982;
Geanakoplos and Polemarchakis, 1985; Geanakoplos et al., 1990). The logic is as follows. When
asset markets are incomplete and there is more than one commodity, a redistribution of asset hold-
ings generically induces relative price changes in spot markets, in each state of the world. These
relative price changes, in turn, affect the spanning properties of the limited assets that are avail-
able, potentially improving insurance. Such a pecuniary externality is not internalized by private
agents. As a result, the equilibrium is generically constrained inefficient: it can be improved upon
by interventions in the existing financial markets. Similar results obtain in economies with bor-
rowing constraints that depend on prices of goods and assets, or when contracting is constrained
by private information (see e.g. Greenwald and Stiglitz, 1986). A large literature has leveraged
these theoretical insights to justify macroprudential interventions.1
    In this paper, we offer an alternative general theory for macroprudential policies based on a
different set of frictions. Indeed, in our baseline model, the only frictions are nominal rigidities
and, possibly, constraints on monetary policy such as the zero lower bound or a fixed exchange
rate. Instead of pecuniary externalities, our theory emphasizes aggregate demand externalities. In
addition to providing a new foundation for macroprudential policies, our framework, focusing
on monetary policy and nominal rigidities, is well posed for the joint study of monetary and
macroprudential policy.
    We provide two sets of results. First, using a perturbation argument similar in spirit to that
in Geanakoplos and Polemarchakis (1985), we show that equilibria that are not first best can be
improved upon by interventions in financial markets, except in non-generic knife-edged cases.
Although we share the focus on constrained inefficiency with the pecuniary externality literature,
the source of inefficiency is completely different.2 In that literature, the key frictions lie in financial
markets themselves; in our baseline model, we assume complete markets. Pecuniary externalities
rely on price movements; in our framework price rigidities tend to negate such effects.3 Our
   1 See  e.g. Caballero and Krishnamurthy (2001); Lorenzoni (2008); Farhi et al. (2009); Bianchi and Mendoza (2010);
Jeanne and Korinek (2010); Bianchi (2011); Korinek (2011); Davilla (2011); Stein (2012); Korinek (2012a,b); Jeanne and
Korinek (2013). Woodford (2011) studies a model with nominal rigidities and pecuniary externalities, and charac-
terizes optimal monetary policy and optimal macroprudential policy. Importantly, and in contrast to our theory, the
justification for macroprudential interventions in his model is entirely driven by the presence of pecuniary externali-
ties.
    2 By constrained inefficiency we mean, in both cases, that the planner does not necessarily have the tools necessary

to entirely overcome the frictions leading to inefficiencies. For example, in our applications the policy instruments
can be interpreted as taxes or regulation on borrowing or portfolio decisions. It is also important that monetary
policy be constrained and unable to overcome the nominal rigidities. In some applications it is also important that
tax instruments be somewhat constrained, to avoid being able to control all relative prices and effectively undo price
rigidities.
    3 Using a disequilibrium approach, Herings and Polemarchakis (2005) show that under some conditions, it is

possible to construct fix-price equilibria that Pareto dominate competitive (flex-price) equilibria when asset markets
are incomplete in the absence of asset market interventions. In some way, our approach is the polar opposite. It takes
price rigidities as a constraint (if prices were flexible, competitive equilibria would be Pareto efficient) and looks


                                                           2
results are instead driven by aggregate demand externalities that arise from the price rigidities.
    Second, we jointly characterize optimal monetary and macroprudential policy by provid-
ing explicit formulas combining three sufficient statistics: elasticities of substitution, marginal
propensities to spend, and good-specific wedges. Wedges are a standard measure for the depar-
ture of an allocation from the first best benchmark—a positive wedge signals the under-provision
of a good.4
    Our formulas for optimal monetary policy adapt the standard optimal monetary policy tar-
geting rules derived in the New Keynesian literature (see e.g. Woodford, 2003) to our setting with
macroprudential policy. These standard targeting rules form the core of the inflation targeting
doctrine and its elaborations. Formally, we express the relevant first-order conditions as a linear
system of equations in the wedges, with coefficients given by substitution elasticities, and forcing
variables given by the derivatives of the constraints on price adjustment and monetary policy, as
well as their associated multipliers. Wedges are nonzero to the extent that these forcing variables
are nonzero, indicating that the corresponding constraints are binding. Intuitively, monetary pol-
icy targets a set of weighted averages of the wedges. The forcing variables capture the fact that
nominal rigidities and constraints on monetary policy prevent achieving these ideal targets.
    Our formula for optimal macroprudential policy provides the financial taxes required on any
asset and agent in the economy. It depends on simple combination of wedges and marginal
propensities to spend. According to the formula, in our baseline model the Arrow-Debreu hold-
ings for an agent in a particular state of the world is relatively subsidized if this agent tends to
spends relatively heavily on goods with high wedges. Intuitively, optimal financial taxes provide
incentives for agents with higher marginal propensities to spend on goods that are relatively de-
pressed in some states to tilt their wealth towards these states. The resulting change in the ex-post
wealth distribution increases aggregate demand for these goods, lowering the wedge and mitigat-
ing the inefficiency. These macroeconomic stabilization benefits are due to an aggregate demand
externality that is not internalized by atomistic private agents. As a result, optimal government
intervention in financial markets can be understood as Pigouvian corrective taxes, or associated
quantity restrictions, that overcome this market failure.5
    We allow a subset of goods to be rationed to capture, in particular, the possibility of underem-
ployment with nominal wage rigidities, where workers are forced off their labor supply curves.
Our formula for financial taxes includes only wedges and marginal propensities to spend on those
goods that are not rationed. This is natural, since marginal propensities to spend on rationed
goods are effectively zero.
for Pareto improvements through interventions in asset markets when markets are complete. Another important
difference is that we are concerned with nominal rigidities and constraints on monetary policy, while their approach
is real.
    4 Output gaps in log-linearized New Keynesian models are first order approximation of wedges.
    5 Blanchard and Kiyotaki (1987) isolate a different form of aggregate demand externality. In their framework, for a

given level of nominal money balances, individual firms’ price setting decisions influence aggregate demand through
the level of real money balances, an effect which they fail to internalize.



                                                          3
    We also briefly consider ex-post redistribution after the realization of the state of world. In our
model, redistributing towards agents with higher marginal propensities to spend on depressed
goods provides macroeconomic stabilization benefits. Rather than equalizing private marginal
utilities of income, the ex-post optimum equalizes social marginal utilities of income, where for
any given agent, the difference between private and social marginal utility of income coincides
with the optimal financial tax required in that state of the world. We use this result to argue
that the optimum is time consistent: as long as the right set of ex-ante macroprudential policies
is available, no commitment over ex-post transfers is required. Financial taxes are required in
order to prevent agents from undoing the desired ex-post wealth distribution through financial
markets.
    Our baseline model purposefully abstracts from financial markets frictions that give rise to
pecuniary externalities, such as incomplete markets and borrowing constraints that depend on
prices. This allows us to focus on an entirely different set of frictions—nominal rigidities and con-
straints on monetary policy—that give rise to aggregate demand externalities, providing a distinct
rationale for macroprudential policies. However, the two theories are not mutually exclusive and
both frictions may be present in some applications. To address this possibility, we extend our
baseline model and provide a unified framework that incorporates both aggregate demand and
pecuniary externalities. The system of linear equations in wedges describing optimal monetary
policy now acquires new forcing variables, due to market incompleteness and the presence of
prices in borrowing constraints. Remarkably, however, our formula for optimal macropruden-
tial policy is unchanged in the unified model. To be sure, the presence of pecuniary externalities
affects wedges, but does not affect the mapping from wedges to macroprudential policy.
    We illustrate our results with four applications, three novel ones and one that appeared earlier
in our own work.6 All our examples are fit within our general model. Some feature only aggregate
demand externalities, while others fit within our feature both aggregate demand and pecuniary
externalities. These applications demonstrate the versatility of our framework from a theoretical
perspective and the importance of the underlying mechanisms from an applied perspective.
    Our first application is motivated by Eggertsson and Krugman (2012) and Guerrieri and Loren-
zoni (2011), that show how episodes with household deleveraging can throw the economy into
a liquidity trap. There are two types of agents: borrowers and savers. Borrowers are initially
indebted to savers, but must pay down their debts. This “deleveraging” requirement amounts
to a binding borrowing constraint that reduces equilibrium real interest rates in a flexible price
model and may lead to a liquidity-trap recession in the presence of nominal rigidities. We ex-
tend this model by adding an earlier period, before the deleveraging shock, where the borrower
contracts debt, capturing the “credit boom” phase before the crisis. In parallel and independent
   6 In
      a previous version of this paper, we also presented two additional applications: an application to risk sharing
through financial markets or fiscal transfers in currency unions along the lines of Farhi and Werning (2012b), and an
application to capital controls with flexible exchange rates in anticipation of a liquidity trap. We have excluded these
applications in the current version to economize on space.



                                                           4
work, Korinek and Simsek (2014) analyze a similar situation.
    Our main result in this context emphasizes ex-ante macroprudential restrictions on borrow-
ing, which could in practice take the form of regulatory Loan-To-Value (LTV) or Debt-To-Income
(DTI) ratios. The optimal intervention lowers the build up in debt during the credit boom. As
a result, borrowers are richer, and savers poorer, when the crisis hits. This increases aggregate
demand,since borrowers have a higher marginal propensity to consume, stimulating the econ-
omy precisely when the economy is depressed. This stabilization benefit is is not internalized by
individual borrowers. Optimal policy corrects this an aggregate demand externality by imposing
macroprudential Pigouvian taxes, or corresponding quantity restrictions, on borrowing.
    There has been considerable recent debate over the proper conduct of monetary policy during
a credit boom. Should monetary policy lean against the wind by raising interest rates? Or is
it best to continue to focus on the usual macroeconomic targets? Our model sheds light on these
questions. We show that in the initial period, during the credit boom, the optimal mix of monetary
and macroprudential policy achieves perfect macroeconomic stabilization. There is no need to
sacrifice macroeconomic stability by tightening monetary policy to improve financial stability. It
is better to tighten macroprudential policy instead.
    We present a few extensions of the deleveraging model. We introduce uncertainty, so that the
deleveraging requirement on borrowers only occurs with some probability. We use this to show
that macroprudential policies during the credit boom only restrict borrowing against future states
of nature where the zero-lower bound binds. This highlights that the problem is one of under
insurance in borrowing, rather than over borrowing overall.
    We also extend the model by adding a housing sector and study borrowing constraints that
depend on housing prices. This leads to a hybrid model with both aggregate demand and pecu-
niary externalities. These two externalities amplify each other through a feedback loop: ex-ante
borrowing reduces ex-post aggregate demand, which in turn reduces housing prices and tightens
ex-post borrowing constraints further, further reducing ex-post aggregate demand etc. ad infini-
tum. Optimal macroprudential interventions corrects for both mutually reinforcing externalities.
    Our second application concerns Mundell’s trilemma, drawing on our previous work in Farhi
and Werning (2012a) (see also Schmitt-Grohe and Uribe, 2012).7,8 We consider a small open econ-
omy that can attain perfect macroeconomic stabilization with flexible exchange rates, just as en-
visioned by Friedman (1953). However, we consider a case where monetary policy is constrained
   7 To avoid overextending ourselves, we stop short of developing and explaining this application in full.We provide
a stylized version of the basic model and results that are enough to appreciate the unifying aspects emphasized by
the general approach taken in the present paper. However, Farhi and Werning (2012a) address a number of specific
issues that arise in the context of this application using a richer model.
    8 In Schmitt-Grohe and Uribe (2012), nominal rigidities take the form of downward sticky nominal wages. Wages

can only decrease over time at a certain pace that increases with the amount of slack in the economy, according to an
ad hoc norm. Because wages are not set in a forward looking manner in good times, this introduces an additional
rationale for macroprudential policy to influence the behavior of wages, taking into account that it will be hard to
decrease them later in bad times. This motive, which could account for significant welfare effects, is not captured in
our baseline model.



                                                          5
by a fixed exchange rate, due to a hard currency peg or membership in a currency union. With
monetary policy constrained in this way, we show that it is optimal to use macroprudential capital
controls. This can be understood as a second-best way of regaining monetary policy autonomy,
that is, control over the interest rate. Taxes on inflows should be deployed to cool down booms,
and taxes on outflows to mitigate recessions.
     Our third and fourth applications show a role for capital controls even when the exchange rate
is flexible, outlining an important qualification to the Mundellian paradigm that ties the benefits
of capital controls to fixed exchange rate regimes. We present two examples without constraints
on monetary policy, where the need for macroprudential capital controls arise due to the interac-
tion of financial market imperfections and nominal rigidities. In the third application, domestic
agents are subject to a collateral constraints that depend on the terms of trade, a standard as-
sumption in the international literature on “sudden stops”, i.e. sharp reversals in capital flows.
In the fourth application, there are incomplete markets, with only non-contingent nominal debt
denominated in local and foreign currency. These applications feature both aggregate demand
and pecuniary externalities. In the third example application, taxes on capital inflows should
be imposed preemptively in anticipation of binding collateral constraints. The fourth example
application shows that capital controls should differentiate between local- and foreign-currency
borrowing, with higher taxes on foreign-currency debt. This is consistent with common wisdom
within policy circles arguing that international credit booms fueled by foreign-currency debt are
especially problematic.
     The rest of the paper is organized as follows. Section 2 introduces the baseline model. Section
3 characterizes ex-ante constrained-efficient Pareto optima, deriving conditions for monetary and
macroprudential policy. Section 4 introduces our unified model that allows for both pecuniary
and aggregate demand externalities. Section 5 presents four applications. Section 6 concludes.


2     Model Framework
This section lays out our baseline framework. The model strikes a balance between generality and
tractability: general enough to capture a wide set of applications, but tractable enough to derive
our main results in a way that transparently conveys the mechanisms at work. Our baseline
model isolates aggregate demand externalities, shutting down pecuniary externalities. Section 4
provides a unified model that incorporates both types of externalities.


2.1   Environment
We consider an economy populated by heterogenous agents. Financial markets are assumed to
be perfect, except possibly subject to simple borrowing limits. Heterogeneity is important to gen-
erate meaningful financial transactions and to allow differences in spending patterns. We abstract


                                                 6
from incomplete markets or borrowing constraints that depend on prices to avoid pecuniary ex-
ternalities and isolate the effects of aggregate demand externalities.
    In addition to financial markets, agents transact in goods and labor markets that suffer from
nominal rigidities. Monetary policy may mitigate the resulting inefficiencies, but we will be
most interested in situations where it is unable to fully restore the first best. This may be due
to self-imposed constraints on monetary policy such as fixed exchange rates, or more intrinsic
constraints, such as the zero lower bound on nominal interest rates. Even when monetary policy
is unconstrained it may not be able to achieve the first best, depending on the nature of the shocks
and nominal rigidities.9
    We adopt notation following conventions from the general equilibrium literature. Commodi-
ties are indexed by s ∈ S and j ∈ Js , so that the consumption vector is of dimension N = ∑s∈S #Js .
The dichotomy between s and j is required to separate perfect financial markets from imperfect
goods and labor markets. In applications, s ∈ S denotes a state of the world, a time period, or
a set of time periods, while j ∈ Js denotes commodities within state s. An important distinction
between s ∈ S and j ∈ Js is that we allow the government to use taxes or quantity restrictions to
influence financial transactions across states, but rule out such policy tools to influence spot trans-
actions within a state. This is done to focus on the role of macroprudential policy interventions in
financial markets.
    Technology is described by
                                             F ({Yj,s }) ≤ 0,                                       (1)

where Yj,s is the production of good j in state s and F : R N → R is a convex function.
  Agent i ∈ I has preferences described by the utility function

                                                   ∑ U i ({Xj,s
                                                            i
                                                                }; s ),
                                                   s∈S


where the functions U i (·; s) are concave and X j,s
                                                 i is the consumption of agent i of good j in state s.

The state-dependent utility function U i (·; s) may be embed probabilities of states and even allow
for heterogenous subjective beliefs across agents.
    Agent i faces the budget constraints

                                             ∑ Dsi Qs (1 − τD,s
                                                            i
                                                                ) ≤ −Ti ,
                                             s∈S


                                      ∑ Pj,s Xj,s
                                              i
                                                  ≤ − T̂si + Dsi          ∀s ∈ S,
                                     j∈ Js

   9 Insimple closed-economy, one-sector New Keynesian model with sticky prices and flexible wages the “divine
coincidence” result provides conditions under which unconstrained monetary policy attains the first best. These
results are not immediately applicable in richer frameworks, such as open economies, or multi-sectors models or
models that also include nominal wage rigidities. In these situations, the first best would require the adjustment of
various relative prices, which are impeded by nominal rigidities that cannot be fully overcome by monetary policy.


                                                            7
where
                                                   T̂si = Tsi − xi    ∑ Pj,s Yj,s .
                                                                      j∈ Js

The first constraint represents the financial market stage, where the agent can transfer wealth
across states s ∈ S by trading in a complete set of Arrow-Debreu securities, where Dsi denotes the
holdings by agent i of a state-contingent claim that pays one in units of the numeraire in state s and
zero in other states and Qs is the price of a unit of this claim. Importantly, we introduce an agent-
and asset-specific tax/subsidy τD,s  i so that agents face different net-of-tax/subsidy state prices
           i
Qs (1 − τD,s ). Note that we could either haveτD,s i   ≥ 0, corresponding to a subsidy, or τD,s    i  ≤ 0,
                                                                           i
corresponding to a tax. In the rest of the paper, we simply refer to τD,s as financial tax, or as a
macrorpudential intervention. In addition to this distortion, we also allow for a lump-sum tax T i .
    The second budget constraint represents the spot market stage. On the right-hand side income
Is is financial wealth Dsi net of a lump-sum tax Tsi gross of share of profits xi ∑ Pj,s Yj,s .10 We allow
 i

a lump-sum tax at this stage for convenience.11 When labor is one of the commodities in Js , labor
income is included implicitly on the left-hand side as a negative entry.
    It is sometimes useful to allow for a restriction on consumption by imposing

                                           Bsi ({ X j,s
                                                    i
                                                        }) ≤ 0          ∀s ∈ S, ∀i ∈ I,

for some convex function Bsi . Restrictions on the consumption possibility set fit in with standard
consumer demand theory. In our applications, this constraint allows us to capture simple borrow-
ing limits. This can be done by labeling consumption (and labor) over two periods as different
commodities j under the same state s. The constraints do not depend on prices to avoid introduc-
ing pecuniary externalities. Section 4 introduces more general borrowing constraints that include
prices, giving rise to pecuniary externalities. Importantly, the functions Bsi are independent of
policy, so that the constraints cannot be directly manipulated by the planner to influence agents’
spending decisions within a state.
    The indirect utility function for agent i in state s is

      Vsi ( Isi , { Pj,s }) ≡ max U i ({ X j,s
                            { X ij,s }
                                           i
                                               }; s )   subject to            ∑ Pj,s Xj,s
                                                                                      i
                                                                                          ≤ Isi   and            i
                                                                                                        Bsi ({ X j,s }) ≤ 0.
                                                                              j∈ Js


Let
                                                      i       i
                                                    X j,s = X j,s ( Isi , { Pj,s })                                            (2)
                                                              i
denote the associated Marshallian demand functions and by Sk,j,s = XPi k ,j,s + Xk,s
                                                                                 i Xi
                                                                                     I,j,s the associ-
ated Slutsky matrix. Note that when one of the commodities j ∈ Js is labor, this problem assumes
that agents are free to choose their labor supply, given the wage, i.e. they are always on their
  10 Here   xi denotes the share of profits of agent i, with ∑i∈ I xi = 1.
  11 Given   complete markets, this lump sum tax is redundant to the planner.



                                                                  8
“labor supply curve”. Section 3.3 considers situations with sticky wages and rationed labor.
   To capture price rigidities and restrictions on monetary policy we impose

                                                       Γ({ Pj,s }) ≤ 0,                                            (3)

where Γ : R N → R M is a vector function. This allows us to capture fairly flexible forms of nominal
rigidities and constraints on monetary policy, such as the zero lower bound or fixed exchange
rates. Section 5 provides concrete applications where these constraints are explicitly spelled out
and mapped into the present framework.
    On the supply side, we have described technology but postpone a precise description of mar-
ket structure. Following the seminal analysis of Diamond and Mirrlees (1971) we proceed as if
production and prices were controlled by the planner.12 Section 5 provides explicit decentral-
izations for production and price decisions that adopt the standard New Keynesian model with
monopolistically competitive firms that post prices and meet demand at these prices. Our plan-
ner can implicitly control production and price decisions by appropriate taxes and subsidies. In
particular, as is standard in the New Keynesian literature, these taxes are used to remove the
distortion from monopoly markups.
    The government budget constraints are

                                      ∑ Ds Qs + ∑ ∑ τD,s Dsi Qs = ∑ T i ,
                                            g        i
                                     s∈S                i ∈ I s∈S            i∈ I


                                   ∑ Pj,s Yj,s + ∑ T̂si + Ds
                                                                    g
                                                                        =0   ∀s ∈ S.
                                   j∈ Js               i∈ I


2.2    Equilibrium
                                                           i }, output {Y }, state contingent debt { D i , D }        g
An equilibrium is an allocation for consumption { X j,s                     j,s                         s    s
                                                     i       i         i
as well as prices { Qs } and { Pj,s }, and taxes {τD,s }, { T } and { Ts } such that agents optimize, prices
satisfy the nominal rigidity restrictions, the government balances its budget and markets clear so
that
                                      Yj,s = ∑ X j,s
                                                  i
                                                         ∀s ∈ S, ∀ j ∈ Js .                               (4)
                                                i∈ I
  12 The goal in Diamond and Mirrlees (1971) was to characterize arrangements where agents interact in decentralized

markets and the government seeks to achieve some redistributive objective or to raise some revenues. They were led
to a second best problem because they assumed that the government could only use a restricted set of instruments,
linear commodity taxes. They ruled out lump-sum taxes which would allow the government to achieve its objectives
without imposing any distortion, thereby reaching the first best. We are interested in a different set of constraints,
namely nominal rigidities in the prices faced by consumers. We also incorporate restrictions on instruments, but of
a different nature. In particular, we allow for lump-sum taxes (T i and Tsi ), but rule out a complete set of commodity
taxes that would allow the government to get around the nominal rigidities and attain the first best.




                                                                9
This implies that the markets for state-contingent claims clear so that

                                        Ds + ∑ Dsi = 0
                                          g
                                                                       ∀s ∈ S.
                                                 i∈ I


Proposition 1 (Implementability). An allocation for consumption { X j,s       i } and output {Y } together
                                                                                                  j,s
                                                                                     i
with prices { Pj,s } form part of an equilibrium if and only if there are incomes { Is } such that (1), (2), (3)
and (4) hold.

    For any feasible allocation, it will be useful to define the wedges τj,s :

                                                             Pj∗ (s),s Fj,s
                                          1 − τj,s =                         ,
                                                              Pj,s Fj∗ (s),s

for each s ∈ S given some reference good j∗ (s) ∈ Js . These wedges are zero at first best alloca-
tions. More generally, goods with positive wedges τj,s > 0 feature a deficit of demand (good j
is depressed) while goods with negative wedges τj,s < 0 feature an excess of demand (good j is
overheated). For example, suppose there is a single consumption good produced from labor, then
taking the consumption good as the reference good j∗ (s), and indexing labor by j, the wedge τj,s is
simply the labor wedge metric defined and measured in the business cycle and search literature.
In log-linearized New Keynesian models the labor wedge is negatively related one-for-one to the
output gap, a concept defined as the log deviation of output from its efficient level.


2.3    Planning Problem
We now formulate the Ramsey planning problem of choosing the equilibrium that maximizes
social welfare, computed as a weighted average of agents utilities with Pareto weights λi :

                                         max ∑ ∑ λi Vsi ( Isi , { Pj,s }),                                  (5)
                                                 i ∈ I s∈S

subject to
                                        F ({∑ X j,s
                                                i
                                                    ( Isi , { Pj,s })}) ≤ 0,
                                              i∈ I

                                                     Γ({ Pj,s }) ≤ 0.


3     Optimal Monetary and Macroprudential Policy
In this Section we characterize optimal monetary and macroprudential policy as the solution to
the planning problem (5). Our main result is a simple formula for optimal interventions, ex-
pressed in terms of sufficient statistics. We prove that macroprudential policies are needed except



                                                             10
in knife-edge cases. We also extend our results to situations with sticky wages. Finally, we com-
pare ex-ante macroprudential policies with ex-post redistribution policies and shed light on the
time-consistency properties of optimal policy.


3.1    Optimal Policy
The first-order conditions for income Isi and prices Pk.s are

                                          λi VI,s
                                              i
                                                  =µ         ∑ Fj,s XiI,j,s   ∀i ∈ I, ∀s ∈ S,
                                                             j∈ Js


                       ∑ λi VPi k ,s = ∑ ∑ µFj,s XPi k ,j,s + ν · ΓPk,s               ∀s ∈ S, ∀k ∈ Js ,
                       i∈ I                    i ∈ I j∈ Js

where µ is the multiplier on the resource constraint and ν is the vector multiplier on the price con-
straint. We can rearrange these first-order conditions to derive the following two key equations
in terms of wedges
                                λi VI,s
                                      i                  µFj∗ (s),s
                                                       =            ∀i ∈ I, ∀s ∈ S,                (6)
                        1 − ∑ j∈ Js Pj,s X iI,j,s τj,s   Pj∗ (s),s

                          µFj∗ (s),s
                              Pj∗ (s),s    ∑ ∑ Pj,s τj,s Sk,j,s
                                                          i
                                                                = ν · Γ Pk,s        ∀s ∈ S, ∀k ∈ Js .           (7)
                                           i ∈ I j∈ Js

The left-hand side of equation (6) defines the correct notion of social marginal utility of income
and can be compared to the private marginal utility of income λi VI,s   i . The difference between the

social and private marginal utility of income for of agent i is larger when this agent displays a
higher marginal propensity to spend Pj,s X iI,j,s with large wedges τj,s (depressed goods). Since the
right-hand side of equation (6) is independent of i, the social marginal utility of income must be
equalized across agents in all states of the world s ∈ S.
     Equation (6) characterizes optimal macroprudential policy, while equation (7) characterizes
optimal monetary policy. Equation (7) expresses optimal monetary policy in terms of policy tar-
gets (see e.g. Woodford, 2003) that form a linear system of equations in the wedges τj,s , with
                                                             i , and with forcing variables given by
coefficients commensurate with substitution elasticities Sk,j,s
the derivatives Γ Pk,s of the constraints on price adjustment and monetary policy and their asso-
ciated multipliers ν. The wedges τj,s are non-zero to the extent that these forcing variables are
non-zero, indicating that the corresponding constraints are binding. Intuitively, these conditions
show that optimal monetary policy targets some weighted average of wedges in each state of the
world. If prices Pj,s were perfectly free, so that Γ is trivial, then it would be possible to achieve
τj,s = 0 for all j ∈ J and s ∈ S. Constraints on price adjustment and monetary policy can prevent
achieving the ideal outcome, with zero wedges.13
  13 The model can be generalized to the case where the constraint on prices and monetary policy depends directly

on the output vector {Yj,s }, so that it becomes Γ({ Pj,s }, {Yj,s }) ≤ 0. This would be the case for example with a


                                                                       11
   Turning back to equation (6), nonzero wedges and marginal propensities to spend feed into
                                                                                               i
social marginal utilities of income. These can be used to compute the optimal financial taxes τD,s
required to implement the social optimum.14

Proposition 2. The solution to the planning problem (5) can be implemented with financial taxes given by

                                               i
                                              τD,s =       ∑ Pj,s XiI,j,s τj,s ,
                                                           j∈ Js


with wedges τj,s satisfying the weighted average conditions (7).

    Private financial decisions are based on private marginal utilities instead of social marginal util-
ities. Corrective taxes are required to align private and social incentives. The difference between
private and social marginal arises from an aggregate demand externality. Intuitively, financial de-
cisions determine the wealth distribution across states s ∈ S. When agents have different spend-
ing patterns, changes in the distribution of wealth affect demand. These changes in demand can
improve efficiency, but infinitesimal agents do not internalize the macroeconomic consequences
of their financial decisions. Aggregate demand externalities justify government interventions.
    Our formula shows that the taxes τD,s       i can be expressed in terms of two sufficient statistics: the

marginal propensities to spend Pj,s X iI,j,s and wedges τj,s . Both of these variables are well-known
concepts, that can in principle be measured from the data or calibrated from standard models,
and are the focus of large applied literatures. According to the formula, financial taxes should
encourage an agent to shift wealth towards a state if this agent tends to spend relatively more (at
the margin) than others on goods with positive wedges.
    To be specific, Proposition 2 delivers the tax rates required when state prices Qs are propor-
tional to Fj∗ (s),s /Pj∗ (s),s . There are other possibilities since all that matters for consumers is the after
tax prices (1 − τD,s  i ) Q . However, the relative financial taxes (1 − τ i ) / (1 − τ i0 ) faced by two
                              s                                                   D,s         D,s
                  0
agents i and i in any given state s ∈ S are uniquely determined by (1 − ∑ j∈ Js Pj,s X iI,j,s τj,s )/(1 −
             0
∑ j∈ Js Pj,s X iI,j,s τj,s ). With nonzero wedges τj,s and differences in marginal propensities to spend
Pj,s X iI,j,s across agents i and i0 , relative financial taxes are nonzero in general. We formalize this
statement in Section 3.2, establishing that nonzero financial taxes are generically required.
     A standard Ricardian equivalence indeterminacy permeates our implementation: any ex-post
wealth distribution can be obtained by different combinations of financial portfolios Dsi and lump-
Keynesian Philips curve. Both our formulas, for optimal monetary and macroprudential policy, go through with one
                                                       1 Pj∗ (s),s
modification: τj,s is replaced everywhere by τj,s −   Pj,s µFj∗ (s),s ( ν · ΓYj,s ).   In other words, what matters now is not solely
whether a good is depressed, as captured by τj,s , but whether increasing spending on this good relaxes the constraint
                                                                                Pj∗ (s),s
on prices and monetary policy, as reflected in the new term − P1
                                                                          j,s   µFj∗ (s),s ( ν · ΓYj,s ).
  14 Proposition 2 shows that constrained Pareto efficient outcomes—solutions of the planning problem (5) for some
set of Pareto weights {λi }—can be implemented with taxes on state contingent debt. There are of course equivalent
implementations with quantity restrictions (caps and floors on portfolio holdings) instead of taxes, and we use both
in our applications, depending on the specific context. Our theory is silent on the relative desirability of these two
forms of intervention.


                                                                12
sum taxes Tsi . Loosely speaking, any insurance can be achieved privately through financial mar-
kets or through the government. Importantly, identical financial taxes τD,s  i  are required in both
cases. In the first case, the taxes are required to induce agents to purchase the right amount of in-
surance. In the second case, to prevent agents from undoing the government-provided insurance.


Arbitrary securities. Our model features complete markets with Arrow-Debreu securities. We
can easily allow for an arbitrary security a in zero net supply with payoff Za,s in each state s ∈ S
to be traded. The analysis is identical (the resulting planning problem is the same). And the
optimal financial tax on security a is given by a simple formula which can be easily deduced from
Proposition 2.

Corollary. If security a were independently traded, then the solution to planning problem the planning
problem (5) would require an agent specific financial tax on security a given by

                                                     Fj∗ (s),s
                                                     Pj∗ (s),s Za,s
                                     τai =   ∑        Fj∗ (s),s
                                                                       i
                                                                      τD,s .
                                             s∈S ∑s∈S P         Z a,s
                                                       j∗ (s),s


   Security a can be replicated by a portfolio consisting of Za,s units of every Arrow-Debreu se-
curity paying one in state s ∈ S. For each agent i, the optimal tax financialτai on security a is a
weighted average of the underlying Arrow-Debreu securities with weights commensurate with
their proportions Za,s in the replicating portfolio and state prices Qs = Fj∗ (s),s /Pj∗ (s),s .


Policy instruments. We have allowed for a rich set of policy instruments in the form of monetary
                                              i }, and a complete set of lump-sum taxes { T i } and
policy, a complete set of financial taxes {τD,s
{ Tsi }. These instruments allow the implementation of a large set of allocations characterized in
                                                       i } allows the planner to control the portfolio
Proposition 1. The complete set of financial taxes {τD,s
decisions of each agent. This complete set of financial taxes is the same as that considered in
the pecuniary externalities literature. The complete set of lump-sum taxes { T i } and { Tsi } ensure
that the sole objective of financial taxes is to correct for the resulting market failure, and not to
indirectly redistribute resources across agents (recall that the lump-sum taxes { Tsi } are actually
redundant). Similar lump-sum taxes are considered in the pecuniary externalities literature, and
for the same reason. Hence, and in the same spirit as the pecuniary externalities literature, the
set of policy instruments that we consider is theoretically compelling because it allows to neatly
zoom in on a key macroecomomic externality, in our case an aggregate demand externality.
      But a natural question is whether such a rich array of agent-specific taxes is likely to be avail-
able in practice. In our applications, there is a limited amount of heterogeneity across agents
which come in two types: borrowers and savers, or domestics and foreigners. In these settings,
the set of policy instruments that are needed to implement constrained efficient allocations is
relatively limited: simple Loan-To-Value ratio restrictions or capital controls are enough. The de-

                                                       13
mands on the set of policy instruments increase in environments with richer heterogeneity. It
is sometimes possible to construct alternative implementations where all agents are confronted
with the same nonlinear financial tax schedule as a function of portfolios, but face different agent-
specific marginal financial taxes because they endogenously choose different portfolios.15 Finally,
it may be of interest to impose additional exogenous restrictions on the set of available financial
taxes. We conjecture that some averaged-out version of our results would obtain, but characteriz-
ing optimal policy in this context goes beyond the scope of this paper, and we leave it for future
research.
    One could also consider going in the opposite direction by allowing for a richer, rather than
more restricted, set of policy instruments. In particular, it is well understood that if rich and
flexible enough commodity taxes are available, and in particular a full set of taxes that change
consumer prices for given sticky producer prices, then it is possible to completely circumvent
nominal rigidities and implement the first best, independently of constraints on monetary policy
(see e.g. Correia et al., 2008, 2013; Farhi et al., 2014). These commodity taxes can clearly be useful,
but it is difficult to imagine that they would be flexible enough in practice to actually deliver
the first best. While we do not elaborate on this point, our model allows us to capture these
taxes as well as constraints on their use. Nominal rigidities, constraints on monetary policy, and
constraints on such commodity taxes are all captured by the constraint Γ({ Pj,s }) ≤ 0 as a function
of consumer prices { Pj,s }.


3.2    On the Generic Need for Macroprudential Interventions
A constrained efficient allocation can be implemented without financial taxes only if

            1 − ∑ j∈ Js Pj,s X iI,j,s τj,s       1 − ∑ j∈ Js0 Pj,s0 X iI,j,s0 τj,s0
                                  0          =                            0           ∀i ∈ I, i0 ∈ I, s ∈ S, s0 ∈ S.   (8)
            1 − ∑ j∈ Js Pj,s X iI,j,s τj,s       1 − ∑ j∈ Js0 Pj,s0 X iI,j,s0 τj,s0

Proposition 3 below establishes that this only happens in knife-edge cases, that is, in situations
that are not generic.
    To establish this result we consider a utility perturbation described by a set of utility func-
tions U i,e indexed by e > 0. We restrict attention to perturbations where the functions U i,e (·; s),
their derivatives DU i,e (·; s) and their second second derivatives D2 U i,e (·; s) converge uniformly
on compact sets as e → 0 to DU i (·; s) and D2 U i (·; s), respectively. Our next result presumes a
constrained efficient allocation that is not first best, so that τj,s 6= 0 for some s ∈ S and j ∈ Js . We
then show that if this allocation can be implemented without financial taxes, so that (8) holds, we
can then find a utility perturbation for which the optimum requires financial taxes. That is, for
  15 Forexample, in our first application in Section 5.1, we use a constraint on borrowing as a policy instrument,
which is a form of nonlinear financial tax on borrowing. An endogenous outcome of the model is that this policy-
induced borrowing constraint affects only borrowers but not savers. As a result, borrowers face a higher implicit
marginal tax rate on borrowing than savers.


                                                                     14
which (8) is violated.

Proposition 3. Suppose that the solution of the planning problem (5) can be implemented without financial
taxes. Suppose in addition that it is not first best. Then we can find a utility perturbation U i,e such that for
e > 0 small enough, the solution of the perturbed planning problem where U i is replaced by U i,e cannot be
implemented without financial taxes.

    The basic idea of the proof is as follows. Denote the incomes and prices that solve the non-
perturbed planning problem by Īsi and P̄j,s , and we denote place a bar over variables representing
functions evaluated at these income and prices. We construct a utility perturbation U i,e such that
at the incomes Īsi and prices P̄s , the individual demand functions X̄si,e are unchanged, the Slutsky
matrices S̄si,e are unchanged, the social marginal utility of incomes λi V̄I,si,e
                                                                                  /(1 − ∑ j∈ Js P̄j,s X̄ i,e
                                                                                                         I,j,s τ̄j,s )
are unchanged, but the income derivatives of the individual demand functions X̄ i,e        I,j,s are changed
in such a way that (8) is now violated. Taken together, these conditions guarantee the incomes
Īsi and prices P̄j,s still solve the planning problem with the perturbed utility functions. Indeed, at
these incomes and prices, and with the perturbed utility functions, the constraints are still veri-
fied (because the quantities demanded are unchanged), and so are the first order conditions for
optimality because the Slutsky matrices and the social marginal utilities of income are unchanged.
However, given that (8) is violated, the solution cannot be implemented without financial taxes.
      The requirement that the allocation not be first best is important. For example, so that there
are no restrictions on prices, i.e. Γ is simply the zero function. In this case, constrained efficient
allocations are always first best, and can always be implemented without financial taxes. The
proof outlined above then fails since all the wedges τ̄j,s are zero, making it impossible to change
income derivatives of individual demand functions X̄ i,e   I,j,s to create a violation in (8).
      Now suppose that the solution of the planning problem (5) requires financial taxes—i.e. (5) is
violated. Then by continuity, all utility perturbations U i,e are such that for e > 0 small enough, the
solution of the perturbed planning problem where where U i is replaced by U i,e cannot be imple-
mented without financial taxes—i.e. (5) is violated. Together with Proposition 3, this indicates that
constrained efficient allocations that are not first best cannot generically be implemented without
financial taxes.


3.3    Rationing and Sticky Wages
So far our model accommodates nominal price rigidities, but not nominal wage rigidities. In the
model, agents are choosing quantities of goods subject to prices, that is, they are on their demand
curves. In particular, if good j ∈ Js represents leisure, this implies that agents are choosing labor,
that is, they are on their labor supply curve (leisure demand curve).
   We now extend the model to allow for sticky wages. Indeed, we proceed in a slightly more
general manner and consider various forms of rationing applying to different goods, with sticky
wages and rationing in labor markets emerging as one application.

                                                         15
General model with rationing. In each state s, there exists a subset J̄s ⊆ Js of goods for which
agents do not get to choose their consumption. The consumption of these goods is given by X̄ j,s i ,

exogenously to the agent, but determined endogenously by a rationing mechanism. Quantities
   i are subject to some constraints Θ ({ X̄ i }) ≤ 0. For example, efficient rationing corresponds
X̄ j,s                                           j,s
to the case where there are no constraints. Equal rationing corresponds to the case where the
constraint imposes that X̄ j,si = X̄ i0 for all i, i 0 ∈ I.
                                     j,s
      The indirect utility function is now

                                    Vsi ( Isi , { Pj,s }; { X̄ j,s
                                                               i
                                                                   }) = max U i ({ X j,s
                                                                                     i
                                                                                         }; s )

subject to
                                                            ∑ Pj,s Xj,s
                                                                    i
                                                                        ≤ Isi ,
                                                            j∈ Js

                                                            Bsi ({ X j,s
                                                                     i
                                                                         }) ≤ 0,
                                                          i        i
                                                        X j,s = X̄ j,s        ∀ j ∈ J̄s .

As before, we denote by X j,s     i ( I i , { P }; { X̄ i }) the associated Marshallian demand functions and
                                       s       j,s      j,s
    i        i         i     i
by Sk,j,s = XP ,j,s + Xk,s X I,j,s the associated Slutsky matrix.
              k



Planning problem.       We are led to the planning problem

                                          max ∑ ∑ λi Vsi ( Isi , { Pj,s }; { X̄ j,s
                                                                                i
                                                                                    }),                          (9)
                                                    i ∈ I s∈S

subject to
                                         F ({∑ X j,s
                                                 i
                                                     ( Isi , { Pj,s }; { X̄ j,s
                                                                            i
                                                                                })}) ≤ 0,
                                                i∈ I

                                                             Γ({ Pj,s }) ≤ 0,
                                                                    i
                                                             Θ({ X̄ j,s }) ≤ 0.

Optimal policy. For each s ∈ S pick a reference good j∗ (s) in Js \ J̄s . Let µ be the multiplier on the
resource constraint, ν the multiplier on the price constrain, and χ the multiplier on the rationing
constraint. We obtain the first-order conditions

                                        λi VI,s
                                            i                            µFj∗ (s),s
                                                                    =                       ∀i ∈ I, ∀s ∈ S,     (10)
                         1 − ∑ j∈ Js \ J̄s Pj,s X iI,j,s τj,s            Pj∗ (s),s

                       µFj∗ (s),s
                        Pj∗ (s),s   ∑ ∑                            i
                                                        Pj,s τj,s Sk,j,s = ν · Γ Pk,s        ∀s ∈ S, k ∈ Js .   (11)
                                    i ∈ I j∈ Js \ J̄s




                                                                      16
                                                  i
                             ∂Vsi             ∂X j,s
                          λi
                                i
                                    = µ ∑ Fj,s i + χ.Θ X̄i                             ∀s ∈ S, k ∈ J̄s .   (12)
                            ∂ X̄k,s     j∈ Js ∂ X̄k,s    k,s


Proposition 4. The solution to the planning problem (9) can be implemented with taxes given by

                                          i
                                         τD,s =     ∑           Pj,s X iI,j,s τj,s ,
                                                  j∈ Js \ J̄s


where the wedges τj,s must satisfy the weighted average conditions (11).

    The key difference with the formula in Proposition 2 is that only the goods that are chosen
(instead of rationed) appear in the formula. This is natural as for a given agent, wealth in a
particular state only influences spending on these goods.


3.4   Time Consistency and Redistribution
Our analysis has focused on influencing financial decisions before the realization of the state of
the world. From this ex-ante perspective, macroprudential interventions lead to Pareto improve-
ments in expected utility. The key mechanism is that the distribution of wealth Isi across agents in
each state s affects demand and, hence, economic activity ex post. However, the presence of both
ex-ante and ex-post instruments (ex-ante portfolio taxes and ex-post lump-sum taxes) naturally
raises the question of time consistency to which we now turn.
    In contrast to our previous analysis, assume that policies are decided sequentially, without
commitment. To simplify, let F and Γ be separable across states, so that we can write the corre-
sponding constraints as Fs ({Yj,s } j∈ Js ) ≤ 0 and Γs ({ Pj,s } j∈ Js ) ≤ 0 for all s ∈ S. Consider a policy
game with two stages, ex ante and ex post. To preserve the idea that agents act as price takers,
we proceed as in Chari and Kehoe (1990): we replace agent i by a unit-mass continuum indexed
by hi of identical agents of type i, where hi is uniformly distributed in [0, 1]; and we consider
anonymous symmetric perfect Bayesian equilibria of the associated game.
    In the ex-ante stage, the government chooses financial taxes {τDi,s }, lump-sum taxes { T i }, state
                                               g                                            h
prices { Qs }, and government portfolio { Ds }. Agents choose their portfolios { Ds i }. In the ex-post
stage, the state s is realized and the government chooses prices { Pj,s }, and lump-sum taxes { Tsi }.
                                            h
Agents choose their consumptions { X j,si } of the different goods available in state s. Importantly,
note that financial taxes {τDi,s } and lump-sum taxes { T i } and { Tsi } depend only on the agent type
i and not on the agent identity hi .
                                                                                                  h
    The payoff of agent hi of type i at the ex-ante (respectively ex-post) stage is ∑s∈S U i ({ X j,si }; s)
                      h
(respectively U i ({ X j,si }; s)) if his budget constraints are verified; it is −∞ otherwise. The payoff
of the government is the weighed average of agents’ utilities with weight λi dhi on the utility of a
mass dhi of agents of type i if the government budget constraints, the markets for state-contingent
claims, the the goods markets all clear, and if in addition Γs ({ Pj,s } j∈ Js ) ≤ 0 for all s ∈ S; it is −∞
otherwise.

                                                          17
   We proceed by backward induction. Ex post when state s is realized, the equilibrium allocation
solves
                                  max ∑ λi Vsi ( Isi , { Pj,s }),                            (13)
                                                             i∈ I

subject to
                                               Fs ({∑ X j,s
                                                        i
                                                            ( Isi , { Pj,s })}) ≤ 0,
                                                      i∈ I

                                                             Γs ({ Pj,s }) ≤ 0.

The first-order conditions are just as before, given by (6) and (7). This leads to the following result.

Proposition 5. For given state s, the solution of the ex-post redistribution planning problem (13) equalizes
the social marginal utility of income across agents
                                                                         0   0
                                λi VI,s
                                    i                                λi VI,s
                                                                         i
                                                      =                          0         ∀i ∈ I, ∀i0 ∈ I,
                     1 − ∑ j∈ Js Pj,s X iI,j,s τj,s       1 − ∑ j∈ Js Pj,s X iI,j,s τj,s

where the wedges τj,s must satisfy the weighted average conditions (7).

    In particular, ex post, the government equalizes social marginal utilities of income across
agents, rather than the private marginal utilities of income. Redistributing towards agents that
have a higher marginal propensity to spend on depressed goods (goods with high τj,s ) is benefi-
cial. In other words, there are macroeconomic stabilization benefits from redistribution.
    The allocation for incomes { Isi }, prices { Pj,s }, consumption { X j,s
                                                                         i }, and output {Y } that arises
                                                                                           j,s
in the ex-post stage coincides with the optimal allocation under commitment, solving (5). This im-
mediately implies that the optimum with commitment is time consistent: the optimal allocation
under commitment is an equilibrium allocation of the policy game, and the corresponding equi-
librium financial taxes {τDi,s } are the same as those required under commitment characterized in
Proposition 2.16,17


4       Unifying Aggregate Demand and Pecuniary Externalities
Our basic model purposefully assumed away the sort of financial frictions that generate pecuniary
externalities, which have already been invoked to justify macroprudential interventions. This
allowed us to isolate a new class of externalities, aggregate demand externalities, and to show
that they provide an independent rationale for macroprudential policies.
    16 Of
        course, the indeterminacy discussed earlier remains, so that there are many equilibria of the game, but all
share the same allocation.
  17 This time consistency of optimal policy result depends on the set of instruments and market structure that we

have assumed, on the separability across states of the production function and price constraints, as well as on our
assumptions on the number and timing of stages. We have analyzed different sets of assumptions under which
optimal policy is not time consistent. Due to space constraints, we cannot include the corresponding analysis in this
paper. Instead, we plan to explore these issues further in future work.

                                                                    18
    However, aggregate demand and pecuniary externalities are not mutually exclusive. In this
section, we build a unified model that allows for both forms of externalities and derive their
implications for macroprudential interventions. We extend our basic model by introducing the
frictions that are known to give rise to pecuniary externalities: incomplete markets and prices in
borrowing constraints.


General model with incomplete markets and prices in borrowing constraints. We generalize
the budget constraints as follows. Assets are indexed by a ∈ A, where the nominal payoff of
asset a in state s ∈ S is given by the function Za,s ({ Pj,s }) of the vector of all prices { Pj,s } in all
states. For example, assets with fixed nominal payoffs can be captured by assuming that Za,s are
independent of { Pj,s }. We allow payoffs to depend on prices to capture indexed debt, or nominal
debt in different currencies.
    Agent i faces the budget constraints

                                              ∑ Dai Qa (1 − τai ) ≤ −Ti ,
                                              a∈ A


                            ∑ Pj,s Xj,s
                                    i
                                        ≤ − T̂si + ∑ Dai Za,s ({ Pj,s })           ∀s ∈ S,
                            j∈ Js                       a∈ A

and the additional constraints

                                         Φi ({ Dai }; { Pj,s }) ≤ 0      ∀i ∈ I,

                                    Bsi ({ X j,s
                                             i
                                                 }, { Pj,s }) ≤ 0     ∀i ∈ I, ∀s ∈ S.

We now allow the function Bsi to depend on the vector of prices { Pj,s } in state s. We also introduce
a new vector constraint, Φi ({ Dai }; { Pj,s }) ≤ 0, on the portfolio { Dai } of agent i, where Φi is convex
in { Dai } and can depend on the price vector { Pj,s }. These two functions allow us to capture
borrowing constraints featuring prices.
     We define the indirect utility function Vsi ( Isi , Ps ), the Marshallian demand functions X j,s
                                                                                                    i ( I i , P ),
                                                                                                         s s
                                         i           i            i  i                        i
and the associated Slutsky matrix Sk,j,s = XP ,j,s + Xk,s X I,j,s . Note that because Bs depends on
                                                       k
{ Pj,s }, the Slutsky matrix is not necessarily symmetric and the Roy identity VPi k ,s + Xk,s   i Vi = 0
                                                                                                      I,s
does not necessarily hold.
     Unrestricted lump-sum taxes allow the government to circumvent the incompleteness of mar-
kets. To avoid this outcome, we introduce a new constraint

                                                      Ω({ T̂si }) ≤ 0.




                                                               19
As before, the government faces standard budget constraints

                                                                                                τai
                                                ∑                +∑         ∑                         = ∑ Ti ,
                                                        g
                                                       Da Q a                       Dai Q a
                                                a∈ A                    i∈ I a∈ A             1 + τai   i∈ I


                                   ∑ Pj,s Yj,s + ∑ T̂si + ∑ Da Za,s ({ Pj,s }) = 0
                                                                                    g
                                                                                                                     ∀s ∈ S.
                                   j∈ Js                i∈ I             a∈ A


Planning problem.                  The planning problem becomes

                                                          max ∑ ∑ λi Vsi ( Isi , { Pj,s }),                                                        (14)
                                                                    i ∈ I s∈S

subject to
                                                         F ({∑ X j,s
                                                                 i
                                                                     ( Isi , { Pj,s })}) ≤ 0,
                                                                 i∈ I

                                                                        Γ({ Pj,s }) ≤ 0,

                                           Isi = − T̂si +      ∑ Dai Za,s ({ Pj,s })                  ∀i ∈ I, ∀s ∈ S,
                                                            a∈ A

                                                       Φi ({ Dai }; { Pj.s }) ≤ 0                     ∀i ∈ I,

                                                                         Ω({ T̂si }) ≤ 0.


Optimal policy.            The first-order condition with respect to Dai is

                    ∑s∈S λi VI,s
                             i Z
                                 a,s
           Fj∗ (s),s
           Pj∗ (s),s Za,s
  ∑s∈S         Fj∗ (s),s        [1 − ∑ j∈ Js Pj,s X iI,j,s τj,s ]
         ∑s∈S P ∗        Za,s
                j (s),s

                                 Fj∗ (s),s                                              −ρi .ΦiDi
                 =µ∑                         Za,s +                Fj∗ (s),s
                                                                                                  a
                                                                                                                                  ∀ a ∈ A, ∀i ∈ I, (15)
                                Pj∗ (s),s
                        s∈S                                        Pj∗ (s),s Za,s
                                                       ∑s∈S            Fj∗ (s),s          [1 − ∑ j∈ Js Pj,s X iI,j,s τj,s ]
                                                                 ∑s∈S P ∗        Za,s
                                                                        j (s),s



where ρi is the multiplier on the constraint Φi ({ Dai }; { Pj.s }) ≤ 0 and ΦiDi is the derivative of the
                                                                                                                              a
function Φi with respect to Dai . The first term on the left-hand side still represents the concept of
social marginal utility of income. Social marginal utilities of income need not be equalized across
agents in all states s ∈ S because of the portfolio constraints Φi ({ Dai }; { Pj.s }) ≤ 0.
   The first order condition for Pk,s can be written as follows (using the first order condition for




                                                                                20
T̂si derived below)

                  Fj∗ (s),s
                  Pj∗ (s),s   ∑ ∑ Pj,s τj,s Sk,j,s
                                             i
                                                   = ν · Γ Pk,s + I Mk,s + PBk,s                         ∀s ∈ S, ∀k ∈ Js ,    (16)
                              i ∈ I j∈ Js


where
                         I Mk,s = − ∑ Xk,s
                                       i
                                           (ω · Ω T̂si ) +                   ∑ ∑ ∑ Dai Za,s0 ,Pk,s (ω · Ω T̂ i ),
                                                                               0                            s0
                                            i∈ I                             a∈ A s ∈S i ∈ I

                                       PBk,s = − ∑ λi [VPi k ,s + Xk,s
                                                                   i    i
                                                                       VI,s ] − ∑ ρi · ΦiPk,s .
                                                        i∈ I                                     i∈ I

Here, ω is the multiplier on the constraint Ω({ T̂si }) ≤ 0.
  The first-order condition for T̂si is

                          λi VI,s
                              i                        µFj∗ (s),s                   ω · Ω T̂si
                                                   =                −                                       ∀i ∈ I, ∀s ∈ S.   (17)
               1 − ∑ j∈ Js Pj,s X iI,j,s τj,s           Pj∗ (s),s       1 − ∑ j∈ Js Pj,s X iI,j,s τj,s

Proposition 6. The solution to the planning problem (14) can be implemented with financial taxes given
by
                                                                        Fj∗ (s),s
                                                                        Pj∗ (s),s Za,s
                                                       τai =   ∑        Fj∗ (s),s
                                                                                        i
                                                                                       τD,s ,
                                                               s∈S ∑s∈S P         Za,s
                                                                         j∗ (s),s

                          D are defined as
where the virtual taxes τi,s

                                                           i
                                                          τD,s =     ∑ Pj,s XiI,j,s τj,s ,
                                                                     j∈ Js


where the wedges τj,s must satisfy the weighted average conditions (16), and (17).

    Remarkably, the formula for optimal financial taxes in Proposition 6 is exactly the same as
in Proposition 2 and its corollary for arbitrary securities.18 It is independent of the exact fric-
tion: nominal rigidities and constraints on monetary policy; incomplete markets; and prices in
borrowing constraints. It applies in environments with aggregate demand externalities, pecu-
niary externalities, or both. Of course the underlying sufficient statistics (marginal propensities to
spend Pj,s X iI,j,s and wedges τj,s ) depend on the environment. But given these sufficient statistics,
the formula for optimal taxes is independent of the details of the environment.
    To understand how the different frictions contribute to the wedges τj,s , it is illuminating to
examine the system of equations (16). For each s ∈ S and k ∈ Js , the left-hand side represents a
weighted average of the wedges τj,s in state s. The right-hand side comprises three terms (on three
  18 This   exact formula might seem surprising in light of equation (15). The intuition is that for every agent, at
the optimal portfolio, these financial taxes align the social and private marginal benefits of any particular feasible
marginal trade (i.e. a trade that leaves the portfolio in the feasible set defined by the constraint portfolio constraint
Φi ({ Dai }; { Pj.s }) ≤ 0).


                                                                         21
different lines), corresponding to the different frictions contributing to non-zero wedges. As be-
fore, the first term ν · Γ Pk,s , which arises because of nominal rigidities and constraints on monetary
policy, is due to the frictions emphasized in our baseline model. The second term I Mk,s , which
arises because of incomplete markets, and the third term PBk,s , which arises because of prices in
borrowing constraints, are both new and are due to the additional financial frictions introduced
in the unified model. Overall, these terms show up as forcing variables in a linear system of equa-
tions for wedges τj,s . Wedges τj,s are nonzero to the extent that these forcing variables are nonzero,
indicating that the corresponding frictions are binding.
    As before, nonzero wedges τj,s and differences in marginal propensities to spend Pj,s X iI,j,s im-
ply that private financial decisions are suboptimal in the absence of financial taxes. Wedges and
marginal propensities to spend are enough to determine optimal financial taxes, independently
of the friction or combination of frictions that lead to these wedges.


5     Applications
We now study various applications, all of which map exactly into the general models and results
from Sections 3 and 4. Our applications illustrate optimal monetary and macroprudential poli-
cies in concrete examples. We stress aggregate demand externalities, but also consider pecuniary
externalities, as well as their interactions.


5.1   Liquidity Trap and Deleveraging
In this section we consider a liquidity trap model with “deleveraging” in the spirit of Eggertsson
and Krugman (2012). They study an economy with sticky prices where indebted households
are suddenly required to pay down their debt. This amounts to a form of forced savings that
lowers the real interest rate that would be prevail with flexible prices, i.e. the “Wicksellian natural
interest rate”. As long as this natural interest rate remains positive, monetary policy can perfectly
stabilize the economy, achieving the flexible price outcome, by setting the nominal interest rate
equal to the natural interest rate. However, because nominal interest rates are bounded below
by zero, if the deleveraging shock is large enough then the natural real interest rate becomes
negative, achieving the flexible price outcome is no longer possible. This generates a liquidity
trap: monetary policy finds itself constrained by the zero lower bound, and a recession ensues,
with output and employment below their flexible price levels.
    Eggertsson and Krugman (2012) take initial debt positions as given. To study macropruden-
tial policies, we extend their model by considering the pre-crisis determination of indebtedness,
as well as polices that curb this indebtedness. Indeed, we show that it is optimal to introduce
macroprudential limits on borrowing ahead of the crisis, which could in practice take the form of
macroprudential regulatory Loan-To-Value (LTV) or Debt-To-Income (DTI) ratios.


                                                  22
   There are a few ways of introducing nominal rigidities. Here, we consider a model with sticky
wages rather than sticky prices. We adopt an equal rationing rule in the labor market. These
particular choices do not affect our main conclusions. We could have instead assumed sticky
wages and efficient rationing, or flexible wages with sticky prices.19
   To keep things simple, we start with a deterministic model and focus on aggregate demand
externalities. We then extend the model to incorporate uncertainty and borrowing constraints that
are affected by housing prices, motivated by mortgage lending which takes real estate as collat-
eral. The latter gives rise to pecuniary externalities in addition to aggregate demand externalities.

Households. There are three periods t ∈ {0, 1, 2} and two types of agents i ∈ {1, 2} with relative
fractions φi in a population of mass 1. For concreteness it is useful to think of type 1 agents as
“savers” and type 2 agents as “borrowers”. Periods 1 and 2 represent the economy in Eggertsson
and Krugman (2012), with an exogenous binding borrowing constraint on borrowers. We add
period 0 where borrowers contract their initial debt with savers.
    Agents of type i have preferences over consumption and labor given by

                                                2
                                               ∑ βti [u(Cti ) − v( Nti )].
                                               t =0

We assume β 2 ≤ β 1 so that agents of type 2 are more impatient than agents of type 1. As a result,
agents of type 1 are natural savers while agents of type 2 are natural borrowers.
   Agents of type i face the budget constraints

                                                                     1
                                         Pt Cti + Bti ≤ Wt Nti +          Bi ,                               (18)
                                                                   1 + i t t +1

and B3i = 0, where Bti represent the nominal debt holdings, it is the nominal interest rate, and Wt
is the nominal wage.
    In period 1, type-2 agents face a borrowing constraint

                                                      B22 ≤ P2 B̄2 .                                         (19)

This constraint may arise from contracting imperfections and is assumed to be independent of
policy. We are interested in cases where this constraint binds, so that period 1 represents the
“deleveraging” stage. In contrast, we assume that borrowing in period 0, during the “credit
boom” stage, is unconstrained in the absence of government intervention in credit markets. We
consider policy interventions that limit borrowing in the initial period, where the government
chooses a maximum debt level B̄1 and imposes

                                                      B12 ≤ P1 B̄1 .                                         (20)
 19 A   previous version of this paper studies this application assuming sticky prices and flexible wages.

                                                           23
This constraint captures regulations that affect the amount of credit extended to borrowers.20,21
   The households’ first order conditions are

                                               1 Pt+1    β 1 u0 (Ct1+1 )
                                                       =                 ,                                         (21)
                                             1 + it Pt      u0 (Ct1 )
                                               1 Pt+1    β 2 u0 (Ct2+1 )
                                                       ≥                 ,                                         (22)
                                             1 + it Pt      u0 (Ct2 )

where each inequality holds with equality if the borrowing constraint in period t is slack.

Sticky wages and rationing. We assume sticky wages with Wt = W for all t. As a result, agents
are not necessarily on their labor supply curves, i.e. Wt /Pt 6= v0 ( Nti )/u0 (Cti ). Furthermore, we
assume that work is equally rationed: Nt1 = Nt2 = Nt for all t.

Firms. The final good is produced by competitive firms according to the production function

                                                     Yt = ANt .

Given a nominal wage W, perfect competition requires

                                                                W
                                                         Pt =     .                                                (23)
                                                                A

Government. The government sets the borrowing limit B̄1 in period 0, and the nominal interest
rate it in every period. In addition, it levies lump-sum taxes in period 0, which are equivalent to
choosing initial debt levels subject to

                                                 φ1 B01 + φ2 B02 = 0.

Equilibrium. An equilibrium specifies quantities for consumption {Cti }, labor supply { Nti },
debt holding { Bti }, prices { Pt }, wages W, nonnegative nominal interest rates {it }, and a borrow-
ing limit B̄1 such that households and firms maximize, there is equal rationing Nt1 = Nt2 = Nt ,
and markets clear,
                                       2             2
                                      ∑ φi Cti =    ∑ φi ANt          t = 0, 1, 2.                                 (24)
                                      i =1         i =1

These conditions imply that the bond market clears, i.e. φ1 Bt1 + φ2 Bt2 = 0 for all t.
   The conditions for an equilibrium (18)–(24) act as constraints on the planning problem we
study next. However, in a spirit similar to Lucas and Stokey (1983), we seek to drop variables and
  20 We could have also imposed a lower bound on debt, but this will not be relevant in the cases that we are interested

in. The borrowing constraint effectively allows us to control the equilibrium level of debt B12 .
  21 An alternative formulation that leads to the same results is to tax borrowing to affect the interest rate faced by

borrowers.

                                                           24
constraints as follows. Given quantities, equations (21) and (23) can be used to back out certain
prices, wages and taxes. Since these variables do not affect welfare they can be dispensed with
from our planning problem, along with all the equations except the market clearing condition
(24), the borrowing constraint
                                         C22 ≥ AN2 − B̄2 ,                                   (25)

the Euler equations,

                                      u0 (Ct1 ) = β 1 (1 + it )u0 (Ct1+1 ),                         (26)
                                      u0 (Ct2 ) ≥ β 2 (1 + it )u0 (Ct2 ),                           (27)

the complementary slackness condition

                          (C22 − AN2 + B̄2 )(u0 (Ct2 ) − β 2 (1 + it )u0 (Ct2 )) = 0,               (28)

and the requirement that nominal interest rates be positive

                                                     it ≥ 0.                                        (29)

Proposition 7 (Implementability). An allocation {Cti } and { Nt1 } together with nominal interest rates
{it } forms part of an equilibrium if and only if conditions (24), (25), (26), (27), (28), and (29) hold.

Optimal macroprudential interventions. We now solve the Ramsey problem of choosing the
competitive equilibrium that maximizes social welfare, computed as a weighted average of agents
utilities, with arbitrary Pareto weights λi ,

                                          2    2
                                    max ∑     ∑ λi φi βti [u(Cti ) − v( Nt )]                       (30)
                                         i =1 t =0

subject to (24)–(29). Henceforth, we are interested in cases where the borrower finds himself bor-
rowing constrained, so that (25) and (28) hold with equality, and (27) holds with strict inequality.
We also focus on the possibility that the zero lower bound binds in periods 1, and assume it does
not bind in period 0.
   The first-order conditions of this planning problem deliver a number of useful insights. Define
the normalized Pareto weights
                                             λit = λi βti .

Denote by the labor wedge of agents of type i ∈ {1, 2} in period t as

                                                          v0 ( Nti )
                                              τti = 1 −              ,
                                                          Au0 (Cti )


                                                       25
and we define the average labor wedge τ̄t by

                                        τ̄t       2
                                                        λi φ       τ0i
                                              = ∑ 2 t ii               i
                                                                         .
                                      1 − τ̄t   i =1 ∑ j=1 λt φi 1 − τ0


First, we can derive a set of equations that characterize the average labor wedge τ̄t . This character-
ization involves the multiplier ν ≤ 0 on the constraint u0 (C11 ) = β(1 + i1 )u0 (C21 ). This multiplier ν
is zero when the zero bound constraint i1 ≥ 0 is slack, and is negative otherwise. We have

                                                    τ̄0 = 0,

                                 τ̄1      λ1 φ1      1       ν u00 (C11 )
                                       = 2 1 i                              ,
                               1 − τ̄1  ∑i=1 λ1 φi 1 − τ11 λ11 φ1 u0 (C11 )
                                τ̄2       λ1 φ1      1     νβ 1 u00 (C21 )
                                      =− 2 2 i                              .
                              1 − τ̄2   ∑i=1 λ2 φi 1 − τ21 λ12 φ1 u0 (C21 )
Taken together, these equations imply that τ̄0 = 0, τ̄1 ≥ 0 and τ̄2 ≤ 0 with strict inequalities if
and only if the zero lower bound constraint binds. In other words, when the zero lower bound
constraint does not bind we achieve perfect macroeconomic stabilization (τ̄t = 0) in every period.
In contrast, when the zero lower bound binds the economy is in a recession in period 1 (τ̄1 > 0), in
a boom in period 2 (τ̄2 < 0), and is balanced in period 0 (τ̄0 = 0). The recession in period 1 occurs
because the zero lower bound prevents the reduction in the nominal interest rate i1 required to
stimulate the economy. The boom in period 2 relaxes the constraint u0 (C11 ) = β(1 + i1 )u0 (C21 ).
Intuitively, it overstimulates spending in period 2, so as to increase spending in period 1, thus
mitigating the recession in period 1.
    We now show that borrowing should be restricted in period 0. That is, that B̄1 is set low enough
to make constraint B12 ≤ P1 B̄1 bind. Indeed, intertemporal rates of substitution satisfy

                         1 − τ0B  β 2 u0 (C2 )                     1     β 1 u0 (C1 )
                                 = 0 21               and               = 0 11 ,
                         1 + i0    u (C0 )                       1 + i0   u (C0 )

where the implicit macroprudential tax τ0B is given by

                                        ν u00 (C11 )         1 − τ11 ∑2i=1 λ1i φi
                              τ0B =                    = τ̄1                      ,
                                      λ11 φ1 u0 (C11 )       1 − τ̄1 λ11 φ1

Here τ̄1 ≥ 0 and hence τ0B ≥ 0 with a strict inequality in both cases if the zero lower bound
constraint binds. When the zero lower bound binds, borrowing in period 0 should be restricted—
or an equivalent tax on borrowing (subsidy on saving) so that the implicit interest rate faced by
borrowers is (1 + i0 )/(1 − τ0B ) where τ0B > 0. This stimulates spending in period 1, when the
economy is in a recession. Intuitively, restricting borrowing in period 0 reshuffles date-1 wealth


                                                       26
away from savers, with a low propensity to spend, towards borrowers, with a high propensity to
spend. The resulting increase in spending at date 1 helps stabilize the economy. These stabiliza-
tion benefits are not internalized by private agents—hence the need for government intervention.
Proposition 8. Consider the planning problem (30). Then at the optimum, the average labor wedges are
such that τ̄0 = 0, τ̄1 ≥ 0 and τ̄2 ≤ 0 with strict inequalities if the zero lower bound constraint binds in
period 1. When it is the case, it is optimal to impose a binding borrowing constraint B12 ≤ P1 B̄1 on type-2
                                                                                               1−τ 1 ∑2i=1 λ1i φi
agents in period 0. The equivalent implicit tax on borrowing τ0B > 0 is given by τ0B = τ̄1 1−τ̄11       λ11 φ1
                                                                                                                  .

Discussion: optimal ex-ante policy mix. An interesting implication of Proposition 8 is that the
optimal mix of monetary and macroprudential policy achieves perfect stabilization τ̄0 = 0 in
period 0. This result can be interpreted as follows. In period 0, optimal policy is characterized
in target form by two first-order conditions: the equation determining τ0B and the condition that
τ̄0 = 0. Loosely speaking, these two targets correspond to two policy objectives: financial stability
and macroeconomic stability. Financial stability is addressed by macroprudential policy. Given
macroprudential policy, monetary policy then addresses macroeconomic stability by following
the standard targeting rule τ̄0 = 0 that arises in New-Keynesian models without constraints on
monetary policy or financial frictions.
    The fact that optimal monetary policy achieves perfect macroeconomic stabilization τ̄0 = 0 in
period 0 shows that there is no need to modify the objectives assigned to monetary policy by the
inflation targeting doctrine in order to address financial stability. In particular, it is not optimal to
implement tighter monetary policy in period 0 because of financial stability concerns. Financial
stability is best addressed with macroprudential policy.
    Of course, this conclusion rests on the availability of macroprudential instruments and the
assumption that these can be implemented effectively. In practice, there are concerns regarding
the implementation of such policies and the incentives they create for evasion and avoidance. One
formal way to see that is that macroprudential policies confront different agents with different
interest rates. In contrast, monetary policy “gets in all the cracks”, as Federal Reserve Board
governor Jeremy Stein put it (in a February 7th, 2013 speech), by setting a common market price,
the interest rate.22

Mapping to the general model. The planning problem (30) is a particular case of the one studied
in Section 3.3. There are two states. The first state corresponds to period 0, and the second state
to periods 1 and 2. In the first state, the commodities the consumption good and labor in period
0. In the second state, the commodities are the consumption good and labor in periods 1 and 2.
    The constraint on prices is that Pt = W/A and that Wt = W must be the same in all periods in
the period-t numeraire, and that the period-1 price of a unit of the period-2 numeraire 1/(1 + i1 )
  22 We have characterized optimal monetary policy under the assumption that macroprudential instruments are not
available. We show that both τ̄0 > 0 or τ̄0 < 0 are then possible, depending on whether engineering a recession by
increasing nominal interest rates increases and reduces borrowing.

                                                       27
must be lower than one. In every period, labor is not chosen by agents of either type. The rationing
constraint is that Nt1 = Nt2 for all t.
    Proposition 8 can then be seen as an application of Proposition 4. Indeed, it is instructive to see
how the general formula of Proposition 4 can be directly applied in the context of this example.
In the interest of space, we will omit the corresponding analysis for our other examples.
    In the first state, we take the consumption good to be the reference good. For all agents, it is
the only chosen good in this period. In the second state, we take the consumption good at date
2 to be the reference good. We call good 2 the date-2 consumption good and good 1 the date-1
consumption good. We focus on the case where i1 = 0 and borrowers are borrowing constrained
in period 1. In the second state, the marginal propensity to spend on good 1 for borrowers MPS12
and savers MPS11 are given by

                                                    1
                                MPS11 =                             <1            and         MPS12 = 1.
                                                    u00 (C11 )
                                              1+   β 1 u00 (C21 )


Applying the general formula from Proposition 4, which follows from equation (10), we get

                                                                     1 − τ1,2 MPS12
                                                 1 − τ0B =                          ,
                                                                     1 − τ1,2 MPS11

where τ1,2 is the wedge of the consumption good at date 1 vis a vis the consumption good at date
2. This wedge τ1,2 can in turn be computed as a function of the multiplier on the zero lower bound
constraint ν and to the labor wedges by using the system of equations (11) and (12)23

                                                                 u00 (C21 )               00 1
                                                           ν                       ν u (C1 )
                                                        λ11 φ1   u0 (C21 )
                                                                              + λ1 φ1 u0 (C11 )
                                                                                  1
                                              τ1,2 =                             00 1
                                                                                                  ,
                                                                           ν u (C2 )
                                                                    1+   λ11 φ1 u0 (C21 )


                                            ν u00 (C11 )         1 − τ11 ∑2i=1 λ1i φi
                                                           = τ̄1                      .
                                          λ11 φ1 u0 (C11 )       1 − τ̄1 λ11 φ1
In these expressions second derivatives of the utility functions appear because they determine
Slutsky compensated elasticities. Taken together, these equations can then be manipulated to
yield exactly as above

                                                ν u00 (C11 )         1 − τ11 ∑2i=1 λ1i φi
                                      τ0B =                    = τ̄1                      .
                                              λ11 φ1 u0 (C11 )       1 − τ̄1 λ11 φ1
  23 It
      is also possible to derive these formulas by directly using the first order conditions of planning problem (30).
For example, the intermediate steps to compute τ1,2 are as follows. By definition we have 1 − τ1,2 = µ12 1+1 i or
                                                                                                             µ
                                                                                                                                      1
                           µ1
equivalently 1 − τ1,2 =    µ2   since i1 = 0, where µt is the multiplier on the resource constraint (24) at date t in the
planning problem (30). The first order conditions for C11 and C12 are λ11 u0 (C11 ) −                 ν 00   1
                                                                                                      φ1 u (C1 )   = µ1 and λ12 u0 (C21 ) +
β 1 ν 00 1
φ1 u (C2 )   = µ2 . The result follows.

                                                                      28
   It is apparent from these formulas that the key determinants of the (implicit) macroprudential
tax on borrowing are the differences in marginal propensities to spend MPS12 and MPS11 and the
depth of the recession as measured by τ1,2 and commensurate with τ̄1 .
   We now present a number of extensions of the basic model. All these extensions can be
mapped exactly in the general models developed in Sections 3 and 4. In the interest of space,
we do not lay down the details of these mappings.


Incorporating uncertainty. We now extend this example to allow for uncertainty. Uncertainty
is modeled by a shock ω realized at date 1. The realization can be good ω = ωG or bad ω = ω B
with ex-ante probabilities π (ωG ) and π (ω B ). There are complete markets in period 0 so that
borrowers and savers can trade state-contingent Arrow-Debreu securities which pay one unit of
the numeraire in period 1 if ω = ωG and zero otherwise, or one unit of the numeraire in period 1
if ω = ω B and zero otherwise.
    The realization of ω determines the borrowing constraint B̄2 (ω ), with B̄2 (ωG ) > B̄2 (ω B ). We
consider the case where under the optimal policy, the period-1 borrowing constraint and the zero
lower bound constraint between periods 1 and 2 are both slack if ω = ωG , but are both binding if
ω = ω B . Loosely speaking, this example features a credit boom in period 0, and a credit crunch
associated with deleveraging in period 1 in state ω B .24
    The analysis is similar to that of the deterministic model. When ω = ωG , the economy is
perfectly stabilized with τ̄1 (ωG ) = τ̄2 (ωG ) = 0. When ω = ω B instead, the economy experiences
a liquidity trap and a recession with τ̄1 (ω B ) > 0 and τ̄2 (ω B ) < 0 exactly as above. In period 0, we
still have τ̄0 = 0.
                                                                             Bω
    Optimal macroprudential policy imposes no macroprudential tax τ0 G = 0 on state-contingent
                                                                                 Bω
borrowing against state ωG , but a positive macroprudential tax τ0 B > 0 on state-contingent bor-
rowing against state ω B by agents of type 2, given by the same formulas as above (in particular,
             Bω                1− τ 1 ( ω )
we have τ0 B = τ̄1 (ω B ) 1−τ̄1 (ω B) (λ11 φ1 + λ21 φ2 )/λ11 φ1 ). The objective of macroprudential policy
                                 1   B
is to restrict borrowing by type-2 agents against the bad state of the world ω B with a liquidity
trap and a recession, not to restrict borrowing against the good state of the world ωG with no
recession. In this sense, the problem can be seen as one of under-insurance, rather than over-
borrowing. Note however, that non-contingent borrowing must carry a positive tax, since it em-
beds a component of borrowing against the bad state of the world ω B . Indeed the correspond-
                                                                                          Bω
ing tax on non-contingent borrowing in period 0 is τ0B = QωB /( QωG + QωB )τ0 B > 0, where
Qωi = π (ωi ) β 1 u0 (C11 (ωi ))/u0 (C11 (ωi )) is the price of the Arrow-Debreu security that pays one in
period 1 if ω = ωi , for i ∈ { G, B}. As is natural, this tax is commensurate with the probability
  24 It is also possible to allow for differences in beliefs in period 0 by endowing agents with different subjective

probabilities. We adopt a practical solution to resolve the associated conceptual normative difficulties by evaluating
the welfare of each agent under his subjective probabilities. For example, imagine that agents of type i have subjective
probabilitiesπ i (ω j ) with π 2 (ωG ) > π 1 (ωG ) so that agents of type 2 (borrowers) are more optimistic than agents of
type 1 (savers). Such differences in beliefs generate additional borrowing in period 0, thereby contributing to the
credit boom in period 0. The analysis is identical.


                                                           29
π (ω B ) of the bad state.


Pecuniary externalities from housing prices. We now extend this example to allow for bor-
rowing constraints that depend on housing prices, capturing their collateral value in mortgage
lending.
    To simplify, we assume two types of houses. Agents of type i ∈ {1, 2} consume housing
services of type i. There is a mass φi of houses of type i. Each house generates one unit of housing
services. Housing services Hti enter the utility function of agents of type i separably with per-
period utility h( Hti ). The prices for housing services (rents) are perfectly flexible. We denote by q1i
the price of one unit of period-2 housing services of type i in terms of the period-1 numeraire. We
refer to q1i as the price of houses of type i in period 1. We assume that the borrowing constraint
of agents of type 2 (borrowers) in period 1 is such that they can borrow κq21 in units of the period-
1 consumption good per unit of period-2 housing services that they purchase. The idea is that
housing services must be purchased one period in advance, subject to a borrowing constraint
which can only potentially bind in period 1. This type of borrowing constraint is common in
the literature (see e.g. Kiyotaki and Moore, 1997). As above, we focus on situations where the
borrowing constraint and the zero lower bound bind only in period 1.
    In equilibrium, an agent of type i consumes exactly one unit of housing services of type i
in each period, and the price of houses of type i in period 1 is given by q1i = β i h0 (1)/u0 (C1i ),
an increasing function of C1i which we denote, with a slight abuse of notation, by q1i (C1i ). The
planning problem is then identical to the planning problem (30) with B̄2 replaced by κq21 (C12 ).
Optimal macroprudential policy is now characterized by

                                          ν    u00 (C11 )           γκ q210 (C12 )
                                      λ11 φ1   u0 (C11 )           λ21 φ2 u0 (C12 )
                             τ0B =                           +                            > 0,
                                           γκ q210 (C12 )               γκ q210 (C12 )
                                     1+   λ21 φ2 u0 (C12 )
                                                                  1+   λ21 φ2 u0 (C12 )


where γ > 0 denotes the multiplier on the borrowing constraint and q210 (C12 ) is the derivative of
the price of houses of type 2 with respect to the consumption of agents of type 2 in period 1. The
macroprudential tax on period-0 borrowing by agents of type 2 now corrects for two externalities:
an aggregate demand externality as before (the first term) and a new pecuniary externality (the
second term).
    When borrowers increase their borrowing it lowers their wealth in period 1. This, in turn,
reduces aggregate demand because they have a high marginal propensity to spend in period 1.
Lower consumption reduces housing prices in period 1, further tightening the borrowing con-
straint. This, in turn, further reduces aggregate demand and consumption in period 1, leading to
further reductions in housing prices in period 1. This negative feedback loop has the potential to
greatly amplify the negative effects of the deleveraging shock. None of these adverse macroeco-
nomic consequences are internalized by borrowers, creating the need for government interven-


                                                             30
tion.


5.2     Capital Controls with Fixed Exchange Rates
In Section 5.1, the constraint on monetary policy was a liquidity trap. In this section, we focus on
another constraint on macroeconomic stabilization in environments with nominal rigidities. We
consider a two period model of a small open economy with a fixed exchange rate. The domestic
economy loses all monetary autonomy: the domestic nominal interest rate must be equal to the
foreign interest rate. We show that this creates a role for capital controls to regain monetary
autonomy. We refer the reader to Farhi and Werning (2012a) for a full-fledged analysis of capital
controls with fixed exchange rates.


Households. There are two periods t ∈ {0, 1}. We take the foreign-currency price PT,t           ∗ of the

traded good as given. The domestic-currency price of traded goods is then PT,t = EPT,t           ∗ . For

simplicity, we assume that foreign agents have linear preferences over traded goods and denote
      ∗
by ( PT,t      ∗             ∗                               ∗
          +1 /PT,t ) / (1 + it ) their discount rate, where it is the foreign nominal interest rate. The
domestic nominal interest rate can be backed out from the uncovered interest parity condition
(1 + it ) = (1 + it∗ )(1 + τtB ) in which capital controls τtB (a tax on capital inflows / subsidy on
capital outflows) appear as a wedge.
   There is a representative domestic agent with preferences over non-traded goods, traded goods
and labor given by the expected utility

                                          1
                                         ∑ βt U (CNT,t , CT,t , Nt ).
                                        t =0

Below we make some further assumptions on preferences.
   Households are subject to the following budget constraints

                      ∗                          ∗                                  1
        PNT CNT,t + EPT,t CT,t + EBt ≤ Wt Nt + EPT,t YT,t + Πt − Tt +                          EBt+1 ,   (31)
                                                                          (1 + it∗ )(1 + τtB )

where we impose B2 = 0. Here PNT is the price of non-traded goods which as we will see shortly,
does not depend on t due to the assumed price stickiness; E is the nominal exchange rate, PT,t  ∗ is

the foreign-currency price of the traded good, EPT,t∗ is the domestic-currency price of traded goods

in period t; Wt is the nominal wage in period t; YT,t is the endowment of traded goods in period
t; Πt represents aggregate profits in period t; Tt is a lump-sum tax (that balances the government
budget); Bt is short-term debt in the foreign currency.
    The households’ first order conditions can be written as
                                                       ∗
                                                      PT,t
                                            1              +1   βUCT ,t+1
                                                         ∗    =           ,                              (32)
                                  (1 + it∗ )(1 + τtB ) PT,t      UCT ,t


                                                     31
                                             UCT ,t   UCNT ,t
                                               ∗    =         ,                                     (33)
                                             EPT,t     PNT
and
                                             Wt    −UN,t
                                                 =         .                                        (34)
                                             PNT   UCNT ,t

Firms. The traded goods are traded competitively in international markets. The domestic agents
have an endowment YT,t of these traded goods. Non-traded goods are produced in each country
by competitive firms that combine a continuum of non-traded varieties indexed by j ∈ [0, 1] using
the constant returns to scale CES technology

                                              ˆ    1
                                                                                 !    1
                                                                                     1− 1e
                                                                    1− 1e
                                   YNT,t =             YNT,t ( j)           dj               ,
                                               0


with elasticity e > 1. Each variety is produced by a monopolist using a linear technology

                                          YNT,t ( j) = At Nt ( j).

Each monopolist hires labor in a competitive market with wage Wt , but pays Wt (1 + τL ) net of
a tax on labor. Monopolists must set prices once and for all in period 0 and cannot change
them afterwards. The demand for each variety is given by CNT,t ( PNT ( j)/PNT )−e where PNT =
 ´
( ( PNT ( j))1−e dj)1/(1−e) is the price of non traded goods. We assume that each firm j is owned by
a household who sets the price PNT ( j) in addition to making its consumption and labor supply
decisions. The corresponding price setting conditions are symmetric across j and given by

                                                1     t −1      1        Wt
                                            e ∑t=0 ∏s=0 (1+is∗ )(1+τsB ) At CNT,t
                        PNT   = (1 + τL )                                         .                 (35)
                                          e − 1 ∑1t=0 ∏ts−
                                                         =0
                                                           1
                                                                ∗
                                                                  1
                                                                       B C NT,t
                                                                       (1+is )(1+τs )

                                                        Wt
                                    Πt = [ PNT −           (1 + τL )]CNT,t .                        (36)
                                                        At

Government. The government sets the tax on labor τL , capital controls τtB , and in addition, it
levies lump-sum taxes Tt in period t to balance its budget

                                                         τtB    1
                                Tt + τL Wt Nt +                       Et Bt = 0.                    (37)
                                                       1 + τt 1 + it∗
                                                             B



Equilibrium. An equilibrium takes as given the price of traded goods { PT,t        ∗ }, the foreign nomi-

nal interest rate {it∗ } and the exchange rate E. It specifies consumption of traded and non-traded
goods {CT,t , CNT,t }, labor supply { Nt }, debt { Bt }, the price of non-traded goods PNT , wages {Wt },
the labor taxes τL , capital controls {τtB } such that households and firms maximize, the govern-


                                                         32
ment’s budget constraint is satisfied, and markets clear:

                                                CNT,t = At Nt .                                         (38)

These conditions imply that the market for traded goods clears.
    The conditions for an equilibrium (31)–(38) act as constraints on the planning problem we
study next. However, we can drop variables and constraints. Given quantities, equations (32),
(34) and (35) can be used to back out certain prices, wages and taxes. Since these variables do not
affect welfare they can be dispensed with from our planning problem, along with all the equations
except the condition that determines agents’ relative consumption of traded and non traded goods
(33), the market clearing condition (38), and the country budget constraint for traded goods

                              ∗                        1
                             PT,0 [CT,0 − YT,0 ] +          P∗ [CT,1 − YT,1 ] ≤ 0                       (39)
                                                     1 + i0∗ T,1

Proposition 9 (Implementability). An allocation {CT,t , CNT,t } and { Nt } together with prices for non-
traded goods { PNT } and capital controls {τtB }, forms part of an equilibrium if and only if equations (33),
(38) and (39) hold.


Homothetic Preferences. Next, we characterize the key condition (33) further by making some
weak assumptions on preferences. We make two assumptions on preferences: (i) preferences
over consumption goods are weakly separable from labor; and (ii) preferences over consumption
goods are homothetic. These assumptions imply that

                                                          PT,t
                                           CNT,t = α(          )CT,t ,
                                                         PNT,t

for some function α that is increasing and differentiable. This conveniently encapsulates the re-
striction implied by the first order condition (33).
    Define the indirect utility function, which encodes utility in period t when the consumption of
traded goods is CT,t and the relative price of traded vs. non-traded goods is pt = PT,t /PNT,t as

                                                                         α( pt )
                              V (CT,t , pt ) = U (α( pt )CT,t , CT,t ,           CT,t ).
                                                                          At

The derivatives of the indirect utility function will prove useful for our analysis. To describe these
derivatives, it is useful to first introduce the labor wedge

                                                         1 UN,t
                                             τt = 1 +               .
                                                         At UCNT ,t




                                                       33
Proposition 10. The derivatives of the value function are

                                                      α p,t
                                    Vp (CT,t , pt ) =       CT,t UCT ,t τt ,
                                                       pt
                                                                   αt
                                   VCT (CT,t , pt ) = UCT ,t (1 + τt ).
                                                                   pt

    These observations about the derivatives and their connection to the labor wedge are bor-
rowed from Farhi and Werning (2012b) and will be key to our results. A private agent values
traded goods according to its marginal utility UCT ,t , but the actual marginal value in equilibrium
is VCT ,t . The wedge between the two equals (αt /pt )τt = (( PNT CNT,t )/( PT,t CT,t ))τt , the labor
wedge weighted by the relative expenditure share of non-traded goods relative to traded goods.
We will sometimes refer to it as the weighted labor wedge for short.
    In particular, a private agent undervalues traded goods VCT ,t > UCT ,t whenever the economy
is experiencing a recession, in the sense of having a positive labor wedge τt > 0. Conversely,
private agents overvalue traded goods VCT ,t < UCT ,t whenever the economy is booming, in the
sense of having a negative labor wedge τt < 0. These effects are magnified when the economy is
relatively closed, so that the relative expenditure share of non-traded goods is large.


Optimal macroprudential capital controls. We now solve the Ramsey problem of choosing the
competitive equilibrium that maximizes the utility of domestic agents. We have the following
planning problem
                                         1              ∗
                                                     EPT,t
                                  max ∑ β V (CT,t ,
                                            t
                                                           )                             (40)
                                       t =0           PNT
subject to
                            ∗                         1
                           PT,0 [CT,0 − YT,0 ] +           P∗ [CT,1 − YT,1 ] ≤ 0.
                                                    1 + i0∗ T,1
   We have                                    ∗                 ∗
                                            EPT,0             EPT,1
                                     Vp,0           + βVp,1           = 0,
                                            PNT               PNT
which can be rewritten using Proposition 10 as

                              α p,0 CT,0 UCT ,0 τ0 + βα p,1 CT,1 UCT ,1 τ1 = 0,

where τt is the labor wedge in period t. Taken together, these equations imply that τ0 and τ1
are of opposite signs, so that if the economy is experiencing a recession in period 0, then it is
experiencing a boom in period 1 and vice versa.
   We can also derive a condition that characterizes the optimal capital controls. Indeed, we have

                                                      P∗
                                         β(1 + i0∗ ) PT,0
                                                      ∗ VCT ,1
                                                       T,1
                                                                 = 1,
                                                  VCT ,0

                                                      34
or equivalently
                                              P∗
                                    β(1 + i0∗ ) PT,0
                                                 ∗ UCT ,1 (1 +
                                                                    α1
                                                                    p1 τ1 )
                                               T,1
                                                          α0                  = 1,
                                           UCT ,0 (1 +    p0 τ0 )

implying that capital controls should be given by
                                                                α1
                                                          1+    p1 τ1
                                            1 + τ0B   =         α0    .
                                                          1+    p0 τ0


Suppose for example that the economy is in a boom in period 0 (τ0 < 0) and a recession in pe-
riod 1 (τ1 > 0). Then the optimal tax on capital inflows / subsidy on capital outflows is positive
τ0B > 0. Doing so reduces spending on non-traded goods by domestic agents in period 0, when
the economy is in a boom, and increases it in period 1, when the economy is in a recession. These
stabilization benefits are not internalized by private agents—hence the need for government in-
tervention.

Proposition 11. Consider the planning problem (40). Then at the optimum, the labor wedges are such that
τ0 and τ1 are of opposite signs. The optimal tax on capital inflows / subsidy on capital outflows is given by
                                                                α1
                                                          1+    p1 τ1
                                            1 + τ0B   =         α0    .
                                                          1+    p0 τ0


Mapping to the general model. The planning problem (40) can be seen as a particular case of
the one studied in Section 3. Proposition 11 can then be seen as an application of Proposition 2.
    The mapping is as follows. There are two states. The first state corresponds to period 0, and
the second state to period 1. In the first state, the commodities are the different varieties of the
non-traded good, the traded good and labor in period 0. In the second state, the commodities are
the different varieties of the non-traded good, the traded good and labor in period 1.
    We use the foreign numeraire. The constraint on prices the requirement that price of the traded
good be given by PT,t∗ in every period in the foreign numeraire, and the requirement that the price

of each variety of non-traded good is constant at PNT   ∗  = EPNT in the foreign numeraire. The
                             ∗                                     ∗
international interest rate it simply indexes the discount rate ( PT,t      ∗             ∗
                                                                       +1 /PT,t ) / (1 + it ) of risk neutral
foreigners who have linear preferences over the traded good.


5.3   Capital Controls with Flexible Exchange Rates and Collateral Constraints
In Section 5.2, we considered a small open economy with nominal rigidities and constraints on
monetary policy, a fixed exchange rate. In this section, we use a similar model, but focus on the
interaction of collateral constraints and nominal rigidities with a flexible exchange rate. Because
prices appear in the collateral constraint, the environment is hybrid, comprising both aggregate


                                                      35
demand and pecuniary externalities. This creates a role for ex-ante macroprudential capital con-
trols in the form of taxes on capital inflows. Collateral constraints and capital controls have been
modeled in the literature on “sudden stop” episodes (see e.g. Jeanne and Korinek, 2010; Bianchi,
2011; Korinek, 2011), but this literature focuses on pecuniary externalities and abstracts from nom-
inal rigidities and monetary policy.


Households. There are three periods t ∈ {0, 1, 2}. There is a representative domestic agent with
preferences over non-traded goods, traded goods and labor given by the expected utility

                                          2
                                          ∑ βt U (CNT,t , CT,t , Nt ).
                                         t =0

Below we make some further assumptions on preferences.
      We take the foreign-currency price PT,t   ∗ of the traded good as given. To capture a small open

economy, assume that foreign agents have linear preferences over traded goods and denote by
     ∗
( PT,t       ∗            ∗                               ∗
       +1 /PT,t ) / (1 + it ) their discount rate, where it is the foreign nominal interest rate. The do-
mestic nominal interest rate is given by the uncovered interest parity condition 1 + it = (1 +
it∗ )(1 + τtB ) in which capital controls τtB (a tax on capital inflows / subsidy on capital outflows)
appear as a wedge. Households are subject to the following budget constraints

                  ∗
  PNT CNT,t + Et PT,t CT,t + (1 + it∗−1 )(1 + τtB−1 ) Et Bt ≤ Wt Nt + Et PT,t
                                                                          ∗
                                                                              YT,t + Πt − Tt + Et Bt+1 ,   (41)

where we have imposed B3 = 0. Here PNT is the price of non-traded goods which does not
depend on t due to the assumed price stickiness; Et is the nominal exchange rate, PT,t     ∗ is the

foreign-currency price of the traded good, Et PT,t∗ is the domestic-currency price of traded goods

in period t; Wt is the nominal wage in period t; YT,t is the endowment of traded goods in period
t; Πt represents aggregate profits in period t; Tt is a lump-sum tax (that balances the government
budget); Bt is short-term debt in the foreign currency.
    We assume that households face a collateral constraint of the form

                                     Et Bt+1 ≤ κ NT,t PNT,t + κ T,t PT,t .                                 (42)

This type of ad-hoc borrowing constraint is common in the literature (see e.g. Bianchi, 2011).
   The households’ first order conditions are

                                                UCT ,t    UCNT ,t
                                                    ∗   =         ,                                        (43)
                                                Et PT,t    PNT

                                                Wt    −UN,t
                                                    =         ,                                            (44)
                                                PNT   UCNT ,t



                                                       36
                                                     ∗
                                                    PT,t
                                           1             +1   βUCT ,t+1
                                        ∗         B    ∗    ≥           ,                         (45)
                                  (1 + it )(1 + τt ) PT,t      UCT ,t
with equality if the borrowing constraint is slack at t.


Firms. Firms are modeled exactly as in Section 5.2. The traded goods are bought and sold on
competitive international markets. The domestic agents have an endowment YT,t of traded goods.
Non-traded goods are produced in each country by competitive firms that combine a continuum
of non-traded varieties indexed by using a constant returns to scale CES technology with elasticity
of substitution e. Each variety is produced from labor by a domestically-owned monopolist using
a linear technology with productivity At .
    Each monopolist hires labor in a competitive market with wage Wt , but pays Wt (1 + τL ) net
of a tax on labor. Monopolists set prices once and for all in period 0 and cannot change them
afterwards. The associated price setting conditions are symmetric across firms and given by

                                                1     t −1      1        Wt
                                            e ∑t=0 ∏s=0 (1+is∗ )(1+τsB ) At CNT,t
                        PNT   = (1 + τL )                                         .               (46)
                                          e − 1 ∑1t=0 ∏ts− 1
                                                                ∗
                                                                  1
                                                         =0 (1+i )(1+τ )
                                                                       B  C NT,t
                                                                   s     s


Profits are                                                   
                                                   Wt
                                  Πt =       PNT −    (1 + τL ) CNT,t .                           (47)
                                                   At

Government. The government sets the tax on labor τL , capital controls τtB , and in addition, it
levies lump-sum taxes Tt in period t to balance its budget

                                Tt + τL Wt Nt + τtB−1 (1 + it∗−1 ) Et Bt = 0.                     (48)


Equilibrium. An equilibrium takes as given the price of traded goods { PT,t     ∗ } and the foreign

nominal interest rate {it∗ }. It specifies consumption of traded and non-traded goods {CT,t , CNT,t },
labor supply { Nt }, debt { Bt }, the price of non-traded goods PNT , wages {Wt }, the labor taxes
τL , capital controls {τtB } such that households and firms maximize, the government’s budget
constraint is satisfied, and markets clear:

                                               CNT,t = At Nt .                                    (49)

These conditions imply that the market for traded goods clears.
    The conditions for an equilibrium (41)–(49) act as constraints on the planning problem we
study next. However, we can drop variables and constraints. Given quantities, equations (45),
(44) and (46) can be used to back out certain prices, wages and taxes. Since these variables do not
affect welfare they can be dispensed with from our planning problem, along with all the equations
except the condition that determines agents’ relative consumption of traded and non traded goods

                                                     37
(43), the market clearing condition (49), the country budget constraint for traded goods
                                                                               ∗
                                                                             PT,t
                                                                         ∗
                                 CT,t − YT,t ≤ B̂t+1 −         B̂t (1 + it ) ∗     ,                    (50)
                                                                            PT,t+1

and the borrowing constraint
                                                            PNT,t
                                        B̂t+1 ≤ κ NT,t          ∗ + κ T,t ,                             (51)
                                                            Et PT,t

where we have defined normalized debt B̂t as debt expressed in units of the international price of
                           ∗ .
the traded good B̂t = Bt /PT,t

Proposition 12 (Implementability). An allocation {CT,t , CNT,t } and { Nt } together with prices for non-
traded goods { PNT } and capital controls {τtB }, forms part of an equilibrium if and only if equations (43),
(49), (50) and (51) hold.

   As in Section 5.2, we assume that preferences over consumption goods are weakly separable
from labor; and that preferences over consumption goods are homothetic.

Optimal macroprudential capital controls. We now solve the Ramsey problem of choosing the
competitive equilibrium that maximizes the utility of domestic agents. We have the following
planning problem
                                        2                ∗
                                                     Et PT,t
                                  max ∑ βt V (CT,t ,         )                           (52)
                                      t =0            PNT
subject to
                                                                               ∗
                                                                             PT,t
                                                                         ∗
                                 CT,t − YT,t ≤ B̂t+1 −         B̂t (1 + it ) ∗     ,
                                                                            PT,t+1
                                                            PNT,t
                                        B̂t+1 ≤ κ NT,t          ∗ + κ T,t .
                                                            Et PT,t
   We have                                      ∗
                                            Et PT,t                 PNT,t
                                     Vp,t             − νt κ NT,t       ∗ = 0,
                                             PNT                    Et PT,t
where νt is the multiplier on the collateral constraint at t, which can be rewritten using Proposition
10 as
                                                                      1
                                      α p,t CT,t UCT ,t τt = νt κ NT,t ,
                                                                      pt
where τt is the labor wedge in period t. This equation characterizes optimal monetary policy in
a target form. It implies that τt = 0 if the borrowing constraint is slack at t, and that τt > 0 if
the collateral constraint is binding at t. When the borrowing constraint is slack, optimal monetary
policy perfectly stabilizes the economy. But when the collateral constraint is binding, monetary
policy faces a meaningful tradeoff between two objectives: macroeconomic stabilization (mini-
mizing labor wedges) and financial stabilization (smoothing consumption). A more depreciated

                                                          38
exchange rate Et improves the first objective as it stimulates demand, but worsens the second as
it tightens the collateral constraint. Optimal monetary policy is therefore a compromise resulting
in a recession and a binding collateral constraint.
     We can also derive a condition that characterizes the optimal capital controls. Indeed, we have
that then                                         ∗
                                           1     PT,t +1  VC ,t+1
                                              ∗     ∗    ≥ T      ,
                                       β(1 + it ) PT,t     VCT ,t
or equivalently
                                            ∗                          α
                                    1      PT,t +1
                                                     UCT ,t+1 (1 + ptt++11 τt+1 )
                                                   ≥                              ,
                                β(1 + it∗ ) PT,t
                                              ∗        UCT ,t (1 + αptt τt )

with equality if the borrowing constraint is not binding at t, implying that capital controls should
be given by
                                                     α
                                                 1 + ptt++11 τt+1
                                            B
                                     1 + τt =                     .
                                                   1 + αptt τt

Suppose for example that the borrowing constraint is slack in period 0 but binding in period
1. Then optimal monetary policy stabilizes the economy in period 0 (τ0 = 0) but engineers a
recession in period 1 (τ1 > 0). Then the optimal tax on capital inflows / subsidy on capital
outflows is positive τ0B > 0. Doing so increases spending on non-traded goods by domestic agents
in period 1 when the economy is in a recession. These stabilization benefits are not internalized
by private agents—hence the need for government intervention.

Proposition 13. Consider the planning problem (52). The optimal tax on capital inflows / subsidy on
capital outflows is given by
                                                   α
                                               1 + ptt++11 τt+1
                                           B
                                     1 + τt =                   ,
                                                 1 + αptt τt

where τt > 0 if and only if the collateral constraint is binding at t.


Mapping to the general model. The planning problem (52) can be seen as a particular case of
the one studied in Section 4. Proposition 11 can then be seen as an application of Proposition 6.
    The mapping is as follows. There are three states. The first state corresponds to period 0,
the second state to period 1, and the third state to period 2. In each state, the commodities are the
different varieties of the non-traded good, the traded good and labor in the corresponding period.
    We use the foreign numeraire. The constraint on prices the requirement that price of the traded
good be given by PT,t∗ in every period in the foreign numeraire. The international interest rate i ∗
                                                                                                        t
                                     ∗
simply indexes the discount rate ( PT,t    /P ∗ ) / (1 + i ∗ ) of risk neutral foreigners who have linear
                                        +1   T,t           t
preferences over the traded good. The fact that the price of each variety of non-traded good is
constant at PNT in the domestic numeraire or PNT,t   ∗      = PNT /Et in the foreign numeraire simply
defines the exchange rate Et .


                                                       39
  There is a complete set of Arrow-Debreu securities. The portfolio constraints are the require-
                         ∗
ment that Bt+1 ≤ κ NT,t PNT,t          ∗ . These constraints depend on prices.
                              + κ T,t PT,t


5.4   Capital Controls with Flexible Exchange Rates and Local and Foreign-
      Currency Debt
In Section 5.3, we considered a hybrid model of a small open economy with flexible exchange
rates and collateral constraints that depend on prices, featuring both aggregate demand and pe-
cuniary externalities. In this section, we analyze another hybrid environment, where pecuniary
externalities arise from incomplete markets, instead of collateral constraints. We consider a small
open economy model with two periods subject to uncertainty. Markets are incomplete: only local-
and foreign-currency debt can be traded. This creates a for role macroprudential capital controls.
Interestingly, optimal policy calls for different taxes on local- and foreign-currency debt. Under
natural conditions, taxes on foreign currency debt are higher than on local-currency debt, con-
sistent with a standard view that international credit booms fueled by foreign-currency debt are
particularly problematic.


Households. There are two periods t ∈ {0, 1}. States of the world s1 ∈ S1 occur with probability
π (s1 ). We leave the dependence of variables on s1 implicit whenever possible. Expectations at
date 0 are denoted by E0 .
    We take the foreign-currency price PT,t       ∗ of the traded good as given. For simplicity, we as-

sume that foreign agents are risk neutral with linear preferences over traded goods and denote by
   ∗
( PT,t      ∗             ∗                               ∗
       +1 /PT,t ) / (1 + it ) their discount rate, where it is the foreign nominal interest rate.
    There is a representative domestic agent with preferences

                                             1
                                       E0   ∑ βt U (CNT,t , CT,t , Nt ).
                                            t =0

Below we make some further assumptions on preferences.
   Households are subject to the following budget constraints

                  ∗
  PNT CNT,t + Et PT,t CT,t + Et BtF + BtH
                                     ∗                                     1                        1
                       ≤ Wt Nt + Et PT,t YT,t + Πt − Tt +                            Et BtF+1 +          BtH+1 , (53)
                                                                               BF
                                                               (1 + it∗ )(1 + τt )                1 + it

where we impose B2F = B2H = 0. Here PNT is the price of non-traded goods which as we will
see shortly, does not depend on t due to the assumed price stickiness; E is the nominal exchange
       ∗ is the foreign-currency price of the traded good, EP∗ is the domestic-currency price of
rate, PT,t                                                   T,t
traded goods in period t; Wt is the nominal wage in period t; YT,t is the endowment of traded


                                                      40
goods in period t; Πt represents aggregate profits in period t; Tt is a lump-sum tax (that balances
the government budget); BtF is short-term debt in the foreign currency; BtH is short-term debt in
                                                                                                       F
the local currency; it∗ is the foreign nominal interest rate; it is the domestic interest rate; and τtB is
the capital control tax on foreign-currency debt.
                                                  H
   We also introduce a capital control tax τtB on local-currency debt. The uncovered interest
parity equation which must hold despite the presence of risk because the rest of the world is risk
neutral, but with a wedge introduced by capital controls

                                                    Et              H
                                  (1 + i t )Et [        ] = (1 + τtB )(1 + it∗ ).                    (54)
                                                   Et+1

   The households’ first order conditions are
                                                                     ∗
                                  "                                      #
                                    βUCT ,t+1                   F  P
                           1 = Et             (1 + it∗ )(1 + τtB ) ∗T,t ,                            (55)
                                     UCT ,t                       PT,t+1

                                                                           ∗
                                          "                                     #
                                              βUCT ,t+1             Et PT,t
                                 1 = Et                 (1 + i t )       ∗        ,                  (56)
                                               UCT ,t              Et+1 PT,t +1

                                                   UCT ,t    UCNT ,t
                                                       ∗   =         ,                               (57)
                                                   Et PT,t    PNT
                                                   Wt    −UN,t
                                                       =         .                                   (58)
                                                   PNT   UCNT ,t

Firms. Firms are modeled exactly as in Section 5.2. The traded goods are traded competitively
in international markets. The domestic agents have an endowment YT,t of these traded goods.
Non-traded goods are produced in each country by competitive firms that combine a continuum
of non-traded varieties indexed by using a constant returns to scale CES technology with elasticity
of substitution e. Each variety is produced from labor by a domestically-owned monopolist using
a linear technology with productivity At .
    Each monopolist hires labor in a competitive market with wage Wt , but pays Wt (1 + τL ) net of
a tax on labor. Monopolists must set prices once and for all in period 0 and cannot change them
afterwards. The associated price setting conditions are symmetric across firms and given by

                                                 1     t −1      1        Wt
                                             e ∑t=0 ∏s=0 (1+is∗ )(1+τsB ) At CNT,t
                         PNT   = (1 + τL )                                         .                 (59)
                                           e − 1 ∑1t=0 ∏ts−
                                                          =0
                                                            1
                                                                 ∗
                                                                   1
                                                                        B C NT,t
                                                                     (1+is )(1+τs )

Profits are then given by
                                      Πt = [ PNT − Wt (1 + τL )]CNT,t .                              (60)




                                                          41
Government. The government sets the tax on labor τL , capital controls on foreign-currency debt
   F                           H
τtB and local-currency debt τtB , and in addition, it levies lump-sum taxes Tt in period t to balance
its budget
                                                 F                       H
                                           τtB   1        F     τtB     1
                       Tt + τL Wt Nt +         F   ∗ Et Bt  +         H
                                                                            BtF = 0.                    (61)
                                       1 + τt 1 + it
                                             B                1 + τt 1 + it
                                                                    B



Equilibrium. An equilibrium takes as given the price of traded goods { PT,t         ∗ } and the foreign

nominal interest rate {it∗ }. It specifies consumption of traded and non-traded goods {CT,t , CNT,t },
labor supply { Nt }, local and foreign-currency debt { BtH , BtF }, the price of non-traded goods PNT ,
                                                       F     H
wages {Wt }, the labor taxes τL , capital controls {τtB , τtB } such that households and firms maxi-
mize, the government’s budget constraint is satisfied, and markets clear:

                                                     CNT,t = At Nt .                                    (62)

These conditions imply that the market for traded goods clears.
   The conditions for an equilibrium (53)–(62) act as constraints on the planning problem we
study next. However, exactly as in Section 5.1 we can drop variables and constraints. Given
quantities, equations (54), (55), (56), (58) and (59) can be used to back out certain prices, wages
and taxes. Since these variables do not affect welfare they can be dispensed with from our plan-
ning problem, along with all the equations except the condition that determines agents’ relative
consumption of traded and non traded goods (57), the market clearing condition (62), and the
country budget constraint for traded goods

                              1        1             1      F 1       1            1 B1H
              CT,0 +   B0F         H
                              ∗ + B0 E P∗ ≤ YT,0 + 1 + i ∗ B1 P∗ + (1 + i ∗ ) E0 [ E ] P∗ ,             (63)
                             PT,0     0 T,0             0      T,0       0          1   T,0

                                                      1            1
                                      CT,1 + B1F      ∗   + B1H      ∗ ≤ YT,1 .                         (64)
                                                     PT,1       E1 PT,1
Proposition 14 (Implementability). An allocation {CT,t , CNT,t } and { Nt } together with prices for non-
                                              F     H
traded goods { PNT } and capital controls {τtB , τtB }, forms part of an equilibrium if and only if equations
(57), (62), (63) and (64) hold.

   As in Sections 5.2 and 5.3, we assume that preferences over consumption goods are weakly
separable from labor; and that preferences over consumption goods are homothetic.

Optimal macroprudential capital controls. We now solve the Ramsey problem of choosing the
competitive equilibrium that maximizes the utility of domestic agents. We have the following
planning problem
                                        1               ∗
                                                    Et PT,t
                                  max ∑ β V (CT,t ,
                                           t
                                                            )                            (65)
                                      t =0            PNT

                                                           42
subject to

                             1        1             1      F 1       1            1 B1H
             CT,0 +   B0F         H
                             ∗ + B0 E P∗ ≤ YT,0 + 1 + i ∗ B1 P∗ + (1 + i ∗ ) E0 [ E ] P∗ ,
                            PT,0     0 T,0             0      T,0       0          1   T,0

                                                       1            1
                                       CT,1 + B1F      ∗   + B1H      ∗ ≤ YT,1 .
                                                      PT,1       E1 PT,1
   We have                                         ∗
                                               E0 PT,0                     1
                                        Vp,0             + VCT ,0 B0H        ∗ = 0,
                                                PNT                     E0 PT,0
                                 ∗
                             E1 PT,1                     1      VCT ,0 1 π (s1 ) B1H
                      Vp,1             + VCT ,1 B1H        ∗  −                   ∗ = 0,
                              PNT                     E1 PT,1    β 1 + i0∗ E1 PT,0
which can be rewritten using Proposition 10 as

                                                                             1
                                    α p,0 CT,0 UCT ,0 τ0 + VCT ,0 B0H          ∗ = 0,
                                                                          E0 PT,0

                                                            1      VCT ,0 1 π (s1 ) B1H
                   α p,1 CT,1 UCT ,1 τ1 + VCT ,1 B1H          ∗  −                   ∗ = 0.
                                                         E1 PT,1    β 1 + i0∗ E1 PT,0
where τt is the labor wedge in period t. These equations characterize optimal monetary policy in
a target form. Monetary policy has to navigate a tradeoff between macroeconomic stabilization
(targeting a value of zero for τt ) and risk sharing (the exchange rate affects the return of local-
currency debt). The first equation shows that τ0 < 0 if initial local-currency debt is positive
B0H > 0 and τ0 < 0 otherwise. Optimal monetary policy depreciates the exchange rate more than
would be warranted for macroeconomic stability, delivering a boom τ0 < 0, in order to lower
debt repayments to foreigners. The first two terms in the second equation are identical to the first
equation. The third term −VCT ,0 /( β(1 + i0∗ ))(π (s1 )/E1 )( B1H /PT,0
                                                                     ∗ ) arises because depreciating the

exchange rate in state s1 at date 1 is anticipated at date 0 and increases the interest rate on local-
currency debt at date 0, an effect which optimal monetary policy takes into account.
    We can also derive a condition that characterizes the optimal capital controls. Indeed, we have

                                                  βVCT ,1           P∗
                                           E0 [           (1 + i0∗ ) T,0
                                                                     ∗ ] = 1,
                                                  VCT ,0            PT,1

                                                                     1
                                            βVCT ,1          P∗
                                                          ∗ T,0     E1
                                       E0 [         (1 + i0 ) ∗             ] = 1,
                                            VCT ,0           PT,1 E0 [ E1 ]
                                                                         1




                                                              43
or equivalently using Proposition 10,25

                                                                                         P∗
                                                                       α1
                                                         βUCT ,1 1 +   p1 τ1         ∗ T,0
                                                    E0 [               α0    ( 1 + i 0 )  ∗ ]       = 1,
                                                         UCT ,0 1 +    p0 τ0             PT,1

                                                                                               1
                                                                                     P∗
                                                                   α1
                                              βUCT ,1 1 +          p1 τ1         ∗ T,0         p1
                                         E0 [                            ( 1 + i 0 )  ∗                     ] = 1.
                                                                                            E0 [ p11 ]
                                                                   α0
                                              UCT ,0 1 +           p0 τ0             PT,1

Proposition 15. Consider the planning problem (65). The optimal tax on capital inflows / subsidy on
capital outflows on foreign- and local-currency debt are given by
                                                                                                        α
                                                                                       βUCT ,1 1+ p11 τ1
                                                              1+   α1         cov0 [   UCT ,0 , 1+ α0 τ0 ]
                                                F                  p1 τ1                           p
                                  1 + τ0B = E0 [                   α0    ]+                         α
                                                                                                            0
                                                                                                                     ,
                                                              1+      τ0           βUC ,1      1+ p1 τ1
                                                                   p0          E0 [ UC T,0    α
                                                                                                1
                                                                                                    ]
                                                                                      T    1+ p0 τ0
                                                                                                0
                                                                                              1                           α
                                                                                    βUCT ,1 p1                      1+ p1 τ1
                                                                                                                              1
                                                              1+   α1         cov [
                                                                                  0 UC ,0 E [ 1 ]               ,         α           ]
                                                                   p1 τ1               T    0 p                     1+ p0 τ0
                                             BH
                                 1 + τ0              = E0 [        α0    ]+                 1
                                                                                                 1
                                                                                                                      α
                                                                                                                              0
                                                                                                                                          .
                                                              1+                                                1+ p1 τ1
                                                                   p0 τ0       E [
                                                                                   βUCT ,1 p1
                                                                                                            ,        1
                                                                                                                                  ]
                                                                                 0 UC ,0 E [ 1 ]                   α
                                                                                                                1+ p0 τ0
                                                                                      T    0 p
                                                                                               1                     0


    This shows that capital controls on local and foreign-currency debt should be different in gen-
eral. Indeed, the first (expectation) terms on the right-hand side of these formulas coincide, but
the second (covariance) terms differ. The expectation terms simply capture that international bor-
rowing in either local- or foreign-currency debt should be discouraged if the economy is more
depressed at date 1 than at date 0, i.e. if labor wedges τt are on average higher at date 1 than
at date 0. This reallocates spending from date 0 to date 1 and helps stabilize the economy. The
covariance terms capture the effects of borrowing in foreign- or local-currency debt across states
at date 1. There is a force pushing towards a higher capital control tax on foreign-currency debt
than on local-currency debt if the terms of trade tend to depreciate in states of the world s1 ∈ S1
that feature larger recessions, i.e. if 1/p1 co-moves negatively with τ1 —a natural configuration.


Mapping to the general model. The planning problem (65) can be seen as a particular case of
the one studied in Section 4. Proposition 15 can then be seen as an application of Proposition 6.
   The mapping is as follows. There are #S1 + 1 states. The first state corresponds to period 0, and
the remaining #S1 states correspond to the different states s1 ∈ S1 in period 1. In the first state,
the commodities are the different varieties of the non-traded good, the traded good and labor in
period 0. In each remaining state corresponding to s1 ∈ S1 , the commodities are the different
varieties of the non-traded good, the traded good and labor in state s1 in period 1.
                                1                1
 25 We                         E1               p1
         use the fact that               =               .
                             E0 [ E1 ]       E0 [ p1 ]
                                    1                1




                                                                          44
    We use the foreign numeraire. The constraint on prices are as follows. The price of the traded
                    ∗ in every period in the foreign numeraire. The international interest rate i ∗
good is given by PT,t                                                                                t
                                     ∗       ∗          ∗
simply indexes the discount rate ( PT,t+1 /PT,t )/(1 + it ) of risk neutral foreigners who have linear
preferences over consumption goods. The fact that the price of each variety of non-traded good
is constant at PNT in the domestic numeraire simply defines the exchange rate Et = PNT /PNT,t  ∗ .

    There are incomplete markets with only local and foreign-currency debt. The dependency of
their returns on prices is captured by the Za,s functions. There are neither portfolio constraints nor
borrowing constraints.


6     Conclusion
We developed a new general theoretical foundation for macroprudential policies. Our theory is
based on a key friction relative to the Arrow-Debreu model: nominal rigidities in goods and labor
markets, possibly interacted with constraints on monetary policy such as the zero lower bound
or fixed exchange rates. We have shown that in general, competitive equilibria are constrained
inefficient. The underlying market failures can be traced to aggregate demand externalities.
    Government intervention in financial markets in the form of financial taxes or quantity restric-
tions generate Pareto improvements, and optimal interventions are characterized by simple and
interpretable formulas expressed in terms of empirically measurable sufficient statistics.
    We also incorporated financial markets frictions to combine aggregate demand and pecuniary
externalities in a single framework. All our results carry over to this hybrid model. Finally, we
provided a various relevant applications.


A     Appendix

A.1    Proof of Proposition 2
We use
                                                     ∑ Pj,s XiI,j,s = 1,
                                                    j∈ Js

to get for any λs
                                  λi VI,s
                                      i
                                          = [ ∑ (µFj,s − λs Pj,s ) X iI,j,s + λs ],
                                                  j∈ Js

                             µFj∗ (s),s
and in particular for λs =   Pj∗ (s),s ,   we get

                                     µFj∗ (s),s                      µFj,s
                       λi VI,s
                           i
                               =                  [ ∑ ( Pj∗ (s),s              − Pj,s ) X iI,j,s + 1].
                                      Pj∗ (s),s    j∈ Js
                                                                    µFj∗ (s),s



                                                             45
We can re-express this as
                                                       µFj∗ (s),s
                                           λi VI,s
                                               i
                                                   =
                                                           Pj∗ (s),s
                                                                           [1 −   ∑ Pj,s XiI,j,s τj,s ].
                                                                                  j∈ Js

   We use
                                                           VPi k ,s = − Xk,s
                                                                         i    i
                                                                             VI,s ,
                                                   i
                                                  Sk,j,s                 i
                                                         = XPi k ,j,s + Xk,s X iI,j,s ,

                                                    ∑ Pj,s XPi k ,j,s + Xk,s
                                                                         i
                                                                             = 0,
                                                   j∈ Js

                                                            ∑ Pj,s XiI,j,s = 1,
                                                            j∈ Js

to get
                                      −ν · Γ Pk,s = ∑           ∑ µFj,s [XPi k ,j,s + Xk,s
                                                                                       i
                                                                                           X iI,j,s ],
                                                        i ∈ I j∈ Js



  − ν · Γ Pk,s = ∑    ∑ (µFj,s − λs Pj,s )[XPi k ,j,s + Xk,s
                                                         i
                                                             X iI,j,s ]
               i ∈ I j∈ Js

                                                                                                  − ∑ λs Xk,s
                                                                                                          i
                                                                                                              +∑               ∑ λs Pj,s Xk,s
                                                                                                                                          i
                                                                                                                                              X iI,j,s ,
                                                                                                        i∈ I             i ∈ I j∈ Js




                      µFj∗ (s),s                    µFj,s
  − ν · Γ Pk,s = ∑                 ∑ ( Pj∗ (s),s µF ∗               − Pj,s )[ XPi k ,j,s + Xk,s
                                                                                            i
                                                                                                X iI,j,s ]
               i∈ I
                      Pj∗ (s),s    j∈ Js               j (s),s
                                                                                           µFj∗ (s),s                        µFj∗ (s),s
                                                                               −∑                        i
                                                                                                        Xk,s +∑      ∑                          i
                                                                                                                                          Pj,s Xk,s X iI,j,s ,
                                                                                  i∈ I
                                                                                           Pj∗ (s),s           i ∈ I j∈ Js
                                                                                                                             Pj∗ (s),s

and finally
                                                                           Fj∗ (s),s
                                           −ν · Γ Pk,s = − ∑                           ∑ Pj,s τj,s Sk,j,s
                                                                                                    i
                                                                                                          .
                                                                    i∈ I
                                                                           Pj∗ (s),s   j∈ Js

   Summing up, we have

                                                       µFj∗ (s),s
                                           λi VI,s
                                               i
                                                   =
                                                           Pj∗ (s),s
                                                                           [1 −   ∑ Pj,s XiI,j,s τj,s ],
                                                                                  j∈ Js


                                                                    µFj∗ (s),s
                                            ν · Γ Pk,s =    ∑        Pj∗ (s),s     ∑ Pj,s τj,s Sk,j,s
                                                                                                i
                                                                                                      .
                                                            i∈ I                   j∈ Js




                                                                            46
A.2    Proof of Proposition 3
We treat the case without set restrictions Bsi . The case where these restrictions are imposed can
be perfectly approximated as a limit of economies where the individual utility functions are
U i ({ X j,s
         i }; s ) are modified to U i ({ X i }; s ) + χn ( Bi ({ X i }) where χn is a sequence of smooth con-
                                           j,s              s      j,s
cave negative functions such that limn→∞ χ ( x ) = −∞ if x > 0, and χn ( x ) = 0 if x ≤ 0.
                                                     n

     Consider the solution of the planning problem (5). We denote this solution for incomes and
prices as Īsi and P̄j,s , and we denote with bar variables any function evaluated at these income and
prices. Suppose that the solution can be implemented with no financial taxes. This happens if and
only if for all i ∈ I, i0 ∈ I and for all s ∈ S and s0 ∈ S,
                                                    0                                           0
                            1 − ∑ j∈ Js P̄j,s X̄ iI,j,s τ̄j,s        1 − ∑ j∈ Js0 P̄j,s0 X̄ iI,j,s0 τ̄j,s0
                                                                =                                             .
                            1 − ∑ j∈ Js P̄j,s X̄ iI,j,s τ̄j,s        1 − ∑ j∈ Js0 P̄j,s0 X̄ iI,j,s0 τ̄j,s0

   We introduce a perturbation of utility functions U i,e (·; s). We construct this perturbation such
that the following properties are verified. First, the demand functions at the original incomes Īsi
and prices P̄j,s are unchanged, i.e. for all i ∈ I, j ∈ J and s ∈ S,

                                                            i,e      i
                                                         X̄ j,s = X̄ j,s .

Second, the Slutsky matrices at the original incomes Īsi and prices P̄j,s are unchanged, i.e. for all
i ∈ I, j ∈ J and s ∈ S,
                                            i,e       i
                                          S̄k,j,s = S̄k,j,s .

Third the income derivatives X i,e                                                        i
                                 I,j,s of the demand functions at the original incomes Īs and prices
P̄j,s are changed in such a way that for some i ∈ I, i0 ∈ I and for all s ∈ S and s0 ∈ S,

                                                    0                                           0
                            1 − ∑ j∈ Js P̄j,s X̄ iI,j,s
                                                    ,e
                                                        τ̄j,s        1 − ∑ j∈ Js0 P̄j,s0 X̄ iI,j,s
                                                                                               ,e
                                                                                                   0 τ̄j,s0
                                                                6=                                            .
                            1 − ∑ j∈ Js P̄j,s X̄ i,e
                                                 I,j,s τ̄j,s         1 − ∑ j∈ Js0 P̄j,s0 X̄ i,e
                                                                                            I,j,s0 τ̄j,s
                                                                                                         0



Fourth, the marginal utilities of income at the original incomes Īsi and prices P̄j,s change in such a
way the social marginal utilities of income are unchanged, i.e. for all i ∈ I, and s ∈ S,

                                              i,e
                                         λi V̄I,s                                  λi V̄I,s
                                                                                        i
                                                                 =                                        .
                             1 − ∑ j∈ Js P̄j,s X̄ i,e
                                                  I,j,s τ̄j,s
                                                                      1 − ∑ j∈ Js P̄j,s X̄ iI,j,s τ̄j,s

Taken together, these conditions guarantee the incomes Īsi and prices P̄j,s still solve the planning
problem with the perturbed utility functions. Indeed, at these incomes and prices, and with the
perturbed utility functions, the constraints are still verified (because the quantities demanded are
unchanged), and so are the first order conditions for optimality because the Slutsky matrices and


                                                                 47
the social marginal utilities of income are unchanged.26,27,28 And given that (8) is violated, the
solution cannot be implemented without financial taxes.
   Since the original allocation is not first best by assumption, there exists a state s ∈ S and a
good j ∈ Js such that τj,s 6= 0. Our proposed perturbation actually only changes utility for a single
agent i ∈ I this state state s. All the other utility functions are unchanged. We proceed by first
determining income effects that change the optimal financial taxes. Assume that

                                                            X̄ i,e        i          i
                                                               I,j,s = X̄ I,j,s + eZ j,s ,
                 i such that
for some vector Zj,s


                                                              ∑ P̄j,s Zj,s
                                                                       i
                                                                           τ̄j,s 6= 0.
                                                              j∈ Js

Because they are income effects, and we want to retain the unperturbed prices, we must also have


                                                                   ∑ P̄j,s Zj,s
                                                                            i
                                                                                = 0.
                                                                   j∈ Js

This is possible as long as there are at least two goods, and that there exists j ∈ Js such that
τj,s 6= 0 (recall that by construction τj∗ (s),s = 0). To engineer such income effects while preserving
the Slutsky matrix, we follow Geanakoplos and Polemarchakis (1980). We start with the problem
of the agent:

                                                 V i,e ( Isi , { Pj,s }) = max U i,e ({ X j,s
                                                                                          i
                                                                                              }; s ),
                                                                           { X ij,s }

subject to
  26 Because  of the homogeneity of degree 0 in Isi and Ps of Vsi and X j,s      i , there might be an issue of indeterminacy

leading to the solution of the planning problem not being locally unique. If that is the case, we expand the function Γ
to include a normalization of certain prices to rule out this indeterminacy without changing the allocations that solve
the planning problem.
   27 Note that we can rewrite the planning problem as maximizing
                                                                               ∑i∈ I ∑s∈S λi U i ({ X ij,s }; s) subject to the resource
constraints that F ({∑i∈ I X ij,s }) ≤ 0, the price constraint that Γ({ Pj,s }) ≤ 0, and the first order conditions of the agents
that for all i ∈ I, s ∈ S, j ∈ Js and j0 ∈ Js , Uji ({ X j,s i }; s ) /P = U i ({ X i }; s ) /P 0 . We we assume, as is generically
                                                                         j,s     j0    j,s           j ,s
the case, that the second order conditions of this planning problem are strictly satisfied on the manifold of allocations
that satisfy the constraints.
  28 Our perturbations U i,e ({ X i }; s ) = αi U i ({ X i }; s ) + e ( X i )0 Ωi X i − e ( X̄ i )0 Ωi X i , which add linear and quadratic
                                  j,s         s          j,s           2     s  s s           s      s s
terms scaled by e to the utility functions U i (·; s), are such that for e small enough, the incomes Īsi and prices P̄j,s
are a global maximum of the non-perturbed planning problem, but may only be a local maximum of the perturbed
planning problem. We can always modify the perturbations so they are also a global maximum of the perturbed
planning problem by adding eχO  n (·; s ) to U i,e (·; s ) for well chosen convex bounded neighborhoods Oi of X̄ i and some
                                  i                                                                      s      s
                                         s
                                n is a sequence of smooth concave negative functions such that: if { X i } ∈ Oi , then
large enough value of n, where χO i                                                                    j,s    s
                                             s

                             j,s / Os then limn→∞ χOi ({ X j,s }; s ) = − ∞ uniformly on compact subsets of the complement
 n ({ X i }; s ) = 0; if { X i } ∈
χO                                  i              n       i
   i
   s
        j,s                                                    s
(Ōsi )c of the closure Ōsi of Osi ; and for all K > 0, there exists a compact set Osi,K ⊃ Osi such that for all n, if { X j,s
                                                                                                                            i }∈/ Osi,K ,
      n ({ X i }; s ) + 1 ( X i )0 Ωi X i − ( X̄ i )0 Ωi X i < − K.
then χO i    j,s        2    s      s s         s      s s
         s



                                                                           48
                                                 ∑ Pj,s Xj,s
                                                         i
                                                             ≤ Isi .
                                                j∈ Js

The first order condition, in vector notation, is

                                               DUsi,e − ωsi Ps = 0,

where ωsi is the multiplier on the budget constraint. By the envelope theorem,

                                                             i,e
                                                      ωsi = VI,s ,

and by non-satiation,


                                                 ∑ Pj,s Xj,s
                                                         i
                                                             = Isi .
                                                j∈ Js

Holding income constant, totally differentiating, and evaluating the derivatives at incomes Īsi and
prices P̄j,s ,

                                                     i,e                i,e
                              D2 Ūsi,e D X̄si,e − V̄I,s dPs − P̄s ⊗ DV̄I,s = 0,

and

                                          ( X̄si,e )0 dPs + P̄s0 D X̄si,e = 0.

In block matrix form, these equations can be written as
                              "                     #"            # "             #
                                  D2 Ūsi,e − P̄s        D X̄si,e         i,e
                                                                       V̄I,s  I
                                                              i,e =                 dPs .
                                   − P̄s0    0           DV̄I,s       ( X̄si,e )0
Geanakoplos and Polemarchakis (1980) show that the concavity of the utility function is sufficient
to establish the invertibility of
                                                "                   #
                                                    D2 Ūsi,e − P̄s
                                                                      .
                                                     − P̄s0    0
We construct the perturbation starting with the inverse matrix
                                  "               # "                 # −1
                                       Ke     −ve     D2 Ūsi,e − P̄s
                                                   =                       ,                    (66)
                                      −(ve )0 ee       − P̄s0    0
which implies that
                              "            # "             #"             #
                                  D X̄si,e      Ke     −ve        i,e
                                                               V̄I,s  I
                                       i,e =                                dPs .               (67)
                                  DV̄I,s       −(ve )0 ee     ( X̄si,e )0

                                                           49
We choose

                                                            i,e −1 i
                                                   K e = (V̄I,s ) S̄s ,

and

                                                        ve = X̄ i,e
                                                                I,s ,

so that the first equation of (67) is simply the Slutsky equation. We conclude that, in order to
create the desired income effects while preserving the Slutsky matrix, it is necessary and sufficient
to ensure that

                                             i,e −1 i 2 i,e
                                          (V̄I,s ) S̄s D Ūs + X̄ i,e   0
                                                                  I,s P̄s = I,

and

                                            −( X̄ i,e  0 2 i,e   e 0
                                                  I,s ) D Ūs − e P̄s = 0.

These two equations are sufficient for the perturbation to generate the desired income effects
while preserving the Slutsky matrix. Because the equations hold for the unperturbed utility func-
tion and corresponding income effects, we can write

                                     i,e −1 2 i,e     i −1 2 i
                            S̄si ((V̄I,s ) D Ūs − (V̄I,s ) D Ūs ) + e Z̄iI,s P̄s0 = 0,                      (68)

and

                                       Z̄iI,s ( D2 Ūsi,e − D2 Ūsi ) = (ee − e) P̄s0 .                       (69)

      Now, we construct a utility function that preserves the demand at the incomes Īsi and prices
P̄j,s while satisfying these equations (68) and (69) (so that the Slutsky matrix is unchanged and the
desired income effects are produced), and preserving the social marginal utility of income. Define

                                                                   e
                    U i,e ({ X j,s
                               i
                                   }; s) = αis U i ({ X j,s
                                                        i
                                                            }; s) + ( Xsi )0 Ωis Xsi − e( X̄si )0 Ωis Xsi ,
                                                                   2
where Ωis is a matrix and αis is a scalar. First, note that

                                      DŪsi,e = αis DŪsi = ωsi,e P̄s = αis ωsi P̄s .

Therefore, at the incomes Īsi and prices P̄j,s , the demand is unchanged. Applying the envelope
theorem,

                                                        i,e
                                                      V̄I,s = αis V̄I,s
                                                                    i
                                                                        .



                                                             50
To preserve the social marginal utility of income, we set

                                                  1 − ∑ j∈ Js P̄j,s X̄ i,e
                                                                       I,j,s τ̄j,s
                                        αis   =                                       .
                                                  1 − ∑ j∈ Js P̄j,s X̄ iI,j,s τ̄j,s

Note that

                                         D2 Ūsi,e = αis D2 Ūsi + eΩis .

Plugging this into (68), we must choose an Ωis such that

                                           i,e −1 i i
                                        (V̄I,s ) S̄s Ωs + Z̄iI,s P̄s0 = 0.

Because the Slutsky matrix is a square symmetric matrix, we can write

                                                  S̄si = Σis Dsi (Σis )0 ,

where Σis has orthogonal rows and Dsi is diagonal. Suppose that, for some vector ξ si ,

                                                    Ωis = Σis ξ si P̄s0 .

Then

                               S̄si Ωis = Σis Dsi (Σis )0 Σis ξ si P̄s0 = Σis Dsi ξ si P̄s0 .

We can solve for ξ si to satisfy the necessary equation,

                                                 i,e
                                        ξ si = V̄I,s ( Dsi )+ (Σis )−1 Z̄iI,s ,

where ( Dsi )+ denotes the pseudo-inverse of Dsi . This is possible because the non-zero eigenvectors
of the Slutsky matrix form a basis for all vectors orthogonal to P̄s , and by assumption Z̄iI,s lies in
this space. Finally, we can choose some ee scalar to satisfy (69).


References
Bianchi, Javier, “Overborrowing and Systemic Externalities in the Business Cycle,” American Eco-
  nomic Review, December 2011, 101 (7), 3400–3426.

  and Enrique G. Mendoza, “Overborrowing, Financial Crises and ’Macro-prudential’ Taxes,”
  NBER Working Paper 16091 June 2010.

Blanchard, Olivier Jean and Nobuhiro Kiyotaki, “Monopolistic Competition and the Effects of
  Aggregate Demand,” American Economic Review, September 1987, 77 (4), 647–66.


                                                            51
Caballero, Ricardo J. and Arvind Krishnamurthy, “International and domestic collateral con-
  straints in a model of emerging market crises,” Journal of Monetary Economics, December 2001,
  48 (3), 513–548.

Chari, V V and Patrick J Kehoe, “Sustainable Plans,” Journal of Political Economy, August 1990, 98
 (4), 783–802.

Correia, Isabel, Emmanuel Farhi, Juan Pablo Nicolini, and Pedro Teles, “Unconventional Fiscal
 Policy at the Zero Bound,” American Economic Review, June 2013, 103 (4), 1172–1211.

  , Juan Pablo Nicolini, and Pedro Teles, “Optimal Fiscal and Monetary Policy: Equivalence
  Results,” Journal of Political Economy, 02 2008, 116 (1), 141–170.

Davilla, Eduardo, “Dissecting Fire Sales Externalities,” Working Paper, Harvard August 2011.

Diamond, Peter A and James A Mirrlees, “Optimal Taxation and Public Production: I–
 Production Efficiency,” American Economic Review, March 1971, 61 (1), 8–27.

Eggertsson, Gauti B. and Paul Krugman, “Debt, Deleveraging, and the Liquidity Trap: A Fisher-
  Minsky-Koo Approach,” The Quarterly Journal of Economics, 2012, 127 (3), 1469–1513.

Farhi, Emmanuel and Ivan Werning, “Dealing with the Trilemma: Optimal Capital Controls with
  Fixed Exchange Rates,” NBER Working Papers 18199, National Bureau of Economic Research,
  Inc June 2012.

   and , “Fiscal Unions,” NBER Working Papers 18280, National Bureau of Economic Research,
  Inc June 2012.

  , Gita Gopinath, and Oleg Itskhoki, “Fiscal Devaluations,” Technical Report 2 2014.

  , Mikhail Golosov, and Aleh Tsyvinski, “A Theory of Liquidity and Regulation of Financial
  Intermediation,” Technical Report 3 2009.

Friedman, Milton, “The Case for Flexible Exchange Rates,” in “Essays in Positive Economics,”
  University of Chicago Press, 1953, pp. 157–203.

Geanakoplos, J D and H M Polemarchakis, “On the Disaggregation of Excess Demand Func-
 tions,” Econometrica, March 1980, 48 (2), 315–31.

Geanakoplos, J., M. Magill, M. Quinzii, and J. Dreze, “Generic inefficiency of stock market
 equilibrium when markets are incomplete,” Journal of Mathematical Economics, 1990, 19 (1-2),
 113–151.




                                               52
Geanakoplos, John and Heracles M. Polemarchakis, “Existence, Regularity, and Constrained
 Suboptimality of Competitive Allocations When the Asset Market Is Incomplete,” Cowles
 Foundation Discussion Papers 764, Cowles Foundation, Yale University 1985. available at
 http://ideas.repec.org/p/cwl/cwldpp/764.html.

Greenwald, Bruce C and Joseph E Stiglitz, “Externalities in Economies with Imperfect Informa-
 tion and Incomplete Markets,” The Quarterly Journal of Economics, May 1986, 101 (2), 229–64.

Guerrieri, Veronica and Guido Lorenzoni, “Credit Crises, Precautionary Savings, and the Liq-
 uidity Trap,” Working Paper 17583, National Bureau of Economic Research November 2011.

Hart, Oliver D., “On the optimality of equilibrium when the market structure is incomplete,”
 Journal of Economic Theory, December 1975, 11 (3), 418–443.

Herings, P. and Herakles Polemarchakis, “Pareto improving price regulation when the asset mar-
 ket is incomplete,” Economic Theory, 01 2005, 25 (1), 135–154.

Jeanne, Olivier and Anton Korinek, “Excessive Volatility in Capital Flows: A Pigouvian Taxation
  Approach,” American Economic Review, May 2010, 100 (2), 403–407.

   and , “Macroprudential Regulation Versus Mopping Up After the Crash,” NBER Working
  Papers 18675, National Bureau of Economic Research, Inc January 2013.

Kiyotaki, Nobuhiro and John Moore, “Credit Cycles,” Journal of Political Economy, April 1997,
  105 (2), 211–48.

Korinek, Anton, “The New Economics of Prudential Capital Controls: A Research Agenda,” IMF
 Economic Review, August 2011, 59 (3), 523–561.

  , “Capital Controls and Currency Wars,” 2012. Mimeo, University of Maryland.

  , “Systemic Risk: Amplification Effects, Externalities, and Regulatory Responses,” Working Pa-
  per 2012.

   and Alp Simsek, “Liquidity Trap and Excessive Leverage,” NBER Working Papers 19970, Na-
  tional Bureau of Economic Research, Inc 2014.

Lorenzoni, Guido, “Inefficient Credit Booms,” Review of Economic Studies, 2008, 75 (3), 809–833.

Lucas, Robert E., Jr. and Nancy L. Stokey, “Optimal Fiscal and Monetary Policy in an Economy
  without Capital,” Journal of Monetary Economics, 1983, 12, 55–93.

Schmitt-Grohe, Stephanie and Martin Uribe, “Prudential Policies for Peggers,” NBER Working
  Papers 18031, National Bureau of Economic Research, Inc June 2012.

Stein, Jeremy C., “Monetary Policy as Financial-Stability Regulation,” Technical Report 1 2012.

                                               53
Stiglitz, Joseph E, “The Inefficiency of the Stock Market Equilibrium,” Review of Economic Studies,
  April 1982, 49 (2), 241–61.

Woodford, Michael, Interest and Prices: Foundations of a Theory of Monetary Policy, Princeton Uni-
 versity Press, 2003.

  , “Monetary Policy and Financial Stability,” Working Paper, Columbia University 2011.




                                                54
