                               NBER WORKING PAPER SERIES




 EXECUTION RISK AND ARBITRAGE OPPORTUNITIES IN THE FOREIGN EXCHANGE
                              MARKETS

                                         Takatoshi Ito
                                         Kenta Yamada
                                        Misako Takayasu
                                        Hideki Takayasu

                                       Working Paper 26706
                               http://www.nber.org/papers/w26706


                     NATIONAL BUREAU OF ECONOMIC RESEARCH
                              1050 Massachusetts Avenue
                                Cambridge, MA 02138
                                    January 2020




The views expressed herein are those of the authors and do not necessarily reflect the views of the
National Bureau of Economic Research.

At least one co-author has disclosed a financial relationship of potential relevance for this
research. Further information is available online at http://www.nber.org/papers/w26706.ack

NBER working papers are circulated for discussion and comment purposes. They have not been
peer-reviewed or been subject to the review by the NBER Board of Directors that accompanies
official NBER publications.

© 2020 by Takatoshi Ito, Kenta Yamada, Misako Takayasu, and Hideki Takayasu. All rights
reserved. Short sections of text, not to exceed two paragraphs, may be quoted without explicit
permission provided that full credit, including © notice, is given to the source.
Execution Risk and Arbitrage Opportunities in the Foreign Exchange Markets
Takatoshi Ito, Kenta Yamada, Misako Takayasu, and Hideki Takayasu
NBER Working Paper No. 26706
January 2020
JEL No. F31,G12,G14,G15,G23,G24

                                           ABSTRACT

With the high-frequency data of firm quotes in the transaction platform of foreign exchanges,
arbitrage profit opportunities--in the forms of a negative bid-ask spread of a currency pair and
triangular transactions involving three currency pairs--can be detected to emerge and disappear
in the matter of seconds. The frequency and duration of such arbitrage opportunities have
declined over time, most likely due to the emergence of algorithmic trading. When a human
trader detects such an arbitrage opportunity and places orders for multiple transactions--two in
negative spreads and three in triangular arbitrage--there is no guarantee all of those orders are
fulfilled in a fraction of one second. Thus, the arbitrageur has to consider execution risk, when he/
she/it detects the emergence of such an opportunity. The novelty of this paper is to show that
those arbitrage opportunities were exploitable and executable, before the mid-2000s, even
considering the transactions costs and execution risk. After many algorithmic computers were
allowed to be connected directly to the EBS transaction platform in the mid-2000s, the frequency
of free lunch cases has declined and probabilities of successful executions of all legs for arbitrage
declined. We calculate the change in the expected profit of an attempt to execute necessary
transactions to reap benefits from arbitrage opportunity.

Takatoshi Ito                                   Misako Takayasu
Columbia University                             Tokyo Institute of Technology
School of International and Public Affairs      Department of Mathematical and Computing Sciences
Room 927 IAB (MC 3333)                          School of Computing
420 West 118th Street                           And Institute of Innovative Research
New York, NY 10027                              4259, Nagatsuta-cho
and NBER                                        Yokohama, 226-8502
ti2164@columbia.edu                             Japan
                                                takayasu@dis.titech.ac.jp
Kenta Yamada
University of the Ryukyus                       Hideki Takayasu
Faculty of Global and Regional Studies 1        Sony Computer Science Laboratories
Senbaru, Nishihara                              3-14-13 Higashigotanda, Shinagawa-ku
Okinawa 903-0213                                Tokyo 141-0022
Japan                                           Japan
k-yamada@tm.u-ryukyu.ac.jp                      and Institute of Innovative Research,
                                                Tokyo Institute of Technology
                                                takayasu@csl.sony.co.jp
1. Introduction
In most empirical work as well as theoretical work in the foreign exchange markets just assumes "no
free lunch," or no riskless, profitable arbitrage opportunities at any point of time. If profitable
arbitrage opportunities are observed in data, it is often criticized that data are either indicative quotes
(no guarantee of trade commitment) or stale or time-lagged/aggregated quotes. In the 1990s and
2000s, a popular data source was the Olsen data, that are based on indicative quotes observed in the
Reuter FXFX. Any work on showing the existence of the arbitrage opportunities using indicative
quotes was subject to a criticism in that indicative quotes did not mean they are accepted for trading
when an arbitrageur tried to exploit the opportunities. The "indicative quotes" problem was solved
by using "firm quotes" that are collected from an actual trading platform. The commercially
available EBS data sets collect actual quotes and deal prices since 1998 with time stamp of 1 second
or finer in the EBS trading platform. All the quotes in the data set are "firm."
          Ito, et al. (2012) showed that the profitable arbitrage opportunities, in the form of negative
bid-ask spread and triangular arbitrage opportunities, do exist in the market. The size of the profits is
larger than presumed marginal execution costs. The paper also showed that the frequency and
duration of the profitable arbitrage opportunities have diminished over time, in particular after more
bank computers with algorithmic trading programs were allowed to connect directly with the EBS
computer in 2005. The speed of disappearance of arbitrage opportunities accelerated after 2005. By
2010, when an arbitrage opportunity arose, 80-90 percent of them disappeared within one second. It
used to be the case, that is, the bank machined were allowed to be connected to the EBS matching
engine, that humans with eagle eyes and quick fingers could reap the profit from the temporal
inefficiencies in the market, but after mid-2000s, only super-fast computers can detect and exploit
the arbitrage opportunities. The paper suggests that computers having faster CPUs and being housed
next (co-located) to the EBS order-matching computer can collect profits.
          It is a challenge to prove that arbitrage opportunities have been exploitable and actually
exploited by quick human fingers or algorithm in the machine. One critical question is whether an
arbitrage opportunity disappears due to execution of profitable trades or quote revision without
trades. Put differently, the question is whether free lunch was eaten by arbitrageurs or was
disappeared before being eaten. Ito, et al. (2012) gave an indirect answer. The paper showed that a
moment after an arbitrage opportunity appears on screen, deal activities that would make profits
from the opportunities increase. This is consistent with a view that exploitable opportunities are
indeed exploited by deal activities. However, the evidence is only suggestive. An arbitrageur may
have not succeeded in completing two legs, in the case of negative spreads, or three legs, in the case
of triangular arbitrage, of transactions that are needed to reap profits.
          This paper moves an investigation one step further by explicitly calculating the execution
risk. An execution risk here means that the order by a market taker, "the arbitrageur," trying to hit a
bid (or an offer) is not fulfilled either because someone else's order reaches the matching engine a


                                                     2
fraction of a second earlier than the arbitrageur's order; or the firm quote is cancelled a fraction
earlier the arbitrageur's order reaches the matching engine.
          Suppose that the arbitrage opportunity, say the negative spread in the USD/JPY market, is
detected at period t (measured in the unit of one second). Namely, the best bid is higher the best
offer. An arbitrageur places two orders trying to hit the firm bid and to hit the firm offer
simultaneously. If both are executed, the arbitrageur reaps profits, by definition of negative spread.
However, if one of the orders successfully hits a bid but fails to hit an offer, then the arbitrageur is
left with an unwanted short position of the dollar. The arbitrageur has to press hitting the failed trade
even at an unfavorable price. This may generate the loss. If both orders are not fulfilled, zero profit is
a result. Hence it is critical to calculate the success and failure of the arbitrageur's orders to be
fulfilled. This represents an execution risk.
          How can a researcher make inference whether a market taker's order is fulfilled or failed? In
the commercially-available EBS data, the bank identity is not disclosed. Hence, we cannot directly
prove whether a bank actually hit the quote.
          A crucial and very realistic assumption in this paper is that if a quote does not change or
change in the favorable direction for the arbitrageur--higher bid or lowering ask--from period t to
period (t+1), then the trade of the arbitrageur is safely assumed to have been executed. If the price
moves unfavorably from t to t+1, there are two possibilities, either the arbitrageur successfully hits
the firm quote and the best quote targeted for execution disappears as a result; or the arbitrageur
failed to hit the quote, due to a competitor reached earlier or the market maker withdrew earlier. For
the case, the price moved unfavorably, we will introduce a success probability that is used to
calculate the expected profit. Simulations are conducted to calculate the expected profits as a
function of the success probability.
          In case of triangular arbitrage, there are three legs of transactions involved. If all three were
realized, profits are reaped; if none of the three legs is realized, zero profit/loss is a result. We need
to assume some behaviors in case of incomplete triangular trades: if only one leg (order) is fulfilled,
it is assumed to be unwound the position one second later; and if only two legs are fulfilled, the
remaining unfulfilled leg is assumed to be executed successfully one second later. Whether the
exchange rate moves or not, and when it moves, moving in a favorable or unfavorable direction,
makes profits to vary. Sometimes, the execution at one second later, either unwinding or completing
the triangular, will result in losses.
          The main findings can be summarized as follows: Both negative bid-ask spreads and
triangular arbitrage profit opportunities were frequently observed and when they emerge, they tended
to last for a few seconds before 2005. Conditional on the emergence of an arbitrage opportunity, the
execution risk is evaluated with the inference described above. Before 2005, the expected profits,
taking into account execution risk, tended to be positive, while they become positive only when the
success probability is higher for the leg where the price moved unfavorably from t to t+1.


                                                    3
          Even when execution risks are defined and considered the expected profits, net of
transaction costs, remained positive. However, after 2005, the number of observed cases of negative
bid-ask spreads and triangular arbitrage profit opportunities became much smaller, and when they
occurred, they quickly disappeared. The expected profits from arbitrage operations (attempt) became
negative, when the execution risk and the transaction costs was considered.
          The percentage of successful execution (fulfillment) of arbitrage orders declined sharply
after 2005, while the percentage of no completion at all has increased since 2005. The percentages of
partial fulfilment (only a part of a set of market-taking orders are fulfilled) has remained relatively
similar before and after 2005.
          The year 2005 was the first year of a large number of bank transaction computers was
allowed to make a direct connection to the EBS matching supercomputer. It is highly likely that the
change in transaction micro-structure can explain the disappearance of "free lunch."
          The literature on negative spread and triangular arbitrage, using high-frequency data is not
long. Aiba, Hatano, Takayasu, Marumo, and Shimizu (2002), examined the data for two months in
1999 detecting triangular arbitrage profit opportunities, on average for 6.4% of total time, among the
yen, the dollar, and the euro. Aiba, Hatano, Takayasu, Marumo, and Shimizu (2003) and Aiba and
Hatano (2004) also explored some theoretical implications of triangular arbitrage. Aiba and Hatano
(2006) constructed an agent-based model for simulation. Parameters were matched to replicate the
observed distribution of arbitrage profits from Aiba, et al. (2002).
          The exchange rate data from an actual trading platform became available in the mid-1990s.
The availability of "firm quotes," as opposed to "indicative quotes," improved the quality of research
using the high-frequency exchange rate data. Goodhart, Ito and Payne (1996), Goodhart and O'Hara
(1997), and Goodhart and Payne (1996) used such data, although the samples are very limited. Using
the EBS data, which became available in the 2000s, Ito and Hashimoto (2006) showed the intradaily
patterns. Berger et al. (2008) and Ito and Hashimoto (2008) showed that the order flows have
predictable power using the reliable data. The exchange rate reactions to macroeconomic statistical
announcements were analyzed in Chaboud, et al. (2008) and Hashimoto and Ito (2010). Akram and
Sarno (2008) investigated arbitrage opportunities in covered interest parity relationship. Marshall,
Treepongkaruna, and Young (2008) investigated triangular arbitrage opportunities involving, various
advanced countries' currencies for the EBS data from January 1, 2005 to December 31, 2005. Their
findings suggest triangular arbitrage opportunities arise rather frequently throughout the day.
Chaboud, et al. (2010) analyzed the high-frequency volatility in the foreign exchange market.
          For analysis of the execution risk, the literature is thin. Chaboud, et al. (2014) pointed out
the execution risk but did not analyze it empirically. Fenn, et al. (2009) considered execution risk by
defining a winning probability, and using it to calculate profit/loss of attempting taking advantage of
triangular arbitrage opportunities. Their data for analysis of emergence and durability of triangular
arbitrage opportunities are based on a one-week long period in the fall in each of three years, 2003-
05. The simulation of execution risk is conducted only for the one week (10/02/2005­10/27/2005)

                                                   4
data. Engle and Ferstenberg (2007) and Engle, Ferstenberg, and Russell (2012) considered execution
costs and risk from the viewpoint of portfolio management of an equity dealer who receive the
customer orders and execute in the market. The data set consists of 233,913 orders executed by
Morgan Stanley in 2004.
          Kozhan and Tham (2012) analyzed the execution risk explicitly by modeling competition
among arbitrageurs. The more competitors being active in the market, less the probability of
execution. Their data come from Reuters D-3000 and EBS from January 2003 to December 04.
          Foucault, Kozhan; and Tham (2017) distinguishes toxic and nontoxic arbitrage
opportunities. The former is due to asynchronous adjustments in quotes following information
arrival, while the latter is due to temporary price pressures. They built a model to predict that when
the toxic arbitrage ratio is higher, arbitrage opportunities are shorter, even though the bid-ask spread
is higher; and that a technical change allows arbitrageurs react faster, the duration of arbitrage
opportunities becomes shorter. They put the theoretical predictions to test using the triangular
arbitrage opportunities using the Reuters D-3000 Data set from January 2003-December 2004, with
10 millisecond frequency.
          We use the USD/JPY, EUR/JPY and EUR/USD in the EBS data set that spans from 1999 to
2010, containing 1 second slice of actual deal price, deal volume and firm quotes. The following
days are excluded from our samples.
          (1)      Weekend. From GMT 9pm. Friday to GMT 8:59pm. Sunday.
          (2)      End of the year to the New Years, from December 24 to January 5.
          (3)      Low volume of transaction. Days that had less than half of the average transaction
volume of the year, where the average was calculated after exclusion of (1) and (2) are done.
          In the case of triangular arbitrage, we also exclude days when regular settlement (the so-
called t+2) is not possible due to national holidays. Specifically, we exclude transaction days when
non-US national holidays (not including weekend) occur within two days from the transaction day;
and transaction days when US national holiday falls in the second day from the transaction day.
          Our paper covers much longer data compared to any of the paper cited above, and it
becomes possible to link the changes in occurrence and duration of arbitrage opportunities to market
microstructure. The paper also analyzes negative spread of bilateral exchange rate. We will show in
this paper that the market microstructure fundamentally changed after the bank computers were
allowed to connect directly to EBS matching computer, starting from 2003 and the number of
connected institutions grew substantially from 2005-2010.
          The rest of this paper is organized as follows. Section 2 explains the case of negative bid-
ask spread. Section 3 the case of triangular profit opportunities. In each section, the evolution of the
frequency of observing such profit opportunities from 1999 to 2010 will be described; the execution
risk is defined; the profit conditional of all/partial/no fulfillment is defined and calculated; and the
expected profits, taking into account execution risk and transaction costs, will be calculated. Section
4 concludes.

                                                   5
2. Negative Spread
2.1. Definition of negative spread
The negative spread (NS) means that a bid quote (posted by market maker Bank B) is higher than an
ask quote (posted by market maker Bank A) at time t, so that a third-party market-taker financial
institution (Bank C) can simultaneously hit both the bid quote and the ask quote and make profits.
          Let us denote the best ask quote and best bid quote for currency pair  =
                                                                
{/,  /,  /} at time t by   and   , respectively and the case of

negative spread is defined as
                                                                                                (1)
                           =   -   < 0.

Alternatively, the above condition can be rewritten as the following condition:
                                           
                                         
                                                > 1.                                             (2)
                                         



2.2. Execution Risk of Negative Bid-Ask Spread
Conditional on the emergence of negative spread, satisfying equation (2), a market taker (Bank C)
                                                                         
sends two orders trying to hit both best bid,   , and the best ask,   , simultaneously. If the two

orders are fulfilled, the market taker, acting as an arbitrageur, makes profit. However, there is an
execution risk, that is, either one of the two orders or both may not be fulfilled, as matching at the
EBS computer is done on the first-come, first-served basis to the unit of millisecond. A competitor's
order may get to the EBS matching server earlier than the arbitrageur's, or the market maker
withdraws the quote earlier than the arbitrageur's order reached the EBS.
          We infer the execution success or failure from the bid or ask quote price movement from t
to t+1. If the bid quote is unchanged or moved higher from t to t+1, then the arbitrageur's selling
order is assumed to be fulfilled, as the price is moving even higher. Similarly, if the ask quote is
unchanged or moved lower from t to t+1, then the arbitrageur's buying order is assumed to be
fulfilled, as the price is moving even lower.
          When the ask or bid price moves from t to t+1 in the direction unfavorable to the
arbitrageur, then it is not certain whether the arbitrageur's order was fulfilled. We infer and assume
execution success or failure as follows. The price may have moved because the arbitrageur's order
hit and knocked off the best bid (or ask). Or the arbitrageur's order was not fulfilled due to
competitor's have got there first to knock off the best bid (or ask), or the market maker of the best
bid (or ask) have withdrawn before the arbitrageur's order got to the EBS matching engine. Hence
we assign a "winning probability" for the arbitrageur's order hitting the intended bid (or ask) before
the price moved. With a winning probability, w, the arbitrageur's order is fulfilled at price of time t.

                                                   6
With probability of (1-w), the arbitrageur's order is not fulfilled at time t, but is assumed to be
fulfilled at price of time t+1.
          Thus, we can consider the following four cases, which is explained in the flow char of
Figure 1.
                                      <Insert Figure 1 about here>


                                           
Case 11:    +1
            
                   +1
                   
                      .

The arbitrage opportunity continues to exist in period t+1, since the bid becomes equal or higher and
the ask becomes equal or lower. Hence, it is assumed that two orders to hit both bid and ask are
fulfilled. The success probability of execution is one.


                                           
Case 10:    +1
            
                  < +1
                    
                       .

The bid becomes equal or higher, thus a market taker's order to hit is assumed to be fulfilled on the
bid side. However, the ask becomes higher, which may be due to a successful hit by the arbitrageur
or an execution failure of the arbitrageur's order. We assign the success probability, denoted by w, of
the latter leg. If succeed, the arbitrageur's orders are executed at price of time t on both legs. If fail,
the arbitrageur's order on the ask side is fulfilled at one second later, time t+1, at that prevailing
price.


                                           
Case 01:   > +1
             
                    +1
                    
                       .

The ask becomes equal or lower, suggesting that the arbitrageur's order is fulfilled. But, the bid
becomes lower, suggesting that the arbitrageur's order being fulfilled, only with probability w. When
fail, the order is fulfilled at time t+1, with the prevailing price at that time.


                                           
Case 00:   > +1
             
                   < +1
                     
                        .


The bid becomes lower and the ask becomes higher, that is the adverse direction for the arbitrageur,
in time t+1. It is uncertain that any of the arbitrageur's two orders are fulfilled. There are four
subcases in this case: First, two legs are successfully carried out to reap NS profits in time t. Second,
the order to hit the ask was successful at time t, but not on the bid side, so that hitting the bid in time
t+1. Third, the order to hit the bid was successful at time t, but not on the ask side, so that hitting the
ask was done in time t+1. Fourth, both of the arbitrageur's orders were not fulfilled.
         In preparation for calculating the expected return taking into account execution risk
conditional on the existence of the negative spread at time t, we first calculate the number and ratio

                                                     7
of each case and an average return of each case for each year. First, we define the total number of
seconds for each case in each sample year.
                               Year = {all of seconds in Year}
For example, 2010 includes the name of seconds with negative spread, such as
{... 2010.01.21.0:00:00, 2010.01.21.00:00:01, 2010.01.21.00:00:02, ...}.


                                                                  NS,
Next, the set of seconds with negative spread is defined by Year  , namely,

                                  NS,                       
                              Year  =   ÷   > 1.                                                   (3)

The set of seconds that satisfies case 11 is defined as follows:
                                                                      
                      11,Year = {|   +1
                                     
                                            +1
                                            
                                               }.                                                  (4)

Similarly, for Case 10 Case 01 Case 00, the set of seconds are defined as
                   
10,Year , 01          
            ,Year , 00,Year . The set of seconds for Case 11 conditional on negative spread (NS) is

defined as follows:
                                   NS,          NS,         
                                  11,Year = Year   11,Year .                                       (5)

The probability of Case 11, given NS is calculated as follows:
                                    NS,
                                                NS,
                                                            NS,
                                  11,Year = 11,Year /Year ,                                        (6)

where
                            NS,           NS,       ,             ,
                           Year = #Year  , 11,
                                               = #11,
                                                      .                                            (7)

And `#' denotes the number of elements in the set.


Table 1 shows the total number of seconds and the ratio of Cases 11, 10, 01, 00 for the each of the
currency pair  = {USD/JPY, EUR/USD, EUR/JPY} for each sample year.
                                         <Insert Table 1 about here>


Expected return of sending orders to hit NS quotes
When the arbitrageur detects the profit opportunities of negative spread, he/she/it would like to send
orders in an attempt to reap the profit. However, the arbitrageur is mindful of an execution risk, that
is, (part of) the orders may not be fulfilled. Therefore, orders are sent only when the expected profit
is positive. In order to calculate the expected profit, profits of each of the four cases in the flow chart
of Figure 1 has to be calculated first and then the weighted average has to be calculated.


                                                        8
         The return in each case is calculated as follows. The return for Case 00 is zero by definition.
The return for Case 11 is positive (or more than 1 in the defined ratio) by definition. The return of
case 11 is calculated as follows:
                                NS,           1                               
                               11,Year =   NS,
                                                                   ÷    .
                                           11,Year                                                              (8)
                                                    NS,
                                                       11,Year

The returns for Cases 01 and 10 are similarly defined. Case00 does not involve the transaction so that
    NS,
     
00,Year = 1. Table 2 shows the average (over the year) return for each of the execution cases {11,

01, and 10}, for each of sample years. Case 11 means both of the two legs of orders to exploit NS are
executed so that the profit was positive (r > 1). Returns in Cases 01 and 10 are negative (r < 1).
                                      <Insert Table 2 about here>


The arbitrageur when he/she/it detects the existence of NS calculates the average return of sending
orders for execution, taking into account which case (11, 01, 10, or 00) it may end up and expected
returns (average of the year) for each case. 1 Equation (9) shows the average return of sending orders
                                                                                                          NS,
for execution upon an observation of NS, using the probabilities of Cases of execution, ,Year

                                              NS,
(Table 1) and returns of each Case ,Year (Table 2).

          Each executed trade is charged with the EBS transaction fee, which is denoted by c, and in
case of 01 or 10, the winning order ratio, w, is introduced. With probability of w, the arbitrageur's
order is executed at the price at t, before price moves unfavorably to the arbitrageur. The winning
ratio means a ratio to beat competitor in the race to the EBS matching computer, or quick enough to
hit it before the original market maker withdraws the best price at time t. Each component of the
expected profits is the profits conditional on each Case, multiplied by the probability of the case
(average seconds in the case among the total NS time) and the winning probability (simulation
parameter) and the not-winning probability in Cases of 01, 10 and 00.


       NS,USD/JPY        NS,USD/JPY            NS,USD/JPY
      Year          = 11,Year         -   × 11,Year


                                                   ×w+01,Year                               × (1 -w)
               NS,USD/JPY             NS,USD/JPY        NS,USD/JPY             NS,USD/JPY
          +11,Year           -   × 01,Year                           -   × 01,Year                              (9)


                                                   ×w + 10,Year                               × (1 -w)
                NS,USD/JPY            NS,USD/JPY            NS,USD/JPY           NS,USD/JPY
             +11,Year        -   × 10,Year                               -   × 10,Year




1
  Here and in the rest of this paper, the arbitrageur is assumed to be risk neutral, so that the average return for each
case in each year is sufficient to consider for the order decision.
                                                             9
            NS,USD/JPY          NS,USD/JPY             NS,USD/JPY            NS,USD/JPY
        +11,Year         -   × 00,Year        ×  2 1+10,Year        -   × 00,Year         ×  (1 - )

            NS,USD/JPY           NS,USD/JPY                     NS,USD/JPY
         +01,Year        -   × 00,Year        × (1 -  )+ 1× 00,Year          × (1 - )2



The log (base 10) return is defined as follows:
                                  NS,USD/JPY           NS,USD/JPY
                                Year           = log10 Year       .                                   (10)



Figure 2 shows the matrix of expected returns, in equation (10), as a function of the winning ratio
(horizontal row) for each year (vertical column). The execution fee is assumed to be $6 per contract
($1 million). 2 Fig. 2 is a heat map where the darker cell implies more profitable and the lighter cell
implies a loss. If the winning probability is higher, the average return is higher. The average profits
became smaller and sometimes turns a loss as the year passes by, given the winning probability.
                                      <Insert Figure 2 about here>


The direct connection of bank computers to the EBS matching engine started on the limited scale in
2003 and the number of connection gradually increased to 2010. The algorithmic program can easily
detect the emergence of negative spread (NS) and react to it much faster than humans. Until 2002,
even in the case of the winning probability of 0, the profit was expected until 2002. When the NS is
detected the market maker with quick fingers should (and probably did) send order for execution,
and made profits. More recently, after 2005, the arbitrageur faces the expected loss, thus should not
send execution orders even detecting NS at period t. However, if your algorithm is much faster than
others, namely the winning probability is higher, there could be still expected profits.


Figures 3 and 4 show the expected returns, net of transaction costs and taking into account of
execution risk, for the currency pairs of EUR/USD and EUR/JPY, respectively. Similar to Figures 1
and 2, the expected return is a function of winning probabilities in cases of 01 and 10. The horizontal
axis is the year. The gain/loss table of the EUR/USD shows a result similar to the USD/JPY. Namely,
the prior to 2003, regardless of the winning probability, the expected profit of sending two orders
was positive, conditional on the detection of a triangular arbitrage opportunity. The winning
probability became to matter after 2003 more and more. By 2006, winning probability exceeding 70
percent was required to make the expected profit positive.
                                      <Insert Figures 3 and 4 here>




2 The fee is based on our interview to EBS. This is close to what EBS charges to large volume
customers.
                                                 10
The EUR/JPY shows much lower expected return in executing an arbitrage opportunity. Even before
bank machines became directly connected to the EBS computer, higher winning ratios, typically
higher than 40% were required to command a positive profit in attempting execution. The EUR/JPY
market was not very liquid in the first half of the 1990s. The bid-ask spread was wider than other two
currency pairs. When one of the two legs of transaction fail to be executed, the exchange rate of
actual execution one second later was much worse in terms of arbitrage opportunity.

3. Triangular Arbitrage
3.1. Definition: Triangular Arbitrage
The triangular arbitrage opportunities can be understood as profits from a set of three simultaneous
transactions: (Eastward) Selling the yen (JPY) to buy the US dollar (USD); selling the USD to buy
the euro (EUR); and finally selling EUR to buy JPY; or (Westward) Selling JPY to buy EUR; selling
EUR to buy USD; and selling USD to buy JPY. The words, Eastward and Westward are used to
make it easier to understood, but the transactions are time-wise simultaneous executed and
geographically in any market. Since a set of transactions has to be executed simultaneously, the
original currency for an explanation purpose is irrelevant in calculation of profits.
         In either Eastward or Westward transactions, if the amount of Yen after three transactions is
more than that of yen before the three transactions, it is defined that there is a profit opportunity of
triangular arbitrage. Let us follow the precise definition, provided in Ito et al. (2012). The three
currency pairs are said to have a positive (normal) bid-ask spread, when:

                           USD/JPY        USD/JPY                        USD/JPY
         For USD/JPY:         >         , with mid-point of 
                       EUR/USD    EUR/USD                        EUR/USD
         For EUR/USD:          >           , with mid-point of 
                      EUR/JPY    EUR/JPY                       EUR/JPY
         For EUR/JPY:         >          , with mid-point of 

Even when all the three positive bid-ask spread conditions are satisfied, a possibility of arbitrage
profits may exist by combining simultaneous transactions of three currency pairs. Suppose a series of
transaction that takes the yen to the US dollar, to Euro, and back to the yen. First the buying the US
dollar takes at the ask side (quoted price of USD seller); then buying the euro with the US dollar
takes place at the ask side (quoted price of Euro seller); and finally exchanging the euro back to the
yen should be on the bid side of the EUR/JPY. Thus, profits from the triangular arbitrage, TA,
considering the bid-ask, in the three Eastward transactions of JPY USD EUR JPY is defined
as
                                                    1           1        EUR/JPY
         TA(JPY/USD/EUR/JPY) =  =             USD/JPY    ×   EUR/USD   × 
                                                             

        Similarly, the amount of yen after the three Westward transactions of JPY EURUSD
JPY is denoted as follows:


                                                    11
                                                     1             EUR/USD         USD/JPY
        TA(JPY/EUR/USD /JPY) =  =                   EUR/JPY   ×              × 
                                               



3.2. Execution Risk of Triangular Arbitrage
This subsection examines profitability of triangular arbitrage, taking into account transaction costs
and execution risk. As in the case of negative spread, we infer a success in execution from change/no
change in best bid and best ask quotes in one second after an arbitrage opportunity arises. When a
quote moves in an adverse direction, we examine a success probability in execution. A triangular
arbitrage involves three legs of transactions to complete an arbitrage strategy. If only one or two
initial orders are completed, the arbitrageur has to decide to carry out the remaining trades, one
second later with adverse prices, or to unwind the partially buildup positions. The expected
profit/loss on the recovery tactics will be calculated.
          Triangular arbitrages involving Yen, Dollar and Euro, has a two types: One exchanges
currencies from JPY to USD, USD to EUR, and EUR to JPY; and another from JPY to EUR; EUR to
USD, and USD to JPY. Since all orders are placed simultaneously, the sequence does not matter.
Technically the two strategies differ in whether bid or ask is used in each currency.
          Figures 5 and 6 show the flow charts of execution possibilities when the three orders to
exploit an triangular arbitrage are placed. Figure 5 shows the case of JPY to USD, to EUR and to
JPY; while Figure 6 shows the case of JPY to EUR, to USD, and to JPY. Again the order of
executions is irrelevant to the layer of flow chart can be flipped. In each case, the execution
possibility is categorized in eight cases: {111,110,101,011,100,010,001,000}. When the index is 1,
the order is executed at time t; and when the index is 0, then with probability w, the order is executed
at time t, and with probability (1-w), the order is executed at time (t+1). This is explicitly explained
the case that includes 0 once, but it is implicit in the case that includes 0 twice or three times, in
order to save space.
                                    <Insert Figures 5 and 6 about here>
          First, the frequencies, probability of emergences, and average returns of each of eight cases
will be calculated. For each calendar year, the set of time (in seconds) in that Eastward triangular
arbitrage (JPY-USD-EUR-JPY) opportunities are present is defined as follows:
                                          USD/JPY          EUR/USD       EUR/JPY
               TA-                                              
               Year =  >1.00001 ,      USD/PY < 1, EUR/USD < 1, EUR/JPY < 1                       (11E)
                                                                
where
            USD/JPY     USD/JPY         EUR/USD          EUR/USD         EUR/JPY        EUR/JPY
                   /            < 1,           /            < 1,            /            <1
means that each currency pair is not showing negative spread. Similarly the set of time (in seconds)
in that Westward triangular arbitrage (JPY-EUR-USD -JPY) opportunities are present is defined as
follows:
                                          USD/JPY          EUR/USD       EUR/JPY
              TA-                                               
              Year = TA >1.00001 ,     USD/PY < 1, EUR/USD < 1, EUR /JPY < 1                      (11W)
                                                                

                                                     12
The set of time (in seconds), i.e., cumulative seconds, for Case {111}, whether or not it represent
triangular opportunities, in Figure 5 (Eastward transactions) is defined as follows:

       E              USD/JPY     USD/JPY    EUR /USD    EUR /USD    EUR/JPY   EUR/JPY
       111 ,Year = { |                      ,                       ,                    }     (12)
Hence, the set of time, in which trilateral arbitrage of (JPY-USD-EUR-JPY) is present and in Case
{111}, is defined as the intersection of two sets:
                                 TA-E         TA-E      E
                                111 ,Year = Year  111,Year                                  (13)
Similarly, the set of time for each of cases {110}, {101}, {011}, {100}, {010}, {001} and {000} is
defined. In parallel, sets are defined in the triangular arbitrage of the reverse direction: JPY-EUR-
USD-JPY.
         The number of seconds, n, in a year for Eastward triangular arbitrage opportunity case is
defined as:

                                      TA-E    TA-E
                                      Year = #Year                                            (14E)
And similarly for the Westward one as:
                                     -       -
                                     Year = #Year                                            (14W)


The number of seconds for Case 111 for East and West triangular arbitrage opportunities is,
respectively, defined as:
                                 TA-E          TA-E
                                111 ,Year = #111,Year                                       (15E)
                                    TA-W        TA-W
                                    111,Year = #111,Year                                     (15W)


Hence, given arbitrage opportunities being present, the probability of Case {111}, for Eastward and
Westward, respectively, is calculates as:
                                 -          -          -
                               111  ,Year = 111,Year /Year                                  (16E)
                                -          -         -
                                111,Year = 111,Year /Year                                    (16W)


Tables 3E and 3W show the time series (annual) changes of the number of occurrence, the
probability of occurrence for each of the sample years, for Eastward and Westward, respectively.
The probability of case {111} declined over the year, and the probabilities of other cases have
increased instead. Similarly, the number and probability (ratio) for each Case{x, y, z}, where x={0,
1}; y={0, 1}; and z={0, 1}, is calculated.
                                <Insert Tables 3E and 3W about here>


                                                    13
         Next, we calculate the return for each of the Cases {x, y, z}. In case of Case 111, the return
for Eastward triangular arbitrage and Westward triangular arbitrage are calculated as follows:


                                            1
                            -
                            111 ,Year =                        ()                              (17E)
                                          111,Year-
                                                  111 ,Year



                                            1
                            -
                            111 ,Year =               ()                                       (17W)
                                          111,Year  -
                                                   111 ,Year




 Similarly, Case110,101,011,100,010,001,000 are defined and calculated. Tables 4E and 4W show
 an annual average return from 1999 to 2010. Returns in Case111 always exceeds 1, that is, profits
 are realized, since conditions suggest successful execution. Other cases {110,101,011,100,010,001,
 000}, indicating at least one of the three leg transactions fail to materialize and the price moves in
 an adverse direction, are calculated with possible losses.
                                 <Insert Tables 4E and 4W about here>

3.3. Profitability
                                                                           
Using probabilities of cases {111,110,101,011,100,010,001,000} in Table 3,  ,Year , and average
                                                                   TA
returns of cases of {111, 110, 101, 011, 100, 010, 001}in Table 4,    ,Year , we can calculate the
executable average returns, given the triangular arbitrage opportunities being detected, for each year,
as shown in equation (18) below. Here, c and w denote the commission fee (paid to EBS) and the
probability of successful execution (winning) when the price moves in an adverse direction one
second later.

    TA     TA             TA
    Year = 111,Year -   × 111,Year
          TA             TA            TA             TA
         +111,Year -   × 110,Year ×w + 110,Year -   × 110,Year × (1 -w)
          TA             TA            TA             TA
         +111,Year -   × 101,Year ×w + 101,Year -   × 101,Year × (1 -w)
          TA             TA            TA             TA
         +111,Year -   × 011,Year ×w + 011,Year -   × 011,Year × (1 -w)
          TA             TA            TA             TA
         +111,Year -   × 100,Year ×w + 110,Year -   × 100,Year × (1 -w)
          TA             TA         2  TA             TA
         +111,Year -   × 100,Year ×  + 110,Year -   × 100,Year ×  (1 -  )
          TA             TA                   TA             TA                 2
         +101,Year -   × 100,Year ×  (1 -  ) +100,Year -   × 100,Year × (1 -  )                 (18)
          TA             TA         2  TA             TA
         +111,Year -   × 010,Year ×  + 110,Year -   × 010,Year ×  (1 -  )
          TA             TA                   TA             TA                 2
         +011,Year -   × 010,Year ×  (1 -  ) +010,Year -   × 010,Year × (1 -  )
          TA             TA         2  TA             TA
         +111,Year -   × 001,Year ×  + 101,Year -   × 001,Year ×  (1 -  )
          TA             TA                   TA             TA                 2
         +011,Year -   × 001,Year ×  (1 -  ) +001,Year -   × 001,Year × (1 -  )
          TA             TA         3 TA             TA         2
         +111,Year -   × 000,Year ×  +110,Year -   × 000,Year ×  (1 -  )
          TA             TA         2        TA             TA         2
         +101,Year -   × 000,Year ×  (1 -  )+011,Year -   × 000,Year ×  (1 -  )


                                                      14
          TA             TA                 2 TA             TA                  2
         +100,Year -   × 000,Year ×  (1 -  ) +010,Year -   × 000,Year ×  (1 -  )
          TA             TA                 2     TA                 3
         +001,Year -   × 000,Year ×  (1 -  ) +1 × 000,Year × (1 -  )




The log returns (with base of 10) of equation (18) are defined as follows:
                                      TA
                                    Year = log10 Year
                                                   TA
                                                      .                                          (19)


Figures 7E and 7W shows the average log-returns depending on the w parameter moving from 0 to 1
by unit of 0.1 for each year from 1999 to 2010, depending on the eastward arbitrage (JPY ­ USD ­
EUR ­ JPY) and the westward arbitrage (JPY ­ EUR ­ USD ­ JPY), respectively. The commission
fee is assumed to be  = 9 × 10-6 . Hence Figures 7E and 7W show average returns of triangular
                                                    
arbitrage with execution risk and transaction cost (Year ).

         The winning probability has to be much higher to make triangular arbitrage opportunities
profitable with execution risk, compared to cases of negative spreads. This is sensible because taking
advantage of a triangular arbitrage opportunity requires three transactions that are exposed to
execution risk, while two transactions to negative spread. It is also obvious that even higher winning
probabilities are required to generate profits when algorithm trading became prevalent after 2003.


4. Concluding Remarks
This paper examined one-second slice of high-frequency data from 1999 to 2010. With the high-
frequency data of firm quotes in the transaction platform of foreign exchanges, arbitrage profit
opportunities--in the forms of a negative bid-ask spread of a currency pair and triangular
transactions involving three currency pairs--can be detected to emerge and disappear in the matter of
seconds. The frequency and duration of such arbitrage opportunities have declined over time, and
almost disappeared by the mid-2000s. The declining frequency of appearance and shortening
duration of arbitrage opportunities can be attributable to the proliferation of algorithm trading and
other innovations in the market. Critics of the existence of such "free lunch" opportunities would
argue that opportunities are not exploitable once the transactions costs and execution risk are taken
into account. In this paper, we will show that profits remain positive even after transactions costa and
executions were possible most of the time. When a human trader detects such an arbitrage
opportunity and places orders for multiple transactions--two in negative spreads and three in
triangular arbitrage--there is no guarantee all of those orders are fulfilled in a fraction of one second.
Thus, the arbitrageur has to consider execution risk, when he/she/it detects the emergence of such an
opportunity.
         Execution risk as well as transaction costs was explicitly considered in calculation of profits,
by examining a change in the best ask and bid from one second to next for each emergence of the


                                                   15
arbitrage opportunity. We calculated the expected profits depending on some parameters, tie-brake
rule for competing orders, on execution risk.
          The novelty of this paper is to show that those arbitrage opportunities were exploitable and
executable, before 2004, even considering the transactions costs and execution risk. After many
algorithmic computers were allowed to be connected directly to the transaction platform in 2005, the
frequency of free lunch cases has declined and probabilities of successful executions of all legs for
arbitrage declined. We calculate the change in the expected profit of an attempt to execute necessary
transactions to reap benefits from arbitrage opportunity.




                                                  16
References

Aiba, Yukihiro and Naomichi Hatano (2004). "Triangular Arbitrage in the Foreign Exchange
Market," Physica A 344, 2004, 174­177.


Aiba, Yukihiro and Naomichi Hatano (2006). "A microscopic model of triangular arbitrage" Physica
A 371, 2006, 572­584.


Aiba, Yukihiro; Naomichi Hatano; Hideki Takayasu; Kouhei Marumo; and Tokiko Shimizu (2002).
"Triangular arbitrage as an interaction among Foreign exchange rates," Physica A 310, 2002, 467­
479.


Aiba, Yukihiro; Naomichi Hatano; Hideki Takayasu; Kouhei Marumo; and Tokiko Shimizu (2003).
"Triangular arbitrage and Negative Auto-correlation of Foreign Exchange Rates," Physica A 314,
2003, 253­257.


Akram, Farooq and Lucio Sarno (2008). "Arbitrage in the Foreign Exchange Market: Turning on the
Microscope," Journal of International Economics, vol. 76, 2008, 237­253.


Berger, David W., Alain P. Chaboud, Sergey V. Chernenko, Edward Howorka, and Jonathan H.
Wright (2008). "Order Flow and Exchange Rate Dynamics in Electronic Brokerage System Data,"
Journal of International Economics, vol. 75, no. 1, 2008, 93­109.


Chaboud, Alain P., Sergey V. Chernenko, and Jonathan H. Wright (2008). "Trading Activity and
Macroeconomic Announcements in High-Frequency Exchange Rate Data," Journal of the European
Economic Association, vol. 6, no. 2-3, 589-596.


Chaboud, Alain P., Benjamin Chiquoine, Erik Hjalmarsson, and Mico Loretan (2010). "Frequency of
Observation and the Estimation of Integrated Volatility in Deep and Liquid Financial Markets,"
Journal of Empirical Finance, vol. 17, no. 2, 212-240.


Chaboud, Alain, Benjamin Chiquoine, Erik Hjalmarsson, and Clara Vega (2014). "Rise of the
Machines: Algorithmic Trading in the Foreign Exchange Market," Journal of Finance, vol. 69, no. 5,
2045-2084.


Engle, Robert and Robert Ferstenberg (2007). "Execution Risk," Journal of Portfolio Management,
vol. 33, no. 2, 34-45.


                                               17
Engle, Robert; Robert Ferstenberg, and Jeffrey Russell (2012). "Measuring and Modeling Execution
Cost and Risk," Journal of Portfolio Management, Winter vol. 38, no. 2: 14-28.


Fenn, Daniel J.; Sam D. Howison; Mark McDonald; Stacy Williams; and Neil F. Johnson, (2009).
"The mirage of triangular arbitrage in the spot foreign exchange market" International Journal of
Theoretical and Applied Finance Volume 12, Issue 8, December 2009: 1105-1123.

Foucault, Thierry; Roman Kozhan; and WingWah Tham, (2017). "Toxic Arbitrage," Review of
Financial Studies, vol. 30, no. 4: 1053-1094.


Goodhart, Charles, Ito, Takatoshi, and Payne, Richard (1996). "One day in June 1993: a study of the
working of the reuters 2000-2 electronic foreign exchange trading system," in Frankel, J.A., Galli,
G., Giovannini, A. (Eds.), The Microstructure of Foreign Exchange Markets. The University of
Chicago Press, Chicago, 107­179.

Goodhart, C.A.E. and O'Hara, M. (1997). "High frequency data in financial markets: Issues and
applications." Journal of Empirical Finance, 4, 73­114.


Goodhart, Charles, Payne, Richard (1996). "Microstructural dynamics in a foreign exchange
electronic broking system," Journal of International Money and Finance 15 (6), 829­85.


Hashimoto, Yuko and Takatoshi Ito (2010). "Effects of Japanese Macroeconomic Announcements
on the Dollar/Yen Exchange Rate: High-Resolution Picture," Journal of the Japanese and
International Economies vol. 24, 334-354.

Ito, Takatoshi and Yuko Hashimoto (2006). "Intra-day Seasonality in Activities of the Foreign
Exchange Markets: Evidence from the Electronic Broking System" Journal of the Japanese and
International Economies, vol. 20, no. 4, 637-664.


Ito, Takatoshi and Yuko Hashimoto (2008). "Price Impacts of Deals and Predictability of the
Exchange Rate Movements," in T. Ito and A. Rose (eds.), International Financial Issues in the
Pacific Rim, NBER East Asia Seminar on Economics, Volume 17, Chicago: University of Chicago
Press, 177-215.


Ito, Takatoshi; Kenta Yamada; Misako Takayasu; and Hideki Takayasu (2012), Free Lunch!
Arbitrage Opportunities in the Foreign Exchange Markets" NBER Working Paper No. 18541,
November.


                                                 18
Kozhan, R. and Tham, W. W. (2012). "Execution risk in high-frequency arbitrage," Management
Science, Volume 58, Number 11, 2131-2149.


Marshall, Ben R., Treepongkaruna, Sirimon and Young, Martin R. (2010). "What Level of
Compensation is Available to Arbitrageurs in the Foreign Exchange Market?" AFA 2008 New
Orleans Meetings Paper. http://ssrn.com/abstract=970410




                                              19
Figures




Figure 1 Flow chart of success and failure of arbitrageur's orders for execution




                                                  20
                                                                                 NS,USD/JPY
Figure 2 The average returns of sending orders of execution conditional of NS: (Year          ).
Notes: The Horizontal axis is year; and the vertical axis is the winning probability.




                                                21
                                                             NS,EUR/USD
Figure 3 Expected returns for the currency pair of EUR/USD: (Year         )




                                              22
                                                             NS,EUR/JPY
Figure 4 Expected returns for the currency pair of EUR/JPY: (Year         )




                                              23
Figure 5 Flow chart of case 111,110,101,011,100,010,001,000 for (JPY-USD-EUR-JPY)




                                             24
Figure 6 Flow chart of case 111,110,101,011,100,010,001,000 for (JPY-EUR-USD-JPY)




                                             25
Figure 7E Average returns of Eastward triangular arbitrage with execution risk and transaction
      
cost (Year ).




                                                 26
Figure 7W Average returns of Westward triangular arbitrage with execution risk and transaction
      
cost (Year )




                                                27
Tables

Table 1




Notes: (1) Row "#"is the number of negative spread cases (in units of seconds) that appeared in the
year by types of execution success or failures of the two legs. (2) "%" shows the percentage of the
number of the particular combination(s) of execution in ratio to total cases.



Table 2 Average returns of Cases 11, 01, 10 for each sample year




                                                 28
Table 3E The number of Occurrence and the probability for Eastward by Cases {x, y, z}




Table 3W The number of Occurrence and the probability for Eastward by Cases {x, y, z}




                                               29
 Table 4E Annual average returns of Eastward triangular arbitrage




Table 4W Annual average returns of Westward triangular arbitrage




                                                30
