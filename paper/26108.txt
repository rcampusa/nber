                              NBER WORKING PAPER SERIES




                          NETWORKS, BARRIERS, AND TRADE

                                        David Baqaee
                                       Emmanuel Farhi

                                      Working Paper 26108
                              http://www.nber.org/papers/w26108


                    NATIONAL BUREAU OF ECONOMIC RESEARCH
                             1050 Massachusetts Avenue
                                Cambridge, MA 02138
                           July 2019, Revised January 2021




Emmanuel Farhi tragically passed away in July, 2020. Emmanuel was a one-in-a-lifetime
collaborator and my best friend. Revising this paper without him has been very difficult. We
thank Pol Antras, Andy Atkeson, Natalie Bau, Ariel Burstein, Arnaud Costinot, Pablo
Fajgelbaum, Elhanan Helpman, Sam Kortum, Marc Melitz, Stephen Redding, Andrés Rodríguez-
Clare, and Jon Vogel for insightful comments. We are grateful to Maria Voronina, Chang He, and
Sihwan Yang for outstanding research assistance. We acknowledge support from NSF grant
#1947611. The views expressed herein are those of the authors and do not necessarily reflect the
views of the National Bureau of Economic Research.

NBER working papers are circulated for discussion and comment purposes. They have not been
peer-reviewed or been subject to the review by the NBER Board of Directors that accompanies
official NBER publications.

© 2019 by David Baqaee and Emmanuel Farhi. All rights reserved. Short sections of text, not to
exceed two paragraphs, may be quoted without explicit permission provided that full credit,
including © notice, is given to the source.
Networks, Barriers, and Trade
David Baqaee and Emmanuel Farhi
NBER Working Paper No. 26108
July 2019, Revised January 2021
JEL No. F1,F11,F13

                                           ABSTRACT

We study a non-parametric class of neoclassical trade models with international production
networks and arbitrary distortions. We characterize their properties in terms of sufficient statistics
useful for growth and welfare accounting as well as for counterfactuals. Using these sufficient
statistics, we characterize societal losses from increases in tariffs and iceberg trade costs, and
highlight the qualitative and quantitative importance of accounting for intermediates. Finally, we
establish a formal duality between open and closed economies and use this to analytically
quantify the gains from trade. Our results, which can be used to compute local and global
counterfactuals, provide an analytical toolbox for studying large-scale trade models. Therefore,
this paper helps bridge the gap between computation and theory.


David Baqaee
Department of Economics
University of California at Los Angeles
Bunche Hall
Los Angeles, CA 90095
and CEPR
and also NBER
baqaee@econ.ucla.edu

Emmanuel Farhi
and CEPR
N/A user is deceased




A data appendix is available at http://www.nber.org/data-appendix/w26108
1    Introduction
Trade economists increasingly recognize the importance of using large-scale computational
general equilibrium models for studying trade policy questions. One of the major down-
sides of relying on purely computational methods is their opacity: computational models
can be black boxes, and it may be hard to know which forces in the model drive specific
results. On the other hand, simple stylized models, while transparent and parsimonious,
can lead to unreliable quantitative predictions when compared to the large-scale models.
    This paper attempts to provide a theoretical map of territory usually explored by ma-
chines. It studies output and welfare in open economies with disaggregated and inter-
connected production structures and heterogeneous consumers. We address two types of
questions: (i) how to measure and decompose, a     ` la Solow (1957), the sources of output and
welfare changes using ex-post sufficient statistics, and (ii) how to predict the responses of
output, welfare, as well as disaggregated prices and quantities, to changes in trade costs or
tariffs using ex-ante sufficient statistics. Our analysis is non-parametric and fairly general,
which helps us to isolate the common forces and sufficient statistics necessary to answer
these questions without committing to a specific parametric set up. We show how account-
ing for the details of the production structure can theoretically and quantitatively change
answers to a broad range of questions in open-economy settings.
    In analyzing the structure of open-economy general equilibrium models, we emphasize
their similarities and differences to the closed-economy models used to study growth and
fluctuations. To fix ideas, consider the following fundamental theorem of closed economies.
For a perfectly-competitive economy with a representative household and inelastically
supplied factors,
                                  d log W     d log Y     salesi
                                            =           =        ,                           (1)
                                  d log Ai    d log Ai    GDP
where W is real income or welfare (measured by equivalent variation), Y is real output or
GDP, and Ai is a Hicks-neutral shock to some producer i. Equation (1), also known as Hul-
ten's Theorem, shows that the sales share of producer i is a sufficient statistic for the impact
of a shock on aggregate welfare, aggregate income, and aggregate output to a first order.
Specifically, Hulten's theorem implies that, to a first order, any disaggregated information
beyond the sales share (the input-output network, the number of factors, the degrees of
returns to scale, and the elasticities of substitution) is macroeconomically irrelevant.
    In this paper, we examine the extent to which the logic of (1) can be transported into
international economics. We provide the open-economy analogues of equation (1), and
show that although versions of Hulten's theorem continue to hold in open-economies, the
sales shares are no longer such universal sufficient statistics. Ultimately, there are two

                                               2
main barriers to naively applying Hulten's theorem in an open-economy: first, in an open-
economy, output and welfare are no longer the same since welfare depends on terms-of-
trade but output does not (see e.g. Burstein and Cravino, 2015); second, much of trade
policy concerns the effects of tariffs, which knocks out the foundation of marginal cost
pricing and Pareto efficiency that Hulten's Theorem is built on. Our generalizations make
clear precisely the conditions under which a naive-application of (1) to an open-economy
is valid. Even when not directly applicable, it proves helpful to think in terms of (1), and
deviations from it.
    Our framework allows for arbitrary distorting wedges (like tariffs or markups) in the
initial equilibrium, and we derive comparative statics with respect to both wedges (like
tariffs) and technologies (like iceberg costs of trade) in terms of model primitives. When
the initial allocation is Pareto-efficient, because of the first welfare theorem, changes in
wedges have no first-order effect on real GDP and world welfare. In this case, we can in-
stead provide second-order approximations. We show that welfare losses to the world as a
whole, and to the output of each country, from the imposition of tariffs or other distortions
is approximately equal to a Domar-weighted sum of Harberger triangles. This result holds
even in the absence of implausible compensating transfers, and we provide explicit formu-
las for what these Harberger triangles are equal to in terms of microeconomic primitives.
We explain how to adjust these formulas to obtain welfare losses. We show that the exis-
tence of global value chains dramatically increases the costs of protectionism by inflating
both the area of each triangle and the Domar weight used to aggregate the triangles. Simple
(non-input-output) models, regardless of how they are calibrated, get either the area of the
triangles or their weight wrong.
    Our comparative static results generalize the local hat-algebra of Jones (1965) beyond
frictionless 2 × 2 × 2 no input-output economies. These local results can also be numeri-
cally integrated to arrive at exact global comparative statics. This provides an alternative
to exact hat-algebra (e.g. Dekle et al., 2008) common in the literature. Whereas exact hat-
algebra requires solving a large nonlinear system of equations once, this differential ap-
proach requires solving a smaller linear system repeatedly. Computationally, for large and
highly nonlinear models, this differential equation approach is significantly faster.1
    Finally, we analytically characterize the gains from trade by considering how welfare
changes as a country moves towards autarky. To do so, we show that under some condi-
tions, there exists a useful isomorphism between open and closed economies. In particular,
for any open-economy with nested-CES import demand there exists a companion (dual)
closed economy, and the welfare effects of trade shocks in the open-economy are equal to
   1 We also provide flexible Matlab code for performing these loglinearizations and numerically integrating

the results.

                                                     3
the output effects of productivity shocks in the closed economy. Hence, we can use re-
sults from the closed-economy literature, principally Hulten (1978) and Baqaee and Farhi
(2017a), to characterize the effects of trade shocks on welfare. Our formulas provide a gen-
eralization of some of the influential insights of Arkolakis et al. (2012) to environments
with disaggregated, non-loglinear (non-Cobb-Douglas) input-output connections. Com-
pared to the loglinear (Cobb-Douglas) production networks common in the literature (e.g.
Costinot and Rodriguez-Clare, 2014; Caliendo and Parro, 2015), we find that accounting
for nonlinear production networks significantly raises the gains from trade. Accounting
for nonlinear input-output networks is as, or more important, as accounting for intermedi-
ates in the first place. For example, for the US, the gains from trade increase from 4.5% to
9% once we account for intermediates with a loglinear network, but they increase further
to 13% once we account for realistic complementarities in production. The numbers are
even more dramatic for more open economies, for example, the gains from trade for Mex-
ico go from 11% in the model without intermediates, to 16% in the model with a loglinear
network, to 44.5% in the model with a non-loglinear network.
    In Section 7, we present a series of worked-out analytical examples. These examples
show how our general results can be applied to study a range of different applied ques-
tions, like Dutch disease, the incidence of tariffs on different factors, how global value
chains can amplify the losses from protectionism, and how the presence of universal inter-
mediate inputs, like foreign energy, amplify the welfare loss of moving towards autarky.
    The outline of the paper is as follows. In Section 2, we set up the model and define the
objects of interest. In Section 3, we derive some first-order growth-accounting results use-
ful for measurement and decompositions. In Section 4, we derive first-order comparative
statics in terms of microeconomic primitives, useful for prediction. In Section 5, we apply
the results in Section 4 to approximate societal losses from tariffs and other wedges to the
second order. In Section 6, we establish a (global) dual relationship between closed and
open economies and use it to study the gains from trade. Section 7 contains analytical ex-
amples. Section 8 contains quantitative examples, calibrated using nested-CES functional
forms, to show the sorts of questions our results can be used to answer and to check the
accuracy of our local approximations. Section 9 concludes.


Related Literature. This paper is related to three literatures: the literature on the gains
from trade, the literature on production networks, and the literature on growth account-
ing. We discuss each literature in turn starting with the one on the gains (or losses) from
trade. Our results generalize some of the results in Arkolakis et al. (2012) and Costinot and
Rodriguez-Clare (2014) to environments with non-linear input-output connections. Our


                                             4
framework generalizes the input-output models emphasized in Caliendo and Parro (2015),
Caliendo et al. (2017), Morrow and Trefler (2017), Fally and Sayre (2018), and Bernard et al.
(2019). In contemporaneous work, Huo et al. (2020) provide a framework for decomposing
bilateral GDP comovement into shock transmission and shock correlation using a general
equilibrium model with input-output linkages. Their analysis, which focuses on business
cycle fluctuations, highlights the role of endogenous factor supply, an issue that we abstract
from.
    Our results about the effects of trade in distorted economies also relates to Berthou
et al. (2018) and Bai et al. (2018). Our results also relate to complementary work with non-
parametric or semi-parametric models of trade like Adao et al. (2017), Lind and Ramondo
(2018), and Allen et al. (2014). Whereas they study reduced-form general equilibrium de-
mand systems, we show how to construct these general equilibrium objects from microe-
conomic primitives. The cost is that our approach requires more data, but the benefit is
that our analysis does not rely on the invertibility or stability of factor demand systems
or gravity equations, assumptions that can be easily violated in models with intermedi-
ates or wedges. Our characterization of how factor shares and prices respond to shocks
is related to a large literature, for example, Trefler and Zhu (2010), Davis and Weinstein
(2008), Feenstra and Sasahara (2017), Dix-Carneiro (2014), Galle et al. (2017), among oth-
ers. Finally, our computational approach, which, instead of solving a nonlinear system of
equations, numerically integrates derivatives, is similar to the way computational general
equilibrium (CGE) models are solved (for a survey, see Dixon et al., 2013).
    The literature on production networks has primarily been concerned with the prop-
agation of shocks in closed economies, typically assuming a representative agent. For
instance, Long and Plosser (1983), Acemoglu et al. (2012), Atalay (2017), Carvalho et al.
(2016), Baqaee and Farhi (2017a,b), and Baqaee (2018), among others. A recent focus of the
literature, particularly in the context of open economies, has been to model the formation
of links, for example Chaney (2014), Lim (2017), Tintelnot et al. (2018), and Kikkawa et al.
(2018). Our approach, which builds on the results in Baqaee and Farhi (2017a,b), is differ-
ent: rather than modelling the formation of links as a binary decision, we use a Walrasian
environment where the presence and strength of links is determined by cost minimization
subject to some production technology.
    Finally, our growth accounting results are related to closed-economy results like Solow
(1957), Hulten (1978), as well as to the literature extending growth-accounting to open
economies, including Kehoe and Ruhl (2008) and Burstein and Cravino (2015). Perhaps
closest to us are Diewert and Morrison (1985) and Kohli (2004) who introduce output in-
dices which account for terms-of-trade changes. Our real income and welfare-accounting


                                              5
measures share their goal, though our decomposition into pure productivity changes and
reallocation effects is different. In explicitly accounting for the existence of intermediate
inputs, our approach also speaks to how one can circumvent the double-counting problem
and spill-overs arising from differences in gross and value-added trade, issues studied by
Johnson and Noguera (2012) and Koopman et al. (2014). Relative to these other papers, our
approach has the added bonus of easily being able to handle inefficiencies and wedges.
   Our approach is general, and relies on duality, along the lines of Dixit and Norman
(1980). We differ from the classic analysis, however, in that, in extending Hulten's theorem
to open economies, we state our comparative static results in terms of observable suffi-
cient statistics: expenditure shares, changes in expenditure shares, the input-output table,
and elasticities of substitution. Our approach relies heavily on the notion of the allocation
matrix, which helps give a physical interpretation to the theorems, and is convenient for
analyzing inefficient economies. In inefficient economies, the abstract approach that relies
on macro-level envelope conditions, like Dixit and Norman (1980) and Chipman (2008),
runs into problems. However, our results and their interpretation in terms of the allocation
matrix readily extend to inefficient economies.


2     Framework
In this section, we set up the model and define the equilibrium and statistics of interest.


2.1    Model Environment
There is a set of countries C, a set of producers N producing different goods, and a set of
factors F. Each producer and each factor is assigned to be within the borders of one of
the countries in C. The sets of producers and factors inside country c are Nc and Fc . The
set Fc of factors physically located in country c may be owned by any household, and not
necessarily the households in country c. To streamline the exposition, we assume that there
is a representative agent in each country.2

Distortions. Since tax-like wedges can implement any feasible allocation of resources in
our model, including inefficient allocations, we use wedges to represent distortions in the
model. These tax wedges may be explicit, like tariffs, or they may be implicit, like markups
or financial frictions. For ease of notation, to represent a wedge on i's purchases of inputs
from k, we introduce a fictitious middleman k that buys from k and sells to i at a "markup"
   2 See Appendix M for a discussion of how to extend the results to models with heterogeneous households

within countries.

                                                   6
µk . The revenues collected by these markups/wedges are rebated back to the households
in a way we specify below.3


Factors. Income is earned by primary factors and revenues generated by the wedges. A
primary factor is simply a non-produced (endowment) good, and earns Ricardian rents.4
To model revenues earned by wedges, for each country c  C, we introduce a "fictitious"
factor that collects the markup/wedge revenue accruing to residents of country c. We
denote the set of true primary factors by F and the set of true and fictitious factors by F  .
The C × ( N + F ) matrix  is the ownership matrix, where ci is the share of i's value-added
(sales minus costs) that goes to households in country c.


Households.       The representative household in country c has homothetic preferences5

                                           Wc = Wc ({cci }i N ),

and faces a budget constraint given by

                        pi cci =  c f w f L f +  ci (1 - 1/µi ) pi yi + Tc ,
                      i N           f F               i N


where cci is the quantity of the good i consumed by household c, w f and L f is the wage
and quantity of factor f , pi is the price and yi is the quantity of good i, and Tc is an ex-
ogenous lump-sum transfer. The right-hand side is country c's income: the first summand
is income earned by primary factors, the second summand is income earned from wedges
("fictitious" factors), and the final summand is net transfers.
   3 These  fictitious middlemen are convenient for writing compact formulas, but adding them to the model
explicitly is computationally inefficient. In the computational appendix, Appendix K, we discuss these issues
in more detail.
   4 That is, we assume factors are inelastically supplied. In Appendix L, we discuss how to endogenize

factor supply by using a Roy model and discuss the connection of our results with those in Galle et al. (2017).
   5 In mapping our model to data, we interpret domestic "households" as any agent which consumes re-

sources without producing resources to be used by other agents. Specifically, this means that we include
domestic investment and government expenditures in our definition of "households".




                                                      7
Producers. Good i  N belongs to some country c  C and is produced using a constant-
returns-to-scale production function6,7

                                    yi = Ai Fi { xik }k N , li f    f  Fc
                                                                            ,

where yi is the total quantity of good i produced, xik is intermediate inputs from k, li f is
factor inputs from f , and Ai is an exogenous Hicks-neutral productivity shifter. Producer
i chooses inputs to minimize costs and sets prices equal to marginal cost times a wedge
pi = µi × mci .


Iceberg Trade Costs. We capture changes in iceberg trade costs as Hicks-neutral produc-
tivity changes to specialized importers or exporters whose production functions represent
the trading technology. The decision of where trading technologies should be located is
ambiguous since they generate no income. It is possible to place them in the exporting
country or in the importing country, and this would make no difference in terms of the
welfare of agents or the allocation of resources.8


Equilibrium. Given productivities Ai , wedges µi , and a vector of transfers satisfying
cC Tc = 0, a general equilibrium is a set of prices pi , intermediate input choices xij ,
factor input choices li f , outputs yi , and consumption choices cci , such that: (i) each pro-
ducer chooses inputs to minimize costs taking prices as given; (ii) the price of each good
is equal to the wedge on that good times its marginal cost; (iii) each household maximizes
utility subject to its budget constraint taking prices as given; and, (iv) the markets for all
goods and factors clear so that yi = cC cci +  j N x ji for all i  N and L f =  j N l j f for
all f  F.


2.2    Definitions and Notation
In this subsection, we define the statistics of interest and introduce useful notation.
   6 This   is more general than it might appear. First, production has constant returns to scale without loss
of generality, because non-constant-returns can be captured via fixed factors. Second, the assumption that
each producer produces only one output good is also without loss of generality. A multi-output production
function is a single output production function where all but one of the outputs enter as negative inputs.
Finally, productivity shifters are Hicks-neutral without loss of generality. To represent input-augmenting
technical change for i's use of input k, introduce a fictitious producer buying from k and selling to i, and hit
this fictitious producer with a Hicks-neutral shock.
   7 We rule out fixed costs in our analysis. Our results accommodate an extensive margin of product entry-

exit, but only if it operates according to a choke-price, rather than a fixed cost. For an analysis of general
equilibrium models with fixed costs see Baqaee and Farhi (2020).
   8 We do not need to take a precise stand at this stage, but we note that this will matter for our conclusions

regarding country-level real GDP changes (as pointed out by Burstein and Cravino, 2015).


                                                       8
Nominal Output and Expenditure. Nominal output or Gross Domestic Product (GDP)
for country c is the total final value of the goods produced in the country. It coincides with
the total income earned by the factors located in the country:

                       GDPc =       pi qci =            wf Lf +           (1 - 1/µi ) pi yi ,
                                   i N          f  Fc             i  Nc


where qci = yi 1{i Nc } -  j Nc x ji is the "final" or net quantity of good i  N produced by
country c. Note that qci is negative for imported intermediate goods.
   Nominal Gross National Expenditure (GNE) for country c, also known as domestic
absorption, is the total final expenditures of the residents of the country. In our model, it
coincides with nominal Gross National Income (GNI) which is the total income earned by
the factors owned by a country's residents adjusted for international transfers:

                GNEc =       pi cci =  c f w f L f +  ci (1 - 1/µi ) pi yi + Tc .
                            i N          f F                  i N


   To denote variables for the world, we drop the country-level subscripts. Nominal GDP
and nominal GNE are not the same at the country level, but they are the same at the world
level:
          GDP = GNE =  w f L f +  (1 - 1/µi ) pi yi =  pi qi =  pi ci ,
                                   f F          f N                             i N             i N

where, for the world, final consumption coincides with net output ci = qi because ci =
cC cci = cC qci = qi , net transfers are zero T = 0 because T = cC Tc . Let world GDP
be the numeraire, so that GDP = GNE = 1. All prices and transfers are expressed in units
of this numeraire.


Real Output and Expenditure. To convert nominal variables into real variables, as in the
data, we use Divisia indices throughout. The change in real GDP of country c and the
corresponding GDP deflator are defined to be

                   d log Yc =      Yc ,i d log qci ,        d log PYc =       Yc ,i d log pi ,
                                  i N                                       i N

where Yc ,i = pi qci / GDPc is good i's share in final output of country c.9
   9 Our definition of real GDP coincides with the double-deflation approach to measuring real GDP, where

the change in real GDP is defined to be the sum of changes in real value-added for domestic producers. We
also slightly abuse notation since, at the initial equilibrium, qci = 0 for new goods and qci < 0 for imported
intermediates. In these cases, we define d log qci = d qci /qci .




                                                        9
    The change in real GNE of country c and the corresponding deflator are

                  d log Wc =      Wc ,i d log cci ,         d log PWc =    Wc ,i d log pi ,
                                 i N                                      i N

where Wc ,i = pi cci / GNEc is good i's share in country c's consumption basket. By Shep-
hard's lemma, changes in real GNE are equal to changes in welfare for every country .
    As with the nominal variables, real GDP and real GNE are not the same at the country
level. However, these differences vanish at the world level so that, for the world, d log Y =
d log W and d log PY = d log PW .10 Conveniently, changes in country real GDP and real
GNE aggregate up to their world counterparts.11
    Finally, infinitesimal changes in real GDP and real GNE can be integrated or chained
into discrete changes by updating the corresponding shares along the integration path. We
denote the corresponding discrete changes by  log Y ,  log Yc ,  log W , and  log Wc . In
the case of GDP, this is how these objects are typically measured in the data, and in the case
of GNE, this coincides with the nonlinear change in the welfare of each agent c.


Input-Output Matrices. The Heterogenous-Agent Input-Output (HAIO) matrix is the
(C + N + F ) × (C + N + F ) matrix  whose ijth element is equal to i's expenditures on
inputs from j as a share of its total revenues/income

                                            p j xij             p j cij
                                    ij =            1{ i  N } +         1 .
                                            pi yi               GNEi {iC}

The HAIO matrix  includes the factors of production and the households, where factors
consume no resources (zero rows), while households produce no resources (zero columns).
The Leontief inverse matrix is

                                   = ( I -  ) -1 = I +  +  2 + . . . .

Whereas the input-output matrix  records the direct link from one agent or producer
to another, the Leontief inverse matrix  records instead the direct and indirect exposures
through the production network.
    Denote the diagonal matrix of wedges by µ (where non-taxed quantities have wedge
  10 Real GDP and real GNE for the world are defined by aggregating across all countries, so d log Y =
i N ( pi qi / GDP) d log qi , d log PY = i N ( pi qi / GDP) d log pi , d log W = i N ( pi ci / GNE) d log ci , and
d log PW = i N ( pi ci / GNE) d log pi ,.
   11 Namely, d log Y =
                         cC ( GDPc / GDP) d log Yc and d log W = cC ( GNEc / GNE) d log Wc .




                                                       10
µi = 1) and define the cost-based HAIO matrix and Leontief inverse to be

                                   ~ = µ ,           ~ = (I - ~ ) -1 .


   It will sometimes be convenient to treat goods and factors together and index them by
k  N + F where the plus symbol denotes the union of sets. To this effect, we slightly
extend our definitions. We interchangeably write yk and pk for the quantity Lk and wage
wk of factor k  F.


Exposures. Each i  C + N + F is exposed to each j  C + N + F through revenues ij and
through costs ~ ij . Intuitively, ij measures how expenditures on i affect the sales of j (due
to backward linkages), whereas      ~ ij measures how the price of j affects the marginal cost of
i (due to forward linkages). In the absence of wedges, µi = 1 for every i, these two objects
coincide.
    When i is a household, we use special notation to denote backward and forward exposure.
In particular, let

                    W
                    k =  c,k =
                     c
                                       c,i ik ,          ~ Wc = 
                                                           k
                                                                ~ c,k =    ~ c ,i 
                                                                                  ~ ik .
                                     i N                                  i N

In words, c's exposure to k is the expenditure share weighted average of the exposure of
c's suppliers to k. By analogy, the forward and backward exposure of country c's GDP (as
opposed to welfare) is defined as

                           Yc
                           k =        Yc ,i ik ,         ~ Yc =
                                                           k       Yc ,i ~ ik ,               (2)
                                    i N                           i N

where recall that Yc ,i = pi qci / GDPc is the share of a good i in GDP. As usual, the world-
level backward and forward exposure to k are denoted by suppressing the country sub-
script: that is, Y      ~Y
                  k and k respectively.
    We sometimes denote exposure to factors with capital  or       ~ to distinguish them from
non-factor producers  or       ~ . In other words, when f  F  , we write Yc = Yc , Wc =
                                                                              f      f   f
  Wc ~ Wc     ~ Wc ~ Wc   ~ Wc
 ,  =  ,  =  to emphasize that f is a factor.
 f     f      f     f      f


Sales and Income. Exposures of GDP to a good or factor k at the country and world levels
have a direct connection to the sales of k:

                                                    pk yk               pk yk
                               Yc
                               k = 1{k  Nc + Fc }         ,       k =         .               (3)
                                                    GDPc                GDP


                                                    11
Hence, the exposure of world GDP Y      k to k is just the sales share (or Domar weight) of k in
world output k = pk yk / GDP. Similarly, the exposure of country c's GDP to k is the local
Domar weight of k in country c, that is Y  c
                                          k = 1{k  Nc + Fc } ( GDP / GDPc ) k .
    We also define factor income shares: the share of a factor f in the income of country c and
of the world are denoted
                                      c f w f L f            wf Lf
                               c  f =             , f =            .
                                        GNEc                 GNE
Since world GNE is equal to world GDP, it follows from (2) and (3) that  f = Y
                                                                             f =
 i  N  Y ,i  i f .


3       Comparative Statics: Ex-Post Sufficient Statistics
In this section, we characterize the response of real GDP and welfare to shocks. We state our
results in terms of changes in endogenous, but observable, sufficient statistics. In the next
section, we solve for changes in these endogenous variables in terms of microeconomic
primitives.

Allocation Matrix. To better understand the intuition for the results, we introduce the
allocation matrix, which helps give a physical interpretation to the theorems. Following
Baqaee and Farhi (2017b), define the (C + N + F ) × (C + N + F ) allocation matrix X as
follows: Xij = xij /y j is the share of good j used by i, where i and j index households, fac-
tors, and producers. Every feasible allocation is defined by a feasible allocation matrix X , a
vector of productivities A, and a vector of factor supplies L. In particular, the equilibrium
allocation gives rise to an allocation matrix X ( A, L, µ, T ) which, together with A, and L,
completely describes the equilibrium.12
    We decompose changes in any quantity X into changes due to the technological en-
vironment, for a given allocation matrix, and changes in the allocation matrix, for given
technology. In vector notation:

                                   log X            log X            log X
                    d log X =            d log A +        d log L +        dX .
                                   log A            log L            X
                                                 technology                    reallocation


Real GDP. The response of real GDP to shocks, stated in terms of country c variables, is
given by the following.
    12 Since
          there may be multiplicity of equilibria, technically, X ( A, L, µ, T ) is a correspondence. In this case,
we restrict attention to perturbations of isolated equilibria. As shown by Debreu (1970), we can generically
expect equilibria to be locally isolated.


                                                        12
Theorem 1 (Real GDP). The change in real GDP of country c in response to productivity shocks,
factor supply shocks, transfer shocks, and shocks to wedges is:



  d log Yc =            ~ Yc d log Ai +
                          i                       ~ Yc d log L f +
                                                    f                               ~ Yc - Yc d log(qci )
                                                                                      i    i
                i  Nc                     f  Fc                       i  N - Nc

                                                             technology
                                                    F
                    -            ~ Yc d log µi -
                                   i                       ~ Yc d log Yc +
                                                             f        f                       Y
                                                                                              i - i
                                                                                               c  ~ Yc d log Yc , (4)
                                                                                                             i
                         i  Nc                     f  Fc                          i  N - Nc

                                                                  reallocation


where, for imported intermediates i  N - Nc , the term Yi = i  Nc Yc ,i ik = - pi qci / GDPc is
                                                         c


expenditure on imported intermediate i as a share of GDP and ~ Yc = i N Y ,i    ~ ik . The change
                                                               i         c    c

in world real GDP d log Y can be obtained by simply suppressing the country index c. That is,

                                                                                                  F
      d log Y =            ~ Y d log Ai +
                             i                      ~ Y d log L f -
                                                      f                         ~ Y d log µi -
                                                                                  i
                                                                                                 ~ Y d log Y .
                                                                                                   f       f
                    i N                      f F                          i N                    f F

                                       technology                                          reallocation


    To understand equation (4), first consider the case where there are no wedges in the ini-
tial equilibrium. Then forward and backward exposures are the same         ~ Yc = Yc . Further-
                                                                             i     i
more, since revenues generated by wedges exactly offset the reduction in primary factor
income shares i Nc   ~ Yc d log µi = -  F Yc d log Yc = -  F           ~ Yc d log Yc , Theorem
                       i                 f  Fc f        f        f  Fc   f        f
1 simplifies to
                        d log Yc =  Y   i d log Ai +   f d log L f .
                                           c               Yc

                                            i  Nc                         f  Fc

That is, when there are no initial (domestic) wedges, country c's real GDP is equal to a
Domar-weighted sum of domestic productivity shocks and domestic factor endowments. In
this case, changes in the allocation matrix have no effect on real GDP.13 Intuitively, when
there are no domestic wedges, there is an envelope theorem for real GDP (the competi-
tive equilibrium maximizes the joint profits of all domestic firms for given prices). Hence,
without wedges, reallocations cannot affect real GDP to a first-order. Furthermore, in the
absence of wedges, foreign shocks, like shocks to iceberg costs outside c's borders, have no
effect on real GDP.
    Now, suppose there are pre-existing wedges. There are two major changes. First, on
the first line of equation (4), there are "mechanical" technology effects (holding fixed the
  13 Theorem   1 generalizes Hulten (1978), Burstein and Cravino (2015), and Baqaee and Farhi (2017b).


                                                               13
distribution of resources). As in the efficient benchmark, shocks to domestic productivity
d log Ai and domestic factor-endowments d log L f move real GDP. However, when there
are pre-existing wedges, changes in the quantity of imported intermediate inputs d log qci
also change real GDP. This happens because expenditure on imported intermediates Y              c
                                                                                               i is
not equal to the shadow value of imported intermediates         ~ Yc . Imported intermediates are
                                                                  i
netted out of GDP using expenditures Y      i
                                              c
                                                and not their shadow-values,   so, when there are
initial wedges, changes in the quantity of imported intermediates changes real GDP.14
    The second line of (4) reflects changes in the allocation of resources. When there are pre-
existing wedges, reallocation can have first-order effects on real GDP even holding fixed
microeconomic productivities, factor endowments, and the quantity of imports. These
are genuine changes in efficiency, and they occur because resources are not being used
efficiently at the initial equilibrium. The intuition for the second line of (4) is similar to that
described in Baqaee and Farhi (2017b) and Baqaee and Farhi (2019) for closed economies.


Welfare.     We now turn our attention to changes in welfare (real GNE).15

Theorem 2 (Welfare). The change in welfare of country c in response to productivity shocks, factor
supply shocks, and transfer shocks can be written as:

  d log Wc =     ~ Wc d log L f +  
                   f
                                   ~ Wc d log Ai
                                     i
                 f F                      i N

                                    technology

                         -   ~ Wc d log µi + 
                               i
                                              
                                                              c   ~ Wc d log  f + ( GNE/ GNEc ) d Tc ,
                                                              f - f
                             i N                   f F

                                                                 reallocation


where d Tc is the change in net transfers, and ~ Wc = 0 whenever f is a fictitious factor. The change
                                                 f
d log W of world real GNE is obtained by suppressing the country index c. That is,

     d log W =     ~ W d log L f +  
                     f
                                    ~ W d log Ai
                                      i                         -   ~ W d log µi -  
                                                                      i
                                                                                   
                                                                                    ~ W d log  f .
                                                                                      f
                   f F                     i N                      i N                f F

                                     technology                                  reallocation
  14 For  example, if there is a tariff on an imported intermediate i  N - Nc , then expenditure on the import
is less than its shadow-value Y          ~ Yc
                                   i < i . In this case, ceteris paribus, an increase in intermediate input usage
                                    c

d log qci = dqci /qci > 0 will boost real GDP and TFP. Therefore, even in an economy where the allocation
of resources across producers is efficient, trade shocks can alter aggregate TFP by changing the quantity of
imported intermediates. For an example, see Gopinath and Neiman (2014).
   15 Throughout the paper, if the wedges associated with a fictitious factor f are 1, then we have  =
                                                                                                             f
0 and d log  f / d log µi is not defined. In this case, elasticities can be replaced with semi-elasticities in a
straightforward way, but we omit the details for brevity.


                                                         14
    As with real GDP, changes in welfare can be broken into technological effects (hold-
ing fixed the distribution of resources) and reallocation effects (holding fixed technology).
However, unlike real GDP, reallocation effects are first-order even when there are no wedges.
This is because unlike real GDP, even in the absence of wedges, there is no envelope the-
orem for the welfare of a given country. We discuss the intuition for the technology and
reallocation effects in turn.
    The direct technology effect of a shock depends on each household's exposures to the
technology shock. Since households consume foreign goods, either directly or indirectly
through supply chains, this means that technology shocks outside of a country's borders
affect the household in that country holding fixed the allocation matrix.
    The second line in Theorem 2 captures reallocation effects. The first term is the direct
effect of wedges on consumer prices. To see the intuition for the second term on the second
line, recall that  ~ Wc =   ~ c f is the cost-based forward exposure of household c to factor f .
                     f
This captures the total reliance of household c on f , taking into account direct and indirect
exposures through supply chains. Intuitively, the reallocation effects consider, for each
factor f , how the income earned by the factor changes d log  f , and whether household c
is a net seller c      ~ Wc                             ~ Wc
                  f -  f > 0 or a net buyer  f -  f < 0 of factor f . The final term on the
                                                    c

second line is the change in net transfers.
    Once we aggregate to the level of the world, if there are no pre-existing wedges, the
reallocation effects are zero. In other words, for efficient models, reallocation effects are
zero-sum distributive changes. On the other hand, when there are pre-existing wedges, re-
allocation effects are no longer zero-sum, since they can make everyone better or worse off
by changing the efficiency of resource allocation. Appendix H contains a detailed and for-
mal discussion of the reallocation effects. Appendix H emphasizes that these reallocation
effects are not the same as changes in the terms-of-trade.


Simple Example. To see the difference between Theorems 1 and 2, consider a productiv-
ity shock d log Ai to a foreign producer i Nc . Suppose there are no wedges and all produc-
tion and utility functions are Cobb-Douglas. Since there are no wedges, Theorem 1 implies
that domestic real GDP does not respond to the foreign productivity shock d log Yc = 0.
    Now, consider the change in welfare in Theorem 2. The Cobb-Douglas assumption
implies that factor income shares do not respond to productivity shocks d log  f = 0.
Hence, there are no reallocation effects for welfare either. Nevertheless, domestic welfare
does respond to the foreign productivity shock d log Wc = W      c
                                                               i d log Ai . Intuitively, even
though there are no reallocation effects, an increase in foreign productivity increases the
overall amount of goods the world economy can produce and this increases the welfare of


                                              15
country c to the extent that the consumption basket of country c relies on i (directly and
indirectly through global supply chains).


Uses of Theorems 1 and 2. Since Theorems 1 and 2 depend on endogenous movements in
factor income shares, they cannot be used directly to make predictions. However, despite
this fact, they are useful for three reasons: (i) they provide intuition about why and how
Hulten's theorem fails to describe welfare and real GDP in open economies, (ii) they can be
used to measure and decompose changes into different sources conditional on observing the
changes in factor shares (extending growth-accounting to open and distorted economies),
and (iii) they can be combined with the results in Section 4 to perform counterfactuals.


Outline of the Rest of the Paper. In Section 4, we provide a full characterization of how
disaggregated sales shares, prices, and quantities change in terms of microeconomic prim-
itives (ex-ante sufficient statistics) to a first-order. In Section 5, we use these first-order
results to approximate the losses to society from the imposition of tariffs and other distor-
tions to a second-order. In Section 6, we use these results to study the effect on welfare of
large external shocks, for instance, the cost of moving the economy to autarky. We end the
paper with analytical and quantitative examples in Sections 7 and 8.


4     Comparative Statics: Ex-Ante Sufficient Statistics
Section 3 shows that the response of welfare and real GDP to shocks depend on changes
in ex-post sufficient statistics (like changes in factor shares). In this section we characterize
these ex-post sufficient statistics in terms of microeconomic primitives: the HAIO matrix
and elasticities of substitution in production and in consumption (ex-ante sufficient statis-
tics). The results of this section can then be combined with Theorems 1 and 2 to answer
counterfactual questions about welfare and real GDP. We focus on two types of shocks: pro-
ductivity shocks, which nest shocks to factor supply and iceberg costs, and wedge shocks,
which nest shocks to tariffs and markups.


4.1   Set Up
To clarify exposition, we specialize production and consumption functions to be nested-
CES aggregators, with an arbitrary number of nests and elasticities. This is for clarity not
tractability. Appendix A shows that it is very straightforward to generalize the rest of the
results in the paper to non-nested-CES economies.


                                               16
    Nested CES economies can be written in many different equivalent ways. We adopt a
standardized representation, which we call the standard-form representation. We treat every
CES aggregator as a separate producer and rewrite the input-output matrix accordingly, so
that each producer has a single elasticity of substitution associated with it; the represen-
tative household in each country c consumes a single specialized good which, with some
abuse of notation, we also denote by c. Importantly, note that this procedure changes the
set of producers, which, with some abuse of notation we still denote by N .16 In other
words, every k  C + N has an associated cost function

                                                                                1
                                                                              1-  k
                                               µ
                                           pk = k
                                               Ak                ~ kj p1-k
                                                                       j              ,
                                                      j N + Fc


where k is the elasticity of substitution.17
  For nested-CES economies, the input-output covariance turns out to be a central object.


Input-Output Covariance. We use the following matrix notation throughout. For a ma-
trix X , we define X (i) to be its ith row and X( j) to be its jth column. We define the input-
output covariance operator to be


          Cov~ (k ) (  (i ) ,  ( j ) ) =          ~ kl li lj -               ~ kl li             ~ kl lj   .
                                           lN+F                     lN+F                  lN+F

This is the covariance between the ith and jth columns of the Leontief inverse using the
kth row of   ~ as the probability distribution. We make extensive use of the input-output
covariance operator throughout the rest of the paper.


4.2   Comparative Statics
Sales Shares and Prices. The following characterizes how prices and sales shares, includ-
ing factor income shares, respond to perturbations in an open-economy.18

Theorem 3 (Prices and Sales Shares). For a vector of perturbations to productivity d log A and
wedges d log µ, the change in the price of a good or factor i  N + F is

                     d log pi =      ~ ik (d log µk - d log Ak ) +  ~ i f d log  f .                           (5)
                                    k N                                        f F

 16 SeeBaqaee and Farhi (2017a) for a more detailed discussion of the standard-form representation.
 17 Seethe second example in Section 7 for an example of an economy written in standard-form.
 18 Theorem 3 generalizes Propositions 2 and 3 from Baqaee and Farhi (2017b) to open-economies.



                                                           17
The change in the sales share of a good or factor i  N + F is

                                        k                 
   d log i =             1{ i = k } -
                                        i
                                          ki d log µk +  k µ-
                                                             k
                                                               1
                                                                 (1 - k )Cov~ (k) ( (i ) , d log p )
               k N + F                                 k N i
                        W
                        i - i
                         c
               +              cg  g d log  g ,                                                         (6)
                g F  cC
                          i

where d log p is the ( N + F ) × 1 vector of price changes in (5). The change in wedge income
accruing to household c (represented by a fictitious factor) is

                                            ci i
                    d log c =               c
                                                  -1
                                                 µi                   -1
                                                     d log µi + (1 - µi  )d log i .                    (7)
                                        i

    Recall that for every fictitious or real factor i  F  , we interchangeably use i or i
to denote its Domar weight. This means that (6) pins down the change in primary factor
income shares and (7) pins down changes in "fictitious" factor income shares. Therefore,
substituting the vector of price changes (5) into (6) results in an F  × F  linear system
in factor income shares d log . The solution to this linear system gives the equilibrium
changes in factor shares, which can be plugged back into equations (5) and (6) to get the
change in the sales shares and prices for every (non-factor) good.
    We discuss the intuition in detail below, but at a high level, equation (5) captures forward
propagation of shocks -- shocks to suppliers change the prices of their downstream con-
sumers. On the other hand, equation (6) captures backward propagation of shocks -- shocks
to consumers change the sales of their upstream suppliers. Each term in these equations
has a clear interpretation.
    To see this intuition, start by considering the forward propagation equations (5): the
first set of summands show that a change in the price of k, caused either by wedges d log µk
or productivity d log Ak , affect the price of i via its direct and indirect exposures   ~ ik through
supply chains. The second set of summands capture how changes in factor prices, which
are measured by changes in factor income shares, also propagate through supply chains
to affect the price of i. These expressions use the cost-based HAIO matrix             ~ , instead of
the revenue-based HAIO matrix , because Shephard's lemma implies that the elasticity
of the price of i to the price of one of its inputs k is given by    ~ ik and not ik .
    For the intuition of backward propagation equations (6), we proceed term by the term.
The first term captures how an increase in the wedge d log µk reduces expenditures on
suppliers i. If µk increases, then for each dollar k earns, relatively less of it makes it to i, and
this reduces the sales of i.
    The second term captures the fact that when relative prices change d log p                 0, then

                                                       18
every producer k will substitute across its inputs in response to this change. Suppose that
k > 1, so that producer k substitutes (in expenditure shares) towards those inputs that
have become cheaper. If those inputs that became cheap are also heavily reliant on i, then
Cov  ~ (k) ( (i ) , d log p ) < 0. Hence, substitution by k towards cheaper inputs will increase
demand for i. These substitutions, which happen at the level of each producer k, must be
summed across all producers.
    The last set of summands, on the second line of (6), capture the fact that changes in fac-
tor prices change the distribution of income across households in different countries. This
affects the demand for i if the different households are differently exposed, directly and
indirectly, to i. The overall effect can be found by summing over countries c the increase
in c's share of aggregate income  g F cg  g d log  g multiplied by the relative welfare
exposure (W       i - i ) / i to i. If every household has the same consumption basket, the last
                    c


term disappears.


Quantities.        Theorem 3 can be used to characterize the response of quantities to shocks.19

Corollary 1. ( Quantities) The changes in the quantity of a good or factor i in response to a pro-
ductivity shock to i is given by:

                                       d log yi = d log i - d log pi ,

where d log  and d log p are given in Theorem 3.

    These results on the responses of prices and quantities to perturbations generalize clas-
sic results of Stolper-Samuelson and Rybczynski.


Real GDP and Welfare. Theorem 3 gives the response of factor shares to shocks as a
function of microeconomic primitives. These were left implicit in Theorem 2. Furthermore,
Theorem 3 and Corollary 1 also pin down changes in the sales and quantities of imported
intermediate inputs, which were left implicit in Theorem 1. Hence, Theorem 3 used in
conjunction with Theorems 1 and 2 characterizes the response of real GDP and welfare to
shocks as a function of microeconomic primitives, up to the first order.
    For an efficient model, without wedges, real GDP in Theorem 1 does not depend on
changes in factor shares to a first-order. In that, case, Theorem 3 gives the response of real
  19 Recall   that prices are expressed in the numeraire where GDP = GNE = 1 at the world level.




                                                      19
GDP to shocks to the second order instead:
                                                       Yc
  d log Yc                  d2 log Yc         d j                     d log  j                    d log  f
  d log A j
            = Yc
              j ,       d log A j d log Ai
                                           =
                                             d log Ai
                                                      = Y
                                                        j
                                                          c
                                                                      d log Ai
                                                                               -            Y
                                                                                            f
                                                                                              c
                                                                                                  d log Ai
                                                                                                             , (8)
                                                                                    f  Nc


where d  j / d log Ai and d log  f / d log Ai are given by Theorem 3.20 For world real GDP,
suppress the c subscript.


Non-infinitesimal Shocks. Theorem 3, which is a generalization of hat-algebra (Jones,
1965), is useful for studying small shocks and gaining intuition. For large shocks, the trade
literature instead relies on exact-hat algebra (e.g. Dekle et al., 2008; Costinot and Rodriguez-
Clare, 2014), which involves solving the non-linear system of supply and demand relation-
ships. Theorem 3 provides an alternative way to make hat-algebra exact by "chaining"
together local effects. This amounts to viewing Theorem 3 as a system of differential equa-
tions that can be solved by iterative means (e.g. Euler's method or Runge-Kutta). In our
quantitative exercises in Section 8, we find that the differential approach is ten times faster
than using state-of-the-art nonlinear solvers to perform exact hat-algebra.21 Furthermore,
the non-parametric generalization of Theorem 3 in Appendix A can be used to feed es-
timates of the elasticity of substitution directly into the differential equation to compute
global comparative statics without specifying a closed-form expression for production or
cost functions. See Appendix C for more details about global comparative statics.


Other Uses of Theorem 3. Theorem 3 can also be used to characterize other statistics
of interest. Appendix E provides the elasticity of the international factor demand system
with respect to factor prices and iceberg shocks as a linear combination of microeconomic
elasticities of substitution with weights that depend on the input-output table. Figure 4 in
Appendix E quantifies these elasticities using input-output data. This relates to insights
from Adao et al. (2017), who show that the factor demand system is sufficient for perform-
ing certain counterfactuals. As another application, Appendix F writes trade elasticities at
any level of aggregation as a linear combination of underlying microeconomic elasticities
  20 The  expression for d2 log Yc /(d log A j d log Ai ) abuses notation and must be handled with care. Techni-
cally, the change in real GDP from one allocation to another in general depends on the path taken. Hulten's
theorem guarantees that changes in real GDP are a path integral of the vector field defined by the local Domar
weights along a path of productivity changes. Hence, the expression d2 log Yc /(d log A j d log Ai ) is really the
derivative of the vector field defined by the local Domar weights. Conditional on the path taken from one
allocation to the next, it can be used to compute the second derivative of the change in GDP at any point
along that path.
   21 This type of approach is also used in the CGE literature, for example Dixon et al. (1982), to solve high-

dimensional models because exact-hat algebra is computationally impracticable for very large models.


                                                       20
of substitution with weights that depend on the input-output table.22


5      Losses from Tariffs and Other Distortions
Section 4 shows how changes in wedges affect output and welfare to a first-order. How-
ever, starting at an efficient allocation, the response of real GDP and aggregate welfare to
changes in wedges is zero to a first-order (due to the envelope theorem). Losses are not zero
to a second-order, and in this section, we characterize these losses. We show that losses are
approximately equal to a Domar-weighted sum of deadweight-loss triangles. This con-
nects our results to the large, but mostly closed-economy, literature on misallocation. As
usual, we present this result in two ways, using ex-post and ex-ante sufficient statistics.


5.1     Losses: Ex-Post Sufficient Statistics
Starting at the efficient point, consider introducing some tariffs or other distortions as
exp( log µi ). We provide approximations for small wedges  log µi around the efficient
equilibrium, log µ = 0, for both real GDP and welfare.


Losses in Real GDP.         We start by characterizing changes in real output.

Theorem 4 (Real GDP). Starting at an efficient equilibrium, up to the second order, in response to
the introduction of small tariffs or other distortions, changes in the real GDP of country c are given
by
                                             1
                                 log Yc   Y           c
                                                         log yi  log µi .
                                             2 i N i
                                                     c

Changes in world real GDP (and real GNE) are given by suppressing the country subscript.

   Hence, for both the world and for each country, the reduction in real GDP from tariffs
and other distortions is given by the sum of all the deadweight-loss triangles 1/2 log yi  log µi
weighted by their corresponding local Domar weights.23,24
    22 Appendix F.3 shows that the effect of supply chains on the trade elasticity, emphasized by Yi (2003),
are formally identical to the issues of reswitching and capital reversing identified in the Cambridge Capital
Controversy of the 1950s and 60s.
   23 Theorem 4 holds in general equilibrium, but it has a more familiar partial equilibrium counterpart (Feen-

stra, 2015). For a small open economy operating in a perfectly competitive world market, import tariffs
reduce the welfare by W  (1/2) i i  log yi  log µi , where µi is the ith gross tariff (no tariff is µi = 1),
yi is the quantity of the ith import, and i is the corresponding Domar weight (see Appendix I for details).
Theorem 4 shows that this type of intuition can be applied in general equilibrium as well.
   24 Harberger (1964) argues that an equation like the one in Theorem 4 can be used to measure welfare as

long as there are compensating transfers to keep the distribution of income across households fixed. Theorem


                                                         21
     Theorem 4 shows that we only need to track changes in those quantities which are
subject to a wedge -- if a good is untaxed, or taxed but not included in real GDP (like a tax
on imported consumption), then changes in that quantity are not directly relevant for real
GDP.
     To give some intuition for Theorem 4, we focus on the country level result for simplic-
ity. Starting at an efficient equilibrium, the introduction of tariffs or other distortions leads
to changes  log yi in the quantities of goods i  Nc in country c and to changes in the
wedges  log µi between prices and marginal costs. The price-cost margin pi  log µi mea-
sures the wedge between the marginal contribution to country real GDP and the marginal
cost to real GDP of increasing the quantity of good i by one unit. Hence, Y          i  log µi is the
                                                                                      c


marginal proportional increase in real GDP from a proportional increase in the output of
good i. Integrating from the initial efficient point to the final distorted point, we find that
(1/2)Y   i  log yi  log µi is the contribution of good i to the change in real GDP.
          c


     This formula helps explain why accounting for global value chains matters a great deal
for the quantitative effects of tariffs. Intuitively, this is because the triangles 1/2 log yi  log µi
are larger, and they are weighted more heavily i and Y             c
                                                                  i , when there are input-output
linkages.

Tariffs vs. Iceberg Trade Costs. It is instructive to compare the costs of tariffs to the costs
of an increase in iceberg costs. At the world level, in response to a change  log(1/ Ai ) in
iceberg trade costs, following equation (8), the change in real GDP or real GNE is given up
to a second-order by the sum of trapezoids rather than triangles:

                                                            1
                   log Y =  log W  -            i        1 +  log i  log(1/ Ai ).
                                                            2
                                              i N

In contrast to equivalent shocks to tariffs, shocks to iceberg trade costs have nonzero first-
order effects. This is a way to see why iceberg shocks are typically much more costly than
tariffs.

Losses in Welfare. Theorem 4 shows how real GDP responds to changes in tariffs or other
distortions. These results do not apply to welfare. At the country level, changes in tariffs
and other distortions typically lead to first-order changes (due to reallocation effects). But
even at the world level, where these effects wash out, changes in real expenditure no longer
coincide with changes in welfare, since changes in world real expenditures d log W cannot
4 shows that, in fact, a similar formula can be used for changes in real GDP, even in the absence of compen-
sating transfers. Proposition 5 shows how Harberger's formula must be altered for aggregate welfare in the
absence of compensating transfers.



                                                    22
be integrated to arrive at a well-defined social welfare function.25
    To measure world welfare, we introduce a homothetic social welfare function

                                 W BS (W1 , . . . , WC ) =    W
                                                              c log Wc ,
                                                             c


where W  c is the initial income share of country c at the efficient equilibrium. These welfare
weights are chosen so that there is no incentive to redistribute across agents at the initial
equilibrium. Starting at an efficient allocation, to a first-order approximation, the response
of world welfare to the introduction of wedges is zero because of the envelope theorem.
Therefore, we consider the reduction in world welfare from the introduction of wedges to
a second-order approximation.
    We measure the change in welfare by asking what fraction of consumption would so-
ciety be prepared to give up to avoid the imposition of the tariffs. Formally, we measure
changes in welfare by  log , where  solves the equation

                            W BS (W 1 , . . . , W C ) = W BS (W1 , . . . , WC ),

where W c and Wc are the values at the initial and final equilibrium. We use a similar
definition for country level welfare c .
    Define W c = GNEc / GNE to be country c's share of income. Then changes in country
income shares are given up to the first order by

                        log W
                            c           cg g  log g +  ci i  log µi ,
                                      g F                         i N


where the first set of summands show how c's income changes due to changes in factor
prices, and the second set of summands capture revenues earned by the wedges accruing
to c. Changes in the consumption price index of country c are given up to the first order by

                          log PWc         W
                                          i  log µi +   g  log  g ,
                                            c          Wc
                                         i N                     g F


where the first term captures changes in consumer prices due to the wedges and the second
term captures changes in consumer prices due to changes in factor prices (the log change
in the factor price is the same as the log change in the factor income share).

Proposition 5 (Welfare). Starting at an efficient equilibrium in response to the introduction of
small tariffs or other distortions:
 25 This has to do with the fact that individual household preferences across all countries are non-aggregable.



                                                     23
 (i) changes in world welfare are given up to the second order by

                            log    log Y + Cov                  log W
                                                                    c ,  log PWc ;
                                                         W



 (ii) changes in country real expenditure or welfare are given up to the first order by

                                log c   log Wc   log W
                                                     c -  log PWc .


    The change in world welfare is the sum of the change in world real expenditure (output)
and a redistributive term. The redistributive term is positive whenever the covariance
between the changes in household income shares and the changes in consumption price
deflators is positive. It captures a familiar deviation from perfect risk sharing. It would
be zero if households could engage in perfect risk sharing before the introduction of the
tariffs or other distortions. In our applications, this redistributive effect is quantitatively
small and so changes in world welfare are approximately equal to changes in world real
GDP.


5.2   Losses: Ex-Ante Sufficient Statistics
Theorem 4 and Proposition 5 express the effects of tariffs and other distortions in terms
of endogenous individual output changes. In this subsection, we provide formulas for
these individual output changes, and hence for the effects of tariffs and other distortions,
in terms of primitives: microeconomic elasticities of substitution and the HAIO matrix. To
do this, we combine Theorem 4 with Theorem 3 and Corollary 1.26

Theorem 6 (Real GDP). Around an efficient equilibrium, changes in world real GDP/GNE in
response to changes in tariffs or other distortions are given, up to the second order, by


                 1
                 2 l      log µk  log µl   j  j Cov(j) ((k) , (l) )
   log Y  -
                     N k N               j N
                          1
                          2 l     log g  log µl   j  j Cov(j) ((g) , (l) )
                      -
                              N g F             j N
                                                             1
                                                             2 l    W        W           Wc
                                                         +            c  log c  log µl ( l - l ).
                                                                 N cC

   Changes  log Yc in the real GDP of country c are similar and in Appendix N.
 26 Theorem   6 generalizes Proposition 5 from Baqaee and Farhi (2017b) to open-economies.


                                                    24
    First, all the terms scale with the square of the tariffs or other distortions  log µ. There
is therefore a sense in which misallocation increases with the tariffs and other distortions.
Second, all the terms scale with the elasticities of substitution  of the different producers.
There is therefore a sense in which elasticities of substitution magnify the costs of these
tariffs and other distortions. Third, all the terms also scale with the sales shares  of the
different producers and with the square of the Leontief inverse matrix . There is therefore
also a sense in which accounting for intermediate inputs magnifies the costs of tariffs and
other distortions. Fourth, all the terms mix the wedges, the elasticities of substitution, and
of properties of the network.
    For a given producer l  N , there are terms in  log µl on the three lines. Taken to-
gether, these terms sum up to the Harberger triangle (1/2)l  log µl  log yl correspond-
ing to good l in terms of microeconomic primitives. The three lines break it down into
three components, corresponding to three different effects responsible for the change in
the quantity  log yl of good l .
    The term - k N  log µk  j N  j  j Cov( j) ((k) , (l ) ) on the first line corresponds to
the change  log yl in the quantity of good l coming from substitutions by all producers j
in response to changes in all tariffs and other distortions  log µk , holding factor wages
constant.
    The term  g F  log  g  j N  j  j Cov( j) (( g) , (l ) ) on the second line corresponds to
the change  log yl in the quantity of good l coming from substitutions by all producers j in
response to the endogenous changes in factor wages  log w g =  log  g brought about by
all the changes in tariffs and other distortions.
                                    Wc
    The term cC W      c  log c ( l - l ) on the third line corresponds to the change  log yl
                               W

in the quantity of good l coming from redistribution across agents with different spending
patterns, in response to the endogenous changes in factor wages brought about by all the
changes in tariffs and other distortions.
    It is straightforward to combine Theorem 6 with Proposition 5 to arrive at ex-ante suffi-
cient statistics for the change in welfare.

Corollary 2 (Welfare). Starting at an efficient equilibrium, changes in world and country welfare
 log  and  log c   log Wc are given via Proposition 5, respectively up to the second order
(world) and up to the first order (country).


6    The Gains from Trade
In this section, we characterize the change in welfare caused by trade shocks, for example,
the gains relative to autarky. To reach autarky, we would have to raise iceberg trade costs

                                               25
to infinity, at which point our local approximations in Sections 3, 4, and 5 become unusable.
In this section, we study the effect of large trade shocks on domestic welfare by relying on a
dual representation of trade shocks. Formally, we show that the effects of foreign shocks on
welfare are globally equivalent to the effects of productivity shocks on real GDP in a "dual"
closed economy.27 This allows us study the gains from trade by using characterizations
of the linear and nonlinear effects of productivity shocks in closed economies provided
respectively in Hulten (1978) and Baqaee and Farhi (2017a).
    The approach in this section builds on Feenstra (1994) and Arkolakis et al. (2012). We
use changes in domestic shares, and the elasticity of substitution between domestic and
foreign varieties, to back out changes in the price of imports. We then show that changes
in the price of imports affect welfare in a way that is isomorphic to productivity shocks in
a fictitious closed economy.
    To facilitate exposition, we restrict attention to nested-CES economies where the coun-
try of interest has only one primary factor, which we call labor. We also assume that there
are no domestic wedges. We discuss how the results may be extended beyond the CES
functional form in Appendix A.28


6.1       Duality Mapping
Consider an open nested-CES economy c written in standard form. Each producer i  Nc
in the domestic economy has a unit cost-function

                                                                         1
                                                                        1-  i
                                         1
                                                  
                                                                1-  i
                                    pi =                   ij p j               ,
                                         Ai     j N + Fc


where i is the elasticity of substitution for i and Ai is a productivity shifter. Since there are
no wedges   ~ ij = ij .
   Construct a dual closed economy with the same set of producers i  Nc with CES
production functions with the same set of elasticities i and a HAIO matrix            given by
 ij = ij /ic , where ic =  j N ij is the domestic input share of i.29 The unit-cost
                                       c

  27 Our  results are related in spirit, but different, to those of Deardorff and Staiger (1988).
  28 We  also extend duality to the case with multiple domestic factors and tariffs in Appendix J. In Appendix
L, we also show that duality can even be extended to Roy models with endogenous factor supply, along the
lines of Galle et al. (2017).
   29 This means that the domestic input share of every producer must be greater than zero. If the domestic

input share of some producer i is zero, then we treat i as a foreign producer and exclude it from the domestic
economy. We can do this because if i's domestic input share is zero, then i generates no value-added for the
domestic economy.




                                                     26
function of producer i in the dual closed economy is given by

                                                                        1
                                                                       1-  i
                                     1
                                               
                                                                 - i
                                 i =
                                 p                           1
                                                          ij p
                                                               j               .
                                     i
                                     A       j Nc + Fc


In words, the closed dual economy has the same set of producers as the open economy with
the same elasticities, except the expenditure shares of each producer on foreign goods has
been set to zero, and domestic expenditures have been rescaled so they sum to one. Vari-
ables with "inverted-hats" are the closed-economy counterparts of the original variable.
The shifter A i is the productivity shifter in the closed economy, to be defined below.
   Denote the set of producers that directly use imports in their production function by
Mc  Nc . If i is an importer i  Mc , we sometimes use the notation i = i - 1 since this
corresponds to the partial equilibrium trade elasticity for producer i.


6.2    Duality Results
Denote by W  c the welfare of the dual closed economy. Since the "inverted-hat" economy is
closed, welfare is equal to real output  log W c =  log Y
                                                        c .

Theorem 7 (Exact Duality). The discrete change in welfare  log Wc of the original open economy
in response to discrete shocks to iceberg trade costs or productivities outside of country c is equal to
the discrete change in real output  log Y  c of the dual closed economy in response to discrete shocks
to productivities  log A  i = -(1/ i ) log ic .

    Recall that ic =  j Nc ij is the domestic input share of i. In words, when productivity
shocks in the closed economy are the negative log change in domestic input shares divided
by the trade elasticity, changes in welfare in the closed economy mirror changes in welfare
in the open economy. Therefore, we can leverage results from the literature on the real
GDP effects of productivity shocks in closed-economies to characterize the welfare effects
of trade shocks in open economies.

Corollary 3 (First-Order Duality). A first-order approximation to the change in welfare of the
original open economy is:

                                             c 
                               log Wc =  log Y                       i  log A
                                                                             i,
                                                            i  Mc


where, applying Hulten's theorem,  i is the sales share or Domar weight of producer i in the dual
closed economy.


                                                   27
    Conditional on the size of the associated productivity shocks  log A    , intermediate in-
puts amplify the gains from trade shocks much in the same way that they amplify produc-
tivity shocks in closed economies. This is because sales shares are greater than value-added
shares, reflecting an intermediate-input multiplier that magnifies the effect of productivity
shocks. This observation is behind the findings of Costinot and Rodriguez-Clare (2014)
that allowing for intermediate inputs significantly increases gains from trade.
    An easily-missed subtlety is that the sales shares in the closed dual economy     are not
the same as the sales shares Yc in the original open economy. To see this, imagine an
economy with a representative domestic firm . Suppose that the household spends all its
income on the domestic firm. Suppose  is part of a global value chain and its sales are much
greater than its value-added, so Y  c
                                   > 1. In this example, the closed economy sales share of
this firm is just   = 1 < Y  c
                             , and so the gains from trade in this model are identical to the
one-sector model in Arkolakis et al. (2012). This is because input-output linkages outside
of a country's borders, although they increase Domar weights, do not amplify trade shocks
given changes in observed domestic shares.
    We can also use Theorem 7, and the closed-economy results in Baqaee and Farhi (2017a),
to provide a second-order approximation of the effect of trade shocks.

Corollary 4 (Second-Order Duality). The second-derivative of welfare to trade shocks is

                  d2 log Y c        d i
                                =         =  (  k - 1)  k Cov  (k) 
                                                             
                                                                    (i ) ,  ( j) .
              d log A j d log A
                              i         j
                                  d log A  k  Nc


We can re-express the change in welfare in the original open economy as


                  c 
    log Wc =  log Y                   i  log A
                                              i + 1  (  k - 1)  k Var  (k)                     i
                                                                                      (i)  log A   .
                                                  2 k N              
                             i  Mc                      c                    i  Mc


     We start by discussing the first equation. It follows from Hulten's theorem that d log Y         c / d log A
                                                                                                                i =
 i . This immediately implies that d2 log Y
                                             c /(d log A  j d log A     i) = d  i / d log A
                                                                                           j . Hence, the
nonlinear effect depends on how Domar weights in the closed economy change. The Do-
mar weight of each i changes due to substitution. In response to a shock to j, substitution
by k changes the sales of i by (k - 1)    k Cov  (k) ( (i ) ,  ( j) ). These substitution effects must
                                                
be weighted by the size     k of each k and summed over all k. This equation has a similar
intuition, and structure, to the backward propagation equations (6) in Theorem 3.
     The second equation in the corollary indicates that the ultimate impact of the shock
depends on how heterogeneously exposed each producer k is to the average productivity
                                                                      (k) i  Mc (i )  log Ai , and on
shock via its different inputs as captured by the term Var                                    


                                                   28
whether these different inputs are complements (k < 1), substitutes (k > 1) or neither
(k = 1). It indicates that complementarities lead to negative second-order terms which
amplify negative shocks and mitigate positive shocks. Conversely, substitutabilities lead to
positive second-order terms which mitigate negative shocks and amplify positive shocks.
Of course, there are no second-order terms in the Cobb-Douglas case.


Duality with an Industry Structure. To discuss these results further, we focus on economies
with an industry structure: producers are grouped into industries and the goods produced
in any given industry are aggregated with a CES production function; and all other agents
only use aggregated industry goods. In this case, all domestic producers in a given in-
dustry are uniformly exposed to any other given domestic producer. This implies that in
Corollary 4, only the elasticities of substitution across industries receive non-zero weights.
The elasticities of substitution across producers within industries receive a zero weight,
and they only matter via their influence on the productivity shocks through the trade elas-
ticities.
    In fact, the matrix   of the dual closed economy can be specified entirely at the industry
level where the different producers are the different industries   Nc . Given the produc-
tivity shocks  log A     to the importing industries   Mc , Theorem 7 and Corollaries 3 and
4 can then be applied at the industry level, with this industry level input-output matrix,
and with only elasticities of substitution across industries.
    Many cases considered in the literature have such an industry structure, and impose the
additional assumption that all the elasticities of substitution across industries (and with the
factor) in production and in consumption are unitary (but those within industries are above
unity). This makes the dual closed economy Cobb-Douglas. Such assumptions are made
for example by Arkolakis et al. (2012), Costinot and Rodriguez-Clare (2014), and Caliendo
and Parro (2015). In this Cobb-Douglas case, the dual closed economy is exactly log-linear
in the dual productivity shocks  log A      . The effects of shocks to iceberg trade costs or to
productivities outside of the country then coincide with the first-order effects of the dual
shocks given by Corollary 3. Their second-order effects given by Corollary 4 are zero, and
the same goes for their higher-order effects.
    Our results therefore generalize some of the insights of Arkolakis et al. (2012) and of
Costinot and Rodriguez-Clare (2014) to models with input-output linkages and where elas-
ticities of substitution across industries (and with the factor) are not unitary.30 In such mod-
  30 Costinot and Rodriguez-Clare (2014) show that the gains from trade are higher in multi-sector economies

without input-output linkages when sectors are complements in consumption. Corollary 5 generalizes these
results to economies with input-output linkages. This matters quantitatively given that most empirical evi-
dence points to the presence of much more important complementarities in production than in consumption.



                                                    29
els, the dual closed economy is no longer Cobb-Douglas. Deviations from Cobb Douglas
generate nonlinearities, which can either mitigate or amplify the effects of the shocks de-
pending on whether there are complementarities or substituabilities, and with an intensity
which depends on how heterogeneously exposed the different producers are to the shocks.

Corollary 5 (Exact Duality and Nonlinearities with an Industry Structure). For country c
with an industry structure, we have the following exact characterization of the nonlinearities in
welfare changes of the original open economy.

    (i) (Industry Elasticities) Consider two economies with the same initial input-output matrix and
        industry structure, the same trade elasticities and changes in domestic input shares, but with
        lower elasticities across industries for one than for the other so that    for all industries
         . Then  log Wc =  log Y     c   log Wc =  log Y        c so that negative (positive) shocks have
        larger negative (smaller positive) welfare effects in the economy with the lower elasticities.

 (ii) (Curvature) Suppose that all the elasticities of substitution  across industries are less than
      (greater than) unity, then  log Wc =  log Y    c is concave (convex) in  log A.
                                                                                     So nonlinear-
      ities amplify (mitigate) negative shocks and mitigate (amplify) positive shocks compared to a
      loglinear approximation.

   Since elasticities of substitution across industries are likely below one, Corollary 5 sug-
gests that accounting for nonlinearities will amplify the gains relative to autarky, but miti-
gate the gains from opening up further (for fixed changes in import shares).


7      Analytical Examples
In this section, we consider some simple examples to hone intuition and illustrate the sorts
of questions our results can be used to answer. For each example, the section with the
relevant propositions is listed in parenthesis.


Two Countries with Arbitrary IO Linkages (Section 4). This example uses the forward
and backward propagation equations in Theorem 3 to linearize a model with arbitrary
input-output relationships and two single-factor countries.
   Consider a two-country economy (home and foreign), with each country owning one
primary factor. Hence, C = F = 2. Denote foreign variables by an asterisk and let L index
Furthermore, even if the production and consumption elasticities were the same, Corollary 4 shows that
given the size of the trade shocks  log A i , the nonlinear effects of non-unitary elasticities k - 1 scale with
the size of the Leontief inverse and the Domar weights. Therefore, even if the elasticities are identical in
consumption and production, input-output linkages amplify the gains from trade.


                                                      30
the home factor and L the foreign factor. Assume that there are no wedges, and consider
a productivity shock d log A j to producer j. Applying Theorem 3, the change in the home
factor's share of income is
                                                                            ( L)
            d log  L                    k (k - 1)k Cov(k) ( j) ,            L
                      =                                              ( L)
                                                                                      .     (9)
            d log A j          L                                                  W
                        1+   (1-  L )   k (k - 1)k Var(k)            L      - W
                                                                              L - L


The numerator captures the fact that a shock to j directs demand towards the home fac-
tor L if inputs are substitutes k > 1 and exposure to j and L are positively correlated
Cov(k) (( j) , ( L) ) > 0 (this is reversed if inputs are complements). In this case, as k sub-
stitutes to use inputs most heavily exposed to j, it boosts demand for the home factor L.
    The denominator captures the general equilibrium effects of changes in factor prices.
An increase in the price of L triggers its own substitution effects and redistributes income
between home and foreign. The terms in the denominator reflect these two effects. If
inputs are substitutes k > 1 and k is heterogeneously exposed Var(k) (( L) ) > 0 to L, then
an increase in the price of L will cause k to substitute away from L and this mitigates the
partial equilibrium effect in the numerator. The final term in brackets in the denominator
accounts for the fact that an increase in the income share of L raises the income share of the
domestic consumer and lowers the income share of the foreign consumer. If the domestic
                                                                        W
consumer is more heavily exposed to the domestic factor W       L >  L , then this amplifies
the partial equilibrium effect in the numerator.
    Since the factor shares must sum to one, we know that d L = -d L . This gives us
closed-form equations for changes in both factor shares. Hence, Theorem 3 can be used to
obtain closed-form expressions for changes in the sales share and the price of every other
producer in the economy.


Dutch Disease in a Cobb-Douglas Model (Section 4). To make the previous example
more concrete, we apply Equation (9) to a Cobb-Douglas economy, and use it to character-
ize conditions under which the home economy experiences Dutch disease. The example
below also shows how to map a specific nested-CES model into standard-form required by
Theorem 3.
    Suppose there are n industries at home and foreign. The utility function of home and
foreign consumers is

                                  n                            n
                                                                    0i
                          W=     ( x 0 i )  0i ,        W =    ( x0 i) ,
                                i =1                          i =1




                                                   31
                are home and foreign consumption of goods from industry i. The pro-
where x0i and x0 i
duction function of industry i (at home or foreign) is a Cobb-Douglas aggregate of inter-
mediates and the local factor
                                                          n
                                                               ij
                                         yi = Lij iL  xij .
                                                      i =1

Suppose that the intermediate good xij is a CES combination of domestic and foreign va-
rieties of j, with initial home share  j and foreign share     j = 1 -  j , and elasticity of
substitution  j + 1. Since the market share of home and foreign in industry j does not vary
by consumer i, this means there is no home-bias.
    In standard-form, this economy has N = 3n producers: the first n are industries at
home, the second n are industries in foreign, and the last n are CES aggregates of domestic
and foreign varieties that every other industry buys. The HAIO matrix for this economy,
in standard-form, is (2 + 3n + 2) × (2 + 3n + 2):
                                                                     n                                 
                0        0                 0                   0i               0           0
                                                                     i =1                              
                                                                     n
                                                               0i
                                                                                                       
                0        0                 0                                    0           0          
         
                                                                     i =1                              
                                                                                                       
                                                                    n               n                  
                0        0                 0                  ij               iL           0          
                                                                    i , j =1        i =1
                                                                                                       
                                                                                                       
                                                                    n                           n
                                                                                                       
        =       0        0                 0                  ij                0          iL
                                                                                                       
                                                                                                       .
                                                                    i , j =1                    i =1   
                                                                                                       
                    1               1
                                                                                                       
         
                        ···    0          ···    0                                                     
                                                                                                       
         
                0       ..                ..                    0               0           0
                                                                                                       
         
                           .                 .                                                         
                                                                                                       
                    0          n     0           
                                                                                                       
         
                                                 n                                                     
                                                                                                       
                0        0                 0                    0               0           0

 The first two rows and columns correspond to the households, the next 2n rows and
columns correspond to home industries and foreign industries respectively. The next n
rows and columns correspond to bundles of home and foreign varieties. The last two rows
and columns correspond to the home and foreign factor. The vector elasticities of substitu-
tion  for this economy is a vector with 2 + 3n elements  = (1, · · · , 1,  1 + 1, · · · ,  n + 1),
where  i is the trade elasticity in industry i.
    Using Equation (9), the change in home's share of income following a productivity
shock d log A j to some domestic producer j is

                             d log  L    j        j    j  jL
                                       =                         0,
                             d log A j    L 1 + i  i i iL iL 
                                                      L 1-  L i

which is positive as long as domestic and foreign varieties are substitutes  j > 0. The
numerator captures the fact that a shock to j will increase demand for the home factor if j


                                                     32
uses the home factor  jL > 0. The denominator captures the fact that an increase in the
price of the home factor attenuates the increase in demand for the home factor by bidding
up the price of home goods.
    The positive productivity shock to j will therefore shrink the market share of every other
domestic producer, a phenomenon known as Dutch disease. To see this, apply Theorem 3
to some domestic producer i j to get

                            d log i             iL d log  L
                                      = - i i                  < 0.
                            d log A j         1 -  L d log A j

In words, the shock to j boosts the price of the home factor, which makes i less competitive
in the world market if i relies on the home factor iL > 0. Of course, (9) can easily be
used to write down the necessary and sufficient conditions for Dutch disease for the more
general model as well.


Incidence of Tariffs with Global Value Chain (Section 4). Theorem 3 can also be used
to compute the incidence of tariffs on different factors in the presence of input-output link-
ages. For example, consider the simple economy depicted in Figure 1. Country 1 is the
home country and country 2 represents the rest of the world. The home country has two
factors: L1 representing manufacturing labor and L3 representing services labor. Manufac-
turing labor participates in a global value-chain with the rest of the world, whereas services
labor sells domestically only.
    The rest of the world is kept simple, and foreign factors can either be used as part of
the value-chain with home or they can be used directly to supply foreign consumers. To
simplify the algebra, we make the stark assumption that the foreign market is perfectly
competitive -- that is, the elasticity of substitution for foreign consumers  H2 = .


                       L3             L1              L2


                       H1             y1              y2              H2


Figure 1: Solid lines show flow of goods. Green, purple, and white nodes are factors,
households, and goods. Boundaries of countries are represented by dashed boxes.

    Now, suppose that country 1 introduces a tariff d log µ on foreign imports in an attempt
to shield manufacturing workers from foreign competition. We can use Theorem 3 to cal-
culate the change in the real wages of both types of workers. In this example, the policy

                                              33
backfires, since the real wage of manufacturing workers is

                            d log  L1   d log p H1     
                          lim         -            =-    < 0,
                         H2  d log µ     d log µ      1-

where  is the intermediate input share of y1 . The losses increase in the intermediate
input share. Intuitively, the tariff raises the marginal cost of y1 . Since the foreign market is
perfectly competitive  H2 = , the price of the y1 falls by exactly enough to offset the tariff.
This comes about via a reduction in manufacturing workers's wages. Service workers are
unaffected by the tariff lim H  d log  L3 - d log p H1 = 0. Welfare overall for the home
                                2
country does not change d log WH2 = 0, because the reduction in the real wages of the
manufacturing workers are precisely cancelled out by the real revenue raised by the tariffs.


Trade War with Global Value Chain (Section 5). To see how input-output connections
can amplify the losses from protectionism, consider the example depicted in Figure 2. As-
sume the two countries are symmetric, let  be imports as a share of sales, and  be the
elasticity of substitution between intermediates and labor.


                                      L1               L2


                       H1             y1                y2            H2


Figure 2: Solid lines show flow of goods. Green, purple, and white nodes are factors,
households, and goods. Boundaries of countries are represented by dashed boxes.

    Suppose that each country introduces a symmetric tax  log µ on its imports from the
other country. By symmetry, changes in country real output, country welfare, world real
output, and world welfare are all the same. Hence, using Theorem 4 and Theorem 6, up to
a second order approximation, the reduction in real GDP and welfare are

                  1                                                
 log W =  log Y  - (12  log y12  log µ + 21  log y21  log µ)             ( log µ)2 ,
                  2                                            2(1 -  )2

where yij is the quantity of imports from country j by country i, ij is the corresponding
sales share. By symmetry y12 = y21 and 12 = 21 .
    The losses increase with the elasticity of substitution  and with the intermediate input
share . This is both because the relevant sales shares 12 = 21 = /[2(1 - )] and the
reductions in the quantities of imports - log y12 = - log y21 = [ /(1 - )] log µ are

                                               34
increasing in  and . The latter effect occurs because when  is higher, goods effectively
cross borders more times, and hence get hit by the tariffs more times, which increases the
relative price of imports more and leads to a larger reduction in their quantity.


The Gains from Trade with Critical Inputs (Section 6). The last example uses the duality
results in Section 6 to give some intuition for how nonlinearities in the domestic production
network affect the gains from trade. In particular, how complementarities in the domestic
economy amplify the losses from moving towards autarky and mitigate the gains from
further trade liberalization. In this example, we consider how the existence of a universal
intermediate input, like foreign energy, can increase the losses of moving to autarky.
    Consider country c depicted in Figure 3. The only traded good is energy E.31 The
household consumes domestic goods 1 through to N with some elasticity of substitution 0
and equal sales shares 1/ N at the initial point. Goods 1 through to M are made using labor
L and energy E with an elasticity of substitution 1 , with an initial energy share ( N / M) E.
Energy is a CES aggregate of domestic and foreign energy with elasticity of substitution
 E > 1. Domestic energy E and consumption goods M + 1 through to N are made using
only domestic labor. Assume that the elasticity of substitution in production 1 < 1, and
that production has stronger complementarities than consumption 1 < 0 .

                                  E                   L
                          1

                      1           ...         M           M+1          ...         N

                                    0
                                                      H

Figure 3: Industries substitutes across labor and energy with elasticity 1 < 1. The house-
hold substitutes with elasticity of substitution 0 > 1 . Energy is produced domestically
and sourced from foreign with an elasticity of substitution  E > 1.

   Consider an increase in iceberg trade costs that increase the cost of importing foreign
energy. The welfare effect of this trade shock is the same as that of a negative productivity
shock to the energy producer of the dual closed economy

                                                     1
                                             E = -
                                         log A          log  Ec < 0,
                                                     E

where  E =  E - 1 is the trade elasticity of the energy composite good E and  log  Ec is
 31 This   example is an open-economy version of an example in Baqaee and Farhi (2017a).


                                                     35
the change of its domestic expenditure share.
   Corollary 4 shows that, to a second order, the change in welfare is32

     log Wc          E + 1  (  k - 1) 
             E  log A                  k Var  (k)           E ,
                                                   (E)  log A
                         2 k N              
                                     c


               =        E + 1
                 E  log A      E ( 0 - 1)  E ( N - 1) + (1 - 1)(1 - N  E ) ( log A
                                                                                  E )2 .
                            2                  M                    M

     When M = N , energy becomes a universal input, and the elasticity of substitution in
                                                            (0) (  E ) = 0. This is because all
consumption 0 drops out of the expression because Var             
consumption goods are uniformly exposed to the trade shock, and so substitution by the
household is irrelevant. Since 1 < 1, nonlinearities captured by the second-order term
amplify the negative welfare effects of the trade shock. This is because complementarities
between energy and labor imply that the sales share of energy      E increases with the shock,
thereby amplifying its negative effect.
     When M < N , the elasticity of substitution in consumption 0 matters. Since 0 > 1 ,
the nonlinear adverse effect of the trade shock is reduced compared to the case M = N
when we keep the initial sales share of energy    E constant. This is true generally but the
effect is easiest to see when 0 > 1 since the household can now substitute away from
energy-intensive goods, which mitigates the increase of the sales share of energy       E , and
hence the negative welfare effects of the shock. These effects are stronger, the lower is M,
i.e. the more heterogeneous are the exposures of the different goods to energy.
     If 0 and 1 are both less than one, then Corollary 5 implies that domestic welfare is
concave in the trade shock  log A    E . Hence, for the same magnitude change in import
shares, complementarities magnify the losses from moving towards autarky and mitigate
the benefits of further integration relative to when the domestic input-output network is
Cobb-Douglas (0 = 1 = 1).


8       Quantitative Examples
In this section, we use a multi-factor production network model calibrated to match world
input-output data. We quantify the way increasing trade costs (tariffs or iceberg) affect
output, welfare, and factor rewards, and use our analytical results to give intuition for
our findings. We provide flexible Matlab code, detailed in Appendix K, that loglinearizes
arbitrary general equilibrium models of the type studied in this paper and computes local
    32 Since
          the closed dual economy in this example is acyclic, we can actually write the output function in
closed-form. See Appendix J for more details.


                                                   36
and global comparative statics.


Calibration. The benchmark model has 40 countries as well as a "rest-of-the-world" com-
posite country, each with four factors of production: high-skilled, medium-skilled, low-
skilled labor, and capital. Each country has 30 industries each of which produces a single
industry good. The model has a nested-CES structure. Each industry produces output
by combining its value-added (consisting of the four domestic factors) with intermediate
goods (consisting of the 30 goods). The elasticity of substitution across intermediates is 1 ,
between factors and intermediate inputs is 2 , across different primary factors is 3 , and
the elasticity of substitution of household consumption across industries is 0 . When a
producer or the household in country c purchases inputs from industry j, it consumes a
CES aggregate of goods from this industry sourced from various countries with elasticity
of substitution  j + 1. We use data from the World Input-Output Database (WIOD) (see
Timmer et al., 2015) to calibrate the CES share parameters to match expenditure shares in
the year 2008.33
    We use the estimates from Caliendo and Parro (2015) to calibrate the elasticities  i be-
tween traded and domestic varieties of each industry. We set the elasticity of substitution
across industries 2 = 0.2, the one between value-added and intermediates 1 = 0.5, and
the one in consumption 0 = 0.9. These elasticities are broadly consistent with the esti-
mates of Atalay (2017), Boehm et al. (2015), Herrendorf et al. (2013), and Oberfield and
Raval (2014). Finally, we set the elasticity of substitution among primary factors 3 = 0.5.
Overall, the evidence suggests that these elasticities are all less than one (sometimes signif-
icantly so). Appendix D contains additional details about how the model is mapped to the
data.

Effect of Trade Barriers. In Table 1, we report the impact on welfare for a few countries
of a universal increase in either the iceberg costs of trade or import tariffs. We compare the
nonlinear response of the benchmark economy to the loglinear approximation implied by
Theorem 2.
    Across the board, and as suggested by the discussion of trapezoids and triangles in
Section 5.1, an increase in iceberg trade costs is significantly more costly than an increase
in tariffs. For the world, a universal 10% increase in iceberg costs reduces output by 2.26%.
A similar increase in tariffs only reduces output by 0.43%. In Appendix B, we show that
abstracting from intermediate inputs reduces these estimates by a factor of two or three.
  33 Since  most tariffs in 2008 are close to zero, for simplicity, we assume that tariffs are equal to zero at
the initial equilibrium. In Appendix G, we show that recomputing the results using initial tariffs does not
meaningfully alter the results.



                                                      37
Table 1: Change in welfare, in log points, for a subset of countries in response to a universal
10%, 5%, and 1% change in trade costs, and comparison to a loglinear approximation.

                                     10% Shock                   5% Shock                1% Shock
   Universal Iceberg Shock     Nonlinear    Loglinear       Nonlinear   Loglinear   Nonlinear   Loglinear
           China                 -1.30        -1.40           -0.69       -0.72       -0.14       -0.15
        Great Britain            -2.52        -3.16           -1.42       -1.62       -0.32       -0.33
        Luxembourg              -16.86       -19.75           -9.31      -10.11       -2.02       -2.06
           Russia                -2.97        -3.00           -1.52       -1.54       -0.31       -0.31
            USA                  -1.06        -1.32           -0.60       -0.68       -0.13       -0.14
           World                 -2.26        -2.75           -1.26       -1.41       -0.28       -0.28
   Universal Tariff Shock
           China                  -0.16        0.93            0.12       0.48         0.08       0.10
        Great Britain             -0.65        -0.40          -0.29       -0.20       -0.05       -0.04
        Luxembourg                -5.37        -3.05          -2.17       -1.56       -0.33       -0.32
           Russia                 -1.59        -1.17          -0.74       -0.60       -0.13       -0.12
            USA                    0.09         0.30           0.07        0.15        0.03        0.03
           World                  -0.43       -0.85           -0.15      -0.22        -0.01      -0.01


 denotes a second order approximation following Theorem 6, because the first-order effect would be zero.


    For 1% shocks, the loglinear approximation performs very well for both iceberg shocks
and tariff shocks. The approximation performs less well as the shocks get larger. For exam-
ple, for a 10% universal increase in iceberg costs, a loglinear approximation suggests that
world output should fall by 2.75% instead of 2.26%.
    To compute the nonlinear effect of the shock, we can either solve the nonlinear sys-
tem of supply and demand relationships (i.e. exact hat algebra), or we can repeatedly
compute first-order approximations and chain the results. For exact hat algebra, we use
a state-of-the-art numerical solver (Artelys Knitro), and we provide the solver with ana-
lytical derivatives. To compute a new equilibrium, the solver takes around 12 hours on a
standard desktop. The linear approximation, on the other hand, takes around four min-
utes.34 Therefore, differential exact hat algebra, where we take the derivative 20 times and
cumulate
    Table 2the results,
            uses        is about 10 times faster
                 the chained-derivatives         than exact
                                           to decompose     hat algebra.
                                                         welfare  changes into technology and
reallocation effects following Theorem 2 due to a uniform 10% increase in all iceberg costs.
To compute the numbers in Table 2, we compute the reallocation and technology effect
locally following Theorem 2 and cumulate the results.35
   Recall that the technology effect is the direct effect of the iceberg shock on households,
holding fixed the distribution of resources. The reallocation effect measures the change in
  34 Solving the linear system described in Theorem 3 takes seconds; the four minutes are almost entirely
spent constructing the relevant matrix representation that needs to be inverted.
  35 As with all nonlinear decompositions, the order in which we decompose effects matters. For this nonlin-

ear decomposition, we simultaneously increase all iceberg costs at the same time.



                                                       38
Table 2: Decomposition of welfare changes following Theorem 2 for a 10% universal ice-
berg shock.

                                log Welfare       Technology      Reallocation
               China                    -1.30            -1.88              0.58
               Great Britain            -2.52            -2.51             -0.01
               Luxembourg              -16.86            -4.00            -12.86
               Russia                   -2.97            -2.41             -0.57
               USA                      -1.06            -1.43              0.37
               World                    -2.26            -2.25             -0.01



welfare that results from the (endogenous) redistribution of resources. These reallocation
effects are not the same as changes in the terms of trade. Instead, they are related to the
factoral terms of trade introduced by Viner (1937) (see Appendix H for more discussion).
    Naturally, small and very open economies, like Luxembourg, Belgium, Ireland, and
Taiwan are worst affected by such a shock. Partly, this reflects the fact that their domes-
tic consumers are more exposed to foreign goods, and this effect is captured by the pure
technology effect. However, for small open economies, there are also large negative reallo-
cation effects, whereas for large economies, like China or the USA, reallocation effects are
positive. Intuitively, as trade becomes more restricted, expenditures shift away from im-
ports and towards domestic factors. For small open economies, this means that the share
of income claimed by their domestic factors falls. For very small countries, these nega-
tive reallocation effects are as or more important than the direct effect of the technology
shock from exposure to traded goods. Naturally, for the world as a whole, there are no
reallocation effects.

Gains from Trade: Intermediate Inputs and Nonlinearities. Finally, we use the duality
in Theorem 7, to calculate the welfare losses from moving different countries to autarky.
For this exercise, we aggregate the factors in each country into a single representative factor.
The "dual" productivity shocks corresponding to autarky are  log A         i = -(1/ i ) log ic ,
since all domestic input shares must go to one in autarky.
    The gains from trade are in Table 3 for different values of the elasticities of substitution
(0 , 1 , 2 ). The first column replicates the results of a multi-sector model without inter-
mediate inputs and with the Cobb-Douglas assumption (0 , 1 , 2 ) = (1, 1, 1), reported
in Costinot and Rodriguez-Clare (2014).The second column replicates the results of an a
model which allows for intermediate inputs but maintains the Cobb-Douglas assumption,
also reported in Costinot and Rodriguez-Clare (2014). As expected, allowing for inter-
mediate inputs increases gains from trade. This is because of the first-order or log-linear

                                                39
                     Table 3: Gains from trade for a selection of countries.

               ( 0 , 1 , 2 )    VA (1, 1, 1)   (1, 1, 1)   (1, 0.5, 0.6) (0.9, 0.5, 0.2)
               France           9.8%              18.5%       24.7%          30.2%
               Japan            2.4%              5.2%        5.5%           5.7%
               Mexico           11.5%             16.2%       21.3%          44.5%
               USA              4.5%              9.1%        10.3%          13.0%

The first column is a multi-sector economy with no intermediates and Cobb-Douglas produc-
tion/consumption. The second column has intermediates but maintains Cobb-Douglas. The third column
has intermediates and complementarities. The final column is our benchmark calibration. The micro trade
elasticities are kept constant, so the size of the shock to each industry is the same across all columns.


effect captured by Corollary 3: it reflects the fact that abstracting away from intermediate
inputs reduces the volume of imports relative to GDP. The other columns continue to al-
low for intermediate inputs, but deviate from the Cobb-Douglas assumption, giving rise
to nonlinearities. Moving across columns towards more complementarities increases the
gains from trade. This is because of the nonlinear effect captured by Corollary 4: more
complementarities magnify gains from trade by increasing nonlinearities. Our benchmark
calibration is the one on the far right, but the second to last column shows that even with
milder complementarities, which are probably more relevant for longer-run applications,
the nonlinearities remain sizeable.
    The magnitudes of these different effects are different across countries. The importance
of accounting for intermediate inputs is largely independent of the degree of openness of
the country. By contrast, the importance of accounting for nonlinearities does depend on
the degree of openness: the more open the country, the larger are the dual productivity
shocks, and hence, the more nonlinearities matter. Overall, it seems that nonlinearities are
as important as intermediate goods to the study of gains from trade.

9    Conclusion
This paper establishes a unified framework for studying output and welfare in open and
potentially distorted economies. We provide ex-post sufficient statistics for measurement
and ex-ante sufficient statistics for conducting local and global counterfactuals. Our for-
mulas bring together results from the open and closed-economy literatures, and provide
new characterizations of the gains from trade and the losses from trade protectionism. As
discussed in the appendix, these results also have implications for the aggregation of trade
elasticities, and the distributional consequences of trade policy.



                                                   40
References
Acemoglu, D., V. M. Carvalho, A. Ozdaglar, and A. Tahbaz-Salehi (2012). The network origins of aggregate
  fluctuations. Econometrica 80(5), 1977­2016.
Adao, R., A. Costinot, and D. Donaldson (2017). Nonparametric counterfactual predictions in neoclassical
  models of international trade. American Economic Review 107(3), 633­89.
Allen, T., C. Arkolakis, and Y. Takahashi (2014). Universal gravity. NBER Working Paper (w20787).
Arkolakis, C., A. Costinot, and A. Rodriguez-Clare (2012). New trade models, same old gains? American
  Economic Review 102(1), 94­130.
Atalay, E. (2017). How important are sectoral shocks? American Economic Journal: Macroeconomics (Forthcom-
  ing).
Bai, Y., K. Jin, and D. Lu (2018). Misallocation under trade liberalization. Unpublished Working Paper, University
  of Rochester.
Baqaee, D. and E. Farhi (2019). A short note on aggregating productivity. Technical report.
Baqaee, D. and E. Farhi (2020). Entry vs. rents. Technical report, National Bureau of Economic Research.
Baqaee, D. R. (2018). Cascading failures in production networks. Econometrica (Forthcoming).
Baqaee, D. R. and E. Farhi (2017a). The macroeconomic impact of microeconomic shocks: Beyond Hulten's
  Theorem.
Baqaee, D. R. and E. Farhi (2017b). Productivity and Misallocation in General Equilibrium. NBER Working
  Papers 24007, National Bureau of Economic Research, Inc.
Bernard, A. B., E. Dhyne, G. Magerman, K. Manova, and A. Moxnes (2019). The origins of firm heterogeneity:
  A production network approach. Technical report, National Bureau of Economic Research.
Berthou, A., J. J. Chung, K. Manova, and C. S. D. Bragard (2018). Productivity,(mis) allocation and trade.
  Technical report, Mimeo.
Boehm, C., A. Flaaen, and N. Pandalai-Nayar (2015). Input linkages and the transmission of shocks: Firm-
                                    ¯
  level evidence from the 2011 tohoku      earthquake.
Burstein, A. and J. Cravino (2015). Measured aggregate gains from international trade. American Economic
  Journal: Macroeconomics 7(2), 181­218.
Caliendo, L. and F. Parro (2015). Estimates of the trade and welfare effects of nafta. The Review of Economic
  Studies 82(1), 1­44.
Caliendo, L., F. Parro, and A. Tsyvinski (2017, April). Distortions and the structure of the world economy.
  Working Paper 23332, National Bureau of Economic Research.
Carvalho, V. M., M. Nirei, Y. Saito, and A. Tahbaz-Salehi (2016). Supply chain disruptions: Evidence from the
  great east japan earthquake. Technical report.
Chaney, T. (2014). The network structure of international trade. American Economic Review 104(11), 3600­3634.
Chipman, J. S. (2008). The theory of international trade, Volume 1. Edward Elgar Publishing.
Costinot, A. and A. Rodriguez-Clare (2014). Trade theory with numbers: quantifying the consequences of
  globalization. Handbook of International Economics 4, 197.
Davis, D. R. and D. E. Weinstein (2008). The Factor Content of Trade, Chapter 5, pp. 119­145. Wiley-Blackwell.
Deardorff, A. V. and R. W. Staiger (1988). An interpretation of the factor content of trade. Journal of Interna-
  tional Economics 24(1-2), 93­107.
Debreu, G. (1970). Economies with a finite set of equilibria. Econometrica: Journal of the Econometric Society,
  387­392.
Dekle, R., J. Eaton, and S. Kortum (2008). Global rebalancing with gravity: measuring the burden of adjust-


                                                       41
   ment. IMF Staff Papers 55(3), 511­540.
Diewert, W. E. and C. J. Morrison (1985). Adjusting output and productivity indexes for changes in the terms
   of trade.
Dix-Carneiro, R. (2014). Trade liberalization and labor market dynamics. Econometrica 82(3), 825­885.
Dixit, A. and V. Norman (1980). Theory of international trade: A dual, general equilibrium approach. Cambridge
   University Press.
Dixon, P., B. Parmenter, J. Sutton, and D. Vincent (1982). ORANI, a multisectoral model of the Australian economy,
   Volume 142. North Holland.
Dixon, P. B., R. B. Koopman, and M. T. Rimmer (2013). The monash style of computable general equilibrium
   modeling: a framework for practical policy analysis. In Handbook of computable general equilibrium modeling,
   Volume 1, pp. 23­103. Elsevier.
Fally, T. and J. Sayre (2018). Commodity trade matters. Technical report, National Bureau of Economic
   Research.
Feenstra, R. C. (1994). New product varieties and the measurement of international prices. The American
   Economic Review, 157­177.
Feenstra, R. C. (2015). Advanced international trade: theory and evidence. Princeton university press.
Feenstra, R. C. and A. Sasahara (2017). The `china shock', exports and us employment: A global input-output
   analysis. Technical report, National Bureau of Economic Research.
Galle, S., A. Rodriguez-Clare, and M. Yi (2017). Slicing the pie: Quantifying the aggregate and distributional
   effects of trade. Technical report, National Bureau of Economic Research.
Gopinath, G. and B. Neiman (2014). Trade adjustment and productivity in large crises. American Economic
   Review 104(3), 793­831.
Harberger, A. C. (1964). The measurement of waste. The American Economic Review 54(3), 58­76.
Herrendorf, B., R. Rogerson, and A. Valentinyi (2013). Two perspectives on preferences and structural trans-
   formation. American Economic Review 103(7), 2752­89.
Hulten, C. R. (1973). Divisia index numbers. Econometrica: Journal of the Econometric Society, 1017­1025.
Hulten, C. R. (1978). Growth accounting with intermediate inputs. The Review of Economic Studies, 511­518.
Huo, Z., A. A. Levchenko, and N. Pandalai-Nayar (2020). International comovement in the global production
   network.
Johnson, R. C. and G. Noguera (2012). Accounting for intermediates: Production sharing and trade in value
   added. Journal of international Economics 86(2), 224­236.
Jones, R. W. (1965). The structure of simple general equilibrium models. Journal of Political Economy 73(6),
   557­572.
Kehoe, T. J. and K. J. Ruhl (2008). Are shocks to the terms of trade shocks to productivity? Review of Economic
   Dynamics 11(4), 804­819.
Kikkawa, A. K., G. Magerman, E. Dhyne, et al. (2018). Imperfect competition in firm-to-firm trade. Technical
   report.
Kohli, U. (2004). Real gdp, real domestic income, and terms-of-trade changes. Journal of International Eco-
   nomics 62(1), 83­106.
Koopman, R., Z. Wang, and S.-J. Wei (2014). Tracing value-added and double counting in gross exports.
   American Economic Review 104(2), 459­94.
Lim, K. (2017). Firm-to-firm trade in sticky production networks.
Lind, N. and N. Ramondo (2018). Trade with correlation. Technical report, National Bureau of Economic
   Research.


                                                       42
Long, J. B. and C. I. Plosser (1983). Real business cycles. The Journal of Political Economy, 39­69.
Morrow, P. M. and D. Trefler (2017). Endowments, skill-biased technology, and factor prices: A unified
   approach to trade. Technical report, National Bureau of Economic Research.
Oberfield, E. and D. Raval (2014). Micro data and macro technology. Technical report, National Bureau of
   Economic Research.
Solow, R. M. (1957). Technical change and the aggregate production function. The review of Economics and
   Statistics, 312­320.
Timmer, M. P., E. Dietzenbacher, B. Los, R. Stehrer, and G. J. De Vries (2015). An illustrated user guide
   to the world input­output database: the case of global automotive production. Review of International
   Economics 23(3), 575­605.
Tintelnot, F., A. K. Kikkawa, M. Mogstad, and E. Dhyne (2018). Trade and domestic production networks.
   Technical report, National Bureau of Economic Research.
Trefler, D. and S. C. Zhu (2010). The structure of factor content predictions. Journal of International Eco-
   nomics 82(2), 195­207.
Viner, J. (1937). Studies in the theory of international trade.
Yi, K.-M. (2003). Can vertical specialization explain the growth of world trade? Journal of political Econ-
   omy 111(1), 52­102.




                                                    43
    Online Appendix to Networks, Barriers, and Trade
                     David Rezza Baqaee                   Emmanuel Farhi




A Beyond CES                                                                                        45

B Comparison to Models without Intermediates                                                        46

C Non-Infinitesimal Shocks                                                                          51

D Data Appendix                                                                                     52

E Factor Demand System                                                                              54

F Aggregation and Stability of the Trade Elasticity                                                 57

G Results with Initial Tariffs                                                                      63

H Reallocation Effects                                                                              64

I   Partial Equilibrium Counterpart to Theorem 4                                                    73

J   Duality with Multiple Factors and Tariff Revenues                                               74

K Computational Appendix                                                                            76

L Extension to Roy Models                                                                           86

M Heterogenous Households Within Countries                                                          88

N Proofs                                                                                            91
     Emmanuel Farhi tragically passed away in July, 2020. Emmanuel was a one-in-a-lifetime collaborator
and my best friend. Revising this paper without him has been very difficult. We thank Pol Antras, Andy
Atkeson, Natalie Bau, Ariel Burstein, Arnaud Costinot, Pablo Fajgelbaum, Elhanan Helpman, Sam Kortum,
Marc Melitz, Stephen Redding, Andr´   es Rodr´
                                             iguez-Clare, and Jon Vogel for insightful comments. We are
grateful to Maria Voronina, Chang He, and Sihwan Yang for outstanding research assistance. We acknowl-
edge support from NSF grant #1947611. Email: baqaee@econ.ucla.edu.

                                                  44
A     Beyond CES
In this appendix, we show how to generalize the results in the paper beyond nested-CES
functional forms. We begin by discussing how Sections 4 and 5 can be generalized beyond
CES. We then show how Section 6 can be generalized to non-CES functional forms.


A.1    Generalizing Sections 4 and 5 and Appendix C
In a similar vein to Baqaee and Farhi (2017a), we can extend the results in Sections 4 and
5 to arbitrary neoclassical production functions simply by replacing the input-output co-
variance operator with the input-output substitution operator instead.
    For a producer k with cost function Ck , the Allen-Uzawa elasticity of substitution be-
tween inputs x and y is

                                          Ck d2 Ck /(dp x dpy )                   k ( x, y)
                            k ( x, y) =                         =                             ,
                                        (dCk /dp x )(dCk /dpy )                    ky

where k ( x, y) is the elasticity of the demand by producer k for input x with respect to the
price py of input y, and    ~ ky is the expenditure share in cost of input y. We also use this
definition for final demand aggregators.
    The input-output substitution operator for producer k is defined as

           k (  (i ) ,  ( j ) ) = -                 ~ kx [xy + ~ ky (k ( x, y) - 1)] xi yj ,
                                      x ,y  N + F
                              1
                             = E(k) (k ( x, y) - 1)(i ( x ) - i (y))( j ( x ) -  j (y)) ,         (10)
                              2

where xy is the Kronecker delta, i ( x ) =  xi and  j ( x ) =  xj , and the expectation on the
second line is over x and y.
   In the CES case with elasticity k , all the cross Allen-Uzawa elasticities are identical
with k ( x, y) = k if x y, and the own Allen-Uzawa elasticities are given by k ( x, x ) =
-  k (1 - ~ kx )/~ kx . It is easy to verify that when Ck has a CES form we recover the input-
output covariance operator:

                          k ((i) , ( j) ) = (k - 1)Cov               ~ (k ) (  (i ) ,  ( j ) ).
                                                                   Omega

    Even outside the CES case, the input-output substitution operator shares many proper-
ties with the input-output covariance operator. For example, it is immediate to verify, that:
k ((i) , ( j) ) is bilinear in (i) and ( j) ; k ((i) , ( j) ) is symmetric in (i) and ( j) ; and


                                                             45
k ((i) , ( j) ) = 0 whenever (i) or ( j) is a constant.
   All the structural results in the paper can be extended to general non-CES economies
by simply replacing terms of the form (k - 1)Cov    ~ (k) ( (i ) , ( j) ) by k ( (i ) , ( j) ).
   For example, when generalized beyond nested CES functional forms, Theorem 3 be-
comes the following.

Theorem 8. For a vector of perturbations to productivity d log A and wedges d log µ, the
change in the price of a good or factor i  N + F is the same as (5). The change in the sales
share of a good or factor i  N + F is

                                              k                 
         d log i =             1{ i = k } -
                                              i
                                                ki d log µk +  k µ-
                                                                   k k ( (i ) , d log p )
                                                                    1

                     k N + F                                 k N i
                                 W
                                 i - i
                                  c
                     +      i cg g d log g ,
                         g F  cC


where d log p is the ( N + F ) × 1 vector of price changes in (5). The change in wedge income
accruing to household c (represented by a fictitious factor) is the same as (7).


A.2    Generalizing Section 6
To generalize the results in Section 6 to non-CES economies, assume that the production
function of any importing producer i  Mc is separable in imported inputs and domestic
inputs and let i be the elasticity of substitution between domestic and imported inputs
(where i is not necessarily a constant). Then define the dual productivity shock to i via the
differential equation
                                   d log A i = - d log ic .
                                                  i - 1
If dual productivity shocks are defined by the equation above, then Theorem 7 holds even
when production functions are non-CES. Therefore, Corollary 3 generalizes to non-CES
economies without change. Corollary 4 generalizes to non-CES economies if we replace
                               (k) (i ) , ( j) by k ( (i ) , ( j) ), where k is defined by (10).
terms of the form (k - 1)Cov                                 



B     Comparison to Models without Intermediates
In this appendix, we discuss how the quantitative results in Table 1 change if we abstract
from intermediate inputs. We find that abstracting from intermediates significantly reduces
the losses from protectionism, and we discuss the intuition for this using our analytical
results.

                                                     46
Value-Added Calibrations

The benchmark model features input-output linkages. To emphasize the importance of
taking input-output linkages into account and to connect with our analytical results, we
compare the benchmark model with input-output linkages to two alternative value-added
calibrations which are common in the trade literature. These alternative calibrations both
assume that all production takes place with value-added production functions (no inter-
mediates) but trivialize the input-output connections in two different ways. We call these
two calibrations the low-trade value-added (LVA) and the high-trade value-added (HVA)
economies. As we shall see, these two value-added calibrations are problematic, because
they are not exact representations of the benchmark economy.1
    Low-trade value-added (LVA): the value-added produced by each producer matches
the one in the data. It is then assumed that the fraction of the value added of i which is
sold to each country is equal to the corresponding fraction of the sales of i in the data. This
calibration matches trade a share of total sales, and therefore, it lowers the volume of trade
relative to GDP. We call this the low-trade value-added economy for this reason. This is the
procedure used by Costinot and Rodriguez-Clare (2014) in the handbook chapter for their
value-added calibration, and it is also how Arkolakis et al. (2012) mapped their model to
the data.
    High-trade value-added (HVA): the value-added produced by each producer matches
the one in the data. However, it is then assumed that the value of i which is sold to each
foreign country is equal to the corresponding sales of i in the data. The residual value-
added is sold in the domestic country of i. This calibration preserves trade as a share of
GDP, so we call this the high-trade value-added economy.


Results

In Table 4, we report the impact on the welfare of a few countries, as well as the effect
on world welfare, of a universal 10% increase in either the iceberg costs of trade or a 10%
increase in import tariffs. We compare the response of our benchmark economy to those of
the LVA and HVA economies (which do not have intermediate goods).
   Across the board, and as suggested by the discussion of trapezoids versus triangles in
   1 The  only correct way of representing this economy with intermediate inputs as a value-added economy
is to follow Adao et al. (2017). For some welfare counterfactuals, this representation can be put to use by
directly specifying and estimating a parsimoniously-parameterized factor demand system. This parsimony
advantage must of course be traded of against the cost of misspecification, and, as our formulas in Section
4 make clear, the "true" functional form of the factor demand system is likely to be complex for realistic
economies. Furthermore, using this approach is more difficult in the presence of intermediate goods, trade
costs, and tariffs. In Appendix E, we use Theorem 3 to explicitly characterize the factor-demand system.



                                                    47
Table 4: Percentage change in real income for a subset of the countries in response to a
universal 10% change in iceberg trade costs or import tariffs.


                          AUS     BEL     BGR     CAN      CHN     DEU      IRL     LUX       USA     World
  Benchmark Iceberg       -2.0%   -6.7%   -5.9%   -3.3%    -1.3%   -3.0%    -8.3%   -16.9%    -1.1%   -2.26%
  HVA Iceberg             -2.1%   -5.2%   -5.5%   -3.9%    -1.5%   -3.4%    -7.1%   -10.8%    -1.0%   -2.34%
  LVA Iceberg             -0.8%   -2.3%   -1.9%   -1.4%    -0.5%   -1.2%    -3.6%    -5.0%    -0.3%   -0.86%

  Benchmark Tariff        -0.7%   -2.3%   -0.7%   -1.2%    -0.2%   -0.9%    -3.7%    -5.4%     0.1%   -0.43%
  HVA Tariff              -0.5%   -0.6%   -0.1%   -1.5%    -0.1%   -0.7%    -2.1%    -5.3%     0.3%   -0.23%
  LVA Tariff              -0.4%   -0.3%    0.3%   -0.7%     0.1%   -0.5%    -1.3%    -0.7%     0.1%   -0.17%




Section 5.1, an increase in iceberg trade costs (or other non-tariff barriers to trade) is signif-
icantly more costly than an equivalent increase in tariffs. For example, US welfare actually
increases by 0.1% in response to increases in tariffs, but decreases by 1.1% in response to
increases in trade costs. World welfare decreases by 0.4% in response to increases in tariffs,
but decreases by 2.3% in response to increases in trade costs. Hence, drawing inferences
about increases in tariffs by studying increases in iceberg trade costs can be misleading.
     In the benchmark economy, the effects of a universal tariff or universal iceberg shock are
amplified by global value chains, as pointed out by Yi (2003). Tariffs are compounded each
time unfinished goods cross borders, as in the round-about example of Section 5.2, poten-
tially magnifying the impact of the tariff many times. To quantify this double-marginalization
effect (where tariffs are paid multiple times) consider taxing traded goods based only on
the domestic content of their exports.2 For the benchmark economy, taxing only the domes-
tic content of exported goods reduces global output by -0.31% instead of the benchmark
-0.43%, suggesting that there is a significant degree of re-exporting in world trade.
     Next, we compare the benchmark model to the value-added economies. The reduction
in world welfare from increases in iceberg trade costs is 2.3% for the benchmark economy,
it is also 2.3% for the HVA economy, but it is only 0.9% for the LVA economy. The HVA
economy does a better job than the LVA economy because it preserves the volume of trade,
and hence, by Theorems 1 and 2, the response of world welfare in that model is, at the
first order, identical to that of the benchmark model.3 The response of country welfare
is different at the first order, but for the shock that we consider, these differences seem
   2 Formally,                                                        c =  1(i  c ) and c = ( I - c )-1 .
                 for each traded good i produced in country c, define ij  ij
Let i =  j c ij c and impose the tax µ = (1 + 0.101-i ) on each i. If the traded good i does not rely on foreign
                                      i
inputs in its supply chain, then i = 0, if the traded good i contains no domestic value-added (directly or
indirectly) then i = 1.
   3 That means, as long as the shocks are sufficiently small (ruling out nonlinearities), we should expect the

benchmark and HVA economies to deliver similar welfare results for the world as a whole.


                                                      48
to be relatively small for most (but not all) countries. The LVA economy, the much more
common calibration, does much worse. Since LVA reduces the volume of trade to GDP, it
greatly understates, at the first order, the welfare effects of shocks to iceberg trade costs.
    The reduction in world welfare from an increase in tariffs is 0.43% for the benchmark
economy, but it is only 0.23% for the HVA economy, and it is even less at 0.17% for LVA
economy. In this case, neither the LVA nor the HVA economy does a good job of replicating
the benchmark model.
    Theorem 4 helps explain why: the losses from tariffs are given by (1/2) i i  log yi ×
log µi , where i is the sales share, log yi is the quantity, and log µi is the (gross) tax for good
i. Since the HVA economy preserves the volume of trade, i are the same for the benchmark
and the HVA economy. Nevertheless, the response of the HVA economy is half that of the
benchmark. This is because in the HVA economy, the reduction in export quantities  log yi
in response to tariffs is significantly lower. The LVA economy is still hopeless, since it gets
both the output elasticity  log yi wrong and the trade volumes i wrong.
    One reason why the quantities respond less to taxes in the HVA economy than the
benchmark is because in the HVA economy imported goods are a larger share of each
agent's basket. To match the overall volume of trade relative to value-added, the HVA
economy must increase the amount of traded goods consumers buy as a share of their over-
all consumption basket. Intuitively, the higher is the share of imports in the consumer's
consumption basket, the lower is the elasticity of that consumer's demand with respect to
the tax. The reason is that increases in the price of imports increase the overall price index
by more, and hence reduce substitution away from imports.


Intuition from a Round-About Economy. To gain more intuition, we formally work
through the round-about economy depicted in Figure 2. In Section 5, we showed that the
welfare and output losses from a universal increase in tariffs in that economy were given
by
                   1                                 
                -   ji  log y ji ×  log µi =  ji           log µ  log µ,
                   2i j                            1-
                                                           - log y ji    log µi

with the sales share of each traded good given by  ji = /[2(1 - )], and where i and j
index the origin and destination of the traded good,  is the share of traded goods in sales,
and  is the elasticity of substitution between traded and non-traded goods.
   The expression above follows from the fact that

                                                         1
                           - log y ji =   log p ji =        log µ.
                                                        1-


                                                49
The term 1/(1 - ) captures the fact that global value chains amplify the effect of the tariff
on the price -- each time the good crosses the border, the tariff must be paid again.
   Now, imagine that we take data from this economy and calibrate it using the HVA and
LVA structures, keeping the elasticity of substitution between traded and non-traded goods
(the trade elasticity) constant and equal to  throughout.4 The HVA economy has the same
value  ji = /[2(1 - )] for the sales share of traded goods as the round-about economy,
but the LVA economy has a lower value for  ji = /2.5
   Both for the HVA and LVA economies, the reduction in the quantity of traded goods in
response to tariffs is given by

                      - log y ji =  ( log p ji -  log Pc ) =  (1 -  ji ) log µ,

where Pc is the consumer price index in both countries. Combining these two facts, the
welfare and output losses from tariffs are given by

                          1
                          2
                      -          ji  log y ji  log µi =  ji  (1 -  ji ) log µ  log µ,                         (11)
                            i j
                                                                   - log y ji       log µi


where  ji = /[2(1 - )] for the HVA economy and  ji = /2 for the LVA economy.
    Since for a given tariff  log µ, the loss is proportional to the product of  ji and - log y ji ,
the HVA and LVA economies will give the wrong answer to the extent that they fail to
match the values of these two variables in the round-about economy.
    By construction, the HVA economy matches  ji , whereas the LVA has a lower  ji . This
leaves the change in the quantity  log y ji to consider. As mentioned before, the HVA
economy underpredicts the reduction in imports since it inflates the household's purchases
of imported goods to make up for the fact that there are no imported intermediates. This
means that the household's price index responds more to a change in the price of imported
goods, thereby reducing the extent of substitution.
    In Table 4, we saw that both the LVA and HVA economies undershoot the true effect
of the tariffs by about the same amount. Equation (11) gives some intuition for why this
happens: there, the losses (11) are proportional to  ji (1 -  ji ) -- when the volume of trade
to GDP is close to its value in the data  ji  0.5, both the HVA and LVA give broadly
similar results, and both undershoot the round-about economy.
   4 In this context, we define the trade elasticity to be the elasticity of expenditures on foreign goods rela-

tive to domestic goods to an iceberg trade shock, holding factor and import prices (before the iceberg cost)
constant. This is the notion used by Caliendo and Parro (2015) in the context of economies with IO linkages.
   5 This implies that to a first order, the welfare and output losses from increases in iceberg trade costs in the

HVA economy are the same as for the round-about economy, but they are lower in the LVA economy.


                                                        50
C     Non-Infinitesimal Shocks
We can conduct global comparative statics by viewing Theorem 3 as a system of differential
equations that can be solved by iterative means (e.g. Euler's method or Runge-Kutta). The
endogenous terms in Equations (5) and (6) depend only on HAIO and Leontief matrices
( ~ , , ~ , ). However, a similar logic to (6) can be used to derive changes in these matrices.
In particular, the change in the HAIO matrix     ~ is

                               d~ ij = (1 - i )Cov ~ (i) d log p, I( j) ,
                                                  


where I( j) is the jth column of the identity matrix. The change in the Leontief inverse is

                          d~ ij =   ~ ik (1 - i )Cov ~ (k)
                                                               d log p, ~ ( j) .
                                    k N

Similarly, changes in  are
                                             -1 ~
                                      dij = µi dij - d log µi

and changes in  are

       dij =     ik µ- 1
                     k (1 - k )Cov~ (k) ( d log p, ( j) ) -  ik ( kj - 1{k = j} ) d log µk .
                k N                                               k

As explained in Appendix K, this means that we can conduct global comparative statics by
repeatedly solving a (C + F ) × (C + F ) linear system and cumulating the results, instead of
solving a system of (C + N + F ) × (C + N + F ) nonlinear equations. This type of approach
is also used in the CGE literature, for example Dixon et al. (1982), to solve high-dimensional
models because exact-hat algebra is computationally impracticable for large models.6 For
the quantitative model in Section 8, the differential approach is more than ten times faster
than using state-of-the-art nonlinear solvers to perform exact hat-algebra.
    There are two scenarios where the differential equations approach is especially useful.
The first is for large models with strong nonlinearities (e.g. low elasticities of substitution).
In these cases, repeatedly solving the smaller linear system may be more computationally
feasible than solving the larger highly nonlinear system.
    Secondly, the differential approach is also useful outside of the nested-CES case where
closed-form expressions for the demand system are not available, but estimates of the elas-
ticity of substitution are available at different points of the cost function. In this case, the
non-parametric version of Theorem 3 (Theorem 8 in Appendix A) can be used to feed es-
   6 In the CGE literature, supply and demand relationships are log-linearized and then integrated numeri-

cally by Euler's method.

                                                   51
timates of the elasticity of substitution directly into the differential equation to compute
global comparative statics without specifying a closed-form expression for production or
cost functions.7


D      Data Appendix
To conduct the counterfactual exercises in Section 8, we use the World Input-Output Database
(Timmer et al., 2015). We use the 2013 release of the data for the final year which has no-
missing data -- that is 2008. We use the 2013 release because it has more detailed informa-
tion on the factor usage by industry. We aggregate the 35 industries in the database to get
30 industries to eliminate missing values, and zero domestic production shares, from the
data. In Table 5, we list our aggregation scheme, as well as the elasticity of substitution,
based on Caliendo and Parro (2015) and taken from Costinot and Rodriguez-Clare (2014)
associated with each industry. We calibrate the model to match the input-output tables and
the socio-economic accounts tables in terms of expenditure shares in steady-state (before
the shock).
    For the growth accounting exercise in Section H.3, we use both the 2013 and the 2016
release of the WIOD data. When we combine this data, we are able to cover a larger number
of years. We compute our growth accounting decompositions for each release of the data
separately, and then paste the resulting decompositions together starting with the year of
overlap. To construct the consumer price index and the GDP deflator for each country, we
use the final consumption weights or GDP weights of each country in each year to sum up
the log price changes of each good. To arrive at the price of each good, we use the gross
output prices from the socio-economic accounts tables which are reported at the (country
of origin, industry) level into US dollars using the contemporaneous exchange rate, and
then take log differences. This means that we assume that the log-change in the price of
each good at the (origin, destination, industry of supply, industry of use) level is the same
as (origin, industry of supply) level. If there are differential (changing) transportation costs
over time, then this assumption is violated.
    To arrive at the contemporaneous exchange rate, we use the measures of nominal GDP
in the socioeconomic accounts for each year (reported in local currency) to nominal GDP
in the world input-output database (reported in US dollars).


   7 An additional reason why the differential equations approach can be useful is because some statistics,

like real GDP, are defined in terms of path integrals. Hence, the differential equation approach must be used
because the change in real GDP, in general, will depend on the path of integration. See Hulten (1973) for
more information.


                                                     52
           WIOD Sector                                       Aggregated sector   Trade Elasticity
      1    Agriculture, Hunting, Forestry and Fishing        1                   8.11
      2    Mining and Quarrying                              2                   15.72
      3    Food, Beverages and Tobacco                       3                   2.55
      4    Textiles and Textile Products                     4                   5.56
      5    Leather, Leather and Footwear                     4                   5.56
      6    Wood and Products of Wood and Cork                5                   10.83
      7    Pulp, Paper, Paper , Printing and Publishing      6                   9.07
      8    Coke, Refined Petroleum and Nuclear Fuel          7                   51.08
      9    Chemicals and Chemical Products                   8                   4.75
      10   Rubber and Plastics                               8                   4.75
      11   Other Non-Metallic Mineral                        9                   2.76
      12   Basic Metals and Fabricated Metal                 10                  7.99
      13   Machinery, Enc                                    11                  1.52
      14   Electrical and Optical Equipment                  12                  10.6
      15   Transport Equipment                               13                  0.37
      16   Manufacturing, Enc; Recycling                     14                  5
      17   Electricity, Gas and Water Supply                 15                  5
      18   Construction                                      16                  5
      19   Sale, Maintenance and Repair of Motor Vehicles... 17                  5
      20   Wholesale Trade and Commission Trade, ...         17                  5
      21   Retail Trade, Except of Motor Vehicles and...     18                  5
      22   Hotels and Restaurants                            19                  5
      23   Inland Transport                                  20                  5
      24   Water Transport                                   21                  5
      25   Air Transport                                     22                  5
      26   Other Supporting and Auxiliary Transport....      23                  5
      27   Post and Telecommunications                       24                  5
      28   Financial Intermediation                          25                  5
      29   Real Estate Activities                            26                  5
      30   Renting of M&Req and Other Business Activities    27                  5
      31   Public Admin/Defence; Compulsory Social Security 28                   5
      32   Education                                         29                  5
      33   Health and Social Work                            30                  5
      34   Other Community, Social and Personal Services     30                  5
      35   Private Households with Employed Persons          30                  5

Table 5: The sectors in the 2013 release of the WIOD data, and the aggregated sectors in our
data.




                                                 53
E     Factor Demand System
Adao et al. (2017) show that some trading economies can be represented as if only fac-
tors are traded within and across borders, and households have preferences over factors.
Theorem 3 can be used to flesh out this representation by locally characterizing its associ-
ated reduced-form Marshallian demand for factors in terms of sufficient-statistic microeco-
nomic primitives. For example, in the absence of wedges, the expenditure share of house-
hold c on factor f under the "trade-in-factors" representation is given by c f ; the elastici-
ties  log c f / log Ai holding factor prices constant then characterize its Marshallian price
elasticities as well as its Marshallian elasticities with respect to iceberg trade shocks:

                        log c f      
                                =  ck (k - 1)Cov(k) (( f ) , (i) ).
                        log Ai       
                                  k N c f

The reduced-form factor demand system is locally stable with respect to a single shock
d log Ai if, and only, if  log c f / log Ai = 0, with a similar conditions for a combination
of such shocks. Similarly, by Theorem 3, we know that the elasticity of the factor income
share of some factor j with respect to the price of another factor i, holding fixed all other
factor prices, is given by

             log  j            
                    =  (1 - k ) k Cov(k) ((i) , ( j) ) +  (Wj /  j - 1) ci i ,
                                                              c
                                                                                           (12)
             log wi   k N
                                j                        cC

recalling that for factors f  F, we interchangeably write  f or  f to refer to their Domar
weight. Figure 4 illustrates these elasticities of the factor demand system for a selection of
the countries using the benchmark calibration. The ijth element gives the elasticity of j's
world income share with respect to the price of i (holding fixed all other factor prices). Each
country has four factors: capital, low, medium, and high skilled labor. Some interesting
patterns emerge:

    1. There dark blue columns corresponding to factors in major countries like China, Ger-
       many, Britain, Japan, and the USA. For these countries, an increase in the price of
       their countries' factors (except low-skilled labor) strongly raises the share of world
       income going to foreign countries.

    2. There is a block-diagonal structure where an increase in domestic capital prices low-
       ers domestic capital's share of world income, but also lowers domestic labor income
       shares. On the other hand, an increase in labor prices often raises domestic labor in-
       come and lowers domestic capital's share of world income. This pattern is interesting


                                              54
  because it emerges due to the HAIO matrix. At the micro level, the elasticity of sub-
  stitution among domestic factors for every user is symmetric and equal to 0.5. For
  example, an in increase in US capital prices lowers the income claimed by all types of
  US labor. However, an increase in US labor prices lowers capital income and raises
  labor income.

3. For the USA, an increase in domestic factor prices raises the income share of every
   other country (the biggest beneficiary is Canada). Low-skilled labor has the mildest
   effects.




                                         55
        Figure 4: The international factor demand system for a selection of countries

 BRA

 CAN

CHN                                                                                                            0.5

 CYP

 CZE

 DEU

 DNK                                                                                                           0

 ESP

 EST

  FIN

 FRA                                                                                                           -0.5

GBR

GRC

HUN

 IDN                                                                                                           -1

 IND

  IRL

  ITA

 JPN                                                                                                           -1.5

KOR

 LTU

 LUX

 LVA                                                                                                           -2

MEX

 MLT

 NLD

 POL                                                                                                           -2.5

 PRT

ROU

 RUS

 SVK                                                                                                           -3

 SVN

SWE

 TUR

TWN                                                                                                            -3.5

 USA
        BRA



        CYP




        SVN

        TUR

        USA
         EST




         LUX
        GRC




        ROU
          IRL
          ITA
        CAN




        DEU
        DNK




        RUS
         IDN
         IND
        CZE



        ESP



        FRA




        MLT
        NLD
        POL
        PRT



        SVK

        SWE

        TWN
          FIN




         JPN

         LTU

         LVA
        CHN




        GBR

        HUN




        KOR




        MEX




The ijth element is the elasticity of factor j with respect to the price of factor i, holding fixed other factor
                                        prices, given by equation (12).
                                                      56
F     Aggregation and Stability of the Trade Elasticity
In this section, we characterize trade elasticities at different levels of aggregation in terms of
microeconomic primitives. We also prove necessary and sufficient conditions for ensuring
that the trade elasticity is constant and stable. We also relate the instability of the trade
elasticity to the Cambridge Capital controversy -- a mathematically similar issue that arose
in capital theory in the middle of the 20th century.


F.1   Aggregating and Disaggregating Trade Elasticities
We start by defining a class of aggregate elasticities. Consider two sets of producers I and
J . Let  I = i I i and  J =  j J be the aggregate sales shares of producers in I and J , and
let iI = i / I and  jJ =  j / J . Let k be another producer. We then define the following
aggregate elasticities capturing the bias towards I vs. J of a productivity shock to m as:

                                                   ( I / J )
                                        I J ,m =             ,
                                                    log Am

where the partial derivative indicates that we allow for this elasticity to be computed hold-
ing some things constant.
    To shed light on trade elasticities, we proceed as follows. Consider a set of producers
S  Nc in a country c. Let J be denote a set of domestic producers that sell to producers
in S, and I denote a set of foreign producers that sell to producers in S. Without loss of
generality, using the flexibility of network relabeling, we assume that producers in I and J
are specialized in selling to producers in S so that they do not sell to producers outside of
S.
    Consider an iceberg trade cost modeled as a negative productivity shock d log(1/ Am )
to some producer m. We then define the trade elasticity as  I J ,k = ( J / I )/ log(1/ Am ) =
( I / J )/ log Am . As already mentioned, the partial derivative indicates that we allow
for this elasticity to be computed holding some things constant. There are therefore dif-
ferent trade elasticities, depending on exactly what is held constant. Different versions of
trade elasticities would be picked up by different versions of gravity equations regressions
with different sorts of fixed effects and at different levels of aggregation.
    There are several possibilities for what to hold constant, ranging from the most partial
equilibrium to the most general equilibrium. At one extreme, we can hold constant the
prices of all inputs for all the producers in I and J and the relative sales shares of all the




                                                   57
producers in S:

                               s                                                   s
                iI (s - 1) i Cov(s) ( I(i) , (m) ) -    j (s - 1)  j Cov(s) ( I( j) , (m) ),
                                                                          J
  I J ,m =                                                                                                (13)
             sS i  I                                         sS j J


where I(i) and I( j) are the ith and jth columns of the identity matrix. An intermediate
possibility is to hold constant the wages of all the factors in all countries:

                                                   iI ik -   j  jk .
                                                                      J
                                       I J ,k =
                                                  i I         j J


And at the other extreme, we can compute the full general equilibrium:

                                    d log  g                 d log  g
   I J ,m =    iI      im -    ig d log Am +  ig d log Am
              i I             g F                    g F

                                                                              d log  g         d log  g
                                           -   jJ           jm -     jg d log Am +   jg d log Am           ,
                                               j J                 g F                   g F


d log  f / d log Am is given in Theorem 3.
    The trade elasticity is a linear combination of microeconomic elasticities of substitution,
where the weights depend on the input-output structure. Except at the most microeco-
nomic level where there is a single producer s in S and in the most partial-equilibrium
setting where we recover s - 1, this means that the aggregate trade elasticity is typically
an endogenous object, since the input-output structure is itself endogenous.8 Furthermore,
in the presence of input-output linkages, it is typically nonzero even for trade shocks that
are not directly affecting the sales of I to J , except in the most partial-equilibrium setting.


Example: Trade Elasticity in a Round-About World Economy

In many trade models, the trade elasticity, defined holding factor wages constant, is an
invariant structural parameter. As pointed out by Yi (2003), in models with intermedi-
ate inputs, the trade elasticity can easily become an endogenous object.Consider the two-
country, two-good economy depicted in Figure 2. The representative household in each
country only consumes the domestic good, which is produced using domestic labor and
imports with a CES production function with elasticity of substitution  . We consider the
imposition of a trade cost hitting imports by country 1 from country 2. For the sake of
illustration, we assume that the trade cost does not apply to the exports of country 1 to
   8 In
      Appendix F.3, we provide necessary and sufficient conditions for the trade elasticity to be constant in
the way.


                                                        58
country 2.
    The trade elasticity holding factor wages and foreign input prices constant is a constant
structural parameter, and given simply by

                                                   - 1.

However, echoing our discussion above, the trade elasticity holding factor wages constant
is different, and is given by
                                        -1
                                                 ,
                                    1 - 21 12
where ij is the expenditure share of i on j, e.g. its intermediate input import share. As
the intermediate input shares increase, the trade elasticity becomes larger. Simple trade
models without intermediate goods are incapable of generating these kinds of patterns.
   Of course, since the intermediate input shares ij are themselves endogenous (depend-
ing on the iceberg shock), this means that the trade elasticity varies with the iceberg shocks.
In particular, if  > 1, then the trade elasticity increases (nonlinearly) as iceberg costs on
imports fall in all countries since intermediate input shares rise. 9


                                   L1                               L2


                          H1              y1                 y2              H2


Figure 5: The solid lines show the flow of goods. Green nodes are factors, purple nodes are
households, and white nodes are goods. The boundaries of each country are denoted by
dashed box.



F.2       Necessary and Sufficient Conditions for Constant Trade Elasticity
In this section, we study conditions under which the trade elasticity (holding fixed factor
prices) is constant. This trade elasticity between i and j with respect to shocks to k is defined
as
                                                  ( i /  j )
                                          ij,k =             ,
                                                  log Ak
   9 InAppendix F.3, we show that there it is possible to generate "trade re-switching" examples where the
trade elasticity is non-monotonic with the trade cost (or even has the "wrong" sign) in otherwise perfectly
respectable economies. These examples are analogous to the "capital re-switching" examples at the center
the Cambridge Cambridge Capital controversy.



                                                    59
holding fixed factor prices. We say that a good m is relevant for  ij,k if

                                   m Cov(m) ((k) , (i) /i - ( j) / j )               0.

If m is not relevant, we say that it is irrelevant. For instance, if some producer m is exposed
symmetrically to i and j through its inputs

                                        ml (li - lj ) = 0              ( l  N ),

then  ij,k is not a function of m and m is irrelevant. Another example is if some producer
m j is not exposed to k through its inputs

                                                  mk = 0,

then  ij,k is not a function of m and m is irrelevant.

Corollary 6 (Constant Trade Elasticity). Consider two distinct goods i and j that are imported to
some country c. Then consider the following conditions:

  (i) Both i and j are unconnected to one another in the production network: ij =  ji = 0, and i
      is not exposed to itself ii = 1.

 (ii) The representative "world" household is irrelevant

                                                            (i )       ( j)
                                          Cov     (i ) ,           -          = 0,
                                                            i           j

      which holds if both i and j are only used domestically, so that only household c is exposed to i
                       W       W
      and j. That is, i h =  j h = 0 for all h c. This assumption holds automatically if i and j
      are imports and domestic goods and there are no input-output linkages.

(iii) For every relevant producer l, the elasticity of substitution l =  .

The trade elasticity of i relative to j with respect to iceberg shocks to i is constant, and equal to

                                                 ij,i = ( - 1).

if, and only if, (i)-(iii) hold.

   The conditions set out in the example above, while seemingly stringent, actually rep-
resent a generalization of the conditions that hold in gravity models with constant trade


                                                       60
elasticities. Those models oftentimes either assume away the production network, or as-
sume that traded goods always enter via the same CES aggregator.
    A noteworthy special case is when i and j are made directly from factors, without any
intermediate inputs. Then, we have the following

Corollary 7. (Network Irrelevance) If some good i and j are only made from domestic factors, then

                               m Cov(m) ((i) , ( j) /i - (i) /i ) = 1.
                       mC, N


Hence, if all microeconomic elasticities of substitution m are equal to the same value m =  then
 ij, j =  .

    Suppose that i is domestic goods and j are foreign imports, both of which are made
only from factors (no intermediate inputs are permitted). Then a shock to j is equivalent
to an iceberg shock to transportation costs. In this case, the trade elasticity of imports j
into the country producing i with respect to iceberg trade costs is a convex combination of
the underlying microelasticities. Of course, whenever all micro-elasticities of substitution
are the same, the weights (which have to add up to one) become irrelevant, and this is the
situation in most benchmark trade models with constant trade elasticities. Specifically, this
highlights the fact that having common elasticities is not enough to deliver a constant trade
elasticity (holding fixed factor prices) in the presence of input-output linkages as shown in
the round-about example in the previous section.


F.3   Trade Reswitching
Yi (2003) shows that the trade elasticity can be nonlinear due to vertical specialization,
where the trade elasticity can increase as trade barriers are lowered. Building on this in-
sight, we can also show that, at least in principle, the trade elasticity can even have the
"wrong sign" due to these nonlinearities. This relates to a parallel set of paradoxes in cap-
ital theory.
    To see how this can happen, imagine there are two ways of producing a given good: the
first technique uses a domestic supply chain and the other technique uses a global value
chain. Whenever the good is domestically produced, the iceberg costs of transporting the
good are, at most, incurred once -- when the finished good is shipped to the destination.
However, when the good is made via a global value chain, the iceberg costs are incurred
as many times as the good is shipped across borders. As a function of the iceberg cost
parameter  , the difference in the price of these two goods (holding factor prices fixed) is a


                                               61
polynomial of the form
                                         Bn  n - B1  ,                                     (14)

where Bn and B1 are some coefficients and n is the number of times the border is crossed.
The nonlinearity in  , whereby the iceberg cost's effects are compounded by crossing the
border, drives the sensitivity of trade volume to trade barriers in Yi (2003). The benefits
from using a global value chain are compounded if the good has to cross the border many
times.
    However, this discussion indicates the behavior of the trade elasticity can, in principle,
be much more complicated. In fact, an interesting connection can be made between the
behavior of the trade elasticity and the (closed-economy) reswitching debates of the 1950s
and 60s. Specifically, equation (14) is just one special case. In general, the cost difference
between producing goods using supply chains of different lengths is a polynomial in  ­
and this polynomial can, in principle, have more than one root. This means that the trade
elasticity can be non-monotonic as a function of the trade costs, in fact, it can even have the
"wrong" sign, where the volume of trade decreases as the iceberg costs fall. This mirrors
the apparent paradoxes in capital theory where the relationship between the capital stock
and the return on capital can be non-monotonic, and an increase in the interest rate can
cause the capital stock to increase.
    To see this in the trade context, imagine two perfectly substitutable goods, one of which
is produced by using 10 units of foreign labor, the other is produced by shipping 1 unit of
foreign labor to the home country, back to the foreign country, and then back to the home
country and combining it with 10 units of domestic labor. If we normalize both foreign and
domestic wages to be unity, then the costs of producing the first good is 10(1 +  ), whereas
the cost of producing the second good is (1 +  )3 + 10, where  is the iceberg trade cost.
When  = 0, the first good dominates and goods are only shipped once across borders.
When  is sufficiently high, the cost of crossing the border is high enough that the first
good again dominates. However, when  has an intermediate value, then it can become
worthwhile to produce the second good, which causes goods to be shipped across borders
many times, thereby inflating the volume of trade.
    Such examples are extreme, but they illustrate the point that in the presence of input-
output networks, the trade elasticity even in partial equilibrium (holding factor prices
constant) can behave quite unlike any microeconomic demand elasticity, sloping upwards
when, at the microeconomic level, every demand curve slopes downwards.




                                              62
Non-Symmetry and Non-Triviality of Trade Elasticities

Another interesting subtlety of Equation (13) is that the aggregate trade elasticities are non-
symmetric. That is, in general  ij,l    ji,l . Furthermore, unlike the standard gravity equa-
tion, Equation (13) shows that the cross-trade elasticities are, in general, nonzero. Hence,
changes in trade costs between k and l can affect the volume of trade between i and j holding
fixed relative factor prices and incomes. This is due to the presence of global value chains,
which transmit shocks in one part of the economy to another independently of the usual
general equilibrium effects (which work through the price of factors).


G      Results with Initial Tariffs
Table 6 recomputes the exercise in Table 1 but allows for tariffs in the initial equilibrium.
Since initial tariffs in 2008 are relatively small, these numbers are broadly similar to those
reported in Table 1.

Table 6: Change in welfare, in log points, for a subset of countries in response to a universal
10%, 5%, and 1% change in trade costs, and comparison to a loglinear approximation.

                                   10% Shock                  5% Shock                1% Shock
    Universal Iceberg Shock   Nonlinear   Loglinear      Nonlinear   Loglinear   Nonlinear   Loglinear
            China               -1.69       -2.40          -0.96       -1.23       -0.22       -0.25
         Great Britain          -2.54       -3.22          -1.43       -1.65       -0.33       -0.34
         Luxembourg            -16.81      -19.62          -9.26      -10.04       -2.00       -2.05
            Russia              -3.27       -3.87          -1.70       -1.98       -0.36       -0.40
             USA                -1.15       -1.57          -0.67       -0.80       -0.15       -0.16
            World               -2.37       -3.02          -1.33       -1.55       -0.30       -0.32
    Universal Tariff Shock
            China               -0.60       -0.09          -0.19       -0.05       -0.01       -0.01
         Great Britain          -0.69       -0.46          -0.31       -0.24       -0.05       -0.05
         Luxembourg             -5.28       -2.93          -2.11       -1.50       -0.32       -0.31
            Russia              -2.05       -2.07          -1.01       -1.06       -0.21       -0.22
             USA                 0.00        0.06           0.00        0.03        0.01        0.01
            World               -0.56       -0.27          -0.24       -0.14       -0.03       -0.03



    Below, we discuss how we map the data to initial tariffs.

Initial Tariff Data. The list of countries we include coincides with the countries in the
World Input-Output Database (WIOD) in 2013 Release. We collect bilateral trade and tar-
iffs data for 2016 from the United Nations Statistical Division (UNSD) Commodity Trade
(COMTRADE) dataset and the Trade Analysis and Information System (TRAINS). Both
trade and tariffs data defined on sectors that use the Harmonized Commodity Description

                                                    63
and Coding System (HS) 1988/1992 concorded at the 2-digit ISIC Rev. 3 industry levels.
We further aggregate these tradable sectors to match the WIOD data.
    The trade value is defined as the import value from partner country to reporter country
and is reported in thousand US dollars at current prices. The effective applied tariffs rates
(AHS) are reported in both simple average and weighted average rates by the reporter
countries. We collect only the weighted average AHS. We also have both the trade and
tariffs data available for World as a partner and for European Union (EU) as a reporter.
    We then compute the "aggregate weighted average AHS " (weighted by the import
value at the 2-digit ISIC Rev. 3 industries) at the aggregate sector level. The following algo-
rithm is used to input the missing values of "aggregate weighted average AHS" (hereafter
AAHS) rates of certain country-sectors of our dataset.

    1. For reporter countries in the EU, fill in the missings by the AAHS rates reported by
       the EU in the same year. We do not replace the rates by the EU-reported AAHS rates
       before a country joined EU. The timeline of the countries in our dataset who join EU
       is reported in Table 7.

    2. For ROW as a partner, we use data for partner = World to fill in the missing val-
       ues of the corresponding reporter-industry-year. For ROW as a reporter, we use the
       weighted average of AAHS rates of all other 40 countries in the dataset.

    3. If a AAHS rate is still missing after the previous step, use AHHS rate of ROW im-
       puted above to fill in the corresponding industry-year.

    4. Finally, when the AAHS rate is not available in a particular year, we input this value
       using the closest value available in the past years. If none of the past-years data are
       available, we use the closest available one in the proceeding years.

   We use the WIOD data on pre-tariff trade flows and WITS to calibrate the model. To
do so, we match the dollar values of pre-tariff trade flows and pre-tariff sales from WIOD.
Given the pre-tariff IO data, we compute total sales and total trade flows (including tariffs)
using the tariff rates from WITS. We readjust WIOD value-added for all sectors in order to
match WIOD data on pre-tariff output and total producer costs, where total costs include
VA, pre-tariff costs of intermediate goods and tariffs on intermediate goods.


H      Reallocation Effects
This appendix discusses the reallocation effects in Theorem 2 and compares them to terms-
of-trade effects.

                                              64
                        by 1988             by 1995    by 2004                by 2007
                        Belgium             Austria    Cyprus                 Bulgaria
                       Denmark              Finland Czech Republic            Romania
                         France             Sweden     Estonia
                       Germany                        Hungary
                         Greece                         Latvia
                           Italy                      Lithuania
                         Ireland                        Malta
                     Luxembourg                         Poland
                     Netherlands                       Slovakia
                        Portugal                       Slovenia
                          Spain
                    United Kingdom

                     Table 7: (New) Countries in WIOD that join EU by year


    To better understand reallocation effects, we define the change in the factoral terms of
trade to be  f  F (c      ~ Wc
                     f -  f ) d log w f . With fixed factor supplies and in the absence of trans-
fers, the reallocation effect is given by the change in the factoral terms of trade.10 Intuitively,
the factoral terms of trade weighs the change in each factor's price by the households "net"
position to the price of that factor, since each factor may contribute to the household's earn-
ings c                                                  ~ Wc
        f as well as that household's expenditures  f . For instance, if household c owns
factor f and is the only consumer of services produced by factor f , c =         ~ Wc and changes
                                                                                    f      f
in the price of factor f are irrelevant for welfare.
    Once we aggregate to the level of the world, as long as there are no wedges, there are
no reallocation effects. This follows from Theorem 2 since Y   f =  f =  f for all factors
                                                                     W

f and since d T = 0. Hence, at the world level, there are only "pure" technology effects
but no reallocation effects. Furthermore, the "pure" technology effect and the reallocation
effect at the country level aggregate up to their world counterparts. This implies that, if
there are no wedges in the initial equilibrium, then country reallocations sum up to zero:

                        GNEc
                        GNE
                             (d log Wc / d X ) d X = (d log W / d X ) d X = 0.
                   cC

Reallocation effects can therefore be interpreted as zero-sum distributive changes. When
there are pre-existing wedges, reallocation effects are no longer zero-sum, since they can
make everyone better or worse off by changing the efficiency of resource allocation.
   We now define the terms-of-trade decomposition, and proceed to compare, theoretically
  10 Ourdefinition can be seen as a formalization and a generalization of the "double factoral terms of trade"
(in changes) discussed in Viner (1937).


                                                     65
and empirically, the differences between reallocation effects, as defined by Theorem 2 and
Terms of Trade effects.


H.1     Terms-of-Trade Decomposition
We characterize an alternative decomposition of welfare in terms of output and terms-of-
trade effects. We then contrast this decomposition with the reallocation decomposition,
and provide some notable special cases under which the terms-of-trade decomposition or
the reallocation decomposition take especially simple forms.
   We start by defining each country's share of global GDP and GNE.

                                            GDPc                    GNEc
                                     Y
                                     c =         ,            W
                                                              c =        .
                                            GDP                     GNE

Then we have the following.

Proposition 9 (Welfare-Accounting, Terms of Trade). The change in welfare of country c in
response to productivity shocks, factor supply shocks, and transfer shocks can be decomposed into:11

                  Y            Y                         1                                Y
d log Wc =        c
                  W
                  c
                    d log Yc + c
                               W
                               c
                                 d log PYc - d log PWc + W d Tc +
                                                        c                      (cf - W
                                                                                     c
                                                                                       Y
                                                                                       f ) d log  f ,
                                                                                        c

                                                                              f F           c
                    Output              Terms of Trade
                                                                       Transfers and Net Factor Payments

where the change in terms of trade (Y   W
                                    c / c ) d log PYc - d log PWc is


                         Y                                     Y
             (~ Wc -
                i
                         c ~ Yc
                         W
                           i ) d log Ai +       (~ Wc -
                                                   f
                                                               c ~ Yc
                                                               W
                                                                  f ) - d log  f + d log L f ,
            i N          c                     f F             c


with Y    W
      c / c = GDPc / GNEc . The change d log W of world real expenditure can be obtained by
simply suppressing the country index c.

    To understand this result, consider for example a unit change in the productivity of
producer i on the terms of trade. Intuitively, for given factor wages, the productivity shock
affects the terms of trade of country c according to the difference between the country's
exposures to producer i in real expenditure and in real output   ~ Wc - (Y    W ~ Yc
                                                                          c / c ) i . The pro-
                                                                   i
ductivity also leads to endogenous changes in the wages of the different factors d log w f ,
                                                                                         Yc
  11 When   all factors inside a country are owned by the residents of that country, c
                                                                                     f =  f , and so net factor
payments are zero. If in addition, there are no transfers so that Tc = 0, then Y   W
                                                                               c = c and our decomposition
is invariant to changes in the numeraire. Outside of this case, the choice of numeraire influences the break-
down into changes in terms of trade and changes in transfers and net factor payments, but not the sum of the
two.


                                                         66
which given that factor supplies are fixed, coincide with the changes in their factor income
shares d log  f .12 These changes in factor wages in turn affect the country's terms of trade
according to the difference between the country's exposures to producer f in real expendi-
ture and in real output  ~ Wc - (Y    W ~ Yc
                                 c /c ) f .
                           f
   At the world level, there are no terms-of-trade effects (and no transfers or net factor
payments). Furthermore, changes in real output and real expenditure or welfare and their
corresponding deflators for each country aggregate up to their world counterparts. This
implies that changes in the country terms of trade sum up to zero:

                  W    Y   W
                  c [( c / c ) d log PYc - d log PWc ] = d log PY - d log PW = 0,
                cC


where W                           Y
         c = GNEc / GNE and c = GDPc / GDP. Terms-of-trade effects can therefore
be interpreted as zero-sum distributive effects. The same goes for transfers and net factor
payments.


H.2       Terms of Trade vs. Reallocation
Proposition 9 and Theorem 2 provide two decompositions of changes in real expenditure
or welfare with different economic interpretations: the terms-of-trade and reallocation de-
compositions. As long as there are no distortions, both the reallocation effects and the
terms-of-trade effects (and the net-factor-payments and transfer effects) can be interpreted
as zero-sum distributive effects, and both of them can be written in terms of changes in
factor shares. The goal of this section is to compare the two decompositions. Throughout
this discussion, for simplicity, we assume there are no wedges in the initial equilibrium.


Two Hulten-Like Results

To frame our discussion, it is useful to start by stating two different Hulten-like results
for welfare in open economies. We call these "Hulten-like" results because they predict
changes in welfare as a function of initial expenditure shares only without requiring infor-
mation on changes in (endogenous) factor shares.

Corollary 8 (Welfare, Two Hulten-like Results). In the following two special cases, Hulten-like
results give changes in the welfare of a country c as exposure-weighted sums of productivity and
factor supply shocks (and do not feature changes in factor shares).
 12 The   formula actually still applies with endogenous factor supplies.




                                                      67
 (i) Assume that country c receives no transfers from the rest of the world (balanced trade), there
     are no cross-border factor holdings, and international prices are exogenous and fixed (small-
     open economy). Then there are only real output effects, and no terms-of-trade, transfer effects,
     or net factor payment effects, so that the change in welfare is given by

                     d log Wc = d log Yc =           Yc
                                                     f d log L f +           Yc
                                                                             i d log Ai .
                                             f  Fc                   i  Nc


 (ii) Assume either that the world economy is Cobb-Douglas or, if it is not, that we keep the allo-
      cation of resources (the allocation matrix) constant. Then there are only "pure" technology
      effects and no reallocation effects, so that the change welfare is given by:

                          d log Wc =     W
                                         f d log L f +  i d log Ai .
                                          c             Wc

                                       f F                   i N


   Corollary 8 follows from Theorems 9 and 2. It shows that in some special cases, we can
continue to use exposures to predict the effects of productivity and factor supply shocks
on welfare in open economies.
   The two Hulten-like results are very different. Focusing on productivity shocks, the
elasticities d log Wc / d log Ai of real expenditure to productivity shocks are given by expo-
sures in real output Y   c                                            Wc
                        i in case (i) and by exposures in welfare i in case (ii).
   The intuitions underlying the two Hulten-like results are also very different. The orig-
inal Hulten theorem applies in a closed economy (e.g. the world) where there are neither
terms-of-trade effects nor reallocation effects. In case (i), there are no terms-of-trade effects
but there are reallocation effects. In case (ii), there are no reallocation effects, but there are
terms-of-trade effects.
   More generally, we can interpret the real output effects in Theorem 9 and the "pure"
technology effects in Theorem 2 as Hulten-like terms, and the terms-of-trade effects (to-
gether with transfers and net factor payments) and reallocation effects as adjustment terms.
As we saw earlier, these adjustment terms are zero-sum and depend on changes in factor
shares.


Comparing the Terms-of-Trade and Reallocation Decompositions

Both decompositions can be applied at the level of a country and the world. Both decom-
positions isolate a distributive zero-sum term, which aggregates up to zero at the level of
the world economy. These different distributive terms are responsible for departures from
two different versions of Hulten's theorem. The main difference between the two decom-


                                                68
position is their economic interpretations.
    Beyond their differences in interpretation, the two decompositions have different ro-
bustness and aggregation properties, and different data requirements. In these regards,
the reallocation decomposition has several advantages.
    First the reallocation decomposition is based on general equilibrium counterfactual:
"pure" changes in technology coincide with the change in real expenditure that would
arise under the feasible counterfactual allocation which keeps the allocation of resources
constant. This is not the case for the terms-of-trade decomposition: changes in real output
are not the changes in real expenditure that would arise under a specified feasible counter-
factual allocation.
    Second, as discussed in Section 4, this particular general equilibrium counterfactual is
extremely useful conceptually and intuitively in order to unpack our counterfactual re-
sults. This is because reallocation effects (but not "pure" technology effects) depend only
on expenditure substitution by the different producers and households in the economy. By
contrast, terms-of-trade effects also include technology effects.
    Third, the reallocation decomposition is not sensitive to irrelevant changes in the envi-
ronment, because it does not use changes in real output. This is not the case for the terms-
of-trade decomposition: for example, assuming that changes in iceberg trade costs apply
to the importers of a good or to its exporter simply produces different representations of
the same underlying changes in the economy and is immaterial for changes in welfare, but
it does modify the changes in terms of trade of the importers and of the exporter.


                                HH1                        HH2




                                 C                         M




Figure 6: An illustration of the two welfare decompositions in an economy with two coun-
tries, two factors, and two goods. Country 1 has an endowment of a commodity good
(C), and country 2 has an endowment of the manufacturing good (M). The representative
household in country 1 consumes only the manufacturing good, and the representative
household in country 2 consumes a CES aggregate of the two goods with an elasticity of
substitution  .

   Fourth, the two decompositions have different economic interpretations. It is useful to
provide a simple illustrative example. Consider the economy depicted in Figure 6 with two
countries, two factors, and two goods. Country 1 has an endowment of a commodity good
(C), and country 2 has an endowment of the manufacturing good (M). The representative

                                             69
household in country 1 consumes only the manufacturing good, and the representative
household in country 2 consumes a CES aggregate of the two goods with an elasticity of
substitution  :
                                                             
                                  y 2C  -1        y 2 M  -1  -1
                           ¯ 2C (
                                       )  +¯ 2M (      )        .
                                  ¯ 2C
                                  y               ¯2 M
                                                  y
C and M can either be substitutes ( > 1) or complements ( < 1). We denote by 2 the
sales share of the consumption bundle of producer 2, and by C and  M the sales shares
of C and M (the factor income shares), with 2 ¯ 2C =  C .
    Consider a shock d  ¯ 2M = - d ¯ 2C > 0 which shifts the composition of demand away
from C and towards M in country 2. 13 The shock reduces the welfare of country 1 with

                                                   1
                                  d log W1 = -       d log ¯ 2C < 0.
                                                   M

There are neither real output nor "pure" technology effects, and there are equivalent nega-
tive terms-of-trade effects and reallocation effects:

                                                                        1
             d log pC - d log p M = d log C - d log  M = -                d log ¯ 2C < 0.
                                                                        M

This can be seen as a simple illustration of the Prebisch-Singer hypothesis, whereby de-
mand shifts towards manufacturing as countries develop at the expense of commodity
producers.
   Consider next a shock d log C > 0 which increases the endowment of C in country 1.
The effect of the shock is different depending on whether C and M are substitutes (comple-
ments): it improves (reduces) the welfare of country 1 with

                                                         ¯ 2M
                                                         
                                   d log W1 = ( - 1)          d log C;
                                                         M

there are positive real output effects d log Y1 = C d log C > 0 and less (more) negative
terms-of-trade effects

                                                                         ¯ 2M
                                                                         
                   d log pC - d log p M = -C d log C + ( - 1)                 d log C;
                                                                         M
  13 This
        shock can be modeled as a combination of positive and negative productivity shocks d log A2 M =
[ /( - 1)] d log d ¯ 2 M and d log A2C = [ /( - 1)] d log d ¯ 2C for fictitious producers intermediating be-
tween C, M, and the representative household of country 2.




                                                    70
there are no "pure" technology effects, and positive (negative) reallocation effects

                                                        ¯ 2M
                                                        
                        d log C - d log  M = ( - 1)          d log C.
                                                        M

  Finally, consider a shock which increases the endowment of M in country 2. This shock
improves the welfare of country 1 as long as goods are not too substitutable

                                                       ¯ 2M
                                                       
                        d log W1 = d log M - ( - 1)         d log M;
                                                       M

there are no real output effects and positive terms-of-trade effects as long as goods are not
too substitutes with

                                                             ¯ 2M
                                                             
                   d log pC - d log p M = d log M - ( - 1)        d log M;
                                                             M

there are positive "pure" technology effects d log M > 0 and negative (positive) realloca-
tion effects if C and M are substitutes (complements) with

                                                         ¯ 2M
                                                         
                       d log C - d log  M = -( - 1)           d log M.
                                                         M

H.3    Application of Welfare-Accounting Formulas
We end this discussion of the welfare-accounting formulas by decomposing the change
in real expenditure in different countries over time. We implement our two decomposi-
tions: the reallocation decomposition and the terms-of-trade decomposition. We abstract
away from distortions. Unlike our previous applications, these decompositions are non-
parametric in the sense that they do not require taking a stand on the various elasticities of
substitution.
    The left column of Figure 7 displays the cumulative change in each component over
time of the reallocation decomposition, for a few countries (Canada, China, and Japan).
We choose these three countries because they depict a systematic pattern: industrializing
countries, like China, and commodities- or services-dependent industrialized countries,
like Canada, are experiencing positive reallocation, whereas manufacturing-dependent in-
dustrialized countries, like Japan, are experiencing negative reallocation.
    The right column of Figure 7 displays the terms-of-trade decomposition. Commodity
producers like Canada experience large movements in terms of trade due to fluctuations
in commodity prices. Even for countries for which terms-of-trade effects are small, real-
location effects are typically large, indicating that these countries cannot be taken to be


                                             71
            GNE                                                           GNE
            Technology                                                    GDP
0.60        Reallocation ex. KA
                                                              0.60        ToT
            KA                                                            KA




0.40                                                          0.40




0.20                                                          0.20




0.00                                                          0.00


        1996 1998 2000 2002 2004 2006 2008 2010 2012 2014             1996 1998 2000 2002 2004 2006 2008 2010 2012 2014

                                    (a) Canada                                       (b) Canada
            GNE                                                           GNE
            Technology                                                    GDP
1.50        Reallocation ex. KA                               1.50        ToT
            KA                                                            KA




1.00                                                          1.00




0.50                                                          0.50




0.00                                                          0.00

        1996 1998 2000 2002 2004 2006 2008 2010 2012 2014             1996 1998 2000 2002 2004 2006 2008 2010 2012 2014

                                    (c) China                                         (d) China
 0.20                                                          0.20
              GNE                                                          GNE
              Technology                                                   GDP
              Reallocation ex. KA                                          ToT
              KA                                                           KA

 0.10                                                          0.10




 0.00                                                          0.00




-0.10                                                         -0.10




-0.20                                                         -0.20
         1996 1998 2000 2002 2004 2006 2008 2010 2012 2014             1996 1998 2000 2002 2004 2006 2008 2010 2012 2014

                                    (e) Japan                                          (f) Japan

Figure 7: Welfare accounting according to the reallocation decomposition (left column) and
according to the terms-of-trade decomposition (right column), for a sample of countries,
using the WIOD data. KA are changes due to net transfers.


                                                         72
approximately closed.
   Finally, it is interesting to note that the difference between the reallocation effect on the
one hand, and the terms of trade effect and the transfer effect on the other hand identifies
the following technological residual:14

                  ((Y
                    c / c ) i - i ) d log Ai +  (( c / c )  f -  f ) d log Lc .
                        W   Yc  Wc                 Y   W   Yc   Wc

                 i N                                          f F


This residual is a measure of the difference between country c's technological change and
its exposure to world technical change, including the effects of changes in productivities
and in factor supplies. For a closed economy, it is always zero. By comparing the two
columns of Figure 7, we can see that (and by how much) China and Canada are experienc-
ing faster growth in productivities and factor supplies in their domestic real output than in
their consumption baskets, while the pattern is reversed for Japan.


I      Partial Equilibrium Counterpart to Theorem 4
Proposition 10. For a small open economy operating in a perfectly competitive world market, the
introduction of import tariffs reduces the welfare of that country's representative household by

                                                 1
                                                 2
                                         W           i  log yi  log µi ,
                                                   i

where µi is the ith gross tariff (no tariff is µi = 1), yi is the quantity of the ith import, and i is the
corresponding Domar weight.

Proof. To prove this, let e( p)W be the expenditure function of the household. We have
e( p)W = p · q + i (µi - 1) pi yi . Differentiate this once to get c · d p + e( p) d W = q ·
d p + d q · p + i d µi pi yi + i (µi - 1) d( pi yi ). Theorem 2 implies that this can be sim-
plified to e( p) d W = (q - c) · d p + i d µi pi yi + i (µi - 1) d( pi yi ) = i (µi - 1) d( pi yi ),
where the left-hand side is the equivalent variation. Now differentiate this again, and eval-
uate at µi = 1 to get i pi d yi . Hence the second-order Taylor approximation, at µ = 1, is
1                   1
2 i d µi pi d yi = 2 i d log µi pi yi d log yi , and our normalization implies pi yi is equal to its
Domar weight.


    14 That   is, we compute ( log Wh )(X ) d X - (1/W            Y   W
                                                     c ) d Tc - ( c / c ) d log PYc + d log PWc .




                                                         73
J    Duality with Multiple Factors and Tariff Revenues
The duality between trade shocks in an open economy and productivity shocks in a closed
economy extends beyond the one-factor case. In the multi-factor case with pre-existing
tariffs, external productivity shocks (like iceberg shocks) in the open economy translate
into productivity shocks and shocks to factor prices in the closed economy. In this section,
we establish this duality. As an example application, in Appendix L, we show how the
model in Galle et al. (2017), which studies the distributional consequences of trade with a
Roy model, can be generalized to economies with production networks.
    With multiple factors and tariffs, we must use the change in the dual price deflator
 log P W =  log P
          c
                     Y =  log p
                      c
                                  c of the dual economy for given changes in factor prices
and not the change in real expenditure or welfare for given factor supplies. This requires
the choice of a numeraire in the dual closed economy: we use the nominal GDP, which
means that we normalize the nominal GDP of the dual closed economy to one. If there
are import tariffs, the input-output table should be written gross of any tariffs (that is,
including expenditures on tariffs by importers).

Theorem 11 (Exact Duality). The discrete change in welfare  log Wc of the original open econ-
omy in response to discrete shocks to iceberg trade costs or productivities outside of country c is
equal to (minus) the discrete change in the price deflator - log P
                                                                 Y of the dual closed economy in
                                                                   c
                                                    
response to discrete shocks to productivities  log Ai = -(1/ i ) log ic and discrete shocks to
                                        f = - log c . This duality result is global in that it holds
the productivities of the factors  log A                f
exactly for arbitrarily large shocks.

   In other words, shocks to the open economy are equivalent to productivity and factor
price shocks in the closed economy. Note that if there are tariffs, tariff revenues imply
reductions in factor income shares in the original open economy, which translates into
positive shocks to the productivities of the factors in the dual closed economy.

Corollary 9 (First-Order Duality). A first-order approximation to the change in welfare of the
original open economy is:

                           log Wc = - log P
                                          Y 
                                            c                        i  log A
                                                                             i,
                                                       i  Mc + Fc


where applying Hulten's theorem,     i is the sales share of producer i when i  Mc and the sales share
of factor i in the dual closed economy (which we also sometimes write      i ).




                                                 74
Corollary 10 (Second-Order Duality). A second-order approximation to the change in welfare of
the original open economy is:

                                             1              d2 log PY
 log Wc = - log P
                Y 
                  c              i  log Ai - 2  d log A
                                                                      c
                                                                j d log Ai
                                                                                 j  log A
                                                                            log A        i,
                             i  Mc + Fc        i, j Mc + Fc

where applying Baqaee and Farhi (2017a),

                    d2 log PY         d i
            -                 c
                                  =         =  (  k - 1)  k Cov  (k) 
                                                               
                                                                      (i ) ,  ( j) .
                d log A j d log A
                                i         j
                                    d log A  k  Nc


We can re-express the second-order approximation to the change in welfare of the original open
economy as:


 log Wc = - log P
                Y                                 i + 1  (  k - 1) 
                                          i  log A                  k Var  (k)                          i
                                                                                               (i)  log A   .
                  c
                                                      2 k N              
                            i  Mc + Fc                     c                     i  Mc + Fc


Corollary 11 (Exact Duality and Nonlinearities with an Industry Structure). For country c
with an industry structure, we have the following exact characterization of the nonlinearities in
welfare changes of the original open economy.

 (i) (Industry Elasticities) Consider two economies with the same initial input-output matrix and
     industry structure, the same trade elasticities, but with lower elasticities across industries for
     one than for the other so that    for all industries  . Then  log Wc =  log Y               c 
      log Wc =  log Y     c so that negative (positive) shocks have larger negative (smaller positive)
     welfare effects in the economy with the lower industry elasticities.

 (ii) (Cobb-Douglas) Suppose that all the elasticities of substitution across industries (and with the
      factor) are equal to unity ( = 1), then  log Wc = - log P       Y is linear in  log A.
                                                                        c
                                                                                            

(iii) (Complementarities) Suppose that all the elasticities of substitution across industries (and
      with the factor) are below unity (  1), then  log Wc = - log P                             
                                                                           Y is concave in  log A,
                                                                            c

      and so nonlinearities amplify negative shocks and mitigate positive shocks.

(iv) (Substituabilities) Suppose that all the elasticities of substitution across industries (and with
     the factor) are above unity (  1), then  log Wc = - log P           Y is convex in  log A,
                                                                           c
                                                                                                 and
     so nonlinearities mitigate negative shocks and amplify positive shocks.

 (v) (Exposure Heterogeneities) Suppose that industry  is uniformly exposed to the shocks as
     they unfold, so that Var  () Mc +Fc                  = 0 for all s where s indexes the
                                              (),s  log A
                                s



                                                    75
                                                         ,s = s log A
      dual closed economy with productivity shocks  log A             , then  log Wc =
      - log P  Y is independent of  . Furthermore
                c



         log Wc = - log P
                        Y =
                          c                   log A
                                                  
                                  Mc +Fc
                              1
                         +
                             0  N
                                   (  - 1)  ,s Var ()
                                                  s
                                                                              
                                                                    (),s  log A
                                                                                   (1 - s)ds.
                                  c                       Mc +Fc


Closed-form Expression for Example in Figure 3

The exact expression for the impact of the trade shock on welfare can be found in closed
form by exploiting the recursive structure of the contraction mapping described in the
proof of Corollary 5 because this example features no reproducibility:

                       1          M N  -(1- ) log A
                                                  E    N  1-       N-M
         log Wc = -      log       ( E e            +1-  E ) 1-  +                     .
                      1-          N M                  M            N


K      Computational Appendix
This appendix describes our computational procedure, as well as the Matlab code in our
replication files. Before running the code, customize your folder directory in the code ac-
cordingly.
    Writing nested-CES economies in standard-form is useful for intuition, but it is compu-
tationally inefficient since it greatly expands the size of the input-output matrix. Therefore,
for computational efficiency, we instead use the generalization in Appendix A to directly
linearize the nested-CES production functions without first putting them into standard
form.


Overview
First, we provide an overview of the different files before providing an in depth description
of each.

    1. main load data.m: First part of main code that calculates expenditure shares from
       data.

    2. main dlogW.m: Second part of the main code that loads inputs and calls functions to
       iterate.

    3. AES func.m: Function that calculates Allen-Uzawa elasticities of substitution.

                                              76
  4. Nested CES linear final.m: Function that solves the system of linear equations de-
     scribed in Theorem 3.

  5. Nested CES linear result final.m: Function that calculates derivatives that are used
     to derive welfare changes or iterate for large shocks.

   While 1. and 3. are specific to our quantitative application, 2., 4. and 5. are general
purpose functions that can be used to derive comparative statics and solve any model in
the class we study. We now describe each part of the code in some detail.


1. Main code that loads data
Code: main load data.m

Data input:

  1. Number of countries (C), Number of sectors in each country (N), Number of factors
     in each country (F)

  2. Trade elasticity when a country imports or buys domestic product (trade_elast: N
     by 1 vector)

  3. Input-output matrix across country and sectors (Omega_tilde: CN by CN matrix,
     (i, j) element: expenditure share of sector i on sector j)

  4. Household expenditure share on heterogenous goods (beta: CN by C matrix, (i, c)
     element: expenditure share of household c on sector i)

  5. Value-added share (alpha: CN by 1 vector, (i, 1) element: value-added share of sector
     i), Primary Factor share (alpha_VA: CN by F matrix, (i, f ) element: expenditure share
     of sector i on factor f out of factor usage)

  6. A ratio of GNE of each country to world GNE (GNE_weights: C by 1 vector)

  7. (Optional) If economy has initial tariff,

      (a) Tariff matrix when household (column) buys goods (row) ­ Tariff_cons_matrix_new:
          CN by C matrix ((i, c) element: tariff rate of household c, destination, on sector
          i, origin)
      (b) Tariff matrix when a sector (row) buys goods (column) ­Tariff_matrix_new:
          CN by CN matrix ((i, j) element: tariff rate of sector i, destination, on sector j,
          origin)

                                             77
User input:

  1. If the economy does not have initial tariff, initial_tariff_index= 1. Otherwise, if
     the economy has initial tariff, =2.


Outputs:

  1. data, shock struct

From the inputs, the code automatically calculates input shares (beta_s, beta_disagg,
Omega_s, Omega_disagg, Omega_total_C, Omega_total_N) and the input-output matrix (Omega_total_ti
Omega_total). These variables are used to calculate Allen-Uzawa elasticities of substitu-
tion and solve system of linear equations.


2. Main code that loads inputs and calls functions
Code: main dlogW.m

Data input:

  1. data, shock struct from main load data.m


User input:

  1. Elasticity of substitution parameters for nested CES structure: Elasticity of substitu-
     tion (1) across Consumption (sigma), (2) across Composite Value-added and Interme-
     diates (theta), (3) across Primary Factors (gamma), and (4) across Intermediate Inputs
     (epsilon)

  2. If the economy gets universal iceberg trade cost shock, shock_index = 1. Otherwise,
     if the economy gets universal tariff shock, = 2.

  3. When intensity of shock is x%, intensity = x.

  4. When shock is discretized by x /y% and model cumulates the effect of shocks y times,
     ngrid = y.

  5. Ownership structure

      (a) Ownership structure of factor (Phi_F: C by CF matrix, (c, f ) element: Factor
          income share of factor f owned by household c)



                                            78
      (b) Ownership structure of tariff revenue (Phi_T: C+CN by CN+CF by C 3-D ma-
          trix, (i, j, c) element: Tariff revenue share owned by household c when house-
          hold/sector i buys from sector/factor j)

  6. (Optional) Technical details about how to customize iceberg trade cost shock matrix
     dlog and tariff shock matrix dlogt are described in Nested CES linear final.m


Output:

  1. dlogW (C by ngrid matrix) collects change in real income of each country for each
     iteration of discretized shocks

  2. dlogW_sum (C by 1 vector) shows change in real income of each country from lin-
     earized system by summing up dlogW

  3. dlogW_world (1 by ngrid vector) is change in real income of world for each iteration
     of discretized shocks

  4. dlogR (C by ngrid matrix) collects reallocation terms of each country for each itera-
     tion of discretized shocks

  5. dlogR_sum (C by 1 vector) shows reallocation terms of each country from linearized
     system by summing up dlogR

  6. dlogY_2nd shows change in world GDP to a 2nd order


3. Allen-Uzawa Elasticity of Substitution (AES)
This code computes Allen-Uzawa elasticities of substitution for each sector. These are then
used following Appendix A.


Code: AES func.m

Inputs:

  1. Number of countries (C), Number of sectors in each country (N), Number of factors
     in each country (F)

  2. Elasticity of substitution parameters for nested CES structure: Elasticity of substitu-
     tion (1) across Consumption (sigma), (2) across Composite Value-added and Interme-
     diates (theta), (3) across Primary Factors (gamma),and (4) across Intermediate Inputs
     (epsilon)

                                            79
  3. Trade elasticity when a country imports or buys domestic product (trade_elast: N
     by 1 vector)

  4. Value-added share (alpha: CN by 1 vector, (i, 1) element: value-added share of sector
     i)

  5. Input shares:

      (a) bic (beta_s : C by N matrix, (c, i ) element: How much household c consumes
          sector i good)
      (b)  ic
           j (Omega_s: CN by N matrix, (ic, j ) element: How much sector i in country c
          uses sector j good)
      (c) ~ 0c (Omega_total_C : C by CN matrix, (c, jm) element: How much household c
            jm
          buys from sector j in country m)
      (d)  ~ ic (Omega_total_N : CN by CN+CF matrix, (ic, jm) element: Hom much sector
             jm
          i in country c buys from good/factor j in country m)


Outputs:

  1. 0c (ic , jm) (AES_C_Mat: CN by CN by C 3-D matrix, (ic , jm, c) element: AES of house-
     hold in country c that substitutes good i in country c and good j in country m)

  2. kc (ic , jm) (AES_N_Mat: CN by CN+CF by CN 3-D matrix, (ic , jm, kc) element: AES of
     producer of sector k in country c that substitutes good i in country c and good/factor
     j in country m)

  3. kc ( f c, jm) (AES_F_Mat: CF by CN+CF by CN 3-D matrix, ( f c, jm, kc) element: AES of
     producer of sector k in country c that substitutes factor f in country c and good j in
     country m)

   To describe how this code functions, we introduce the following notation.


Notation:
      kc be the bilateral price when industry or household k in country c buys from industry
Let pic
i in country c . That is
                                         kc    kc kc
                                        pic = ic tic pic ,

where ickc is an iceberg cost on kc purchasing goods from ic and tkc is a tariff on kc pur-
                                                                  ic
chasing goods from ic , and where pic is the marginal cost of producer i in country c .

                                            80
Define
                                        p jm xic
                                              jm                      tic        ic
                                                                       jm p jm x jm
                            ic
                            jm      =                 ,   ~ ic
                                                            jm    =                            ,
                                        pic yic                             pic yic
where p jm xic
             jm is expenditures of ic on jm not including the import tariff. Notice that every
row of  ~ ic should always sum up to 1. Also, assume that C is a set of countries, and Fc is
          jm
the factors owned by Household in country c. Then,
   Households: The price of final consumption in country c
                                                                              1
                                                                             1- 
                                                                     1- 
                                P0c =         bic          Pi0c                        ,
                                              i

where bic = mC ~ 0c . The price of consumption good from industry i in country c
                 im

                                                                                            1
                                                                                           1-  i
                                                                           1-  i
                           Pi0c =            0c
                                             m  t0 c 0c
                                                 im im pim                                         ,
                                        mC

      0c = 
where m     ~ 0c /  v  C ~ 0c .
              im           iv
  Producers: The marginal cost of good i produced by country c

                                                                                            1
                                      1-                1-                                 1- 
                            pic = ic Pw ic
                                           + (1 - ic ) PM ic



where ic =  f  Fc ~ ic . The price of value-added bundled used by producer i in country c
                    fc

                                                                             1
                                                                            1- 

                                                      
                                                             1- 
                                  pwic =                  ic
                                                          f wfc                    ,
                                                  f  Fc


        f =  f c / d Fc dc . The price of intermediate bundle used by producer i in
where ic    ~ ic        ~ ic
country c
                                                                               1
                                                                              1- 
                                                                     1- 
                               p Mic =         ic
                                               j               qic
                                                                j                      ,
                                                  j

where  ic
        j =      mC   ~ ic /(1 - ic ). The price of intermediate bundle good j used by
                        jm
producer i in country c

                                                                                        1
                                                                                       1-  i
                                                                           1-  i
                           qic
                            j =              ic
                                             jm ic ic
                                                jm t jm p jm                                       ,
                                        mC

      ic = 
where jm   ~ ic / vC ~ ic .
             jm        iv


                                                          81
   Deriving Allen-Uzawa elasticities for nested-CES models is straightforward. To do so,
we proceed as follows:


Derivation:

(1) 0c (ic , jm)    Household demand in country c for good i from c is

                                                              c    - i             -
                                      0c                   p0               Pi0c
                                     xic   =   ~ 0c
                                                            ic
                                                                                         Cc
                                                 ic
                                                           Pi0c             P 0c

Hence

                                                                              jm -  jm
                         0c       1( jm = ic ) - 1( j = i )0 c    1( j = i ) 0 c   ~ 0c
                 1  log xic                                jm
 0c (ic , jm) = 0c          = - i                              -                        .
                ~  log p0c
                  jm     jm                   ~ 0c
                                                jm                        ~ 0c
                                                                             jm


This can be simplified as

                      i                                1                   i         1
0c (ic , jm) =                + 1-                                     =       + 1-                   when i = j & ic   jm,
                    vC ~ 0c
                         iv                     vC ~ 0c
                                                     iv
                                                                           bic      bic
                                             i              1
                     0c (ic , jm) = -             + i + 1-                           when ic = jm.
                                            ~
                                             jm bic
                                              0 c          bic

Otherwise, 0c (ic , jm) = .


(2) kc (ic , jm)    When k is not a household, demand by k in country c for good i from c is

                                                 kc        - i              -             -
                            kc       ~ kc
                                                pic                Pikc             kc
                                                                                   PM
                           xic   =     ic                                                     Ykc .
                                                Pikc                kc
                                                                   PM              pkc

Hence

                        kc                                kc
                                 1( jm = ic ) - 1( j = i )jm              kc - 1( j
                                                                1( j = i )jm                                               kc  kc
                                                                                                                        F )jm
                1  log xic                                                                                                     j
kc (ic , jm) = kc          = - i                             -
               ~  log pkc
                 jm     jm                   ~ kc
                                               jm
                                                                             ~ kc
                                                                               jm

                 1( j        kc  kc - 
                          F )jm       ~ kc
                                 j      jm
            -                                          .
                              ~ kc
                                jm


This can be simplified as




                                                                  82
                          i                    1        1
  kc (ic , jm) =                  +               -
                     (1 - kc ) kc
                               j
                                            1 - kc (1 - kc ) kc
                                                             j
                                                                          1
                                                        + 1-                        when i = j  N & ic    jm,
                                                                       1 - kc

                      i           i                       1        1                                1
kc (ic , jm) = -          +                 +                -                           + 1-             when ic = jm,
                     ~ kc
                       jm   ( 1 -  kc )  kc
                                         j
                                                       1 - kc (1 - kc ) kc
                                                                        j
                                                                                                 1 - kc
                                                                     1
                      kc (ic , jm) =              + 1-                       when i      j  N,
                                         1 - kc                   1 - ic
and when j  F, kc (ic , jm) =  .


(3) kc ( f c, jm)    Lastly, when k is not a household, demand by k in country c for factor f is

                                                      pfc     -              -
                                                                      pwkc
                                  x kc
                                    fc   =~ kc
                                            fc                                   Ykc .
                                                      pwkc            pkc

Hence,

                                                                              j -  jm
                         kc       1( jm = f c) - 1( jm  Fc )ic   1( jm  Fc )ic    ~ kc
                 1  log x f c                               j
kc ( f c, jm) = kc            = -                              -                       .
                ~  log pkc
                  jm     jm
                                               ~ kc
                                                 jm                      ~ kc
                                                                           jm

Notice that kc ( f c, jm) =  if j  N . Also,

                                                  1                           1
 kc ( f c, jc) =                 + 1-                             =      + 1-             when j  F & m = c,
                     g Fc ~ kc
                            gc               g Fc ~ kc
                                                    gc                kc      kc

                                                        1
                       kc ( f c, jc) = -        +  + 1-                      when f c = jm.
                                           ~
                                            f c kc
                                             kc         kc


4. Solving system of linear equations
Code: Nested CES linear final.m

Input:

   1. Number of countries (C), Number of sectors in each country (N), Number of factors
      in each country (F)

   2. Allen-Uzawa elasticities of substitution:

         (a) 0c (ic , jm) (AES_C_Mat: CN by CN by C 3-D matrix)

                                                             83
      (b) kc (ic , jm) (AES_N_Mat: CN by CN+CF by CN 3-D matrix)
      (c) kc ( f c, jm) (AES_F_Mat CF by CN+CF by CN 3-D matrix)

  3. Input-output matrix and Leontief inverse

      (a) ~ ic (Omega_total_tilde: C+CN+CF by C+CN+CF matrix) : Standard form of
            jm
          Cost-based IO matrix
      (b) icjm (Omega_total: C+CN+CF by C+CN+CF matrix) : Standard form of Revenue-
          based IO matrix
      (c) ~ ic (Psi_total_tilde) : Leontief inverse of 
            jm
                                                       ~ ic
                                                         jm

          jm (Psi_total) : Leontief inverse of  jm
      (d) ic                                   ic


  4. Initial sales share CN (lambda_CN: C+CN by 1 vector) and factor income  F (lambda_F:
     CF by 1 vector)

  5. Ownership structure of factor (Phi_F: C by CF matrix) and tariff revenue (Phi_T:
     C+CN by CN by C 3-D matrix) defined in main dlogW.m

  6. (Optional) If economy has initial tariff, initial tariff matrix (init_t: C+CN by CN
     matrix) defined in main load data.m

Current version of code simulates universal iceberg trade cost or tariff shock. If the user
wants to specify the shocks, customize

  1. universal iceberg trade cost shock matrix (dlogtau: C+CN by CN+CF matrix, (i, j)
     element: log change in iceberg trade cost when household/sector i buys from sec-
     tor/factor j) or

  2. tariff shock matrix (dlogt: C+CN by CN+CF matrix, (i, j) element: log change in
     tariff when household/sector i buys from sector/factor j).


Output:

Let d F be the vector of changes in the sales of primary factors and

                         d  F ,c , =     c ,ic,jm ic    ic
                                                  jm ( t jm - 1) d ic
                                       ic jm


be the change in wedge-revenues of household c due to changes in sales shares, where
c ,ic, jm is the share of tax revenues on ic's purchases of jm that go to household c . The


                                               84
linear system in Theorem 3 can be written as:

                                 d F            d F
                                         =A            +B
                                 d F            d F

This code outputs:

  1. A (C+CF by C+CF matrix) and B (C+CF by 1 vector).

Using these outputs, the code inverts the system and solves for d F (dlambda_F) and d F
(dlambda_F_star), which are used to obtain derivatives calculated by
Nested CES linear result final.m. It updates   ~ and other variables which are used in the
next iteration.


5. Calculate derivatives
Code: Nested CES linear result final.m

Input:

All inputs used in Nested CES linear final.m are also used in this code. Additionally, it
requires

  1. GNE_weights (C by 1 vector): A ratio of GNE of each country to world GNE

  2. d F (dlambda_F) and d F (dlambda_F_star) : Solutions from Nested CES linear final.m


Output:

  1. d (dlambda_result: C+CN+CF by 1 vector): Change in sales shares;

  2. d (dchi_std: C+CN+CF by 1 vector): Change in household income shares;

  3. dlogP (dlogP_Vec: C+CN+CF by 1 vector): Change in either the price index (house-
     hold), marginal cost (sector), or factor price;

  4. d~ ic (dOmega_total_tilde: C+CN+CF by C+CN+CF matrix) : Change in Cost-
        jm
     based IO matrix;

  5. dicjm (dOmega_total: C+CN+CF by C+CN+CF matrix) : Change in Revenue-based
     IO matrix.




                                           85
For each iteration, change in real income of country c is

                                d log Wc = d log c - d log Pc

where d log Pc is change in price index of household c. Meanwhile, outputs are used to up-
date , , ,   ~ , which are used as a simulated data with discretized shock in next iteration.



L    Extension to Roy Models
Galle et al. (2017) combine a Roy-model of labor supply with an Eaton-Kortum model of
trade to study the effects of trade on different groups of workers in an economy. They
prove an extension to the Arkolakis et al. (2012) result that accounts for the distributional
consequences of trade shocks. In this section, we show how our framework can be adapted
for analyzing such models. We generalize our analysis to encompass Roy-models of the
labor market, and show how duality with the closed economy can then be used to study
the distributional consequences of trade.
    Suppose that Hc denotes the set of households in country c. As in Galle et al. (2017),
households consume the same basket of goods, but supply labor in different ways. We
assume that each household type has a fixed endowment of labor Lh , which are assigned
to work in different industries according to the productivity of workers in that group and
the relative wage differences offered in different industries.
    As usual, let world GDP be the numeraire. Define h      f to be type h's share of income
derived from earning wages f
                                               h f  f
                                        h f =         ,
                                                h
where h = k F hk k . The Roy model of Galle et al. (2017) implies that

                                                          1
                                                      h
                                                              Lh
                                                          h
                               h            h    wf
                               h
                                 =      f        wf               h
                                                                      ,
                                        f                     L

where h is the supply elasticity, variables with overlines are initial values, Lh is the stock
of labor h has been endowed with (since we analyze log changes, only shocks to the en-
dowment value are relevant). Galle et al. (2017) show that the above equations can be mi-
crofounded via a model where homogenous workers in each group type draw their ability
for each job from Frechet distributions, and choose to work in the job that offers them the
highest return. The Roy model generalizes the factor market, with h = 1 representing the
case where labor cannot be moved across markets by h. If h > 1 then h can take advantage

                                                86
of wage differentials to redirect its labor supply and boost its income. When   , labor
mobility implies that all wages in the economy are equalized (and the model collapses to a
one-factor model).

Proposition 12 (Exact Duality). The discrete change in welfare  log Wh of group h  Hc of the
original open economy in response to discrete shocks to iceberg trade costs or productivities outside
of country c is equal to (minus) the discrete change in the price deflator - log P   Y of the dual
                                                                                       g
                                                                       
closed economy in response to discrete shocks to productivities  log Ai = -(1/ i ) log ic and
discrete shocks to factor wages  log A    f = - 1  log h . This duality result is global in that it
                                               h           f
holds exactly for arbitrarily large shocks.

   In the case where   , we recover the one-factor version of Duality in Theorem 7.
   Of course, due to the fact that factor shares hf are endogenously respond to factor
prices, Theorem 3 can no longer be used to determine how these shares will change in
equilibrium. Therefore, we extend those propositions here.

Proposition 13. The response of the factor prices to a shock d log Ak is the solution to the following
system:

   1. Product Market Equilibrium:

                  d log l                                                              d log w f
              l
                  d log Ak
                           =                 j (1 -  j )Cov( j)    (k) +  ( f )                  ,
                                                                                       d log Ak (l )
                               j{ H , N }                                      f

                                                                       d log w f
                                (l                    
                                      Wh
                           +                 - l )            h f  f               .
                               h H                    f  Fc
                                                                       d log Ak


   2. Factor Market Equilibrium:

      d log  f =         E(h) h E(h) d log w f - d log w                   + E(h) (d log w) + (d log L) .
                   h H


Given this, the welfare of the hth group is

                    d log Wh
                             =  s  h
                                     - W
                                       s
                                         h            W
                                           d log ws + k h + d log Lh .
                    d log Ak   s F

   The product market equilibrium conditions are exactly the same as those in Theorem 3,
but now we have some additional equations from the supply-side of the factors (which are
no longer endowments). Letting h = 1 for every h  H recovers Theorem 3.



                                                      87
M     Heterogenous Households Within Countries
To extend the model to allow for a set of heterogenous agents h  Hc within country c  C,
we proceed as follows. We denote by H the set of all households. Each household h in
country c maximizes a homogenous-of-degree-one demand aggregator

                                            Ch = Wh ({chi }i N ),

subject to the budget constraint

                                     pi chi =  h f w f L f + Th ,
                                   i N                f F


where chi is the quantity of the good produced by producer i and consumed by the house-
hold, pi is the price of good i, h f is the fraction of factor f owned by household, w f is the
wage of factor f , and Th is an exogenous lump-sum transfer.
    We define the following country aggregates: cci = h Hc chi , c f = h Hc h f , and
Tc = h Hc Th . We also define the HAIO matrix at the household level as a ( H + N + F ) ×
( H + N + F ) matrix  and the Leontief inverse matrix as  = ( I - )-1 .
    All the definitions in Section 2 remain the same. In addition, we introduce the corre-
sponding household-level definitions for a household h. First, the nominal output and the
nominal expenditure of the household are:

              GDPh =    h f w f L f ,           GNEh =           pi chi =  h f w f L f + Th ,
                       f F                                      i N           f F


where we think of the household as a set producers intermediating the uses by the different
producers of the different factor endowments of the household. Second, the changes in real
output and real expenditure or welfare of the household are:

                                f h d log L f ,                                f h d log w f ,
                                       Y                                            Y
                 d log Yh =                                 d log PYh =
                              f F                                            f F


                               i                                               i
                                       Wh                                           Wh
                d log Wh =                  d log chi ,        d log PWh =               d log pi ,
                              i N                                            i N
       Y                                    W
with  f h = h f w f L f / GDPh and i h = pi chi / GNEh . Third, the exposure to a good or
factor k of the real expenditure and real output of household h is given by

                                        i                                f h  f k,
                              Wh                Wh              Y            Y
                             k     =                 ik ,      k h =
                                       i N                             f F


                                                          88
                    W                            Y
where recall that i h = pi chi / GNEh and  f h = h f w f L f / GDPh . The exposure in real
output to good or factor k has a direct connection to the sales of the producer:

                                     Y                 hk pk yk
                                     k h = 1{ k  F }            ,
                                                       GDPh

        Y
where k h = 1{k F} hk ( GDP/ GDPh )k the local Domar weight of k in household h and
where hk = 0 for k  N to capture the fact that the household endowment of the goods
are zero. Fourth, the share of factor f in the income or expenditure of the household is
given by
                                            h f w f L f
                                     h f =              .
                                             GNEh
   The results in Section 3 go through without modification. Theorems 1 and 2 can be
extended to the level of a household h by simply replacing the country index c by the
household index h.
   The results in Section 4 go through except the term on the second line of (6) must be
replaced by
                                        W
                                       i h - i
                                     i  h f  f ,
                                   h H

where we write i and i interchangeably when i  F is a factor.
   The results in Section 5 go through with the following changes. Theorem 4 goes through
without modification, and extends to the household level where  log Yh  0. Proposition
5 goes through with some minor modifications. The world Bergson-Samuelson welfare
function is now W BS = h W       h log Wh , changes in world welfare are measured as  log ,
where  solves the equation W BS (W 1 , . . . , W H ) = W BS (W1 /, . . . , WH /), where W h are
the values at the initial efficient equilibrium. We use a similar definition for country level
welfare c , and the same notation for household welfare h . Changes in world welfare are
given up to the second order by

                      log    log W + CovW  log W
                                               h ,  log PWh ,
                                                  h


changes in country welfare are given up to the first order by

                         log c   log Wc   log W
                                              c -  log PWc ,


and the change in country welfare up to the first order by

                         log h   log Wh   log W
                                              h -  log PWh .


                                                89
    Theorems 6 goes through with some minor modifications. The final term on the last
line must be replaced by

                       1
                       2 l     W        W           Wc
                                 c  log c  log µl ( l - l ).
                           N c H




                                         90
N     Proofs
Throughout the proofs, let c be the share of total world income accruing to country c.

Proof of Theorem 1. Nominal GDP is equal to

                                 PYc Yc =    (1 - 1/µi ) pi yi +                       wf Lf
                                            i  Nc                              f  Fc


Hence

               d log PYc + d log Yc =           (1 - 1/µi )Yc
                                                           i d log                     (1 - 1/µi )Y
                                                                                                  i
                                                                                                    c

                                              i  Nc

                                          +           Yc
                                                      f d log w f + d log L f
                                              f  Fc

                                 d log Yc =     (1 - 1/µi )Yc
                                                           i d log                     (1 - 1/µi )Y
                                                                                                  i
                                                                                                    c

                                              i  Nc

                                          +           Y                                Yc
                                                      f d log w f + d log L f - d log P .
                                                       c

                                              f  Fc


The price of domestic goods is given by

              d log pi = d log µi - d log Ai +                      ~ ij d log p j +            ~ ij d log p j ,
                                                           j Nc                          j Nc


which implies that

    d log p = ( I - ~ D )-1 d log µi - d log Ai + ~ F (d log  - d log L) + ~ M d log p M ,


where  ~ D is the cost-based domestic IO table, ~ F are cost-based factor shares, and ~ M are
cost-based intermediate import shares, and d log p M represents the change in the price of
imported intermediate goods. Use the fact that

          d log PYc =            Yc ,i d log pi -                 Yc
                                                                  i d log pi
                         i  Nc                        i  N - Nc

                     =           ~ Yc (d log µi - d log Ai ) +
                                   i                                           ~ Yc d log  f - d log L f
                                                                                 f
                         i  Nc                                         f  Fc

                     +               ~ Yc d log pi -
                                       i                            Yc
                                                                    i d log pi .
                         i  N - Nc                      i  N - Nc




                                                           91
For an imported intermediate

                                    d log pi = d log Y
                                                     i - d log qi + d log GDP
                                                      c




Substitute this back to get

d log Yc =     (1 - 1/µi )Yc
                          i d log                     (1 - 1/µi )Y
                                                                 i
                                                                   c
                                                                     +                      Yc
                                                                                            f d log w f + d log L f
             i  Nc                                                                  f  Fc

        -            ~ Yc (d log µi - d log Ai ) -
                       i                                             ~ Yc d log  f - d log L f
                                                                       f
             i  Nc                                           f  Fc

        -                ~ Yc d log
                           i            pi +               Yc
                                                           i d log        pi
             i  N - Nc                         i  N - Nc

        =       f d log  f - 
                Yc                                   ~ Yc (d log µi - d log Ai ) -
                                                       i                                               ~ Yc d log  f - d log L f
                                                                                                         f
             f  Fc                           i  Nc                                             f  Fc

        -                 ~ Yc - Yc
                            i    i               d log Y
                                                       i - d log qi + d log GDP
                                                        c

             i  N - Nc

        =            ~ Yc d log Ai +
                       i                            ~ Yc d log L f +
                                                      f                                ~ Yc - Yc d log qi
                                                                                         i    i
             i  Nc                          f  Fc                      i  N - Nc

        +       Y
                f
                  c
                            d log Y
                                  f + d log GDPc -
                                   c
                                                                                  ~ Yc d log µi -
                                                                                    i                          ~ Yc d log Yc + d log GDPc
                                                                                                                 f        f
             f  Fc                                                        i  Nc                        f  Fc

        -                 ~ Yc - Yc
                            i    i               d log Yc
                                                       i + d log GDP
             i  N - Nc

        =            ~ Yc d log Ai +
                       i                            ~ Yc d log L f +
                                                      f                                ~ Yc - Yc d log qi
                                                                                         i    i
             i  Nc                          f  Fc                      i  N - Nc

        -            ~ Yc d log µi -
                       i                         ~ Yc d log Yc -
                                                   f        f                          ~ Yc - Yc
                                                                                         i    i                d log Y
                                                                                                                     i
                                                                                                                       c

             i  Nc                       f  Fc                            i  N - Nc


        + 1-                     ~ Yc
                                   f     -                 ~ Yc - Yc
                                                             i    i               d log GDPc
                         f  Fc               i  N - Nc

        =            ~ Yc d log Ai +
                       i                            ~ Yc d log L f +
                                                      f                                ~ Yc - Yc d log qi
                                                                                         i    i
             i  Nc                          f  Fc                      i  N - Nc

        -            ~ Yc d log µi -
                       i                         ~ Yc d log Yc -
                                                   f        f                          ~ Yc - Yc
                                                                                         i    i                d log Y
                                                                                                                     i
                                                                                                                       c
                                                                                                                         .
             i  Nc                       f  Fc                            i  N - Nc


The last line follows from the fact that


                                            ~ Yc +
                                              f                   ~ Yc = 1 +
                                                                    i                             Y
                                                                                                  i
                                                                                                    c
                                                                                                      .
                                    f  Fc             i  N - Nc                       i  N - Nc




                                                                     92
Proof of Theorem 2. Note that welfare is given by

                                                              f  F c f w f L f
                                             Wc =                              .
                                                                   PWc

Hence, letting world GDP be the numeraire,

                         d log Wc =      cf                  d log  f - ~ (W )
                                                                            c
                                                                                          d log p.
                                         f


Use the fact that

                     d log pi =   ~ ij d log A j +  ~ if                         d log  f - d log L f
                                  j N                             f F


to complete the proof.

Proof of Theorem 3. For each good,

                                        i =      Wc ,i c +   ji  j ,
                                                     c                   i

where c is the share of total income accruing to country c and Wc ,i is the share of income
household c spends on good i. This means

 i d log i =    c Wc ,i d log Wc ,i +   ji  j d log  ji +   ji d  j +  Wc ,i c d log c .
                 c                                       j                            j              c


Now, note that
                            d log Wc ,i = (1 - c ) d log pi - d log Pyc

                 d log  ji = (1 -  j ) d log pi - d log Pj + d log µ j - d log µ j
                                                         f               
                           d log c =                     c
                                                           d log  f +  i d log µi .
                                                                         µ
                                             f  Fc                    i c i

                          d log pi = ~ (d log µ - d log A) + ~~ d log .

                        d log Pyc = b ~ (d log µ - d log A) + b ~~ d log .

   For shock d log µk , we have


   d log Wc ,i = (1 - c )         ~ ik +  
                                          ~ i f d log  f -  W , j                         ~ jk +   j f d log  f
                                                                                                                  .
                                                             c
                                         f                                   j                   f




                                                                 93
     d log  ji = (1 -  j )               ~ ik +  
                                                 ~ i f d log  f - ~ jk -   j f d log  f                                     -  j d log µ j .
                                                    f                                                f

   Putting this altogether gives


d l =    (1 - c )c Wc ,i                    ~ ik +  ~ i f d log  f -  W , j
                                                                       c
                                                                                                                 ~ jk +   j f d log  f
                                                                                                                                               il
        i       c                                       f                                        j                      f


    +   (1 -  j )  j µ - 1 ~
                       j  ji
                                                ~ ik +  
                                                        ~ i f d log  f - ~ jk -   j f d log  f                                   il
        i       j                                           f                                            f

    - k k  ki il +  c  Wc ,i il d log c .
                    i            c          i

Simplify this to


d l =   (1 - c )c  Wc ,i                        ~ ik +  
                                                        ~ i f d log  f                           il
        c                    i                                  f


    -        Wc ,i        ~ jk +   j f d log  f
                                                                              Wc ,i il
            i                        f                                           i


    +  (1 -  j )  j µ -
                      j   ji
                        1 ~                     ~ ik +  ~ i f d log  f                           il -    ~ ji il
                                                                                                                              ~ jk +   j f d log  f
                                                                                                                              
        j                        i                          f                                                i                         f

    - k k (kl - 1(l = k)) +  c  Wc ,i il d log c .
                                                c       i

Simplify this further to get


                        d l =    (1 - c )c Covb(c)                          ~ (k) +  
                                                                                     ~ ( f ) d log  f , (l )
                                 c                                                           f


                                             j   ji
                           +  (1 -  j )  j µ - 1 ~                                   ~ ik +  
                                                                                             ~ i f d log  f            il
                                 j                                  i                            f


                           -         ~ ji il                ~ ji ~ ik +  ~ ji  i f d log  f
                                     i                          i                        i           f

                           - k k (kl - 1(l = k)) +  c  Wc ,i il d log c ,
                                                                                     c       i

Using the input-output covariance notation, write


   d l =        (1 - c )c Cov(Wc )                  ~ (k) +  
                                                             ~ ( f ) d log  f , (l )
                c                                                       f


                                                                            94
         +  (1 -  j )  j µ - 1
                           j Cov~ ( j)
                                             ~ (k) +  
                                                      ~ ( f ) d log  f , (l )
            j                                          f



         - (1 - k )k (kl - 1(l = k)) - k k (kl - 1(l = k)) +  c  Wc ,i il d log c ,
                                                                                            c      i




This then simplifies to give from the fact that i Wc ,i il = W c
                                                             l :

                                                                                   F
                   l d log l =                            j Cov ( (k ) +  d log  f , (l ) )
                                           (1 -  j )  j µ - 1     ~
                                 j  N ,C                                           f

                             - k (kl - 1(k = l )) +                      c W
                                                                           l
                                                                             c
                                                                                  d log c .
                                                                    c

To complete the proof, note that

                                                                             1
                              Pyc Yc =       wf Lf +                    1-
                                                                             µi
                                                                                       pi yi .
                                               f            i  Nc


Hence,

                                                                                                         1
                                                      1                                           d 1-
                  w f L f d log w f +                       pi yi d log( pi yi ) + 
                                                                                                         µi
 d( Pyc Yc ) =                                     1-                                                         pi yi d log µi .
                 f c                     i c
                                                      µi                                    i c
                                                                                                  d log µi

In other words, since Py Y = 1, we have

                                                                                                   1
                                                      1                                  d 1-
                     f d log w f +                          i d log i + 
                                                                                                   µi
         d c =                                     1-                                                   i d log µi .
                   f c                   i c
                                                      µi                          i c
                                                                                            d log µi

Hence,
                                                    f               
                           d log c =                c
                                                      d log  f +  i d log µi .
                                                                    
                                            f  Fc                i c c




Proof of Theorem 4. Proof of Part(1):
   The expression for d2 log Y follows from applying part (2) to the whole world. The
equality of real GNE and real GDP at the world level completes the proof.
   Proof of Part (2):



                                                           95
   Denote the set of imports into country c by Mc . Then, we can write:

                                                                          1
            d log Yc               d log  f                   d j    1- µ                 Y  c
                                                                                               d log PYc
                                Y                        +
                                                                           j
                     =           c
                                f d log µ                                                + i -           ,
            d log µi      f  Fc           i               j
                                                            d log µi PYc Yc                µi  d log µi

where

         d log PYc                     d log  f            d log pm ~ Yc           d log pm
         d log µi
                   =           ~ Yc
                                 f     d log µi
                                                +      ~Y
                                                        m
                                                         c
                                                           d log µi
                                                                    -  i -  Y   m
                                                                                 c
                                                                                   d log µi
                                                                                            ,
                       f  Fc                     m  Mc                    m  Mc


and
                                                     ~ Yc =
                                                       i       Yc ,j ~ ji .
                                                               j

Combining these expressions, we get

             d log Yc                                      d log  f
                                        Y   ~ Yc                    +  Y       ~ Yc d log pm
                                        f - f                              m - m
                                         c
                      =                                                     c
             d log µi          f  Fc
                                                           d log µi  m  Mc
                                                                                    d log µi

                                   d log  j                  1          Y  c
                       +        Yc
                                j d log µ
                                          i
                                                          1-
                                                             µj
                                                                       + i -
                                                                         µi
                                                                             ~ Yc .
                                                                               i
                           j Nc


At the efficient point,
                                                                                  
                  2
                 d log Yc                                d Y
                                                           f
                                                             c
                                                                        d~ Yc
                                                                           f         d log  f
             d log µi d log µk
                               =                     
                                                        d log µi
                                                                   -
                                                                       d log µi
                                                                                  
                                                                                     d log µk
                                             f  Fc

                                                         d Y  c
                                                                  d  ~Yc
                                                                                      d log pm    d  ~ Yc
                                             
                                                             m        m                                k
                                        +                       -                              -
                                            m  Mc
                                                        d log µi d log µi             d log µk   d log µi
                                                     d log Y  c
                                                                                    1     d Y   c
                                        + Y
                                          k
                                            c               k
                                                                - ki        +                 i
                                                                                                  ,
                                                     d log µi                     PYc Yc d log µk

where ki is the a Kronecker delta.
  Using Lemma 15,

          d2 log Yc                     d log  f                d log pm
                        = -  Y  i
                                  c
                                    i f           -  Y   i
                                                           c
                                                             im           - Y
                                                                            i ( ik - ik )
                                                                             c
      d log µi d log µk     f F
                                        d log µ k  m  Mc
                                                                d log µ k
                                        c

                                               d i      1
                        - Yc
                          k ik +                             ,
                                             d log µk PYc Yc
                                                  d log  f              d log pm
                        =-                  i i f d log µ -  i im d log µ - i ik
                                            Yc

                                                           k
                                                                     Yc
                                                                               k
                                                                                 Yc

                                   f  Fc                       m  Mc


                                                                 96
                               d log pi   d log yi
                        + Y
                          i
                            c
                                        +              ,
                              d log µk d log µk
                             d log yi
                        = Yc
                          i d log µ .
                                    k




Lemma 14. Let h be the income share of country h at the initial equilibrium. Then

                  d j         d log ~ Wh
                                      j                d
                         -  h            =         d loghµi  j
                                                             Wh
                                                                  - i ij - ij .
                d log µk   h
                               d log µk           h

Proof. Let µ be the diagonal matrix of µi and Iµk be a matrix of all zeros except µk for its kth
diagonal element. Then

                  d~      d  ~ (W )      d~                      d
                        =           +          µ +  ~ Iµ  +  µ
                                                             ~          ,
                                                        k
               d log µk   d log µk    d log µk                 d log µk

where   ~ (W ) is a matrix whose cith element is household c's expenditure share ~ W ,i on
                                                                                    c

good i.
   On the other hand,
                                     =     ~ (W ) +   .

Form this, we have

                  d         d ~             d  ~ (W )     d         d
                        =           (W ) +            +         +         .
               d log µk   d log µk          d log µk    d log µk d log µk

     Combining these two expressions

         d       d log ~               d       d log ~               d ~
               -                =            -              +                   - ~ (h) Iµ .
      d log µk   d log µk           d log µk   d log µk           d log µk (W )           k



Rearrange this to get

                    d       d log ~              d ~
                          -               =             (W )  -  ~ (h) Iµ ( - I ),
                                                                         k
                 d log µk   d log µk          d log µk

or
                      d       d log ~                d ~
                            -                 =             -  Iµk ( - I ).
                   d log µk   d log µk            d log µk (W )




                                                  97
Lemma 15. At the efficient steady-state

                                 d Y
                                   j
                                     c
                                                d~ Yc
                                                   j
                                           -              = - Y
                                                              k kj - kj .
                                                               c
                                d log µk       d log µk

Proof. Start from the relations


                                            j =  j +  i ij ,
                                            Yc  Yc    Yc

                                                                   i

and
                                           ~ Yc = Yc +  
                                                        ~ Yc µi ij .
                                             j    j       i
                                                               i

Differentiate both to get
                                                                                        
                d Y
                  j
                    c
                                 d~ Yc
                                    j                   d Y
                                                          j
                                                            c
                                                                                d~ Yc
                                                                                   j
                            -              =                            -                ij - Yc ki .
                                                                                                  k
               d log µk         d log µk       i
                                                       d log µk             d log µk

Rearrange this to get the desired result.

Proof of Corollary 5. Let Wh be the elasticity of social welfare with respect to the consump-
tion of country h (i.e. log Pareto weight). Then

            d log W BS                    d log Wh                          d log W    d log Pcpi,h
             d log µk
                       =              W
                                      h
                                          d log µk
                                                   =       W
                                                           h
                                                                                   h
                                                                            d log µk
                                                                                     -
                                                                                        d log µk
                                                                                                        .
                                h H                        h

                                                                                              1
                       d log W                 f d log  f        d  i (1 - µi )
                              h
                       d log µk
                                =             h d log µk
                                                          + 
                                                               d log µk h
                                                                                .
                                      f  Fc                i N              h

                                 d log Pcpi,h                          d log  f
                                                   ~ h     W                        ~ Wh .
                                              =     f d log µ                      +  k
                                  d log µk         f F        k

Hence, assuming the normalization PY Y = 1 gives

    d2 log W BS                     d  f d log  f 1        f  d2 log  f
 d log µk d log µi
                   =    W
                        h          d log µi d log µk W  W d log µi d log µk
                                                       +
                        h         f                  h   f h
                             f d log  f d log W        d k       1      k d log W        k
                  -                             h
                                                   +                 -             h
                                                                                      -       
                                                                                         W µ ki
                        f   W
                            h
                               d log µ k d log µ i   d log µ i  Wµ
                                                                h  k    W µ d log µ
                                                                        h  k        i    h  k
                                                   1                                                    1
                         d2  j      1- µ   d i      1      d  j 1 - µ j d log W
                   d log µi d log µk h + d log µk µ W +  d log µk W d log µhi
                                         j

                  i                                i h  j          h


                                                         98
                                                                                       
                       d  ~ Wh d log                    d 2
                                                            log              d ~ Wh
                            f             f                         f
                    -                       -  ~ Wh
                                                 f                        -      k     .
                     f
                       d log  µ i d log µ k  f
                                                    d log   µ i d log µ k   d log  µ i


At the efficient point, this simplifies to
                                                                                   
               2                            d log  f        d f            d~ Wh
              d    log W BS                                                   f
           d log µk d log µi
                             =          d log µk       
                                                           d log µi 
                                                                   - Wh d log µ
                                                                                i
                                                                                  
                                        f                           h

                                         d k           d ~ Wh             d log  f d log W
                                  +             -  W       k
                                                    h d log µ   -       f
                                                                                           h
                                       d log µi   h           i   f ,h
                                                                          d log µ k d log µ i

                                      d log Wh            d i
                                  - k          - k ki +          .
                                      d log µi          d log µk

By Lemma 14, at the efficient point,

                     d j         d ~ Wh                      d W
                                     j
                   d log µi                                 d logh µi 
                           - hW
                                           =                          ~ Wh - i ij - ij .
                                d log  µ                                j
                            h            i                 h

Whence, we can further simplify the previous expression to

            d2 log W BS             d log  f             d W
         d log µk d log µi
                           =       d log µk             d logh µi ~ Wh - i i f
                                                                    f
                                  f                    h
                                        d h ~ Wh                        d log  f d log h
                              +                 k - i (ik - ik ) -   f
                                  h
                                       d log µi                    f ,h
                                                                        d log µk d log µi
                                     k                        d i
                              -           d log µi - k ki +          ,
                                  d log h                   d log µk
                                        d log  f            d
                              =                         d loghµi 
                                                                    W
                                                                 ~ h - i i f
                                                                  f
                                   f
                                        d log µk       h
                                        d h ~ Wh                d log  f d log h
                              +                 k - i ik -   f
                                  h
                                       d log µi            f ,h
                                                                d log µk d log µi
                                     k                 d i
                              -           d log µi +          ,
                                  d log h            d log µk

and using d log i = d log pi + d log yi ,

                                        d log  f            d
                              =                         d loghµi 
                                                                    W
                                                                 ~ h - i i f
                                                                  f
                                   f
                                        d log µk       h




                                                           99
                                      d h ~ Wh                d log  f d log h
                          +                   k - i ik -   f
                              h
                                     d log µi            f ,h
                                                              d log µk d log µi
                                 k                 d log pi      d log yi
                          -           d log µi + i          + i           ,
                            d log h                d log µk     d log µk
                                   d log h ~ Wh d log  f              d log  f
                          =  h              f             - i  i f
                            f ,h
                                   d log µi      d log µk      f
                                                                      d log µk
                                           d log h ~ Wh             d log h d log  f
                          +  h                      k - i ik -   f
                              h
                                           d log µi            f ,h
                                                                    d log µi d log µk
                                     d log h      d log yi
                          - k                 + i
                                     d log µi     d log µk
                                                d log  f
                          + i             i f d log µk       + ik ,
                                          f
                                         d log h d log  f
                          =                                   h 
                                                                    W
                                                                ~ h - f
                                                                 f
                              f ,h
                                         d log µi d log µk
                                  d log yi      d log h ~ Wh    d log h
                          + i              +  h           k - k           ,
                                  d log µk   h
                                                d log µ i       d log µ i

                                     d log yi      d log h                      d log  f
                          = i                 +  h                       ~ Wh
                                                                           f             +~ Wh
                                                                                            k
                                     d log µk   h
                                                   d log µi                     d log µk
                                     d log h d log  f           d log h
                          -                             f - k            ,
                              f ,h
                                     d log µi d log µk        h
                                                                d log µi
                                     d log yi      d log h d log Pcpi,h
                          = i                 +  h
                                     d log µk   h
                                                   d log µi d log µk
                                          d log  f                d log                  d log h
                          -        d log µk  f                d log µh
                                                                     i
                                                                                - k 
                                                                                         d log µi
                                                                                                  ,
                                     f                        h                      h
                                     d log yi                d log h d log Pcpi,h
                          = i                 + Cov                  ,                      ,
                                     d log µk                d log µi d log µk

since
                                                                                     1
                d log  f          d f       d 1 -  j  j (1 -                         µj )
             -           f = -            =                                                     = -k
              f
                d log µk       f
                                 d log µk         d log µk

at the efficient point, and
                                                     d log 
                                               h d log µh
                                                        i
                                                                  = 0.
                                               h




                                                      100
Proof of Theorem 6. From Theorem 4, we have

                                                     1
                                                     2
                                         L=-             (d log µl )l d log yl .
                                                       l

With the maintained normalization PY = 1, we also have

                                           d log yl = d log l - d log pl ,

                                    d log pl =    l f d log  f +  lk d log µk ,
                                                 f                       k

where, from Theorem 3,

                          k                  j
d log l = (lk -             kl )d log µk -  ( j - 1)Cov( j) ( (k) d log µk -  ( g) d log  g , (l ) )
            k
                          l                j
                                             l               k               g
                1
            +
                l                   W
                                    l - l cg  g d log  g ,
                                     c

                    g F     c


and

                          k f                                                                  ( f )
d log  f = -  k               d log µk -   j ( j - 1)Cov( j) ( (k) d log µk -  ( g) d log  g ,       )
                k
                          f              j                    k               g                f
                1
            +
                f                    W
                                     i -  f cg  g d log  g .
                                      c

                     g F        c


    We will now use these expressions to replace in formula for the second-order loss func-
tion. We get


        1                                           1
 L=-         ( lk - kl - lk )k l d log µk d log µl +  l d log µl  l f d log  f
        2 l k k     l   k                           2 l          f
            1
            2   (d log µl ) j ( j - 1)Cov(j) ( (k) d log µk -  (g) d log g , (l) )
        +
              l j                             k               g

                                                          1
                                                          2                  
                                                      -       d log µl               W
                                                                                     l - l cg  g d log  g
                                                                                      c

                                                            l                g   c



            1                                           1
      L=-        ( lk - kl - lk )k l d log µk d log µl +  l d log µl  l f d log  f
            2 l k k     l   k                           2 l          f




                                                            101
             1
             2   (d log µl ) j ( j - 1)Cov(j) ( (k) d log µk -  (g) d log g , (l) )
         +
               l j                             k               g

             1
             2     
         -               W
                         l - l c d log c
                          c
                                                  d log µl
               l    c


We can rewrite this expression as

                                            L = L I + LX + L H

where

          1       - kl   - lk kl
 LI =         
          2 k l
                [ kl
                     l
                       + lk
                            k
                              +
                                l
                                  - 1]k l d log µk d log µl

                                            1
                                            2     d log µk d log µl  j ( j - 1)Cov(j) ((k) , (l) ),
                                        +
                                              k l j




             1      l f
 LX =             (
             2 l f f
                        - 1)l  f d log µl d log  f

                                           1
                                           2    d log µl d log g   j ( j - 1)Cov(j) ((g) , (l) ),
                                       -
                                             l g                 j


                                    1
                                    2       
                          LH = -                 W
                                                 l - l c d log c
                                                  c
                                                                           d log µl ,
                                      l      c

where d log  is given by the usual expression.15 Finally, using Lemma 17, we can write

                            1
                            2   (d log µl )(d log µk )   j  j Cov(j) ((k) , (l) ).
                     LI =
                              l k                      j


and
                                 1
                                 2    d log µl d log g   j  j Cov(j) ((g) , (l) ).
                        LX = -
                                   l g                 j

 15 We   have used the intermediate step


          1                            1
 LX =         
          2 l k
                k l d log µk d log µl +   d log µl d log  f l l f
                                       2 l f
                                                     1
                                                     2    d log µl d log g   j ( j - 1)Cov(j) ((g) , (l) ).
                                                 -
                                                       l g                 j




                                                     102
Lemma 16. The following identity holds


                                 j          ~ jk  jl -   jm 
                                                            ~ mk ml     =~ k l .
                                 j                      m


Proof. Write  so that it contains all the producers, all the households, and all the factors
as well as a new row (indexed by 0) where 0i = i if i  C and 0 otherwise. then, letting
e0 be the standard basis vector corresponding to the 0th row, we can write

                                                   = e0 +   ,

or equivalently
                                                  ( I -  ) = e0 .
                              kl = 
Let X kl be the vector where Xm    ~ mk ml . Then


  j          ~ jk  jl -   jm 
                             ~ mk ml           =  ( I - ) X kl ,
     j                  m

                                               = e0 ( I - )-1 ( I - ) X kl , = e0 X kl = ~ 0k  0l = ~ k l .




Lemma 17. The following identity holds

                                                              ~ lk - lk kl - kl   lk  ~k
                j j
                  µ -1
                       Cov ~
                             ( j ) ( ~ (k) ,  (l ) ) =   
                                                        l k [
                                                                  k
                                                                       +
                                                                          l
                                                                                +
                                                                                  k
                                                                                    -
                                                                                      k
                                                                                         ].
               j


Proof. We have


       j µ- 1
          j Cov~ ( j) (  (k ) ,  (l ) ) =
                        ~
         j


                                       j µ-
                                          j
                                            1
                                              ~ jm ~ mk ml -  ~ jm ~ mk                   ~ jm ml
                                                                                                          ,
                                      j             m                    m                m

or


       j µ- 1
          j Cov~ ( j) (  (k ) ,  (l ) ) =
                        ~
         j



                                                            103
                                    j   jm ~ mk ml -   j µ-1  
                                                          j
                                                              ~ jm ~ mk                                    ~ jm ml
                                                                                                                         ,
                                   j        m                               j               m              m

or


       j µ- 1
          j Cov~ ( j) (  (k ) ,  (l ) ) =
                        ~
      j

                                         j   jm ~ mk ml -   j ~ jk  jl
                                       j        m                               j


                                            +  j ~ jk  jl -   j µ-1
                                                                 j
                                                                                            ~ jm 
                                                                                                 ~ mk      ~ jm ml       ,
                                                    j                       j               m              m


or using, Lemma 16

            j µ- 1
               j Cov~ ( j) ( (k ) , (l ) ) = - k l +   j  jk  jl -   j
                             ~                 ~         ~                                      ~ jk - jk ( jl - jl ),
           j                                                       j                    j


and finally

                                                               ~ lk - lk kl - kl   lk  ~k
                 j j
                   µ -1
                        Cov ~
                              ( j ) ( ~ (k) ,  (l ) ) =   
                                                         l k [
                                                                   k
                                                                        +
                                                                           l
                                                                                 +
                                                                                   k
                                                                                     -
                                                                                       k
                                                                                          ].
                j




Proof of Theorem 7. Here we assume that there is only one factor in the domestic economy
and normalize its price to one. Define the "fictitious domestic" IO matrix

                                                                       ij
                                                         ij                         ,
                                                                 k Nc ik

with associated Leontief-inverse matrix

                                                          (1 -  ) -1 .

Applying Feenstra (1994), for each producer i  Nc , we have


                                   d log pi =                   ij d log p j + d log ic ,
                                                               
                                                        j Nc
                                                                                i - 1

where ic is the domestic cost share of producer i. The solution of this system of equations




                                                                 104
is
                                                                  d log  jc
                                       d log pi =            ij
                                                                   j - 1
                                                                            .
                                                     j Nc

From this we can get welfare gains

                                                                       d log  jc         d log  jc
         d log Yc = -            i d log pi = -
                                b                              i
                                                               b  ij
                                                                        j - 1
                                                                                 =-    j
                                                                                            j - 1
                                                                                                   ,
                        i  Nc                     i  Nc j Nc                       j N      c


where
                                             i 
                                                              j
                                                             b  ji .
                                                      j Nc

This can be thought of as hitting the fictitious domestic economy with productivity shocks
-d log  jc /( j - 1). Since relative domestic prices in the closed and open economy are
identical, the relative expenditure shares on domestic goods moves in the same way in
both economies.

Proof of Corollary 5. Result (ii) follows immediately from Corollary 4 applied at the indus-
try level, which allows us to determine that at every point, the Hessian of the function
 log Y c ( log A  ) is negative semi-definite when all cross-industry elasticities of substitu-
tion are below one and positive semi-definite when they are above one. The same logic
can be used to prove a local version of (i) since the Hessians of the two economies at the
original point are ordered (using the semi-definite condition partial ordering).
    There is an alternative way to prove this corollary via the contraction mapping theorem.
To see this, introduce the mapping T , which to every vector of price changes  log p    for the
goods of the dual closed economy, associates a new vector of price changes  log p          =
T ( log p          
           ;  log A) given by:

                                                1                              ij e(1-i ) log p
                                i +
                      i = - log A
                 log p
                                              1 - i
                                                    log                                       j
                                                                                                  .
                                                                  j Nc + Fc


It is easy to verify that T (·;  log A    ) is a contraction mapping, the fixed-point of which
gives the response of prices to productivity shocks in the dual closed economy:  log p          =
limn T n ( log p                  ), for all  log p
                     init ;  log A                  init . The response of welfare in the original
economy is equal to the response of real output in the dual closed economy and is given by
 log Wc =  log Y    c = - log p     c , where recall that we denote by c the final good consumed
by the representative agent of the dual closed economy.
    (i) and (ii) can also be derived using  log Wc =  log Y        c = - log p    c with  log p =
limn T ( log p
           n                      ), where the mapping  log p
                     init ;  log A                                  = T ( log p            ) is ap-
                                                                                   ;  log A


                                                      105
plied at the industry level. Indeed, the mapping is always linear in  log A      . If all the
elasticities of substitution across industries are below (above) unity, then the mapping is
convex (concave) in  log p, and hence the mapping preserves convexity (concavity) in
 log A. This immediately implies (ii). The result (i) also follows from the fact that the T
mapping for the high-elasticity and low-elasticity economy are monotonically ordered and
the ordering is preserved by iterating on T .


Proof of Proposition 12. The proof closely follows that of Proposition 11. Notably, using an
insight from Galle et al. (2017), which builds on Feenstra (1994), we note that

                                                                   1       g
                                 d log  g = d log w g +              d log s
                                                                   g

for any s, and hence,

                                                                      1
                                                g                             g
                          d log  g =    f               d log w f +     d log  f ,
                                        f
                                                                      g

where   g and  g are the Domar weights under the closed-economy IO matrix. Then we
can combine this with the fact that

                                         d log w f -  
                                  c                 g  i d log A
                                                               i
                           d log Pg =    f
                                            f                         i


and choosing household g's nominal income as the numeraire to get
                                                               g
                          d log Wg =       g d log s +    i d log A
                                                                   i.
                                           f    
                                        f         g    i




Proof of Proposition 13. Loglinearizing this, we get

 f d log  f = d log w f         h
                                f  h h -         ( h - 1)  h  h
                                                              f  hl d log wl +                h h        h
                                                                                                f d log L .
                          h H                   h H                       lF            h H

We can put this back into familiar notation

                                                                              hl l
 f d log  f = d log w f          h f  f h -       ( h - 1)  h f  f              h
                                                                                   d log wl +  h f  f d log Lh .
                          h H                   h H                        lF                h H




                                                         106
Simplify this to get

                                                                         hl l
     d log  f = d log w f           h f h -    ( h - 1)  h f             h
                                                                              d log wl +  h f d log Lh .
                             h H              h H                     lF                h H

We can beautify this a bit as

d log  f =          h E(h) E(h) d log w f - d log w                  +         E(h) E(h) (d log w) +            E(h) (d log L) .
              h H                                                        h H                              h H

or

     d log  f =         E(h) h E(h) d log w f - d log w                    + E(h) (d log w) + (d log L) .
                  h H

or
         d log  f =          E(h) E(h) h d log w f - d log w + (d log w) + (d log L) .
                       h H

    The case with immobile labor is given by h = 1 for every h  H , in which case
d log w f = d log  f . Combine this with demand for the factors to finish the characteri-
zation

                 d log l                                                                  d log w f
             l            =   j (1 -  j )Cov( j)                     (k) +  ( f )                   ,
                 d log Ak  i { H , N }                                           f
                                                                                          d log Ak (l )

                                                                     d log w f
                             +    (lh - l )                 h f  f
                                                                     d log Ak
                                                                                     .
                                 h H                f  Fc


      This means that we can also redo the welfare accounting and write

                                                                    c
                                       d log Wg = d log  g - d log Pg ,

where  g is the (nominal) income of household g. This can be written as

                  d log Wg         W             W
                           =  s - s g d log ws + k g d log Ak + d log L g ,
                                 g
                  d log Ak   s F

or
                    d log Wg               gs     Wg                                 Wg
                             =                s - s               d log ws + k + d log L g .
                    d log Ak  s F
                                          g



Proposition 18 (Structural Output Loss). Starting at an efficient equilibrium in response to the


                                                            107
introduction of small tariffs or other distortions, changes in the real output of country c are, up to
the second order, given by


                1
   log Yc  -
                2 l           log µk  log µl  Y
                                              j  j Cov( j) ( (k ) , (l ) )
                                               c

                    N   c   k N                    j N
                            1
                    -
                            2 l         log g  log µl  Y
                                                       j  j Cov( j) ( ( g) , (l ) )
                                                        c

                                N c   g F                  j N
                                                         1
                                                    +
                                                         2 l      W      W           Wc        Y
                                                                  c  log c  log µl ( l - l ) / c .
                                                             N
                                                             c   cC


Proof. The proof follows along the same lines as Theorem 6.




                                                      108
