                               NBER WORKING PAPER SERIES




  SEARCH FRICTIONS AND EFFICIENCY IN DECENTRALIZED TRANSPORTATION
                              MARKETS

                                        Giulia Brancaccio
                                        Myrto Kalouptsidi
                                      Theodore Papageorgiou
                                          Nicola Rosaia

                                       Working Paper 27300
                               http://www.nber.org/papers/w27300


                     NATIONAL BUREAU OF ECONOMIC RESEARCH
                              1050 Massachusetts Avenue
                                Cambridge, MA 02138
                                     June 2020




We gratefully acknowledge the support of the National Science Foundation (under grant
SES-1847555), the Social Sciences and Humanities Research Council (under grant
#430-2018-00540), as well as the Griswold Center for Economic Policy Studies at Princeton
University. The views expressed herein are those of the authors and do not necessarily reflect the
views of the National Bureau of Economic Research.

NBER working papers are circulated for discussion and comment purposes. They have not been peer-
reviewed or been subject to the review by the NBER Board of Directors that accompanies official
NBER publications.

© 2020 by Giulia Brancaccio, Myrto Kalouptsidi, Theodore Papageorgiou, and Nicola Rosaia. All
rights reserved. Short sections of text, not to exceed two paragraphs, may be quoted without explicit
permission provided that full credit, including © notice, is given to the source.
Search Frictions and Efficiency in Decentralized Transportation Markets
Giulia Brancaccio, Myrto Kalouptsidi, Theodore Papageorgiou, and Nicola Rosaia
NBER Working Paper No. 27300
June 2020
JEL No. F1,L0,L91,R4,R48

                                          ABSTRACT

In this paper we explore efficiency and optimal policy in decentralized transportation markets that
suffer from search frictions, such as taxicabs, trucks and bulk shipping. We illustrate the impact
of two externalities: the well-known thin/thick market externalities and what we call pooling
externalities. We characterize analytically the conditions for efficiency, show how they translate
into efficient pricing rules, as well as derive the optimal taxes for the case where the planner is
not able to set prices. We use our theoretical results to explore welfare loss and optimal policy in
dry bulk shipping. We find that the constrained efficient allocation achieves 6% welfare gains,
while the first-best allocation corresponding to the frictionless world, achieves 14% welfare
gains. This suggests that policy can achieve substantial gains, even if it does not alleviate search
frictions, e.g. through a centralizing platform. Finally, we demonstrate that simple policies
designed to mimic the optimal taxes perform well.

Giulia Brancaccio                                Theodore Papageorgiou
Department of Economics                          Department of Economics
Cornell University                               Boston College
464 Uris Hall                                    343 Maloney Hall
Ithaca, NY 14850                                 140 Commonwealth Ave
and NBER                                         Chestnut Hill, MA 02467
giulia.brancaccio@cornell.edu                    theodore.papageorgiou@bc.edu

Myrto Kalouptsidi                                Nicola Rosaia
Department of Economics                          Littauer Center
Harvard University                               Department of Economics
Littauer 124                                     Harvard University
Cambridge, MA 02138                              nicolarosaia@g.harvard.edu
and NBER
myrto@fas.harvard.edu
1    Introduction

The transportation sector is indispensable for economic growth and social development. With both people

and goods covering larger distances than ever before, the sector has witnessed a newfound and growing

interest by policymakers. In many transport markets interactions between carriers and customers occur

in a decentralized manner. This is for instance the case in the markets for taxis, trucks and bulk shipping

among others. In these markets, search frictions may result in unrealized trade, thus posing the question

of whether the sector operates efficiently, and if not, what policies can be employed.

    In this paper, we study efficiency and optimal policy in decentralized transport markets. In particular,

taking search frictions as given, we dissect the sources of inefficiency that distort the market equilibrium

allocation and characterize analytically the conditions for (constrained) efficiency. We derive both the

set of efficient pricing rules, as well as optimal taxes, that the planner can employ to achieve the efficient

allocation. We then use our theoretical results to explore welfare loss and optimal policy in dry bulk

shipping.

    Our starting point is a dynamic spatial search model for decentralized transport markets, in the

spirit of Lagos (2000) and Brancaccio et al. (2020a) (henceforth BKP). There is a network of locations

at different distances to each other. In each location, carriers (e.g. ships, taxis) and customers (e.g.

exporters, passengers) participate in a random matching process. Carriers that get matched, transport

their customer to their desired destination for a price, and restart there. Carriers that do not get matched,

decide whether to wait at their current location or travel empty elsewhere to search. Customers that get

matched, obtain a valuation from arriving at their destination, while customers that do not, wait another

period. Finally, every period, potential customers decide whether to start searching for a carrier, as

well as their destination, thus replenishing the customer pool seeking transportation. We do not impose

restrictions on the price setting mechanism, nor the structure of the demand system, in order to nest

different modes of transportation (in taxis prices are regulated, while in shipping they are negotiated).

    Studying efficiency in this setup is not straightforward due to the dynamic nature of decision-making

and the spatial network; yet, we are able to obtain analytical results. In particular, we provide a char-

acterization of the market equilibrium allocation that allows us to directly compare it to the constrained

efficient one, i.e., the allocation where the planner cannot directly overcome the constraints imposed by


                                                      1
search frictions. This comparison allows us to identify the different types of externalities that can result

in this setting and derive conditions for each one to be internalized.

   We show that search frictions create two types of externalities. First, as is well-known, they generate

thin/thick market externalities: when choosing whether to search, agents affect the matching probabilities

faced by other agents both in the same and in the opposite side of the market. If agents' search decisions

do not internalize this effect, the overall number of agents searching may be distorted away from the

efficient one.

   Thin/thick market externalities are internalized in equilibrium if and only if the private returns from

searching are equal to the social returns. This amounts to the so-called "Hosios (1990) conditions" on

surplus sharing: these conditions, which are well-known to characterize efficiency in search models of labor

markets with homogeneous workers, require the share of the surplus which is appropriated by agents on

each side of the market to be equal to the elasticity of the matching function with respect to the same

side.

   Second, search frictions generate what we call "pooling externalities": a carrier needs to restart its

search once it has dropped off the customer at their destination; however customers may fail to internalize

the impact of their destination choice on the distribution of carriers over space. Hence the composition

of customers searching for transport to different destinations, and thus the composition of trips realized,

may be distorted away from the efficient one.

   Customers internalize pooling externalities in equilibrium if and only if prices are such that, carriers

receive the same surplus regardless of the customer they match with. This condition for efficiency repli-

cates the no-arbitrage condition obtained in a frictionless world, where competition among carriers ensures

that prices coincide with the opportunity cost of each trip, until in equilibrium carriers are indifferent

among different customers. In our frictional setup, separate markets for each customer type (e.g. for each

destination) are missing: if carriers could compete for a specific customer type, so that heterogeneous

customers were not pooled together, in equilibrium carriers would be indifferent across customers. Absent

this condition, the price paid by customers for a trip does not reflect its social value and the share of

destinations with high social value is too low in equilibrium.

   The two efficiency conditions combined characterize analytically the efficient pricing rule, which is



                                                     2
useful if a central authority is able to set prices, as in the case of taxicabs. In many markets, however, the

planner is not able to directly control prices, but he may be able to impose taxes or subsidies. We show

that, when prices are set via Nash bargaining, the planner can achieve efficiency using these instruments

and we derive their optimal values. We consider a tax on searching carriers, a tax on searching customers

and a tax on trips. The search tax (on either side) is set to equate the private value of an additional agent

searching to its social value and forces agents to internalize the thin/thick market externalities. Taxes

on trips are used to target the pooling externalities. The optimal trip tax depends on the deviation of

the trip's social surplus from the average social surplus across destinations, so that a customer entering a

route with social surplus higher (lower) than the average is subsidized (taxed). The planner can restore

efficiency by taxing trips and one of the two searching sides.

   We apply these results to study empirically the dry bulk shipping industry. A number of features

of dry bulk shipping, such as information frictions and port infrastructure, can hinder the matching of

ships and exporters. We begin by leveraging a rich dataset of vessel movements and bulk shipping prices

to document the presence of search frictions. In particular, we propose a novel test to argue that these

frictions lead to unrealized potential trade. The test is based on weather shocks at sea that exogenously

shift ship arrivals at port: in a frictionless world, in regions with more ships than exporters, the change in

the number of ships should not affect matching, since the short side of the market is always matched. Here,

instead, matches are indeed affected by weather shocks. In addition, the law of one price does not hold:

shipping prices exhibit substantial dispersion within a time-origin-destination triplet, also consistent with

frictions. Finally, at any given time, in most countries there are simultaneous arrivals of empty ships that

load and departures of empty ships, even though ships are homogeneous. This also suggests wastefulness.

   We proceed to estimate the model using the dry bulk shipping data. We use the estimates obtained in

BKP for the ship parameters; and we introduce external trade data to estimate the exporter parameters,

including the bargaining coefficients.

   We first test whether the observed equilibrium is efficient by checking whether the conditions for

efficiency hold in the data. Perhaps not surprisingly, we find that neither condition is satisfied, suggesting

that the market does not operate efficiently.

   Next, we turn to the welfare analysis. We compare, (i) the market equilibrium; (ii) the constrained



                                                      3
efficient outcome, i.e., the market allocation under the efficient prices; (iii) the first-best, i.e., the allocation

in a world without search frictions. We find that total welfare in the market equilibrium allocation is 6.3%

lower than the constrained efficient allocation and 14% lower than the frictionless benchmark. Moreover,

trade volume and net trade value are substantially higher under constrained efficiency (by 13.5% and

11.7% respectively), as well as under the first-best (by 36.5% and 42.7% respectively). This suggests that

the externalities have a substantial impact on world trade.

   These results relay an important message: under the optimal policy, the market is able to achieve about

44% of the first-best welfare gains. If the first-best allocation is interpreted as a benchmark achievable

by a platform that eradicates search frictions (like Uber/Lyft), our results imply that policy-makers can

improve efficiency substantially through simple policies, such as taxes or subsidies, without resorting to

some form of centralization. This is important because centralization may be infeasible in practice, or

may come with market power if provided by private firms.

   We next delve into the different role of the two externalities. We find that both externalities contribute

to distorting the equilibrium market allocation. However, they have a qualitatively different impact on

the economy. Thin/thick market externalities have a large impact on trade volume, as they distort the

numbers of searching agents and therefore the total number of matches formed. In contrast, pooling exter-

nalities have an impact on trade value, as they distort the composition of exports and favor destinations

with low social value.

   In order to correct thin/thick market externalities, we find that exporters need to be subsidized: at

the observed equilibrium, the entry of an additional exporter has a substantial positive externality on

matching rates, but prices remain too high to achieve the socially efficient number of exporters. On the

other hand, correcting the pooling externalities requires subsidizing routes with high social surplus; i.e.,

trips with high exporter revenue, short trip duration and/or trips to destinations with a high option value

for the ship (many customers, high value matches, low travel costs to other locations etc).

   Finally, although the efficient prices and optimal taxes that restore efficiency have known expressions,

they may not be feasible to implement in practice, either because the planner does not have access to

all instruments; or because they may be too complex or computationally challenging. We thus consider

simple policies that are designed to mimic the optimal taxes but may be more easily implementable. We



                                                         4
find that a destination-specific tax (customs tax) performs relatively well, as it can achieve 44% of welfare

gains achieved under the optimal taxes. In contrast, a tax that is a function of distance achieves no

welfare gains. This suggests that a pricing scheme based on distance, such as the one used in taxis, is far

from efficient. Explicitly targeting origin and destination is essential in order to correct for the different

sources of externalities.


Related Literature

This paper broadly relates to four strands of literature: search and matching; transportation; international

trade; and industry dynamics.

    First, our work naturally relates to the search and matching literature; see Diamond (1982), Mortensen

(1982) and Pissarides (1985) for the canonical DMP labor market model, as well as Rogerson et al. (2005)

for a survey.1 More specifically, our paper relates to the literature on efficiency of search models. Hosios

(1990) considers efficiency in markets with random search and Nash bargaining. He shows that these

markets are generically inefficient and derives the well-known "Hosios condition" that restores efficiency.

Acemoglu and Shimer (1999) show that the Hosios condition does not guarantee efficiency when firms

are heterogeneous, and that efficiency is achieved in models of directed search and posted wages (see also

Moen, 1997). In a follow-up paper, Acemoglu (2001) shows that with random search and heterogeneous

firms, labor market policies, such as unemployment benefits or minimum wages, can potentially improve

welfare.2

    Our paper extends the existing literature by further investigating the externalities that distort the

equilibrium allocation and deriving explicit conditions for efficiency with random search and heterogeneous

agents on one side of the market. In particular, our main theorem shows that efficiency is restored if two

conditions hold: first, the Hosios (1990) conditions that ensures that the number of matches in every

market is optimal;3 second, a no arbitrage/indifference condition that ensures that the composition of
   1
     In addition to labor markets, the search and matching framework has been used in other decentralized markets, see Weill
(2020) for over-the-counter financial markets, Burdett and Coles (1997) and Shimer and Smith (2000) for marriage markets
and Lagos and Wright (2005) for monetary exchange.
   2
     More recently, Bilal (2020) extends the results in Acemoglu (2001) to the spatial context and shows that there are too
many low productivity jobs in high productivity locations.
   3
     Extending the literature, we also show how to restore efficiency in the case of decreasing returns to scale in the matching
technology. In addition, compared to Hosios (1990), we consider a more general setup with a network of interconnected
markets and without the Nash bargaining assumption on pricing.



                                                               5
matches in every market is optimal. This latter condition is novel. In addition, we derive theoretically

the set of policy instruments (both efficient pricing rules, and taxes/subsidies) that can restore efficiency.

   Second, our paper contributes to a large and rapidly growing literature on transportation. Our model

builds on Lagos (2000) (and Lagos, 2003). More recently, Frechette et al. (2019) and Buchholz (2020)

study search frictions and regulation frictions in NYC taxicabs. In particular, Buchholz (2020) relies on a

similar framework, and numerically implements tariff pricing changes in order to explore whether welfare

improvements can be achieved. Frechette et al. (2019) investigate the welfare impact of changes in the

number of active medallions, as well as the introduction of an "Uber-like" platform.

   In addition, a series of papers study different aspects of efficiency in urban transportation; for instance,

Shapiro (2018) and Liu et al. (2019) explore the welfare improvements from different centralizing formats;

Ghili and Kumar (2020) investigate demand and supply imbalances in ride-sharing platforms; Ostrovsky

and Schwarz (2018) focus on carpooling and self-driving cars; Kreindler (2020) studies optimal congestion

pricing; Cao et al. (2018) explore competition in bike-sharing platforms; while several papers study

platform pricing (e.g. Bian, 2020, Ma et al., 2018, Castillo, 2019).

   Third, since our empirical application involves oceanic transportation, we relate to a literature studying

transportation in the context of international trade; e.g. Koopmans (1949), Hummels and Skiba (2004),

Fajgelbaum and Schaal (2019), Asturias (2018), Brooks et al. (2018), Cosar and Demir (2018), Holmes

and Singer (2018), Wong (2018), Allen and Arkolakis (2019), Ducruet et al. (2019), Lee et al. (2020) and

BKP. We also relate to a literature in international trade studying the role of frictions, such as Eaton

et al. (2016), and Krolikowski and McCallum (2018) who consider search frictions between importers and

exporters and Allen (2014) who investigates information frictions. In our prior work, BKP, we explore

the role of the transportation sector in world trade and spell out the impact of endogenous trade costs.

Although we rely on the model setup and empirical strategy employed there, our focus here is entirely

different, as this paper considers search frictions and efficiency.

   Finally, we relate to the literature on industry dynamics (Hopenhayn, 1992, Ericson and Pakes, 1995),

while our empirical methodology borrows from the literature on the estimation of dynamic setups (e.g.

Rust, 1987, Bajari et al., 2007, Pakes et al., 2007; applications include Ryan, 2012, Collard-Wexler, 2013,

Kalouptsidi, 2014, 2018). Related to this paper, a small literature lying in the intersection of search and



                                                       6
industry dynamics, has explored trading frictions in decentralized markets (e.g. Gavazza, 2011, 2016 for

real assets and Brancaccio et al., 2020b for over-the-counter financial markets).

    The rest of the paper is structured as follows: Section 2 presents the model. Section 3 provides the

efficiency and optimal policy results. Section 4 describes the dry bulk shipping industry and the data

used, presents evidence for search frictions and outlines the estimation of the model. Section 5 presents

our welfare analysis. Section 6 concludes. The (Online) Appendix contains all proofs and additional

theoretical results, evidence on random search in shipping, details on the estimation procedure, data and

computation, as well as additional tables and figures.



2     Model

We introduce a model of decentralized transport markets that focuses on the interaction between carriers

(e.g. ships, taxis, trucks) and customers (e.g. exporters, passengers).


2.1    Environment

Time is discrete and the horizon is infinite. There are I locations, i  {1, 2, ..., I }. There are two

types of agents: customers and carriers. Both are risk neutral and have discount factor  . Variables

with superscript s refer to carriers and e to customers, in line with our empirical exercise of ships and

exporters.

    There is a measure S of homogeneous carriers in the economy.4 At the beginning of every period,

a carrier is either in some region i, or traveling full or empty, from some location i to some location j .

Carriers at i can either search or remain inactive. The per-period payoff of staying inactive is set equal

to 0 at each location, while searching carriers incur a per-period search cost cs
                                                                                i . Carriers traveling from

i to j incur a per period traveling cost cs
                                          ij . The duration of a trip between location i and location j is

stochastic: a traveling carrier arrives at j in the current period with probability dij , so that the average

duration of the trip is 1/dij .5
    4
      A constraint on the fleet size is consistent with most applications of interest, and can be due to either regulatory
constraints (e.g. fixed number of medallions) or time to build.
    5
      It is straightforward to have deterministic trip durations instead. Our specification, however, preserves tractability and
allows for some variability e.g. due to weather/traffic shocks, without affecting the steady state properties of the model.




                                                               7
   Customers can only be delivered to their destination by carriers and each carrier can carry at most

one customer. Following the search and matching literature, we model the number of matches that take

place every period in region i, mi , using a matching function, whereby


                                        mi = mi (si , ei )  min {si , ei }


where si is the measure of unmatched carriers in region i and ei is the number of unmatched customers

in region i. mi (si , ei ) is increasing and concave in both arguments. We allow for the possibility that

mi (si , ei ) < min {si , ei } creating the potential for unrealized trade: two agents searching in the same

location might fail to meet, due to impediments such as information frictions or physical constraints. As

Petrongolo and Pissarides (2001) note, "[...] the matching function [...] enables the modeling of frictions

[...] with a minimum of added complexity. Frictions derive from information imperfections about potential

trading partners, heterogeneities, the absence of perfect insurance markets, slow mobility, congestion from

large numbers, and other similar factors."

   Since search is random, the probability according to which customers searching at i meet a carrier

is e
   i = mi (si , ei ) /ei , which is the same for all customers. Similarly the probability according to which

carriers searching at i meet a customer is s
                                           i = mi (si , ei ) /si .

   When a carrier and a customer meet, if they both accept to match, the customer pays a price ij

upfront and the carrier begins its trip immediately to j . We are agnostic for now as to what the price

mechanism is in the market. This allows us to nest several different practices in different markets; for

instance prices are fixed by regulation in taxicabs, while prices are bilaterally negotiated in bulk shipping.

   Carriers that remain unmatched decide whether to stay in their current region or travel empty to a

different region where they wait for a match. Customers that remain unmatched wait in their current

region. Inactive carriers restart the following period in the same region.

   Finally, every period, at each location i, a large pool of potential customers decide whether to enter

and search for a carrier, in order to be transported to a destination j = i, subject to an entry cost ij .

Denote by eij the endogenous measure of customers in i who search for transportation to j . The total

measure of customers searching at location i is ei =         j =i eij ,   while Gij is the share of demand routed




                                                        8
from i to j , i.e.,

                                                   i, j : Gij  eij /ei .

Once they have entered, customers pay a per-period search cost ce
                                                                ij .
                                                                    6


       Upon matching with a carrier, customers obtain a valuation from being transported from origin i to
                                                                      ×I     ×I
destination j . We model customer valuations via the function, w : RI
                                                                    +      + , where wij (q ) is the
                                                                          RI

valuation of the marginal customer on route ij , and q is the matrix with typical element qij denoting the

quantity transported every period (i.e. the measure of accepted matches) on route ij . This can be thought

of as an inverse demand curve for transportation services, before customer entry and search costs. For

example, consider customers with heterogeneous valuations for transportation (e.g. passengers looking

for taxis with different value of time): when qij matches are formed on route ij , wij (q ) describes the

valuation of the qij -th (i.e. the marginal) consumer entering route ij .7 As a simpler case, if valuations are

homogeneous so that all customers obtain wij on route ij , the marginal customer naturally also obtains

wij .

       Consistent with this interpretation, w is the gradient of a concave and differentiable function W :

q  R+ , which is interpreted as the total customer value from transportation, as a function of the total

quantity transported, q .


2.2      Behavior and equilibrium

We consider the steady state of our industry model. In a steady state equilibrium, customers and carriers

respond optimally to their expectations of the endogenous market variables, which are consistent with

agents' behavior (rational expectations) and constant over time. Market clearing can be achieved either

by price adjustment, or rationing (captured by the adjustment of the meeting probabilities faced by the

agents at each location), or a mix of these two mechanisms.8

       We begin by describing the optimal behavior of carriers and customers facing a given tuple , s , e , G.

We then endogenize these variables to achieve market clearing.
   6
     By convention we set ce                      s
                             ii = 0, ii = 0, and cii = 0.
   7
     In addition, valuations might depend on quantities through general equilibrium effects; for instance in a general equilib-
rium trade model, traded goods' prices depend on traded quantities.
   8
     For instance in the case of taxicabs, where prices are regulated, wait times determine the entry decisions of customers
and equilibrate demand and supply. In the case of bulk shipping, both prices and wait times clear the market.



                                                              9
Carrier optimality Let Vij
                         s denote the value of a carrier that begins the period traveling from i to j


(empty or loaded), Vis the value of a carrier that begins the period in location i, and Uis the value of a

carrier that remained unmatched at i at the end of the period. In everything that follows, we suppress

the dependence of the value functions on the state of the economy, given our focus on a steady state; in

Appendix E we consider out of steady state dynamics. Given prices and meeting rates we have,


                                       s
                                     Vij = -cs
                                             ij + dij Vj + (1 - dij ) Vij
                                                        s               s
                                                                                                               (1)


In words, a carrier that is traveling from i to j : pays the per period cost of traveling cs
                                                                                           ij ; with probability

dij it arrives at destination j where it begins unmatched with value Vjs ; with the remaining probability

1 - dij , the carrier does not arrive and keeps traveling.

   A carrier that starts the period in region i obtains:
                                                                                              
                                                                                              
                   Vis = max -cs
                               i + i
                                   s
                                                 Gij max ij + Vij
                                                                s
                                                                  , Uis + (1 - s
                                                                               i ) Ui , Vi
                                                                                    s     s
                                                                                                 .
                                                                                              
                                          j =i


   In words, if the carrier decides to search, it pays the per period search cost cs
                                                                                   i ; with probability i Gij
                                                                                                        s


it meets a customer heading to destination j , in which case it accepts to match if and only if its value,

inclusive of the price ij , is higher than its outside option, Uis , otherwise it receives the outside option Uis .

With probability 1 - s
                     i , the carrier does not meet a customer and receives the value of being unmatched.

If the carrier remains inactive, it obtains a flow payoff of zero and restarts the following period at the

same location.

   Defining the carrier meeting surplus as,


                                         s
                                         ij = max ij + Vij - Ui , 0
                                                         s    s
                                                                                                               (2)


the carrier's value Vis can be written as follows,

                                                                                     
                                                                                     
                                             i + i
                                 Vis = max -cs   s
                                                                 Gij s
                                                                     ij + Ui , Vi
                                                                           s     s
                                                                                        .                      (3)
                                                                                     
                                                          j =i

   Next, if the carrier remains unmatched, it chooses where to search: it can either keep waiting at i or


                                                         10
travel empty to another location. The unmatched carrier value function is equal to:


                                                     Uis = max Vij
                                                                 s
                                                                                                                       (4)
                                                              j



where we set Vii
               s  V s . In words, if the carrier stays in region i, at the beginning of the next period it
                   i

will be waiting at i; otherwise if the carrier chooses another region j = i it begins its trip towards j .

       Having defined all the carrier value functions, we now characterize their optimal behavior in terms

of the three decisions they make (whether to search in the beginning of the period, whether to accept a

match and where to search if unmatched at the end of the period). First, carriers search only when it is

profitable to do so, so that from equation (3),


                                     si > 0  Vis = -cs
                                                     i + i
                                                         s
                                                                         Gij s
                                                                             ij + Ui .
                                                                                   s
                                                                                                                       (5)
                                                                  j =i


       Second, carriers do not reject any match yielding a strictly positive surplus, and they accept only

matches yielding a positive surplus:9


                                                 i si Gij  ij = 0
                                           qij < s                                                                     (6)
                                                           s


                                           qij > 0  s
                                                    ij = ij + Vij - Ui
                                                                s    s
                                                                                                                       (7)


       Third, carriers choose where to search when unmatched. Denote by bij the measure of carriers who

decide to relocate empty from i to j (and let bii be the measure that decides to remain in i); optimality

requires that bij is positive only if option j achieves the maximum value across all possible choices:


                                                  bij > 0  Uis = Vij
                                                                   s
                                                                     .                                                 (8)


       Finally, it must be the case that, whenever the measure of inactive carriers is greater than zero, there

is some location where some carriers would rather not search at all. Since qij + bij carriers depart from

i towards j every period, traveling for 1/dij periods on average, the total measure of active carriers in
   9
    Note that we allow for the number of meetings (i.e., mij  Gij mi = si si Gij ) to be higher than the number of realized
matches (i.e., qij ) since agents can reject a match upon meeting. However, in equilibrium generically no rejections occur,
since a customer would not enter the market, only to have a match with a carrier rejected later. Therefore qij = mij .


                                                            11
steady state is given by     ij   (qij + bij ) /dij (setting dii = 1). Hence this condition can be written as,


                                                qij + bij
                                                          < S  i : Vis = 0.                                       (9)
                                           ij
                                                   dij

Customer optimality We now turn to the value functions of customers; we begin with existing cus-

tomers and then consider customer entry. If a customer meets a carrier they can either agree to form a

match, in which case the customer pays price ij and receives its valuation, or the customer can revert

to its outside option and stay unmatched. Hence the meeting surplus of the marginal customer with

valuation wij (q ) is given by,

                                        e
                                        ij = max wij (q ) - ij - Uij , 0 ,
                                                                  e
                                                                                                                 (10)

where Uij
       e is its value of searching for a carrier in i with destination j :



                                    e
                                   Uij = -ce
                                           ij + i ij + Uij + (1 - i ) Uij
                                                e e     e         e    e


                                       = -ce
                                           ij + i ij + Uij .
                                                e e     e
                                                                                                                 (11)


In words, the customer pays the cost ce
                                      ij while searching; then with probability i it meets a carrier and
                                                                                e


receives the meeting surplus on top of its outside option, while with the remaining probability it remains

unmatched and receives its outside option.

   Similarly to carriers, optimality requires that the customer does not reject any match yielding a strictly

positive surplus, and that it accepts only matches yielding positive surplus:


                                              i eij  ij = 0
                                        qij < e                                                                  (12)
                                                     e


                                        qij > 0  e
                                                 ij = wij (q ) - ij - Uij
                                                                       e
                                                                                                                 (13)


   Finally, the measure of customers searching on each route ij is pinned down by a free entry condition

for the marginal customer:


                                        e
                                       Uij - ij  0, with equality if eij > 0.                                    (14)




                                                          12
We adopt the convention that customers in i choosing i do not enter, and normalize the payoff in that

case to zero.


Feasible allocations An allocation for the transportation economy consists of a tuple (s, E, q, b) where
                                                                                     ×I
s = [s1 , . . . , sI ] denotes the measure of carriers waiting in each region, E  RI
                                                                                   + , with typical element eij ,
                                                                                ×I
denotes the measure of customers waiting for transport on each route ij , q  RI
                                                                              +    denotes the measure
                                               ×I
of new matches formed on each route, and b  RI
                                             +    denotes the measure of carriers departing empty on

each route. Equivalently, we will sometimes denote an allocation by (s, e, G, q, b), where e = [e1 , . . . , eI ] =

   j e1j , . . . ,   j eIj   denotes the measure of customers waiting in each region. This will be useful when

we want to emphasize the implications of search behavior on the share of waiting customers in location i

headed towards j , captured by the matrix G. The first triplet (s, e, G) captures search activities; hence we

will often refer to it as a search allocation, in contrast with the last pair (q, b), capturing transportation

and relocation activities.

   An allocation is feasible if it satisfies: (i) the set of constraints defining a steady state, equations

(15) and (16) below; (ii) the total fleet constraint, equation (17) below; and (iii) the constraints on the

transported quantities imposed by the meeting technology, equation (18) below. Thus, the following

feasibility constraints must hold:


                                                (qij + bij ) =         (qji + bji ) , i                           (15)
                                            j                     j

                                                         si =          (qij + bij ) , i                           (16)
                                                                  j
                                                                        qij + bij
                                                                                  S                               (17)
                                                                  ij
                                                                           dij

                                                       qij  mi (si , ei ) Gij , ij                                (18)


The first set of constraints requires that the measure of carriers departing at any given location i equals

the measure of arrivals, so that flows into i are equal to the flows out of i. Equation (16) requires that the

measure of carriers searching at each location (si ) must equal those that will be matched (          j qij ),   those

that will be unmatched and choose to remain (bii ) and those that will be unmatched and decide to travel



                                                                 13
elsewhere empty (       j =i bij ).   Equation (17) imposes the fleet constraint. Finally, constraints (18) require

that the number of matches does not exceed the number of meetings between carriers and customers.


Equilibrium We now define the equilibrium of the transportation economy, which is a tuple (s, E, q, b,  )
                                                          ×I
consisting of an allocation (s, E, q, b) and prices,   RI
                                                        + .


Definition 1. An outcome (s, E, q, b,  ) is a steady state equilibrium under prices  if:

    1. (s, E, q, b) satisfies the feasibility constraints (15)-(18).

    2. (s, q, b) satisfies the carrier optimality conditions (1)-(9) given , s and G.

    3. E, q satisfies the customer optimality and free entry conditions (10)-(14) given , e .

    4. The perceived meeting probabilities are consistent with the true ones, i.e., for all i, j , s
                                                                                                   i =

mi (si , ei ) /si , e
                    i = mi (si , ei ) /ei and Gij = eij /ei .

    (s, E, q, b) is an equilibrium allocation if there exists a price matrix  such that (s, E, q, b,  ) is an

equilibrium outcome.



3     Efficiency

In this section we present our efficiency results. In Section 3.1 we present the social planner's optimization

problem and we provide a theorem that allows us to compare the solution of that problem to the market

equilibrium allocation. In Section 3.2 we discuss the presence of two externalities and provide our main

theorem that states the conditions for efficiency. We also discuss the efficient pricing rules. In Section 3.3

we derive taxes and subsidies that restore efficiency, when prices are set via Nash bargaining.


3.1    Comparing the market equilibrium to the efficient allocation

In this section, we characterize the set of equilibrium allocations as agents become patient, so that   1,

and compare them to the social planner's solution. Focusing on the case of patient agents simplifies the

dynamic problem at hand without sacrificing its essential features. Patient (in the limit) agents only care

about their average payoff under the steady state and not about the transition dynamics. In Appendix E

we demonstrate that our efficiency results hold with discounting, as well as out of steady state.

    We begin by defining the limits of equilibrium allocations as   1:


                                                                14
Definition 2. (s, E, q, b,  ) is a limit equilibrium outcome if there exists a sequence (sn , E n , q n , bn ,  n ,  n )n0

such that: (i) for each n, (sn , E n , q n , bn ,  n ) is an equilibrium outcome for the economy populated by

agents with discount factor  n ; and (ii) as  n  1, (sn , E n , q n , bn ,  n )  (s, E, q, b,  ). (s, E, q, b) is a

limit equilibrium allocation if there exists a price matrix  such that (s, E, q, b,  ) is a limit equilibrium

outcome.

    The main task now is to compare the limit equilibrium allocation to the social planner's solution, who

wishes to maximize total welfare. When agents do not discount future payoffs, the (constrained) efficient

steady state allocation is a solution to the following problem,

                                                                             cs
                                                                              ij
                        max W (q ) -          qij ij -        (qij + bij )       -       si cs
                                                                                             i -        eij ce
                                                                                                             ij    (19)
                      s,E,q,b0
                                         ij              ij
                                                                             dij     i             ij

                           s.t. feasibility constraints (15)-(18)


    In words, the social planner maximizes the per-period welfare corresponding to (s, E, q, b): every

period, qij customers depart on each route ij , generating gross customer value equal to W (q ); matched

customers are replaced by a pool of new entrants of equal measure who pay the entry cost ij ; qij + bij

carriers begin traveling on route ij for 1/dij periods on average, paying a per-period traveling cost cs
                                                                                                       ij ,

while at every location i, si unmatched carriers pay the search cost cs
                                                                      i , and ei unmatched customers incur

the search cost ce
                 ij . The planner is subject to the set of steady state feasible allocations (15)-(18). Note

that since we focus on constrained efficiency, the planner is subject to the same frictions as the market.

    Comparing the socially optimal allocation to the market one is not straightforward, since neither one

has a closed-form expression. Indeed, the market equilibrium allocation solves a nonlinear system of

equalities and inequalities, as described in Definition 1 (agent optimality conditions and value functions,

feasibility constraints and rational expectations constraints), while the efficient allocation solves the plan-

ner's constrained optimization Problem (19) above. Nonetheless, the following theorem establishes that

the market allocation can be found by solving an optimization problem that is remarkably similar, in

form, to the planner's problem.




                                                              15
Theorem 1. If (s, E, q, b) is a limit equilibrium allocation then it solves

                                                                              cs
                                                                               ij
                        max W (q ) -           qij ij -        (qij + bij )       -       si cs
                                                                                              i -        eij ce
                                                                                                              ij      (20)
                      s,E,q,b0
                                          ij              ij
                                                                              dij     i             ij

                           s.t. feasibility constraints (15)-(17)

                               i, j : qij  s
                                           i si Gij                                                                   (21)

                               i, j : qij  e
                                           i eij .                                                                    (22)


where the perceived probabilities s , e and G are taken as given and are consistent with the true ones

(i.e. they satisfy condition 4 in Definition 1).

       Theorem 1 characterizes market equilibrium allocations as solutions to Problem (20), the "market

problem". As in the planner Problem (19), the objective function is equal to total welfare. Moreover,

both the market and the planner face the steady state constraints (15)-(16), and the total fleet constraint

(17). However, when it comes to the matching constraints, Problems (19) and (20) differ. Indeed, the

social planner faces constraint (18), which treats the meeting rates s , e and the destination shares G as

endogenous objects that are functions of s, e; in contrast, constraints (21) and (22) in the market Problem

(20) treat these objects as exogenous constants.

       The proof of Theorem 1, provided in Appendix A, rests heavily on duality. In particular, the dual

variables of the market Problem (20) are linked to the carrier and customer value functions. This, in turn

allows us to show that the carrier optimality conditions, equations (1)-(9), and the customer optimality

conditions, (10)-(14), are equivalent in the limit to the first order conditions of the market Problem (20).10

       Importantly, when comparing the market Problem (20), to the planner Problem (19), the only differ-

ence is that the latter internalizes the effect of search behavior on the endogenous meeting probabilities

and destination shares. The market's failure to optimize with respect to these variables is the unique

potential source of inefficiency in the economy.
  10
    Caution is needed however when limits are taken as the discount factor goes to one, because the value functions per se
may diverge. The desired correction is obtained by subtracting a reference value function from the remaining ones. Detailed
arguments are found in the Appendix A.




                                                               16
3.2   Externalities and efficient prices

In contrast to a frictionless world, in an economy with search frictions prices may fail to balance demand

and supply efficiently. As suggested by the comparison of the market Problem (20) to the planner Problem

(19), the inefficiency arises from the effect of agents' decisions on the meeting probabilities and destination

shares. This hints at the presence of two externalities, one related to the matching rates s , e and one

to the destination shares G.

   First, when choosing whether to join the search pool, agents may not internalize the effect that their

entry has on the matching opportunities faced by other agents. Indeed, an extra carrier (customer) makes

it easier for customers (carriers) to find a match and harder for other carriers (customers) to find a match.

These are known as "thin/thick market externalities" in the search and matching literature.

   Second, when choosing their destination, customers do not internalize the effect that this choice has

on the distribution of carriers over space: a carrier will have to take the customer to his destination,

and restart its search there. The customer only cares about its private surplus of the trip, whereas the

planner also cares about the carrier's surplus, which depends on the destination. The random matching

process creates what we call "pooling externalities": as heterogeneous customers are pooled together in

the matching process, prices may fail to fully capture the social value of a match between a carrier and a

customer. This distorts the customers' destination decisions and the resulting destination shares G.

   We now formalize this intuition. Define the social value of a search allocation s, e, G by

                                                                             cs
                                                                              ij
           V p (s, e, G)  max W (q ) -        qij ij -        (qij + bij )       -       si cs
                                                                                             i -       ei       Gij ce
                                                                                                                     ij   (23)
                          q,b0
                                         ij              ij
                                                                             dij     i             i        j

                           s.t. feasibility constraints (15)-(18)


This problem essentially solves for the carriers' optimal relocation decisions (b) and the decision of whether

to accept a match or not (q ), while taking as given the entry decisions of carriers (s) and customers (e),

as well as customers' destination decisions (G).




                                                          17
       The social planner Problem (19) is equivalent to,11


                                  max V p (s, e, G) , s.t.           Gij =1 i and             si S                          (24)
                                 s,e,G0
                                                                 j                        i


Intuitively, since the only source of inefficiency results from agents' search behavior, it is useful to "optimize

out" the other variables (i.e. q, b) in order to focus on the impact of the main variables of interest, s, e, G.

Definition 3. At a search allocation (s, e, G):

       - Carriers internalize thin/thick market externalities if


                                        s  arg max V p s , e, G s.t.                  si  S.                                (25)
                                                 s 0
                                                                                 i


       - Customers internalize thin/thick market externalities if


                                                 e  arg max V p s, e , G .                                                  (26)
                                                           e 0



       - Customers internalize pooling externalities if


                                     G  arg max V p s, e, G           s.t.           Gij = 1 i.                             (27)
                                               G 0
                                                                             j


       Our next theorem states three conditions that determine how the meeting surpluses must be shared

between carriers and customers in order for the externalities to be internalized in equilibrium. For every

i  I , we denote by i
                    s = d ln m (s , e ) /d ln s and  e = d ln m (s , e ) /d ln e , the elasticities of the
                              i i i            i    i          i i i            i

matching function with respect to the measure of carriers and customers searching at i, respectively. To

avoid delving into corner solutions arising in trivial cases, we assume that the equilibrium is such that

there is a positive measure of customers and carriers searching at each location (si , ei > 0 i) and that

         < S .12 Let ¯ s and ¯ e denote the carrier and customer limit surpluses associated with the limit
  i si

equilibrium outcome, (s, e, G, q, b,  ), when   1. In addition, let ¯ ij  ¯s +¯ e , i, j denote the limit
                                                                           ij   ij
  11
      Note that for every feasible solution s, e, G of this problem there exists a pair q, b  0 such that the resulting allocation
is steady state feasible: simply set q = 0, bij = 0 for i = j and bii = si i.
   12
      If si = 0 or ei = 0 for some i, then the efficiency conditions must hold only at locations with positive number of carriers
and customers. The second is a non-triviality assumption which precludes having no carriers traveling at all, since i si = S
implies that (qij , bij ) = (0, 0) for every ij such that dij < 1.


                                                               18
social surplus. For a formal definition, see Appendix A.1.

Theorem 2. Let (s, e, G, q, b,  ) be a limit equilibrium outcome. Suppose that Problem (23) admits a

unique optimal solution.13 Then:

       (i) Carriers internalize thin/thick market externalities if and only if14

                                                                  Gij ¯s
                                                              j         ij
                                                 i  I :                    = i
                                                                             s
                                                                               .                                            (28)
                                                                      ¯
                                                                  Gij ij
                                                              j


       (ii) Customers internalize thin/thick market externalities if and only if

                                                                  Gij ¯e
                                                              j         ij
                                                 i  I :                    = i
                                                                             e
                                                                               .                                            (29)
                                                                      ¯
                                                                  Gij ij
                                                              j


       (iii) Customers internalize pooling externalities if and only if


                                                       ¯ s = max 
                                                                 ¯s                                                         (30)
                                                         ij       ik
                                                                  k=i



for every ij such that Gij > 0.

       (iv) (s, e, G, q, b) is efficient only if conditions (i)-(iii) hold jointly.

       The proof, provided in Appendix A.3, first establishes that the function V p (s, e, G) is concave. There-

fore the supergradients with respect to each of the arguments (s, e, G) are well-defined at every search

allocation and in fact V p is differentiable almost everywhere in its domain. Then we demonstrate, through

the use of the dual variables associated with a limit equilibrium allocation, that the resulting first order

conditions coincide with the conditions internalizing the three externalities.

       Conditions (i) and (ii) of Theorem 2 recast the familiar Hosios (1990) conditions requiring that the

share of the surplus appropriated by agents on each side of the market equals the elasticity of the matching

function with respect to the measure of agents on that side of the market. As discussed above, when agents

(either customers or carriers) choose whether to search for a match, they do not take into account the

effect that this decision has on other agents' meeting probabilities, generating the well-known thin/thick
  13
     This is a technical condition which is generally satisfied, for example, when the function W is strictly concave.
  14
     Formally, this condition is necessary only when V p (s, e, G) is differentiable in s, which is the case almost everywhere. A
similar disclaimer applies to statement (ii), (iii) and (iv), where necessity relies on differentiability with respect to e, G and
(s, e, G), respectively.


                                                               19
market externalities. Conditions (28) and (29) have a similar flavor as the standard Coasian conditions

in the presence of externalities, where the private value of an action must be equal to its social value.

Indeed, we can rewrite equation (28) as


                                                      ¯s =   dmi (si , ei )           ¯ ij .
                                         s
                                         i        Gij  ij                         Gij 
                                              j
                                                                dsi           j


The left-hand-side captures the per-period expected private return of a carrier entering market i, which

equals the expected carrier surplus from matching (                  Gij ¯ s ) multiplied by its matching probability (s ).
                                                                 j         ij                                          i

The right-hand-side captures the per-period expected social return from an additional carrier entering i,

which equals the expected social surplus from an additional match (                         Gij ¯ ij ) multiplied by the marginal
                                                                                        j

increase in the number of matches ( dmids
                                       (si ,ei )
                                          i
                                                 ).

       Condition (iii) of Theorem 2 deals with the pooling externalities. The inefficiency here arises because

customer type-specific (in this case destination-specific) markets are missing. When heterogeneous cus-

tomers are pooled together, carriers cannot compete among themselves to serve a given type of customer;

this grants carriers market power, creating a wedge between prices and the carriers' opportunity cost

of a trip. It is useful to compare our setup with a frictionless environment. In that case, competition

among carriers ensures that prices coincide with their opportunity cost. In equilibrium, therefore, carriers

are indifferent among serving different types of customers. Similarly, in a world with search frictions,

but where carriers can direct their search to a specific customer type (i.e. a model of directed search

which is efficient, see Moen, 1997), in equilibrium a similar no-arbitrage condition would make carriers

indifferent across destinations.15 In our setup, the planner essentially restores this indifference condition

in Condition (iii) of Theorem 2. A consequence of pooling externalities is that the share of destinations

with high social value is too low in equilibrium.

       Moreover, conditions (i) and (ii) imply that a necessary condition for efficiency is that the matching

function exhibits constant returns to scale; indeed, if we add equations (28) and (29), the left-hand-side is

equal to one, and thus the elasticities must add to one as well. Corollary 3 in Appendix A.5 demonstrates

that under non-constant returns to scale in matching, efficiency can still be restored, via a tax or subsidy
  15
    In a directed search world, there is a separate market for each customer type/destination; carriers enter different markets,
until in equilibrium they are (ex ante) indifferent across different choices. Markets of more desirable destinations entail longer
waiting times for carriers and vice versa.



                                                               20
which however creates a wedge between the price paid by the customer and the one received by the carrier.


Efficient prices Condition (iv) of Theorem 2 provides a characterization of the efficient pricing rule:

Corollary 1. Let a limit equilibrium outcome (s, e, G, q, b,  ) be efficient. Then we have i
                                                                                           s = 1 -  e and
                                                                                                   i

the equilibrium prices are such that, for every ij such that Gij > 0:

                                                                                     

                         ij = wij (q ) - ij - i
                                              e
                                                      Gij ¯ ij - ¯ ij -       Gij ¯ ij  .                (31)
                                                  j                       j


   To gain some intuition for this pricing rule, we can show that (31) can be rewritten as follows:

                                                                                  
                                      s ¯s     s¯e    ¯ ij -                  ¯ ij  ,
                          i, j : (1 - i ) ij = i ij -                     Gij                            (32)
                                                                     j


where the terms ¯ s and ¯ e depend on the price ij . Relationship (32) is reminiscent of a surplus sharing
                  ij      ij

condition under Nash bargaining (i.e. the equilibrium condition that determines prices when agents Nash

bargain in a decentralized fashion), where however we have (i) replaced the bargaining coefficients with

the respective matching function elasticities (this amounts to satisfying the Hosios condition under Nash

bargaining, see Section 3.3); and (ii) adjusted the outside option of the customer by the deviation of route

ij 's social surplus from the average social surplus across destinations. By adjusting the outside option

of the customer, we ensure that customers fully internalize the social value of their destination in their

decision-making. If the customer has chosen a destination whose social surplus is higher than the mean

from origin i, he should enjoy a higher outside option (and thus a lower price), and vice versa.

   Corollary 1 suggests that if a central authority could post prices, they should choose them according

to (31). For instance, in the case of taxicabs, prices are regulated by central agencies. In practice, they

are roughly set equal to a tariff plus a fee proportional to distance. Corollary 1 indicates that this pricing

rule is unlikely to be efficient, since the efficient prices should be origin-destination specific. Naturally,

implementing the efficient prices may not be straightforward in practice, as there are not many examples

of markets where prices can be fully regulated. Thus, in the next section we consider optimal policy when

prices are bilaterally negotiated, as is often the case in decentralized markets.



                                                         21
3.3   Optimal policy under Nash bargaining

In this section we consider the problem of a planner who cannot directly control prices, but can use

taxes/subsidies to restore efficiency in the market. We show that the planner can indeed achieve efficiency

using such instruments and we derive their optimal values.

   Suppose that the planner can impose a tax/subsidy hq on loaded trips, hs on searching carriers, and he

on searching customers. In other words, searching carriers in region i pay hs
                                                                            i in addition to their waiting

cost cs
      i every period they search; customers searching in i pay hi in addition to their cost cij every period
                                                                e                            e


they search; finally, there is a one-time tax hq
                                               ij on every new match (as illustrated below which side pays

the tax does not matter).

   We focus on a specific price mechanism, that of Nash bargaining, which is a commonly employed model

used to capture bilateral negotiations. We can extend the definition of equilibrium to accommodate Nash

bargaining and taxes in a straightforward manner: (s, e, G, q, b,  ) is an equilibrium outcome under taxes

h and Nash bargaining, if carriers and customers behave optimally given h,  , s , e and G; the feasibility

constraints are satisfied; s , e and G are consistent with the allocation; and finally, prices are determined

by the usual surplus sharing condition,


                                              (1 - i ) ¯ s = i ¯e                                       (33)
                                                         ij     ij



where i is the carrier bargaining coefficient at i (see Appendix A.6 for further details).

   Corollary 2 derives the tax scheme h that resolves the two externalities:

Corollary 2. Let (s, e, G, q, b,  ) be a limit equilibrium outcome under taxes h and Nash bargaining. Then:

   (i) Thin/thick market externalities are internalized if and only if for every i

                                                                     
                                                 s
                            i       Gij ¯ ij -  hi + i        Gij hq   = s       Gij ¯ ij               (34)
                                                                   ij    i
                                j
                                                si       j                   j


and similarly,                                                            
                                                 e
                     (1 - i )       Gij ¯ ij -  hi + (1 - i )        Gij hq   = e        Gij ¯ ij .     (35)
                                                                          ij    i
                                j
                                                ei               j                   j




                                                         22
       (ii)Pooling externalities are internalized if and only if for all ij

                                                                                        
                                                           i  ¯                      ¯ ij 
                                  hq
                                   ij -       Gij hq
                                                   ij  -       ij -              Gij                                    (36)
                                          j
                                                         1 - i               j


with equality if Gij > 0.

       Before discussing the result, note that if the planner does not impose any taxes, so that h = 0, the

conditions required to internalize the thin/thick market externalities (34) and (35) become the well-known

Hosios (1990) conditions. Indeed, in that case equations (34) and (35) imply that

                                 d ln mi (si , ei )                  d ln mi (si , ei )
                           i =                       s
                                                     i , and 1 - i =                     e
                                                                                         i                              (37)
                                     d ln si                             d ln ei

       In addition, notice that, regardless of who pays the matching tax hq                       q
                                                                          ij , we can think of i hij as the

incidence of this tax on carriers and (1 - i ) hq
                                                ij as the incidence on customers, since Nash bargaining

implies that the agents split the gross surplus from the match according to i .16 Moreover, a searching

carrier in expectation pays hs
                             i /i while searching and a searching customer pays hi /i .
                                s                                                e  e


       Condition (34) states that the private value of an additional carrier searching in i must equal its social

value. Indeed, the left-hand-side of equation (34) consists of the share of the total surplus accruing to the

carrier (which is equal to his bargaining coefficient times the total surplus) minus his tax incidence. The

right-hand-side is the surplus the planner wants the carrier to receive, which equals the contribution of

the extra carrier to total surplus. In other words, the tax incidence of the carrier must be set so that the

original condition for thin/thick market externalities, equation (28) of Theorem 2, is satisfied. A similar

intuition holds for equation (35).

       Condition (36) determines the trip taxes that resolve the pooling externalities. At first glance, it has

an intuitive explanation: destinations with a surplus above average should get a subsidy above average

and vice versa. Next, note that the system of equations in (36) is not full rank; for simplicity we can
  16
    To see this note that Nash bargaining implies that     ¯s        ¯       q       ¯e            ¯              q
                                                             ij = i ij - i hij and ij = (1 - i ) ij - (1 - i ) hij , so that
agents split the gross surplus  ¯ ij according to i , and similarly pay their share of the matching tax also according to i .
Indeed, the social surplus is now defined by  ¯ ij =  ¯s    ¯e     q            ¯s     ¯e            q  ¯
                                                       ij + ij + hij (as either ij or ij include -hij , ij does not depend
    q                  ¯ s         ¯ s   ¯ e         ¯      q
on hij ) and therefore ij = i ij + ij = i ij - hij . Note also that the definition of efficiency remains the same,
except that we include the planner's revenue in the welfare.




                                                             23
set the planner revenue in region i,                j   Gij hq
                                                             ij , equal to zero.
                                                                                17 Multiplying both sides by - (1 -  ),
                                                                                                                    i

it is easy to see that Condition (36) requires that the subsidy on route ij that falls on the customer,

(1 - i ) (-hq                                                         ¯
            ij ), is equal to the deviation of the carrier surplus, i ij from the average carrier surplus

from i, i             Gij ¯ ij . Therefore, routes where the carrier surplus is high (low) are subsidized (taxed).
                  j

By setting the customer tax/subsidy equal to the deviation of the carrier surplus, the planner forces the

customer to fully internalize the impact of his destination decision on the carrier surplus.

         Finally, note that if the planner can only use the search taxes hs , he , he can correct the thin/thick

market externalities.18 Similarly if he can tax only matches but not search of any side of the market,

then he can correct the pooling externalities (using equation (36) as discussed above). The planner can

correct all externalities by taxing matches and either searching carriers or searching customers.19



4         Empirical application: dry bulk shipping

In this section we describe our empirical application using data from the dry bulk shipping industry. We

begin in Section 4.1 with a description of the industry and the available data. In Section 4.2 we discuss

search frictions in this market. In Section 4.3 we briefly discuss model estimation. With the exception of

Section 4.2, this section follows closely BKP. Throughout the following sections, unless otherwise noted,

we split ports into 15 geographical regions, depicted in Figure 6 of Appendix D.20


4.1        Industry description and data

Dry bulk shipping involves vessels designed to carry a homogeneous unpacked dry cargo, for individual

shippers on non-scheduled routes. Bulk carriers operate much like taxi cabs: a specific cargo is transported

individually by a specific ship, for a trip between a single origin and a single destination. Dry bulk shipping
     Condition (36) defines a linear system of equations in terms of the I - 1 trip taxes hq
    17
                                                                                                ij for each location i. This system
has multiple solutions as its rank equals I - 2. Thus, to obtain a unique solution we would have to impose a linear constraint.
Imposing the constraint      j
                               Gij hq
                                    ij = 0 is natural as it implies that the budget is balanced in each location.
  18                            e   e
     He can do so by setting hi /i = (1 - i ) j Gij      ¯ ij - ie
                                                                       Gij ¯ ij and hs   s   e    e          e
                                                                                     i /i + hi /i = (1 - i - i )
                                                                                                                  s
                                                                                                                          Gij ¯ ij .
                                                                     j                                                  j
  19                                                                   q               ¯              ¯
     If he taxes matches and searching carriers, he sets (1 - i ) hij = (1 - i ) ij + j Gij ij - ij - i      ¯      e
                                                                                                                            Gij ¯ ij , if
                                                                                                                          j
               s  s
Gij > 0 and hi /i +             q           e
                           Gij h = (1 - i - i )  s           ¯
                                                        Gij ij .
                            j    ij                      j
    20
    To determine the regions, we employ a clustering algorithm that minimizes the within-region distance between ports. The
regions are: West Coast of North America, East Coast of North America, Central America, West Coast of South America,
East Coast of South America, West Africa, Mediterranean, North Europe, South Africa, Middle East, India, Southeast Asia,
China, Australia, Japan-Korea. We ignore intra-regional trips and entirely drop these observations.



                                                                   24
involves mostly commodities, such as iron ore, steel, coal, bauxite, phosphates, but also grain, sugar,

chemicals, lumber and wood chips; it accounts for about half of total seaborne trade in tons (UNCTAD)

and 45% of the total world fleet, which includes also containerships and oil tankers.21

       There are four size categories of dry bulk carriers: Handysize (10,000­40,000 DWT), Handymax

(40,000­60,000 DWT), Panamax (60,000­100,000 DWT) and Capesize (larger than 100,000 DWT). The

industry is unconcentrated, consisting of a large number of small shipowning firms (see Kalouptsidi,

2014). Moreover, shipping services are largely perceived as homogeneous. In his lifetime, a shipowner will

contract with hundreds of different exporters, carry a multitude of different products and visit numerous

countries.

       Trips are realized through individual contracts that are intermediated by a disperse network of brokers.

Ships carry the cargo of a single customer at a time, who fills up the entire ship. In this paper, we focus

on spot contracts and in particular the so-called "trip-charters", in which the shipowner is paid in a per

day rate.22

       We combine four data sets. The first is a data set of shipping contracts, from 2010 to 2016, collected

by Clarksons Research. An observation is a transaction between a shipowner and a charterer for a specific

trip. We observe the vessel, the charterer, the contract signing date, the loading and unloading dates, the

price in dollars per day, as well as some information on the origin and destination.

       Second, we use satellite AIS (Automatic Identification System) data from exactEarth Ltd for the

ships in the Clarksons data set between July 2010 and March 2016. AIS transceivers on the ships

automatically broadcast information, such as their position (longitude and latitude), speed, and level of

draft (the vertical distance between the waterline and the bottom of the ship's hull), at regular intervals

of at most six minutes. The draft is a crucial variable, as it allows us to determine whether a ship is

loaded or not at any point in time.

       Third, we augment the ship data sets above, with international trade data from Comtrade on export

value and volume by country pair for bulk commodities.
  21
     Bulk ships are different from containerships, which carry cargo (mostly manufactured goods) from many different cargo
owners in container boxes, along fixed itineraries according to a timetable. It is not technologically possible to substitute
bulk with container shipping.
  22
     Trip-charters are the most common type of contract. Long-term contracts ("time-charters"), however, do exist: on
average, about 10% of contracts signed are long-term. Interestingly, though, ships in long-term contracts, are often "relet"
in a series of spot contracts, suggesting that arbitrage is possible.



                                                             25
       Fourth, we use the ERA-Interim archive, from the European Centre for Medium-Range Weather

Forecasts (CMWF), to collect global data on daily sea weather. This allows us to construct weekly data

on the wind speed (in each direction) on a 6° grid across all oceans.

       We provide a brief overview of the data and empirical regularities and we refer the interested reader to

BKP for further details. Our final dataset stretches from 2012 to 2016 and involves 5,398 ships (about half

the world fleet) and 12,007 shipping contracts with a known price, origin and destination.23 The average

trip price is 14,000 dollars per day (or 290,000 dollars for the entire trip), with substantial variation. Trips

last on average 2.9 weeks. Contracts are signed close to the loading date, on average six days before. We

have 393,058 ship-week observations at which the ship decides to either travel empty someplace (termed

"ballast") or stay at its current location. Ships that do not sign a contract, remain in their current location

with probability 77%, while the remaining ships ballast elsewhere. Clarksons reports the product carried

in about 20% of the sample and the main commodity categories are grain (29%), ores (21%), coal (25%),

steel (8%) and chemicals/fertilizers (6%). For summary statistics see Table 1 in BKP while for details on

the construction of the final dataset see the Supplemental Material of BKP.

       Finally, an important feature of this market revealed by the satellite data, is that most countries are

either large net importers or large net exporters. For instance, Australia, Brazil and Northwest America,

the world's biggest exporters of commodities, are rich in minerals, grain, coal, etc. At the same time,

China and India, the world's biggest importers, require raw materials to grow further. As a result,

commodities flow out of the former, towards the latter. The trade imbalances have implications for both

ship ballast behavior and shipping prices. Indeed, at any point in time, 42% of ships are traveling without

cargo. At the same time, prices are largely asymmetric and depend on the destination's trade imbalance:

all else equal, the prospect of having to ballast after offloading is associated with higher shipping prices

(see results in Table 7).
  23
    We drop the first two years (until May 2012) of vessel movement data, as satellites are still launched at that time and
the geographic coverage is more limited.




                                                            26
4.2       Search frictions in dry bulk shipping24

A number of features of dry bulk shipping, such as information frictions and port infrastructure, can

hinder the matching of ships and exporters. In this section we argue that these frictions indeed lead

to unrealized potential trade. Consider a geographical region, such as a country or a set of neighboring

countries, where there are s ships available to pick up cargo and e exporters searching for a ship to

transport their cargo. We define search frictions by the inequality:


                                                   m < min {s, e}                                                (38)


where m is the number of matched ships and exporters. In other words, under frictions there is potential

trade that remains unrealized; in contrast, in a frictionless world, the entire short side of the market gets

matched, so that m = min {s, e}. When inequality (38) holds, matches are often modeled via a matching

function, m = m(s, e), as is done in Section 2 above, and also extensively in the labor literature.

       In this section, we present three facts consistent with frictions, as defined by (38). In particular, we (i)

provide a direct test for inequality (38); (ii) we document wastefulness in ship loadings; (iii) we document

substantial price dispersion. Then, we estimate the matching function m = m(s, e) and gauge the degree

of frictions.


       Evidence of search frictions We begin with a simple test for search frictions. If we observed all

variables s, e, m, it would be straightforward to test (38); this is essentially what is done in the labor

literature, where the co-existence of unemployed workers and vacant firms is interpreted as evidence of

frictions. However in our setup, we observe m (i.e. ships leaving loaded) and s, but not e; we thus need

to adopt a different approach.

       Assume there are more ships than exporters, i.e. min (s, e) = e. We begin with this assumption,

because our sample period is one of low shipping demand and severe ship oversupply due to high ship

investment between 2005 and 2008 (see Kalouptsidi, 2014). If there are no search frictions, so that

m = min (s, e) = e, small exogenous changes in the number of ships should not affect the number of
  24
   The material in this section was included in a previous working version of our paper "Geography, Transportation and
Endogenous Trade Costs"; please see NBER Working Paper 23581.




                                                         27
matches. In contrast, if there are search frictions, an exogenous change in the number of ships changes

the number of matches, through the matching function m = m(s, e). We approximate an exogenous

change in the number of ships, with unpredictable ocean weather conditions. The intuition is that wind

affects the speed at which ships travel and therefore exogenously shifts the supply of ships at port. We

therefore explore whether exogenously changing the number of ships in regions with a lot more ships than

exporters affects the realized number of matches.25 Since we do not observe exporters directly, to select

periods in which there are more ships than exporters, for each region we consider weeks when there are

at least twice as many ships waiting in port as matches. Table 1 presents the results. We find that indeed

matches are affected by weather conditions in all but one region, consistent with the presence of search

frictions.

       Second, we document simultaneous arrivals and departures of empty ships. Indeed, the first two panels

of Figure 1 display the weekly number of ships that arrive empty and load, as well as the number of ships

that leave empty, in two net exporting countries: Norway and Chile. In Norway, several ships arrive

empty and load, but almost no ship departs empty. In Chile, however, the picture is quite different: it

frequently happens that an empty ship arrives and picks up cargo, while at the same time another ship

departs empty. This is suggestive of wastefulness in Chile: why does the ship that depart empty, not pick

up the cargo, instead of having another ship arrive from elsewhere to pick it up?

       This pattern is observed in many countries. Indeed, the third panel of Figure 1 depicts the histogram

of the bi-weekly ratios of outgoing empty ships over incoming empty and loading ships for net exporting

countries. In the absence of frictions, one would expect this ratio to be close to zero. However, we see that

the average ratio is well above zero. Moreover, this pattern is quite robust in a number of dimensions.26

       Third, again inspired by the labor literature, we investigate dispersion in prices. In markets with no

frictions, the law of one price holds, so that there is a single price for the same service. This does not hold
  25
      We partition the globe into cells of 9 × 9 ; for each cell we collect data on the wind speed in different directions, as well
as wave period and height. To control for seasonality, we residualize the weather measurements for each cell on a quarter
fixed effect. We follow Belloni et al. (2012) to select the relevant instruments in each region i. The potential regressors
include all the weather measurements for cells in the sea, for one and two weeks prior to period t.
   26
      This figure is robust to alternative market definitions, time periods and ship types. Capesize vessels exhibit somewhat
larger mass towards zero, consistent with the somewhat higher concentration of ships and charterers, as well as the ships'
ability to approach fewer ports. The figure is also similar if done by port rather than country. To control for repairs we
remove stops longer than 6 weeks. Finally, we only consider as "ships arriving empty" the ships arriving empty and sailing
full towards another region, and we consider as "ships leaving empty" ships sailing empty toward a different country; so
movements to nearby ports are excluded. This definition also implies that refueling cannot explain the fact either- though
there are very small differences in fuel prices across space anyway (less than 10%).


                                                                28
                                                                N     Joint Significance       s
                                                                                               m

                            North America West Coast           193             0             2.706
                            North America East Coast           200              0            3.172
                            Central America                    199           0.001           3.451
                            South America West Coast           198             0             2.913
                            South America East Coast           200             0             4.083
                            West Africa                        200           0.001           5.862
                            Mediterranean                      200              0            4.244
                            North Europe                       200              0            3.577
                            South Africa                       200              0            2.862
                            Middle East                        200              0             3.86
                            India                              200            0.34            8.58
                            South East Asia                    200             0             3.334
                            China                              200           0.038           6.194
                            Australia                          187              0            2.457
                            Japan-Korea                        200              0            5.311

Table 1: Test for search frictions. Regressions of the number of matches in each region on the unpredictable
component of weather conditions in the surrounding seas. For each region we use weeks in which there are at least
twice as many ships as matches. The first column reports the number of observations; the second column joint
significance; and the third column the average ratio of ships over matches in each region during these weeks. To
proxy for the unpredictable component of weather, we partition the globe into cells of 9 × 9 , and for each cell we
collect data on the speed of the horizontal (E/W) and vertical (N/S) component of wind, as well as wave period
and height. To control for seasonality, we residualize the weather measurements for each cell on a quarter fixed
effect. The potential regressors include one and two weeks lagged values of all the weather measurements for cells
in the sea. Finally, we follow Belloni et al. (2012) to select the relevant instruments in each region.


in labor markets, where there is large wage dispersion among workers who are observationally identical.

This observation has generated a substantial and influential literature on frictional wage inequality, i.e.

wage inequality that is driven by search frictions.27 Similarly, Table 7 in Appendix D shows that there

is substantial price dispersion in shipping contracts. More specifically, at best we can account for about

70% of price variation, controlling for ship size, as well as quarter, origin and destination fixed effects.

Moreover, the coefficient of variation of prices within a given quarter, origin and destination triplet is

about 30% (23%) on average (median). In the most popular trip, from Australia to China, the weekly

coefficient of variation is on average 34% and ranges from 15% to 65% across weeks.

       In addition, it is worth noting that the type of product carried affects the price paid and overall more

valuable goods lead to higher contracted prices, as shown in the same table. In the absence of frictions, if
  27
       See for instance Burdett and Mortensen (1998), Postel-Vinay and Robin (2002), Mortensen (2003) and references therein.



                                                              29
                                 Norway                                               Chile

                                                                                                                    4
              20                                                      15


              15                                                                                                    3
Empty Ships




                                                        Empty Ships
                                                                      10




                                                                                                          Density
              10
                                                                                                                    2

                                                                       5
               5
                                                                                                                    1


               0                                                       0
                                                                                                                    0
                            13




                                        14




                                                   15




                                                                            13




                                                                                          14




                                                                                                     15
                           20




                                       20




                                               20




                                                                           20




                                                                                         20




                                                                                                 20
                                                                                                                        0.00   0.25      0.50     0.75   1.00
                                                                                                                                Outgoing Empty Ships
                            Arrival   Departures                            Arrival     Departures                              Incoming Empty Ships


Figure 1: Simultaneous arrivals and departures of empty ships: The first two panels depict the flow of ships
arriving empty and loading, and ships leaving empty in two-week intervals in Norway and Chile. The last panel
shows the histogram of the ratio of outgoing empty over incoming empty and loading ships across all net exporting
countries.


there are more ships than exporters, as is the case during our sample period, we would expect prices to be

bid down to the ships' opportunity cost.28 In contrast, in markets with frictions and bilateral bargaining,

since ships now have market power, the price also depends on the exporter's valuation and exporters with

higher valuations pay more.

                   As in labor markets, a multitude of factors can lead to frictions (i.e. unrealized matches) in shipping.

First, the decentralized and unconcentrated nature of the market and the mere existence of brokers,

suggest that information frictions are present. The meeting process involves a disperse network of brokers;

oftentimes more than two brokers intervene to close a deal, suggesting that the ship's and the exporter's

brokers do not always find each other, and that an "intermediate broker" was necessary to bring the

two together (Panayides, 2016). In interviews, brokers claimed to receive 5,000-7,000 emails per day;

sorting through these emails is reminiscent of an unemployed worker sorting through hundreds of vacancy

postings. Port infrastructure, congestion or capacity constraints may also hinder matching.

                   Finally, we discuss two features of this market, ship homogeneity and random search. While in labor

markets, as some researchers have argued, observed or unobserved heterogeneity may partly explain the

documented facts, in shipping, heterogeneity is much more limited. Indeed, the data suggests that ship

heterogeneity alone is not a prominent explanation for search frictions. Ships do not specialize neither
              28
    In a frictionless market with more ships than exporters and homogeneous ships, in equilibrium the price from an origin
to a destination would be such that ships are indifferent between transporting the cargo and staying unmatched.



                                                                                 30
geographically, nor in terms of products: during the period of our data ships deliver cargo to 13 out of 15

regions on average and carry at least 2 of the 3 main products (coal, ore and grain). Moreover, neither

shipowner characteristics, nor shipowner fixed effects have any explanatory power in price regressions,

as shown in Table 8 in Appendix D, while ballast decisions of ships in the same region are concentrated

around the same options.29 Random search is also a reasonable approximation in shipping as meetings

occur through an unconcentrated network of brokers. Nonetheless, we examine this more rigorously in

Appendix B, where we investigate a standard implication of directed search, whether matching rates differ

across destinations from a given origin.


       Matching function estimation           We close this section by discussing the estimated search frictions

implied by the estimated matching function. Here, we follow the same approach to estimate the matching

function as BKP; we thus provide a brief overview of the procedure and then present the implications for

search frictions.

       A sizable literature has estimated matching functions in several different contexts (e.g. labor markets,

marriage markets, taxicabs). For instance, in labor markets, one can use data on unemployed workers,

job vacancies and matches to recover the underlying matching function. In our data, we observe ships

and matches, but not searching exporters; in BKP we simultaneously recovered both exporters, as well as

a nonparametric matching function. This approach extends the literature in two dimensions. First, we do

not take a stance on the presence of search frictions. When one side of the market (in this case exporters)

is unobserved or mismeasured, it is difficult to discern whether search frictions are present. Second, we

avoid parametric restrictions on the matching function; this is important, since as shown in Theorem 2,

in frictional markets, the conditions for constrained efficiency depend crucially on the elasticity of the

matching function with respect to the search input.

       Briefly, the estimation draws from the literature on nonparametric identification (Matzkin, 2003)

and non-separable instrumental variable techniques (e.g. Imbens and Newey, 2009). We require that

m (s, e) is increasing in e, that it exhibits constant returns to scale (although the results are robust to
  29
    If heterogeneity were an important driver of ships' ballasting decisions, we would expect ships to choose diverse des-
tinations from a given origin. Yet we find that ballast choices are similar across ships (the CR3 measure for the chosen
destinations, i.e. the concentration ratio of the top 3 destinations, is higher than 70% in most regions). Moreover, home-
ports are not an important consideration for shipowners, as the crew flies to their home country every 6-8 months.




                                                           31
alternative restrictions; see BKP) and that an instrument that shifts the number of ships exists (the

weather shocks). The methodology delivers exporters point-wise and the matching function of each

location i nonparametrically. We provide a short description of the approach in Appendix C.1 and refer

the reader to BKP for further details, as well as Brancaccio et al. (forthcoming) for a guide on the

implementation of this approach in this and other settings.30

       Figure 5 in Appendix C.1 reports our estimates for search frictions. In particular, to measure the

extent of search frictions in different regions, we compute the average percentage of weekly "unrealized"

matches; i.e. (min{si , ei } - mi ) / min{si , ei }. Search frictions are heterogeneous over space and may be

somewhat sizable, with up to 20% of potential matches "unrealized" weekly in regions like South and

Central America and Europe. On average, 13.5% of potential matches are "unrealized".31

       Moreover, we find that the estimated search frictions are positively correlated with the observed

within-region price dispersion (0.47), another indicator of search frictions. We also find that frictions are

negatively correlated with the Herfindahl-Hirschman Index of charterers (those reported in the Clarksons

contract data) in a region (-0.31); this suggests that when the clientele is disperse, frictions are higher.

Finally, when we estimate the matching function separately for Capesize (biggest size) and Handysize

(smallest size) vessels, we find that for Capesize, where the market is thinner, search frictions are lower.


4.3      Model estimation and results

We make four changes that render the model presented in Section 2 amenable to empirical analysis. First,

we impose a specific pricing mechanism, Nash bargaining, with i the ship bargaining coefficient in market

i. Second, we add randomness to the discrete choice problem for ships of where to ballast, by adding

idiosyncratic shocks to equation (4), so that it becomes,


                                                 Uis = max Vij
                                                             s
                                                               +       ij                                             (39)
                                                          j

  30
     For an application to labor markets see Lange and Papageorgiou (2020).
  31
     It is worth noting that this does not imply that in the absence of search frictions there would be 13.5% more matches,
as we would need to take into account the optimal response of ships and exporters. This is simply a measure of the severity
of search frictions in different regions.




                                                              32
where        ij   are drawn i.i.d. from the Type I extreme value distribution with standard deviation  . Third,

we consider the version of the model with  < 1. In Appendix E we demonstrate that our efficiency results

hold in this empirical model with discounting and idiosyncratic shocks. Fourth, we also add randomness

to the exporters' problem (14), so that they solve the following discrete choice problem of whether and

where to export,

                                                 max Uij
                                                      e
                                                         - ij +    ij
                                                  j


with    ij    drawn i.i.d. from the Type I extreme value distribution; we normalize Uii
                                                                                     e -  = 0 and interpret
                                                                                         ii

this as the option of not exporting at all. We also assume for simplicity that wij (q ) = wij for all ij .

   The main parameters of interest are: the ship travel and wait costs cs
                                                                        ij , ci , for all i, j , as well as
                                                                              s


the standard deviation of the logit shocks  ; the exporter valuations wij , the exporter waiting costs

 i (to gain power, we assume that cij do not vary over j ), and entry costs ij for all i, j ; and the
ce                                 e


bargaining coefficients i for all i. We present the estimation strategy in Appendix C. Briefly, we use the

ship parameter estimates from BKP and estimate the exporter parameters and bargaining coefficients

from prices and trade flows. Unlike BKP, we allow the bargaining coefficient to vary by region to allow

for flexibility, given the importance of that parameter regarding the thin/thick market externalities.

Moreover, we bring in additional data to obtain exporter valuations wij and as a result we are able to

estimate the extra parameters capturing exporter wait costs, ce
                                                              i.

   The results are presented in Table 6 in Appendix D. The exporter wait costs, ce
                                                                                 i , are equal to about

3% of the exporters' valuation on average, but there is substantial heterogeneity over space; the estimated

costs are highest in Central and South America, as well as parts of Africa. These parameters capture

inventory expenditures, delay costs, risks of damage or theft etc. Consistent with this interpretation, we

find that exporter wait costs are positively correlated with the recovered wait costs for ships (0.34), and

are negatively correlated with the World Bank index of quality of port infrastructure (-0.50). Finally, the

estimates for the bargaining coefficients suggest that the exporters get a larger share of the surplus in

almost all regions.




                                                          33
5     Efficiency in dry bulk shipping

In this section we present our welfare results. In Section 5.1 we check whether the efficiency conditions

hold in the case of bulk shipping. In Section 5.2 we present our main welfare analysis and in Section 5.3

we discuss policy implementation.


5.1   Is dry bulk shipping efficient?

Efficiency requires that the following conditions are met: (i) the elasticity of the matching function with

respect to each input must equal the corresponding bargaining coefficient (thin/thick market externalities);

(ii) the ship surplus must equalize across destinations (pooling externalities). We test each of these

conditions in the data.

    Figure 2 examines whether the thin/thick market externalities are internalized. For each region, the

left panel presents the histogram of the estimated matching function elasticity with respect to exporters,

as well as the estimated exporter bargaining coefficient. For several regions, as shown in the right panel, we

reject that the average elasticity of the matching function  e is equal to the exporter bargaining coefficient.

Although the "knife-edge" nature of these conditions implies that this finding is not particularly surprising,

it is worth noting that the difference between the elasticity and the bargaining coefficient is often large,

suggesting that the "Hosios conditions" for efficiency (28) and (29) are not satisfied. Moreover, the

exporter bargaining coefficient tends to be lower than the matching function elasticity, suggesting that

the planner would like to see an increase in the share of the surplus accruing to the exporter.

    Figure 3 checks whether the pooling externalities are internalized. For each region i, it plots the

coefficient of variation of the ship surplus from traveling to all destinations j = i. When pooling exter-

nalities are internalized, this coefficient of variation should be equal to zero, since the ship is indifferent

across destinations. Figure 3 demonstrates that this is not the case in bulk shipping. In all regions the

coefficient of variation is significantly different from zero, and larger than 20%, while in several regions it

is substantially higher.

    We conclude that the market has not internalized neither the pooling externalities, nor the thin/thick

market ones.




                                                      34
        North America WC                                                         North America EC                                                   Central America
 12.5

 10.0
                                                                           20                                                                 15                                                                                               t-stat
                                                                           15
  7.5                                                                                                                                         10

  5.0                                                                      10                                                                                                                                               North America WC    4.900
  2.5                                                                       5
                                                                                                                                               5
                                                                                                                                                                                                                            North America EC   10.155
  0.0                                                                       0                                                                  0                                                                            Central America    3.002
                                                                                                                                                                                                                            South America WC   3.497
                 4




                                         6




                                                            8




                                                                      0




                                                                                                  5




                                                                                                                   7




                                                                                                                                    9




                                                                                                                                                              4




                                                                                                                                                                                  6




                                                                                                                                                                                                         8




                                                                                                                                                                                                                       0
              0.




                                      0.




                                                         0.




                                                                   1.




                                                                                               0.




                                                                                                                0.




                                                                                                                                 0.




                                                                                                                                                           0.




                                                                                                                                                                               0.




                                                                                                                                                                                                      0.




                                                                                                                                                                                                                    1.
                                                  e                                                             e                                                                     e
        South America WC                                                         South America EC                                                   West Africa
                                                                                                                                                                                                                            South America EC    4.080
                                                                          12.5
                                                                                                                                              30                                                                            West Africa        1.169
  10
                                                                          10.0
                                                                                                                                                                                                                            Mediterranean       6.129
                                                                           7.5                                                                20
                                                                                                                                                                                                                            North Europe        7.756
   5                                                                       5.0
                                                                                                                                              10                                                                            South Africa        1.649
                                                                                                                                                                                                                            Middle East        6.936
                                                                           2.5


                                                                                                                                                                                                                            India               8.200
   0                                                                       0.0                                                                 0
                     4




                                             6




                                                             8




                                                                   0




                                                                                                  5




                                                                                                                 7




                                                                                                                                 9




                                                                                                                                                3




                                                                                                                                                                  5




                                                                                                                                                                                      7




                                                                                                                                                                                                                9
                     0.




                                             0.




                                                             0.




                                                                  1.




                                                                                              0.




                                                                                                                0.




                                                                                                                                 0.




                                                                                                                                               0.




                                                                                                                                                                  0.




                                                                                                                                                                                      0.




                                                                                                                                                                                                               0.
                                                  e                                                             e                                                                     e                                     South East Asia    0.685
        Mediterranean                                                            North Europe                                                       South Africa                                                            China               1.290
                                                                          10.0
  20                                                                                                                                          15
                                                                                                                                                                                                                            Australia          1.932
                                                                                                                                                                                                                            Japan-Korea        2.500
                                                                           7.5
  15
                                                                                                                                              10
                                                                           5.0
  10
                                                                                                                                               5
   5                                                                       2.5

   0                                                                       0.0                                                                 0
          2




                          4




                                              6




                                                              8




                                                                  0




                                                                                              4




                                                                                                            6




                                                                                                                             8




                                                                                                                                        0




                                                                                                                                                             4




                                                                                                                                                                                6




                                                                                                                                                                                                      8




                                                                                                                                                                                                                    0
        0.




                      0.




                                             0.




                                                             0.




                                                                  1.




                                                                                          0.




                                                                                                           0.




                                                                                                                            0.




                                                                                                                                        1.




                                                                                                                                                           0.




                                                                                                                                                                               0.




                                                                                                                                                                                                  0.




                                                                                                                                                                                                                    1.
                                                  e                                                             e                                                                     e
        Middle East                                                              India                                                              SEast Asia
  25                                                                      12.5

  20                                                                      10.0
                                                                                                                                              10
  15                                                                       7.5

  10                                                                       5.0                                                                 5

   5                                                                       2.5

   0                                                                       0.0                                                                 0
              4




                                     6




                                                         8




                                                                    0




                                                                                 4




                                                                                                       6




                                                                                                                       8




                                                                                                                                        0




                                                                                                                                                      4




                                                                                                                                                                       6




                                                                                                                                                                                                 8




                                                                                                                                                                                                                     0
             0.




                                     0.




                                                       0.




                                                                  1.




                                                                             0.




                                                                                                      0.




                                                                                                                       0.




                                                                                                                                        1.




                                                                                                                                                    0.




                                                                                                                                                                       0.




                                                                                                                                                                                                 0.




                                                                                                                                                                                                                    1.
                                                  e                                                             e                                                                     e
        China                                                                    Australia                                                          Japan-Korea
                                                                                                                                             10.0
  15
                                                                           10                                                                 7.5

  10
                                                                                                                                              5.0
                                                                            5
   5                                                                                                                                          2.5

   0                                                                        0                                                                 0.0
      4




                                 6




                                                         8




                                                                      0




                                                                                         25




                                                                                                           50




                                                                                                                            75




                                                                                                                                        00




                                                                                                                                                  5




                                                                                                                                                             6




                                                                                                                                                                           7




                                                                                                                                                                                             8




                                                                                                                                                                                                                9




                                                                                                                                                                                                                        0
   0.




                              0.




                                                      0.




                                                                   1.




                                                                                                                                               0.




                                                                                                                                                          0.




                                                                                                                                                                        0.




                                                                                                                                                                                          0.




                                                                                                                                                                                                             0.




                                                                                                                                                                                                                     1.
                                                                                         0.




                                                                                                           0.




                                                                                                                            0.




                                                                                                                                        1.




                                                  e                                                             e                                                                     e

                                                                                                      mean of e              e



Figure 2: The left panel compares the exporter bargaining coefficient i      e
                                                                               and the elasticity of the matching function
with respect to exporters, estimated nonparametrically. The histogram corresponds to the estimated elasticity at
different points in time. The dotted vertical line is the average elasticity and the solid line is the estimated bargaining
coefficient. The right panel presents the t-statistic for the null that the exporter bargaining coefficient i    e
                                                                                                                   coincides
with the average elasticity of the matching function with respect to exporters.


5.2               Welfare loss

We now come to our main welfare analysis. We begin by a comparison of (i) the market equilibrium; (ii)

the constrained efficient outcome we analyzed in Section 3; (iii) the frictionless equilibrium (first-best),

i.e., the outcome in a world without search frictions, so that m = min {s, e}. To compute the constrained

efficient outcome, we compute the equilibrium under the efficient prices given in equation (31) of Corollary




                                                                                                                                        35
                                                    1.00




                      Coefficient of Variation s
                                               ij
                                                    0.75
                                                                                                           q




                                                                              q
                                                                                  q
                                                                                                       q       q
                                                                                      q    q                           q
                                                                  q

                                                    0.50              q
                                                                                                   q

                                                                          q



                                                                                                                   q



                                                              q                                q


                                                    0.25



                                                    0.00
                                                                                  C

                                                                               EC


                                                         ut eric a
                                                                                  C

                                                                               EC

                                                                  ite rica

                                                                                 an

                                                                                 pe

                                                                                   a

                                                                                  st

                                                                   Ea dia

                                                                                  ia

                                                                     Au a

                                                                     n- a

                                                                                   a
                                                                                ic




                                                                              r ic




                                                                                 n

                                                                pa rali

                                                                               re
                                                              Am a W




                                                                             W




                                                                            Ea




                                                                            As
                                                                          ne

                                                                            ro




                                                                             hi
                                                             Am er




                                                                             n




                                                                         Ko
                                                                            f




                                                                         Af
                                                           en rica




                                                                           a




                                                                         st
                                                                           I



                                                                         C
                                                                       tA
                                                                          a




                                                                       Eu
                                                                        m




                                                                        ic




                                                                        st
                                                                      rra




                                                                        e
                                                                       ic




                                                                     dl
                                                                      h
                                                                     er
                                                                    lA




                                                                    es
                                                                    er

                                                                     e




                                                                   ut
                                                                   th



                                                                  id
                                                              Am
                                                    Am




                                                               W
                                                      So tra




                                                              So
                                                               or




                                                               M
                                                              ed




                                                                h




                                                            Ja
                                                             ut
                                                            N
                                                           M
                                                         th




                                                           h




                                                        So
                                              th




                                                           h
                                                        C

                                                        ut
                                                      or
                                     or




                                                      So
                                                     N
                              N




Figure 3: For each region i, we plot the coefficient of variation (standard deviation over mean) of ship surplus for
all destinations j = i. When pooling externalities are internalized, the coefficient of variation should be zero.


1.32 In terms of policy relevance, one can think of (ii) as what can be achieved by policy makers who are

not able to affect the meeting process or the search environment. In contrast, (iii) loosely corresponds to a

centralized market; one can think of it as a meeting platform, like Uber, which however does not exercise

market power.33 This three-way comparison allows us to assess both the overall impact of frictions on

welfare, as well as the impact of the two externalities under study.

       The results are shown in Table 2. As reported in the first three columns, total welfare in the market

equilibrium allocation is 6% lower than the constrained efficient allocation and 14% lower than the fric-

tionless equilibrium. Moreover, externalities coming from search frictions have a substantial impact on

world trade, both in terms of value and volume. Indeed, trade volume is 13% higher under constrained

efficiency and 36% higher under the first-best, while net trade value (i.e. wij - ij ) is 12% higher under

constrained efficiency and 43% higher under the first-best. Moreover, ships would ballast 10% and 0.6%

less under constrained efficiency and the first-best respectively; this suggests that although the majority

of ballast traveling is attributed to the natural imbalance in the supply and demand of commodities rather
  32
    Alternatively we can impose the optimal tax/subsidies derived in Corollary 2. The resulting allocation is the same.
  33
    Other work has indeed modeled platforms as the eradication of search frictions; e.g. Frechette et al. (2019); Buchholz
(2020).



                                                                                      36
than frictions as expected, some wasteful traveling does exist in the market equilibrium. Finally, ships

wait less under constrained efficiency and in the frictionless world (9% and 23% respectively).

   These results relay an important message: under the optimal policy, the market is able to achieve

about 44% of the first-best welfare gains, which, following the literature (see footnote 33), we interpret

as centralization. This is important as, in contrast to policies like taxes/subsidies, centralization may

not be feasible in practice, or, may come with substantial market power if provided by private firms.

Indeed, platforms that reduce search frictions between agents are emerging in a multitude of markets (for

instance, Uber/Lyft in the taxi market, Uber Freight and other entrants in the trucking industry, but also

Airbnb in the rental housing market and peer-to-peer lending in financial markets). Yet these platforms

are likely exerting market power rather than acting as benevolent planners, so that the 14% welfare gain

in the first-best allocation is likely a crude upper bound on the gains from centralization. Hence, the

constrained efficient allocation, which at the very least achieves almost half of overall welfare gains, may

well be the desirable outcome, and it is attainable by policy.

   We now discuss the different role of the two externalities. In the third and fourth columns of Table

2, we compute the welfare loss when only pooling externalities or only thin/thick market externalities

are internalized. To do so, we impose the relevant tax derived in Section 3.3 (see Footnotes 18 and

19) and compute the equilibrium. The welfare gains are 3.3% when thin/thick market externalities are

internalized and 5.1% when pooling externalities are internalized. This suggests that both externalities

introduce substantial distortions in the market equilibrium, with pooling externalities having a larger

impact.

   Table 2 also reveals that the two externalities have a qualitatively different impact on the economy;

this is illustrated by the change in the total trade volume and value. The thin/thick market externalities

have a large impact on the volume of trade, as they essentially distort the number of searching agents

and therefore the total number of matches formed. Indeed, as shown in Table 2, correcting the thin/thick

market externalities has a bigger impact on trade volume (which rises by 19%) than correcting both

externalities (in which case trade volume rises by 13%). In contrast, pooling externalities have a large

impact on trade value, as they distort the composition of exports by favoring destinations with low social

value. As shown in Table 2, correcting the pooling externalities leads to a large increase in trade value



                                                    37
(by 13%), as destinations with high social value are subsidized.


                                       Frictionless    Constrained Efficient         Pooling     Thin/Thick
              Welfare                   14.32 %                6.33 %                5.14 %           3.29%
              Trade                     36.50 %                13.55 %              -13.62 %        19.36 %
              Trade value (net)          42.71 %               11.69 %               13.61 %          6.48%
              Ballast miles              -0.60 %               -9.68%                -6.43%         -12.12%
              Waiting ships             -22.97 %               -9.48%                 5.19%          -8.47%

Table 2: Welfare Loss Analysis. The first column presents the frictionless allocation, i.e. the market equilibrium
in the absence of search frictions when the matching function is m=min{s, e}. The second column presents the
constrained efficient allocation, i.e. the market equilibrium under the efficient prices. The third and fourth columns
present the market equilibrium when only the pooling and only the thin/thick market externalities respectively are
internalized. All columns present the percent difference compared to the market equilibrium.


    We next delve deeper into each externality in turn. As described in Section 3.2, thin/thick market

externalities relate to the efficient entry of searching agents. Based on our estimates, the elasticity of the

matching function with respect to exporters, i
                                             e , is large, so that an additional exporter has a substantial


positive externality on matching rates. However, for most regions, the exporter bargaining coefficient

is lower than i
              e (see Figure 2). Therefore, shipping prices are too high to achieve the socially efficient


number of exporters. When thin/thick market externalities are internalized, this imbalance is corrected

by lowering prices and increasing exporter entry, as shown in Figure 7 in Appendix D.34

    Next, we turn to the pooling externalities. The optimal trip tax/subsidy that restores pooling exter-

nalities depends on the social surplus, ¯ ij , which is determined by several factors, such as the exporter

valuation, distance, as well as the ship continuation value at the destination. In the right panel of Figure

4, we regress the optimal trip tax, hq
                                     ij , on these features. The planner subsidizes exporters with higher

value wij ; this is not surprising, as wij enters total welfare directly. In addition, the planner taxes distant

destinations, as they are associated with high travel costs. Beyond this "direct" benefit (wij ) and cost

(cs
  ij ) however, the planner also values the attractiveness of a destination j for ships. Attractive regions for

ships may involve many customers, high value matches, low travel costs to other locations etc. Indeed,
  34
     In addition to this "direct" effect, the final allocation is also determined by "general equilibrium" effects. Ships may
avoid ballasting to regions with large price declines. As ship supply declines in those regions, prices rise and exporters stop
entering, thus dampening the direct effect on prices. This phenomenon is most pronounced in the East Coast of North
America and Northern Europe: these regions, which experience a large fall in prices, rely heavily on ships ballasting there
as they are big exporters.



                                                              38
the planner subsidizes destinations that are big exporters, implying that the ship can easily reload there,

and he taxes destinations that force the ship to ballast afterwards and/or to ballast somewhere far.
                                                                                                        q
       The left panel of Figure 4 plots the average import tax for each region (i.e.,            i qij hij /   i qij ).   The

highest subsidy is awarded to trips towards the West Coast of North America, as well Australia: these

regions are high-value importers (wij is high when j corresponds to these regions), but at the same

time, they offer high continuation values to ships that arrive there, as they are also big exporters. In

other words, both the trip there is valuable, and the ship continuation value is high. In contrast, the

highest taxes are levied on West Africa and India, as these are both low value importers and provide poor

reloading options to ships. While imports in some regions are taxed, it is worth noting that exporters

from all countries end up gaining in our results.35


                                                                                                           hq
                                                                                                            ij
                                                                Net exporter revenues on route ij       -0.09
                                                                                                         (0.03)
                                                                Trip duration (log)                      0.007
                                                                                                         (0.23)
                                                                Total net value of exports from j       -0.78
                                                                                                         (0.10)
                                                                Probability of ballast from j (log)      2.86
                                                                                                         (0.89)
                                                                Duration of ballast trip from j (log)    3.88
                                                                                                         (1.12)




                         Average tax
                                       -0.41
                                        0. 36
                                        0. 1
                                          13
                                          0
                                          .




                         on imports
                                       -1




Figure 4: Pooling Externalities. The left panel plots the the average import tax for each region, i qij hq  ij /          i qij .
The right panel regresses the optimal tax hq
                                           ij on features that affect the social surplus of a trip on route  ij .



5.3      Policy implementation

Although the prices and optimal taxes that restore (constrained) efficiency have known expressions, they

may not be feasible to implement in practice, either because the planner does not have access to all

instruments; or because the expressions may be too complex or computationally challenging. As an
  35
    In addition, as mentioned in Section 3.3, we restrict the planner budget to be zero at each origin, so that the taxes
redistribute exporters only across destinations within each origin.



                                                           39
example, the planner may not be able to set prices. Moreover, he may be able to tax trips, but not

searching agents; indeed, it may be difficult to tax hailing passengers and searching exporters, or waiting

taxis/ships. Finally, the matrix hq may be very large, in which case the planner might prefer a simpler

tax scheme.

    In this section we consider simple policies that are designed to mimic the optimal taxes, but may be

more easily implementable. In particular, we consider the following taxes: (i) an origin-specific tax on

matches which can be interpreted as a flat tax on exports; (ii) a destination-specific tax on matches which

can be interpreted as a customs tax; (iii) a linear in distance tax, resembling the taxi price schedule.

    Table 3 reports the maximum welfare gains under these tax schemes. The destination-specific tax

works best, as it achieves welfare gains of 2.8%. The origin-specific tax delivers only 0.9% welfare gains.

This is consistent with our finding that pooling externalities account for a larger portion of the overall

welfare loss. Indeed, to resolve pooling externalities, it is crucial to impose different taxes across desti-

nations. Finally, taxes that are a function of distance achieve no welfare gains. This suggests that the

pricing scheme used in taxis is far from efficient and cannot alleviate either externality. This finding is

not surprising given the optimal taxes derived in Section 3.3, that explicitly target the origin and the

destination to correct the thin/thick and pooling externalities respectively.


                              Optimal tax     Export tax      Customs tax     Distance
                                  hq
                                   ij            hqj              hq
                                                                   i            dij
                                  6.33%          2.82%            0.9%           0%


Table 3: Simple policy instruments. This table reports the maximum welfare gains attained via three simple
policy instruments: an origin-specific tax on matches (second column); a destination-specific tax on matches (third
column); a linear in distance tax (fourth column).




6    Conclusion

This paper studies efficiency in decentralized transport markets, such as taxis, ships and trucks. In this

setup, search frictions create two externalities: thin/thick market and pooling externalities. Because of

the latter, we show that the well-known Hosios (1990) conditions are not sufficient to restore efficiency

when agents are not homogeneous. We derive explicit and intuitive conditions for efficiency, which lead

                                                         40
naturally to the efficient pricing rules. Moreover, we derive the optimal taxes that restore efficiency for

a social planner that cannot set prices. Then, using data from dry bulk shipping, we demonstrate that

search frictions are present and lead to a sizeable social loss. However, through optimal taxes/subsidies

the market can achieve substantial welfare gains. In fact, these policies achieve 44% of the first-best

welfare gains, suggesting that they may constitute a good alternative to centralized platforms. Finally,

we use the intuition obtained from analyzing the nature of the two externalities to design simple policies

that mimic the optimal taxes.



References

Acemoglu, D. (2001): "Good Jobs versus Bad Jobs," Journal of Labor Economics, 19, 1­21.

Acemoglu, D. and R. Shimer (1999): "Holdups and Efficiency with Search Frictions," International Economic
  Review, 40, 827­849.

Allen, T. (2014): "Information Frictions in Trade," Econometrica, 82, 2041­2083.

Allen, T. and C. Arkolakis (2019): "The Welfare Effects of Transportation Infrastructure Improvements,"
  NBER working paper, 25487.

Asplund, E. (1968): "Fréchet Differentiability of Convex Functions," Acta Mathematica, 121, 31­47.

Asturias, J. (2018): "Endogenous Transportation Costs," mimeo, School of Foreign Service in Qatar, Georgetown
  University.

Bajari, P., C. L. Benkard, and J. Levin (2007): "Estimating Dynamic Models of Imperfect Competition,"
  Econometrica, 75, 1331­1370.

Belloni, A., D. Chen, V. Chernozhukov, and C. Hansen (2012): "Sparse Models and Methods for Optimal
  Instruments with an Application to Eminent Domain," Econometrica, 80, 2369­2429.

Bertsekas, D. P. (2009): Convex Optimization Theory, Athena Scientific Belmont.

Bian, B. (2020): "Search Frictions, Network Effects and Spatial Competition: Taxis versus Uber," mimeo, Penn
  State University.

Bilal, A. (2020): "The Geography of Unemployment," mimeo, Princeton University.


                                                     41
Boyd, S. and L. Vandenberghe (2004): Convex Optimization, Cambridge University Press.

Brancaccio, G., M. Kalouptsidi, and T. Papageorgiou (2020a): "Geography, Transportation, and Endoge-
  nous Trade Costs," Econometrica, 88, 657­691.

------ (forthcoming): "A Guide to Estimating Matching Functions in Spatial Models," International Journal of
  Industrial Organization, (Special Issue EARIE 2018).

Brancaccio, G., D. Li, and N. Schuerhoff (2020b): "Learning by Trading: The Case of the US Market for
  Municipal Bonds," mimeo, Cornell University.

Brooks, L., N. Gendron-Carrier, and G. Rua (2018): "The Local Impact of Containerization," mimeo,
  University of Toronto.

Buchholz, N. (2020): "Spatial Equilibrium, Search Frictions and Dynamic Efficiency in the Taxi Industry," mimeo,
  Princeton University.

Burdett, K. and M. G. Coles (1997): "Marriage and Class," Quarterly Journal of Economics, 112, 141­168.

Burdett, K. and D. T. Mortensen (1998): "Wage Differentials, Employer Size, and Unemployment," Interna-
  tional Economic Review, 39, 257­273.

Cao, G., G. Z. Jin, X. Weng, and L.-A. Zhou (2018): "Market Expanding or Market Stealing? Competition
  with Network Effects in Bike-Sharing," NBER working paper, 24938.

Castillo, J. C. (2019): "Who Benefits from Surge Pricing?" mimeo, Stanford University.

Collard-Wexler, A. (2013): "Demand Fluctuations in the Ready-Mix Concrete Industry," Econometrica, 81,
  1003­1037.

Cosar, A. K. and B. Demir (2018): "Shipping inside the Box: Containerization and Trade," Journal of Inter-
  national Economics, 114, 331­345.

Diamond, P. A. (1982): "Wage Determination and Efficiency in Search Equilibrium," Review of Economic Studies,
  49, 217­227.

Ducruet, C., R. Juhasz, D. K. Nagy, and C. Steinwender (2019): "All Aboard: The Aggregate Effects of
  Port Development," mimeo, Columbia University.




                                                      42
Eaton, J., D. Jinkins, J. Tybout, and D. Xu (2016): "Two-sided Search in International Markets," mimeo,
  Penn State University.

Ericson, R. and A. Pakes (1995): "Markov-Perfect Industry Dynamics: A Framework for Empirical Work," The
  Review of Economic Studies, 62, 53­82.

Fajgelbaum, P. D. and E. Schaal (2019): "Optimal Transport Networks in Spatial Equilibrium," forthcoming,
  Econometrica.

Frechette, G. R., A. Lizzeri, and T. Salz (2019): "Frictions in a Competitive, Regulated Market Evidence
  from Taxis," American Economic Review, 109, 2954­2992.

Galichon, A. (2018): Optimal Transport Methods in Economics, Princeton University Press.

Gavazza, A. (2011): "The Role of Trading Frictions in Real Asset Markets," American Economic Review, 101,
  1106­1143.

------ (2016): "An Empirical Equilibrium Model Of a Decentralized Asset Market," Econometrica, 84, 1755­1798.

Ghili, S. and V. Kumar (2020): "Spatial Distribution of Supply and the Role of Market Thickness: Theory and
  Evidence from Ride Sharing," mimeo, Yale University.

Holmes, T. J. and E. Singer (2018): "Indivisibilities in Distribution," NBER working paper, 24525.

Hopenhayn, H. A. (1992): "Entry, Exit, and Firm Dynamics in Long Run Equilibrium," Econometrica, 60,
  1127­1150.

Hosios, A. J. (1990): "On the Efficiency of Matching and Related Models of Search and Unemployment," The
  Review of Economic Studies, 57, 279­298.

Hummels, D. and S. Skiba (2004): "Shipping the Good Apples Out? An Empirical Confirmation of the Alchian-
  Allen Conjecture," Journal of Political Economy, 112, 1384­1402.

Imbens, G. W. and W. K. Newey (2009): "Identification and Estimation of Triangular Simultaneous Equations
  Models Without Additivity," Econometrica, 77, 1481­1512.

Kalouptsidi, M. (2014): "Time to Build and Fluctuations in Bulk Shipping," American Economic Review, 104,
  564­608.




                                                      43
------ (2018): "Detection and Impact of Industrial Subsidies, the Case of Chinese Shipbuilding," Review of Eco-
  nomic Studies, 85, 1111­1158.

Koopmans, T. C. (1949): "Optimum Utilization of the Transportation System," Econometrica, 17, 136­146.

Kreindler, G. (2020): "Peak-Hour Road Congestion Pricing: Experimental Evidence and Equilibrium Implica-
  tions," Mimeo, Harvard University.

Krolikowski, P. M. and A. H. McCallum (2018): "The Role of Trade Costs in the Surge of Trade Imbalances,"
  Federal Reserve Bank of Cleveland, Working Paper no. 16-35R.

Lagos, R. (2000): "An Alternative Approach to Search Frictions," Journal of Political Economy, 108, 851­873.

------ (2003): "An Analysis of the Market for Taxicab Rides in New York City," International Economic Review,
  44, 423­434.

Lagos, R. and R. Wright (2005): "A Unified Framework for Monetary Theory and Policy Analysis," Journal
  of Political Economy, 113, 463­484.

Lange, F. and T. Papageorgiou (2020): "Beyond Cobb-Douglas: Flexibly Estimating Matching Functions with
  Unobserved Matching Efficiency," NBER working paper, 26972.

Lee, J., S.-J. Wei, and J. Xu (2020): "The Welfare Cost of the Current Account Imbalance: A New Channel,"
  mimeo, Columbia University.

Liu, T. X., Z. Wan, and C. Yang (2019): "The Efficiency of A Dynamic Decentralized Two-sided Matching
  Market," mimeo, University of Rochester.

Ma, H., F. Fang, and D. C. Parkes (2018): "Spatio-Temporal Pricing for Ridesharing Platforms," arXiv
  preprint arXiv:1801.04015.

Marimon, R. and J. Werner (2019): "The Envelope Theorem, Euler and Bellman Equations, without Differ-
  entiability," mimeo, European University Institute.

Matzkin, R. L. (2003): "Nonparametric Estimation of Nonadditive Random Functions," Econometrica, 71, 1339­
  1375.

Moen, E. R. (1997): "Competitive Search Equilibrium," Journal of Political Economy, 105, 385­411.




                                                        44
Mortensen, D. T. (1982): "The Matching Process as a Noncooperative Bargaining Game," in The Economics of
  Information and Uncertainty, ed. by J. J. McCall, University of Chicago Press.

------ (2003): Wage Dispersion: Why Are Similar Workers Paid Differently?, Cambridge, MA: MIT Press.

Ostrovsky, M. and M. Schwarz (2018): "Carpooling and the Economics of Self-Driving Cars," Mimeo, Stanford
  University, 25487.

Pakes, A., M. Ostrovsky, and S. T. Berry (2007): "Simple Estimators for the Parameters of Discrete
  Dynamics Games," The RAND Journal of Economics, 38, 373­399.

Panayides, P. M. (2016): Principles of Chartering, CreateSpace Independent Publishing Platform, 2nd ed.

Petrongolo, B. and C. A. Pissarides (2001): "Looking Into the Black Box: A Survey of the Matching
  Function," Journal of Economic Literature, 39, 390­431.

Pissarides, C. A. (1985): "Short-Run Equilibrium Dynamics of Unemployment, Vacancies, and Real Wages,"
  American Economic Review, 75, 676­690.

Postel-Vinay, F. and J.-M. Robin (2002): "Equilibrium Wage Dispersion with Worker and Employer Hetero-
  geneity," Econometrica, 70, 2295­2350.

Rogerson, R., R. Shimer, and R. Wright (2005): "Search-Theoretic Models of the Labor Market: A Survey,"
  Journal of Economic Literature, 43, 959­988.

Rust, J. (1987): "Optimal Replacement of GMC Bus Engines: An Empirical Model of Harold Zurcher," Econo-
  metrica, 55, 999­1033.

Ryan, S. P. (2012): "The Costs of Environmental Regulation in a Concentrated Industry," Econometrica, 80,
  1019­1062.

Shapiro, M. H. (2018): "Density of Demand and the Benefit of Uber," mimeo, Singapore Management University.

Shimer, R. and L. Smith (2000): "Assortative Matching and Search," Econometrica, 68, 343­369.

Weill, P.-O. (2020): "The Search Theory of OTC Markets," Annual Review of Economics.

Wong, W. F. (2018):        "The Round Trip Effect:    Endogenous Transport Costs and International Trade,"
  mimeo,University of Oregon.




                                                      45
Online Appendix

A        Proofs

A.1        Preliminaries: limit equilibrium outcomes and associated dual variables

In this section we show that every limit equilibrium outcome can be associated with a set of dual vari-

ables corresponding to the no-discounting limits of the agents' value function. These variables will be

instrumental in the proofs of Theorems 1 and 2 below.

       Let (s, E, q, b,  ) be a limit equilibrium outcome and (sn , E n , q n , bn ,  n ,  n )n0 be a corresponding

sequence of equilibrium outcomes and discount factors, as defined in Definition 2. For each n, let

V s,n , U s,n , s,n and U e,n , e,n be the corresponding value functions and meeting surpluses for carriers

and customers, respectively. Fix an arbitrary reference location i .

Lemma 1. The sequences (Vis,n - Vis,n      s,n
                                   )n0 , (Ui   - Vis,n               s,n
                                                    )n0 , ((1 -  ) Vi )n0 and
                                                                n                                                                    s,n
                                                                                                                                     ij         are
                                                                                                                                           n0
bounded for every i and j .             e,n
                                        ij                                             i > 0.
                                                         is also bounded provided that e
                                                  n0


Proof. Taking into account equation (4) we can rewrite the carrier's surplus, s,n
                                                                              ij , defined in equation (2)

as s,n             s,n        s,n           s,n
   ij = max ij + Vij - maxj Vij , 0 . Hence ij is bounded above by ij and below by zero. Since
            n                                                      n


 n converges to  , it follows that s,n
                                   ij is bounded. Note that in the steady state, equation (1) becomes:
  s = -cs + d V s / (1 -  (1 - d )) . (1 -  n ) V s,n is bounded as an average of bounded prices and
Vij     ij   ij j               ij               i

the finite set of all possible per-period search and traveling costs.36 Vis,n - Vis,n
                                                                                      is bounded below, since
                                                            s,n                          s,n    s,n
  36
       In particular, from equation (3), we have that -cs
                                                        i + i                    j
                                                                                     Gn
                                                                                      ij ij + Vij    Vis,n for all ij , so that
                                                                                        n s,n
                                                                             -cs
                                                                               ij + dij  Vj
                                         - cs   s,n
                                            i + i              Gn  s,n
                                                                ij ij +                       - Vis,n  0                                        (40)
                                                                             1 -  (1 - dij )
                                                                                   n
                                                           j

                                                                                                                                  s,n
                s,n               s,n        -cs                                                                         dij  n Vj
     n
Let kij = -cs
            i + i             Gn
                               ij ij + 1- n
                                               ij
                                                         . This is a bounded sequence. Hence (40) is written as                          Vis,n - kij
                                                                                                                                                  n
                          j                   (1-dij )                                                                  1- n (1-dij )
                              1- n (1-dij ) s,n       1- n (1-dij ) n
for all i = j , or Vjs,n        dij  n
                                           Vi     -     dij  n
                                                                   kij .   Applying the same inequality on Vis and rearranging, we obtain

                (1 -  n +  n dij ) (1 -  n +  n dji )                      (1 -  n +  n dij ) (1 -  n +  n dji ) n    1 -  n -  n dij n
           1-                                                  Vjs,n  -                                         kji -                kij
                            dji dij  n                                          dij  n             dji  n                 dij  n

  It is easy to see that the right-hand-side is bounded. Moreover, the left-hand-side, after straightforward computations, be-
        1-(1- n )- n (dij +dji )                             1-(1- n )- n (dij +dji )  (dij +dji )
comes          dij dji  n
                                 (1 -  n ) Vjs,n . But lim 1       dij dji  n
                                                                                      = dij dji and hence (1 -  n ) Vjs,n is bounded.




                                                                            46
we have

                                                             n dii Vis,n
                                                                         - cs
                                                                            ii
               Vis,n - Vis,n
                              -cs   s,n
                                i + i
                                                     s,n
                                                  ij ij +
                                                 Gn                            - Vis,n
                                                                                   
                                          j =i
                                                            1 -  (1 - dii )
                                                                  n


                                   s,n               s,n          csii          (1 -  n ) Vis,n
                                                                                            
                           = -cs
                               i + i              ij ij -
                                                 Gn                          -
                                          j =i
                                                            1 -  n (1 - dii ) 1 -  n (1 - dii )


and all sequences on the right-hand-side are bounded. Reversing the roles of i and i it follows that

Vis,n - Vis,n
              is bounded above as well.
                           e,n
   Finally, if e
               i > 0, then i   > 0 for n large enough. Hence, based on Equations (10) and (11), for n

large enough, we have,
                                        e,n
                                   ij + i
                                 -ce        wij (q n ) - ij
                                                         n
                                                                   e,n
                                                                  Uij   ij .
                                      1 - (1 - e,n
                                               i )
                                                   n

                                        e,n
   Since the left-hand-side converges, Uij  is bounded. Finally, by equation (10), this implies that e,n
                                                                                                     ij

is bounded as well.

   Given Lemma 1, there exists a sequence (nk )k0  N such that we can define the limits


                                          i = lim Vis,nk - Vis,n
                                                             
                                                                 k
                                                  k



                                          i = lim Uis,nk - Vis,n
                                                             
                                                                 k
                                                   k


                                           = lim (1 -  nk ) Vis,n
                                                              
                                                                  k
                                                 k

                                                 ¯ s = lim s,nk .
                                                   ij      ij
                                                      k


If e
   i > 0 then we can also define the limit



                                                 ¯ e = lim e,nk
                                                   ij      ij
                                                       k



otherwise we simply define ¯ e = max {wij (q ) - ij - ij , 0} .
                             ij




                                                       47
   Note that for every i it holds that


             lim (1 -  nk ) Vis,nk = lim (1 -  nk ) (Vis,nk - Vis,n
                                                                
                                                                    k
                                                                      ) + lim (1 -  nk ) Vis,n
                                                                                           
                                                                                               k
                                                                                                 = .
             k                            k                                    k
                                                          =0


Definition 4. , , , ¯ s, ¯ e is a tuple of equilibrium dual variables associated with the limit equilib-

rium outcome (s, E, q, b,  ).

Lemma 2. Let (s, E, q, b,  ) be a limit equilibrium outcome and                  , , , ¯ s, ¯e   be a tuple of dual

variables associated with it. Then the following conditions hold for every i, j :


                                                cs
                                                 ij    
                                  i  j -            -     with equality if bij > 0                             (41)
                                                dij   dij
                                     ¯ s  0 with equality if qij < si s Gij
                                                                                                               (42)
                                       ij                             i


                                                          ¯ s + i with equality if si > 0
                                 i + i
                            i  -cs                    Gij                                                      (43)
                                     s
                                                            ij
                                               j =i

                                                                       qij + bij
                                       0 with equality if                        <S                            (44)
                                                                  ij
                                                                          dij

                                          ¯ e  0 with equality if qij < e eij
                                                                                                               (45)
                                            ij                          i


                                                              e¯e
                                                         ij + i ij = 0
                                                      - ce                                                     (46)

                                ¯ s  ij + j - i -  with equality if qij > 0
                                                                                                               (47)
                                  ij
                                                  dij
                                ¯ e  wij (q ) - ij - ij with equality if qij > 0.
                                                                                                               (48)
                                  ij


Proof. The reader can verify this by taking the no-discounting limits of the equilibrium conditions (2)-

(14). For example, the equilibrium conditions (4) and (8) can be written as (taking into account that in

steady state Vij
               s = d V s - cs / (1 -  (1 - d )))
                    ij j    ij              ij



                                           n dij Vjs,n - cs
                                                          ij
                                Uis,n >                      , with equality if bn
                                                                                 ij > 0.
                                          1 - (1 - dij )  n




                                                             48
Subtracting Vis,n
                  from both sides we obtain,


                         n dij Vjs,n - Vis,n
                                                          cs
                                                           ij         (1 -  n ) Vis,n
                                                                                  
      Uis,n - Vis,n
                    >                          -                    -                  , with equality if bn
                                                                                                           ij >0
                          1 - (1 - dij )  n        1 - (1 - dij )  n 1 - (1 - dij )  n

Taking limits of both sides as n   yields Condition (41).

As another example, notice that the equilibrium conditions (2), (6) and (7) are equivalent to


                                     s,n                            n s,n n
                                     ij  0, with equality if qij < si i Gij
                                                              n




and

                                 s,n        s,n  s,n
                                 ij  ij + Vij - Ui , with equality if qij > 0.
                                     n                                 n



Taking the limit of the first one gives Condition (42). The second condition can be written as,


                        s,n n      s,n   s,n  s,n
                        ij  ij + Vij - Vi - (Ui   - Vis,n
                                                       ) , with equality if qij > 0.
                                                                             n




Taking the limits of both sides gives Condition (47).

   Analogous arguments establish the remaining conditions. More precisely, Condition (43) is a con-

sequence of the equilibrium conditions (3) and (5); Condition (44) is a consequence of the equilibrium

conditions (3) and (9); Condition (45) results from the the equilibrium conditions (10) and (12); Condition

(46) is obtained from the equilibrium conditions (11) and (14); and finally, Condition (48) is obtained

from the equilibrium conditions (10), (13) and (14). Finally notice that combining conditions (47) and

(48) we obtain,
                        ¯s + 
                             ¯ e  wij (q ) - ij + j - i -  with equality if qij > 0.                               (49)
                         ij    ij
                                                          dij




A.2      Proof of Theorem 1

Consider Problem (20), and let , , , ¯ s and ¯ e be the dual variables associated with constraints

(15), (16), (17), (21) and (22), respectively. Since Problem (20) is concave, convex duality implies that



                                                            49
 s, E, q, b, , , , ¯ s, ¯ e is an optimal dual pair of Problem (20) (that is, (s, E, q, b) is an optimal solution

of Problem (20) and , , , ¯ s, ¯ e are the multipliers associated with the constraints) if and only if

it satisfies the Karush-Kuhn-Tucker conditions (see for example Bertsekas, 2009, Prop. 5.2.2, pg. 167).

The reader can verify that these can be written as conditions (41)-(46), as well as condition (49). Hence

the result follows by taking , , , ¯ s, ¯ e to be a tuple of equilibrium dual variables associated with

s, E, q, b and applying Lemma 2.


A.3     Proof of Theorem 2

First, we show that Vp is concave. Then, we characterize its supergradient. Finally, we exploit this

characterization to prove the main result.

Lemma 3. For each (s, e, G)  0 such that         i si    S and       j   Gij = 1 i, consider the set M (s, e, G) of all

pairs (q, b)  0 satisfying constraints (15)-(17) given s, e, G. The multi-valued map (s, e, G)  M (s, e, G)

satisfies

                               (1 - ) M (u) + M (u )  M (1 - ) u + u

for every u = (s, e, G) and u = (s , e , G ).

Proof. It follows from the concavity of the matching function.

    Next we show that:

Lemma 4. Let f (x, u) be convex in (x, u) and M (u) satisfies the convexity property of the previous

lemma. Then the function:

                                             g (u) =     inf     f (x, u)
                                                        xM (u)


is convex.

Proof. The above is a well-known result when M (u) is convex and does not vary with u (see for instance

Boyd and Vandenberghe, 2004). We adapt the proof to this case. Let u1 , u2 and   [0, 1] and                       > 0.

Then there exist x1  M (u1 ) and x2  M (u2 ) such that f (x1 , u1 )  g (u1 ) + and f (x2 , u2 )  g (u2 ) + .

Then,

                       g (u1 + (1 - ) u2 ) =             inf             f (x, u1 + (1 - ) u2 )
                                                xM (u1 +(1-)u2 )


                                                          50
Since x1 + (1 - ) x2  M (u1 ) + (1 - ) M (u2 )  M (u1 + (1 - ) u2 ), we have,


                     inf          f (x, u1 + (1 - ) u2 )  f (x1 + (1 - ) x2 , u1 + (1 - ) u2 )
              xM (u1 +(1-)u2 )



Since f (·) is convex in (x, u) we have,


                           g (u1 + (1 - ) u2 )  f (x1 + (1 - ) x2 , u1 + (1 - ) u2 )

                                                   f (x1 , u1 ) + (1 - ) f (x2 , u2 )

                                                   g (u1 ) + (1 - ) g (u2 ) +


Since this is true for all , convexity is established.

   Applying this lemma to the function -V p (s, e, G), defined in (23), we obtain that V p (s, e, G) is con-

cave. Hence, it is differentiable almost everywhere in its domain. Denote by V p (s, e, G) the supergradient

of V p at a search allocation s, e, G, that is, the set of all vectors


                             y = (y (si ) iI , y (ei ) iI , y (Gij ))i,j I  RI × RI × RI ×I


such that for every search allocation s , e , G :


      V p s , e , G - V p (s, e, G)           y (si ) si - si +          y (ei ) ei - ei +        y (Gij ) Gij - Gij .
                                          i                          i                       ij


Similarly, for every i, j , we denote by si V p (s, e, G), ei V p (s, e, G) and Gij V p (s, e, G) the supergradients

of V p at s, e, G with respect to si , ei and Gij , respectively.

Lemma 5. Take a limit equilibrium allocation (s, e, G, q, b), and let , , , ¯ s, ¯ e be a tuple of equi-

librium dual variables associated with it. For every i, j define

                                                    dmi (si , ei )           ¯s + ¯ e + i
                            y (si ) = -i - cs
                                            i +                          Gij  ij    ij
                                                       dsi           j


                                                    dmi (si , ei )           ¯s + ¯e
                                 y (ei ) = -ce
                                             ij +                        Gij  ij   ij
                                                       dei           j


                                                            51
                                  y (Gij ) = -ei ce                  ¯s   ¯e
                                                  ij + mi (si , ei ) ij + ij .


Then y  V p (s, e, G).

Proof. Consider Problem (23) defining V p (s, e, G). Its Lagrangian can be written as

                                                                            cs              
 L q ,b , , ,¯ ,  |s, e, G =W q +                      qij + bij        -
                                                                             ij
                                                                                + j -  i -            -        qij ¯ + ij
                                                                                                                    ij
                                                ij
                                                                            dij            dij            ij

                                                                       si i - i + cs                                       ¯ + S
                                   -       ei        Gij ce
                                                          ij -                     i +             mi (si , ei )       Gij  ij
                                       i        j                  i                           i                   j


and the Karush-Kuhn-Tucker (K-K-T) conditions as

                                                cs
                                                 ij    
                                  i  j -            -     with equality if bij > 0
                                                dij   dij

                                  ¯ ij  0 with equality if qij < mi (si , ei ) Gij
                                  

                                           cs              
                           ¯ ij  j -
                           
                                            ij
                                               - ij - i -     with equality if qij > 0
                                           dij            dij

                                                                            qij + bij
                                      0 with equality if                              <S
                                                                       ij
                                                                               dij

which are equivalent to the set of Conditions (41), (42)/(45), (49) and (44), respectively, taking ¯ ij =

¯s +
    ¯ e . Since the problem is concave, the K-K-T conditions are necessary and sufficient for optimality.
 ij   ij

Hence letting , , , ¯ s, ¯ e be a tuple of equilibrium dual variables associated with (s, e, G, q, b), it

follows that q, b, , , ¯s + ¯ e ,  is an optimal dual pair for Problem (23). From the assumptions of

Theorem 2 , it follows that (q, b) is the unique optimal solution of Problem (23). Hence the result follows

from Theorem 2 of Marimon and Werner (2019).

   We now proceed with the proof of the main result. By the previous analysis, Problem (24) is concave,

hence optimality is characterized by the K-K-T conditions. Recall that we are assuming that s and e are

in the interior of the feasible set (si , ei > 0 for each i and              i si   < S ). Hence conditions (25) and (26) are

equivalent to the first order conditions,


                                0  si V p (s, e, G) i and 0  ei V p (s, e, G) i

                                                             52
respectively. Denoting by ij and µi the multipliers associated with the constraints Gij  0 and          j   Gij =

1, condition (27) is equivalent to

                                                0 - ij - µi  Gij V p (s, e, G)

                      ×I
for some µ,   RI × RI
                    +    such that ij Gij = 0. It follows from the previous Lemma that conditions


                                     i : y (si ) = 0                                                         (50)

                                     i : y (ei ) = 0                                                         (51)

                                   i, j : y (Gij ) + µi  0 with equality if Gij > 0                          (52)


are sufficient for conditions (25), (26) and (27), respectively, and they are necessary whenever V p (s, e, G)

is differentiable. Comparing with condition (43), condition (50) is equivalent to

                          dmi (si , ei )             ¯s + ¯ e + i = i = -cs + s               ¯ s + i
             i : - cs
                    i +                          Gij  ij    ij            i   i           Gij   ij
                             dsi            j                                         j

                  s
                  i           Gij ¯s + ¯e =                  Gij ¯s ,
                                   ij   ij                        ij
                          j                              j


Similarly, comparing with condition (46), condition (51) is equivalent to

                                   dmi (si , ei )           ¯s + ¯ e = 0 = -ce + e            ¯e
                  i : - ce
                         ij +                           Gij  ij    ij        ij  i        Gij  ij
                                      dei           j                                 j

                                  Gij ¯ e = e           Gij ¯s + ¯e .
                                        ij  i                ij   ij
                              j                     j


Condition (52) requires


                                             ¯s   ¯e
                          ij + mi (si , ei ) ij + ij + µi  0 with equality if Gij > 0.
                    - ei ce                                                                                  (53)


Since -ei ce                  ¯e
           ij + mi (si , ei ) ij = 0 from Condition (46), this is equivalent to Condition (iii) in the Theorem

2. This completes the proof of Theorem 2.




                                                                53
A.4    Proof of Corollary 1

Suppose that (s, e, G, q, b,  ) is efficient. Conditions (i) and (ii) of Theorem 2 imply that i
                                                                                              s = 1 -  e for all
                                                                                                      i

i. For every ij such that Gij > 0, Conditions (i) and (iii) of Theorem 2 imply ¯ s = (1 -  e )             Gij ¯ ij .
                                                                                 ij       i            j

By Condition (48) we have ¯ e = wij (q ) - ij - ij . Substituting ¯s = ¯ ij - ¯e = ¯ ij - wij (q )+ ij + ij
                            ij                                     ij          ij

yields Condition (31).


A.5    Efficiency Without Constant Returns to Scale

In the discussion following Theorem 2 we noted that, unless all matching functions display constant

returns to scale, efficiency cannot be achieved. In this section we allow the planner to charge a price

to customers,  e , that is different from the price paid to carriers,  s . The price wedge  e -  s can be

interpreted as a tax/subsidy. We show that in this setting the planner can achieve efficiency even when

the matching functions do not exhibit constant returns to scale.

   The definition of equilibrium can be extended to this case in a straightforward manner: (s, e, G, q, b,  e ,  s )

is an equilibrium outcome, if carriers behave optimally given  s , s and G; customers behave optimally

given  e and e ; the feasibility constraints are satisfied; and s , e and G are consistent with the allocation.

   The social planner's problem is the one stated in (24). Notice that the tax revenues do not appear in

the social welfare since they are a transfer from the agents to the planner (one can imagine that the tax

revenues are paid back to agents by means of a lump sum transfer). On the other hand, the limit social

surplus resulting from a match now takes the planner's revenue into account:


                                         ¯ ij = 
                                                ¯s + ¯ e + e - s .
                                                 ij    ij  ij  ij



With these modifications, we can proceed along the lines of the proof of Theorem 2 to show the following:

Theorem 3. Let (s, e, G, q, b,  e ,  s ) be a limit equilibrium outcome. Suppose that Problem (23) admits a

unique optimal solution. Then:

   (i) Carriers internalize thin/thick market externalities if and only if

                                                          Gij ¯s
                                                      j         ij
                                          i  I :                   = i
                                                                     s
                                                                       .                                       (54)
                                                              ¯
                                                          Gij ij
                                                      j



                                                      54
   (ii) Customers internalize thin/thick market externalities if and only if

                                                            Gij ¯e
                                                        j         ij
                                           i  I :                    = i
                                                                       e
                                                                         .                                       (55)
                                                                ¯
                                                            Gij ij
                                                        j


   (iii) Customers internalize pooling externalities if and only if


                                    ¯ s +  e -  s = max 
                                                        ¯ s + e - s                                              (56)
                                      ij  ij   ij         ik  ik  ik
                                                        k=i



for all ij such that Gij > 0.

   Hence, the characterization of efficiency in the economy with a price wedge is the same as the one in

the main text except for the last condition, which requires that, at each location i, the sum of the carrier

surplus and the planner's revenue is constant across destinations­ in other words, customers must fully

internalize the differences in the matching surpluses across different destinations. We can then use this

result to characterize the optimal pricing rules. Let (s, e, G, q, b,  e ,  s ) be an efficient limit equilibrium

outcome and suppose that (s, e, G, q, b) is efficient. For simplicity, consider the case where Gij > 0 for all

ij . Condition (55) can be written as


                        Gij ¯ s + e - s =             Gij ¯ ij - ¯ e = (1 -  e )                    Gij ¯ ij .
                              ij  ij  ij                           ij       i
                    j                             j                                             j


Hence Condition (56) implies that


                                ¯ ij - 
                                       ¯e = ¯ s +  e -  s = (1 -  e )                Gij ¯ ij
                                        ij    ij  ij   ij        i
                                                                                 j


for every ij . Substituting ¯ e = wij (q ) -  e - ij into this equation we find
                              ij             ij



                                 e
                                 ij = wij (q ) - ij - ¯ ij + (1 -  e )           Gij ¯ ij                        (57)
                                                                  i
                                                                             j


which is the pricing rule in equation (31). The average price wedge can be derived by summing conditions




                                                        55
(54) and (55), and recalling that ij
                                  e - s = ¯ ij - ¯e - ¯s :
                                      ij          ij   ij



                                          e
                                      Gij ij   s
                                             - ij = (1 - i
                                                         e   s
                                                           - i )                Gij ¯ ij .                  (58)
                                 j                                      j


This expression can be interpreted as saying that the average price wedge at each location is proportional to

the "degree of decreasing returns to scale". Under constant returns to scale the wedge is zero: consistently

with our main results, efficiency in this case can be achieved by setting a unique price on every route. If

the matching function has decreasing returns to scale then the price wedge is positive, imposing a tax on

matches at that location, capturing the social cost of making additional matches harder to form because of

decreasing returns. On the contrary, matches are subsidized when the matching functions have increasing

returns.

    Conversely, it is easy to see that equations (57) and (58) imply equations (54)-(56).

    We state the conclusions of this section below:

Corollary 3. Let (s, e, G, q, b,  e ,  s ) be a limit equilibrium outcome. Then s, e, G, q, b is efficient if and

only if for all i, j
                                e
                                ij = wij (q ) - ij - ¯ ij + (1 -  e )            Gij ¯ ij
                                                                 i
                                                                            j

and
                                          e
                                      Gij ij   s
                                             - ij = (1 - i
                                                         e   s
                                                           - i )                Gij ¯ ij
                                  j                                     j


A.6     Proof of Corollary 2

Before proceeding with the proof, we briefly describe how incentives and total welfare are affected by a

vector of taxes/subsidies h = (hq , hs , he ). The dynamic problem for customers is the same as in Section

2.2 except that now customers waiting at location i pay the amount he
                                                                    i every period (on top of the private

waiting cost ce
              ij ); carriers searching at location i pay the amount hi every period (on top of their private
                                                                     s

                                                                      q
search cost cs
             i ); and every match on route ij is taxed by the amount hij . It does not matter which

side pays the trip tax (customers or carriers), so suppose that it is paid by customers (see footnote 16).




                                                       56
Therefore, the only expressions that change compared to Section 2.2 are the carriers' value of searching:
                                                                                                  
                                                                                                  
                                   Vis = max -cs
                                               i - hi +  i
                                                    s    s
                                                                                  ij + Ui , Vi
                                                                              Gij s     s     s
                                                                                                  
                                                                       j =i


and the customers' value of waiting and meeting surplus:


                                              e
                                             Uij = -ce
                                                     ij - hi + i ij + Uij
                                                           e   e e     e



                                                                 q
                                       e
                                       ij = max wij (q ) - ij - hij - Uij , 0 .
                                                                       e



The definition of equilibrium allocations can be given as in Section 2.2.

       The social planner's problem is the one stated in (24). Notice that the tax revenues do not appear in

the social welfare since they are a transfer from the agents to the social planner (one can imagine that

the tax revenues are paid back to agents by means of a lump sum transfer). On the other hand, the limit

social surplus resulting from a match now takes into account the planner's revenue as well:


                                                    ¯ ij = 
                                                           ¯s + ¯ e + hq .
                                                            ij    ij   ij



       Now for the proof of Corollary 2, let q, s, e, G be a limit equilibrium allocation in the economy with

taxes. Proceeding as in the proof of Theorem 2, one can show that37
  37
    In particular, we proceed by showing that the limits of the equilibrium conditions are a slight modification of conditions
(41)-(48) in Section A.1
                                  cs
                                   ij                      ¯e   ¯s    
                     wij (q ) -       - ij + j - i - hq
                                                      ij - ij - ij -      0 with equality if qij > 0
                                  dij                                dij
                                         cs
                                          ij              
                                       -      +  j - i -      0 with equality if bij > 0
                                         dij             dij
                                        ¯e
                                              ¯s
                                         ij , ij  0 with equality if qij  mi (si , ei ) Gij

                                                                              qij + bij
                                              0 with equality if                        <S
                                                                                 dij
                                              i = -cs    s       s
                                                    i - hi + i + i                 Gij ¯s
                                                                                        ij
                                                                               j

                                                     -ce
                                                      - +
                                                       ij    he
                                                              i    e0¯e
                                                                   i ij

                                   wij (q ) -  e       ¯ e
                                              - ij - ij  0 with equality if qij > 0
                                               ij
Moreover, Nash bargaining requires that (1 - i ) ¯s       ¯e
                                                  ij = i ij . On the other hand, the conditions for different externalities
to be internalized are unchanged. Comparing the efficiency conditions with the new equilibrium conditions as in the proof



                                                                  57
   · Thin/thick market externalities are internalized if and only if for all i,


                                                      ¯ s = s              ¯ ij +     hs
                                                  Gij   ij  i          Gij             i
                                                                                                                                 (59)
                                              j                    j
                                                                                      si


      and
                                                      ¯ e = e              ¯ ij +     he
                                                  Gij   ij  i          Gij             i

                                              j                    j
                                                                                      ei


   · Pooling externalities are internalized if and only if for all i, j ,


                                        ¯ s + hq  Li with equality if Gij > 0
                                          ij   ij



      where Li is an arbitrary constant.

Using the definition ¯ ij = ¯e + ¯ s + hq and the Nash bargaining condition (1 - i ) ¯ s = i ¯ e it
                             ij    ij   ij                                             ij      ij

follows that ¯ ij =   1 ¯s
                             + hq     ¯s     ¯       q                 ¯s
                      i ij      ij or ij = i ij - i hij . Substituting ij into (59) we obtain the Condition

(34). We proceed similarly for customers to obtain Condition (35).

    Next, we turn to the relationship ¯ s + hq  Li with equality if Gij > 0. The constant Li is related
                                        ij   ij

to the Lagrange multiplier associated with the constraint                j   Gij = 1. Consider all j such that Gij > 0.

Then ¯ s + hq = Li . Multiply by Gij and sum over j to obtain, Li =                            Gij ¯s ij +       Gij hq
       ij   ij                                                                             j                 j        ij . Clearly the

sums can be extended to all j since the terms with Gij = 0 do not contribute to the sum. Thus pooling

externalities are internalized if and only if


                                       ¯ s + hq 
                                                          Gij ¯s ij +            Gij hq
                                         ij   ij                                      ij
                                                      j                      j


with equality if Gij > 0. We now express ¯ s in terms of ¯ ij using the surplus sharing condition which
                                           ij

yields ¯ s = i ¯ ij - hq :
         ij            ij



                             i ¯ ij - hq + hq  i               Gij ¯ ij - hq +                     Gij hq
                                       ij   ij                             ij                           ij
                                                          j                                    j

of Theorem 2 we get the result shown below.




                                                              58
                           i ¯ ij + (1 - i ) hq  i          Gij ¯ ij + (1 - i )       Gij hq
                                              ij                                           ij
                                                       j                          j

which proves (36).



B     Random search in bulk shipping

In this section we investigate whether search in bulk shipping is random (or undirected), as assumed in the

model of Section 2. We contrast this with the case of directed search (see e.g. Moen, 1997), where carriers

choose to search in a specific "market", i.e. a market for customers heading to a specific destination. Under

directed search, profitable markets attract more carriers, thereby reducing their matching probabilities

compared to less profitable markets. We can directly test this implication of directed search by checking

whether in a given origin, i, ships' waiting time is different across destinations j . We use 15 regions, so

for a given region there are (up to) 14 possible destinations; therefore there are              14
                                                                                                 2   = 91 such equalities

to test for every origin i. Using a simple F-test we are only able to reject the null of no difference for 16%

of the equalities.

    In addition, we examine the coefficient of variation of matching probabilities within a given origin.

Weighted by trade shares, the average coefficient of variation is just 8%. In contrast, the coefficient

of variation of trip prices from a given origin is substantially higher and equal to 46%, suggesting that

differences in the attractiveness of different types of customers is reflected in prices, but not in matching

probabilities, as would be the case in directed search.



C     Estimation and computation details

C.1    Model estimation and results

In this section we discuss the estimation of the model. The main parameters of interest are: the matching

functions mi (si , ei ) for all i, the ship travel and wait costs cs
                                                                   ij , ci , for all i, j , as well as the standard
                                                                         s


deviation of the logit shocks  ; the exporter valuations wij , the exporter waiting costs ce
                                                                                           i , and entry costs

ij for all i, j ; and the bargaining coefficients i for all i. The available data consist of the matches mi

and ships si for all i, the ship ballast choice probabilities Pij , for all ij , the average prices ij on all routes



                                                           59
ij , the exporter entry probabilities Pij
                                        e , for all ij as well as total trade values by country pair (Comtrade).


We describe the estimation of each object in turn.


Matching function estimation We briefly outline the approach adopted to estimate the matching

function in BKP. To illustrate, assume that s and e are independent. We assume that m(s, e) is continuous

and strictly increasing in e, that it exhibits constant returns to scale (CRS), so that m (as, ae) = am (s, e)

for all a > 0, and that there is a known point {s
                                                ¯, e
                                                   ¯, m
                                                      ¯ }, such that m
                                                                     ¯ = m (¯  ¯). The intuition behind the
                                                                            s, e

identification argument is as follows: the observed correlation between s and m informs us on m(s, e)/s,

since by assumption s and e are independent; then, due to CRS, this derivative also delivers the derivative

m(s, e)/e; once these derivatives are known, the matching function is known and can be inverted to

provide the number of exporters.

       More formally, suppose we have a sample {sit , mit }T
                                                           t=0 for each market i. The unknowns of interest are

the I matching functions mi (·) and the exporters eit , for all i, t; henceforth, we suppress the i subscript to

ease notation. Let Fm|s denote the distribution of matches conditional on ships, and Fe the distribution

of exporters, e. Then at a given point {st , et , mt } we have:


                 Fm|s=st (mt |s = st ) = Pr (m (s, e)  mt |s = st ) = Pr e  m-1 (s, mt ) |s = st

                                        = Pr e  m-1 (st , mt ) = Fe (et )


       This equation, along with the CRS assumption, allows us to recover the distribution Fe (e), for all e:

using the known point {s
                       ¯, e
                          ¯, m
                             ¯ } and letting a = e/e
                                                   ¯, for all e,


                                ¯) = Fm|s=as
                           Fe (ae          ¯ (m (as   ¯) |s = as
                                                  ¯, ae        ¯) = Fm|s=as
                                                                          ¯ (am
                                                                              ¯ |s = as
                                                                                      ¯)


                                    ^e (e), relying on a kernel density estimator for the conditional
We use this and vary a to trace out F
             ^m|s=as
distribution F     ¯ (am
                       ¯ |s = as
                               ¯).38

       Since it is unlikely that s and e are independent, we employ an instrument, which consists of the ocean
  38
    We choose the known point, {s   ¯, e  ¯ }, to be of the form 1 = m(¯
                                       ¯, m                            s, 1), so that one exporter is always matched when there
are s               ¯ iteratively, to be the lowest value such that mt  et , for all t, thus obtaining a conservative bound on
    ¯ ships. We set s
search frictions.




                                                              60
weather conditions (unpredictable wind at sea) that shift the arrival of ships at a port without affecting

the number of exporters (also employed in the search frictions test, see Section 4.2).39 Table 4 presents

the first stage estimates.

       Figure 5 reports our estimates for search frictions, along with confidence intervals constructed from

200 bootstrap samples.

                                                                              F-stat

                                         North America West Coast             21.132
                                         North America East Coast             18.429
                                         Central America                      17.877
                                         South America West Coast             18.671
                                         South America East Coast             16.889
                                         West Africa                          16.333
                                         Mediterranean                        46.072
                                         North Europe                         28.651
                                         South Africa                         13.153
                                         Middle East                          68.037
                                         India                                29.521
                                         South East Asia                      34.909
                                         China                                28.642
                                         Australia                            35.977
                                         Japan-Korea                          32.794


Table 4: First Stage, Matching Function Estimation. Regressions of the number of ships in each region on the
unpredictable component of weather conditions in the surrounding seas. The table reports the F-statistic. For the
construction of the instrument, see Table 1.




Ship parameters           We use the estimates for the ship parameters                 cs     s
                                                                                        ij , ci ,    from BKP. To estimate

these parameters, we used a Nested Fixed Point Algorithm (Rust, 1987): at every guess of the parameters

  ij , ci ,  for all i, j , we employ a fixed point algorithm to solve for the ship value functions Vi , Vij , Ui ,
 cs     s                                                                                             s    s    s


for all i, j from equations (1), (3), and (39), using the observed average prices for each route ij and the

observed meeting probability s
                             i (which is set equal to the average mi /si ). We then match the ship ballast
  39
    Assume that an instrument z exists such that s = h (z,  ), with z independent of e,  . The approach now has two steps.
In the first step, we recover  using the relationship s = h (z,  ). In the second step, we repeat the above conditioning on both
s (as before) and  , Fm|s=st , (mt |s = st ,  ) = Fe| (et | ). We recover the unknowns of interest e and m(·), by integrating
both sides over  .




                                                              61
                                                                                                             q

                                          0.2                                                            q




                             min(e,s)-m
                              min(e,s)
                                                                                                 q   q

                                                                                     q   q   q


                                                                                 q

                                                                             q
                                                                q   q
                                                            q
                                                        q

                                          0.1
                                                    q
                                                q




                                             ut eric C

                                                                      C

                                                                      C

                                                                       a

                                                                      ia

                                                                     na

                                                         Au e

                                                                     lia

                                                                        t

                                                                       a

                                                                       a

                                                                       n

                                                                      C

                                                                       a
                                            or me dia




                                                                   as




                                                                    ic
                                                                  ric




                                                                     p




                                                                   re

                                                                     c

                                                                     a

                                                                  W
                                                                   E

                                                                  W

                                                   So a E



                                                                As




                                                                 ra




                                                                fri
                                                                hi

                                                                ro




                                                  Am ane



                                                               er
                                                 Ja le E
                                                               In




                                                              Ko
                                                              Af
                                                  Am ca




                                                              st
                                                              C




                                                M st A



                                                en rica
                                                              a




                                                            Eu




                                                            m
                                                            ic



                                                            st




                                                          n-
                                                           ri




                                                           rr
                                             So uth
                                                         er



                                                        Ea




                                                        lA
                                                          d




                                                        te
                                                       th




                                                         e
                                                       id




                                                        e
                                                     pa
                                                   Am




                                                    W




                                                   tra
                                          So edi
                                                   or



                                                   M
                                                     h
                                                   A




                                                  ut



                                                 N
                                               th




                                                h




                                                h
                                              th




                                             C
                                             ut
                                            or



                                          So
                                           N

                                          N




Figure 5: Search Frictions. Average weekly share of unrealized matches, with confidence intervals from 200
bootstrap samples.


choices predicted by our model and given by the logit choice probabilities,

                                                                    exp Vij
                                                                          s /
                                                            Pij =                                                           (60)
                                                                        l   exp Vil
                                                                                  s /



to the observed ballast choices. We do so by maximizing over the parameters via Maximum Likelihood.

See BKP for further details on identification and estimation.40 Table 5 reports the estimates of the ship

cost parameters, along with confidence intervals constructed from 200 bootstrap samples.


Exporter parameters and bargaining coefficients We are left with four sets of parameters: the

exporter valuations wij , the waiting costs ce
                                             i , the bargaining coefficients i ; and the exporter entry costs

ij , for all i, j .

       The valuations wij are the revenues of exporters in i from selling their commodities to destination j .

We compute them using aggregate trade data from Comtrade, which reports product-level export values
  40
     In BKP we construct seven groups for the sailing cost cs  ij , roughly based on the continent and coast of the origin; and we
estimate wait costs cs
                     i , for all i. The seven groups are: (i) Central America, West Coast Americas; (ii) East Coast Americas;
(iii) West and South Africa; (iv) Mediterranean, Middle East and North Europe; (v) India; (vi) Australia and Southeast
Asia; (vii) China, Japan and Korea. Since cs    ij is the per week sailing cost from i to j , its major component is the cost of
fuel. We set this cost for one of the groups (for trips originating from the East Coast of North and South America) equal to
the average weekly fuel price (40,000 US dollars); such a restriction is required for identification as is standard in dynamic
discrete choice. Moreover, since the fuel cost is paid by the exporter when the ship is loaded, we add it to the observed
prices.



                                                                            62
and quantities by country pair. We focus on bulk commodities and compute the average value of a cargo

of commodities exported from each region i to each j , which forms our direct estimate for wij ; details are

provided in the next section.

      Next, we turn to ce
                        i and i , for all i, which we estimate from observed shipping prices. Nash bargaining

implies the surplus sharing condition,


                                     (1 - i ) ij + Vij
                                                     s
                                                       - Uis = i wij - ij - Uij
                                                                             e




where if we substitute the exporter value Uij
                                           e from its steady state value, U e = (-ce + e (w -  )) / (1 -  (1 - e )),
                                                                           ij      i   i   ij ij               i

we obtain,
                                i + ((1 -  ) (1 - i )) wij
                               ce                            (1 - i ) (1 -  (1 - e
                                                                                 i ))
                                                  e
                     ij = i                                +                          Uis - Vij
                                                                                              s
                                  1 -  (1 - i ) - i i
                                              e       e       1 -  (1 - i ) - i e
                                                                           e
                                                                                  i

In this equation, the only unknowns are i and ce
                                               i , for all i; indeed, note that i is known from the
                                                                                e


matching function (set equal to mi /ei ); Uis , Vij
                                                  s are known once the ship cost parameters are known; w is
                                                                                                        ij

obtained from Comtrade data as described above; and  is calibrated to 0.995. We thus estimate i and

 i via non-linear least squares. Identification results from variation over the regions i, j : intuitively, the
ce

identification of the bargaining coefficient i relies on the correlation of prices ij and values wij across

destinations j , while the inventory cost ce
                                           i matches the overall level of prices at origin i. To gain power,

we restrict ce
             i to be constant within a continent.

      Finally, exporter entry costs ij are estimated using the exporter entry probabilities, which are given

by
                                                            exp Uij
                                                                 e -
                                                                    ij
                                                 e
                                               Pij =                                                                        (61)
                                                       1+     l=i exp
                                                                         e -
                                                                        Uil il


for j = i, where Pii
                   e = 1/ 1 +
                                          l=i exp (Uil
                                                    e    - il ) is interpreted as the option of not exporting at all.

Then, following BKP:


                                                                      i + i (wij - ij )
                                                                    -ce   e
                                ln Pij
                                     e
                                       - ln Pii
                                              e
                                                = Uij
                                                   e
                                                      - ij =                            - ij
                                                                      1 -  (1 - e i)


where ij is the only unknown.41 The results are presented in Table 6.

 41               e
      To recover Pii , the share of the "outside good", corresponding to the choice of not exporting, we use the total production


                                                               63
C.2     Exporter valuations

We construct exporter valuations, wij , from product-level data on export value and quantity by country-

pair, obtained from Comtrade. We select bulk commodities among all possible 4-digit HS product codes.

The list includes cereals (except rice and barley); oil seeds (which consists of mostly soybeans); cocoa

beans; salt and cement; ores; mineral fuels (except petroleum coke); fertilizers; fuel wood and wood pulp;

metals; cermets and articles thereof.

    To compute the average value of a cargo exported from region i to j , we first compute the average

"price" of a ton exported by dividing total export value by total export quantity from i to j . Then, we

multiply this price by the average ship tonnage capacity in our sample.42

    Finally, although most countries belong to one of our regions (depicted in Figure 6), the USA and

Canada each belong to two regions (according to the coast). We thus need to split the Comtrade data

for the USA and Canada into east and west coast export values. To do so, we employ data on state-

level exports from the US Census, as well as on province-level exports from the Canadian International

Merchandise Trade Database. In particular, we assign every state (province) to either the east or the

west coast and compute, for every product, the share of the total value of trade in that commodity that

is exported by east and west coast states (provinces). Then, we compute the total value and quantity

of trade for the region East Coast of North America (West Coast of North America) by summing over

products the share of the value of east (west) coast trade by the total value of the country's trade for the

USA and Canada. Implicitly, this approach assumes that export values from these two regions are only

different due to the composition of products, not their prices.


C.3     Algorithm to compute the efficient allocation

Here, we describe the algorithm employed to compute the steady state of our model. In order to sim-

ulate both the market equilibrium and the efficient allocation we approximate the matching function

that we obtained non-parametrically with a Cobb Douglas. In particular, for each region we impose

of the relevant commodities for each region i.
  42
     This is robust to using the average ship tonnage capacity on route ij .


                                                              64
            -i i
mit = Ai s1
          it  eit , and select the parameters (Ai , i ) through non-linear least-squares using the non-

parametrically estimated exporters.

       The algorithm proceeds as follows:

   1. Make an initial guess for {U e,0 ,  0 , s0 , E 0 }.

   2. At each iteration k , inherit U e,k-1 ,  k-1 , sk-1 , E k-1 . Let Gk-1 , ek-1 , and q k-1 denote the asso-

         ciated destination shares, searching exporters, and matches respectively.43 Moreover, let e,k-1 and

         s,k-1 denote the associated matching rates. We update our guess according to the following steps:

          (a) First, in an inner loop we compute the ship optimal policy and value function implied by the

               matching rates s,k-1 , prices  k-1 , and destination shares Gk-1 . In particular, after initializing

               V s,0 , repeat the following steps until convergence
                                                                                                                             s,h-1
                                                                      s,h        s,h                             -cs
                                                                                                                   ij +dij Vi
                  i. At iteration h, compute the value of traveling Vij   from Vij   =                             1- (1-dij )     .

                 ii. Compute the value Uis,h from:

                                                                                                         
                                                                                                   s,h
                                                                  V s,h-1            Vij
                                                 Uis,h   =  ln exp i      +      exp      +  euler
                                                                            j =i
                                                                                      


                     where  euler is the Euler constant.44
                                                         s,k-1             -1
                iii. Update Vis,h from Vis,h = -cs
                                                 i + 1 - i     Uis,h + s,k
                                                                       i                                  j   Gk
                                                                                                               ij
                                                                                                                 -1   s,h
                                                                                                                    Vij     k-1
                                                                                                                          + ij
                                                       s,
                                               s,k
                iv. Upon convergence, we set Vij   = Vij  , Vis,k = Vis, , Uis,k = Uis, , and compute the ship
                                                                                        s,k                            s,k
                                                                                      Vij                            Vil               Vis,k
                                                             k = exp
                     optimal choice probabilities based on Pij                                 /         l=i exp             + exp             for i =
                                                                             s,k
                                                Vis,k                      Vil                Vis,k
                             k = exp
                     j and Pii                            /     l=i exp            + exp                      for i = j .

          (b) To update the efficient prices  k compute the total surplus from matching as,45


                                                                      e,k-1     s,k
                                                          k
                                                          ij = wij - Uij    + Vij   - Uis,k ,
                                                   -1
                   -1            -1      -1     ek             k-1        -1 k-1
  43
       That is, ek
                 i    =       ek
                               ij   , Gk
                                       ij   =    ij
                                                   -1   , and qi   = m sk
                                                                        i   , ei
                          j                     ek
                                                 i
  44
     This is the closed form expression for the expectation of the maximum over multiple choices, and is obtained by integrating
Uis over the distribution of .
  45
     Following BKP we assume that unmatched exporters survive with probability  so that their effective discount factor is
 (this is also true in the estimation procedure even though it was omitted there for notational simplicity). We calibrate
 = 0.99. This makes no difference in our theoretical analysis.


                                                                      65
       and compute the efficient prices based on,


                                            e,k-1                                  -1 k
                                k
                                ij = wij - Uij    - k
                                                    ij + i                       ij ij ,
                                                                                Gk
                                                                           j


       where i denotes the elasticity of the matching function with respect to the number of exporters.

       Similarly, compute prices under Nash bargaining using the surplus sharing condition (33).

   (c) Update the exporter value function U e,k based on the efficient prices  k and matching rates
                      e,k  -ce +e,k-1 (wij -ij
                                             k
                                               )
       e,k-1 setting Uij  = i i        e,k-1     .
                               1- 1-i

   (d) Finally, update the number of ships and exporters searching sk , E k                 according to


                                                        -1    k-1                k-1
                                    i =
                                   sk                sk           +
                                                   k
                                                 Pij  j    - qj                 qij  ,
                                            j                               j


       and
                                                 e,k
                                            exp Uij  - ij
                                                                              -1    k-1
                             ij = Ei
                            ek                             e,k
                                                                         + ek
                                                                            i    - qi
                                       1+       l=i exp   Uil    - il
                                                                                unmatched
                                                new entrants

       where Ei is the mass of potential entrants.

3. If sk - sk-1 < , E k - E k-1 < , U e,k - U e,k-1 <                   , and  k -  k-1 <       stop; otherwise go

  back to point (a).




                                                     66
                                                  Port Costs    Sailing Costs    Logit Shock
                                                      cs
                                                       i              cs
                                                                       ij             
                  North America West Coast          227.65          46.75
                                                    (8.77)          (0.36)
                  North America East Coast           272.3             -
                                                     (4.31)            -
                  Central America                   175.41          46.75
                                                    (5.06)          (0.36)
                  South America West Coast          265.55          46.75
                                                    (7.77)          (0.36)
                  South America East Coast           292.5             -
                                                     (5.23)            -
                  West Africa                        145.3          47.65
                                                     (4.84)         (0.33)
                  Mediterranean                     121.89          46.16
                                                     (3)            (0.28)
                  North Europe                      122.48          46.16
                                                    (1.71)          (0.28)
                  South Africa                      220.11          47.65
                                                    (7.28)          (0.33)
                  Middle East                       118.45          46.16
                                                    (2.14)          (0.28)
                  India                              97.23          45.93
                                                     (1.8)          (0.28)
                  South East Asia                    93.14          40.99
                                                     (1.02)         (0.28)
                  China                              91.07          40.89
                                                     (0.98)         (0.25)
                  Australia                         193.29          40.99
                                                    (2.85)          (0.28)
                  Japan-Korea                       100.41          40.89
                                                     (1.9)          (0.25)
                                                                                     16.53
                                                                                   (0.1070)

Table 5: Ship cost estimates (from BKP). All parameters in 1,000 USD. Standard errors computed from 200
bootstrap samples. The sailing cost for the East Coast of North and South America is set equal to the weekly fuel
cost at 40,000 US dollars.


                                                       67
                                 Exporter wait costs     Ship bargaining coefficient    Average exporter value
                                         ce
                                          i                          i                            ¯i
                                                                                                  w
 North America West Coast                83.49                      0.384                        13,738
                                        (10.72)                    (0.018)
 North America East Coast                83.49                      0.585                        12,192
                                        (10.72)                    (0.012)
 Central America                         302.3                      0.344                        14,350
                                        (69.28)                    (0.038)
 South America West Coast                302.3                      0.259                        20,096
                                        (69.28)                    (0.017)
 South America East Coast                302.3                      0.371                         6,971
                                        (69.28)                    (0.042)
 West Africa                             396.9                      0.292                         4,547
                                       (512.74)                    (0.078)
 Mediterranean                           3.44                       0.412                        10,508
                                        (8.60)                     (0.014)
 North Europe                            3.44                       0.517                        14,577
                                        (8.60)                     (0.014)
 South Africa                            396.9                      0.24                          6,224
                                       (512.74)                    (0.075)
 Middle East                            20.53                       0.615                         7,160
                                        (9.04)                     (0.026)
 India                                  20.53                       0.568                         6,305
                                        (9.04)                     (0.022)
 South East Asia                        174.01                      0.215                         4,918
                                        (44.00)                    (0.036)
 China                                   282.8                      0.194                         8,231
                                        (77.86)                    (0.028)
 Australia                              174.01                      0.388                        12,475
                                        (44.00)                    (0.037)
 Japan-Korea                             282.8                      0.265                         2,977
                                        (77.86)                    (0.038)

Table 6: Average exporter valuation (over destinations), wait costs and bargaining coefficients estimates. All
the estimates are in 1,000 USD. To gain power, we restrict exporter wait costs to be constant within a continent.
Standard errors computed from 200 bootstrap samples.




                                                       68
D     Additional figures and tables

                                                                                                                                                                qq
                                                                                                                                                      qq
                                                                                                                                                       qq
                                                                                                                                                  qqq qq q
                                                                                                                                       q         qq        q
                                                                                                                                                           q         q
                                                                                                                                                 q
                                                                                                                                                 q        q
                                                                                                                                                 q
                                                                                                                                                 qq        q q
                                                                                                                                            q q  q
                                                                                                                                                 q  q q    qqq
                                                                                                                                                            qqqqq
                                                                                                                                           q q  q
                                                                                                                                                qqq q
                                                                                                                                                    qq   q
                                                                                                                                                         q
                                                                                                                                          q      qqqqq
                                                                                                                                                     q  qqq
                                                                                                                                                          q q
                                                                                                                                          qqqq
                                                                                                                                            q q qq   qqqq q
                                q                               q                                                                        qqq
                                                                                                                                           qq
                                                                                                                                            qqqqq
                                                                                                                                               q qqq
                                                                                                                                                   qqq
                                                                                                                                                    q
                                                                                                                                                    q qq
                                                                                                                                                       q
                                                                                                                                                       q q
                            q                                                                                                            qq
                                                                                                                                         q q q  qq
                                                                                                                                                 q
                                                                                                                                                 q
                                                                                                                                                 q
                                                                                                                                          q q
                                                                                                                                            qq
                                                                                                                                             qqq
                                                                                                                                               qq
                                                                                                                                                q
                                                                                                                                                qq
                                                                                                                                                 q
                                                                                             q
                                                                                             qqqq                                     q q  qq
                                                                                                                                            qqq
                                                                                                                                              qq
                                                                                                                                               q
                                                                 qqq
                                                                  q q                      qq                                               q
                                                                    q
                                                                    q
                                                                    q                       q qq                                        qqq  q
                                                                                                                                             q
                                                                 qqqq
                                                                    q                    q
                                                                                         q qq                                             qqq q       q         qq
                                                                    q                            q                                            q       q
                                                                                                                                                      qq           q
                                                                                                q q                                       q
                                                                                                                                          qqqq q   q
                                                                                                                                                   q
                                                                                                                                                   qq
                                                                                                                                                    q
                                                                                                                                                    q
                                                                                                                                                      qq       q
                                                                                                                                                               q q
                                                                                                                                                               qq q q
                                                                                                                                                                                                                         q
                                                                                           q                                            qqq        q q qq     q                                                          qqq
                                                                                         q
                                                                                         q
                                                                                         qq                                              q
                                                                                                                                         qq q  qqq qqqq  q
                                                                                                                                                         q qq q
                                                                                                                                                              q
                                                                                                                                                              qq
                                                                                                                                                               q
                                                                                                                                                               qqqq q                                         q
                                                                                                                                                                                                              q
                                                                                                                                                                                                                         qq
                                                                                        q
                                                                                        q
                                                                                        qqq                                              q     qqq q         q
                                                                                                                                                             q                                              qq
                                                                                                                                                                                                             qq q         q
                                                                     q                  q
                                                                                        qq                                               q q   qqq q
                                                                                                                                                   qq   q q qqq                                             q
                                                                                                                                                                                                            qqqq         q
                                                                     q                  q
                                                                                        qq
                                                                                         q
                                                                                              q
                                                                                                                                        q
                                                                                                                                      q q
                                                                                                                                         qq
                                                                                                                                          q
                                                                                                                                           q
                                                                                                                                           qq
                                                                                                                                            q
                                                                                                                                            qq
                                                                                                                                             q
                                                                                                                                             q
                                                                                                                                              q
                                                                                                                                              q
                                                                                                                                              qqqq
                                                                                                                                                 qqqq
                                                                                                                                                    q
                                                                                                                                                    q
                                                                                                                                                    q
                                                                                                                                                     qqq
                                                                                                                                                       q
                                                                                                                                                       q
                                                                                                                                                       q
                                                                                                                                                        q
                                                                                                                                                         qq
                                                                                                                                                         q
                                                                                                                                                         qq
                                                                                                                                                           q
                                                                                                                                                            q
                                                                                                                                                            q
                                                                                                                                                            qq
                                                                                                                                                             q
                                                                                                                                                             q
                                                                                                                                                           q q
                                                                                                                                                              qq
                                                                                                                                                             qq
                                                                                                                                                                q q
                                                                                                                                                                q q
                                                                                                                                                                   q
                                                                                                                                                                   q
                                                                                                                                                                   q
                                                                                                                                                                                                             q
                                                                                                                                                                                                             q
                                                                                                                                                                                                             q
                                                                                                                                                                                                              q
                                                                                                                                                                                                              q
                                                                                                                                                                                                              q
                                                                                                                                                                                                               q
                                                                                                                                                                                                               qq
                                                                                                                                                                                                               q
                                                                                                                                                                                                              qq
                                                                                                                                                                                                                qq
                                                                                                                                                                                                                 q
                                                                                                                                                                                                                  q
                                                                                                                                                                                                                  q
                                                                                                                                                                                                                  q
                                                                                                                                                                                                                   q qq
                                                                                                                                                                                                                   q
                                                                                                                                                                                                                   q
                                                                                                                                                                                                                   q
                                                                                                                                                                                                                   q
                                                                                                                                                                                                                   q
                                                                                                                                                                                                                   qqqq
                                                                                                                                                                                                                     q
                                                                                                                                                                                                                     qq
                                                                                                                                                                                                                      qqq
                                                                                                                                                                                                                         q
                                                                                                                                                                                                                         q
                                                                                                                                                                                                                         q
                                                                                                                                                                                                                         q
                                                                                                                                                                                                                         q
                                                                                                                                                                                                                                                                   q   Australia
                                                                       q              q                                                  qq
                                                                                                                                                       q q
                                                                                                                                                           q q    q                                           qqq  qq
                                                                                                                                                                                                                   qq
                                                                                                                                                                                                                    q
                                                                                                                                                                                                                    qq
                                                                                                                                                                                                                     q
                                                                                                                                                                                                                     q
                                                                                                                                      q qq                                                                   q
                                                                                                                                                                                                             q
                                                                        qq   qq
                                                                              q
                                                                              q
                                                                              q
                                                                               q
                                                                               qq
                                                                               qq
                                                                                qq
                                                                                 q
                                                                                 q
                                                                                 qqqq
                                                                                  qq
                                                                                     q
                                                                                     qq
                                                                                      q
                                                                                                                                      q                       qqqq
                                                                                                                                                                 q
                                                                                                                                                                qq
                                                                                                                                                                 q
                                                                                                                                                                 q
                                                                                                                                                                  q
                                                                                                                                                                  q      q
                                                                                                                                                                         q
                                                                                                                                                                         qq
                                                                                                                                                                          q
                                                                                                                                                                                   q
                                                                                                                                                                                                             qq
                                                                                                                                                                                                              q
                                                                                                                                                                                                              q
                                                                                                                                                                                                              q
                                                                                                                                                                                                               q
                                                                                                                                                                                                               qq
                                                                                                                                                                                                                q
                                                                                                                                                                                                                q
                                                                                                                                                                                                                   qq                                              q   Central America
                                                                             qqq   q
                                                                                     q
                                                                                       q q                                            q                           q
                                                                                                                                                                  q       q
                                                                                                                                                                          q
                                                                                                                                                                          qqq                                qqqq
                                                                         q
                                                                             q
                                                                              q qq  qq
                                                                                   q qq
                                                                                        q                                                                          q
                                                                                                                                                                    q
                                                                                                                                                                    q
                                                                                                                                                                          qq
                                                                                                                                                                            q
                                                                                                                                                                           qqq
                                                                                                                                                                             q
                                                                                                                                                                             qqq q
                                                                                                                                                                              qq q
                                                                                                                                                                                 qq
                                                                                                                                                                                  qq
                                                                                                                                                                                  q         q
                                                                                                                                                                                                         q
                                                                                                                                                                                                         q
                                                                                                                                                                                                         qq
                                                                                                                                                                                                          q
                                                                                                                                                                                                          q
                                                                                                                                                                                                          q
                                                                                                                                                                                                           q
                                                                                                                                                                                                           q
                                                                                                                                                                                                            q
                                                                                                                                                                                                            q
                                                                                                                                                                                                            q
                                                                                                                                                                                                            q
                                                                                                                                                                                                             q
                                                                                                                                                                                                             q
                                                                                                                                                                                                             q
                                                                                                                                                                                                             q
                                                                                                                                                                                                             q
                                                                                                                                                                                                             q
                                                                                                                                                                                                              q
                                                                                                                                                                                                              q
                                                                                                                                                                                                              q
                                                                                                                                                                                                              q
                                                                                                                                                                                                             qq
                                                                                                                                                                                                               q
                                                                                                                                                                                                               q                                                   q   China
                                    q                                        q qq                                                    q                               q            qqq       q
                                                                                                                                                                                            q q        q
                                                                                                                                                                                                       q
                                                                                                                                                                                                       q
                                                                                                                                                                                                       qqq  q                q
                                                                                                                                                                                                         q qq
                                                                           q qq
                                                                           q
                                                                             qq
                                                                                    q
                                                                                      q
                                                                                       q q
                                                                                  q q q q
                                                                                           q
                                                                                             q
                                                                                             qq
                                                                                              qq
                                                                                               q
                                                                                                                                     q
                                                                                                                                     q
                                                                                                                                     q
                                                                                                                                                                    q
                                                                                                                                                                            q
                                                                                                                                                                                  qq
                                                                                                                                                                                   q
                                                                                                                                                                                    q
                                                                                                                                                                                    q
                                                                                                                                                                                    q
                                                                                                                                                                                    q
                                                                                                                                                                                    q      q
                                                                                                                                                                                            q q       qqq
                                                                                                                                                                                                       q qq
                                                                                                                                                                                                        q q
                                                                                                                                                                                                              q
                                                                                                                                                                                                             qq
                                                                                                                                                                                                                                                                   q   India
                                                                                  q
                                                                                  q                                                                                    q            q
                                                                                                                                                                                    q    q
                                                                                                                                                                                         qqq qq        q
                                                                                                                                                                                                       q                    q
                                                                                 qq q q                                                                                             q qq       qq q            q
                                                                               qq
                                                                                       qqq
                                                                                         q
                                                                                          q
                                                                                          q
                                                                                          qq
                                                                                           q
                                                                                            q
                                                                                            q
                                                                                            qq
                                                                                             qqq
                                                                                             qq q
                                                                                                                                     q
                                                                                                                                     qq
                                                                                                                                                                       q
                                                                                                                                                                       q
                                                                                                                                                                                    qq
                                                                                                                                                                                     qq
                                                                                                                                                                                      qq
                                                                                                                                                                                        q
                                                                                                                                                                                        q
                                                                                                                                                                                        q
                                                                                                                                                                                        q
                                                                                                                                                                                        q
                                                                                                                                                                                                   q
                                                                                                                                                                                                   q qq
                                                                                                                                                                                                  qq
                                                                                                                                                                                                        q
                                                                                                                                                                                                        q q
                                                                                                                                                                                                            q
                                                                                                                                                                                                            qq
                                                                                                                                                                                                             q
                                                                                                                                                                                                             q
                                                                                                                                                                                                              q
                                                                                                                                                                                                              q
                                                                                                                                                                                                              q
                                                                                                                                                                                                              q
                                                                                                                                                                                                              qq
                                                                                                                                                                                                              q
                                                                                                                                                                                                              q
                                                                                                                                                                                                               qq
                                                                                                                                                                                                                qq
                                                                                                                                                                                                                 q
                                                                                                                                                                                                                     q
                                                                                                                                                                                                                                                                   q   Japan-Korea
                                                                                      q
                                                                                      q                                                                                                                       qq q
                                                                                                                                                                                                                 q
                                                                                      q         q
                                                                                                q
                                                                                                   qq
                                                                                                                                       q
                                                                                                                                         q q
                                                                                                                                        q q   qq
                                                                                                                                               qq
                                                                                                                                                qq
                                                                                                                                                 qq
                                                                                                                                                   q
                                                                                                                                                   q
                                                                                                                                                                                      qq
                                                                                                                                                                                       q
                                                                                                                                                                                        q
                                                                                                                                                                                        q
                                                                                                                                                                                          q
                                                                                                                                                                                                q
                                                                                                                                                                                              q q q
                                                                                                                                                                                                    q
                                                                                                                                                                                                q qq q
                                                                                                                                                                                                    q
                                                                                                                                                                                                     q      q
                                                                                                                                                                                                     q q qq q
                                                                                                                                                                                                             q
                                                                                                                                                                                                             qq
                                                                                                                                                                                                               qq
                                                                                                                                                                                                                q
                                                                                                                                                                                                                q
                                                                                                                                                                                                                 q                                                 q   Mediterranean
                                                                                       q                                                       qqqq q
                                                                                                                                                    q                                             q
                                                                                                                                                                                                  qqqqq q q
                                                                                            q                q
                                                                                                                                                   q
                                                                                                                                                    q
                                                                                                                                                                                                   q
                                                                                                                                                                                                   qq
                                                                                                                                                                                                    qq
                                                                                                                                                                                                     q
                                                                                                                                                                                                     qq
                                                                                                                                                                                                      q q
                                                                                                                                                                                                            q
                                                                                                                                                                                                            q
                                                                                                                                                                                                            q
                                                                                                                                                                                                            q
                                                                                                                                                                                                            q
                                                                                                                                                                                                            q
                                                                                                                                                                                                             q
                                                                                                                                                                                                             q
                                                                                                                                                                                                                  q                                                q   Middle East
                                                                                            q              q qq
                                                                                                           q   q                                                                                     qq     q             q
                                                                                                                 q                                                   q                             q qq
                                                                                                                                                                                                   q     q
                                                                                                                                                                                                          q
                                                                                                                                                                                                           q
                                                                                                                                                                                                           q q
                                                                                                                                                                                                           q
                                                                                                                                                                                                           q q
                                                                                                                                                                                                               q                                                   q   North America EC
                                                                                            q                                                        qq                                              q
                                                                                                                                                                                                     q
                                                                                                                                                                                                     qqq q qq
                                                                                                                                                                     q                               q  qq qq
                                                                                                                       q                             q                                                 q  q
                                                                                                                                                                                                          qq
                                                                                             q
                                                                                              q                      q
                                                                                                                      q                               q
                                                                                                                                                                       q
                                                                                                                                                                                                           q
                                                                                                                                                                                                           q        q qq
                                                                                                                                                                                                                               q
                                                                                                                                                                                                                                                                   q   North America WC
                                                                                                                                                                                                                       q
                                                                                                  q
                                                                                                                                                     q
                                                                                                                                                                     q q
                                                                                                                                                                                                              q        q q
                                                                                                                                                                                                                            q
                                                                                                                                                                                                                                                                   q   North Europe
                                                                                                                                                                   q          q                              q               q
                                                                                                   q
                                                                                                   q               q
                                                                                                                   q
                                                                                                                   q
                                                                                                                    q
                                                                                                                     q
                                                                                                                     q
                                                                                                                    qq
                                                                                                                       q                                                    q
                                                                                                                                                                                                         q
                                                                                                                                                                                                           qq                qq
                                                                                                                                                                                                                               q
                                                                                                                                                                                                                                    q                              q   South Africa
                                                                                                                q
                                                                                                                qqqq
                                                                                                                   q                                             q                                                              q
                                                                                                  q
                                                                                                  q
                                                                                                  q            q
                                                                                                               q
                                                                                                                q
                                                                                                                q
                                                                                                                q
                                                                                                                                                                q
                                                                                                                                                                 q                                        q
                                                                                                                                                                                                                                                                   q   South America EC
                                                                                                                                                                                                           q
                                                                                                  q
                                                                                                  q
                                                                                                   q   qq
                                                                                                        q
                                                                                                        qq
                                                                                                         q
                                                                                                         qq
                                                                                                          qqq
                                                                                                           q
                                                                                                                                                         q
                                                                                                                                                         q
                                                                                                                                                         qqqq
                                                                                                                                                              q                                           q q
                                                                                                                                                                                                                       q
                                                                                                                                                                                                                       qq     q
                                                                                                                                                                                                                               q                                   q   South America WC
                                                                                                  q
                                                                                                       q
                                                                                                       q
                                                                                                       qqq
                                                                                                         q                                                                                                                q
                                                                                                                                                                                                                          q
                                                                                                                                                                                                                                                                   q   South East Asia
                                                                                                       q                                                                                                                                q                          q   West Africa




             Figure 6: Definition of regions. Each color depicts one of the 15 geographical regions.




                                                               0.4
                                                                                 sia
                                    Change in export prices


                                                                           tA




                                                                             q
                                                                                                                                C
                                                                         as




                                                                                                                               W
                                                                        SE




                                                                                                                       ica
                                                                                             lia
                                                                                             a




                                                                                                                     er
                                                                                          str




                                                                                                                  Am
                                                                                       Au




                                                                                        q
                                                                                                               uth




                                                                                                                                                                ica
                                                                                                           So




                                                               0.0                                          q
                                                                                                                                                                  er
                                                                                                                                                                 a
                                                                                                                                                       fric Am
                                                                                                                                                              ric




                                                                                                                                                                                     C
                                                                                                                               ina




                                                                                                                                                                                    E
                                                                                                                                            Af




                                                                                                                                                                                               C
                                                                                                                                                    t A tral
                                                                                                                       Ch




                                                                                                                                                                                ica



                                                                                                                                                                                              W
                                                                                                                                                            a




                                                                                                                           q
                                                                                                                                          uth




                                                                                                                                                                                                      n
                                                                                                                                                          n




                                                                                                                                                                                                    ea
                                                                                                                                                                             er


                                                                                                                                                                                          ica
                                                                                                                                                W Ce
                                                                                                                                      So




                                                                                                                                                                           Am




                                                                                                                                                                                                  n




                                                                                                                                      q            q
                                                                                                                                                                                         er

                                                                                                                                                                                               ra
                                                                                                                                                 es




                                                                                                                                                                                     Am

                                                                                                                                                                                               er
                                                                                                                                                                       uth




                                                                                                                                                                                                                         st




                                                                                                                                           q
                                                                                                                                                                                           dit
                                                                                                                                       ea




                                                                                                                                                                                                                      Ea




                                                                                                                                                    q
                                                                                                                                                                                  r th
                                                                                                                                                                   So




                                                                                                                                                                                         Me




                                                                                                                                                                                           q
                                                                                                                                     or




                                                                                                                                                                       q
                                                                                                                                                                                No




                                                                                                                                                                                                                   dle
                                                                                                                                   -K




                                                                                                                                                                                 q
                                                                                                                                                                                                                Mid
                                                                                                                                an




                                                                                                                                                                                                                                                        EC
                                                                                                                              p




                                                                                                                                                                                                                  q
                                                              -0.4
                                                                                                                           Ja




                                                                                                                                                                                                                                                    pe ica
                                                                                                                                                                                                                                                  ro er
                                                                                                                                                                                                                                              Eu Am
                                                                                                                                                                                                                                          r th r th




                                                                                                                                                                                                                                                              ia
                                                                                                                                                                                                                                        No No




                                                                                                                                                                                                                                                             Ind




                                                                                                                                                                                                                                            q
                                                                                                                                                                                                                                                              q
                                                                                                                                                                                                                                            q
                                                                                                           0




                                                                                                                                                                             2




                                                                                                                                                                                                                            4
                                                                                                       0.




                                                                                                                                                                           0.




                                                                                                                                                                                                                         0.




                                                                                                                                                                           e   e
                                                                                                                                                                           i - i




Figure 7: The vertical axis reports the change in prices when only thin/thick market externalities are internalized.
The horizontal axis reports the difference between the estimated exporter bargaining coefficient and the estimated
elasticity of the matching function with respect to exporters. We do not allow ships to reallocate to capture the
direct effect of the thin/thick market externalities. See also discussion in footnote 34.




                                                                                                                                                                       69
                                                                  I            II       III
                                                                      log(price per day)

                       Probability of ballast                               0.234     0.556
                                                                            (0.030)   (0.081)
                       Avg duration of ballast trip (log)                   0.166     0.065
                                                                            (0.014)   (0.032)
                       Coal                                                           0.088
                                                                                      (0.045)
                       Fertilizer                                                     0.245
                                                                                      (0.051)
                       Grain                                                          0.131
                                                                                      (0.048)
                       Ore                                                            0.124
                                                                                      (0.045)
                       Steel                                                          0.135
                                                                                      (0.049)
                       Constant                               10.284        9.127     8.915
                                                               (0.103)      (0.099)   (0.408)

                       Destination FE                            Yes          No       No
                       Origin FE                                 Yes          Yes      Yes
                       Ship type FE                              Yes          Yes      Yes
                       Quarter FE                                Yes          Yes      Yes

                       Obs                                     11,014       11,011    1,662
                       R2                                       0.694        0.674    0.664

                       ** p   < 0.05,* p < 0.1

Table 7: Shipping price regressions (Table II in BKP). The dependent variable is the logged price per day in USD.
The independent variables include combinations of: the average frequency of ballast traveling after the contract's
destination (Probability of ballast), the average logged duration (in days) of the ballast trip after the contract's
destination, as well as ship type, origin, destination and quarter FEs. The product is reported in only 20% of
the sample, so the regression in column III has substantially fewer observations. The omitted product category is
cement.




                                                        70
                                                               log(price per day)
                                                        I          II        III         IV




                    I {orig. = home country}                                0.004
                                                                           (0.019)

                    I {dest. = home country}                               -0.012
                                                                           (0.015)

                    ln (Number Employees)                                              0.008
                                                                                      (0.007)

                    ln (Operating Revenues)                                            0.003
                                                                                      (0.005)



                    Time FE                         Qtr×Yr     Qtr×Yr      Qtr×Yr     Qtr×Yr
                    Shipowner FE                       No         Yes        No          No
                    Ship characteristics             Yes        Yes         Yes        Yes
                                                     Orig.      Orig.       Orig.      Orig.
                    Region FE
                                                    & Dest.    & Dest.     & Dest.    & Dest.



                    Observations                     7,263       7,263      7,973      7,973
                    Adj. R2                          0.530       0.540      0.537      0.537

                                                                p<0.1;  p<0.05;  p<0.01

Table 8: Regression of shipping prices on shipowner characteristcs and fixed effects (Table SI in Supplement
to BKP). Shipping prices, ships' characteristics (age and size), and the identity of the shipowner are obtained
from Clarksons. Information on shipowner characteristics is obtained from ORBIS. In particular, we match the
shipowners in Clarksons to ORBIS; we do so for two reasons: (i) ORBIS allows us to have reliable firm identities, as
shipowners may appear under different names in the contract data; (ii) ORBIS reports additional firm characteristics
(e.g. number of employees, revenue, headquarters). Here we identify the shipowner with the global ultimate owner
(GUO); results are robust to controlling for the identity of the domestic owner (DUO) and the shipowner as reported
in Clarksons. Finally, the data used span the period 2010-2016.




                                                        71
E     Supplemental Material: Discounting, preference shocks and out of

      steady state dynamics

In this section we show that the main results of Section 3.2 are valid in a more general setup. In particular,

we extend the model of Section 2 to allow for idiosyncratic preference shocks in carriers relocation choice

(relevant in our empirical application), as well as out of steady state dynamics, and we derive an efficiency

result analogous to that of Theorem 2.


E.1     Model

We begin by laying out the model focusing on the changes made compared to Section 2.


States and transitions In this Appendix we do not consider the steady state equilibrium. Hence, we

now state explicitly the dependence of actions and value functions on the relevant state variables and

transitions, which were only implicit in the model of Section 2. At the beginning of a given time period,

the state of the economy is described by a vector,


                                                          ×I I ×I
                                          z = (x, y )  RI
                                                        + × R+ .



The first element of z , x = (xij )i,j I , corresponds to the supply at every origin i,

    · xii is the measure of carriers waiting at location i

    · xij is the measure of carriers traveling from i to j , either empty or full, for every destination j = i.

The second element of z , y = (yij )i,j I , corresponds to demand. For every origin-destination pair ij , yij

is the measure of customers who are waiting on route ij at the beginning of the current period. These

are customers that entered in some previous period and have not yet been matched with a carrier.

    At a given state z , the choice sets that agents face, as well as the search and matching process are the

same as in Section 2. At each origin i, a measure si  xii of carriers choose to search for a customer, while

the remaining measure xii - si choose to remain inactive. Similarly, a measure eij  yij of customers

search for a carrier on route ij , so that eij - yij is the measure of new customers joining the existing

search pool.

                                                       72
      Once a customer and a carrier meet, they can choose whether to match or remain unmatched. The

outcome of this process is a vector (b, q ) describing the measure of carriers that start traveling empty (bij )

or full (qij ) on each route ij . The state transitions as a function of the allocation (s, E, q, b) are as follows

for all ij :


                                 ii (s, E, q, b|z ) = xii - si +
                                x+1                                        dji (xji + qji + bji )
                                                                       j


                                 ij (s, E, q, b|z ) = (1 - dij ) (xij + qij + bij )
                                x+1
                                 +1
                                yij (s, E, q, b|z ) = eij - qij .                                                        (62)


      The feasibility constraints on the allocation (s, E, q, b) are as follows for all i, j :


                                        xii  si , eij  yij , si , eij , qij , bij  0                                     (63)

                                            (qij + bij ) = si , mi (si , ei ) Gij  qij
                                        j


Prices, expectations and allocation rules The pricing rule maps each state into the associated

vector of transportation prices on each route,  : z   (z ) = ( ij (z ))i,j I . As in Section 2, we begin by

remaining agnostic regarding the structure of the pricing rule, and later we characterize the pricing rules

that are consistent with efficient equilibria and compare them to Nash bargaining.

      In state z carriers expect to meet customers at rate s
                                                           i (z ) in location i, and customers expect to meet

carriers at rate e
                 i (z ), where  : z   (z ) = (i (z ))iI ,  : z   (z ) = (i (z ))iI . Agents make
                               s     s        s           e     e        e


optimal choices under rational expectations about the state transitions, the matching probabilities and

prices at each state, generating an allocation rule (s, E , q , b) : z  (s (z ) , E (z ) , q (z ) , b (z )), mapping

states into feasible allocations. That is, for every state z , (s (z ) , E (z ) , q (z ) , b (z )) satisfies (63).

      Similarly to Section 2, we will sometimes denote an allocation rule by (s, e, G, q , b), where ei (z ) =

  j   eij (z ) and Gij (z ) = eij (z ) /ei (z ), and we will often refer to the first triplet (s, e, G) as a search rule.


Preference shocks and carrier optimality Carriers' payoff structure is the same as in Section 2. In

addition, we allow for stochasticity in carriers' preferences for destinations. The stochastic component at

each origin i is represented by a random vector           i   =(   ij )i,j I   that enters the carriers' utility of relocating

                                                              73
to different destinations additively, is i.i.d. across carriers and satisfies the conditional independence

assumption,       +1 +1
                  i |z        i, z.   To simplify the exposition, we assume that                          i   is independent of z and i, so

that i, z :   i    P  RI , although this assumption is not needed for the results. We assume that P has

full support and that it admits a continuous density.

   The value of a carrier that remained unmatched at origin i at state z depends on the particular

realization of the shock. We denote its expectation by


                                                Uis (z ) = EP max Vij
                                                                    s
                                                                      (z ) +              ij   .                                      (64)
                                                                j



The values of a carrier traveling from i to j and a carrier waiting in i are given by:


                         s
                       Vij (z ) = - cs
                                     ij +  dij Vj z
                                                 s  +1
                                                       + (1 - dij ) Vij
                                                                      s
                                                                        z +1
                                                                                                                    
                                                                                                                    
                          Vis (z ) = max -cs
                                           i + i (z )
                                               s
                                                                         ij (z ) + Ui (z ) , Vi z
                                                                     Gij s          s          s  +1
                                                                                                                    
                                                            j =i


as before, where

                                       s
                                       ij (z ) = max  ij (z ) + Vij (z ) - Ui (z ) , 0
                                                                  s         s



is the carrier expected surplus of being matched with respect of being unmatched.

   Denote by P b the matrix of carrier relocation choice probabilities associated with b  RI ×I :


                                                         b
                                                       Pij = bij /           bik .
                                                                         k


for all ij . Optimality in state z requires that for all ij ,


                                       b(z )
                                      Pij      = P Vij
                                                     s
                                                       (z ) +   ij   = max (Vik
                                                                              s
                                                                                (z ) +             ik )   .                           (65)
                                                                             k



The remaining optimality conditions of Section 2 still hold. In particular, carriers search only when it is

profitable to do so:

                             si (z ) > 0  Vis (z ) = -cs
                                                       i + i (z )
                                                           s
                                                                                        Gij s
                                                                                            ij (z ) + Ui (z )
                                                                                                       s
                                                                                                                                      (66)
                                                                                 j =i




                                                                    74
Moreover, they do not reject any match yielding a strictly positive surplus, and they accept only matches

yielding a positive surplus:


                                 q ij (z ) < s
                                             i (z ) si (z ) Gij  ij (z ) = 0
                                                                 s


                                 q ij (z ) > 0  s
                                                ij (z ) =  ij (z ) + Vij (z ) - Ui (z ) .
                                                                       s         s
                                                                                                                  (67)


Customer optimality Customer value functions are the same as in Section 2, but we make the de-

pendence on the state of the economy explicit. In state z , the meeting surplus of the marginal customer

(with respect to being unmatched) is given by


                              e
                              ij (z ) = max wij (q (z )) -  ij (z ) - Uij z
                                                                       e    +1
                                                                               ,0 ,


where Uij
       e (z ) is the value of customer with destination j that is searching for a carrier in location i:



                                     e
                                    Uij (z ) = -ce
                                                 ij + i (z ) ij (z ) + Uij z
                                                      e      e          e    +1
                                                                                .                                 (68)


Optimality requires that the marginal customer does not reject a match yielding a strictly positive surplus:


                                         q ij (z ) < e
                                                     i (z ) ij (z )  ij (z ) = 0.
                                                                     e
                                                                                                                  (69)


The measure of customers searching on each route ij is pinned down by a free entry condition for the

marginal customer:


                                   e
                                  Uij (z ) - ij  0, with equality if eij (z ) > yij .                             (70)


Equilibrium An outcome is a tuple (s, E , q , b,  ) consisting of an allocation rule and a price rule.

Definition 5. An outcome is a Markovian equilibrium if, for every state z :

    1. (s (z ) , E (z ) , q (z ) , b (z )) satisfies the feasibility constraints (63).

    2. (s (z ) , q (z ) , b (z )) satisfies the carrier optimality conditions (64)-(67) given  (z ) , s (z ) , z +1 and

G (z ).


                                                             75
       3. (E (z ) , q (z )) satisfies the customer optimality and free entry conditions (68)-(70) given  (z ) , e (z )

and z +1 .

       4. Expectations are consistent with the realized outcomes:


                     i : s
                         i (z ) = mi (si (z ) , ei (z )) /si (z ) , i (z ) = mi (si (z ) , ei (z )) /ei (z )
                                                                    e


                     z +1 = z +1 (s (z ) , E (z ) , q (z ) , b (z )) .


       (s, E , q , b) is an equilibrium allocation rule if there exists a price rule  such that (s, E , q , b,  ) is a

Markovian equilibrium.


E.2       Externalities and efficiency

The social planner solves an infinite horizon constrained Markov decision problem in which, conditional

on every initial state z , he chooses a dynamic allocation rule maximizing the discounted sum of future

social payoffs.

       The social welfare W p (s, e, G, q, b; z ) at each state z and for every allocation (s, e, G, q, b) entails the

welfare terms encountered in Section 3.1, but involves an additional term that captures the welfare due

to carrier preference shocks. This term is given by                        j bij       f Pib      where f (Pib ) represents the value

associated with the best allocation of shocks to destinations at i conditional on the aggregate choice

probabilities being given by Pib :46


W p (s, e, G, q, b; z )  W (q )-          (xij + qij + bij ) cs
                                                              ij -       si cs
                                                                             i-         ei       Gij ce
                                                                                                      ij -        (ei Gij - yij ) ij +        bij f Pib .
                                     ij                              i             i         j               ij                          ij


                                                                             
       In what follows, we use the upper bar notation a
                                                      ¯ = at                 t=0       for infinite sequences. When dealing with

a sequence of allocations s
                          ¯, e  ¯ q
                             ¯, G, ¯, ¯
                                      b and an initial state z 0 , unless stated otherwise, it is understood
  46
       Formally:
                                                      f Pib =      max E ( j )                                                                (71)
                                                                    b
                                                                  (Pi )
where the expectation on the right hand side is with respect to a joint realization of the vector = ( j )j I and the destination
j  I , and  Pib is the set of all probability measures    RI × I such that the marginal of  over I is Pib and the
marginal of  over RI is P. For a discussion, the reader is referred to Galichon (2018). For example, if i is distributed
according to a logit, we have f Pib = - j Pij   b     b
                                                  ln Pij .




                                                                   76
that z
     ¯ refers to the sequence of states induced by s
                                                   ¯, e  ¯ q
                                                      ¯, G, ¯, ¯
                                                               b from z 0 :


                                       z t+1 = z +1 st , et , Gt , q t , bt ; z t .


for t  0. Moreover, when dealing with a feasible allocation rule (s, e, G, q , b) and an initial state z 0 , it

is understood that s
                   ¯, e  ¯ q
                      ¯, G, ¯, ¯
                               b refers to the sequence of allocations induced by (s, e, G, q , b) from z 0 :


                         st , et , Gt , q t , bt = s z t , e z t , G z t , q z t , b z t            .


The planner's dynamic problem at state z 0 is given by

                                                       
                             V p z0 =        max              t W p st , et , Gt , q t , bt ; z t         (72)
                                          (s
                                           ¯,e ¯q
                                             ¯,G,   b) t=0
                                                  ¯,¯

                                                s.t. xt    t
                                                      ii  si

                                                      et  t    t
                                                       i Gij  yij

                                                               t
                                                              qij + bt
                                                                     ij = si
                                                                           t

                                                        j

                                                      mi st    t  t    t
                                                          i , ei Gij  qij


                                                              ij = 1
                                                             Gt
                                                        j


                                                       i , ei , Gij  0, i, j, t
                                                      st    t    t




Definition 6. An allocation rule (s, e, G, q , b) is efficient at a state z 0 if s
                                                                                 ¯, e  ¯ q
                                                                                    ¯, G, ¯, ¯
                                                                                             b solves Problem

(72).

   Similarly to Section 2, we distinguish three different potential sources of inefficiency. To do so, for

each state z 0 , let A z 0 be the set of allocation sequences s
                                                              ¯, e  ¯ q
                                                                 ¯, G, ¯, ¯
                                                                          b which are feasible from z 0 , that

is, they satisfy the constraints of Problem (72). Let also


                         SA z 0 =        s  ¯, G
                                         ¯, e       ¯, ¯
                                               ¯ :  q      ¯, e
                                                       b , s     ¯ q
                                                              ¯, G, ¯, ¯
                                                                       b  A z0




                                                             77
be the set of feasible sequences of search allocations, and


                                            ¯ = s
                                         ¯, G
                                 SA z 0 |e      ¯: s
                                                   ¯, e  ¯  SA z 0
                                                      ¯, G

                                            ¯ = e
                                         ¯, G
                                 SA z 0 |s      ¯: s
                                                   ¯, e  ¯  SA z 0
                                                      ¯, G

                                         ¯, e
                                 SA z 0 |s      ¯: s
                                            ¯ = G  ¯, e
                                                      ¯, G
                                                         ¯  SA z 0                         .


For every s
          ¯, e  ¯  SA z 0 , we define the maximum dynamic welfare attainable by this sequence by:
             ¯, G

                                                          
                                ¯, e
                             Vp s     ¯ z 0 = max
                                   ¯, G,                      t W p st , et , Gt , q t , bt ; z t             (73)
                                                  ¯,¯
                                                  q b t=0

                                                  s.t. s
                                                       ¯, e  ¯ q
                                                          ¯, G, ¯, ¯
                                                                   b  A z0


so that we have


                                   V p z0 =         max              ¯, e
                                                                  Vp s     ¯ z0 .
                                                                        ¯, G,
                                               (s
                                                ¯,e ¯ )SA(z 0 )
                                                  ¯,G



   Given an equilibrium allocation rule (s, e, G, q , b) and an initial state z 0 we say that:

   (i) Carriers internalize thin/thick market externalities at z 0 if s
                                                                      ¯ solves


                                              max             ¯,e
                                                           Vp s    ¯ z0
                                                                ¯, G,
                                          ¯ SA(z 0 |e
                                          s           ¯)
                                                    ¯,G



   (ii) Customers internalize thin/thick market externalities at z 0 if e
                                                                        ¯ solves


                                             max          ¯, e
                                                       Vp s      ¯ z0
                                                             ¯ , G,
                                          ¯ SA(z |s
                                          e     0 ¯,G)
                                                    ¯



                                                               ¯ solves
   (iii) Customers internalize pooling externalities at z 0 if G


                                             max             ¯, e
                                                          Vp s     ¯ , z0 .
                                                                ¯, G
                                         ¯ SA(z 0 |s
                                         G         ¯,e
                                                     ¯)


   Next we state the equivalent of Theorem 2 in the current framework. Given (s, e, G), we denote by
s (z ) = d ln m (s (z ) , e (z )) /d ln s and  e (z ) = d ln m (s (z ) , e (z )) /d ln e . For simplicity, in order
i              i  i        i             i    i               i  i        i             i


                                                           78
to avoid delving into corner conditions, in the statement below we assume that the equilibrium path

originating from z 0 is such that we have st
                                           i , ei > 0 for every t, i.
                                                t



Theorem 4. Suppose that at a given state z 0 , Problem (73) admits a unique optimal solution, and let

(s, e, G, q , b) be an equilibrium allocation rule. Then the following statements hold:47

       (i) Carriers internalize thin/thick market externalities at z 0 if and only if, for every t  0:


                   i  I :          ij z ij z
                                  Gt   t s   t
                                               = i
                                                 s
                                                   zt                  Gij z t   s
                                                                                 ij z
                                                                                      t
                                                                                        + e
                                                                                          ij z
                                                                                               t
                                                                                                         .
                             j                                     j


       (ii) Customers internalize thin/thick market externalities at z 0 if and only if, for every t  0:


                    i  I :        Gij z t e
                                          ij z
                                               t
                                                 = i
                                                   e
                                                     zt                Gij z t   s
                                                                                 ij z
                                                                                      t
                                                                                        + e
                                                                                          ij z
                                                                                               t

                              j                                    j


       (iii) Customers internalize pooling externalities at z 0 if and only if, for every t  0, for each origin i,


                                               s
                                               ij z
                                                    t
                                                      = max s
                                                            ik z
                                                                 t
                                                             k=i



for every ij such that Gij z t > 0.

       The following section provides the proof.


E.3       Proof of Theorem 4

The proof follows the same reasoning as under the steady state assumption, but has to overcome a number

of technical difficulties due to the infinite dimensional form of the planner's optimization problem.


E.3.1       Preliminaries

Let X be a compact and convex subset of RN for some N  N, and   (0, 1). For each pair of sequences
                                                              
¯, y
x                                        ¯, y
                                            ¯ =
   ¯  X N{0} we define the inner product x                        t t
                                                              t=0  x · y
                                                                         t           ¯, y
                                                                             for all x  ¯, where · denotes the standard
  47
    Formally, the only if parts of statements (i) to (iii) hold for almost every sequence s
                                                                                          ¯, e  ¯  SA z 0 . That is, there
                                                                                             ¯, G
                                 0
exists a dense subset D of SA z such that the only if part of the statements hold whenever s     ¯, e  ¯  D. See Section E.3
                                                                                                    ¯, G
for details.




                                                            79
                                      ¯ =
inner product on RN . Define the norm x                ¯, x
                                                       x  ¯ and L2, =       ¯  X N{0} : x
                                                                                        ¯ <  . Then
                                                                            x

 L2, , ·    is a Banach space.

     Let X  L2, be a convex set and f : X  R be a continuous and concave function.

Definition 7. For every x
                        ¯  X , the super gradient of f at x
                                                          ¯, denoted f (¯
                                                                        x), is the set of all sequences

¯  X N{0} such that, for every x
y                              ¯  X:


                                          ¯ - f (¯
                                        f x      x)  x
                                                     ¯ -x
                                                        ¯, y
                                                           ¯ .


f is differentiable at x
                       ¯ if its super gradient at x
                                                  ¯ contains a unique element.

Lemma 6. Let D  X be the set of sequences at which f is differentiable. Then D is a dense subset of

X.

Proof. See (Asplund, 1968), Theorem 2.

         ¯ maximizes f over X if and only if 0 belongs to f (¯
Lemma 7. x                                                   x).

Proof. Immediate from the definition of f (¯
                                           x).

     The following lemma will be useful in the derivation of each of the three statements internalizing the

respective externalities in Theorem 4. As before, z denotes the state. The interpretation of the variables

x,  will change based on each externality considered; for instance, in the case of carrier thin/thick market

externalities, x corresponds to s, while  corresponds to e, G. The function f summarizes all constraints,

H defines the state dynamics and u the welfare.

Lemma 8. Let L, M, N > 0 and Z, X, , be compact and convex subsets of RL , RM and RN , respectively,

u : X ×  × Z  R be a concave and continuously differentiable function, H : X ×  × Z  Z be a

linear function, and for each k = 1, ..., K > 0, let fk (x, , z ) be a continuously differentiable and concave




                                                     80
function. Let z 0  Z , and   N{0} be such that for every ¯   problem

                                                          
                                    P ¯ :         max            t u xt , t , z t
                                              xX N{0}     t=0

                                                         t, k : fk xt , t , z t  0

                                                         t : z t+1 = H xt , t , z t


is feasible, and let V ¯ denote its value. Then V is concave. Moreover, suppose that ¯   is such that
                                                                                            N{0}                 N{0}
P ¯ admits a unique optimal solution, and let x
                                              ¯  X N{0} , ¯  RK                                    and ¯  RL            be such

that, for every t, k, l, m:

                                    k  0 with equality if fk x ,  , z
                                    t                                 >0                                                   (74)
                                                              t t t


                     u xt , t , z t             fk xt , t , z t                Hl xt , t , z t t+1
                                    +       t
                                            k                   +                             l = 0                        (75)
                       xm               k
                                                   xm                      l
                                                                                  xm

where the sequence ¯ is defined recursively by:


                           u xt , t , z t             fk xt , t , z t                   Hl xt , t , z t t+1
                    l =
                    t                     +       t
                                                  k                   +                                l                   (76)
                              zl              k
                                                         zl                        l
                                                                                           zl

                                                        lim  t t
                                                               l =0
                                                      t


                 ¯ is defined recursively by
and the sequence z


                                              t : z t+1 = H xt , t , z t .


Then ¯ maximizes V over  if


                           u xt , t , z t             fk xt , t , z t                  Hl xt , t , z t t+1
                  t, n :                  +       t
                                                  k                   +                               l = 0                (77)
                             n                k
                                                         n                     l
                                                                                          n


and the above condition is also necessary whenever V is differentiable at ¯.


Proof. Concavity of V can be proved using an argument analogous to the proof of Lemma 4. For a generic
                                                                                                T
sequence a
         ¯ = at     t=0    and for every T > 0, we use the notation a
                                                                    ¯T  at                      t=0   to denote the truncation



                                                             81
of a                                     ¯x
   ¯ at T . When dealing with a sequence , ¯ and an initial state z 0 , unless stated otherwise, it is

understood that z                                             ¯x
                ¯ refers to the sequence of states induced by , ¯ and the map H from z 0 :


                                                      t  0 : z t+1 = H xt , t , z t .


    ¯x
Let ,    ¯ 
      ¯, , ¯ be as in the statement. For every T > 0 consider the finite horizon problem,

                                                                      T
                         P T, ¯ : VT ¯T =                   max              t u xt , t , z t +  T +1           zT +1 T +1
                                                                                                                     l
                                                                                                                 l
                                                          ¯T X T +1
                                                          x
                                                                      t=0                                   l

                                           s.t. t = 0, ..., T : k : fk xt , t , z t  0.


By standard convex optimization theory, Conditions (74), (76) and (75) imply that x
                                                                                  ¯T , ¯ T is an optimal

dual pair for Problem P T, ¯ . Hence for every feasible sequence x
                                                                 ¯ and for every T > 0 we have

               T                                                                 T
                     t     t
                     u x , ,z  t   t
                                           +   T +1
                                                          zlT +1 T
                                                                 l
                                                                   +1
                                                                                      t u x t , t , z t +  T +1        zlT +1 T
                                                                                                                              l
                                                                                                                                +1

              t=0                                     l                       t=0                                  l


Sine Z and u are bounded48 , taking limits on both sides implies that x
                                                                      ¯ is optimal for P ¯ . Hence by

our assumptions it must be the unique optimal solution for P ¯ . Define


                                       u xt , t , z t                  fk xt , t , z t                 Hl xt , t , z t t+1
                    t, n : yn
                            t
                              =                       +            t
                                                                   k                   +                              l .
                                         n                     k
                                                                          n                        l
                                                                                                          n


We show that y
             ¯  V ¯ . From Marimon and Werner (2019) it follows that y
                                                                     ¯T  V ¯ for all T > 0:


                                                                                      T
                                   ¯ : VT ¯ -VT ¯                                          t        t
                                                                                                   yn t
                                                                                                      n   t
                                                                                                        - n
                                                                                     t=0       n



Pick ¯   and let x
                 ¯ be an optimal solution for P ¯ . For each T we have


                                       T
                                            t u x t , t , z t +  T +1                zlT +1 T +1
                                                                                                 VT ¯
                                                                                            l
                                   t=0                                           l
 48
      u is bounded, being a continuous function on a compact space.




                                                                            82
and
                                                    T
                                       VT ¯ =             t u xt , t , z t +  T +1                zT +1 T +1
                                                                                                       l
                                                                                                   l
                                                   t=0                                    l

hence

      T                            T                                                                              T
             t u x t , t , z t -          t u xt , t , z t +  T +1                zlT +1 - z T
                                                                                             l
                                                                                               +1
                                                                                                  T
                                                                                                  l
                                                                                                    +1
                                                                                                                       t            t
                                                                                                                                   yn  t - n
                                                                                                                                           t

      t=0                          t=0                                   l                                     t=0             n



Taking limits of both sides we get V ¯ -V ¯                                        t       t        t -  t . Since ¯ was arbitrary, this
                                                                              t=0       n yn       n    n

implies y  V ¯ . Hence, by Lemma 7, ¯ maximizes V over  if y
                                                           ¯ = 0, and this condition is also

necessary whenever V is differentiable at ¯. This completes the proof.


E.3.2        Proof of main result

This subsection is devoted to the proof of Theorem 4. We first establish two auxiliary lemmas.

Lemma 9. The function f defined in equation (71) is continuously differentiable. Moreover, given a

vector of choice probabilities p  I , a vector   RI and a scalar   R, the following are equivalent:

   (i)

                           = EP max (j +            j)   and j : pj = P j +               j       = max (k +          k)   .
                                                                                                     k


   (ii)
                                                         f (p)                    f (p)
                                         j : f (p) +           -             pk         + j -  = 0
                                                         pj          k
                                                                                  pk

Proof. It is well known (Galichon, 2018) that

                                                                                                               

                               p  I : -f (p) = min                           pj j - EP max (j +           j ) .
                                                                                              j
                                                                     j


By our assumptions on P, the objective function of the above problem is continuous and strictly convex,

hence the set of its solutions is a singleton. By the envelope theorem, this implies that, f (p) = {- (p)},

where  (p) is the unique optimal solution of the above problem. Hence f is differentiable. Moreover,

continuity of f follows by noting that  is continuous by the Maximum Theorem.




                                                                     83
   For the second part of the statement, it is known (see Galichon, 2018) that (i) is equivalent to


                                   (-f (p)) and - f (p) +  =                    p j j .
                                                                            j


When f is differentiable, the condition above is equivalent to (ii). This completes the proof.

              ¯, e
Lemma 10. Let s     ¯ q
                 ¯, G, ¯, ¯  ¯ µ
                          b, , ¯e , µ
                                    ¯s , ¯,¯s , ¯e be such that


                                         lim  t s,t      t e,t
                                                ij = lim  ij = 0,
                                        t                t



 ¯, e
 s     ¯ q
    ¯, G, ¯, ¯                                  i , ei > 0 and the following conditions hold:
             b  A z 0 and, for every t, i, j , st    t




                                      µs,t
                                       i  0 with equality if si < xii
                                                              t    t




                                     µe,t
                                      ij  0 with equality if ei Gij > yij
                                                              t t      t




                                t
                                ij  0 with equality if qij < mi si , ei Gij
                                                        t        t t     t




                        t
                        ij  wij q
                                  t
                                    + s,t   e,t+1
                                      ij - µij
                                                    t
                                                  - i                     t
                                                      , with equality if qij >0


                                            t
                                            i = EP max s,t
                                                       ij +       ij
                                                     j

                                        t
                                        b
                                      Pij = P s,t      s,t
                                              ij = max ik +            ik
                                                          k




                                             s,t   s,t s,t+1
                                             ii = µi + ii


                                               e,t        e,t
                                               ij = ij - µij


                                s,t              s,t+1
                                ij = -cij +  dij jj
                                       s
                                                       + (1 - dij ) s,t
                                                                    ij
                                                                        +1
                                                                           .

Then:


                                                         84
           ¯ maximizes the function s
       (i) s                            ¯,e
                                    ¯ V s ¯, G,
                                             ¯ z 0 over SA z 0 |e  ¯ if, for every i, t:
                                                                ¯, G


                                           mi st    t
                                               i , ei                      s,t+1
                                    i +
                                 - cs                          ij ij + i - ii
                                                              Gt  t    t
                                                                                 - µs,t
                                                                                    i = 0.                           (78)
                                             si           j



                                                       ¯ V s
This condition is also necessary whenever the function s   ¯,e  ¯ z 0 is differentiable at s
                                                             ¯, G,                         ¯.

            ¯ maximizes the function e
       (ii) e                            ¯, e
                                     ¯ V s  ¯ , G,
                                                ¯ z 0 over SA z 0 |s  ¯ if, for every i, t:
                                                                   ¯, G


                              mi st    t
                                  i , ei                                          e,t  e,t+1
                                                 ij ij -
                                                Gt                 ij cij + ij - µij - ij    = 0.                    (79)
                                                    t
                                                                  Gt   e
                                ei          j                 j



                                                       ¯ V s
This condition is also necessary whenever the function e   ¯, e   ¯ z 0 is differentiable at e
                                                              ¯ , G,                         ¯.
             ¯ maximizes the function G
       (iii) G                        ¯ V s
                                          ¯, e  ¯ , z 0 over SA z 0 |s
                                             ¯, G                    ¯, e
                                                                        ¯ if there exists a sequence ¯ such

that, for every i, t:


                                                                   e,t  e,t+1
                                        i , ei ij - ei cij + ij - µij - ij
                                    mi st                                                                            (80)
                                             t t     t  e                      t
                                                                               i

                                                      ij > 0.
                                    with equality if Gt


                                                       ¯ V s
This condition is also necessary whenever the function G   ¯, e  ¯ , z 0 is differentiable at G
                                                              ¯, G                            ¯.


Proof. We apply Lemma 8 to Problem (73)

                                                                          
                           ¯, e
                         P s     ¯ : Vp s
                              ¯, G      ¯, e  ¯ z 0 = max
                                           ¯, G,                               t W p st , et , Gt , q t , bt ; z t
                                                                    ¯,¯
                                                                    q b t=0

                                                                    s.t. s
                                                                         ¯, e  ¯ q
                                                                            ¯, G, ¯, ¯
                                                                                     b  A z0 .


In doing so, notice that the assumptions of Lemma 8 are satisfied, since by Lemma 9 the function W p is

continuously differentiable, and we can take feasible allocations and states to live inside a compact set.49

       We use the following notation for the Lagrangian multipliers:
  49
       Indeed, let M =   ij
                              x0
                               ij . Then for every s
                                                   ¯, e  ¯ q
                                                      ¯, G, ¯, ¯
                                                               b  A z 0 we must have

                                                  t, i, j : 0  st    t     t     t
                                                                i , qij , bij , xij  M.




                                                                   85
                                                multiplier      constraint

                                                   µe,t
                                                    ij          et  t    t
                                                                 i Gij  yij

                                                   µs,t
                                                    i           xt    t
                                                                 ii  si

                                                                 i =
                                                    t
                                                    i           st                 t + bt
                                                                                  qij
                                                                              j         ij

                                                   t
                                                   ij
                                                                 t  m st , et Gt
                                                                qij  i i i     ij

                                                                         ij = 1
                                                   t
                                                  -i                    Gt
                                                                   j


Moreover, we denote ¯= ¯s , ¯e , where ¯s is the component of ¯ associated with the supply component

of the state and ¯e is associated with the demand component. With this notation in hand, the set of

Conditions (74) is given by


                                t, i, j : µs,t
                                           i  0 with equality if si < xii
                                                                  t    t


                                          µe,t
                                           ij  0 with equality if ei Gij > yij
                                                                   t t      t


                                          t
                                          ij  0 with equality if qij < mi si , ei Gij ,
                                                                  t        t t     t




the set of Conditions (76) is given by


                                 t, i, j : s,t   s,t s,t+1
                                           ii = µi + ii

                                           e,t        e,t
                                           ij = ij - µij

                                           s,t              s,t+1
                                           ij = -cij +  dij jj
                                                  s
                                                                  + (1 - dij ) s,t
                                                                               ij
                                                                                   +1


Moreover, letting e , q  , b be a solution of

                                            max W (q ) -           ei    min ce
                                                                              ij + min ij
                                           e,q,b0                         j            j
                                                               i

                                                s.t.qij  M
                                                          qij  mi (M, ei )
                                                    j

                                              
                            ¯ such that et
we have that every sequence e            i > ei for some t, i is clearly sub optimal, hence without loss of generality we can
take
                                                                     
                                                      0  et    t
                                                          i , yij  ei .




                                                                   86
and the set of Conditions (75) is given by


                   t, i, j : t
                             ij  wij q
                                       t
                                         + s,t   e,t+1
                                           ij - µij
                                                         t
                                                       - i with equality if qij
                                                                             t
                                                                                >0

                                            f Pib                        f Pib
                             f    Pib   +             -              b
                                                                   Pik           + s,t
                                                                                   ij - i = 0.
                                                                                        t
                                                Pij           k
                                                                          Pik

By Lemma 9, the set of conditions in the second line above is equivalent to

                              t
                 t, i, j : Pij
                             b
                               = P s,t      s,t
                                   ij = max ik +                     ik    and i
                                                                               t
                                                                                 = EP max s,t
                                                                                          ij +   ij   .
                                                  k                                     j



To prove Statement (i), we apply Lemma 8 to the function s
                                                         ¯ V s
                                                             ¯,e  ¯ z 0 . Given our assumption
                                                               ¯, G,

that st
      i > 0 for every t, i, Condition (77) is given by


                                        mi st    t
                                            i , ei                             s,t+1
                       i, t : -cs
                                i +                                ij ij + i - ii
                                                                  Gt  t    t
                                                                                     - µs,t
                                                                                        i = 0.
                                          si              j



To prove Statement (ii), we apply Lemma 8 to the function e
                                                          ¯ V s
                                                              ¯, e   ¯ z 0 . Given our assumption
                                                                 ¯ , G,

that et
      i > 0 for every t, i, Condition (77) is given by


                           mi st    t
                               i , ei                                              e,t  e,t+1
                  i, t :                         ij ij -
                                                Gt  t
                                                                    ij cij + ij - µij - ij
                                                                   Gt   e
                                                                                              = 0.
                             ei             j                 j


                                                           ¯ V s
To prove Statement (iii), we apply Lemma 8 to the function G   ¯, e  ¯ , z 0 . Condition (77) is given
                                                                  ¯, G

by
                                                          e,t  e,t+1
                               i , ei ij - ei cij + ij - µij - ij
                 i, j, t : mi st    t t     t  e                       t
                                                                     - i      ij = 0
                                                                         + post

where post
         ij is the multiplier associated to the positivity constraint Gij  0, which must satisfy



                                        post
                                           ij  0 with equality if Gij > 0.
                                                                   t




This completes the proof.




                                                                   87
Proof of main result In order to prove the main result, let everything be as in the statement. Let
                             
 V s,t , U e,t , s,t , e,t   t=0   be the sequence of carriers and customers' value functions and meeting surpluses

associated with the sequence s
                             ¯, e  ¯ q
                                ¯, G, ¯, ¯
                                         b evaluated at the state trajectory z t , t >= 0. For every t  0

define s,t = V s,t , e,t = U e,t ,  t = EP U s,t ( ), t = s,t + e,t and
                                                                                                   
                                                                                                   
                                µs,t
                                 i = max -ci + i z
                                           s   s   t                     s,t   s,t
                                                                      ij ij + Ui - Vi
                                                                     Gt              s,t+1
                                                                                           ,0
                                                                                                   
                                                              j =i

                                µe,t        e,t
                                 ij = ij - Uij .



Then s  ¯, G,
     ¯, e  ¯ q¯, ¯  ¯ µ
                 b, , ¯e , µ
                           ¯s , ¯,¯s , ¯e satisfies the conditions of Lemma 10. Moreover, notice that:

    - Condition (78) can be written as

                                       mi st    t
                                           i , ei           s,t  e,t                             s,t
                             i, t :                      ij ij + ij - i z
                                                        Gt            s   t
                                                                                              ij ij = 0.
                                                                                             Gt
                                         si         j                                 j =i


Using s
      i z = mi si , ei /si and rearranging, this is equivalent to
         t      t t      t



                                                            s,t  e,t                   s,t
                                                         ij ij + ij  =              ij ij .
                                           s
                                           i zt         Gt                         Gt
                                                    j                          j


    - Condition (79) can be written as

                              mi st    t
                                  i , ei              s,t  e,t                         e,t   e,t+1
                   i, t :                          ij ij + ij -
                                                  Gt                         ij cij + Uij - Uij
                                                                            Gt   e
                                                                                                   = 0.
                                ei            j                         j


       e,t               e,t  e,t+1
Using Uij  = -ce
               ij + i z ij + Uij
                    e  t
                                      i z = mi si , ei /ei and rearranging, this is equivalent to
                                    , e  t      t t      t



                                                            s,t  e,t                   e,t
                                                         ij ij + ij  =              ij ij .
                                           e
                                           i zt         Gt                         Gt
                                                    j                          j


    - Condition (80) can be written as


                                                                          e,t   e,t+1
                                      i, j, t : mi st
                                                    i , ei ij - ei cij + Uij - Uij
                                                         t t     t  e                  t
                                                                                       i

                                             with equality if Gt
                                                               ij > 0.




                                                               88
       e,t               e,t  e,t+1            mi (st
                                                    i ,ei )
                                                        t
Using Uij  = -ce
               ij + i z ij + Uij
                    e  t            , e
                                      i z =
                                         t
                                                   ei         and rearranging, this is equivalent to

                                                i t
                             i, j, t : s,t
                                       ij  -          .
                                               i (z )
                                               e    t


                                    with equality if Gt
                                                      ij > 0.



This completes the proof.




                                           89
