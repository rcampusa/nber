                                NBER WORKING PAPER SERIES




                              INTERNATIONAL CAPITAL FLOWS

                                          Eric van Wincoop
                                             Cedric Tille

                                        Working Paper 12856
                                http://www.nber.org/papers/w12856


                      NATIONAL BUREAU OF ECONOMIC RESEARCH
                               1050 Massachusetts Avenue
                                 Cambridge, MA 02138
                                     January 2007




We thank seminar participants at the IMF, the Federal Reserve Bank of New York, the Hong Kong
Institute for Monetary Research, Hong Kong University and Hong Kong University of Science and
Technology for comments. We also thank Philippe Bacchetta, Mick Devereux, Martin Evans, Enrique
Mendoza, Asaf Razin, Alan Sutherland and Frank Warnock for comments and discussions. van Wincoop
acknowledges financial support from the Hong Kong Institute for Monetary Research. The views expressed
in the paper are those of the authors and do not necessarily represent those of the Federal Reserve
Bank of New York or the Federal Reserve System. The views expressed herein are those of the author(s)
and do not necessarily reflect the views of the National Bureau of Economic Research.

© 2007 by Eric van Wincoop and Cedric Tille. All rights reserved. Short sections of text, not to exceed
two paragraphs, may be quoted without explicit permission provided that full credit, including © notice,
is given to the source.
International Capital Flows
Eric van Wincoop and Cedric Tille
NBER Working Paper No. 12856
January 2007
JEL No. F32,F36,F41

                                               ABSTRACT

The sharp increase in both gross and net capital flows over the past two decades has led to a renewed
interest in their determinants. Most existing theories of international capital flows are in the context
of models with only one asset, which only have implications for net capital flows, not gross flows.
Moreover, there is no role for capital flows as a result of changing expected returns and risk-characteristics
of assets as there is no portfolio choice. In this paper we develop a method for solving dynamic stochastic
general equilibrium open-economy models with portfolio choice. We show why standard first and
second-order solution methods no longer work in the presence of portfolio choice, and extend them
giving special treatment to the optimality conditions for portfolio choice. We apply the solution method
to a particular two-country, two-good, two-asset model and show that it leads to a much richer understanding
of both gross and net capital flows. The approach highlights time-varying portfolio shares, resulting
from time-varying expected returns and risk characteristics of the assets, as a potential key source
of international capital flows.

Eric van Wincoop
Department of Economics
University of Virginia
P.O. Box 400182
Charlottesville, VA 22904-4182
and NBER
vanwincoop@virginia.edu

Cedric Tille
International Research Function
Federal Reserve Bank of New York
33 Liberty Street
New York, NY 10045-1003
CEDRIC.TILLE@NY.FRB.ORG
1       Introduction
The last two decades have witnessed a remarkable growth of both gross and net
international capital ‡ows and external positions. The near-tripling of gross posi-
tions among industrialized countries has also given rise to large valuation e¤ects
as asset price and exchange rate changes interact with much bigger external assets
and liabilities.1 These developments have lead to a renewed interest in understand-
ing the driving forces behind capital ‡ows and their macroeconomic implications.
Most of what we know about capital ‡ows is within settings where only one risk-
free bond is traded. These models only have implications for net capital ‡ows,
not gross ‡ows. Capital ‡ows are not driven by di¤erences in expected returns or
risk characteristics of assets since there is only one risk-free asset and therefore no
portfolio choice. Finally, since these are generally one-period bonds there is no role
for valuation e¤ects. At the other extreme are models where …nancial markets are
complete. But capital ‡ows do not really matter in these models and are rarely
ever computed as the real allocation is independent of the exact structure of asset
markets.2
    A broad consensus has therefore recently developed of the need for general
equilibrium models of portfolio choice in which …nancial markets are not restricted
to be complete.3 Such models feature a limited number of assets, such as stocks
and bonds, with both gross and net capital ‡ows. Portfolio choice is then key
and leads to capital ‡ows associated with changes in expected returns and risk
    1
      Lane and Milesi-Ferretti (2005) o¤er a detailed review of these developments.
    2
      The magnitude of capital ‡ows in complete markets models depends on the particular struc-
ture through which the market completeness is implemented. In a setup where a full set of
Arrow Debreu securities covering all possible future contingencies is traded in an initial period,
subsequent capital ‡ows will be always be zero. In other asset market structures with complete
markets capital ‡ows will generally be non-zero (e.g. Kollman (2006)), but Obstfeld and Rogo¤
(1996) argue that then they are “...merely an accounting device for tracking the international
distribution of new equity claims foreigners must buy to maintain the e¢ cient global pooling of
national output risks.”
    3
      Typical of current views, Gourinchas (2006) writes “Looking ahead, the next obvious step is
to build general equilibrium models of international portfolio allocation with incomplete markets.
I see this as a major task that will close a much needed gap in the literature...”. Also emphasizing
the need for incomplete market models, Obstfeld (2004) writes: “at the moment we have no
integrative general-equilibrium monetary model of international portfolio choice, although we
need one.”



                                                 1
characteristics of assets. One would expect that such models are widely adopted
in open economy macroeconomics, but they are not, largely due to the di¢ culty of
solving models of portfolio choice in a fully dynamic stochastic general equilibrium
(DSGE) setting.
    The goal of this paper is twofold. First, we develop a tractable method for solv-
ing DSGE open-economy models with portfolio choice that can be implemented
both when asset markets are complete and incomplete.4 Second, the method is
applied to a particular two-country, two-good, two-asset model to both illustrate
the solution technique and to show that it can lead to a much richer understanding
of both gross and net capital ‡ows and positions, and corresponding adjustments
of goods and asset prices. The approach highlights a potential key source of inter-
national capital ‡ows, associated with changes over time in portfolio allocation.5
We show that capital ‡ows can be broken down into a component associated with
portfolio growth through savings and a component associated with the optimal re-
allocation of portfolios across various assets due to changing expected returns and
risk-characteristics of assets. The model also allows us to study the impact of both
expected and unexpected valuation e¤ects that have received signi…cant attention
in recent years, e.g. Gourinchas and Rey (2006), Lane and Milesi-Ferretti (2005)
and Tille (2005).
    Standard solution methods for DSGE models separately analyze model equa-
tions at di¤erent orders (zero-order, …rst-order, and so on). The zero-order compo-
nent of a variable is its level when the variance of innovations in the model goes to
zero. The …rst-order component of a stochastic variable is proportional to model
innovations, while the second-order component depends on the product of model
innovations (product of …rst-order variables). The standard solution method com-
putes the zero-order component of the variables from the zero-order component
of the model equations, then the …rst-order component of the variables from the
…rst-order component of the model equations (after linearization), and so on.
    Unfortunately the standard method cannot be applied to a model with port-
folio choice. For example, the zero-order component of portfolio shares cannot
   4
     The method is in fact broader than just open-economy applications and can be broadly
applied to both partial and general equilibrium models of portfolio choice.
   5
     Even in complete market models authors generally only solve the steady portfolio allocation
rather than its time variation, e.g. Engel and Matsumoto (2005), Heathcote and Perri (2005)
and Kollman (2006).



                                               2
be computed from the zero-order component of model equations because portfolio
choice is not well-de…ned in a deterministic environment. Portfolio allocation, in-
cluding its zero-order component, depends on the variance and covariance of asset
returns. These second-order moments only show up in the second-order component
of the optimality conditions for portfolio choice. Therefore solving the zero-order
component of portfolio allocation is based on the second-order component of the
optimality conditions for portfolio choice. Analogously, the …rst-order component
of portfolio allocation is based on the third-order component of the optimality
conditions for portfolio choice. This captures the impact on portfolio choice over
time due to the time-variation in second moments of returns and time variation in
expected return di¤erences.6 While the third-order component of model equations
is generally considered to be very small and best ignored, we show that this is
misleading as it is key to obtaining the …rst-order solution of portfolio shares and
therefore capital ‡ows.
    We show that the technical challenge is associated with the di¤erence between
portfolio shares of Home and Foreign investors (i.e. the share of one asset in the
Home investor’s portfolio minus the share of that asset in the Foreign investor’s
portfolio). In contrast, the …rst-order component of average portfolio shares can
be solved from the …rst-order component of asset market clearing conditions.
    Overall the method can be summarized as follows. The zero-order component
of portfolio share di¤erences is solved jointly with the …rst-order component of
other model variables. This uses the second-order component of the optimality
conditions for portfolio choice and the …rst order component of other model equa-
tions. The second-order component of the optimality conditions for portfolio choice
leads to a solution of the zero-order component of portfolio share di¤erences as a
function of various second moments. These second moments in turn depend on
the …rst-order solution of other model variables. The latter can be solved from the
…rst-order component of other model equations, conditional on the zero-order com-
ponent of portfolio share di¤erences. Overall this therefore leads to a …xed point
problem in the zero-order component in portfolio share di¤erences. Taking this
one step further, the …rst-order component of portfolio share di¤erences is solved
   6
     The latter are third-order. For example, in a standard two-asset model the portfolio shares
depend on the expected excess return divided by the variance of the excess return. Since the
latter is second-order, the …rst-order component of portfolio allocation depends on the third-order
component of the expected excess return.


                                                3
jointly with the second-order component of other model variables. This uses the
third-order component of the optimality conditions for portfolio choice and the
second-order component of other model equations, which in combination lead to a
…xed point problem for the …rst-order component of portfolio share di¤erences.
    Solving for the …rst-order component of portfolio share di¤erences is technically
challenging as it is based on the second and third-order components of model
equations. However, we show that this is only needed to solve gross capital ‡ows
and gross external assets and liabilities, and to conduct welfare analysis. It is
not needed to solve for the …rst-order component of net capital ‡ows and the net
external asset position.
    The remainder of the paper is organized as follows. In section 2 we connect
the paper to related literature. Section 3 describes the solution method in general
terms. Section 4 describes a particular model, to which the solution method is
applied in section 5. Focusing on a particular parameterization, section 6 discusses
the implications of the model for gross and net capital ‡ows and positions, as well
as asset prices and the real exchange rate, external adjustment issues, and welfare.
Section 7 concludes.


2       Related Literature
Most closely related to this paper is the work by Devereux and Sutherland (2006a,b,c).
Devereux and Sutherland (2006c) have independently and simultaneously devel-
oped a solution method for DSGE models with portfolio choice that is essentially
the same as ours.7 They focus on the solution of the …rst-order component of port-
folio allocation, building on Devereux and Sutherland (2006a) that discusses the
solution of the zero-order component of portfolio allocation. While the solution
method is exactly the same as in our paper, the emphasis is di¤erent. Devereux
and Sutherland emphasize the most e¢ cient way to obtain a solution to the …xed
point problem for portfolio allocation that we described in the introduction, and
show that there is an analytical solution to this problem in a broad class of models.
Our focus is di¤erent in two ways. First, we characterize at a general level why
    7
    Judd and Guu (2000) develop a solution method for portfolio choice in a partial equilibrium,
static, context that is nonetheless related as well. While they adopt a di¤erent method, combining
bifurcation and implicit function theorems, it delivers a solution for portfolio allocations that is
the same as ours at least for the zero-order component.


                                                 4
standard solution methods for DSGE models break down with portfolio choice, and
present an iterative solution method to solve for portfolio choice that applies to any
order of approximation. Second, we illustrate the implications of this method for
the dynamics of gross and net international capital ‡ows in a simple model. Since
our ultimate goal is to have a better understanding of capital ‡ows we focus on the
intuitive driving forces behind the optimal portfolio allocation. Such intuition is
best obtained from the implicit solution for portfolio choice that follows from the
optimality conditions for portfolio choice, before combining them with the other
model equations. This delivers an expression for portfolio allocation as a function
of the expected excess return, various intuitive second moments and time-variation
in these second moments.8
    Also closely related is the work by Evans and Hnatkovska (2005,2006a,b) and
Hnatkovska (2006). Evans and Hnatkovska (2006a) develop a solution method
for DSGE models with portfolio choice that combines a variety of discrete time
approaches (perturbation and projection methods) with various continuous time
approximations (of portfolio return and second-order dynamics of the state vari-
ables). Evans and Hnatkovska (2005) and Hnatkovska (2006) apply the solution
method to discuss implications for issues such as the volatility of asset prices and
capital ‡ows and the magnitude of portfolio home bias. Evans and Hnatkovska
(2006b) use the method to discuss the welfare implications of …nancial integration.
While these are the …rst papers to tackle the di¢ cult problem of portfolio choice in
typical DSGE models, the method employed is an unusual hybrid that departs sig-
ni…cantly from standard …rst and second-order solution methods commonly used
to solve DSGE models. The solution described in this paper stays much closer
to these existing methods, modifying them in a way that accommodates portfolio
choice.
    There is also a related literature in …nance that solves stochastic equilibrium
models with portfolio choice. Examples are Brennan and Cao (1997) and Albu-
querque, Bauer and Schneider (2006). These are rich models in that there is a wide
range of assets, there are gross capital ‡ows among many countries, agents have
both public and private information that di¤ers across countries, and the models
are framed in a full general equilibrium setting. Nonetheless these models are far
   8
    This is an implicit solution since second moments and their time-variation themselves depend
on the portfolio allocation. We …rst solve the …xed point problem and then compute the various
intuitive drivers in the implicit solution.


                                               5
removed from standard DSGE models used in macroeconomics. The main missing
link from these models is that they are largely static. While there are multiple
trading rounds, assets have only one terminal payo¤. The solution methods also
strongly rely on constant absolute risk-aversion preferences, as is standard in noisy
rational expectations models.
    Finally, closely related as well are an instructive set of papers by Kraay and
Ventura (2000,2003). While they consider partial equilibrium models, they do
allow for portfolio reallocation across assets, which yields important insights. There
is trade in a riskfree international bond, with a …xed return, and domestic and
foreign capital. The expected return on capital can change due to diminishing
returns to capital. In that case there is a reallocation across assets that a¤ects net
capital ‡ows. This is distinguished from capital ‡ows associated with changes in
savings for a given portfolio allocation of savings (holding expected returns given).


3     A general description of the solution method
3.1    Overview
This section describes the key features of our approach. We start by presenting
the breakdown of the model equations and variables into components of di¤erent
orders. We then discuss how the allocation of investors’portfolios enter the model.
We review the standard solution method and explain why it no longer works in
a model with portfolio choice. The section ends by describing how the method is
adapted to encompass portfolio choice and discusses the solution algorithm.


3.2    The various orders of approximation
DSGE models generally lead to a set of equations of the form:

                                  Et f (xt ; xt+1 ) = 0                           (1)

where xt contains a vector of both control and state variables at time t. A subset
of the state variables, denoted yt , usually follows an exogenous process:

                                  yt+1 = yt +      t+1




                                           6
where t+1 are the model innovations. Each variable has components that are
zero-order, …rst-order, and higher order:

                                 xt = x(0) + xt (1) + xt (2) + :::                                  (2)

x(0) is the zero-order component of xt . It is de…ned as the level to which xt
converges when the variance of model innovation approaches zero. xt (O) is the
order O component, for O > 0. Normalizing the standard deviation of all model
innovations to , the order of a variable is de…ned as follows:

De…nition 1 The component of a variable is of order O if:

                                                   xt (O)
                                             lim       O
                                              !0

is either a well-de…ned stochastic variable whose variance is not zero or in…nity or
a non-zero constant whose value is not zero or in…nity.

    Components of order O are proportional to O . Stochastic variables that are
proportional to model innovations are …rst-order. An example is the dynamics of
goods prices in response to a shock: pt+1 (1) = p1 t+1 . Stochastic variables that
depend on the product of model innovations are second-order, such as pt+1 (2) =
p2 ( t+1 )2 . Other examples of second-order variables are 2 or t+1 . Examples of
third-order variables are the product of three model innovations, or the product of
  2
    and a model innovation.
    Model equations have to hold at all orders.9 They are derived by writing (1)
as an in…nite order Taylor expansion around the allocation xt = xt+1 = x(0)
and substituting the order decomposition (2). Let f1 and f2 denote the …rst-
order derivatives of f with respect to respectively xt and xt+1 , both evaluated at
x(0). Second-order derivatives f11 , f22 and f12 are de…ned analogously. Writing
x^t = xt x(0), and limiting ourselves for illustrative purposes to a second-order
expansion, we have:
                                                  1              1
f (xt ; xt+1 ) = f (x(0); x(0))+f1 x^t +f2 x^t+1 + x^0t f11 x^t + x^0t+1 f22 x^t+1 + x^0t f12 x^t+1 +:::
                                                  2              2
   9
     Formally, this can be seen as follows. Write f as shorthand for f (xt ; xt+1 ) and let f (O) be the
                                                            PO 1
order O component of f . We have f (O) = O lim !0 (f          o=0 f (o))=
                                                                              O
                                                                                . Adding expectations,
and applying this equation recursively starting at O = 0, using E(f ) = 0, we have E(f (O)) = 0
for all O.


                                                   7
Substituting x^t = xt (1) + xt (2) + ::: in this relation and taking expectations, we
write the zero-order component of (1) as

                                     f (x (0) ; x (0)) = 0                         (3)

Similarly, the …rst-order component is

                               f1 xt (1) + f2 Et xt+1 (1) = 0                      (4)

which consists only of linear terms. The second-order component is
                                              1
                  f1 xt (2) + f2 Et xt+1 (2) + x0t (1) f11 xt (1) +                (5)
                                              2
                     1
                  + Et x0t+1 (1) f22 xt+1 (1) + Et x0t (1) f12 xt+1 (1) = 0
                     2
Notice that the second-order component includes linear terms. Therefore, while
…rst-order components are linear, linear terms are not necessarily made only of
…rst-order components.


3.3    Introducing portfolio choice
Before describing the solution method, it is useful to specify how portfolio shares
enter the model.

Assumption 1 The only two ways that portfolio shares enter model equations are
(i) through the return on the overall portfolio and (ii) through asset demand.

    This assumption holds in almost any general equilibrium model with portfolio
choice. For concreteness, assume that there are two countries, Home and Foreign,
and N assets with asset i providing a gross stochastic return Ri;t+1 from t to t + 1,
with the return expressed in units of a numeraire currency. Consider an investor
                                                         H
in the Home country. In period t she invests a share ki;t  of her wealth in asset i,
with the shares summing up to 1. Treating asset 1 as a base asset, portfolio shares
clearly a¤ect the overall portfolio return:

                   p;H
                             X
                             N                                X
                                                              N
                                    H                                H
                  Rt+1   =         ki;t Ri;t+1   = R1;t+1 +         ki;t ERi;t+1
                             i=1                              i=2

where ERi;t+1 = Ri;t+1       R1;t+1 is the excess return on asset i.


                                                  8
   In addition portfolio shares a¤ect the model through asset demand. Consider
the asset market clearing condition for asset i:
                                               H         F
                                  Qi;t Ki;t = ki;t Wt + ki;t Wt                                (6)

The left hand side of (6) is the value of the asset supply, which is the product of
the asset price Qi;t and the quantity of the asset available for trading, Ki;t . The
right hand side of (6) is the asset demand from both Home and Foreign investors.
                                       H
The Home investor invests a share ki;t   of her wealth Wt in asset i, and the Foreign
                            F
investor invests a share ki;t of her wealth Wt in the asset.
    Rather than conducting the analysis in terms of the portfolio shares of each
country, it is useful to do so in terms of average portfolio shares and di¤erences in
portfolio shares. These are respectively
                       A          H      F                 D      H       F
                      ki;t = 0:5 ki;t + ki;t        ;     ki;t = ki;t    ki;t                  (7)
                                            D
If asset i is equity in Home …rms then ki;t   > 0 corresponds to the well-known
home bias in portfolios. The shares in each portfolio are simple combinations of
                        H       D      A        F         D      A
the elements of (7): ki;t = 0:5ki;t + ki;t and ki;t = 0:5ki;t + ki;t . We similarly
                                                          A
de…ne average wealth and its cross-country di¤erence as Wt = 0:5 (Wt + Wt ) and
WtD = Wt Wt . Although this is not key to the argument, we assume that
the zero-order components of wealth of the two countries are the same, equal to
W (0).10
    Optimal portfolio choice implies

              Et ms (xt ; xt+1 )ERi;t+1 = 0          i = 2; ::; N         s = H; F             (8)

where ms (xt ; xt+1 ) is the asset pricing kernel for country s. Investors choose their
portfolio to equalize the expected return on each asset, discounted by the pricing
kernel. Note that portfolio shares do not directly enter (8). They only enter indi-
rectly by a¤ecting the overall portfolio return, which a¤ects next period’s wealth
and therefore the asset pricing kernels. An immediate implication of (8) is that
the zero-order components of excess returns are zero: ERi (0) = 0. Furthermore,
the …rst-order component of (8) implies that the …rst-order component of expected
excess returns is zero: Et ERi;t+1 (1) = 0.11
  10
      Otherwise average portfolio shares need to be de…ned as a weighted average, using the zero-
order components of wealth shares as weights.
   11
      Without loss of generality, the zero-order component of the asset pricing kernels are normal-
ized at 1.

                                                9
3.4    The limitation of the standard solution method
The standard method for solving DSGE models solves the order O component of
model variables from the order O component of model equations. Speci…cally, the
zero-order component of variables is obtained from (3) and is also known as the
deterministic steady state. The method is sequential, as the zero-order solution
is required to compute the …rst-order solution: the terms f1 and f2 in (4) are
evaluated at x (0). In turn, the zero- and …rst-order solution is required to solve
for the second-order solution: the terms f1 , f2 , f11 , f22 and f12 in (5) are evaluated
at x (0), while xt (1) and xt+1 (1) use the …rst-order solution. This solution method
only works if the following two conditions are satis…ed:

Condition 1 The order O components of all model variables a¤ect the order O
component of at least one model equation.

Condition 2 The order O components of all model equations depend on the order
O component of at least one model variable.

   Unfortunately neither of these conditions holds in the presence of portfolio
choice. First, Condition 1 is not satis…ed because the order O components of the
                                   D
N 1 portfolio share di¤erences ki;t  do not a¤ect the order O component of model
equations for any O     0. This can be seen from the order O components of the
Home portfolio return and total asset demand (the right-hand side of (6)):

           p;H
                                      X
                                      N X
                                        O
                                                    D          A
          Rt+1 (O)   = R1;t+1 (O) +             0:5ki;t (o) + ki;t (o) ERi;t+1 (O   o)    (9)
                                      i=2 o=0
          X
          O
                    D
                0:5ki;t (o)WtD (O            A
                                      o) + 2ki;t (o)WtA (O   o)                          (10)
          o=0

 A
ki;t (O) enters (10) and can therefore be identi…ed from the order O component of
                                                     D
the asset market clearing equations. By contrast, ki;t (O), does not enter either (9)
or (10), and we therefore cannot compute it from the order O components of model
                          D
equations. Speci…cally, ki;t (O) appears in (9) and (10) multiplied with respectively
                    D
ERi;t+1 (0) and Wt (0), which are both zero. While the order O component of
 D
ki;t  does not a¤ect the order O component of model equations, the lower order
                   D
components of ki;t    do a¤ect the order O component of model equations (they
a¤ect both (9) and (10)).
     Condition 2 is not satis…ed either because there are N 1 equations whose

                                             10
order O components do not depend on the order O components of variables. This
can be seen by considering the order O component of the optimality conditions
for the Home and Foreign investors’portfolio choice (8), and taking the di¤erence
between the two conditions. We refer to this expression as the portfolio Euler
equation di¤erential. The zero and …rst-order components of the di¤erence are
zero. For O 2 the di¤erence is
                 X
                 O
            Et         mH
                        t+1 (o)   mFt+1 (o) ERi;t+1 (O       o) = 0     i = 2; ::; N         (11)
                 o=1

(11) does not depend on the order O component of variables because ERi;t+1 (0) =
0.12
     While the order O components of the portfolio Euler equation di¤erentials do
not depend on the order O components of model variables, they do depend on the
order O 1 components of model variables, as re‡ected in both mH        t+1 (O   1)
  F
mt+1 (O 1) and ERi;t+1 (O 1). Therefore the order O components of portfolio
Euler equation di¤erentials can be written as a function of components of order
O 1 and less of model variables other than portfolio share di¤erences. The latter
only impact the asset pricing kernels indirectly through the portfolio return, which
a¤ects next period’s wealth.


3.5     Solution algorithm
Assume that the model contains a total of Z equations and variables. In developing
the solution method, we start from the fact that Conditions 1 and 2 are satis…ed for
Z~ = Z (N 1) equations and variables. This includes all model variables other
than the vector ktD of N 1 portfolio share di¤erences and all model equations
other than the N 1 portfolio Euler equation di¤erentials (11).13 From now on
  12
      (11) is derived under the assumption that the return on asset i is the same for Home and
Foreign investors, in terms of the numeraire. The model presented in Section 3 relaxes this
assumption by introducing a trading friction, which appears as an additional term in (11). But
the presence of this additional term does not a¤ect our point that the order O component of (11)
does not depend on the order O component of model variables.
   13
      For model equations and variables that do not involve portfolio choice we simply assume that
Conditions 1 and 2 hold as those are standard even in DSGE models without portfolio choice.
It is easily veri…ed that Condition 2 holds for the average of portfolio Euler equations. We have
also seen that it holds for the portfolio return and asset market clearing equations. Finally, we
                                                                 A
have seen that Condition 1 holds for average portfolio shares kit  .

                                               11
we will simply refer to these as the “other” model variables and “other” model
equations. The solution algorithm is then summarized as follows.

Solution Algorithm In sequence O = 1; 2; :: solve the order O 1 component of
ktD jointly with the order O components of all “other” model variables, using (i)
the order O + 1 components of the portfolio Euler equation di¤erentials and (ii)
the order O components of all “other” model equations.

     Consider the case of O = 1. We know from (9)-(10) that the …rst-order compo-
nent of model equations is only a¤ected by the zero-order component of ktD , namely
k D (0). Using the …rst-order component of the Z~ “other”model equations, we can
then solve the …rst-order component of the Z~ “other” variables as a function of
the unknown k D (0). To solve for k D (0), we then use the second-order component
of the portfolio Euler equation di¤erentials. These depend on the …rst-order com-
ponents of the “other” model variables, which have been solved as a function of
k D (0). The use of second-order components of portfolio Euler equations to solve
for k D (0) is consistent with the intuition discussed in the introduction as k D (0)
depends on second moments that show up in the second-order components of the
portfolio Euler equations.
     We proceed similarly for O = 2. We solve jointly for the …rst-order component
of ktD and the second-order component of the Z~ “other” model variables. In this
case we use the second-order components of the “other”model equations together
with the third-order component of the portfolio Euler equation di¤erentials. This is
where we stop in the paper as we are only interested in the …rst-order components
of gross and net capital ‡ows. But in principle one can keep following this algorithm
for higher orders.
     Solving for the …rst-order component of ktD requires second and third-order
components of model equations and is therefore substantially more complicated
than solving the …rst-order component of “other” model variables. However, the
…rst-order solution of ktD is only needed to compute the …rst-order component of
gross capital ‡ows and gross external positions. We can gain substantial insights
on the solution of the model, while avoiding technical complications, by focusing on
the net asset positions and net capital ‡ows, which depend only on the zero-order
solution of ktD and the …rst-order solution of the other model variables. Intuitively,
net capital ‡ows re‡ect the extent to which investors worldwide accumulate assets
of one country relative to another, which is driven by the …rst-order component

                                         12
of ktA (one of the “other”variables). They do not depend on whether investors in
particular countries do so to di¤erent extents, which is captured by the …rst-order
component of ktD .
    Algebraically this can be seen as follows. If the …rst J assets are claims on the
Home country, the net value of Home external assets minus liabilities is

                    X
                    N                           X
                                                J                         X
                                                                          J                    X
                                                                                               J
                             H                         F                          H                   F
               Wt           ki;t         Wt           ki;t = Wt     Wt           ki;t     Wt         ki;t
                    i=J+1                       i=1                        i=1                 i=1

The …rst-order component of the net external asset position is proportional to:

                               X
                               J                                  X
                                                                  J
                                                                                        1 D      X   J
      Wt (1)    2WtA    (1)               A
                                         ki;t   (0)     2W (0)           A
                                                                        ki;t   (1)        Wt (1)      D
                                                                                                     ki;t (0)
                                   i=1                            i=1
                                                                                        2        i=1

It clearly depends on the zero and …rst-order components of the average portfolio
shares, but only on the zero-order component of the di¤erence in portfolio shares.
Net capital ‡ows are simply equal to the change in the net external asset position,
after controlling for valuation changes associated with asset prices, and can also
be solved without needing the …rst-order component of the di¤erence in portfolio
shares.


4     A two-country, two-good, two-asset model
This section describes a symmetric two-country, two-good, two-asset model to
which the solution technique will be applied. In order to both simplify the model
and focus on portfolio choice, we abstract from other decisions by agents (e.g.
consumption and investment decisions) in order to focus squarely on what has
been the key obstacle so far in solving models with incomplete …nancial markets.


4.1    Two goods: production and consumption
The two countries, Home and Foreign, each produce a di¤erent good that is avail-
able for consumption in both countries. Production uses a constant returns to
scale technology combining labor and capital:

                                         1
                            Yi;t = Ai;t Ki;t Ni;t                               i = H; F



                                                           13
where H and F denote the Home and Foreign country respectively. Yi is the output
of the country i good, Ai is an exogenous stochastic productivity term, Ki is the
capital input and Ni the labor input. A share of output is paid to labor, with
the remaining going to capital. The capital stocks and labor inputs are …xed and
normalized to unity. Outputs therefore simply re‡ect the levels of productivity,
which follow an exogenous auto-regressive process:

                     Yi;t = Ai;t       ;    ai;t+1 = ai;t +             i;t+1                         (12)

where lower case letters denote logs and 2 (0; 1). The productivity innovations
are iid, with a N (0; 2 ) distribution and uncorrelated across countries.
    Consumers in both countries purchase both Home and Foreign goods, with a
preference towards towards domestic goods. The CES consumption indices are
given in the …rst column of the table below, where C is the overall consumption of
the Home consumer, CH denotes her consumption of Home goods and CF denotes
her consumption of Foreign goods. The corresponding variables for the Foreign
consumer are denoted by an asterisk.        is the elasticity of substitution between
Home and Foreign goods, and captures the relative preference towards domestic
goods, with     > 0:5 corresponding to home bias in consumption. The second
column shows the corresponding consumer price indexes in both countries, with
the Home good taken as the numeraire and PF representing the relative price of
the Foreign good:

               Consumption indices                                         Price indices
      h    1         1             1        1
                                              i      1
                                                                    h                                 i11
                                                                                                  1
 Ct = ( ) (CH;t ) + (1    ) (CF;t )                          Pt =         + (1        ) [PF;t ]
      h     1        1      1                   1i       1
                                                                    h                                 i11
 Ct = (1   ) CH;t      + ( ) CF;t                            Pt = (1             )+     [PF;t ]1

   The allocation of consumption across goods is computed along the usual lines,
re‡ecting the relative price of Foreign goods and the elasticity of substitution .
The presence of home bias in consumption implies that the Home and Foreign
consumer price indexes do not move in step, so movements in the relative price of
the Foreign good lead to movements in the real exchange rate Pt =Pt . The model
therefore has implications for real exchange rate adjustments that can be expected
when faced with external imbalances, as in Obstfeld and Rogo¤ (2005) and Engel
and Rogers (2006).


                                           14
4.2     Two assets: rates of return
Two assets are traded, claims on the Home capital stock KH and claims on the
Foreign capital stock KF . We refer to these as Home and Foreign equity. The
price at time t of a unit of Home equity is denoted by QH;t , measured in terms of
the numeraire Home good. The holder of this claim gets a dividend in period t + 1,
which is a share 1       of output (12), and can sell the claim for a price QH;t+1 .
The overall return on a Home equity, in terms of Home goods, is then:

              RH;t+1 = 1 + (QH;t+1        QH;t ) =QH;t + (1       )AH;t+1 =QH;t            (13)

Similarly, the price at time t of a unit of Foreign equity is denoted by QF;t , expressed
in terms of the numeraire Home good. The return on Foreign equity is:

            RF;t+1 = 1 + (QF;t+1       QF;t ) =QF;t + (1      )PF;t+1 AF;t+1 =QF;t         (14)

(13)-(14) show that the returns consist of a capital gain or loss due to movements
in equity prices and a dividend yield.
    While agents can invest in equity abroad, this entails a cost. Speci…cally, the
agent receives only the returns in (13)-(14) times an iceberg cost e . It is a simple
way to capture the hurdles of investing outside the domestic country, re‡ecting the
cost of gathering information on an unfamiliar market for instance.14 This cost is
second-order ( is proportional to 2 ) to ensure a well-behaved portfolio allocation.
This friction also ensures that …nancial markets are incomplete.15
                                                   H
    In period t a Home agent invests a fraction kH;t  of her wealth in Home equity,
                     H
and a fraction 1 kH;t in Foreign equity. The overall real return on her portfolio,
expressed in terms of the Home consumption basket, is then:
                   p;H    H                         H
                  Rt+1 = kH;t RH;t+1 + (1          kH;t )e RF;t+1 Pt =Pt+1                 (15)
                                               F
Similarly, a Foreign agent invests a fraction kH;t of her wealth in Home equity, and
                 F
a fraction 1 kH;t in Foreign equity, leading to an overall real return in terms of
  14
     It is by now quite common to introduce such exogenous …nancial frictions. Other examples,
with more detailed motivating discussions, are Martin and Rey (2004), Coeurdacier (2005) and
Coeurdacier and Guibaud (2005).
  15
     Even in the absence of this …nancial friction …nancial markets are incomplete when    6= 1,
where      is the rate of relative risk-aversion discussed below. See the discussion in Obstfeld
and Rogo¤ (2000), page 364. Their model is one with trade costs, but that is observationally
equivalent to home bias in preferences.

                                              15
the Foreign consumption basket of:
                 p;F    F                        F
                Rt+1 = kH;t e RH;t+1 + (1       kH;t )RF;t+1 Pt =Pt+1            (16)


4.3    Stationarity and wealth accumulation
It is well-known that when …nancial markets are incomplete even transitory shocks
can have a permanent e¤ect on the distribution of wealth, leading to a non-
stationary distribution of wealth. This is unappealing as a country will eventually
own the entire world, so that the long run wealth distribution is not determined.
In addition, approximation methods around an allocation cannot be used as the
economy can move far away from it.
    In order to induce stationarity we assume that agents die with constant prob-
ability and new agents are born at the same rate. We do so by adopting the
framework of Caballero, Fahri and Gourinchas (2006). Agents only consume in
the last period of life, during which they liquidate all their assets. Since the prob-
ability of death is the same for all agents, total consumption is then simply equal
to aggregate wealth times the probability of death.
    We assume that newborn agents work only in the …rst period of their life and
therefore face no risk on any future labor income. After that the wealth of a
particular Home investor j accumulates according to
                                    j
                                  Wt+1 = Wtj Rt+1
                                              p;H
                                                                                 (17)
The portfolio return will be the same for all Home investors as they all choose the
same portfolio.
    Aggregate wealth accumulation is di¤erent for three reasons. First, only a
fraction 1      of wealth is reinvested since the rest is consumed by agents who
will die. Second, labor income of the newborns raises aggregate wealth. Third, we
assume that the cost of equity investment abroad does not represent lost resources,
but instead is a fee paid to a broker, which we take to be the newborn agents for
simplicity. These fees therefore do not a¤ect aggregate wealth. Let Wt and Wt
be real aggregate wealth of the Home and Foreign countries, measured in terms of
their respective consumption baskets. They then accumulate according to
                          H                 H            Pt       AH;t+1
        Wt+1 = (1     ) kH;t RH;t+1 + (1 kH;t  )RF;t+1       Wt +              (18)
                                                        Pt+1       Pt+1
                          F                 F            Pt        PF;t+1 AF;t+1
        Wt+1 = (1     ) kH;t RH;t+1 + (1 kH;t  )RF;t+1       Wt +              (19)
                                                        Pt+1          Pt+1

                                         16
4.4    Markets clearing
There are goods and asset market clearing conditions for both countries. Con-
sumption by the Home and Foreign dying agents has to equal the output of Home
and Foreign goods. Using (12) and the allocation of consumption between Home
and Foreign, goods market clearing conditions are

           AH;t =      (Pt )      Wt + (1          ) (Pt )       Wt                         (20)
           AF;t = (1           ) (PF;t )   (Pt )       Wt +      (PF;t )       (Pt )   Wt   (21)

   Turning to asset markets, the total values of Home and Foreign equity supply
are equal to QH;t and QF;t since the capital stocks are normalized to 1. The
amounts invested by Home and Foreign agents at the end of period t, measured in
Home goods, are (1    ) Wt Pt and (1    ) Wt Pt respectively. The market clearing
conditions for Home and Foreign asset markets are then
                                      H            F
               QH;t = (1           ) kH;t Wt Pt + kH;t W t Pt                               (22)
                                             H                          F
               QF;t = (1           ) (1     kH;t )Wt Pt + (1           kH;t )Wt Pt          (23)


4.5    Portfolio allocation
The only decision faced by agents is the allocation of their investment between
Home and Foreign equity. A Home agent j who dies in period t + 1 consumes her
entire wealth and gets utility
                                j       j          1
                               Ut+1 = Wt+1              =(1        )

From the point of view of period t, the agent faces a probability of dying the
next period. We denote the value of wealth in period t by V (Wtj ). The Bellman
equation is
                                                                           1
            V (Wtj ) = (1                  j
                                  )Et V (Wt+1 )+                  j
                                                             Et Wt+1            =(1     )   (24)

where is the discount rate.
   We conjecture the following form for the value of wealth:
                                                             1
                        V (Wtj ) = ev+fH (St ) Wtj               (1        )                (25)

where St is the state space discussed below. The function fH (St ) captures time
variation in expected portfolio returns. For given wealth utility is higher (fH (St )

                                              17
is lower) the larger are expected future portfolio returns. These expected returns
will vary with the state. In the steady state S = 0 and we normalize fH (0) = 0.
The constant term v can have components of zero, …rst and higher order, written
as v = v(0) + v(1) + :::, with v(i) proportional to i . For Foreign investors the
function fH (St ) is replaced by fF (St ).
    Agent j of the Home country chooses the portfolio allocation to maximize the
right hand side of (24), subject to (17) and (15). The …rst-order conditions for
Home and Foreign investors are:

    Et   t   RH;t+1       e RF;t+1 = 0     ;        Et   t   e RH;t+1       RF;t+1 = 0   (26)

where
                                                              p;H
                      t   =   (1   )ev+fH (St+1 ) +          Rt+1       Pt =Pt+1
                                                              p;F
                      t   =   (1   )ev+fF (St+1 ) +          Rt+1       Pt =Pt+1

are the asset pricing kernels of the Home and Foreign investors respectively. The
optimality condition for portfolio choice therefore sets the expected product of the
asset pricing kernel and the excess return equal to zero.
   Using (25), the Bellman equation for a representative investor in counry i is
                                                              p;i   1
             ev+fi (St ) = Et (1    )ev+fi (St+1 ) +         Rt+1            i = H; F    (27)

which gives an implicit solution to the function fi (St ).


5     Solution of the model
We now apply the general solution method discussed in section 3 to the speci…c
model of section 4. After substitution of the expressions for asset and portfo-
lio returns, the model can be summarized by 12 equations: the two processes
for technology (12), the two wealth accumulation equations (18)-(19), the two
goods market equilibrium equations (20)-(21), the two asset market clearing con-
ditions (22)-(23), the two Euler equations for portfolio choice (26) and the two
Bellman equations (27). The Foreign goods market equilibrium condition (21) can
be dropped due to Walras’law, which gives a total of 11 equations.
    Dropping country subscripts due to symmetry, the zero-order components of the
equations imply that W (0) = 1= , R(0) = (1        ) = (1   ), Q(0) = (1    )= ,

                                               18
A(0) = PF (0) = 1 and v(0) = ln( ) ln(R(0) 1 =                 1 + ). For portfolio
allocation we need to make a distinction between average portfolio shares and
the di¤erence across countries. De…ne ktA = 0:5(kH;t  H      F
                                                         + kH;t ) as the average share
invested in the Home country. From the asset market clearing conditions k A (0) =
0:5. De…ne ktD = kH;tH      F
                           kH;t as the di¤erence in portfolio shares invested in the
Home country. A positive number re‡ects positive portfolio home bias. Its zero
order component, k D (0), can only be computed from the second-order component
of portfolio Euler equations. We take …rst and higher order log-expansions around
the zero-order solution of all variables. Appendix A lists all model equations with
variables in logarithmic form. Logs are denoted with lower case letters.
    We now follow the solution method described in section 3. We keep the descrip-
tion of the solution method as non-technical as possible, focusing on the method-
ology rather than the details. Appendices B and C provide an abbreviated version
of technical details associated with the …rst and second-order components of Bell-
man equations and the third-order components of Euler equations for portfolio
choice, with a full description of all the algebra left to a Technical Appendix that
is available on request.


5.1        The easy part
We start with the …rst-order solution of all variables other than the portfolio share
di¤erence, conditional on k D (0). For technology, wealth and portfolio shares we
use the di¤erences and averages of the variables across countries rather than the
country-speci…c variables themselves. For example, aD    t = aH;t     aF;t and aAt =
0:5(aH;t + aF;t ). The vector of state variables is
                                                              0
                                    St =     aD
                                              t wtD aA
                                                     t                                      (28)

The state consist of the average and di¤erence in technology variables, as well as
the di¤erence in wealth levels that matters when asset markets are incomplete.16 .
    First consider the 9 equations of the model other than the Bellman equations.
After linearization we obtain the …rst-order components of these equations. There
is one redundancy since the …rst-order component of the portfolio Euler equations
for Home and Foreign investors both imply that Et ert+1 (1) = 0, where ert+1 =
  16
       The average wealth level is not a separate state variable and the …rst-order components of
wtA    and aA
            t are identical.


                                                19
rH;t+1 rF;t+1 is the excess return between Home and Foreign equity. This leaves
us with 8 equations. Taking expectations of all equations, they take the form
Et f (xt ; xt+1 ) = 0, where xt consists of the 3 state variables in (28) plus the 5
control variables cvt = (wtA ; pF;t ; ktA ; qH;t ; qF;t )0 .
    Using the standard …rst-order solution technique applied to the …rst-order com-
ponents of the log-linearized equations, we solve for the …rst-order component of
control variables as a function of state variables and for the dynamic process of
the …rst-order component of state variables:

               cvt (1) = BSt (1)          ;       St+1 (1) = N1 St (1) + N2     t+1            (29)

where B, N1 and N2 are matrices and t+1 = ( H;t+1 ; F;t+1 )0 .
    The …rst-order component of ktA , the average fraction invested in Home assets, is
solved using only the …rst-order component of the asset market clearing conditions.
A higher average portfolio share implies a higher demand for Home equity, which
raises the relative price of Home equity and lowers its expected return relative to
Foreign equity. Imposing that the …rst-order components of expected returns must
be equal then identi…es the equilibrium average portfolio share.
    k D (0) a¤ects the …rst-order solution in two ways. First, it a¤ects the responsive-
ness of ktA (1) to the state variables (through the di¤erence in the two asset market
clearing conditions), but does not a¤ect the responsiveness of the other control
variables to the state variables.17 Second, it a¤ects the sensitivity of the second
state variable to model innovations as k D (0) multiplies excess return innovations
in the wealth accumulation equations.
    The …nal two equations are the Bellman equations (27). Let the …rst-order
component of fH (St ) be H1;H St (1), where H1;H is the …rst-order derivative of
fH with respect to St at S(0) = (0; 0; 0)0 . Appendix B shows that H1;H can be
computed from the …rst-order component of the Home Bellman equation, which
also gives v(1) = 0. For the Foreign country the …rst-order component of fF (St )
is H1;F St (1), with H1;F solved analogously from the …rst-order component of the
Foreign Bellman equation.
  17 D
     k (0) does not a¤ect the other control variables since when adding the expectation operator
to the wealth accumulation equations (which is needed to solve for the control variables), portfolio
shares are multiplied by the expected excess return. Both the zero and …rst-order components
of the expected excess return are zero.



                                                20
5.2    A bit more di¢ cult
The …rst-order solution (29) is conditional on the unknown k D (0), which is solved
from the di¤erence across countries of the second-order component of the portfolio
Euler equations. Abstracting from the algebraic details, we get

                                           1 cov(pt+1 (1) pt+1 (1); ert+1 (1))
       k D (0) = 2                   +                                            (30)
                      var(ert+1 (1))                   var(ert+1 (1))
                           0
                     (1      )cov(fHt+1 (1) fF t+1 (1); ert+1 (1))
                   +
                                     var(ert+1 (1))

The …rst-order component of the excess return between Home and Foreign equity
is ert+1 (1) = r t+1 for a 1 by 3 vector r that follows from the …rst-order solution
(29). fHt+1 (1) = H1;H St+1 (1) is the …rst-order component of the function fH (St+1 ),
and 0 = 1        (1    )R(0)1 .
    A positive value of (30) implies home bias, while a negative value implies foreign
bias. (30) shows that there are three sources of portfolio bias. The …rst re‡ects the
cost of investing abroad, , with a higher cost making investing in domestic equity
more attractive. The second re‡ects the co-movements of the real exchange rate
and excess return. Assuming > 1, it is attractive for Home investors to invest in
the Home equity if the excess return on Home equity is high in states where the
Home price index is relatively high.
    The …nal source re‡ects a hedge against changes in future expected portfolio
returns, which are captured by the functions fH (St+1 ) and fF (St+1 ) in the value
function of Home and Foreign investors next period. An increase in these functions
imply a drop in welfare because of low expected future returns. It is attractive for
Home investors to invest in Home equity when the excess return on Home equity
is high in states where expected future portfolio returns are low (fH (St+1 ) high).
This source is positive when there is consumption home bias ( > 0:5). Consider
for example a positive shock to Home productivity relative to Foreign productivity
in period t + 1. This will lower the expected real portfolio return of Home investors
in subsequent periods, relative to Foreign investors. The reason is that the relative
price of Foreign goods rises at time t + 1 and is then expected to fall, leading to
an expected fall of the Foreign price index relative to the Home price index (i.e.
a lower real portfolio return for Home investors). At the same time the return on
Home equity increases at time t + 1, relative to Foreign equity. Home equity is
then a better hedge against changes in expected real portfolio returns for Home

                                          21
than for Foreign investors.
     Notice that each of the three components of k D (0) in (30) is a ratio of second-
order variables. Both the numerator and the denominator of these terms are
proportional to 2 , and the ratio is therefore zero-order. This illustrates why the
second-order components of portfolio Euler equations are necessary to compute
the zero-order component of portfolio shares.
     With the exception of , all the second-order components in the three ratios are
based on variances and covariances of …rst-order components of model variables.
These are based on the …rst-order solution (29), which is in turn conditional on
k D (0).18 This leads to a …xed point problem. We solve k D (0) as a …xed point of
the function that maps k D (0) into itself: k D (0) maps into the …rst-order solution
(29), which maps into k D (0) in (30). The solution described so far implements the
solution algorithm in section 3 for O = 1.
     It is worthwhile pointing out that the di¢ culty in solving DSGE models with
portfolio choice lies in assumptions that distinguish Home investors from Foreign
investors. Otherwise ktD = 0 and we can solve the model in exactly the same
way as for DSGE models without portfolio choice. In the model described here
there are two di¤erences between Home and Foreign investors. First, the …nancial
friction impacts returns asymmetrically for Home and Foreign investors. Second,
the home bias in preferences leads to di¤erent consumer price indices that they
hedge against when choosing their portfolio. When we set = 0 and = 0:5 these
di¤erences disappear.


5.3     The hard part
The …nal step is only necessary to compute gross external holdings or gross capital
‡ows, which requires the …rst-order component of the portfolio share di¤erence ktD .
In order to solve for the …rst-order component of ktD we need to implement the so-
lution algorithm in section 3 for the case O = 2. It proceeds along the same line as
the solution described above, but now one order higher for all equations and vari-
ables. We combine the third-order component of the di¤erence in portfolio Euler
  18
     The solution for k D (0) in (30) depends on the …rst-order components ert+1 (1), pt+1 (1)
pt+1 (1) and fH;t+1 (1) fF;t+1 (1). These all depend on St+1 (1) in a way that is independent
of k D (0). But St+1 (1) depends on t+1 in a way that does depend on k D (0) as the portfolio
allocation a¤ects the impact of shocks on wealth accumulation.



                                             22
equations with the second-order components of all 10 “other” model equations,
and solve for the …rst-order component of ktD and the second-order component of
all “other”variables.
    We start by solving the second-order component of the “other”variables condi-
tional on a …rst-order solution for the portfolio share di¤erence: ktD (1) = ks St (1),
with ks a 1 by 3 vector. The second-order components of the “other” variables
are obtained after substituting the …rst-order solutions of all variables into the
second-order components of the 10 “other” model equations. Since such second-
order solutions are by now quite standard, we omit a full description of the algebra
for brevity.19 The solution for control variables, for example pF t , takes the form

                        pF;t (2) = ps St (2) + St (1)0 pss St (1) + kp   2
                                                                                            (31)

where ps is a vector, pss a matrix and kp a scalar. The second-order solution for
state space accumulation takes the form
                          2                                                         3
                             St (1)0 N3;1 St (1) + 0t+1 N4;1 t+1 + St (1)0 N5;1 t+1
                          6                                                         7
  St+1 (2) = N1 St (2) + 4 St (1)0 N3;2 St (1) + 0t+1 N4;2 t+1 + St (1)0 N5;2 t+1 5 + N6 2
                             St (1)0 N3;3 St (1) + 0t+1 N4;3 t+1 + St (1)0 N5;3 t+1
                                                                                        (32)
where N3;i , N4;i and N5;i are matrices and N6 is a vector. Finally, Appendix B
shows that the second-order component of the Bellman equations yield the second-
order derivative of the functions fH (St ) and fF (St ) at S = S(0).
    In parallel to the …rst-order solution, ktD (1) a¤ects the second-order solution in
two ways. First, of the control variables it only a¤ects ktA (2), through the di¤erence
in the two asset market clearing equations.20 Second, it a¤ects the dynamic process
of the second-order component of the second state variable as ktD (1) multiplies the
excess return innovation ert+1 (1) = r t+1 in the wealth accumulation equations.
    The second-order components of time t + 1 variables depend, among other
terms, on the product of elements of St (1) and t+1 . For example, using (29), (31)
and (32), the sum of these terms in the solution for pF;t+1 is
                                                                    !
                                X 3
                      St (1)0        ps;i N5;i + N10 (pss + p0ss )N2 t+1
                                i=1
  19
      For descriptions of second-order solutions see Kim et.al. (2003), Schmitt-Grohe and Uribe
(2004) and Lombardo and Sutherland (2005).
   20
      In the expected second-order component of the wealth accumulation equations ktD (1) is mul-
tiplied by the …rst-order component of the expected excess return, which is zero.

                                               23
where ps;i is element i of the vector ps . This captures time-variation in the impact
of shocks on the relative price next period. The impact varies with the current
state St (1).
    This naturally leads to time-variation in conditional second moments, which
shows up in the third-order component of variances and covariances. In order to see
that, consider two variables x and y for which the expected …rst-order components
are zero. The third-order components of the variance and covariance are then
var(x)
 ^      = 2Ex(1)x(2) and cov(x;
                              ^     y) = Ex(1)y(2) + Ex(2)y(1).21 These third-order
components take the form 2 St (1). For example ert+1 (1) = r t+1 , while in line
with the discussion above ert+1 (2) involves a term of the form St (1)0 A t+1 (with A
a matrix of constants), as well as squared terms in model innovations and St (1).
Therefore Eert+1 (1)ert+1 (2) = r A0 2 St (1). This third-order component therefore
varies with the state space.
    In order to solve ktD (1), we combine the second-order solution described above
with the third-order component of the di¤erence in portfolio Euler equations across
countries. The latter is derived in Appendix C. The resulting …rst-order solution
for ktD is

                             var(er
                                ^     t+1 )             ^ t+1 pt+1 ; ert+1 )
                                                     1 cov(p
        ktD (1) =   k D (0)                  +                                 +          (33)
                           var(ert+1 (1))                  var(ert+1 (1))
        cov
         ^ (fHt+1      fF t+1 ; ert+1 ) + 0:5 0 Et [(fHt+1 (1))2 (fF t+1 (1))2 )] ert+1 (1)
                                                              0
                                       var(ert+1 (1))=(1        )

In this expression the variance in the denominator of each ratio is second-order,
while the terms in the numerator are all third-order, so that the ratios are all
…rst-order. The three ratios capture respectively time variation in the variance of
the excess return, in the covariance between the real exchange rate and the excess
return, and in the hedge against changes in expected portfolio returns. These same
elements without their time variation are present in the zero order component (30)
of portfolio shares.
    An increase in the variance of the excess return by itself reduces home bias. For
instance, (30) shows that home bias is a¤ected by the …nancial friction , relative
to the variance of the excess return. An increase in the variance then reduces the
relevance of the …nancial friction for the portfolio decision, which translates into a
  21
   For example, var(x) = E(x2 ) (Ex)2 . Substituting x = x(0) + x(1) + x(2) + ::: and using
Ex(1) = 0, the third- order component of var(x) is 2Ex(1)x(2).


                                             24
smaller home bias. This is captured by the …rst ratio in (33). An increase in the
covariance between the real exchange rate and the excess return leads to increased
home bias as it implies that for both Home and Foreign investors their domestic
asset has a relatively high payo¤ when the domestic price index is high. This
is captured by the second ratio in (33). Similarly, an increase in the covariance
between the hedging term fH (St+1 ) fF (St+1 ) and the excess return leads to
increased home bias as it implies that for both Home and Foreign investors their
domestic asset has a relatively high payo¤ when their utility is low due to low
future expected portfolio returns. This is captured by the last ratio in (33).
     (33) implies that ktD (1) is of the form ks St (1). We solve for the vector ks by
solving the …xed point of a function that maps ks into itself. For a given vector ks
we can solve the second-order components of the “other”model variables. Together
with the …rst-order components of the “other”model variables it allows us to solve
the time varying moments var    ^ and cov^ in (33). This in turn yields a new vector
ks . Solving the …xed point problem yields the …rst-order solution of ktD .
     The solution for ktD (1) is based on the di¤erence across countries in the third-
order component of the portfolio Euler equations. So far we have not used the
average of the portfolio Euler equations across the two countries. One can show
that the average of the second-order components of portfolio Euler equations im-
plies that Et ert+1 (2) = 0, so that the zero, …rst and second-order components of
the expected excess return are all zero.22 Taking the average of the third-order
component of the portfolio Euler equations we get (see Appendix C):
                  Et ert+1 (3)            1 cov(p
                                             ^ t+1 + pt+1 ; ert+1 )
        ktA (1) =                 +                                   +                  (34)
                 var(ert+1 (1))                  2var(ert+1 (1))
                1 var(r
                   ^ H;t+1 ) var(r   ^ F;t+1 )
          0:5                                   +
                        var(ert+1 (1))
         ^ (fHt+1 + fF t+1 ; ert+1 ) + 0:5 0 Et [(fHt+1 (1))2 + (fF t+1 (1))2 )] ert+1 (1)
        cov
                                                            0
                                 2 var(ert+1 (1))=(1          )
   The …rst-order component of the average portfolio share depends on time-
varying second moments, just as the …rst-order component of the di¤erence in
portfolio shares. But it also depends on the third-order component of the expected
excess return. This term did not show up in the di¤erence of portfolios since Home
  22
     The result that the expected second-order component is zero depends critically on the sym-
metry of the model. More generally it would be a non-zero constant term that is proportional to
 2
   .

                                              25
and Foreign agents respond in the same way to changes in expected returns. Note
however that ktA (1) is solved in the …rst step of the solution method, based asset
market clearing conditions. The expected excess return adjust to ensure that
agents are willing to hold the portfolio that clears asset markets. Therefore (34)
can be used to solve for the third-order component of the expected excess return
given the …rst-order solution ktA (1) and the …rst and second-order components of
rH;t+1 , rF;t+1 , pt +pt , fH;t+1 and fF;t+1 that are needed to compute the time-varying
second moments.


6      A numerical illustration
6.1     Parametrization
The implications of our simple model can be illustrated through a numerical exam-
ple. The parameterization we adopt is for illustrative purposes only, not to match
the data of any particular country. Various extensions of the model will need to
be introduced before it can be seriously confronted to the data.
    We assume a labor share of output, , of 0:7. Productivity shocks are assumed
to be highly persistent, with = 0:99, and productivity innovations have a stan-
dard deviation of = 5%. Turning to consumers’ preferences, we assume home
bias in preferences by setting    = 0:8. The elasticity of substitution between
Home and Foreign goods is set at = 2. The rate of relative risk-aversion, , is
set at 10 and = 1. Agents face a probability of death of = 0:05, leading to a
consumption-wealth ratio of 5%. The transaction cost on investing abroad, , is
set at 0:419%. These parameters generate a sizable home bias in equity holdings,
with the zero-order component of the fraction invested in domestic equity equal to
0.8.23 We illustrate the dynamic response to a one standard deviation increase in
Home productivity through nine charts.
  23
     This implies that agents invest 30% more in the domestic country than under perfect diver-
si…cation. Of this, there is a bias of +67% invested in the domestic country due to the …nancial
friction , a negative bias of -40% due to a negative correlation between the real exchange rate
and excess return (this is a foreign bias) and a positive home bias of +3% due to the hedge
against changes in expected portfolio returns.




                                              26
6.2    Real exchange rate and equity prices
Chart 1 illustrates the dynamic response of the relative price of the Foreign good.
The persistent increase in Home productivity boosts the supply of the Home good,
leading to an immediate 2:6% increase in the relative price of the Foreign good (a
Home real depreciation). This is followed by a gradual drop in the relative price
of the Foreign good (Home real appreciation) as the shock dissipates.
    Chart 2 shows the dynamic response of equity prices, depicting the Home equity
price in units of the Home good and the Foreign equity price in units of the Foreign
good. The persistent Home productivity shock immediately raises the Home equity
price by 4:7%. The Foreign equity price rises by a small 0:3% because the higher
productivity boosts wealth, some of which is invested in Foreign equity. While the
increase in Foreign equity prices is larger when expressed in Home goods (2:9%),
Home equity prices still increase by more on impact. Following the initial jump,
equity prices gradually drop back to their steady state, which implies a larger
expected drop in the Home equity price than in the Foreign equity price.


6.3    Financial positions
Chart 3 shows the dynamic response of gross external assets and liabilities of
the Home country, as well as its net external asset position. All are shown as a
fraction of the initial GDP. Gross positions change both as a result of valuation
e¤ects and capital ‡ows. It is therefore useful to view Chart 3 jointly with Chart
4, which shows net external assets along with the cumulative net capital out‡ows.
The initial response of both gross assets and liabilities is almost entirely due to
unexpected valuation e¤ects. Chart 4 shows that initial net capital out‡ows are
small in comparison. Gross liabilities rise due to the increase in the Home equity
price. Gross assets rise both as a result of the rise in the Foreign equity price (in
units of the Foreign good) and the large immediate real depreciation of the Home
currency. Overall the net external position becomes negative at 6:2% of GDP.
    After the initial shock gross liabilities drop much faster than gross assets and
soon the Home country becomes a net creditor. Chart 4 shows that this is driven
to a large extent by cumulative net capital out‡ows. On top of that the Home
country also receives fully expected valuation gains that increase its net external
position, re‡ecting the gradual fall in Home equity prices in Chart 2. This is
illustrated by the decreasing gap between cumulative capital out‡ows and the net

                                         27
external position in Chart 4.


6.4     Capital ‡ows
Chart 5 shows the dynamic response of both gross and net capital ‡ows as a
fraction of initial GDP. Positive gross capital out‡ows capture purchases of Foreign
equity by Home investors, while positive gross capital in‡ows capture purchases
of Home equity by Foreign investors. Net capital out‡ows measure the di¤erence
between gross out‡ows and in‡ows. Initially both capital in‡ows and out‡ows go
down, while subsequently they almost perfectly mirror each other. The theory can
therefore account both for periods of positive co-movements between in‡ows and
out‡ows and periods of negative co-movements.
    A …rst step towards understanding the drivers of capital ‡ows is to break them
down into portfolio growth and portfolio reallocation components, a breakdown
also emphasized by Kraay and Ventura (2000,2003).24 Without any changes in
portfolio shares, an increase in national savings leads to capital out‡ows equal
to the rise in national savings times the portfolio share of Foreign assets. This
portfolio growth represents the …rst source of capital ‡ows. The second source,
portfolio reallocation, is associated with an active reallocation of wealth across
assets. While it is related to a change in portfolio shares, it is important to realize
that changes in portfolio shares do not necessarily translate into capital ‡ows. In
particular, changing asset prices a¤ect portfolio shares without any asset trade, a
dimension that we refer to as the passive portfolio. Capital ‡ows associated with
portfolio reallocation re‡ect a change in portfolio shares away from this passive
portfolio.
    Charts 6 and 7 document the breakdown of gross capital out‡ows and in‡ows
into the portfolio reallocation and portfolio growth components. The shock leads
to a rise in Home savings and an o¤setting drop in Foreign savings. The portfolio
growth e¤ect then leads to positive capital out‡ows and negative capital in‡ows.
While this channel is not negligible under our parameterization, Charts 6 and 7
show that the portfolio reallocation e¤ect dominates the overall dynamics of gross
capital ‡ows. At the time of the shock, there is a retrenchment in that both Home
and Foreign investors reallocate their portfolios towards domestic assets, leading
  24
    A decomposition of capital ‡ows along this line is derived in the Technical Appendix based
on standard balance of payments accounting.


                                             28
to negative values for both capital in‡ows and out‡ows. In subsequent periods,
both Home and Foreign investors reallocate their portfolio towards Foreign equity,
which translates into positive capital out‡ows and negative capital in‡ows.
     The portfolio reallocation is further illustrated in Chart 8. It shows the portfolio
share invested in Home equity by both Home and Foreign investors, as well as
the passive portfolio share. Without any asset trade, the increase in Home equity
prices automatically boosts the value of investors’holdings of Home equity, thereby
raising the passive share of Home equity in all portfolios. Chart 8 shows that there
is a gap between the optimal Home and Foreign portfolio shares in the immediate
response to the shock. The Home portfolio share is higher than the passive portfolio
share, so that Home investors actively reallocate their portfolio towards Home
assets. In contrast, the Foreign portfolio share is lower than the passive portfolio
share, so that Foreign investors actively reallocate their portfolio towards Foreign
assets. This retrenchment towards domestic assets implies negative capital in‡ows
and out‡ows. After the initial shock the portfolio shares of both Home and Foreign
investors drop much faster than the passive portfolio share. This means that
both Home and Foreign investors actively reallocate their portfolio towards Foreign
assets, leading to positive capital out‡ows and negative capital in‡ows.
     Portfolio reallocation is a result of both changes in the expected excess re-
turn and time-varying second moments. In the immediate response to the shock,
changes in second moments in (33) have the biggest impact on gross capital ‡ows.
The volatility of the excess return increases, leading to a reduction in home bias
ktD (1). But this is more than o¤set by an increase in the covariance between the
excess return and the real exchange rate and between the excess return and the
hedging component fHt+1 fF t+1 , leading to increased home bias and therefore a
shift to domestic assets by both countries.
     The subsequent reallocation towards Foreign assets by investors from both
countries is mainly driven by changes in the expected excess return, which is shown
in Chart 9. Not all changes in expected excess return lead to capital ‡ows though,
and it is useful to break down the change in the expected excess return into three
components, as illustrated in Chart 9. Each of these components is associated with
a di¤erent source of change in demand or supply of assets. For each source, asset
demand and supply are brought to equilibrium through changes in the expected
excess return. The …rst component is associated with the increase in the relative
supply of Home equity following the increase in the relative price of Home equity. A

                                           29
rise in demand for Home equity is needed to clear asset markets, which is achieved
through a higher expected excess return. Since this change in expected returns
induces agents to hold the passive portfolio, it does not give rise to capital ‡ows.
    Second, changes in the second moments a¤ect the average portfolio share, as
shown in (34). In our example, this translates into a substantial shift of investors
towards Foreign assets. By contrast, the …rst-order component of relative equity
supply is not a¤ected by changes in second moments.25 The clearing of equity
markets requires that demand be brought back in line with supply. This is achieved
through a rise in the expected excess return on Home equity that undoes the shift
towards Foreign equity. This aspect does not lead to any capital ‡ows either. The
…rst two aspects therefore illustrate the need to be careful when linking capital
‡ows with changes in expected returns. Most of the changes in the expected
excess return are not related to capital ‡ows at all.
    Third, the rise in Home savings leads to an increase in demand for Home
equity due to the portfolio home bias. The expected excess return on Home equity
then needs to fall to clear equity markets. This leads to a portfolio reallocation
towards Foreign equity by investors from both countries, so that capital out‡ows
are positive and capital in‡ows are negative.26 This last component is therefore
the only one that is associated with capital ‡ows. Notice that it moves in opposite
direction from the overall expected excess return, which rises after the shock, again
illustrating the pitfalls in empirically linking capital ‡ows to changes in expected
returns.


6.5     Channels of external adjustment
Our setup allows us to explore the channels through which the net external position
of the Home country adjusts after the initial jump. Standard balance of payments
  25
      The relative equity supply depends exclusively on relative equity prices, which depends on
the …rst-order component of the expected present value of di¤erences in dividend payments and
is solved from the …rst-order component of model equations.
   26
      While we have abstracted from investment in the model, it plays a similar role. For example,
an increase in Home investment, holding everything else constant, raises the Home equity supply
and would lead to a rise in the expected excess return on Home equity, leading to net capital
in‡ows.




                                               30
accounting implies that
                         X
                         1
                           Et tbt+s (1)             X
                                                    1
                                                      Et (rF;t+s (1)    rH;t+s (1))
           nf at (1) =                    + GA(0)                                      (35)
                         s=1
                               R(0)s                s=1
                                                                R(0)s   1



where nf a is the net foreign asset position, tb is the trade balance and GA(0) is the
zero-order component of gross assets. (35) shows that a net external debt can be
…nanced by either expected future trade surpluses or by more favorable expected
future returns on external assets (Foreign equity) than external liabilities (Home
equity).
    As expected future excess returns are zero to the …rst-order, the net external
debt is simply equal to the present value of expected trade surpluses. The model
can therefore not account for empirical …ndings by Gourinchas and Rey (2006)
that net external debt is to some extent …nanced by di¤erences in expected returns.
Our …nding that …rst-order expected excess returns are zero is a standard arbitrage
condition found in virtually any asset pricing model, and can only be relaxed by
introducing elements that break the arbitrage across various assets.27
    While the expected excess return is zero to a …rst-order, it is nonetheless of
interest to look at its components. Di¤erences in expected returns are associated
with di¤erent expected dividend yields, di¤erent expected Home and Foreign equity
price changes and expected real exchange rate changes. Chart 10 breaks down
the components of net external adjustment. In the immediate response to the
shock the net external debt of the Home country reaches 6:2% of GDP, which is
…nanced entirely through expected future trade surpluses. As Home productivity
is persistently higher, the expected dividend yield is larger for Home than Foreign
equity. In present value terms this adds 2:1% to the external debt. After the shock,
the expected appreciation of the Home real exchange rate leads to a capital loss
on Home investors’holdings of Foreign equity, adding 5:1% to the external debt in
present value terms. Finally, the expected fall in Home equity prices, relative to
Foreign equity prices, translates into an expected capital loss for Foreign investors
on their holdings of Home equity which reduces the external debt of the Home
country by 7:2% in present value terms.
  27
    One example is Bacchetta and van Wincoop (2006), who introduce a portfolio decision mak-
ing cost (or asset management cost), leading to infrequent portfolio decisions.




                                             31
6.6    Welfare
The method can also be used to conduct welfare analysis, which requires the
second-order solution of the model. With portfolio choice this means combin-
ing the third-order component of portfolio Euler equations with the second-order
component of other model equations, the same step that is needed to compute
gross capital ‡ows. As an illustrative exercise we compute the impact of the …nan-
cial friction on the welfare of a representative investor, varying the friction from
0 to 0:5%. Welfare is measured by the value function (25). We assess how the
…nancial friction a¤ects the welfare for a given wealth Wt in a situation where
the state variables are equal to their zero-order component, so fH (S) = 0. Wel-
fare then depends only on the constant v, which is a¤ected by the second-order
component of the …nancial friction that we compute from the second step of the
solution algorithm.
    The welfare loss is reported in Chart 11, expressed in terms of the percentage
drop in wealth that leads to an equal welfare loss. The welfare loss rises to about
1:2% when = 0:4% as in the benchmark parameterization. In addition, the loss
is concave in . When gets close to 0:5%, the portfolio approaches full home
bias with investors holding only domestic equity. With little exposure to foreign
equity, investors are little a¤ected by further changes in the …nancial friction.


7     Conclusion
We have developed a method for solving DSGE open-economy models of portfolio
choice with the aim of better understanding the nature of international capital
‡ows. The method has the advantage that it closely connects to existing …rst and
second-order solution methods of DSGE models, while giving special treatment to
optimality conditions for portfolio choice. It highlights the need to go to higher
orders of these optimality conditions to solve for zero and …rst-order components
of the portfolio allocation and therefore capital ‡ows.
    The method also has the advantage that it can be broadly applied. The sim-
ple two-country, two-asset, two-good example discussed in the paper illustrates
what we can learn from such models. The next natural step is to extend this
framework by introducing consumption and investment decisions. Other natural
extensions are to introduce monetary elements through price rigidities, …scal policy


                                        32
and additional assets. A potentially rewarding strategy may also be to introduce
information asymmetries as in the noisy rational expectations literature in …nance.
All these extension will put us in a better position to confront the model to data
on gross and net capital ‡ows, analyze policy questions related to capital ‡ows,
and make meaningful predictions related to the external adjustment process faced
by countries with large external imbalances like the United States.




                                        33
                                             Appendix

A     Equations of the model
As discussed at the beginning of section 4, the model can be summarized by 11
equations. Writing variables other than portfolio shares in logarithmic form these
equations are

         aH;t+1 = aH;t +             H;t+1                                                                      (36)
         aF;t+1 = aF;t +             F;t+1                                                                      (37)
          wt+1 +pt+1                        H rH;t+1                   H
         e             = (1            )   kH;t e         + (1        kH;t )erF;t+1       wt +pt
                                                                                          e         +
                                aH;t+1
                            e                                                                                   (38)
         ewt+1 +pt+1 = (1                 F
                                       ) kH;t erH;t+1 + (1             F
                                                                      kH;t )erF;t+1 ewt +pt +
                            epF t+1 +aF;t+1                                                                     (39)
         eaH;t =        ewt +   pt
                                     + (1          ) ewt +       pt
                                                                                                                (40)
         eqH;t = (1            H wt +pt
                            ) kH;t e       F
                                        + kH;t ewt +pt                                                          (41)
         eqF;t = (1           H wt +pt
                           ) kF;t e       F wt +pt
                                       + kF;t e                                                                 (42)
                                                          p;H
         Et (1          )ev+fH (St+1 ) +            e    rt+1
                                                                  erH;t+1       erF;t+1       ept   pt+1
                                                                                                           =0   (43)
                                                          p;F
         Et (1          )ev+fF (St+1 ) +            E    rt+1
                                                                  erH;t+1          erF;t+1 ept      pt+1
                                                                                                           = 0 (44)
                                                                                  p;H
          v+fH (St )                              v+fH (St+1 )             (1   )rt+1
         e             = Et (1               )e                  +     e                                        (45)
                                                                                  p;F
          v+fF (St )                          v+fF (St+1 )              (1      )rt+1
         e             = Et (1               )e                  +     e                                        (46)

(36) and (37) are the autoregressive processes for productivity. (38)-(39) are the
wealth dynamics in the Home and Foreign countries. (40) is the Home goods
market clearing condition (we can omit the Foreign goods market clearing condition
due to Walras’s law). (41)-(42) are the market clearing conditions for Home and
Foreign equities. (43)-(44) are the optimal portfolio conditions for Home and
Foreign investors. Finally, (45)-(46) are the Bellman equations for Home and
Foreign investors.
   These equations depend on consumer price indices, asset and portfolio returns,




                                                        34
which in logarithmic form can be written as

                       e(1     )pt
                                     =       + (1         ) e(1      )pF t
                                                                                                                        (47)
                        (1     )pt                             (1   )pF t
                       e             = (1           )+ e                                                                (48)
                       erH;t+1 = eqH;t+1          qH;t
                                                         + (1          )eaH;t+1     qH;t
                                                                                                                        (49)
                       erF;t+1 = eqF;t+1          qF;t
                                                         + (1         )epF t+1 +aF;t+1        qF;t
                                                                                                                        (50)
                         p;H
                        rt+1      H rH;t+1                           H
                       e       = kH;t e    + (1                     kH;t )erF;t+1            ept   pt+1
                                                                                                                        (51)
                         p;F
                        rt+1      F
                       e       = kH;t erH;t+1             + (1         F
                                                                      kH;t )erF;t+1 ept              pt+1
                                                                                                                        (52)

(47)-(48) de…ne the consumer prices indexes. (49)-(50) de…ne the rates of return
on Home and Foreign equity. Finally, (51)-(52) de…ne the rates of return on the
portfolios of Home and Foreign investors.


B        Expansions of the Bellman equation
The elements of the Bellmann equation for the Home investor (45) are solved by
taking a second-order expansion around S = 0. The resulting expression contains
both …rst- and second-order components. The …rst-order components are:
                                         0                                                                    p;H
    v (1) + H1;H St (1) = (1                 ) [v (1) + H1;H Et St+1 (1)] + Et (1                           )rt+1 (1)   (53)

where v (1) is the …rst-order component of v and H1;H is a 1x3 vector with the …rst
derivative of fH (S), evaluated at S = 0. 0 is a transformation of the probability
of death : 0 = 1        (1     )R(0)1 . (53) is solved by v (1) = 0 and:
                                                                             0           1
                             H1;H = (1              )rs (I3         (1           )N1 )

where rs is a 1x3 matrix taken from the …rst-order solution of the portfolio return
                                   p;H
for the Home investor from (29): rt+1  (1) = rs St+1 (1), I3 is a 3x3 identity matrix
and N1 is the 3x3 matrix from (29).
    The second-order components of (45) are:
                         1
     H1;H St (2) +          [H1;H St (1)]2 + 2v (2) + St (1)0 H2;H St (1) =              (54)
                         2
                                                               0   h               i2
                0                                  p;H                      p;H
     (1           ) H1;H Et St+1 (2) + (1     )Et rt+1 (2) + Et (1        )rt+1 (1) +
                                                              2
     1        0       h                                  i2
                Et H1;H St+1 (1) + (1            p;H
                                               )rt+1 (1) + 2v (2) + St+1 (1)0 H2;H St+1 (1)
          2

                                                          35
where v (2) is the second-order component of v and H2;H is a 3x3 matrix with the
second derivative of fH (S), evaluated at S = 0.
    (54) entails cross-products of the …rst-order components of the state variables,
                                        p;H
St+1 (1), and the portfolio return, rt+1    (1). These terms are taken from the …rst-
order solution (29). (54) also includes the second-order components of the state
variables, St+1 (2), which are taken from (32), as well as the second-order compo-
                                                   p;H
nent of the expected the portfolio return, Et rt+1     (2), which takes a form similar to
(31):
                         p;H
                     Et rt+1 (2) = rs St (2) + St (1)0 rss St (1) + r^ 2             (55)
where rss is a 3x3 matrix and r^ is a scalar.
                                                                  p;H             p;H
    We use (54), along with the solution for St+1 (1), St+1 (2), rt+1 (1) and Et rt+1 (2)
                   28                  vec
to solve for H2;H . The 9x1 vector H2;H is the "vectorized" form of the 3x3 matrix
                                                   vec
H2;H . Speci…cally, the …rst three elements of H2;H     are the …rst row of H2;H , the
next three elements are the second row of H2;H and the last three elements are the
                      vec
third row of H2;H . H2;H  is solved from (54) as:

                                       vec
                                      H2;H = (I9      (1      0    ^ ) 1 H vec
                                                                  )N      3


where I9 is a 9x9 identity matrix. N^ is a 9x9 matrix that consists of cross-products
of various elements of the N1 matrix from (29). The 9x1 vector H3vec is the "vec-
torized" form of a 3x3 matrix H3 . The matrix H3 includes cross-products of the
matrices H1;H and rs , as well as the matrix rss in the second-order component of
the expected portfolio return (55), speci…cally:

                         0                                                       0
            H3 =        H1;H H1;H + 2F1 + 2(1                )rss + (1               )N10 H1;H
                                                                                           0
                                                                                               H1;H N1
                                      0
                      +2(1                )(1    )N10 H1;H
                                                       0
                                                           rs + (1        )2 rs0 rs
                                      X
                                      3
                              0
            F1 = (1               )         H1;H (v)N3;v
                                      v=1

where H1;H (v) is the v’th element of the 1x3 vector H1;H and the 3x3 matrices
N3;v are the same as in (32).
   The corresponding matrices for the Foreign investor, H1;F and H2;F , are com-
puted analogously.
  28
       We also solve for v (2), but this element does not a¤ect portfolio choice.




                                                       36
C     First-order di¤erence in portfolio shares
The solution of the …rst-order component of the portfolio share di¤erence ktD relies
on the third-order components of the optimal portfolio conditions (43)-(44). The
expansion of the condition for the Home investor (43) leads to:

                                     A                      A
      Et ert+1 (3) + Et ert+1 (1) rt+1  (2) + Et ert+1 (2) rt+1 (1)                (56)
                     h                                                    i
                             0                 p;H
      +Et ert+1 (1) (1         )fHt+1 (2)     rt+1  (2) + pt (2) pt+1 (2)
                     h                                                    i
                             0                 p;H
      +Et ert+1 (2) (1         )fHt+1 (1)     rt+1 (1) + pt (1) pt+1 (1)
             h                                                              i
               A                 0                 p;H
      + Et rt+1    (1) + (1        )fHt+1 (1)     rt+1 (1) + pt (1) pt+1 (1) + O3 = 0

                                           A
where ert+1 (i) = rH;t+1 (i) rF;t+1 (i), rt+1  (i) = 0:5 [rH;t+1 (i) + rF;t+1 (i)], and
   is second-order. The …rst term in (56) is the third-order component of the
expected excess return. The next two terms are the third-order components of
the cross-product between excess returns and the average return, and consists of
products of …rst- and second-order terms. Similarly, the fourth and …fth terms are
the third-order components of the cross-product between excess returns and the
pricing kernel. The sixth term re‡ects the friction in investing abroad, . The last
term in (56) consists of cubic-products of …rst-order elements:
          1
 O3 =       Et (rH;t+1 (1))3 (rF;t+1 (1))3
          6 h                                                      i
                       0                  p;H                         A
          +Et (1         )fHt+1 (1)      rt+1 (1) + pt (1) pt+1 (1) rt+1 (1) ert+1 (1)
            1              h                                         i 2
                    0                       p;H
          + (1        )Et fHt+1 (1)        rt+1 (1) + pt (1) pt+1 (1) ert+1 (1)
            2
            1 0 h         p;H
                                                     i2
          +    Et       rt+1  (1) + pt (1) pt+1 (1) ert+1 (1)
            2
  The various components of O3 are solved using the …rst-order solution (29).
We can show that the resulting expression is:
                                            0            0
                                                (1           )
             O3 = 2rDE BH AH     2
                                     St +                        Et [fHt+1 (1)]2 ert+1 (1)
                                                     2
where AH is a 1x3 vector and rDE and BH are scalars. rDE re‡ects the sensitivity
of the …rst-order excess return to innovations:

                                                                 D
                                 ert+1 (1) = rDE                 t+1



                                                37
where Dt+1 = H;t+1      F;t+1 . AH and BH re‡ect the …rst-order solution of a
                                           A
combination of the average rate of return rt+1 (1) and the pricing kernel:
 A                  0                                   p;H                                                   D            A
rt+1 + (1               )fHt+1 (1)                     rt+1 (1) + pt (1)        pt+1 (1) = AH St + BH         t+1   + CH   t+1


where CH is a scalar and A
                         t+1 = 0:5 ( H;t+1 + F;t+1 ).
   We undertake similar steps using the condition for the Foreign investor (44).
Taking the di¤erence between (56) and its equivalent for the Foreign investor, we
write:
       0            0
           (1           )
                Et [fHt+1 (1)]2 [fF t+1 (1)]2 ) ert+1 (1)                                                                  (57)
                2  "                                                                                                  #
                           0                                p;H      p;F
                     (1      ) [fHt+1 (2) fF t+1 (2)]      rt+1 (2) rt+1 (2)
     +Et ert+1 (1)
                             + (pt (2) pt (2))     pt+1 (2) pt+1 (2)
                   "                                                                                                  #
                           0                                p;H      p;F
                     (1      ) [fHt+1 (1) fF t+1 (1)]      rt+1 (1) rt+1 (1)
     +Et ert+1 (2)                                                                                                        =0
                             + (pt (1) pt (1))     pt+1 (1) pt+1 (1)

   The …rst-order component of the di¤erence in portfolio shares, ktD (1), enters
(57) through the second-order components of the portfolio returns. Taking the
second-order components of (51)-(52) leads to:
                             p;H                       p;F
                            rt+1 (2)                  rt+1 (2) = k D (0)ert+1 (2) + (pt (2)         pt (2))
                                     pt+1 (2)             pt+1 (2) + ktD (1) ert+1 (1)

Similarly, taking the …rst-order component of (51)-(52) leads to:
    p;H              p;F
   rt+1 (1)         rt+1 (1) = k D (0)ert+1 (1) + (pt (1)                           pt (1))      pt+1 (1)      pt+1 (1)

Using this result, (57) becomes:
                            0                0
                                (1               )
                                                     Et [fHt+1 (1)]2        [fF t+1 (1)]2 ) ert+1 (1)
                                     2
                                         0
                        +(1                  )cov
                                               ^ (fHt+1          fF t+1 ; ert+1 )        k D (0)v^
                                                                                                 ar(ert+1 )
                        +(               1) cov(p
                                             ^ t+1             pt+1 ; ert+1 )        ktD (1) var(ert+1 ) = 0               (58)

where cov
        ^ (xt+1 ; yt+1 ) = Et xt+1 (1) yt+1 (2) + Et xt+1 (2) yt+1 (1) and var
                                                                            ^ (xt+1 ) =
                                                  2
 ^ (xt+1 ; xt+1 ) and var(ert+1 ) = Et [ert+1 (1)] . (33) follows simply from (58).
cov
    The elements of (58) are computed by using the …rst-order solution (29), the
second-order dynamics of the state variables, (32), and the second-order solution

                                                                       38
for the control variables, which are of the form of (31). For instance, the excess
returns are:
                 ert+1 (1) = r0 t+1       ert+1 (2) = St (1)0 M t+1
                                                                   0
where r0 is a 1x2 vector,         t+1   =[       H;t+1 ; F;t+1 ]       and M is a 3x2 matrix. Using these
expression, we write:

                 ar(ert+1 ) = 2Et ert+1 (1) ert+1 (2) = 2 2 r0 M 0 St (1)
                v^                                                                                        (59)

(59) shows that the third-order components of the variances and covariances in (58)
re‡ect the second-order variance of the innovations, 2 , along with the …rst-order
state variables, St (1). Solving for all the third-order components of the variances
and covariances in (58) along similar lines we compute the …rst-order di¤erence in
portfolio shares as a function of the …rst-order components of state variables:

                                             ktD (1) = ks St (1)

where ks is a 1x3 vector.
   Taking the average of (56) and its equivalent for the Foreign investor, we write:
                           1 0         0
       0 = Et ert+1 (3) +      (1        )Et fH;t+1 (1)2 + fF;t+1 (1)2 ert+1 (1)
                  "        4                                                   #
                                     A             0 1
                            ert+1 ; rt+1  + (1      ) 2 [fHt+1 + fF t+1 ]
           +cov
              ^ t        1    p;H     p;F
                         2
                             rt+1 + rt+1    + 12 (pt pt ) 12 pt+1 + pt+1

Using the …rst- and second-order components of (51)-(52) this becomes:
                                    1   0             0
       0 = Et ert+1 (3) +                   (1            )Et fH;t+1 (1)2 + fF;t+1 (1)2 ert+1 (1)
                                    4
                       1
              +            cov
                            ^ t pt+1 + pt+1 ; ert+1 ;
                   2
                       1
                           Et [2rH;t+1 (1)rH;t+1 (2)                   2rF;t+1 (1)rF;t+1 (2)]
                   2
               1
              + (1           0
                                 )cov
                                   ^ t (fHt+1 + fF t+1 ; ert+1 )                 ktA (1)Et (ert+1 (1))2
               2
where we used the fact that Et (ert+1 (1))3 = 0. (34) follows from a simple re-
arrangement of terms.




                                                           39
References
 [1] Albuquerque, Rui, Gregory H. Bauer and Martin Schneider (2006), “Global
     Private Information in International Equity Markets, ”working paper, New
     York University.

 [2] Bacchetta, Philippe and Eric van Wincoop (2006), “Incomplete Information
     Processing: A Solution to the Forward Discount Puzzle,”working paper, Uni-
     versity of Virginia.

 [3] Brennan, Michael J. and H. Henry Cao (1997), “International Portfolio In-
     vestment Flows,”The Journal of Finance 52, 1851-1880.

 [4] Caballero, Ricardo, Emmanuel Farhi, and Pierre-Olivier Gourinchas (2006),
     “An Equilibrium Model of “Global Imbalances””, mimeo, University of Cali-
     fornia, Berkeley.

 [5] Coeurdacier, Nicolas (2005), “Do Trade Costs in Goods Markets Lead to
     Home Bias in Equities?,”working paper.

 [6] Coeurdacier, Nicolas and Stephane Guibaud (2005), “A Dynamic Equilibrium
     Model of Imperfectly Integrated Financial Markets,”working paper.

 [7] Devereux, Michael B. and Alan Sutherland (2006a), “Solving for Country
     Portfolios in Open Economy Macro Models, ” working paper, University of
     British Columbia.

 [8] Devereux, Michael B. and Alan Sutherland (2006b), “Monetary Policy Rules
     and International Portfolio Choice, ” working paper, University of British
     Columbia.

 [9] Devereux, Michael B. and Alan Sutherland (2006c), “Country Portfolio Dy-
     namics, ”working paper, University of British Columbia.

[10] Engel, Charles and Akito Matsumoto (2005), “Portfolio Choice and Home
     Bias in Equities in a Monetary Open-Economy DSGE Model,”working paper,
     University of Wisconsin.




                                      40
[11] Engel, Charles and John Rogers (2006), “The U.S. Current Account De…cit
     and the Expected Share of World Output,” forthcoming in Carnegie-
     Rochester Conference Series on Public Policy.

[12] Evans, Martin D.D. and Viktoria Hnatkovska (2005), “International Capital
     Flows, Returns and World Financial Integration,”working paper, Georgetown
     University.

[13] Evans, Martin D.D. and Viktoria Hnatkovska (2006a), “Solving General Equi-
     librium Models with Incomplete Markets and Many Assets,” working paper,
     Georgetown University.

[14] Evans, Martin D.D. and Viktoria Hnatkovska (2006b), “Financial Integration,
     Macroeconomic Volatility and Welfare,” working paper, Georgetown Univer-
     sity.

[15] Gourinchas, Pierre Olivier (2006), “The Research Agenda: Pierre-Olivier
     Gourinchas on Global Imbalances and Financial Factors,” Review of Eco-
     nomic Dynamics Newsletter, April.

[16] Gourinchas, Pierre Olivier and Helene Rey (2006), “International Financial
     Adjustment,”working paper, UC Berkeley and Princeton University.

[17] Heathcote, Jonathan and Fabrizio Perri (2005), “The International Diversi…-
     cation Puzzle is Not as bad as You Think,” working paper, NYU Stern and
     Georgetown University.

[18] Hnatkovska, Viktoria (2006), “Home Bias and High Turnover: Dynamic Port-
     folio Choice with Incomplete Markets,” working paper, University of British
     Columbia.

[19] Judd, Kenneth L. and Sy-Ming Guu (2000), “Asymptotic Methods for Asset
     Market Equilibrium Analysis,”Economic Theory 18, 127-157.

[20] Kim, Jinill, Sunghyun Kim, Ernst Schaumburg and Christopher A. Sims
     (2003), “Calulating and Using Second Order Accurate Solutions of Discrete
     Time Dynamic Equilibrium Models,”working paper.

[21] Kollman, Robert (2006), “International Portfolio Equilibrium and the Current
     Account,”mimeo, University of Paris XII.

                                       41
[22] Kraay, Aart and Jaume Ventura (2000), “Current Accounts in Debtor and
     Creditor Countries,”Quarterly Journal of Economics XCV, 1137-1166.

[23] Kraay, Aart and Jaume Ventura (2003), “Current Accounts in the Long and
     Short Run,”NBER Macro Annual 2002.

[24] Lane, Philip and Gian Maria Milesi-Ferretti (2005), “A Global Perspective on
     External Positions,”IIIS Discussion Paper 79.

[25] Lombardo, Giovanni and Alan Sutherland (2005), “Computing Second-Order-
     Accurate Solutions for rational Expectations Models using Linear Solution
     Methods

[26] Martin, Philippe and Helene Rey (2004), “Financial Super-Markets: Size Mat-
     ters for Asset Trade,”Journal of International Economics, 64(2), 335-361.

[27] Obstfeld, Maurice (2004), “External Adjustment,” Review of World Eco-
     nomics, 140(4), 541-568.

[28] Obstfeld, Maurice and Kenneth Rogo¤ (1996), “Foundations of International
     Macroeconomics,”Cambridge, MA: MIT Press.

[29] Obstfeld, Maurice and Kenneth Rogo¤ (2000), “The Six Major Puzzles in
     International Macroeconomics: Is There a Common Cause?,” NBER Macro-
     economics Annual 2000, 339-390.

[30] Obstfeld, Maurice and Kenneth Rogo¤ (2005), “Global Current Account Im-
     balances and Exchange Rate Adjustments,” working paper, Harvard Univer-
     sity.

[31] Schmitt-Grohe, Stephanie and Martin Uribe (2004), “Solving Dynamic Gen-
     eral Equilibrium Models Using Second-Order Approximation to the Policy
     Function,”Journal of Economic Dynamics and Control, 27, 755-775.

[32] Tille, Cedric (2005), “Financial Integration and the Wealth E¤ect of Exchange
     Rate Fluctuations,”Federal Reserve Bank of New York Sta¤ Report 226.




                                       42
                        Chart 1: Relative price of the Foreign good*

3.0%


2.5%


2.0%


1.5%


1.0%


0.5%


0.0%
         0              50             100            150        200            250          300
* Impulse response of the relative price of the Foreign good to a 5% increase in Home
productivity. An increase in the relative price of the Foreign good corresponds to a real
depreciation for the Home country.



                                       Chart 2: Equity prices*
5%



4%


                               Home equity price
3%                          (in units of Home good)


2%



1%
                Foreign equity price
             (in units of Foreign good)

0%
     0                 50             100             150       200             250          300

* Impulse response after a 5% increase in Home productivity. In terms of the notation in the text
the lines represent qH and qF-pF.
                                                     Chart 3: International assets and liabilities*
                                   20%

                                               Gross liabilities of the Home country
                                   15%
 Percent of steady state GDP




                                                             Gross assets of the Home country
                                   10%


                                    5%


                                    0%
                                          0             50            100              150       200            250   300
                                                Net assets of the Home country
                                   -5%


                                   -10%
                *Impulse response after a 5% increase in Home productivity.The gross assets of the Home
                country are the gross liabilities of the Foreign country.




                                              Chart 4: Net assets and cumulative net capital outflows*
                                   12%

                                   10%                                         Cumulative net capital outlows
                                    8%
     Percent of steady state GDP




                                    6%

                                    4%                 Net assets of the Home country

                                    2%

                                    0%
                                          0             50            100              150       200            250   300
                                   -2%

                                   -4%

                                   -6%

                                   -8%

* Impulse response after a 5% increase in Home productivity. The 'cumulative net capital
outflows' line at period t denotes the sum of net capital outflows from Home to Foreign between
period zero and period t.
                                            Chart 5: Gross and net capital flows*
                                0.6%


                                0.4%
                                                                 Net outflows
  Percent of steady state GDP




                                0.2%
                                            Gross outflows

                                0.0%
                                        0   5           10            15        20   25       30
                                -0.2%
                                                      Gross inflows

                                -0.4%


                                -0.6%


      -0.8%
* Impulse response after a 5% increase in Home productivity. Positive values for gross outflows
indicate a purchase of Foreign equity by Home investors. Positive values for gross intflows
indicate a purchase of Home equity by Foreign investors.
                                            Chart 6: Breakdown of gross capital outflows*
                                0.3%
                                                            Outflows due to portfolio reallocation
                                                                          growth
                                0.2%
                                                                                                Total outflows
  Percent of steady state GDP




                                0.1%

                                0.0%
                                        0        5               10             15            20             25         30
                                -0.1%
                                                     Outflows due to portfolio growth

                                -0.2%

                                -0.3%

                                -0.4%

                                -0.5%
* Portfolio reallocation indicates capital outflows due to active reallocation towards Foreign equity.
Portfolio growth indicates capital outflows due to increased saving, allocated across assets at
steady state portfolio shares.



                                            Chart 7: Breakdown of gross capital inflows*
                                0.0%
                                        0        5               10             15            20              25        30
                                -0.1%
                                                                                           Total inflows
  Percent of steady state GDP




                                -0.2%

                                                                                Inflows due to portfolio reallocation
                                -0.3%

                                -0.4%
                                                       Inflows due to portfolio growth

                                -0.5%

                                -0.6%

                                -0.7%

                                -0.8%

* Portfolio reallocation indicates inflows due to reallocation towards Home equity. Portfolio growth
indicates inflows due to increased saving, allocated at steady state portfolio shares. Both are negative
as Foreign saving drops and the portfolio is reallocated to Foreign equity.
                               Chart 8: Share of Home equity in portfolio*

                    0.3%
                                                                   Passive portfolio share
  Share of wealth




                    0.2%                                       Home investors



                                           Foreign investors
                    0.1%




                    0.0%
                           0      5         10           15       20            25           30
* Impulse response after a 5% increase in Home productivity. The chart shows the change in the
share invested in Home equity. The passive portfolio share reflects the direct impact of
movements in equity prices (the change in the portfolio share without equity trade).
                            Chart 9: Expected excess return


  0.006%                 Expected excess return




  0.004%         Due to changes
                 in second moments


  0.002%                                                Due to passive portfolio




  0.000%
           0            5             10           15            20            25              30
                  Due to savings

 -0.002%

* Impulse response after a 5% increase in Home productivity. The chart shows the third-order
expected excess return on Home equity, relative to Foreign equity. The component due to
passive portfolio shows the expected excess return needed to induce investors to hold the
passive portfolio. The component due to changes in second moments is the expected excess
return needed to undo the demand shift toward Foreign equity driven by changing second
moments. The component due to savings shows the reduction in the expected excess return
needed to offset the demand shift driven by the higher savings of Home investors.
           Chart 10: External adjustment channel: net present values*
  8%                                                                                  7.2%
             6.2%              6.2%
  6%

  4%

  2%

  0%

 -2%
                                                 -2.1%
 -4%

 -6%                                                              -5.1%
       Net external debt   Trade balance      Net dividend     Exchange rate      Equity prices
                                                income           valuation         valuation


* Changes after 5% increase in Home productivity. All values are measured at the end of the
period when the shock occurs, after any initial jump in response to the shock. The 'net external
debt' column indicates the value of the Home net external debt as a fraction of GDP. The 'trade
balance' column is the net present value of expected future trade surpluses of the Home country.
The 'net dividend income' column is the present value of expected net dividend income of the
Home country (negative value=expected positive net dividend payments to Foreign country). The
'exchange rate valuation' column is the present value of expected future valuation gains due to a
real depreciation of Home currency (negative value=valuation losses due to expected real
appreciation). The 'equity prices valuation' column is the net present value of expected future
valuation gains due to equity price changes.
                    Chart 11: Welfare loss from financial friction

 1.4%

 1.2%

 1.0%

 0.8%

 0.6%

 0.4%

 0.2%

 0.0%
     0.0%            0.1%            0.2%              0.3%          0.4%            0.5%
                                            Financial friction t


* The chart shows the welfare loss from the financial friction t, measured in terms of the
percentage loss in wealth that leads to an identical drop in utility
