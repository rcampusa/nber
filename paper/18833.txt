                               NBER WORKING PAPER SERIES




  ESTIMATING THE IMPACT OF MEANS-TESTED SUBSIDIES UNDER TREATMENT
      EXTERNALITIES WITH APPLICATION TO ANTI-MALARIAL BEDNETS

                                      Debopam Bhattacharya
                                         Pascaline Dupas
                                          Shin Kanaya

                                       Working Paper 18833
                               http://www.nber.org/papers/w18833


                     NATIONAL BUREAU OF ECONOMIC RESEARCH
                              1050 Massachusetts Avenue
                                Cambridge, MA 02138
                                    February 2013




Bhattacharya gratefully acknowledges financial support from the Leverhulme Trusts for partly funding
this project. The dataset used in the application was collected through an earlier project funded by
the Acumen Fund, the Adessium Foundation and the Exxon Mobil Foundation. The Olyset® nets
used in the study were donated by the manufacturer Sumitomo Chemical. The views expressed herein
are those of the authors and do not necessarily reflect the views of the National Bureau of Economic
Research.

NBER working papers are circulated for discussion and comment purposes. They have not been peer-
reviewed or been subject to the review by the NBER Board of Directors that accompanies official
NBER publications.

© 2013 by Debopam Bhattacharya, Pascaline Dupas, and Shin Kanaya. All rights reserved. Short sections
of text, not to exceed two paragraphs, may be quoted without explicit permission provided that full
credit, including © notice, is given to the source.
Estimating the Impact of Means-tested Subsidies under Treatment Externalities with Application
to Anti-Malarial Bednets
Debopam Bhattacharya, Pascaline Dupas, and Shin Kanaya
NBER Working Paper No. 18833
February 2013
JEL No. C01,H23,H4,H51,I38,O1

                                                 ABSTRACT

Regular use of effective health-products such as insecticide-treated mosquito nets (ITN) by a household
benefits its neighbors by (a) reducing chances of infection and (b) raising awareness about product-effectiveness,
thereby increasing product-use. Due to their potential social benefits and high purchase price, causing
free-riding and sub-optimal private procurement, such products may be subsidized in developing countries
through means-testing. Owing to associated spillover effects, cost-benefit analysis of such subsidies
requires modelling behavioral responses of both the subsidized household and its neighbors. Using
experimental data from Kenya where subsidies were randomized, coupled with GPS-based location
information, we show how to estimate aggregate ITN use resulting from means-tested subsidies in
the presence of such spatial spillovers. Accounting for spillovers introduces infinite-dimensional estimated
regressors corresponding to continuously distributed location coordinates and makes the inference
problem novel. We show that even if individual ITN use unambiguously increases with increasing
incidence of subsidy in the neighborhood, ignoring spillovers may over- or under-predict overall ITN
use resulting from a specific targeting rule, depending on the resulting aggregate incidence of subsidy.
Applying our method to the Kenyan data, we find that (i) individual ITN use rises with neighborhood
subsidy-rates, (ii) under means-testing, predicted ITN use is a convex increasing function of the subsidy
incidence and (iii) ignoring spillovers implies a nearly-linear increasing relationship leading to over-estimation
of ITN use at lower and under-estimation at higher subsidy rates.


Debopam Bhattacharya                                    Shin Kanaya
Department of Economics                                 Aarhus University
Oxford University                                       Department of Economics and Business
Manor Road Building                                     Fuglesangs Allé 4
Oxford OX1 3UQ                                          building 2628, room 310
debopam.bhattacharya@st-hildas.ox.ac.uk                 8210 Aarhus V
                                                        Denmark
Pascaline Dupas                                         skanaya@creates.au.dk
Department of Economics
Stanford University
579 Serra Mall
Stanford, CA 94305-6072
and NBER
pdupas@stanford.edu
1    Introduction

An important goal of statistical policy analysis is to estimate the distribution of outcomes that
would result from targeted policy-interventions in society. These estimates can then be fed into
the formulation of eﬀective targeting rules. The formal analysis of such "treatment assignment"
problems was pioneered by Manski (2004, 2007) and subsequently extended and expanded by other
researchers. This line of research has assumed that the treatment is individual-specific and does not
produce any externalities for other, untreated individuals. However, in several field experiments in
a variety of contexts, it has been demonstrated empirically that providing a certain treatment to
an individual household has significant spillover eﬀects on other untreated households who reside
in its vicinity. These spillovers can be either behavioral, i.e., where the behavior of the untreated
household is aﬀected by the neighbors’ treatment, or mechanical, i.e., where the outcome of un-
treated households but not its behavior is aﬀected by the neighbors’ treatment. For example, in
epidemiological studies on infectious diseases, the neighborhood incidence of vaccination has been
shown to be an eﬀective disease-deterrent beyond one’s own vaccination status (see Root et al.,
2011, on cholera vaccines in Bangladesh). Likewise, households in sub-Saharan Africa living within
the vicinity of a village with high coverage of insecticide-treated bednets (ITN) are significantly
less likely to get malaria (see Hawley et al., 2004). In Kenya, students attending schools where
the majority of children underwent intestinal worm infection treatment as well as children living
within 3 kilometers of a school where the majority of students were dewormed experienced sig-
nificant health-gains, despite not getting the treatment themselves (Miguel and Kremer, 2004).
In economic contexts, Angelucci and De Giorgi (2009) have shown that means-tested cash trans-
fers create behavioral spillovers on ineligible households. On the other hand, Bandiera and Rasul
(2006) demonstrated that farmers strategically delay the time they adopt a recommended farming
technology in order to free ride on the knowledge generated by those in their neighborhood who
experiment before them. In the context of ITN subsidies, Dupas (2012) has recently shown that the
incidence of subsidies in the neighborhood has an independent eﬀect on a household’s decision to
purchase and use an ITN over and above the eﬀect brought about by the household’s own receipt
or non-receipt of a subsidy. The presence of such externalities and the high private procurement
costs relative to earnings for these technologies and products typically lead to socially sub-optimal
levels of private investment in them and creates a case for subsidizing them, at least for the poorest
and most vulnerable sections of society.




                                                  2
       The purpose of the present paper is to develop a method for estimating the predicted aggregate
eﬀect of a given subsidy-targeting rule, taking into account the spillover eﬀects that one house-
hold’s subsidization has on neighboring households’ outcomes; and to estimate the error incurred
in prediction due to ignoring the spillovers. A key requirement of the method we propose is the
availability of data to estimate the magnitude and shape of spillovers. In our application, we ex-
ploit data from a randomized field experiment (discussed in Dupas, 2009) in which a subsidy for
antimalarial bed nets was randomly assigned across Kenyan households. Randomized program
assignment, which has become common practice among applied microeconomists, yields exogenous
variation in individual treatment status. More importantly, for small enough neighborhoods, it also
yields exogenous variation in neighborhood treatment rates. We propose a method for estimating
own-treatment and indirect-treatment (spillover) eﬀects from such experimental variation and for
using these estimates to predict the eﬀects of means-tested subsidization on aggregate product-
procurement. It is important to note that here we do not aim to identify "social interaction" type
behavioral eﬀects which capture the impact of neighborhood product-use on a household’s own
product use. Instead, the key ingredient of our analysis is the more direct policy-relevant impact
of subsidizing neighborhood households on a household’s own product-use — both when it receives
and when it does not receive the subsidy itself.1
       The key methodological innovation in our cost-benefit analysis is the incorporation of neighbor-
hood eﬀects where neighborhoods are defined via physical distance obtained through GPS location
coordinates of households. Even when individual household responses are modeled via paramet-
ric models, incorporating such neighborhood eﬀects introduces infinite-dimensional estimated re-
gressors corresponding to continuously distributed location coordinates. This makes the inference
problem non-trivial and novel. To solve this problem, we establish an appropriate Hadamard diﬀer-
entiability result which, coupled with a functional central limit theorem, establishes the necessary
limiting distribution result. We further establish consistency of the nonparametric bootstrap in
approximating this limiting distribution, thereby giving practitioners a user-friendly method for
calculating confidence intervals for the parameters of interest. Proving bootstrap validity is non-
trivial in this problem, because here one needs to prove bootstrap consistency for an underlying
stochastic process before applying the functional delta method.
   1
       In principle, one could use the experiment-led variation in neighborhood subsidy incidence as an instrument for
neighborhood product use and recover such social interaction eﬀects. But this question is somewhat tangential to
our goal.




                                                           3
   Having developed our statistical methodology, we apply it to the problem of predicting aggregate
ITN use resulting from means-tested subsidies. We show that ignoring treatment externalities in
the estimation of aggregate policy impacts can yield large bias, and importantly, that the sign of
this bias cannot be inferred solely from the sign of the externality. For example, when individual
ITN use is increasing in neighborhood subsidy rates, as in our application, intuitive reasoning might
suggest that ignoring this externality would lead to under-estimation of the aggregate impact of a
targeted ITN subsidy program. However, this intuition is flawed and the correct answer depends
on whether the average neighborhood subsidy rate under the proposed subsidy program would be
higher or lower than the average neighborhood subsidy rate observed in the data used to estimate
the parameters of interest.
   To get some intuition behind this finding, consider a much simpler set-up where an outcome 
is related to a scalar covariate  via the classical linear regression model  =  0 +  1  +  where
 is zero-mean, independent of  and  1  0. OLS estimation of this model yields estimators
̂ 1 , ̂ 0 with probability limits (and also expected values)  1 = Cov [  ] Var [] and  0 =
 [ ] −  1  [], respectively. Corresponding to a value  of , the predicted outcome has its
probability limit of ∗ :=  0 +  1  =  [ ] +  1 { −  []}. Now consider what happens if
one ignores the covariate . Then the prediction is simply the sample mean of  which has the
probability limit of   :=  [ ]. Therefore, ∗   if    []. Thus, although the ignored
covariate  has a positive eﬀect on the outcome (since  1  0), ignoring it in prediction leads to
an overestimation of the outcome if the point  where the prediction is made is smaller than the
population average of the ignored covariate. On the other hand, if    [], then there will be
under-estimation.
   For a more general model,  =  0 + 1  1 + 2  2 +  with 1  2 independent of  and 2
independent of 1 , the OLS based prediction  ∗ at (1  2 ) will have the probability limit equal to
 [ ] + {1 −  [1 ]}  1 + {2 −  [2 ]}  2 . Ignoring 2 leads to OLS prediction  with its
probability limit  [ ] + {1 −  [1 ]} ̃ 1 , where ̃ 1 is the plim of the OLS coeﬃcient of 1 in a
regression of  on 1 alone. The diﬀerence between the two predictions equals
                                             ³          ´
             − ∗ = {2 −  [2 ]}  2 +  1 − ̃ 1 {1 −  [1 ]}

                        = {2 −  [2 ]}  2 − {1 −  [1 ]} Var [1 ]−1 Cov [1  2 ]  2

                        = {2 −  [2 ]}  2 

since Cov [1  2 ] = 0. This is the higher dimensional analog of the previous result. If the point of


                                                   4
prediction is higher relative to the population mean of the omitted covariates and the coeﬃcients
on the omitted variables are positive, then ignoring the covariates leads to an over-estimation of
the predicted value. Note that in this case, the omitted covariate 2 is orthogonal to the included
covariate 1 so that there is no omitted variable bias in the coeﬃcient estimate, i.e.,  1 = ̃ 1 and
yet the prediction is biased.2
       Literature review and substantive contributions: Several papers have recently appeared
in the statistics and econometrics literature on formal analysis of treatment eﬀects under inter-
ference — i.e., where treatment status of peers or neighbors aﬀects an individual’s outcome over
and above his/her own treatment status. See, for example, Rosenbaum (2007), Hudgens and Hal-
loram (2009) and Manski (2010). A diﬀerent strand of the literature has investigated the impact
of alternative peer assignment policies on population outcome distribution when peer-eﬀects are
significant determinants of individual outcomes. See, for instance, Bhattacharya (2009), Graham
(2011), Carrell et al (2012) and the references therein. These papers did not require a separate for-
mulation of neighborhood eﬀects in terms of distance, since peer-eﬀects were taken to work within
identifiable neighborhoods (such as classes, dorm-rooms or entire villages) and hence the set of peers
was "closed". In contrast, in our present context of ITN subsidies, the relevant neighborhoods are
defined in terms of physical distance, which is sensible in the context of health externalities or that
of social learning (c.f., Conley and Udry, 2011), especially in communities like rural Africa where
the relevant households are not concentrated in isolated villages but are located continuously in
space.. Therefore, the relevant neighborhoods are overlapping (not closed) in the sense that we can
generically have situations where a household (hhd)  and hhd  are neighbors, hhd  and  are
neighbors but hhd  and  are not neighbors. This distance-based characterization of neighborhood
eﬀects leads to new challenges for formulation and inference in our analysis.
       We note that our aim here is not to devise either an outcome-maximizing (c.f., Bhattacharya,
2009; Graham, 2011) or decision-theoretically optimal (c.f., Manski, 2004; Dehejia, 2005, Hirano
and Porter, 2009; Stoye, 2008; Tetenov, 2010) treatment-targeting rule. Instead, we wish to calcu-
late marginal and average returns for what is arguably the most common subsidy allocation rule in
developing (and developed) countries, viz. means-testing, where only households below a certain
income level qualify for the subsidy. The methodological innovation is to conduct this analysis in
   2
       A similar argument applies if we predict the population-average outcome corresponding to a counter-factual
change in the marginal distribution of the covariates. In this case, an over-estimation will occur if the mean of the
ignored covariate under the counterfactual distribution is lower than its mean under the original distribution.




                                                          5
the presence of infinite-dimensional neighborhood eﬀects identified experimentally. Therefore, our
problem and its analysis are, to the best of our knowledge, unique relative to the existing literature
on neighborhood eﬀects in the analysis of treatment response and treatment assignment problems.
    Last, but not least, our finding that ignoring neighborhood-externalities can lead to either
under or over-estimation of the aggregate impact of treatment — even when raising neighborhood
treatment rates unambiguously increase individual outcomes — appears to be novel. It highlights
a statistical issue concerning the impact of omitted variables on outcome predictions which is very
diﬀerent from the well-known impact of omitted variables on regression coeﬃcients. As such, this
finding provides a new — and to our knowledge, heretofore unnoticed — cautionary note regarding the
extrapolation of experimental results involving randomized treatment assignment to the prediction
of aggregate outcomes in situations where the aggregate incidence of treatment might diﬀer from
that in the experiment.


2    The context and the experiment

Malaria is a life-threatening parasitic disease transmitted from human to human through mos-
quitoes. In 2010, malaria is estimated to have caused up to 1,200,000 deaths, mostly among
African children (Murray et al., 2012). Despite major strides in malaria eradication in the early
and mid-20th century, notably in the Americas, eﬀorts to eradicate malaria worldwide were aban-
doned in the 1970s. Recently, eﬀorts to control malaria transmission have rejuvenated with the
introduction of highly eﬀective prevention tools, insecticide treated bednets (ITNs). Regular use of
an ITN is believed to reduce overall child mortality by around 18 percent and to reduce morbidity
for the entire population (Lengeler, 2004). However, at $6 or more a piece, ITNs are unaﬀord-
able for many poor households, and as of 2007, ITN coverage rates in most of sub-Saharan Africa
were below 25%, way short of the 100% coverage recommended by the World Health Organization
(WHO, 2008). Given this, an important policy question for governments in malaria-endemic areas
of Africa is how much to subsidize ITNs, and for whom. Because the returns to malaria prevention
are higher among children under five and pregnant women (Lengeler, 2004), and targeting based on
such easily observable characteristics is relatively cheap, initial calls were made for subsidies to be
targeted at these subgroups (Webster et al., 2007). But as argued in Killeen (2007), in the presence
of externalities, it might actually be more cost-eﬀective to subsidize ITNs for a larger share of the
population than just children under five and pregnant women. Evidence on the size and shape




                                                   6
of these externalities remain scant, however, as few experimental studies to date were designed to
estimate those.
      Experimental design: We exploit data from a 2007 randomized ITN subsidy experiment
conducted in eight rural markets of Western Kenya, where malaria is transmitted year-round. In
each market area, a list of 150 to 200 households was compiled from school registers. Households
were then randomly assigned to a subsidy level. After the random assignment had been performed
in oﬃce, trained enumerators visited each sampled household to administer a baseline survey. At
the end of the interview, the household was given a voucher for an ITN at the randomly assigned
subsidy level. Vouchers could be redeemed within three months at participating local retailers.
The subsidy level varied from 40% to 100%; there were 22 corresponding final prices faced by
households, ranging from 0 to 300 Kenyan shillings (US$4.60). In what follows, we group these
subsidy levels into two categories: those who received a large subsidy (i.e., faced a price of 90 Ksh or
below) and those who received a lower subsidy (i.e., faced a price of 100 Ksh or above). Given the
liquidity constraints faced by the study population, these two subsidy categories indeed correspond
to two very diﬀerent treatments: 71% of households receiving a price at or below 90 Ksh acquired
the ITN, compared to only 26% of those in the low subsidy group. Furthermore, there is a level
drop in take-up of around 20 percentage points (from 55 to 35%) between the price points of 90
and 100 Ksh, possibly owing to the fact that other types of bednets (less eﬀective but better known
ones) are sometimes available in retail shops for the price of 100 Ksh.3
      Data: Three separate but related sources of data are combined in our analysis. First, we
use administrative data on voucher redemption to obtain our main outcome of interest: whether
the household purchased an ITN. Second, we use data on background household characteristics
measured during a baseline survey. The three main background characteristics we consider are
wealth (the combined value of all durable and animal assets owned by the household); the number
of children under 10 years old; and the education level of the female head of the household. Finally,
we have data on the exact geoposition (latitude and longitude, measured with a GPS device) of all
households in the sample. These data enable us to compute, for each household, the number and
density of study households within a given radius. We can also compute the number and density
of households with a given characteristic within that radius, in particular, the share of households
below a certain poverty threshold, and the share of households who received a subsidy.
  3
      See Dupas (2012, Figure 1) for the full demand curve.




                                                          7
3     Methodology

Stochastic specification: There are  randomly chosen households from the population and they
are indexed by  which will run from 1 to .
    Let  denote household ’s location (such as a latitude-longitude pair). Let  denote other
                                                                             ∗ (··) denote the
household covariates, of which the 1st component 1 is wealth-holding. Let 
(true) joint cumulative distribution function (C.D.F.) of (   ) in the population. Let  denote
the binary indicator of whether the household purchased an ITN, and  is a binary indicator of
whether it had received a subsidy-voucher entitling it to buy an ITN for under 100 Ksh (about
US$1.50). Due to simple random sampling, our experimental dataset consists of  independent and
identically distributed (I.I.D.) realizations of (       ).
    Finally, we denote by  () := ∗ (  ) the fraction (rate) of households residing within the 
neighborhood of household  (a radius of  from  ) who got a subsidy. In general, several values of 
(say,  values, 1  2    ) will be used in our empirical exercise; so ∗ (  ) should be interpreted
as a generic component of the vector (∗ (  1 )  ∗ (  2 )   ∗ (   )) (we regard ∗ (  ·) as a
random function). We will sometimes suppress the dependence of ∗ on  (or that of  on ) when
there is no possibility of confusion.
    Let  (1 ∗ ) denote a potential outcome (ITN purchase) of household  if it receives the subsidy
and a fraction ∗ of its neighbors also receive the subsidy. Similarly, let  (0 ∗ ) denote a potential
outcome when  is not receiving the subsidy itself and a fraction ∗ of its neighbors receives the
subsidy. Implicit in this notation is the assumption that the treatment status of a household’s
neighbors aﬀects its own outcome only through the aggregate fraction of subsidized households in
the neighborhood. Define

                  1 ( ) :=  [ (1 ) | = ] ; 0 ( ) :=  [ (0 ) | = ] 

where  denotes a generic incidence of subsidy in the neighborhood (while the function with an
asterisk, ∗ , denotes the true one). Here the expectation is taken with respect to the population
distribution, or, equivalently, the distribution induced by random sampling from the population.
These quantities can be defined without reference to any subsidy allocation mechanism.
    Now, random assignment of subsidies in the experiment implies that 1 ( ) and 0 ( ) can
be consistently estimated by the sample counterparts

                   ̂ [ | = 1  =   = ] ; ̂ [ | = 0  =   = ] 



                                                         8
respectively, if one observes the realizations of (       ).4 However, realizations of  are not
observed, since only a subset  of the population is sampled for measurement; realizations of 
need to be estimated oﬀ of the observed sample, and hence we have a generated regressor problem.
We estimate the above quantities by

                    ̂ [ | = 1 ̂ ( ) =   = ] ; ̂ [ | = 0 ̂ ( ) =   = ] 

respectively, where                                         P
                                                         −1 =1 1 {|| −  || ≤ } 
                                 ̂ () = ̂ ( ) :=       P                           
                                                          −1 =1 1 {|| −  || ≤ }



       Parameters of interest: Our key parameter of interest is potential ITN use resulting from
income-based, i.e., means tested subsidy. Toward this end, consider the binary treatment rule:
                                                                      R
giving a subsidy if 1  . The expected cost of this rule is  () = 1 {1  } ∗ 1 (1 ). On
the other hand, under this subsidy rule, the neighborhood subsidy-rate for a generic household at
a location  will be given by

                            ∗ ( ) = Pr [k −  k ≤  & 1 ≤ ]  Pr [k −  k ≤ ]                        (1)

where ||−|| = ||−||L = ||−||L is an appropriate distance measure between  and  on L. Each
 is defined via latitude-longitude coordinates in our dataset (L is a set of latitude-longitude points
on the earth sphere), and therefore, we work with the distance based on the Haversine formula.5
This distance is used for defining each household’s neighborhood.
       Finally, the expected ITN usage rate corresponding to this counterfactual subsidy-rule will be
given by
                       Z
                           £               ¡             ¢                 ¡             ¢¤ ∗
            ∗ () =        1 {1  } × 1  ∗ ( ·) + 1 {1 ≥ } × 0  ∗ ( ·)  ( )            (2)

   4
       We in particular note that due to randomized subsidy allocation, the following relationship holds:

                        [ ( ) | = ]   =    [ (1 )  +  (0 ) (1 −  ) | =   = ]

                                               =    [ | = 1  =   = ]  for  = 1 0


   5
       For simplicity, we develop our asymptotic theory under the assumption that the earth is a sphere and || − || =
||−||L measures the shortest distance between two points  and  on the sphere surface. This simplifying assumption
allows us to easily compute so-called covering numbers of functional sets. Note that for the Euclidean norm, we also
use the same notation ||·|| in the sequel, which should cause no confusion.



                                                               9
       If we ignore the externality, we would calculate, analogous to Bhattacharya and Dupas (2011),
       ̄1 (): Probability of the ITN use if an  type household gets a subsidy;
       ̄0 (): Probability of the ITN use if an  type household gets no subsidy.
       One can identify ̄’s from the experiment, in which subsidy allocation was randomized. Then
the naive expected ITN usage rate — ignoring the externality — is given by
                            Z
                                                                         ∗
                    ̄ () = [1 {1  } ̄1 () + 1 {1 ≥ } ̄0 ()]  ()                                   (3)

       Our goals are to estimate (2) and (3) and to calculate the diﬀerence between them for various
counterfactual subsidy rule (namely, various eligibility thresholds ). We now turn to the question
of how to estimate them from the data and then derive statistical properties of these estimates
which are needed to conduct inference.

       Functional forms and estimation method: Now, we formally present our econometric
framework and estimation method. To this end, we first re-formulate the fraction of subsidized
households, ∗ ( ), as follows. Let 
                                        ∗ (· ·) denote the (true) joint distribution function of


(   ) induced in the population via the one-time experiment and let ∗ (·) denote the marginal
distribution function of  in the population. Then, write

                                    Pr [|| −  || ≤  &  = 1]
                ∗ ( )   :     =
                                           Pr [|| −  || ≤ ]
                                                                 R                          ∗ ( )
                                   [1 {|| −  || ≤ }  ]       × 1 {|| − || ≤ } 
                            =                                  =     R                                           (4)
                                            ∗ ( )                  1 {|| − || ≤ } ∗ ()
for any  ∈ [ ∞) (with some constant   0) and  ∈ L, where ∗ ( ) is the probability that
some household exists within the  neighborhood of , i.e.,

                                ∗ ( ) := Pr [|| −  || ≤ ] =  [1 {|| −  || ≤ }]                      (5)

In the above expression, probabilities and expectations are calculated with respect to the distribu-
tion corresponding to random sampling from the population, given the realizations of the subsidy
experiment, and not with respect to infinite repetitions of the experiment itself. Thus, for a house-
hold located at a location , ∗ ( ) denotes the true fraction of subsidized (through the experiment)
households in its  neighborhood.6 It is also important to note that ∗ ( ) is not in the form of a
regression (2 -projection) function.
   6
       Thus although  is randomly assigned during the experiment,  and  are not independent with respect
                              ∗
to the sampling distribution  (· ·), given the realizations of the (one-time) experiment, by which the probabili-
ties/expectations in (4) are computed.



                                                             10
         Since the object ∗ (· ·) is required to calculate our interested parameters (as previously ex-
plained), we consider nonparametric estimation of this function (indexed by ( )) by
                                            P
                                         −1 =1 1 {|| −  || ≤ } 
                            ̂ ( ) :=     P                                                                                        (6)
                                          −1 =1 1 {|| −  || ≤ }

This is a moment based estimator corresponding to a solution of the moment equation [1 {|| −  || ≤ }×
{ −  ( )}] = 0.7
         Next, given the fraction of subsidized households ∗ ( ), we model the probability of the ITN
use for an ( )-type household with a treatment  ∈ {0 1} ( = 1 if subsidized, and = 0 otherwise)
by
                                                                         ³         P                   ´
              Pr [ = 1 | =   =   =   = ] =  ( ) = Φ 0  ∗ + =1  ∗  ( )                               (7)

where Φ is some cumulative distribution function of a continuously-distributed random variable
(we choose a standard normal C.D.F. in our application);  ∗ is a  -dimensional column vector
( ∗1       ∗  )0 ( = 0 1); and  is some finite integer and { }=1 is a set of evaluation grid points
picked by an econometrician (with  ∈ [ ∞)).

Remark 1 Implicit in this formulation is the assumption that the location  itself has no impact
on household decision to buy an ITN, given  ,  and  .

         We estimate the parameters by the quasi maximum likelihood (QML) method. Here, we do
not suppose that Φ is correctly specified but interpret it as a device for us to obtain a convenient
and reasonable criteria for the estimation (see, e.g. discussions on the QML estimators in White,
1994), meaning that our asymptotic theory developed below is valid even under misspecification.
To define our QML objective function, write

     ¡                   ¢0     ¡                                                           ¢0
 :=   0    0 ; η :=  00   01   10       0   11       1 ; s (·) := ( (· 1 )       (·  ))0 

In the sequel, η ∗ and s∗ (·) denote the (pseudo) true parameters (a 2 ( + )-dimensional vector
of real numbers and a -dimensional vector of functions, respectively), and η̂ and ŝ (·) denote their
     7
         Since we are only interested in ∗ (  ), evaluated at  =  (for each household ), we may use the following
estimator of ∗ (  ):                               
                                                        1≤≤; 6=   1 {|| −  || ≤ } 
                                           ̂ () :=                                           
                                                            1≤≤; 6=   1 {|| −  || ≤ }
Since we can easily show that ̂ (  ) = ̂ () +  (1) uniformly over  and  (under some weak conditions),
whether we use ̂ (  ) or ̂ () does not aﬀect our asymptotic analyses, and therefore we subsequently work with
the estimator (6).




                                                                    11
estimators.8 Then, the objective function is defined as
                                                              X
                                       (η ŝ (·)) := −1               (  ηŝ ( ))                           (8)
                                                                   =1

where
                                                   ³          P                     ´
                 (  η s ( )) : =   ln[Φ 0  0 + =1  0  (   ) ]
                                                               ³       P                      ´
                                      + (1 −  ) ln[1 − Φ 0  0 + =1  0  (   ) ]
                                                          ³         P                   ´
                                                               0
                                      + (1 −  )  ln[Φ   1 + =1  1  (   ) ]
                                                                    ³           P                     ´
                                      + (1 −  ) (1 −  ) ln[1 − Φ 0  1 + =1  1  (   ) ]

The (quasi) log-likelihood function  is a plug-in type, i.e., the true s∗ (·) is replaced with the
preliminary (first-step) estimator ŝ (·). We note that the (vector-valued) function s (·) influences 
only through its value at  , i.e., s ( ) = ( (  1 )       (   ))0 . Now, we can define the QML
estimator η̂ as
                                          η̂ : = arg sup∈R2( +)  (η ŝ (·))                                     (9)

       To compute our object of interest, the probability of the ITN use defined in (2), we also need
∗ ( ) (defined in (1)) and the C.D.F. 
                                              ∗ ( ), which are nonparametrically estimated by

                                  P
                               −1 =1 1 {|| −  || ≤ } × 1 {1  }
                ̂ ( ) : =            P                                for each (  ) ;  (10)
                                      −1 =1 1 {|| −  || ≤ }
                                  X
            ̂ ( ) : = −1        1{ ≤  &  ≤ } for each ( ) 
                                            =1

respectively.
       Given the estimated ̂ (· ·), η̂, ̂ (· ·) and ̂ (· ·) (together with the formulation in (7)), we
can now obtain an estimate of  ∗ () by simply replacing the true parameters with their estimates.
To formulate this and to facilitate our subsequent analyses, we define a [0 1]-valued functional Ψ:
                                       Z n                ³                              ´
                                                             0   P
    Ψ (η s (·)   (· ·) |) : =     1 {1 ≥ } × Φ   0 + =1  0  (   )
                                                     ³         P                      ´o
                                     +1 {1  } × Φ 0  1 + =1  1  (   )  ( )  (11)

where s (·) := ( (· 1 )       (·  ))0 . In what follows, we use the notation

                                              ρ := (η s (·)   (· ·))                                        (12)
   8
       We often write a function or parameter with an asterisk to refer to the (pseudo) true one, that is,  ∗ , and ˆ with
a hat to denote an estimator of  ∗ , while a function or parameter without an asterisk or hat, such as  , usually refers
to a generic one.



                                                              12
a (2 + 3 + 1)-dimensional vector of functions; analogously ρ∗ and ρ̂ refer to the (pseudo) true
parameter and the estimator, respectively. Ψ is a map: ρ 7−→  ∈ [0 1], whose domain is formally
defined in the Appendix before the statement of Lemma 5. Then, we can write our estimand and
its estimator as

                 ∗ () = Ψ(ρ∗ | ) = Ψ(η ∗  s∗ (·)  
                                                          ∗
                                                              (· ·) | );

                  ̂ () = Ψ(ρ̂ | ) = Ψ(η̂ŝ (·)  ̂ (· ·) | )
                               X n                          ³           P                    ´
                         = −1          1 {1 ≥ } × Φ 0 ̂ 0 + =1 ̂ 0 ̂ (   )
                                   =1
                                                ³           P                      ´o
                           + 1 {1  } × Φ 0 ̂ 1 + =1 ̂ 1 ̂ (   )                                   (13)

                              ¡                                  ¢0
respectively, where s∗ (·) := ∗ (· 1 )      ∗ (·  ) and ŝ (·) := (̂ (· 1 )      ̂ (·  ))0 . The
integral with respect to ̂ simply leads to an average as in (13) since ̂ is the empirical
distribution function (E.D.F.) from the observations {(   )}=1 . We note that this estimator
̂ () can be seen as a three-step one: the first step is the estimation of the (nuisance) nonparametric
component of s∗ (·); the second step is obtaining the estimate η̂ of the finite-dimensional parameter
η ∗ whose estimation depends upon the estimate ŝ (·) from the previous step; and the third step
is computing an empirical average of quantities based on the second-step estimate η̂ as well as
another nonparametric estimator ŝ (·) (or equivalently, computing a value of the functional Ψ
with (η̂ŝ  ̂ ) as an input).

                                                                        ¡       ¢
    For the case where the externality is ignored, we model ̄ () := Φ 0 ̄  , where ̄  is a  -
dimensional vector (for  = 0 1), and consider the following (quasi maximum-likelihood) estimator
of the parameter  ∗∗
                    :

                                   0    0
                                (̃ 0  ̃ 1 )0 : = arg sup(0 0 )0 ∈R2  (( 00   01  00 )0  0)
                                                               0   1



where  is the likelihood function defined in (8) and 0 stands for a zero (column) vector (of some
appropriate dimension). By using the functional defined in (11), we can also write the mis-measured
usage and its estimate as

                                ¡                         ¢
                    ̄ ∗ () = Ψ η̄ ∗  0 
                                            ∗
                                                (· ·) |  ; ̃ () = Ψ(η̃ 0 ̂ (· ·) | )

                                       ∗0   ∗0                          0   0
respectively, where η̄ ∗ := (̄ 0  ̄ 1  00 )0 and η̃ :=(̃ 0  ̃ 1  00 )0 . Under the null hypothesis that the
externality does not matter for the ITN purchase decision, we can say that ̃ is an estimator of
the usage rate which incorporates the restriction due to the null hypothesis.


                                                                   13
4    Distribution theory and methodological contributions

We are primarily interested in the asymptotic distribution of our estimator ̂ (). Our derivation
of this distribution is somewhat involved due to the complicated three-step form of ̂ (). As
discussed above, our object of interest  ∗ () may be regarded as a value of the functional Ψ
evaluated at ρ∗ := (η ∗  s∗  
                                  ∗ ). And therefore, ̂ () is computed as a plug-in type estimator,


a functional value of Ψ evaluated at estimates of parameters ρ̂ := (η̂ŝ  ̂ ). Our strategy
for deriving the asymptotic distribution of ̂ () relies on this formulation using the functional Ψ.
That is, we first derive a joint functional central limit theorem (FCLT) for η̂, ŝ (·) and ̂ (· ·)
to show that the (normalized) vector of the estimators weakly converges to a Gaussian process.
Then we apply the functional delta method by showing that Ψ is Hadamard diﬀerentiable and
                                                                  √
computing the explicit form of the derivative, and thus obtain the  asymptotic normality of
̂ () = Ψ(η̂ ŝ (·)  ̂ (· ·) |). This approach works here because all three elements, viz., η̂,
ŝ (·) and ̂ (·), have the same convergence rate. Combining the above steps then yields an
asymptotic normality result for ̂ () which takes into account spatial externalities and that for
̄ () which does not. This result is presented as Theorem 1.
    Before presenting our formal results, we state the conditions which we work with:

Assumption 1 { }=1 is a sequence of I.I.D. random vectors ( = (  0    0 )0 ), and (0  s∗ ( )0 )0
is not linearly dependent almost surely.

Assumption 2 There exists some constant   0 such that

                                        inf ()∈L×[∞) ∗ ( )                                     (14)

Assumption 3 (i) The support of  , X , is some bounded set in R . (ii) Φ is the C.D.F. of the
standard normal distribution.

Assumption 4 L (the range of  ) is a proper subset of the sphere and does not include any
band/ring surrounding the sphere.

Assumption 5 For each  ∈ {1       }, ∗ ( ) and ∗ ( ) are continuous in (∈ L). 
                                                                                                 ∗ ( )


is continuous in ( )(∈ X × L).

    Assumption 2 is imposed to guarantee the uniform convergence of ŝ () and ŝ () (over ). Since
these are estimators of the ratio type (with the estimated ∗ (  ) in the denominator of ŝ () and


                                                       14
ŝ ()), they are potentially unbounded if ∗ ( ) and its estimate are very close to zero. The
assumption is useful to avoid the so-called random-denominator problem. From a practical view
point, ∗ ( ) and its estimate would be very close to zero if  was so, but we can avoid this by
setting the distance parameters { } away from zero. The boundedness of the support in (i) of
Assumption 3 is a reasonable assumption in our context and greatly facilitates our formal proofs.
As for (ii) of Assumption 3, we can also think of some other specification such as the logistic
function. Again, we impose this condition for simplicity. Assumption 4 allows us to regard L as
some (bounded) subset of R2 (say, L ⊂ R2 ), which is trivially satisfied since our data were collected
in Western Kenya (only a part of the globe surface, not a "band"). By regarding L ⊂ R2 , we can
define the continuity property of the functions in Assumption 5. This continuity condition may not
necessarily be required, but it facilitates our proof by making a set of functions (indexed by ( ))
smaller (see the condition (19.25) and the proof of Theorem 19.28 of van der Vaart, 1998).

Theorem 1 Suppose that Assumptions 1-5 hold. Then,
                           ⎛                    ⎞
                              ̂ () −   ∗ ()
                        √                         
                          ⎝                    ⎠→   (0 Σ ()) 
                              ̃ () − ̄ ∗ ()

for each , where Σ () is a 2-by-2 variance-covariance matrix (for the derivation of the explicit
form of Σ (), see the proof of theorem in the Appendix ).

      The asymptotic normality result of Theorem 1 allows us to implement econometric infer-
ence provided we can consistently estimate the asymptotic variance matrix, which takes a com-
plicated form, as is apparent from the proof of Theorem 1 (see the Appendix), and is thus
not easy to estimate. Therefore, we resort to bootstrap-based inference. We use the nonpara-
metric (I.I.D.) bootstrap and show that it consistently estimates the asymptotic distribution of
√
  (̂ () −  ∗ ()  ̃ () − ̄ ∗ ())0 . This assertion is formally stated and proved via Theorem 2.
      Let {# }=1 be bootstrap data drawn randomly with replacement from { }=1 ( = (  0    0 )),
and let (̂ # ()  ̃ # ()) be an estimator of ( ∗ ()  ̄ ∗ ()) based on the bootstrap data (we sub-
sequently use a superscript # to denote a bootstrapped (resampled) variable or object).

                                                                                   √
Theorem 2 Suppose that Assumptions 1-5 hold. Then, given { }=1 ,                (̂ # ()−̂ ()  ̃ # ()−
̃ ())0 (conditionally) weakly converges to  (0 Σ ()) in probability as  → ∞.9
  9
      For the notion of this convergence, see the definition (3.9.9) in van der Vaart and Wellner (1996, p. 378). In
                             
subsequent proofs, we use =⇒ to denote this convergence.
                             #




                                                         15
       This theorem provides the justification of the bootstrap-based inference, i.e., we can obtain an
approximation of the limit distribution by the distribution of bootstrap estimates.10
       These theorems are proved in the Appendix, using the following sequence of steps (here we
outline the steps for ̂ () only; the analogous ones for ̃ () are much simpler because they do not
involve the spatial externalities):

   1. Lemma 1 establishes the asymptotically linear forms of the (normalized) nonparametric esti-
             √                       √ £                 ¤
      mators,  [ŝ () − s∗ ()] and  ŝ () − s∗ () .

   2. By using the pathwise derivative method (Newey, 1994), we quantify eﬀects on η̂ of prelimi-
         nary estimation of s∗ (calculate a so-called correction term).

   3. Lemmas 2 and 3 verify an asymptotic linear expression of the QML estimator

                                            η̂ = arg sup∈R2( +)  (η ŝ (·))

         defined in (9) (this expression reflects the correction due to estimating s∗ obtained in the
         previous step).

   4. Combining the previous steps, one then obtains the asymptotically linear uniform expression
         of the (stacked) vector of the normalized estimators:
                                                ⎛                               ⎞
                                                             η̂ − η ∗
              √                              √ ⎜⎜                               ⎟
                                                                                ⎟
                 [ρ̂ ( ) − ρ∗ ( )] ≡  ⎜       ŝ () − s∗ ()       ⎟ = Ĝ ( ) +  (1)        (15)
                                                ⎝                               ⎠
                                                  ̂ ( ) − ∗ ( )



         for each , in terms of an empirical process Ĝ (defined in (55) in the Appendix).
         Lemma 4 then proves a functional central limit theorem for the process {Ĝ ( )}()∈X ×L ,
         which forms the basis of our inference and makes our analysis diﬀerent from previous analyses
         of multi-step estimation methods owing to the non-standard form of ŝ.

   5. Lemma 5 then establishes that  ∗ () is a Hadamard diﬀerentiable functional Ψ of (η ∗  s∗  
                                                                                                      ∗ ).



   6. Steps 4 and 5 are then combined to establish Theorem 1.
  10
       We estimate the limit distribution by a simulation. Simulation errors may be made arbitrarily small by letting
the number of simulations large enough, and therefore we do not evaluate such errors, following the standard manner
in the literature.




                                                          16
   7. Finally, the above steps are combined with two auxiliary results in Lemmas 6 and 7 to obtain
      Theorem 2. The key step for establishing the bootstrap validity is to show the asymptotic
      uniform negligibility of
                                     √ #
                                      [ρ̂ ( ) − ρ̂ ( )] − Ĝ#
                                                                      ( )                          (16)
                               #
      where ρ̂#  ( ) and Ĝ ( ) are bootstrap counterparts of ρ̂ ( ) and Ĝ ( ), respectively
                                                                                             √ #
      (Ĝ# ( ) is formally defined in (69) in the proof of Theorem 2). Note that            [ρ̂ ( ) −
                                                                                    √
      ρ̂ ( )] is a bootstrap counterpart of the normalized (actual) estimator [ρ̂ ( )−ρ∗ ( )],
      and thus the negligibility of (16) states that the expression as (15) holds true also in the
      bootstrap world. To verify this negligibility of (16), we exploit U-statistic-like expressions
      of estimators, as well as explicit expressions of bootstrapped estimators using multinomial
      random variables (see the proof of Lemma 6), where the multinomial distribution arises from
      the nonparametric bootstrap procedure.


Relation of our derivations with the existing literature: Our derivations, outlined above
and proved rigorously in the Appendix, may be contrasted with distribution theory for (i) two-step
semiparametric estimators (e.g., Newey, 1994; Chen, Linton and van Keilegom, 2003; Mammen,
Rothe and Schienle, 2012) and (ii) three-step semiparametric estimators (e.g., Hahn and Ridder,
2012).
   The two key points of diﬀerence in our set-up, relative to other papers in the relevant literature,
are that (i) our first step-estimators ŝ(·) and ŝ (·), as is clear from the definitions (6) and (10), do
not involve kernel (local) or series-based estimators, and consequently (ii) every component of our
                                                                      √
second-step stochastic process, viz., [ρ̂ (· ·) − ρ∗ (· ·)], has a -rate of convergence. Hence our
proof of the final step can be based on the functional CLT coupled with Hadamard diﬀerentiability
arguments. This makes the derivation diﬀerent from other two or three-step estimators in the
literature.
   The two key technical contributions in our derivations are (a) calculating the correction term,
which quantifies the impact of the estimation of ŝ (·) on the second-step parametric estimator η̂
(see equations in (33) and (34), and Lemma 3), and (b) establishing bootstrap consistency for our
final, third step estimator (Theorem 2). As is well-known from e.g., Newey (1994), the eﬀect of
first-step estimators of infinite-dimensional parameters may be calculated via pathwise derivatives
leading to a correction term in the asymptotic linearization of the second-step estimator. But in
general, one needs to find these correction terms on a case by case basis, as in the calculations



                                                     17
for semiparametric eﬃciency bounds. The calculation of the corrections term here is non-trivial
and involves a clever use of the law of repeated conditional expectations, which is purportedly of
independent interest (see Remark 2 in the Appendix).
         As regards bootstrap validity, to our knowledge, ours is the first result of bootstrap consistency
for three-step estimators. For two-step ones, Chen, Linton and Keilegom (2003) have shown boot-
strap consistency based on an entropy-based technique. However, for our proof for the three-step
estimators, a corresponding "entropy condition" is diﬃcult to verify since the nonparametric es-
timators ŝ (·) and ŝ (·) are constructed with indicator functions and thus are discontinuous and
non-smooth.11 Therefore, we develop independent proofs based on properties of the multinomial
distribution induced by the bootstrap resampling, as mentioned above. Thus it may be fair to say
that our results and proofs complement existing results and proofs on multi-step estimators in the
semiparametric literature.


5         The application and empirical results

We now apply our methods to data collected via the experiment described above. See Section 2 for
descriptions of the context and details on the design of the experiment generating the data.
         The outcome we consider is whether the household acquires the ITN. As shown in Dupas (2012),
this is a very good proxy for ITN coverage (what, ultimately, the social planner that subsidizes ITNs
cares about) since ITN usage conditional on ownership is high, reaching 90% within 12 months.
         As regressors  , we include household wealth (represented by the total value of the durable
and animal assets reported by the household at a baseline survey), the number of children under
the age of ten years and years of education of the oldest female member of the household. This
choice of regressors is motivated by previous studies on determinants of ITN use in Kenya (c.f.,
Bhattacharya and Dupas, 2011 and Dupas, 2012).
         In order to take into account the neighborhood eﬀects, we include as additional regressors
the fraction of households who received a large subsidy and reside within 250 meters, 500 meters
and 1000 meters respectively of a given household. In terms of the notation of section 3, we
included (estimated counterparts of) the three additional regressors ∗ (  250), ∗ (  500) and
∗ (  1000), in addition to  . Table 1 reports summary statistics on these regressors, as well as
    11
         We could work with some smoothed versions of ŝ (·) and ŝ (·), but such smoothing complicates our estimation
procedure, requiring some smoothing parameter choice.




                                                            18
on the randomized treatment dummy (= 1 if the household received a large subsidy voucher) and
the outcome of interest (a dummy equal to 1 if the household purchased the ITN).
        Tables 2A and 2B report the determinants of buying an ITN as a function of household co-
variates, estimated using the experimental data where subsidy allocation was randomized. Table
2A reports the probit coeﬃcient estimates corresponding to subsidized households, i.e., ̂ 1  ̂ 1 , and
Table 2B reports probit coeﬃcients for the unsubsidized ones, i.e., ̂ 0  ̂ 0 in (9). The standard
errors, which adjust for the first-step estimation of the ̂’s, are calculated using the bootstrap. The
justification of the bootstrap follows from lemma 6 and 7 proved in the appendix (c.f., step 7 in
section 4, above).
        It can be seen from these tables that the covariates have somewhat diﬀerent impacts on the
decision to purchase a net depending on whether the household itself received the subsidy. The
wealth variable is a significant predictor of ITN purchase among households not receiving the large
subsidy but an insignificant one among heavily subsidized households. Similarly, the log-likelihood
test statistic for testing the joint significance of the three neighborhood variables yields a chi-square
test statistic of 3197 (p-value below 00001) when the households received the subsidy themselves
and a test statistic value of 540 (p-value = 0145) when they did not.12
        These findings are intuitive because the ITN is expensive relative to average earnings in our
population of interest. Consequently, it is rare for an unsubsidized household to buy an ITN, no
matter what the neighborhood incidence of subsidy is, unless it is relatively wealthy. However,
upon receiving the subsidy, a household has the option of deciding whether to buy an ITN and it
   12
        The QML objective function in (8) is constructed for obtaining the estimates of two sets of parameters,
                                                            0                                                          0    0    0    0
(̂1  ̂ 1 ) and (̂0  ̂ 0 ) jointly, i.e, ̂ = (̂ 0   01  ̂ 10      ̂ 0  ̂ 11      ̂ 1 )0 = (̂0  ̂ 1  ̂ 0  ̂ 1 )0 . While this definition
of the objective function facilitates our asymptotic analysis, we here calculate these two sets separately. That
                 
is, we use −1      =1 0 (   ŝ ( )) as an objective for (̂ 0  ̂ 0 ) (0 is the sum of the first two terms of ), and
  −1 
      =1 1 (  ŝ ( )) for (̂ 1  ̂ 1 ) (0 is the sum of the last two terms of ). We note that these joint and separate

estimation procedures yield numerically the same result. This is because the objective function  consists of two
parts, one only relevant for (0   0 ) and the other for (1   1 ), and there is no interaction between two sets of the
parameters.
   We also note the two chi-square test statistic values reported here are based on two separate QML procedures.
It is known that in a standard setting with no generated regressor, a likelihood ratio statistic is asymptotically chi-
square distributed. This also holds true in our case with generated regressors ŝ ( ). For the asymptotic chi-square
distribution result of a likelihood ratio statistic, what is important is asymptotic normality of the estimator. Since we
have verified the asymptotic normality of the second step estimator (Lemma 4), we can as well prove the asymptotic
result for the test statistic (proof arguments are quite standard as in Section 9 of Newey and McFadden, 1994, and
we omit details).



                                                                                    19
is only then that neighborhood eﬀects impact this decision.
   Table 3 reports the estimated impact of means-tested subsidies, first including and then exclud-
ing the neighborhood eﬀects. The estimates are reported for each of 20 diﬀerent choices of wealth
thresholds  for means-testing. Columns 6 and 7 report bootstrapped pointwise 95% equal-tailed
confidence intervals for estimates of the diﬀerence  ∗ () − ̄ ∗ (), as we vary the poverty line 
such that households with income below  would receive the subsidy. The theoretical justification
of the bootstrap comes from our Theorem 2.
   The entries in Table 3 may be interpreted as follows. For example, row 10 in Table 3 (highlighted
in bold font) shows the expected impact if households with wealth no more than 10,000 Kenyan
shillings are made eligible for the subsidy. The estimated fraction of such households is about 36%
of the total population of households. An estimate of the average ITN ownership rate resulting from
this rule is 0396 if externalities are taken into account and 0431 if externalities are ignored. This
extent of overestimation is seen to be associated with a 95% confidence interval (−0049 −0019)
which does not include zero and thus suggests statistically significant over-estimation. The reason
why we see such overestimation is that the average neighborhood rate in the experiment used for the
estimation was significantly higher (43%) than under the means-tested subsidy considered in this
case (36%), c.f., our discussion in the Introduction. This means that when the positive externality
is not properly accounted for, the aggregate eﬀect of the subsidy on subsidy-recipients is over-,
rather than under-, estimated.
   Figure 1 summarizes the overall findings from Table 3. The horizontal axis represents column 2
of Table 3, showing the fraction subsidized under each threshold used for means-testing. The light
grey dashed line in the background is the 45-degree line, the solid black line represents the predicted
fraction — including the neighborhood eﬀects — of households who will purchase an ITN. Finally,
the thick dashed line represents the predicted take-up rate if the neighborhood eﬀects are ignored.
It can be seen from Figure 1 that ignoring externalities leads to overestimation of ITN coverage at
low subsidy incidence rates and to underestimation at higher rates. When the incidence rate equals
that in the experiment (about 0.43), the lines corresponding to including or ignoring externalities
coincide and there is no bias. This is the point discussed earlier. This feature is illustrated in
Figure 2 where we plot the diﬀerence between the predicted usage including externality and the
one ignoring the externality together with the corresponding (pointwise) 95% confidence intervals.
   Some policy-relevant conclusions from Table 3 may be stated in terms of average and marginal
returns on the subsidy. We show these calculations in Table 4 where we list the average and marginal



                                                  20
returns to the incidence of subsidy. The average return is the ratio of the predicted take-up rate
(column 3 of Table 3) to the share of the population eligible for the subsidy (column 2 of Table
3). The (approximate) marginal return is defined to be the ratio of the diﬀerence in (predicted)
ITN ownership rates to the diﬀerence in subsidy incidence rate. For example, row 10 in Table 4
suggests that when the 36% poorest households of the population are eligible for the large subsidy,
the average return is 110%; while the marginal return is 81% when the spatial externality is taken
into account, and 51% when it is ignored. For the most part, ignoring the positive externalities
via neighborhood eﬀects leads to under-estimation of marginal returns. The overall pattern of
average and marginal returns are plotted in Figure 3. Because a fixed share of households acquires
the ITN even if not eligible for the large subsidy, average returns appear relatively high at low
levels of subsidy, and steadily decline as the subsidy rate increases. For example, subsidizing
the poorest ten percent households leads to expected ITN ownership by about 24 percent of all
households; subsidizing the poorest 55 percent leads to average use of just around 55 percent.
However, the marginal returns to subsidy, i.e., the increase in ITN ownership corresponding to an
increase in subsidy-incidence rates, is increasing in the subsidy rate. For example, when subsidizing
the poorest ten percent of households via means-testing, increasing the subsidy incidence rate by
one percentage point leads to increase in expected ITN ownership by about 0.5 percentage points;
when subsidizing the poorest 55 percent, increasing the subsidy-rate by one percentage point leads
to increase in expected ITN ownership by about 0.8 percentage points.
    The third feature, shown graphically in Figure 4 is that the marginal returns, taking into account
the externalities, tend to be higher than those obtained ignoring externalities, except at very low
(less than 15%) incidence-rates. The latter curve is almost flat in contrast to the former, which is
generally increasing due to the positive feedback eﬀects coming through neighborhood eﬀects. This
feature corresponds to the convexity of the solid black line and the linearity of the thick dashed
grey line in Figure 1. The diﬀerence between these two curves shown by the dashed line in Figure
4 can be interpreted as the impact of the externality.


6    Conclusion

In this paper we have addressed the problem of predicting the aggregate eﬀect of treatment-targeting
policies in a population where spatial externalities are present, i.e., where treating some households
(e.g., whose income is lower than a threshold) aﬀects the behavior of households living in close vicin-




                                                  21
ity of the treated households. Our set-up is quite general in that we do not assume that all of the
spillover takes place within a closed and identifiable locality (e.g., classroom/village/school/hospital
ward) but not across localities — as is often assumed in empirical studies of spillover eﬀects.13 In
other words, our set-up allows for households    where   are neighbors,   are neighbors
but   are not neighbors. This distance-based notion of neighborhood is the relevant one in con-
texts like ours, involving the spatial dissipation of infection or of social learning when the relevant
households are not concentrated in isolated villages/hamlets but are located continuously in space.
However, allowing for such distance-based, overlapping neighborhoods in the statistical analysis
gives rise to an infinite dimensional estimated regressor — viz., the fraction of treated households
in a neighborhood around a (continuously varying) location coordinate. We develop the relevant
theory of inference which (i) accommodates such predicted, infinite dimensional regressors, and (ii)
establishes bootstrap consistency for the resulting three-step semiparametric estimator. On a more
substantive note, we point out that ignoring spatial spillovers may, statistically, over or underesti-
mate the aggregate eﬀect of targeted subsidy regimes even when the sign of the spillover eﬀects is
unambiguously positive. This, somewhat counter-intuitive, conclusion obtains from discrepancies
between aggregate incidence of subsidies under the proposed regime and that under the experiment
used to obtain estimates of the spillover eﬀects.
       The methods developed above are applicable to other estimation situations where there are
spatial externalities and where the set of units generating and experiencing the spillovers is not
closed or, equivalently, “neighborhoods” are overlapping. The availability and use of GPS based
location data, an important ingredient of our analysis, are becoming increasingly common in quan-
titative social sciences. In some contexts, such as epidemiological studies, actuarial projections and
social network analysis, such data are indispensable. Our methods, therefore, are likely to have
applicability to many other empirical contexts, beyond the important policy-question of predicting
welfare eﬀects of health-product subsidies.
       Turning to the specific application in this paper, our results contribute to the ongoing debate
regarding ITN subsidization. Our findings above suggest that the marginal impact of subsidies is
generally increasing and remains fairly high even when nearly half the population receives a subsidy.
Most of this increasing marginal eﬀect is brought about by behavioral externalities whereby high
  13
       To be clear, we also define the neighborhood of a household as the collection of all households which reside within
a fixed distance from it. However, this definition makes the neighborhoods overlapping and does not partition the
population of households into disjoint and collectively exhaustive "equivalent classes" of neighborhoods.




                                                             22
subsidy levels in the neighborhood lead to higher ITN take-up, conditional on a household’s own
subsidy-status. The marginal eﬀect stops increasing beyond the point at which 50% of households
become eligible for the subsidy but remains positive throughout. In the light of these findings
and (a) given that the World Health Organization recommends that every community members
sleeps under an ITN,14 and (b) assuming means-testing remains politically feasible and practically
implementable, there is a strong case, based on behavioral externalities alone, for extending the
subsidy to at least the poorest 50% of the rural Kenyan population. If there are in addition some
epidemiological externalities (e.g. reduced malaria transmission probabilities when coverage is high
enough, as suggested in Hawley et al., 2003), the marginal returns in terms of public health may
continue increasing well beyond a subsidy incidence rate of 50%.
 14
      See http://www.who.int/malaria/publications/atoz/itnspospaperfinal.pdf




                                                        23
                                                                       Figure 1
                                 Estimated aggregate outcome by share of the population subsidized,
                                        with and without taking into account the externality



                                0.70

                                0.60
        Aggregate ITN Take-Up




                                0.50

                                0.40                                                                  Ignoring externality
                                0.30                                                                  Including externality

                                0.20                                                                  45 degree line

                                0.10

                                0.00
                                       0.00    0.10     0.20    0.30      0.40        0.50   0.60
                                         Share of population eligible for means-tested ITN subsidy




                                                               Figure 2
                                95% Confidence interval for the difference between the two predictions
                                                   (with and without externality)


                                 0.08
                                 0.06
                                 0.04
                                 0.02
                                 0.00
                                -0.02
                                -0.04                                                                       95% CI, upper
                                -0.06                                                                       Difference
                                -0.08                                                                       95% CI, upper
                                -0.10
                                -0.12
                                -0.14
                                     0.000              0.200               0.400             0.600
                                          Share of population eligible for means-tested ITN subsidy




Note: The share subsidized in the experiment that generated the data used for estimation was
43% (see Table 1).




                                                                                 24
                                                       Figure 3
                                Average and Marginal Return, by share subsidized


                   16

                   14

                   12

                   10
                                                                                        Average
                     8
                                                                                        return
                     6                                                                  Marginal
                                                                                         return
                     4

                     2

                     0
                         0.00          0.20            0.40             0.60
                           Share of the population eligible for ITN subsidy




                                                       Figure 4
                  Difference in estimated marginal returns, with and without externality

    1.2

    1.0

    0.8

    0.6                                                                                    Marginal
                                                                                           return
    0.4
                                                                                           Marginal return w/o
    0.2                                                                                    externality
    0.0                                                                                    Difference

    -0.2

    -0.4
           0.00    0.10         0.20     0.30       0.40        0.50      0.60
                  Share of the population eligible for ITN subsidy


Notes: The average return is the ratio of the predicted take-up rate (col. 3 of Table 3) to the share of the population
eligible for the subsidy. The (approximate) marginal return is the ratio of the change (between two rows) in
predicted take-up rate to the change (between two rows) in the share eligible for the subsidy.




                                                           25
Table 1: Summary Statistics

                                                 Obs         Mean         Std. Dev.        Min       Max
Regressors
Household wealth ('000 Ksh)                      1094         21.98          21.12         0.00     1727.28
# of children 10 or younger                      1094         5.46           2.82          0.00      35.00
Years of education of female head                1060         4.94           3.84          0.00      15.00
Share of subsidy recipients within 1000m         1094         0.43           0.22          0.00       1.00
Share of subsidy recipients within 500m          1094         0.41           0.25          0.00       1.00
Share of subsidy recipients within 250 m         1094         0.38           0.32          0.00       1.00
Randomized Treatment status
Received large subsidy (price <100 Ksh)          1094         0.43           0.49          0.00      1.00
Outcome of Interest
Household purchased ITN                          1094         0.46           0.50          0.00      1.00
Note: Sample of Kenyan households surveyed in 2007.




Table 2A: Determinants of ITN Take-up among households that received large subsidy

                                                              Coef.        Std. Err.      t-stat

Household wealth ('000 Ksh)                                  0.0001         0.0003         0.30
# of children 10 or younger                                 -0.0010         0.0229        -0.04
Years of education of female head                            0.0018         0.0160         0.11
Share of subsidy recipients within 1000m                     1.8720         0.5170         3.62
Share of subsidy recipients within 500m                     -0.3500         0.4770        -0.73
Share of subsidy recipients within 250 m                     0.3630         0.2620         1.39
Notes: Probit estimates. Dependent Variable: Household purchased ITN. N=486, Pseudo-Rsq= 0.06. p-
value for joint-significance of three neighborhood covariates<0.0001




Table 2B: Determinants of ITN Take-up among households that did not receive large
subsidy

                                                              Coef.        Std. Err.      t-stat
HH wealth                                                    0.0050        0.0020          2.50
# of children 10 or younger                                  0.0033         0.0215         0.15
Years of education of female head                            0.0115         0.0150         0.77
Share of subsidy recipients within 1000m                     0.0180        0.4600         0.04
Share of subsidy recipients within 500m                      0.3260         0.4620         0.71
Share of subsidy recipients within 250 m                     0.1810         0.2470         0.73
Notes: Probit estimates. Dependent Variable: Household purchased ITN. N=634, Pseudo-Rsq= 0.02. p-
value for joint-significance of three neighborhood covariates=0.145




                                                    26
Table 3: Impact Estimates

          (1)                   (2)                 (3)                 (4)                 (5)                 (6)                  (7)
                                                                                                          Bootstrapped Confidence Interval for
                             Share of the     Estimate of Aggregate ITN Take-up…                                  Difference Estimate
  Poverty Line (ϒ)       population eligible    …including          … ignoring
    (in '000s Ksh)         for ITN subsidy      externality         externality         Difference          95% CI, lower       95% CI, upper
            1                    0.014            0.2042              0.2636              -0.059                  -0.115           -0.009
            2                   0.026             0.2104              0.2695              -0.059                 -0.112            -0.009
            3                   0.059             0.2200              0.2853              -0.065                 -0.113            -0.018
            4                   0.098             0.2376              0.3042               -0.067                -0.106            -0.025
            5                    0.133            0.2549              0.3230              -0.068                 -0.108             -0.031
            6                    0.174            0.2767              0.3428              -0.066                 -0.097            -0.034
            7                   0.236             0.3095              0.3708               -0.061                -0.085            -0.035
            8                    0.273            0.3336              0.3896              -0.056                 -0.079            -0.032
            9                    0.316            0.3619              0.4099              -0.048                 -0.067            -0.029
           10                   0.361             0.3958             0.4309               -0.035                -0.049             -0.019
           11                    0.391            0.4205              0.4464              -0.026                 -0.038             -0.012
           12                    0.419            0.4410              0.4585               -0.017                -0.028            -0.006
           13                    0.447            0.4637              0.4721              -0.008                 -0.018             0.003
           14                    0.467            0.4811              0.4820               -0.001                -0.011             0.010
           15                   0.494             0.5009              0.4944               0.007                 -0.005             0.018
           16                    0.514             0.5181             0.5039                0.014                0.000              0.027
           17                   0.538             0.5378              0.5137               0.024                 0.008              0.040
           18                    0.555            0.5550              0.5237                0.031                 0.014             0.047
           19                    0.571            0.5680              0.5296               0.038                  0.019             0.057
          20                    0.598             0.5913              0.5435               0.048                  0.026             0.068
Note: The poverty line is the threshold household wealth below which the household is eligible for the subsidy.




                                                                         27
Table 4: Average and (approximate) marginal returns

           (1)                       (2)                       (3)                         (4)                      (5)                    (6)

   Poverty Line (ϒ)       Share of the population            Average                    Marginal             Marginal return
    (in '000s Ksh)        eligible for ITN subsidy            return                     return              w/o externality           Difference
            1                       0.014                    14.294                      0.536                   0.506                   0.0305
            2                       0.026                      8.127                     0.290                   0.480                  -0.1894
            3                       0.059                      3.734                     0.447                   0.481                  -0.0345
            4                       0.098                      2.419                     0.497                   0.537                  -0.0406
            5                       0.133                      1.916                     0.530                   0.483                   0.0477
            6                       0.174                      1.589                     0.533                   0.455                  0.0780
            7                       0.236                      1.313                     0.642                   0.499                   0.1423
            8                       0.273                      1.221                     0.660                   0.475                   0.1853
            9                       0.316                      1.145                     0.760                   0.470                   0.2891
          10                        0.361                     1.097                      0.815                   0.508                  0.3060
           11                       0.391                      1.075                     0.741                   0.438                   0.3026
           12                       0.419                      1.053                     0.794                   0.476                   0.3179
           13                       0.447                      1.037                     0.887                   0.503                   0.3843
           14                       0.467                     1.030                      0.739                   0.463                   0.2756
           15                       0.494                      1.015                     0.836                   0.467                   0.3691
           16                       0.514                      1.007                     0.816                   0.406                   0.4107
           17                       0.538                     0.999                      1.015                   0.591                   0.4247
           18                       0.555                     0.999                      0.811                   0.362                   0.4496
Notes: The average return is the ratio of the predicted take-up rate (col. 3 of Table 3) to the share of the population eligible for the subsidy. The
(approximate) marginal return is the ratio of the change (between two rows) in predicted take-up rate to the change (between two rows) in the
share eligible for the subsidy.




                                                                            28
References

 [1] Andrews, D. (1994a) Asymptotics for semiparametric econometrics models via stochastic
    equicontinuity, Econometrica, 62, 43-72.

 [2] Andrews, D.W.K. (1994b) Empirical Process Methods in econometrics, Handbook of Econo-
    metrics, Chapter 37, Volume IV (Ed. R.F. Engle and D.L. McFadden), Elsevier Science B.V.

 [3] Angelucci, M. and G. De Giorgi (2008) Indirect eﬀects of an aid program: How do cash
    transfers aﬀect non-eligibles’ consumption? American Economic Review, 99, 486-508.

 [4] Bandiera, O. and I. Rasul (2006) Social networks and technology adoption in northern Mozam-
    bique, Economic Journal, 116-514, 869-902.

 [5] Bhattacharya, D. (2009) Inferring optimal peer allocation using experimental data, Journal of
    the American Statistical Association, 104-486, 486-500.

 [6] Bhattacharya, D. and P. Dupas (2012) Inferring welfare maximizing treatment assignment
    under budget constraints, Journal of Econometrics, 167-1, 168-196.

 [7] Carrell, Scott, B. Sacerdote and James E. West (2012). "From Natural Variation to Optimal
    Policy? The Lucas Critique Meets Peer Eﬀects," mimeo. Dartmouth College.

 [8] Chen, X., O. Linton and I. van Keilegom (2003) Estimation of semiparametric models when
    the criterion function is not smooth, Econometrica, 71, 1591-1608.

 [9] Conley, T. and C.R. Udry (2010) Learning About a New Technology: Pineapple in Ghana,
    American Economic Review, 100, 35-69.

[10] Dehejia, R.H. (2005) Program evaluation as a decision problem, Journal of Econometrics, 125,
    141-173.

[11] Dupas, P. (2009) What matters (and what does not) in households’ decision to invest in malaria
    prevention? American Economic Review, 99-2, 224-230.

[12] Dupas, P. (2012) Short-Run Subsidies and Long-Run Adoption of New Health Products: Ev-
    idence from a field experiment, Working Paper.




                                                29
[13] Kong, E., O. Linton and Y. Xia (2010) Uniform Bahadur representation for local polynomial
    estimates of M-regression and its application to the additive model, Econometric Theory, 26,
    1529-1564.

[14] Graham, B.S. (2011) Econometric methods for the analysis of assignment problems in the
    presence of complementarity and social spillovers, Handbook of Social Economics, 1B (Ed. J.
    Benhabib, A. Bisin and M. Jackson), 965-1052, North-Holland.

[15] Hahn, J. and G. Ridder (2012) The asymptotic variance of semi-parametric estimators with
    generated regressors, forthcoming in Econometrica.

[16] Hansen, B.E. (2008) Uniform convergence rates for kernel estimation with dependent data,
    Econometric Theory, 24, 726-748.

[17] Hawley, W.A., P.A. Phillips-Howard, F.O. ter Kuile, D.J. Terlouw, J.M. Vulule, M. Ombok,
    B.L. Nahlen, J.E. Gimnig, S.K. Kariuki, M.S. Kolczak, A.W. Hightower (2003) Community-
    wide eﬀects of permethrin-treated bed nets on child mortality and malaria morbidity in western
    Kenya, American Journal of Tropical Medicine and Hygiene, 68 (4 Suppl), 121-127.

[18] Hirano, K. and J. Porter (2009) Asymptotics for Statistical Treatment Rules, Econometrica,
    77-5, 1683-1701.

[19] Hudgens, M.G. and M.E. Halloram (2008) Toward Causal Inference With Interference, Journal
    of the American Statistical Association, 103-482, 832-842.

[20] Kanaya, S. (2012) Uniform convergence rates of kernel-based nonparametric estimators for
    diﬀusion processes: A damping function approach, Working Paper, University of Oxford.

[21] Killeen, G.F., T.A. Smith, H. M. Ferguson, H. Mshinda, S. Abdulla, C. Lengeler and S.P.
    Kachur (2007) Preventing childhood malaria in Africa by protecting adults from mosquitoes
    with insecticide-treated nets, PLoS Medicine, 4-7, e229.

[22] Lengeler, C. (2004) Insecticide-treated bed nets and curtains for preventing malaria, Cochrane
    Database of Systematic Reviews, 2, Art. No. CD000363.

[23] Mammen, E., C. Rothe and M. Schienle (2012) Semiparametric estimation with generated
    covariates, Working Paper, Toulouse School of Economics.




                                                30
[24] Manski, C. (2004) Statistical Treatment Rules for Heterogeneous Populations, Econometrica,
    72-4, 1221-1246.

[25] Manski, Charles F. (2007) Identification for Prediction and Decision, Harvard University Press,
    Cambridge, MA.

[26] Manski, C. (2010) Identification of treatment response with social interactions, CeMMAP
    working paper CWP01/10, Centre for Microdata Methods and Practice, Institute for Fiscal
    Studies.

[27] Miguel, E., and M. Kremer (2004) Worms: Identifying impacts on education and health in the
    presence of treatment externalities, Econometrica, 72, 159-217.

[28] Mosimann, J.E. (1962) On the compound multinomial distribution, the multivariate beta-
    distribution, and correlations among proportions, Biometrika, 49, 65-82.

[29] Murray, C.J.L, L.C. Rosenfeld, S.S. Lim, K.G. Andrews, K.J. Foreman, D. Haring, N. Fullman,
    M. Naghavi, R. Lozano and A.D. Lopez (2012) Global malaria mortality between 1980 and
    2010: a systematic analysis, The Lancet, 379-9814, 413-431.

[30] Newey, W. (1994) The asymptotic variance of semiparametric estimators, Econometrica, 62,
    1349-1382.

[31] Newey, W. and D.L. McFadden (1994) Large sample estimation and hypothesis testing, Hand-
    book of Econometrics, Chapter 36, Volume IV (Ed. R.F. Engle and D.L. McFadden), Elsevier
    Science B.V.

[32] Pagan, A. and A. Ullah (1999) Nonparametric Econometrics, Cambridge University Press.

[33] Root, E.D., S. Giebultowicz, M. Ali, M. Yunus and M. Emch (2011) The Role of Vaccine
    Coverage within Social Networks in Cholera Vaccine Eﬃcacy, PLoS ONE, 6-7: e22971.

[34] Rosenbaum, P. (2007) Interference Between Units in Randomized Experiments, Journal of the
    American Statistical Association, 102-477, 191-200.

[35] Stoye, J (2009) Minimax Regret Treatment Choice with Finite Samples, Journal of Economet-
    rics, 151, 70-81.




                                                 31
[36] Tetenov, A. (2008) Statistical treatment choice based on asymmetric minmax regrest criterion,
    forthcoming in Journal of Econometrics.

[37] Van der Vaart, A.W. and J. Wellner (1996) Weak Convergence and Empirical Processes: With
    Applications to Statistics, Springer.

[38] Van der Vaart, A.W. (1998) Asymptotic Statistics, Cambridge University Press.

[39] Webster, J., J. Lines and L. Smith (2007) Protecting all pregnant women and children under
    five years living in malaria endemic areas in Africa with insecticide treated mosquito nets,
    Working Paper, World Health Organization.

[40] White, H. (1994) Estimation, Inference and Specification Analysis, Cambridge University
    Press.

[41] WHO (2008) World Malaria Report 2008, World Health Organization, Geneva.




                                                32
A       Appendix

This appendix is divided into two subsections — the first subsection dealing with Theorem 1 and the
second one with Theorem 2. In this Appendix, terminologies related to empirical process theory
follow those of van der Vaart and Wellner (1996), which is hereafter referred to as VW (1996).


A.1      Lemmas and proofs for Theorem 1

Step 1: Linearization of the nonparametric estimators ŝ () and ŝ ().

Lemma 1 Suppose that Assumptions 1-2 hold. Then,
                                                             X
             sup()∈L×[∞) |̂ ( ) − ∗ ( )| = −1        (   ) +  ((ln ) );                                     (17)
                                                              =1
                             ¯                       ¯       X
            sup()∈L×[∞) ¯̂ ( ) − ∗ ( )¯ = −1        (   ) +  ((ln ) )                                   (18)
                                                                                =1


where

                       (   ) : = 1{|| −  || ≤ } [ − ∗ ( )] ∗ ( ) ;                                                 (19)
                                                           £                           ¤
                      (   ) : = 1{|| −  || ≤ } 1 {1  } − ∗ ( ) ∗ ( ) ;                                        (20)

∗ ( ) is defined in (5); and we note that  and  are subcomponents of  (= (  0    0 )0 ).
Furthermore, it also holds that
                                                                                p
                             sup()∈L×[∞) |̂ ( ) − ∗ ( )| =  ( (ln ) );
                                             ¯                       ¯          p
                            sup()∈L×[∞) ¯̂ ( ) − ∗ ( )¯ =  ( (ln ) )

    These linearized expressions have some resemblance to the Bahadur expression for kernel-based
estimation (see, e.g., Sections 3.3-3.4 of Pagan and Ullah, 1999; Kong, Linton and Xia, 2010).
However, we do not consider the localization, and therefore the convergence rates in (17) and (18)
are much faster. By this lemma, we have

                             √                         √ X
                              [ŝ () − s∗ ()] = (1 )       ξ (  ) +  (1) ;                                                 (21)
                                                            =1
                            √                          √   X
                             [ŝ () − s∗ ()] = (1 )      ξ (  ) +  (1)                                                 (22)
                                                                             =1


uniformly over  ∈ L, where

      ξ (  ) := ( (   1 )       (    ))0 ;   ξ (  ) := (  (   1 )        (    ))0 



                                                                     33
The former result (21) allows us to derive the linearized expression of η̂ − η ∗ , while the latter (22)
is used to derive that of the nonparametric component of ρ̂ ( ) − ρ∗ ( ) in (12).
   Proof of Lemma 1. Since we can show (17) and (18) exactly in the same manner, we only
consider the former. Let
                           P
       ̂ ( ) : = −1      =1 1{||   −  || ≤ };
                           P
       ̂ ( ) : = −1      =1 1{||   −  || ≤ } ; and ∗ ( ) :=  [1{|| −  || ≤ } ] 

Then, we can write
                                                                          ∙                          ¸
                                          ̂ ( ) − ̂ ( ) ∗ ( )      ∗ ( ) − ̂ ( )
                ̂ ( ) − ∗ ( ) =                                    1 +                         
                                                     ∗ ( )                       ̂ ( )
where ∗ ( ) is defined in (5). By noting the fact that
                                                         P
                 ̂ ( ) − ̂ ( ) ∗ ( ) = −1     =1 1{||   −  || ≤ } [ − ∗ (|)]

and using the following results:
                                      ¯                              ¯          p
                    sup()∈L×(0∞) ¯̂ ( ) − ̂ ( ) ∗ ( )¯ =  ( ln );                  (23)
                                                ¯                    ¯         p
                            sup()∈L×(0∞) ¯̂ ( ) − ∗ ( )¯ =  ( ln );                     (24)
                                                                                p
                           sup()∈L×(0∞) |̂ ( ) − ∗ ( )| =  ( ln );                     (25)

                                       sup()∈L×[∞) 1̂ ( ) =  (1)                           (26)

whose proofs are provided below, we can obtain the desired result (17).

   We can easily check that (26) holds by the boundedness condition of (14) and the result (25).
   We now show the three convergence results (23)-(25). Since these can be proved in the same
manner, we only consider the last one (25). Denote by F the following set of functions indexed
by ( ) ∈ L × (0 ∞): F := { (| ) |  ∈ L and   0}, where L is a set of latitude-longitude
points on the earth surface; each  (·| ) is a function with the form  (| ) := 1 {|| − || ≤ };
|| − || = || − ||L measures a distance between two points  and  on L. Recall that we have
assumed that the earth is a sphere and || − || measures the shortest distance between  and  on
the sphere (Footnote 5), and therefore, the number of all closed balls on L is bounded by that of
all closed balls in R3 (a ball in R3 is defined with respect to the standard Euclidean norm). By (ii)
of Lemma 9.12 of Kosorok (2008), the set of all closed balls in R3 is a VC-class of index 6.
   Let A denote the set of all closed balls on L. Then, it obviously holds that F ⊂ {1 (·) |  ∈ A}
where 1 (·) is an indicator function (1 () = 1 if  ∈  and = 0 otherwise). Then, by using the


                                                           34
fact that the VC index of A is bounded by 6, together with Theorem 9.2 of Kosorok (2008), the
covering number of the set of functions F satisfies

                             sup  ( F  ()) ≤ Λ−5 for  ∈ (0 1)                          (27)

where  ( F  ()) stands for the  covering number of the set of function F (for the definition,
see Section 2.2.2 of Kosorok, 2008 or Section 2.2.1 of VW, 1996); the supremum is over all probability
measures on L; and Λ ( 0) is some constant independent of . Now, using (27), the Bernstein
exponential inequality (see, e.g., page 102 of VW, 1996) and the Borel-Cantelli lemma as in (Hansen,
2008, Proofs of Theorems 2 and 3) and Kanaya (2012, Proof of Theorem 4), we can easily show the
desired result (25), where we note that the number of  () -balls needed to cover F is finite with
the polynomial order (at most) while the convergence of relevant probabilities has an exponential
decay. Now, the proof of Lemma 1 is completed.
    Step 2: Quantifying eﬀects on η̂ of preliminary estimation of s∗ .
    To investigate asymptotic behavior of the parametric component η̂ − η ∗ , we define our QML
estimator η̂ as the solution to the following equation (the first-order condition of the maximization
problem in (9)):
                                 n       ¯    P                             o
                            η̂ := η ∈R ¯ −1 =1 m (  η ŝ ( )) = 0                       (28)

where m is a  -dimensional (column) vector of functions:

                                  m ( η s ()) = (η)  ( η s ()) 

By the convexity property of the function , we can easily check the existence of η̂ and its uniqueness
(for given ŝ (·)) and we here define the (pseudo) true parameter (η∗  s∗ (·)) as the one satisfying the
following population moment equation:

                                         [m (  η ∗  s∗ ( ))] = 0                            (29)

    The interpretation of η̂ as a moment-based estimator in (28) helps us to find a linearized
(asymptotic) expression of η̂ − η∗ . One can usually obtain linearized expressions for standard
parametric estimators by using Taylor expression arguments. This is also the case here. However,
our estimator η̂ depends up on the preliminary estimation of ŝ, and we need to quantify its eﬀect.
This can be done by Newey’ (1994) pathwise derivative method, which allows us to obtain a so-
called correction term (i.e., a term capturing the eﬀect of preliminary estimation in the linearized
expression of η̂ − η ∗ ).


                                                      35
   Pathwise derivative method: Let F be the set of all distribution functions of  , and
{ :  ∈ F} be a one-dimensional subfamily of F, i.e., a path in F (indexed by  ∈ R), and also let
 [·] denote the expectation at the distribution  . We let  = 0 =  |=0 the true distribution,
and  [·] (= 0 [·]) denote the expectation at the true 0 . Suppose that  has a density  (with
respect to some dominating measure which is common for all  ). Let  () :=  ln ( ) .
Then, 0 () =  ln ( ) |=0 is called a score corresponding to  , where we also suppose
that  [| ( )|2 ]  ∞ for each .
   Our nonparametric estimator ̂ ( ) for each ( ) is a moment estimator which solves the
moment condition:  [1 {|| − || ≤ } [ −  ( )]] = 0. Therefore, we can see ̂ ( ) as the
sample counterpart of the following (population) quantity:

                                                    [1 {|| − || ≤ }  ]
                                  ( | ) :=                                                    (30)
                                                     [1 {|| − || ≤ }]

when  ∼  .
   When  ∼  , our (finite-dimensional) parameter of interest, η ∗ = η ∗ (), solves the following
population moment equation:
                                          [m (  η s ( | ))] = 0

which corresponds to equation (3.8) in Newey (1994). If we can find some function α such that

            ()  [m (  η∗  s ( | ))]|=0 =  [α ( ) 0 ( )] and  [α ( )] = 0    (31)

then we can obtain the linear expression (or influence function) of the estimator η̂ (see equation
(3.10) in Newey, 1994). α ( ) satisfying (31) is called a correction term (in Newey’s terminology).
We below present a way for deriving this correction term.
   Given the expression (30) under  ∼  , we are able to calculate
                                                  ½
                                               −2
()  ( | ) = { [1 {|| − || ≤ }]}     [ 1 {|| − || ≤ }  ( )]  [1 {|| − || ≤ }]
                                                                                  ¾
                      − [ 1 {|| − || ≤ }]  [1 {|| − || ≤ }  ( )] 

which quantifies the influence of the infinitesimal change of  on  ( | ) at  . Let

                          (   ) = 1{|| − || ≤ }[ − ∗ ( )]∗ ( ) 

as defined in (19), then, we can write

                  ()  ( |0 ) = ()  ( | )|=0 =  [ (   ) 0 ( )]       (32)


                                                        36
For notational convenience, define the following vectors of functions:

      s (| ) := ( ( 1 | )       (  | ))0 and ξ (  ) := ( (   1 )      (    ))0 

We also define a  -by- matrix of functions as

                                        D̄∗ () := (s) m ( η ∗  s)|s=s∗ () 

where we note that s∗ () = s (|0 ).
    Given these, we have
                                                         £                                  ¤
            ()  [m (  η ∗  s ( | ))]|=0 =  D̄∗ ( ) () s ( | )|=0
                                                         £                                        ¤
                                                      =  D̄∗ ( )  [ξ (   ) 0 ( ) | ]
                                                         £                                         ¤
                                                      =  D̄∗ ( )  [ξ (   ) 0 ( ) | ]
                                                         £ £                            ¤            ¤
                                                      =   D̄∗ ( ) ξ (   ) | 0 ( )

                                                              =  [α ( ) 0 ( )]                                          (33)

where the second equality follows from (32) and the definition of the column vector ξ (  ); and
the third holds since  is a subcomponent of  ; and the fourth holds due to the law of repeated
conditional expectations. The last equality in (33) holds with
                                                 "                   ¯                     #
                                                                    ¯
                      ∗
    α () : = [D̄ ( ) ξ (  )] =               m (  η  s)¯¯
                                                               ∗
                                                                                 ξ (  )
                                                   s                 s=s∗ ( )
                 ∙                   ¯
                                    ¯
           =         m (  η  s)¯¯
                                ∗
                   s                 s=s∗ ( )
                 µ                                                                                          ¶¸
                   1 {|| −  || ≤ 1 } [ − ∗ (  1 )]       1 {|| −  || ≤  } [ − ∗ (   )] 0
               ×                                                                                          (34)
                                  ∗ (  1 )                                     ∗ (   )

which is a  -dimensional column vector of functions, where we note that  and  are subcomponents
of  (recall  = (  0    0 )0 ). By the I.I.D. condition, we can check

             ()  [m (  η ∗  s ( | ))]|=0 =  [α ( ) 0 ( )] =  [α ( ) 0 ( )] 

and  [α ( )] (=  [α ( )]) = 0.

Remark 2 The calculation of the pathwise derivative ()  [m (  η ∗  s ( | ))]|=0 in (33) is
basically a chain rule. However, unlike a standard simple case for composite functions, we need to
consider an involved object, i.e., the expectation of a composite function. In this case, a derivative
calculation rule is still similar to a standard one, but we use the use of the law of conditional


                                                               37
expectations. This calculation method seems to have general applicability to several other cases, as
long as a preliminary estimator aﬀects the next step only through its values at observations (ŝ ( )
in our case). If one can obtain the pathwise derivative of the preliminary estimator, which is not
diﬃcult in many cases, we can almost immediately derive the form of the correction term by the
law of repeated conditional expectations.

Remark 3 Given the form of the correction term as in (34), we need to verify that it indeed
constitutes the asymptotic linear expression of [η̂ − η ∗ ]. This can be done by direct calculations as
in our proof of Lemma 3 below.

   Step 3: Linearization of the parametric component η̂.
   By the boundedness of relevant functions and their derivatives as well as the uniform convergence
of the nonparametric first step estimator ŝ (·), we can easily prove the consistency of η̂ for η ∗ (note
that by the convexity, we can restrict the domain of η as some compact neighborhood of η ∗ , which
we denote by C (⊂ R )). By using the Taylor-expansion arguments, we can write

      √                           √ X                                     ¡ √ ¢
       [η̂ − η∗ ] = − [M∗ ]−1 (1 )          m (  η∗  ŝ ( )) +  1 
                                           =1
           ∗ −1     √ nX                 ∗ ∗
                                                        X                                      o
    = − [M ] (1 )              m (  η  s ( )) +          D̄∗ ( ) [ŝ ( ) − s∗ ( )] +  (1)(35)
                                                                                                          
                                 =1                            =1


where M∗ is the limit Hessian matrix of the objective function defined as

                       £¡ 2        ¢                       ¤   £¡    ¢                       ¤
            M∗ :=        η 0 η  (  η ∗  s∗ ( )) =  η0 m (  η ∗  s∗ ( ))          (36)

and D̄∗ (·) is a matrix-valued function defined as

                                           ¡     ¢             ¯
                                 D̄∗ () := s0 m ( η∗  s)¯s=s∗ ()                               (37)

This result (35) is formally stated below as Lemma 2.

   We note that while the first term inside the curly brackets on the right-hand side (RHS) of
(35) is the score function for the fully parametric case with s∗ (·) known, the second term captures
the eﬀect due to the nonparametrically estimated component. We can verify that this second term
can be actually replaced with the correction term derived in Step 2, and as a result, the main
component on the RHS of (35) can be written as an empirical process. That is, we have

                             √                  √ X
                              [η̂ − η ∗ ] = (1 )  ψ ( ) +  (1)                                  (38)
                                                          =1




                                                     38
where ψ is the influence function defined as

                             ψ ( ) := −[M∗ ]−1 {m (  η ∗  s∗ ( )) + α ( )}                               (39)

Lemma 3 (presented below), together with Lemma 2, formally proves the validity of this linearized
expression (38).
   As stated previously, the term α in (39) is called a "correction term", since it corrects sampling
errors stemming from the preliminary nonparametric estimation, which are additional to usual
sampling errors in standard parametric estimation. The sum of m and α left-multiplied by −[M∗ ]−1
is called the influence function of η̂, which fully characterizes the (first-order) asymptotic properties
of the estimator η̂.


Lemma 2 Suppose that Assumptions 1-3 hold. Then,
         √
           [η̂ − η ∗ ]
                   √ nX                           X                                o
    = − [M∗ ]−1 (1 )   m (  η ∗  s∗ ( )) +    D̄∗ ( ) [ŝ ( ) − s∗ ( )] +  (1)(40)
                                                                                               
                                    =1                              =1

where M∗ and D̄∗ are defined in (36) and (37), respectively.

   Proof. First, we claim the consistency of η̂, that is, |η̂−η∗ | =  (1) (η ∗ is defined in (29)).
The proof of this result is omitted for the sake of brevity (it can be easily shown by using arguments
similar to those in this proof and in the proof of Lemma 3.
   By the definition of our semiparametric estimator η̂ and the Taylor expansion , we have
            √ X
     0 = (1 )     m (  η̂ ŝ ( ))
                =1
            √ X                                  X ¡      ¢                     √
       = (1 )     m (  η ∗  ŝ ( )) + −1     η 0 m (  η̃ ŝ ( ))  [η̂ − η ∗ ]  (41)
                           =1                                 =1

where η̃ is on the linesegment connecting to η̂ to η ∗ (it may be diﬀerent for a diﬀerent element of
(η 0 ) m).
                                                                P
   We now consider the limit of the component −1                    =1 (η
                                                                                 0 ) m (  η̃ ŝ ( )).
                                                                                                          To this end,
note that by the convexity property of the function , which is induced by the functional form
of Φ (the C.D.F. of the standard normal), we may restrict the parameter space of η to some
compact neighborhood of η ∗ in R . We denote by ∗ this compact neighborhood. For notational
simplicity, we write
                                     ¡      ¢                     ¡            ¢
                h (  η s ( )) = η 0 m (  η s ( )) =  2 η 0 η  (  η s ( )) 


                                                         39
and denote by  (  η s ( )) each element of the matrix h with 1 ≤   ≤  . Then, by the
Taylor expansion again, we have
                X
         −1            (  η ŝ ( ))
               =1
              X                                       X      ¡        ¢                ¯
     =    −1
                        (  η s∗ ( )) + −1               s0  (  η s)¯s=s̃( ) [ŝ ( ) − s∗ ( )]
                 =1                                     =1                                     
                X                                     p
           −1                         ∗
     =                 (  η s ( )) +  ( (log )) uniformly over η ∈∗                            (42)
                 =1


for each ( ) element, where s̃ ( ) is on the linesegment connecting ŝ ( ) to s∗ ( ), and the
last equality holds since (s0 ) ( η s) is uniformly bounded over  η and s (recall that the
functional form of Φ and the linear specification in (7) and (8)) and
                                                      p
                             ŝ () − s∗ () =  ( (log )) uniformly over                                    (43)

(this can be easily shown by using arguments similar to those in the proof of Lemma 1).
                                                                                    P
    Given the result (42), we next consider the uniform law of large numbers for −1 =1  (  η s∗ ( )).
By the specification of  with the C.D.F. of the standard normal Φ (in (7) and (8)), as well as the
boundedness condition of the support of  (in Assumption 3), we can see that  (  η s∗ ( ))
is Lipschitz continuous with respect to η (with a Lipschitz constant uniform over η ∈∗ ). There-
                                             P
fore, together with the I.I.D. condition, −1 =1  (  η s∗ ( )) is stochastically equicontinuous
(over η ∈∗ ). Note also that  [ (  η s∗ ( ))] is continuous uniformly over η ∈∗ . Then,
by the law of large numbers (recall the I.I.D. condition) and the compactness of the parameter
space ∗ , we have
                      ¯    X                                                      ¯
                      ¯                                                            ¯
             sup∈∗ ¯−1     (  η s∗ ( )) −  [ (  η s∗ ( ))]¯ =  (1)                        (44)
                                    =1


for each ( ). By the consistency of η̂, (42) and (44), together with recalling the definition of
M∗ ( ) (given in (36)) and that of  (given earlier in this proof), we now obtain
                                          X ¡      ¢                     
                                  −1         η 0 m (  η̃ŝ ( )) → M∗                                       (45)
                                             =1


   Therefore, by this and (41), together with the Taylor expansion, we have

                       √                       √ X
          [M∗ +  (1)]  [η̂ − η∗ ] = −(1 )             m (  η ∗  ŝ ( ))
                                                       =1
                          (                                           ¯                                 )
              √ X                                                   ¯
        = −(1 )          m (  η ∗  s∗ ( )) + 0 m ( η ∗  s)¯¯            [ŝ ( ) − s∗ ( )] 
                      =1                           s                       ∗
                                                                       s=s ( )
              ³√                                                                                         ´
          +      max1≤≤ max1≤≤ sups(·) | (  η  s ( ))| × [ŝ ( ) − s∗ ( )]2  (46)
                                                                ∗




                                                          40
where the supremum in the last line is taken over the set of [0 1]-valued functions on  ∈ L. By
the specification of  and the boundedness condition (in Assumption 3),  ( η s) is uniformly
bounded (over ( η s)). Also, by (43), sup [ŝ () − s∗ ()]2 =  ((log )). Therefore, the second
                                                     √
component on the RHS of (46) is  ((log ) ) =  (1). Finally, recalling the definition of
D̄∗ () in (37) and noting the invertibility of M∗ , which follows from the convexity property of 
and the non linear-dependence condition in Assumption 1, we obtain the desired result (40). This
completes the proof of Lemma 2.

Lemma 3 Suppose that Assumptions 1-3. Then, it holds that

                 √ X                                      √ X
              (1 )  D̄∗ ( ) [ŝ ( ) − s∗ ( )] = (1 )  α ( ) +  (1)                     (47)
                             =1                                              =1


with  [α ( )] = 0 and [||α ( )||2 ]  ∞, where α (·) is a vector-valued function defined as
                                                                         ¯
                               £ ∗               ¤                      ¯
                 α () : =  D̄ ( ) ξ (  ) = [ 0 m (  η  s)¯¯
                                                                     ∗
                                                                                      ξ (  )]; (48)
                                                         s                s=s∗ ( )
              ξ (  ) : = ( (   1 )       (    ))0 ;                           (49)

             (   ) : = 1 {|| − || ≤  } [ − ∗ (  )] ∗ (  ) ;

and we note that  and  are subcomponents of  = ( 0   0 )0 and the functional form of  (· · )
defined here is the same as that defined in (19).

   The proof of the lemma follows subsequently. Note that the left-hand side (LHS) of (47) includes
an infinite-dimensional component, ŝ () − s∗ (). To handle this sort of object (and verify a result
like (47)), we use some U-statistic-like arguments.
   Proof of Lemma 3. First, we check the moment conditions of α ( ). By the boundedness of
the support of  and the specification of Φ (in Assumption 3), D̄∗ () is uniformly bounded over
the support of  . Also, by Assumption 2, | (  )| ≤ 2 uniformly over (  ). Therefore,
α () is uniformly bounded over the support of  and [||α ( )||2 ]  ∞. By the definition of
α () and ξ (  ) (given in (48) and (49)), we can easily see that [α ( )] = 0 (recall also the
way we have derived the form of α (·) in (33)).
   Next, we verify the equality in (47). By the uniform convergence result (17) in Lemma 1, we
have

                     ¡ √ ¢ X
                      1       D̄∗ ( ) [ŝ ( ) − s∗ ( )]
                            =1
                     ¡ √ ¢ X                   X                                   √
                   = 1        D̄∗ ( ) [−1            ξ (   )] +  ((ln ) )             (50)
                                       =1                       =1



                                                            41
By the definition of α (·) given in (48), we can write
                      X                Z             X
                              α ( ) = D̄∗ () [−1                           ξ (  )]∗ () 
                                =1                                      =1

By using this and letting
                                                                   Z
                                             ∗
                        a ( ) := D̄ ( ) ξ (   ) −            D̄∗ () ξ (  ) ∗ () 

we can also write
             ¡ √ ¢ nX                    X                     X              o
              1         D̄∗ ( ) [−1         ξ (   )] −          α ( )
                      =1                   =1                      =1
                                      ½                         Z                        ¾
             ¡ √ ¢ −1 X X               ∗                           ∗               ∗
           = 1                       D̄ ( ) ξ (   ) − D̄ () ξ (  )  ()
                         =1     =1
             ¡ √ ¢    nX                 XX                            o         ¡ √ ¢
           = 1  −1          a ( ) +                      a ( ) =  1  =  (1)  (51)
                                      =1                    1≤≤; 6=

where the last equality holds since [||a ( )||2 ] =  (1) (uniformly over any , which follows from
the boundedness of relevant functions) and
                                             PP                                    ¡ ¢
                                      [||       1≤≤; 6=   a ( ) ||2 ] =  2                     (52)

We can see that this result (52) holds true by noting the following expansion:
           PP
    [||       1≤≤; 6=   a ( ) ||2 ] =  ( − 1) {[a (1 2)0 a (1 2)] + [a (1 2)0 a (2 1)]}

    + ( − 1) ( − 2) {[a (1 2)0 a (1 3)] + [a (1 2)0 a (3 1)] + [a (1 2)0 a (2 3)] + [a (1 2)0 a (3 2)]}

    + ( − 1) ( − 2) ( − 3) [a (1 2)0 ] [a (3 4)]                                                          (53)

where ||·|| stands for the usual Euclidean norm; the equality holds by the I.I.D. condition; the
second and third terms on the right-hand side are zero since  [a ( ) | ] =  [a ( ) | ] = 0
for any  6= ; and it holds that [a (1 2)0 a (1 2)] =  (1) and [a (1 2)0 a (2 1)] =  (1) by the
boundedness of the relevant functions. Now, by (50) and (51), we obtain the desired result (47).
                                                                   √
   Step 4: Functional CLT of Ĝ and weak convergence of [ρ̂ − ρ∗ ].
   Recall the definitions of ρ̂ and ρ∗ stated in defining (12). Then, by (22) and (38) together
with the definition of the E.D.F., we have uniformly over ( ) ∈ X × L,
                                  √
                                   [ρ̂ ( ) − ρ∗ ( )] = Ĝ ( ) +  (1)                        (54)

where
                                                                    ⎛                  ⎞
                                                        ⎜
                                                                          ψ ( )
                                                  √ X                                  ⎟
                                                          ⎜                            ⎟
                                Ĝ ( ) : = (1 )     ⎜ ξ (  )                ⎟;                   (55)
                                                          ⎝                            ⎠
                                                      =1
                                                             (   )
                                                                   ∗
                            (   ) : = 1{ ≤  &  ≤ } −  ( ) ;


                                                             42
                                                                                     √
From this expression, we can see that the asymptotic properties of                    [ρ̂ − ρ∗ ] are determined by
those of Ĝ . We below prove a functional CLT of this Ĝ , i.e., the weak convergence of Ĝ to a
tight Gaussian process. To formally prove the FCLT result, we hereafter work as if L (the range
of  ) is a bounded subset of R2 , while L is in fact a set of latitude-longitude points on the sphere.
Accordingly, we regard ∗ (· ), ∗ (· ), 
                                              ∗ ( ·) and all relevant functions as functions on (the


subset of) R2 . This way of treating L (and the functions on L) is possible by decimalizing a pair
of latitude-longitude figures appropriately, if L does not include any band or ring surrounding the
sphere.15 Also, note that this way does not at all restrict a way of calculating/defining a distance
on L. We can still use a distance measured along a path on the sphere’s surface (say, one based on
the Haversine formula), but by (re-)defining the relevant function as functions on R2 , we can easily
define some continuity properties of functions.16
       We now derive the weak convergence of Ĝ (as elements of ∞ (X × L), which denotes the
set of all bounded (2 + 3 + 1)-dimensional vector-valued functions, X × L(⊂ R × R2 ) →
R2 +3+1 ).17 While our main purpose is an inference on ̂ (), we are also interested in examining
whether it diﬀers from ̃ (), i.e., the eﬀect of taking into account the externality. To implement
an econometric inference jointly on ̂ () and ̃ (), we also consider the joint result of ρ̂ ( )
          0   0
and (̃ 0  ̃ 1 )0 , which is useful to derive the joint asymptotic distribution of (̂ ()  ̃ ())0 .

Lemma 4 Suppose that Assumptions 1-5.
Then, (i) it holds that
                                                       Ĝ =⇒ G∗                                                    (56)

for each , where =⇒ denotes the weak convergence; the weak convergence takes place in ∞ (X ×L);
∞ (X × L) is the set of all vector-valued bounded maps, X × L(⊂ R × R2 ) → R2 +3+1 );
  15
       For example, it is possible if L is the set of all points satisfying 45◦ N ≤ latitude ≤ 55◦ N and 5◦ S ≤ longtitude ≤
15◦ E; but not if L is the set of all points satisfying 45◦ N ≤ latitude ≤ 55◦ N. For the latter, L is a latitude "band"
surrounding the sphere, and it is hard to think of its projection on R2 since the points of 180◦ E (+180) are also those
of 180◦ S (−180).
  16
     For example, in defining the right continuity of  (· ·), we should consider that  (· ·) is a function on (a
subset of) R × R2 .
  17
     Note that in empirical process theory, it is often standard to consider a set of functions as an index set (rather
than X × L, a subset of R × R2 , as here). To verify the desired weak convergence result in our subsequent proof, we
actually consider such a set of functions F (defined in (57)). However, the weak convergence in ∞ (F) (the space of
all bounded (2 + 3 + 1)-dimensional vectors of maps, F → R2 +3+1 ) implies that in ∞ (X × L) under standard
conditions (see Section 19.5 of van der Vaart, 1998). Therefore, we can work here without explicitly defining some
set of functions as an index set.



                                                              43
Ĝ = {Ĝ ( )}()∈X ×L ; and G∗ = {G∗ ( )}()∈X ×L is a tight mean-zero Gaussian process
(indexed by ( ) ∈ X × L, for each ) whose covariance kernel Λ∗ is given as
                                                          ⎡⎛                       ⎞⎛                    ⎞0 ⎤
                                                                      ψ ( )               ψ( )
                                                        ⎢⎜                         ⎟⎜                    ⎟⎥
                                                        ⎢⎜                         ⎟⎜                    ⎟⎥
                     Λ∗ ((1  1 )  (2  2 )) :=  ⎢⎜ ξ (  1 )           ⎟ ⎜ ξ (  2 )     ⎟ ⎥
                                                        ⎣⎝                         ⎠⎝                    ⎠⎦
                                                           (  1  1 )           (  2  2 )


(ii) It holds that
                                                  √
                                                   [ρ̂ − ρ∗ ] =⇒ G∗ 

for each , where [ρ̂ − ρ∗ ] = {[ρ̂ ( ) − ρ∗ ( )]}()∈X ×L ; and the weak convergence takes place
in the space ∞ (X × L).
(iii) It also holds that                  ⎛                                       ⎞
                                      √                   ρ̂ − ρ∗
                                       ⎝         0      0
                                                                                  ⎠ =⇒ H∗ 
                                              (̃ 0  ̃ 1 )0   − ( ∗∗0  ∗∗0 0
                                                                     0  1 )

where the weak convergence takes place in the space of ¯∞ (X × L), the set of all vector-valued
bounded maps, X × L(⊂ R × R2 ) → R4 +3+1 ); and H∗ = {H∗ ( )}()∈X ×L is a tight mean-
zero Gaussian process (indexed by ( ) ∈ X × L, for each ; the first 2 + 3 + 1 components of
H∗ ( ) coincide with G∗ ( )) whose covariance kernel is given as
                                                    ⎡⎛                             ⎞⎛                     ⎞0 ⎤
                                                    ⎢⎜   ψ ( )                           ψ( )
                                                    ⎢⎜                             ⎟⎜                     ⎟⎥
                                                    ⎢⎜ ξ (  1 )                ⎟⎜                     ⎟⎥
                                                    ⎢                              ⎟⎜     ξ (  2 ) ⎟ ⎥
                 Π∗ ((1  1 )  (2  2 )) :=  ⎢⎜
                                                                                  ⎟⎜                     ⎟⎥
                                                     ⎜
                                                    ⎢⎜ (     )               ⎟⎜                     ⎟ ⎥;
                                                    ⎢⎝                             ⎟⎜    (  2  2 ) ⎟ ⎥
                                                    ⎣
                                                            1 1
                                                                                   ⎠⎝                     ⎠⎥ ⎦
                                                         ψ̄ ( )                          ψ̄ ( )
                             £    ¤−1                             £¡     ¢                 ¤
                ψ̄ ( ) := − M̄∗     m (  η̄ ∗  0) ; M̄∗ :=  η 0 m (  η̄ ∗  0) 

   Proof. We can check the (uniform) validity of the linear representation in (15) by the results
proved in Lemmas 1, 2 and 3. Therefore, given the part (i) of the lemma, the result (ii) follows
immediately by using standard results on stochastic convergence (see, e.g., (iv) of Theorem 18.10
in van der Vaart, 1998) and we omit details. We also omit the proof of the part (iii) for brevity,
which is quite analogous to the proof of the parts (i) and (ii).
   To prove the result (i), we consider the following set of functions:

                                    F = {(ψ (·)  ξ (· )0   (·  ))0 }()∈X ×L                        (57)



                                                                    44
Given this, in order to obtain the weak convergence of {G∗ ( )}()∈X ×L in the space ∞ (X × L),
we follow the same strategy as in the proof of Theorem 19.28 of van der Vaart (1998) (or that as
in Theorem 2.11.22 of VW, 1996). While van der Vaart’s theorem deals with a set of univariate
(real-valued) functions, it can be easily extended to the multivariate (vector-valued) function case.
We omit the proof for the multivariate case (since it is a trivial modification of van der Vaart’s
proof), but we can verify the weak convergence result for the multivariate case by checking the
following four conditions (in addition to the I.I.D. condition in Assumption 1): (I) There exists
some (pseudo) metric  with which the space T (= X × L) is a totally bounded. (II) For any
f  f ∈F, it holds that

                        sup() ; ∈T [||f ( ) − f ( ) ||2 ] → 0 as   → 0           (58)

where ||·|| stands for the usual Euclid norm. (III) supf ∈F sup∈Z ||f () ||  ∞, where Z denotes the
support of a random vector  . (IV) Let F be each -th element of F ( ∈ {1     ( +  + 1)});
and then for each , there exists some positive constants 1 , 2 such that

                            max1≤≤ ++1 sup  ( F  2 ()) ≤ 1 −2                        (59)

where the supremum is taken over all probability measures on T (= X × L).

    Now, we check the four conditions (I)-(IV). The condition (I) is trivially satisfied by setting  as
the usual Euclidean metric, since T is a bonded subset of the  + 2 dimensional Euclidean space.
To verify (II), recall that by the continuity of Assumption 5, each element of [Ĝ ( )Ĝ ( )0 ]
is continuous. Since the domain X × L is totally bounded, this continuity actually holds uniformly
over ( ) ∈ X × L, leading to (58). The condition III) can be also easily checked by noting that
each component of Ĝ is uniformly bounded over ( ) ∈ X × L, i.e., ψ (), which is independent of
( ), is uniformly bounded over the support of  (see the proof of Lemma 3); |ξ ( ) | ≤ 2 by
                                                                                         ∗ ( )
Assumption 2; and the uniform boundedness of  (     ) := 1{ ≤  &  ≤ } − 
is also obvious by the definition of the C.D.F.
    Finally, to verify the condition (IV), recall that for  ∈ {1      }, F consists of a single-
ton (the -th element of the vector-valued function ψ (·)); for  ∈ { + 1      + }, F :=
    ¡           ¢
{  ·  − }∈L ; and for  =  +  + 1, F := { (·  )}()∈X ×L . Here, we verify (59) by
explicitly computing the covering number bound of {  (·  )}∈L for each  ∈ {1       } and
that of { (·  )}()∈X ×L . Now, fix any  ∈ {1       } (we here suppress the dependence of
variables/functions on  for notational simplicity), and recall that the form of the function defined


                                                       45
                                              £                         ¤
in (20):   (   ) = 1 {|| −  || ≤ } 1 {1  } − ∗ ( ) ∗ ( ). This may be regarded as
a composite of several functions, and we consider each subcomponent of   (·  ). First, we let
H1 be the set of functions: H1 := {1 (·|) |  ∈ L} with 1 (̃| ) = 1{|| − ˜|| ≤ }. Then, by the
arguments as in the proof of Lemma 1,

                            sup  ( H1  2 ()) ≤ Λ1 −10 for  ∈ (0 1) 

where the supremum is over all probability measures on X × L; and Λ1 ( 0) is some constant
independent of  (note that |1 | ≤ 1 for any 1 ∈ H1 ). Second, let H2 := {∗ ( )}∈L and
H3 := {1∗ ( )}∈L . H2 is a set of constant functions (of  ) since ∗ ( ) is independent of
 . By the same token, F3 is also a set of constant functions. Therefore, by the definition of the
covering number, we can easily derive the following bounds:

                                                        ¡                   ¢
             sup  ( H2  2 ()) ≤ Λ2 −1 and sup   −1  H3  2 () ≤ Λ3 −1 

for  ∈ (0 1), where each supremum is over all probability measures on X × L; Λ2 and Λ3 are some
positive constants independent of  (note that sup()∈L×[∞) ∗ ( ) ≤ 1 by the definition of ∗ ;
and sup()∈L×[∞) {1∗ ( )} ≤ 1 by Assumption 2). Third, look at

            {  (·  )}∈L ⊂ {1 × [1 {·  } − 2 ] × 3 | 1 ∈ H1  2 ∈ H2  3 ∈ H3 } 

Using this fact with (v) of Lemma 9.9, Lemmas 9.18 and 9.25 of Kosorok (2008), we can see that
the covering number of {  (·  )}∈L satisfies

                  sup  (̄ {  (·  )}∈L  2 ()) ≤ Λ1 Λ3 Λ3 −12 for  ∈ (0 1)            (60)

where the supremum is over all probability measures on X × L, and ̄ is some constant independent
of .
   We now turn to F ++1 = { (·  )}()∈X ×L . To bound its covering number, we use the
following two results:

          sup  ( {1{· ≤  & · ≤ }}()∈X ×L  2 ()) ≤ Λ4 −2[( +4)−1] = Λ4 −2( +3) 
                                       ∗
                          sup  ( { ( )}()∈X ×L  2 ()) ≤ Λ5 −1 

where each supremum is over all probability measures on X × L; Λ4 and Λ5 are some positive
constants independent of ; the former result follows from (i) of Lemma 9.12 and Lemma 9.2,
Kosorok (2008) (recall that we can regard L as a bounded subset of R2 by Assumption 4); and the


                                                      46
latter follows from the fact that the functional set in question consists of only constant functions.
From these, we can obtain

                     sup  ( { (·  )}()∈X ×L  2 ()) ≤ Λ4 Λ5 −2 −7 for  ∈ (0 1)                                       (61)

where the supremum is over all probability measures on X × L, and ̄ is some constant independent
of . By (60) and (61), we can obtain (59) and check the condition (IV). Thus, part (i) of the
theorem is verified, completing the proof of Lemma 4.

       Steps 5 & 6: Functional delta method.
       Next, we use the functional delta method to find the asymptotic distribution of ̂ () (for each
). For our formal presentation, we need to define the domain of the functional Ψ precisely. For
this purpose, let C [L] be the set of all -dimensional vector-valued functions, s : L → (−∞ ∞)
with s = (1       )0 and each element  being a càdlàg function: L → (−∞ ∞), and BV [X × L]
be the set of all càdlàg functions, X × L → (−∞ ∞), of variation bounded by some  ( 0).18
Given these, we can re-define Ψ as a functional D := R × C [L] × BV [X × L] → (−∞ ∞). This
re-formulation allows us to verify the following diﬀerentiability condition required for the functional
delta method:

Lemma 5 Suppose that Assumptions 3-5 hold. Then, the functional Ψ(: D → R) whose form is
given in (11) is Hadamard diﬀerentiable at ρ∗ tangentially to the domain D, and its Hadamard
derivative Γ∗ (σ)(: D → R) is given by
                    Z ½                   ³                                   ´
                                                        P
          ∗
         Γ (σ) =         1 {1 ≥ } ×  0  ∗0 + =1  ∗0 ∗ (  )
           h                 P                                    P                                  i
         × 0 ( 0 − ∗0 ) + =1 ( 0 −  ∗0 )∗ (  ) + =1  ∗0 ( () − ∗ (  ))
                              ³        P                         ´
         +1 {1  } ×  0  ∗1 + =1  ∗1 ∗ (  )
           h                 P                                    P                                  i¾
         × 0 ( 1 − ∗1 ) + =1 ( 1 −  ∗1 )∗ (  ) + =1  ∗1 ( () − ∗ (  )) 
                                                                                                        ∗
                                                                                                            ( )
           Z ½                    ³                                 ´
                                            P
         +      1 {1 ≥ } × Φ 0  ∗0 + =1  ∗0 ∗ (  )
                              ³        P                         ´¾
         +1 {1  } × Φ 0  ∗1 + =1  ∗1 ∗ (  ) ( ( ) −         ∗
                                                                                              ( ))             (62)

for each , where  is the probability density function of the standard normal; σ := (ρ − ρ∗ ) ∈ D
with ρ = ( 00   01   10       0   11       1  1 (·)       (·)   (· ·))0 , a generic element of D.
  18
       A càdlàg function is a function which is right-continuous and whose left limits exist at any points.




                                                                    47
   Proof. Recall the functional form of Φ, the linear specification in (7), and the form of the
likelihood function (8). Then, we can easily verify the existence of the Hadamard derivative and its
form (62) by using the standard chain rule for Hadamard diﬀerentiable functionals and arguments
analogous to those in the proof of Lemma 20.10 of van der Vaart (1998). We omit details of the
proof for brevity.
   Given these preparations, we can now prove Theorem 1.
   Proof of Theorem 1.           We here use the functional delta method (see, e.g., Theorem 20.8 of
van der Vaart, 1998). To do so, let Γ̄∗ be the Hadamard derivative of the functional Ψ(: D → R)
             ∗0   ∗0
at ρ̄∗ := (̄ 0  ̄ 1  003   ∗ (· ·))0 with 03 being the 3-dimensional vector of zeros. By the same
arguments as for Lemma 5, we can verify the existence of Γ̄∗ and derive its form:
                 Z ½                                                                        ¾
        ∗
                                  ¡ 0 ∗¢ 0          ∗                 ¡ 0 ∗¢ 0           ∗     ∗
      Γ̄ (σ̄) =     1 {1 ≥ }   ̄ 0  ( 0 −̄ 0 ) + 1 {1  }   ̄ 1  ( 1 −̄ 1 )  ( )
         Z ½                                                 ¾
                           ¡ 0 ∗¢                     ¡ 0 ∗¢                    ∗
      +       1 {1 ≥ } Φ  ̄ 0 + 1 {1  } Φ  ̄ 1 ( ( ) −          ( ))             (63)

for each , where a generic form of σ̄ can be written as σ̄ =(ρ − ρ̄∗ ) ∈ D.
   Let D̄ := D × R2 , and ∗ be a map from D̄ to R2 :

                                        ∗ (h) := (Γ∗ (σ)  Γ̄∗ (σ̄))0 

where σ ( ) and σ̄ ( ) are 2 + 3 + 1-dimensional vector (for each ( ) ∈ X × L); σ ( ) is
the first 2 + 3 + 1 components of h ( ); σ̄ ( ) consists of the last 2 components of h ( ),
003 and the (2 + 3 + 1)-th component of h ( ) (with the stated order).
   Now, applying the functional delta method, together with the results of Lemmas 4, we can
obtain
                            √                                         
                             (̂ () −  ∗ ()  ̃ () − ̄ ∗ ())0 → ∗ (H∗ )

Since H∗ is a mean-zero Gaussian process (as defined in Lemma 4) and ∗ is a continuous linear
map (recall the forms of Γ∗ and Γ̄∗ given in (62) and (63)), Γ∗ (G∗ ) is normally distributed with
mean zero, and the form of the variance matrix Σ () can be computed as in Section 3.9.2 of VW
(1996) (with the aid of the Riesz representation and Fubini theorems). This completes the proof.




A.2      Bootstrap validity

Step 7 Bootstrap validity: We here provide the proof the validity of our bootstrap inference
(Theorem 2) with two auxiliary lemmas which follow the proof of the theorem.


                                                        48
                                                                                           √
    Proof of Theorem 2. We below consider the bootstrap consistency result only for (̂ # ()−
                             √
̂ ()). The joint result for (̂ # () − ̂ ()  ̃ # () − ̃ ())0 can be shown quite analogously,
and we omit details.
                                                       √ #
   We first consider a convergence result for           [ρ̂ ( ) − ρ̂ ( )]. To this end, we define
                                                              ⎛                 ⎞
                                                                         #
                                                            ⎜
                                                                    ψ̂(  )
                                                      √ X                       ⎟
                                       #                      ⎜         #       ⎟
                                     G̃ ( ) := (1 )     ⎜ ξ̂ (  ) ⎟                            (64)
                                                              ⎝                 ⎠
                                                          =1
                                                                 ̂(#   )
where
                                   n                                 o
              ψ̂(# ) : = −[M̂]−1 m(#  η̂ ŝ(#   )) + α̂( #
                                                                   )   ;
                               X       £                             ¤
                    M̂ : = −1         (η 0 )m(  η̂ ŝ ( )) ;
                                  =1
                               X                                                          ¯
                α̂ () : = −1
                                      D̂ ( ) ξ̂ (  ) ; D̂ () := (s0 )m ( η̂ s)¯s=ŝ() ;
                                             =1

            ξ̂ (  ) : = (̂ (   1 )      ̂ (    ))0 ;                                   (65)

         ̂ (   ) : = 1{|| − || ≤ } [ − ̂ (  )] ̂ (  ) ;

            ξ̂ (#  ) : = (̂  (#   1 )     ̂  (#    ))0 ;                            (66)
                                                          h                                   i
        ̂  (#   ) : = 1{|| − #     || ≤   }     1{    #
                                                                   1    }  −    ̂ ( )  ̂ ( ) ;

         ̂(#   ) : = 1{# ≤  & #
                                          ≤ } − ̂ ( ) 

We note that G̃#
                ( ) is a bootstrap counterpart of Ĝ ( ) (i.e., it is constructed by replacing

all the true parameters in Ĝ ( ) with their empirical estimates, and that by the definitions,

                      # [ψ̂(# )] = 0;  # [ξ̂ (#  )] = 0; and  # [̂(#   )] = 0                (67)

where  # denotes the mathematical expectation with respect to the E.D.F., e.g.,  # [ψ̂(# )] =
     P
(1) =1 ψ̂ ( ).
   Now, we can easily show that
                                        ¯√                                       ¯
                                        ¯                                        ¯ 
                          sup()∈X ×L ¯ [ρ̂#                          #
                                               ( ) − ρ̂ ( )] − G̃ ( )¯ =⇒ 0                       (68)
                                                                                                     #

whose proof proceeds in the same way as the proof of (15) (but with replacing the true C.D.F. and
estimators replaced by the E.D.F. and their bootstrap counterparts, respectively), and we omit
details. We further consider the following object:
                                              ⎛                                    ⎞
                                                                       ψ(# )
                                               1 X⎜                                ⎟
                                                   
                                                      ⎜                            ⎟
                                Ĝ#
                                   ( ) := √       ⎜ ξ (#  )               ⎟ − Ĝ ( )             (69)
                                                     ⎝                            ⎠
                                                  =1
                                                        (#   )


                                                                  49
which is a bootstrap counterpart of Ĝ ( ) (note that Ĝ#
                                                             ( ) is re-centered and [Ĝ ( )] = 0).

Then, we show the following convergence result:
                                              ¯                       ¯
                                              ¯                       ¯ 
                                sup()∈X ×L ¯G̃#
                                                  ( ) − Ĝ#
                                                               ( )¯ =⇒ 0                                         (70)
                                                                                #


To prove this, recall the zero-mean conditions in (67), as well as the definitions of G̃#       #
                                                                                         and Ĝ in

(64) and (69), respectively. Then, we can write

            G̃#            #
               ( ) − Ĝ ( )
                     ⎛                                   ⎞                  ⎛                                    ⎞
                  ⎜
                            ψ̂(# ) − ψ(# )                                      ψ̂ ( ) − ψ ( )
             1  X                                        ⎟   1 X⎜
                                                                                                                ⎟
                     ⎜                                   ⎟        ⎜                                              ⎟
          = √        ⎜ ξ̂ (#  ) − ξ (#  )      ⎟− √     ⎜              ξ̂ (  ) − ξ (  )      ⎟   (71)
                    ⎝                                   ⎠       ⎝                                              ⎠
                =1                                                   =1
                        ̂(#   ) − (#   )                          ̂ (   ) −  (   )

where the convergence results of the components involving ψ̂(# ), ψ(# ), ξ̂ and ξ are presented
in Lemmas 7; and the convergence of the last row component can be shown analogously and its
proof is omitted (recall the fact that the (usual) convergence in probability implies the conditional
weak convergence in probability).
   Note that Ĝ#
                is simply in the form of a bootstrapped empirical process, to which we can

directly apply the bootstrap CLT (e.g., Theorem 3.6.1 of VW, 1996; or Theorem 2.6 of Kosorok,
2008). That is, by the weak-convergence/Donsker result of Ĝ ((i) of Lemma 4), it holds that

                                                         
                                                Ĝ#     ∗
                                                   =⇒ G 
                                                         #

where the conditional weak convergence in probability take places in the space ∞ (X × L) (given
the original observations { }=1 ). This, together with (68) and (70), implies that

                                           √ #             
                                            [ρ̂ − ρ̂ ] =⇒ G∗                                                     (72)
                                                              #

                                                     √
   Now, we have obtained the weak convergence of [ρ̂ − ρ∗ ] ((ii) of Lemma 4), the conditional
                   √
weak convergence of [ρ̂#
                         −ρ̂ ] (the result (72)), and the Hadamard diﬀerentiability of Ψ (Lemma

5). By these three results, we can apply the functional delta method for bootstrap (Theorem 3.9.11
                                   √                     
of VW, 1996), which verifies that (̂ # () − ̂ ()) =⇒  (0 Σ ()) as  → ∞, as desired (note
                                                                  #
that the separability requirement of Theorem 3.9.11 of VW (1996) is trivially satisfied since G∗ is
a Gaussian process and X × L is a subset of R × R2 ). This completes the proof of the theorem.




                                                         50
Lemma 6 Suppose that the same conditions hold as in Theorem 2. Then,

                         √ nX                        X                     o
        sup()∈X ×L (1 )   [ψ̂(# ) − ψ(# )] −    [ψ̂ ( ) − ψ ( )] =  (1) 
                                       =1                                 =1


   Proof. Let (1       ) be a vector of multinomial-distributed random variables with the
parameter , and the probability vector (1     1) which is independent of { }=1 . Then, by
the definition of our bootstrap procedure, we can write
                       X                                   X
                                   [ψ̂(# ) − ψ(# )] =               [ψ̂ ( ) − ψ ( )]          (73)
                             =1                                 =1


By the (uniform) law of large numbers, which follows from the same arguments for deriving (45) in
Lemma 2, we can write M̂−1 = [M∗ ]−1 + e with e =  (1). Therefore, recalling the definition
of ψ̂, we can also write

          ψ̂ ( ) = −[M∗ ]−1 {m(  η̂ ŝ ( )) + α̂ ( )} − e {m(  η̂ ŝ ( )) + α̂ ( )}    (74)

Now, by these expressions (73)-(74), we have

                  √ nX                                  X                          o
               (1 )         [ψ̂(# ) − ψ(# )] −             [ψ̂ ( ) − ψ ( )]
                          =1                                =1
                  √ X
             = (1 )       ( − 1)[ψ̂ ( ) − ψ ( )]
                        =1
                   √            X
             = −(1 )[M∗ ]−1          ( − 1)[m (  η̂ŝ ( )) − m (  η ∗  s∗ ( ))];
                                   =1
                   √            X
               +(1 )[M∗ ]−1          ( − 1)[α̂ ( ) − α ( )];
                                   =1
                   √     X
               −(1 )e           [m (  η̂ ŝ ( )) + α̂ ( )]
                                       =1
                     ∗ −1
             = [M ]         [−J1 + J2 ] − J3 

where

                        √ X
            J1 : = (1 )       ( − 1) [m (  η̂ ŝ ( )) − m (  η ∗  s∗ ( ))] ;
                              =1
                        √ X
            J2 : = (1 )       ( − 1) [α̂ ( ) − α ( )] ;
                              =1
                        √     X
            J3 : = (1 )e        [m (  η̂ ŝ ( )) + α̂ ( )] 
                                             =1


We can show that

                                                                √
                                             J1 =  ((ln )  );                                       (75)
                                                                √
                                             J2 =  ((ln )  );                                       (76)

                                             J3 =  (1)                                                (77)


                                                            51
whose proofs are below provided. These results imply the conclusion of the lemma.

   To derive the convergence result for J1 , observe that

            m (  η̂ ŝ ( )) − m (  η ∗  s∗ ( ))

        = (s0 )m (  η ∗  s∗ ( )) [ŝ ( ) − s∗ ( )] + (η 0 )m (  η ∗  s∗ ( )) (η̂ − η ∗ )

          +(sup∈L ||ŝ () − s∗ () ||2 ) + (||η̂ − η ∗ ||2 )
                                               X
        = (s0 )m (  η ∗  s∗ ( )) [−1       ξ (   )] + (η0 )m (  η ∗  s∗ ( )) [η̂ − η ∗ ]
                                                       =1

            + ((ln ) )                                                                                       (78)

uniformly over , where the equalities follow from the Taylor expansion, the (uniform) boundedness
                            √
of the derivatives of m, the -consistency of η̂, and the result (18) in Lemma 1. This implies that

             √ X                      ¡    ¢                             X
   J1 = (1 )           ( − 1) s0 m (  η ∗  s∗ ( )) [−1          ξ (   )]
                       =1                                                   =1
               √    X                   ¡     ¢                                                √
          +(1 )            ( − 1) η 0 m (  η∗  s∗ ( )) (η̂ − η ∗ ) +  ((ln )  )
                         =1
                nX                   XX                         o           √                   √
        = −32            b ( ) +                    b ( ) +  (1 ) +  ((ln )  )
                      =1                  1≤≤; 6=
                       √
        =  ((ln )  )                                                                          (79)

where
                                                 ¡     ¢
                           b ( ) := [ − 1] s0 m (  η ∗  s∗ ( )) ξ (   ) 

The second equality in (79) holds since

                      P             ¡      ¢
                 ||    =1 (− 1) η 0 m (  η ∗  s∗ ( )) (η̂ − η ∗ )||2
                                     P                       PP
             =  (||η̂ − η ∗ ||2 ) × =1 ( − 1)2 +          1≤≤; 6= ( − 1) ( − 1)
                            £                                ¤0
               ×(η̂ − η ∗ )0 (η 0 )m (  η ∗  s∗ ( )) (η 0 )m (  η∗  s∗ ( )) (η̂ − η ∗ )

             =  (1) 

                                                                               √
which follows from the uniform boundedness of (η 0 )m, the                   -consistency of η̂, the indepen-
dence between (1       ) and { }=1 , and the facts that

                        [( − 1)2 ] = Var[ ] =  (1) [1 − (1)] = 1 − 1

                       [( − 1) ( − 1)] = Cov [   ] = −1 (for  6= )




                                                              52
                                                                            P
To see the validity of third equality in (79), we observe that                 =1 b ( )   =  () and

             PP                         2    PP                            0                      0
        [||   1≤≤; 6= b ( ) || ] =      1≤≤; 6= {[b ( ) b ( )] + [b ( ) b ( )]}
          PPP                                 0                       0
        +       1≤≤; 6=6= {[b ( ) b ( )] + [b ( ) b ( )]

     +[b ( )0 b ( )] + [b ( )0 b ( )]}
       PPPP                                          0
     +             1≤≤; 6=6=6= [b ( ) b ( )]
     PP                            0                      0
   =     1≤≤; 6= {[b ( ) b ( )] + [b ( ) b ( )]}
       PPP                                  0
     +         1≤≤; 6=6= [b ( ) b ( )]

   = 2 × (1) + 3 × (1) = (2 )                                                                             (80)

where the equalities use the following facts:  [b ( ) | ] = 0 for  6= ;

                        [b ( )0 b ( )] =  (1) and [b ( )0 b ( )] =  (1) 

uniformly over  and ; and

       [b ( )0 b ( )]
                                              £¡        ¢                      ¤0 ¡  ¢
  = Cov[   ] × [ξ (   )0            s0 m(  η ∗  s∗ ( )) s0 m(  η ∗  s∗ ( ))ξ (   )]

  = −(1) ×  (1)  uniformly over   and  ( 6=  6= )

which follows from the independence between (1       ) and { }=1 , and the uniform
boundedness of (s0 ) m and ξ. Now, we have proved the desired result (75)

    We now look at J2 . Analogously to (83) and (84), we can write

                           ̂ (   ) =  (   ) +   (    ) +  ((ln ) )

uniformly over  ,  ,  and , where

                                                                                                     £              ¤
    (̃  ) := [ ( ) ∗ ( )]1{|| − ˜|| ≤ } + [ ( ) ∗ ( )]1{|| − ˜|| ≤ }  − ∗ ( ) ;
                                                                                       p
 ( ) and  ( ) are the same components used in (82), and   (̃  ) =  ( (ln ) ) uni-
formly over ̃  and . Let ν  (̃ ) := (  (̃  1 )        (̃   ))0 . Then, we can write

                             ξ̂(   ) = ξ(   ) + ν  (   ) +  ((ln ) )                         (81)




                                                             53
For notational simplicity, we denote by w ( η s) the -th row vector of the by the  -by- matrix
(s0 ) m ( η s) (1 ≤  ≤  ), i.e., each w ( η s) is a 1-by- vector with
                                                          ⎛                 ⎞
                                                              w1 ( η s)
                                                            ⎜               ⎟
                                                            ⎜      ..       ⎟
                                       (s0 )m( η s) = ⎜       .       ⎟
                                                            ⎝               ⎠
                                                              w ( η s)

Then, by using the Taylor expansion (as in 78)), the boundedness of the derivatives of w , and the
expression (81),

        w (  η̂ ŝ ( )) ξ̂ (   ) = w (  η ∗  s∗ ( )) ξ̂ (   )
        ¡     ¢h                                        i
      = s0 w (  η ∗  s∗ ( )) ξ̂ (   ) [ŝ ( ) − s∗ ( )] + (sup∈L ||ŝ () − s∗ () ||2 )
          ¡        ¢h                                        i
        + η 0 w (  η ∗  s∗ ( )) ξ̂ (   ) (η̂ − η ∗ ) + (||η̂ − η ∗ ||2 )

      = w (  η ∗  s∗ ( )) [ξ (   ) + ν  (   )]
         ¡        ¢
        + s0 [w (  η∗  s∗ ( )) ξ (   )] [ŝ ( ) − s∗ ( )]
         ¡        ¢
        + η 0 [w (  η ∗  s∗ ( )) ξ (   )] (η̂ − η∗ ) +  ((log ) )

uniformly over  and , for  = 1      . Therefore, recalling the following expression:

      α̂ ( ) − α ( )
           X                                                 Z
    = −1         (s0 )m (  η̂ŝ ( )) ξ̂ (   ) − (s0 )m ( η ∗  s∗ ()) ξ (  )  () 
                 =1


we can write

                          the -th element of the column vector J2
                                                                                  √
                       = 1 () + 2 () + 3 () + 4 () +  ((log )  )

where

                          P P  
   1 () : = (132 )          ( − 1)
                          =1 =1
                £                                      R                                       ¤
              × w (  η ∗  s∗ ( )) ξ (   ) − w ( η ∗  s∗ ()) ξ (  )  () ;
                          P P  
   2 () : = (132 )          ( − 1)w (  η ∗  s∗ ( )) ν  (   ) ;
                                    =1 =1
                          32       P P   
   3 () : = (1            )               [w (  η ∗  s∗ ( )) ξ (   )] [ŝ ( ) − s∗ ( )];
                                          ( − 1)
                                              0
                          =1 =1          s
                          P P             
   4 () : = (132 )        ( − 1) 0 [w (  η ∗  s∗ ( )) ξ (   )] (η̂ − η ∗ )
                          =1 =1          η



                                                         54
We can show that [|1 ()|2 ] =  (1) by considering its expansion as in (80) and using the
facts that
            £                                      R                                        ¯ ¤
           w (  η ∗  s∗ ( )) ξ (   ) − w ( η∗  s∗ ()) ξ (  )  ()¯  = 0;
           £                                       R                                       ¯ ¤
           w (  η ∗  s∗ ( )) ξ (   ) − w ( η ∗  s∗ ()) ξ (  )  ()¯  = 0

where the latter follows from the definition of ξ (  ) (given in (19)). We can also show that
               p                                p
2 () =  ( (ln ) ) and 3 () =  ( (ln ) ) for each . To prove these two, we
expand each of [|2 ()|2 ] and [|3 ()|2 ] as in (80) (both exist since w and its derivatives,
ν  (   ), ξ (   ) and [ŝ ( ) − s∗ ( )] are uniformly bounded), and then use the results:
                    p                                            p                p
ξ (   ) =  ( (ln ) ) and [ŝ ( )−s∗ ( )] =  ( (ln ) ) are  ( (ln ) ) uniformly
over  and ; the independence condition between (1       ) and { }=1 ; and the following
fact:
                                                                             ¡    ¢
              [( − 1)( − 1)( − 1)( − 1)] = 3 ( − 2) 3 =  12 

for 1 ≤  6=  6=  6=  ≤ , which follows from the generalized factorial moment formula for
multinomial distributions (page 67, Mosimann, 1962). By using analogous arguments with the
√
 -consistency of η̂ and the fact that
                                                                    ¯
                                                                   ¯
                          [ 0 [w (  η  s ( )) ξ (   )]¯¯  ] = 0
                                          ∗ ∗
                             η

we can also show |4 ()|2 =  (1). From these, we can obtain the desired result (76).
                                                              √
    Finally, we look at J3 . Using the fact that e =  (1 ), we can write
                            nX
          J3 =  (1) ×              [m(  η∗  s∗ ( )) + α ( )]
                                   =1
            X                                                           X                             o
          +        [m(  η̂ ŝ ( )) − m(  η ∗  s∗ ( ))] +        [α̂ ( ) − α ( )] 
                 =1                                                       =1

                                                √
The first term within the curly braces is  (1 ) since  [m (  η ∗  s∗ ( )) + α ( )] = 0 and
thus
                            P
                         [| =1  [m (  η ∗  s∗ ( )) + α ( )]|2 ] = ()

The second and third terms within the curly braces are  () since we have the uniform convergence
of [m ( η̂ŝ ()) − m ( η ∗  s∗ ())] and [α̂ () − α ()] (over ; in probability), which can be easily
shown by using the Taylor expansion arguments with (uniform) convergence results of η̂ and ŝ ().
                                                   √
Therefore, we have obtained J3 =  (1) × { ( ) +  ()} =  (1), as desired. Now, the
proof of Lemma 6 is completed.


                                                      55
Lemma 7 Suppose that the same conditions hold as in Theorem 2. Then,

                     √ nX                                  X                             o
                                                                                             
          sup     (1 )   [ξ̂ (#  ) − ξ (#  )] −    [ξ̂ (  ) − ξ (  )] =⇒ 0
       ()∈X ×L                 =1                                    =1                               #


    Proof. Noting the uniform convergence results of ̂ ( ) and ̂ ( ) in Lemma 1, and the
boundedness condition of ∗ ( ) in Assumption 2, we can write

                    ̂ ( ) = ∗ ( ) +  ( ) and 1̂ ( ) = [1∗ ( )] +  ( )               (82)

                                                              p
where sup()∈X ×[∞) max{| ( ) | | ( ) |} =  ( (ln ) ), and max{| ( ) | | ( ) |} 
 for some  ∈ (0 ∞) (the existence of such  follows from the boundedness of the relevant func-
tions and estimators). Given these (with recalling the definition of ξ and ξ̂ in (49) and (66), we
can write each component of the  × 1 vector [ξ̂ (#  ) − ξ (#  )] as
                                                                     h                         i
     ̂  (#   ) −   (#   ) = 1{|| − #                      #
                                                          || ≤ } 1{1  } − ̂ ( ) ̂ ( )
                                h                               i
     −1{|| − #      || ≤  }  1{    #
                                        1   } −   ∗
                                                         ( )  ∗ ( )
                        ½                                                                    h                       i
   = −[1 ( )]  ( ) 1{|| − #
              ∗
                                                 || ≤  }   +   ( ) 1{|| − #
                                                                                    || ≤ }  1{ #
                                                                                                 1  } − ∗
                                                                                                              ( )
                                                     ¾
     + ( )  ( ) 1{|| − #       || ≤ } 


for each  ∈ {1       }. This leads to the following expression:

                ̂  (#   ) −   (#   ) = −[ ( ) ∗ ( )]1{|| − # || ≤ }
                                                                h                           i
                +[ ( ) ∗ ( )]1{|| − #      || ≤ }  1{  #
                                                                      1   } −  ∗
                                                                                     ( )  +  ((ln ) )   (83)

uniformly over  ∈ {1     } and  ∈ L. In the same way, we can also write

                ̂  (   ) −   (   ) = −[ ( ) ∗ ( )]1 {|| −  || ≤ }
                                                               £                            ¤
                +[ ( ) ∗ ( )]1 {|| −  || ≤ } 1{1  } − ∗ ( ) +  ((ln ) )             (84)

uniformly over  ∈ {1     } and  ∈ L. Therefore, for each ,

           √ X                                                   ¡ √ ¢ X
        (1 )           {̂  (#   ) −   (#   )} − 1             {̂ (   ) −   (   )}
                     =1                                                      =1 
                                     √      n X                             X                          o
      = −[ ( ) ∗ ( )](1 )                 1{|| − #  || ≤ } −         1{|| −    || ≤ }
                                 ¡    √    ¢ nX=1 
                                                                                =1

        +[ ( ) ∗ ( )] 1                    1{|| − #               #             ∗
                                                                   || ≤ }[1{1  } −  ( )]
                                                   =1
          X                               £                            ¤o               √
        −          1{|| −  || ≤ } 1{1  } − ∗ ( ) +  ((ln )  )                                  (85)
                    =1




                                                           56
Recall the Donsker property of the two sets of functions, {1{|| − ·|| ≤ } |  ∈ L &   0} and
                 £                      ¤
{1{|| − ·|| ≤ } 1 {·  } − ∗ ( ) |  ∈ L &   0} (argued in the proof of Lemma 1). By
applying the functional CLT for bootstrap empirical processes (e.g., Theorem 3.6.1 of VW, 1996;
or Theorem 2.6 of Kosorok, 2008), each of two parts within the curly braces on the RHS of (85),
                 √
normalized by (1 ), conditionally weakly converges to some tight random function in probability.
Therefore, we have

                                    
                  the LHS of (85) =⇒ 0 uniformly over ( ) ∈ L × {1       } 
                                    #

where we also have used the boundedness of 1∗ ( ) (Assumption 2), the convergence property of
 ( ) and  ( ), and the fact that the (usual) convergence in probability implies the conditional
weak convergence in probability. This completes the proof of Lemma 7.




                                                   57
