                                NBER WORKING PAPER SERIES




                                        PLANTS IN SPACE

                                          Ezra Oberfield
                                      Esteban Rossi-Hansberg
                                        Pierre-Daniel Sarte
                                         Nicholas Trachter

                                        Working Paper 27303
                                http://www.nber.org/papers/w27303


                      NATIONAL BUREAU OF ECONOMIC RESEARCH
                               1050 Massachusetts Avenue
                                 Cambridge, MA 02138
                                      June 2020




We thank participants at numerous seminars and conferences for their feedback. We thank Eric
LaRose, Reiko Laski, James Lee, Sara Ho, and Suren Tavakalov for outstanding research
assistance. The views expressed herein are those of the authors and do not necessarily represent
the views of the Federal Reserve Bank of Richmond, the Federal Reserve System, or the National
Bureau of Economic Research.

At least one co-author has disclosed a financial relationship of potential relevance for this research.
Further information is available online at http://www.nber.org/papers/w27303.ack

NBER working papers are circulated for discussion and comment purposes. They have not been peer-
reviewed or been subject to the review by the NBER Board of Directors that accompanies official
NBER publications.

© 2020 by Ezra Oberfield, Esteban Rossi-Hansberg, Pierre-Daniel Sarte, and Nicholas Trachter. All
rights reserved. Short sections of text, not to exceed two paragraphs, may be quoted without explicit
permission provided that full credit, including © notice, is given to the source.
Plants in Space
Ezra Oberfield, Esteban Rossi-Hansberg, Pierre-Daniel Sarte, and Nicholas Trachter
NBER Working Paper No. 27303
June 2020
JEL No. D24,L25,R3

                                         ABSTRACT

We study the number, size, and location of a firm's plants. The firm's decision balances the
benefit of delivering goods and services to customers using multiple plants with the cost of
setting up and managing these plants, and the potential for cannibalization that arises as their
number increases. Modeling the decisions of heterogeneous firms in an economy with a vast
number of widely distinct locations is complex because it involves a large combinatorial problem.
Using insights from discrete geometry, we study a tractable limit case of this problem in which
these forces operate at a local level. Our analysis delivers clear predictions on sorting across
space. Productive firms place more plants in dense locations that exhibit high rents compared
with less productive firms, and place fewer plants in markets with low density and low rents.
Controlling for the number of plants, productive firms also operate larger plants than those
operated by less productive firms in locations where both are present. We present evidence
consistent with these and several other predictions using U.S. establishment-level panel data.

Ezra Oberfield                                  Pierre-Daniel Sarte
Department of Economics                         Research Department.
Princeton University                            Federal Reserve Bank of Richmond
Julis Romo Rabinowitz Building                  PO Box 27622
Princeton, NJ 08544                             Richmond, VA 23261
and NBER                                        pierre.sarte@rich.frb.org
edo@princeton.edu
                                                Nicholas Trachter
Esteban Rossi-Hansberg                          Federal Reserve Bank of Richmond
Princeton University                            701 E Byrd Street
Department of Economics                         Richmond, VA 23219
289 Julis Romo Rabinowitz Building              trachter@gmail.com
Princeton, NJ 08544-1021
and CEPR
and also NBER
erossi@princeton.edu
1    Introduction
Delivering products and services to locations where consumers can easily access them involves complex
decisions on where to locate plants and how large these plants should be. Having too few establishments
in the wrong locations is costly because it increases either transport costs or the distance to consumers.
Having too many involves large span-of-control and fixed costs, as well as plants that cannibalize each
other's customers. Understanding how these trade-offs play out for firms with different characteristics in an
economy consisting of many local markets that differ in demand and production costs is complex. Perhaps
due to the difficulty of the problem, little is known about the solution to this fundamental problem of how
to organize production. The sorting of firms in space determines not only the profitability of firms, but
also consumers' surplus as well as the characteristics of individual locations. In this paper, we study this
core component of a firm's production problem, provide a methodology that simplifies it significantly, and
contrast its implications with the data.
    Consider the case of Starbucks, which operated in 2019 around 14,000 stores in different locations across
the US. Of course, not all Starbucks are equal in size, not all locations in the US have a Starbucks, and the
distance between neighboring Starbucks stores in a location differs across space. Simply put, there is a lot
of variation across space in how individual stores are arranged. This variation is naturally related to the
spatial distribution of population density, of wages, and other characteristics. For example, Figure 1 shows
the location of Starbucks establishments in three markets, Princeton NJ, Richmond VA, and New York
NY. Clearly, the number of establishments as well as the distance between them varies across these cities.
Even within New York, the number of establishments is much larger, and the distance between them much
shorter, in the densest parts of Manhattan. What are the general characteristics of establishment location
decisions? Clearly density matters, but the scale of establishments is by no means constant in space. The
average plant employment of Starbucks in New York is more than 23% higher than in Richmond.
    Casual evidence and introspection might suggest that firms simply sell in the densest markets with the
marginal market determined by a firm's productivity. A closer look, however, reveals a more nuanced pat-
tern. Figure 2 provides a simple example that illustrates this point. Walgreens and Rite Aid are pharmacies
that operate nationally, but Walgreens' total employment is larger and it has more establishments. The
figure shows that, in fact, both pharmacy chains tend to have more establishments in more dense locations.
However, Rite Aid decided to have more stores in less dense locations. Is this form of sorting across location
a general feature of the solution to the location problem, of the data?
    More generally, we aim to provide insights into two main questions: First, which firms set up plants in
which locations? Second, what determine the scale and location of production? Answering these questions
requires us to think about plants and firms as distinct, albeit related, economic entities. In particular, we set
up an economy with a continuum of heterogeneous locations. These locations have different productivities
and amenities that determine, in general equilibrium, the distribution of population density, wages, and res-
idential and business rents. It also determines, given the form local competition takes in a location, residual



                                                       2
                                       Figure 1: Density of Starbucks Locations

                  Princeton                                Richmond                                New York




Notes: The figure shows the locations of Starbucks establishments in a 12 × 12 square mile area in Princeton, Richmond, and New
York City.




                                       Figure 2: Sorting: Walgreens vs. Rite Aid




Notes: For Walgreens and Rite Aid, this graph plots the cumulative number of establishments in locations with populations density
weakly less than each population density. Population density is measured as the population density of the 6 × 6 mile square in which
the establishment is located.




                                                                 3
demand for a firm's product. We focus primarily on the problem of a firm that takes these distributions as
given and needs to decide if and how to serve each consumer. The firm decides where to set up production
plants, how large each plant should be, and from which plant to serve each of its customers. We assume
that firms face iceberg transport costs. Setting up a plant entails a fixed cost that depends on local land
rents. The productivity of a plant depends on local characteristics as well as a firm-specific component that
decreases with the total number of plants the firm operates. In other words, increasing a firm's span-of-
control by adding plants implies a management cost that lowers its productivity. The main trade-off faced
by the firm, therefore, is to reduce transport costs by setting up more plants close to consumers versus
setting up fewer plants to economize on fixed costs, augment productivity by lowering span of control, and
reduce cannibalization between plants. Ours is a standard setup of this canonical firm decision problem.
      Solving this production problem when the set of potential locations is large and heterogeneous involves
a large and challenging combinatorial optimization problem. Our contribution is to focus on a limit formu-
lation of the problem in which the firm chooses a density of plants, rather than a discrete set. The firm's
problem then becomes one of calculus of variations which is simpler to solve. Crucially, in the limit we
propose, all relevant trade-offs described above remain active. Specifically, we study a limit of the problem
in which fixed and span-of-control managerial costs become small while transportation costs become large.
In this limit economy, the problem of the firm becomes amenable to an analytical characterization, making
it easy to transparently characterize its implications.
      In characterizing the solution to the firm's problem in the limit economy, we apply insights from discrete
geometry. In particular, we exploit the sum of moments theorem by Fejes Toth (1953). The theorem
provides the optimal way to arrange plants across space when economic activity is uniform and the number
of plants is large. In particular, it states that plants should be located at the center of catchment areas
given by hexagons arranged so as to cover all locations. The intuition for this result is that, among all
polygons with which one can construct a uniform tessellation, the hexagon is the closest to a circle.1 A
circle minimizes the average distance from a plant located at is center to its customers. However, unlike
hexagons, it cannot be used repeatedly to form a tessallation. We extend the theorem to an economy
where locations are heterogeneous across space. Specifically, the environment recognizes that customers
are not necessarily uniformly distributed across space while plant costs and productivities also differ across
locations.
      Apart from being obviously important for practical applications, our extension of the theorem allows us to
study sorting patterns, namely the many-to-many matching between heterogeneous firms and heterogeneous
locations. It helps us understand examples such as Starbucks, or Walgreens and Rite Aid, for which the
number of establishments changes with customer density but at different rates and with different ranges of
locations that vary with the firm's aggregate scale. In general, our theory delivers testable implications on
sorting patterns across firms. First, more productive firms set up more plants in denser, high rent, locations
than low productivity firms. Perhaps more surprising is that they also set up fewer plants in markets with
  1
      A tessellation is an arrangement of shapes, especially of polygons, in a repeated pattern without gaps or overlapping.


                                                                4
lower density and rents. Second, controlling for the number of plants in a location, more productive firms
set up larger plants. In the final section of the paper, we present evidence, using the National Establishment
Time Series (NETS) dataset, that corroborates these and other predictions of our theoretical analysis.
      One of the advantages of using our limit economy to analyze the firm production problem is that the sim-
plicity of the solution allows us to embed the problem into an equilibrium setup. In equilibrium, exogenous
local amenities and populations, together with worker mobility and the solution to the firm's production
problem, lead to an endogenous distribution of population in space, as well as a distribution of local prices
and factor costs. We set up this problem and show that in equilibrium, an index of local productivity and
amenities is the only relevant local characteristic needed to determine equilibrium outcomes. Analyzing
realistic quantitative general equilibrium counterfactuals is not the focus of our study, but the method we
develop to make the firm's problem tractable can be readily used to do so. We provide an algorithm to com-
pute an industry equilibrium of our economy and illustrate the effect of improvements, in a single industry,
in the technology to manage a firm's span of control and the technology to transport goods.
      Canonical models of firm dynamics (i.e. Jovanovic (1982) and Hopenhayn (1992)) make no clear dis-
tinction between a plant and a firm. However, mounting evidence points to the importance of considering
plants and firms as different but related entities. Rossi-Hansberg and Wright (2007) highlight large differ-
ences between the size distributions of enterprises and establishments. In addition, Rossi-Hansberg et al.
(2018) show evidence of diverging trends in market concentration at the national and local levels resulting
from the expansion of the largest firms into new markets. Hsieh and Rossi-Hansberg (2019) show that
industries with large increases in national market concentration also saw their top firms expand their oper-
ations geographically through the opening of new plants in smaller markets. Further, Aghion et al. (2019)
observe that the average number of plants per firm has risen considerably in the US, and Cao et al. (2019)
and Aghion et al. (2019) provide evidence that growth through the opening of new plants has been a key
margin of a firm's employment growth since 1990.
      The distinction between firms and plants has been more prevalent in the international trade literature
given the interest in multinational production and export platforms. Examples of papers in this literature
include Ramondo (2014), Ramondo and Rodr´
                                        iguez-Clare (2013), and Tintelnot (2016), among many others.
Moreover, all of these frameworks either solve the combinatorial problem with only a few countries or assume
away fixed costs. These models all have the feature that the less profitable markets are reached only by
the more productive firms. In contrast, our environment is one in which it is the less productive firms that
locate in the more marginal markets.
      The industrial organization literature has also analyzed how individual firms set up distribution networks
in space. Seminal papers include Jia (2008) and Holmes (2011). Importantly, many of these frameworks
study cases where opening stores in one location increases the marginal value of opening stores in other
locations, the so called "supermodular" cases.2 The lack of cannibalization across plants makes these cases
somewhat easier to handle. On the contrary, cases where cannibalization is prevalent, so that setting up
  2
      Holmes (2011) assumes submodularity but does not solve the model; he estimates parameters using moment inequalities.


                                                             5
new plants reduces the value of other plants, cannot easily be solved except for algorithms that evaluate
essentially all possible combinations. Recently, Arkolakis and Eckert (2017) and Hu and Shi (2019) have
developed more powerful algorithms to solve these types of "submodular" problems more efficiently, but
doing so for large numbers of locations remains a challenge. Furthermore, the purely numerical nature of
essentially all this literature implies that few general insights have been obtained. Our analytical approach
has the advantage of providing a set of general implications that we can contrast with micro data.
        We provide a characterization of the matching of heterogeneous firms with multiple plants to heteroge-
neous locations. Gaubert (2018), and Ziv (2019) study the assignment of single-plant firms to heterogeneous
locations. Behrens et al. (2014), Eeckhout et al. (2014), Diamond (2016), Davis and Dingel (2019) and Bi-
lal and Rossi-Hansberg (2019), study the assignment of workers to heterogeneous locations. None of these
papers, however, address sorting when the agent, in our case a firm, can choose many locations concurrently.3
        The rest of the paper is organized as follows. Section 2 presents the problem of the firm, proposes
and studies the limit problem, and derives our main results. Section 3 embeds heterogeneous firms solving
the production problem with multiple plants into a general equilibrium economy. It also presents numerical
examples that illustrate the effect of changes in the efficiency of span of control and transport costs. Section 4
contrasts some of the main implications of our solution with panel data of firms and establishments. Section 5
concludes. An Appendix includes technical derivations, presents additional robustness results and data
constructions details, and describes the numerical algorithm.


2        The Multi-plant Firm Problem
We consider the problem of a firm deciding how to serve customers located in a unit square, S = [0, 1]2  R2 .
More generally, we require S to be an Euclidean space that is closed, bounded and convex. Each location
s  S is characterized by an exogenous productivity level Bs , as well as local equilibrium characteristics that
firms take as given, namely, the residual demand function, Ds (·), the wage rate, Ws , and the commercial
rent, Rs .
        There is a set of firms, j  J . Each firm produces a unique variety. A firm is characterized by
productivity, qj . It chooses a finite set of locations Oj  S where to set up plants. If j produces in a total
of Nj = |Oj | locations, its productivity in location o  Oj is Bo Z (qj , Nj ) where Z is decreasing in N and
Z (q, 0) < . Thus, firms face a cost of increasing their span of control. Each plant takes up  units of
commercial real estate with rental cost Rs per unit of space. Trade between any two locations incurs an
iceberg shipping cost. For one unit of a good to arrive a distance of  , T ( )  1 units must be shipped. We
assume T ( ) is strictly increasing, satisfies the triangle inequality, and diverges as   .
        Conditional on having a plant, production requires only local labor which is employed at wage Ws . Let
    3
    Empirically, assessing sorting patterns when each plant is a stand alone unit is difficult because of the reflection problem. In
particular, one can observe whether plants in more dense locations are larger, but it is not clear whether that is due to sorting
or to the impact of being in a dense location. In our setting, with firms that operate many units in different locations, we can
exploit leave-out strategies to argue that there is clear evidence of positive assortative matching.


                                                                 6
ljo denote the number of workers employed by firm j at a plant in o. Firms will serve customers in the
least costly possible way. Thus, the cost of delivering one unit of good j from a plant in o to a consumer
            Wo T (so )                                       Wo T (so )
in s is    Bo Z (qj ,Nj ) .   Let js (Oj )  minoOj          Bo Z (qj ,Nj )   be j 's minimal cost of delivering one unit of good j
                                                                                  Wo T (so )
to a consumer in location s, and let js  arg minoOj                              Bo Z (qj ,Nj )   be the location that sources the product.
Let pjs be the price charged by j to consumers in s. Then, Ds (pjs ) be the residual demand for variety j in
location s. The optimal price maximizes

                                                         max Ds (pjs ) (pjs - js ) ,
                                                         pjs


       The problem above can lead to complicated pricing rules where markups depend on local characteristics.
To simplify the problem, we abstract from spatial variation in markups and assume the following about the
residual demand function.

Assumption 1 Residual demand satisfies Ds (pjs ) = Ds p- 
                                                       js , where Ds subsumes all determinants of local
demand, including the local price index.

       Assumption 1 is satisfied in the standard case with monopolistic competition and CES preferences with
                                                                                                                     4
elasticity of substitution across varieties given by . Then, as usual, pjs =                                  -1 js .
       Given a choice of plants, Oj , j 's profit can be expressed as
                                                                                                                     
                                                                                                                     
                                   j = max           max Ds p- 
                                                             js (pjs - js (Oj )) ds -                          Ro         ,             (1)
                                        Oj          s pjs                                                oOj
                                                                                                                     

or, using the expression for j 's price, is

                                   ( - 1)-1
                        j      =                    Ds js (Oj )1- ds -                    Ro 
                                                s                                  oOj
                                                                                                  1-
                                   ( - 1)-1                          Wo T (so )
                               =                    Ds      min                                        ds -         Ro 
                                                s           oOj     Bo Z (qj , Nj )
                                                                                                              oOj
                                                               -1                                        -1
                                                    ( - 1)                                 Bo /Wo
                               = Z (qj , Nj )-1                          Ds max                                 ds -          Ro .
                                                                     s           oOj       T (so )
                                                                                                                        oOj
   4
    In this environment, the fact that a plant can charge different prices to different customers is innocuous because markups
are independent of demand. This would be equivalent to having the store charging a single price to all its customers, but
customers incurring on the iceberg cost of transporting the good back to their home.




                                                                             7
2.1      The Catchment Area of a Plant
The catchment area of a plant in location o is formed by locations s to which the firm ships goods from the
plant in o. Formally, letting CT (o) denote the catchment area of a plant in location o,

                                                                                         Bo
                                                                                          ~/Wo ~
                                  CT (o) =      s  S for which o = arg max                               .                     (2)
                                                                                ~Oj
                                                                                o        T (so
                                                                                             ~)


Given that T (0) = 1 and T is increasing, if CT (o) is not empty then o  CT (o). CT (o) can be empty if a
plant's cost, relative to other nearby plants, is high enough.5
      Notice that, once plants are placed in locations Oj , the catchment area of each plant only depends on
transportation costs and on the production cost of locations where the plants are placed. The production
cost plays an important role in defining catchment areas.

2.1.1      An example

We explore the importance of the production cost by solving for the catchment areas when we place 9 plants
equidistant from each other.6 For transportation costs we let T (so ) = 1 + so , where so is the Euclidean
distance between s and o. We solve two cases with different distributions of productivity and economic
activity. In the first case, we assume that there is no variation in economic fundamentals, so Bo /Wo = 1
 o  Oj . We present the resulting catchment areas in the left panel of Figure 3. In the second case, we
increase the costs of the location in the upper left corner by setting Bo /Wo = 0.85, and we reduce the costs
of the central and lower right corner locations by letting Bo /Wo = 1.2. This case is presented in the right
panel of Figure 3.
      As Figure 3 shows, when production costs are constant across production locations, catchment areas are
all equally sized, are all convex, and are all polygons. However, when production costs vary, the catchment
areas can take different shapes and sizes, can be non-convex, and are not polygons. Note the resulting
complexity in the catchment areas in the example where we add some heterogeneity. Not only do lower cost
regions catchment areas' grow, but the characteristics of their neighbors and their location in the square
matter as well.
      The complexity of this problem seems daunting, particularly once we introduce more locations, richer
heterogeneity, and incorporate the decision of how many plants to use and where to locate them. To make
progress, we now propose a reformulation of this problem that can be tractably studied, while still preserving
its main features and trade-offs.
  5
      This problem is equivalent to constructing a weighted Voronoi diagram.
  6
      We let plant locations be given by

                (1/6, 1/6), (1/6, 1/2), (1/6, 5/6), (1/2, 1/6), (1/2, 1/2), (1/2, 5/6), (5/6, 1/6), (5/6, 1/2), (5/6, 5/6) .




                                                                     8
                                                 Figure 3: Catchment Areas

                           Bo /Wo = 1  o                                              Bo /Wo vary with o




 Notes: The figure present the catchment areas, as defined in (2), for the case where 9 plants are located in the squared space. Each
 dot in each plot corresponds to the location of a plant. Each number on parenthesis next to each dot corresponds to the value for
 Bo /Wo for that dot.




2.2      A Tractable Limit
We propose a tractable limit of the firm's problem in which the number of plants per firm grows large so that
the firm is essentially choosing a density of plants, rather than a discrete number. In particular, we study a
limit in which the space that plants take up grows small, trade costs grow large, and the productivity cost
for having many plants grows small. We take limits at carefully chosen rates so the problem is well-behaved
in the limit. Specifically, for some  > 0 let

                                                            = 2 ,
                                                                         
                                                     T  ( ) = t               , and
                                                                         
                                                 Z  (q, N ) = z q, 2 N .

We study the limit as   0.
      We want to study a limit in which the key trade-offs between the fixed and managerial span-of-control
costs of setting up plants and the cost of reaching consumers remain relevant; a limit in which plants continue
to potentially cannibalize each other's customers. Thus, as  declines and the cost of adding plants falls,
we increase transport costs.   and Z  depend on the square of  since space is two dimensional while,
in contrast, distance is one dimensional.7 The following proposition describes the profits of the firm in this
  7
      There is a natural analogy to the continuous time limit of discrete time portfolio choice problems. In those models, as the



                                                                  9
limit.

Proposition 1 Suppose Rs , Ds , and Bs /Ws are continuous functions of s. Then, in the limit as   0,
the profits of firm j satisfy

                                                                    -1
                            j =     sup         xs z qj ,    ns
                                                              ~ds
                                                                ~        ns g (1/ns ) - Rs ns ds
                                  n:SR+     s


              (-1)-1
where xs             Ds (Bs /Ws )-1       and where g (u) is the integral of t (·)1- over the distances of points to
the center of a regular hexagon with area u.

    Proposition 1 shows that in the limit, the firm's problem is one of calculus of variations which, as we
show below, is much easier to analyze. The variable xs combines both local demand facing the plant (Ds )
and local cost of effective labor (Ws /Bs ) into a measure of local profitability. Before presenting a sketch of
the proof of Proposition 1, we discuss a simpler case with identical locations. We then proceed to sketch the
proof of Proposition 1 and characterize the solution to the profit maximization problem. The formal proof
is relegated to the Appendix.

2.3      Uniform Space
We begin by discussing a simpler case, where all locations are identical. Assume the local profitability of
all locations is x and commercial land rents are R. In this special case, the solution to the firm's problem
is known. If a firm places N plants, the firm's payoff will be no higher than xz (qj , N )-1 Ns g (|S|/N ) - RN
where |S| is the area of S and, as stated in Proposition 1, g (x) is the integral of the transportation cost over
a regular hexagon with area x centered at the origin. This follows from the Sum of Moments theorem in
Fejes Toth (1953), one of the landmark results in discrete geometry.8 That is, the nearly optimal policy is to
have uniform catchment areas in the form of hexagons, with plants at the center of each hexagon. Figure 4
shows an example of this solution.
    Why are hexagonal catchment areas optimal? Jensen's inequality implies that it is optimal to have
catchment areas of roughly the same area. Furthermore, optimality dictates that the shape of each catchment
area should minimize the average distance from the center to the points in the catchment area. Among all
shapes, a circle minimizes this average distance. However, one cannot form a tessellation with circles as they
would either overlap or leave empty spots. Among all polygons with which one can construct a uniform
tessellation, the hexagon is closest to a circle.
length of a period shrinks to zero, the amount of risk must grow without bound so that there is a meaningful amount of risk
to compare across assets. The key, as in our setup, is that the speed at which risk grows is the same as the speed at which the
period shrinks. Thus, the relative importance of risk per period unit remains constant. In the appropriate limit, the value of
assets follows a Brownian motion.
   8
     While the appearance of hexagons as a result of the optimal configuration of economic activity in space is sometimes
associated with Christaller (1933), the formal statement and proof are due to Fejes Toth (1953).



                                                              10
                                               Figure 4: Hexagons in a Square




                          Notes: The figure shows a square of area |S| divided by N hexagons of area |S|/N .




      Note that this is an upper bound. As Figure 4 shows, N disjoint uniform hexagons of size |S|/N
generically do not fit exactly in the space S .9 It is straightforward to show that if N is large, i.e., if |S| is
large relative to the size of the catchment areas, then the boundary issues is quantitatively less relevant. In
the "appropriate" limit, the upper bound is attained.

2.4      Heterogeneous Space
We are interested in understanding the location of a firm's plants in heterogeneous space. Proposition 1
provides our key result for this case. The proposition establishes that we can use a similar "large N " limit
to obtain a simple characterization of the firm's optimization problem when space is heterogeneous. It
states that, in the limit, the optimal policy is to place plants so that local catchment areas are uniform,
infinitesimal, hexagons. The variable ns is the measure of plants in the neighborhood of s, so that 1/ns is
a measure of the size of the catchment areas.

2.4.1      A Sketch of the Proof of Proposition 1
                (-1)-1
Define bs                (Bs /Ws )-1 . Recall that a firm j 's profits are given by


                              j = Z (qj , Nj )-1           Ds max bo T (so )1- ds -               Ro .
                                                       s     oOj
                                                                                            oOj


      We start by dividing the unit square S into congruent squares with side length k , indexed by i  I k ,
  9
      Bollobas (1973) showed that the upper bound can be attained only if S is the union of N disjoint regular hexagons.


                                                                 11
                                                                                          ¯ k = sup k Rs
denoted by Sik (for any k such that 1/k is an integer). For each k , for each square, let R i       sSi
      k                                                                              ¯ k
and Ri = inf sS k Rs be the highest and lowest rents in square i. Similarly, define Di = supsS k Ds and
                i                                                                                 i
Dk = inf k Ds , ¯
  i         sSi   bk = sup k bs and bk = inf k bs . With these bounds for rents, demand, and the costs
                      i        sSi             i       sSi
per efficiency unit, within these intervals. we can construct upper and lower bounds for profits,  k and
                                                                                                  ¯j
k 
j . We can then show that
                                                       k  
                                                       j  j  
                                                              k
                                                             ¯j .

   Here,    k is an upper bound constructed by replacing the rent in each location in square S k with Rk and
           ¯j                                                                                  i       i
the effective demand and effective productivity in each location in square S k with D¯ k and ¯
                                                                                             bk .10 Similarly,
                                                                                           i          i        i
k                                                                    ¯ k , Dk , and bk
        constructs a lower bound by replacing each Rs , Ds , bs with R               i for the locations in square,
 j                                                                     i    i
Sik .   In constructing the lower bound, we impose the ad hoc restriction that each plant located in Sik only
sells to households in Sik , and all plants within Sik have catchment areas that are formed by regular hexagons;
since regular hexagons do not form a tessellation of a square, not all customers in Sik are served by the firm
in this suboptimal policy.
      The second step is to study the limit as   0. Define the function (ns )  ns g (1/ns ). Then, for any
k , we prove that  k and  k are such that
                  ¯j      j

                                                                                -1
                       lim  k
                           ¯j  k
                              ¯j
                                  sup                  ¯ k¯
                                                       D    k
                                                                                      (ns ) - ns Rk
                                                         s bs z qj ,     ns
                                                                          ~ds
                                                                            ~                     s   ds,
                      0                   {n0}


and
                                                                                -1
                      lim   k 
                                    k    sup           Dk  k                                     ¯k
                                                                                      (ns ) - ns R
                            j       j                   s bs z    qj ,   ns ~
                                                                          ~ds                     s   ds,
                      0                   {ns 0} s

which imply that
                                                        k
                                                        j  j  
                                                               k
                                                              ¯j ,
               . For any k , the economic features are uniform within each square S k , so we can
where j  lim0 j                                                                    i
use results from discrete geometry to derive relatively simple expressions for the bounds. For the upper
bound, the results imply that the catchment areas within each square Sik form a mesh with uniform regular
hexagons. For the lower bound, the ad hoc restriction imposes that the catchment areas form a mesh with
uniform regular hexagons.
      The final step is to show that

                                                                                -1
                            k
                       lim ¯j = lim  k
                                     j = sup           Ds bs z qj ,      ns
                                                                          ~ds
                                                                            ~         (ns ) - Rs ns   ds,
                      k0         k0           n    s

  10
     In constructing this upper bound, we compute separately for each k × k square, the profits the firm would earn from the
            k
plants in Si  , if it had no other plants in all of S . We then add together the profits for all k × k squares. Clearly, we are
constructing an upper bound for profits, not the value of profit for any feasible policy. Note also that, when we take the limit
  0, sales outside a plant's k × k square go to zero.




                                                                 12
i.e., that the limit can be interchanged with the supremum. Since xs = Ds bs , this proves Proposition 1.
The rest of the technical details of the proof are relegated to the Appendix.

2.4.2    The Local Efficiency of Distribution and its Properties

The function (ns )  ns g (1/ns ) can be interpreted as the local efficiency of distribution in the neighborhood
of s. It represents the fraction of the value of sales a firm retains after subtracting the cost of optimally
transporting the goods to consumers from its ns plants. Figure 5 provides a one dimensional representation
of the function g (·) and the implied function (·). The following lemma describes some useful properties of
.

                        1
Lemma 2 (n)  ng         n   is strictly increasing and strictly concave, and satisfies the following properties:

    1. (0) = 0;

    2. limn (n) = 1;

    3. 1 - (n)  n-1/2
                  n
                                      4
If transport costs satisfy lim  - -1 t( ) =  then

    4.  (0) = 0;
                        1- 2d
    5.  (0) =     0 t( )        < .

    The first property says that without plants revenues are zero. The second property states that as n
grows infinitely large, catchment areas grow small and (n) approaches an upper bound of 1. Additional
plants only cannibalize other plants without significant gains from reducing transport costs; the economy
becomes "saturated". The third property states that (n) follows an asymptotic power law as n grows large.
If, asymptotically, trade costs increase sufficiently fast with distance, we can give a sharper characterization
of the efficiency of distribution when n is small. The fourth property states that when the number of plants
is small, local profits increase linearly in the number of plants. In sum, cannibalization is irrelevant for the
first set of plants but the dominant force when the number of plants grows large. Finally, the fifth property,
says that there is no Inada condition at n = 0. Hence, there can be locations s in which the firm places no
plants, ns = 0.

2.5     The Assignment of Plants to Locations
Proposition 1 can be used to characterized how firms place their plants. As before, we assume that the firm
takes as given the distribution of commercial rents, Rs , and the distribution of local profitability, xs . The




                                                       13
     Figure 5: A One Dimensional Representation of the Efficiency of Distribution, (ns )  ns g (1/ns )



                t( )1-                          g      1
                                                      ns
                           1-



                           0
                                                                                                 1
                                          1
                                         ns



problem of choosing how many plants to have, Nj , and their distribution in space, nj : S  R+ , can be
stated as
                                     sup            xs z (qj , Nj )-1 (njs ) - Rs njs ds,
                                Nj ,nj   :SR+   s

subject to
                                                              njs ds  Nj .
                                                          s

Letting j be the multiplier on the constraint, the first order condition with respect to njs is given by

                                 -1
                            x s zj   (njs )  Rs + j ,                 with equality if njs > 0,             (3)

where we use zj as shorthand for z (qj , Nj ). The first order condition with respect to Nj is

                                                    d[z (qj , Nj )-1 ]
                                           j = -                             xs (njs )ds.                   (4)
                                                          dNj            s

   To characterize the solution to this problem it is useful to make the following assumption on the pro-
ductivity function z (q, N ).

Assumption 2 z (q, N ) = q (N ), where  is a log-concave function.

   Using the first order conditions in (3), together with this assumption, we can show that firms with higher
endogenous productivity have higher marginal cost of increasing the number of plants, even relative to their
                              -1
firm-specific profitability, zj  .

                                                                          1          2
Lemma 3 Consider two firms with z1 < z2 . Then, either                    -1
                                                                         z1
                                                                                <    -1
                                                                                    z2
                                                                                          or N1 = N2 = 0.

                                                                 14
                                                                                                        Rs +j                         1         2
Proof. Since  is concave, the density of plants is a decreasing function of                                  -1 .
                                                                                                        xs z j
                                                                                                                    Suppose that      -1
                                                                                                                                     z1
                                                                                                                                                -1 .
                                                                                                                                               z2
                                  Rs +1         Rs +2
Then, in every market                  -1
                                  xs z 1
                                            >        -1 .
                                                xs z 2
                                                            Therefore n1s  n2s with a strict inequality whenever n2s > 0. If
                                                                                                                                              1
N2 > 0, then N2 > N1 , and the log-concavity of z with respect to N along with  > 0 implies                                                   -1
                                                                                                                                             z1
                                                                                                                                                   =
( -     1) -zN (q1 ,N1 )
            z (q1 ,N1 )     s xs (n1s )ds   < ( -      1) -z N (q2 ,N2 )
                                                           z (q2 ,N2 )     s xs  (n2s ) ds   =    2
                                                                                                  -1
                                                                                                 z2
                                                                                                       , a contradiction. If N2 = 0, then
N1 = 0.
       Our next result uses the previous Lemma to prove that more productive firms set up relatively more
plants in locations with higher rents.

Proposition 4 Consider two firms with z1 < z2 . Let R (z1 , z2 ) be the unique rent that satisfies

                                                                                 -1
                                                             R (z1 , z2 ) + 2   z2
                                                                              =  -1 .
                                                             R (z1 , z2 ) + 1   z1

Then, Rs > R (z1 , z2 ) implies that n2s  n1s , with strict inequality if n2s > 0; Rs < R (z1 , z2 ) implies that
n1s  n2s , with strict inequality if n1s > 0; and Rs = R (z1 , z2 ) implies that n1s = n2s .
                                                                                                                              -1
                                                                    2           1                     R+2                    z1  R+2
Proof. z2 > z1 implies that 2 > 1 and                               -1
                                                                   z2
                                                                           >    -1
                                                                               z1
                                                                                     . Therefore      R+1    > 1, so          -1 R+
                                                                                                                             z2     1
                                                                                                                                          is strictly
                                             -1                     -1                            -1                 -1
                                            z1     R+2          2 /z2                            z1    R+2          z1
decreasing in R. Since limR0                 -1
                                            z2     R+1      =       -1
                                                                1 /z1
                                                                           > 1 and limR           -1
                                                                                                 z2    R+1   =       -1
                                                                                                                    z2
                                                                                                                          < 1, there is a unique
                      -1
                     z1    R+2                                                                                      Rs +2        Rs +1
R such that           -1
                     z2    R+1    = 1. If Rs > R (z1 , z2 ) and n2s , n1s > 0 then  (n2s ) =                         -1
                                                                                                                    z2  xs
                                                                                                                             <    -1
                                                                                                                                 z1  xs
                                                                                                                                          =  (n1s )
and since  is decreasing, n2s > n1s . If n2s > 0 and n1s = 0, then of course n2s > n1s . If n2s = 0, then
            Rs +2          Rs +1
 (0)         -1
            z2  xs
                     <      -1
                           z1  xs
                                  ,   which implies that it is optimal for n1s = 0. The argument for Rs < R (z1 , z2 ) is
identical. The argument for R = R (z1 , z2 ) is trivial.
       Proposition 4 states that for two firms with different productivities, there is a cutoff level of rent such
that the firm with higher productivity places more plants in locations with higher rent and the firm with
lower productivity places more plants in locations with lower rent. Thus, even while the two firms have
overlapping footprints, there is a clear pattern of sorting. Figure 6 provides a graphical representation of
this result.
       The type of sorting implied by Proposition 4 stands in sharp contrast to workhorse models of trade and
multinational production in which the more marginal locations are reached by the most productive firms.11
Here, it is the less productive firms that go to the lower rent locations. Why the difference?
                                                                       -1
       Firms balance the marginal profit from an additional plant, xs zj   (njs ), against the effective fixed
cost of a new plant, Rs + j , which depends on the local rent and the productivity penalty arising from
the larger span of control of managers. As Lemma 3 shows, higher productivity firms have higher span of
                                                                 -1
control costs, as given by j , relative to their profitability, zj  . Hence, a higher rent has a smaller impact
                                             d ln(Rs +j )
on their costs. Formally, since                 d ln Rs      is decreasing in j , the effective fixed cost of setting up a plant
rises proportionally less with rents for the high productivity firm, and so it places relatively more plants in
  11
       See for example Melitz (2003), Eaton and Kortum (2002), and Ramondo and Rodr´
                                                                                   iguez-Clare (2013).


                                                                            15
                    Figure 6: Location of Plants of a High and a Low Productivity Firm

                     Measure of plants




                                                                     High productivity firm



                               Low productivity firm




                                                                                R
                                                        R*


high rent locations. Most models of plant location decisions in the literature do not feature cannibalization
and span of control costs, and so they miss this implication.
   We can extend the result further to show that the marginal efficiency of distribution of more productive
firms is relatively smaller in higher rent locations.

Lemma 5 Consider two firms with z1 < z2 and two locations with Rs < Rs
                                                                     ^. Then, if n1s , n1^
                                                                                         s , n2s , n2^
                                                                                                     s > 0,

                                                 (n2s )    (n2^
                                                              s)
                                                        >        .
                                                 (n1s )    (n1^
                                                              s)

                        R+2              R+2
Proof. Since 2 > 1 ,    R+1   > 1, so    R+1   is decreasing in R. Hence, we have that

                               (n2s )  z -1 Rs + 2    -1
                                                     z1     Rs
                                                             ^ + 2    (n2^
                                                                         s)
                                      = 1 - 1      >    - 1        =        .
                               (n1s )  z2 Rs + 1     z2 Rs   ^ + 1    (n1^
                                                                         s)



   So far we have shown that firms sort based on local commercial rents. Similarly, we can show that
firms sort according to local profitability, xs . The next proposition shows that, if there is sorting, high
productivity firms set relatively more plants in locations with high profitability.

Proposition 6 Consider two firms with z1 < z2 . Suppose there is a location s such that n1s = n2s =
n > 0. Then, for any location s with xs > x , n2s > n1s , and for any location s with xs < x , n2s < n1s .
                                                        -1                 Rs +j
Proof. Suppose that xs > x . The first order condition zj   (njs ) =         xs    implies that

                  -1                                    -1
                 z2   (n2s ) xs -  (n ) xs = Rs - Rs = z1   (n1s ) xs -  (n ) xs ,

                                                         16
which can be rearranged as

                                                                   -1  (n2s )  -1  (n1s )
                                                                       (n ) - z1
                                    -1            -1              z2
                               x   z2   (n2s ) - z1      (n1s )                       (n )
                            1>    = -1              - 1         =         - 1    - 1       .
                               xs   z2  (n ) - z1  (n )                z 2 - z1

Since z1 < z2 , the inequality implies that  (n2s ) <  (n1s ), or n2s > n1s . The xs < x case can be proven
analogously.
       The results above condition on firms with a positive density of plants in particular locations. Our next
result shows that, for any given location, there is a productivity threshold such that firms with productivity
below the threshold do not set up plants in that location. Under further restrictions on the span of control
costs, the lemma also shows that there is another threshold such that firms with high enough productivity
do not set up plants there either. That is, when all conditions are satisfied, only plants with productivities
between these thresholds set up plants in a given location.
                               2
Lemma 7 If lim               t( )-1
                                      = 0, for any location s, there exists a productivity threshold z s > 0 such that
                                        j
njs = 0 if zj < z s . If limz         z -1
                                             = , then there exists an additional threshold z
                                                                                           ¯s <  such that njs = 0
if zj > z
        ¯s .

Proof. ns (z ) denotes the density of plants a firm with productivity z places in location s. The first order
                                                 Rs +j
condition (3) implies that ns (z ) = 0 if        xs z -1
                                                           >  (0). Since j > 0,

                                                    R + j        R
                                                lim        lim -1 = ,
                                                z 0 xz -1  z 0 xz
                       j
and, if limz         z -1
                            = ,
                                                      R + j   1      j
                                               lim          =    lim    = .
                                               z      xz -1   x z  z -1
                                                                                                                     2
The result follows from the fact that  is continuous, strictly decreasing, and  (0) <  if lim                      t( )-1
                                                                                                                            =0
by Lemma 2.
       Our final result in this subsection refers to the total size of firms. The results above condition on a firm's
productivity. However, empirically, it is easier to condition on other firm observables, such as their total
employment size or the total number of plants. We do not have a result that the total number of plants
is increasing in firm productivity. Not only do firms sort their plants across locations, but their optimal
plant size varies depending on local characteristics. However, under particular parametric assumptions on
a firm's productivity function, and if wages are constant across space, we can show that more productive
firms employ more workers.12 We let Lj denote the total number of workers of firm j and ljs denote its
density of employment in location s.

Lemma 8 Suppose that z (q, N ) = qe-N and local wages are constant across locations at W . Consider two
firms with z1 < z2 , then either L1 < L2 or L1 = L2 = 0.
  12
       The assumption of equal local wages is consistent with the general equilibrium framework we setup in Section 3.


                                                                17
                                                         -1                                                
Proof. For firm j , variable profit in location s is xs zj  (njs ), so with a markup of                    -1 ,   the expenditure
                                              -1
on labor in s         is Ws ljs = ( - 1) xs zj    (njs ). Since the wage Ws = W           for all s  S , j 's total employment
              -1           -1                1 1
is Lj =       W        xs zj  (njs ) ds = W  j . If N1 = N2 = 0, then L1 =                L2 = 0. Otherwise, by Lemma 3,
 2            1
 -1
z2
          >    -1
              z1
                    , which implies 2 > 1 , and so L2 > L1 .


3         Equilibrium
We now proceed to embed the problem of the multi-plant firm that we studied in the previous section into a
general equilibrium framework. The purpose is to illustrate how the proposed limit of the firm's problem can
be readily incorporated in a quantitative spatial model. We choose a particular equilibrium model to do so,
but many alternative general equilibrium setups would work as well. We start by embedding the standard
problem in our equilibrium setup and then characterize the limit when   0. We let locations in S be
heterogeneous in their exogenous productivity, Bs , and an exogenous amenity, As . Denote the endogenous
number of workers at s by Ls .

3.1         Workers
The economy consists of a mass L of workers who can freely move across space. They choose a location where
to live and work, and supply one unit of labor inelastically in that location. They consume a consumption
bundle, c, housing space, h, and amenities according to the utility function

                                                       u(c, h, A) = Ac1- h .                                                  (5)

Consistent with Assumption 1, c is a Dixit-Stiglitz bundle of all varieties j , with elasticity of substitution
across varieties . A worker in location s earns a wage Ws , faces price of consumption bundle Ps , and faces
                        H per unit of housing space. In addition, the household owns a share of a mutual
rental cost of housing Rs
fund that owns all firms and all land, and receives from the mutual fund a lump sum transfer . Hence,
the budget constraint of the worker is given by

                                                              H
                                                      Ps c + Rs h  Ws + .                                                     (6)

                                                                                                         p-
Then, if cs denotes the optimal choice of the CES consumption bundle by agents in s, Ds (pjs ) = Ls cs Ps js
is the residual demand function.13 Hence, the local demand level can be defined as Ds = Ls cs Ps
                                                                                               .



3.2         Land Use
There is a unit measure of land in each location that is owned by a national mutual fund. Competitive
                                       M and use it for either commercial real estate, renting it to plants
developers can rent the land at price Rs
    13
         Where we are already using the implication that identical agents make identical choices in each location.


                                                                  18
                                                                    H . Housing and commercial real estate are
at rate Rs , or residential housing, renting it to workers at rate Rs
perfect substitutes and satisfy the constraint

                                                       Hs + Ns  1,                                                                    (7)

where Hs is total measure of housing, Ns is the total measure of commercial real estate. Note that Ns / is
the measure plants at location s. In addition, since all workers in the same location choose the same amount
of housing, hs = Hs /Ls .

3.3      Equilibrium definition and limit economy
We are ready to define a competitive equilibrium.

Definition 1 Given a set of local fundamentals, {As , Bs }sS , an equilibrium is a population, land, and
                                                                                      M , RH , P }
consumption allocation {Ls , Ns , hs , cs {cjs }j J }sS , a set of prices {Ws , Rs , Rs    s    s sS , a set of firm
choices, Oj , {ljo , Sjo }oOj , {pjs }sS , and profits j , for each j , a level of utility u
                                                                                           ¯ and a transfer payment
, such that:

      · Individual maximize (5) subject to (6) and are indifferent across locations for which there is positive
                       ¯  u(cs , hs , As )s  S , with equality if Ls > 0.
        employment, so u
                                                                                            -1            -1
                                                   1- =                      1-
      · The price and consumption indexes satisfy Ps                      j pjs dj and cs
                                                                                          
                                                                                           =             
                                                                                                    j cjs dj .

                                                                              H h L + R N - RM .
      · Developers maximize profit. Hence, given rents, {Hs , Ns } = arg max Rs  s s   s s   s

      · Firms solve the problem in (1) and (2) for each j .

      · The transfer payment is given by  =              M
                                                      s Rs ds     +   j   j dj .

      · Goods, labor, and land markets clear. Thus, for each j and o  Oj ,

                                                                         -         T (so )
                                           ljo =                 Ls cs Ps pjs                   ,
                                                   sCT (o)j                     Bo Z (qj , Nj )

        L=    s Ls ds,   and, s  S , Ls =     j ljs I{sOj } dj   and (7) hold.14

      In the Appendix we prove that, when   0, the equilibrium defined above has a standard structure.
Using only the decisions of firms and the definition of the Dixit-Stiglitz consumption aggregate, we can
characterize a location's aggregate productivity in Proposition 9.

Proposition 9 In the limit when   0, the number of plants is given by Ns =                            j   njs dj , and the local price
                                                                                                                             1
                                                        Ws                                                     -1            -1
index and consumption bundle satisfy Ps =           -1 Bs Zs ,     and cs = Bs Zs , where Zs                j zj  (njs )dj        .
 14
      Where I{sOj } denotes an indicator function equal to 1 when s  Oj and 0 otherwise.


                                                                 19
      Observe that aggregate productivity in a location, Zs , is the CES aggregate of the firms' effective
productivities, zj , with weights given by the efficiency of distribution, (njs ). Then, the local price index is
just the standard CES markup times the `aggregate' local marginal cost. Similarly, the local consumption
bundle is simply the local labor productivity. With Proposition 9 in hand, we can solve easily for the rest
                                                                       1 Ws Ls
of the equilibrium. The local profitability is given by xs =          -1 Zs-1 . The utility specification in (5) implies
                                                                         
that Ps cs = (1 -  )(Ws + ), and so the nominal wage             solves -1 Ws = (1 -  )(Ws + ). Hence, the nominal
wage is the same in all locations, and proportional to the transfer payment .
                                                                         - 
                                                               ¯ = As c1
      Perfect mobility implies that all workers obtain utility u       s hs . Since hs Ls = Hs , population
                                                  1/
                             1      1- 1-
in location s is Ls =        ¯ As B s
                             u        Zs Hs            , and so the labor market equilibrium condition implies, as is
standard in this class of models, that

                                                                            1/
                                                             1- 1-
                                             Ls          As Bs Zs H s
                                                =                           1/
                                                                                      .
                                             L              1- 1-
                                                       s As ~ Zs
                                                          ~Bs  ~  Hs             ds
                                                                                  ~

                                                          H = RM (since all locations have some establish-
      Note that developer optimization implies that Rs = Rs    s
ments and population in the limit). Consumer optimization implies that Rs hs =  (Ws + ), which together
                                                                                                       M.
with zero profits for developers and the land market clearing condition in (7), determine hs , Rs and Rs
      In sum, Proposition 9 gives us the key local aggregates to solve the general equilibrium of the model as
in standard spatial equilibrium frameworks.15 Of course, to do so requires knowing the function  as well
as the solution to the firm's problem which we characterized in Section 2.

3.4      Numerical Illustration of an Industry Equilibrium
To illustrate more concretely some of the equilibrium implications of our theory, we now specify all relevant
functional forms and distributions and solve for an equilibrium of the model numerically. Our parametriza-
tion is intended to make the relevant forces visually clear and transparent. We study the implications of a
single `small' industry when transport or span of control costs change for that industry only. Hence, in the
comparative statics exercises, we keep rents and wages fixed which implies that firms within an industry
interact exclusively through the local industry price index.
      Assume that the economy is formed by a unit continuum of industries, and that households have sym-
metric Cobb-Douglas preferences across these industries so that expenditure on any mass of industries is a
constant fraction of local income. Expenditure in location s, Is , is distributed truncated Pareto, so that the
measure of locations with income weakly less than I is [1 - (I/I )-I ]/[1 - (I/I ¯ )-I ], with I = 1, I ¯ = 25,
and  = 2. We set the elasticity of substitution across varieties, , to 2. We assume that the amenity
                                                                                                              2
distribution is such that the rent schedule in a location with income Is is given by R(Is ) = elog(Is ) .
                                                         
    Let transportation costs take the form t( ; )  t(/ ), where  indexes the efficiency of transportation
 15
      See Redding and Rossi-Hansberg (2017) for a review of the quantitative spatial economics literature.



                                                               20
(i.e. a higher  implies lower trade costs for a given distance traveled,  ).16 This implies that (n; )  (n).
                                                           
We parameterize transportation costs as t(/ ) = e/  . We set  = 0.04. Firms' productivity is given by
z (q, N ) = qe-N/ , where  indexes the efficiency of a firm's span of control (i.e. a higher  implies a higher
z for the same aggregate size of the firm, N ). We set  = 1. There is a unit measure of firms, and the
distribution of productivity is given by a truncated Pareto distribution so that the measure of firms with
pure productivity no greater than q is [1 - (q/q )-q ]/[1 - (¯
                                                             q /q )-q ], with q = 0.1, q
                                                                                       ¯ = 10, and q = 1.25.

                                       Figure 7: Sorting in Industry Equilibrium

                            Plants                                                            Sales




       We first describe the baseline industry equilibrium and then proceed to study comparative static exercises
with respect to  and . Appendix E describes the numerical algorithm that solves for the industry
                                                                                   -1
equilibrium. Figure 7 presents the distribution of plants, njs , and sales, ( - 1)zj  xs (njs ), for three
representative firms: a firm with the lowest productivity, q = 0.1, a firm with intermediate productivity,
q = 1, and a firm with the highest productivity, q = 10. As implied by Proposition 6, for any pair of firms,
there exists an income threshold (or, equivalently, a rent threshold since rents are monotone in income) such
that the more productive of the two firms sets up more plants above the threshold and fewer plants below.
In our example, the most productive firm operates many plants in middle income locations and fewer plants
in very high or very low income locations (the case q = 10 in the left-hand panel of Figure 7). In fact, it
operates no plants in the worse locations. The logic should be clear; rents in high income locations are high
which encourages high productivity firms to economize on plants at the cost of having lower efficiency of
distribution, (njs ). As shown in the right-hand panel of Figure 7, they compensate with higher sales from
each plant which results in higher total sales. Low income locations, in contrast, are less attractive to large
  16                                                     
     Note  is defined so that it enters the function t as , while it enters the function  linearly. The reason for the discrepancy
is that the function  is constructed from an integral over a two dimensional space.


                                                               21
firms, since their shadow cost of setting up an additional plant is high given the productivity penalty that
arises from their larger span of control (j is increasing in qj ). Again, these firms compensate with higher
sales from each plant. Firms with lower productivity then take advantage of low income locations given
their lower span of control and the lack of competition from top firms in those locations.
    The total measure of plants across locations depends on both the set of firms that open plants in each
location and how many plants they open. High income locations accommodate only the best firms which
operate few plants because of the associated high rents. Low income locations attract the worst firms, which
set up few plants since they have low productivity. In general, the overall dependence of the total number
of plants on the level of income depends on the distribution of amenities and other characteristics of the
economy through the rent function. Figure 8 shows that in this example, the log of the measure of plants is
hump-shaped. Figure 8 also presents the log of local industry productivity, Zs , which is also hump-shaped
though its maximum lies to the right of that of the measure of plants. As Proposition 9 shows, local industry
productivity depends on the productivity of firms that locate in the region, which is strictly increasing in
local income, but also on the local efficiency of distribution, which is lower in high-income locations because
                                                                                    1   Is
of higher rents. Ultimately, however, local profitability for the industry, xs =        -1 ,
                                                                                    -1 Zs      remains strictly
increasing in Is .

              Figure 8: Log of Total Measure of Plants and Industry Productivity by Location




3.4.1    Improvements in an Industry's Span of Control Technology

Consider the effect of an improvement in the span of control technology captured by an increase in the
parameter  in the firm's productivity function, z (q, N ) = qe-N/ . A better span of control technology
increases firm productivity and lowers the shadow cost of adding new plants. This motivates firms to have
more plants in more locations. In equilibrium, the additional entry leads to more local competition, through

                                                      22
an increase in Zs at all locations, which makes some firms shrink and others exit from some, or all, locations.
   Figure 9 reproduces Figure 7 (the solid lines computed for  = 1) and compares it with findings for  = 3
(the dashed lines). In response to the improvement in span of control technology, the top firm increases
the measure of plants in low-income locations. It also reduces its presence slightly in the highest-income
markets because of increased competition. The middle-productivity firm expands its presence in both lower
and higher-income locations. Holding fixed the actions of other firms, the lowest productivity firm would
benefit from the improved span of control technology as well. However, increased competition pushes it to
exit all markets. The top firm not only enters lower-income markets but, with improved span of control
technology, ends up outselling the medium productivity firm that already had a presence in those locations.
The ability to manage a greater span of control, therefore, results in a net reallocation of sales from low to
high-productivity firms.

                     Figure 9: Span of Control and Sorting in an Industry Equilibrium

                        Plants                                                  Sales




   The left-hand panel in Figure 10 shows how an improved span of control technology affects the shadow
cost of additional plants, j . As argued above, j declines following the direct effect of the technological
change. The effect is clearly magnified for high-productivity firms. These firms benefit most since their
better technology makes them want to expand more extensively in space, and thus makes them benefit
disproportionately from a technology that renders such an expansion less costly. The right-hand panel in
Figure 10 shows the effect of the span of control technology on local profitability, xs . Increased competition
lowers local profitability but more so in low-income locations. These are the locations where top firms
expand and where they now compete with lower productivity firms. Although the total number of plants
increases everywhere, low-income locations exhibit the largest increase in the number of plants.



                                                      23
              Figure 10: Effect of Improvements in Span of Control Technology on j and xs

                          j                                                       xs




3.4.2   Improvements in an Industry's Transportation Costs

Consider the effects of an improvement in transportation technology captured by an increase in  in the
                                          
transportation cost function, t( ) = e/      .   An increase in transportation efficiency reduces the cost of
reaching customers and so incentivizes firms to have fewer plants with larger catchment areas. Fewer plants
imply lower managerial costs associated with firms' span of control which in turn increases productivity
and induces them to expand. The larger catchment areas effectively reduce the (fixed) rent costs of serving
consumers in a location, which encourages the entry of all firms in more markets but particularly incentivizes
the entry of less-productive firms. Furthermore, lower transport costs imply more cannibalization between
plants. This effect is particularly relevant for high-productivity firms since they operate more plants. Hence,
we expect improvements in transport efficiency to disproportionately benefit low-productivity firms. The
incentives to enter more locations with fewer plants implies that competition at the local level increases
everywhere, as reflected by an increase in Zs . This countervailing force reduces firms sales in some locations.
   Figure 11 shows the effect of an increase in  from 0.04 to 0.4 on the mass of plants and sales of
the representative high, medium and low productivity firms discussed earlier. The left-hand panel shows
that all firms expand to new locations but also have fewer plants in most locations where they where
already present. The top firm expands to low-income locations and now sells everywhere, while the medium
and low-productivity firms expand to higher income locations. The increase in competition implies that
profitability, xs , declines almost uniformly across markets. As the right-hand side of Figure 11 shows,
increased competition implies that all three firms see their sales fall in many of the markets where they were
already operating.
   While the improvement in transport technology leads firms to expand the range of locations in which

                                                       24
               Figure 11: Transportation Efficiency and Sorting in an Industry Equilibrium

                        Plants                                                   Sales




they are active, they also have fewer plants. The effect on the total number of plants, therefore, is ambiguous.
In this simulation, the total measure of plants falls in both low-income and high-income markets. However,
it increases in middle-income markets as a large number of lower-productivity firms now choose to enter
these markets. Overall, the improvement in transport costs favors low-productivity firms. Figure 12 shows
that improvements in transportation technology lead total sales to increase for the lowest-productivity firms
while total sales by the top firms decline.

            Figure 12: Effect of Improvements in Transportation Efficiency on Total Firm Sales




                                                      25
4         Empirical Evidence
Our theory provides a number of concrete implications about the location of plants in space. In this
section, we contrast these implications with U.S. evidence for the year 2014. Our main source of data is
the National Establishment Time Series (NETS), which is provided by Walls & Associates. NETS provides
yearly employment information for `lines of business', which we associate to plants in the theory, and refer to
as plants or establishments in the reminder of the paper.17 For each establishment, we know its geographic
coordinates, its industry classification, and its parent company.18 We classify industries according to the
SIC8 industry classification, with over 18,000 distinct industries.
         We are interested in exploring how firms place their plants across space. To do so, we require a consistent
definition of a `location'. We follow Holmes and Lee (2010), and divide the continental United States into
squares with side length of M miles. We present results for values of M ranging from 3 to 48 miles.

4.1        Sorting in the Data
A central and distinctive prediction of our model is that more productive firms sort towards `better' locations.
In order to study sorting in the data, we first need to map firm productivity and location characteristics
to observable measures in the data. In Lemma 8, we show that firm total national employment in a given
industry is strictly increasing in its productivity. We can measure a firm's total employment directly in the
data. The discussion in the previous sections shows that population in a location is related to a combination
of its exogenous amenities, productivity, as well as endogenous characteristics of firms that set up plants in
that location. We can easily measure population density in the data (since all locations are squares with
the same area), and then use this metric to rank locations.
         Our main results related to sorting are presented in Proposition 4 and Proposition 6. These propositions
establish that more productive firms set up relatively more plants in locations with higher land rents or
higher local profitability. We do not observe local rents in the NETS data. However, using alternative data
sources, it is clear that there is a very tight positive relationship between rents and our ordering of locations
using population density. Figure B.1 in Section B of the Appendix shows the relationship for zip codes and
counties using ACS and Zillow data. Hence, in what follows, we use population density as a measure of the
local characteristics on which firms sort.
         As in the theory, let Ls , denote population density in location s. The average weighted density of the
    17
     The definition of a line of business is almost identical to the definition of an establishment or plant (which we use as
synonyms). An establishment may contain one or more lines of businesses. Although conceivable in principle, in practice
almost all plants have a single line of business. Thus, we refer to a line of business as a plant. For those cases where two lines of
business are present in the same exact location, and thus in the same plant, each line of business is identified as a single plant.
  18
     A more detailed description of NETS can be found in Rossi-Hansberg et al. (2018). We mostly use only a cross-section
of NETS for 2014. Compared to Census data, a cross section in NETS has two main discrepancies. First, as pointed out by
Barnatchez et al. (2017), it has an excess of very small firms, partly because it keeps track of non-employee firms. Thus, we
restrict our attention to firms with at least five employees. Second, as discussed in Crane and Decker (2019), it has imputed
employment data. We therefore only use non-imputed observations. For firms with at least five employees, the fraction of plants
with non-imputed employment is 81.5%.


                                                                 26
                                               ¯ ji , is given by L
                                                                  ¯ ji 
locations of a firm j operating in industry i, L                                           s jis Ls ,   where jis is the weight for
firm j in industry i at location s. We compute the weights jis in three alternative ways: by the number
of plants owned by j in s, by its employment in s, or by assigning equal weights to each location s. For
each case, the sum of the weights across locations for a given firm j operating in industry i add up to one,
  s jis = 1. We use weights given by the number of plants as our baseline since our results refer directly
                                       ¯ ji , we subtract industry fixed effects. We use the residuals as
to the choice of njs . Once we compute L
our measurement of a firm's average weighted density of location. Figure 13 presents, for a set of different
resolutions M , binned log average firm employment densities as a function of log firm size, ln Lj . As the
figure shows, for all resolutions, there is a strong increasing relationship between firm size and average
density. As implied by Proposition 4 and Proposition 6, larger firms sort into denser places that tend to
exhibit larger rents and better fundamentals.

                                                 Figure 13: Sorting in the data




 Notes: The figure presents the results for the log of the average employment density of each location, weighted by the number of
 establishments of a particular firm operating in a particular industry in the location. To produce the figure we first subtract industry
 fixed effects. We then bin the residuals by the log total firm employment at the national level. The figure presents the results for five
 different resolutions M : 3 miles, 6 miles, 12 miles, 24 miles, and 48 miles.


   Figure C.3 in Section C of the Appendix shows that the results are robust to alternative weights.
Figure C.1 in the same Appendix, implements a leave-out strategy to addresses the potential concern that
the firm's presence could be driving local density. In the figure, when we compute a firm's log average
density, we net out its own local employment from each local density. The resulting sorting is virtually
identical.
   Of course, the sorting pattern we have uncovered could arise from omitted characteristics of firms that
are correlated with density. For example, if firms tend to set up plants where they are founded and denser


                                                                   27
locations incubate more productive firms, we would obtain the pattern in Figure 13. To control for fixed
firm characteristics, we can replicate the empirical sorting exercise in time changes. If a firm experiences an
exogenous productivity shock that makes it grow, our theory predicts that it should shift production towards
more dense locations. The productivity shock can be endogenous to all firm characteristics, including the
initial distribution of plants, but we require the shock to be exogenous to the location of new plants. Using
population density in 2000, we replicate the construction of the average weighted log density of the locations
of a firm, but using as weights the number of plants in 2000 and in 2014 alternatively. Figure 14 plots the
difference in the log average density of location for each firm between the year 2014 and the year 2000, against
the log difference in the firm's total employment. It shows, at all resolutions M , that larger increases in
firm size imply shifts to denser locations.19

                                                   Figure 14: Sorting over time




 Notes: The figure is produced by calculating the average population density across all locations where a firm is present, for a given
 industry, holding densities at their 2000 levels and weighting by the firm's establishments in the location in both 2000 and 2014, for
 firms-industry pairs with positive employment in both years. We then compute the log-difference in firm size and in average population
 density between 2000 and 2014, regress each of them separately on industry fixed effects, and store the residuals from each regression.
 We bin the residuals of the log-difference in average density by the log-difference in firm size residuals. The figure presents the results
 for five different resolutions M : 3 miles, 6 miles, 12 miles, 24 miles, and 48 miles.


    We can also explore the implications of Proposition 4 on sorting by looking at the size of the firm with the
largest number of plants in each location. Sorting implies that, in locations with low population densities,
low productivity firms should place more plants than large firms. Figure 15 shows that, in fact, for less
  19
     These results show the average, across firm sizes, relationship between firm density of plant location and firm growth. Hsieh
and Rossi-Hansberg (2019) show using the LBD Census data that the largest firms, in industries that are concentrating at the
national level, have been progressively entering smaller cities since the late 70's. Both results are consistent since top firms in
these industries are behaving differently than the average firm. Proposition 4 admits this case, if the rent R is higher than any
existing rent when we compare the location of the plants of the top firm before and after its change in productivity.



                                                                    28
dense locations, the firm with most local plants has a smaller number of total employees. Specifically, the
national size of the firm with the most plants in a location increases with population density.20 In Figure 15,
there are locations where multiple firms tie for the highest number of plants. In those cases, we use the
average national firm size among these firms. In Section C in the Appendix, we show that the finding is
robust to dropping cases with ties or to using the national size of the largest firm among those tied.

                                Figure 15: The national size of the largest firm in town




 Notes: The figure is produced by finding the log employment of the firm with the most plants in an industry and location, and
 regressing its total employment on industry fixed effects, weighted by each industry's total employment. In locations where multiple
 firms are tied for the highest number of plants, we take the average of the firm size. We then bin the residuals against log population
 density for five different resolutions M : 3 miles, 6 miles, 12 miles, 24 miles, and 48 miles.


       In Section C.4 of the Appendix, we show that these sorting patterns are also present when we focus
on particular industry aggregates. Specifically we reproduce the results using data for Manufacturing,
Services, or Retail Trade exclusively. We find that the strength of sorting varies across sectors. It is weak in
Manufacturing, moderate for Services, and strong for Retail Trade. This ranking is expected since transport
costs in manufacturing are much lower. We revisit this implication later in this section.

4.2      The Role of Span of Control Costs
In the multi-plant firm problem we analyzed in Section 2, two firms present in the same location can choose
to have a different number of plants either because they have different productivity, or because they have
a different cost of increasing their span of control, j . Lemma 3 shows that higher productivity firms have
a higher cost of increasing their span of control, but the marginal cost of increasing the number of plants,
  20
    Note that the relationship is clearly steeper as we increase the resolution M . This is simply the mechanical result of spatial
averaging since larger M implies a lower range of densities but the range of firm employment sizes remains the same.


                                                                   29
                                                  Figure 16: Span of Control




 Notes: The figure presents the results for the log of the average plant employment of a firm within a location. To produce the figure
 we first subtract industry-location fixed effects, and we control for the number of plants of the firm in the location. We then bin the
 residuals by the log total firm employment at the national level, which is controlled for industry fixed effects. Also, we subtract the
 own firm contribution of employment in a location from that firm's total employment. The figure presents the results for five different
 resolutions M : 3 miles, 6 miles, 12 miles, 24 miles, and 48 miles.




j , depends on the entire distribution of local characteristics. Now consider two firms that have the same
number of plants in a location. The larger cost of setting up additional plants, in any location, faced by
more productive firms implies that plants operated by these firms will be larger. Formally, we can write the
average plants size of firm j in location s as

                                                  ¯            -1 xs  (njs )
                                                  ljs = ( - 1)zj             .                                                        (8)
                                                                 Ws njs

Then, it is straightforward to see that, if zj > z~        ¯     ¯ in locations where njs = n~ . Hence,
                                                  j , then ljs > l~
                                                                  js                         js
controlling for the measure of plants in a location, more productive firm place larger plants in a given
location. Consistent with this logic, Figure 16 presents the positive relationship between average plant
employment and total firm employment, after controlling for the number of plants and industry-location
fixed effects.21
  21
     These results are consistent with those found in Fernandes et al. (2018), which finds that a large fraction of the variation of
exports in bilateral trade is through the intensive margin of trade. In our model, this variation maps into variation in average
plant employment within a location. Moreover, our empirical findings are inconsistent with the application of trade models
relying on Pareto distributions to explain the way firms locate their plants across space within the US (e.g., Lind and Ramondo,
2018).



                                                                   30
4.3    Local Saturation
As evident from equation (8), a firm's average plant size in a location s, ¯
                                                                           ljs , depends on its productivity,
zj , local characteristics, xs /Ws , and the number of plants, njs through the local efficiency of distribution
function, . Lemma 2 describes the properties of the efficiency of distribution. It starts at 0, where it
increases linearly because cannibalization is limited with few plants, becomes increasing and concave as the
number of plants grows, and eventually converges to 1. The function describes how the firm increasingly
saturates local markets as it adds plants. Taking logs and the total derivatives of equation (8), we obtain
that

                                               -1            xs     njs  (njs )
                              d ln ¯
                                   ljs = d ln zj  + d ln        +               - 1 d ln njs ,                   (9)
                                                             ws       (njs )
               njs  (njs )                     njs  (njs )
where limn0      (njs )      = 1 and limn        (njs )      = 0 by Lemma 2. The equation implies that, controlling
for changes in firm productivity and local characteristics, firms with very few local plants that add plants in
a location make few adjustments to the size of their plants; with no saturation, new plants do not affect the
size of plants that already exist. In contrast, firms that already own many local plants significantly reduce
the size of their plants when adding plants to a location. In the limit, as the market becomes completely
saturated, any increase in the number of plants is compensated by a similar proportional reduction in plant
size. Hence, at least on average over the whole range, the correlation between changes in plant size and
changes in the number of plants is decreasing in the number of plants, conditional on appropriate firm and
location controls. To test this prediction, we estimate,

              ln ¯
                 ljs = 0 ln njs,2000 + 1  ln njs + 2 ln njs,2000 ×  ln njs + F Es + F Ej + js ,

where F Es and F Ej account for trends in location and firm characteristics, ln njs,2000 denotes the log of j 's
number of plants in location s in year 2000, and  ln njs is the log change in the number of plants between
2000 and 2014. The theoretical implication is that 2 is negative. Table I presents the results. As the table
shows, 2 < 0 for all resolutions M . The effect of the number of plants on plant employment size is more
negative the more plants a firm has in that location.

4.4    The Role of Local Characteristics
The decision of how many plants to set up in a particular location depends, of course, on the characteristics
of the area. The first order condition (3) identifies the level of local profitability, xs , and local rents, Rs , as
the relevant local variables. Proposition 6 tells us that more productive firms sort into locations with higher
local profitability, and we provided evidence for this claim in this section already. We are now interested in
understanding how changes in local profitability, that lead to a change in rents, affect the number of plants
of firms with different productivity levels.



                                                               31
                                           Table I: Local Saturation and Firm Growth
                                                        (1)           (2)            (3)           (4)            (5)
                                                        ln ¯
                                                           ljs        ln ¯
                                                                         ljs         ln ¯
                                                                                        ljs        ln ¯
                                                                                                      ljs         ln ¯
                                                                                                                     ljs

                   ln njs,2000                       -0.0792***     -0.0467***    -0.0402***    -0.0634***     -0.0661***
                                                      (0.0260)       (0.0169)      (0.0136)      (0.0115)       (0.0101)

                    ln njs                            0.0729***      0.0460**     0.0768***      0.0610***     0.0639***
                                                       (0.0262)      (0.0190)      (0.0157)       (0.0135)      (0.0126)

                   ln njs,2000 ×  ln njs             -0.0954***      -0.00369       -0.0194      -0.0192**     -0.0225***
                                                      (0.0308)       (0.0203)      (0.0132)      (0.00970)      (0.00787)

                   Observations                         20,230       30,583        41,246          49,888        56,170
                   R-squared                             0.628        0.621        0.604           0.589         0.571
                   SIC8-location FE                       Yes          Yes          Yes             Yes           Yes
                   SIC8-firm FE                           Yes          Yes          Yes             Yes           Yes
                   M                                       3            6            12              24            48
                                                       Standard errors in parentheses
                                                      *** p<0.01, ** p<0.05, * p<0.1
 Notes: The table presents the results of regressing the change from 2000 to 2014 in the log average plant employment of a firm in a
 location on the initial level of the log of the number of plants of the firm in 2000, the change from 2000 to 2014 in the log number of
 plants of the firm in the location, and the interaction of the initial level of the log of the number of plants of the firm in the location
 and the change from 2000 to 2014 in the log number of plants of the firm in the location. The regression also includes industry-location
 and industry-firm fixed effects. The table presents the results for five different resolutions M : 3 miles, 6 miles, 12 miles, 24 miles, and
 48 miles.




       To explore the implications of optimal firm behavior, differentiate the log of condition (3) to obtain22

                                    d ln njs       (njs )        Rs d ln Rs
                                             =-             1-                                     >0.
                                    d ln xs     njs  (njs )    Rs + j d ln xs

We know from Lemma 3 that more productive firms have higher span of control costs, j . Furthermore,
note that, if d ln Rs /d ln xs > 0, the term in brackets is increasing in j . Hence, conditional on the number
of plants, since  is increasing and concave, more productive firms set up and operate relatively more plants
as local profitability increases. The intuition is, as before, that rents make up a smaller portion of the cost
of setting new plants for the more productive firms (since their larger span of control also implies a larger
).
       We explore this implication empirically in Table II where we regress the growth in the number of
establishments of a firm in a location s, on the log of its number of establishments in s in 2000, ln njs,2000 ,
an interaction of the log of total firm size (our proxy for firm profitability) and the change in local log density
(our proxy for the change in local characteristics), ln Lj,2000 ×  ln Ls , as well as firm-industry and location-
industry fixed effects.23 The results confirm that, as implied by the theory, the interaction is positively
  22
     The location is small in the firm's problem and so changes in xs do not affect j .
  23
     We compute the growth rate of the number of plants njs as in (see, Davis et al., 1996), namely, we let Growth of njs =
(njs,2014 - njs,2000 )/(0.5njs,2014 + 0.5njs,2000 ). This growth measure is particularly useful when entry and exit of firms, and
therefore all their plants, across locations is substantial. This approach allows us to minimize the loss of information that would
follow from using more standard growth measures.



                                                                     32
related with growth in the number of plants. Namely, conditional on the number of plants, larger firms at
the national level add more plants when local conditions improve.

                                               Table II: Rents and Firm Growth
                                         (1)                 (2)                (3)             (4)              (5)
                                     Growth in njs       Growth in njs      Growth in njs   Growth in njs    Growth in njs

              ln njs,2000                0.00438            -0.00302           -0.00213        0.00150          0.00511*
                                        (0.00646)          (0.00457)          (0.00357)       (0.00303)         (0.00268)

              ln Lj,2000 ×  ln Ls        0.0100*           0.0126**           0.0171***       0.0237***         0.0427***
                                        (0.00540)          (0.00522)          (0.00549)       (0.00622)         (0.00717)

              Observations               272,506            360,721           418,772          443,227           442,352
              R-squared                   0.793              0.788             0.782            0.780             0.775
              SIC8-firm FE                 Yes                Yes               Yes              Yes               Yes
              SIC8-location FE             Yes                Yes               Yes              Yes               Yes
              M                             3                  6                12               24                 48
                                                    Robust standard errors in parentheses
                                                      *** p<0.01, ** p<0.05, * p<0.1
 Notes: The table presents the results of regressing the growth from 2000 to 2014 in the number of plants of a firm in a location
 on the log of the number of plants of the firm in a location in 2000, and on the interaction of the log of the firm's employment
 at the national level in 2000 and the change from 2000 to 2014 in the log of the location's population density. The regression also
 includes industry-location and industry-firm fixed effects. We compute the growth in the number of plants of a firm in a location
 as Growth of njs = (njs,2014 - njs,2000 )/(0.5njs,2014 + 0.5njs,2000 ) (see, Davis et al., 1996). The table presents the results for five
 different resolutions M : 3 miles, 6 miles, 12 miles, 24 miles, and 48 miles.




4.5    The Role of Transportation Efficiency
We are interested in understanding how the transportation infrastructure of a region affects the location
of plants, as well as their size. To that end, we parameterize transport costs using a measure of transport
efficiency, js . Specifically, we let the cost of delivering a product at distance  , when local transport
                                                      
efficiency is , be given by t( ; )  t                 
                                                       
                                                            , as in Section 3.4. Thus, as before, the corresponding local
efficiency of distribution function becomes (n; )   (n) and the first order condition in condition (3)
becomes

                                                 -1
                                                zj  xs js  (js njs ) = Rs + j .                                                       (10)

Hence, holding fixed zj , xs , Rs , and j , we obtain that

                                               d ln njs            (js njs )
                                                        = -1 -                   .                                                    (11)
                                               d ln js         js njs  (js njs )

There are two competing forces that influence how an improvement in transport efficiency alters firm j 's
choice of njs . First, given total sales, the firm moves towards larger plants to supply its customers using
larger catchment areas. This force is associated with a proportional reduction in the number of plants
reflected in the term -1. Second, since transport is now cheaper, the plant can reach consumers at lower

                                                                       33
cost which incetivizes it to raise its sales and employment. The firm, therefore, sets up a greater number of
production plants, captured by the second term which, given the concavity of , is positive. The resulting net
effect is generally ambiguous. However, the properties of  in Lemma 2 imply that this effect is decreasing
in njs , and therefore decreasing in total local employment (i.e. equation (8)), firm productivity, and total
                                                                         (n)                                   (n)
firm size. More precisely, we can show that limn0 -1 -                 n (n)   =  and limn -1 -              n (n)   = -1
                                                                                                                        3 . In
sum, better transport efficiency leads to a more pronounced reduction in the number of plants (or a less
pronounced increase) for firms with larger local footprints.
       Consider also the effect of transport efficiency on average plant size. Using equations (8) and (10), we
obtain that
                           d ln ¯
                                ljs      - (njs js )2                  (njs js )
                                    =                       - -1 -                                    .                          (12)
                           d ln js     (njs js )  (njs js )        js njs  (njs js )
                                                 d ln Ljs                        d ln njs
                                                 d ln js                         d ln js


The first term is the direct effect of sales to consumers holding fixed the mass of plants; employment increases
so as to raise production to satisfy each consumer's increased demand. This effect is always positive. In
addition, as discussed above, average employment may also change as the measure of plants adjusts following
better transport efficiency. The properties of  in Lemma 2 imply that the first term is large when njs is
                                                                                                         js             d ln n
small and small in the limit as njs becomes large. In contrast, the discussion above implies that - d ln js is
increasing in njs . Large firms with many plants expand total local employment by less than smaller firms
following an improvement in transport efficiency, but they are also less aggressive in setting up new plants.
The final effect of firm size on average plant size is, therefore, ambiguous.
       We now go to the data to determine whether, in fact, the effect of transportation efficiency on the
number of plants is decreasing in firms' local employment. Without directly identifying exogenous changes
in js , we can nevertheless assess the effect of transportation efficiency in the cross-section, controlling for
firm and location fixed effects. Specifically, we estimate

                              ln njs = 0 ln Ljs + 1 ln Ljs × ln js + F Es + F Ej + js ,                                          (13)

where F Es and F Ej again denote location-industry and firm-industry fixed effects. The prediction discussed
above implies that 1 < 0.24
       To estimate equation (13), we require a local, firm-specific, measure of js . We can also exploit variation
across industries, since firms operate in different industries. We propose seven distinct measures of trans-
portation efficiency, described in detail in Table IV in Section D of the Appendix. The first two, the Gini
coefficient of an industry's employment across space, and the Ellison and Glaeser (1997) index (which cor-
rects the Gini coefficient for granularity of individual plants), measure industry concentration across space.
  24
     The prediction of our theory applies holding xs , Rs , zj , and j constant. This regression controls for firm and location
fixed effects, but uses variation in transportation efficiency that, we would expect, affects these firm and local characteristics
in general equilibrium. Hence, our interpretation of the results relies on the changes in these firm or local variables being
sufficiently small.


                                                               34
More concentration is likely the result of smaller transport costs or higher transportation efficiency. Admit-
tedly, these measures are arguably endogenous to the number of plants. The third measure, (Agarwal et al.,
2017) consumer gravity, uses credit card purchases to estimate, for each industry, the elasticity of purchases
with respect to distance from home; we interpret a lower elasticity as indicating low transport costs. Our
fourth measure, uses measures of average freight costs computed by Bernard et al. (2006); while this measure
is closest to a primitive measure of trade costs, it is only available for manufacturing industries. Fifth, we
use measures of trade costs from Gervais and Jensen (2019) for service and manufacturing industries inferred
from local disparities in supply and demand for each industry. Sixth, we use a measure of traveling speed
computed by Couture et al. (2018) for 50 MSAs for 2008. Seventh, we use a measure of traveling time for
470 MSAs, computed by the Texas Transportation Institute. Each measure is standardized and built such
that js is increasing in each measure.

              Table III: The Effect Transportation Efficiency on Number of Plants in a Location


                               (1)          (2)         (3)             (4)        (5)         (6)          (7)          (8)
    VARIABLES                ln njs       ln njs      ln njs          ln njs     ln njs      ln njs       ln njs       ln njs

    ln Ljs                  0.223***    0.201***     0.224***     0.267***     0.122***     0.207***     0.218***    0.220***
                            (0.00162)   (0.00147)    (0.00161)    (0.00262)    (0.00655)    (0.00160)    (0.00205)   (0.00167)
    X Gini                              -0.127***
                                        (0.00199)
    X Ellison-Glaeser                               -0.0499***
                                                     (0.00317)
    X Consumer Gravity                                           -0.0644***
                                                                  (0.00168)
    X Freight Cost                                                             -0.0150**
                                                                               (0.00665)
    X Trade Cost                                                                           -0.0404***
                                                                                            (0.00131)
    X Speed Score                                                                                       0.00346**
                                                                                                        (0.00156)
    X Travel Time                                                                                                    -0.00262*
                                                                                                                     (0.00134)

    Observations            244,541      244,541     244,541       116,831       5,783      229,635      134,377      214,054
    R-squared                0.961        0.964       0.961         0.963        0.984       0.959        0.959        0.960
    SIC8-location FE          Yes          Yes         Yes           Yes          Yes         Yes          Yes          Yes
    SIC8-firm FE              Yes          Yes         Yes           Yes          Yes         Yes          Yes          Yes
    M                          24          24           24            24           24          24           24           24
                                               Robust standard errors in parentheses
                                                 *** p<0.01, ** p<0.05, * p<0.1
 Notes: The table presents the regression results of (13), including location and firm fixed effects. The transportation efficiency
 measures that we use are described in Table IV. All transportation efficiency measures are standardized. For this table, we use
 resolution M = 24.



   Table III presents the results of running the cross-sectional regression presented in (13) for alternative
transportation efficiency measures and M = 24. While the measures capture different aspects of transporta-
tion efficiency (shipping costs, distribution costs, and consumer travel costs), the regression results are all
consistent. As implied by the theory, better transportation efficiency has a larger negative impact on the


                                                                 35
number of plants of firms with more local employment.25


5         Conclusions
In this paper, we propose a novel methodology to analyze the problem of how to serve customers distributed
across heterogeneous locations when firms face transport costs, fixed costs of setting up new plants, and
span of control costs of managing multiple plants. Although the basic trade-off between transport costs and
cannibalization is clear, characterizing the solution to this core problem in economics has proven elusive
given its complexity. In order to make progress, we propose a limit problem in which firms choose a
density of plants in space. A large combinatorial problem is therefore reduced to a much simple calculus of
variations problem. The solution to this problem can be easily characterized and the problem can be readily
incorporated in a general equilibrium spatial setup with labor mobility, as we have demonstrated.
         The solution to the firm problem has a number of unique predictions. First, and most important, is
that firms sort in space. Specifically, more productive firms operate relatively more plants in locations with
better characteristics or simply higher rents. Less productive firms, in turn, operate relatively more plants in
worse, low rent, locations. Furthermore, conditional on the number of plants, more productive firms operate
larger plants. These and other predictions of the theory are empirically verified using NETS establishment
level data for 2000 to 2014 in the U.S.
         The methodology proposed in this paper can readily be used to understand the role of changes in
transport infrastructure on plant locations. We illustrate numerically how firms in a `small' industry ­ one
that does not affect local rents or wages ­ adjust by opening fewer plants but in more locations. In the
data, we find that local transport infrastructure improvements indeed lead to a lower number of plants,
particularly for the most productive firms. We carry out a similar quantitative exercise to illustrate the
effects of improvements in the span of control technology, where we see large firms expanding into low-rent
markets. Studying general equilibrium counterfactuals for `large' industries that affect local factor prices,
or for the whole economy, is left for future research. A quantitative general equilibrium analysis of such
changes could be used to study the implications of secular technological changes for the spatial distribution
of economic activity, as well as local competition and concentration. These are exciting avenues that our
methodology now makes feasible.




    25
    The results are very stable across resolutions, as shown in Figure D.1 in Section D of the Appendix, where we present a
plot of the coefficients on the interaction term, 1 .


                                                            36
References
Agarwal, S., Jensen, J. B., and Monte, F. (2017). The Geography of Consumption. NBER Working Papers
  23616, National Bureau of Economic Research, Inc.

Aghion, P., Bergeaud, A., Boppart, T., Klenow, P. J., and Li, H. (2019). A Theory of Falling Growth and
  Rising Rents. Working Paper Series 2019-11, Federal Reserve Bank of San Francisco.

Arkolakis, C. and Eckert, F. (2017). Combinatorial discrete choice. Technical report.

Barnatchez, K., Crane, L., and Decker, R. (2017). An Assessment of the National Establishment Time
  Series (NETS) Database. Finance and economics discussion series, Board of Governors of the Federal
  Reserve System (US).

Behrens, K., Duranton, G., and Robert-Nicoud, F. (2014). Productive cities: Sorting, selection, and ag-
  glomeration. Journal of Political Economy, 122(3):507­553.

Bernard, A. B., Jensen, J. B., and Schott, P. K. (2006). Trade costs, firms and productivity. Journal of
  Monetary Economics, 53(5):917­937.

Bilal, A. and Rossi-Hansberg, E. (2019). Location as an asset. Technical report.

Bollobas, B. (1973). The optimal arrangement of producers. Journal of the London Mathematical Society.

Cao, D., Sager, E., Hyatt, H., and Mukoyama, T. (2019). Firm Growth through New Establishments. 2019
  Meeting Papers 1484, Society for Economic Dynamics.

Christaller, W. (1933). Die zentralen Orte in Suddeutschland.

Couture, V., Duranton, G., and Turner, M. A. (2018). Speed. The Review of Economics and Statistics,
  100(4):725­739.

Crane, L. and Decker, R. (2019).       Business Dynamics in the National Establishment Time Series
  (NETS)/Leland Crane, Ryan Decker. Finance and economics discussion series, Board of Governors of the
  Federal Reserve System (US).

Davis, D. R. and Dingel, J. I. (2019). A spatial knowledge economy. American Economic Review, 109(1):153­
  70.

Davis, S. J., Haltiwanger, J., and Schuh, S. (1996). Small Business and Job Creation: Dissecting the Myth
  and Reassessing the Facts. Small Business Economics, 8(4):297­315.

Diamond, R. (2016). The determinants and welfare implications of us workers' diverging location choices
  by skill: 1980-2000. American Economic Review, 106(3):479­524.


                                                    37
Eaton, J. and Kortum, S. (2002). Technology, geography, and trade. Econometrica, 70(5):1741­1779.

Eeckhout, J., Pinheiro, R., and Schmidheiny, K. (2014). Spatial sorting. Journal of Political Economy,
  122(3):554­620.

Ellison, G. and Glaeser, E. L. (1997). Geographic Concentration in U.S. Manufacturing Industries: A
  Dartboard Approach. Journal of Political Economy, 105(5):889­927.

Fejes Toth, L. (1953). Lagerungen in der Ebene, auf der Kugel und im Raum. Springer-Verlag.

Fernandes, A. M., Klenow, P. J., Meleshchuk, S., Pierola, D., and Rodrguez-Clare, A. (2018). The Intensive
  Margin in Trade. NBER Working Papers 25195, National Bureau of Economic Research, Inc.

Gaubert, C. (2018). Firm sorting and agglomeration. American Economic Review, 108(11):3117­53.

Gervais, A. and Jensen, J. B. (2019). The tradability of services: Geographic concentration and trade costs.
  Journal of International Economics, 118(C):331­350.

Holmes, T. J. (2011). The diffusion of wal-mart and economies of density. Econometrica, 79(1):253­302.

Holmes, T. J. and Lee, S. (2010). Cities as Six-by-Six-Mile Squares: Zipf's Law?           In Agglomeration
  Economics, NBER Chapters. National Bureau of Economic Research, Inc.

Hopenhayn, H. A. (1992). Entry, Exit, and Firm Dynamics in Long Run Equilibrium. Econometrica,
  60(5):1127­1150.

Hsieh, C.-T. and Rossi-Hansberg, E. (2019). The industrial revolution in services. Working Paper 25968,
  National Bureau of Economic Research.

Hu, K. and Shi, R. (2019). Solving combinatorial discrete choice problems in heterogeneous agents models.
  Technical report.

Jia, P. (2008). What happens when wal-mart comes to town: An empirical analysis of the discount retailing
  industry. Econometrica, 76(6):1263­1316.

Jovanovic, B. (1982). Selection and the Evolution of Industry. Econometrica, 50(3):649­670.

Lind, N. and Ramondo, N. (2018). Trade with Correlation. NBER Working Papers 24380, National Bureau
  of Economic Research, Inc.

Melitz, M. J. (2003). The impact of trade on intra-industry reallocations and aggregate industry productivity.
  Econometrica, 71(6):1695­1725.

Ramondo, N. (2014). A quantitative approach to multinational production. Journal of International Eco-
  nomics, 93(1):108 ­ 122.

                                                     38
Ramondo, N. and Rodr´
                    iguez-Clare, A. (2013). Trade, multinational production, and the gains from openness.
  Journal of Political Economy, 121(2):273­322.

Redding, S. J. and Rossi-Hansberg, E. (2017). Quantitative spatial economics. Annual Review of Economics,
  9(1):21­58.

Rossi-Hansberg, E., Sarte, P.-D., and Trachter, N. (2018). Diverging Trends in National and Local Concen-
  tration. NBER Working Papers 25066, National Bureau of Economic Research, Inc.

Rossi-Hansberg, E. and Wright, M. L. J. (2007). Establishment size dynamics in the aggregate economy.
  American Economic Review, 97(5):1639­1666.

Tintelnot, F. (2016). Global production with export platforms. The Quarterly Journal of Economics,
  132(1):157­209.

Ziv, O. (2019). The micro-geography of productivity, density, and sorting. Technical report.




                                                    39
Appendix

A        Proofs
A.1       Properties of the Efficiency of Distribution
                                                               ~( )  t( )1- . A hexagon with area x has
In this appendix, we provide a proof of Lemma 2. First, define t
                    
sides of length l =  x, where   21/2 3-3/4 . The integral of the function t
                                                                          ~( s ) over a hexagon with area
x can be expressed as
                                                             x1/2
                                                                                           ~( )2d
                                          g (x) =                                          t
                                                         0                          x1/2
where(r) is the fraction of circle with radius r that intersects with a hexagon with side length 1. That is,
    
if   3/2 is the radius of the largest circle that can be inscribed in a hexagon with side length 1, then
  (r) = 1 for r  [0, ],    (r) < 0 for r  (, 1), and (1) = 0.26 We first rewrite g in a form that is easier
                             ~( )  t( )1- . We then can change variables
to manipulate. First, define t
                                                                 
                                                                  x
                                                                                           ~( )2d
                                        g (x) =                                            t
                                                             0                       x
                                                                        1                
                                                 = 2x                                  ~  xu 2udu
                                                                                    (u)t
                                                                    0

This implies that

                                                                          n-1/2
                                                     1                                              ~( )2d
                               (n) = ng                      =n                                     t                                         (14)
                                                     n                0                    n-1/2
                                                                                1
                                                     1                                  ~ n-1/2 u 2udu
                               (n) = ng                      = 2                     (u)t                                                     (15)
                                                     n                      0

       It will be useful to have expressions for the first and second derivative Differentiating with respect to n
yields
                                                 1
                                                            ~ n-1/2 u                       1
                                (n) =  2                 (u)t                              - n-3/2 u 2udu                                     (16)
                                             0                                              2
                                                                                                                                 
  26
       What is   ? To get at this, for a hexagon with side length 1, a circle with radius  =                     1 - (1/2)2 =    2
                                                                                                                                  3
                                                                                                                                      will be full
                                                                 
                                                                  3
inscribed. Consider a circle with radius between                 2
                                                                    ,1          . What fraction of the circle is inside the hexagon? Consider
                                                                                                                                      
                                                                                                                                       3
two line segments, each emanating from the center of the hexagon to the border of the hexagon. One of length                          2
                                                                                                                                           which is
                                                                                                                           
                                                                                                                           3/2
perpendicular to the side of the hexagon, and one of length  . The angle  between the two satisfies cos() =                    .   The fraction
                                                                                                                                       
                                                                                                   1                            0    3/2
of the circle of length  that is outside the hexagon is therefore 12 
                                                                      . Therefore ( ) =      6     -1   3/2
                                                                                                                                               .
                                                                  2                     1 -  cos                                  3/2    1
                                                                                                        




                                                                            40
   To find the second derivative, we change variables once more to get

                                                  n-1/2
                                                                                          ~ ( )  2 d
                                    (n) =                                                -t
                                              0                    n-1/2

Differentiating once more, using      (1) = 0, and changing variables yields

                                             n-1/2
                                                                                 1 -1  ~ ( )  2 d
                           (n) =                                                  n 2 -t
                                         0                        n-1/2         2
                                                              1
                                                     
                                    =  3 n-5/2                             ~ n-1/2 u
                                                                    (u)u3 -t                                    du
                                                     2    0

   Using the fact that        (r) = 0 for r  (0, ) gives

                                                              1
                                                     
                                 (n) =  3 n-5/2                            ~ n-1/2 u
                                                                    (u)u3 -t                                    du                               (17)
                                                     2       

                          1
Claim A.1 (n)  ng         n    is strictly increasing and strictly concave, and satisfies the following properties:

  1. (0) = 0;

  2. limn (n) = 1;
                                                                                                                                          
                                                         1                                                                            2
                                                                                                                               ~ (0) 3/      1       ln 3
  3. 1-(n) follows a power law with exponent             2   as n  , i.e., limn                                n [1 -  (n)] = -t    3 4      3   +    4     >
     0.

                                                                                 ~ < 0. (17) implies that
Proof. (16) implies that  is strictly positive because t > 0 and  > 1 imply that t
 is strictly negative because   is strictly negative on (, 1). (0) = 0 follows from (15) and the fact that
limy t(y ) =  which implies that limy t       ~(y ) = 0. limn (n) = 1 follows from (15) and the facts
     ~(0) = 1, and  2  1
that t                0   (u)2udu = 1.
                                                                          1        u
    Beginning with (15), we can express n[1 - (n)] as n 1 -  2 2 0 (u)t          ~     udu . Taking the
                                                                                    n
                           
limit as n  , using x = n, and using L'Hopital's rule gives

                                                                                                 1
                                                                                                             u
                    lim       n (1 - (n)) =          lim          n 1 -  2 2                               ~ 
                                                                                                        (u)t         udu
                   n                                n                                        0                n
                                                                                 1         ~(ux) udu
                                                             1 -  2 2           0      (u)t
                                              =     lim
                                                    x0                                 x
                                                                            1            ~ (ux) u2 du
                                                             - 2 2         0         (u)t
                                              =     lim
                                                    x0                                 1
                                                                                     1
                                              =       ~ (0)  2 2
                                                     -t                                   (u)u2 du
                                                                                0

                                                     1
The result follows from the fact that  2 2          0     (u)u2 du =                     1
                                                                                         3   +       ln 3
                                                                                                      4     = 21/2 3-3/4   1
                                                                                                                           3   +   ln 3
                                                                                                                                    4


                                                                   41
   Before proceeding, it will be useful to derive an alternative expression for  (n). Differentiating (14)
with respect to n yields

                                                         n-1/2
                                                                                             ~( )2d
                                (n) =                                                        t
                                                     0                 n-1/2
                                                           ~ n-1/2 2n-1/2 -                                  1
                                                     +n (1)t                                                      n-3/2
                                                                                                             2
                                                               n-1/2
                                                                                                 1 -1/2 ~
                                                     +n                                           n     t( )2d
                                                           0                      n-1/2         2

Noting that     (1) = 0 and changing variables gives

                                           n-1/2
                                                                                      1                                        ~( )2d
                    (n) =                                                      +                                               t
                                      0                        n-1/2                  2        n-1/2             n-1/2
                                                 1
                                      2                          1          ~ n-1/2 u 2udu
                               =                         (u) +         (u)u t
                                       n     0                   2

We can separate this into two terms, the integral over u  [0, ] and the integral from [, 1]. For u  [0, ),
  (u) = 1 and     (u) = 0, so we can express the integral as

                                                                                      1
                          2           ~ n-1/2 u 2udu + 
                                                        2                                            1            ~ n-1/2 u 2udu
               (n) =                  t                                                      (u) +           (u)u t                                   (18)
                          n    0                       n                                             2

                 ~( ) 2 = 0 then  (0) =                                 ~
Claim A.2 If lim t                                                     0 t( )2d


Proof. Taking the limit of the first term of (18) gives

                                                                                          n-1/2                                
                     2                ~ n-1/2 u 2udu = lim                                        ~( )2d =                        ~( )2d
                 lim                  t                                                           t                               t
                n n            0                                           n 0                                             0

The second term of (18) can be expressed as

         1                                                                        1
   2                  1            ~ n-1/2 u 2udu =                                          (u) 1           ~ n-1/2 u
                                                                                                                                               2
              (u) +           (u)u t                                                            +        (u) t                       n-1/2 u       2du
   n                  2                                                                      u    2

We next show that the limit of this second term is zero. If limx t~(x)x2 = 0, then t
                                                                                   ~(x)x2 has a peak. call
                          (u)                                   2                      (u)
it r
   ¯. Then the function         1        ~ n-1/2 u n-1/2 u 2 is dominated by                 1
                          u + 2      (u) t                                             u + 2     (u) r
                                                                                                     ¯2 .
                                                          1      (u)       1                         1   1        1                  1
Since the latter is integrable on [, 1] (                        u     +   2      (u) du                 u   +    2      (u) du = ln   -1
                                                                                                                                        2 ) Dominated
                                                                                                                                               2
                                                                          ~ n-1/2 u
convergence means we can bring the limit inside the integral. Since limn0 t                                                          n-1/2 u       = 0, the
limit of the second terms is zero.

                 ~( ) 4 = 0, then  (0) = 0
Claim A.3 If lim t

                                                                               42
Proof. The second derivative of  at zero is defined as  (0) = limn0  (n)- n
                                                                             (0)
                                                                                 . lim t  ~( ) 4 = 0
implies lim t~( ) 2 = 0, so Claim A.2 gives  (0) =  t ~( )2d . Using this along (18) gives
                                                   0

                     2    1              1        ~ n-1/2 u 2udu -            ~
                     n   0       (u) +   2   (u)u t                          0 t ( ) 2d
  (0) =        lim
               n0                                    n
                     2   1                        ~ n-1/2 u 2udu             2    ~                        ~
                     n           (u) +   1
                                         2   (u)u t                          n   0 t   n-1/2 u 2udu -     0 t ( ) 2d
           =   lim                                               +
               n0                              n                                                n

We next show that each of the two terms is equal to zero. We first rearrange the first term and take the limit
                                                                                         1          2u
inside the integral using dominated convergence (the function -                  (u) +   2   (u)u is integrable on the
                                                                                                     u4
                                         1                1                                                 ~(y )y 4 = 0
domain u  [, 1], in particular     - (u) +
                                                          2     (u)u   2udu = 4, and the fact that limy t
             ~(y )y has a uniform upper bound)
implies that t     4


                                    2   1             1            ~ n-1/2 u 2udu
                                    n    -    (u) +   2       (u)u t
                              lim
                              n0                               n
                                        1
                                   1                     1            ~ n-1/2 u n-1/2 u
                                                                                          4 1
                     =        lim         -      ( u ) +     ( u ) u  t                        2udu
                              n0  2                      2                                  u4
                                    1
                               1                    1                   ~ n-1/2 u n-1/2 u
                                                                                           4 2u
                     =          2
                                      -     (u) +        (u)u lim t                                du
                                                    2             n0                            u4
                                    1
                               1                    1                    ~(y )y 4 2u du
                     =          2
                                      -     (u) +        (u)u      lim t
                                                    2             y                u4
                              4        ~(y ) y 4
                     =            lim t
                               2 y
                     =        0

For the second term, we can change variables and use L'Hopital's rule.

           2    ~                              ~                              n-1/2                  ~
           n   0 t   n-1/2 u 2udu -           0 t ( ) 2d                     0
                                                                                       ~( ) 2d -
                                                                                       t            0 t ( ) 2d
     lim                                                          =    lim
     n0                       n                                        n0                    n
                                                                  =     ~ n-1/2 2n-1/2 - 1 n-3/2
                                                                    lim t
                                                                    n0                     2
                                                                                 ~ n-1/2 n-1/2
                                                                                               4
                                                                  = -       lim t
                                                                          2 n
                                                                      ( ) 0
                                                                                  ~(y )y 4
                                                                  = -     2 ylim  t
                                                                      ( )    

                                                                  = 0

Together, these imply that  (0) = 0.




                                                                 43
A.2       Proof of Main Proposition
Define G(x) to be the integral of T ( s )1- over a regular hexagon with area x centered at the origin. This
                                                                                                                           x
will be an important function in characterizing optimal policy. Notice that G(x) = 2 g                                     2
                                                                                                                                .27 We begin
by restating a well-known result from discrete geometry.

Theorem A.4 (Theorem of L. Fejes Toth on sums of moments): Let f : [0, )  R be a nondecreasing
function and let H be a convex 3,4,5, or 6-gon in E2 . Then for any set of n points P in E2 ,

                                             min {f ( x - p ) : p  P } dx  n                 f ( x ) dx
                                         H                                             Hn


where Hn is a regular hexagon in E2 with area |H |/n and center at the origin.

      We next apply this theorem to our context.

Lemma A.5 For any h and any finite set of points Oi  Sik ,

                                                                                             k2
                                                      max T (so )1- ds  |Oi | G
                                                   k oOi
                                                 sSi                                        |Oi |

Proof. Since T ( ) is strictly increasing in  , T ( )1- is strictly decreasing. The theorem of L. Fejes Toth
on sums of moments therefore implies that

                                                                                                          k2                       k2
              max T (so )1- ds = -                    min -T (so )1- ds  - |Oi | -G                                 = |Oi | G
           k oOi
         sSi                                       k oOi
                                                 sSi                                                     |Oi |                    |Oi |



Lemma A.6 For any k > 0, N  N0

                                                                                                        k2
                                             sup           max T (so )1- ds  N G (n)
                                     k ||O |=N
                                 Oi Si    i            sSi oOi                                          N

                               -2
                        33/4
where (n) = 1 +         
                         2N
                                     .

Proof. As in the proof of the lemma above, define   21/2 3-3/4 . The set Sik is a square with side length
k . It is sufficient to show that for any non-negative integer N , one can fit N regular hexagons with area
 27
      The definition of t along with the change of variables ~=     
                                                                         imply
                                                                    
                                                                                     1  x
                                         x                    1-                                    ~              1-
                                                                                                               ~          ~ ~
                    G(x)   =                           t           2d = 2                       1            t          2 d
                                 0                x                              0              
                                                                                                  x
                                             x
                           =   2 g
                                             2



                                                                    44
            -2
       1         k2
 1+    
       N         N    inside the square Sik as this would constitute a particular Oi choice. Using our hexagon
                                                                                                                     1
area expression from Lemma 2, each of these hexagons would have a side length l =                             
                                                                                                               N 1+ -1 N -1/2
                                                                                                                              k.        Since
regular hexagons can form a regular tiling of the plane, we can consider hexagons each with side length l
                                                     1
                                                         
and tiling with c =  3 N columns and r =               3
                                                          N rows, where x denotes the smallest integer
                                                               3
weakly larger than x. Our proposed lattice has total width of 2  c+ 1
                                                                    2 l and total height weakly less than
                   2
                              
(2r + 1) l2 - (l/2) =    3r + 23 l (with equality if there is more than one column). We first show that
                                                3        1
that total width is smaller than k , i.e.,      2c   +   2   l  k . To see this, we have

                               3    1            3        1            1
                                 c+     l =         3 N +             -1 N -1/2
                                                                                k
                               2    2            2        2    N 1 + 
                                                 3           1              1
                                                    3 N +1 +                       k
                                                 2           2     N 1 +  1 N -1/2
                                                                          -
                                                         2
                                                    1+  
                                                          N
                                           =                    k
                                            1+        -1 N -1/2
                                            k

where the last step follows because 4  33/2 implies 2 =                        2
                                                                           2-1/2 33/4 
                                                                                       33/4 2-1/2 = 1
                                                                                                      .
                                                                                       3
   We next show that the total height is less than k , i.e.,                   3r + 2 l  k . To see             this, we have

                                                           
                                   3                  1     3              1
                             3r +       l =         3  N +                         k
                                  2                    3   2       N 1 +  1 N -1/2
                                                                          -
                                                                 
                                                         1        3            1
                                                    3     N +1 +                       k
                                                          3      2     N 1 +  1 N -1/2
                                                                              -

                                                         1
                                                 1+     N
                                                         
                                          =                     k      =k
                                               1+     -1 N -1/2
                                                                                                 
Finally, we note that such a lattice contains cr = 21/2 3-1/4 N                        2-1/2 31/4 N  N regular hexagons. It
                                                                            -2
                                                                       1         k2
follows that N regular hexagons each with area 1 +                   N
                                                                       
                                                                                 N    fit inside the square Sik .

Claim A.7 For any k , ,  k    where
                        ¯j  j

                                                                                                                        k
                                                     -1                          k2                    -1       1
       k
      ¯j
          sup                 -Ni Rk
                                   i  + Z (qj , |O |)
                                                                 ¯ k¯
                                                                 D    k
                                                                   i bi Ni G            + Z (qj , 0)        ¯¯
                                                                                                            D b             T ( )1- d
             {Ni 0}                                                              Ni                             k   0
                         i                                   i




                                                                  45
                                     k be the subset that are in square i. We begin with:
Proof. For any set of plants O, let Oi

     Ds max bo T (so )1- ds =                                     Ds max bo T (so )1- ds
 s      oO                                                  k
                                                          sSi             oO
                                                iI k

                                                                  Ds              max bo T (so )1- ds
                                                            k                       k
                                                                                  oOi
                                                          sSi
                                                iI k                      i I k

                                                                  ¯ik             ¯             1-
                                                                  D               bk
                                                                                   i max T (so )   ds
                                                            k                            k
                                                                                       oOi
                                                          sSi
                                                iI k                      i I k

                                            =            ¯ k¯
                                                         D    k
                                                           i bi             max T (so )1- ds +                           ¯ k¯
                                                                                                                         D    k
                                                                                                                           i bi              max T (so )1- ds
                                                                        k oO k
                                                                      sSi                                                               k oO k
                                                                                                                                      sSi
                                                iI k                        i                             iI k i =i                         i



We can bound the first term using the previous lemma. To bound the second term, note that

                                                  max T (so )1- ds                           max T (so )1- ds.
                                              k oO k
                                            sSi                                          k oS k
                                                                                       sSi
                                                  i                                          i



The term       k
             sSi          maxoOk T (so )1- ds is maximized if Sik , Sik are contiguous, in which case,
                                  i


                                                                                                  k
                                                         max T (so )1- ds = k                         T ( )1- d
                                                  k        k
                                                         oSi
                                                sSi                                           0

                                                                                                                                                       k
In addition,          i
                                 ¯ k¯k
                            i =i Di bi      1 ¯¯
                                            k2
                                               Db,   so that          i
                                                                                 ¯ k¯k
                                                                            i =i Di bi         k
                                                                                             sSi      maxoOk T (so )1- ds  D
                                                                                                                           ¯¯ 1
                                                                                                                             bk                       0    T ( )1- d
                                                                                                                  i
Together, these imply

                                                                                                                                      k
                                                                                                         k2                1
                      Ds max bo T (so )1- ds                           ¯ k¯
                                                                       D    k
                                                                         i bi
                                                                                          k
                                                                                         Oi G             k
                                                                                                                       ¯¯
                                                                                                                      +D b                T ( )1- d
                  s         oO                                                       k
                                                                                   sSi                   Oi                k      0
                                                                  i

     Similarly,
                                         -Ro  =                   -Ro                        -Rk
                                                                                               i =
                                                                                                                         k
                                                                                                                      - Oi Rk
                                                                                                                            i
                                 oO                  i     k
                                                         oOi                       i     k
                                                                                       oOi                    i




                                                                                  46
Together, these imply that

    
    j = sup                    -Ro  + Z (qj , |O|)-1                Ds max bo T (so )1- ds
               O oO                                             s        oO

                                                                                                                                   k
                                                       -1                                                 k2          1
           sup                    k
                               - Oi Rk
                                     i  + Z (qj , |O |)
                                                                                      ¯ k¯
                                                                                      D    k  k
                                                                                        i bi Oi G          k
                                                                                                                  ¯¯
                                                                                                                 +D b                  T ( )1- d
               O                                                                                          Oi          k        0
                       i                                                         i
                                                                                                                                                 k
                                                               -1                                   k2                    -1       1
                 sup                    -Ni Rk
                                             i  + Z (qj , |O |)
                                                                                     ¯ k¯
                                                                                     D    k
                                                                                       i bi Ni G           + Z (qj , 0)        ¯¯
                                                                                                                               D b                   T ( )1- d
              {Ni N0 }                                                                              Ni                             k         0
                                   i                                         i
                                                                                                                                             k
                                                              -1                                   k2                    -1       1
                 sup                   -Ni Rk
                                            i  + Z (qj , |O |)
                                                                                 ¯i
                                                                                 D k ¯k
                                                                                     bi Ni G              + Z (qj , 0)        ¯¯
                                                                                                                              D b                T ( )1- d
              {Ni 0}                                                                               Ni                             k      0
                               i                                         i
             k
          = ¯j

where we use that Z is decreasing in N and slightly abuse notation so that Ni for a particular firm is choice
of number of plants in Sik .

Claim A.8 In the limit as   0,

                                                                                                          -1
                           lim ¯ k  ¯ k  sup                    -ns Rk                                         ¯ k¯ k
                                                                     s + z qj ,                    ns
                                                                                                    ~ds
                                                                                                      ~        D s bs  (ns ) ds
                       0                             n0




                                             2 N i
Proof. Replace and use ni =                  k2

                                                                                                                                   k
                                                    -1 ¯ k ¯k                             k2                          1
 k
¯j =       sup                 -Ni Rk
                                    i  + Z (qj , N )  Di bi Ni G                                   + Z (qj , 0)-1 D
                                                                                                                  ¯¯b                  T ( )1- d
          {Ni 0}                                                                          Ni                          k        0
                   i

                                                                    -1   ¯ik ¯k             1 k2               -1 ¯ ¯ 1
                                                                                                                          k
                                                                                                                               1-
      =    sup                 -Ni Rk
                                    i
                                      2
                                               + z qj ,  N  2
                                                                         D   bi Ni 2 g             + Z (qj , 0)    Db       t      d
          {Ni 0}                                                                            2 Ni                      k 0     
                   i
                                                                                               
                                                                             -1
                                                                                            1                       1 k       1-
      =    sup k 2                 -n Rk + z         qj , k 2       n~          ¯i
                                                                                D k ¯k
                                                                                    bi ni g      + Z (qj , 0)-1 D
                                                                                                                ¯¯b     t        d
          {ni 0}                    i i                              i
                                                                                            ni                      k 0     
                           i                                    ~
                                                                i




                                                                                     47
Taking the limit gives
                                                                                                                     
                                                                                                -1
                  k
                                                    
                                                                                                     ¯ k¯          1 
             lim ¯j =        lim sup k 2            -ni Rk
                                                         i +z              qj , k 2       n~
                                                                                           i         D    k
                                                                                                       i bi ni g       +
            0                0 {ni 0}                                                                              ni 
                                               i                                      ~
                                                                                      i
                                                            k           1-
                                                 1        
                         +  lim z (qj , 0)-1 D
                                             ¯¯b       t                       d
                           0                     k 0     
                                                                                                                  
                                                                                          -1
                                          
                                                                                               ¯ik ¯k          1 
                         = sup k 2         -ni Rk  i + z qj , k
                                                                2
                                                                                  n~
                                                                                   i           D   bi ni g
                           {ni 0}                                                                              ni 
                                        i                                     ~
                                                                              i
                                                                                                               
                                                                                          -1                   
                                                                                               ¯ik ¯k
                         = sup k 2         -ni Rk  i + z qj , k
                                                                2
                                                                                  n~
                                                                                   i           D   bi  (ni )
                           {ni 0}         
                                          i                                   ~
                                                                              i
                                                                                                               


where we used the assumption that t( ) diverges as   . Let N k be the set of strategies in which ns is
constant for all s  Sik . Then we can write

                                                                                           -1
                     lim  k
                         ¯j =         sup           -ns Rk                                      ¯ k¯ k
                                                         s + z qj ,               ns
                                                                                   ~ds
                                                                                     ~          D s bs  (ns ) ds
                     0               nN k
                                                                                          -1
                                                                                               ¯sk ¯k
                                  sup              -ns Rk
                                                        s   + z qj ,          ns
                                                                               ~ds
                                                                                 ~             D   bs  (ns ) ds
                                     n0

                                 = ¯k



   We next show that for each j , it is without loss of generality to impose a uniform upper bound on the
density of plants.

                                                 ¯¯
                 ¯ j to satisfy R = z (qj , 0)-1 D
Lemma A.9 Define n                                 b (¯
                                                      nj ).

                                                                                      -1
                          k
                         ¯j = sup             -ns Rk
                                                   s + z qj ,              ns
                                                                            ~ds
                                                                              ~            ¯ k¯
                                                                                           D    k
                                                                                             s bs  (ns ) ds
                               n[0,n
                                   ¯j ]                                s
                                                                       ~


Proof. We show that it is without loss to restrict the strategies to the set n  [0, n
                                                                                    ¯ j ]. Restricting the set
of strategies yields a weakly lower payoff. To show the opposite inequality, for any strategy, let N + be the
subset of S for which ns > n
                           ¯ j . We will show that the alternative strategy in which

                                                                ns s  N +
                                                   n
                                                   ~=
                                                                n
                                                                ¯j    s  N+

                                                                                        ¯ and bs  ¯
would give a weakly higher payoff, Consider any profile R, D, b such that Rs  R and Ds  D         b.



                                                                 48
For shorthand, we express zj = z qj ,             s ns ds   and z
                                                                ~j = z qj ,         sn
                                                                                     ~ s ds    .

                                                -1
      j (n) - j (~
                 n) =                 -ns Rs + zj  Ds bs h (ns ) ds -  (~
                                                                        n)

                                                 -1
                                      -ns Rs + z
                                               ~j   Ds bs  (ns ) ds -  (~
                                                                        n)

                                                         -1                                                     -1
                             =                -ns Rs + z
                                                       ~j   Ds bs  (ns ) ds -                       -n
                                                                                                     ~ s Rs + z
                                                                                                              ~j   Ds bs  (~
                                                                                                                           ns ) ds
                                    sN +                                                     sN +
                                                         -1                                                     -1
                             =                -ns Rs + z
                                                       ~j   Ds bs  (ns ) ds -                       -n
                                                                                                     ¯ s Rs + z
                                                                                                              ~j   Ds bs s (¯
                                                                                                                            n) ds
                                    sN +                                                     sN +
                                                                   -1
                             =                - (ns - n
                                                      ¯ j ) Rs + z
                                                                 ~j   Ds bs [ (ns ) -  (¯
                                                                                        n)] ds
                                    sN +

The concavity of  implies  (ns )   (¯        nj ) (ns - n
                                    nj ) +  (¯          ¯ j ), so that  (ns ) -  (¯
                                                                                  nj )   (¯
                                                                                          nj ) (ns - n
                                                                                                     ¯j ) =
       Ra
z (qj ,0)-1 D
            ¯¯b
                  (ns - n
                        ¯ j ). Plugging this in gives


                                                                          -1                          R
                  j (n) - j (~
                             n)                      - (ns - n
                                                             ¯ j ) Rs + z
                                                                        ~j   Ds bs                            (ns - n
                                                                                                                    ¯ j ) ds
                                           sN +                                              z (qj , 0)-1 D
                                                                                                          ¯¯b
                                                                 -1
                                                               z
                                                               ~j   Ds bs        R
                                     =               -1 +            -1                  Rs (ns - n
                                                                                                  ¯ j ) ds
                                           sN +             z (qj , 0)       ¯ ¯
                                                                             Db sR
                                      0




Claim A.10
                                                                                        -1
                                  j  sup           -ns Rs + z qj ,           ns
                                                                              ~ds
                                                                                ~            Ds bs  (ns ) ds
                                         n0                              s
                                                                         ~




Proof. For any strategy n, define ¯ k (n) and  (n) as

                                                                                        -1
                                 ¯ k (n) =                                                   ¯sk ¯k
                                                    -ns Rk
                                                         s + z q,             ~ds
                                                                             ns ~            D   bs  (ns ) ds
                                                                         s
                                                                         ~
                                                                                        -1
                                 (n) =              -ns Rs + z qj ,              ns
                                                                                  ~ds
                                                                                    ~         Ds bs  (ns ) ds
                                                                             s
                                                                             ~


Since R, D, and b are continuous on a compact space, they are uniformly continuous. This implies that for
any  > 0, there is an  small enough so that h <  implies both Rk - Rs  , and D        ¯ k¯
                                                                                         bk - Ds bs  .
                                                                                               s                      s s




                                                                   49
With that, for any n  [0, n
                          ¯ j ],

                                                                                        -1
          ¯ k (n) - (n)                   -ns Rk                                              ¯ k¯ k
                            =                  s - Rs + z qj ,                   ns
                                                                                  ~ds
                                                                                    ~         D s bs - Ds bs  (ns ) ds
                                                                             s
                                                                             ~
                                                                                   -1
                                                                                        ¯sk ¯k
                                         ns R k
                                              s - Rs + z qj ,              ns
                                                                            ~ds
                                                                              ~         D   bs - Ds bs  (ns ) ds
                                                                       s
                                                                       ~
                                                                      -1
                                         n s  + z qj ,       ns
                                                              ~ds
                                                                ~            (ns ) ds
                                                         s
                                                         ~

                                         ¯ j  + z (qj , 0)-1  ds
                                         n

                                          ¯ j + z (qj , 0)-1 ds
                                          n


Therefore ¯ k (·) is uniformly convergent on the domain n  [0, n
                                                               ¯ j ] as k  0.. Therefore

                                          lim sup ¯ k (n) = sup lim ¯ k (n)
                                          k0 n[0,n
                                                 ¯j ]                    ¯ j ] k0
                                                                     n[0,n


In other words, we have j   k for all k , so taking the limit of both sides yields
                           ¯j

               j  lim  k
                      ¯j = lim sup ¯ k (n) = sup lim ¯ k (n) = sup  (n)  sup (n)
                     k0         k0 n[0,n
                                       ¯j ]                  ¯ j ] k0
                                                         n[0,n                          n[0,n
                                                                                            ¯j ]         n0




   We next bound the payoff from below.

Claim A.11
                                                                                  -1
                                                  ¯i                                                            k2
              j      k
                     j
                       
                                sup           -Ni R k
                                                      +Z       qj ,         N~
                                                                             i              Dk  k
                                                                                             i bi Ni G  (Ni )
                              {Ni N0 }                                                                          Ni
                                          i                            ~
                                                                       i                i

Proof. Begin with

                         Ds max bo T (so )1- ds =                                Ds max bo T (so )1- ds
                     s     oO                                                k
                                                                           sSi      oO
                                                                 i

                                                                                 Ds max bo T (so )1- ds
                                                                             k        k
                                                                                    oOi
                                                                 i         sSi

                                                                      Dk  k
                                                                       i bi             max T (so )1- ds
                                                                                    k     k
                                                                                        oOi
                                                                 i                sSi




                                                               50
Similarly,
                                   -Ro  =                      -Ro                              ¯i
                                                                                               -R k
                                                                                                    =                  k ¯k
                                                                                                                    - Oi Ri 
                              oO                i         k
                                                        oOi                      i         k
                                                                                         oOi                   i

                                        
Together, these yield a lower bound for j

    
    j = sup                 -Ro  + Z (qj , |O|)-1                  Ds max bo T (so )1- ds
                  O oO                                         s        oO


              sup              k ¯k
                            - Oi Ri  + Z (qj , |O|)-1                       Dk  k
                                                                             i bi                 max T (so )1- ds
                  O                                                                         k oOi
                                                                                          sSi
                      i                                                 i

             =     sup              sup                  - Oi Ri  + Z (qj , |O|)-1
                                                            k ¯k
                                                                                                                   Dk  k
                                                                                                                    i bi          max T (so )1- ds
                                                                                                                              k     k
                                                                                                                                  oOi
                 {Ni N0 } {   k S k |
                             Oi      |Oi | i}
                                       k =N
                                                    i                                                      i                sSi
                                 i
                                                                                                     -1
             =     sup              sup                      ¯k + Z
                                                         -Ni R i                     q,        Ni                   Dk  k
                                                                                                                     i bi          max T (so )1- ds
                                                                                                                              k      k
                                                                                                                                   oOi
                 {Ni N0 } {      k|
                             Oi Si   |Oi | i}
                                       k =N
                                                    i                                      i                   i            sSi
                                                                            -1
             =     sup                ¯k  + Z
                                  -Ni Ri                qj ,       Ni                     Dk  k
                                                                                           i bi         sup                         max T (so )1- ds
                                                                                                                               k      k
                                                                                                                                    oOi
                 {Ni N0 }                                                                         {Oi                        sSi
                                                                                                       i | i|      i}
                                                                                                    k S k | O k =N
                              i                                i                     i
                                                                            -1
                                      ¯k  + Z                                                                          k2
                   sup            -Ni Ri                qj ,       Ni                     Dk  k
                                                                                           i bi Ni G  (Ni )
                 {Ni N0 }                                                                                              Ni
                              i                                i                     i
             =   k
                 j
                   




Claim A.12 For any k , in the limit as   0,

                                                                                                               -1
                      lim  k  k
                           j    sup
                                                                       ¯ k + z qj ,
                                                                   -ns R                            ns
                                                                                                     ~ds
                                                                                                       ~             Dk  k
                                                                                                                      s bs  (ns ) ds
                                                                         s
                      0                     {ns 0} s




                                                                             51
                                                 2 N i
Proof. Replace and use ni =                      k2

                                                                                  -1
                                    ¯k + Z                                                                                       k2
k
j
  
         =     sup              -Ni R i                         qj ,        Ni                     Dk  k
                                                                                                    i bi Ni G  (Ni )
             {Ni N0 }                                                                                                            Ni
                            i                                           i                    i
                                                                                             -1
                                     ¯ik                                                                                                        k2
         =    sup               - Ni R   +Z                         qj ,         Ni                         Dk  k
                                                                                                             i bi Ni G  ( Ni )
             {Ni 0}                                                                                                                             Ni
                        i                                                   i                          i
                                                                                                       -1
                                     ¯ik 2                                                                                                1             k2
         =    sup               - Ni R   +z                            qj ,  2           Ni                          Dk  k    2
                                                                                                                      i bi Ni  g              ( N i )
             {Ni 0}                                                                                                                       2             Ni
                        i                                                         i                              i
                                                                                                                                                                              
                                                                                                                     -1
                                      k2      ¯ik 2                                                k2                                  k2             1      k2        k2
         =    sup               -          ni R   +z                        qj ,  2                        ni                  Dk  k
                                                                                                                                i bi      ni 2 g  2               ni          
             {ni 0}                  2                                                            2                                    2                     2         k2
                                                                                                                                                                          n
                        i                                                                i                                 i                                           2 i


       Next, we use the fact that lim inf 0 sup{n0} f (n, )  sup{n0} lim inf 0 f (n, )28 along with
               h2
lim0 2         2 i
                  n         = h2 ni and limN  (n) = 1 to get

                                                                       k2    ¯i
          lim  k
               j
                 
                                     sup lim                    -         ni R k 2
                                                                                 +
          0                         {ni 0} 0                           2
                                                        i
                                                                                                                                                             
                                                                                 -1
                                                                 k2                                             k2                 1        k2         k2
                        + z            qj ,  2                         ni                        Dk  k
                                                                                                  i bi               ni 2 g                      ni          
                                                                2                                               2                  2        2         k2
                                                                                                                                                         n
                                                    i                                    i                                                            2 i
                                                                                                                -1
                                                        ¯ik 2                                      2                                       1
                        =            sup          -k ni R   +z                    qj ,            k ni                     Dk  k 2
                                                                                                                            i bi k ni g
                                    {ni 0}                                                                                                 ni
                                             i                                               i                        i
                                                                                                                                        
                                                                                                                     -1                 
                        =            sup k 2                        ¯i
                                                                -ni R k
                                                                        +z            qj , k 2              ni            Dk b
                                                                                                                           i i
                                                                                                                              k
                                                                                                                                 ( n i )
                                    {ni 0}       
                                                        i                                              i
                                                                                                                                        

Since (n) is strictly concave, Jensen's inequality implies that

                                                 sup                     (ns ) ds subject to                               ns ds  ni
                                                  ns              k
                                                                sSi                                                    k
                                                                                                                     sSi

  28
     Quick proof: For any n0 ,  we have f (n0 , )  supn f (n, ). Taking limits preserves inequalities, so that
lim inf 0 f (n0 , )  lim inf 0 supn f (n, ). The conclusion follows from taking sup of both sides with respect to n0 .




                                                                                                 52
                         ni
is maximized for ns =            , i.e., ns is constant. This means
                        |Sik |
                                                                                                                  
                                                                                               -1                 
                   lim  k 
                                          sup k 2               ¯k + z
                                                            -ni R         qj , k 2       ni         Dk bk
                                                                                                           ( n i )
                        j                                        i                                   i i
                  0                     {ni 0}                                                                    
                                                        i                            i
                                                                                         -1
                                  =       sup            ¯s
                                                     -ns R k
                                                             + z qj ,        ns ~
                                                                              ~ds             Dk  k
                                                                                               s bs  (ns ) ds
                                        {ns 0} s

                                  = k
                                    j




Claim A.13
                                                                                 -1
                         j  sup                   -ns Rs + z qj ,        ns
                                                                          ~ds
                                                                            ~            Ds bs  (ns ) ds
                                   {ni 0}


Proof. We can again use the fact that lim inf h0 sup{n0} f (n, h)  sup{n0} lim inf h0 f (n, h) to write
as k  0

                                 k
                   j     lim inf j  lim inf  k
                                             j
                                      k0                k0
                                                                                          -1
                                  sup lim inf               ¯ k + z qj ,
                                                        -ns R                   ns
                                                                                 ~ds
                                                                                   ~           Dk  k
                                                              s                                 s bs  (ns ) ds
                                 {ns 0}      k0 s

                                                                             -1
                        =         sup           -ns Rs + z qj ,       ns
                                                                       ~ds
                                                                         ~           Ds bs  (ns ) ds
                                 {ns 0} s




A.3     Aggregation
A.3.1    The Local Price Index

The price that firm j sets in location s is

                                                                      Wo T (so )
                                                pjs =        min
                                                         - 1 oOj      Bo Z (q, Nj )

In a small enough neighborhood of location s, economic activity is locally uniform. Thus each firm will choose
to have catchment areas that are locally uniform regular hexagons. Among firms with the same effective
productivity Z , the pattern of plant locations will be the same up to translation. These translations are
such that if we integrate across such firms, the total measure of plants at each point will be uniform. An
implications is that, for consumers in location s and firms with effective productivity Z , the fraction of those
firms that have plants closer than distance  to those consumers is the same as the fraction of locations in

                                                                 53
such a firm's catchment area that are closer than distance  to the plant at the center of the catchment
area.
    Given this we now derive an expression for the ideal price index at a location. As in the proof of the
main proposition, we will proceed by dividing the economy into k × k squares in which economic activity is
uniform, taking the limit as   0, and then taking the limit as k  0. We ignore boundary issues because
these will disappear when we take the limit as   0.
                                                                                   -
                                                   1- =
    The ideal price index at location s satisfies Ps                            p1
                                                                                 js dj . Consider a k × k square with uniform local
economic activity, so that catchment areas are uniform hexagons. We can compute the local ideal price
index at any point in that k × k square by integrating over all firms in the economy.
    Let Nji be the number of plants that firm j places in the square. Then for each plant, the distance to
the furthest point in the catchment area is                   k 2 /Nji , and among points that are distance  from the plant,
                         
the fraction                       are in the plant's catchment area (the remainder are served by other plants).29
                        k2 /Nji
The ideal price index can therefore be expressed as
                                                                                                               1-
                                                    k2 /Nji                                   Ws T ( )
                                             0
                                                                                          -1 Bs Z (q,Nj )           2d
                                  1-                                        k2 /Nji
                           k
                          Ps           =                                                                                  dj
                                                                     k2 /Nji
                                                              0
                                                                                                      2d
                                                                                       k2 /Nji


                                                              -1
Using T ( ) = t           and Z (q, N )  z q, 2 N                     gives
                                                                                                             1-
                                                    k2 /Nji
                                                                                            -1        ( )
                                                                                                  Ws t 
                                  1-         0                                                        2
                                                                                            Bs z (q, Nj )
                                                                                                                  2d
                            k                                               k2 /Nji
                           Ps          =                                                                                  dj
                                                                     k2 /Nji                 
                                                              0
                                                                                                      2d
                                                                                            k2 /Nji


               2 Nji
Using nji =    k2
                       and using a change of variables gives

                                                                                -1/2                              1-
                                                                              nji                 ~
                                                      1-
                                                                                                  
                                                                                                            t ~          ~ 
                                                                                                                       2 d ~
                             1-                                              0                   -1/2
                        k                Ws                        -1                           nji
                       Ps         =                               zj                     -1/2
                                                                                                                               dj
                                        - 1 Bs                                       nji                ~
                                                                                                                    ~ ~
                                                                                    0                   -1/2      2 d
                                                                                                      nji

  29
     Recall that   (x) is defined as that fraction of a circle of radius x that intersects with the interior of a hexagon with side
length 1.




                                                                          54
Taking the limits as   0 and k  0 gives
                                                                -1/2                              1-
                                                           njs                  ~
                                              1-
                                                                                
                                                                                            t ~          ~ 
                                                                                                       2 d ~
                                                          0                    -1/2
                  1-               Ws               -1                        njs
                 Ps       =                        zj                  -1/2
                                                                                                                 dj
                                  - 1 Bs                          njs                   ~
                                                                                                    ~ ~
                                                                 0                    -1/2        2 d
                                                                                    njs
                                                                  -1/2
                                              1-                njs                 ~                  1-
                                   Ws               -1                                             ~          ~ dj
                                                                                                                ~
                          =                        zj  n                         -1/2
                                                                                                 t          2 d
                                  - 1 Bs                    0                   njs
                                              1-
                                   Ws               -1
                          =                        zj   (njs ) dj
                                  - 1 Bs

        -1             -1
Define Zs             zj   (njs ) dj
                                                                Ws
                                                   Ps =
                                                           - 1 B s Zs
   With this, we can simplify the expression for local profitability, xs :

         ( - 1)-1                     -1   ( - 1)-1         (Bs /Ws )-1   ( - 1)-1         (Bs /Ws )-1
xs =              L  c P
                    s s s ( B s /W s )   =          L  P c
                                                      s s s      1-     =          L  P c
                                                                                     s s s          1-
                                                               Ps                               Ws
                                                                                                                      -1 Bs Zs
         1
    =      Ls Ps cs (Zs )1-
         
         1            Ws
    =      Ls              cs (Zs )1-
           - 1 B s Zs
           1 Ws L s
    =                 c
                      s
          - 1 B s Zs

A.3.2   Market clearing for Space

We use the same approach to characterize the total amount of local real estate used by plants. Consider a
square of size k × k . The fraction of of land devoted to commercial real estate is

                          k        1                                                        1
                         Ns =                  1 {j has plant in s} djds =                         Nji (j ) dj
                                   k2     k
                                        sSi                                                 k2

where Nji is the number of plants the firm places in square Sik . Using  = 2 , this is

                                               k           1
                                              Ns = 2               Nik (j ) dj
                                                           k2

              2 Nji
Using nji =   k2
                                                    k
                                                   Ns =           nji dj



                                                           55
Taking the limit as   0 and k  0 gives

                                                                   Ns =         njs dj


A.3.3     Consumption

We derive here an expression for the local consumption bundle. Labor used by firm j in a plant located in
o to produce cjs Ls units of output for consumption by households in location s is


                                                                                                                      -
                                       T (os )          T (os )      -         T (os )         Wo T (os )
                 ljos ( ) =                    cjs Ls =         cs Ps pjs Ls =         cs Ps                              Ls
                                       Bo Zj            Bo Zj                  Bs Zj          - 1 Bs Zj
                                                 -                         1-
                                                        1     Wo T (os )              
                                =                                                 cs Ps Ls
                                          -1            Wo     Bo Zj

   We again use the approach of studying a k × k square in which economic activity is uniform. In such a
square, firm j sets up Nji plants, each with a catchment area that is a regular hexagon of size 1/Nji (again,
ignoring boundary issues, which disappear in the limit as   0. If the density of employment in the square
is Lk
    i
       and consumption per capita is ck , then, per unit of space, total employment of firm in the square
                                      i
is then
                                                                                 1-
                            k2 /Nji                 -
        1                                                1       Wik T ( )                                         
           Nji                                                                        ck
                                                                                       i
                                                                                         
                                                                                          Pik       Lk
                                                                                                     i
                                                                                                       
                                                                                                                               2d
        k2        0                       -1            Wik       Bik Z
                                                                        j                                         k 2 /Nji

Employment across all firms per unit of space is then
                                                                                      1-
                                    k2 /Nji              -
            1                                                 1       Wik T ( )                                        
Lk
 i
   
    =          Nji                                                                          ck
                                                                                             i
                                                                                               
                                                                                                Pik      Lk
                                                                                                          i
                                                                                                            
                                                                                                                                 2ddj
            k2           0                       -1          Wik       Bik Z
                                                                             j                                        k 2 /Nji

                              ~ = / and nji =                          2
Using the change of variables                                            N ,
                                                                       k2 ji
                                                                                  this is
                                                                                                           
                                                         -                            1-
                                    / nji
                                                              1       Wik t(~)                                     ~
                                                                                                                   
   Lk 
       =              nji                                                                   ck 
                                                                                                Pik      Lk 
                                                                                                                               2 d ~
                                                                                                                                 ~ dj
    i                                                                                        i            i
                                              
                                0                -1          Wik      Bik Z
                                                                            j                                     / nji
                                         -                       1-
                                               1         Wik                          
           =                                                          ck
                                                                       i
                                                                         
                                                                          Pik            Lk
                                                                                          i
                                                                                            
                                                                                             (nji )dj
                             -1               Wik        k Z
                                                        Bi   j




                                                                           56
Taking the limit as   0 and k  0 gives

                                                -                    1-
                                                    1      Ws
                        Ls =                                              cs (Ps ) Ls (njs )dj
                                       -1           Ws    Bs Zj
                                            -                  1-
                                                1        Ws
                             =                                      cs (Ps ) Ls Zs
                                                                                 -1
                                    -1          Ws       Bs

                                                                         Ws
Combining this with the expression for the price level Ps =          -1 Bs Zs   and simplifying gives

                                                     cs = Bs Zs


B     Rents and Density
Our theory relies on the observation that more desirable locations exhibit a higher rent. As more desirable
locations have higher population density, we can study empirically the connection between rents and a
location desirability by testing whether locations with higher population density have higher rent. We
borrow rent data from Zillow for the year 2018. For population density, we use the 2012-2016 population
estimate provided in the American Community Survey (ACS) dataset. For each zipcode and county, Zillow
provides an estimate of the rent per square foot. The rent per square foot is a preferable measure of rent
than just the average rent in a location as the former controls for differences in housing size across locations,
while the latter does not. Figure B.1 shows how the rent per square foot of a location, measured at either
zip code or county levels, increases with the location population density.




                                                          57
                                              Figure B.1: Rents across space




 Notes: The figure presents the binned rent per square foot of a location (zipcode or county) in 2018 as a function of the location
 population density. Rent data comes from Zillow, while we use the 2012-2016 population estimate in the American Community Survey
 (ACS) to construct the population density measure.



C     Sorting and Single-Crossing
In this section we perform some robustness checks to our sorting and single-crossing results.

C.1     Excluding Each Firm's Own Employment
Figure C.1 revisits our sorting results both sorting and single-crossing results, but redefines the average
population density (for sorting) and total firm employment (for single-crossing) to be net of the firm contri-
bution to employment/population in a location (for sorting) and of the location contribution to total firm
employment (for single-crossing).

C.2     Alternative Approaches to Identify the Largest Firm in Town
In Figure 15, in locations where multiple firms tie for the highest number of plants we use the average firm
size among these firms. There are other reasonable approaches. We explore two alternative approaches in
Figure C.2. In the left panel we exclude locations with ties for the highest number of plants. In the right


                                                                58
                    Figure C.1: Sorting, excluding own firm contribution to local employment

                                     Sorting                              National size of Largest firm in town




 Notes: The left figure presents the results for the log average employment density of each location, weighted by the number of
 establishments of a particular firm operating in a particular industry in the location, net of the firm's employment contribution to each
 location's employment level. We subtract industry fixed effects, then bin the residuals by the log total firm employment at the national
 level. The right figure is produced by finding the log employment of the firm with the most plants in an industry and location, net of
 the location's contribution to the firm's total employment level, and regressing its total employment on industry fixed effects, weighted
 by each industry's total employment. In locations where multiple firms are tied for the highest number of plants, we take the average
 of the firm size. We then bin the residuals against log population density. Both figures present the results for five different resolutions
 M : 3 miles, 6 miles, 12 miles, 24 miles, and 48 miles.




panel, whenever there is a tie for the highest number of plants, we use the firm size of the largest firm among
those tied. In both cases, as in Figure 15, we find patterns consistent with single-crossing.

                Figure C.2: The National Size of the Largest Firm in Town, alternative methods

                  Discarding Geographies with Ties                                   Using Largest Firm




 Notes: The figure is produced by finding the employment of the firm with the most plants in an industry and location, and regressing
 its total employment on industry fixed effects, weighted by each industry's total employment. In the left figure we discard locations
 where multiple firms are tied for the highest number of plants. In the figure on the right we use the employment of the largest firm in
 locations where multiple firms are tied for the highest number of plants. We then bin the residuals against log population density for
 five different resolutions M : 3 miles, 6 miles, 12 miles, 24 miles, and 48 miles.




                                                                    59
C.3     Alternative Weights
Figure C.3 revisits the sorting results, but using alternative weighting methods. In the left plot, average
population density is weighted by the number of plants of firm, while in the plot in the right average
population density is equally weighted across locations where the firm is present.

                                 Figure C.3: Sorting in the data, alternative weighting

                        Weighted by employment                                      Equally weighted




 Notes: The left figure presents the results where the average employment density of each location is weighted by the employment of
 a particular firm in the location. In the figure on the right each observation is equally weighted. To produce these figures we first
 subtract industry fixed effects, we then bin the residuals by the log total firm employment. Both figures present the results for five
 different resolutions M : 3 miles, 6 miles, 12 miles, 24 miles, and 48 miles.




C.4     Heterogeneity in Sorting
In Figures C.4 and C.5 we study how sorting and the single-crossing property vary across major sectors.
We focus on three major industries: manufacturing (left plots in both figures), services (center plots in both
figures), and retail trade (right plots in both figures). The first row in each figure uses all firms within the
industries, while plots in the second row exclude firms with a single plant in a given industry.
   The first row of both Figures C.4 and C.5 paint a clear picture: Although less pronounced for manu-
facturing, sorting with the single-crossing property seems to be present in the three major sectors that we
present. Not surprisingly, the effects seem to be weaker for manufacturing. Manufacturing has a higher
prevalence of large firms with a single plant. For example, this could be due to lower transportation costs,
or to higher returns to scale relative to other industries. Once we remove firms with a single plant within an
industry, strong sorting patterns, exhibiting the single-crossing property, are clearly observed for the three
major sectors. This can be seen in the second row of Figures C.4 and C.5.
   There is clear evidence of sorting in all three sectors. However, it seems that the extent sorting varies
by sector. The average density of a location where a firm locates its plants exhibits a flatter profile in
manufacturing, a moderately increasing profile in services, and a strongly increasing profile for retail trade.


                                                                  60
                                                  Figure C.4: Sorting by Sector

                 Manufacturing                                  Services                               Retail Trade




 Notes: The figures present the results where the log average employment density of each location is weighted by the number of
 establishments of a particular firm operating in a particular industry in the location. To produce the figures, we subtract industry fixed
 effects, and bin the residuals by the log total firm employment at the national level. The figures present the results for five different
 resolutions M : 3 miles, 6 miles, 12 miles, 24 miles, and 48 miles. The left plots presents the results for the manufacturing sector, the
 center plots present the results for the service sector, while the right plots present the results for retail. The plots in the first row
 present the results using all firms within a sector. The plots on the second row remove firms with only one plant.




The same is true for the the size of the firm with most plants in a location as a function of the rent of that
location. In other words, it seems that retail exhibits the highest amount of sorting across space, services
exhibits moderate amount of sorting across space, and manufacturing the least amount of sorting across
space.




                                                                    61
                        Figure C.5: The National Size of the Largest Firm in Town by Sector

                 Manufacturing                                   Services                                Retail Trade




 Notes: The figures are produced by finding the log employment of the firm with the most plants in an industry and location, and
 regressing its total employment on industry fixed effects, weighted by each industry's total employment. In locations where multiple
 firms are tied for the highest number of plants, we take the average of the firm size. We then bin the residuals against log population
 density for five different resolutions M : 3 miles, 6 miles, 12 miles, 24 miles, and 48 miles. The left plots present the results for the
 manufacturing sector, the center plots present the results for the service sector, while the right plots present the results for retail. The
 plots in the first row present the results using all firms within a sector. The plots on the second row removes firms with only one plant.




D      Transportation Measures and Additional Results
In this section we provide a description of the transportation measures that we construct to asses the
importance of transportation efficiency in explaining the way firms set up their stores across space (see
Section 4.5). We build seven different transportation measures. Some of them vary across firms across
industries, while other vary within a firm across space. A description of these measures is available in
Table IV.




                                                                     62
                           Table IV: Measures of Transportation Efficiency
     Measure                                                    Description


Gini coefficient   Gini coefficient of industry i's employment in a location relative to population in that location.
                   A high value indicates that industry i is concentrated relative to population. We interpret this
                   as industry i exhibiting high transportation efficiency. Constructed at SIC8 level.

Ellison-Glaeser    Constructed following Ellison and Glaeser (1997). Compares firm employment distribution in
                   industry i with counterfactual distribution where firms locate randomly across space. A high
                   value indicates high concentration. We interpret this as high transportation efficiency.
                   Constructed at SIC8 level.

Consumer gravity   Constructed following Agarwal et al. (2017). The index measures, across industries, the elasticity
                   of expenditure with respect to distance. We map industries with weaker gravity to industries with
                   high transportation efficiency. This index is constructed for a subset of SIC2 industries. We apply
                   the same index value to all SIC8 industries within an SIC2 industry with an estimate.

Freight Cost       Additive inverse of 1992 measure constructed in Bernard et al. (2006). Available for manufacturing
                   industries at SIC2 level. We apply the same index value to all SIC8 industries within an SIC2
                   industry with an estimate.

Trade Cost         Additive inverse of measure constructed in Gervais and Jensen (2019). Trade cost estimates for
                   969 service and manufacturing industries at NAIC6 level. We apply the same index value to all
                   SIC8 industries within a NAICS6 industry with an estimate.

Speed Score        Constructed following Couture et al. (2018). Provides Estimate of driving speed for the top 50
                   Metropolitan Statistical Areas (MSAs) in the US, for 2008. We assign the same speed score
                   to all locations within an MSA.

Travel Time        Constructed using data for 2014 from the Texas Transportation Institute. Provides travel time
                   at peak period relative to free-flow conditions for the major 470 urban areas in the US. We
                   assign the same travel time to all locations within an urban area. We apply an additive inverse
                   to the measure provided by the Institute.




                                                          63
Figure D.1: The Effect of Transportation Efficiency on Average Plant Employment Across Resolutions




Notes: The figure presents the estimated coefficients on the interaction term, 1 , in equation 13 for each of the transportation
efficiency measures described in Table IV. All transportation efficiency measures are standardized. We present the results for five
different resolutions M : 3 miles, 6 miles, 12 miles, 24 miles, and 48 miles.




                                                                64
E      Numerical Exploration: Algorithm
In this section we describe the algorithm that we used to solve for the industry equilibrium. Our algorithm
exploits the first order conditions of the firm's problem (equations 3 and 4),

                                  -1
                             x s zj   (njs )  Rs + j ,                   with equality if njs > 0, and
                                                      d[z (qj , Nj )-1 ]
                                             j = -                               xs (njs )ds,
                                                            dNj              s

                                                                                                             1
                                                              Is /(-1)                      -1               -1
where zj = z (qj , Nj ) with Nj =           s njs ds, xs =      Zs-1     with Zs =       j zj  (njs )dj           , and Rs = R(Is ).
     Our algorithm iterates on three univariate functions, Zs  s, and {Nj , j }  j . Let t = 0, 1, 2, ... denote the
                                                                                   t-1  s, and {N t-1 , t-1 }  j ,
iteration round. Given an initial guess or the results of the previous iteration, Zs             j      j
we can compute the following objects: (i) nt                                   t
                                           j,s  j, s (using equation 3), (ii) Nj =
                                                                                                             t
                                                                                                          s njs ds,
                                                                                                                             t = z (q , N t ),
                                                                                                                      (iii) zj       j   j
                                            1
                        -1                  -1                                                                    t )-1
                                                                                                          z (qj ,Nj
      t =           t                                              Is
(iv) Zs        j   zj        (nt
                               js )dj            , (v) xt
                                                        s =    (-1)(Zst )-1
                                                                            ,    and (vi) t
                                                                                          j = -       s        N        xt   t
                                                                                                                         s (njs )ds.     We
                                                                                                ~ such that
repeat this procedure until a convergence criterion is satisfied, that is, until there is a t = t

                                     t  ~ t-1     ~   t    t-1 ~     ~    t-1       ~    ~
                                  ||Zs - Zs   || + ||Nj - Nj   || + ||t
                                                                      j - j ||                    ,

where || · || is the sup norm and            is a small number.
     We use a two dimensional grid of points to numerically integrate when necessary and to evaluate the
convergence criterion. Specifically, we use a two dimensional grid of S locations and J firms. For each
                                                                          t , at these grid points. For each point
iteration, a sufficient state is the value of the functions Nj , j , and Zs
                                                 t-1 , N t-1 , and t-1 to evaluate nt . To find N t , numerically
j, s on the grid, we require only the values of Zs      j          j                js           j
integrate across the locations using the trapezoid rule and the values of nt
                                                                           js at each of the S location grid
                             -1
points. Similarly, to find t
                           j , we numerically integrate across locations. To find each location's local
                                                                                    t and nt at each grid
productivity, for any s, we numerically integrate across firms using the values of zj      js
point. This delivers new values of the functions at each of the S grid points. Finally, to evaluate the norms,
we evaluate the convergence criterion by numerically integrating using the grid points.
     In our numerical simulation, we used J = 50 and S = 100, but we found no noticeable difference in the
solution when we used a grid of J = 30 and S = 50.
     A complication arises due to the fact that (n) is linear in the neighborhood of n = 0 (see Lemma 2).
Because of this linearity, njs move quite a bit across iterations in response to very small changes in Zs , Nj
and j . This can generate cycles in the iteration process. We handle this issue in two ways.
    First, at each iteration, we do not fully update the policy functions. That is, we evaluate iteration t + 1
using Z~s
        t, N~ t and ~ t instead of Z t , N t and t , where Z
                                    s
                                                           ~s                          ~ t = N t-1 + (1 -  )N t , and
                                                             t =  Z t-1 + (1 -  )Z t , N
                                                                   s              s
             j        j                   j      j                                       j    j              j
~ t = t-1 + (1 -  )t , where   (0, 1) is a dampening parameter. In principle, there exists a  < 1 such
 j       j               j
that cycles are not a concern. However, in many situations (i.e. sets of parameter values) the low degree of


                                                                    65
updating of the policy functions makes the code extremely slow.30 Thus, we take an additional step.
      Second, we replace the function (n) with

                                             ^ (n) = H(n) + (1 - )(n) ,
                                             

where H(n) = 1 - e-n/h . Notice that H (n) > 0, H (n) < 0, with H(0) = 0, limn H(n) = 1.31 As a
result, ^ (n) > 0, ^ (n) < 0, with ^ (0) = 0, limn ^ (n) = 1.
      That is, in the iteration process we use ^ (n) instead of (n). In our experiments, a combination of
 > 0 and  > 0 are able to handle cycles and thus allows the code to converge quickly. For the numerical
explorations presented in this paper we use  = 0.97 and  = 0.0001.
    To ensure that this approximation yields an accurate solution, we can evaluate whether the resulting
policy function found using                                                               ^s , N
                            ^ is the solution to each firm's true problem that uses . Let Z    ^j and ^j
denote the solution of the iteration process (i.e. once the convergence criterion is satisfied) when we solve
the firms problem using  ^ (n). We can also easily obtain n
                                                          ^ js , z            ^j ), and x
                                                                 ^j = z (qj , N         ^s . To gauge the accuracy
of the approximate solution, we compute,

                                                                         error in equation 3

                                                                      -1                 ^ j ) djds ,
                        absolute error =             1 [^
                                                        njs > 0] x
                                                                 ^s z
                                                                    ^j     njs ) - (Rs + 
                                                                          (^
                                             s   j
                                                                      -1                 ^ j ) djds
                                             s j     1 [^
                                                        njs > 0] x
                                                                 ^s z
                                                                    ^j     njs ) - (Rs + 
                                                                          (^
                         relative error =                                                             .
                                                                 1 [^
                                                                    njs > 0] (Rs + ^ j )djds
                                                           s j


That is, the first expression computes the absolute error of the allocation using ^ (n), but evaluating the
first order condition using (n), while the second expression provides the absolute error, relative to the level
of costs for firm j in location s, as described by the RHS of equation 3. For our baseline equilibrium, we
find that absolute error = 0.00008, and relative error = 0.000025. That is, the absolute error is 0.0025% of
the average level of the RHS of the first order condition. This provides reassurance that the solution under
^ (n) is a good approximation of the actual solution.




 30
      For high enough values of  the code can take many hours to converge, even when J and S are small.
 31
      The parameter h allows us to modify the concavity of the function H(n). Here, we used h = 0.01.


                                                                 66
