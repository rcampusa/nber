                               NBER WORKING PAPER SERIES




FOUNDATIONS OF WELFARE ECONOMICS AND PRODUCT MARKET APPLICATIONS

                                         Daniel McFadden

                                       Working Paper 23535
                               http://www.nber.org/papers/w23535


                      NATIONAL BUREAU OF ECONOMIC RESEARCH
                               1050 Massachusetts Avenue
                                 Cambridge, MA 02138
                                      June 2017




I am indebted to Kenneth Train, Professor of Economics, University of California, Berkeley, who
made major contributions to the contents of this paper, including the welfare calculus formulas
given in Sections 5 and 7, the application given in Section 8, and Appendix C. I also thank Moshe
Ben-Akiva, Andrew Daly, Mogens Fosgerau, Garrett Glasgow, Stephane Hess, Armando Levy,
Douglas MacNair, Charles Manski, Rosa Matzkin, Kevin Murphy, Frank Pinter, Joan Walker,
and Ken Wise for useful suggestions and comments. The views expressed herein are those of the
author and do not necessarily reflect the views of the National Bureau of Economic Research.

The author has disclosed a financial relationship of potential relevance for this research. Further
information is available online at http://www.nber.org/papers/w23535.ack

NBER working papers are circulated for discussion and comment purposes. They have not been
peer-reviewed or been subject to the review by the NBER Board of Directors that accompanies
official NBER publications.

© 2017 by Daniel McFadden. All rights reserved. Short sections of text, not to exceed two
paragraphs, may be quoted without explicit permission provided that full credit, including ©
notice, is given to the source.
Foundations of Welfare Economics and Product Market Applications
Daniel McFadden
NBER Working Paper No. 23535
June 2017
JEL No. D11,D12,D60,D61,K13,L51

                                         ABSTRACT

A common problem in applied economics is to determine the impact on consumers of changes in
prices and attributes of marketed products as a consequence of policy changes. Examples are
prospective regulation of product safety and reliability, or retrospective compensation for harm
from defective products or misrepresentation of product features. This paper reexamines the
foundations of welfare analysis for these applications. We consider discrete product choice, and
develop practical formulas that apply when discrete product demands are characterized by mixed
multinomial logit models and policy changes affect hedonic attributes of products in addition to
price. We show that for applications that are retrospective, or are prospective but compensating
transfers are hypothetical rather than fulfilled, a Market Compensating Equivalent measure that
updates Marshallian consumer surplus is more appropriate than Hicksian compensating or
equivalent variations. We identify the welfare questions that can be answered in the presence of
partial observability on the preferences of individual consumers. We examine the welfare
calculus when the experienced-utility of consumers differs from the decision-utility that
determines market demands, as the result of resolution of contingencies regarding attributes of
products and interactions with consumer needs, or as the result of inconsistencies in tastes and
incomplete optimizing behavior. We conclude with an illustrative application that calculates the
welfare impacts of unauthorized sharing of consumer information by video streaming services.


Daniel McFadden
University of California, Berkeley
Department of Economics
508-1 Evans Hall #3880
Berkeley, CA 94720-3880
and NBER
mcfadden@econ.berkeley.edu
1. INTRODUCTION

   A common problem in applied economics is assessment of the welfare consequences for consumers of
policies/scenarios that regulate markets for products, or correct for past product defects or misrepresentations.
Examples are (1) prospective regulation of information provided on coverage and costs in insurance contracts and
other financial instruments such as mortgages, and retrospective redress of harm from failures to properly disclose
information; (2) harm from environmental damage to recreation facilities such as ocean beaches; (3) safety
regulation of consumer products such as automobile air bags, mobile phones, and privacy protection in video
streaming services, or redress of harm from safety defects; and (4) evaluation of overall market performance; e.g.,
the prospective benefit of blocking a merger of dominant suppliers, or retrospective harm from collusion or
restraints on entry. This paper reexamines the foundations of welfare analysis for these applications, and provides
a practical framework for analysis that rests on these foundations.

                                               Figure 1. Dupuit’s Calculation of Relative Utility


                                                                            Demand for trips adjusts to equate
                                                                            value in exchange and value in use
                                                                            = Marginal utility per monetary unit
                           Toll per Crossing




                                                            a
                                                                              Scenarios
                                                 "Relative
                                                 utility" or
                                                 "consumer
                                                 surplus"                              b


                                                            Bridge Crossings per Year

   Measuring changes in consumer well-being from policies that affect the availability, prices, and/or attributes
of goods and services has been a central concern of economics from its earliest days. Adam Smith (1776) observed
that “haggling and bargaining in the market” would achieve “rough equality” between value in use and value in
exchange. Working at the fringes of mainstream economics, Jules Dupuit (1844) was remarkably prescient,
recognizing that if the marginal utility of income (MUI) is constant, then the demand curve for a commodity
(illustrated in Figure 1) is a marginal utility curve, so that the area to the left of this demand curve between the
prices established by scenarios labeled a and b gives a money-metric measure of “relative utility”. Dupuit’s
measure later became known as Marshallian Consumer Surplus (MCS); see Alfred Marshall (1890, III.IV.2-8).




                                                                       2
Hermann Gossen (1854) deduced further that consumers exhibiting diminishing marginal utility would achieve
maximum utility when the marginal utilities per unit of expenditure on each good are equal, and equal the MUI.

   To rephrase these propositions in current microeconomic terms, suppose the consumer maximizes a utility
function U(q0,q1) of two goods subject to a budget constraint I = p0q0 + p1q1, where I is income and p0 and p1 are
the goods prices. Let q0 = D0(I,p0,p1) and q1 = D1(I,p0,p1) ≡ (I – p0D0(I,p0,p1))/p1 denote the demands that come out
of this maximization, and let V(I,p0,p1) ≡ U(D0(I,p0,p1),D1(I,p0,p1)) ≡ max U(q0,(I – p0q0)/p1) denote the resulting
                                                                             q0

indirect (or maximized) utility. The first-order condition for maximization is FOC ≡ ∂U/∂q0 – (p0/p1)∂U/∂q1 = 0.
The derivatives of V are ∂V/∂I = (1/p1)∂U/∂q1 + FOC∙(∂D0/∂I) ≡ (1/p1)∂U/∂q1 and ∂V/∂p1 = – (D1(I,p0,p1)/p1)∂U/∂q1
+ FOC∙(∂D0/∂ p1) ≡ – D1(I,p0,p1)∙ (∂V/∂I ), illustrating the envelope theorem. Rearranging the MUI ∂V/∂I gives
Smith’s proposition: “value in exchange” ≡ p1 = (∂U/∂q1)/(∂V/∂I) ≡ “value in use” (or marginal utility per unit of
good 1 measured in money units), which combined with a rearrangement (1/p1) ∂U/∂q1 = (1/p0)∂U/∂q0 of the FOC
                                   𝜕𝜕V/ ∂p1
gives Gossen’s result. The ratio           �∂V/ ∂𝐼𝐼 ≡ – D1(I,p0,p1) gives Roy’s (1947) identity. Substituting this ratio

in the Dupuit’s relative utility or Marshallian consumer surplus (MCS) integral,

                  p                       p   𝜕𝜕V/∂p1
(1)      MCS = ∫p 1a D1(I,p0,p1)dp1 ≡ ∫p 1b             dp1 ≡ [V(I,p0,p1b) – V(I,p0,p1a)]/MUI*,
                   1b                      1a  ∂V/∂𝐼𝐼


where the last equality is obtained by integration after applying the first mean value theorem to move outside
the integral an intermediate value MUI* of the denominator ∂V/∂I. In this paper, we define a measure of the
consumer’s change in well-being that we term the Market Compensating Equivalent (MCE),

(2)     MCE = [V(I,p0,p1b) – V(I,p0,p1a)]/MUIa,

the difference in indirect utilities, scaled to money-metric units by dividing by the MUI at the “default” or “as is”
scenario a. Obviously, MCS and MCE differ only in the MUI scaling factor, and are identical when MUI is constant,
confirming Dupuit’s original insight. The advantage of MCE is that it is easily calculated when the indirect utility
function and its derivatives are known, allows the introduction of policy change dimensions other than price,
avoids the generally path-dependent definition of MCE, and usefully for retrospective analysis, expresses the
change in well-being in units of the consumer’s income in the “as is” scenario. The indirect utility function V has
MUI constant, given p0, if and only if it has an additively separable form V(I,p0,p1) = μI/p0 – G(p1/p0) for some
function G and constant μ, in which case Roy’s identity establishes that the demand for good 1, D1(I,p0,p1) =
G’(p1/p0)/μ, is independent of income.




                                                                 3
      Dupuit’s idea of solving the inverse problem, recovering utility from demand, was brought into mainstream
economics at the end of the 19th century by William Stanley Jevons (1871), Francis Edgeworth (1881), Alfred
Marshall (1890), Vilfredo Pareto (1906), and Eugen Slutsky (1915). MCS became the accepted measure of the
change in consumer well-being. However, John Hicks (1939) observed that when the MUI = ∂V(I,p0,p1)/∂I is not
constant, reducing income in scenario b by a transfer MCS will not necessarily leave the consumer indifferent
between the scenarios. Hicks considered this a defect, and introduced two closely related alternative measures
that correct it: Hicksian Contingent Valuation (HCV), the net decrease in scenario b income that equates utility in
the two scenarios, and Hicksian Equivalent Variation (HEV), the net increase in scenario a income that equates
utility in the two scenarios.

      Importantly, the MCE, HCV, and HEV measures correspond to different consumer choice environments: The
HCV measure assumes that the transfer is fulfilled in scenario b before the consumer makes a choice in that
scenario, and the HEV measure assumes the transfer is fulfilled in scenario a before the scenario a choice. The
MCE measure assumes that choices are made under actual market and income conditions in each scenario,
without compensation, and that the post-choice transfer is determined after this as a remedy for the utility gain
or loss from the change in scenario. Then, HCV is appropriate for prospective welfare analysis when the transfer
is fulfilled before choice in scenario b, and HEV when the transfer is fulfilled before choice in scenario a. However,
for retrospective welfare analysis where the objective is to redress past harm, or for prospective analysis where
the transfers are hypothetical and not fulfilled, MCE is a more appropriate measure of what it takes to “make the
consumer whole” following the choices the consumer did make or would have made in the uncompensated “as
is” and “but for” scenarios. MCE is also appropriate for assessment of residual gains and losses subsequent to
prospective analysis where an inexact compensation scheme is fulfilled.

      HCV and HEV are often defined as areas to the left of income-compensated demand curves (i.e., demands with
income adjusted as price changes to keep utility fixed at the scenario a or scenario b levels, respectively).
However, their definition in terms of the indirect utility function, solutions to V(I – HCV,p0,p1b) = V(I,p0,p1a) and
V(I,p0,p1b) = V(I+HEV,p0,p1a), are more revealing. Applying the mean value theorem, they satisfy

          HCV = [V(𝐼𝐼, p0 , p1b ) – V(𝐼𝐼, p0 , p1a )]/MUI′
(3)                                                           ,
           HEV = [V(𝐼𝐼, p0 , p1b ) – V(𝐼𝐼, p0 , p1a )]/MUI"

where MUI’ and MUI” are some intermediate values. Then, these two measures, the MCE measure from (2), and
MCS are all proportional to the difference in utilities of the two scenarios, and differ only in scaling by the MUI
valued at different points. Obviously, if the MUI is constant, then MCE, HCV, HEV, and MCS are identical, and in

                                                                  4
applications where the marginal utility of income varies little, they will be close approximations. MCE has a closed
form when the indirect utility function is known, a computational advantage over HCV and HEV.

   Samuelson (1947) and Hurwicz and Uzawa (1971) updated the Hicksian analysis using modern consumer
theory, and their approach has been adapted to consumers making discrete choices by Diamond and McFadden
(1974), Small and Rosen (1981), McFadden (1981, 1994, 1999, 2004, 2012, 2014), Yatchew (1985), and Zhou et al
(2012). For the most part, this literature assumes that consumers are strictly neoclassical utility maximizers, with
self-interest defined narrowly to include only personally purchased and consumed goods. Mostly, social motives
are ignored and no allowance is made for ambiguities and uncertainties regarding tastes, budgets, hedonic
attributes of goods and services, the reliability of transactions, or the consistency and completeness of preference
maximization, and there is no distinction between the decision-utility postulated to determine market behavior
and the experienced-utility of outcomes. Public and environmental goods are incorporated only if they have active
margins that allow them to be valued from market behavior. The market demand functions of individual
consumers are assumed to be completely observed, and consumers fully informed about policy regimes, so that
utility can be recovered from the demand behavior it produces and the compensating transfers can be calculated
and fulfilled exactly each consumer. The primary focus of welfare theory has been prospective, assuming that
compensating transfers are fulfilled before consumer choices are made. The analysis has been fundamentally
static, with the consumer pictured as making a once-and-for-all utility-maximizing choice for contingent deliveries
of market goods, even if resolution of uncertainties and fulfillment of contracts extend over time; as in Debreu
(1959). Analysis typically starts from prespecified scenarios, although in retrospective applications there are often
substantive questions regarding the nature of the “but for” scenario, particularly when the “as is” scenario leads
to experienced utility different from decision utility. Two further assumptions are tacit in most practical welfare
calculations: First, policy scenario differences are limited in scope and magnitude, so that after accounting for a
few major margins, general equilibrium effects can be neglected. Second, if compensating transfers are
incomplete within a class of consumers, conducted say using a simple formula such as uniform transfers rather
than an exact consumer-by-consumer calculation, the loss in social welfare from this imperfect redistribution can
be neglected relative to the aggregate welfare change for the class.

     We review these assumptions. Section 2 gives a foundation in consumer theory for the welfare calculus, with
explicit treatment of discrete alternatives and their hedonic attributes. Section 3 restates the welfare measures
in Section 1 for general applications, using the consumer theory of Section 2. Section 4 distinguishes retrospective
and prospective policy applications of the welfare calculus. Section 5 discusses partial observability of individual
consumer preferences, and its implications for welfare measurement and aggregation. Section 6 distinguishes

                                                           5
decision-utility and experienced-utility foundations for calculation of well-being. Section 7 gives computational
formulas for common policy problems. Section 8 contains an illustrative empirical application. Appendices collect
relevant mathematical results on approximation, give properties of extreme-value distributed random variables,
and give R-code for discrete welfare calculations.




2. CONSUMER FOUNDATIONS

      A common starting assumption for welfare analysis is that consumers have “nice” demand functions that allow
recovery of indirect utility. For example, Hurwicz and Uzawa (1971) give local and global sufficient conditions for
recovery of money-metric indirect utility 2 when the market demand function is single-valued and smooth; see
also Katzner (1970) and Border (2014). Another approach, originating in the revealed preference analysis of
Samuelson (1948), Houthakker (1950), and Richter (1966), gives necessary and sufficient conditions for recovery
of a preference order whose maximization yields the market demand function; Afriat (1967) and Varian (2006)
provide constructive methods for recovery of utility under some conditions. Technical difficulties arise because
quite strong smoothness and curvature conditions on utility are needed to assure smoothness properties on
market demand, while preferences recovered from upper hemicontinuous demand functions are not necessarily
continuous; see Peleg (1970), Rader (1973), Conniffe (2007). This section gives a restatement of the consumer
theory behind welfare measurement, with extensions that include a “no local cliffs” Lipschitz continuity axiom on
the preference map that avoids the Peleg-Rader problem and guarantees representation of preferences by utility,
expenditure, indirect utility, and demand functions that satisfy (bi-)Lipschitz 3 conditions in economic variables.
These results facilitate practical welfare measurement, and are of independent interest. Readers may find it useful
to refer to Table 1 for notation, and consult as needed the technical material in the remainder of this section.




2
    Indirect utility is money-metric if the marginal utility of (real) income in a baseline scenario remains one as income changes.
3
    An increasing function is bi-Lipschitz if its left and right derivatives are bounded away from 0 and +∞.

                                                                    6
                                                           Table 1. Notation

m = a,b                        “As-Is”/baseline policy/scenario a and “But-For”/counterfactual policy/scenario b
s∈S                            Finite-dimensional vector in a compact set S describing observed demographics and
                               history of the decision-maker
Im ∈ [IL,IU]                   Consumer real income, in an interval [IL,IU], with 0 < IL < IU < +∞, in scenario m
j ∈ Jm ⊆ J = {0,…,J}           Mutually exclusive discrete choices (e.g., “products”), including “benchmark” or “no-
                               purchase” alternatives that are not affected by policy change
zjm ∈ Z                        Vector zm of observed hedonic attributes zjm for alternatives j ∈ Jm in scenario m, in a
                               compact finite-dimensional set Z
q ∈ Q’ ⊆ Q                     Vector of the goods and services that are supplied in continuous quantities, in a finite
                               rectangle Q ≡ [0,qU] in n-dimensional Euclidean space, or in a subrectangle Q’ = [0,qA],
                               where qA is an upper bound on vectors that are affordable, 0 ≪ qA ≪ qU
wjm = (q,zjm) ∈ W              Consumption vector given discrete choice j in scenario m, in W = Q×Z or in W’ = Q’×Z
pjm ϵ P                        Real price, in a compact interval P = [0,pU] with pU > 0, of discrete product j in scenario
                               m; pm is the vector with components 𝑝𝑝jm for j ∈ Jm
rm ∈ R                         Finite-dimensional vector in a rectangle R = [rL,rU], with 0 ≪ rL ≪ rU,≪ +∞, of real
                               prices of the goods and services that are available in continuous quantities;
                               benchmark ra
rm∙qm + pjm ≤ Im               Budget constraint given discrete alternative j in scenario m
≽∈H                            A field H of complete transitive reflexive preference preorders ≽ on Q×Z,
                               represented by sets G(≽) ⊆ W×W with (w’,w”) ∈ G(≽) ⟺ w’ ≽ w”

U(q,z,≽)                       A direct utility function conditioned on choice j in scenario m, defined on Q’×Z×H as
                               the minimum over q’ ∈ QU of ra⋅q’ such that (q’,z0a) ≽ (q,zjm) ≡ wjm
M(u,r,z,≽)                     An expenditure function, the minimum over q ∈ Q of r⋅q such that U(q,z,≽) ≥ u
�(I,r,z,≽)
V                              � ≡ 𝐼𝐼 + v� (𝐼𝐼, 𝐫𝐫, 𝑧𝑧, ≽), a money-metric indirect utility function, the maximum of
                               V
                               U(q,z,≽) subject to the budget constraint r∙q ≤ I

𝒱𝒱(Im ,pm,rm,zm,≽)                           �(Im – pjm,rm,zjm,≽) unconditional maximum utility in scenario m
                               𝒱𝒱 = maxj∈𝐉𝐉m V
�
Pk(I,pm,rm,zm,s)               The probability that choice k in scenario m attains maximum utility 𝒱𝒱
xjm = X(I – pjm,rm,zjm)        A finite-dimensional vector of predetermined functions
v�𝐼𝐼m − 𝑝𝑝jm , 𝐫𝐫, 𝑧𝑧jm , ≽�   v = xjmβ with I = Im, parameters β = β(≽), an approximation to v� �𝐼𝐼m − 𝑝𝑝jm , 𝐫𝐫, 𝑧𝑧jm , ≽�

V(Im – pjm,r,zjm,≽)                                                          � with additive EV1 “noise”, σ = σ(≽)
                               V = 𝐼𝐼m − 𝑝𝑝jm + xjm β + σεj approximation to V
Pk(I,pm,r,zm,s)                Pkm = Eβ|s exp(
                                                 xkm β−𝑝𝑝km    Jm
                                                            )/∑j=0
                                                                       xjm β−𝑝𝑝jm
                                                                   exp( σ         )   MMNL approximation to �
                                                                                                            Pk(I,pm,r,zm,s)
                                                      𝜎𝜎




                                                                   7
   Suppose consumers face scenarios m = a,b, and a universe of possible discrete alternatives indexed by a finite
set J ≡ {0,…,J}. Let Jm ⊆ J denote the set of alternatives available in the market under policy m, with |Jm| elements,
and characterize then by real prices pjm in a compact interval P = [0,pU] with pU > 0, and observed hedonic attributes
zjm in a compact finite-dimensional set Z. Let pm and zm denote the vectors of pjm and zjm for j ∈ Jm. Assume that
there are alternatives that are always available and are unaffected by policy, including ordinarily “no purchase”
alternatives that by convention are assigned zero price and attributes. Market goods supplied in continuous
quantities are described by commodity vectors q ⊆ Q = [0,qU] with 0 ≪ qU, a bounded rectangle in n-dimensional
space, with real market prices r ∈ R = [rL,rU], a commensurate bounded rectangle with 0 ≪ rL ≪ rU. We assume
that Z is a finite union of disjoint rectangles; this avoids technical complications and covers applications where
measured attributes either vary continuously in some interval or take on a finite number of discrete levels.

   Assume that consumers are characterized by a vector s of observed demographics and history, and by real
income Im in a bounded interval [IL,IU]. In many applications, Ia = Ib, but if changing from scenario a to scenario b
entails an allocated net production cost or fulfilled transfer assessed as a lump sum net tax, then Ia and Ib will differ
by the net amount. A consumer’s market opportunities under policy m are summarized in prices rm ∈ R, and for j
∈ Jm, attributes zjm ∈ Z and prices pjm ∈ P, giving the budget constraint rm∙q ≤ Im – pjm for vectors q ∈ Q when a
product j from Jm is chosen. Let qA ∈ Q denote a vector that bounds all affordable vectors (i.e., rL∙q ≤ IU implies q
≪ qA) and define Q’ = [0,qA]. Let z denote the vector of attributes and p the vector of prices for the discrete
alternatives in J, and let zm and pm denote their subvectors for the available alternatives in Jm.We adopt a
description of consumers that is sufficiently flexible to encompass neoclassical preference maximization and some
behavioral deviations, and can be made empirically tractable. Assume that consumers have complete transitive
reflexive preference preorders ≽ over vectors (q,z) ∈ Q×Z ≡ W, that these preorders are predetermined and
invariant with respect to current market opportunities, and that consumers are preference maximizers. Later, we
consider the implications for identification of preferences and the welfare calculus when these neoclassical
assumptions are relaxed. A preference preorder ≽ is described by the non-empty set of pairs ((q’,z’),(q”,z”)) ∈
W×W that satisfy (q’,z’) ≽ (q”,z”). Let H ⊆ 2W×W denote the field of preference preorders of consumers in the
population. We will assume that preferences for continuous goods are monotonic (i.e., q’ ≥ q” ⟹ q’ ≽ q”), and
that qU is sufficiently large and continuous goods are sufficiently desirable so that they can substitute for any
affordable (q,z); i.e., (qU,z0a) ≽ (qA,z) for all z ∈ Z and ≽ ∈ H.. We use the notation “≻” for strict preference and the
notation “∼” for indifference. We use the Euclidean norm on Q, R, and Z; e.g., ‖𝐪𝐪‖ = �𝐪𝐪 ∙ 𝐪𝐪 for q ∈ Q.

   For non-empty subsets A,B of the metric space W×W, define the Hausdorff distance h(A,B) to be the greatest
lower bound of positive scalars η such that each set is contained in an η-neighborhood of the other; i.e., if Nη(A)

                                                             8
denotes the union of the open balls of radius η centered at the points in A, then h(A,B) is the greatest lower bound
of η satisfying B ⊆ Nη(A) and A ⊆ Nη(B). The set W×W is compact, so h is bounded, and if A,B ∈ W×W are closed,
then h(A,B) = 0 if and only if A = B. If the sets in H are all closed, then h is a metric on H termed the Hausdorff set
metric, and H is precompact in its metric topology. We make a series of assumptions on preferences and budgets,
beginning with a basic assumption on continuity of preferences:

    A1. If a sequence of preorders ≽i ∈ H+ and sequences of consumption vectors (w’i,w”i) ∈ G(≽i) satisfy
h(G(≽i),G(≽0)) → 0, w’i → w’0, and w”i → w”0, then G(≽0) ∈ H and (w’0,w”0) ∈ G(≽0).

    Since our attention is primarily on discrete choice, we will make strong and simple assumptions on continuous
good preferences. Fix baseline values (ra,za) ∈ R×Z. For (q,z) ∈ Q×Z and ≽ ∈ H, define A(q,z,≽) = {q’∈Q|(q’,za) ≽
(q,z)}, the set of continuous commodity vectors q’ ∈ Q that combined with “benchmark” attributes za are at least
as good as (q,z). We will assume for q ∈ Q’ that qU ∈ A(q,z,≽), so this set is non-empty. Assumption A1 implies
that A(q,z,≽) is compact, and if q’,q” ∈ Q’, z’,z” ∈ Z, and (q’,z’) ≻ (q”,z”), then A(q’,z’,≽) is contained in the interior
of A(q”,z”,≽). Assumption A2 strengthens our monotonicity requirement for continuous goods and imposes
Lipschitz continuity conditions on preferences. Let hQ(A’,A”) denote the Hausdorff distance between non-empty
subsets A’,A” ⊆ Q. If A’ ⊆ A”, then hQ(A’,A”) ≡ inf{η > 0|A" ⊆ Nη (A′)}. Assumptions A1 and A2 do not impose
any convexity condition on preferences, but do require that the open quadrant to the northeast of any point in
A(q,z,≽) is contained in the interior of this set.

    A2. For q’,q” ∈ Q, z’,z” ∈ Z, and ≽’,≽” ∈ H, q” ≪ q’ implies (q’,z’) ≻’ (q”,z’). If q ∈ Q’, then (qU,za) ≽’ (q,z’).
There exist scalars α, δ > 0 such that (i) (q’,z’) ~’ (q”,z”) implies hQ(A(q’,z’,≽’),A(q”,z”,≽”)) ≤ α∙h(≽’,≽”), (ii)
hQ(A(q’,z’,≽’),A(q”,z”,≽”)) ≤ α∙(|q’ – q”| + |z’ – z”| + h(≽’,≽”)), and (iii) (q’,z’) ≻’ (q”,z”) implies
     inf           sup{η > 0 | Nη (q) ⊆ A(𝐪𝐪”, 𝑧𝑧", ≽ ′)} ≥ δhQ(A(q’,z’,≽’),A(q”,z”,≽’)).
𝐪𝐪∈A(𝐪𝐪′,𝑧𝑧′,≽′)


     For each ≽, the A(q,z,≽) are “at least as good as” sets whose boundaries define contours in Q, as illustrated
in Figure 2. The Lipschitz continuity conditions (i) and (ii) rule out precipitous changes in A(q,z,≽) when (q,z,≽)
changes. Let ∆ denote the difference in elevation of the contours on some (arbitrary) scale. The line between
boundary points in the upper contour sets A’ = A(q’,z’,≽) and A” = A(q”,z”,≽) that achieves their Hausdorff distance
gives the lowest slope between them, ∆/hQ(A’,A”), while the highest slope is bounded by ∆/δhQ(A’,A”), where δ is
the lower bound given by (iii). Then condition (iii) rules out “local cliffs” by bounding the ratio of the highest
slope to the lowest slope as two contours converge. Preferences on a compact set that are representable by
absolutely continuous utility functions with gradients that are bounded positive and finite satisfy the Lipschitz



                                                                    9
continuity condition. The utility function in ℝ2 satisfying u = q1 – �1 − q 2 for 0 ≤ q2 ≤ 1 and u = q1 + �q2 − 1 for
q2 > 1 is an example that has a local cliff and fails to satisfy the condition at q2 = 1.



                     Figure 2. Lowest and Highest Slopes between Contours




                                                      “lowest slope”
                                                        = ∆/hQ(A’,A”)


                                                       “highest slope”
                                                       ≤ ∆/δhQ(A’,A”)


                                                                         A’
                                                                                       difference ∆
                                                                    A”
                                                                                       in elevation



    A last assumption confirms that income is in a range where consumer budgets are limiting but nevertheless
allow choice of any available discrete alternative, and all affordable q are in Q’:

    A3. The consumption vector (0,z) is affordable for each z ∈ Z (i.e., IL > pU), and q ∈ Q and rL∙q ≤ IU ⟹ q ∈ Q’.

We next establish that A1-A3 are sufficient to guarantee well-behaved representations of preferences by utility,
expenditure, and indirect utility functions.

    Lemma 2.1. If A1, then each G(≽) ∈ H is a compact set, and H is a compact metric space with metric h.

Proof: For fixed ≽, A1 establishes that G(≽) is a non-empty closed subset of the compact space W×W. The
properties of h and H are given in Aliprantis and Border (2006, Sections 3.16-3.18), particularly Definition 3.70,
Theorem 3.85, and Corollary 3.95. ∎

    Lemma 2.2. Suppose A1 and A2, (q’,z’), (q”,z”) ∈ Q’×Z, ≽ ∈ H, and (q’,z’) ≻ (q”,z”). Let δ denote the bound
from A2, 1 denote a vector of ones, and γ = hQ(A(q’, z’,≽),A(q”, z”,≽)). If q’* is in the boundary of A(q’,z’,≽), q”*
is in the boundary of A(q”,z”,≽), and r ∈ R, then q’* – γδr/‖𝐫𝐫‖ ∈ A(q”,z”,≽) and q”* + γ1 ∈ A(q’,z’,≽).




                                                              10
Proof: By A2, all points in a neighborhood of q’* with radius γδ are contained in A(q”,z”,≽), giving the first result.
If q”* + γ1 ∉ A(q’,z’,≽), then no point within radius γ of q”* is in A(q’,z’,≽), contradicting the definition of γ as the
Hausdorff distance. ∎

      The next result uses the expenditure at baseline continuous good prices needed to achieve the level of
satisfaction of a given vector of goods to define a well-behaved (i.e., bi-Lipschitz) utility function.

      Theorem 2.3. Suppose A1 and A2. For each (q,z) ∈ Q’×Z and ≽ ∈ H, define

(5)     U(q,z,≽) = min{ra∙q’ | q’ ∈ A(q,z,≽)}.

Then, U is a continuous direct utility function on Q’×Z×H; i.e., U is continuous in its arguments and U(q’,z’,≽) ≥
U(q”,z”,≽) ⟺ (q’,z’) ≽ (q”,z”). Further, U is locally non-satiated with a range U(Q’,z,≽) contained in the bounded
interval [0,ra∙qU], is Lipschitz in (q,z,≽), and is bi-Lipschitz in A = A(q,z, ≽); i.e., there exist scalars αU, λU > 0 such
that q’,q” ∈ Q’ and z’,z” ∈ Z imply

          ℎQ (A(𝐪𝐪’, 𝑧𝑧’, ≽), A(𝐪𝐪”, 𝑧𝑧”, ≽)) ∙ λU ≥ |U(𝐪𝐪’, 𝑧𝑧’, ≽) – U(𝐪𝐪”, 𝑧𝑧”, ≽)| ≥ ℎQ (A(𝐪𝐪’, 𝑧𝑧’, ≽), A(𝐪𝐪”, 𝑧𝑧”, ≽))/λU
(6)                                                                                                                               .
                       |U(𝐪𝐪’, 𝑧𝑧’, ≽ ′) – U(𝐪𝐪”, 𝑧𝑧”, ≽ ")| ≤ 𝛼𝛼𝑈𝑈 ∙ (|𝐪𝐪’ – 𝐪𝐪”| + | 𝑧𝑧’ – 𝑧𝑧”| + ℎ(≽′ , ≽ "))

Proof: A1 and A2 imply that A(q,z,≽) is non-empty and closed, hence compact, so (5) is well-defined. Suppose
(q’,z’) ≽ (q”,z”). If (q,za) ∈ A(q’,z’,≽), then (q,za) ≽ (q’,z’) and transitivity implies (q,za) ≽ (q”,z”), and hence (q,za)
∈ A(q”,z”,≽). Therefore, ra⋅q ≥ U(q”,z”,≽), and hence U(q’,z’,≽) ≥ U(q”,z”,≽). A1 implies that U is continuous in
its arguments. In particular, U is sequentially continuous in ≽ in the Hausdorff metric topology on H, or
equivalently the topology of closed convergence.

      If q*’ ∈ argmin{ra∙q | q ∈ A(q’,z’,≽)} and q*” ∈ argmin{ra∙q | q ∈ A(q”, z”,≽)}, then U(q’, z’,≽) – U(q”, z”,≽) =
ra⋅(q*’ – q*”).                                                                       �" = 𝐪𝐪∗ ’ − δγ𝐫𝐫a /‖𝐫𝐫a ‖ ∈
                     Let γ ≡ hQ(A(q’,z’,≽),A(q”,z”,≽)). Lemma 2.2 with r = ra implies 𝐪𝐪
                   �′ = 𝐪𝐪∗ " + γ𝟏𝟏 ∈ A(𝐪𝐪′, 𝑧𝑧’, ≽). Then ra⋅(q*’ – 𝐪𝐪
A(𝐪𝐪”, 𝑧𝑧”, ≽) and 𝐪𝐪                                                                                          �′ − q*”)
                                                                     �") = 𝛿𝛿𝛿𝛿‖𝐫𝐫a ‖ ≤ ra⋅(q*’ – q*”) and ra⋅(𝐪𝐪
= γra∙1 ≥ ra⋅(q*’ – q*”). Defining λU = max(ra∙1,1/δ‖𝐫𝐫a ‖), this gives the first row of (6). Then, the first Lipschitz
condition in A2 gives the second inequality in (6),

      |U(𝐪𝐪’, 𝑧𝑧’, ≽) – U(𝐪𝐪”, 𝑧𝑧”, ≽)| ≤ λUhQ(A(q’,z’,≽),A(q”,z”,≽)) ≤ λUα∙(|q’ – q”| + | z’ – z”| + h(≽’,≽”)). ∎




                                                                  11
      Theorem 2.4. Suppose A1 and A2, and U:Q’×Z×H → [0,ra∙qU] from (5). For each (r,z) ∈ R×Z, ≽ ∈ H, and u ∈
U(Q’,z,≽), define

(7)        M(u,r,z,≽) = minq’∈Q’{r∙q’ | U(q’,z,≽) ≥ u}.

Then M is an expenditure function that is continuous in its arguments, and concave, linear homogeneous, and
non-decreasing in r. Further, M satisfies M(u,ra,za,≽) ≡ u, is Lipschitz in (r,z,≽), and is bi-Lipschitz and increasing
in u; i.e., there exists scalars αM, λM > 0 such that (r’,z’,≽’), (r”,z” ,≽”) ∈ R×Z×H and u’,u” ∈ U(Q’,z,≽) with u’ ≥ u”
imply

                   (u’ – u”)λM ≥ M(u′, 𝐫𝐫′, 𝑧𝑧′, ≽ ′) – M(u”, 𝐫𝐫′, 𝑧𝑧′, ≽ ′) ≥ (u’ – u”)/λM
(8)                                                                                                     .
           |M(u′, 𝐫𝐫 ′ , 𝑧𝑧′, ≽ ′) – M(u′, 𝐫𝐫", 𝑧𝑧", ≽ ")| ≤ αM ∙ (|rʹ − r"| + |𝑧𝑧′ − z"| + ℎ(≽′ , ≽ "))

Proof:    Mas-Colell, Whinston, and Green (1995, Proposition 3E2) demonstrate that M is concave, linear
homogeneous, and non-decreasing in r. The continuity of M in its arguments follows from the Berge Maximum
Theorem (Aliprantis and Border, 2006, Theorem 17.31). Suppose (r’,z’,≽’), (r”,z”,≽”) ∈ R×Z×H, and u’ ≥ u”.
Consider q*’ ∈ argmin {r’⋅q | U(q,z’,≽’) ≥ u’} and q*” ∈ argmin {r’⋅q | U(q,z’,≽’) ≥ u”}.                                  Let γ =
hQ(A(𝐪𝐪∗ ′,z’,≽),A(𝐪𝐪∗ ”,z’,≽)). From Lemma 2.2, 𝐪𝐪
                                                 �" = 𝐪𝐪∗ ’ − δγ𝐫𝐫/‖𝐫𝐫‖ ∈ A(𝐪𝐪∗ ”, 𝑧𝑧′, ≽ ′) and q�′ = 𝐪𝐪∗ " + γ𝟏𝟏 ∈
A(𝐪𝐪∗ ′, 𝑧𝑧′, ≽ ′), so that r⋅(q*’ – 𝐪𝐪                                                                              �′ − q*”)
                                     �") = 𝛿𝛿𝛿𝛿‖𝐫𝐫‖ ≤ r⋅(q*’ – q*”) = M(u′, r′, 𝑧𝑧′, ≽ ′) – M(u”, r′, 𝑧𝑧′, ≽ ′) ≤ r⋅(𝐪𝐪
= γr∙1. This establishes the first row inequality in (8) with λM = λU max(rU∙1 , 1/𝛿𝛿�𝐫𝐫 L �).

      Next consider q*’ ∈ argmin 𝐫𝐫′ ∙ 𝐪𝐪 and q*” ∈ argmin 𝐫𝐫" ∙ 𝐪𝐪, and define γ = hQ(A(𝐪𝐪∗ ",z”,≽”),A(𝐪𝐪∗ ”,z’,≽’))
                            U(𝐪𝐪,z′≽′)≥u′                   U(𝐪𝐪,𝑧𝑧",≽")≥𝑢𝑢′

≤ α(|z’ – z”| + h(≽’,≽”)). Then, A(q*’,z’,≽’) = A(q*”,r”,≽’). If M(u′ , 𝐫𝐫 ′ , 𝑧𝑧 ′ , ≽′ ) > M(u′, 𝐫𝐫", 𝑧𝑧", ≽ ′), then q*” + γ1
∈ A(𝐪𝐪∗ ”,z’,≽’), implying M(u′ , 𝐫𝐫 ′ , 𝑧𝑧 ′ , ≽′ ) − M(u′, 𝐫𝐫", 𝑧𝑧", ≽ ′) ≤ γr’∙1 + |(r” – r’)∙q*”| ≤ �𝐫𝐫 U �α(|z’ – z”| + h(≽’,≽”))

≤ |r” – r’|∙�𝐪𝐪U � + �𝐫𝐫 U �α(|z’ – z”| + h(≽’,≽”)), proving the second row in (8) with αM = max(�𝐪𝐪U �, �𝐫𝐫 U �α). ∎


      Theorem 2.5. Suppose A1-A3 and U:Q’×Z×H → [0,ra∙qU] from (5). For I ∈ [IL–pU,IU], r ∈ R, z ∈ Z, and ≽ ∈ H,
define a money-metric indirect utility function

(9)      V(I,r,z,≽) ≡ maxq∈Q’{U(q,z,≽) | r∙q ≤ I}

satisfying V(I,ra,za,≽) ≡ I that is continuous in its arguments with a range contained in the bounded interval
[0,ra∙qU], is quasi-convex and homogeneous of degree zero in (I,r), is non-increasing in r, is Lipschitz in (r,z,≽), and




                                                                    12
is bi-Lipschitz increasing in I; i.e., there exist scalars αV ≥ ra∙qU and λV > 0 such that I’ > I”, r’,r” ∈ R, z’,z” ∈Z, and
≽’,≽” ∈ H imply

                        λV (𝐼𝐼’ – 𝐼𝐼”) ≥ V(𝐼𝐼’, 𝐫𝐫′, 𝑧𝑧′, ≽ ′) – V(𝐼𝐼”, 𝐫𝐫′, 𝑧𝑧′, ≽ ′) ≥ (𝐼𝐼’ – 𝐼𝐼”)/λV
(10)                                                                                                                 .
             |V(𝐼𝐼’, 𝐫𝐫′, 𝑧𝑧′, ≽ ′) – V(𝐼𝐼”, 𝐫𝐫", 𝑧𝑧", ≽ ")| ≤ αV (|𝐼𝐼’ – 𝐼𝐼”| + |𝐫𝐫 ′ − 𝐫𝐫|+|z'-z| + ℎ(≽′ , ≽ "))

Further, V(I,r,z,≽) is twice continuously differentiable in (I,r) except on a set of measure zero, and continuous good
demands are almost everywhere in (I,r) single-valued and continuously differentiable, and satisfy Roy’s identity,
                            ∂V(𝐼𝐼 ,𝐫𝐫,𝑧𝑧,≽)/∂𝐫𝐫
q = D(𝐼𝐼 , 𝐫𝐫, 𝑧𝑧, ≽) ≡ –                       .
                            ∂V(𝐼𝐼 ,𝐫𝐫,z,≽)/∂𝐼𝐼


Proof: Theorem 2.3 implies that U is continuous in its arguments, and A3 assures that the budget set for q is a
non-empty subset of Q’ for all discrete choices. Then, (9) is well-defined. Local non-satiation from A2 implies that
V is the inverse with respect to u of I = M(u,r,z,≽); see Mas-Colell, Whinston, and Green (1995, Propositions 3D3
and 3E1). Result (8) then implies the first row of (10) with λV = λU. The continuity of M in its arguments from
Lemma 2 and the bi-Lipschitz condition (8) imply V is continuous in its arguments and Lipschitz-continuous in
(r,z,≽). It is immediate from the properties of M that V is homogeneous of degree zero in (I,r), and non-increasing
in r. Consider budgets (Ii,ri) for i = 0,1 and (I𝜃𝜃,r𝛉𝛉) = θ(I0,r0) + (1-θ)(I1,r1) for θ ∈ (0,1), and let q* denote a maximand
of (5) subject to the budget (I𝜃𝜃,r𝛉𝛉). Then V(I𝜃𝜃,r𝛉𝛉,z,≽) = U(q*,z,≽). But r𝛉𝛉⋅q* ≤ I𝜃𝜃 implies either or both r0⋅q* ≤ I0 or
r1⋅q* ≤ I1, and therefore either V(I0,r0,z,≽) = U(q*,z,≽) or V(I1,r1,z,≽) = U(q*,z,≽), so that V is quasi-convex:
V(I𝜃𝜃,r𝛉𝛉,z,≽) ≤ max{ V(I0,r0,z,≽), V(I1,r1,z,≽)}. From the definition of quasi-convexity, there exists an increasing
transformation ψ such that such that ν(I,r,z,≽) = ψ(V(I,r,z,≽)) is a convex function of (I,r). Results of Rademacher
(1919) and Alexandrov (1939) establish that since ν(I,ra,za,≽) ≡ ψ(I) is convex in I, ψ is bi-Lipschitz on (IL–pU,IU),
continuously differentiable in I except possibly on a countable set, and almost everywhere twice continuously
differentiable in I. Then, ψ-1(v) is also bi-Lipschitz and increasing, and hence continuously differentiable except on
a countable set. This implies that V(I,r,z,≽) = ψ-1(ν(I,r,z,≽)) is increasing and bi-Lipschitz in I, and hence
continuously differentiable in I except for a countable set, and almost everywhere twice continuously
differentiable in (I,r). Then the Roy (1947) identity applied to ν(I,ra,z,≽), or equivalently to V(I,r,z,≽), establishes
that continuous good demands are almost surely single-valued and continuously differentiable in (I,r). ∎




                                                                      13
    Lemma 2.6. Suppose A1-A3, the direct utility function U(q,z,≽) from (5), and its associated money metric
indirect utility function V(I,r,z,≽) from (9). For q ∈ Q’, define U*(q,z,≽) = min V(𝐫𝐫 ⋅ 𝐪𝐪, 𝐫𝐫, 𝑧𝑧, ≽). Then U*(q,z,≽) is
                                                                                      𝐫𝐫∈R

quasi-concave and R-monotone , U*(q,z,≽) ≥ U(q,z,≽), with equality if for some r ∈ R, the conditions q’ ∈ Q’ and
                                       4


r∙q’ ≤ r∙q imply U(q’,z,≽) ≤ U(q,z,≽).                    Then, U and U* are observationally equivalent; i.e., V(I,r,z,≽) ≡
maxq∈Q’{U*(q,z,≽) | r∙q ≤ I} and the continuous good demands from maximization of U and U* subject to the
budget constraint r∙q ≤ I coincide except on a set of (I,r) of measure zero.

Proof: V(𝐫𝐫 ⋅ 𝐪𝐪, 𝐫𝐫, 𝑧𝑧, ≽) = max{U(q’,z,≽) | r∙q’ ≤ r∙q} ≥ U(q,z,≽)} implies U*(q,z,≽) ≥ U(q,z,≽). Suppose for some r
∈ R, the conditions q’ ∈ Q’ and r∙q’ ≤ r∙q imply U(q’,z,≽) ≤ U(q,z,≽), so that q’ is a maximand of U subject to this
budget constraint. Then U*(q,z,≽) ≤ V(r∙q,r,z,≽) ≤ U(q,z,≽). Hence, U and U* are observationally equivalent.
Suppose q0,q1 ∈ Q’ and qθ = θq0 + (1-θ)q1 for θ ∈ (0,1), and let rθ ∈ R be such that U*(qθ,z,≽) = V(rθ∙qθ,rθ,z,≽). Since
rθ∙qθ ≥ min{rθ∙q0,rθ∙q1}, U*(qθ,z,≽) = V(rθ∙qθ,rθ,z,≽) ≥ min{V(rθ∙q0,rθ,z,≽), V(rθ∙q1,rθ,z,≽)} ≥ min{U*(q0,z,≽),
U*(q1,z,≽)}, so U* is quasi-concave in q. Suppose r∙q” > r∙q’ for all r ∈ R. Then there exists r” satisfying U*(q”,z,≽)
= V(r”∙q”,r”,z,≽) > V(r”∙q’,r”,z,≽) ≥ U*(q’,z,≽), so U* is R-monotone. ∎

       Let V(I – pjm,rm,zjm,≽) denote the indirect utility function from (9) for discrete alternative j with attributes zjm,
price pjm, and income I – pjm remaining for purchase of continuous goods. The consumer who chooses j ∈ Jm and
q ∈ Q to maximize utility subject to the budget constraint rm∙q + pjm ≤ I then achieves unconditional indirect utility

(11)         u = 𝒱𝒱(𝐼𝐼, 𝐩𝐩m , 𝐫𝐫m , 𝐳𝐳m , ≽) ≡ max V(𝐼𝐼 – 𝑝𝑝jm , 𝐫𝐫m , 𝑧𝑧jm , ≽) .
                                                  j∈𝐉𝐉m


Associated with (11) is an unconditional expenditure function I = ℳ(u,pm,rm,zm,≽) obtained as an implicit solution
of (11), or equivalently as

(12)         I = ℳ(u,pm,rm,zm,≽) ≡ min[M�u, 𝐫𝐫m , 𝑧𝑧jm , ≽� + 𝑝𝑝jm ] .
                                           j∈Jm


Theorems 2.4 and 2.5 imply that ℳ is bi-Lipschitz increasing in u and 𝒱𝒱 is bi-Lipschitz increasing in I.

    Next characterize the choices and demands that achieve (11). For k ∈ Jm, and I ∈ [IL,IU], pm ∈ P|Jm | , zm ∈ Z|𝐉𝐉m | ,
and rm ∈ R, define the set of preferences that make alternative k uniquely optimal,

(13)        Hk(I,pm,rm,zm) = {≽∈H | V(I – pkm,rm,zkm,≽) > V(I – pjm,rm,zjm,≽) for j ∈ Jm\{k}}




4
 A function u(q) is quasi-concave if 0 < θ < 1 implies u(θq’+(1-θ)q”) ≥ min(u(q’),u(q”)), and is R-monotone if r∙q’ ≥ r∙q” for
all r ∈ R implies u(q’) ≥ u(q”).

                                                                       14
and let H#(I,pm,rm,zm) = ⋃k∈𝐉𝐉m Hk (𝐼𝐼, 𝐩𝐩m , 𝐫𝐫m , 𝐳𝐳m ) denote the set of all preferences that result in a unique utility-
maximizing choice. For ≽ ∈ H#(I,pm,rm,zm), choice is indicated by


(14)        δk(𝐼𝐼, 𝐩𝐩m , 𝐫𝐫m , 𝐳𝐳m , ≽) = 𝟏𝟏Hk(𝐼𝐼,𝐩𝐩m ,𝐫𝐫,𝐳𝐳m) (≽) ≡ � 1     if ≽ ∈ H k (𝐼𝐼, 𝐩𝐩m , 𝐫𝐫m , 𝐳𝐳m ) ,
                                                                       0           otherwise

and using Theorem 2.5 and Roy’s identity, continuous good demands are given for almost all (I,r) by

                                                                           ∂V(𝐼𝐼 – 𝑝𝑝km ,𝐫𝐫m ,𝑧𝑧km ,≽)/∂𝐫𝐫
(15)        D(I,pm,rm,zm,≽) = – ∑k∈𝐉𝐉m δk (𝐼𝐼, 𝐩𝐩m , 𝐫𝐫m , 𝐳𝐳m , ≽) ∙                                        .
                                                                           ∂V(𝐼𝐼 – 𝑝𝑝km ,𝐫𝐫m ,𝑧𝑧km ,≽)/∂𝐼𝐼


    In applications, the preferences ≽ in (9) are unobserved and are heterogeneous across consumers. Limited
observations on the market choices of a single consumer allow only partial identification of preferences,
insufficient to estimate (9) with precision. Therefore we treat preferences as a “random effect” in (9), with a
probability FH(∙|s) on the field of preferences H whose salient features we can hope to identify from market data.
Our final preference assumption is that preference heterogeneity is almost surely sufficient to break ties:

       A4. FH(H#(I,pm,rm,zm)|s) ≡ 1 for (I,pm,rm,zm) ∈ [IL,IU]×P Jm +1×R×ZJm +1 and s ∈ S.

This assumption can be restated as a probabilistic transversality condition that the distribution of the vector of
indirect utilities for the various alternatives is of full dimension and absolutely continuous; see Shannon (2006).
Given Assumption A4, the discrete alternatives k ∈ Jm, are chosen with probabilities

(16)        Pk(I,pm,rm,zm,s) = FH(Hk(I,pm,rm,zm)|s) ≡ ∂𝐄𝐄≽|𝑠𝑠 𝒱𝒱(𝐼𝐼, 𝐩𝐩m , 𝐫𝐫m , 𝐳𝐳m , ≽)/ ∂vjm ,

with the last form of (16) coming from the interpretation of E≽|s𝒱𝒱(I,pm,rm,zm,≽) as a Choice-Probability-Generating-
Function (CPGF) with vjm ≡ V(I – pjm,rm,zjm,≽) for j ∈ Jm as arguments; see Fosgerau, McFadden, and Bierlaire
(2013). 5 The conditional probability of continuous good demand in a measurable set B ⊆ Q, given choice k, is
FH({≽ ∈ Hk(I,pm,rm,zm) | s,D(I,pm,rm,zm,≽) ∈ B})/Pk(I,pm,rm,zm,s), and the conditional probability of ≽ given choice k
satisfies FH(A|s,k) = FH(A∩Hk(I,pm,rm,zm)|s)/Pk(I,pm,rm,zm,s) for measurable A ⊆ H.

    For welfare applications, the representation in (9) and (11) of a population preference field satisfying
Assumptions A1-A4 has to be translated into a system that is practical for estimation and calculation. One
approach is direct non-parametric estimation of 𝐄𝐄≽|𝑠𝑠 𝒱𝒱(𝐼𝐼, 𝐩𝐩m , 𝐫𝐫m , 𝐳𝐳m , ≽) using the property (16) that its gradient



5
 When E≽|s(I,pm,rm,zm,≽) is additively linear in income, the CPGF coincides with the social surplus function introduced by
McFadden (1981). The greater generality of the CPGF comes from recognizing that treating the vjm as linear perturbations
of utility gives the gradient property even when real income is not linear and additive in the indirect utility function.

                                                                           15
equals the vector of choice probabilities; see Bhattacharya (2015, 2017). This approach can be sharpened by using
the Lipschitz properties of (11) and adapting the Hall and Yachew (2007) method for nonparametric estimation of
a function and its derivatives. A limitation of a fully nonparametric approach is that its regularities are local, so
that it has difficulty predicting consumer outcomes when policies require non-local extrapolation. A second
approach to practical analysis is the method of sieves, utilizing a net of finite-parameter approximations to the
consumer preference field. Advantages of this approach are that it requires at an entry level only the finite-
parameter methods and software employed in traditional applied economics, and that it is relatively easy to
impose structural restrictions that support plausible policy extrapolation. In this paper, we provide a foundation
for this second approach by showing that the field of indirect utility functions (9) with the properties given by
Assumptions A1-A4 can be approximated uniformly by a practical finitely-parameterized family, with random
parameters in the population that have a finitely parameterized distribution. Then, this family can be estimated
from observed choices in sufficiently rich arrays of market environments faced by samples of consumers, and the
estimated family can be used to carry out welfare calculations with no essential loss of generality.

                                    �(I,rm,zjm,≽) for (I,rm,zjm,≽) ∈ [IL–pU,IU]×R×Z×H denote the true indirect
    Theorem 2.7. Suppose A1-A4. Let V
                                                                               �(I – pjm,rm,zjm,≽) – I on [IL,IU]×[0,pU]×R×Z×H.
utility function from Theorem 2.5, and define v� �𝐼𝐼, 𝑝𝑝jm , 𝐫𝐫m , 𝑧𝑧jm , ≽� ≡ V
Given a small scalar γ ∈ (0,1), there exists a bound η = - ln(γ/4|Jm|); a vector of predetermined twice continuously
differentiable functions X:[IL–pU,IU]×R×Z ⟶ ℝN drawn from a Schauder basis 6 for the space ℭ([IL–pU,IU]×R×Z); a
commensurate vector of Lipschitz-continuous real functions β from a compact subset ℬ ⊆ ℭ(H,ℝN), and a
Lipschitz-continuous real function σ:H ⟶ [σL,σU] from a compact subset 𝒮𝒮 ⊆ ℭ(H,[σL,σU]) with σL > 0 and σU <
γ/2η; and independent standard type I extreme value (EV1) distributed random variables εj such that:

    (i) There is an approximate indirect utility function 7

(17)        V(I – pjm,rm,zjm,β,σ,εj) = I + v(I,pjm,rm,zjm,β) + σεj




6
  A Schauder basis may be polynomials, Fourier series, or other series of functions that span the space of continuous
functions on a compact finite-dimensional space. The basis may be tailored to reduce the number of terms required to
achieve a given tolerance.
7
 The approximation V is not guaranteed to satisfy the slope and curvature properties of V    �, but at each point where V� is
twice continuously differentiable with non-zero slopes and a non-singular (bordered) hessian, the approximation V for a
sufficiently small tolerance γ will also have these properties and preserve signs, and hence locally have the same slope and
curvature properties as V �.

                                                                16
    on [IL–pU,IU]×R×Z×ℬ×𝒮𝒮×ℝ with v(I,pjm,rm,zjm,β) ≡ X�𝐼𝐼 – 𝑝𝑝jm , 𝐫𝐫m , 𝑧𝑧jm � ⋅ β − 𝑝𝑝jm such that |v� (I,pjm,rm,zjm,≽) –
    v(I,pjm,rm,zjm,β(≽))| < γ uniformly. Further, in the event C = {ε | |εj| ≤ η for j ∈ J} that has Prob(C) > 1 – γ/2,
     �(I,rm,zjm,≽) – V(I,rm,zjm,β(≽),σ(≽),εj)| < γ uniformly.
    |V

    (ii) Suppose δ�km (𝐼𝐼, ≽) ≡ δ�k(𝐼𝐼, 𝐩𝐩m , 𝐫𝐫m , 𝐳𝐳m , ≽) is the choice indicator given by (14) for V
                                                                                                       �, and let δkm (𝐼𝐼, β, σ) ≡
    δk(𝐼𝐼, 𝐩𝐩m , 𝐫𝐫m , 𝐳𝐳m , β, σ, 𝛆𝛆) be an indicator for the discrete alternative that maximizes V(I – pjm,rm,zjm,β,σ,εj) on Jm.
    Then except for ≽ and ε each in sets that have probability at most γ/3, δk(𝐼𝐼, 𝐩𝐩m , 𝐫𝐫m , 𝐳𝐳m , β(≽), σ(≽), 𝛆𝛆) =
    δ�k(𝐼𝐼, 𝐩𝐩m , 𝐫𝐫m , 𝐳𝐳m , ≽). Letting �   Pk (I,pm,rm,zm,s) denote the true discrete choice probability, from (16), and
                                                                        exp(vkm (𝐼𝐼,β)/𝜎𝜎 )                exp(vkm (𝐼𝐼,β)/𝜎𝜎 )
    Pk(Im,pm,rm,zm,s) = 𝐄𝐄δk (𝐼𝐼, 𝐩𝐩m , 𝐫𝐫m , 𝐳𝐳m , β, σ, 𝛆𝛆) ≡ Eβ,σ|s ∑                          ≡ ∫ℬ×𝒮𝒮 ∑                          F(dβ, dσ|𝑠𝑠),
                                                                       j∈𝐉𝐉m exp(vjm (𝐼𝐼,β)/𝜎𝜎)           j∈𝐉𝐉m exp(vjm (𝐼𝐼,β)/𝜎𝜎)
                                                                               �k(I,pm,r,zm,s) – Pk(I,pm,r,zm,s)| < γ.
    where vkm(I,β) ≡ X(𝐼𝐼, 𝐫𝐫m , 𝑧𝑧km ) ∙ β – 𝑝𝑝km , one then has, uniformly, |P

    (iii) Let F(A|s) ≡ FH({≽∈H|(β(≽),σ(≽)) ∈ A}|s) for Borel sets A ⊆ ℬ×𝒮𝒮 and s ∈ S, and let FT(A|s) denote the
    empirical probability obtained from T independent draws from F. Let ℱ1 denote the family of functions of the
    form (17) for j ∈ Jm, ℱ2 denote the family of functions formed as differences of the functions in ℱ1, and ℱ
    denote the family of functions of the form min(f1,…,fK) for fk ∈ ℱ2 and 1 ≤ K ≤ |J|, plus the function f ≡ 1. Let
    𝒦𝒦 denote the family of functions exp(v(I,pjm,rm,zjm,β)/σ)/∑i∈Jm exp(v(𝐼𝐼, pim , 𝐫𝐫m , zim , β)/σ) for v given in (17).
    Let ℐ denote the family of indicator functions i = 1(f>0) for f ∈ ℱ, and 𝒢𝒢 denote the family of functions of the
    form i∙f for i ∈ 𝒥𝒥 and f ∈ ℱ. Letting E𝛃𝛃,σ and E𝛃𝛃,𝛔𝛔,T denote expectation operators with respect to F and FT
    respectively, there exists T such that Prob( sup      sup |(𝐄𝐄T′ − 𝐄𝐄)f| > 𝛾𝛾/3) < γ/3.
                                                          T′ ≥ T f∈ℱ∪𝒦𝒦∪ℐ∪𝒢𝒢

             � (I,pm,rm,zm,≽) and D(I,pm,rm,zm,β,σ,ε) denote the continuous good demands given by (15) for the
    (iv) Let D
    indirect utility functions V � and V respectively. If on a closed subset A of [IL–pU,IU]×R×Z, V is continuously
    differentiable in (I,r), then X can be selected with a sufficient number of terms so that on the set A and except
    for sets of ≽ and ε that each have probability at most γ/3, |𝐷𝐷    � (I,pm,rm,zm,≽) – D(I,pm,rm,zm,β(≽),σ(≽),εj)| < γ
    uniformly.

Proof: Let Hδ# (I,pm,rm,zm) = ⋃k∈𝐉𝐉m{≽∈ H |V                               ��𝐼𝐼 – 𝑝𝑝jm , 𝐫𝐫m , 𝑧𝑧jm , ≽� + δ for j ∈ 𝐉𝐉 & j ≠ k} for
                                           �(𝐼𝐼 – 𝑝𝑝km , 𝐫𝐫m , 𝑧𝑧km , ≽) > V
                                                                                                                       m

0 < δ ≤ γ. Then Hδ# (I,pm,rm,zm) ↘ H # (I,pm,rm,zm), and A4 implies that there exists δ(I,pm,rm,zm) > 0 such that
   #
F(Hδ(𝐼𝐼,𝐩𝐩                                                                  � on [IL–pU,IU]×R×Z×H implies there exists an open
                      (I,pm,rm,zm)|s) ≥ 1 – γ/2. Further, the continuity of V
          m ,𝐫𝐫,𝐳𝐳m )

                                                                                    #
neighborhood N(I,pm,rm,zm) in [𝐼𝐼 L , 𝐼𝐼 U ] × P|𝐉𝐉m | × R × Z|𝐉𝐉m | such that ≽ ∈ Hδ(𝐼𝐼,𝐩𝐩m ,𝐫𝐫,𝐳𝐳m )
                                                                                                       (I,pm,rm,zm) and (𝐼𝐼̃,𝒑𝒑
                                                                                                                             � m,𝒓𝒓�,𝒛𝒛�m) ∈
                        ��𝐼𝐼̃ – 𝑝𝑝� , 𝐫𝐫�, 𝑧𝑧�km , ≽� − max V
N(I,pm,rm,zm) imply max{V                                   �(𝐼𝐼̃ – 𝑝𝑝� , 𝐫𝐫�, 𝑧𝑧� jm , ≽)} > δ(𝐼𝐼, 𝐩𝐩m , 𝐫𝐫m , 𝐳𝐳m )/2 .      One can then
                          k∈𝐉𝐉m    km                          j≠k     jm


extract a finite family of these open neighborhoods that cover [𝐼𝐼 L , 𝐼𝐼 U ] × P|𝐉𝐉m | × R × Z |𝐉𝐉m | . Let δ0 > 0 denote the
                                                                                                               δ
minimum of the δ(I,pm,rm,zm) for this finite family and define a constant σ = σ(≽) ≡ 12η
                                                                                       0
                                                                                         . Recall that Z is a finite

union of disjoint rectangles. Combine each of these rectangles with the rectangular domains of income and prices,
shift and scale these rectangles so they form a unit cube, and apply Appendix Theorem A.1 to establish the
existence of a vector of multivariate polynomials v(I,rm,zjm,≽) ≡ X(𝐼𝐼, 𝐫𝐫m , 𝑧𝑧jm ) ⋅ β(≽) that satisfy |v� (I,rm,zjm,≽) –



                                                                           17
                   δ0
v(I,rm,zjm,≽)| <   12
                      ≤   γ. From the properties of EV1 variates, the event C has Prob(C) > 1 – γ/2, and if C, then |σεj |

< δ0/12. In the event C, V(I,rm,zjm,≽) given by (17), (i) is established by

         �(I,rm,zjm,≽) – V(I,rm,zjm,≽)| ≤ �v�𝐼𝐼, 𝐫𝐫m , 𝑧𝑧jm , ≽� − v� �𝐼𝐼, 𝐫𝐫m , 𝑧𝑧jm , ≽�� + |σεj | < δ0/6.
        |V

     For any point (𝐼𝐼̃,𝒑𝒑
                        � m,𝒓𝒓�,𝒛𝒛�m) ∈ [𝐼𝐼 L , 𝐼𝐼 U ] × PJm +1 × R × Z Jm +1 , let (I,pm,rm,zm) be the center of a neighborhood in
the open cover that includes (𝐼𝐼̃,𝒑𝒑                                             #
                                  � m,𝒓𝒓�,𝒛𝒛�m). The probability of the event C∩Hα(𝐼𝐼,𝐩𝐩m ,𝐫𝐫,𝐳𝐳m )
                                                                                                    (I,pm,rm,zm) is at least 1 – γ.
                                                                                               δ�𝐼𝐼,𝐩𝐩m ,𝐫𝐫𝐦𝐦 ,𝐳𝐳m �
In    this    case,    V(𝐼𝐼̃ – 𝑝𝑝�km , 𝐫𝐫�, 𝑧𝑧̃km , ≽) − max V�𝐼𝐼̃ – 𝑝𝑝�jm , 𝐫𝐫�, 𝑧𝑧̃jm , ≽� >
                                                                                                      2
                                                                                                                     > δ0 /2   for   some   k   implies
                                                         j≠k

�(𝐼𝐼̃ – 𝑝𝑝�km , 𝐫𝐫�, 𝑧𝑧̃km , ≽) − max 𝐕𝐕
V                                     �(𝐼𝐼̃ – 𝑝𝑝�jm , 𝐫𝐫�, 𝑧𝑧̃jm , ≽) > δ0 /6. Then (ii) holds with probability at least 1 – γ. The
                               j≠k

bound on the difference between the exact and approximate choice probabilities then follows.

     The proof of (iii) utilizes results on convergence of empirical processes given in Appendix A. The functions in
the family ℱ1, and hence in ℱ2, are linear in (β,γ,ε0,…,ε|J|). Then these families are contained in a finite-
dimensional subspace defined by their intercepts and slope coefficients. The functions in ℱ2 are Lipschitz in
these intercepts and slope coefficients, implying that ℱ is Lipschitz in these parameters. By construction, the
domain [IL–pU,IU]×R×Z×ℬ×𝒮𝒮 and the domain ℬ×[σL,σU] of (β,σ) are compact, so that v(I,pjm,rm,zjm,β) is bounded
on its domain by a constant M. Therefore, f* = M + σU|ε| is an envelope function for ℱ1 and 2f* is an envelope
function for ℱ2 , and hence for ℱ, that from Appendix B(a) satisfies EFf* ≤ M + 1.219384 σU. The family 𝒦𝒦 is
Lipschitz in (β,σ) ∈ ℬ×[σL,σU] since σL > 0, with envelope function f* ≡ 1. Apply Theorem A.3 to establish the
result for ℱ and 𝒦𝒦, and Theorem A.4 to establish the result for ℐ and 𝒢𝒢.

                       � is almost everywhere continuously differentiable in (I,r), and where it is, continuous good
     From Theorem 2.5, V
demands are unique and are given by (15). Let A be a closed set on which this continuous differentiability holds.
Then, Lemma 6 establishes that the derivatives of V approximate uniformly on A the corresponding derivatives of
�. Combined with the bi-Lipschitz property of V
V                                             � in I, this establishes (v). ∎

     The additive EV1-distributed disturbances εj in (17) are introduced as a mathematical convenience,
perturbations that for small positive σ(≽) smooth expected utility and give choice probabilities that are well-
behaved mixed multinomial logits, while approximating closely the choices and continuous good demands from
the underlying true utility. Under Assumptions A1-A4, the approximation properties (i), (iii), and (iv) of Theorem
2.7 continue to hold even in the limit σ(≽) ≡ 0. The EV1 and independence assumptions on the εj are not essential
for smoothing the choice probabilities; any absolutely continuous distribution with well-behaved tails
accomplishes this. The εj in (17) can be treated as predetermined at the time of consumer choice, and thus


                                                                                 18
independent of income transfers or market scenario, so that (17) is consistent with fully neoclassical consumer
behavior. In the literature on discrete choice, the εj are often characterized as random perturbations or tremble
in individual utility, and attributed to the limits of psychophysical discrimination, as in Thurstone (1927). This
relaxation of neoclassical assumptions can be made more general by allowing the individual consumer’s
preference preorder ≽ to be a random draw from H in each choice situation, perhaps representable as tremble
centered on a core preference preorder. In this case, FH is a convolution of population heterogeneity in core
preferences and individual preference tremble. The implications of true preference tremble for demand analysis
and the welfare calculus are deferred to the section on decision versus experienced utility.

   Result (iii) in this theorem shows that utility and the distribution of tastes can be approximated using the
empirical distribution of the finite-dimensional taste parameters (β,σ). This can be interpreted as a member of
the finite-parameter family that places probability at each support point. Obviously, it is then possible to achieve
an approximation of the same precision using other finite-parameter families of distributions with the same
number of parameters. The proof of this theorem assumes a constant for the scaling factor σ, and this is sufficient
for the approximation results, but allowing heterogeneity in σ may allow more parsimonious approximations with
respect to the specification of β.

   The direct utility function (5) given by Lemma 2 can be interpreted as a continuous mapping from the compact
space of preferences H onto a compact subset 𝒰𝒰 of the normed linear space ℭ(Q’×Z) of continuous real-valued
functions u:Q’×Z ⟶ ℝ.        The probability FH on H induces a probability FU on 𝒰𝒰 that satisfies FU(A|s) =
FH({≽∈H|U(⋅,⋅,≽)∈A} | s) for measurable subsets A of 𝒰𝒰. Then, given A1-A4, the field of preferences can be
characterized by (𝒰𝒰,FU) rather than (H,FH). With this characterization, the money-metric utility function (9) in
Lemma 4 is written V:[IL–pU,IU]×R×Z×𝒰𝒰 ⟶ ℝ, and correspondingly the choice indicator δk(𝐼𝐼, 𝐩𝐩m , 𝐫𝐫𝐦𝐦 , 𝐳𝐳m , U) from
(14) and continuous good demand D(I,pm,rm,zm,U) from (15) are written as functions of U ∈ 𝒰𝒰.

    Consider the family (17) of the indirect utility functions V(Im – pjm,rm,zjm,β,σ,εj) ≡ Im + v(Im,pjm,rm,zjm,β) + σεj,
where v(Im,pjm,rm,zjm,β) ≡ X(Im – pjm,rm,zjm)∙β – pjm. A major simplification of the welfare calculus occurs when
v(I,pjm,rm,zjm,β) is independent of income. Make explicit the price index π = π(rm) used to deflate income and
prices to real terms, where π(ra) = π(rb) by assumption, and rewrite V as

(18)      V(Im – pjm,rm,zjm,β,σ,εj) = Im/π(rm) + v(pjm/π(rm),rm/π(rm),zjm,β) + σεj.

But this is a Gorman Polar Form, with the properties that choice among the products j ∈ Jm is independent of
income, and continuous good demands have the form



                                                              19
(19)        D(I,pm,rm,zm,β,σ,εm) = –∂v(pjm/π(rm),rm/π(rm),zjm,β)/∂rm + [Im + v(pjm/π(rm),rm/π(rm),zjm,β)]∂ln π(rm)/∂rm ,

so that the only goods showing income effects are those whose prices influence the index π, and the Engle curves
for these goods are affine linear. The Gorman polar preference field has been studied extensively in welfare
economics, and has important aggregation properties for both continuous and discrete choice; see Chipman and
Moore (1980,1990), Small and Rosen (1981), and McFadden (2004,2014). The Gorman form (19) defines a hedonic
preference field in which product attributes influence tastes only through an effective price, 𝑝𝑝�jm = pjm – X(rm,zjm)∙β.

     The approximation (17) is consistent with the approach to welfare analysis taken by Jorgenson (1997) using
translog utility function families with parameterized observed heterogeneity. Other empirical demand analysis
systems, such as generalized Gorman (Blackorby et al, 1978) or Deaton-Muellbauer (1980), can also be interpreted
as specializations of (17). The money-metric property imposed on (17) will in general put side restrictions on the
parameters of these functional families. These are most easily handled in applications by specifying (17) without
the money-metric restriction, and then obtaining the marginal utility of income from these forms that can later
be used to convert utility differences to (approximate) money-metric terms.




3. WELFARE ANALYSIS

     We restate for product markets the neoclassical welfare calculus outlined in Section 1, utilizing the treatment
of consumer theory given in Section 2. 8 There is a baseline, “as is,” or “default” policy/scenario m = a and a
counterfactual, “but for,” or “replacement” policy/scenario m = b. 9 Consumers face menus of mutually exclusive
products j ∈ Jm ⊆ J with at least one “benchmark” or “no purchase” alternative whose attributes are unaffected
by scenario changes. 10 Our analysis will be carried out for a population of consumers who are neoclassical
maximizers of preferences that satisfy Assumptions A1-A4 and that are predetermined and unaffected by income



8
 The basics of this theory can be found in Varian (1992, Chap. 7, 10), Mas-Colell, Whinston, and Green (1995, Chap. 3), and
other graduate-level textbooks. See also McFadden and Winter (1966) and Border (2014).
9
  For convenience we will use the “baseline/as is/default” and “counterfactual/but for/replacement” labels for both
retrospective analysis of past policy and prospective analysis of policies not yet implemented, noting that these labels are
arbitrary and interchangeable in many prospective applications. In retrospective applications, associating a with the
historical scenario and b with the counterfactual leads to measures of welfare change often termed “Willingness to Pay”
(WTP), while reversing these labels and making b the baseline leads to “Willingness to Accept” (WTA) welfare measures.
10
  If the products in an application are not mutually exclusive, or the consumer can buy more than one unit of a product,
then J indexes the mutually exclusive possible portfolios of product purchases. In general, J may index locations or
“addresses” in physical or hedonic space, and with added technical machinery is not restricted to be finite.

                                                              20
transfers or scenario changes that alter market opportunities. 11 These consumers have indirect decision-utility
functions that from Theorem 2.7 are uniformly approximated by

(20)        V(I – pjm,rm,zjm,β,σ,εj) ≡ I + vjm(I,β) + σεj,

where vjm(I,β) is shorthand for v(I,pjm,rm,zjm,β) ≡ X(I – pjm,rm,zjm)β – pjm. The vector β and positive scalar σ are
randomly distributed in the population with a probability F(β,σ|s,𝛼𝛼) that is in a parametric family with parameter
α, given observed socioeconomic history s, and the εj are independent standard Extreme Value type I random
variables. As discussed earlier, the εj are introduced as a mathematical convenience, but will often be interpreted
as contributions of unobserved perceptions and attributes to the utility of product j. By construction, V is money-
                                                                                                                 k
metric for a “no purchase” or “benchmark” alternative in scenario a (e.g., v(I,p0a,ra,z0a,β) ≡ 0). In the event Hm =
{ε | V(I – pkm,rm,zkm,β,σ,εk) > V(I – pjm,rm,zjm,β,σ,εj) for j ∈ Jm\{k}}, the consumer maximizes (20) at alternative k ∈
Jm, an event indicated by δkm(I,β,σ,ε) = 1, with a probability that is uniformly approximated by a mixed multinomial
logit (MMNL),

(21)        Pkm = Pk(I,pm,rm,zm,,s,𝛼𝛼) ≡ Eβ,σ|s 𝐿𝐿km (𝐼𝐼, β, σ) ,

                            exp(vkm (𝐼𝐼,β)/𝜎𝜎 )
where 𝐿𝐿km (𝐼𝐼, β, σ) = ∑                             is the “flat” multinomial logit probability of δkm(I,β,σ,ε) = 1 given (β,σ).
                           j∈𝐉𝐉m exp(vjm (𝐼𝐼,β)/𝜎𝜎)

The components of the vector of taste parameters β are termed “part-worth” or Willingness-to-Pay (WTP)
coefficients for unit changes in the corresponding components of X. Unconditional maximum indirect utility in
scenario m when income is I , our policy-independent yardstick for welfare analysis, then satisfies

(22)      um = 𝒱𝒱(𝐼𝐼, 𝐩𝐩m , 𝐫𝐫m , 𝐳𝐳m , β, σ, 𝛆𝛆) ≡ max [I + v(I,pjm,rm,zjm,β) + σεj].
                                                      j∈𝐉𝐉m


     There are three substantive questions whose resolution affects the form of the welfare calculus: (1) Is the
analysis prospective, comparing policies not yet put into place, or retrospective, comparing “as is” and “but for”
past policies? (2) Is information on the tastes of individual consumers complete or partial, and if partial what
welfare measures are relevant to transfers that can actually be fulfilled? (3) Should well-being be assessed in
terms of the decision-utility postulated to determine economic demand behavior, or in terms of experienced-
utility after taste ambiguities and uncertainties are resolved? These questions are discussed in Sections 4, 5, and




11
  Our analysis lumps unobserved perceptions and attributes of alternatives together with unobserved preferences. To
maintain taste invariance when these unobserved factors are influenced by policy, we would need to make these sources of
randomness explicit and consider how to detect their presence and identify their influence on welfare.

                                                                      21
6 below. In the remainder of this section, we restate for our general model of discrete product choice and
neoclassical assumptions the welfare measures introduced in Section 1.

       A standard welfare measure for the net gain in well-being from scenario b relative to scenario a is Hicksian
Compensating Variation (HCV), the net decrease in scenario b income that makes the two scenarios indifferent.
Let HCV(s,k,β,σ,ε) denote this measure for an observed history s and scenario a choice k, and a vector (β,σ,ε) of
unobservables. 12 In terms of the conditional indirect utility function (21), HCV(s,k,β,σ,ε) satisfies

 (23)       max [𝐼𝐼b − HCV + v(𝐼𝐼b − HCV, 𝑝𝑝jb , 𝐫𝐫b , 𝑧𝑧jb , β) + σεj ] = 𝐼𝐼a + v(𝐼𝐼a , 𝑝𝑝ka , 𝐫𝐫a , 𝑧𝑧ka , β) + σεk .
             j∈𝐉𝐉b


 Removing the conditioning on k when it is not observed gives the measure HCV(s,β,σ,ε) = min HCV(𝑠𝑠, k, β, σ, 𝛆𝛆).
                                                                                                                              k∈𝐉𝐉a

 Another standard welfare measure, Hicksian Equivalent Variation (HEV), denoted HEV(s,β,σ,ε), is the net increase
 in scenario a income that makes the two scenarios indifferent. Because the scenario a choice may change with
 the income transfer, HEV does not depend explicitly on the uncompensated scenario a choice k; from (23),
 HEV(s,β,σ,ε) satisfies

 (24)         max [𝐼𝐼b + v(𝐼𝐼b , 𝑝𝑝jb , 𝐫𝐫b , 𝑧𝑧jb , β) + σεj ] = max [𝐼𝐼a + HEV + v(𝐼𝐼a + HEV, 𝑝𝑝ja , 𝐫𝐫a , 𝑧𝑧ja , β) + σεj ].
               j∈𝐉𝐉b                                                    j∈𝐉𝐉a


Sometimes, HCV is termed Willingness-to-Pay (WTP), and HEV is termed Willingness-to-Accept (WTA); this
terminology is related to the description of β as a vector of WTP coefficients, but only in special cases is there a
simple mapping between β and HCV or HEV.

       The definition of Market Compensating Equivalent (MCE) that generalizes (2) is the difference in the utilities
(23) that the consumer would attain in scenarios a and b in the absence of compensation, scaled by a MUI in
scenario a scaling the utility difference in monetary units. The conditional indirect utility V(I – pjm,rm,zjm,β,σ,εj) ≡
I + v(I,pkm,rm,zkm,β) + σεkm is denominated in monetary units and is money-metric for a “no purchase” alternative.
However, if there are neoclassical income effects for other alternatives k, one has ∂V(I – pkm,rm,zkm,β,σ,εk)/∂I ≡ 1
+ ∂v(I,pkm,rm,zkm,β)/∂I ≢ 1. If alternative k is chosen in scenario a, then

                                 max �𝐼𝐼b + v�𝐼𝐼b ,𝑝𝑝jb ,𝐫𝐫b ,𝑧𝑧jb ,β�+ σεj �− max �𝐼𝐼a + v�𝐼𝐼a ,𝑝𝑝ja ,𝐫𝐫a ,𝑧𝑧ja ,β�+ σεj �
                                 j∈𝐉𝐉                                          j∈𝐉𝐉
 (25) MCE(s,k,β,σ,ε) =              b                                                 a
                                                                                                                          .
                                                                        µk (𝐼𝐼a ,β)


Where the MUI,



12
     Note that when k is observed in scenario a, the distribution of ε is conditioned on the event {ε|δka(I,β,σ,ε) = 1}.

                                                                                22
 (26)        μk(Ia,β) = ∂v(Ia – pka,ra,zka,β)/∂Ia ≡ 1 + [∂X(Ia – pka,ra,zka)/∂Ia]β,

gives a definition of MCE(s,k,β,σ,ε) that at least locally has the money-metric property in scenario a. 13 Later, when
we consider cases where choice k in scenario a is not observed, or one observes or uses only the information that
“as is” choice is from a set D ⊆ Jm, μk(Ia,β) will be replaced by a scale factor μD(Ia,β). Note that μk(Ia,β) defined
by (26) is independent of σ and ε, and if X does not depend on income, then μk(Ia,β) ≡ 1.

     The measure (25) can be interpreted as a generalization to multiple products with varying attributes of the
Marshallian consumer surplus (MCS) introduced in Section 1; this generalization is more convenient for
applications than multivariate extensions, path-dependent when there are income effects, of the integral form
(2) for MCS. First-order Taylor’s expansions of (24) imply

 (27) HCV(𝑠𝑠, k, β, σ, 𝛆𝛆) ∙ µ′ = HEV(𝑠𝑠, k, β, σ, 𝛆𝛆) ∙ µ′′ = MCE(𝑠𝑠, k, β, σ, 𝛆𝛆) ∙ µk (𝐼𝐼a , β) ,

where µ′ = 1 + ∂v(I’ – pjb,rb,zjb,β)/∂I and µ′′ = 1 + ∂v(I” – pka,ra,zkb,β)/∂I are MUI at the chosen alternatives j in
scenario b and k in scenario a, respectively, when there is no compensation, evaluated at incomes I’ and I”
intermediate between uncompensated and compensated levels. The measures HCV, HEV, and MCE all agree on
sign, but in general can differ in magnitude. However, if the marginal utility of income is constant, then HCV =
HEV = MCE. In general, (24) can be solved quickly for HCV or HEV by iteration starting from MCE.

     It is common in applied welfare analysis to aggregate money-metric measures of individual benefits from a
policy change, net of allocated costs and fulfilled transfers, and judge the change desirable if this aggregate
welfare measure exceeds unallocated costs. Ideally, the cost allocation and fulfilled transfers exhaust the feasible
opportunities for socially desirable income redistribution, so that the feasibility-constrained social marginal
utilities of income for consumers are the same and equal weighting of consumers in the aggregate welfare
criterion is appropriate. Restrictions on the nature of the preference field, the set of policies under consideration,
and/or the measure of individual welfare are required for the aggregate welfare criterion to order policies and
identify a best policy; otherwise, it may fail to satisfy the irreflexivity or transitivity conditions required of an order.




13
   The scale factor μk(Ia,β) in the definition of MCE is natural for retrospective analysis where the consumer has experienced
scenario a, or for prospective analysis when scenario a is a default that will occur unless there is a policy intervention, and
is unambiguous when indirect utility has been transformed so that the marginal utility of income in scenario a remains
constant when income changes. However, more generally, MCE will be affected by transformations of utility and the
evaluation point for the marginal utility of income, and additional criteria may be needed to select among alternative
versions of MCE.

                                                                  23
When the aggregate criterion does order policies, it has the properties of a Bergson (1938) social welfare function,
and is then subject to the challenges of social choice theory; see Arrow (1950), Harsanyi (1955), Sen (2017, p. 385).

    If the set of policies under consideration along with their accompanying fulfilled transfers are Pareto-ordered,
then the aggregate welfare criterion with any of the transfers HCV, HEV, or MCE will follow the same order.
Alternately, when marginal utilities of income are constant over the domain of consumption induced by the policy
set, and equal across individuals, the aggregate welfare criterion with MCE and any pattern of transfers orders
policies; this case corresponds to a preference field of Gorman polar form with parallel income-expansion paths;
see Chipman and Moore (1980,1990), McFadden (2004). Kaldor (1936) and Scitovsky (1942) give an argument
that suggests the aggregate welfare criterion using HCV, termed the Kaldor-Hicks criterion, orders policies, and
that this is a basis for preferring HCV over MCS. On closer examination, this argument holds only in cases such as
constant, equal marginal utilities of income, or policies incorporating transfers that are Pareto-ordered, in which
case, either HCV or MCE can be used. Otherwise, the aggregate welfare criterion with either HCV or MCE may fail
to order the policy alternatives.

    With the apparatus above, practical welfare analysis of product markets can be carried out in three steps.
First, observations on the market choices of surveyed consumers, augmented by extra-market data on stated
preferences if necessary to identify tastes for relevant attributes, can be used to estimate the mixed MNL model
(22) and recover the probability F(β,σ|s,𝛼𝛼). An obvious caution is that the vector of predetermined functions X in
(21) has to be comprehensive enough to achieve the approximation accuracy promised by Theorem 2.7, so that
estimation of (22) needs to include a careful econometric specification analysis. A “method of sieves” approach
to the specification of X provides practical guidelines for this specification search. With this caveat, this setup is
both practical and sufficiently general to handle welfare analysis of policy changes that affect discrete choice
without making unwarranted assumptions on preferences.

    Second, construct a large synthetic population. Start from a random sample from the target population. For
each sampled person, assign a history s, incomes Ia and Ib, choice sets Ja and Jb, and market environments (pa,ra,za)
and (pb,rb,zb), using available data for the sampled individual wherever possible in order to preserve ecological
correlations in the target population. Make multiple draws of (β,σ) from the estimated probability F(β,σ|s,𝛼𝛼) and
of ε from the standard Extreme Value Type I distribution. Assign utility-maximizing choices k in scenario a and j in
scenario b. Each draw defines a synthetic consumer.

    Third, calculate the measures HCV(𝑠𝑠, k, β, σ, 𝛆𝛆), HEV(𝑠𝑠, k, β, σ, 𝛆𝛆), and MCE(𝑠𝑠, k, β, σ, 𝛆𝛆) from (24) and (25) for
each consumer in the synthetic population. These measures can be aggregated over this synthetic population or

                                                               24
subpopulations to estimate hypothetical compensating transfers for relevant consumer classes. However,
transfers that are actually fulfilled in the target population can depend only on observable history s and (if
observed) the scenario a choice k. Define uniform transfers UMCE(s,k) = 𝐄𝐄β,σ,𝛆𝛆|s,k MCE(𝑠𝑠, k, β, σ, 𝛆𝛆) and UMCE(s)
= 𝐄𝐄k,β,σ,𝛆𝛆|s MCE(𝑠𝑠, k, β, σ, 𝛆𝛆). Fulfillment of these transfers in the real population in retrospective welfare analysis
will not in general make individual consumers “whole”, but will balance individual gains and losses in the sense
that a MCE welfare measure taken subsequent to these uniform transfers aggregates to zero. In the same way,
one can solve for uniform transfers tk = UHCV(s,k) and t = UHCV(s) that if fulfilled in scenario b balance the gains
and losses from the remaining unfulfilled Hicksian transfers, so that a subsequent MCE aggregates to zero:


             ⎧ 𝐄𝐄β,σ,𝛆𝛆|s,k �max
                             j∈𝐉𝐉
                                  �𝐼𝐼b − t k + v�𝐼𝐼b − t k , 𝑝𝑝jb , 𝐫𝐫b , 𝑧𝑧jb , β� + σεj � − [𝐼𝐼a + v(𝐼𝐼a , 𝑝𝑝ka , 𝐫𝐫a , 𝑧𝑧ka , β) + σεk ]�
                               b
(28)    0=                                                                                                                                     .
             ⎨𝐄𝐄         �max �𝐼𝐼 − t + v�𝐼𝐼b − t, 𝑝𝑝jb , 𝐫𝐫b , 𝑧𝑧jb , β� + σεj � − [𝐼𝐼a + v(𝐼𝐼a , 𝑝𝑝ka , 𝐫𝐫a , 𝑧𝑧ka , β) + σεk ]�
             ⎩ k,β,σ,𝛆𝛆|s j∈𝐉𝐉b b

Analogous definitions can be given for UHEV(s,k) and UHEV(s). 14 Note that the measures considered in this
paragraph are all based on predetermined decision-utility, with no adjustment for possible tremble in decision
utility or differences in decision and experienced utility.




4. PROSPECTIVE VERSUS RETROSPECTIVE WELFARE ANALYSIS

     Traditional welfare theory considers a prospective policy change in a static “what if” environment. An
“incumbent” or “default” policy/scenario a is compared with a “replacement” policy/scenario b in a situation
where neither has been implemented and both are on the table. The theory assumes that the policymaker has
the information and authority to carry out net lump sum transfers in the event that policy b is adopted, adjusted
for direct policy-induced effects on incomes, that make each consumer indifferent between the policies, and
assumes that if policy b is adopted, these transfers are fulfilled before consumers maximize utility. Under these
conditions, the Hicksian Contingent Variation (HCV) defined in (24) is the precise measure of each lump sum
transfer required. If instead, a and b are reversed, so that transfers are fulfilled if a is adopted, then the Hicksian
Equivalent Variation (HEV) is the precise measure of each lump sum transfer required. So long as population



14
  Another approach to defining UHCV(s,k) and UHEV(s,k) is to consider ”representative” utility for the class of consumers
with history s, perhaps the expectation of (21) with respect to the unobservables, and then define UHCV(s,k), or UHEV(s,k)
as analogs of HCV or HEV for “representative” utility. However, these definitions will not in general have the property that
UHCV(s,k) = 𝐄𝐄β,σ,𝛆𝛆|𝑠𝑠,k HCV(β,σ,ε) or UHEV(s,k) = 𝐄𝐄β,σ,𝛆𝛆|𝑠𝑠,k HEV(β, σ, 𝛆𝛆).

                                                                        25
aggregate HCV or HEV, adjusted for policy-induced income changes, exceeds zero, a shift from policy a to policy b
with the exact individual transfers fulfilled, plus any distribution of the residual surplus, is a Pareto improvement.

     In practice many welfare calculations are retrospective rather than prospective. The welfare question is what
transfers after the fact redress harm from a past “as is” or “baseline” scenario a in which some products were
defective or improperly marketed, using as a benchmark a “but for” or “counterfactual” scenario b in which these
flaws would have been absent. 15 A key feature of these applications is that the transfer occurs after the decision-
utility-maximizing choice would have been made in the “but for” scenario, and hence these transfers could not be
a factor in “but for” choice. Put another way, the “but for” utility maximization that would have occurred at the
consumer’s original income will not in general coincide with that assumed in the Hicksian compensating variation
calculation in which the transfer would have been made prior to consumer choice and would have influenced that
choice. Since at the time the corrective transfer is being considered, the consumer is in the “as is” situation, this
transfer is denominated in “as is” monetary units. Then, the transfer that “makes whole the consumer with choice
k in the baseline scenario” equals the difference in the utilities (21) that would have been attained in the “but for”
and “as is” scenarios, scaled to “as is” monetary units, the MCE (25).

     Suppose the purpose of a prospective policy analysis is not to actually fulfill the HCV or HEV transfers associated
with a move from scenario a to scenario b, but simply to determine whether it is possible in principle to
compensate consumers so that the move from scenario a to scenario b would be a Pareto improvement. Then,
arguably, aggregate MCE rather than aggregate HCV or HEV is the appropriate welfare criterion. Further, MCE is
easier to compute and aggregate than HCV or HEV, since it is obtained as an explicit solution (25) from the indirect
utility functions (21) of individual consumers, and the distribution of these solutions in the target population.
Equation (27) shows that HCV, HEV, and MCE differ only due to differences in the marginal utility of income at
different arguments. Later, we show in examples that these differences are often but not always modest. Then,
the distinction between prospective and retrospective welfare measures often will be empirically unimportant,
but occasionally will be of practical as well as theoretical significance.

     The distinction we have made between prospective and retrospective welfare analysis does not require explicit
consumer dynamics, but a MCE transfer to redress past harm obviously occurs at some time later than the period




15
  Retrospective policy analysis is often conducted in conjunction with litigation, and statues and legal rulings often control
the definition of harm and the scope and magnitude of remedies. These legal standards are often rooted in economic
arguments, but may nevertheless deviate from a purely economic analysis of harm and remedy. In this paper, we consider
only the economic foundation of retrospective analysis, and do not take up legal considerations.

                                                               26
of the harm, introducing issues such as discounting and pre-judgement interest, but more fundamentally the
longer-run impacts of injury on consumer assets and opportunities. We leave this as a topic for future research,
but note that in a fully dynamic model, the impact of policy on state variables justifies scaling MCE in monetary
units that make the consumer whole in terms of lifetime well-being. 16




5. PARTIAL OBSERVABILITY AND WELFARE AGGREGATES

    Traditional welfare analysis assumes that the individual utility functions required to calculate measures of
well-being can be recovered fully (with money-metric scaling) from observations on this consumer’s market
choices. This is unrealistic, first because the analyst typically has observations on a consumer’s choices in only a
small number of market environments, often only one, and because markets are observed only over a limited
range of conditions. For example, variations in historical product prices are limited by production costs and
competition between products, and the dimensionality of possible product attributes is high, with only a limited
range of bundles of attributes appearing in historically available products. However, different consumers
generally face somewhat different observed market environments, and if one can maintain the consumer
sovereignty assumption that consumer tastes are predetermined at the time of market choice, and assume
plausibly that given s there is no ecological correlation of market environments and tastes, then observations
across consumers can be used to estimate the distribution of tastes in the population. Further, in many
applications it is reasonable to assume that consumers value products using hedonic effective prices that adjust
market price for the attributes of the product; then the analysis can recover distributions of hedonic weights. This
will often be sufficient to infer the distribution of consumer utilities for new or modified products even if their
specific configurations of attributes are novel.

    A more challenging recovery problem arises when markets are incomplete, due to transaction costs,
asymmetric information that causes market failure through adverse selection and moral hazard, or failure to




    16
      Technically, retrospective welfare analysis should be conducted with a multi-period consumer model, with redress in
the second period from harm in the first period. If the consumer has intertemporarly separable utility, then the ideal MCE
measure satisfies V1b(I1) + V2(I2 – MCE) = V1a(I1) + V2(I2), where V1 and V2 are indirect utilities for the respective periods, and
non-income arguments in indirect utility are suppressed. Applying the first mean value theorem for integrals, MCE = [V1b(I2)
– V1a(I1)]/μ2, where μ2 is a marginal utility of income in the second period. But the consumer will allocate income between
periods to equate marginal utilities of income (without accounting for MCE), so that μ2 will to a first approximation equal
μ(Ia,β,σ). Consequently, the MCE defined in (25) approximates the two-period ideal. Further analysis of intertemporal utility
to sharpen the definition of MCE is left to the reader.

                                                                 27
establish ownership and control of the distribution of some goods and services. For example, consumers cannot
insure against some kinds of events, cannot directly purchase environmental amenities such as clean air and
unpolluted beaches, and lack market opportunities that show their tastes for “existence goods” such as protecting
endangered species or reducing global warming. If there is sufficient market redundancy, or if there are active
margins where unmarketed and marketed goods are complements or substitutes, then it may be possible to
recover indirectly preferences for unmarketed goods. For example, consumer preferences for environmental
amenities are reflected in their willingness to travel to unpolluted beaches or move to neighborhoods with cleaner
air. However, when preferences for unmarketed goods and services leave no market trace, they obviously cannot
be recovered from market data. Experimental methods for directly eliciting stated preferences for these goods in
hypothetical markets are successful in some marketing contexts, but sensitivity to context and framing can make
experimental data unreliable; see Ben Akiva et al (2016), McFadden (2017), Miller et al. (2011). For the remainder
of this section, we assume that there is sufficient market information to recover distributions of preferences in
the population, and study the construction of aggregate measures of welfare. These aggregates may be sufficient
for policy decisions, or sufficient to determine transfers that are judged appropriate to remedy harm to a class of
consumers even if the compensation is not exact for each individual.

    When a welfare analysis seeks to fulfill the transfers HCV, HEV, or MCE that in retrospective or prospective
applications leave a class of consumers indifferent to the policy change, an obvious limitation is that an actual
transfer to a consumer can be a function only of observed characteristics. It is common in applied welfare analysis
to estimate welfare effects by postulating a representative consumer whose demands are close to the per capita
market demands of a consumer class, calculating the transfer that keeps “representative” utility constant, and
assuming that this per capita transfer could in principle be redistributed to keep the utility of each consumer in
the class constant. A necessary and sufficient condition for the existence of a representative consumer meeting
these conditions exactly is that the utilities of individuals in the class be representable in Gorman Polar Form with
possibly heterogeneous committed expenditures but a common price deflator; see Chipman and Moore (1990),
McFadden (2004). In (21), this requires that the X functions be independent of income, so that discrete choices
will exhibit no neoclassical income effect and HCV, HEV, and MCE coincide. In practical fulfillment of compensating
transfers, the policymaker faces a decision-theory problem in which there will be social losses from under or over-
compensation of individuals, and some (Bayesian) criterion must be applied to determine a loss-minimizing
transfer rule. For example, if the policymaker has a quadratic social loss function, and a diffuse Bayesian prior,
the optimal transfer to an individual equals the expected compensating transfer given observed characteristics.
This suggests two rules in the case of partial observability. First, if transfers are fulfilled, prospectively or


                                                           28
retrospectively, then they should equal the expected value of the exact compensating transfer given available
information on the individual. Second, the impact of a policy change on a class of consumers in either prospective
or retrospective applications should equal the expected value of the exact aggregate compensating transfers, with
the appropriate compensating transfers determined by whether or not the transfers are hypothetical or fulfilled,
and if the latter, whether this occurs before or after preference-maximizing choices in each scenario.

    Relevant aggregates defined in Section 3 are the expected values UMCE(s,k) = 𝐄𝐄β,σ,𝛆𝛆|s,k MCE(𝑠𝑠, k, β, σ, 𝛆𝛆) and
UMCE(s) = 𝐄𝐄k,β,σ,𝛆𝛆|s MCE(𝑠𝑠, k, β, σ, 𝛆𝛆), or uniform Hicksian measures such as UHCV(𝑠𝑠, k) and UHCV(𝑠𝑠). Section 3
describes a computational approach to forming the relevant aggregates using a synthetic population; this
approach can accommodate any assumptions the analyst chooses on the properties of ε and the observed
histories on which the welfare measures are conditioned. However, in selected cases, it is possible to reduce
computation by forming analytic expectations with respect to ε. In the remainder of this section, we do this for
the case where the scenario a choice is not observed, and three cases where this choice is observed: (A) all
products, even “brands” whose prices and attributes do not change between scenarios, have distinct indices in
the two scenarios; (B) “brands” with changing attributes and prices across scenarios have distinct indices, but
benchmark “brands” whose attributes and prices do not change have the same indices; and (C) all “brands” are
present in both scenarios a and b, and have the same indices, even though some have measured attributes or
prices that change. In terms of choice sets, these cases are (A) Ja∩Jb = ∅, (B) ∅ ≠ Ja∩Jb a ≠ Ja∪Jb, and (C) Ja = Jb.
Since the εj are approximation elements added for convenience, rather than utility components with deeper
justification from consumer behavior, one should be able to pick from the cases (A)-(C) to get the most convenient
computational formulas. However, if this makes a substantial difference in the overall level or distribution of
compensating transfers, then (20) needs to be respecified to reduce the relative contribution of the εj elements.
Case (A) is plausible if the consumer has a fixed idiosyncratic contribution εj to utility for each good j, but perceives
of all goods in a new choice situation as if they were entirely new products. This stretches the neoclassical
assumption of predetermined and fixed preferences, as it is equivalent to allowing a special preference tremble
that can vary with choice situation. Cases (B) and (C) more easily fit the neoclassical interpretation of the εj as
contributions from persistent unobserved attributes of branded products.

    Consider the unconditional indirect utility function (22). Appendix B(b) shows that its expectation with respect
to (β,σ,ε), given history s, income I, and scenario m is


 (29)    Eβ,σ|s Eε max [I + v(I,pjm,rm,zjm,β) + σεj] = I + Eβ,σ|s {σ ∙ ln ∑j∈Jm exp�vjm (𝐼𝐼, β)⁄σ� + 𝜎𝜎 ∙ γ0 },
                  j∈𝐉𝐉m




                                                                29
where γ0 denotes Euler’s constant and vjm (𝐼𝐼, β) ≡ v�𝐼𝐼, 𝑝𝑝jm , 𝐫𝐫m , 𝑧𝑧jm , β�. Scaling and differencing for m = b,a,

                                                                                                 ∑j∈J exp�vjb (𝐼𝐼b ,β)⁄σ�
(30)    UMCE(s) ≡ 𝐄𝐄k,β,σ,𝛆𝛆|s MCE(𝑠𝑠, k, β, σ, 𝛆𝛆) = 𝐄𝐄β,σ|𝑠𝑠 [Ib – Ia + σ ∙ ln ∑                   b
                                                                                                                             ]/μ(Ia,β,σ) ,
                                                                                                  j∈Ja exp�vja (𝐼𝐼a ,β)⁄σ�



where the mean scaling factor μ(Ia,β,σ) is a weighted harmonic mean of the marginal utilities of income (26), with
the MNL choice probabilities from (22) as weights, that depends on σ through these weights,

               1                         1                   𝐿𝐿km (𝐼𝐼a ,β,σ)
(31)                    ≡ 𝐄𝐄k|,β,σ                 = ∑k∈Ja                     .
          µ(𝐼𝐼a ,β,σ)                µk (𝐼𝐼a ,β)               µk (𝐼𝐼a ,β)


   A Hicksian analogue of (30) is obtained by forming the expectation of (24) and solving

                                                                     ∑j∈J exp�vjb (𝐼𝐼b −UHCV(𝑠𝑠),β)⁄σ�
(32)      0 = 𝐄𝐄β,σ|𝑠𝑠 [𝐼𝐼b − UHCV(𝑠𝑠) − 𝐼𝐼a + σ ∙ ln                    b
                                                                             ∑j∈J exp�vja (𝐼𝐼a ,β)⁄σ�
                                                                                                          ].
                                                                                 a



A formula for UHEV(s) is more complicated. If scenario a optimal choices before and after the income transfer
change due to income effects, then (29) is replaced by a complex expression from Appendix B(e). However, if the
marginal utility of income μk(Ia,β) from (26) is independent of Ia and k remains the optimal choice after the transfer,
then from (27), UHEV(s) = UMCE(s). Of course, if discrete choice exhibits no income effects, then the definitions
above satisfy UMCE(s) = UHCV(s) = UHEV(s).

   Next consider situations (A), (B), and (C) defined above in which choice of alternative k in scenario a is observed,
δk (𝐼𝐼a ) = 1.

       (A) From Appendix B(b), expected utility given the utility-maximizing choice k is the same as (29) when m = a
and I = Ia. Further, independence implies that (29) will also apply when m = b and I = Ib.                                                   Then, (32) with
conditioning on k added continues to hold in case (A), with a solution defining a uniform transfer UHCV(s,k) for
each k. Further, (30) is altered only by substituting the choice-k specific scale factor (26), giving

                                                             ∑j∈J exp�vjb (𝐼𝐼b ,β)⁄σ�
(33)     UMCE(s,k) = 𝐄𝐄β,σ|𝑠𝑠,k [Ib – Ia + σ ∙ ln ∑              b
                                                                                          ]/μk(Ia,β) .
                                                              j∈Ja exp�vja (𝐼𝐼a ,β)⁄σ�



Note that (30) is the expectation of (33) with respect to the MNL probability 𝐿𝐿km (𝐼𝐼a , β, σ). While the formula (33)
depends on k only due to the scale factor, its expectation conditioned on choice k in a population with
heterogeneous observed environments will in general vary substantially with k due to selection on the
environments that yield this choice.


                                                                                     30
       (B) Suppose the alternatives in Ja∪Jb can be partitioned into a set A of alternatives with indices that appear
only in Ja; a set B of alternatives that appear only in Jb; and a set C of “benchmark” alternatives appearing in both
scenarios that satisfy vja(Ia,β) = vjb(Ib,β) for j ∈ C; this requires that their attributes and prices not change, and if
these vjm depend on income, that Ia = Ib. As a result of this assumption, the vjm(I,β) ≡ vj(I,β) for j ∈ A∪B∪C do not
depend on the scenario m.

       Utilizing the conditional expectation formulas in Appendix B(c),


(34)      UMCE(s,k) = 𝐄𝐄β,σ|𝑠𝑠,k �𝐼𝐼b − 𝐼𝐼a + max �vj (𝐼𝐼b , β) + σεj � − (vk (𝐼𝐼a , β) + σεk )� /µk (𝐼𝐼a , β)
                                                     j∈B∪C


                                                                                                        𝐿𝐿(C|A,C) 𝜎𝜎∙ln(1−𝐿𝐿(A|A,B,C))
                                                                                            𝐄𝐄β,σ|𝑠𝑠,k                                   if k ∈ A
                            1                             ∑j∈B∪C exp�vj (𝐼𝐼b ,β)/𝜎𝜎�                   𝐿𝐿(A|A,C)        µk (𝐼𝐼a ,β)
           = 𝐄𝐄β,σ|𝑠𝑠,k             �𝐼𝐼b − 𝐼𝐼a + 𝜎𝜎 ∙ ln � ∑                          �� + �                                                        ,
                        µk (𝐼𝐼a ,β)                         j∈A∪C exp�vj (𝐼𝐼a ,β)/𝜎𝜎�                     𝜎𝜎∙ln(1−𝐿𝐿(A|A,B,C))
                                                                                             −𝐄𝐄β,σ|𝑠𝑠,k        µ (𝐼𝐼 ,β)
                                                                                                                                         if k ∈ C
                                                                                                                  k a



                                   v �𝐼𝐼 ,β�/𝜎𝜎                                 v �𝐼𝐼 ,β�/𝜎𝜎
                            ∑j∈A 𝑒𝑒 j b                                  ∑j∈C 𝑒𝑒 j b
where L(A|A,B,C) =                  v (𝐼𝐼 ,β)/𝜎𝜎   and L(C|A,C) =                v (𝐼𝐼 ,β)/𝜎𝜎   .
                         ∑j∈A∪B∪C 𝑒𝑒 j a                                ∑j∈A∪C 𝑒𝑒 j a


       The left-hand expectation term in the last line of (34) coincides with the expression (33) for UMCE(s,k)
obtained when the idiosyncratic noise in scenario b is independent of the idiosyncratic noise in scenario a. The
right-hand expectation term is an adjustment for the effect of the conditioning event on the expected maximum
utility from B∪C, downward if k ∈ A and upward if k ∈ C. This expectation incorporates the effects of selection,
which can be powerful if σ is large: Many choices from A will come from favorable draws of idiosyncratic noise
even when observed attributes make these alternatives unattractive. Then, regression to the mean in draws of
idiosyncratic noise will tend to make alternatives in B less desirable than their analogues in A even if they are
objectively better. In contrast, when the analogues in B of alternatives in A objectively improve, choices from C
that result from a favorable draw will lead to an even better expected outcome in scenario b since alternatives
with this draw remain available. If the scale factors μk(Ia,β) vary with k, then the interaction of selection and
income effects no longer gives the result that (30) with scale factor (31) equals the expectation of (34) with respect
to k. For example, if alternatives in A have μk(Ia,β) > 1, and alternatives in C have μk(Ia,β) = 1, then the expectation
of (34) with respect to k exceeds MCE(s) from (30). Equation (34) can also be adapted to calculate UHCV(s,k) for
this case: Reduce income Ib in scenario b by UHCV(s,k), with this quantity adjusted so that (34) equals zero.

       (C) Suppose Ja = Jb = J = {0,…,J}, δk (𝐼𝐼a ) = 1, and εa = εb = ε, so that all alternatives are indexed the same and
have the same idiosyncratic noise in both scenarios. It is possible to obtain analytic formulas for MCE(s,k) under


                                                                             31
quite general conditions in which the differences vjb(𝐼𝐼b∗ , β) – vja(𝐼𝐼a∗ , β), evaluated at income levels that may differ
from Ia or Ib respectively due to transfers, vary across multiple alternatives. Appendix B(e) provides formulas that
can be assembled to program this calculation, but these are too complex to be useful for comparison to the
previous cases. We instead consider the special circumstance in which Ia = Ib = I and the scenario affects only
product J, so vjm(I,β) is independent of m for j < J. For this case, Appendix A(d) implies the following results:

       If k = J, then

                                                   vJb (𝐼𝐼, β) − vJa (𝐼𝐼, β)        if vJb (𝐼𝐼, β) > vJa (𝐼𝐼, β)
                                       1
(35)      UMCE(s,J) = 𝐄𝐄β,σ|𝑠𝑠,J            �                   v (𝐼𝐼,β)/𝜎𝜎
                                                          ∑j∈J e jb
                                                                                                                     ,
                                   µJ (𝐼𝐼,β) σ
                                                   ∙ ln         v (𝐼𝐼,β)/𝜎𝜎         if vJb (𝐼𝐼, β) < vJa (𝐼𝐼, β)
                                            𝐿𝐿Ja          ∑j∈J e ja



while If k < J,

                                                                                                       v (𝐼𝐼,β)/𝜎𝜎
                                                     𝐿𝐿                                  σ       ∑    e jb
                               1     − 𝐿𝐿 Ja (vJb (𝐼𝐼, β) − vJa (𝐼𝐼, β)) + 𝐿𝐿 ∙ ln j∈J vja(𝐼𝐼,β)/𝜎𝜎                      if vJb (𝐼𝐼, β) > vJa (𝐼𝐼, β)
 (36) UMCE(s,k) = 𝐄𝐄β,σ|𝑠𝑠,k (𝐼𝐼,β) � ka                                     ka   ∑j∈J e                                                                ,
                            µk
                                                       0                                                                 if vJb (𝐼𝐼, β) < vJa (𝐼𝐼, β)


where Lka = evka(𝐼𝐼,β)/𝜎𝜎 �∑j∈J evja(𝐼𝐼,β)/𝜎𝜎 . As in case (B), this formula can be adapted to solve for the transfer
UHCV(s,k) that when fulfilled makes a subsequent UMCE zero, while computation of UHEV(s,k) is in general more
complicated.
       We consider an example where due to a fixing agreement the price of a single product, say a tablet computer,
 is higher in scenario a than in scenario b. For the alternative configurations of Ja, Jb, and ε, we estimate in Table
 2 the measures 𝐄𝐄β,σ,𝛆𝛆|𝑠𝑠,k MCE(s,k,β,σ,ε), 𝐄𝐄β,σ,𝛆𝛆|𝑠𝑠,k HCV(s,k,β,σ,ε), and 𝐄𝐄β,σ,𝛆𝛆|𝑠𝑠,k HEV(s,k,β,σ,ε) in a synthetic
 population, and the measure UMCE(s,k). Suppose the product J = 1 has price p1m in scenario m. Suppose the “no
 purchase” alternative has p0m = 0. Suppose consumers have utilities of the form (21) with v1m(I, β) = β1I + β2 – p1m
 for alternatives where the product is purchased, and v0m(I, β) = 0 for the “no purchase” alternative, for scenarios
 m = a,b. Then μ0(Ia,β) = 1 and μ1(Ia,β) = 1 + β1. The idiosyncratic noise cases we consider are (A) independent
 noise across scenarios, represented by Ja = (0,1} and Jb = {2,3}, with j = 0,2 corresponding to “no purchase” and j
 = 1,3 corresponding to “purchase”; (B) Ja = {0,1} and Jb = {0,3}, with j = 0 corresponding to a common “no
 purchase” and j = 1,3 corresponding to “purchase”; and (C) Ja = Jb = {0,1}, with j = 0 corresponding to a common
 “no purchase” and j = 1 to a common purchase. Suppose that β1 = 0.002 and σ = 9 are fixed parameters, and that
 β2 is normal with mean zero and standard deviation 60. The choice probabilities are then mixed logit, with P0m(I)
                 1
 = 𝐄𝐄β                         for non-purchase of the product j in scenario m. Suppose the consumer faces p1a = $110
         1+exp(vjm (𝐼𝐼,β)/σ)


                                                                               32
and p1b = $90, and the base income is I = $50,000. The probabilities of buying the product in a synthetic
population of 10,000 are P1a(50000) = 0.430, P1b(50000) = 0.555, and P1a(56000) = 0.505. These probabilities
imply an arc income elasticity of 1.45 and an arc price elasticity of -1.59 for the given market changes. The table
shows first that for this example, 𝐄𝐄β,σ,𝛆𝛆|𝑠𝑠,𝑠𝑠,k, MCE(s,k,β,σ,ε), 𝐄𝐄β,σ,𝛆𝛆|𝑠𝑠,𝑠𝑠,k, HCV(s,k,β,σ,ε), and 𝐄𝐄β,σ,𝛆𝛆|𝑠𝑠,k HEV(s,k,β,σ,ε)
estimated in the synthetic population are almost the same. This result is consistent with the conclusion of Willig
(1976) that income effects are typically small. The value of UMCE using an analytic expectation with respect to
ε differs modestly from the synthetic population estimate of 𝐄𝐄β,σ,𝛆𝛆|𝑠𝑠,𝑠𝑠,k,MCE(s,k,β,σ,ε), but the difference is well
within sampling error. The Marshallian consumer surplus, estimated here using the trapezoid rule, is nearly
identical to UMCE.



                                      Table 2. Comparisons of Welfare Measures ($pp)
                                                          Case A             Case B             Case C              𝛔𝛔 = 0
       Total Population
         Marshallian consumer surplus                      9.819             9.799              9.781               9.854
         UMCE (analytic E𝛆𝛆)                               9.848             9.858              9.802               9.840
         MCE (synthetic population)                        9.886             9.806              9.755               9.840
         HCV (synthetic population)                        9.883             9.803              9.753               9.837
         HEV (synthetic population)                        9.886             9.806               NC                 9.840
       Class of Product Purchasers
         UMCE (analytic E𝛆𝛆)                              18.568             18.283             19.960             19.960
         MCE (synthetic population)                       18.609             18.368             19.960             19.960
         HCV (synthetic population)                       18.610             18.368             19.960             19.960
         HEV (synthetic population)                       18.609             18.368               NC               19.960
       Class of Non-Purchasers
         UMCE (analytic E𝛆𝛆)                               3.305             3.535              2.180               2.240
         MCE (synthetic population)                        3.340             3.382              2.097               2.240
         HCV (synthetic population)                        3.335             3.375              2.093               2.235
         HEV (synthetic population)                        3.340             3.382               NC                 2.240


    The example suggests that UMCE will be an adequate approximation when 𝐄𝐄β,σ,𝛆𝛆|𝑠𝑠,ka HCV(s,k,β,σ,ε) is the
ideal measure. However, the closeness of UMCE and expected HCV is sensitive to the magnitude of the change
in price in the two scenarios, and larger changes can lead to a gap between these measures. In short, when
UMCE is used as an approximation to expected HCV, it is desirable to use synthetic population methods with
large samples to check the quality of the approximation.
    There is variation in the welfare measures when one moves from Case A with independent disturbances to
Case C with common disturbances. In particular, Cases A and B attribute less welfare gain to purchasers and

                                                                   33
 more welfare gain to non-purchasers than does Case C and a σ = 0 case with no idiosyncratic noise. Then, the
 assumptions made on the persistence of idiosyncratic errors across scenarios makes a difference.


                   Table 3. Effect of Idiosyncratic Noise on Distribution of Welfare Changes ($pp)
                        Case A                             Case B                              Case C
  UMCE       Buyers      Non-       Total      Buyers       Non-        Total      Buyers       Non-        Total
    at                  buyers                             buyers                              buyers
 σ=0         19.960     2.240      9.840       19.960       2.240      9.840       19.960       2.240      9.840
 σ=9         18.568     3.305      9.848       18.283       3.535      9.858       19.960       2.180      9.802
 σ = 36      13.641     6.943      9.895        5.046      14.057      10.086      19.960       1.683      9.737
 σ = 64      11.687     8.463      9.927       -9.086      25.560      10.370      19.960       1.224      9.734



   Table 3 continues the example with different scale factors σ, and shows that at high levels of σ relative to the
observed changes in the scenarios, the effects of selection on idiosyncratic noise can drastically alter the
distribution of welfare gains between purchasers and non-purchasers. We infer from this table that unless there
is compelling evidence to support the case (B) assumptions, they should be rejected in favor of case (A) or case
(C) assumptions that more closely approximate a model in which neoclassical tastes, heterogeneous across
consumers but durable within each consumer, describe choice behavior without significant added idiosyncratic
noise. Finally, there is a substantial advantage in simplicity for the analytic expectations coming out of the case
(A) compared to case (C), suggesting that case (C) be used only if there is persuasive evidence for durable
idiosyncratic noise.




6. DECISION-UTILITY VERSUS EXPERIENCED-UTILITY

    Decision-utility is defined as the objective function that the neoclassical consumer optimizes in making her
market choices, the function that can be recovered (with money-metric scaling) from sufficiently rich observations
on these market choices. The foundations of welfare theory restated in Section 3 assume that decision-utility is
a direct and complete measure of well-being. In reality, anticipated decision-utility and realized experienced-
utility can differ. The most straightforward case, covered by neoclassical theory, is decision-making under
uncertainty where the decision utility function equals the expectation over objective probabilities of a utility
function of outcomes, and the experienced utility function equals this utility function evaluated at the realized
outcome. For example, consumers may be uncertain about attributes of alternatives such as product durability,
so that buying a product is equivalent to buying a lottery ticket on its attributes. Under von Neumann-

                                                          34
Morgenstern assumptions on utility, sufficiently rich market observations on choice among risky prospects will
suffice to recover the utility function of outcomes.

    Beyond neoclassical decision-making under uncertainty, there are a number of factors that can cause gaps
between decision-utility and experienced-utility: (1) misperceptions of shrouded, ambiguous, or misleadingly
promoted product attributes, (2) unrealistic personal probability judgements on uncertain events, (3) whims and
psychometric noise that induce tremble in tastes, as in Thurstone (1927), (4) factors that influence the sensation
of well-being but do not influence market choices, such as provision of pure public goods and services, (5)
inconsistencies in preferences, such as time-inconsistent discounting and unanticipated habit-formation or
addiction, and (6) flaws in the process of utility maximization, such as reference point bias and hypersensitivity to
recent experience.

      When there are gaps between decision-utility and experienced-utility, which should be used to measure
well-being? Roughly, welfare measures based on decision-utility focus on equity in opportunity, while those based
on experienced-utility focus on equity in outcomes. It may seem evident that consumer perceptions and decision-
making in markets are simply instruments to achieve final outcomes, so experienced utility should be at the core
of welfare assessment. However, there are complicating factors. First, while decision-utility is arguably linked to
and recoverable from observed market behavior of consumers, there will often be no clear link between decision-
utility and experienced-utility, and no reliable method of recovering experienced-utility from economic or
psychological experiments. Then, it may be impossible to use experienced utility as a basis for evaluating transfers
or other policies designed to address inequitable outcomes. Second, when consumers are fully and accurately
informed about the prospects and contingencies they face, and there are sufficient contingent markets so that
they can insure against risks if they choose, then they have it in their own hands to make informed choices and
live with the consequences of these choices. Further, interventions based on experienced utility can introduce
“moral hazard” in which the anticipation of ex post remedies for bad outcomes leads consumers to take excess
risks and be less diligent in their decisions, particularly by failing to take steps to avoid or mitigate harm. Then,
for fully informed consumers facing complete contingent markets, policies should arguably be evaluated in terms
of decision-utilities. However, when consumers are poorly informed or lack opportunities to manage risks, ex
post equity is a social concern, and/or consumers are unable to look after their own interests, interventions by a
benevolently paternalistic regulator may be appropriate, with or without a basis in experienced utility.

   In general, it will be important to know how perceptions, decision utility, and experienced utility are linked.
Misperceptions of attributes and biased personal probabilities, listed above as sources (1) and (2) of gaps between


                                                           35
decisions and experience, do not substantially alter the neoclassical preference structure, and can in principle be
accounted for starting from decision utility and correcting these factors. For example, it should be straightforward
in principle to correct consumer misperceptions arising from supplier misrepresentation of product attributes. In
practice, identification and recovery of personal perceptions and probabilities may overburden market data and
require extra-market experimental observations.

   Instabilities in tastes arising from psychometric noise, source (3) above, also leaves many neoclassical elements
of choice in place. However, preference tremble creates a fundamental difficulty with welfare analysis: How to
measure welfare changes when preferences are not fixed. One tack is to simply take the preferences revealed in
“as is” decisions as yardsticks for welfare comparisons, and ignore shifts in “but for” tastes caused by tremble. An
issue here is that incorporating whims into the welfare calculus can make the results sensitive to selection effects,
as in the previous section. Another tack is to try to recover stable “core” preferences stripped of the tremble
introduced by transient whims and misperceptions. However, a measured distribution of preferences that is a
convolution of population heterogeneity and individual tremble will confound recovery of either component of
the convolution, making recovery of core preferences problematic unless one observes multiple choices for each
individual.

   Other elements entering experienced utility such as sources (4)-(6) of gaps between perceptions and
experience, particularly factors that leave no trace in market choices, can confound choice behavior so that there
may be no identifiable decision-utility or linked experienced utility that capture consumer well-being. Then
recovery of experienced-utility will be beyond the capacity of economists using customary market-based data.
Ben-Akiva, McFadden, and Train (2016) discuss experimental methods for direct elicitation of preference that
might be used in principle to address these identification and recovery tasks. Stated preference methods are
widely used in market research to forecast demand for new products and the value of extra-market resources,
with varying degrees of reliability; see McFadden (2017). An open question about measurement of well-being of
consumers who have behavioral elements in their decision-making and a gap between decision-utility and
experienced-utility is whether experienced utility could be elicited directly in conjoint analysis experiments, either
through experiments used to uncover the components of experienced utility, or through conjoint elicitation
methods such as elicitation of stated personal probabilities. Established experimental designs for such elicitations
are not available now, and there are major scientific challenges to their development, particularly known biases
in personal probability judgements and the problem of verification, but there will be high payoffs to future
scientific breakthroughs in these areas. Since the focus of this paper is welfare analysis using market observations,



                                                           36
this paper will not explore experimental, cognitive, or neurological approaches to direct measurement of well-
being.

     To facilitate analysis of the consequences of gaps between anticipation and experience, let superscript “d”
denote decision utility and superscript “e” denote experienced utility. From (20), choice in scenario m at income
                  d
I then maximizes vjm �𝐼𝐼, βd � + σεj ; let δjm(I, βd , σ, 𝛆𝛆) denote an indicator for this choice, and Pjm(I, βd , σ) the
                                            e
probability of this choice given βd,σ. Let vjm �𝐼𝐼, βd � + σεj denote the experienced utility obtained from choice j.
                                                 e                                d
The application will determine the structure of vjm (𝐼𝐼, βe ) and its linkage to vjm �𝐼𝐼, βd �, and the mapping from βd
to βe. 17 The decision utility and experienced utility from a choice situation with income I are, in this notation,

                                        d
 (37)     udm �𝐼𝐼, βd , σ� = 𝐼𝐼 + max �vjm �𝐼𝐼, βd � + σεj �
                                         j=0,…,Jm

and
                                    Jm                        e
 (38) uem �𝐼𝐼, βe , βd , σ� = 𝐼𝐼 + ∑j=0 δjm (𝐼𝐼, βd , σ, 𝛆𝛆)�vjm (𝐼𝐼, βe ) + σεj �

                                             Jm                        e               d
                       ≡ udm �𝐼𝐼, βd , σ� + ∑j=0 δjm �𝐼𝐼, βd , σ, 𝛆𝛆��vjm (𝐼𝐼, βe ) − vjm �𝐼𝐼, βd ��,

where experienced utility in the last expression equals anticipated utility plus a correction that comes from
differences in anticipated and realized attributes and tastes. Combined with (25) defining MCEd for decision-
utility, (38) implies the experienced-utility welfare measure, given (βd,βe,σ), and δka(𝐼𝐼, βd , σ, 𝛆𝛆) = 1 = δjb(𝐼𝐼, βd , σ, 𝛆𝛆),

(39)      µek (𝐼𝐼a , β) ∙ MCE e (𝑠𝑠, k, βe , σe , 𝛆𝛆𝐞𝐞𝐚𝐚 , 𝛆𝛆𝐞𝐞𝐛𝐛 , βd , σd , 𝛆𝛆d𝐚𝐚 , 𝛆𝛆db ) = µdk (𝐼𝐼a , β) ∙ MCE d (𝑠𝑠, k, βd , σd , 𝛆𝛆d𝐚𝐚 , 𝛆𝛆db )
                         e                 d                 e                 d
                      + vjb (𝐼𝐼b , βe ) − vjb �𝐼𝐼b , βd � − vka (𝐼𝐼a , βe ) + vka �𝐼𝐼a , βd � ,

where µek (𝐼𝐼a , β) is the marginal experienced utility of income.

     Economists should be very cautious in applying the traditional welfare calculus when decision-utility requires
behavioral factors to explain behavior; as transfers to maintain decision utility can have unreliable and unintended
effects on experienced well-being. If anticipated tastes are an unreliable guide to realized tastes, this is a challenge
to the foundations of welfare economics; see Lowenstein and Ubel (2008), Thaler and Sunstein (2003,2008),



                                                            d            e
17
   One case which is straightforward occurs when vjm           (𝐼𝐼) and vjm (𝐼𝐼) differ only because of differences in observed
                                                    d           e
anticipated and experienced product attributes, 𝑧𝑧jm and 𝑧𝑧jm , due to say false advertising of attributes, and βd = βe. Cases
that are more challenging for economic analysis occur when either anticipated or experienced attributes are unobserved, or
ve and vd differ due to optimization errors and volatility in tastes. In such cases, the analyst will often have no recourse other
than using extra-market observations such as experimental elicitation of stated preferences, with attendant questions of
reliability.

                                                                                     37
McFadden (2014), Train (2015), Bernheim (2016). There is currently no accepted general welfare theory for non-
neoclassical consumers who have shifts between anticipated and realized tastes, even though the random
decision-utility setup itself can accommodate many non-neoclassical elements. However, there may be some
special circumstances and assumptions that overcome this limitation. For example, differences in “as is” or “but
        d      d           e      e
for” (𝑧𝑧jm , 𝑝𝑝jm ) and (𝑧𝑧jm , 𝑝𝑝jm ) may be limited to identifiable misperceptions such as misinformation about product
attributes, and the joint distribution of anticipated and realized tastes may by assumption be generated through
limited differences such as personal misjudgments on the probabilities of contingent events or biases in risk
preferences and time discounts used in making decisions. If it is plausible that such limited shifts in tastes can be
fully described and modeled using specific external evidence, then welfare analysis based on (39) may be justified.

        An example of consumer behavior that appears to be distorted by unrealistic personal probability
judgements is consumer choice of health insurance policies. An argument, simplified from Heiss, McFadden, and
Winter (2013) and McFadden and Zhou (2015), shows that misperceptions can be identified and corrected in some
cases. Suppose consumers face stochastic medical expenses c, and have the subjective perception that these have
a distribution Kd(c) with a mean μd and variance sd2. Suppose they have a menu of insurance alternatives j = 0,…,J
with plan j characterized by a premium pj and a copayment rate rj, with p0 = 0 and r0 = 1. Suppose their decision-
utility is a money-metric transformation of a constant-absolute-risk-aversion (CARA) expected utility function,

                 −1      +∞
 (40)     uj =      ln ∫c=0 exp �−β�𝐼𝐼   − 𝑝𝑝j − rj 𝑐𝑐�� K d (d𝑐𝑐) + 𝜎𝜎εj ≡ I – pj – κd (βrj )/β + 𝜎𝜎εj ,
                 β


where I is income, κd is the cumulant generating function of Kd, β is a risk-aversion parameter with a probability
distribution in the population, and the parameter σ scales psychometric noise εj. Replacing the cumulant
generating function κd in (40) with a quadratic approximation gives a utility uj = I – pj – μdrj – ½sd2 βrj2 + 𝜎𝜎εj of the
form (21). Suppose (ln β,ln σ) is distributed bivariate normal, and the εj is i.i.d. EV1. Then observations on
consumer insurance choices in real or experimental markets allows estimation of the parameters of the bivariate
normal distribution, and μd, and sd2.        Observations on objective probabilities Ke(c) for health expenses allow
estimation of μe and se2. Then specialization of (40) using (41) and the quadratic approximations to the cumulant
generating functions κd and κe allow estimation of the money-metric loss in consumer utility arising from poor
choices due to misperception of medical expense risk.




                                                                 38
7. WELFARE CALCULUS FOR COMMON POLICY PROBLEMS

   Suppose mixed MNL choice probabilities of the form (22), along with the associated parameter α of a
population distribution of taste parameters F(β,σ|α) and a money-metric utility of the form (21), have been
estimated from choice data collected in real or hypothetical markets. Using these estimates, prospective benefit-
cost analysis using decision utility can be carried out by solving (24) or evaluating (25) for each consumer in a
synthetic population defined by draws of s , parameters (β,σ) from F(β,σ|s,α), and idiosyncratic noise ε. Measures
such as HCV, HEV, or MCE can then be averaged over the synthetic consumers falling into classes defined by
restrictions on s, with the law of large numbers operating to ensure reliable estimates of the net transfer to the
class that when optimally distributed leaves its members indifferent to the policy change. Alternately, one can
concentrate on estimating a UMCE measure (30) for this class. To simplify notation, suppress the “d” superscript
for decision utility. Let C denote the set of alternatives whose attributes are unchanged by a shift from policy a
to policy b. By construction, C is a proper subset of Ja and Jb which contain alternatives whose attributes do not
change, and C always contains at least j = 0. Then (30) can be rewritten as

                                                        𝐿𝐿𝐂𝐂a (𝐼𝐼a ,β,σ)
(41)        UMCE(s) ≡ 𝐄𝐄β,σ|𝑠𝑠 �𝐼𝐼b − 𝐼𝐼a + σ ∙ ln                       � /µ(𝐼𝐼a , β, σ)
                                                        𝐿𝐿𝐂𝐂b (𝐼𝐼b ,β,σ)


where LCm is the logit probability at random parameters (β,σ) of choice from C in scenario m. For example,
introducing a set B of new products with attributes included in (xb,pb), keeping unchanged the attributes of existing
products in C, is UMCEb(s) = 𝐄𝐄β,σ|𝑠𝑠 [𝐼𝐼b − 𝐼𝐼a – σ∙ln 𝐿𝐿𝐂𝐂b (𝐼𝐼b , β, σ)]/µ(𝐼𝐼a , β, σ).

   For small policy changes and Ja = Jb = J, a Taylor’s expansion of the first form of (41) in variations ∆vj ≡
vjb (𝐼𝐼b , β) − vja (𝐼𝐼a , β) ≡ ΔX j β − Δpj , where ΔXj ≡ X(Ib – pjb,rb,zjb) – X(Ia – pja,ra,zja) and Δpj ≡ pjb – pja, gives the
approximation,

                                                                                            2
(42)        UMCE(s) = 𝐄𝐄β,σ|𝑠𝑠 [𝐼𝐼b − 𝐼𝐼a + ∑j∈𝐉𝐉[𝐿𝐿ja (𝐼𝐼𝑎𝑎 , β, σ)Δvj + 𝑂𝑂(�Δvj � /𝜎𝜎)]]/µ(𝐼𝐼a , β, σ) .

Another useful approximation, due to Doug MacNair, applies the expansion ln(1 – y) = – y + O(y2) to (41) with LBb
= 1 – LCb and LAa = 1 – LCa the probabilities of choosing products whose attributes change, to obtain

(43)      UMCEb(s) = 𝐄𝐄β,σ|𝑠𝑠 [𝐼𝐼b − 𝐼𝐼a + σ ∙ [𝐿𝐿𝐁𝐁b (𝐼𝐼b , β, σ) − 𝐿𝐿𝐀𝐀a (𝐼𝐼a , β, σ) + 𝑂𝑂((1 − 𝐿𝐿𝐂𝐂m )2 ]]/µ(𝐼𝐼a , β, σ).

When σ and μ = µ(𝐼𝐼a , β, σ) are homogeneous in the population, (43) has a particularly simple form,

                              𝐼𝐼 −𝐼𝐼    𝜎𝜎
(44)        UMCEb(s) ≈ [ b𝜇𝜇 a +           𝐄𝐄 [𝐿𝐿 (𝐼𝐼 , β, σ)     − 𝐿𝐿𝐀𝐀a (𝐼𝐼a , β, σ)]],
                                        µ β|𝑠𝑠 𝐁𝐁b b



                                                                         39
the income difference scaled by μ plus the difference in the (σ/μ)-scaled full population market share of
consumers choosing the products affected by the policy change. For example, if a set A of products is “new” in
scenario b, and income and the attributes of the remaining products in C are unchanged, then UMCEb(s) ≈
𝜎𝜎
   ∙𝐄𝐄 𝐿𝐿 (𝐼𝐼 , β, σ)],           a scaled market share of the new products.
µ β|𝑠𝑠 𝐀𝐀b b


      Consider a policy that affects attributes and price of products, and let Xjλ = Xja + λΔXj, pjλ = pja + λΔpj, and Iλ =
Ia + λ(Ib – Ia) for λ ∈ [0,1] and j = 1,…,J denote a linear path that achieves this change. Let UMCEλ denote (41)
evaluated at point λ on this path. Let vjλ ≡ X jλ β − 𝑝𝑝jλ and 𝐿𝐿jλ = evjλ/𝜎𝜎 / ∑𝐢𝐢∈𝐉𝐉 eviλ /𝜎𝜎 . Then ∂vjλ/∂λ = ΔXjβ – Δpj,
and since the numerator of LCλ does not vary with λ,

                 d UMCEλ (𝑠𝑠)                               J
(45)                               = 𝐄𝐄β,σ|𝑠𝑠 [𝐼𝐼b − 𝐼𝐼a + ∑j=1 𝐿𝐿jλ �ΔXj β − Δ𝑝𝑝j �]/µ(𝐼𝐼a , β, σ).
                     dλ


Then the incremental change in UMCE is a demand-weighted average of the changes ΔX j β − Δ𝑝𝑝j in the systematic
components of utility. First, consider the common circumstance where ΔX j and Δ𝑝𝑝j do not depend on s; this will
be the case for example for a product offered in a national market where interactions of product attributes and
individual characteristics are not needed to explain choice behavior. Then, (45) reduces to

                d UMCEλ (𝑠𝑠)                                   J
 (46)                                                               � jλ − Δ𝑝𝑝j �𝐿𝐿jλ (𝐼𝐼𝜆𝜆 , β, σ)/µ(𝐼𝐼a , β, σ),
                                  = 𝐄𝐄β,σ|𝑠𝑠 [𝐼𝐼b − 𝐼𝐼a + ∑j=1�ΔX j β
                    dλ


                      𝐄𝐄β,σ|𝑠𝑠,α β𝐿𝐿jλ (𝐼𝐼𝜆𝜆 ,β,σ)
      � jλ =
where β                                              denotes the mean of β among consumers who choose j when the alternatives are
                      𝐄𝐄β,σ|𝑠𝑠,α Pj �𝐿𝐿jλ ,β,σ�

                                              � jλ gives WTP for attribute changes that translate directly into incremental
characterized by (𝐗𝐗 λ , 𝐩𝐩λ ). In this case, β
                                                                                                         � jλ is
compensating variation. In the special sub-case of changes that are uniform in j, Δ𝑥𝑥j = Δ𝑥𝑥1 for j ≠ 0, β
independent of j and is the mean of β among all buyers. In the special case that the relevant components of β are
                  � jλ = β in the corresponding components, and these coefficients are unequivocal measures
homogeneous, then β
of “part-worths”. More generally, obtaining β�jλ is a calculation that requires estimates of both F(β,σ|s,α) and
𝐿𝐿jλ (𝐼𝐼𝜆𝜆 , β, σ).

     Second, when the relevant components of β are homogeneous, but Δ𝑥𝑥j and Δ𝑝𝑝j are heterogeneous over s, (45)
reduces to

                 d UMCEλ (𝑠𝑠)
 (47)                                                        �����ȷ � ∙ β − �Δ𝑝𝑝
                                    = 𝐄𝐄β,σ|𝑠𝑠 �𝐼𝐼b − 𝐼𝐼a + �ΔX              ����ȷ � � /µ(𝐼𝐼a , β, σ),
                     dλ                                             λ                λ


so the relevant components of β give WTP for mean attribute changes among consumers choosing j when product
features are described by (𝐗𝐗 λ , 𝐩𝐩λ ). Third, when β is heterogeneous and the ΔXj are heterogeneous over the

                                                                                40
population (i.e., vary with s), the relationship between values of β and 𝐄𝐄β,σ|𝑠𝑠,α UMCEb (β, σ) is more complex; (42)
requires a calculation that handles selection driven by both consumer history and taste heterogeneity.

    The scaling parameter σ appears in (41) and (43) to have a prominent direct role in determining the level of
UMCE(s), but (42) indicates that this is offset elsewhere, so that the final impact of σ is only indirect, through its
influence on the choice probabilities. To see this more generally, write (41) as

                              1   dUMCEλ (𝑠𝑠)                                         1
 (48) UMCE(s) ≡ ∫λ=0                            dλ = 𝐄𝐄β,σ|𝑠𝑠 [𝐼𝐼b − 𝐼𝐼a + ∑j∈𝐉𝐉 ∫λ=0 𝐿𝐿jλ �ΔXj β − Δ𝑝𝑝j �dλ]/µ(𝐼𝐼a , β, σ).
                                     dλ


This is a line integral over the rectifiable path of the area behind the demand functions for the products in A
between the old and new vectors of quality-adjusted net values, which is the Mashallian consumer surplus
associated with the change from policies a to b; (48) depends on σ only through its influence on the acuity of
consumer response to price changes. These price effects are usually bounded even when there is a positive
                                                                                                                               vjλ
                                                                                                                        exp(         )
probability of very small σ. Recall that the own price elasticity of a MNL probability Ljλ =                                   σ
                                                                                                                                v        equals
                                                                                                                      ∑i∈𝐉𝐉 exp( iλ )
                                                                                                                                 σ

−𝑝𝑝jλ (1−𝐿𝐿jλ )
      σ
                   . Use the inequality e-c/σ ≤ σ/c for c > 0. If ck = max (vjλ − vkλ ) > 0, then Lkλ is bounded above by σ/ck,
                                                                         j=0,…,J

and if c-k ≡ min ci > 0, then 1 – Lkλ is bounded by Jσ/c-k. Then the price elasticity is bounded in magnitude by
                     i≠k

max{pkλ/ck,Jpkλ/c-k} no matter how small σ. The limited sensitivity of (48) to σ is also seen by considering limiting
cases. For constant σ ⟶ 0, UMCE(s) ⟶ 𝐄𝐄β,σ|𝑠𝑠 {min vjλ − min vja }/µ(𝐼𝐼a , β, σ), and for σ ⟶ +∞, UMCE(s) ⟶
                                                                  j∈𝐉𝐉         j∈𝐉𝐉
            1
𝐄𝐄β,σ|𝑠𝑠          ∑j∈𝐉𝐉{vjλ − vja }/µ(𝐼𝐼a , β, σ). The difference in these expressions comes only from the difference between
           |𝐉𝐉|

least and average quality-adjusted net values, reflecting two extremes in the acuity of consumers in gravitating to
alternatives with the greatest quality-adjusted net values.

    Next consider retrospective welfare analysis that quantifies the harm to consumers from a past “as is” scenario
a compared to a “but-for” scenario b in which product attributes are changed by altering attributes or seller
conduct judged defective or improper. By its nature, retrospective analysis deals with loss of experienced utility,
and with compensating transfers to make consumers whole after their “as is” choices have been made, so that
experienced-utility MCE rather than HCV or HEV is the target of the analysis, even if choices are influenced by
neoclassical income effects. The analysis in these applications is focused on objective changes in product
attributes rather than shifts in consumer tastes, so it is reasonable to assume that the decision-utility and
experienced-utility tastes are the same, and that in most cases Ia = Ib, so that any gap between decision utility and
                                               d       e
experienced utility comes from differences in zjm and zjm . Then experienced utility MCE is given by (39), with


                                                                         41
                                                                                               d
MCEd given by (25). The circumstances of the application will determine the configurations of vjm (𝐼𝐼, β, σ) and
 e
vjm (𝐼𝐼, β, σ) that prevail. A critical question is whether consumers are fully and accurately informed about the
attributes of products in both the “as is” and “but for” scenarios, or whether the issue is misinformation or
deception on product attributes in the “as is” scenario.

   The first case we consider is one in which consumers have full information on the available products under
both “as is” and “but for” conditions. One example is anti-trust litigation in which the question is the harm to
consumers caused by improper supplier conduct such as price collusion, market allocation, bundling, or artificial
barriers to entry. Other examples are environmental litigation in which the question is the harm caused by
improper disposal of hazardous wastes, and patent litigation in which the question is the value to consumers of
                                                                                 d             e
infringing features. With full information, anticipations are realized, so that vjm (𝐼𝐼, β) = vjm (𝐼𝐼, β) for m = a,b. In
many applications, the class of consumers of interest is not the general population, but individuals meeting
specific conditions, such as residence in a specified region. If the class is defined by consumer characteristics s in
a set T, and either the “as is” choice is unobserved, or it is observed but Ja∩Jb = ∅, then the per capita transfer
prescribed for this class is

                                              𝐿𝐿𝐂𝐂a (𝐼𝐼a ,β,σ)
 (49)     UMCE(𝐓𝐓) = 𝐄𝐄s|𝐓𝐓 𝐄𝐄β,σ|𝑠𝑠 σ ∙ ln   𝐿𝐿𝐂𝐂b (𝐼𝐼b ,β,σ)
                                                               /µ(𝐼𝐼a , β, σ).


   Next consider cases where consumers are misinformed about products in the “as is” scenario 1, due to failure
to deliver goods as promised, or to deceptive advertising, resulting in experienced utility that deviates from
anticipated utility, an application studied by Chorus and Timmermans (2009), Alcott (2013), Schmeiser (2014), and
                                                                                                d d                e      e
Train (2015). In these cases, consumers are fully informed in scenario b. Then, J = Ja = Jb, (𝑧𝑧ja , 𝑝𝑝ja ) and (𝑧𝑧ja , 𝑝𝑝ja )
                                                                                                 d d                e      e
are different for j in a set of products D where the misinformation occurs in scenario a, but (𝑧𝑧ja , 𝑝𝑝ja ) and (𝑧𝑧ja , 𝑝𝑝ja )
                       d      d           e      e
agree for j ∉ D and (𝑧𝑧jb , 𝑝𝑝jb ) and (𝑧𝑧jb , 𝑝𝑝jb ) agree for all j. Continue to assume that anticipated and experienced
taste parameters are the same. There are two leading possibilities for defining the “but for” scenario: the
benchmark “but for” net values can match either the anticipated decision-utility net values when the anticipation
is accurate, or match the realized utility net values when these net values are correctly anticipated in the “as is”
scenario. The former benchmark applies to contract violations, where the violator is obligated to provide the
promised product or equivalent compensation. The latter benchmark arguably applies to false advertising cases
where the “but for” scenario correctly informs consumers of the actual product attributes, so that anticipations
are realistic.




                                                                          42
   In the contract violation case, the “but for” net values are defined to match what consumers anticipated in the
                         e             d             d                          e             d
“as is” situation. Then vjb (𝐼𝐼, β) = vjb (𝐼𝐼, β) = vja (𝐼𝐼, β) for all j, but vja (𝐼𝐼, β) ≠ vja (𝐼𝐼, β) for j ∈ D. The appropriate
metric for comparing consumer welfare under the “as is” and the “but for” scenarios for consumers with the
observed “as is” choice k is the experienced MCE, which becomes

                                         d                         e
 (50)    MCE e (𝑠𝑠, k, β, σ, 𝛆𝛆) = �max�vjb (𝐼𝐼b , β) + σεjb � − [vka (𝐼𝐼a , β) + σεka ]� /µk (𝐼𝐼a , β)
                                      j∈𝐉𝐉

               = {max�vjb
                       d                            d
                          (𝐼𝐼b , β) + σεkb � − max�vja                       d
                                                       (𝐼𝐼a , β) + σεja � + vka              e
                                                                                (𝐼𝐼a , β) − vka (𝐼𝐼a , β)}/µk (𝐼𝐼a , β).
                    j∈𝐉𝐉                                      j∈𝐉𝐉


                                                                   d               e
If εa = εb, this expression reduces to MCE e (𝑠𝑠, k, β, σ, 𝛆𝛆) = {vka (𝐼𝐼a , β) − vka (𝐼𝐼a , β)}/µk (𝐼𝐼a , β), the scaled difference
in the anticipated and realized net value for the chosen alternative. Even without the last assumption,

                                          d               e
 (51)        UMCEe (𝑠𝑠, k) = 𝐄𝐄β,σ|𝑠𝑠,k (vka (𝐼𝐼a , β) − vka (𝐼𝐼a , β))/µk (𝐼𝐼a , β).

Selection again enters the calculation of UMCE for a class of consumers. For consumers with s ∈ T and observed
“as is” choices in a set D,

                                𝐄𝐄s|T 𝐄𝐄β,σ|𝑠𝑠 ∑k∈𝐃𝐃 𝐿𝐿ka (𝐼𝐼a ,β,σ)∙[vd              e
                                                                       ka (𝐼𝐼a ,β) − vka (𝐼𝐼a ,β)]/µk (𝐼𝐼a ,β)
 (52)        UMCE e (𝑠𝑠, k) =                            𝐄𝐄s|𝐓𝐓 𝐄𝐄β,σ|𝑠𝑠 𝐿𝐿𝐃𝐃𝐃𝐃 (𝐼𝐼a ,β,σ)
                                                                                                                 .


These per capita transfers can be applied separately to disjoint D sets, or combined into a weighted average of
the form (52) to give a uniform transfer for all consumers in C whose scenario a purchases are from D. Since only
consumers who choose an alternative in subset D experience any difference between anticipated and realized net
values, the numerator of (52) is the expected compensating variation per capita for all consumers with
characteristics in T, while the denominator is the share of the population with characteristics in T and scenario a
                                 d                  e
choices in D. In (56), commonly vka (𝐼𝐼a , β, σ) ≥ vka (𝐼𝐼a , β, σ) for all tastes. However, it is possible that there are
tastes appearing in reality, or in the utility model approximation to it, that lead to some “as is” winners with
 d                  e
vka (𝐼𝐼a , β, σ) < vka (𝐼𝐼a , β, σ). This raises two issues, first whether the transfers should be calculated including or
excluding winners in the calculation of the aggregate needed to make losers whole. The argument hinges on
whether the distribution fulfilling the aggregate transfer can in principle claw back gains from winners to
compensate losers; if not, the calculation should exclude winners. A related issue is that it may be impossible to
distinguish winners and losers in the class of consumers in C and D, in which case the per capita calculation
excluding winners but applied to both losers and winners gives an unwarranted transfer to winners.




                                                                                    43
    In the second case, with false advertising or other misinformation about alternatives’ actual attributes, the
MCE is the difference between the realized utility obtained from (i) the alternative the person chose when
misinformed and (ii) the alternative the person would have chosen if fully informed. If the chosen alternative is
the same in the “but for” and “as is” scenarios, then MCE e (𝑠𝑠, k, β, σ, ε) = 0; i.e., there is no loss for consumers
whose choice was unaffected by the misinformation. Since the “but for” anticipated net values are defined to
                                                                                e                  d
match the net values that consumers realized in the “as is” situation, one has vkb (𝐼𝐼a , β, σ) = vkb (𝐼𝐼a , β, σ) =
 e
vka (𝐼𝐼a , β, σ) for all k. Given εa = εb, the experienced-utility MCE has the form (51) specialized to this relation among
the net values:


 (53)    UMCE e (𝑠𝑠, k)
                                                          J
                                                          b exp�ve (𝐼𝐼 ,β,σ)⁄σ�
                                    σ                   ∑k=0     ka a                             d                  e
          =   𝐄𝐄β,σ|𝑠𝑠,k �max � (𝐼𝐼 ,β,σ) ∙        ln     J
                                                          a exp�vd (𝐼𝐼 ,β,σ)⁄σ�
                                                                                          , 0� + vja (𝐼𝐼a , β, σ) − vja (𝐼𝐼a , β, σ)� /µ(𝐼𝐼a , β, σ).
                               𝐿𝐿ja a                   ∑k=0     ka a




Again, it is normal in false advertising situations (but not necessarily for all forms of misinformation) that
 e                  d
vka (𝐼𝐼a , β, σ) ≤ vka (𝐼𝐼a , β, σ). Then (53) is less than (51); i.e., the transfer is lower when the “but for” scenario
consists of providing the correct information that leads anticipated and realized utilities to agree than when the
“but for” scenario consists of providing consumers with their anticipated utilities. When there are tastes such
      e            d
that vka (𝐼𝐼a ) > vka (𝐼𝐼a ), so that these consumers win from the misrepresentation, there is again a question of
whether they should be included or excluded in the calculation of the per capita transfer.

   Analogously to (52), in the class of consumers with characteristics in T who chose alternative J in scenario a,

 (54)      𝐄𝐄ε|β,σ,,𝛿𝛿Ja(𝐼𝐼a)=1 MCE e (β, σ, ε)
                                                                                                                     J2        e
                                                                                                                     ∑     exp�vka (𝐼𝐼a ,β)⁄σ�
                         𝐄𝐄s|𝐓𝐓 𝐄𝐄ζ|𝑠𝑠 PJa (𝐼𝐼a ,β,σ)∙� vaj1 (𝐼𝐼a ,β)− vrj1 (𝐼𝐼a ,β)�+𝐄𝐄ε|β,σ,,𝛿𝛿Ja (𝐼𝐼a )=1 max�σ∙ln Jk=0      d
                                                                                                                                               ,0�/µ(𝐼𝐼a ,β,σ)
                                                                                                                    ∑ 1 exp�vka (𝐼𝐼a ,β)�σ�
                     =                                                                                               k=0
                                                                                                                                                             .
                                                                          𝐄𝐄ε|β,σ,,𝛿𝛿Ja (𝐼𝐼a )=1 P𝐉𝐉𝐉𝐉 (𝐼𝐼a ,β,σ)




   Retrospective welfare analysis for consumer durables whose attributes are affected by contract violations or
deceptions can require a combination of the preceding calculations. For example, consider homeowners whose
properties lose value due to groundwater contamination from an industrial site, or automobile owners whose
vehicles fail to deliver promised performance after correction of defective emission controls, and lose resale value
as a result. Then members of the class of owners of the affected durables at the time the defect is announced are
harmed in the amount given by (51) if they are legally entitled to a non-defective product, as in the case of


                                                                                   44
environmental injury, or given by (53) if they are legally entitled only to the opportunity to make a product choice
with the correct information, as in the case of false advertising. Further, as long as there is no further contract
violation or deception following the announcement, the harm is fully capitalized in the resale value of the durables
and these calculations conclude the calculation of harm. Pre-announcement owners who choose to continue to
hold their durables have willingly declined the opportunity to mitigate their losses by selling, and post-
announcement buyers who find that the lower price offsets the reduced performance are not harmed.




8. AN ILLUSTRATIVE APPLICATION

     An empirical example of applied welfare analysis using the methods of this paper, due to Kenneth Train (2015),
examines the impact on consumers of video streaming services that share customers’ personal and usage
information without their prior knowledge. This analysis is based on choice models estimated using data from a
conjoint experiment designed and described by Butler and Glasgow (2015). Each choice experiment included four
alternative video steaming services with specified price and the attributes listed in Table 4 plus a fifth alternative
of not subscribing to any video streaming service.

     Each of 260 respondents was presented with 11 choice experiments. The choice model was of the form (9)
for money-metric utility, with (β,ln σ) having a multivariate normal distribution. Estimates obtained using
maximum simulated likelihood are given in Table 5. The results indicate that people are willing to pay $1.56 per
month on average to avoid commercials. Fast availability is valued highly, with an average WTP of $3.95 per
month in order to see TV shows and movies soon after their original showing. On average, people prefer having a
mix with more TV shows and fewer movies, but the mean is not significantly different from zero. Average
willingness to pay for more content of both kinds is $2.96 per month. Interestingly, people who want fast
availability tend to be those who prefer more TV shows and fewer movies: the correlation between these two
WTP’s is 0.51, while the correlation between WTP for fast availability and more content of both kinds is only 0.04.
Apparently, the desire for fast availability mainly applies to TV shows. 18




18
  The model was also estimated using an Allenby-Train hierarchical Bayes method, with similar results; the details of both
estimation methods are given in Bhat (2001); Train (2000, 2009, 2015), and Ben Akiva, McFadden, and Train (2016).

                                                             45
                                              Table 4. Non-Price Attributes
       Attribute                    Levels
       Commercials shown            Yes (“commercials’)
        between content             No (baseline category)
       Speed of content             TV episodes next day, movies in 3 months (“fast content”)
        availability                TV episodes in 3 months, movies in 6 months (baseline category)
       Catalogue                    10,000 movies and 5,000 TV episodes (“more content”)
                                    2,000 movies and 13,000 TV episodes (“more TV/fewer movies”)
                                    5,000 movies and 2,500 TV episodes (the baseline category)
       Data-sharing policies        Information is collected but not shared (baseline category)
                                    Usage information is share with third parties (“share usage”) 19
                                    Usage and personal information are shared with third parties (“share
                                         usage and personal”)

                          Table 5A. MSL Estimates of WTPs for Video Streaming Services
                                                     Population Mean            Std Dev in Population
                                                  Estimate      Std Error       Estimate     Std Error
               Ln(1/σ)                             -2.002        0.0.945         1.0637       0.0755
               WTP for:
                  Commercials                      -1.562         0.4214         3.940          0.5302
                  Fast Availability                 3.945         0.4767         3.631          0.4138
                  More TV, fewer movies           -0.6988         0.4783         4.857          0.5541
                  More content                      2.963         0.4708         2.524          0.4434
                  Share usage only                -0.6224         0.4040         2.494          0.4164
                  Share personal and usage         -2.705         0.5844         6.751          0.7166
                  No service                       -27.26          2.662         19.42           2.333


                                         Table 5B. Correlation Point Estimates
                                          (* denotes significance at 5% level)
                         Commer-         Fast      Mostly      Mostly        Share           Share          No
                           cials         Avail-     TV         movies        usage          personal      service
                                        ability                                            and usage
        Ln(1/σ)          -0.5813*      -0.1371    0.0358      0.0256        0.0022       -0.1287         0.2801*
        Commercials      1.0000        0.1172     -0.3473*    0.0109        -0.2562      -0.0079         -0.4108*
        Fast                           1.0000     0.8042*     -0.4019*      -0.3542*     -0.4206*        0.2391*
         Availability
        Mostly TV                                 1.0000      -0.5890*      -0.1695      -0.3328*        0.4616*
        Mostly movies                                         1.0000        0.5141*      0.5181*         -0.0147
        Share usage                                                         1.0000       0.9370*         -0.0563
        Share personal                                                                   1.0000          -0.0975
         and usage
        No service                                                                                       1.0000




19
   Butler and Glasgow use the terms “non-personally identifiable information (NPPI)” and “personally identifiable
information (PII)” for what we are labelling “share usage” and “share usage and personal”.

                                                             46
   Consider how a video streaming service might share its subscribers’ personal and usage information with third
parties who then use that information for targeted marketing to the subscribers. The Table 5 estimates imply that
consumers have an average WTP of 62 cents per month to avoid having their usage data shared in aggregate form;
however, the hypothesis of zero average WTP cannot be rejected. Consumers are much more concerned about
their personal information being shared along with their usage information: The average WTP to avoid such
sharing is $2.71 per month. The correlation between WTP to avoid the two forms of sharing is a substantial 0.937.
However, some people like having their data shared, because they value the targeted marketing that they receive
as a result of the sharing. In the demand model, the WTP is normally distributed with a mean of -2.71 and standard
deviation of 6.751, which implies that 34.4% of the population like to have their information shared.

    For the welfare analysis, there are three providers, Netflix, Amazon Prime, and Hulu, and that customers can
subscribe to any one of these services, any combination of them, or to no service. Table 6 gives the “as is”
alternatives available to customers, and the shares of customers in the sample who chose each alternative. At
the time of the survey, Hulu had about 6 million subscribers, which, given the market shares above, imply that
total market size is 31 million potential subscribers. This is less than the number of households in the US because
the survey screened for people who either already subscribe, or were likely to subscribe, to a video-screening
service if they did not currently have one. The market is then the US households who are open to the possibility
of subscribing to a video streaming service.

                          Table 6: Market Shares of Video Steaming Service Portfolios
                                 Alternative                            Share
                                 Netflix                                0.2867
                                 Amazon Prime                           0.0467
                                 Hulu                                   0.0400
                                 Netflix + Amazon Prime                 0.1167
                                 Netflix + Hulu                         0.0700
                                 Amazon Prime + Hulu                    0.0100
                                 Netflix + Amazon Prime + Hulu          0.0733
                                 No video streaming service             0.3567

   In the “as is” scenario, customers think that none of the service providers shares their usage and personal
information, but in fact one of them does. The analysis chooses Hulu as the one who shares, but the selection is
arbitrary. How much are consumers hurt by the fact that Hulu shared its subscribers information without their
knowing beforehand, and how much would Hulu be liable for under different theories of damages?



                                                          47
     Assume for the welfare analysis that when people were choosing among services, they anticipated that these
services would have the attributes given in Table 7. Note that none of the providers were thought to share their
subscribers’ information.

                                Table 7: Anticipated Attributes for Decision Utility
                                                           Netflix        Amazon           Hulu
                                                                           Prime
                          Price per month                   7.99            6.58           7.99
                            Commercials                       0               0              0
                           Fast Availability                  0               0              1
                       More TV, fewer movies                  0               1              0
                            More content                      1               0              0
                          Share usage only                    0               0              0
                      Share personal and usage                0               0              0

The attributes of the alternatives that represent multiple services are the sum of the attributes of the services
within the packages. For example, the price of Netflix+Amazon Prime is $14.67 per month and provides the “More
content” of Netflix and the “MoreTV, fewer movies” of Amazon Prime. Alternative specific constants were
calibrated such that the predicted shares for the alternatives equal the observed shares in Table 7.

   Now suppose that, in reality, Hulu shared its subscribers’ personal and usage information, and that this fact
was revealed months after people began subscribing. The experienced utility is based on the attributes in Table 7
except that “Share personal and usage” receives a 1 for Hulu. What is the difference between the welfare that
people expected to obtain when they made their choices compared to the welfare they actually obtained? Only
Hulu subscribers obtained experienced utility that differed from decision utility. The aggregate difference is $22.9
million per month, or $3.81 on average for Hulu subscribers. Note that, for the population as a whole, the average
WTP to avoid sharing is $2.71, as stated above. The average WTP conditional on having subscribed to Hulu is $3.81.
That is, the average Hulu subscriber dislikes sharing their information more than the average person in the
population does. How does this arise? Note in Table 5B that the correlation between the WTPs for between “Fast
Availability” and Share personal and usage” is -0.42. Hulu is the only service that offered Fast Availability, and so
people who valued this attributed tended to choose Hulu. However, the people who place a high value on Fast
Availablity also tend to dislike sharing their information more than other people. The difference between the
conditional mean of $3.80 and the unconditional mean of $2.71 arises because of this correlation.

     The damages that Hulu would need to pay in compensation for its sharing of its subscribers’ information
depends critically on what was illegal: was it illegal for Hulu to share its customers’ information, or was it illegal


                                                           48
for Hulu not to disclose that it was doing so. If it was illegal for Hulu to share its subscribers’ information, then
the aggregate damage that Hulu is responsible for is $22.9 million for each month that the sharing had been
undisclosed. However, some customers like having their data shared, and this aggregate nets their gains from the
losses that people who dislike sharing incurred. To obtain Pareto neutral compensation on a person-by-person
basis, the $22.80 would not be enough to compensate the people who were hurt by the sharing: the people who
liked the sharing would need to contribute their gains too. We can calculate the welfare impact separately for
people who like sharing and people who dislike sharing. Among the Hulu subscribers who have a negative WTP
for sharing, the aggregate loss in welfare is $30.4 million. Hulu subscribers who have a positive WTP for sharing
obtained an aggregate gain of $7.50 million. For Hulu to be able to compensate the people who were hurt from
its sharing, Hulu would need to pay $30.4, since it does not have the ability to claw back compensation from the
people who gained.

   Next suppose information sharing is legal, but nondisclosure is Illegal. If Hulu is liable for nondisclosure, then
the relevant comparison is between
        (i)        the utility that consumers obtained in the “as is” situation, where they choose among the
                   alternative under the concept that Hulu did not share but it in fact did; this is the realized
                   utility for the alternative that the person chose based on decision utilities, and
        (ii)       the utility that consumers would have obtained Hulu had disclosed its sharing practice
                   before customers choose among the services; this is the realized utility that the customer
                   would choose based on realized utilities.

Every Hulu subscriber who likes sharing would have chosen Hulu if they had known in advance that it shared
information. And some of the Hulu subscribers who dislike sharing would still have chosen Hulu if they had known
that Hulu shared their information. None of these subscribers were hurt by the nondisclosure. The only Hulu
subscribers who were hurt by the nondisclosure are those who dislike sharing sufficiently that they would not
have chosen Hulu if they had known the sharing practice. However, the welfare losses from non-disclosure are
not borne only by Hulu subscribers. People who like sharing but didn’t know that Hulu shares and chose a different
provider were potentially hurt because they were not able to take advantage of this undisclosed attribute of Hulu
service. People who would have chosen Hulu if they had known that Hulu shares but didn’t obtained less welfare
than they would have obtained under full disclosure. Table 8 gives the losses for each group of consumers from
the non-disclosure of Hulu’s sharing practice.




                                                           49
                                 Table 8: Damages Arising from Non-Disclosure




                                                                        Average loss per




                                                                                                              people who did
                                                                                           Average loss for




                                                                                                              Average loss for
                                                in million $ per
                                                Aggregate loss,




                                                                                                               not subscribe
                                                                          person in the




                                                                                             subscribers




                                                                                                                  to Hulu
                                                                             market
                                                    month




                                                                                                Hulu
  All people                                           16.5                     0.53              2.16              0.14
  People who dislike sharing                           13.0                     0.64              3.05              0.00
  People who like sharing                               3.5                     0.33              0.00              0.39



The total loss is $16.5 million per month, which consists of $13.0 million loss to people who dislike sharing and
3.55 loss to people who like sharing. The $13.0 million loss was incurred by Hulu subscribers who dislike sharing
sufficiently to not choose Hulu if they had known its sharing practices. The $3.5 million loss was incurred by people
who did not subscribe to Hulu but like sharing sufficiently to have chosen Hulu if they had known its sharing
practices. The average loss per person in the population is simply the aggregate loss divided by market size (31
million). The average loss for Hulu subscribers can best be explained by starting in the bottom row of Table 10.
Hulu subscribers who like sharing their information incurred zero harm from the nondisclosure: they subscribed
to Hulu and so obtained the benefits of the sharing even though they didn't realize beforehand that they would.
Importantly, they also did not gain from the nondisclosure. They obtained greater welfare from Hulu than they
had expected when they chose Hulu. But they obtained the benefits of sharing even without prior disclosure,
which would not have changed anything for them. Hulu subscribers who dislike sharing were hurt by $3.05 on
average. Not all Hulu subscribers who dislike sharing were hurt by the non-disclosure. Only those who would not
have chosen Hulu if they had known of its sharing practices were hurt, and these people were hurt by more than
$3.05 on average (since the $3.05 average include Hulu subscribers who dislike sharing but were not hurt from
the nondisclosure since they still would have chosen Hulu.) The top row in Table 10 gives a loss per Hulu subscriber
of $2.16: it is the average of the $3.05 in the second row and $0.00 in the third row, weighted by the share of Hulu
subscribers who dislike and like sharing. The losses for people who did not subscribe the Hulu are analogous.
People who dislike sharing and did not subscribe to Hulu incurred no loss, since they would not have chosen Hulu
if its sharing practices had been disclosed. Some people who did not subscribe to Hulu but like sharing would
have chosen Hulu if they had known that Hulu shared their information. These people obtained less utility that
they could have obtained under full disclosure.
     In the “as is” situation, 19.3 percent of people in the market subscribed to Hulu. If everyone had been
informed about Hulu’s sharing practice, then this share would have dropped to 16.0 percent, which is a 17 percent

                                                                   50
reduction in subscribers. However, as explained above, this change includes two different movements: the share
drops because some Hulu subscribers would not have chosen Hulu if they had known that Hulu would share their
information, and the share rises because some people who did not subscribe to Hulu would have subscribed if
they had known. Table 9 gives the share of people in each group. 12.5% of people subscribed to Hulu and would
still have also done so if the sharing practice had been disclosed. 6.8% subscribed to Hulu but would not have if
they had known about its sharing practice. That is, about a third of Hulu’s subscribers would have not subscribed
if they had been informed. 3.5% of people did not subscribe to Hulu but would have done so if they had known
that Hulu shares their information.

                               Table 9: Choice Shares without and with Disclosure
                                Would have subscribed to         Would not have subscribed        Total
                                Hulu if its sharing practices    to Hulu if its sharing
                                had been disclosed               practices    had    been
                                                                 disclosed
  Subscribed to Hulu                        0.125                          0.068                     0.193
  Did not subscribe to Hulu                 0.035                          0.772                     0.807
  Total                                     0.160                          0.840

The share of people who subscribed to Hulu was 19.3%. If its sharing practices had been disclosed, then the share
of subscribers would have been 0.193-0.068+0.035 = 0.16, i.e., 16 % as stated above.




9. CONCLUSIONS

   This paper provides a foundation for applied welfare analysis of product regulation or compensation for
product defects. It gives a practical setup for money-metric indirect utility functions whose features can be
estimated using data on choice in real or hypothetical markets, and shows that there is essentially no loss of
generality in restricting analysis to this setup. It draws a distinction between prospective and retrospective policy
applications, and between cases where compensating transfers are hypothetical or are actually fulfilled. It
introduces a Market Compensating Equivalent (MCE) welfare measure, an updated version of Marshallian
consumer surplus, and shows that when compensating transfers are not actually fulfilled, it is preferred to
commonly prescribed Hicksian compensating or equivalent variations. Further, MCE is shown to have desirable
computational and aggregation properties. The problem of carrying out welfare calculations when tastes of
individual consumers are only partially observed is addressed, and computational formulas are given for
calculation of expected compensating transfers. Decision-utility and experienced-utility are distinguished, and


                                                           51
the issues of conducting welfare calculus in experienced utility are discussed. A number of common welfare
calculus problems are treated, and formulas are given for their resolution. Finally, an application illustrates the
use of these methods and the importance of the distinctions introduced in this paper.


REFERENCES
Afriat, S. (1967) “The construction of utility functions from expenditure data,” International Economic Review, 8, 67-77.
Alexandrov, A. (1939) “Almost everywhere existence of the second differential of a convex function and surfaces connected
    with it,” Lenningrad State University Annals, Mathematics Series 6;3-35.
Aliprantis, C.; K. Border (2006) Infinite dimensional Analysis, Springer: Berlin.
Allcott, H., (2013) “The welfare effects of misperceived product costs: data and calibrations from the automobile market.”
     Am. Econ. J.: Econ. Policy 5 (3), 30–66.
Anas, A. and C. Feng (1988) “Invariance of Expected Utilities in Logit Models,” Economic Letters 27:1, 41-45.
Arrow, K. (1950) “A difficulty in the concept of social welfare,” Journal of Political Economy, 58.4, 328-346.
Ben-Akiva, M.; D. McFadden: K. Train (2016) “Foundations of Stated Preference Elicitation: Consumer Behavior and Choice-
    Based Conjoint Analysis,” University of California, Berkeley, working paper.
Bentham, J. (1789) An introduction to the principles of morals and legislation, Oxford: The Clarendon Press, 1876.
Bergson, A. (1938) “A reformulation of certain aspects of welfare economics,” Quarterly Journal of Economics, 52.2, 310-334.
Bernheim, D. (2016) “The Good, the Bad, and the Ugly: A Unified Approach to Behavioral Welfare Economics,” Journal of
    Benefit Cost Analysis,, 7.1, 12-68.
Bhattacharya, D. (2015) “Nonparametric Welfare Analysis for Discrete Choice,” Econometrica, 83.2, 617-649.
Bhattacharya, D. (2017) “Empirical Welfare Analysis for Discrete Choice: Some General Results,” Cambridge University
    working paper.
Blackorby, C.; R. Boyce; R. Russell (1978) “Estimation of demand systems generated by the Gorman Polar Form,”
    Econometrica, 46, 345-364.
Border, K. (2014) “Monetary Welfare Measurement,” Cal Tech lecture notes.
Chipman, J.; J. Moore (1980) "Compensating Variation, Consumer's Surplus, and Welfare," American Economic Review. 70:
    933-49
Chipman, J.; J. Moore (1990) "Acceptable Indicators of Welfare Change, Consumer's Surplus Analysis, and the Gorman Polar
    Form," in D. McFadden, M. Richter (eds) Preferences, uncertainty, and optimality: Essays in honor of Leonid Hurwicz.
    Boulder and Oxford: Westview Press; 68-120.
Chorus, C.G., H. Timmermans (2009) “Measuring user benefits of changes in the transport system when traveler awareness
    is limited,” Transportation Research Part A , 43(5), 536-547.
Conniffe, D. (2007) “A Note on Generating Globally Regular Indirect Utility Functions,” Journal of Theoretical Economics, 7.1,
    1-11.
Dagsvik, J.; A. Karlstrom (2005) “Compensating Variation and Hicksian Choice Probabilities in Random Utility Models that are
    Nonlinear in Income,” Review of Economic Studies, 72.1, 57-76.
Deaton, A.; J. Muellbauer (1980) “An almost ideal demand system,” American Economic Review, 70, 312-326.
Debreu, G. (1959) Theory of Value, New Haven : Yale University Press.
Diamond, P. and D. McFadden (1974), “Some uses of the expenditure function in public finance,” Journal of Public Economics
    3.1 3-21.
Doha, E. H.; A. H. Bhrawy; M. A. Saker (2011) “On the Derivatives of Bernstein Polynomials,” Boundary Value Problems,
    doi:10.1155/2011/829543 p. 1-16.
Dubin, J. (1985) Consumer Durable Choice and the Demand for Electricity, Elsivier: New York.
Dubin, J., D. McFadden (1984) "An Econometric Analysis of Residential Electric Appliance Holdings and Consumption,"
    Econometrica, 52, 345-62
Dudley, R. (2002) Real Analysis and Probability, Cambridge University Press, New York.
Dunford, N.; J. Schwartz (1964) Linear Operators, Interscience, New York.
Dupuit, J. (1844) "On the Measurement of the Utility of Public Works", Annales des ponts et chaussées. (English translation,
    International Economic Review, 1952).

                                                               52
Edgeworth, F. Y. (1881) Mathematical Psychics; an essay on the application of mathematics to the moral sciences,, London,
    C. K. Paul & Co.
Fosgerau, M.; D. McFadden; M. Bierlaire (2013) “Choice Probability Generating Functions,” Journal of Choice Modelling, 8, 1-
    18.
Fosgerau, M.; D. McFadden (2012) “A theory of the perturbed consumer with general budgets,” working paper.
Gorman, W. (1953) “Community Preference Fields,” Econometrica, 21, 63-80.
Gorman, W. (1961) “On a Class of Preference Fields,” Metroeconomica, 13, 53-56.
Gossen, H. (1854) Die Entwicktlung, English translation: The Laws of Human Relations, Cambridge: MIT Press, 1983.
Hall, P.; A. Yatchew (2007) “Nonparametric Estimation when Data on Derivatives are Available,” The Annals of Statistics, 35.1,
    300-323.
Hammond, P. (1994) "Money Metric Measures of Individual and Social Welfare Allowing for Environmental Externalities," in
    W. Eichhorn (ed) Models and Measurement of Welfare and Inequality, Springer-Verlag, 694-724.
Heiss, F.; D. McFadden; J. Winter (2013) “Plan Selection in Medicare Part D: Evidence from Administrative Data,” Journal of
    Health Economics 32.6, 1325-1344.
Hicks, J. (1939) Value and Capital, Oxford, Clarendon press.
Houthakker, H. (1950) “Revealed preference and the utility function,” Economica, N.S. 17, 159-174.
Hurwicz, L.; H. Uzawa (1971) "On the Integrability of Demand Functions," in J. Chipman, L. Hurwicz, M. Richter, and H.
    Sonnenschein (eds) Preferences, Utility, and Demand, New York: Harcourt, 114-148.
Jevons, W. (1871) Theory of Political Economy, reprinted by London, Macmillan, 1931.
Jorgenson, D. (1997) Welfare, MIT Press: Cambridge, Vol. 1 and 2.
Johnson, N. and S. Kotz (1970, Ch. 21) Continuous Univariate Distributions-1, Houghton-Mifflin: New York.
Kadison, R. and Z. Liu (2016) Bernstein Polynomial and Approximation, lecture notes.
Kaldor, N. (1939) "Welfare Propositions of Economics and Interpersonal Comparisons of Utility," Econ. Jour., XLIX, 549-52.
Katzner, Donald (1970) Static Demand Theory, New York: Macmillan.
Kosorok, M. (2008) Introduction to Empirical Processes and Semiparametric Inference, Springer: New York.
Lorentz, G. (1937) “Zur theorie der polynome von S. Bernstein,” Matematiceskij Sbornik 2, 543–556.
Lowenstein, G.; Ubel (2008) “Hedonic adaptation and the role of decision and experience utility in public policy,” Journal of
    Public Economics, 92, 1795-1810.
Marshall, A. (1890) Principles of Economics, London: Macmillan.
Mas-Colell, A.; M. Whinston, and J. Green (1995) Microeconomic Theory, Oxford: Oxford University Press.
Matzkin, R. and D. McFadden (2011) “Trembling Payoff Market Games,” working paper.
McFadden, D. (1974) “The Measurement of Urban Travel Demand,” Journal of Public Economics, 3, 303-328.
McFadden, D. (1981) “Structural Discrete Probability Models Derived from Theories of Choice,” in C. Manski and D. McFadden
    (eds) Structural Analysis of Discrete Data and Econometric Applications, MIT Press: Cambridge, 198-272.
McFadden, D. (1986) “The Choice Theory Approach to Market Research,” Marketing Science, 275-297.
McFadden, D. (1994) "Contingent valuation and social choice," American Journal of Agricultural Economics 76, 689-708.
McFadden, D. (1999) "Computing Willingness-to-Pay in Random Utility Models," in J. Moore, R. Riezman, and J. Melvin (eds.),
    Trade, Theory, and Econometrics: Essays in Honour of John S. Chipman, Routledge: London.
McFadden, D. (2004) “Welfare Economics at the Extensive Margin: Giving Gorman Polar Consumers Some Latitude,”
    University of California, Berkeley, working paper.
McFadden, D. (2008) “Environmental Valuation of Environmental Projects,” Univ. of California working paper.
McFadden, D. (2012) “Economic Juries and Public Project Provision,” Journal of Econometrics, 166, 116-126.
McFadden, D. (2014) “The New Science of Pleasure: Consumer Behavior and the Measurement of Well-Being,” in S. Hess and
    A. Daly, eds, Handbook of Choice Modelling, Elgar: Cheltenham, 7-48.
McFadden, D. (2017) “Stated Preference Methods and their Applicability to Environmental Use and Non-Use Valuations,” in
    D. McFadden and K. Train (eds) Contingent Valuation of Environmental Goods: A Comprehensive Critique, Elgar:
    Cheltingham, Chap. 6.
McFadden, D., K. Train (2000) "Mixed MNL Models for Discrete Response," Journal of Applied Econometrics, 15, 447-470.
McFadden, D.; B. Zhou (2015) “Measuring Lost Welfare from Poor Health Insurance Choices,” Schaeffer Center, USC.
Miller, K.; et al. (2011) “How Should Consumers’ Willingness to Pay Be Measured? An Empirical Comparison of State-of-the-
    Art Approaches,” Journal of Marketing Research, 48.1, 172-184.
Pareto, Vilfredo (1906) Manual of Political Economy, English Translation, Augustus M. Kelley, NY, 1971.


                                                               53
Peleg, B. (1970) “Utility functions for partially ordered topological spaces,” Econometrica, 38, 93-96.
Pollard, D. (1984) Convergence of Stochastic Processes, Springer, New York.
Rademacher, H. (1919) “Ubë r partielle und totale Differenzierbarkeit von Funktionen mehrerer Variabeln und ubë r die
    Transformation der Doppelintegrale,” Math. Ann. 79, 340-359.
Rader, T. (1973) “Nice demand functions,” Econometrica, 41, 913-935.
Resnic, S.; R. Roy (1990) “Leader and Maximum Independence for a Class of Discrete Choice Models,” Economic Letters, 33.3,
     259-263.
Richter, M. (1966) “Revealed Preference Theory,” Econometrica, 34, 635-645.
Roy, R. (1947) "La Distribution du Revenu Entre Les Divers Biens". Econometrica, 15.3, 205–225.
Samuelson, P. (1947) Foundations of economic analysis, Cambridge: Harvard University Press, 1983.
Samuelson, P. (1948) “Consumption theory in terms of revealed preference,” Economica, 15, 243-253.
Schmeiser, S. (2014) “Consumer inference and the regulation of consumer information,” Int. J. Ind. Organ. 37, 192–200.
Scitovsky, T. (1951) “The State of Welfare Economics,” American Economic Review, 41-3, 303-315.
Sen, A. (2017) Collective Choice and Social Welfare, Harvard University Press: Cambridge.
Shannon, C. (2006) “A Prevalent Transversality Theorem for Lipschitz Functions,” Proceedings of the American Mathematical
    Society, 134.9, 2755-2755.
Slutsky, E. (1915) "Sulla teoria del bilancio del consummatore", Giornale degli Economisti. English translation, "On the Theory
    of the Budget of the Consumer," in G. Stigler and K. Boulding, eds, Readings in Price Theory, Homewood: Irving.
Small, K.; S. Rosen (1981), “Applied Welfare Economics with Discrete Choice Models,” Econometrica, 49.1, 105-130.
Smith, A. (1776) An inquiry into the nature and causes of the wealth of nations. London, W. Strahan and T. Cadell.
Thaler, R.; C. Sunstein (2003) “Libritarian Paternalism,” American Economic Review, 93.2, 175-179.
Thaler, R.; C. Sunstein (2008) Nudge: Improving Decisions about Health, Wealth, and Happiness, Yale University Press: New
    Haven.
Thurstone, L. (1927) “A Law of Comparative Judgment,” Psychological Review, 34: 273-286.
Train, K. (2015) “Welfare calculations in discrete choice models when anticipated and experienced attributes differ: A guide
    with examples,” Journal of Choice Modelling, 16, 15-22.
Van der Vaart, A.; J. Wellner (1996) Weak Convergence and Empirical Processes, Springer, New York.
Varian, H. (1982) "The Nonparametric Approach to Demand Analysis," Econometrica, 50: 945-73.
Varian, H. (2006) Revealed Preference. New York: Oxford University Press.
Willig, Robert (1976) "Consumer's Surplus without Apology," American-Economic-Review. 66: 589-97.
Yatchew, A. (1985) “Applied Welfare Analysis with Discrete Choice Models: Comment,” Economic Letters, 18.1, 13-16.
Zhao, Y.; K. Kockelman; A. Karlstrom (2012) “Welfare Calculations in Discrete Choice Settings: The Role of Error Term
    Correlation,” Transport Policy 19.1, 76-84.




                                                                54
Appendix A: Approximation Theory for Functions and Probabilities

   This appendix provides the mathematical basis for uniform parametric approximations to utility functions and
probabilities. The first theorem adapts Bernstein-Weierstrauss approximation theory to the class of functions
considered in this paper, and the second theorem utilizes Pollard’s methods for establishing uniform weak
convergence of empirical probabilities; see Lorentz (1937), Kadison-Liu (2016), Pollard (1984).

                   K
     Let bjK(p) = � � pj (1 − p)K−j denote the binomial probability of j successes in K draws, each with probability
                   j
                                                                                             d
p ∈ [0,1]; and define bj,K(p) ≡ 0 for j < 0 or j > K. Differentiating,                         b (p)    = K[bj-1,K-1(p) – bj,K-1(p)]. Higher order
                                                                                             dp jK
                                                                                                                                    d
derivatives can be defined recursively; see Doha et al (2011). Note that ∑K                    K
                                                                          j=0 bjK (p) ≡ 1 and ∑j=0                                    b (p)          ≡ 0.
                                                                                                                                    dp jK
The following result is a straightforward multivariate restatement of the Bernstein-Weierstrauss theorem on
approximation of continuous functions by polynomials.

     Theorem A.1. Let H denote a compact metric space with metric h. Consider f ∈ ℭ([0,1]n×H). Let K = (K1,…,Kn)
denote a vector of positive integers, j = (j1,…,jn) a vector of integers satisfying 0 ≤ ji ≤ Ki for i = 1,…,n, p = (p1,…,pn)
∈ [0,1]n , j⊘K = (j1/K1,…,jn/Kn). Define the multivariate binomial probability bj,K(p) = ∏ni=1 bjiKi (pi ), the vector β∙K(h)
of functions βj,K(h) ≡ f(j⊘K,h) on H for 0 ≤ j ≤ K, and the multivariate polynomial BK(p,β∙K(h)) = ∑0≤𝐣𝐣≤𝐊𝐊 b𝐣𝐣,𝐊𝐊 (𝐩𝐩)β𝐣𝐣,𝐊𝐊 (h).
Let C denote the compact range of f. Then, βj,K ∈ ℭ(H,C)), and BK(p,β∙K(h)) has the following approximation
properties: (i) lim max
                      n
                        |B𝐊𝐊 (𝐩𝐩, β∙𝐊𝐊 (h)) − f(𝐩𝐩, h)| = 0, and (ii) if ∂f(p,h)/∂pi exists and is continuous on a closed
                     𝐊𝐊→∞ [0,1] ×H
                                                  ∂BK (𝐩𝐩,β𝐊𝐊 (h))   ∂f(𝐩𝐩,h)
set A ⊆ [0,1] ×H, then lim max �
                 n
                                                                   −          �=   0. If in addition, f is Lipschitz in its arguments, then β∙K is
                                  𝐊𝐊→∞       A         ∂pi             ∂pi
Lipschitz on H.

    Proof: The continuous function f is uniformly continuous on [0,1]n×H and bounded by a constant M, so that
given ε > 0, there exists δ ∈ (0,1) such that |p’ – p| ≤ δ and h(h,h’) ≤ δ imply |f(p’,h’) – f(p,h)| < ε/6. Define the
set Jδ = {j|0 ≤ j ≤ K and |j⊘K – p| ≤ δ/2}. By Hoeffding’s inequality, Prob(𝐉𝐉δ𝑐𝑐 ) ≤ 2∑ni=1 exp(– δ2 K i /2). Select K ≥
192nM/εδ3 and K > 2/δ. In the inequality |B𝐊𝐊 (𝐩𝐩, β∙𝐊𝐊 (h)) − f(𝐩𝐩, h)| ≤ �∑𝐉𝐉δ + ∑𝐉𝐉δ𝑐𝑐 � b𝐣𝐣,𝐊𝐊 (𝐩𝐩)|f(j⊘K,h) – f(p,h)|, the
first sum is bounded by ε/6, while the second sum is bounded by 2M∙Prob(𝐉𝐉δ𝑐𝑐 ) ≤ 4M∙∑ni=1 exp(– δ2 K i /2) ≤
              2
4M∙∑ni=1             ≤ εδ/24 ≤ ε/24. This establishes |B𝐊𝐊 (𝐩𝐩, β∙𝐊𝐊 (h)) − f(𝐩𝐩, h)| < 𝜀𝜀/3 for each (p,h) ∈ [0,1]n×H.
             δ2 Ki

      Next suppose that on a compact set A, ∂f(p,h)/∂p1 exists and is continuous. Then it is uniformly continuous
                                                                                                                   ∂f(𝐩𝐩′,h′)   ∂f(𝐩𝐩,h)         ε
and bounded on A; let M be a bound. The δ above can be chosen so that �                                                       −          �   ≤       and
                                                                                                                     ∂p1         ∂p1             6
f�𝐩𝐩+δ′ ∆1 ,h� − f(𝐩𝐩,h)       ∂f(𝐩𝐩,h)                                     ε
          δ′
                           −            ≡   ζ(δ’,p,h) with |ζ(δ’,p,h)| ≤ for |δ’| ≤ δ and |ζ(δ’,p,h)| ≤ M(1+2/δ) for |δ’| > δ, where
                                ∂p1                                         6
∆1 is a vector with a one in component 1, zeros elsewhere. Define p2+ = (p2,…,pn), j2+ = (j2,…,jn), K2+ = (K2,…,Kn), and
b𝐣𝐣𝟐𝟐+,𝐊𝐊 𝟐𝟐+ (𝐩𝐩𝟐𝟐+ ) = ∏ni=2 bjiKi (pi ) on [0,1]n-1. Then




                                                                                   55
     ∂BK (𝐩𝐩,β𝐊𝐊 (h))
                        = K1 �∑𝐉𝐉δ + ∑𝐉𝐉δ𝑐𝑐 � b𝐣𝐣2+,𝐊𝐊2+ (𝐩𝐩2+ ) �b𝐣𝐣𝟏𝟏−𝟏𝟏,𝐊𝐊 𝟏𝟏−𝟏𝟏 (p1 ) − b𝐣𝐣𝟏𝟏,𝐊𝐊 𝟏𝟏−𝟏𝟏 (p1 )� f(j1 ⁄K1 , 𝐣𝐣2+ ⊘ 𝐊𝐊 2+ , h)
          ∂pi

                                                                                         f((j1 +1)⁄K1 ,𝐣𝐣2+ ⊘𝐊𝐊 2+ ,h) − f(j1 ⁄K1,𝐣𝐣2+ ⊘𝐊𝐊 2+ ,h)
                        = �∑𝐉𝐉δ + ∑𝐉𝐉δ𝑐𝑐 � b𝐣𝐣2+ ,𝐊𝐊2+ (𝐩𝐩2+ )b𝐣𝐣𝟏𝟏,𝐊𝐊 𝟏𝟏−𝟏𝟏 (p1 ) �                             1/K1
                                                                                                                                                 �

                                                                                         ∂f(j1 ⁄K1 ,𝐣𝐣2+ ⊘𝐊𝐊 2+ ,h)
                        = �∑𝐉𝐉δ + ∑𝐉𝐉δ𝑐𝑐 � b𝐣𝐣2+ ,𝐊𝐊2+ (𝐩𝐩2+ )b𝐣𝐣𝟏𝟏,𝐊𝐊 𝟏𝟏−𝟏𝟏 (p1 ) �               ∂p1
                                                                                                                    +   ζ(δ’, 𝐩𝐩, h)�

                            ∂f(𝐩𝐩,h)                                                                  ∂f(j1 ⁄K1 ,𝐣𝐣2+ ⊘𝐊𝐊 2+ ,h)   ∂f(𝐩𝐩,h)
                        =            +   �∑𝐉𝐉δ + ∑𝐉𝐉δ𝑐𝑐 � b𝐣𝐣2+ ,𝐊𝐊2+ (𝐩𝐩2+ )b𝐣𝐣𝟏𝟏,𝐊𝐊 𝟏𝟏−𝟏𝟏 (p1 ) �                              −          +   ζ(δ’, 𝐩𝐩, h)�.
                             ∂p1                                                                                ∂p1                 ∂p1

                                                                                     ε
On Jδ, the term above in square brackets is bounded by , which then also bounds the first sum, and on 𝐉𝐉δ𝑐𝑐 this
                                                                                     6
term is bounded by 5M/δ. The probability of 𝐉𝐉δ𝑐𝑐 is bounded by 2∑ni=1 exp(– δ2 K i /2), so the second sum is bounded
     10M                                        10M                1
by       ∙   ∑ni=1 exp(– δ2 K i /2) ≤               ∙   ∑ni=1           .   Then K ≥ 192nM/εδ3 implies that the second sum is bounded by
      𝛿𝛿                                         𝛿𝛿             δ2 Ki /2
                                                                                             ∂BK (𝐩𝐩,β𝐊𝐊 (h))  ∂f(𝐩𝐩,h)
20ε/192 < ε/6. This establishes the approximation property �                                                  − ∂p          < 𝜀𝜀/3� at each (p,h) in A.
                                                                                                  ∂pi               i


     A final step to establish (i) and (ii) uniformly considers the open cover of neighborhoods where the results
hold (with tolerance ε/2 rather than ε/3), extracts finite sub-coverings for the compact domains, and uses the
minimum value of δ from these finite sub-coverings. By construction, β∙K retains the properties of f with respect
to h; hence, in particular, if f is Lipschitz in H, then so is β∙K. ∎

    The next results will establish uniform convergence of empirical expectations for a family of functions that
encompasses the applications in this paper. These results are obtained as specializations of the general theory of
stochastic convergence treated in Dudley (2014), Kosorak (2008), Pollard (1984), and van der Vaart and Wellner
(1996), referred to hereafter as VW. Let Y denote a closed subset of ℝn, 𝒴𝒴 denote the Borel σ-field of subsets of
Y, and F denote a probability on 𝒴𝒴. Define a family ℱ of functions f:Y ⟶ ℝ that is contained in the Banach space
ℒ1(Y,𝒴𝒴,F) and includes the constant function f(y) ≡ 1. We assume that the functions in ℱ are bounded by an
envelope function f* ∈ ℒ1(Y,,F); i.e., f* ≥ |f| for f ∈ ℱ. Let Θ denote a compact subset of ℝd, with a bound α >
max(1,max‖θ‖). Assume that the functions in ℱ are indexed by θ ∈ Θ and are Lipschitz with respect to this index;
          θ∈Θ
specifically, |fθ’(y) – fθ”(y)| ≤ ‖θ′ − θ"‖ ⋅ f ∗ (y) ≤ α ∙ f ∗ (y). We will call ℱ with the properties above a Lipschitz-
parametric family.

     Let FT denote the empirical probability defined by T independent draws {y1,…,yT} from F; i.e., for A ∈ 𝒴𝒴, FT(A) =
1 T                                                                                                                                       1
 ∑ 𝟏𝟏(yt         ∈ A). For f ∈ ℒ1(Y,,F) and a probability Q on 𝒴𝒴, define EQf ≡∫Y f(y)Q(dy) and ETf ≡ ∑Tt=1 f(yt ). Define
T t=1                                                                                                                                     T
‖f‖Q = EQ|f|, and note that ‖f‖F is the norm of ℒ1(Y,,F). A strong law of large numbers establishes that ETf ⟶ 𝐄𝐄𝐅𝐅 f
                                                                                                                                                            𝑎𝑎𝑎𝑎
pointwise for each f ∈ ℱ and for f*. We give conditions under which this convergence is uniform on ℱ.

     A measure of the “density” or “complexity” of ℱ is its bracketing number N[](γ,ℱ,Q), defined for γ > 0 and a
probability Q on 𝒴𝒴, the minimum cardinality of a family ℱγ ⊆ ℒ1(Y,𝒴𝒴,F), not necessarily a subset of ℱ, such that
for each f ∈ ℱ, there are f’,f” ∈ ℱ satisfying f’ ≥ f ≥ f” and EQ(f’ – f”) < γ. A related measure of the complexity of ℱ
is its covering number N(γ,ℱ,Q), defined for γ > 0 and a probability Q on 𝒴𝒴 as the minimum cardinality of a family
ℱγ ⊆ ℒ1(Y,𝒴𝒴,F), not necessarily a subset of ℱ, such that for each f ∈ ℱ, ′inf 𝐄𝐄Q |f’ – f| < γ. Obviously, N(γ,ℱ,Q) ≤
                                                                                                           f ∈ℱγ




                                                                                     56
N[](γ,ℱ,Q). We will be interested in families of functions for which the bracketing or covering number is finite.
The following result specializes VW Theorem 2.7.11:

   Lemma A.2. Consider a Lipschitz-parametric family ℱ and a positive constant M > 1. For each probability Q
on 𝒴𝒴 such that EQf* ≤ M and each γ > 0, N[](γ,ℱ,Q) ≤ 2 + 2(8αM/γ)d.

   Proof: Let J be the largest integer no greater than 8αM/γ, and j = (j1,…,jd) a vector of indices with 1 ≤ ji ≤ J for
each i. Consider the family of open balls of radius γ/2M centered at bj = (-α + j1γ/4M,…,-α+jdγ/4M). This family
covers Θ ⊆ [-α,α]d and contains Jd elements. Discard the balls that do not intersect Θ. From each of the remainder,
                                                                                    𝛾𝛾f∗                       𝛾𝛾f∗
select a point θj ∈ Θ and let ℱγ denote the family of functions min(fθ𝐣𝐣 + 2M , f ∗ ) and max(fθ𝐣𝐣 − 2M , −f ∗ ) plus f*
and –f*. Then, ℱγ contains at most 2(1+Jd) functions. For θ in the ball containing θj, the Lipschitz condition gives
                      𝛾𝛾                             𝛾𝛾                                    𝛾𝛾
�fθi (y) − fθ (y)� ≤ 2M f ∗ (y), implying fθ𝐣𝐣 (𝑦𝑦) + 2M f ∗ (𝑦𝑦) − f(y) ≥ 0 ≥ fθ𝐣𝐣 (𝑦𝑦) − 2M f ∗ (𝑦𝑦) − f(y). Then ℱγ brackets ℱ,
and N[](γ,ℱ,Q) ≤ 2 + 2(8αM/γ) d. ∎

    Augment the Lipschitz-parametric family ℱ with the countable family ℱ0 ≡ ⋃∞      𝑘𝑘=1 ℱ1/k of the approximating
functions in Lemma A.2 at tolerances γ = 1/k for k = 1,2,… ; i.e., consider the family ℱ* ≡ ℱ∪ℱ0. Then the bound
on bracketing numbers that the lemma establishes for ℱ also holds for ℱ*, and ℱ0 is dense in ℱ*. Then, ℱ* is said
to be Q-measurable for any probability Q on 𝒴𝒴 such that EQf* ≤ M; see VW, 2.2.3 and 2.2.4.

   Theorem A.3. Consider a Lipschitz-parametric family ℱ ⊆ ℒ1(Y,,F) that has an envelope f* ∈ ℒ1(Y,𝒴𝒴,F). For
each tolerance γ ∈ (0,1), lim Prob(sup sup |(𝐄𝐄T′ − 𝐄𝐄)f | > 𝛾𝛾) = 0 .
                             T→∞         T′ ≥T f∈ℱ

    Proof: From the discussion following Lemma A.2, consider the augmented family ℱ* that contains ℱ and also
contains the countable dense subfamily ℱ0. Given γ ∈ (0,1), the condition EFf* < ∞ implies there exists a constant
M > EFf* such that EFf*∙1(f*>M) < γ/4. Define ℱM = {min(M,max(f,-M)) | f ∈ ℱ*}. From Lemma A.2, the bracketing
number bound established on ℱ by the functions in ℱγ also holds for ℱM and the corresponding finite family ℱγM
                                                                    ∗
= {min(M,max(f,-M)) | f ∈ ℱγ} for all probabilities Q on 𝒴𝒴, since fM = min(M,max(f*,-M)) is an envelope function
                ∗                                     M
for ℱM and EQfM ≤ M. Then from Lemma A.2, N(γ, ℱ , FT ) ≤ 2+2(8αM/γ) d. This bound is independent of T. Then,
the result follows for ℱ*, and hence for ℱ, from VW Theorem 2.4.3. ∎

   The following result is stated in a form sufficient for our needs; for more general results, see VW, 2.6.17.

   Theorem A.4. Consider a finite-dimensional linear subspace 𝒦𝒦 of ℒ1(Y,,F). Without loss of generality, assume
that 𝒦𝒦 includes the function f(y) ≡ 1. For a fixed integer J, define ℱ to be a subset of the family of functions of
the form min(f1,…,fj) for fj ∈ 𝒦𝒦,1 ≤ j ≤ J. Let ℐ denote the family of indicator functions i(y) = 1(f(y)>0) for f ∈ ℱ,
and 𝒢𝒢 denote the family of functions g = f∙i for f ∈ ℱ and i ∈ ℐ. Suppose ℱ has an envelope function f* ∈ ℒ1(Y,,F).
Then, for each tolerance γ ∈ (0,1),

             lim Prob(sup sup |(𝐄𝐄T′ − 𝐄𝐄)i| > 𝛾𝛾) = 0 and lim Prob(sup sup |(𝐄𝐄T′ − 𝐄𝐄)g| > 𝛾𝛾) = 0.
             T→∞           T′ ≥T i∈ℐ                                  T→∞        T′ ≥T g∈𝒢𝒢

     Proof: The proof utilizes a geometric measure of the complexity of a family of functions ℱ or a family of sets
𝒞𝒞, the Vapnik-𝐶𝐶̆ ervonenkis (VC) index, denoted V(ℱ) or V(𝒞𝒞); see VW 2.6.1, Dudley (2014, 2.6.1). Classes of
functions or sets with a finite VC index are termed VC-classes. VW Lemma 2.6.15 establishes that 𝒦𝒦 is a VC-

                                                                 57
class. Then VW, Lemma 2.6.18(ii) establishes that ℱ is a VC-class with index V(ℱ), and the truncated class ℱM
= {min(M,max(f,-M)) | f ∈ ℱ } for M > 0 is a VC-class with index at most V(ℱ)+2; see Dudley (2014, Theorem
4.41). Pollard (1984, Lemma 2.4.18) establishes that the family 𝒞𝒞 of sets C = {y∈Y | f(y) > 0} for f ∈ ℱ is a VC-
class, implying that ℐ is a VC-class (see VW, p. 151, #9). VW Theorem 2.6.7 applied to ℱM with envelope f* ≡ M
or to ℐ with envelope i* ≡ 1 implies bounds N(γ, ℱM,Q) ≤ K(M/γ)V(ℱ)+2 and N(γ, ℐ,Q) ≤ K(1/γ) V(ℱ)+2 for γ ∈
                                                                                                     M
(0,1) and any probability Q on 𝒴𝒴, where K is a constant that does not depend on γ or M. Let ℱγ/2       and ℐγ/2M
denote the sets of centers of open balls of radius γ/2 and γ/2M that cover ℱM and ℐ respectively, and satisfy
       M
card(ℱγ/2 ) ≤ 2K(2M/γ)V(ℱ)+2 and card(ℐγ/2M) ≤ 2K(2M/γ) V(ℱ)+2. Let 𝒢𝒢M = {i∙f | i ∈ ℐ and f ∈ ℱM}. For i ∈ℐ and
f ∈ ℱM, one has        min      min 𝐄𝐄|i ∙ f − i′ ∙ f ′ | ≤ max        min 𝐄𝐄|(i − i′ ) ∙ f| + ′ max     min 𝐄𝐄|(f − f ′ ) ∙ i′ | < γ.
                     i′ ∈ℐγ/2M f′ ∈ℱγ/2                    f∈ℱM i′ ∈ℐγ/2M                      i ∈ℐγ/2M f′ ∈ℱγ/2
Then the covering number N(γ, 𝒢𝒢M ,Q) for any probability Q on 𝒴𝒴 is bounded by the number of functions in
𝒢𝒢γ ={i∙f | i ∈ ℐγ/2M and f ∈ ℱγ/2}, which is in turn bounded by 4K2(2M/γ)2V(ℱ)+4. The countable families
         M
⋃∞                  ∞
   𝑘𝑘=1 ℱ1/2K and ⋃𝑘𝑘=1 ℐ1/2kM are dense in ℱ and ℐ respectively, so that these families are F-measurable. Then
                                             M

VW Theorem 2.4.3 applies to give the result. ∎




Appendix B: Properties of Extreme Value Type 1 Random Variables

      a. A standard Extreme Value Type 1 (EV1) random variable has CDF F(ε) ≡ exp(-e-ε), density e-ε ∙ exp(-e-ε), and
for t < 1 the moment generating function Γ(1-t). Johnson and Kotz (1970, Ch. 21) show the linear transformation
ξ = v + σε with σ > 0 has CDF exp(−e−(ξ−v)⁄σ ), mean v + σγ0, where γ0 = 0.5772156649⋯ is Euler’s constant,
median v – σ ln ln 2, mode v, and variance σ2π2/6. For 0 < ρ < 0.08, the tails of F(ε) satisfy F(2∙ln ρ) + 1 – F(–2∙ln ρ)
                                                                                                                   ∞
< ρ and ∫|ε|>−2∙ln ρ|ε|F(dε) < ρ. Also, E|ε| ≤ 1.219384 (i.e., integrating by parts, E|ε| = ∫0 exp(−eε ) dε +
 ∞                                           ∞                                  ∞ e−y
∫0 [1 − exp(−e−ε )]dε ≤ E1 (1) + ∫0 exp(−ε) dε , where E1(c) ≡ ∫c                  y
                                                                                        dy is the exponential integral with values
given in Abramovitz and Stegum, 1964, Table 5.1). Finally, Eε2 = γ02+ π2/6 = 1.978112∙∙∙.

   b. Consider J = {0,…,J}, constants aj and independent standard EV1 random variates εj for j ∈ J, and a non-
empty subset C of J. Define q𝐂𝐂 = ln ∑j∈𝐂𝐂 eaj and ξC = max(aj + εj ) − qC . Then ξC is again a standard EV1 random
                                                                j∈𝐂𝐂
variable; i.e., Prob(ξC < c) = Prob(εj < c + q𝐂𝐂 − aj for j ∈ 𝐂𝐂) = ∏j∈𝐂𝐂 exp(−e−c−q𝐂𝐂 +aj ) ≡ exp(−e−c). Given k ∈ C,
the probability of the event YC(k) = {ε| ak + εk ≥ aj + εj for j ∈ C} is multinomial logit,

             +∞                                                   +∞                                                   eak
   LC(k) = ∫ε      f(εk ) ∏j∈𝐂𝐂\{k} F�εk    + ak − aj �dεk = ∫ε         e−εk exp(−e−εk      ∑j∈𝐂𝐂 eaj −ak )dεk =          a    ,
             k =−∞                                                k =−∞                                            ∑j∈𝐂𝐂 e j

                                 a
                          ∑j∈𝐀𝐀 e j
and for A ⊆ C, LC(A) =           a .   The conditional CDF of εk, given k ∈ C and YC(k), is
                          ∑j∈𝐂𝐂 e j

                                 1     c
     Prob(εk < c| YC(k)) =           ∫       f(εk ) ∏j∈𝐂𝐂\{k} F�εk   + ak − aj �dεk
                             𝐿𝐿𝐂𝐂 (k) εk =−∞

               1     c
       =           ∫       e−εk exp(−e−εk    ∑j∈𝐂𝐂 eaj −ak )dεk = exp(−e−(c+ak−q𝐜𝐜 ) ) ≡ F(c + ak – qC).
           𝐿𝐿𝐂𝐂 (k) εk =−∞



                                                                       58
Then the payoff ak + εk, conditioned on the event YC(k), has the same CDF as ξC + qC , and is therefore the same for
all k. Term this the Optimizer Invariance Property (OIP). An immediate implication of OIP is

     γ0 + q𝐂𝐂 = E(ξC + q𝐂𝐂 ) ≡ E maxj∈C(aj + εj) ≡ E{ ak + εk | YC(k)}.

so these unconditional and conditional means are the same. This result is obtained in Dubin and McFadden (1984),
Anas and Feng (1988), Resnick and Roy (1990), and Dubin (1985). A consequence is that if B and C are disjoint
non-empty subsets of J, then the conditional (on YC(k) for some k ∈ C) and unconditional expectations of utility
differences are given by the same log sum difference:
                                                                                                                                            a
                                                                                                                                     ∑j∈𝐁𝐁 e j
   𝐄𝐄 �max(aj + εj ) − max(aj + εj ) | YC (k)� ≡ 𝐄𝐄{max(aj + εj ) − max(aj + εj )} ≡ ln                                                     a     .
       j∈𝐁𝐁                           j∈𝐂𝐂                                  j∈𝐁𝐁                       j∈𝐂𝐂                          ∑j∈𝐂𝐂 e j


If k ∉ C, then the conditional CDF of ξC, given ak + εk > ξC + qC, is

                                                         1       c
    Prob(ξC < c|ak + εk > ξC + qC) =                           ∫        f(ξ𝐂𝐂 )[1 −   F(ξC + q𝐂𝐂 − ak )]dξ𝐂𝐂
                                                   𝐿𝐿𝐂𝐂∪{k} (k) ξ𝐂𝐂 =−∞

                                             c
                             F(c)      ∫ξ =−∞ e−ξC exp(−e−ξ𝐂𝐂 [1+eak−q𝐂𝐂 ])dξC              F(c) − 𝐿𝐿𝐂𝐂∪{k} (𝐂𝐂)F(c + q𝐂𝐂 − ln[eq𝐂𝐂 +eak ])
                     =                − 𝐂𝐂                                              =                                                     .
                         𝐿𝐿𝐂𝐂∪{k} (k)                𝐿𝐿𝐂𝐂∪{k} (k)                                             𝐿𝐿𝐂𝐂∪{k} (k)


Using the OIP, this result is unchanged if instead of a single alternative k ∉ C, there is a set of alternatives A with
A∩C = ∅ and either k maximizes aj + εj for j ∈ A, with conditioning on the event YA(k), or q𝐀𝐀 = ln ∑j∈𝐀𝐀 eaj replaces
ak, a standard EV1 variate ξA replaces εk, and A replaces {k}.

        Next, given k ∉ C, the conditional CDF of ξC, given ak + εk < ξC + qC, is

                                                          1        c
    Prob(ξC < c|ak + εk < ξC + qC) =                             ∫       f(ξC )F(ξ𝐂𝐂   + q𝐂𝐂 − ak )dξ𝐂𝐂
                                                    𝐿𝐿𝐂𝐂∪{k} (𝐂𝐂) ξC =−∞

                              1          c
                     =                  ∫
                                    (𝐂𝐂) ξ
                                                  e−ξ𝐂𝐂 exp(−e−ξ𝐂𝐂 [1 + eak−q𝐂𝐂 ])dξ𝐂𝐂 = F(c + q𝐂𝐂 − ln[eq𝐂𝐂 + eak ]).
                         𝐿𝐿𝐂𝐂∪{k}        𝐂𝐂 =−∞



Again by the OIP, this result is unchanged if k ∈ B with B∩C = ∅, q 𝐁𝐁 = ln ∑j∈𝐁𝐁 eaj replaces ak, a standard EV1
variate ξB replaces εk, and A replaces {k}.

   c. Let A, B, C denote disjoint non-empty subsets of J. Define qA = ln ∑j∈𝐀𝐀 eaj , and define qB and qC analogously.
Define ξA = max�aj + εj � − q𝐀𝐀, with analogous definitions for ξB and ξC, and let “ABC” denote the event ξA + qA >
              j∈𝐀𝐀
ξB + qB > ξC + qC, and so on. The possible events and outcomes are given below:


                                      ABC                 ACB             BAC                    BCA                   CAB                  CBA
       Choice at a                     A                   A               A                      C                     C                    C
       Choice at b                     B                   C               B                      B                     C                    C
         Type                     difference          difference        compound               compound              compound             compound


                                                                                59
   The probability of the event ABC is

                   +∞
   P(ABC) = ∫ξ            𝑓𝑓(ξB )F(ξ𝐁𝐁    + q𝐁𝐁 − q𝐂𝐂 )[1 − F(ξB + q𝐁𝐁 − q𝐀𝐀 )]dξ𝐁𝐁
                   𝐁𝐁 =−∞


      +∞                                                            +∞
  = ∫ξ       e−ξ𝐁𝐁     exp�−e−ξ𝐁𝐁 [1 + eq𝐂𝐂 −qB ]� dξ𝐁𝐁 − ∫ξ               e−ξ𝐁𝐁    exp�−e−ξ𝐁𝐁 [1 + eq𝐀𝐀 −q𝐁𝐁 + eq𝐂𝐂 −qB ]� dξ𝐁𝐁
      𝐁𝐁 =−∞                                                        𝐁𝐁 =−∞


     = P(B|B,C) – P(B|A,B,C) ≡ P(B|B,C)∙P(A|A,B,C),

where P(A|A,B,C) = eq𝐀𝐀 /(eq𝐀𝐀 + eq𝐁𝐁 + eq𝐂𝐂 ) and P(B|B,C) = eq𝐁𝐁 /(eqB + eq𝐂𝐂 ). This formula gives the probability of
any other of the events by substituting the corresponding permutation of A, B, C. Next,

                                    +∞
   E{(ξ𝐁𝐁 + q𝐁𝐁 )∙1(ABC)} = ∫ξ            (ξ𝐁𝐁   + q𝐁𝐁 )𝑓𝑓(ξ𝐁𝐁 )F(ξ𝐁𝐁 + q𝐁𝐁 − q𝐂𝐂 )[1 − F(ξ𝐁𝐁 + q𝐁𝐁 − q𝐀𝐀 )]dξ𝐁𝐁
                                    𝐁𝐁 =−∞


          +∞
     = ∫ξ       (ξ𝐁𝐁    + q𝐁𝐁 )e−ξ𝐁𝐁 �exp�−e−ξ𝐁𝐁 [1 + eq𝐂𝐂 −q𝐁𝐁 ]� − exp�−e−ξ𝐁𝐁 [1 + eq𝐀𝐀 −q𝐁𝐁 + eq𝐂𝐂 −q𝐁𝐁 ]��dξ𝐁𝐁
          𝐁𝐁 =−∞


         = {P(𝐁𝐁|𝐁𝐁, 𝐂𝐂)[γ0 + ln(eq𝐁𝐁 + eq𝐂𝐂 )] − P(𝐁𝐁|𝐀𝐀, 𝐁𝐁, 𝐂𝐂)[γ0 + ln(eq𝐀𝐀 + eq𝐁𝐁 + eq𝐂𝐂 )]},

The event ACB also has an expectation satisfying this “difference type” formula with B and C interchanged.

   The event BAC has

                                        +∞                           ξ +q −q𝐀𝐀
      E{(ξ𝐁𝐁 + q𝐁𝐁 ) ∙1(BAC)} = ∫ξ            (ξ𝐁𝐁   + q𝐁𝐁 )f(ξ𝐁𝐁 ) ∫ξ 𝐁𝐁=−∞
                                                                           𝐁𝐁
                                                                                   f(ξ𝐀𝐀 )F(ξ𝐀𝐀 + q𝐀𝐀 − q𝐂𝐂 )dξ𝐀𝐀 dξ𝐁𝐁
                                        𝐁𝐁 =−∞                        𝐀𝐀


                +∞                               ξ +q −q𝐀𝐀 −ξ
            = ∫ξ      (ξ𝐁𝐁   + q𝐁𝐁 )f(ξ𝐁𝐁 ) ∫ξ 𝐁𝐁=−∞
                                                   𝐁𝐁
                                                           e 𝐀𝐀   exp(−e−ξ𝐀𝐀 [1 + eq𝐂𝐂 −q𝐀𝐀 ])dξ𝐀𝐀 dξ𝐁𝐁
                𝐁𝐁 =−∞                           A


                      +∞
   = P(A|A,C) ∫ξ            (ξB    + q𝐁𝐁 )e−ξ𝐁𝐁 exp�−e−ξ𝐁𝐁 � exp�−e−ξ𝐁𝐁 +q𝐀𝐀−q𝐁𝐁 [1 + eq𝐂𝐂 −q𝐀𝐀 ]�dξ𝐁𝐁
                      𝐁𝐁 =−∞


                      +∞
   = P(A|A,C) ∫ξ            (ξ𝐁𝐁   + q𝐁𝐁 )e−ξ𝐁𝐁 exp�−e−ξ𝐁𝐁 [1 + eqA −q𝐁𝐁 + eq𝐂𝐂 −q𝐁𝐁 ]�dξ𝐁𝐁
                      𝐁𝐁 =−∞


   = P(A|A,C)P(B|A,B,C){ γ0 + ln(eq𝐀𝐀 + eq𝐁𝐁 + eq𝐂𝐂 )} .

   The events BCA, CAB, and CBA also have expectations satisfying this “compound type” formula with the
corresponding permutations of A, B, and C.

   Consider the event AC. From (b), E max(ξ𝐀𝐀 + q𝐀𝐀 , ξ𝐂𝐂 + q𝐂𝐂 )]∙1(AC) = [γ0 + ln(eq𝐀𝐀 + eqC )]∙P(A|A,C). Then,

   E{[max(ξ𝐁𝐁 + q𝐁𝐁 , ξ𝐂𝐂 + q𝐂𝐂 ) – max(ξ𝐀𝐀 + q𝐀𝐀 , ξ𝐂𝐂 + q𝐂𝐂 )]}∙1(AC)

                q𝐁𝐁
   = E{[ξ𝐁𝐁 +   σ
                      – (ξ𝐀𝐀 + q𝐀𝐀)]∙1(ABC) + E{[ξ𝐂𝐂 + q𝐂𝐂 – (ξ𝐀𝐀 + q𝐀𝐀 )]∙1(ACB) + E{[ξ𝐁𝐁 + q𝐁𝐁 – (ξ𝐀𝐀 + q𝐀𝐀 )]}∙1(BAC)

    = {P(𝐁𝐁|𝐁𝐁, 𝐂𝐂)[γ0 + ln(eq𝐁𝐁 + eq𝐂𝐂 )] − P(𝐁𝐁|𝐀𝐀, 𝐁𝐁, 𝐂𝐂)[γ0 + ln(eq𝐀𝐀 + eq𝐁𝐁 + eq𝐂𝐂 )]}

         + {P(𝐂𝐂|𝐁𝐁, 𝐂𝐂)[γ0 + ln(eq𝐁𝐁 + eq𝐂𝐂 )] − P(𝐂𝐂|𝐀𝐀, 𝐁𝐁, 𝐂𝐂)[γ0 + ln(eq𝐀𝐀 + eq𝐁𝐁 + eq𝐂𝐂 )]}

                                                                           60
      + P(A|A,C)P(B|A,B,C){ γ0 + ln(eq𝐀𝐀 + eq𝐁𝐁 + eq𝐂𝐂 )} – [γ0 + ln(eq𝐀𝐀 + eq𝐂𝐂 )]∙P(A|A,C)

    = – P(C|A,C)∙ ln(eq𝐀𝐀 + eq𝐁𝐁 + eq𝐂𝐂 ) + ln(eq𝐁𝐁 + eq𝐂𝐂 ) – P(A|A,C)∙ln(eq𝐀𝐀 + eqC )

                      eq𝐁𝐁 +eq𝐂𝐂                             eq𝐁𝐁 +eq𝐂𝐂
    = P(A|A,C)∙ln                  + P(C|A,C)∙ln                             .
                      eq𝐀𝐀 +eq𝐂𝐂                          eq𝐀𝐀 +eq𝐁𝐁 +eq𝐂𝐂


   Hence,

                                                                                      eq𝐁𝐁 +eq𝐂𝐂   P(𝐂𝐂|𝐀𝐀,𝐂𝐂)       eq𝐁𝐁 +eq𝐂𝐂
       E{[max(ξ𝐁𝐁 + q𝐁𝐁 , ξ𝐂𝐂 + q𝐂𝐂 ) – max(ξ𝐀𝐀 + q𝐀𝐀 , ξ𝐂𝐂 + q𝐂𝐂 )] | AC} = ln eq𝐀𝐀 +eq𝐂𝐂 +                   ∙ln eq𝐀𝐀 +eq𝐁𝐁 +eq𝐂𝐂   .
                                                                                                   P(𝐀𝐀|𝐀𝐀,𝐂𝐂)∙


    The first term in the last expression coincides with the unconditional expectation of the maximum, and the
final term adjusts for the conditioning event. The adjustment is negative so that the information that the best in
A is better than the best in C decreases the expected maximum utility over B and C. By application of the OIC as
described at the end of (b), this result is the same no matter which event YA(k) occurs. Next,

       E{[max(ξ𝐁𝐁 + q𝐁𝐁 , ξ𝐂𝐂 + q𝐂𝐂 ) – max(ξ𝐀𝐀 + q𝐀𝐀 , ξC + q𝐂𝐂 )]}∙1(CA)

         = E{[ξB + q𝐁𝐁 – (ξ𝐂𝐂 + q𝐂𝐂 )]∙1(BCA) = P(C|A,C)P(B|A,B,C)[γ0 + ln(eq𝐀𝐀 + eq𝐁𝐁 + eq𝐂𝐂 )]

                           – P(C|A,C)∙ [γ0 + ln(eq𝐀𝐀 + eq𝐂𝐂 )] + P(C|A,B,C)∙[γ0 + ln(eq𝐀𝐀 + eqB + eq𝐂𝐂 )]

                               eq𝐁𝐁 +eq𝐂𝐂            eqB +eq𝐂𝐂
        = P(C|A,C)∙{ ln                     − ln                    },
                               eq𝐀𝐀 +eq𝐂𝐂          eq𝐀𝐀 +eq𝐁𝐁 +eq𝐂𝐂

                                                                                           eq𝐁𝐁 +eq𝐂𝐂             eq𝐁𝐁 +eq𝐂𝐂
and hence E{max(ξ𝐁𝐁 + q𝐁𝐁 , ξ𝐂𝐂 + q𝐂𝐂 ) – max(ξ𝐀𝐀 + q𝐀𝐀 , ξ𝐂𝐂 + q𝐂𝐂) | CA} = ln                         − ln                      .
                                                                                           eq𝐀𝐀 +eq𝐂𝐂          eq𝐀𝐀 +eq𝐁𝐁 +eq𝐂𝐂


 As before, the first term in the last expression coincides with the unconditional expectation of the maximum, and
the final term is a positive adjustment for the conditioning event, so that the information that the best in C is
better than the best in A increases the expected maximum utility over B and C. Again, by application of the OIC,
this result is the same no matter which event YA(k) occurs.

    d. Now consider J = {0,…,J} and C = {0,…,J-1}. Assume that in a scenario change from m = a to m = b, constants
ajm ≡ aj for j ∈ C do not change, but aJa ≠ aJb. Assume εj for j ∈ J is the same in both scenarios. Define q𝐂𝐂 =
ln ∑j∈𝐂𝐂 eaj and ξC = max(aj + εj ) − q𝐂𝐂. There is an alternative k that maximizes aj + εj over j ∈ C, and from (b),
                        j∈𝐂𝐂
the CDF of ak + εk given that k maximizes the payoff in C is the same as the CDF of ξC + q𝐂𝐂 . Define ω = ξC – εJ and
L(w) ≡ Prob(ω ≤ w) = 1/(1+e-w). The possible events are then:
          Event       Case             Condition                   Probability                 Payoff
           Ybak      aJa < aJb   ξC+qC < aJa+εJ < aJb+εJ            L(aJa – qC)                aJb – aJa
           Ybka      aJa < aJb   aJa+εJ < ξC+qC < aJb+εJ     L(aJb – qC) – L(aJa – qC)     aJb – qC – ω
           Ykba      aJa < aJb   aJa+εJ < aJb+εJ < ξC+qC            L(qC – aJb)                    0
           Yabk      aJa > aJb   ξC+qC < aJb+εJ < aJa+εJ            L(aJb – qC)                aJb – aJa
           Yakb      aJa > aJb   aJb+εJ < ξC+qC < aJa+εJ     L(aJa – qC) – L(aJb – qC)     qC – aJa + ω
           Ykab      aJa > aJb   aJb+εJ < aJa+εJ < ξC+qC            L(qC – aJa)                    0

                                                                                 61
                 t                                  t eω                                1+et
   Note that ∫s ωd𝐿𝐿(ω) = ω𝐿𝐿(ω)]ts − ∫s 1+eω dω = t𝐿𝐿(t) − s𝐿𝐿(s) − ln 1+es . Then the expected payoff in the
event Ybka is
                                                                              a −q
   E{(aJb – qC – ω)∙1(ω∈Ybka)} = (aJb – qC)[L(aJb – qC) – L(aJa – qC)] – ∫a Jb−q 𝐂𝐂 ωd𝐿𝐿(ω)
                                                                              Ja   𝐂𝐂

                                                                                                      a −q
                                                                                                   1+e Jb 𝐂𝐂
      = (aJb – qC)[L(aJb – qC) – L(aJa – qC)] – (aJb – qC)L(aJb – qC) + (aJa – qC)[L(aJa – qC) + ln 1+eaJa−q𝐂𝐂

                                            a
                                     eq𝐂𝐂 +e Jb
      = (aJa – aJb) L(aJa – qC) + ln eq𝐂𝐂 +eaJa ,

   and the expected payoff in the event Yakb is
                                                                                   a −q
       E{(qC – aJa + ω)∙1(ω∈Ybka)} = (qC – aJa)[ L(aJa – qC) – L(aJb – qC)] + ∫a Ja−q 𝐂𝐂 ωd𝐿𝐿(ω)
                                                                                   Jb    𝐂𝐂

                                                                                                             a −q
                                                                                                          1+e Ja 𝐂𝐂
           = (qC – aJa)[L(aJa – qC) – L(aJb – qC)] + (aJa – qC)L(aJa – qC) – (aJb – qC)L(aJb – qC) – ln      a −q
                                                                                                          1+e Jb 𝐂𝐂

                                                 a
                                          eq𝐂𝐂 +e Jb
           = (aJa – aJb) L(aJb – qC) + ln eq𝐂𝐂 +eaJa .

   Combining these results with other payoffs in the table gives


  Scenario           Case                                  Expected Payoff Given Choice
  a Choice
      J          aJa < aJb                                             aJb − aJa
       J         aJa > aJb                                          1            eq𝐂𝐂 + eaJb
                                                                             ln q
                                                              𝐿𝐿(aJa − q𝐂𝐂 )     e 𝐂𝐂 + eaJa
       k         aJa < aJb                     𝐿𝐿(aJa − q𝐂𝐂 )                         1        eq𝐂𝐂 + eaJb
                                             −                (aJb – aJa ) +                 ln q
                                               𝐿𝐿(q𝐂𝐂 − aJa )                  𝐿𝐿(q𝐂𝐂 − aJa ) e 𝐂𝐂 + eaJa
       k         aJa > aJb                                                   0



     e. Assume scenarios m = a, b, a set of alternatives Ja = Jb = J = {0,…,J}, and noise ε that is the same in both
scenarios. Let ajm denote constants. Order the alternatives so that Δi ≡ aib – aia is non-decreasing in i. Define non-
decreasing constants ci = Δi + aka – arb ; then ck = akb – arb, and cr = aka – ara. Let Ajm denote the event that alternative
j is optimal in scenario m. Consider the event

       Bkr = Aka∩Arb = {ε | εk +aka ≥ εi + aia for i ≠ k & εr +arb ≥ εi + aib for i ≠ r},

including both cases k = r and k ≠ r. The Bkr are disjoint for different k or for different r except for sets of probability
                             J                         J
zero, and satisfy Aka = ⋃r=0 𝐁𝐁kr and Arb = ⋃k=0 𝐁𝐁kr . The event Bkr implies (arb – akb) ≥ εk – εr ≥ (ara – aka). Hence,
Bkr is non-empty if and only if arb – ara ≥ akb – aka, or equivalently ck ≤ cr, implying r ≥ k.


                                                                   62
     Consider the case r = k. Then for i ≠ k, εi ≤ εk + aka – max(aia, aib + aka – akb). Then

                 +∞                                      J                                                                           eaka
   P(Bkk) = ∫ε         e−εk          exp�−e−εk ∑i=0 e−aka+max(aia,aib+aka– akb ) �dεk =                                    J                                      .
                 k =−∞                                                                                                    ∑i=0 e max(aia ,aib +aka – akb )



Then, the conditional probability Pkb|ka that the optimal choice in scenario b is k, given that the optimal choice in
scenario a is k, satisfies

                                                     ∑Ji=0 eaia
      Pkb|ka ≡ P(Bkk)/P(Aka) =              J    max (aia ,aib +aka – akb )
                                                                              .
                                           ∑i=0 e


      If r < k, Bkr is empty and Prb|ka = 0. Finally, consider the case r > k. Then ε ∈ Bkr requires εr + (ara – aka) ≡ εr – cr
≤ εk ≤ εr + (arb – akb) ≡ εr – ck. Let Bkri = {ε ∈ Bkr | εr – ci+1 ≤ εk ≤ εr – ci} for i = k,…,r-1 and consider the inequalities εn
≤ min(εk + (aka – ana), εr + (arb – anb)) = (aka – ana) + min(εk, εr – cn). If n > i, then εr – cn ≤ εk, implying εn ≤ (aka – ana –
cn) + εr; otherwise, εn ≤ (aka – ana) + εk. The probability of Bkri is then
          +∞                                                                      ε –c
 Pkri = ∫ε      e−εr exp(−e−εr              ∑Jn=i+1 e(ana – aka + cn ) ) ∫ε r=ε i– c             e−εk exp�−e−εk ∑in=0 e(ana – aka ) � dεk dεr
          r =−∞                                                                   k   r    i+1


                        eaka               +∞                                     J                                   i
                 =                    ��           e−εr exp(−e−εr ��                      e(ana – arb+ Δn) + �              eana – arb+ Δi �)dεr
                     ∑in=0 e ana          εr =−∞                                  n=i+1                               n=0
                                                   +∞                                      J                                  i
                                            − �              e−εr exp(−e−εr ��                       eana – arb+ Δn + �               eana – arb+ Δi+1 �)dεr �
                                                   εr =−∞                                  n=i+1                              n=0


                                      +∞                      J
                    eaka             ∫ε      e−εr exp�−e−εr �∑n=0 e(ana – arb +max(Δi ,Δn) �� dεr
                                      r =−∞
             =    i
                 ∑n=0 e ana
                                 �        +∞                      J
                                                                                                                                              �
                                      − ∫ε =−∞ e−εr exp(−e−εr �∑n=0 e(ana – arb +max(Δi+1 ,Δn ) �)dεr
                                           r


                      eaka                  earb                            earb                                  eaka earb                       �eΔi+1 −eΔi �
             = ∑i                �    J                         −    J                                  � =                            ∙                                .
                     n=0 e
                           ana       ∑n=0 eana +max(Δi ,Δn )        ∑n=0 e na +max(Δi+1 ,Δn )
                                                                          a                                    eana +max(Δi ,Δn )          ∑Jn=0 eana +max(Δi+1 ,Δn )


Then, the probability that the optimal choice in scenario b is r > k, given that the optimal choice in scenario a is k,
                                                                          J
                                                                    earb ∑n=0 e ana                        �eΔi+1 −eΔi �
satisfies Prb|ka ≡ ∑r−1              r−1
                    i=k Pkri /Pka = ∑i=k                                                         ∙                                .
                                                                ∑Jn=0 eana +max(Δi ,Δn )             ∑Jn=0 eana +max(Δi+1 ,Δn )


      Next, consider the expectations of (akb + εk ) ∙ 𝟏𝟏(𝛆𝛆 ∈ Bkk ) for r = k and (arb + εr ) ∙ 𝟏𝟏(𝛆𝛆 ∈ Bkri ) for k ≤ i <
r, given ε ∈ Aka. First,
                                                       1   +∞                                                     J
 𝐄𝐄𝛆𝛆|𝐀𝐀𝐤𝐤𝐤𝐤 (akb + εk ) ∙ 𝟏𝟏(𝛆𝛆 ∈ Bkk ) =               ∫      (a +εk )e−εk                   exp�−e−εk ∑i=0 e−aka +max(aia ,aib +aka – akb ) �dεk
                                                      Pka εk =−∞ kb


                                                = Pkb|ka �akb − aka + ln�∑Ji=0 emax(aia,aib+aka– akb ) � + 𝛾𝛾0 �.

Second, for k ≤ i < r,




                                                                                               63
                                                                         Pkri
    𝐄𝐄𝛆𝛆|𝐀𝐀𝐤𝐤𝐤𝐤 (arb + εr ) ∙ 𝟏𝟏(𝛆𝛆 ∈ Bkri ) =                                a
                                                                         Pka rb

                                                                             +∞                                                J
                                              𝐽𝐽
                                             ∑𝑛𝑛=0 eana               ∫ε =−∞ εr e−εr exp �−e−εr �∑n=0 eana – arb+max(Δi ,Δn) �� dεr
                                         +                           � r +∞                                                              �
                                             ∑in=0 e ana
                                                                       − ∫ε =−∞ εr e−εr exp(−e−εr �∑Jn=0 e(ana – arb+max�Δi+1,Δn�) �)dεr
                                                                                     r


         Pkri           ∑𝐽𝐽𝑛𝑛=0 eana earb                                     1                                           1                              J
    =    Pka 0
              𝛾𝛾    +                                  �                                            −                                       � ∙ ln ∑n=0 eana+max(Δi ,Δn)
                           ∑in=0 e ana                     ∑Jn=0 eana +max(Δi ,Δn )                     ∑Jn=0 e(ana +max�Δi+1 ,Δn �)


                        ∑𝐽𝐽𝑛𝑛=0 eana earb                                      1                                 ∑Jn=0 eana +max(Δi ,Δn )
                   +      ∑in=0 e ana
                                                   ∙                                                     ∙ ln
                                                       ∑Jn=0 eana +max�Δi+1                        ,Δn �        ∑Jn=0 eana +max�Δi+1 ,Δn �


         Pkri                   J                                                             earb                  ∑Jn=0 eana                            ∑Jn=0 eana +max(Δi ,Δn )
     =        [𝛾𝛾0   + ln ∑n=0 eana+max(Δi ,Δn ) ] + ∑i                                            ana    ∙    J                                  ∙ ln    J
         Pka                                                                                 n=0 e            ∑n=0 eana +max�Δi+1 ,Δn �                  ∑n=0 eana +max�Δi+1 ,Δn �


Hence, the conditional expectation of (arb + εr)∙1(ε∈Bkr) given ε ∈ Aka is

                                P  J                                                                                    1          earb ∙∑Jn=0 e ana                     J
                                                                                                                                                                        ∑n=0 eana +max�Δi ,Δn �
      Prb|ka 𝛾𝛾0 + ∑r−1
                    i=k P
                         kri
                             ∙ ln ∑n=0 eana+max(Δi ,Δn) + ∑r−1
                                                           i=k ∑i                                                           a  ∙ J                              ∙ ln    J                          .
                                    ka                                                                                n=0 e
                                                                                                                             na ∑
                                                                                                                                 n=0
                                                                                                                                     eana +max�Δi+1 ,Δn �              ∑
                                                                                                                                                                        n=0
                                                                                                                                                                            eana +max�Δi+1 ,Δn �


Summing this expression over r > k gives
                                                                 P                       J
        (1 − Pkb|ka )𝛾𝛾0 + ∑r>k ∑r−1
                                 i=k P
                                      kri
                                          ∙ ln ∑n=0 eana+max(Δi ,Δn)
                                                                     ka


                                             1                      𝑒𝑒arb ∙∑Jn=0 e ana                                J
                                                                                                                   ∑n=0 eana+max�Δi ,Δn �
                   + ∑r>k ∑r−1
                           i=k                               ∙                                           ∙ ln
                                      ∑in=0 e ana                ∑
                                                                  J
                                                                      eana +max�Δi+1 ,Δn�                        ∑
                                                                                                                  J
                                                                                                                      eana +max�Δi+1 ,Δn �
                                                                  n=0                                             n=0

                                                                                   Pkri
            = (1 − Pkb|ka )𝛾𝛾0 + ∑i=k ∑r=i+1
                                                           J−1       J
                                                                                   Pka
                                                                                             ∙ ln ∑Jn=0 eana+max(Δi,Δn)

                                                   J            J                                                 J
                             J−1        1        ∑r=i+1 𝑒𝑒arb ∙∑n=0 e ana                                        ∑n=0 eana +max�Δi ,Δn �
                        + ∑i=k                 ∙
                                    ∑in=0 e ana ∑J     a   +max  �Δi+1 ,Δn �
                                                                                                        ∙ ln     J                            .
                                                 n=0
                                                     e  na                                                      ∑
                                                                                                                 n=0
                                                                                                                     eana +max�Δi+1 ,Δn �


Combining this expression with the earlier conditional expectation for r = k,

                                                                                   ∑Ji=0 eaia
   𝐄𝐄ε|Aka max(arb + εr ) = 𝛾𝛾0 +                                                                               �akb − aka + ln�∑Ji=0 emax(aia ,aib+aka– akb ) ��
            r≥k                                                  ∑Ji=0 emax(aia ,aib +aka – akb )

                                            J            J
                                           ∑r=i+1 𝑒𝑒arb ∑n=0 e ana                                         �eΔi+1 −eΔi �
                                J−1
                             + ∑i=k       J     (a   +max  �Δi ,Δn �)⁄𝜎𝜎
                                                                                               ∙    J                                   ∙ ln ∑Jn=0 eana+max(Δi ,Δn)
                                         ∑
                                          n=0
                                              e na                                                 ∑
                                                                                                    n=0
                                                                                                        e(ana +max�Δi+1 ,Δn �)⁄𝜎𝜎


                                 J−1                1                         ∑Jr=i+1 𝑒𝑒 arb ∙∑Jn=0 e ana                          ∑Jn=0 eana +max(Δi ,Δn )
                              + ∑i=k ∑i
                                                                         ∙                                              ∙ ln                                      .
                                                 n=0 e
                                                       ana
                                                                             ∑Jn=0 e(ana +max�Δi+1               ,Δn �)        ∑Jn=0 eana +max�Δi+1 ,Δn �


   A consequence of this formula is

     𝐄𝐄 max�ajb + εj �|Aka ) − 𝐄𝐄 max�aja + εj �|Aka )
           j∈𝐉𝐉                                                  j∈𝐉𝐉




                                                                                                                  64
                ∑Ji=0 eaia                                                                                     J
      = ∑J   max(aia ,aib +aka – akb )       �akb − aka + σ ∙ ln�∑Ji=0 emax(aia,aib+aka– akb ) �� − ln ∑n=0 eana
         i=0 e

                  J               J
                 ∑r=i+1 𝑒𝑒arb ∑n=0 e ana               �eΔi+1 −eΔi �
         J−1
      + ∑i=k      J                           ∙    J                         ∙ ln ∑Jn=0 eana+max(Δi ,Δn)
                 ∑
                  n=0
                      eana +max�Δi,Δn �           ∑
                                                   n=0
                                                       eana +max�Δi+1 ,Δn�


                     1                ∑Jr=i+1 𝑒𝑒 arb ∙∑Jn=0 e ana               ∑Jn=0 eana +max(Δi ,Δn )
      + ∑J−1
         i=k ∑i               ∙                                     ∙ σ ∙ ln                               .
                  n=0 e
                        ana
                                  ∑Jn=0 eana +max�Δi+1,Δn �                     J
                                                                               ∑n=0 eana +max�Δi+1,Δn �




Appendix C. R-Code for the Discrete Welfare Calculus using a Synthetic Population
#Code to estimate losses from consumers not knowing their data were shared

sink('P:\\USER\\Kenneth.Train\\misperceptions\\simulation of privacy
results\\SimulationsForDan.txt')

#Attributes
# 1 price
# 2 Commercials shown between shows
# 3 Fast content availability
# 4 More TV shows
# 5 More movies
# 6 share usage data
# 7 share usage and personal data
# 8 No service

#Estimated parameters of distribution of WTP and scale
#alpha is scale parameter; 1/alpha is distributed log-normal
#WTPs are dsitributed normal
#Estimates are in Table 9 and 10 of Foundations

#Mean, stdev, and correlation matrix of underlying normals:
#Order: log(1/alpha), commercials, fast, mostly TV, mostly movies, share usage,
share personal and usage
normmn <- c(-2.0002, -1.562, 3.945, -0.6988, 2.963, -0.6224, -2.705, -27.26)
normstd <- c(1.0637, 3.940, 3.631, 4.857, 2.524, 2.494, 6.751, 19.42)
r1 <- c(1, -0.5813, -0.1371, 0.0358, 0.0256, 0.0022, -0.1287, 0.2801)
r2 <- c(0, 1.0000, 0.1172, -0.3473, 0.0109, -0.2562, -0.0079, -0.4108)
r3 <- c(0, 0,        1.0000, 0.8042, -0.4019, -0.3542, -0.4206, 0.2391)
r4 <- c(0, 0,        0,       1.0000, -0.5890, -0.1695, -0.3328, 0.4616)
r5 <- c(0, 0,        0,       0,       1.0000, 0.5141, 0.5181, -0.0147)
r6 <- c(0, 0,        0,       0,       0,       1.0000, 0.9370, -0.0563)
r7 <- c(0, 0,        0,       0,       0,       0,      1.0000, -0.0975)
r8 <- c(0, 0,        0,       0,       0,       0,      0,       1.0000)

corrMat=rbind(r1,r2,r3,r4,r5,r6,r7,r8)
corrMat=corrMat+t(corrMat) - diag(1,8);


#Specification of services available and combinations of services.
# Look like netflix (N), Amazon Prime (A), huluplus (H), and combos eg NA

N <- c(7.99, 0, 0, 0, 1, 0, 0, 0)

                                                                                    65
A <- c(6.58, 0, 0, 1, 0, 0, 0, 0)
H <- c(7.99, 0, 1, 0, 0, 0, 0, 0)

nos <- c(0,0,0,0,0,0,0,1) #No service
#Create matrix of attributes of the 8 alternatives:
xmat <- rbind(N,A,H,N+A,N+H,A+H,N+A+H,nos) #8 alts x 8 attributes
#Indicator of which alternatives have Hulu:
hasH <- c(0,0,1,0,1,1,1,0)
ndraws <- 1000000

samplen <- c(86, 14, 12, 35, 21, 3, 22, 107) #Number of people in survey who chose
each of the 8 alternatives

mktshares <- samplen/sum(samplen)
market <- sum(samplen)*(6/58) #in million. We know Hulu has 6m customers and 58
people in the survey have Hulu

#Create draws of coefficients
set.seed(1234)
coef <- matrix(rnorm(8*ndraws),8,ndraws)
coef <- matrix(rep(normmn,times=ndraws),8,ndraws) + diag(normstd) %*%
(t(chol(corrMat)) %*% coef)
print("Check mean, std, and correlation matrix of draws against true")
print("Means: simulated and true")
print(cbind(rowMeans(coef),normmn)) #Check against normmn
print("Stds: simulated and true")
print(cbind( sqrt(diag(cov(t(coef)))), normstd)) #Check against normstd
print("Correlation matrix, simulated first, then true")
print(cor(t(coef))) #Check against corrMat
print(corrMat)
wtpsharing <- coef[7,]
pcoef <- exp(coef[1,]); #For lognormally distributed price
coef[1,]<- -pcoef; #First coef is for price
coef[2:8,] <- matrix(rep(pcoef, each=7),7,ndraws) * coef[2:8,] #Attribute coefs are
wtp times price coef

#Calculate representative decision utility and choice probabilities
u <- xmat %*% coef
eu <- exp(u)
eu[is.infinite(eu)] <- 10^300
p <- eu / matrix(rep(colSums(eu),each=8),8,ndraws)
s <- rowMeans(p)

# Adjust constants to equal market shares

alpha <- matrix(0,8,1)
oldu <- u

for(count in 1:20){
  alpha <- alpha+log(mktshares / s)
  u <- oldu+matrix(rep(alpha,times=ndraws),8,ndraws)
  eu <- exp(u)
  eu[is.infinite(eu)] <- 10^300
  p <- eu / matrix(rep(colSums(eu),each=8),8,ndraws)
  s <- rowMeans(p)
}


                                            66
print("ASCs")
print(alpha)
print("Predicted and actual market shares at ASCs")
print(cbind(s,mktshares))


#Calculate welfare impact of lack of knowlegde of sharing by hulu-like service
#Actual attributes; which includes sharing of usage and personal data by hulu
#Same as above but now 1 in column 7 for Hulu, to indicate that Hulu shares
personal and usage info:

H[7] <- 1

xmatnew <- rbind(N,A,H,N+A,N+H,A+H,N+A+H, nos) #8 alts x 8 attributes
unew <- xmatnew %*% coef
unew <- unew + matrix(rep(alpha,times=ndraws),8,ndraws)
eunew <- exp(unew);
eunew[is.infinite(eunew)] <- 10^300
pnew <- eunew / matrix(rep(colSums(eunew),each=8),8,ndraws)
newshares <- rowMeans(pnew)
diffu <- unew-u

hold <- log(colSums(eu)) / pcoef
lsdecision <- mean(hold) #expected log sum based on decision utility
hold <- log(colSums(eunew)) / pcoef
lsrealized <- mean(hold) #expected log sum based on realized utility
hold <- colSums(p * diffu) / pcoef
squareloss<- mean(hold) #expected difference between perceived and actual utility
in money metric

hulusubscribers= t(mktshares) %*% hasH

print("Difference between peoples realized utility and decision utility for chosen
alternative")
print("in money metric.")
print("Aggregate, and per-person who subscribed to Hulu")
print(cbind((squareloss * market), (squareloss / hulusubscribers)))

print("Note: Conditional mean WTP (second number above) differs from unconditional
mean of 2.70.")

print("Difference between peoples realized utility and the utility they would have
obtained if informed");
print("in money metric.");
print("Aggregate, and per-person who subscribed Hulu")
print(cbind(((lsdecision-lsrealized+squareloss) *market),((lsdecision-
lsrealized+squareloss) / hulusubscribers)))
print("Hulu share")
print("Actual choices, informed choices, percent difference")
print(cbind(hulusubscribers,(t(newshares) %*% hasH),((t(mktshares-newshares) %*%
hasH) / hulusubscribers)))


#Break down analysis further by conditioning on choice and whether person likes or
dislikes sharing info.



                                          67
poswtp <- coef[7,]>=0 #These people like sharing their information; others dislike
it.

everrors <- matrix(runif(8*ndraws),8,ndraws)
everrors <- -log(-log(everrors))
util <- u+everrors
util <- util / matrix(rep(pcoef,each=8),8,ndraws) #So utils are back in money
metric
utilnew <- unew+everrors
utilnew <- utilnew / matrix(rep(pcoef,each=8),8,ndraws)

i=max.col(t(util))
inew=max.col(t(utilnew))
c=matrix(0,1,ndraws)
exper_util=matrix(0,1,ndraws)
cnew=matrix(0,1,ndraws)

for(n in 1:ndraws) {
   chosenalt <- i[n]
   c[1,n] <- util[chosenalt,n]
   exper_util[1,n] <- utilnew[chosenalt,n]
   newchosenalt <- inew[n]
   cnew[1,n] <- utilnew[newchosenalt,n]
}
Huluer <- i == 3 | i == 5 | i== 6 | i==7
NumHuluer <- sum(Huluer)
NumHuluerPosWTP <- sum(Huluer * poswtp)
NumHuluerNegWTP <- sum(Huluer *(1-poswtp))
print("Dollar difference in welfare relative what expected")
print("Aggregate, per person, per Hulu subscriber")
print("Everyone:")
xx <- exper_util-c
print(cbind(market * mean(xx), mean(xx), sum(xx)/NumHuluer))
print ("People whose dislike sharing:")
xx <-(exper_util-c) * (1-poswtp)
print(cbind(market * mean(xx), mean(xx), sum(xx)/NumHuluerNegWTP))
print("People whose like sharing:")
xx <-(exper_util-c) * poswtp
print(cbind(market * mean(xx), mean(xx), sum(xx)/NumHuluerPosWTP))

NumOther <- sum(1-Huluer)
NumOtherPosWTP <- sum(Huluer*poswtp)
NumOtherNegWTP <- sum(Huluer*(1-poswtp))
print("Dollar difference in welfare relative to being informed")
print("Aggregate, per person, average for Hulu subscribers, average for non-
subscribers")
print("Everyone:")
xx <- exper_util-cnew
print(cbind(market*mean(xx), mean(xx), mean(xx[Huluer==1]), mean(xx[Huluer==0]) ))
print("People whose dislike sharing:")
print(cbind(mean(1-poswtp)*market*mean(xx[poswtp==0]), mean(xx[poswtp==0]),
mean(xx[Huluer==1 & poswtp==0]), mean(xx[Huluer==0 & poswtp==0]) ))
print("People whose like sharing:")
print(cbind(mean(poswtp)*market*mean(xx[poswtp==1]), mean(xx[poswtp==1]),
mean(xx[Huluer==1 & poswtp==1]), mean(xx[Huluer==0 & poswtp==1]) ))



                                          68
choicemat <- array(0,dim=c(8,8,2)) #Rows for actual choice, cols for choice if
informed, depth for wtp<>0
exper_diff <- array(0,dim=c(8,8,2))
welfare_diff <- array(0,dim=c(8,8,2))
for(rr in 1:8) {
  for(cc in 1:8) {
     k <- (i == rr) & (inew == cc) & (poswtp==0)
     choicemat[rr,cc,1] <- sum(k==1)
     exper_diff[rr,cc,1] <- sum(c[k==1]-exper_util[k==1])
     welfare_diff[rr,cc,1] <- sum(exper_util[k==1]-cnew[k==1])
     k <- (i == rr) & (inew == cc) & (poswtp==1)
     choicemat[rr,cc,2] <- sum(k==1)
     exper_diff[rr,cc,2] <- sum(c[k==1]-exper_util[k==1])
     welfare_diff[rr,cc,2] <- sum(exper_util[k==1]-cnew[k==1])
  }
}


print("Hulu subscriber or not")
matH <- matrix(c( hasH,(1-hasH)),8,2)
subscribe1 <- t(matH) %*% choicemat[,,1] %*% matH
subscribe2 <- t(matH) %*% choicemat[,,2] %*% matH
print("Share of population who chose row and would have chosen col")
print((subscribe1+subscribe2)/ndraws )
print("Of people who dislike sharing, share who chose row and would have chosen
col")
print( subscribe1/sum(subscribe1) )
print("Of people who like sharing, share who chose row and would have chosen col")
print( subscribe2/sum(subscribe2) )

sink()




                                          69
