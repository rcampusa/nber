                               NBER WORKING PAPER SERIES




       INFERRING WELFARE MAXIMIZING TREATMENT ASSIGNMENT UNDER
                          BUDGET CONSTRAINTS

                                     Debopam Bhattacharya
                                        Pascaline Dupas

                                       Working Paper 14447
                               http://www.nber.org/papers/w14447


                     NATIONAL BUREAU OF ECONOMIC RESEARCH
                              1050 Massachusetts Avenue
                                Cambridge, MA 02138
                                    October 2008




Previously circulated under the title: “Nonparametric Inference on Efficient Treatment Assignment
under Budget Constraints.” We thank seminar participants at Dartmouth, Oxford, UCL and the World
Bank for useful comments. Dupas gratefully acknowledges funding from the Acumen Fund. The views
expressed herein are those of the author(s) and do not necessarily reflect the views of the National
Bureau of Economic Research.

NBER working papers are circulated for discussion and comment purposes. They have not been peer-
reviewed or been subject to the review by the NBER Board of Directors that accompanies official
NBER publications.

© 2008 by Debopam Bhattacharya and Pascaline Dupas. All rights reserved. Short sections of text,
not to exceed two paragraphs, may be quoted without explicit permission provided that full credit,
including © notice, is given to the source.
Inferring Welfare Maximizing Treatment Assignment under Budget Constraints
Debopam Bhattacharya and Pascaline Dupas
NBER Working Paper No. 14447
October 2008, Revised July 2011
JEL No. C01,C14,I38

                                              ABSTRACT

This paper concerns the problem of allocating a binary treatment among a target population based
on observed covariates. The goal is to (i) maximize the mean social welfare arising from an eventual
outcome distribution, when a budget constraint limits what fraction of the population can be treated
and (ii) to infer the dual value, i.e. the minimum resources needed to attain a specific level of mean
welfare via efficient treatment assignment. We consider a treatment allocation procedure based on
sample data from randomized treatment assignment and derive asymptotic frequentist confidence interval
for the welfare generated from it. We propose choosing the conditioning covariates through cross-validation.
The methodology is applied to the efficient provision of anti-malaria bed net subsidies, using data
from a randomized experiment conducted in Western Kenya. We find that subsidy allocation based
on wealth, presence of children and possession of bank account can lead to a rise in subsidy use by
about 9 percentage points compared to allocation based on wealth only, and by 17 percentage points
compared to a purely random allocation.


Debopam Bhattacharya
Oxford University
debopam.bhattacharya@st-hildas.ox.ac.uk

Pascaline Dupas
Department of Economics
UCLA
8283 Bunche Hall
Los Angeles, CA 90095
and NBER
pdupas@econ.ucla.edu
1        Introduction
Governments of developing countries often subsidize access to key health and educational
resources for the most vulnerable sections of their populations. However, such subsidizing
eﬀorts are typically constrained by binding budget ceilings. When budgets are such that
only a small fraction of a target population can receive a given subsidy, the eligibility
rule used to decide who will receive the subsidy can have an important eﬀect on the
overall benefit arising from the subsidy program. In this paper, we consider the problem
of allocating a fixed amount of treatment resources to a target population with the aim
of maximizing the mean population outcome, and the dual problem of estimating the
minimum cost of achieving a given mean outcome in the population by eﬃcient targeting
of a treatment. We set-up an econometric framework for studying this problem and apply
it to design welfare-maximizing allocation of subsidies for an eﬀective malaria control tool
— insecticide-treated bed nets (ITNs) — among households in a malaria-endemic region of
Kenya.
    Our paper contributes to a recent but steadily expanding literature in statistics and
economics on how experimental evidence on treatment eﬀect heterogeneity may be used
to maximize gains from social programs. This problem has been analyzed in the literature
as a statistical decision problem with finite samples under ambiguity but with no budget
constraint (c.f., Dehejia (2001), Manski (2004, 2005), Stoye (2009), Hirano and Porter
(2009) and Tetenov (2008)). Our substantive contribution is to study such problems in the
presence of aggregate budget constraints — an extremely common situation in real life but
largely ignored in the treatment choice literature.1 The constraint makes the treatment
assignment problem substantively realistic, especially for developing countries, and raises
a set of unique substantive and technical issues that are absent in the unconstrained case.
    On the empirical side, treatment targeting has been investigated in job-training con-
texts, c.f., Berger, Black and Smith (2001), Frolich (2008), Behnke et al (2008), Lechner
and Smith (2007). See also the papers in Eberts et al (ed., 2002) and the special issue
of the Economic Journal (Nov, 2006) on profiling. A few recent studies have used exper-
imental data to estimate the parameters of dynamic structural models of behavior and
utilized the estimates to simulate the eﬀects of counterfactual policy interventions (c.f.
    1
        Manski (2005) studies planning problems which satisfy ’separability’ and specifically mentions (page
10—11) budget constraints as a situation where separability is violated and, consequently, not studied by
him.
Attanasio, Meghir and Santiago (2011) and Duflo et al (2007)). Mahajan et al (2009)
discuss identification and estimation of a static structural model of ITN adoption using
observational data alone and use the estimated parameters to perform counterfactual pol-
icy analysis. Todd and Wolpin (2006, 2007) discuss the estimation of structural models of
behavior using pre-program data and compare predictions of their estimated model with
subsequent experimental data.
    The rest of the paper is organized as follows. Section 2 describes the treatment assign-
ment problem under budget constraints. Section 3 describes our sample-based approach.
Section 4 introduces the estimators; section 5 develops the relevant distribution theory and
section 6 discusses the covariate choice problem when assignment is based on parametric
models of treatment eﬀects. Section 7 presents the application to the welfare-maximizing
allocation of bed nets in Kenya and presents a Monte Carlo exercise to inform the covari-
ate choice problem. Section 8 concludes with directions for future research. The appendix
contains technical proofs.
    In the text, the symbol := will mean equal by definition, the symbols  and Φ will
refer to the standard normal density and c.d.f., respectively and  | (|) will denote
the c.d.f. of the random variable  at , conditional on  = .


2     Set-up
The assignment problem: To fix ideas, let  denote a household-level outcome and let
 denote a binary treatment whose value can be aﬀected directly by policy. Let  denote
observed covariates which includes both discrete and continuous components. In the bed-
net example, analyzed below in detail, the population of interest is rural households of
Western Kenya. We have a simple random sample drawn from two districts in Western
Kenya. Each household is an observation.  is a binary outcome which equals 1 if the
household owns and uses a bed net.  is the presence of a child under 10, the wealth
per capita and ownership of a bank account. The treatment,  = 1, is oﬀering a highly
subsidized bed net to the household. 1 and 0 are the value of the potential outcome 
with and without the treatment, respectively:  = 1 + (1 − ) 0 . Let   () denote
the expected outcome for households with  =  when their treatment status  is set
externally at  ∈ {0 1}, i.e.,   () =  ( | = ). If the observed  is independent
of (1  0 ) conditional on , as in a randomized trial (the case studied here), then a
nonparametric regression of  on  for households with  =  in the sample can be used
to recover this function.
    First, consider an idealized version of a social planner’s problem where   () and the
marginal distribution of  with support X̄ are known to the planner. The planner faces
a budget constraint that the fraction of households who can be treated is at most . We
define the planner’s idealized problem as the choice of a map  : X̄ → [0 1] where  ()
equals the probability that a household with  =  is assigned to  = 1 with probability
 (). We will assume that the planner wants to maximize mean outcome.2 Then the
planner’s problem is
                                Z
                        max            [ 1 ()  () +  0 () {1 −  ()}]  ()
                         (·)   ∈X̄

subject to                                      Z
                                           =            ()  () .                                  (1)
                                                 ∈X̄

Define  () to be  1 () −  0 (), i.e., the conditional average treatment eﬀect (CATE).
We allow for negative program impacts (i.e., Pr [ ()  0] ≥ 0), but to keep the present
problem substantively interesting and analytically tractable, we will maintain the follow-
ing condition throughout the paper:
    Assumption Maintained (AM): (i) For some  ≥ 0, we have Pr ( ()  )  
(the constraint binds); (ii)  () has bounded support with Lebesgue density bounded
away from zero.
    Condition AM (i) lets us ignore some technical complications due to (additional)
nondiﬀerentiability which would arise if Pr ( ()  0) is close to , relative to the sample
size (c.f., Andrews (1999)). It also makes the problem more realistic in a developing
country setting by making the budget constraint bind. condition AM (ii) is not strictly
necessary for us but it simplifies the exposition and proofs.3
    It is straightforward to show that under condition AM(i) and AM (ii), the solution
to the problem subject to (1) is of the form  () = 1 { () ≥ } where  satisfies:  =
R
 ∈X̄
      1 ( () ≥ )  (). That is,  is the (1 − )th quantile in the marginal distribution
   2
       More generally, if the planner is interested in maximizing (a possibly covariate weighted) outcome
utility, then   () represents the expected value of the planner’s utility defined on outcomes for individ-
uals with  =  and  = .
    3
      In the appendix part 3, we (a) show how a simple model of household consumption would imply
AM(ii) and (b) briefly discuss how the analysis would proceed if we were to drop AM.
of the random variable  () which is unique under assumption AM(ii). Define the
resulting "ideal" welfare as
                   Z
               =       [ 1 () 1 ( () ≥ ) +  0 () 1 ( ()  )]  () ,           (2)
                      ∈X̄

which would be attainable if  1 (·),  0 (·) and the distribution of  were known exactly
to the planner. Note that  also equals 0 (), the shadow cost of the budget constraint,
i.e., the expected treatment eﬀect on the marginal household made eligible for treatment
under our budget-constrained rationing rule.
   Minimizing expenditure: The dual formulation of the problem is where the plan-
ner’s objective is to achieve an expected outcome equal to  by allocating treatment based
on covariates. The parameter of interest is the minimum amount of funds necessary to
achieve . This problem can be represented as
                                    Z
                                min       ()  ()                                      (3)
                                          (·)   ∈X̄

subject to            Z
                              [ 1 ()  () +  0 () {1 −  ()}]  () = .            (4)
                       ∈X̄
It is not hard to show that the optimal  (·) will again be of the form  () = 1 { () ≥  ()}
where  () is such that  (·) satisfies (4). Note that by duality, the minimum value of (3)
is simply −1 () where  (·) is defined in (2) and −1 () = inf { :  () ≥ }. Notice that
 (·) is monotone increasing and so −1 (·) is well-defined.
   Some extensions: While we focus the current paper on the mean utility of outcome
as the objective, the idea applies in principle to any functional of the overall outcome
distribution. Let 1 (·|) and 0 (·|) denote the marginal C.D.F. of the outcome, con-
ditional on , under treatment and no treatment respectively. These marginals can be
identified using experimental data from randomized treatment allocation. If we fix the
treatment probability as  (·), then the C.D.F. of the overall outcome corresponding to
the choice  (·) is
                          Z
              (·; ) =             [1 (·|) ×  () + 0 (·|) × {1 −  ()}]  () .
                             ∈X̄

If the planner wishes to maximize a functional F (·) of the C.D.F.  (· ), then the
optimization problem reduces to
                                                         Z
                          max F ( (·; )) s.t.  =               ()  () .
                             (·)                         ∈X̄
                                                                                 R
For the mean utility case studied in this paper, F ( (· )) ≡                   X
                                                                                       ()  ( ), with
 () ≡  denoting the mean outcome case. Similarly, F ( (·; )) ≡ −1 (05; ) denotes
the median maximization case. The form of the solution and the related distribution
theory will of course change depending on the choice of F (·).
    A simple extension can also be made to the case where the treatment cost varies by
. Let  () denote the per capita additional cost of treating type . This is estimable
from the experimental data when cost data are available. The original problem is now
modified to
                                        Z
                               max             [ 1 ()  () +  0 () {1 −  ()}]  () ,
                                (·)    ∈X̄
                               Z
                   s.t.  =              ()  ()  () .
                                 ∈X̄

The solution is of the cost-benefit form: treat if and only if  () −  () ≥ , with
                       Z
                              () 1 ( () −  () ≥ )  () = .
                               ∈X̄



3        Sample-based rule
The rule 1 { () ≥ } is infeasible because  (·) (and usually also  (·)) are unknown.
But we can approximate it with sample data from an experiment where the treatment
was randomly assigned. In particular, we consider Manski (2004)’s Conditional Empirical
Success (CES, henceforth)-type rule which is the sample analog of the rule in the previous
display, viz.,
                               n               o         1X ³
                                                                             ´
                       () = 1  : ̂ () ≥ ̂ with  =       1 ̂ ( ) ≥ ̂ .
                                                          =1

Here ̂ () an ̂ are consistent estimates of  () and .4 One can then define the expected
welfare of the feasible rule as
                  Z h            n           o            n           oi
             :=       1 () Pr ̂ () ≥ ̂ +  0 () Pr ̂ ()  ̂  () ,                         (5)
                         X

where  (·) represents the population distribution of covariate , based on which the
treatment will be allocated to new applicants. Under regularity conditions (e.g., uniform
    4
        It is worth investigating whether the CES rule itself is optimal in a Hirano-Porter (2009) sense here
but this question is outside the scope of the present paper. It would require extension of their methods
                                                                                √
to allow for unknown parameters, such as , which cannot be estimated at the -rate.
convergence of ̂ (·) to  (·), detailed in the appendix)  will converge to  defined in (2)
as  → ∞.                           ³              ´
                          1
                              P
   The condition  =          =1 1 ̂ ( ) ≥ ̂   is one that holds in the sample and will
hold in the population only asymptotically. In order to have a ̂ that will make the
budget constraint hold exactly in the population, the planner needs to know the marginal
distribution of , whence ̂ may be obtained by solving
                                 Z ³             ´
                             =     1 ̂ () ≥ ̂  () .
                                     X

In our empirical application, we do not know the marginal distribution of  and so
we stick to the sample budget constraint formulation with the understanding that the
resulting choice of ̂ will satisfy the budget constraint approximately in the population.
   The technical results below concern the estimation of  , its inverse and the large
sample properties of these estimators. This distribution theory, which is significantly
more interesting than in the unconstrained case where  is known to be zero, is used to
(i) construct asymptotically valid confidence intervals for expected welfare  and its dual
(introduced below) and (ii) address the issue of covariate choice in treatment allocation.
Interestingly, it turns out here that the estimator ̂ of  (and thus of  in large samples)
                                                                              √
has the parametric rate of convergence but the corresponding ̂ is not -consistently
estimable in general. To see why, consider the special case where  is a scalar continuous
covariate with c.d.f.  (·) and  (·) is strictly increasing but otherwise unknown. Then
                                               ¡             ¢      ¡       ¢
              1 −  = Pr ( ()  ) = Pr    −1 () =   −1 () .

Inverting this, we get that
                         ¡           ¢   ¡                         ¢
                    =  −1 (1 − ) =  1 − 0 | = −1 (1 − ) .

Thus  is the nonparametric conditional expectation evaluated for the marginal treatment
                               √
recipient and is therefore not -consistent even when the marginal of  is known.
Although the distribution theory for ̂ is not of primary interest for the rest of the paper
(it is used to get the distribution of ̂), our result is somewhat interesting from a theoretical
perspective. It shows that when  (·) is an infinite-dimensional unknown parameter and
                         √
cannot be estimated in a -consistent way, then a quantile of the scalar random variable
                       √
 () is generally not -consistently estimable although the mean of  () is. To our
knowledge, this result is new and appears to us to be somewhat interesting because in
most cases of interest, quantiles and means have the same rates of convergence.
    Note that we can define the relevant population quantities, viz., ,  (·) and  as
solutions to the (semiparametric) moment conditions

                                    (1 − 0 −  () |) = 0,
                                  [1 ( () ≤ ) − 1 + ] = 0,
                             [ () × 1 ( () ≥ ) − ] = 0.

Of these, the second moment condition is diﬀerentiable in the scalar  if  () has a
density but, in general, not functionally diﬀerentiable in  (·), owing to the presence of
the indicator. This makes it infeasible to directly apply the methods of e.g., Chen, Linton
and Van Keilegom (2003) which requires (Hadamard) diﬀerentiability of all the population
moment conditions with respect to both the finite and the infinite dimensional parameters.


4     Estimation
We now formally define our estimators corresponding to the CES approach defined above.
Suppose ̂ () denotes an estimator of  () and ̂ 1 () an estimator of  1 (). In order to
circumvent the nonsmoothness of the population moment for  discussed above, we use
extra smoothing to construct our estimators. Suppose that  () is bounded between
[− ] on the support of . Then choose a symmetric (about zero) kernel  (·) with
                                                                           R
bounded support, w.l.o.g. [−1 1], the corresponding C.D.F. kernel ̄ () = −1  ()  for
each  ∈ [−1 1] and a sequence of bandwidths  converging (slowly) to zero as  → ∞.
The C.D.F. kernel simply converts the indicator function 1 { () ≤ } to a function that
changes smoothly from 0 to 1 as  () −  changes sign from positive to negative in finite
samples but approaches the indicator as  → ∞.
    Now define ̂, and ̂ by
                                   ( Ã                  !              )
                             1X
                                 
                                          ̂ − ̂ ( )
                                    ̄                     − {1 − }     = 0,
                              =1             
                             "                        Ã               !#
                        1X
                           
                                                        ̂ − ̂ ( )
                   ̂ −        ̂ ( ) − ̂ ( ) ̄                    = 0.                 (6)
                         =1 1                              

Notice that the solution to the first equation in the previous display is unique. Indeed,
the derivative of the LHS of the first equation w.r.t. ̂ is positive since ̄ (·) is the integral
of a (positive) kernel. Given that ̂ can be uniquely solved, the solution to the second
equation must necessarily be unique because ̂ is defined as the average of something
involving ̂ and other observed quantities. The smoothing applied in (6) is similar in
spirit to Horowitz’s (1992) analysis of the smoothed maximum score (see also Hall et
al (1999)). But in that problem, the finite-dimensional parameter of interest does not
explicitly depend on any infinite-dimensional underlying parameter. In contrast, here the
key parameters of interest,  and , are based on the infinite-dimensional component  (·)
through population moments that are not smooth in  (·). Thus the present estimators
lie at the intersection of classical 2-step semiparametric estimators and smoothing-based
estimators for countering non-diﬀerentiability. This makes both the results and the proofs
substantially diﬀerent from both strands of the literature.
     We now consider two cases as follows.
     Parametric Case: First consider the case where we have a finitely parametrized
regression model for  giving us  () =  ( ) and  1 () = 1 ( ), where the
functional forms  and 1 are known and  is a finite dimensional parameter. The
eﬃcient estimators of  can be constructed here either by a direct optimal minimum
distance approach or by a one-step GMM procedure. For general non-linear models with
a distributional condition, the MLE will be eﬃcient.
                                          ¡       ¢
   Nonparametric case: Suppose  ≡      where   contains the discrete com-
ponents of  and   is a -variate vector of the continuous components of  with support
     
X̄       and density  (·). Let  (·) be a density kernel and  a sequence of bandwidths
converging to zero at an appropriate rate, to be specified later, as  → ∞. Define ̂1 ( ),
̂0 ( ), ̂ 1 ( ), ̂ 0 ( ) as the Nadaraya-Watson regression estimators of respectively
 , (1 − )  ,  and (1 − ) on , evaluated at  =  , and calculated while leaving
out the th observation, e.g.,
                                           P                ³   −  ´ ¡          ¢
                                      1          
                                     −1    6=  
                                                                
                                                                  
                                                                      
                                                                        1  = 
                       ̂1 ( ) =          P               ³   −  ´ ¡          ¢.
                                       1               1                       
                                                                      1   = 
                                      −1      6=            


Now ̂ ( ) can be defined in terms of the above quantities as
                                                  ̂1 ( ) ̂0 ( )
                                     ̂ ( ) =             −          .
                                                  ̂ 1 ( ) ̂0 ( )
     For a large number of discrete regressors, one can also use multi-dimensional kernels
(typically product of several unidimensional kernels) and smooth across the discrete values
as well. As is well-known, this does not aﬀect the asymptotic distribution theory under
the same bandwidth conditions (c.f. Bierens (1994), theorem 10.4.3, Li and Racine (2007),
chapter 4). If, however, in place of a continuous regressor, we have a discrete regressor
taking infinitely many values (such as a Poisson random variable), one can simply use
cell-averages to estimate conditional means. Following the arguments of Delgado and
Mora (1995), it follows that smooth functionals of such nonparametric estimators are
√
 -normal, with no bias term. In our application, all discrete variables are binary and
the key continuous variable (wealth) does appear to be continuously distributed. So we
work with the traditional Nadaraya-Watson type estimators.
   Fixed Trimming: To avoid some technical issues related to boundary bias, we use
the following "fixed trimming" modification, as in Newey (1994), theorem 4.1. Let X̄
denote the support of  and let X be a compact subset of the interior of X̄ , such that
the density of  is bounded away from zero on X . Then to define our estimands, we will
simply work within X . Notice that in this problem, which ’s and what range of ’s
we want to use for conditioning treatment assignment is up to us. So the fixed trimming
condition can be interpreted as part of the problem description.5 However, we will suppress
the trimming term 1 ( ∈ X ) in the rest of our exposition to prevent notational clutter.
   Finite sample bias: Note that our estimator ̂ may be expressed as
                                                      Ã               !
                 1X               1X
                                    
                                                        ̂ − ̂ ( )
                       ̂ ( ) −       ̂ ( ) × ̄                   .
                  =1 1           =1                      
                                                                                    ³                ´
                                                                                        ̂−̂( )
The second term is composed of the product of ̂ ( ) and the term ̄                     
                                                                                                         and
the latter is large when ̂ ( ) is small. Because of the local variance in ̂ (),
                                                                                  ³ there     ´
                                                                                   ̂−̂( )
is potentially a negative correlation in the estimation errors in ̂ ( ) and ̄     
which would tend to introduce a positive bias in the estimate of . In order to mitigate
the bias, one option is to use a split-sample method as first suggested in Geisser (1975).
A simulation exercise using this method is reported in the appendix, part 2. Given that
the split-sample results seem to be worse to us—probably because the eﬀective sample size
is halved— we conduct the nonparametric application using full-sample methods. We will
return to split-sample methods again when we discuss covariate selection but in that case,
we restrict attention to parametric specifications, as suggested by a referee.
   5
       Imbens and Ridder (2009) have recently considered some alternatives to fixed trimming using a
"nearest interior point" modification to NW estimates.
5     Large sample theory
In this section, we consider the asymptotic distribution theory for our estimators. Section
5.1 outlines the simpler results for the parametric case where  () is known up to a finite-
dimensional parameter. Section 5.2 focuses on the nonparametric case. For the latter,
theorem 1 concerns asymptotic properties of ̂, theorem 2 concerns ̂. The key result is
that ̂ but not ̂ has parametric rate of convergence under regularity conditions.


5.1    Parametric Case
To get an idea for the distribution theory, consider the set-up where  () is parametrically
specified as  ( ), with  (·) known; typically  (the so-called “pseudo-true value”) is
a slope coeﬃcient in a linear or non-linear regression and can be estimated at parametric
rates using, say, GMM or the MLE. For some specific functional forms of  (· ·), e.g., a
                                R
linear one, the function  () = − 1 { ( ) ≤ }  () may be diﬀerentiable in 
and then no smoothing would be necessary; but smoothing-based methods (i.e., using )
are more generally applicable and so we focus on that. The key result is that both  and
                          √
 can be estimated at the -rate. We provide an outline of proof in the appendix at the
end of part 1.


5.2    Nonparametric Case
The nonparametric case is far more involved and occupies the bulk of our technical proofs
in the appendix. It has the obvious advantage of being robust to distributional misspec-
ifications and is therefore our preferred method. We now present two results regarding
the large sample behavior of our estimators of  and . The exact conditions under which
these hold are listed in the appendix together with the proofs of the results.
    The next theorem deals with the distribution of ̂ which is ultimately needed for
obtaining confidence intervals for  . The key assumptions for the following theorem 1
are that for some  ≥ 2, density of  (·) has at least  − 1 uniformly bounded derivatives,
the ( − 1)th one denoted by  (−1) (·), the bandwidth sequence satisfies 2+1 →   ∞,
                                         R1
 (·) is an th order kernel satisfying −1   ()   ∞, and  2 () :=  ( | = )
                                                                           √
are finite for  = 0 1. The asymptotic bias of ̂ will be proportional to  which can be
                                                                       1
made to go to zero by choosing  to be of smaller order than − 2+1 but at the cost of
increasing the variance (see below for more on this).
Theorem 1 Under conditions A0-A3, A4(i), conditions B3(i) and B4(i) and B5, listed
in the appendix, we have that
                                     ̂ −  =  (1) .

Further, under conditions A0-A4 and B3-B11, detailed in the appendix, we have that
                 p                 µ                    Z           ¶
                                       2 () +  2 () 1 2
                    (̂ − ) →                         ()  ,
                                              ()      −1

where
                                 ½                           ¾
                     2               20 ()
                     () =                     | () = 
                                Pr ( = 0|)
                              ½                              ¾
                     2               21 ()
                     () =                     | () = 
                                Pr ( = 1|)
                                 √                   Z 1
                                         (−1)
                         = (−1)        ×      ()       () .
                                  !                  −1

   Proof. Appendix
   Finally, we state the result for ̂, under somewhat stronger conditions than the ones
above. The  defined above now needs to be at least 4 and the kernel  is then of a
"higher-order" variety. Define

               1 =  { () − 1 ( ( ) ≤ )} ,
              2 =  ( ) × 1 { ( ) ≤ } − ,
                                             
              3 = 1 ( ( ) ≤ ) ×                 {1 −  (1 | )} ,
                                       Pr ( = 1| )
                                           1 − 
              4 = 1 ( ( ) ≤ ) ×                 {0 −  (0 | )} ,
                                       Pr ( = 0| )
                = 1 + 2 + 3 − 4 .

Theorem 2 Under conditions A0-A4 and B3-B11, listed in the appendix, we have that

                                     ̂ −  =  (1) .

Further, under conditions A0-A5, B3-B12, listed in the appendix,

                              1 X                        1 X
                                                            
             √                         1 −  1 ( )
               (̂ −  ) = √                       −√       +  (1) .          (7)
                                =1 Pr ( = 1| )        =1 
   Proof. Appendix.
   The proof works by using
                                                                                 Ã                   !
                             1X                 1X
                                                               
                                                                                     ̂ − ̂ ( )
                        ̂ =       ̂ 1 ( ) −       ̂ ( ) × ̄                                      .
                              =1               =1                                     

The first term is then analyzed via lemma 3 in the appendix and a Taylor expansion cou-
pled with U-statistics results are used to show that the second term has an asymptotically
linear form. The final variance can be consistently estimated using sample cross-products,
under standard conditions for the WLLN. It may be noted here that the estimation error
in ̂ (·) aﬀects the distribution of ̂ through the terms  3 and 4 .
   Bias Removal: Our proofs of the above results use bias-removal. If  (·) has bounded
derivatives up to order ( − 1), then the MSE of (̂ − ) is given by
                   "    (−1)          Z                      #2
                                                               ∙                Z           ¸
                               ()        1
                                                            1  2 () +  2 () 1 2
         2
              ×                                
                                                ()  +                           ()  ,
                            !             −1                     ()       −1
                   |                       {z           }      |              {z            }
                                                                                            

                                                            1                ¡  ¢ 2+1
                                                                                     1
implying an MSE minimizing bandwidth choice of  = ∗ − 2+1 , where ∗ = 2 2       .
                                            √
This choice of  does not work ³
                                for getting
                                         ´ a -rate for ̂ because (c.f. step 6A in the
                      √             1
proof) it implies that  =   2(2+1) which blows up to +∞. So we need to choose
 to be smaller than the one that is MSE-optimal for .
   Bandwidth Conditions: The conditions in the appendix impose several restrictions
on bandwidths which are related to the dimension  of , the extent of smoothness 
of the density of  () (higher  implying faster convergence for ̂), smoothness  of the
function  (·) (higher  implying faster convergence for ̂ (·)) and the number of moments
 of the dependent variables. They imply suﬃcient moment and bandwidth conditions
for a rate of uniform convergence, obtained in Hansen (2008) and Newey (1994). It is
useful to have a specific choice of bandwidths which imply the conditions for (7) (which
requires the strongest conditions). We can choose the bandwidth  for estimating  (·)
as   = − and the bandwidth  = − for some    0 which satisfy the following
                                                               +2
suﬃcient restrictions:  ≥ 4,  ≥ 4,  ≥                        
                                                                   , 16      1
                                                                                   , 5
                                                                                 2 12
                                                                                             1 and   14 . This
choice will satisfy all the
                         ¯ conditions  ¯ for (7) and, in particular satisfy suﬃcient conditions
                         ¯             ¯      ¡ −14 ¢
for the result that sup ¯̂ (·) −  (·)¯ =          . In particular, for  = 1, one can assume
                                                    1        5
 = 3,  = 4,  = 4 and set  =                     7
                                                        and 24    14 , which is what we use in the application.
    Distribution theory for dual: Recall that the value function for the dual problem
  () represents the smallest fraction of households who have to be assigned to treatment
(optimally) to guarantee that the expected mean outcome is at least . In other words,
 [  ()] equals , where   () plays the role of  in the primal problem. The   () is
estimated by the sample analog ̂ () = ̂−1 (). Using a standard first-order expansion,
and noting that 0 () equals  (), one gets that
                                         √
              √ ³                 ´         (̂ ( ()) −  { ()})
                 ̂ () −   () = −                                 +  (1) ,
                                                     { ()}
                                          √ ³                  ´
from which the asymptotic normality of  ̂ () −   () follows by applying the above
theorems.


6     Choosing Covariates
The above analysis has considered treatment targeting by a fixed set of covariates and
experimental estimates from large samples were used to determine CES type allocation
rules based on these covariates. The resulting expected welfare ( ) is then approximated
in a large-sample sense by an appropriate sample analog (̂). However, one practical
consideration in designing treatment protocols is to decide which covariates to choose for
targeting. A brief outline of the problem and a practical solution based on cross-validation
is discussed below. A full-blown theoretical analysis of this question is beyond the scope
of the present paper. But in appendix subsection 4, we provide an outline of a potential
theoretical approach, based to local-to-zero type asymptotics, for analyzing the problem.
    Basically, there are two considerations involved. One is the financial cost of gathering
covariate information required for implementing the desired allocations. The second is
the issue of statistical precision of covariate-conditioned treatment eﬀects obtained in the
finite experimental sample.
    For the following discussion (as recommended by a referee), we concentrate on the case
where  (·) is parametrically specified as 0 ,  ∈ R and let  :=  (  (·)) denote the
treatment threshold.
    Finite sample accuracy: Suppose we want to choose one among a set of covariate
combinations, indexed by {1  } with  and ̂  denoting the parameter and its MLE,
respectively, corresponding to covariate set . Analogously, denote the treatment thresh-
old and its estimator by   and ̂  . The case  = 0 will denote the full covariate set. Let
 denote assigning an individual to treatment and consider the loss function
                           Z
           L (; (  )) = (0  −  (  )) × [1 (0    (  )) − ]  ()         (8)

The above loss function penalizes when knowledge of the true (  ) would recommend
giving  = 1 (0) but  leads n
                             to recommendation
                                       ³      ´o of 0 (1).
                                                       ³ When´ using all covariates, the
CES rule is of the form  = 1 0 ̂   ̂ ̂ , where ̂ ̂ denote estimates of (  ).
Now consider two rules, one where allocation is based on covariate set  (with respective
parameters   and   ) and one where it is based on the full feasible set of covariates.
Using an Edgeworth expansion, the risk diﬀerence between using the full set versus the
set  = 1, say, up to first order is given by

           ((  )   0 (·)) − 1 ((  )   1 (·))
      :=  − 
       Z 1                 ∙ µ 0                   ¶    µ 0              ¶¸
           0                     1 −  ( 1   )         −  (  )
     =   (  −  (  )) × Φ             √          −Φ            √         () ,
                                   1 ()                   ()  

where  1 () and  () denote respectively the asymptotic standard deviation of 0 ̂ 1 − ̂ 1
and 0 ̂ − ̂. This expression sheds light on the role of estimation precision. Note that
                                          ¡     ¢
whenever 0  −  (  ) and 0  1 −   1   have diﬀerent signs, the integrand will
be negative irrespective of the values of  1 () and  (). When they have the same
sign, however, the integrand will tend to be positive whenever  1 () is small relative to
 (). This suggests that the narrower model will yield higher welfare in finite samples if
covariates not included in it have small impact on the treatment eﬀect and/or there is a
large amount of variation in these covariates in the sample (leading to smaller  1 ()).
   Financial costs: Using a larger number of conditioning covariates can yield bet-
ter (at least, no worse) targeting if our estimates come from large samples. However,
measuring more covariates is also financially expensive. These measurement costs are
incurred for everyone in the population during the actual treatment assignment and not
just for individuals getting the treatment. Furthermore, unlike statistical precision costs,
the measurement costs do not disappear with increasing sample size. Suppose we are
choosing whether to condition treatment on a larger set 0 or a smaller subset 1 where
gathering information about  entails a per capita expenditure of  ,  = 1 2. Suppose
these two conditioning sets yield expected welfare functions 0 (·) and 1 (·), respec-
tively. Also suppose  is the average welfare we want to attain. Then the expected per
capita cost of using 1 is the sum of the treatment cost plus the cost of measuring 1 ,
i.e., −1           6                                                      −1
       1 () + 1 . Similarly for 0 . Therefore, we should choose 0 if 1 () + 1 is large
relative to −1
             0 () + 0 .



6.1          Feasible Rules
Note, however, that since the  ’s are unknown, they cannot be used directly in choosing
 and feasible sample-based rules are warranted. This problem is a somewhat complicated
version of classic model selection problems, on which there is a large literature in statistics
and time-series econometrics. The complication arises here because the underlying con-
strained optimization problem makes the welfare function depend on both the conditional
mean of 1 , 0 , and the marginal distribution function of the covariates in a complicated
way.7
      In the frequentist approaches to model selection in simpler settings, one aims to esti-
mate the risk arising from the use of estimates in place of true values, i.e., in the present
context, estimate  . See, for instance, Claeskens and Hjort (2008, CH hereafter) for a
comprehensive textbook treatment. For reasons of brevity, we concentrate on the method
cross-validation for the present paper but note that other frequentist approaches, e.g.,
resampling based methods and Bayesian approaches could be potentially used here, as
well.
      Cross-validation (CV): The CV idea is to split the sample into a training part
(containing  − 1 observations) and a validation part (containing 1 observations). For
a given covariate choice , for each such split, the parameters  and  are estimated
using the training part —call these ̂  and ̂  . Then these estimates are used to make
allocations for the validation part and the welfare for that particular split is calculated
as:
                         "                                                                                         #
                1 X
                    1
                                                n                 o          (1 −  )      n                 o
      ̃   :=              1
                                  P 1         1 0 ̂  ≥ ̂  +   1
                                                                              P1              1 0 ̂   ̂  .   (9)
                1 =1       1      =1                               1      =1 (1 −  )

The overall welfare is calculated by averaging the per-split welfare across all possible
splits of the sample. A particularly popular split in statistics is the leave-one-out version.
      6
          Notice that in this case,  and −1 are both measured in monetary units and are thus directly
comparable.
   7
     Constructing Manski (2004)-style bounds on exact finite sample risk for diﬀerent covariate choice
is diﬃcult here owing to the complicated nature of the probabilities which involve, among other things,
finite sample Lorenz shares for the finite sample conditional mean function.
The idea here is to predict welfare from using estimates from samples of size  − 1 to
design the allocation for for the remaining observation. Averaging across the sample
observations then mimics the average welfare of the CES rule across samples drawn from
the population.8 A modification of the above is provided by  -fold CV (c.f., Geisser
(1975)) — where the sample is split into  disjoint subsamples randomly; then each of the
 subsamples is used for validation and the result averaged across them.
    In order to compare the accuracies of the cross-validated and the naive sample-based
estimates of welfare in finite samples, we performed a small Monte Carlo exercise based
on our sample data, which is reported in the next section. In the actual application, we
complement our results based on the asymptotic approach of section 4 with a leave-one-
out CV approach (which gave the best results in the Monte Carlo for small samples) to
see how covariate choice in the parametric specification may be dictated by sample size.
    One issue we do not address here, though, is that of post model-selection inference,
which may be relevant in practice, especially when one model is chosen over many com-
peting ones. In the appendix subsection 4, we briefly outline an (local-to-zero type)
asymptotic framework that seems appropriate for the covariate choice problem for finite
samples and describe how that would relate to the post-model selection inference issue.


7        Application to bednet provision

7.1        Background
We now consider a substantive application —viz, the allocation of subsidies for long-lasting
insecticide-treated nets (ITNs) to households, using experimental evidence from Kenya.
Our treatment of interest is making subsidized ITNs available to a section of this popu-
lation.
    ITNs have been shown to reduce overall child mortality by up to 38 percent in regions
of Africa where malaria is the leading cause of death among children under 5.9 In addition,
ITN use can help avert some of the substantial direct costs of treatment and the indirect
    8
        It is possible to show that ̃ is first-order equivalent to the naive ̂ minus a penalty term that is
related to the variance of ̂  (see appendix part 4, last sub-section).
    9
      See Lengeler (2004) for a review. Earlier estimates of ITN use on reductions in child mortality from
a randomized trial in Gambia were as high as 60 percent, but most estimates from randomized trials in
Africa are closer to 20 percent.
costs of malaria infection on lost income.10 Lucas (2007) estimates that, alone, the gains
to education of a malaria-free environment more than compensate for the cost of an ITN.
Costing $5 - $7 a net, however, ITNs are not aﬀordable to most families (Cohen and
Dupas, 2010; Dupas, 2010). For this reason, there is a large consensus that ITNs should
be fully subsidized (WHO, 2007; Sachs, 2005).
    Teklehaimanot et al (2007) estimate that providing one free long-lasting ITN for every
two at-risk persons in sub-Saharan Africa would amount to 2.5 billion dollars. The funds
committed by governments and donor agencies for ITNs have not yet reached that amount,
however. For example, the Government of Kenya estimates that around 1 million pregnant
women are in need of an ITN every year, but their budget will allow them to provide only
0.5 million nets per year to pregnant women over the next 5 years (Kenya Round 7
Proposal, 2007).
    Under such a budget constraint, the question of how to allocate the available ITNs
among households becomes an important policy question. If the treatment eﬀect (the
health impact of getting a subsidized ITN) is exactly the same for everyone in the pop-
ulation, then all possible allocations will lead to the same overall gains. However, when
there is heterogeneity in the treatment eﬀect (e.g. the health impact of getting a sub-
sidized ITN varies with observed covariates, such as socioeconomic status, presence of
children in the household, etc.), the gains can be maximized by a covariate-based alloca-
tion. While the health impact of using an ITN might be homogenous, the health impact
of getting a highly subsidized ITN might vary across covariates since usage rates (con-
ditional on having a net) are likely to vary across covariates. For example, households
who can aﬀord to purchase an ITN in the absence of any subsidy (because they have
access to credit or are wealthy enough) will not benefit from the treatment very much
(i.e. their  0 () will be large and thus for them the diﬀerence  1 ()− 0 () is likely to be
small). Likewise, since young children are the most vulnerable to the disease, households
without young children might not benefit much from the treatment (i.e. their  1 () will
be small and thus the diﬀerence  1 () −  0 () is likely to be small). For these reasons,
the treatment eﬀect is likely to vary across observed covariates such as wealth, access to
financial services, and the presence of young children. An allocation rule that takes into
account such heterogeneity could potentially generate important welfare gains.
  10
       Ettling et al. (1994) find that poor households in a malaria-endemic area of Malawi spend roughly
28 percent of their cash income treating malaria episodes.
7.2       Design
For this application we use data from a randomized experiment conducted with rural
households in Western Kenya in 2007 (Dupas, 2009). The price at which a household
could purchase an ITN varied from $0 (a free ITN) to $4, in steps of $0.50. Households
were randomly assigned to a price. People had three months to redeem the voucher
entitling them to an ITN at the assigned price. In this application, we consider two
groups: households that faced a very low (highly subsidized) price ($0 or $0.50) and
households that faced a high price of $2 or more. Table 1 presents summary statistics on
the 1007 households that form the sample used in the analysis.
    The take-up rate of the ITN subsidy was 84% in the low price group and 13% in the
high price group. Conditional on take-up, the usage rate was slightly higher in the low
price group than in the high price group (70% versus 58%), leading to coverage rates
of 60% and 8%, respectively. In what follows, we consider the low price group as the
treatment group and the high price group constitutes the control. The treatment is thus
“having access to a low-price ITN”.11
    The welfare measure we consider is the fraction of households covered by an ITN (i.e.,
the fraction that owns and uses an ITN). While incidence of malaria, health levels, wages
lost due to malaria, or even consumption foregone due to wages lost due to malaria, could
be the “ultimate” outcomes of interest, we concentrate on the ITN coverage rate for two
reasons. First, as discussed above, multiple trials have established that ITN coverage leads
to significant reductions in morbidity and mortality, especially among young children (see
Lengeler (2004) for a review), and therefore the coverage rate is a good proxy for those
ultimate outcomes. Second, in our data, coverage was observed directly (through surprise
home visits during which enumerators checked whether the ITN was hung above a bed),
and therefore is not subject to reporting biases, in contrast with self-reported health
measures.
    To test for heterogeneity in the treatment eﬀect, we run an OLS regression of ITN
coverage on the treatment, three covariates, and the interactions between the treatment
  11
       One may note that the short-run take-up in the low price group was not 100%, since some of the
“treated” had to pay a small fee (i.e., $0.50) to access the net. In the analysis below, however, we assume
that take-up was 100% in the treatment group. In other words, we consider that those who did not
take-up the subsidy cost as much to the government as those who took-up the subsidy but didn’t use
their net. This is because the take-up would potentially have reached 100% if people had had more than
three months to redeem their voucher.
and the covariates. The covariates are: a binary variable equal to 1 if the household
includes at least one child under 10; the natural log of the value of the household’s wealth
per capita; and a binary variable equal to 1 if the household owns a bank account. The
first covariate (presence of a child) was chosen as an indicator of the private returns to
using a bed net (since young children are the most vulnerable to malaria). The two other
covariates were chosen as proxies for socioeconomic status and ability to pay. They were
measured through a baseline survey administered through household visits. In particular,
wealth per capita was measured as follows: households were asked to list all their assets
(including animal assets) and to estimate their resale value. The combined value of all
assets was then divided by household size to obtain the “wealth per capita” indicator.
Such wealth is typically held in relatively illiquid assets, however. For this reason, we
include “ownership of a bank account” as a second ability-to-pay measure. Savings held
in a bank are perfectly liquid, and in our study area, access to formal financial services
has been shown to be an important determinant of households’ ability to save and acquire
lumpy durables (Dupas and Robinson, 2009). Of the three covariates we use, the most
costly one to measure is wealth, which typically requires a lengthy home visit by an
enumerator. Conditional on making this visit, asking respondents about their household
composition and their ownership of a bank account would not be onerous. One issue
though is that of the reliability of such self-reported information, once people know the
allocation rule. This is not a concern in our dataset since the respondents were explicitly
told (through the informed consent process) that their answers would have no bearing on
what treatment they would be eligible for in the future, but in an actual program, once
the allocation rule is well-known, collecting reliable information on the covariates that
determine eligibility might be quite costly. This cost would then need to be accounted for
in choosing covariates, as discussed above.
   The results are presented in Table 2. The treatment was randomized at the household-
level so no clustering correction is needed. We find that the treatment eﬀect appears
significantly higher for households with a child under 10 and significantly lower for house-
holds that own a bank account. The treatment eﬀect is also lower for those with greater
wealth, but the standard error is also large and the interaction term is not significant. An
F-test of the joint significance of the three interaction terms is significant at 5%.12
  12
       Two commonly used covariates are age and education level. They do not appear to aﬀect the
treatment eﬀect in our sample, possibly because the sample is relatively homogeneous in terms of those
7.3     Analysis
7.3.1    Non-Parametric Analysis: Choice of Kernels and Bandwidths

For bias-removal, we use the kernels13
                        ¡      ¢
            () = 05 × 3 − 2 ×  () ,
                      µ                      ¶
                    15 7 5 10 3           16
            ̄() =       −  + 3 +          × 1 (−1 ≤  ≤ 1) + 1 (  1) ,
                    32 5      3           15

where  (·) is the standard normal density. Two bandwidths are needed for the non-
parametric estimation: the bandwidth  in the estimation of the conditional ATE  (),
and the bandwidth  in the smoothing correction. Figure 1 graphs how the estimated
treatment threshold ̂ (Panel A) and value function ̂ (Panel B) vary with  for a range
of possible  . We find that both estimates are insensitive to the choice of  . In Figure
2, we present ̂ and ̂ for two budget constraint levels:  = 05 (Panel A) and  = 025
(Panel B). The stability of ̂ over a reasonable range of bandwidths suggests that the
choice of bandwidths should have little eﬀect on the nonparametric estimates of the value
function.
    Figure 3 graphs a leave-one-out cross validation criterion function for  (). The
function is plotted over the range  ∈ [03 04], which correspond roughly to −16
and −18 , respectively. The function seems to dip around  = 033. Given the small
sensitivity of our estimates of  and, to a certain extent,  to the choice of   , we show
the results for both   = 03 and   = 04. We use  = 035; recall that the results
seem very insensitive to the choice of  for a given choice of   .

7.3.2    Conditional ATE

The nonparametric estimate of the CATE ̂ () was computed corresponding to two band-
widths   = 03 and   = 04. The parametric estimator of  () was computed as
̂ () = (̂ 0 + 0 ̂01 ), where ̂ 0 and ̂01 are OLS estimates in the regression (presented in
Table 2):
                              = 0 + 0 1 +  0  + 0  1 ×  +  .                         (10)
two characteristics.
  13
     To see how our results are aﬀected by choice of a higher order kernel, we repeated the analysis for a
standard normal kernel instead of  (). The results are numerically very similar and do not imply any
substantively diﬀerent conclusion (results available upon request).
   Figure 4, Panel A graphs the kernel density of the conditional ATE  () computed
with the two proposed bandwidths, as well as the parametric estimate for comparison
purposes. Observations with  such that  () is below −02 or above 09 were discarded
in accordance with appendix condition A2. These cutoﬀs were the 1 and 99 percentile
values in the empirical distribution of  ().
   Figure 4, Panel B presents the c.d.f. of the conditional ATE  () computed both
parametrically and nonparametrically. The stepwise shape for the c.d.f. in the parametric
model is essentially due to the binary nature of two of the three covariates since the
interaction of the treatment with wealth appears to be close to zero in the parametric
case. Finally, Panel C of Figure 4 presents the estimates of  1 () and  0 () as a function
of the continuous regressor (wealth), for each cell defined by the discrete regressors.

7.3.3   Unrestricted and Restricted Value Functions

In what follows, we compare the “first best” allocation (the unrestricted case, in which
the allocation is based on all three covariates) with two “restricted” cases: (i) means-
testing where the allocation is based only on wealth— which is extremely common in
both developed and developing countries, and (ii) purely random allocation which is not
covariate-based at all (this is totally uncommon as far as we know, but makes for a
convenient benchmark). Notice that in the random allocation case, the estimated value
function is linear in :

                              1 Xn                                       o
                                 
                      ̂() =        × ̂ 1 ( ) + (1 − ) × ̂ 0 ( ) .
                               =1

   Figure 5 graphs the parametric and nonparametric estimates for the treatment thresh-
old  () and the value function  () in the unrestricted case. The nonparametric estimates
seem very stable over the two choices of bandwidth. The nonparametric estimates of the
unrestricted value function are higher than the parametric estimates.

7.3.4   Welfare Losses

Figure 6 combines the estimates of the value function  () for all three cases: allocation
based on all three covariates (called unrestricted), allocation based on wealth only, and
random allocation. Panel A presents the parametric estimates and Panel B presents the
nonparametric estimates. Presenting all three cases on the same graph helps visualize
the welfare loss when the optimal allocation is not implementable. In contrast to the
parametric estimates, the non-parametric estimates suggest that means-testing is a clear
“second best”, generating a higher mean outcome than random allocation does. The
standard errors of the welfare losses generated by the two suboptimal allocations are
shown in Table A1 for two budget constraints ( = 25% and  = 50%).

7.3.5   Dual Problem

In Table 3 we report the minimum resources needed to attain a certain expected outcome:
we compute the share of the population that needs to be treated in order to achieve a
given target value function by allocating treatment based on all three covariates (column
2). We then calculate the additional resources that are needed when the optimal, un-
restricted allocation is not possible, and the allocation is instead based on wealth only
(column 3) or the allocation is purely random (column 4). The nonparametric estimates
with the bandwidth  = 04 suggest that, compared to the unrestricted allocation, an
allocation based on wealth only requires treating an additional 65 percentage points of
the population compared to the optimal allocation (Panel B2, column 3). The additional
spending is higher when the allocation is purely random: an extra 137 percentage points
of the population need to be treated to reach the target usage rate, compared to the
optimal allocation (Panel B2, column 4).


7.4     Estimating welfare in finite samples
The application above was based on the large sample approximation to welfare  gen-
erated from using a fixed set of covariates. The approximation is provided by ̂ , the
sample-based estimate of the welfare. This approximation may be inaccurate in finite
samples if the number of conditioning covariates is large, relative to the sample size. In
order to compare the accuracies of ̂ , the naive sample-based estimate with that of ̃ ,
the cross-validated estimate of finite sample risk, we perform a small Monte Carlo exercise
on a parametric specification, as follows.

7.4.1   Monte-Carlo

Making random draws from the sample of interest, we create an artificial dataset of 1008
observations and remove the outcomes. We generate outcomes 1 and 0 through the
probit equation
                             = 1 (0 + 1  + 02  + 03  ⊗  +   0) ,

where the  coeﬃcients are chosen equal to the estimates from a probit regression of 
on the regressors, the treatment and the interaction of the regressors and the treatment,
in the original sample. The error  is chosen to be 3 times a standard normal. This is
used as our population. From this population, we draw samples of varying size. For each
sample, we estimate  and  through a linear (as opposed to probit) regression, calculate
the implied allocations and, by averaging over many samples draws from the population,
compute for each sample size (i) the actual welfare ( ), (ii) the estimated welfare (̂ )
and the cross-validated welfare (̃ ) where we use both a leave-one-out and a 2-fold CV.14
The results are reported in Table 4A (estimated and true welfare), B (Bias and standard
deviation of welfare estimator) and C (MSE of welfare estimator). We see in table 4A
that as the sample size increases,  s are generally increasing as expected but ̂ and ̃
are not. Table 4A also shows that for smaller sample sizes, the welfare from using fewer
covariates is larger and in this case, the leave-one-out CV criterion favours the smaller
model while ̂ always favors the larger model.
   From table 4B, we see that the bias of ̂ in estimating  is larger in almost all cases
than the bias in ̃ s and this is more pronounced as the sample size falls. This is to be
expected, given that CV is generically equivalent to a higher-order bias removal. It is
also instructive that the bias of ̂ is positive, which is consistent with the point made
just before section 5. In terms of the MSE, reported in table 4C, the leave-one-out CV
performs the best except when the sample size is relatively large and consequently ̂ is at
least as good as a leave-one-out CV. However, given that the leave-one-out CV criterion
performs best in small samples and almost as well in larger samples as the naive estimator
̂ , we propose using it to choose between alternative subsets of targeting covariates, in
the application. Those results are reported in table 5 and discussed next.

7.4.2      Cross-Validation Results for Application

We consider the parametric model (10) and two subsets of covariates — (i) household wealth
— the most popular targeting criterion in both developed and developing countries and (ii)
the combination of wealth, number of children under 10 and possession of a bank account.
  14
       Results are indistinguishable between the nonsmooth and the smoothed version of (9) with  varying
between −15 to −18 .
We calculate the leave-one-out welfare estimate using three samples of diﬀerent sizes.
These samples were chosen by randomly sorting the original data of 1008 observations
(with a specific seed) and choosing the top 500, 800 and 1008 observations. The welfare
from using diﬀerent subsets of regressors and diﬀerent sample sizes are displayed in table
5.
     The table can be read as follows. For the first panel with c=0.50, sample size=500,
the number 0.3540 was obtained as follows. Choose the first 500 households, as described
above. Then (i) regress the outcome for individuals randomized into treatment on wealth
only and (ii) regress the outcome for individuals randomized out of treatment on wealth,
bank account and child. For each individual in the data, predict their outcomes with the
subsidy (1 ) using the first set of estimated coeﬃcients and their outcome without the
subsidy (0 ) using the second set of estimates. Calculate the diﬀerence and its median in
the sample which is ̂. Then calculate the cross-validated welfare estimate as described
in the previous section. Repeat for the other sample sizes. The highlighted values indi-
cate the highest number among the four cells. The naive estimates (̂) are reported in
parentheses.
     From table 5 it is apparent that CV recommends using wealth only to target the
subsidy when the sample size is less than 800. For sample size 800, the two conditioning
sets yield similar levels of welfare and for the full sample, it is advisable to use all three
covariates for both 0 and 1 . Further, for the smaller sample sizes, it is nearly as eﬀective
to predict 1 using wealth only and 0 using all three covariates as it is to use wealth
only for both 1 and 0 . The reverse conditioning produces significantly lower welfare.
This asymmetry arises most likely because there are many more observations with no
treatment and so the additional covariates —children and bank account— have relatively
low explanatory power for treatment eﬀects when the household actually receives the
subsidy and relatively high explanatory power when it does not. In contrast, the naive
estimate, which ignores the finite sample inaccuracy, suggests using all 3 covariates for 0
for all sample sizes.


8      Conclusion
In this paper, we have considered a social planner’s problem of allocating a binary treat-
ment among a target population based on observed covariates in the presence of budget
constraints. The paper proposes a simple covariate-conditioned allocation rule based on
sample data from a randomized experiment. The paper then derives and uses large-
sample frequentist properties of these rules to infer the expected welfare from the rule
and the minimum cost of attaining a specific average welfare— i.e., the dual problem.
These methods are applied to data on the provision of anti-malaria bed nets in Western
Kenya. The empirical findings are that a government which can aﬀord to distribute bed
net subsidies to only 50% of its target population can, if using an allocation rule based on
multiple covariates, increase actual bed-net coverage by 17 to 20 percentage points rela-
tive to random allocation. These conclusions are based on large sample approximations
and we investigate, using leave-one-out and 2-fold cross-validation and in both a Monte
Carlo and the actual application data, their robustness to small sample inaccuracy. Our
findings suggest that under parametric specifications and when using evidence from small
experimental samples (under 800 in our application), it is better to condition the subsidy
solely on household wealth; however, for our full sample of size 1008, the expected subsidy
use increases by about 9 percent when we condition on two discrete household charac-
teristics, viz. presence of small children and possession of a bank account, in addition to
wealth.
   This paper has left several topics to future research. A formal analysis of covariate-
selection and post model-selection inference in treatment choice problems is being pursued
by the present authors. This analysis uses tools from the frequentist literature on model
selection, paying specific attention to bias-variance trade-oﬀs implicit in various forms of
cross-validation or resampling-based techniques. A particularly challenging task is to con-
sider this problem when treatment responses are not assumed to have specific parametric
forms. On the substantive front, one possible extension is to the design of conditional cash-
transfer programs, which have gained popularity in a large number of central and south
American countries. A second extension would be to incorporate treatment externalities
into an analysis of eﬃcient treatment assignment. Extension to multiple treatments would
also be a theoretically interesting and practically relevant exercise.
   A caveat to our analysis is the implicit condition that the covariate distributions are
not aﬀected by the targeting strategy used. This may be violated if the population com-
position changes in response to changes in the targeting rule, e.g., switching subsidy
eligibility towards families with children in a district may see an influx of families with
children from neighboring districts, thereby altering the marginal distribution of covari-
ates. Such migration is plausible only when the size of the transfer is high enough relative
to migration costs and thus quite unlikely at the usual scale of in-kind transfer schemes
present in the developing world today. But for larger sized transfers, this caveat can
potentially be an important one.
   The methods proposed here have wider applicability, beyond subsidy targeting in
developing countries, to nearly any situation of constrained treatment assignment such as
deciding eligibility rules for access to credit under aggregate fund constraints or allocating
the unemployed to subsidized job-training programs when subsidy totals are limited by
the government’s budget outlay.
   We would like to end with the observation that in development circles, there has been
a recent push for more experimental evidence on the impact of social programs, as part of
a general eﬀort to improve the eﬀectiveness of aid (Duflo, Kremer and Glennerster, 2008).
For example, the World Bank recently launched the DIME initiative, an eﬀort to increase
the number of Bank-funded projects with impact evaluation components. We believe that
as randomized trials of social programs, e.g., Oportunidades (PROGRESA) in Mexico,
become more common in both developed and developing countries, our methodology will
become increasingly relevant in helping governments and aid-agencies roll out positive-
impact programs via eﬃcient allocation rules.
References
 [1] Andrews, Donald. W. K. (1999): "Estimation When a Parameter Is on a Boundary,"
    Econometrica, 1999, 67: 1341-1383.

 [2] Attanasio, Orazio, Costas Meghir and Santiago (2011): “Education Choices in Mex-
    ico. Using a Structural Model and a Randomized Experiment to Evaluate PRO-
    GRESA,” forthcoming in Review of Economic Studies.

 [3] Behnke, Stephanie, Markus Frölich and Michael Lechner (2009): “Targeting Labour
    Market Programmes — Results from a Randomized Experiment.” Swiss Journal of
    Economics and Statistics, 145, 221-268.

 [4] Berger, Mark, Dan Black and Jeﬀrey Smith (2001): “Evaluating Profiling as a Means
    of Allocating Government Services,” in Michael Lechner and Friedhelm Pfeiﬀer (eds.),
    Econometric Evaluation of Active Labour Market Policies, Heidelberg: Physica, 59-
    84.

 [5] Bhattacharya, D. (2009): “Inferring Optimal Peer Allocation using Experimental
    Data,” Journal of the American Statistical Association, Vol. 104, No. 486: 486—500.

 [6] Claeskens and Hjort (2008): Model Selection and Model Averaging, Cambridge Uni-
    versity Press.

 [7] Cohen, Jessica and Dupas,Pascaline (2010): “Free distribution or cost-sharing? Evi-
    dence from a randomized malaria experiment in Kenya”. Quarterly Journal of Eco-
    nomics, 125 (1): 1-45.

 [8] Dehejia, Rajeev H (2005): Program Evaluation as a decision Problem, Journal of
    Econometrics, vol. 125, no. 1-2, pp. 141-73.

 [9] Delgado, M and J. Mora (1995): Nonparametric and semiparametric estimation with
    discrete regressors, Econometrica, vol. 63, no. 6, pp. 1477-1484.

[10] Duflo Esther, Rema Hanna and Stephen Ryan (2007). “Monitoring Works: Getting
    Teachers to Come to School”, forthcoming, American Economic Review.
[11] Duflo, Esther, Michael Kremer and Rachel Glennerster (2006). “Using Randomiza-
    tion in Development Economics Research: A Tool Kit”, Handbook of Development
    Economics, Volume 4, Editors T. Paul Schultz, pages 3895-3957 (2008).

[12] Dupas, Pascaline (2009). “What matters (and what does not) in households’ decision
    to invest in malaria prevention?” American Economic Review Papers and Proceed-
    ings, 99(2): 224-30.

[13] Dupas, Pascaline (2010). “Short-Run Subsidies and Long-Run Adoption of New
    Health Products: Evidence from a Field Experiment”. mimeo, UCLA.

[14] Dupas, Pascaline, and Robinson, Jonathan (2009). “Savings Constraints and
    Microenterprise Development: Experimental Evidence from Kenya”. NBER WP
    #14693.

[15] Eberts, Randall W., Christopher J. O’Leary, and Stephen A. Wandner, (eds. 2002):
    Targeting Employment Services, Kalamazoo, MI: W.E. Upjohn Institute for Employ-
    ment Research.

[16] Efron, B. (1986). How biased is the apparent error rate of a prediction rule?, J. Amer.
    Statist. Assoc., 81(394):461—470.

[17] Efron. B (1990): The jackknife, the bootstrap, and other resampling plans". Society
    of Industrial and Applied Mathematics CBMS-NSF Monographs, 38.

[18] Ettling M, et al. (1994): “Economic Impact of Malaria in Malawian Households.”
    Tropical Medicine and Parasitology. 45: 74-79.

[19] Frolich, M. (2008): “Statistical treatment choice: an application to active labour
    market programmes,” Journal of the American Statistical Association, 103 (482),
    547-558.

[20] Geisser, S. (1975). The predictive sample reuse method with applications. Journal of
    the Amer. Statist. Assoc., 70:320—328.

[21] Hahn, J. (1998): “On the Role of the Propensity Score in Eﬃcient Semiparametric
    Estimation of Average Treatment Eﬀects”, Econometrica, Vol. 66, No. 2, pp. 315-331.
[22] Hall, Peter and Wolﬀ, Rodney C. L. and Yao, Qiwei (1999): Methods for estimating
    a conditional distribution function. Journal of the American Statistical Association,
    94 (445). pp. 154-163.

[23] Hansen, B. (2008): “Uniform convergence rates for kernel estimation with dependent
    data,” Econometric Theory, 24, pp. 726-748.

[24] Härdle, Wolfgang; Hall, Peter; Marron, J. S. (1988): “How far are automatically cho-
    sen regression smoothing parameters from their optimum?,” Journal of the American
    Statistical Association 83, no. 401, 86—101.

[25] Hawley, William A. et al. (2003): “Community-Wide Eﬀects of Permethrin-Treated
    Bed Nets on Child Mortality and Malaria Morbidity in Western Kenya.” American
    Journal of Tropical Medicine and Hygiene. 68(Suppl. 4): 121-127.

[26] Hirano, K. and J. Porter (2009): “Asymptotics for Statistical Treatment Rules”,
    Econometrica, vol. 77(5), pages 1683-1701.

[27] Hirano, K., G. Imbens, G. Ridder (2003): “Eﬃcient Estimation of Average Treatment
    Eﬀects using the Estimated Propensity Score,” Econometrica 71, 1161-1189.

[28] Horowitz, J (1992): “A Smoothed Maximum Score Estimator for the Binary Re-
    sponse Model,” Econometrica, Vol. 60, No. 3, 505-531.

[29] Imbens, G. and G. Ridder (2009): Estimation and Inference for Generalized Full and
    Partial Means and Average Derivatives, working paper, Harvard University.

[30] Kenya Round 7 Proposal in response to the Global Fund to fight AIDS,
    Tuberculosis   and    Malaria   7th   call     for   proposals.   Available   online   at:
    http://www.theglobalfund.org/en/files/apply/call7/notapproved/7KENM_1527_0_full.pdf

[31] Lechner, M. and J. Smith (2007): What is the value added by case workers?, Labour
    Economics, 14, 135-151, 2007.

[32] Lengeler, Christian (2004): “Insecticide-treated bed nets and curtains for preventing
    malaria”. Cochrane Database Syst Rev 2004; 2:CD000363.

[33] Lucas, Adrienne (2007): “Economic Eﬀects of Malaria Eradication: Evidence from
    the Malarial Periphery”. Mimeo, Wellesley College.
[34] Mahajan, A, Tarozzi, A., Yoong J., Blackburn B. (2009): “Bednets, Information and
    Malaria in Orissa,” mimeo.

[35] Manski, C. (2004): “Statistical Treatment Rules for Heterogeneous Populations,”
    Econometrica, vol. 72, no. 4, pp. 1221-46.

[36] Manski, C. (2005): Social choice with partial knowledge of treatment response,
    Princeton University Press.

[37] Newey, W. K. (1994): "Kernel Estimation of Partial Means and a General Variance
    Estimator." Econometric Theory 10, 233-253.

[38] (NM) Newey, W. and McFadden, D. (1994): “Large sample estimation and hypoth-
    esis testing,” Handbook of Econometrics, vol IV, pp 2113-2245, Elsevier Science B.V.
    Amsterdam.

[39] Sachs, Jeﬀrey (2005): The End of Poverty: Economic Possibilities for Our Time,
    New York: Penguin Press.

[40] Stoye, J. (2009): “Minimax Regret Treatment Choice with Finite Samples,” Journal
    of Econometrics 151, 70-81, 2009.

[41] Teklehaimanot, Awash, et al (2007): “Scaling Up Malaria Control in Africa: An
    Economic and Epidemiological Assessment,” American Journal of Tropical Medicine
    and Hygiene, 77(Suppl 6), pp. 138—144.

[42] Tetenov, A. (2008): Statistical treatment choice based on asymmetric minmax regrest
    criterion, forthcoming, Journal of Econometrics.

[43] Todd, Petra and Kenneth Wolpin (2006): “Assessing the Impact of a School Subsidy
    Program in Mexico: Using Experimental Data to Validate a Dynamic Behavioral
    Model of Child Schooling and Fertility,” American Economic Review, Vol. 96, No.5,
    1384-1417.

[44] WHO (2007): WHO Global Malaria Programme: Position Statement on ITNs.
    http://www.who.int/malaria/docs/itn/ITNspospaperfinal.pdf
9     Appendix

9.1    Proofs of theorems
In the proofs below, CMT will denote continuous mapping theorem and DCT the Lebesgue
dominated convergence theorem. The discrete regressors will not play any substantive
roles in our analysis; so we will drop them in our proofs and put them back into our final
results at the end. In our proofs, the notation ̃ () and ̃ will be used to denote values
intermediate between ̂ () and  () and ̂ and , respectively;  1 and  () will
denote a finite number, a bounded positive constant and a uniformly bounded positive
function respectively, whose actual values may be diﬀerent in diﬀerent places. The latter
will be used in the expressions for upper bounds for various quantities which appear in
the proof. We first state a set of conditions under which the following results will hold.
    A0(i) (     )  = 1 2  is a random sample; A0(ii)  is randomly allocated;
    A1. Conditional on every value  assumed by the discrete regressors, X  is a -
dimensional compact subset of the support of the continuous components   ; the density
of   satisfies that  () ≥   0 for all  ∈ X  ; furthermore, 1 (·), 0 (·) and thus
 (·) and their th order derivatives are uniformly bounded on X  for some   . Also,
 | | and  (| | | = ) ×  () are bounded for some  ≥ 4.
    A2. For some   0,  () ∈ [− ] for every  ∈ X ; A3.  (·) is a th order
-dimensional bounded kernel, with    and the bandwidth sequence  satisfies (i)
            √
  → 0 (ii)   → 0; A4. The kernel ̄ (·) is uniformly bounded with a bandwidth
sequence  → 0 and  → ∞.
    A1 and A2 are standard. X  corresponds to the fixed trimming. condition A3 part
(i) is standard. condition A3 part (ii) is an “undersmoothing” requirement, which is
commonly used in semiparametric problems for bias removal; it is also a key condition for
condition B11 below (c.f. NM, lemma 8.10).
   Let ˆ () and  () denote respectively the estimated and the true density of  ()
at . Under conditions A1 and A2, we½can apply lemma    ¾ B.1 of Newey (1994) to conclude
               ¯              ¯      ³       ´12
               ¯              ¯        ln 
    B1. sup∈X ¯̂ () −  ()¯ =     
                                                  +   and apply theorem 7 of Hansen
(2008) specialized¯ to bounded ¯ (given fixed trimming), iid data and  = 0, to conclude:
                  ¯              ¯
B2. sup∈[−] ¯ˆ () −  ()¯ =  (1). Although these are consequences, rather than
primitive conditions, we refer to these as conditions B1 and B2 for easy reference in
subsequent use.
      Introduce the following additional conditions:
      B3(i) The first derivative of kernel ̄ (·), denoted by , is uniformly bounded; addi-
                                                                     0
tionally  (·) satisfies a uniform Lipschitz condition: | () −  (½ )| ≤ | − 0 | Λ for
                                                                                         ¾ some
                                                                        ³      ´12
                                                                          ln 
Λ  ∞ for all  0 ; B4.(i)  → 0, 4 →  ∈ (0 ∞] and 14           
                                                                                    +  → 0;
B5. The density of  () is strictly positive on an open set containing 
      Most standard kernels with polynomial structure and with bounded support will satisfy
B3.                                    ³               ´
                         1
                             P            −̂( )
      Let ̂̂ () ≡         =1 ̄         
                                                        .

Lemma 1 Under conditions A0-A3, A4(i), B1, B2, B3(i) and B4(i),
                                ¯               ¯
                                ¯               ¯ 
                          sup ¯̂̂ () −  ()¯ → 0.
                                              ∈[−]


      Proof. Observe that

    ̂̂ () −  ()
                Ã              !            µ             ¶       ½ µ             ¶                  ¾
    1X                             1X                         1X
                                     
                   − ̂ ( )                 −  ( )               −  ( )
  =          ̄                  −       ̄                 +       ̄               − 1 ( ( ) ≤ )
     =1                         =1                     =1        
      1X
               
    +       {1 ( ( ) ≤ ) −  ()}
       =1
               Ã             !                           ½ µ             ¶                  ¾
     1 X          − ̃ ( ) n                   o 1X
          
                                                               −  ( )
  =                             ( ) − ̂ ( ) +       ̄               − 1 ( ( ) ≤ )
     =1                                         =1        
            1X
               
        +         {1 ( ( ) ≤ ) −  ()} .
             =1

Therefore,
                     ¯                 ¯
                     ¯                 ¯
                     ¯̂̂ () −  ()¯
                   sup
            ∈[−]
                     ¯                                    ¯
                     ¯1 X                                  ¯
                     ¯                                     ¯
          ≤    sup ¯           {1 ( ( ) ≤ ) −  ()}¯
            ∈[−] ¯  =1                               ¯
                        ¯  ½ µ                    ¶                    ¾¯¯
                        ¯1 X            −  ( )
                        ¯                                                 ¯
            + sup ¯                 ̄                 − 1 ( ( ) ≤ ) ¯
               ∈[−] ¯  =1                                         ¯
                       Ã                  ¯ Ã              !¯! ½
                  1       1X               ¯     − ̃ ( ) ¯¯               ¯        ¯¾
                                           ¯                           14    ¯        ¯
            + 14                   sup ¯                    ¯ ×  sup ¯ () − ̂ ()¯
                             ∈[−] ¯
                                  =1
                                                            ¯             
By condition B3(i) (i.e.  (·) is uniformly bounded), condition B4(i) and condition B1,
the third term is  (1). The first term is  (1) by the standard Glivenko-Cantelli theo-
rem. Under the stated conditions on ̄ and that  () has a Lebesgue density uniformly
bounded above, we can apply lemma 4 of Horowitz (1992) to conclude that the sec-
ond term in the previous display is  (1). (This is analogous to Horowitz’s proof that
lim→0 Pr (|0 |  ); here we have that

                 lim Pr (| −  ()|  ) = lim [ ( + ) −  ( − )]
                 →0                        →0
                                                  ½                ¾
                                          ≤ 2 lim  × sup [ ()] = 0,
                                                  →0           ∈R

and the rest of the proof is identical to Horowitz lemma 4).
   Theorem 1 (Consistency of ̂):
   Proof. Fix   0. Then  ( + ) − 1+  0 and 1 − −  ( − )  0, by condition
(B5). Therefore, we have that

       Pr (|̂ − |  ) ≤ Pr (̂   + ) + Pr (̂   − )
                              ³                       ´    ³                         ´
                         ≤ Pr ̂̂ (̂)  ̂̂ ( + ) + Pr ̂̂ (̂)  ̂̂ ( − )
                              ³                      ´    ³                       ´
                         = Pr 1 −   ̂̂ ( + ) + Pr 1 −   ̂̂ ( − )
                              ³                                                  ´
                         ≤ Pr  ( + ) − 1 +    ( + ) − ̂̂ ( + )
                                 ³                                                  ´
                           + Pr 1 −  −  ( − )  ̂̂ ( − ) −  ( − )
                              Ã                                                    !
                                                               ¯                 ¯
                                                               ¯                 ¯
                         ≤ Pr  ( + ) − 1 +   sup ¯̂̂ () −  ()¯
                                                            ∈[−]
                                   Ã                                                            !
                                                                             ¯                 ¯
                                                                             ¯                 ¯
                             + Pr 1 −  −  ( − )                sup     ¯̂̂ () −  ()¯
                                                               ∈[−]


both of which converge to zero by lemma 1.


   Now, define                                    Ã                  !
                                       1 X
                                           
                            ˆ                          − ̂ ( )
                            ̂ () =                                   .
                                       =1             

The following lemma shows that ˆ̂ (·) converges to  (·) in probability, uniformly on the
support of  ().
Lemma 2 Under conditions A0-A4 and B3-B5,
                              ¯               ¯
                              ¯ˆ              ¯
                         sup ¯̂ () −  ()¯ =  (1) .
                              ∈[−]

   Proof. Observe that
                                                       Ã                  !
                                         1 X
                                             
                     ˆ                                      − ̂ ( )
                     ̂ () −  () =                                      −  ()
                                         =1                

By triangle inequality,
             ¯              ¯                    ¯               ¯                  ¯                ¯
             ¯ˆ             ¯                    ¯ˆ              ¯                  ¯ˆ         ˆ     ¯
       sup ¯̂ () −  ()¯ ≤        sup       ¯ () −  ()¯ +          sup   ¯̂ () −  ()¯ .
    ∈[−]                         ∈[−]                          ∈[−]

The first term is  (1) due to B2. As for the second term, notice that
                                ¯          ( Ã                  !    µ              ¶)¯¯
          ¯                 ¯   ¯ 1 X   
                                                  −  ̂ (   )          −  (  )
          ¯ˆ                ¯   ¯                                                    ¯
          ¯̂ () − ˆ ()¯ = ¯                                −                   ¯
                                ¯                                               ¯
                                       =1
                                      ¯               ¯
                                      ¯               ¯
                                sup ¯̂ () −  ()¯
                              ≤                         Λ, by B3,
                                           
                                    Ã        (µ       ¶12         )!
                                       1        ln 
                              =         ×                 +      ,
                                               

by conclusion B2 and assumption B3. Therefore by condition B4, we get the conclusion.


   Additional conditions:
   A4 (ii) The kernel ̄ (·) has two derivatives which are also uniformly bounded. For
some  ≥ 2, we have B7. the density of  () is ( − 1) times continuously diﬀerentiable,
                            (−1)
the ( − 1)th derivative          (·) is bounded and Lipschitz in a neighborhood of ; B8.
2+1 →   ∞; B9.  (·) is symmetric around zero and has bounded support [−1 1],
                 R1
is of order  and −1 2 ()   ∞. Also assume that B10.  2 () =  ( | = ) for
 = 1 2 are finite; B11. For  = 0 1,
                  √      °©                ª                    °
                    sup ° ̂ () −  () {̂  () −   ()}° =  (1) ,
                     ∈X
                                   √
                                     sup k{̂  () −   ()}k2 =  (1) .
                                             

   Condition B11 is basically the same as B4 with  and  replacing  and hold under
                                                                       √
exactly the same conditions as B4. These are well-known requirement for  -normality
for semiparametric estimators (c.f. Newey and McFadden (1994), section 8.3).
   Theorem 1 (Distribution of ̂):
   To derive the distribution theory for ̂, we will use the following first-order approxi-
mation
                       () = 1 −  = ̂̂ (̂) = ̂̂ () + (̂ − )ˆ̂ (̃)
where ̃ is between ̂ and . This gives us the following first-order expansion for ̂:

               (̂ − )
                            (                    µ               ¶)
               n        o−1            1  X
                                          
                                                    −   (   )
                                                             
             = ˆ̂ (̃)       () −        ̄
                                        =1            
                            |                {z                    }
                                             1
                              "  Ã µ                     ¶       Ã              !!#
                  n       o−1 1 X            −   (   )            − ̂ (  )
                                                                            
               + ˆ̂ (̃)             ̄                   − ̄                    .           (11)
                                 =1                                 
                              |                         {z                         }
                                                           2
                                                                    n         o−1
The proof will proceed in three steps: step 1 is that the multiplier ˆ̂ (̃)     converges
                                                                      ³         ´
in probability to { ()}−1 . Step 2 is that the term 1 will be  √  1
                                                                              
                                                                                 . Finally in
step³ 3 we´ will show, using U-statistic type decompositions, that the term 2 will be
       1
                                                             √
 √   
           .  These  will eventually lead to the result that   (̂ − ) converges to a
normal distribution, as required.
   Proof. Step 1. We first show that
                                                          
                                     ˆ̂ (̃) −  () → 0                                     (12)
    ¯                 ¯   ¯                    ¯
    ¯ˆ                ¯   ¯ˆ                   ¯
    ¯ ̂
        (̃) −  ()¯ ≤ ¯ ̂
                              (̃) −    (̃)¯ + | (̃) −  ()|
                                     ¯                   ¯
                                     ¯ˆ                  ¯
                        ≤    sup ¯̂ () −  ()¯ + | (̃) −  ()|              =  (1) .
                          ∈[−]                              |     {z        }
                          |               {z            }  (1) by CMT and theorem 1
                                    (1), by lemma 2

Step 2: We will show that
                    p     ½             µ              ¶¾
                                            −  ( )
                        () − ̄                       =  +  (1) .                 (13)
                                               
   Observe that
             ½              µ             ¶¾
         1X                     −  ( )
   ≡            () − ̄
          =1                      
                                                   ½                       µ             ¶¾
         1X                                   1X
            
                                                                               −  ( )
      =         { () − 1 ( ( ) ≤ )} +           1 ( ( ) ≤ ) − ̄
          =1                                 =1                               
      ≡ 2 − 1 .                                                                             (14)
Now,
                                 1 X
               p         p           
                 2 =  × √        { () − 1 ( ( ) ≤ )} =  (1) .
                                   =1
                               |                {z               }
                                                  (1)

We will show that
            ³p            ´2        ¡√   ¢ n ³p           ´o2
               1 −  =    1 +    1 −     →0                      (15)

and thus
                                  p
                                    1 −  =  (1) .                             (16)

   Now,
          ¡√      ¢
        1
        ½                    µ             ¶¾2 ½          ½ µ             ¶¾¾2
                                −  ( )                     −  ( )
    =  1 ( ( ) ≤ ) − ̄                  −  () −  ̄                (17)
                                                                

Observe that
                µ                    µ             ¶¶2
                                        −  ( )
               1 ( ( ) ≤ ) − ̄
                                           
              Z  ½ µ        ¶     ¾2              Z ½ µ     ¶¾2
                       −                                −
            =      ̄          − 1  ()  +         ̄          () 
               −                                       

and both of the terms in the previous display converge to zero by the DCT since lim→∞ ̄ () =
1 = 1 − lim→−∞ ̄ ().
   Next,
                ½ µ              ¶¾
                      −  ( )
     () −  ̄
                          
    Z  ∙                µ     ¶¸              Z  µ     ¶
                           −                       −
  =       1 ( ≤ ) − ̄            ()  −    ̄        ()  → 0, by the DCT.
     −                                            

Thus, from (17), we have that
                                      ¡√    ¢
                                     1 → 0 as  → ∞.                            (18)
   Next, consider
                 ½                    µ             ¶¾
                                         −  ( )
     (1 ) =  1 ( ( ) ≤ ) − ̄
                                             
               ½         Z  µ          ¶          ¾
                                  −
             =   () −       ̄          () 
                           −      
               ½            µ     ¶                   Z           µ     ¶ ¾
                              −                  1                −
             =   () − ̄           () |− −          ()         
                                                   −             
               (         Z +                         )
                                     
                =      () −             ( −  )  () 
                                 −
                                  
                                                     Z   1
                        +1         (−1)
                = (−1)           ×          () ×             ()  +  ( ) , by condition B7.
                            !                        −1

This implies that
           ³p        ´           √ +12                  Z 1
                              +1          (−1)
             1   = (−1)             ×       () ×       ()  +  ( )
                                     !                    −1
                       → , by condition B7, B8.                                                          (19)

Now, (18) and (19) imply (15) and thus (16).
   Step 3: We will now analyze the second term in (11):
                            " µ              ¶      Ã              !#
                      1X
                         
                                  −  ( )           − ̂ ( )
                 =         ̄                − ̄                   ,
                       =1                             

using U-statistic type decompositions to show that
                     √
                        X
     p                     
         = √             {[1 ( ) −  {1 ( )}] − [2 ( ) −  {2 ( )}]}
                        =1
                                 ¡      ¢
                    + (1) →  0  2 ,                                                  (20)

where the triangular arrays 1 ( ), 2 ( ) and the constant  2  0 will be specified
below.
   To that end observe that
                         √ X   
                                   " µ                ¶      Ã               !#
           p                             −  ( )           − ̂ ( )
               = √             ̄                  − ̄
                             =1                                 
                          √                                  µ              ¶
                             X n                      o
                                 
                                                                −  ( )
                     = √              ̂ ( ) −  ( ) 
                            =1                                 
                            √                                     Ã              !
                               X n                        o2
                                    
                                                                0   ̃ ( ) − 
                         + √ 2            ̂ ( ) −  ( )                      .
                           2  =1                                     
The second term in absolute value has an expectation which is of the order of
                        ¯              ¯2 √
                        ¯              ¯
                    sup ¯ () − ̂ ()¯ 32 → 0, by condition B4.
                    ∈X                   
Next, note that
                                    ½                         ¾       ½                         ¾
                                        ̂1 ( ) 1 ( )                ̂0 ( ) 0 ( )
             ̂ ( ) −  ( ) =                 −               −                 −               (21)
                                        ̂ 1 ( ) 1 ( )               ̂ 0 ( ) 0 ( )

We will simply work with the first term because the proof is exactly analogous for the
second term and show that

                    1 Xn
                                            o µ  −  ( ) ¶
                                                         
                  √        ̂ ( ) −  ( )                =  (1) .
                    =1                           

   Step 3A: Now,
                  ½                       ¾         µ              ¶
             1 X ̂1 ( ) 1 ( ) 1                    ( ) − 
            √                  −                   
               =1 ̂ 1 ( )  1 ( )                  
                    ½                      ¾        µ              ¶
             1 X ̂1 ( ) − 1 ( ) 1
                 
                                                        ( ) − 
          = √                                     
               =1         ( )                       
                    ½                                ¾        µ             ¶
               1 X  ( ) ̂1 ( ) −  1 ( ) 1                ( ) − 
            −√                                              
                 =1  ( )         1 ( )                     
                                                                          µ             ¶
               1 X {̂1 ( ) − ( )} {̂ 1 ( ) −  1 ( )} 1
                   
                                                                             ( ) − 
            −√                                                          
                 =1               1 ( ) ̂ 1 ( )                       
                                                             µ             ¶
               1 X ( ) {̂ 1 ( ) −  1 ( )}2 1
                   
                                                                ( ) − 
            +√                2
                                                                             .                     (22)
                 =1       1 ( ) ̂ 1 ( )                   

The last two terms in absolute value have expectations that are bounded above by a posi-
                 √                                                    √
tive scalar times  sup k{̂1 () − 1 ()} {̂ 1 () −  1 ()}k and  sup k{̂ 1 () − ()}k2 .
Condition B11 above then implies that these are both  (1).
   Now, the first two terms in (22) add up to
                                                         µ                 ¶
    1 X  1 ( ) ̂1 ( ) − 1 ( ) ̂ 1 ( ) 1
         
                                                            ( ) − 
   √                                                   
      =1                 21 ( )                            
                          ⎡                                                     ³        ´ ⎤
                                  1                                        1       −
   √       1     X X
                                     { 1 ( )  
                                                     −    (    )  }   
                                                         ³1
                                2                                                  
 =                       ⎣ 1 ( )                                  ´                  ⎦
        ( − 1) =1 6=                            1     (  )−
                                                  ×        
                          |                               {z                               }
                                                               = (  ), say

        1               X
                         X
 = √                                 [ (   ) −  ( (   ) | ) −  ( (   ) | ) +  ( (   ))]
      ( − 1)          =1 6=
   |                                                               {z                                                   }
                                                                   1

        1 X                                                    1 X
                                                                                   
     +√        [ ( (   ) | ) −  ( (   ))] + √        ( (   ) | ).                        (23)
          =1                                                   =1
      |                        {z                         } |            {z               }
                                         2                                               3


Step 3B: We first show that
                                                    3 =  (1) .                                          (24)

Notice that
        ⎡         ³              ´                                                                    ⎤
           1
                     ( )−                                                      µ             ¶
                                                                        1            − 
     ⎣                              × { 1 ( )   − 1 ( )  }               | ⎦
               21( )                                                                
              ⎡       ³           ´                                                                      ⎤
                 1
                        ( )−       ½                                        ¾       µ         ¶
                                          ( )               1 ( ) 1         − 
     = ⎣              2
                                     ×  1 ( ) 1          − 1 ( )                             | ⎦
                      1 ( )                      ( )                ( )            
         ³           ´
    1
           ( )−       Z                                              µ         ¶
                             1 ( ) 1 () − 1 ( )  1 () 1         − 
 =                       ×                                                            () 
         21 ( )                              ()                        
         ³           ´
    1
           ( )−       Z
             
 =                       × [ 1 ( ) 1 ( +  ) − 1 ( )  1 ( +  )]  () 
         21 ( )
                           µ                ¶
   1                1         ( ) − 
   =  ( ) ×                               ×  ( ) ,
                                  

for some uniformly bounded function  by condition. Therefore,
                                           µ             ¶
                        1 X
                            
                                       1     ( ) −        ¡√   ¢
      3 =  (  ) × √        ( ) ×                  =   =  (1) ,
                          =1                 

by condition B4.
      Step 3C: The term

           1      XX      
1   =√                   [ (   ) −  ( (   ) | ) −  ( (   ) | ) +  ( (   ))]
         ( − 1) =1 6=

can be analyzed using essentially the steps of Powell, Stoker and Stock (1989), lemma 3.1,
whence one can conclude that
                                                  ¡ 2¢
                                                  1 =  (1)                                                    (25)

The key step is to show that
                                              ¡              ¢
                                              2 (   ) =  () .

Observe that
                ¡               ¢
        −1  2 (   )
                (                                                                    µ             ¶ ∙         µ              ¶¸2 )
                        1                                                2  1             −           1       (  ) − 
 =      −1                  { 1 ( )   − 1 ( )  } 2  2                                 ×      
                    41 ( )                                                                                  
                ⎧                                                ³         ´ h         ³           ´i2                     ⎫
                ⎨                                1       1
                                                              2  −
                                                                             ×  1     ( )−                          ⎬
         −1                                  41 ( ) 2                                
 =                                                     
                ⎩ × { 2 ( )  ( 2 | ) + 2 ( ) (| ) − 2 ( )  ( )  ( | )} ⎭
                          1                                  1                        1        1               
                       ⎧                                       h ³           ´i2              ⎫
                       ⎪
                       ⎪                  1
                                                 2 () ×  ()−                            ⎪
                                                                                              ⎪
                       ⎪
                       ⎪      ⎧       41 ()                                           ⎫   ⎪
                                                                                              ⎪
                  Z ⎪  ⎨                                                                      ⎪
                                                                                              ⎬
          1                   ⎪
                              ⎪          2
                                            ()        (  2
                                                              |  =     +     )       ⎪
                                                                                          ⎪
 =                            ⎨           1                                              ⎬        ()  ( +   ) 
          2 ⎪    ⎪  ×              +    2
                                                  ()     (|    =    +     )            ⎪
                                                                                              ⎪
                       ⎪
                       ⎪      ⎪                1                               
                                                                                          ⎪ ⎪ ⎪
                       ⎪
                       ⎩ ⎪    ⎩ −2 ()  ()  ( | =  +  ) ⎪                       ⎭ ⎪ ⎭
                                      1            1                                  
          µ             ¶
                 1
 =                       → 0 which is implied by B4.
              2

      Step 3D: Now consider the term

                                 1 X
                                         
                         2   =√       [ ( (   ) | ) −  ( (   ))]
                                   =1
Observe that

       ( (   ) | )
         ½∙                                                    µ             ¶ ∙          µ              ¶¸¸                ¾
                   1                                      1      − +             1        ( ) − 
  =                     { 1 ( )   − 1 ( )  }                     ×                            |    
              21 ( )                                                                    
      Z ∙                                                 µ           ¶ ∙          µ            ¶¸¸
                 1                                   1      − +           1        () − 
  =                   {1 ()   − 1 ()  }                     ×                             () 
              21 ()                                                              
      Z   ∙                                                          ∙      µ                       ¶¸¸
              1 ( +   )   − 1 ( +  )                 1        ( +   ) − 
  =                            2
                                                             () ×                                      ( +   ) 
                              1 ( +  )                                          
      ∙                                                        ∙      µ              ¶¸¸ Z
             1                                                   1       ( ) − 
  =                 { 1 ( )   − 1 ( )  }  ( ) ×                                ()  +  ( )
         21 ( )                                                         
      ⎡                                                                                     ⎤
      ⎢∙ 1                                                    ¸ ∙
                                                                    1
                                                                         µ
                                                                             ( ) −  ⎥
                                                                                         ¶¸
      ⎢                                                                                     ⎥
  =   ⎢ 2             { 1 ( )   − 1 ( )  }  ( ) ×                           ⎥ +  (  ) .
      ⎣  1 ( )                                                                         ⎦
        |                            {z                       } |            {z          }
                                 ( )                                    (( ))

Notice that
                                          ⎧                             ⎫
                                          ⎨                             ⎬
               { ( )  ( ( ))} =   ( ( ))  ( ( ) | ) = 0.
                                          ⎩             |    {z       }⎭
                                                                        =0

Now
                                   (                                                       )
                                        1 X
                                            
             (2 ) =            √       [ ( (   ) | ) −  ( (   ))]
                                          =1
                         =   { ( (   ) | )}
                                                                     ¡ ¢
                         =  ( ( ) 1 ( ( )) +  (  ))2 −   2
                                                                        
                             © 2         2
                                                    ª       ¡ 2 ¢
                         =   ( ) 1 ( ( )) +   
                             ¡ ©                        ª¢
                         =    2 ( ) 1 2
                                               ( ( )) .

Now, let  2 () =  { 2 ( ) | ( ) = }. Then
                       ©                          ª
                      2 ( ) 1   2
                                         ( ( ))
                    Z           ∙        µ       ¶¸2
                           2        1       −
                 =         ()                       () 
                      −                   
                        Z  −
                     1      
                 =               2 ( +  ) 2 ()  ( +  ) 
                      −−
                           
                                        Z −
                     1 2                    
                 =       ()  ()           2 ()  + terms of smaller order
                                        −−
                                            
This implies that
                             Ãr                                                     !
           ³p       ´             X
                                      
           2   =              [ ( (   ) | ) −  ( (   ))]
                                   =1
                                     Z ∞
                         2
                      →  ()  ()     2 () .                                     (26)
                                            −∞

Now we will apply the Liapunov condition and use the Lindeberg CLT for triangular
arrays. Consider the array
                          √
                            
                    = √ [ ( (   ) | ) −  ( (   ))] 
                            
                                                         P
which is independent across  and  ( ) = 0. Let  = =1  . Then

      ¡ 2¢  X
            
               ¡ 2 ¢
       =    
                    =1

                 X
                   
              =        ( ( (   ) | ) −  ( (   )))2
                 =1
                 X
                    
              =          ( ( ) 1 ( ( ))) +  (1)
                 =1
                                Z ∞                                 Z ∞
                 2                  2                     2
              =     ()  ()      ()  +  (1) →  ()  ()     2 () ,
                               −∞                                  −∞

by (26). To apply the Liapunov condition, observe that for any   0,

                X
                                       µ  ¶ 2+
                             2+          2
                       | |     =             | ( ) 1 ( ( ))|2+
                =1
                                         
                                       Ã µ ¶ 2+          !
                                             2 1
                                   =  
                                                    1+
                                                      
                                       ³          ´
                                   =  ( )−2 → 0.

Thus the Liapunov condition holds and applying the Lindeberg CLT, we get that
     √ X                                                    µ                Z ∞         ¶
                                                               2                2
 = √       [ ( (   ) | ) −  ( (   ))] →  0  ()  ()      ()  .
        =1                                                                   −∞
                                                                                        (27)
   Putting together (24), (25), (26) and (27), we get that
              r       ½                     ¾∙       µ             ¶¸
                  X ̂1 ( ) 1 ( )         1       ( ) − 
                                   −               
                   =1 ̂ 1 ( ) 1 ( )               
               √ X                            µ                 Z ∞         ¶
                                                 2                  2
           = √          1 ( ) +  (1) →  0  ()  ()        ()  ,
                  =1                                            −∞


where
                              ∙                                       ¸      µ             ¶
                              ( )                                    1       ( ) − 
              1 ( ) = 2           { 1 ( )   − 1 ( )  }                      ,
                             1 ( )                                            
                (½                                     ¾2            )
                      1 ()      − 1 () 
     2 () =                                   () | () =  .                            (28)
                               21 ()

   Similarly, we will get that
               r        ½                    ¾     µ             ¶
                   X ̂0 ( ) 0 ( ) 1            ( ) − 
                                    −             
                   =1 ̂0 ( )  0 ( )             
               √ X                             µ               Z ∞          ¶
                                                 2                 2
            = √          2 ( ) +  (1) →  0  ()  ()       ()  ,
                   =1                                           −∞


where
                        ∙                                                     ¸      µ             ¶
                          ( )                                                1       ( ) − 
          2 ( ) = 2           { 0 ( )  (1 −  ) −  ( ) (1 −  )}                      ,
                         0 ( )                                                        
            (½                                                 ¾2            )
                  0 ()   (1 −  )   −  ()  (1 − )
 2 () =                                                () | () =  .                      (29)
                                  20 ()

   Thus we get that
                        √ X 
              p                                                 ¡      ¢
                 = √      {1 ( ) − 2 ( )} +  (1) →  0  2 ,
                          =1

which establishes (20).
   To get the expression for  2 , note by direct multiplication that since  (1 −  ) = 0
for every ,  {1 ( ) 2 ( )} = 0. Moreover,  (1 ( )) = 0. Therefore,  (1 ( )  2 ( )) =
0. This implies that
                                                          Z
                           ©                 ª                ∞
                         =  2 () +  2 () ×  ()
                          2
                                                                  2 () .                 (30)
                                                           −∞
Using the definitions of 1 (·)   0 (·)   (·) and  1 (·), the above expressions simply to
                                        ½                                   ¾
                       2                             20 ()
                       () =                                   | () = 
                                           1 − Pr ( = 1|)
                                        ½                               ¾
                       2                         21 ()
                       () =                               | () =  .
                                           Pr ( = 1|)

   Now put together (12), (13), (20) and (30) to conclude from (11) that
                                          √
                                              X
           p                                      
                                     1
             (̂ − ) =  +             √         {1 ( ) − 2 ( )} +  (1)
                                    ()  =1
                                    µ                     Z              ¶
                                         2 () +  2 () ∞ 2
                                →                             ()  .
                                                ()      −∞




Lemma 3 Under conditions A0-A4 and B1-B11,

              1 Xh                         i   1 X
                                                  
                                                         1 −  1 ( )
             √       ̂ 1 ( ) −  1 ( ) = √                        +  (1) .
                =1                             =1    Pr ( = 1| )

   Proof. Note that

              1 Xh                         i
                  
             √       ̂ 1 ( ) −  1 ( )
                =1
                   ½                       ¾        ½                          ¾
              1 X ̂1 ( ) − 1 ( )          1 X 1 ( ) ̂ 1 ( ) − ( )
           = √                                −√
                =1         1 ( )             =1  1 ( )   1 ( )
                 1 X {̂1 ( ) − 1 ( )} {̂ 1 ( ) − ( )}
                       
               +√
                   =1            1 ( ) ̂ 1 ( )
                 1 X ̂1 ( ) {̂1 ( ) − ( )}2
                       
               −√                                    .                                       (31)
                   =1       21 ( ) ̂1 ( )

The last two terms are both  (1) under condition B11 above.
   Now, the first two terms in (31) add up to
       1 X
              
      √       { 1 ( ) ̂1 ( ) − 1 ( ) ̂ 1 ( )}
         =1
                    X X 1 ( )   −  ( )  1
                                                                        µ             ¶
    √         1                            1                                  − 
  =                                                    
           ( − 1) =1 6=        2
                                    ( )                                  
   √          1     XX       
 ≡                           (     )
           ( − 1) =1 6=
         1      XX       
  = √                    [ (     ) −  ( (     ) | ) −  ( (     ) | ) +  ( (    
       ( − 1) =1 6=
    |                                                         {z
                                                                  1

         1 X
             
      +√        [ ( (      ) | ) −  ( (      ))]
           =1
       |                            {z                               }
                                        2

         1     X
               
      +√              ( (     ) | ).
              =1
       |                     {z               }
                             3

   We will show that

           (1 )2 =  (1) ,                                                                      (32)
                        1 X
                             
              2 = √          { (| ) ×   −  ( | ) ×  } +  (1) ,                  (33)
                          =1
                  3 =  (1) .                                                                   (34)

   Observe that
            ∙                                         µ          ¶ ¸
              1 ( )   − 1 ( )  1             − 
                                                                   |
                           21 ( )                    
                   ∙            ½                                        ¾       µ         ¶ ¸
                   1                 1 ( )              1 ( ) 1         − 
          =  2                   1 ( )           − 1 ( )                            |
                      1 ( )              ( )               ( )           
                   Z                                                µ         ¶
             1                                                1         − 
    =                  [ 1 ( ) 1 () − 1 ( )  1 ()]                  
         21 ( )                                                     
                   Z
             1
    =                  [ 1 ( ) 1 ( +   ) − 1 ( ) 1 ( +   )]  () 
         21 ( )
          1
          =  ( ) ×  (  ) ,
                                                                            √
for some uniformly bounded function  by condition A1. Therefore, 3 =  (   ) =
 (1) by condition A3 and this establishes (34).
  Next observe that
      ∙                                                     µ           ¶ ¸
             1                                         1       − 
     2            { 1 ( )   − 1 ( )  }                     |
         1 ( )                                              
    Z                                                  µ         ¶
           1                                    1         − 
 =               { 1 ()   − 1 ()  }                     () 
        2 ()                                           
    Z 1
                 1
 =       2
                           { 1 (( +   ))   − 1 (( +   ))  }  ()  (( +  )) 
        1 ( +   )
                                               Z
                                                           1
 = { 1 ( )   − 1 ( )  }  ( )          2
                                                                     () 
                                                    1 ( +   )
                                                      Z
              0                  0                              1
    + { 1 ( )   − 1 ( )  }  ( )           2
                                                                          () 
                                                          1 ( +  )
                  n                                   o        Z
                     ()               ()                                1
    + +   1 ( )   − 1 ( )   ( )                 2
                                                                                     ()  
                                                                    1 ( +   )
                                        ( )
 = { 1 ( )   − 1 ( )  } 2            +  ( )
                                        1 ( )
            1                                                                
 =                  2 { (| ) ×   −  ( | ) ×  } +  (  ) ,
    { (| )}
by a dominated convergence theorem, given the uniform boundedness of  1 (·). Together
with condition A3, we get (33).
   One can establish (32) by essentially repeating the proof of Powell, Stoker and Stock
(1989) lemma 3.1.
   Combining (32), (33) and (34), we get that
                      ½                     ¾
                 1 X ̂1 ( ) 1 ( )
                √                 −
                   =1 ̂ 1 ( )  1 ( )
                  1 X
                         
                                                                     1
               = √       { 1 ( )   − 1 ( )  }  ( ) 2        +  (1)
                    =1                                          1 ( )
                  1 X
                         
                            1 −  1 ( )
               = √                        +  (1) .
                    =1    Pr ( = 1| )


   Theorem 2 (consistency of ̂)
   Proof. Define
                                                                         Ã                   !
                                                   1X
                                                       
                                                                             ̂ − ̂ ( )
           =  { ( ) × 1 ( ≥  ( ))} , ̂ =       ̂ ( ) × ̄                           ,
                                                    =1                          
so that
                             1X
                                
                        ̂ =      ̂ ( ) − ̂,  =  { 1 ()} − .
                              =1 1
Now,
                                         Ã                   !
                  1X
                           
                                             ̂ − ̂ ( )
         ̂ −  =       ̂ ( ) ̄                              −
                   =1                           
                                         Ã                   !                       µ             ¶
                    1X                                              1X
                                                                      
                                             ̂ − ̂ ( )                              −  ( )
                  =       ̂ ( ) ̄                            −         ( ) ̄
                     =1                                          =1                  
                    |                                            {z                                }
                                                              1
                                      ∙ µ             ¶                  ¸
                         1X
                            
                                           −  ( )
                       +        ( ) ̄               − 1 { ( ) ≤ }
                          =1                
                        |                      {z                         }
                                                        2

                         1X
                            
                       +       { ( ) 1 { ( ) ≤ } − }.
                          =1
                        |                 {z               }
                                 = (1), by standard WLLN.

Now,
            ¯  (                 Ã                  !                   µ             ¶)¯¯
            ¯1 X                      ̂ − ̂ ( )                         −  ( )
            ¯                                                                                ¯
   |1 | = ¯         ̂ ( ) ̄                         −  ( ) ̄                       ¯
            ¯                                                                           ¯
                =1
                   ¯                      ¯ ¯      Ã                 !                Ã               !¯
            1 X ¯¯ ̂ ( ) −  ( ) ¯¯ ¯¯                                             ̃ − ̃ ( ) ¯¯
                
                                                       ̃ − ̃ ( )
          ≤        ¯                      ¯ ¯ ̄                       − ̃ ( )                    ¯
             =1 ¯                     ¯¯                                                        ¯
                                    ¯            Ã                 !¯
              (̂ − ) 1 X ¯¯                        ̃ − ̃ ( ) ¯¯
                                
            +           ×           ¯̃ ( )                         ¯
                          =1 ¯                                   ¯
                 ¯                ¯           ¯      Ã                 !               Ã               !¯
                 ¯                ¯       ¯
            sup ¯̂ () −  ()¯ 1 X          ¯          ̃ − ̃ ( )                    ̃ − ̃ ( ) ¯¯
          ≤                                   ¯ ̄                      − ̃ ( )                     ¯
                                   =1 ¯                                                           ¯
              Ã                   !12                ¯           Ã                !¯
                                              1 X ¯¯                 ̃ − ̃ ( ) ¯¯
                                                 
                  (̂ − )2
            +                            ×            ¯̃ ( )                     ¯.
                      3                           ¯                            ¯
                                                  =1

Since  ̄ are uniformly bounded, the above display is of the form
                       ¯              ¯            Ã               !12
                       ¯              ¯
                sup∈X ¯̂ () −  ()¯               (̂ − )2
             ≤                          ×  (1) +                      ×  (1) .
                                                       3

Now, theorem 2 implies that  (̂ − )2 =  (1), conclusion B1 and condition B4 (i)
           sup|̂()−()|
imply that        
                           =  (1) and that 3 → ∞. Thus we have that 1 =  (1).
   As for 2 , observe that since  (·) is uniformly bounded, by using steps exactly anal-
ogous to step 2 in the proof of theorem 2 (leading to (13)), we will get by the DCT that
2 =  (1).
   Now combine with lemma 3 to conclude that |̂ − | =  (1). The proof of | − | =
 (1) is just a simpler version of (45) which is proved below.
   Additional conditions:
   The following ½
                 additional conditions
                                     ¾2 will be used to prove theorem 2.
            √     ³       ´12
   B4 (ii) 2 ×    ln 
                     
                               +   → 0; B12. 6 → ∞,  of condition B7 is at least
                    

4 and   2
              → 0.
   Theorem 2 (distribution of ̂):
   Proof. We will work with the following expansion

    ̂ − 
                      µ             ¶
     1X
        
                         −  ( )
  =         ( ) ̄                 −
     =1                   
    |                 {z               }
                             1

          1
               n
              X                           o ½ µ  −  ( ) ¶  1
                                                                         µ
                                                                            −  ( )
                                                                                       ¶¾
                                                        
        +               ̂ ( ) −  ( )   ̄              −  ( ) 
             =1
                                                                           
         |                                           {z                                 }
                                                     2
                            X
                                       µ             ¶
                   1                      −  ( )
        +(̂ − )            ( ) 
                    =1
                                              
         |                     {z                      }
                              3
                                             (          Ã               !                Ã                !)
            1 Xn                        o2
                 
                                                          ̃ − ̃ ( )                    ̃ −  ̃ ( )
        −            ̂ ( ) −  ( )       −2                        + ̃ ( ) 0
          42 =1                                                                           
         |                                               {z                                                 }
                                                         4
                                             Ã                !
                        1    X
                                               ̃ − ̃ (  )
        +(̂ − )2 ×               ( ) 0
                     42 =1                      
         |                        {z                          }
                                  5
                                                    "       Ã                !               Ã               !#
                    1 Xn                          o
                          
                                                               ̃ − ̃ ( )               0   ̃ − ̃ ( )
        +(̂ − )              ̂ ( ) −  ( )                           − ̃ ( )                   (35).
                  22 =1                                                                        
         |                                                 {z                                                  }
                                                            6
                                                                                                       ³         ´
   Step 4: Under conclusion B1 and condition B4, the fourth term in (35) will be                         √1
                                                                                                             
since 0 (·) is assumed to be uniformly bounded in absolute
                                                   ³ ´ value.³ As ´ for the fifth term,
                                         (̂−)2      1         1
observe by the previous theorem, that 2 =  3 =  √ by condition B12.
                                     ³ ´               
                                                                   ³ ´
So the fifth term in (35) will be  √ . That the sixth term is  √1 follows from
                                       1

combining the two previous results.
   Step 5: The multiplier for the third term in (35) equals
                            µ             ¶    µ           µ             ¶¶
           1 X
               
                               ( ) −               1      −  ( )
                   ( )                  →   ( ) ̄
           =1                                            
                                                          =  () +  ( ) →  () ,

which follows from the standard consistency proof for e.g. kernel density estimates.
   Combining steps 4 and 5, and replacing the asymptotic expansion of (̂ − ) from
theorem 1, we get from (35) that
     √ n        o
        ̂ − 
           ½             µ             ¶    ¾
      1 X                                           X
                                                         
                             −  ( )
  = √           ( ) ̄                 − − √            {1 ( ( ) ≤ ) −  ()}
        =1                                        =1
        1 Xn
                                   o ½ µ  −  ( ) ¶                     1
                                                                               µ
                                                                                  −  ( )
                                                                                             ¶¾
                                                    
     +√          ̂ ( ) −  ( )    ̄                + { −  ( )} 
          =1                                                                   
                                             Ã              !
           1 Xn                          o2
                  
                                               ̃ ( ) − 
     + √ 2            ̂ ( ) −  ( ) 0                   +  (1) .                    (36)
        2  =1                                   

The third term in (36) in absolute value is dominated by
               (µ          ¶12              )2    √
                   ln                             
           ×                      +            × 2 ×  (1) =  (1) , by condition B4(iii).
         2                                     

   Step 6A: Consider the first term in (36)
                        ∙           µ             ¶                            ¸
                   1 X                  −  ( )
               = √         ( ) ̄                 −  ( ) × 1 { ( )  }
                     =1                  
                 |                             {z                                }
                                                               4

                       1    X
                            
                    +√             [ ( ) × 1 { ( )  } − ]                                (37)
                            =1
                     |                              {z                }
                                        5 = (1), by CLT.


We will show that 4 =  (1) using the arguments similar to the ones used for showing
(16).
                                           R
   Define  () =  () and  () = −  () . Then
                     ½           µ             ¶          ¾
               √                    −  ( )
   (4 ) =       ( ) ̄                   −  ()
                                        
                   ½Z  µ            ¶                   ¾
               √                −
           =              ̄           ()  −  ()
                      −         
                   ∙½ µ          ¶        ¾        Z        µ     ¶                   ¸
               √           −                          1     −
           =      ̄                () |− +                     ()  −  ()
                                                  −        
                   "Z +                                    #
               √                                                 ¡√    ¢
           =                 ()  ( −  )  −  () =   → 0, by B12.      (38)
                       −
                        
                                                   R
   Next, define  () = 2  () and  () = −  () . Then
                      ½            µ              ¶                            ¾2
                                      −  ( )
                     ( ) ̄                     −  ( ) × 1 { ( )  }
                                         
                   Z ½ µ              ¶              ¾2
                                 −
               =           ̄            − 1 {  }  () 
                     −           
                   Z       µ        ¶              Z 
                          2     −
               =        ̄               ()  +      1 {  }  () 
                     −                            −
                       Z  µ            ¶
                                  −
                   −2         ̄           × 1 {  } ×  () 
                        −          
Using the DCT repeatedly (c.f. the steps leading to (14)), we get that
                   ½           µ             ¶                            ¾2
                                  −  ( )
                   ( ) ̄                  −  ( ) × 1 { ( )  }
                                     
                 Z       µ      ¶             Z 
                        2   −
             =        ̄            ()  +      1 {  }  () 
                  −                          −
                    Z  µ           ¶
                              −
                 −2       ̄          × 1 {  } ×  () 
                     −         
             →  () +  () − 2 () = 0.

This implies that for 4 defined in (37),
                       Ã        ∙            µ             ¶                            ¸!
                          1 X                    −  ( )
    (4 ) =   √              ( ) ̄                 −  ( ) × 1 { ( )  }
                            =1                    
                       µ             µ             ¶                             ¶
                                        −  ( )
              =    ( ) × ̄                     −  ( ) × 1 { ( )  }
                                            
                     ½          µ              ¶                             ¾2
                                   −  ( )
              ≤   ( ) ̄                     −  ( ) × 1 { ( )  }
                                      
              → 0.                                                                        (39)
From (38) and (39), we get that  (4 )2 → 0 and thus 4 =  (1).
   Replacing in (36), we get that
     √ n       o
       ̂ − 
    1 X                                         X
                                                  
 = √        [ ( ) × 1 { ( )  } − ] − √       {1 ( ( ) ≤ ) −  ()}
      =1                                       =1
      1 Xn
                                 o ½ µ  −  ( ) ¶                   1
                                                                          µ
                                                                              −  ( )
                                                                                         ¶¾
                                                 
   +√           ̂ ( ) −  ( )   ̄               + { −  ( )} 
        =1                                                                 
       µ      ¶
           1
   + √         .                                                                       (40)
            

The final step is to analyze the third term in (40), using U-statistic type decompositions.
First notice that analogous to (23) above, we have here that up to  (1) terms:

     1 Xn
                               o ½ µ  −  ( ) ¶                            1
                                                                                  µ
                                                                                       −  ( )
                                                                                                  ¶¾
                                                     
    √         ̂ ( ) −  ( )      ̄                 + { −  ( )} 
       =1                                                                           
                           ⎡                                                  ³        ´ ⎤
                                 1                                               −
    √       1     X X
                              2 ( )
                                       { ( )   − 1 ( )  } 1   
  =                       ⎣      h    ³          ´                        ³          ´i ⎦
         ( − 1) =1 6=               −( )                   1        −( )
                              × ̄              
                                                    + { −  ( )}             

      √        1       X
                        X
 ≡                              (   )
            ( − 1)=1 6=

         1         XX
                   
  = √                          [ (   ) −  ( (   ) | ) −  ( (   ) | ) +  ( (   ))]
       ( − 1)     =1 6=
    |                                                       {z                                                    }
                                                            1

         1 X                                                    1 X
                                                                        
      +√        [ ( (   ) | ) −  ( (   ))] + √        ( (   ) | ).
           =1                                                   =1
       |                        {z                         } |            {z               }
                                   2                                          3


It is straightforward (replace the kernel involving terms) to verify that we will get the
same conclusion as (25) and (24) here. So we only perform the analysis for 2 .
   Using steps similar to the case for ̂, one gets that

      ( (   ) | )
       ⎧⎡                                                                  ³            ´ ⎤              ⎫
       ⎨           1
                         { 1 (   )   
                                            −   1 (   )     }
                                                                 
                                                                    1
                                                                      
                                                                             − +                     ⎬
                2 ( )                                                          
 =    ⎣ 1 h ³ −( ) ´                                              ³             ´i ⎦ |    
       ⎩          × ̄              
                                         + { −  ( )} 1  −(              )                     ⎭
                                                                           
        ⎡                                                            ³           ´ ⎤
     Z           1
                      {    ()        −      ()      }  1
                                                                 
                                                                       − +
               2          1                  1         
 =      ⎣ 1h()³                ´                           
                                                                   ³  ´i ⎦  () 
                       −( )
           × ̄            
                                     + { −  ( )}   −(
                                                             1
                                                                        
                                                                             )

        ⎡                                                                                               ⎤
     Z                 1
                               { 1 ( +   )   − 1 ( +   )  }  ()
                  2
 =      ⎣ h1 (³ + )               ´                                            ³               ´i ⎦  ( +   ) 
                       −( +  )                                          1       −( + )
           × ̄               
                                            +  {  −    (     +     )}  
                                                                                           
     ⎡                                                                           ⎤
                 1                                                                   Z
              2 ( ) { 1 ( )   − 1 ( )  }  ( )
 =   ⎣    h  1  ³           ´                                ³            ´i   ⎦  ()  +  (  )
                    −( )                             1        −( )
       × ̄           
                                + { −  ( )}                   
     ⎡                 ∙                                                      ¸               ⎤
                         { 1 ( )   − 1 ( )  }
     ⎢                                                               ( )                   ⎥
     ⎢                                    21 ( )                                           ⎥
     ⎢                 |                         {z                           }               ⎥
     ⎢ ∙ µ                          ¶            ( )
                                                                      µ                  ¶¸   ⎥
 =   ⎢               −  ( )                                  1        −  ( )          ⎥ +  (  ) .
     ⎢                                                                                        ⎥
     ⎢ × ̄                            + { −  ( )}                                       ⎥
     ⎣                                                                                  ⎦
          |                                        {z                                      }
                                          2 (( ))


Therefore,

                         1 X
                               
                        √       [ ( (   ) | ) −  ( (   ))]
                           =1
                      1 X
                               
                   = √       [ ( (   ) | ) −  ( ) × 1 ( ( ) ≤ )]
                        =1
                          1 X
                                   
                        +√       { ( ) × 1 ( ( ) ≤ )}
                            =1
                      1 X
                               
                   = √       { ( ) × 1 ( ( ) ≤ )}
                        =1
                                       ⎡ n ³           ´                     o ⎤
                                              −( )
                        1  X
                                           ̄    
                                                         − 1 ( (  ) ≤  )
                     +√         ( ) ⎣                        ³
                                                                  −(  )
                                                                            ´ ⎦.                                 (41)
                          =1                              1
                                          + { −  ( )}          
                               |                     {z                        }
                                                                  


Now, we will show that the second term in the previous display is  (1). Letting  2 () =
 ( 2 ( ) | ( ) = ), we have that
                         ¡ 2¢
                        
                       Z          ½ µ        ¶            ¾2
                             2          −
                  =          () ̄            − 1 ( ≤ )  () 
                        −               
                         Z         µ       ¶2 µ         ¶
                               2      −       2   −
                       +       ()                        () 
                           −                       
                          Z            µ      ¶µ        ¶ µ         ¶
                                 2        −      −         −
                       +2       () ̄                                () .       (42)
                            −                              
The first term in (42) equals
           Z        ½ µ       ¶            ¾2
                 2        −
                () ̄          − 1 ( ≤ )  () 
            −              
           Z        ½ µ       ¶    ¾2           Z        ½ µ     ¶¾2
                 2        −                          2       −
      =         () ̄          − 1  ()  +       () ̄          () 
            −                                               
and both of the terms in the previous display converge to zero by the DCT since lim→∞ ̄ () =
1 = 1 − lim→−∞ ̄ (). The second integral in (42) converges to zero by the DCT since
lim→±∞ 2 2 () = 0. The third integral in (42) also converges to zero by lim→±∞  () =
                                     ¡ 2¢
0 and the DCT. This implies that        → 0 and thus
                          Ã             !
                              1 X
                                  
                                                              ¡ 2¢
                  0    √          =   ( ) ≤         → 0.
                                =1

Next,
             ⎧        ⎡ n ³            ´                       o ⎤⎫
          √  ⎨            ̄
                              −( )
                                         −  1 ( (   ) ≤  )     ⎬
                                
             ( ) ⎣                           ³          ´ ⎦
             ⎩            + { −  ( )} 1 
                                                    −( )       ⎭
                                                        
               ⎧                   ⎡ n ³                ´                     o ⎤⎫
          √    ⎨                         ̄
                                              −( )
                                                           − 1 ( (  ) ≤ )    ⎬
                                                 
        =    { ( ) | } × ⎣                              ³          ´ ⎦ = 0.
               ⎩       =0                + { −  ( )} 1 
                                                                    −( )     ⎭
                                                                      

So it follows that the second term in (41) is  (1).
   Thus we have that
           ½                     ¾½ µ              ¶                   µ              ¶¾
      1 X ̂1 ( ) 1 ( )             −  ( )                   1     −  ( )
     √                  −            ̄               + { −  ( )} 
        =1 ̂ 1 ( )    ( )                                          
           ½                                                        ¾
      1 X { 1 ( )   − 1 ( )  }
  = √                                       ( ) × 1 ( ( ) ≤ ) +  (1)
        =1              2 ( )
          µ Z                     ¶
                   2
    →  0          ()  ()  ,
                 −
where                     (∙                                            ¸2           )
                               { 1 ( )   − 1 ( )  }
           2 () =                                             ( ) | ( ) = 
                                            2 ( )
  Using exactly analogous steps, we will also get that
           ½                       ¾½ µ              ¶                       µ             ¶¾
      1 X ̂0 ( ) 0 ( )               −  ( )                     1      −  ( )
    √                  −               ̄               + { −  ( )} 
        =1 ̂ 0 ( ) 0 ( )                                                
           ½                                                                     ¾
      1 X  0 ( )  (1 −  ) − 0 ( ) (1 −  )
 = √                                                     ( ) × 1 ( ( ) ≤ ) +  (1) .
        =1                     20 ()
          µ Z                      ¶
                   2
    →  0          ()  ()  ,
                 −

where
                       (½                                           ¾2         )
                             0 ()  (1 − ) − 0 () (1 − )
          2 () =                                             () | () =  .
                                            20 ()

Finally, we get that

       1 Xn
                               o ½ µ  −  ( ) ¶                1
                                                                     µ
                                                                        −  ( )
                                                                                   ¶¾
                                                 
      √       ̂ ( ) −  ( )    ̄             + { −  ( )} 
         =1                                                          
           µ Z                                ¶
                  © 2               ª
      →  0           () +  2 ()  ()  ,                                   (43)
                 −

since the covariances will be zero (as can be easily seen from the asymptotic linear ex-
pansions because  (1 − ) = 0).
   Replacing in (40), and noticing that

          1 ( )   − 1 ( )                    
                      2
                                       ×  ( ) =                {1 −  (1 | )} ,
                     ( )                         Pr ( = 1| )

and
                          0 ( )  (1 −  ) − 0 ( ) (1 −  )
                                                                      ×  ( )
                                           20 ( )
                               1 − 
                       =                        {0 −  (0 | )} ,
                         1 − Pr ( = 1| )
we finally arrive at
               √ n        o
                  ̂ − 
                      ½                                                   ¾
                1 X          
           = √                        {1 −  (1 | )} × 1 ( ( ) ≤ )
                  =1 Pr ( = 1| )
                        ½                                                       ¾
                  1 X         1 − 
               −√                           {0 −  (0 | )} × 1 ( ( ) ≤ )
                    =1 1 − Pr ( = 1| )
                      1 X
                             
                + × √       { () − 1 ( ( ) ≤ )}
                        =1
                  1 X
                       
                +√       { ( ) × 1 { ( )  } − } +  (1) .                     (44)
                    =1
Now, observe that

          ̂ − 
           1 Xh                      i 1X                               n      o
                                          
        =        ̂ ( ) −  1 ( ) +      [ ( ) −  { 1 ( )}] − ̂ −  .
           =1 1                        =1 1
          |           {z             } |             {z              }
                           1                            2

Lemma 3 describes the behavior of 1 , and 2 is a standard empirical process which
           √
yields that  (̂ − ) tends to a zero-mean normal. The final step is to show
                                             µ    ¶
                                               1
                                    −  =  √      .                               (45)
                                                
                                                                   n                      o
                                                                 
Derivation of (45): Let  (·) denote the asymptotic variance of  ̂ () − ̂ −  () +  ,
            1
where     2
                (by theorem 1 and standard results on asymptotic distribution of Nadaraya-
Watson estimator) and let the support of −() ()
                                                      be (− ) for   0. Observe that
         Z                   ³            ´
 : =        ( −  ()) Pr ̂ () ≥ ̂ 1 ( ()  )  ()
            X
                          ⎛       n                        o ⎞
      Z                         
                               ̂ () − ̂ −  () + 
   =       ( −  ()) Pr ⎝                                  ⎠ 1 ( ()  )  ()
        X                           ≥  { −  ()}
                 Z                µ                ¶
      Edgeworth      −  ()            −  ()
          =                    Φ −                  1 ( ()  )  () + smaller order terms
                  X     ()                ()
        Z 
   ≤         Φ (− )  −() ()  + smaller order terms
                            ()
          0
            Z                    µ ¶
        1                              
   =    2
                   Φ (−)  −()          + smaller order terms.
             0               ()    
                        =1 , say
Therefore,
                                                           √ Z                        µ ¶
                                                √                                         
                                                 1 =      2
                                                                        Φ (−)  −()     
                                                                 0                ()   
                                                                      Z 
                                                                1
                                                         ≤  2−12          Φ (−) 
                                                                      0
           L’Hospital     2  Φ (− ) −1              2 12 Φ (− ) 
               →                                        =                        → 0 as  → ∞.
                           (2 − 12) 2−32                    (2 − 12)

     Now observe that
                                ⎡⎛     n           o               ⎞⎤
                          Z
                         { () − } Pr ̂ () ≥ ̂ 1 ( ()  )
         −  =    ⎣⎝                   n          o              ⎠⎦  ()
                  X     + { −  ()} Pr ̂ ()  ̂ 1 ( () ≥ )
                       ⎛      n          o                ⎞
                    Z      Pr ̂ () ≥ ̂ 1 ( ()  )
                 +    ⎝       n          o               ⎠  () .
                     X    − Pr ̂ ()  ̂ 1 ( () ≥ )
                          ³         ´
The first term is            √1        by the previous calculation. Finally, the 2nd term is proportional
                                
to
               ⎡⎛       n           o                 ⎞⎤
       Z             Pr ̂ () ≥ ̂ 1 ( ()  )
               ⎣⎝        n           o                ⎠⎦  ()
           X        − Pr ̂ ()  ̂ 1 ( () ≥ )
               ⎡⎛       n                                    o                ⎞⎤
       Z             Pr ̂ () − ̂ −  () +  ≥  −  () 1 ( ()  )
  =            ⎣⎝        n                                    o               ⎠⎦  ()
           X        − Pr ̂ () − ̂ −  () +    −  () 1 ( () ≥ )
               ⎡⎛       n ³                           ´                o                ⎞⎤
       Z             Pr  ̂ () − ̂ −  () +  ≥  { −  ()} 1 ( ()  )
  =            ⎣⎝        n ³                           ´                o               ⎠⎦  ()
           X        − Pr  ̂ () − ̂ −  () +    { −  ()} 1 ( () ≥ )
               ⎡⎛   h      ³          ´i                 ⎞⎤
       Z                      −()
                     1 − Φ  ()         1 ( ()  )
  =            ⎣⎝         n          o                   ⎠⎦  () + smaller order terms.    (46)
           X          −Φ  −()
                               ()
                                       1 (  () ≥ )


                                             √
     The leading term in (46) multiplied by  equals
                       Z  "Ã                           !#
                   √           [1 − Φ ( )] 1 (  0)
                                                           −() () .
                        −       −Φ { } 1 (  0)          ()
Now, observe that
            Z                                                 Z 
        √                
                                                           √
               [1 − Φ ( )] 1 (  0)  −() ()  ≤        Φ (− ) 
                                           ()
             −                                                 0
                                                            √ Z 
                                                             
                                                        =           Φ (−) ,
                                                             0
                                       −1
                        L’Hospital       Φ (− )      √
                           →                           =   Φ (− ) → 0.
                                   ( − 12) −32
                                        √ R
An exactly symmetric argument applies to  − Φ { } 1 (  0)  −() () .
                           ³ ´               √
                                                                    ()
                              1
   Consequently,  −  =  √ and hence a -consistent CI for  is also a valid
√
 -consistent CI for  .
   Outline of proof for parametric  (·): Suppose  () is parametrically specified
as  ( ), where  (·) is known; typically  (the so-called “pseudo-true value”) can be
estimated at parametric rates using, say, GMM. For estimation of  and  resulting from
the plug-in approach, we will still use smoothing with the c.d.f. kernel ̄ (·) to handle the
nonsmoothness, since smoothing-based methods are more generally applicable.
                                                              √
   The key result is that both  and  can be estimated at the -rate. To see this,
recall the asymptotic expansion for ̂:


         √
            (̂ − )
         n       o−1 1 X    ½             µ                ¶¾
           ˆ                                  −  (  )
       = ̂ (̃)     √         () − ̄
                         =1                     
                        ⎧         ⎡                          ⎛       ³        ´ ⎞⎤⎫
           n        o−1 ⎨ 1 X       µ               ¶          −      ̂     ⎬
                                  ⎣̄  −  (  ) − ̄ ⎝
                                                                       
         + ˆ̂ (̃)      √                                                     ⎠⎦ .
                        ⎩                                                    ⎭
                              =1


Using similar steps as in the proof of theorem 2 in the appendix, the first term is asymp-
totically normal with mean equal to
                         "          (−1)      R1              #
                  √       (−1)+1      () × −1   ()       ¡√    ¢
               lim  ×                                         +  
              →∞                           !
                            √ 
which is finite if lim→∞      ∞.
                                                            √
   As for the second term, (and this is what makes ̂ a      -consistent estimator in the
parametric case) notice that
                          ⎡                           ⎛       ³         ´ ⎞⎤
                              µ                ¶         −       ̂
                   1 X⎣
                       
                                 −  (  )                   
                  √        ̄                    − ̄ ⎝                   ⎠⎦
                     =1                                  
                                                       µ                  ¶
                  √ ³        ´0 1 X  
                                                          −  (  )
              =      ̂ −             ∇ (  )                        +  ,
                                 =1                       
where                       °       °2                ⎛ ³        ´    ⎞
                            °       °
                           °̂ −  ° 1 X
                                                          ̃ − 
                | | ≤      √           1 ( ) 0 ⎝               ⎠,
                            2 2  =1                    

with³  a ´fixed positive constant and 1 () a uniformly bounded function. Since
√
  ̂ −  =  (1), by conditions B4(i) and A4 (ii), the RHS of the previous display
goes to zero if 4 → ∞. Then we have that
                              ⎡                           ⎛      ³        ´ ⎞⎤
                                  µ                ¶         −    ̂
                       1 X⎣
                           
                                     −  (  )
                      √        ̄                    − ̄ ⎝                 ⎠⎦
                         =1                                  
                     ∙                           ¸
                       √ ³        ´0
                 =        ̂ −  ∇ (  ) × () () +  (1) .
                    √
This implies that     (̂ − ) will converge to a zero mean normal if 2
                                                                          → 0 and
3 4 → ∞ and when the density of  ( ) has uniformly bounded derivatives up to
order ( − 1) where  ≥ 3. The result for ̂ will follow.


9.2     Part 2: Split sample simulation
Here we describe and perform a simulation exercise, using a split sample method in order
to address the potential positive bias alluded to in section 4. Divide the sample randomly
into 2 parts: call the first group  = 1  and call 2nd group  =  + 1 . Then for
                                      (1)
each  =  + 1 , calculate ̂          ( ) using only observations  = 1 . Then use the
                                                                      (2)
second half to calculate a second independent estimate ̂                   ( ) at the same set of values
                        (1)                  (2)
 as before. Then ̂         ( ) and ̂         ( ) are functions of distinct Y observations which
are independent. Finally, calculate ̂ and ̂ via:
                                  Ã        (2)
                                                  !
                       1 X
                           
                                    ̂ − ̂ ( )
           1− =               ̄
                       =+1             
                                                                            Ã         (2)       !
                      1X                 1 X (1)
                                            
                                                                                ̂ − ̂ ( )
                 ̂ =       ̂ 1 ( ) −         ̂ ( ) × ̄                                      .
                       =1               =+1                                      
Such split-sample methods were previously suggested in Altonji and Segal (1996) to reduce
finite sample bias of GMM estimates. While this split-sample method does not change
the asymptotic distribution of ̂ or ̂, we investigate its potential finite sample superiority
in a small Monte Carlo study as follows.
   Take =wealth and take the population to be our sample. Generate ˜ (0 1),
0 ˜ (0 1), 1 = 0 +  +  ∗ . Then  (1 |) =  () = . Set  = 05, find
median of wealth which equals  and then

                                    1 X
                                       
                                 =        × 1 (  ) .
                                     =1

This  and  are the “true” parameter values. Finally, generate  as a random Bernoulli
variable and set  = 1 + (1 − ) 0 .
   Now we will do the simulations as follows. For each draw from this population, first
estimate  and  with the full sample and then split the sample into two equal halves and
repeat the estimation in the split-sample way, as described above. In both cases, we vary
 between −16 and −18 and  between −524 and −624 . We present the results
graphically in Figure A1. From the graphs, it appears that the full-sample estimates of
 are generally closer to the true value and the bias for  = −18 is in fact negative.
Given these results, we use the full-sample estimation in our application.


9.3    Part 3: Discussion of condition AM
Part A: We first present a very simple model of bednet use, which would imply AM(ii).
Suppose a representative household has utility function defined on consumption and bed-
net adoption  ( ),  ∈ {0 1} where  (· ) is continuous, strictly increasing and strictly
concave for  = 0 1. Suppose nonsubsidized price of bednet is  in terms of the consump-
tion good and the subsidized bednet costs 0. Let  denote unobserved heterogeneity in
household preference, distributed with c.d.f.  . Ignore other covariates (or condition on
them), suppose household budget is  and assume for simplicity that  ⊥ . Then one
can show that

    () = Pr (use net with subsidy| = ) − Pr (use net without subsidy| = )
           = Pr ( ( 1) −  ( 0)  ) − Pr ( ( −  1) −  ( 0)  )
           =  { ( 1) −  ( 0)} −  { ( −  1) −  ( 0)} .
If  is uniform, we get  () =  ( 1)− ( −  1). For fixed   0,  0 () =   
                                                                                    
                                                                                          ( 1)−


      ( −  1)  0 if  is strictly concave in its first argument. If  is continuously
distributed on a bounded support, then  ()—a strictly monotone continuous function
of —will also be continuously distributed with a bounded support. For other choices of
 , we can get piecewise monotone  (·). An intuitive interpretation of  0  0 is simply
that individual demand for bednets is less price-sensitive when individuals are wealthier.
   Part B: If we do not assume AM, then the following generalizations are appropriate.
Define
                                      ½ Z                               ¾
               −1
              ()   (1 − ) =   sup  :       1 ( () ≥ )  () ≤  ,
                                            ∈X
                                    ½Z      ³                      ´        ¾
                                                         −1
                          1 =    1       1  () ≥ () (1 − )  () = 
                                      ∈X
                                       n                 o
                                          −1
                           =     max ()   (1 − )  0
                                    n                  o
                                       −1
                          2 =    1 () (1 − )  0 ,

and write
             ∙              Z                                       ¸
 =  1  2 ×  { 1 ()} −             [ () 1 ( ()  )]  ()
                                  ∈X
         + (1 −  2 ) ×  { 1 ()}
         + (1 −  1 )  2 × [ { 1 () 1 { ()  }} +  { 1 () 1 { ()} = } × ( − Pr ( () ≥ ))] .

When  1 = 1 and  2 = 1, then we have the case discussed in the paper. When  2 = 0,
everyone with positive treatment eﬀect will be treated and hence the second term in the
previous display. When  2 = 1 and  1 = 0, everyone with CATE above  is treated but
this leaves a surplus equal to ( − Pr ( ()  )), which is then randomly distributed
among those with the "next highest" value of  (), which is the third term. So if  ()
has a point mass at  with () (−)  1 −   () (), for some , then the surplus
may then be randomly distributed among the those with  () = .
   As is clear from the expressions, the sample analog of  will have discontinuities in
its asymptotic distribution, depending on what values the nuisance parameters  1 and
 2 take and methods analogous to Andrews and Guggenberger would be warranted for
constructing uniformly valid confidence intervals for . These issues are outside the scope
of the present paper and we leave them to future research. condition AM guarantees that
 1 = 1 = 2 . Strengthening AM (i) to ln () × {Pr ( ()  0) − }   for some   0
would let us assume away AG type situations.
9.4     Part 4: Asymptotic framework for covariate choice
Suppose  = (1  2 ) and we want to decide whether to condition allocation on 2 in
addition to conditioning on 1 . For a fixed  = ( 1   2 ), as  → ∞, the wider model
is obviously better. Therefore, to keep the covariate choice problem non-trivial in the
asymptotics, we consider a sequence of models  with
                                                                         √
                          (1 − 0 | = ) := 0   := 01  1 + 02  ,

for some  ∈  . Let ̂ and ̃ 1 be the MLE of  in the unrestricted (labeled ur) model
and of  1 in the restricted (labeled r) model respectively with ̂  and ̃  the respective
estimates of . Within this "limit of experiment" framework, Le Cam type convergence
theorems can be invoked under appropriate regularity conditions to show that the diﬀer-
ence in welfare functions resulting from the larger and smaller set of covariates satisfies
        √
       lim (     
               −  )
    →∞
        Z                     ∙ µ√ 0                     ¶    µ√ 0                             ¶¸
           ¡√ 0          0
                            ¢     1  1 + 02  −  
                                                      
                                                                               −1
                                                                1  1 + 01 11 12  −  
  = lim       1  1 + 2  Φ                             −Φ                                      ()
    →∞                                  ()                            ()
                                                                                      0               0
where   () and   () represent the asymptotic std deviation of ̂  − ̂ and ̃  − ̃
               −1
respectively, 11 12 represents the projection matrix from regressing 2 on 1 and  
and  
       represent the true thresholds corresponding to the wider and narrower models,
               −1
respectively. 11 12  corresponds to the familiar "omitted variable bias" formula.
   Since these parameters are unknown, potential feasible rules may be based on:
                  1 Xh 0             n n                      o     ³                        ´oi
                     
      1 : =           ̂ (−) × 1 0 ̂ (−) ≥ ̂ 
                                                         (−)   − 1   0
                                                                         ̃
                                                                       1 (−)   ≤  ̃ 
                                                                                       (−)       , or
                   =1
                        "            ( Ã                        !      Ã                         !)#
                  1X 0
                     
                                          0 ̂ (−) − ̂ 
                                                           (−)            0
                                                                              ̃
                                                                            1 (−) −    ̃ 
                                                                                            (−)
      2   : =         ̂       × ̄                          − ̄                                 .
                   =1  (−)                                                  

where the subscript (−) denotes the leave-one-out estimate. The formal task is to show
                                                     √
that under the sequence of models  , the sequences  ( − (     
                                                                   −  )) converge to
an appropriate limiting random variable (see below for how to handle CV based estimates
in the asymptotics). The quantiles of this latter random variable can be used to decide
on the tolerance threshold  for  above which the wider model will be preferred. Two
other issues of interest are those of post-model selection inference, i.e., estimating
                              µ             ¶        µ             ¶
                                                            
                        Pr   √         +  Pr  ≤ √       ;
                                                                
and generalizing the above analysis to the case where  (1 − 0 | = ) is not necessarily
linear in  and yet we are considering two linear models to make treatment allocation. In
this case, ̂ and ̃ 1 can be interpreted as pseudo-MLEs and 1 replaced by
                  ∙µ                         ¶    ³ n                  o   ³                    ´´¸
          1X
              
                          (1 −  )             0                    0              
                            −                    × 1  ̂ () ≥ ̂ () − 1 1 ̃ () ≤ ̃ ()
           =1         ̂      1 − ̂

              1
                  P
where ̂ =        =1    . An appropriate local to zero asymptotic analysis in this case seems
to be an interesting task worth pursuing.
    Cross-validation (heuristics for the claim in footnote 8): Using the smoothed
estimates and the parametric version of theorems 1 and 2 in the main text, it follows that
the diﬀerence between the naive estimate and the CV estimate of welfare is given by
                                         (                         )                    (                 )
                    1X 0                                               1X 0
                                                                          
                                           0 ̂ (−) − ̂ (−)                        0 ̂  − ̂ 
    ̃ − ̂ : =        ̂      ̄                               −         ̂ ̄
                     =1  (−)                                     =1                   
                                                                     µ n                   ¶
                  1X ³                   ´0 n                 o                         o2
                     
                =            ̂       ̂ (−) − ̂  +        ̂ (−) − ̂         ,
                   =1
                 ³              ´
for some vector      ̂  . Now, using an influence functions approach, it can be
shown (c.f., CH page 52) that when ̂ is the MLE with − the Hessian and  (·) the
score, then                                                               µ ¶
                                                     −1 ˆ−1                1
                                ̂ (−) − ̂  = −          ( ) + 
                                                                           
and the term ˆ−1 is related to the estimated asymptotic variance of ̂. Replacing ̂ (−) −̂ 
in the previous display, we get the feasible form of the penalization term.
