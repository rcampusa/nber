                              NBER WORKING PAPER SERIES




                        GRANULAR INSTRUMENTAL VARIABLES

                                        Xavier Gabaix
                                       Ralph S. J. Koijen

                                      Working Paper 28204
                              http://www.nber.org/papers/w28204


                     NATIONAL BUREAU OF ECONOMIC RESEARCH
                              1050 Massachusetts Avenue
                                Cambridge, MA 02138
                                   December 2020




We thank Aditya Chaudhry, Antonio Coppola, Rishab Guha, Dong Ryeol Lee and Lingxuan Wu
for excellent research assistance. We thank Isaiah Andrews, Miriam Arden, Stephane
Bonhomme, Gary Chamberlain, Jiafeng Chen, Raj Chetty, Mark Gertler, James Hamilton, Nathan
Hendren, Guido Imbens, Oleg Itskhoki, Larry Katz, Lutz Kilian, Jens Kvaerner, Erik Loualiche,
Matteo Maggiori, Isabelle Mejean, Serena Ng, Ashesh Rambachan, Jean-Marc Robin, Kelly
Shue, Jim Stock, Elie Tamer, Harald Uhlig, Christian Wolf, Tiemen Woutersen, Dacheng Xiu,
and seminar participants at various conferences for comments. We gratefully acknowledge
financial support from the Sloan Foundation (Gabaix) and the Center for Research in Security
Prices at the University of Chicago Booth School of Business (Koijen). The views expressed
herein are those of the authors and do not necessarily reflect the views of the National Bureau of
Economic Research.

NBER working papers are circulated for discussion and comment purposes. They have not been
peer-reviewed or been subject to the review by the NBER Board of Directors that accompanies
official NBER publications.

© 2020 by Xavier Gabaix and Ralph S. J. Koijen. All rights reserved. Short sections of text, not
to exceed two paragraphs, may be quoted without explicit permission provided that full credit,
including © notice, is given to the source.
Granular Instrumental Variables
Xavier Gabaix and Ralph S. J. Koijen
NBER Working Paper No. 28204
December 2020
JEL No. C01,E0,F0,G0

                                         ABSTRACT

We propose a new way to construct instruments in a broad class of economic environments:
"granular instrumental variables" (GIVs). In the economies we study, a few large firms, in-
dustries or countries account for an important share of economic activity. As the idiosyncratic
shocks from these large players affect aggregate outcomes, they are valid and often powerful
instruments. We provide a methodology to extract idiosyncratic shocks from the data in order to
create GIVs, which are size-weighted sums of idiosyncratic shocks. These GIVs allow us to then
estimate parameters of interest, including causal elasticities and multipliers.

We first illustrate the idea in a basic supply and demand framework: we achieve a novel
identification of both supply and demand elasticities based on idiosyncratic shocks to either
supply or demand. We then show how the procedure can be enriched to work in many sit-
uations. We provide illustrations of the procedure with two applications. First, we measure how
"sovereign yield shocks" transmit across countries in the Eurozone. Second, we estimate short-
term supply and demand multipliers and elasticities in the oil market. Our estimates match
existing ones that use more complex and labor-intensive (e.g., narrative) methods. We sketch how
GIVs could be useful to estimate a host of other causal parameters in economics.


Xavier Gabaix
Department of Economics
Harvard University
Littauer Center
1805 Cambridge St
¸Cambridge, MA 02138
 and NBER
 xgabaix@fas.harvard.edu

Ralph S. J. Koijen
University of Chicago
Booth School of Business
5807 S Woodlawn Ave
Chicago, IL 60637
and NBER
Ralph.koijen@chicagobooth.edu
1       Introduction
In many settings, there is a dearth of instruments, which hampers economists' understanding
of causal relations (Ramey (2016); Stock and Watson (2016); Nakamura and Steinsson (2018);
Chodorow-Reich (2019)). We propose a general way to construct instruments: "granular instru-
mental variables" (GIVs). These instruments in turn allow researchers to establish causal relations
in a wide variety of economic contexts.
    In the economies we study, many decisions are taken by a few large actors, such as firms,
industries, or countries, whose idiosyncratic shocks (e.g., productivity shocks) aect the aggregate
ones.1 These idiosyncratic shocks at the firm, industry, or country level are valid instruments for
aggregate endogenous variables such as prices. We present a method to extract those idiosyncratic
shocks, which allows us to construct GIVs. The GIVs then allow us to estimate parameters of
interest.
    We first illustrate the idea in a basic static setup with supply and demand (Section 2). It
is a classic setting, and we show how GIVs allow for a novel estimation procedure: they yield
an instrument that allows us to estimate the elasticities of both supply and demand. Indeed,
idiosyncratic demand shocks to large firms or countries give a valid instrument for demand change
­ and thus allow one to estimate the elasticity of supply. They also allow us to estimate the
elasticity of demand: the idiosyncratic demand shock of a large firm impacts the price, which
changes the demand of other firms. We formalize these ideas and present a way to "optimally
extract" idiosyncratic shocks, thus constructing optimal GIVs.
    Once the ideas are in place, we show in Section 3 how the procedure can be broadened to handle
many extensions, such as feedback loops, heterogeneity, and several exogenous factors. Section 4
gives a practical user's guide.

Empirical illustrations We provide empirical results for two applications: sovereign yield spillovers
and the equilibrium of global crude oil markets.
    First, we study sovereign yield spillovers in the Eurozone in 2009-2018. If a country has an
increase in its sovereign yield spread (i.e., the yield on its government debt minus the comparable
yield for German sovereign bonds), how much does that "spill over" to other Eurozone countries?
We present a simple model that allows us to think about that and delivers a theoretically-grounded
functional form for the shape of the spillovers. The modeling device we use is partial mutualization
of debt, and we argue that other devices are likely to give a similar reduced form. Then, we use
GIVs to estimate that spillover. Specifically, we extract idiosyncratic sovereign yield shocks and
trace the impact of an idiosyncratic shock of one country on the other countries' yields. We find a
"multiplier" of 1.5 (where unity would signify the absence of spillovers). To interpret this, suppose
    1
    Hence, economies are "granular": their shocks are made of incompressible "grains" of economic activity, at the
firm, industry, or country level. This theme is laid out in Gabaix (2011), and developed in Acemoglu et al. (2012),
di Giovanni and Levchenko (2012), and Carvalho and Grassi (2019).


                                                        2
that Italy suers a bad idiosyncratic shock that makes its debt likelier to default, so that the market
value of Italy's debt falls by one billion euros. The multiplier M ' 1.5 means that the aggregate
debt of all European governments falls by 1.5 billion euros: the spillover is an extra 0.5 billion euros
of losses in European sovereign debt markets.
    Second, we use GIVs to estimate the short-term impact of demand and supply shocks in global
crude oil markets as a validation exercise. These multipliers, which depend on demand and supply
elasticities, have been studied extensively in the literature using structural VARs. To identify the
parameters of interest, the literature has relied on ordered VARs, sign restrictions with informative
priors, and narrative methods. We use country-level oil supply growth to construct the GIV,
after removing common factors using principal components and OPEC membership to construct
an OPEC-specific factor. We find that the multipliers identified by GIV fall within the range
documented in the literature.
    This application also shows how GIVs can be used to identify parameters in structural VARs,
complementing an active literature that uses sign restrictions, as in Uhlig (2005), or narrative
restrictions combined with sign restrictions, as in Antol´   in-D´
                                                                 iaz and Rubio-Ram´    irez (2018) and
Ludvigson et al. (2020).

Uses of GIVs GIVs allow to "democratize" and "automatize" instruments, especially in macro-
finance where they have been rare. In standard practice, finding an instrument is a heroic and
very ingenious aair. For instance, work on the "China shock" (the entry of China in the World
Trade Organization, studied in Autor et al. (2013)) depends on detailed historical knowledge and
applies only to a specific time period. With GIVs, we can have a more systematic way to obtain
instruments, that can apply more generally and over many time periods.
    Once one thinks about causality and GIV procedures, the answers to many interesting questions
suddenly feel within reach. Several recent papers have already applied GIV procedures to identify
key parameters and elasticities of interest. Chodorow-Reich et al. (2021) study the multiplier of
idiosyncratic shocks to an insurer's asset portfolio on the insurer's equity valuation. Camanho et
al. (2020) study the impact of idiosyncratic shocks to fund-level rebalancing on exchange rates.
Galaasen et al. (2020) use GIVs to study how idiosyncratic shocks to firms impact banks, and how
this spills over to other (small, non-granular) firms borrowing from the same bank. In Gabaix and
Koijen (2020), we apply the methodology in this paper to measure the elasticity of the aggregate
stock market using idiosyncratic demand shocks to large investors or investor sectors. Schubert et
al. (2020) study the impact of concentration on wages and use idiosyncratic firm-level shocks to
instrument for concentration. Kundu and Vats (2020) estimate how idiosyncratic firm-level shocks
in one state aect economic activity in other states via their transmission through the banking
system.
    We sketch a few further potential applications here, hoping that they will inspire other re-
searchers to investigate these and related topics with the help of GIVs. In some cases, creative


                                                   3
instruments have been uncovered and GIVs may be useful to sharpen the estimates or to extend
the estimates to other settings (e.g., other time periods, industries or countries).
    The notion of doom loops is that when banks do badly, this will hamper the financial health
of the state (as the state may need to bail out banks), and hence will increase the yield on the
sovereign's debt. This in turn will create a fall in bank returns and result in a "doom loop." How
important are those doom loops quantitatively? Using the idiosyncratic returns of large banks,
GIVs allow us to estimate both channels, from banks to state and from state to bank. We plan to
pursue this application.
    GIVs can be used to estimate the pass-through from exchange rates to real economic activity.
To take a concrete example, if the Turkish Lira appreciates, how does that aect Turkey's exports
and borrowing? One could handle that via idiosyncratic demand shocks by large investment funds
for the Turkish Lira.2
    If there is an export boom, then what is the impact on the exchange rate, and the rest of the
economy? Idiosyncratic shocks to large exporters will be useful to answer that question, as recent
research has shown them to be very large (di Giovanni et al. (2014); Gaubert and Itskhoki (2020);
Kramarz et al. (2020)).
    Do firm-specific hiring, investment, and innovations spill over to peer firms operating in the
same product market? That is, what is the sign and magnitude of strategic complementaries?
Idiosyncratic innovation shocks to some large players will help construct the GIV.
    How much do the constraints of financial intermediaries (such as broker-dealers) matter for asset
prices? The GIV will rely on idiosyncratic shocks to intermediary wealth, which may be related to
shocks to other parts of the banks.
    How do international macroeconomic shocks propagate? For instance, how does a boom in
Germany transmit to the rest of Europe? Using idiosyncratic shocks (dierentiating between pro-
ductivity and demand shocks) to countries will help us answer that question.
    Likewise, how do regional "micro" shocks propagate into macro shocks? GIVs allow us to
measure that and to estimate a micro-to-macro multiplier.3

Related literature We relate to a number of literatures. We oer some brief pointers here, while
oering a longer discussion in Section 8.2.
    Instruments for macro. An active literature discusses identification strategies in macro (Ramey
(2016); Nakamura and Steinsson (2018); Chodorow-Reich (2019)). We add to it by proposing to
use GIVs, which are quite ubiquitous. There are lots of idiosyncratic shocks, and GIVs allow us to
construct them systematically.
    Origins of aggregate fluctuations. A growing literature finds that a sizable amount of volatility
is "granular" in nature ­ coming from idiosyncratic shocks to firms or industries (Long and Plosser
  2
    See Gabaix and Maggiori (2015) and Caballero and Simsek (2020) for models along those lines and Koijen and
Yogo (2019) for a methodology for asset demand systems.
  3
    We are pursuing this last question in ongoing work.


                                                      4
(1983); Gabaix (2011); Acemoglu et al. (2012); di Giovanni and Levchenko (2012); di Giovanni et
al. (2014); Baqaee and Farhi (2019); Carvalho and Grassi (2019); Pasten et al. (2020)). We provide
tools that can tease that apart in the presence of feedback loops. Datasets used in this literature can
be revisited, forming GIVs which allow us to investigate causal relations. Gabaix (2011) introduces
the notion of the "granular residual", a weighted sum of proxies for idiosyncratic shocks, and shows
how idiosyncratic shocks to firms appear to explain about one third of GDP fluctuations. But that
paper does not take the crucial step of using this kind of concept as an instrument to measure
causal relations, for instance in a demand and supply setting.
    The idea that we propose is in retrospect natural, so that we suspected it may have been
already introduced in the literature, perhaps in a forgotten paper from the 1950s. However, after
searching the literature and consulting with many experts, we did not find an earlier statement
of it. We are quite sure that this idea has not been systematically implemented in mainstream
economic applications. The idea of using idiosyncratic shocks as instruments to estimate spillover
eects has been explored in several creative papers, as we discuss in more detail in Section 8.2,
such as Leary and Roberts (2014b), Amiti and Weinstein (2018), and Amiti et al. (2019). However,
the typical approach has been to use idiosyncratic shocks to variables that are excluded from the
main estimating equation to construct instruments. We instead use the idiosyncratic shocks in
the estimating equation directly. In addition, we allow for more flexible exposures to unobserved
common shocks in extracting idiosyncratic shocks.

Outline Section 2 presents a gentle introduction to the GIV framework, centered around a very
simple model of supply and demand. It highlights the core intuition. Section 3 contains the general
procedure. Section 4 gives a practical user's guide. Section 5 presents simulations. Sections 6 and 7
give empirical applications. Section 8 presents a number of extensions and robustness checks, and
discusses more extensively the link with the rest of the literature. Section 9 concludes. Long proofs
are in the online appendix.

Notations We will use the following notations. For a vector X = (Xi )i=1...N and a series of
                        P
relative weights Si with Ni=1 Si = 1, we let

                             N                     N
                          1 X                      X
                    XE :=       Xi ,       XS :=         Si X i ,   X := XS   XE ,                 (1)
                          N i=1                    i=1


so that XE is the equal-weighted average of the vector's elements, XS is the size-weighted average,
and X is their dierence.
                                                                                                2
    We also commonly use the notation ui for shocks that are uncorrelated and with variance u     i
                                                                                                    .
Then, we will define the "inverse variance weights" or "pseudo-equal weights" (using that term to




                                                   5
highlight that they are a small variant of equal weights):
                                                         2
                                            ~i := P1/ u    i
                                            E                2
                                                                ,                                      (2)
                                                    j 1 /    uj

               P ~                            ~   1              2
                                                                                              PN ~
which satisfy i E    i = 1, and are equal to Ei = N when all the ui are equal. Then XE   ~ :=   i=1 Ei Xi .
We also define ~ i := Si E    ~i . Then, X ~ = XS X ~ will be the "granular residual" in a number of
                                                     E
settings. It is the size-weighted sample average of X minus the "inverse-variance" weighted sample
average of X . It will be an optimal proxy for idiosyncratic shocks.
    We use the notation xe for an estimator of a variable x, or as a "proxy" for variable x, meaning
a variable close to x but not exactly equal to it, even asymptotically ­ we will make the dierence
                                                                            PT
clear. Lastly, we use ET for the sample temporal mean, ET [Yt ] := T      1
                                                                              t=1 Yt ; Ct for a vector of
controls;  for a vector of 1's; I for the identity matrix, of the appropriate dimension given the
context; V Y for the variance-covariance matrix of vector Yt (so V Y = E [Yt Yt0 ] if Yt has mean zero);
and X ? Y to say that the random variables X and Y are uncorrelated.


2       The basics of GIV
We introduce the GIV idea by considering a very simple example with supply and demand. We
progressively extend it throughout the present section. The full GIV procedure is then outlined and
synthesized in Section 3. The step-by-step approach we take in this section is helpful, we think, to
progressively build an understanding of the GIV idea from its core to its more arduous extensions.
We discuss extensions in Section 8.


2.1     A very simple example with no feedback loop
2.1.1    Basic model

For clarity, we lay out a concrete economic model of the equilibrium in, for instance, the oil market.
Demand by country i at date t is Dit = QS¯ i (1 + yit ), where Q
                                                               ¯ is the average total world production,
yit is a demand disturbance term, and Si is country i0 s share of demand, normalized to follow
PN
   i=1 Si = 1. The demand does not depend on the price for now: this is for simplicity, and because
it is a useful example of an economy without feedback loops. Once the basic ideas of the GIV are in
place, we will easily extend this simple model to the case of a non-zero demand elasticity in Section
2.2. The demand disturbance is assumed to be the sum of a common shock t and an idiosyncratic
shock uit :
                                           yit = i t + uit .                                        (3)

For now we consider the case with uniform loadings, i = 1, but we will relax that soon.
   All shocks are i.i.d. across dates for now (it is easy to relax that, see Section 4.2). Then, total

                                                     6
                              P          ¯ (1 + ySt ), where ySt := P Si yit is the size-weighted average
world demand is Dt = i Dit = Q                                          i
                                                                    ¯ 1 + pt "t , where pt = Pt ¯ P¯
demand disturbance. We suppose that supply is Qt = Q                                             P
                                                                                                     is the
proportional deviation from P     ¯ , which is thus the average price of oil. Then, to equilibrate supply
and demand (Dt = Qt (pt )), we must satisfy Q        ¯ (1 + ySt ) = Q
                                                                    ¯ 1 + pt "t . That is, the deviation of
                                                                            
the price from its average satisfies:
                                                pt = ySt + "t .                                         (4)
                                                                      P
It depends on the size-weighted average demand shock, ySt = i Si yit .
     Throughout this paper we will make the mild assumption that all our variables (such as t , "t , ut =
(uit )i=1...N ) have finite second moments.
     The classic problem is that we cannot estimate  by OLS. Indeed, a direct regression of pt on
ySt (that is, a regression of the form pt = ySt + "t ) would be biased, as "t and t (hence "t and ySt )
can be correlated.
     However, suppose that we form the GIV:

                                                                N
                                                                X               XN
                                                                                    1
                              zt := y     t   = ySt    yEt =           Si yit         yit .              (5)
                                                                 i=1            i=1
                                                                                    N

                               PN                           PN   1
Then, we have, using uSt :=         i=1   Si uit , uEt :=    i=1 N uit ,    that

                              N
                              X                                            XN
                                                                               1
                      ySt =         Si yit = t + uSt ,           yEt =           yit = t + uEt ,
                              i=1                                          i=1
                                                                               N

so zt := ySt   yEt = (t + uSt )       (t + uEt ) satisfies

                                                zt = uSt     uEt =: u t .                                (6)

Note that zt := ySt yEt is just constructed from observables. It is the dierence between the
size-weighted demand and the equal-weighted demand. Intuitively, it captures the "idiosyncratic
demand" by large units, as shown by zt = u t .
    We assume that the shocks uit are idiosyncratic, in the sense that:

                                               E [uit "t ] = 0 for all i, t.                             (7)

This "exogeneity" or "exclusion" assumption needs to be discussed in each economic application ­
as we will below.4 Then, we have

                                              E [zt "t ] = 0 : Exogeneity,                               (8)
  4
    The uit , ujt could be correlated. If we have disaggregated data for both supply and demand, we can relax
condition (7): see Section D.4.



                                                            7
                                              E [zt ySt ] 6= 0 : Relevance.                                               (9)

Hence, zt = u t is a valid instrument (and as Proposition 3 will show, an optimal one).5 We call it
a "granular instrumental variable" (GIV).
   Given that pt ySt = "t , we have

                                                 E [(pt       ySt ) zt ] = 0,                                           (10)

that is, E [pt zt ]   E [ySt zt ] = 0, which gives the supply elasticity , by

                                                              E [ pt z t ]
                                                      =                    .                                            (11)
                                                              E [ySt zt ]

Indeed, in practice, we might estimate  using sample means:
                                                               1
                                                                 P
                                                                    pt z t
                                                   e
                                                   T    :=    1
                                                               T
                                                                 Pt        .                                            (12)
                                                              T   t ySt zt


    We now state a formal proposition.6

Proposition 1 (Consistency of the GIV estimator in this example). Suppose that E [uit "t ] = 0,
although the uit can have an arbitrary distribution, with mean 0 and finite variance. Form the GIV
                                                                      E [p t zt ]
estimator zt := y t . Then, zt identifies the price elasticity, by  = E [ySt zt ]
                                                                                  . In other terms, for fixed
                                                           1 P
                                  e :=                         t p t zt
N but as T ! 1, the GIV estimator T                        T
                                                          1 P              is consistent for the price elasticity .
                                                          T   t ySt zt


                                                                                       q        P
Precision of the GIV estimator We define the excess Herfindahl as h =                       1
                                                                                            N
                                                                                              + N       2
                                                                                                  i=1 Si . In
the context of industries, for example, a higher h means that the industry is more h       concentrated:
                                                                                              q        i an
                                                                                                     1
industry where all the firms have the same size features h = 0. The quantity h 2 0, 1 N will
prove to be analytically useful, since if (uit )i=1...N is a series of i.i.d. uncorrelated random variables
                                       2
with mean 0 and common variance u        , then the volatility of the GIV zt = u t is:

                                                          u    =h         u.                                            (13)

   In particular, under a standard central limit theorem, an appropriately scaled and centered
version of the above GIV estimator is asymptotically normally for fixed N as T ! 1:
                                             p      e               d           2
                                                 T (T          ) ! N 0,             ,
   5
     The relevance condition is generically true, and otherwise assumes a very mild condition on the shares, see
Proposition 2 and Assumption 1.
   6
     It holds under mild regularity conditions on the joint distribution of uit , t , "t given that the data are i.i.d. across
dates.



                                                                8
       2
where    is the asymptotic variance. The next proposition states the conditions under which the
asymptotic variance of the estimator simplifies substantially (its proof is in Section C).

Proposition 2 (Precision of the GIV estimator in this example). If "t is homoskedastic conditional
on the uit 's, then the asymptotic standard deviation of the scaled and centered GIV estimator is
                                                                      2
  = u . If we assume further than the uit are i.i.d. with variance u , then u = h u and
       "




                                                                  "
                                                     =                ,                        (14)
                                                              h   u

where h is the excess Herfindahl:           v
                                            u                         N
                                            u         1   X
                                       h := t           +     Si2 .                            (15)
                                                      N   i=1

    So in order to have a precise estimate (low  ), we need: some large units (in order to have a
large excess Herfindahl h), and that idiosyncratic shocks are large compared to aggregate shocks
(large u / " ).
    This simple example illustrates the basic idea. The reader might at this point have in mind a
number of questions and objections: What if the factor structure is non-trivial (for instance, we
don't have i = 1 in (3))? What if the demand is sensitive to price? Is the GIV that we constructed
the best instrument we can find? What happens if there are more feedback loops?
    The next subsections are devoted to answering them in turn.

2.1.2   Optimality of the GIV weights

Above, we have shown that zt = y t allows for identification, for a specific = S E . It is easily
                                                 P
verified that any GIV with weights such that i i = 0 would work. Hence, we can seek an
optimal . The we proposed is actually optimal, as we formalize below.
                                                                                     P
Proposition 3 (Optimal weights for the GIV y t ). Consider the GIV zt = y t = i i yit , with
                      P
some weights i with i i = 0. Call V u the variance-covariance matrix of the idiosyncratic shocks
uit . Then, in the basic supply and demand model of Section 2.1, the asymptotic variance of the
            e                    2                  e               2            [ t]
                                                                              2 E y2
estimator T   in (12), which is    = limT !1 T var (T ), satisfies    ( ) = E["
                                                                              y y ]2
                                                                                      . The value
                                                                                  St   t




                                    ~=S   ~               ~    (V u ) 1 
                                          E,              E :=              ,                  (16)
                                                               0 ( V u ) 1 

gives the optimal GIV estimator, in the sense that for any other that is not collinear to ~ , the
asymptotic variance    2                                                         ~i = 1 , and when
                         ( ) is larger. When the shocks are i.i.d., this implies E     N
                                               2
                                            1/ ui
                                     ~
they are uncorrelated, this implies Ei  := P                 ~
                                                 2 , so that E may be called the "precision-weighted
                                            j   1/   uj

quasi-equal" weights.

                                                          9
    Hence, the "essence" of the GIV is not to be "size-weighted minus value-weighted" idiosyncratic
shocks, but rather "size-weighted minus precision-weighted" (i.e. inverse-variance weighted when
shocks are uncorrelated) idiosyncratic shocks.7
    There are two more ways in which the GIV is optimal. First, it is the optimally-weighted
GMM estimator.8 This implies that other combinations of idiosyncratic shocks (besides weighing
by ) would not help the precision of the estimator. Second, one can show that it is the maximum
likelihood estimator, if we assume that all shocks are Gaussian (see Section E). Still, the optimality
formulation of Proposition 3 is the simplest to use in other contexts.

2.1.3    Time-varying size weights
                                                                                     P
Suppose that we have a time-varying size Si,t 1 , so that the demand increase is i Si,t 1 yit , with
                             
E uit (t , "t )0 (1, Si,t 1 ) = 0. Then everything goes through without problems, replacing Si by Si,t 1
                                                              P            1
throughout. The basic GIV becomes: zt = ySt 1 ,t yEt = i Si,t 1 N             yit .

2.1.4    Model with an enriched factor structure

An important extension is that the shocks might have a richer factor structure, with r factors, so
that instead of (3) we have:
                                            r
                                            X   f f
                                      yit =     i t + uit ,                                  (17)
                                                       f =1

or, in vector form:
                                                    y t =  t + u t ,                                                (18)

where  is a N  r matrix, and E [ut (t , "t )] = 0.
   Then, in order to construct a valid GIV we simply run a factor model ­ for example, via Principal
Component Analysis (PCA) ­ and, in essence, we extract the residuals uit to form the GIV. Calling
u
it the residuals from regression (17), we form the GIV as the share-weighted average idiosyncratic
shock:                                               X
                                       zt := S 0 u
                                                 t =   Si u
                                                          it .                                  (19)
                                                                   i

   Let us see more precisely what happens "inside the model" when we do that. Suppose that
we know the vectors (for example, they are country characteristics, or they have been estimated
by PCA, as we will detail later). Then, let Q be a N  N matrix projecting vectors onto a space
orthogonal to , so that Q = 0. Then, Qyt = Qut (to see that, premultiply (18) by Q). Hence,
   7
      The fact that one wants to precision-weight variables is of course well-appreciated from the literatures on Bayesian
inference and generalized least squares.
    8
      Any moment ET [(pt ySt ) (uit uEt )] = 0 is a valid GMM moment to identify . It is easy to check that the
first-order condition of the e cient GMM objective function involves size-weighting those moments, which is exactly
our GIV moment condition ET [(pt ySt ) (uSt uEt )] = 0.



                                                              10
via PCA, estimating t in (17) yields the transformed residuals u
                                                               t = Qut . Then, the GIV is formed
as:
                        zt := S 0 u
                                  t = S 0 Qyt = 0 yt = 0 ut ,    := Q0 S.                    (20)

   Then, zt is a valid instrument, since it is composed of idiosyncratic shocks, as zt = 0 ut . Since
pt ySt = "t and E [ut "t ] = 0, we have E [(pt ySt ) zt ] = 0, which is (10).9
   We now detail the value of the matrix Q ­ this is more advanced material and should be skipped
at the first reading. Let us say that we have estimated t in (18) by generalized least squares
with a weight matrix W of size N  N (one could use W = I , but typically it is optimal to take
W = c (V u ) 1 for c an arbitrary constant).10 To represent this, we define two useful matrices, R,W
and Q,W , with respective dimensions r  N and N  N :

                                                      1
                                 R,W := (0 W )            0 W,            Q,W := I       R,W .                               (21)

Roughly, Q is the projection on the space orthogonal to , and R is the projection on , with a
scalar product that depends on W .11
    Constructing the GIV as (20) generalizes our basic example (3) (when W = I ) and the het-
eroskedastic shock case of Section 2.1.2, with W = (V u ) 1 . Indeed, in that example with uniform
loadings we had  = , W = I , Q = I E      ~ 0 , where E
                                                      ~= W                
                                                              , hence E = N when W = I and E = E  ~
                                                         0 W 
defined in (16) when W = (V u ) 1 . So that u  it = uit uEt
                                                         ~ , and the GIV was: zt = u
                                                                                   St = uSt uEt  ~ .

We therefore had = Q0 S = S E.     ~ 12


2.2       A simple demand and supply example with feedback loops
A simple model We next enrich the previous example, and consider a simple supply and demand
example that features a "loop." Suppose that demand for some commodity (say, oil) is:

                                                               d
                                                  yit =            pt + t + uit ,                                            (24)
   9
     This shows that the GIV is valid and possible as long as := Q0 S 6= 0. This is a very mild assumption, as
discussed in Assumption 1. If were close to 0, that would be picked up by very large standard errors.
                                             e 2           2
  10
     This is, we estimated t by minte ky t t  kW with kxkW := x0 W x. W is assumed to be positive definite.
  11
     They have a number of good properties that we record here (dropping the superscripts for simplicity):

       Q = 0,   R = I,       Q0 W  = 0,     (I   Q) W     1
                                                              Q0 = 0,     (I   Q0 ) W Q = 0,   Q2 = 0,   RW    1
                                                                                                                   Q0 = 0.   (22)


  12                     2       2 0
    This implies that    z   =   u S QS   if the uit are homoskedastic. For instance, if         i   = (1, x
                                                                                                           i ) with x
                                                                                                                    E = 0, the
variance of the GIV is                                                 
                                                    2     2    2   2
                                                                 1 x S
                                                    z =   u  h          .                                                    (23)
                                                                 Nx2 E

This illustrates how controlling for more factors reduces the standard deviation of the GIV, hence (as in Proposition
2, which features a standard deviation of the estimator  = z       "
                                                                                      2
                                                                     ), especially if x S is large and N is small. An
advantage of having lots of small firms (large N ) is that they make the estimation of the common shocks t easier,
                                                                           2                                       2
                                                                                                                 1 x
and hence increase the precision of the GIV estimator (that is, increase z   by shrinking the last term in (23), N 2
                                                                                                                   x
                                                                                                                     S
                                                                                                                       ).
                                                                                                                              E




                                                                    11
and supply is
                                                             s
                                                   st =          p t + "t ,                                     (25)

where t , "t can be correlated. We can expect that the demand and supply elasticities (respectively
 d
   and s ) satisfy d < 0 < s . Again, to be more formal, yit , st , and pt are understood as percent
deviations from the average demand of country i, from supply, and from price, respectively.13 , 14
   In equilibrium, supply equals demand, ySt = st , which gives the price

                                                        uSt + t              "t
                                                 pt =        s           d
                                                                                  .                             (26)

There is a "loop" because the demand shocks t and uit feed into the price pt , which then in turns
aects demand. The equilibrium quantity produced is
                                                        s                s                 d
                                                            uSt +            t                 "t
                                          st = ySt =                s            d
                                                                                                    .           (27)

The classic problem of estimating supply and demand equilibrium quantity st and price pt is that
we cannot regress: st = pt + "t , and hope to get = s , as "t and pt are correlated.
   However, suppose that we form the GIV, as in (5):

                                                  zt := ySt             yEt .                                   (28)

Given that
                                      d                                               d
                             ySt =        pt + t + uSt ,            yEt =                 pt + t + uEt ,

we have:
                                               zt = uSt          uEt =: u t .                                   (29)

As in the previous example, we assume that the shocks uit are idiosyncratic:

                                      E [uit t ] = E [uit "t ] = 0 for all i, t.                                (30)

Then, we have again a valid instrument:

                                     E [zt "t ] = E [zt t ] = 0 : Exogeneity,

                                             E [zt pt ] 6= 0 : Relevance.
                                                                                                           ¯
  13
     We take the model of Section 2.1, and simply set yit = d pt + t + uit , where pt = PtP   ¯
                                                                                                P
                                                                                                  is the proportional
deviation from the average.
  14
     For simplicity, we set all constant additive terms to 0. With non-zero such terms, one can talk about quantities
and prices, rather than their deviations from the mean.




                                                             12
    Estimations of supply and demand elasticities by GIV The supply equation (25) implies
E [(st   s
           pt ) zt ] = 0, which gives the supply elasticity s by

                                                                 s       E [ st z t ]
                                                                     =                .                                                                         (31)
                                                                         E [ pt z t ]
                                        1   P
                                                    s z
and the estimator is s,eT = 1
                              T Pt t t
                                           .
                              T   t p t zt
   Now, we want to estimate demand. For that, we make a stronger assumption: we assume that
the shocks uit are i.i.d. across i's and not just dates (we will relax this later). Then, this implies15

                                                              E [uEt u t ] = 0.                                                                                 (32)
                                                                                                                    
So, given this, we have: yEt                    d
                                                     pt = t + uEt , and E             yEt                  d
                                                                                                               pt zt = 0. This gives an estimate
of the demand elasticity d ,
                                                                d        E [yEt zt ]
                                                                     =                ,                                                                         (33)
                                                                         E [ pt z t ]
                                        1 P
                              d,e           t yEt zt
and the estimator is          T     =   T P
                                         1                .
                                         T   t p t zt



Estimation by OLS and interpreting it as a first- and second-stage IV estimator Let
us recast our GIV in the language of applied microeconomics, and estimate the parameters by
OLS (as we will often do in the general case). Much of this subsectionis very elementary, but for
completeness and future reference we spell it out. Recall that the solutions are:
                                                                                                           s
                                                1
                              pt =          s
                                                       u +"
                                                      d St
                                                           pt,            st = ySt =               s             d
                                                                                                                           s
                                                                                                                     uSt + " t,



          p
where the "   s
            t," t are linear combinations of "t , t . So, if we run the OLS regression, with zt = u t ,


                                                               p t = b p z t + "p
                                                                                t,                                                                              (34)

we estimate bp = s 1 d , which is the sensitivity of the price to the supply or demand shock. If we
run the OLS regression

                                                              ySt = byS zt + "s
                                                                              t,                                                                                (35)
                          s
we estimate byS = s d = M.
   In the language of applied microeconomics, one can view the "first stage" as a regression of the
                                                       P                             P                               P                      P
  15
    Indeed, in the i.i.d. case we have E [uEt u t ] = E ( i               1
                                                                          N uit )(        i   i uit )      =    1
                                                                                                                N        i
                                                                                                                               2
                                                                                                                             i u   = 0 as       i   i   = 0. Equation
(69) generalizes this to the non-i.i.d. case.




                                                                         13
price on the GIV (34), which yields the instrumented price

                                                        pe     p
                                                         t := b zt .                                                   (36)

The "second stage" regresses supply on the instrumented price:

                                                             s e
                                                     st =     pt   + "s
                                                                      t,                                               (37)

which gives s . Alternatively, one can run the "reduced form equation" (35), which estimates M.
                                         yS
The supply elasticity is given by: s = bbp  .
    The demand elasticity is similar. In the second stage we regress equal-weighted demand on the
instrumented change in the price, pet:


                                                    yEt =    d e
                                                              pt   + "y
                                                                      t,                                               (38)

which gives the demand elasticity d .16 Alternatively, we can estimate the reduced form equation
                                                                               yE
yEt = byE zt + "y
                t , which gives b
                                  yE
                                     = d M , and the demand elasticity is d = bbp .
    In practice, we will add controls to those regressions, including estimates of t recovered from
PCA. This improves the precision of the estimator, by absorbing some of the variance of the noise.
    From M and bp , we can recover the elasticities s and d . This is exactly the same estimate as
the IV estimator, derived earlier in (31) and (33).17

Standard errors: When "weak instruments" are or are not a problem When estimating
via OLS (e.g. bp and M ), the standard errors are reliably estimated by the usual OLS method,
even in small samples. When a ratio is implicitly performed (e.g. to estimate d , s ), the two stage
least square (2SLS) procedure as in (37) will also give correct standard errors when the instrument
is strong enough. A traditional rule of thumb for the strength of the instrument (in the i.i.d.,
homoskedastic case) is that the F statistics (which is the squared t-statistic on bp ) on the first
stage (34) should be greater than 10, and this advice is being progressively enhanced in current IV
research.18


2.3      Interpreting and diagnosing idiosyncratic shocks
What is an idiosyncratic shock? Mathematically, an idiosyncratic shock is plainly a random
variable uit such that Et 1 [~
                             t uit ] = 0, where ~t = (t , "t ) includes all the common shocks. But it
may be useful to discuss dierent types of economic settings that map into that definition.
  16
     Here we used (32), which makes the OLS valid.
                                          = ET                    E T [p t z t ]               e
                                                                                                 = E
  17                                    e      [ySt zt ]                                 s,e MT      T [ySt zt ]
     Indeed, the OLS estimators are MT       E T [z t
                                                    2]   and be
                                                              T = E T [z t 2 ] . We have T = be    ET [pt zt ] , which is the
                                                                                              T
same as (31), as st = ySt in equilibrium.
  18
     See the literature on weak instruments, such as Stock and Yogo (2005) and Andrews et al. (2019).


                                                             14
      In some cases it is quite clear ­ for example, a random productivity shock, or demand shock. But
there are more subtle types of idiosyncratic shocks. One is an "unexpected change in the loading on
a common shock". For instance, suppose that OPEC decided to cut down production, which in the
language of our example is an aggregate t shock. If Saudi Arabia cuts down production by more
than anticipated, that is an idiosyncratic shock. Formally, if supply is yit = s pt + i +  it t + vit ,
                           
with Et 1 (1,      ~t )  it = 0, then uit =  it t + vit is a bona fide idiosyncratic shock. To take another
example, suppose that we hear about a change in real estate prices in the economy, t , but that a
bank i was more exposed to it than anticipated: the market thought the bank's equity would move
                                                                                                             
by i t , but it moved by rit = i +  it t for an expectational surprise  it with Et 1 (1,             ~t )  it = 0.
Then, the bank will have an idiosyncratic shock uit =  it t as part of its total return rit .
      Likewise suppose that the news is that a bank failed a stress test (while it was anticipated it
would pass the test). This is an idiosyncratic shock. However, the bank could have failed the test
because of some development in the macroeconomy t . Then, provided that the factor model allows
for a rich enough structure in t , the latter will be controlled for.
      The volatility of idiosyncratic shocks can depend on the common shocks. Suppose that uit =
  t vit where t and t could be correlated (for instance, t could increase when |t | is high), but
Et 1 [~ t t vit ] = 0 (a su cient condition is that vit independent of t     ~t ); then, uit is an idiosyncratic
shock in the sense that Et 1 [~     t uit ] = 0.

Thresholded and narrative GIVs In applications, it is possible to make further progress by
assessing the drivers of the top shocks narratively. One procedure is to simply select the top K
shocks by Si |uit | (where u
                           it is the residual from factor analysis, e.g. u
                                                                         it = uit uEt , and we select
across all actors i and dates t), and check in the news what happened on that day (and check that
the shocks are idiosyncratic indeed). We do that for some our applications. Formally, that means
that we formulate a "thresholded" GIV,
                                                        X
                                                  
                                                 zt =         ( Si u
                                                                   it ) ,                                    (39)
                                                         i


using the thresholding function  (x) = x1|x| b , which only keeps granular shocks bigger than b > 0.19
Then, the GIV procedure works using that "thresholded" GIV (see Section D.5). This thresholded
GIV might also be useful to assess non-linear eects, for instance, in case of demand or supply
curves.
   After examining those largest shocks by looking at the news, some shocks might be eliminated as
not idiosyncratic; we can call ItN the set of shocks that are "narratively certified" to be idiosyncratic
  19
       We adjust b to select a pre-specified expected number K of shocks that survive the thresholding.




                                                             15
by this procedure, and form the alternative instrument
                                                               X
                                                       N
                                                      zt =              Si u
                                                                           it .                                                     (40)
                                                                    N
                                                               i 2I t


    This is roughly what the "narrative" approach in the literature (e.g. Caldara et al. (2018)) does.
But the GIV procedure does help researchers even in the narrative context, since it automates the
"pre-selection" of the top K (perhaps K = 15) shocks, by selecting the events with the largest K
values in Si |u
              it |. Hence, researchers don't need to know the whole history before selecting their
main events ­ the GIV gives them the most promising candidate events, and the detailed historical
search is simply restricted to K events. In addition, the factor analysis in the GIV gives controls
 e
t  that are usable when running regressions, which increases the precision of estimators.


2.4      Over-identification test with multiple GIVs
Consider the model of demand with a single factor with heterogenous exposures

                                                          d
                                                 yit =        pt +      i t   + uit ,

                                                           e
and assume we obtained an estimate of the factor, t          . We abstract from estimation error in the
factor in this section.
    It is easy to get overidentifying tests with GIVs, because each u     eit is potentially a valid instru-
ment. One way to do that is to construct two dierent GIV instruments, z1t and z2t . These could
include size-weighted averages of all ue                                                 e
                                        it , a subset of the largest realizations of Si |u it |, or a subset of
narratively-checked shocks as in Section 2.3. Alternatively, z1t (respectively z2t ) could be the size-
weighted sum of the shocks to odd-numbered (respectively even-numbered) entities, or z1t might be
based on idiosyncratic supply shocks and z2t on idiosyncratic demand shocks, as in Section D.4.20
    Suppose we have constructed these two dierent GIV instruments, z1t and z2t . One can then
estimate separately the parameters of interest (e.g. d ) based on z1t and z2t , and see if they are
economically dierent. We can also do a formal test.21 In Gabaix and Koijen (2020), we provide an
example of such a procedure. There, the goal is to estimate the elasticity of the aggregate equity
demand curve using investor-level equity holdings data. After extracting the idiosyncratic shocks,
we form two instruments. We rank investors by size in each period, and form an instrument based
  20
      Yet another GIV procedure is to use characteristics xit measurable
                                                                      P at time            t 1 (e.g., firm size, or GDP per
                                                                 x :=            e
capita, or a bank's credit risk), and form the x-weighted GIV: zt        i S i u
                                                                                 it x it .   If the test fails, it's probably the
case that xit is economically important and it should have been included as a factor loading in a larger factor model.
                                                                                                                     e 0
   21
      We form the moment conditions as E [gt ()] = 0, where gt () = yEt                   d
                                                                                            pt         e
                                                                                                    E t (z1t , z2t , t ) and  =
   d
( , E ). We can simply perform the Sargan-Hansen J test for over-identifying moment conditions. The test statistic
                                                                       P                      1
                      0                                                1       T           0
is given by J = T gt    WT gt !d 2  1 , under the null, where WT =     T       t=1 gt gt          . If we have K instruments
                                                                                        d          e                       0e
zkt , k = 1 . . . K , then the procedure is the same, with gt () = yEt                      pt   E t   (z1t , . . . , zKt , t ) , and then
J !d 2  K 1.



                                                                16
on the odd and even ranks. We show that the point estimates using either instrument are not
significantly dierent and that the two instruments are uncorrelated.22


2.5       Heterogeneous demand elasticities
We consider a generalization of the basic model to allow for heterogeneity in demand elasticities.
We start from
                                     yit = di pt + i t + uit ,                               (41)

while the supply curve is the same as in (25).
   We consider the parametric version of the model (Section D.2 of the online appendix considers
a non-parametric version, which is more complex). We suppose that the loadings are linear in the
characteristics Xit (a k -dimensional vector, with k in practice a small number, and the first entry
being a 1), so they can be expressed as:

                                                                    k
                                                                    X
                                                  d
                                                  i    = Xit  d =         Xi`t  d
                                                                                `
                                                                    `=1

                    
for some  d =      d
                     `     to be determined. With X the N  k matrix of characteristics, this is
                         `=1...k
saying that we assume the parametric forms d = X  d and = X  where  d and  have dimension
k  1 and k  r, recalling that t has dimension r  1. We want to evaluate s and  d . Here is how
we proceed.
    For each date t we run the cross-sectional regression of yit on Xit (potentially the generalized
least squares regression with weights W to be discussed soon):23

                                                                    k
                                                                    X
                                           yit = Xit y
                                                     t + u
                                                         it =             Xi`t y
                                                                                `t + u
                                                                                     it ,                         (42)
                                                                    `=1


and we get regression slopes y
                              t = (y
                                    `t )`=1...k , then collect the residuals u
                                                                             it . We next form the GIV
      P                                             s       d
zt :=   i Si u
             it as in (20). We then identify          and     instrumenting pt by zt , i.e. using the IV
          24
moments:

                                         E [(s     s
                                                     pt ) zt ] = 0,                                               (43)
                                        h t            i
                                       E y  `t    d pt z t = 0               for ` = 1 . . . k.                   (44)
                                                  `


                                   s
       The identification of           is valid for any weight matrix W (including the identity matrix, as in
  22
     If there are missing common factors, then the instruments are likely correlated. This procedure therefore provides
an additional way to check   Pfor omitted common factors.
  23
     That is, we use miny  t   i,j (yit Xit y
                                             t ) Wij (yjt Xjt y
                                                               t ) to identify y
                                                                                t at each date.
  24
     Alternatively, we can use the first stage and second stage language of Section 2.2. In practice, to increase
precision, we add controls to those regressions, including the estimates of t recovered from PCA.


                                                              17
OLS) and that of  d is valid if we have the "inverse variance" weights W = c (V u ) 1 for some
constant c.25 Section C.4 gives the derivations, and discusses how to estimate W if necessary.


2.6      Robustness to misspecification and threats to identification
The GIV procedure is robust to some forms of misspecification, and more fragile to others.

Robustness of the GIV We may keep only the shocks to some actors (in a set It ), i.e. set
       P
                 e
z t = i 2 I t Si u          e
                   it (with u it = uit uEt ), selecting for example the shocks to the top K entities, the
shocks for which we have data, or some subset of the entities based on size. Then again, everything
goes through.26 The estimator is still valid, just not the optimal GIV estimator.
     The GIV also works if we have information only on some of the large actors (such as countries
or firms): one uses the idiosyncratic shocks of those actors for which we have data.
                                                                                        P
     Suppose that we misspecify the vector S of sizes, for example by defining zt = i Si u     eit using a
wrong vector S . Then, the IV is still valid, but the OLS can be biased. In our basic example of
Section 2.1, we still have E [(pt ySt ) zt ] = 0, so that the IV procedure (11) still works. Likewise,
in the more complex supply and demand case, the IV relations (31) and (33) still hold. But the
OLS relations are slightly biased.27
     If we assume homogeneous coe cients (e.g. on the elasticities of demand or supply), while in
fact they are truly heterogeneous, then again (assuming that t was well-estimated in the cross-
section) the IV estimates are correct, and so are the OLS estimates, except that we obtain the
equal-weighted averages of coe cients. For instance, the IV estimates yield s , d        E , and the OLS
coe cients are those corresponding to the interpretation that the elasticity of demand is d       E rather
        d
that S . Section D.6 provides the derivations.
     If we misspecify   the variance of the uit (but keeping them uncorrelated), things are essentially
fine: as uE = Op pN , we do not need E [u t uEt ] = 0 to hold exactly, as the term E [u t uEt ] will
                         1
                                 
still be small, of order O p1N , and will vanish for large N .

Threats to identification The threat to identification is that we might not control properly for
                                             e e
common factors. Indeed, zt = u t + t          t , so there is a danger that, even after controlling for
 e                                                                 e e
t in the regression we will not completely eliminate the t          t error.28 This danger is greater
when | | is greater, i.e. when loadings are correlated with size (indeed, we are safe if   = 0). This
  25
     If we take W as the identity rather than the "ideal" W above, the error is typically quite moderate: for instance,
                                      1
with X = , it is only of order N        .
  26
     For instance, we still have uSt = zt + "u    t
                                                    S
                                                      with zt ? "u
                                                                 t . Section D.5 gives for a formal analysis.
                                                                   S

  27               E [ z  u   ]
     Calling    = E[     t St
                           2]
                          zt
                                (which is 1 when S = S ), then the OLS above gives (in population) bp,e = bp and
  e
M = M . For some selection procedures (e.g. selecting the shocks to some pre-specified entities as we discussed),
we still have that = 1, so that OLS is still valid.
  28                            e                                                               e e                      e
     As we do control for t       in the regression, the bias is due to the residual of t        t after controlling for t .



                                                            18
is a small sample problem (with a large enough T, N we measure t , accurately). Fortunately,
there are at least four approaches to handle this concern.
    A first check, which we recommend, it to perform the over-identification test of Section 2.4,
based on some meaningful alternative GIVs zt , for example based on the shocks to some top actors,
or their even-odd ranking (as we do in Gabaix and Koijen (2020)).
    Second, one can perform a formal test for the number of factors (Bai and Ng (2002); Onatski
(2009)), as we illustrate in Section 5. A missing factor may also be detected by testing the stability
of estimates across GIVs: as is common practice in the weak factors literature, one can verify the
stability of the estimates by adding one or two factors beyond what is recommended by formal tests
for the number of factors.29
    A third approach is to opt for the narrative GIV of Section 2.3, and as we do in our empirical
applications below. If one checks the top, say, 15 events and they pass the narrative check, one can
record that we could not reject the hypothesis of a misspecified factor model. In a more purist way,
one could even restrict the GIV to those top events.
    A fourth approach is to filter out "sporadic factors," i.e. a factor t that aects a few actors
special ways, but happens once in the sample, so is hard to detect with standard factor models.
Then, one removes the dates with such sporadic factors, after identifying them via a narrative check,
or via statistical methods as discussed in Section D.7. Section 6.6 provides an illustration of this.


3       General setup and multipliers
The previous section introduced the GIV in a simple context, with no loops or a single loop. We
now propose a more general setup with potentially several factors, arbitrary loop structure, and
rich heterogeneity. This section can be skipped when reading the paper for the first time and the
reader can continue with Section 4.


3.1       Framework
Consider the following model of stationary "actions" yit (such as employment, investment, TFP
shocks, returns, and so on) by "actor" i (e.g., a firm or industry i in a closed-economy setting, or a
country i in an international setting):
                                                 X   f f              y
                                         yit =       it Ft   + uit + Cit m,                          (45)
                                                 f


where each Ftf is a factor, f                                                            y
                            it are factor loadings, uit is an idiosyncratic shocks, and Cit is a vector of
controls that may include lagged demands and other characteristics. We could also add constants,
 29
      We do that in Section 5 and in Gabaix and Koijen (2020).



                                                        19
but we omit them for notational simplicity. Factor f follows:

                                              Ftf = f ySt + t
                                                            f
                                                              + Ctf mf .                                (46)

                                        f
It depends on an exogenous shock t        , and potentially on the mean action ySt , and on a set of controls
  f                                   y
Ct (potentially dierent from Cit ). Those controls may include, for instance, lagged values. We
                                                                            P
assume that the "size" weights have been normalized to add to one, i Si = 1.
    We use the structure (45)-(46) because many economic models of interest follow this structure,
at least after linearization, so that the GIV allows to estimate some of their parameters.
    We partition the factors into "exogenous factors", where we know f = 0, and "endogenous"
factors where f may be non-zero. As in the rest of the paper, we make the mild assumption that
                          f
all our variables (e.g. t   , ut ) have finite second moments
    In the baseline case here we study the parametric case. We have some characteristics xit of
actors: for instance, depending on the application we know that the loading is an a ne function of
log market capitalization, or the stock market beta of a bank, or OPEC membership. We also have
a priori knowledge that for some parameter  f to be estimated we have:

                                                     f
                                                     it   = f  f f
                                                            0 + 1 xit ,                                 (47)

This is consistent with the practice in modern finance in which risk exposures (betas) align with
characteristics (see e.g. Fama and French (1993)), so that parametric approaches are preferred, in
particular because they are more stable than non-parametric approaches.
   We make the following identifying assumptions. For all f , i, the shocks uit are idiosyncratic:
                                             h                       i
                                                  f
                                            E uit t , Cty , Ctf , xf
                                                                   t   = 0,                             (48)

         f                                     f
but the t  may be correlated across f 's, and t  may be correlated with the controls, Cty and CtF .
The uit may have some correlation across i's and can be heteroskedastic, as we discuss later. For
expositional simplicity we assume that all dates are i.i.d.
   We rewrite model (45) in vector form:

                             yt = t Ft + ut + Cty m,           Ftf = f ySt + t
                                                                             f
                                                                               + Ctf mf ,               (49)

with t a N  r matrix, Ft a r  1 vector, Cty an N  c matrix, m is c  1, where c is the dimension
of the controls.30
  30
       Our initial examples are particular cases of the general procedure.




                                                             20
3.2     Multipliers
                                              y
Solving the model gives ySt = St Ft + uSt + CSt  m, that is, ySt = St ySt + uSt + "yt , where  is the
                         f    y           y
vector stacking the  's and "t satisfies "t ? ut . So, we can solve for the aggregate outcome ySt as
      u +" y
ySt = 1 St
         St 
            t
              , that is,
                                        ySt = Mt (uSt + "yt),                                    (50)

where the multiplier Mt measures the total impact of shocks, after going through all feedback loops
(where we assume that the denominator is not 0):

                                                   1               1
                                       Mt =            =          P    f
                                                                               .                                 (51)
                                              1    St    1           f St 
                                                                           f



   Hence, an idiosyncratic shock has an impact on the aggregate action ySt that is Mt times bigger
than its direct eect. Also, the total impact of an idiosyncratic shock on factor f is:

                                              Ftf = Mt f uSt + "f
                                                                t,                                               (52)

where it again holds that "f t ? uSt . This shows intuitively, and we will prove formally below, that
our regressions will allow to identify Mt and Mt f .
   In some cases, we may not observe all endogenous factors, Ftf . In this case, we still recover
the correct multiplier, Mt , and it should be interpreted as accounting for all feedback loops in the
economy, including those operating via the unobservable, endogenous factors. However, we can
obviously not estimate f for those unobserved factors.


3.3     A formal identifiability result
We provide here formal conditions for identification, completing the simpler case of Section 2. We
study the parametric case. Section D.2 develops the full non-parametric version, estimating the
factors. We don't have a priori information about the t , nor their variance V  .

Assumption 1 (Condition for identification with GIV) The vector V u S is not spanned by the
factors loadings f (where V u is the covariance matrix of ut ).
                                                                                                 1
                                                                                        (V u )       ,
   Assumption 1 ensures that the GIV is not identically 0 (as zt := S 0 Qt         ut , as in (20) and
(21)). Economically, this assumption seems like a mild restriction. It is generically satisfied.31 , 32
   For simplicity, we shall make here a strong further Assumption 2, which can be relaxed.

  31
     One case that does prevent this assumption to hold is the case where the variance would be inversely proportional
to size: then, GIV would fail, as then V u S = a for some scalar a. Fortunately, in most contexts, variance may decay
a bit with size Si , but less violently than in 1/Si (see e.g. Lee et al. (1998) and the discussion in Gabaix (2011)).
  32
     This also suggest that to control for size, one wants to use log size, but not absolute size.



                                                         21
Assumption 2 (Known form of the variance matrix of the idiosyncratic shocks) The uit 's are
homoskedastic, or, more generally, the econometrician knows the matrix V u up to a proportionality
factor. In addition, V u is invertible.

   Though this would be easy to relax, we assume that all shocks are i.i.d. over time, that St is
constant,
            so that Mt is    constant. We assume that second moments are finite for all random variables
           f    y     f
 t , uit , t , Cit , Ct , xit .
   We next state a formal identification result, which is proven in Section C.5.

Proposition 4 (Su cient condition for identification with GIV) Consider the factor model above,
when N is fixed but T ! 1, and make Assumption 1 and 2. We assume the parametric case, where
we know the actor (e.g., firm or country) characteristics Xit . Then, we can identify f and M by
GIV. Furthermore, the standard errors on M and f M returned by OLS (using the GIV) in this
procedure are valid.

    It may seem a bit surprising that the OLS standard errors are correct. The reason is that
                                                                (V u ) 1 , 
the GIV is directly obtained from an exact formula (zt := S 0 Qt            yt as in (20)), hence has no
estimation error. The standard errors are made explicit in the proof of Proposition 4.
    Proposition 4 shows identification in the case with parametric factors. We conjecture that it
also holds for the case of non-parametric factors. As a partial substitute, we provide numerical
simulations that support the view that the procedure also works in the latter case. But given the
complexity of that case, we defer it to future research as one of the several interesting extensions
of the GIV.


4     A user's guide
We summarize the above arguments in the form of a user's guide. The arguments in this section
extend to multiple factors, as illustrated in Section 3.


4.1    User's guide: basics
The model can be summarized by

                                         d          y
                                 yit =       pt + mCit + ai +    it t   + uit ,                    (53)
                                 pt = ySt +      mp Ctp   +b+   p
                                                                t ,                                (54)

        y
where Cit and Ctp are observable controls, which we assume to be scalar for notational conve-
nience but the arguments directly extend to vectors of controls. We also assume that shocks are
homoskedastic and discuss the extension to heteroskedastic shocks below. In outlining the basic



                                                     22
algorithm, we consider the possibility that we have additional information on factor loadings, xit ,
so that it = 0 + 1 xit for some factors, although this information is not required.
    In describing the procedure, we refer to generic agent fixed eects as ai and generic time fixed
eects as bt . The basic algorithm is summarized by:

   1. Panel regression: We estimate a panel regression with agent and time fixed eects,

                                                                 y
                                               yit = ai + bt + mCit +y
                                                                     it .

                                                  e
         We refer to the estimated residuals as y
                                                it  .

   2. Factor estimation: If information on factor loadings is available, we estimate a first set of
      factors using period-by-period cross-sectional regressions,

                                                       e            x
                                                     y
                                                     it  = bt + xit t + eit ,

                                                    x,e
         and we refer to the estimated factors as t     . In addition, we estimate nonparametric factors
                           e                                            P CA,e 33
         using PCA on y  it and refer
                                       to the  estimated factors as t         .   We stack the estimated
                             e      x,e P CA,e
         factors together in t = t , t           .
                                                                                                   1
   3. Multiplier estimation using OLS: We form Zt = y t and estimate M =                         1     d   and M using
      OLS,
                                                   y Cy
                                 ySt = Zt + y t
                                              e
                                                + CSt   + aS + M " y
                                                                   t,

                                                                           Cp
                                        pt = M Zt +          p e
                                                              t    + Ctp           + b + "p
                                                                                          t.

         The OLS standard errors on M and M are correct in case we only have parametric factors
         (see Proposition 4). In the case of nonparametric factors, the simulation results in Section 5
         suggest that OLS standard errors remain reliable as well.

   4. Elasticity estimation using instrumental variables: We estimate the elasticity  using instru-
      mental variables, where we use Zt as an instrument for ySt in (53). To estimate d , we consider
      the regression
                                                   y
                                 yEt = d pt + mCEt   + Et te
                                                             + aE + uEt ,                        (55)
                                                                                     p
  33
       In case of principal components, we estimate  , t using (with kak =               a0 a)

                                                      1 X e          t     2
                                             min          y
                                                          t                    ,
                                               , t   NT t

                              1 0 
subject to the normalization N      = I . The asymptotic theory for principal components analysis has been developed
in Bai (2003) and relies on N, T ! 1. Alternatively, one can rely on factor analysis in which N is finite and T ! 1,
and the asymptotic theory is developed in Anderson and Amemiya (1988) under a wide class of distributional
assumptions on the error terms and the factors. A variety of algorithms have been developed to extract latent
factors in the presence of missing data.


                                                            23
      and we use Zt as an instrument for pt . In case of elasticity estimates, standard weak instrument
      concerns are relevant (Stock and Yogo (2005); Montiel Olea and Pflueger (2013); Andrews et
      al. (2019)).

After estimating the parameters of interest using GIV, we recommend exploring the specification
tests in Section 2.6 to ensure that the procedure properly isolates idiosyncratic shocks. Depending
on the data available, one can for instance perform a narrative check, an over-identifying restrictions
test or explore the stability the estimates when adding additional factors.


4.2    User's guide: extensions
Heteroskedasticity If there is heteroskedasticity, we compute
                                                           2
                                            ~i = P¯i
                                            E                   2,
                                                       j   ¯j

          2    2
where i     = i  (yit ) and ¯i = max ( i , median ( j )), where  2 [0, 1]. The adjustment using the
max operator and the median ensures that very volatile entities do not distort the equal-weighted
average, while not putting too large of a weight on entities with very low volatilities. When there
is little dispersion, we do not adjust the inverse variance weights if  < 1, say,  = 0.75. In the
presence of heteroskedasticity, we use E   ~i in computing cross-sectional averages or in computing
cross-sectional regressions, which improves e ciency.

Robustness to large idiosyncratic shocks In case there are large idiosyncratic shocks, which
is generally helpful in the context of GIV, this may influence the estimates of common factors,
including the equal-weighted average. One approach is to adjust for heteroskedasticity, as discussed
above. Alternatively, we can winsorize the data for the purposes of computing averages and factors.
This extension is particularly relevant when the cross-section is small. If we denote the winsorized
          w                                                     w
data by yit , then in steps 1 and 2 of the user guide, we use yit . In computing Zt , we form Zt =
       w                      w
ySt yEt . In step 4, we use yEt in (55) as well.

Autocorrelated shocks We have assumed that the idiosyncratic shocks uit are i.i.d. It is easy
to form the GIV more generally: one replaces uit by u ~it := uit Et 1 [uit ]. For instance, suppose
that the uit follow an autocorrelated process, uit = ui,t 1 + u
                                                              ~it , where u
                                                                          ~it is i.i.d. Then, we form
the GIV based on the innovations u ~it .

Heterogeneous demands elasticities When demand elasticities are heterogeneous, we apply
the procedure outlined in Section 2.5.




                                                  24
At what level should one aggregate the data? What's the impact of having aggregate
data? Suppose that firm i in industry k has an action (e.g. demand for oil in our basic example)
yikt = i t + ukt + uikt where ukt is a industry-level common shock, and ukit is a firm-level shock.
                                                                    P                    P
Then, aggregating at the industry k level with weights Sik (with i2k Sik = 1), ykt = i2k Sik yikt =
  k
                               P                          P
    t + ukt + uk,S k t with k = i2k Sik i and uk,S k t = i2k Sik uikt . So, the idiosyncratic industry
level shock is vkt = ukt + uk,S k t : it is the sum of the primitive industry-level shock ukt and the
sum of idiosyncratic firm-level shocks in industry k , uk,S k t . In general, it is of course better to
have disaggregated data, in part because a higher number of units N makes it easier to identify
the common shock t , which leads to a higher-precision GIV (as we saw in our discussion of (23)).
However, when the number of industries is large enough, there is little harm in having industry-level
aggregation, as the marginal impact of having more industries is small.


5     Simulations
We use simulations to illustrate the precision of granularly identified parameters depending on the
size of the sample (both N and T ), the degree of concentration, and the volatility of idiosyncratic
shocks relative to aggregate shocks. Also, we show that PCA can be used to remove common factors
and to estimate the idiosyncratic shocks.


5.1     Model
                                    s                 d
We start from the standard supply, yit , and demand, yt , model

                                     s      s                              d     d
                                    yit =       pt +   i t   + uit ,      yt =       p t + t ,
                                                                                                                  d
where   d
            <0<    s
                       and E [t uit ] = E [t uit ] = E [t t ] = 0. The model implies, with M =                s       d   ,

                         M                                      s
                  pt =       d
                                 (uSt +   S t     t ) ,        ySt = M uSt + M         S t   + (1   M ) t .


5.2     Estimators and standard errors
                        M
To estimate M and        d   , we can use standard OLS. To estimate M , we use

                                             s
                                            ySt = a + M y t +  0 t
                                                                 e
                                                                   + et ,                                             (56)

                  M
and to estimate    d   , we use
                                                             M
                                            p t = ap +         d
                                                                           t + e p
                                                                         0 e
                                                                   y t + p       t.                                   (57)




                                                                   25
All standard OLS results apply if we observe the factors, t . However, we often do not directly
observe all factors. We consider the cases in which we know the factor loadings,          i , and where
the loadings are unobserved and estimated using PCA. To provide a point of reference, we also
consider the case where we do not control for factors and impose that  = p = 0. In all cases,
we report the OLS standard errors to assess to what extent the OLS standard errors need to be
                                       e
adjusted for the fact that we use t      instead of t . Note that we allow for a vector of estimated
           e
factors, t , as in practice we do not know the number of factors. To estimate the multiplier when
using PCA, we estimate the number of common factors using the procedure in Bai and Ng (2002)
by minimizing their ICp2 (k ) criterion, where k 1. Also, we consider the possibility where we add
factors extracted using principal components to factors extracted based on known loadings. The
main conclusion is that adding additional factors does not distort the estimates in our simulations,
while not properly controlling for factors can lead to biased estimates.
    To estimate the demand and supply elasticities, we can recover them from the estimates of M
and M d . However, as discussed before, this is equivalent to a 2SLS estimator using y t as instrument

for price, while controlling in this case for the factors. Hence, the first stage corresponds to

                                                             0 e
                                            pt = ap +  y t + p t + e t ,

                                                                                  0 e
                                                                ^t = ae
and the second stage to estimate the demand elasticity is, with p         e
                                                                      p +  y t +  p t ,

                                            d            d        0 e
                                           yt = ad +         p
                                                             ^t + d t + e d
                                                                          t,


and for the supply elasticity
                                            s            s        0 e
                                           yEt = as +        p
                                                             ^t + s t + e s
                                                                          t.

The standard weak instrument tests can be used to assess whether y t is a su ciently strong
instrument for price (Section 2.2). In this case, we report the 2SLS standard errors to assess
whether their accuracy is impacted by the fact that we estimate the common factors.


5.3       Calibration
In calibrating the model, we target (i) concentration, as measured by the excess Herfindahl, h =
pP
        2
     i Si   1/N , and (ii) the ratio of the volatility of idiosyncratic shocks to the volatility of aggre-
gate supply shocks.
   We set the demand and supply elasticities to d = 0.3 and s = 0.1, respectively. The size
                                                P
weights are generated as ki = i 1/ , Si = ki / i ki , where  is chosen so that h 2 {0.2, 0.3}.34 For
the shocks, we assume t  N (0, 0.062 ) and t  N (0, 1). To construct the loadings, we first draw
¯ 2 RN from a uniform distribution, ¯  U (0, 1). We scale ¯ so that the standard deviation of
 34
      Here  is the power law exponent of the size distribution, see Gabaix (2009).



                                                         26
Table 1: Cases considered in simulations. We calibrate the supply-and-demand model in Section
5 under seven alternative parameterizations. The parameters are the following: N is the cross-
sectional sample size; T is the number of simulated i.i.d. time periods; h is the excess Herfindahl that
we target in our simulation of the size weights (as described in Section 5.3);  is the targeted ratio
of the volatility of idiosyncratic shocks to the volatility of aggregate supply shocks; the multipliers
           d
                    M                                    d
M=       s   d and   d are functions of the elasticities   and s of demand and supply with respect to
price. The final column reports the share of the price volatility that is due to idiosyncratic shocks
under each of the seven parameterizations.
                                                                    M
                         Case   N       T     h         M           d   % price vol. idiosyncratic
                         1      25     360    0.2   3   0.75    -2.5             12.6%
                         2      25     360    0.2   4   0.75    -2.5             20.4%
                         3      25     360    0.3   3   0.75    -2.5             19.1%
                         4      25     360    0.3   4   0.75    -2.5             29.5%
                         5      25     120    0.2   4   0.75    -2.5             20.4%
                         6      50     120    0.2   4   0.75    -2.5             16.1%
                         7      50     360    0.2   4   0.75    -2.5             16.1%

                                                                                .03 ¯
the aggregate supply shock equals 3%, V ( S t ) = 2            2
                                                       S = 0.03 , that is,  = 0¯ S
                                                                                      . We consider two
                                                                 35
cases, namely where Corr ( , S ) = 0 and Corr ( , S ) = 20%. Lastly, we set u = S  = 0.03 to
target the ratio  of idiosyncratic shock volatility to aggregate shock volatility. We vary  2 {3, 4} ,
N 2 {25, 50}, and T 2 {120, 360}.
   The cases considered are summarized in Table 1. The final column reports the fraction of price
volatility that is due to idiosyncratic shocks, which ranges approximately from 10% to 30%, in line
with the recent literature on granularity that estimates the fraction of aggregate fluctuations that
can be traced back to idiosyncratic shocks.


5.4        Simulation results
The simulation results when Corr ( , S ) = 0 are reported in Table 2. We consider four estimators.
In the case of M1, we assume that the loadings are known in estimating the factors; this is an ideal
case taken as a benchmark. In the case of M2, we use PCA to estimate the factors. In the case of
M3, we control for the factors estimated using the known loadings and PCA. This case is helpful
to see whether there is harm in the simulation from controlling for too many factors. In the case of
M4, we use no factors and just use y s t without any factors. Note that we do not advocate M4 in
practice: M4 simply shows that the GIV estimator can be biased if we do not properly control for
  35
    Formally, we start from ¯  U (0, 1).
                                       We
                                                                            ¯           ¯      ¯
                                             then estimate the regression = aN + b S S + e and find b such
that ~ = aN + bS + e satisfies Corr ~ , S = , the target correlation. This correlation equals  = (bV            (S )
                                                                                                              S) (~)
                                                                                                                      =
                                                         q
                                                              2
    p bV (S )
                , which provides the solution b = Sign () 1  2 V V ( e)                 ~ to obtain the right volatility
 (S )  2b V (S )+V (e)                                             (S ) . We then scale
                                     0.03 ~
of aggregate supply shocks,     =     ¯S .



                                                               27
    Table 2: Simulation results when Corr ( , S ) = 0 based on 10,000 replications. The parameters
    used in the dierent cases are summarized in Table 1. In particular, the data are generated from
    a model in which M = 0.75, M     d =   2.5, d = 0.3, and s = 0.1. GIV estimators M1,..., M4 are
    described at the beginning of Section 5.4. For each estimator, we report the median, the mean, and
    percentiles 2.5% (P2.5) and 97.5% (P97.5) in the simulated distribution of estimates. "Coverage" is
    the fraction of estimates falling within the 95% confidence intervals constructed using OLS standard
    errors (columns 1 through 8) or the 2SLS standard errors (columns 9 through 16).

                                                                    M                                   d                                 s
                                  M                                 d

Case    Statistic   M1     M2         M3     M4      M1      M2          M3      M4      M1      M2          M3      M4     M1     M2         M3     M4
        Median      0.75   0.75       0.75   0.75   -2.50   -2.50       -2.50   -2.49   -0.30   -0.30       -0.30   -0.30   0.10   0.10       0.10   0.10
        Mean        0.75   0.75       0.75   0.75   -2.50   -2.50       -2.50   -2.50   -0.33   -0.34       -0.32   -0.34   0.11   0.12       0.11   0.11
1       P2.5        0.53   0.49       0.52   0.51   -3.81   -3.90       -3.86   -3.83   -0.65   -0.67       -0.67   -0.65   0.01   0.00       0.00   0.00
        P97.5       0.98   1.01       0.99   0.99   -1.20   -1.11       -1.15   -1.17   -0.17   -0.17       -0.17   -0.17   0.27   0.32       0.28   0.30
        Coverage    0.95   0.93       0.95   0.95    0.95    0.94        0.95    0.95    0.93    0.93        0.93    0.93   0.96   0.94       0.95   0.96

        Median      0.75   0.75       0.75   0.75   -2.51   -2.50       -2.51   -2.51   -0.30   -0.30       -0.30   -0.30   0.10   0.10       0.10   0.10
        Mean        0.75   0.75       0.75   0.75   -2.51   -2.51       -2.51   -2.51   -0.31   -0.31       -0.32   -0.31   0.10   0.11       0.10   0.10
2       P2.5        0.60   0.56       0.59   0.58   -3.48   -3.54       -3.50   -3.52   -0.52   -0.52       -0.53   -0.52   0.04   0.02       0.04   0.03
        P97.5       0.90   0.94       0.90   0.92   -1.54   -1.47       -1.51   -1.49   -0.20   -0.19       -0.19   -0.19   0.19   0.22       0.19   0.21
        Coverage    0.95   0.90       0.95   0.95    0.95    0.93        0.95    0.95    0.94    0.94        0.94    0.94   0.96   0.91       0.96   0.95

        Median      0.75   0.75       0.75   0.75   -2.51   -2.50       -2.51   -2.51   -0.30   -0.30       -0.30   -0.30   0.10   0.10       0.10   0.10
        Mean        0.75   0.75       0.75   0.75   -2.51   -2.51       -2.51   -2.51   -0.31   -0.31       -0.31   -0.31   0.10   0.10       0.10   0.10
3       P2.5        0.62   0.59       0.62   0.61   -3.27   -3.34       -3.29   -3.29   -0.44   -0.45       -0.45   -0.44   0.05   0.03       0.04   0.04
        P97.5       0.88   0.92       0.88   0.89   -1.74   -1.68       -1.72   -1.72   -0.22   -0.22       -0.21   -0.22   0.17   0.21       0.18   0.18
        Coverage    0.95   0.90       0.95   0.95    0.94    0.93        0.95    0.94    0.94    0.94        0.95    0.95   0.95   0.90       0.95   0.95

        Median      0.75   0.75       0.75   0.75   -2.50   -2.50       -2.50   -2.51   -0.30   -0.30       -0.30   -0.30   0.10   0.10       0.10   0.10
        Mean        0.75   0.75       0.75   0.75   -2.51   -2.50       -2.51   -2.51   -0.31   -0.31       -0.31   -0.31   0.10   0.10       0.10   0.10
4       P2.5        0.65   0.63       0.65   0.64   -3.15   -3.18       -3.17   -3.18   -0.42   -0.42       -0.42   -0.42   0.06   0.05       0.06   0.05
        P97.5       0.85   0.87       0.85   0.87   -1.86   -1.81       -1.84   -1.84   -0.22   -0.22       -0.22   -0.22   0.15   0.17       0.15   0.16
        Coverage    0.95   0.90       0.95   0.95    0.94    0.93        0.95    0.95    0.95    0.95        0.95    0.95   0.95   0.89       0.95   0.95

        Median      0.75   0.75       0.75   0.75   -2.51   -2.50       -2.50   -2.50   -0.30   -0.30       -0.30   -0.30   0.10   0.10       0.10   0.10
        Mean        0.75   0.75       0.75   0.75   -2.50   -2.50       -2.50   -2.50   -0.30   -0.30       -0.30   -0.30   0.10   0.10       0.10   0.10
5       P2.5        0.66   0.64       0.66   0.66   -3.01   -3.05       -3.02   -3.02   -0.38   -0.38       -0.39   -0.38   0.06   0.05       0.06   0.06
        P97.5       0.84   0.86       0.84   0.84   -1.99   -1.95       -1.99   -1.98   -0.24   -0.24       -0.24   -0.24   0.14   0.16       0.15   0.15
        Coverage    0.95   0.90       0.95   0.95    0.94    0.93        0.95    0.95    0.95    0.95        0.95    0.95   0.95   0.89       0.95   0.95

        Median      0.75   0.75       0.75   0.75   -2.50   -2.50       -2.50   -2.50   -0.30   -0.30       -0.30   -0.30   0.10   0.10       0.10   0.10
        Mean        0.75   0.75       0.75   0.75   -2.50   -2.49       -2.50   -2.50   -0.32   -0.33       -0.33   -0.33   0.11   0.11       0.11   0.11
6       P2.5        0.56   0.52       0.55   0.52   -3.71   -3.78       -3.74   -3.77   -0.64   -0.66       -0.65   -0.64   0.02   0.01       0.02   0.01
        P97.5       0.94   0.98       0.95   0.97   -1.24   -1.16       -1.24   -1.20   -0.17   -0.17       -0.17   -0.17   0.22   0.26       0.22   0.26
        Coverage    0.95   0.93       0.95   0.95    0.95    0.95        0.95    0.95    0.93    0.93        0.93    0.93   0.96   0.95       0.96   0.96

        Median      0.75   0.75       0.75   0.75   -2.50   -2.50       -2.50   -2.50   -0.30   -0.30       -0.30   -0.30   0.10   0.10       0.10   0.10
        Mean        0.75   0.75       0.75   0.75   -2.50   -2.50       -2.50   -2.50   -0.31   -0.31       -0.31   -0.31   0.10   0.10       0.10   0.10
7       P2.5        0.64   0.62       0.64   0.62   -3.21   -3.27       -3.23   -3.24   -0.44   -0.44       -0.45   -0.44   0.06   0.05       0.06   0.05
        P97.5       0.86   0.88       0.86   0.88   -1.78   -1.75       -1.77   -1.75   -0.22   -0.22       -0.22   -0.22   0.15   0.17       0.16   0.17
        Coverage    0.95   0.91       0.95   0.95    0.95    0.94        0.95    0.95    0.94    0.95        0.95    0.95   0.95   0.91       0.95   0.95




                                                                          28
    Table 3: Simulation results when Corr ( , S ) = 20% based on 10,000 replications. The parameters
    used in the dierent cases are summarized in Table 1. In particular, the data are generated from
    a model in which M = 0.75, M     d =   2.5, d = 0.3, and s = 0.1. GIV estimators M1,..., M4 are
    described at the beginning of Section 5.4. For each estimator, we report the median, the mean, and
    percentiles 2.5% (P2.5) and 97.5% (P97.5) in the simulated distribution of estimates. "Coverage" is
    the fraction of estimates falling within the 95% confidence intervals constructed using OLS standard
    errors (columns 1 through 8) or the 2SLS standard errors (columns 9 through 16).

                                                                    M                                   d                                 s
                                  M                                 d

Case    Statistic   M1     M2         M3     M4      M1      M2          M3      M4      M1      M2          M3      M4     M1     M2         M3     M4
        Median      0.75   0.69       0.75   0.56   -2.49   -2.29       -2.50   -1.85   -0.30   -0.30       -0.30   -0.30   0.10   0.13       0.10   0.24
        Mean        0.75   0.69       0.75   0.56   -2.50   -2.30       -2.50   -1.85   -0.33   -0.34       -0.33   -0.30   0.11   0.16       0.11   0.21
1       P2.5        0.52   0.41       0.51   0.29   -3.84   -3.72       -3.87   -3.23   -0.66   -0.74       -0.67   -0.97   0.01   0.01       0.00   0.07
        P97.5       0.98   0.97       0.99   0.82   -1.17   -0.88       -1.13   -0.50   -0.17   -0.16       -0.17   -0.14   0.28   0.47       0.29   0.96
        Coverage    0.95   0.88       0.95   0.67    0.95    0.93        0.95    0.84    0.93    0.93        0.93    0.92   0.96   0.97       0.95   1.00

        Median      0.75   0.74       0.75   0.42   -2.51   -2.46       -2.51   -1.38   -0.30   -0.30       -0.30   -0.30   0.10   0.11       0.10   0.42
        Mean        0.75   0.74       0.75   0.41   -2.51   -2.47       -2.51   -1.39   -0.31   -0.32       -0.32    0.00   0.10   0.11       0.10   -0.12
2       P2.5        0.60   0.56       0.59   0.19   -3.51   -3.50       -3.54   -2.48   -0.52   -0.53       -0.54   -1.05   0.04   0.03       0.04    0.17
        P97.5       0.90   0.92       0.91   0.63   -1.52   -1.43       -1.49   -0.30   -0.19   -0.19       -0.19   -0.12   0.19   0.23       0.19    1.86
        Coverage    0.95   0.91       0.95   0.08    0.94    0.94        0.95    0.41    0.93    0.93        0.94    0.92   0.96   0.94       0.96    0.72

        Median      0.75   0.73       0.75   0.56   -2.51   -2.43       -2.51   -1.86   -0.30   -0.30       -0.30   -0.30   0.10   0.11       0.10   0.24
        Mean        0.75   0.73       0.75   0.56   -2.51   -2.43       -2.51   -1.86   -0.31   -0.31       -0.31   -0.31   0.10   0.12       0.10   0.26
3       P2.5        0.62   0.56       0.61   0.39   -3.29   -3.26       -3.31   -2.68   -0.44   -0.45       -0.45   -0.52   0.04   0.04       0.04   0.12
        P97.5       0.88   0.89       0.89   0.72   -1.73   -1.59       -1.69   -1.02   -0.22   -0.21       -0.21   -0.19   0.18   0.23       0.18   0.51
        Coverage    0.95   0.88       0.95   0.29    0.94    0.93        0.94    0.62    0.94    0.94        0.94    0.94   0.95   0.92       0.95   0.55

        Median      0.75   0.74       0.75   0.51   -2.50   -2.48       -2.51   -1.69   -0.30   -0.30       -0.30   -0.30   0.10   0.10       0.10   0.29
        Mean        0.75   0.74       0.75   0.51   -2.51   -2.48       -2.51   -1.69   -0.31   -0.31       -0.31   -0.31   0.10   0.11       0.10   0.32
4       P2.5        0.65   0.62       0.64   0.34   -3.17   -3.16       -3.19   -2.44   -0.42   -0.42       -0.43   -0.51   0.06   0.05       0.06   0.16
        P97.5       0.85   0.86       0.86   0.66   -1.85   -1.79       -1.82   -0.93   -0.22   -0.22       -0.22   -0.20   0.15   0.18       0.16   0.64
        Coverage    0.95   0.91       0.95   0.07    0.94    0.94        0.95    0.36    0.94    0.95        0.95    0.94   0.95   0.92       0.95   0.11

        Median      0.75   0.74       0.75   0.61   -2.50   -2.45       -2.50   -2.03   -0.30   -0.30       -0.30   -0.30   0.10   0.11       0.10   0.19
        Mean        0.75   0.74       0.75   0.61   -2.51   -2.46       -2.51   -2.03   -0.30   -0.30       -0.30   -0.30   0.10   0.11       0.10   0.20
5       P2.5        0.66   0.62       0.66   0.49   -3.03   -3.02       -3.04   -2.59   -0.39   -0.39       -0.39   -0.41   0.06   0.06       0.06   0.12
        P97.5       0.84   0.85       0.84   0.72   -1.98   -1.89       -1.96   -1.46   -0.24   -0.24       -0.24   -0.23   0.15   0.18       0.15   0.32
        Coverage    0.95   0.88       0.95   0.25    0.95    0.93        0.95    0.57    0.95    0.95        0.95    0.95   0.95   0.89       0.95   0.29

        Median      0.75   0.71       0.75   0.46   -2.49   -2.36       -2.50   -1.53   -0.30   -0.30       -0.30   -0.30   0.10   0.12       0.10   0.35
        Mean        0.75   0.71       0.75   0.46   -2.50   -2.35       -2.50   -1.53   -0.33   -0.34       -0.33   -0.25   0.11   0.14       0.11   0.27
6       P2.5        0.55   0.47       0.55   0.21   -3.73   -3.64       -3.76   -2.84   -0.65   -0.71       -0.67   -1.27   0.02   0.03       0.02   0.12
        P97.5       0.95   0.94       0.95   0.71   -1.22   -1.00       -1.21   -0.21   -0.17   -0.16       -0.17   -0.10   0.22   0.34       0.23   1.84
        Coverage    0.95   0.90       0.95   0.35    0.95    0.94        0.95    0.68    0.93    0.93        0.93    0.91   0.96   0.97       0.96   0.97

        Median      0.75   0.74       0.75   0.46   -2.50   -2.45       -2.50   -1.54   -0.30   -0.30       -0.30   -0.30   0.10   0.11       0.10   0.35
        Mean        0.75   0.74       0.75   0.46   -2.50   -2.45       -2.50   -1.53   -0.31   -0.31       -0.31   -0.31   0.10   0.11       0.10   0.35
7       P2.5        0.64   0.61       0.64   0.30   -3.23   -3.21       -3.24   -2.31   -0.45   -0.45       -0.45   -0.61   0.05   0.05       0.05   0.19
        P97.5       0.86   0.87       0.87   0.62   -1.77   -1.70       -1.76   -0.74   -0.22   -0.21       -0.21   -0.18   0.16   0.18       0.16   0.82
        Coverage    0.95   0.91       0.95   0.03    0.95    0.94        0.95    0.29    0.95    0.94        0.95    0.93   0.96   0.93       0.95   0.16




                                                                           29
aggregate factors. The first four columns correspond to the estimates of M , the next four columns
to estimates of M d , the next four columns to estimates of
                                                             d
                                                               , and the last four columns to estimates
     s
of .
    For each of the estimators, we report the median, the mean, and the 2.5% and 97.5% percentiles.
For each estimator, we also report its 95% coverage rate using OLS standard errors (columns 1 to
8) or the 2SLS standard errors (columns 9 to 16).
    As is clear from all cases, the estimators are mean- and median-unbiased in the simulation.
Moreover, confidence intervals tighten when concentration increases (case 3 relative to case 1 and
case 4 relative to case 2) and when the volatility of idiosyncratic shocks increases (case 2 relative to
case 1 and case 4 relative to case 3). Naturally, the confidence interval tightens when we increase
N and T . The coverage is generally accurate and OLS standard errors only slightly overstate the
precision in the case of M2 in estimating M ; the 2SLS standard errors are somewhat small in small
samples in estimating s .
    It is tempting to conclude that using y s t as instrument, even without estimating the factors,
results in accurate and unbiased estimates of the parameters of interest. However, this is only the
case when Corr ( , S ) = 0. To illustrate this, we consider a negative correlation between size and
exposures, Corr ( , S ) = 20%.
    The results are presented in Table 3. We now find a large bias in the case of M4, both in
terms of the mean and median. The coverage estimates are also heavily distorted. Intuitively, y s t
does not filter out aggregate shocks, and the exogeneity restriction is violated. This is why factor
estimates are required when loadings may be correlated with size. Even in the case where we have
no information about factor loadings (in the case of M2, which relies only on PCA), accounting for
common factors removes most of the bias and leads to much improved coverage estimates. When we
know the factor loadings (in case of M1), there is no bias and the coverage estimates are accurate. In
addition, combining the PCA estimate and the estimate using the known loadings results in almost
the same accuracy as M1. This simulation illustrates the importance of accounting for factors in
using GIV when loadings correlate with size.


6    Estimating sovereign yield spillovers
We study spillovers in sovereign yield markets in the Euro area as a first application of GIVs. We
focus on the transmission and amplification of idiosyncratic shocks during the European sovereign
debt crisis.




                                                  30
6.1     Data
We use daily data on 10-year zero coupon yields from Bloomberg.36 The countries and Bloomberg
tickers that we use are listed in Table F.7 in Appendix F.4.37 We use data on general government
gross debt for each country from Eurostat.38 The sample is from July 2009 to May 2018.39


6.2     An empirical model of sovereign yield spillovers
Section F provides a fleshed-out economic model of sovereign yield spillovers, and we summarize its
empirical implications here. In that model, governments may default on their debt, and losses in
one country will be partially shared with other countries, implying that shocks to sovereign yields
in one country spill over to other countries and vice versa.40 We index countries by i. We define
the yield spread, yit , as the yield in country i relative to Germany's yield. The model implies that
                                             yit
relative changes in yield spreads, rit := yi,t  1
                                                  , satisfy the following empirical model

                                                                 0
                                             rit = rSt +         i t   + uit ,                                  (58)

where the size weights are
                                                         Bi,t 1 yi,t 1
                                            Si,t   1   =P                 ,                                     (59)
                                                          j Bj,t 1 yj,t 1

with Bit the outstanding government debt of country i.
    This structural model brings two lessons to the empirics. First, the proper "size" of country i
here is its "debt at risk", Bi,t 1 yi,t 1 , the expected euro loss on its debt.41 Second, the spillover
                        yit
impact is such that yi,t   1
                             , rather than yit , depends linearly on rSt . This means that a country
with almost no default risk should have almost no sensitivity of its yield yit , as there is no risk
in the first place. This intuition is likely to hold in alternative models, and those models will then
imply a similar functional form.42
    The interpretation of and M = 1 1 is that if a country suers 1 billion euros in losses on its
debt because of some idiosyncratic bad news, then the aggregate debt of all European governments
  36
     We use Bloomberg's price variable PX LAST.
  37
     The tickers that we use for dierent countries are the ones used by European Insurance and Occupational
Pensions Authority (EIOPA) to construct the regulatory yield curves of insurance companies and pension funds in
the European Union. For the final construction of the curves, EIOPA combines data on zero yields and swap curves,
while we only use the zero yields.
  38
     https://ec.europa.eu/eurostat/tgm/table.do?tab=table&init=1&plugin=1&language=en&pcode=teina225.
  39
     We remove days in which markets are closed, which is when none of the yields change on a given day, and
holidays.
  40
     A natural extension would to be add the banking sector of each country. In addition, it would be interesting to
model the level of yields (i.e., the German yield) as well, which should go down as a result of safety eects.
  41
     This is under the risk-neutral measure, i.e. adjusting for the price of risk.
  42
     Spillovers in sovereign bond markets may also operate via intermediaries. For instance, if losses in one country
impact the intermediaries' constraints, then this can impact the pricing of bonds in other countries in which the
intermediaries are active. We strongly suspect that with that channel a functional form like 58 would still hold.



                                                            31
falls by M = 1 1 billions.43
    It is essential to control for common factors t . It is well understood, see for instance Forbes and
Rigobon (2002), that omitted factors and endogeneity impact measures of spillovers and contagion.44


6.3        Estimation procedure
We estimate the model using the standard GIV procedure, accounting for heteroskedasticity. Em-
pirically, we use rit = 0.01+y it
                             yi,t 1
                                    to avoid problems when spreads get close to zero, yit ' 0.

   1. We compute the rolling standard deviation of relative changes in yield spreads using the
      trading days of the last two months, t (rit ). We then define45

                                                           it   = max (   t   (rit ) , mt ) ,                        (60)

         where mt = median ( t (rjt )), that is, the cross-sectional median at time t. We define the
                                                2
                                ~i,t 1 = P1/ it 2 . We apply the max operator in (60) to avoid that the
         ~ -weights as usual as E
         E
                                           i 1 /  it
         ~ -weights put too much weight on a single country if yield spreads for that country happen
         E
         to be stable and close to zero. The main objective of adjusting for heteroskedasticity is to put
         less weight on extremely volatile countries.46
                                                                                                  r
                                                                                                  it
   2. We compute r   it = rit rEt ~ and adjust rit for heteroskedasticity, nit =                  it
                                                                                                       . We use PCA based
      on nit , nit =  i t + u
                      0
                            it , to estimate the factors, te
                                                             .
                                                       1
   3. We estimate the multiplier M =               1
                                                                via the regression

                                                                                   0 e
                                              rSt = k + M r ~ t +                  S t   + et .                      (61)


To identify the largest shocks and to verify narratively that the shocks are truly idiosyncratic, we
run the weighted panel regression

                                                                          0 e
                                             rit           rEt
                                                            ~ = c+         t     + uit ,
  43
       Indeed, suppose that country i has an idiosyncratic shock uit , so that that value of its debt falls by Vit =
Bi,t    1 yi,t 1 uit euros. As rSt = M Si,t 1 uit , the value of all Eurozone sovereign debt falls by
                             X                         X
                      Vt = (    Bj,t 1 yj,t 1 )rSt = (    Bj,t 1 yj,t 1 )Si,t 1 M uit = M Bi,t 1 yi,t 1 = M Vit .
                          j                            j


  44
     Caporin et al. (2018) study spillovers in European sovereign debt markets and show that quantile regressions
can be used to test for contagion if contagion is defined as a change in interlinkages. Our definition of contagion
(captured by a nonzero in equation (58)) is very dierent from theirs.
  45
     We compute the rolling standard deviation including the current observation. Given the objective to most accu-
rately estimate the time fixed eect and the factor realizations, we want to account for the same-period realizations,
in particular given the fat-tailed distribution of yield changes.
  46
     The results are quantitatively very similar when using it = max ( t (rit ) , mt ), with  = 0.75.


                                                                     32
Figure 1: Dynamics of sovereign yield spreads and size weights. The figure reports the yield
spreads, relative to Germany, for Italy, Spain, Greece, Ireland, Portugal, and France in the left
panel from September 2009 to May 2018. The spreads are based on 10-year zero-coupon bonds and
are constructed using data from Bloomberg. The right panel displays the size weights based on the
definition in (59) for the same countries and the same sample period.



                              .25




                                                                                                        .6
                              .2




                                                                                                        .4
                                  .15
                       Yield spreads




                                                                                         Size weights
                      .1




                                                                                                        .2
                              .05
                              0




                                                                                                        0
                                        2010m1   2012m1     2014m1   2016m1   2018m1                         2010m1   2012m1     2014m1   2016m1   2018m1
                                                             Date                                                                 Date

                                                    Italy                 Spain                                          Italy                 Spain
                                                    Greece                Ireland                                        Greece                Ireland
                                                    Portugal              France                                         Portugal              France




using the size weights. In this panel regression, ue    St is identical to the residual of the regression
            0 e    e                             e
r ~ t = c + ~ t + uSt . We discuss the largest |uSt | in detail in Section 6.6.


6.4    Empirical results
We plot the dynamics of spreads, yit , in the left panel, and size weights, using the definition in
(59), in the right panel of Figure 1 for France, Greece, Ireland, Italy, Portugal, and Spain. The
sample is from September 2009 to May 2018. We distinguish three broad periods. First, from 2010
to 2012, the yield spread dynamics are driven by the European sovereign debt crisis. During 2015,
yield spreads in Greece widen once again, but the low-frequency dynamics in other countries are
more muted and spreads tighten in most countries. This period is characterized by political turmoil
in Greece related in part to negotiations of a bailout deal. During the last months of our sample,
there is a jump in Italian yields due to political uncertainty regarding budget plans following the
general election. We will revisit these episodes in more detail when analyzing the largest and most
influential idiosyncratic shocks in Section 6.6.
    Table 4 reports the estimates of the multiplier, M . The first column regresses rSt on Zt = r ~ t .
The second to the fourth column add principal components. The multiplier estimate drops after
adding the first principal component from 1.63 to 1.46, but then stabilizes and adding more principal
components does not impact the estimate of the multiplier in an economically meaningful way. In


                                                                                    33
Table 4: Multiplier estimates of sovereign yield spillovers. The table reports the estimates of the
multiplier in (61). The first to the fourth column include zero to three principal components as
controls. In the final column, we re-estimate the model excluding Greece. In this table, Zt = r ~ t and
P Cit corresponds to the ith principal component that we extract based on r       it
                                                                                  it
                                                                                     . The size-weighted
average of relative yield spread changes, rSt , uses the size weights as defined in (59). The model is
estimated using daily data from July 2009 until May 2018.

                           rSt        rSt       rSt            rSt      rSt (excluding Greece)
                Zt        1.632      1.456     1.433          1.488             1.426
                         (73.90)    (44.09)   (45.42)        (46.48)           (29.68)

                P C 1t             0.00215    0.00230        0.00192           0.00215
                                    (7.13)     (8.00)         (6.67)            (5.47)

                P C 2t                        -0.00332       -0.00330         -0.00160
                                              (-14.85)       (-14.95)          (-6.35)

                P C 3t                                       0.00193           0.00249
                                                              (7.53)            (6.50)
                N        2264        2264      2264           2264              2264
                R2       0.707       0.714     0.739          0.745             0.752
                t statistics in parentheses


the final column, we omit Greece, which plays an important role during this period. However, using
the shocks from other countries does not impact the estimates in an economically meaningful way.
    The high R-squared in the first column does not estimate the fraction of the variation in ag-
                                                                                                 e
gregate yield spread changes that is due to idiosyncratic shocks, as r ~ t is correlated with t    . To
estimate the importance of idiosyncratic shocks, we regress rSt on ue   St , which provides exactly the
same point estimate of the multiplier as in the final column of Table 4. The R-squared of this
regression is 24%, implying that a quarter of the variation in aggregate yield spread changes is due
to idiosyncratic shocks.
    The idiosyncratic shocks to relative changes in yield spreads are fat-tailed, as can be seen from
the left panel of Figure 2, which plots the time series of ue  St . The right panel of the same figure
plots ueSt (horizontal axis) against rSt (vertical axis). If there are no spillovers,    = 0, then the
multiplier is one and the points fall along the 45-degree line (the red dashed line). The fact that
the estimated slope is steeper, as indicated by the blue solid line, implies that there are significant
yield spillovers.




                                                        34
Figure 2: Idiosyncratic shocks over time and aggregate yield changes. The figure shows the time-
series dynamics of ue                                     e
                     St in the left panel. We construct uSt as the residual of a regression of r ~ t on
 e
t  . The right panel shows a scatter plot of ue St (horizontal axis) against rSt (vertical axis). The
size-weighted average of relative yield spread changes, rSt , uses the size weights as defined in (59).
The series are constructed using daily data from July 2009 until May 2018.
   .1




                                                                           .2
                                                                                       Data         Multiplier
                                                                                       45-degree




                                                                           .1
   .05




                                                                           0
 uS




                                                                      rS
  0




                                                                           -.1
   -.05




                                                                           -.2
   -.1




                                                                           -.3
          01jan2010   01jan2012   01jan2014   01jan2016   01jan2018              -.1         -.05        0       .05   .1
                                     Date                                                               uS




6.5           Interpretation of the coe cients
We find a multiplier M = 1 1 ' 1.5 and hence a spillover parameter ' 1      3
                                                                              .47 The interpretation
is as follows: suppose that Italy suers a bad shock that makes its debt likelier to default, so that
the market value of Italy's debt falls by 1 billion euros. The multiplier M ' 1.5 means that the
aggregate debt of all European governments falls by 1.5 billion euros ­ the spillover consists of
an extra 0.5 billion euros in expected losses in European sovereign debt markets. Note that the
expectation is under the risk-neutral measure, so could correspond to a higher likelihood of default,
or a higher price of risk for that default.48


6.6           Narrative GIVs
To further inspect the variation that the GIVs are exploiting to estimate the multiplier, we narra-
tively check the largest shocks in Table 5. In particular, we order the dates based on the size of
| ue
   St |. To illustrate the relevance of the largest shocks, we re-estimate the model that includes three
principal components, that is, the fourth column of Table 4, using only the days with the largest k
shocks. In Figure 3, we show the multiplier estimate, alongside the 95%-confidence interval, where
  47                                                                           yit
     Here we use, omitting aggregate shocks, rit = M uSt + uit , with rit = yi,t  1
                                                                                    , and rSt = M uSt .
  48
     To get some more intuition, consider that Italy, near the peak of the crisis, has a relative size of 0.4. Suppose
an idiosyncratic shock to Italy makes the Italian yield double (ui = 1 for i = Italy); that is, the Italian yield spread
goes from 2% to 4%. That makes the other yields go up by a relative value of M  Si  ui = 0.5  0.4  1 = 0.2,
so that the average yield increases from 1% to 1.20%. In other terms, as the Italian yield spread goes up by 200bp,
the other countries' yield spreads go up by 20bp, implying a "pass-through" of 0.1.



                                                                 35
Table 5: Summary of the largest idiosyncratic shocks and narratives. The table reports the proper-
ties of yield spread changes, yit , on the 10 days with the largest realization of |ue St | in Panel A. In
Panel B, we report the corresponding relative yield changes, rit = 0.01+y it
                                                                         yi,t 1
                                                                                . In Panel   C, we provide
the narratives associated with these events. The series are constructed using daily data from July
2009 until May 2018.

                                             Panel A:   Unscaled   idiosyncratic shocks
 Date        Austria   Belgium     Finland   France     Greece      Ireland Italy       Netherlands   Portugal   Slovenia   Spain
 10-May-10   -0.08%     -0.24%      -0.07%   -0.08%     -3.87%      -1.18%    -0.43%        -0.06%     -1.62%     -0.30%     -0.62%
 8-Aug-11    -0.03%     -0.09%       0.00%    0.08%      0.01%       0.05%    -0.66%         0.00%     -0.10%     -0.16%     -0.73%
 26-Oct-11   -0.05%     -0.03%      -0.03%   -0.09%      3.11%       0.01%    -0.02%        -0.03%     -0.15%      0.01%     -0.04%
 12-Mar-12    0.04%      0.04%       0.01%    0.05%     -7.32%       0.00%     0.11%         0.01%      0.06%     -0.04%      0.09%
 3-Feb-15    -0.01%     -0.01%      -0.01%    0.00%     -1.21%      -0.02%    -0.07%        -0.01%     -0.12%     -0.06%     -0.05%
 29-Jun-15    0.05%      0.07%       0.03%    0.07%      3.21%       0.13%     0.36%         0.04%      0.48%      0.11%      0.36%
 6-Jul-15     0.02%      0.04%       0.01%    0.03%      2.35%       0.06%     0.16%         0.01%      0.27%      0.03%      0.18%
 10-Jul-15   -0.04%     -0.05%      -0.03%   -0.05%     -3.28%      -0.10%    -0.21%        -0.04%     -0.24%     -0.23%     -0.22%
 13-Jul-15   -0.01%      0.01%       0.00%    0.01%     -1.11%       0.00%     0.02%         0.00%     -0.03%     -0.01%      0.02%
 29-May-18    0.07%      0.04%       0.03%    0.04%      0.36%       0.08%     0.49%         0.03%      0.20%      0.08%      0.17%

                                               Panel B: Scaled idiosyncratic shocks
 Date        Austria   Belgium     Finland   France    Greece    Ireland Italy         Netherlands    Portugal   Slovenia   Spain
 10-May-10    -5.2%     -14.2%       -5.2%    -5.9%    -41.6%     -29.5%    -17.5%           -4.8%     -38.0%     -12.8%     -24.1%
 8-Aug-11     -1.9%      -3.1%        0.2%     4.4%      0.1%       0.6%    -14.4%           -0.3%      -1.2%       -4.0%    -15.9%
 26-Oct-11    -2.6%      -1.0%       -2.1%    -4.3%     19.4%       0.2%     -0.5%           -2.3%      -1.5%        0.3%     -0.8%
 12-Mar-12     1.9%       1.6%        0.8%     2.5%    -31.7%       0.0%      2.8%            0.9%       0.5%       -0.9%      2.2%
 3-Feb-15     -1.2%      -0.7%       -0.7%    -0.1%    -11.5%      -1.2%     -3.0%           -0.7%      -3.7%       -2.9%     -2.0%
 29-Jun-15     3.8%       5.0%        2.8%     5.1%     33.4%       6.9%     16.6%            3.1%      17.4%        4.7%     16.6%
 6-Jul-15      1.8%       2.5%        0.7%     2.0%     18.9%       3.3%      6.8%            1.2%       8.6%        1.1%      7.7%
 10-Jul-15    -3.0%      -3.5%       -2.2%    -3.7%    -22.1%      -5.0%     -8.8%           -3.0%      -7.6%       -9.1%     -9.0%
 13-Jul-15    -0.5%       1.0%       -0.2%     1.1%     -9.6%       0.1%      1.0%            0.3%      -0.9%       -0.5%      1.1%
 29-May-18     5.2%       2.6%        2.3%     2.9%      7.2%       5.0%     14.6%            2.3%       7.3%        4.7%      7.7%

                                                      Panel C: Narrative analysis
 Date        Event
 10-May-10   Stock markets leap across Europe as EUR750bn eurozone rescue package is agreed
 8-Aug-11    ECB decides to start buying Italian and Spanish bonds as part of the Securities Markets Program
 26-Oct-11   EU leaders announced an agreement, including deal with private sector investors to take a 50% loss on Greek bonds
 12-Mar-12   Greece Bailout Package Signed O by EU Leaders
 3-Feb-15    Greek government said to retreat from a demand for a debt writedown.
 29-Jun-15   Greece closes banks
 6-Jul-15    Greece bailout referendum on July 5th where voters reject austerity package
 10-Jul-15   The Greek government submitted its highly anticipated plan for the country's economic overhaul to bailout authorities
 13-Jul-15   Greek PM Alexis Tsipras conceded to a further swathe of austerity measures and economic reforms
 29-May-18   Italian political turmoil (snap election plus new budget plan) cause largest 1-day decline in Italian bonds in 25 years




                                                                36
Figure 3: Multiplier estimates using an expanding window. The figure reports the estimates of
the multiplier in (61) using three principal components as controls. We estimate the model using
an expanding sample where the data are ordered by |ue   St |, that is, the magnitude of the idiosyn-
cratic shocks. The number of dates included is depicted on the horizontal axis, starting with 15
observations. The solid blue line corresponds to the point estimate and the dashed red lines to the
95%-confidence interval. The model is estimated using daily data from July 2009 until May 2018.


                                     1.8     1.6
                         Multiplier estimate
                               1.4   1.2
                                     1




                                                   0   500   1000            1500   2000   2500
                                                                Dates included




we indicate the number of dates included on the horizontal axis (starting at 15 observations). The
estimate is stable for dierent samples but obviously standard errors tighten as the sample expands.
    Panel A in Table 5 reports the yield changes on the 10 days with the largest realization of |ue
                                                                                                  St |.
In Panel B, we scale the yield changes by 0.01 + yi,t 1 . In Panel C, we provide the narratives.
If we inspect some of the largest shocks in Table 5, then is is clear that most of them are truly
idiosyncratic shocks. Examples include the decision by Greece to close all banks or the outcome
of the referendum. There are two shocks, however, on May 10, 2010 and August 8, 2011 that
involve actions by the ECB and hence are more likely aggregate shocks as opposed to idiosyncratic
shocks. Removing these dates does not impact our estimates, but illustrates the empirical relevance
of sporadic factors during times of crisis (see Section 2.6). Most of the shocks are associated with
Greece, although the final date corresponds to Italy.49
 49
      Also following the end of our sample, many of the idiosyncratic shocks in recent months happened in Italy.




                                                                 37
7        Multipliers and elasticities in crude oil markets
7.1       Data
Our data construction follows the existing literature (Kilian (2009), Caldara et al. (2018), Baumeis-
ter and Hamilton (2019), henceforth BH19). The data on crude oil production are from the January
2019 Monthly Energy Review published by the U.S. Energy Information Administration (EIA). We
observe the monthly oil production for 20 countries from January 1985 until December 2015.50 The
selection of countries includes OPEC and non-OPEC members. In addition to the production data
of these 20 countries, we also observe the production by (current) OPEC and non-OPEC members
as well as the world's production. We use the total non-OPEC production to construct a fictitious
country that produces the residual non-OPEC supply.51
    We focus on estimating short-run (monthly) multipliers as well as demand and supply elasticities,
consistent with the literature. To construct innovations, we use a state vector Xt that includes lagged
(i) world supply growth, (ii) monthly oil price changes, (iii) changes in inventories, and (iv) growth
in industrial production. We use the data of BH19 for the latter three series.


7.2       Model
We model the supply growth of country i in period t as

                                                   s                    0
                                    yit = ai +            pt +          y Xt 1   +   i t   + uit ,

and model changes in aggregate oil demand (both in use and inventories) as

                                                               d           0
                                           d t = cd +              pt +    d Xt 1    + t .

       Market clearing,   ySt =    dt , implies

                                      M            p0                                                y0
                          pt = cp +    d
                                           uSt +        Ct ,             ySt = cyS + M uSt +              Ct ,

                    d
                                                        p
where M =       s   d 2 [0, 1] is the multiplier, and (   , y ) are loadings on Ct = (t , "t , Xt 1 ), and
whose precise values do not matter here.
   Our goal is to estimate the short-run supply and demand elasticities, s and d (with presumably
 d
   < 0 < s ). The equations for aggregate supply and price changes are part of the VAR models
that are commonly used in the recent literature on oil prices and their impact on economic growth.
  50
     We follow Caldara et al. (2018) and remove Gabon from the sample due to concerns about data quality. In
addition, we scale the supply of the USSR using the ratio of supply of the USSR to the supply of Russia to obtain a
continuous series and to avoid a sudden jump in the non-OPEC supply.
  51
     This fictitious country includes the countries that were not part of OPEC during our sample.



                                                                   38
7.3     GIV estimation
The supply changes in a couple of months are extreme for some countries during supply disruptions,
and we therefore winsorize the growth rates at 2.5% and 97.5% across all countries and periods to
                     w             w
estimate yEt = yEt     , where yit   denotes winsorized supply growth.52 We then estimate the
model using the following steps, which follows the procedure in Section 4:

   1. Run a panel regression with country and time fixed eects,53

                                                        w                         w
                                                       yit = ai + b t +         y
                                                                                it  .

             w
   2. Use y it  to estimate a parametric factor based on OPEC membership.54 Let Iit OP EC
                                                                                          = 1 if a
                                                     OP EC
      country is an OPEC member in month t and Iit         = 0 otherwise. We then estimate

                                                     w         OP EC OP EC
                                                   y
                                                   it  = bt + Iit   t      + eit ,

                                               OP EC,e             w
       and we denote the estimated factor by t         . We use y it  also to separately estimate a
                                                                     P CA,e
       principal component, and
                               we denote the   estimated factor by t        . We stack the estimated
                           e    OP EC,e P CA,e
       factors together in t = t       , t      .
                                         d
                  M                                                                           w
   3. Estimate     d   and M =       s       d   using respectively, with Zt = ySt           yEt ,

                                                        M
                                          p t = ap +     d
                                                              Zt +    0 e
                                                                      p t   +    X0
                                                                                 p Xt 1   + ep
                                                                                             t,                 (62)

                                                                      0 e
                                         ySt = aS + M Zt +            S t   +    X0
                                                                                 S Xt 1   + ey
                                                                                             t.                 (63)

   4. Estimate the demand and supply elasticities using the following regressions, where we instru-
      ment pt using Zt ,
                                                     0 e     X0
                              ySt = aS + d pt + S      t + S    Xt 1 + ed
                                                                        t,                     (64)
                                                          s            0 e        X0
                                         yEt = aE +            pt +    E t   +    E Xt 1   + es
                                                                                              t.                (65)


7.4     Empirical results
We report the estimation results of the multipliers M = 0.91 and M    d =   1.97 in Table 6 alongside
both elasticities. The estimate of M  d implies that a 1% decline in the global oil supply leads to a

1.97% increase in oil prices. The estimate of M implies that a 1% shock to supply leads to an overall
  52
     To ensure growth rates are always defined, we set supply to one in case it drops to zero, which happens in seven
country-months.
  53
     Note that the time fixed eects absorb the controls, Xt 1 , in this case.
  54
     OPEC membership is largely stable during our sample except for Angola and Ecuador. We account for changes
in membership in estimating the factor.


                                                               39
Table 6: Multiplier estimates in the oil market. The first column reports the estimate of M as the
coe cient on Zt in (62). The second column reports the estimate of M       d as the coe   cient on Zt
in (63). The third column reports the Two Stage Least Squares (2SLS) estimate of the demand
elasticity d , see (64), and the fourth column the 2SLS estimate of the supply elasticity s , see (65).
In both cases, we use Zt as an instrument for pt . We suppress the coe cients on the controls,
Xt 1 , that include lagged (i) world supply growth, (ii) monthly oil price changes, (iii) changes in
inventories, and (iv) growth in industrial production. The t-statistics are based on OLS and 2SLS
standard errors in parentheses. We also report the t-statistics using standard errors that are robust
to heteroskedasticity and autocorrelation in brackets. We select the optimal lag length as in Newey
and West (1994). The sample is from January 1985 to December 2015.

                                       ySt         pt       ySt        yEt
                            Zt        0.913     -1.974
                                     (16.21)    (-3.60)
                                     [14.11]    [-2.34]

                            P CA
                            t         -0.118    0.173     -0.0379     -0.126
                                     (-15.29)   (2.30)    (-0.97)    (-13.67)
                                     [-11.71]   [2.51]     [-0.76]    [-9.78]

                            OP EC
                            t         0.409     -0.197    0.318       0.418
                                     (15.07)    (-0.75)   (2.55)     (14.35)
                                      [8.92]    [-0.72]   [2.25]      [7.89]

                              pt                          -0.463     0.0438
                                                          (-3.54)    (1.43)
                                                          [-2.52]    [0.97]
                            N          370       370        370        370
                            R2        0.578     0.262




                                                   40
reduction in oil supply of 0.91% as other countries step in to increase their supply in response to
higher prices. We estimate a demand elasticity of d = 0.46 and a supply elasticity of s = 0.044.
Changes in demand also include changes in inventories, which respond more elastically to changes in
prices (Kilian and Murphy (2014)). In parentheses, we report the t-statistics using OLS and 2SLS
standard errors. We also report the t-statistics with more conservative standard errors in brackets
that are robust to heteroskedasticity and autocorrelation. We select the optimal lag length as in
Newey and West (1994). Recall that while the multiplier estimates rely on standard OLS inference,
the elasticity estimates use instrumental variables. This is important, as the instrument for price is
quite weak, and we are therefore cautious when interpreting the elasticity estimates and emphasize
the multiplier estimates instead.
    To put these estimates in perspective, we compare them to recent estimates in the literature and
find them to be in broad agreement. Indeed, Baumeister and Hamilton (2019) use sign restrictions
in combination with a Bayesian estimator to find supply and demand elasticities of 0.15 and 0.35,
respectively, with 68% credibility intervals of (0.09, 0.22) for the supply elasticity and ( 0.51, 0.24)
for the demand elasticity. The point estimates imply multipliers of M = 0.7 and M          d =   2. Kilian
and Murphy (2014) also combine sign restrictions and a Bayesian estimator with short-run supply
elasticities bounded at 0.025, 0.05, and 0.1, and corresponding demand elasticities ranging from
-0.44 to -0.47. For the 5% bound, the multiplier estimates equal M = 0.9 and M           d =   2. Caldara
et al. (2018) use a narrative approach and estimate a supply elasticity of 0.08 (with a standard
error of 0.037) and a demand elasticity of -0.08 (with a standard error of 0.08), yielding multipliers
of M = 0.5 and M   d =   6.3.
    To further compare the GIV to instruments used in the literature, we juxtapose it to that
employed by Caldara et al. (2018). We construct our instrument as the residual from a regression
                                        e
of y t on Xt 1 and the two factors, t     , and refer to it as u t . If we regress it on the instrument
of Caldara et al. (2018), which is non-zero only during 14 months in this sample, we get a slope
coe cient of 0.92, with a t-statistic of 13.5 and an R-squared of 94%. Moreover, if we restrict
ourselves to more extreme episodes by only using data when u t , in absolute value, exceeds a
threshold, then the estimates of M   d becomes more negative.
                                                                   55
                                                                      A potential interpretation is that
demand becomes more inelastic in case of more extreme shocks, for instance, as inventories are
running low. This reconciles our estimates with those of Caldara et al. (2018).
    In summary, the GIV estimator results in estimates that are in the range of estimates docu-
mented in the recent literature, thereby providing some external validation of GIVs as an approach
to estimating demand and supply elasticities. At the same time, the GIV procedure arguably
requires less domain-specific ingenuity than the previous studies we mentioned.
    Several interesting extensions are worth exploring.56 First, we can estimate demand elasticities
  55
     If we restrict |u t | exceeding 0.5%, 1%, and 1.5%, the first-stage slope decreases from -1.97 to -2.19, -3.46, and
-4.76, respectively.
  56
     We are grateful to Lutz Kilian for suggesting these potential extensions.



                                                          41
for oil demand in production and oil demand in use (Kilian and Murphy (2014)). Second, Saudi
Arabia plays a key role within OPEC and steps in quickly in times of supply disruptions, for instance,
during the First Gulf War. One can use GIV to estimate a dierent supply curve for Saudi-Arabia
than for the other countries, and in particular allow Saudi Arabia to respond to the production by
other OPEC countries. Third, detailed country-level data on (net) imports and oil consumption
can be used to construct a second instrument that can be used to both sharpen the estimates and
to test for overidentifying restrictions. Fourth, one could use GIVs to explore non-linear demand
curves to understand the multipliers during large supply disruptions (see Section D.8).57


8       Discussion and extensions of the framework
8.1       Extensions
There are many ways to increase the number of setups in which the GIV idea can be applied. In
our experience, one can extend the GIV idea to many settings and generalizations.

Multidimensional GIV One can handle multidimensional "actions:" for instance, a firm could
have a shock that aects both productivity and labor demand. A country could have a shock
that aects both productivity and oil demand. Formally, the actions yit and shocks uit are now
multidimensional. The GIV idea goes through, and this is developed in Section D.1. We have seen
that with one GIV, we can estimate 1 + dF parameters (M , M f ), where dF is the number of
endogenous, observed factors. With q -dimensional actions, we have q GIVs, and we can estimate
q 2 + qdF parameters, which correspond to M and f .58 So, potentially many parameters can be
recovered with multidimensional "actions" by firms or countries.

GIV with a more complex matrix of influences The GIV can also be extended to non-
                                                                      P
homogeneous influences in the context of loops. Suppose a model yit =   j Gij yjt + i t + uit , i.e.,
in vector form
                                      yt = Gyt + t + ut ,                                      (66)

with a given "influence" matrix G (in our baseline model, G = S 0 ). We'd like to identify , the
strength of linkages.
    A simple generalization of our GIV is to define a "size" vector S := G0 E . Then, left-multiplying
(66) by E 0 , we get
                                     yEt = ySt + E t + uSt .

The key moment is still E [(yEt            ySt ) zt ] = 0, where the GIV is again zt = ySt               yEt in the simple
 57
      One would interact with zt by, for example, the log previous-period price to see the elasticity at dierent prices.
                                                                                            f
 58                                            dyst                                       dFt
      As uSt and ySt are q -dimensional, M =   duSt   q  q dimensional, and each of the   duS   = M f is also q -dimensional.



                                                              42
case where  =  and G = ; see Section D.14 for the general case. Hence, GIV generalizes to
"spatial" models with common shocks (most spatial models do not have latent common shocks).59

Bayesian GIV Another extension is a Bayesian interpretation of the GIVs. This way, we can
interpret GIVs in a Bayesian framework ­ see Section E. In particular, this opens the possibility
of marrying GIV estimation with priors on other parameters. In the simplest cases with Gaussian
shocks, the maximum likelihood estimate is our GIV ­ confirming its optimality properties. At the
same time, the basic GIV doesn't actually use normality assumptions.

Vector autoregressions with GIV One can do vector autoregressions with GIVs: if Yt =
AYt + Xt , one can use the GIV zt to instrument for some of the shocks to the innovations Xt , and
achieve partial or full identification. The GIV is then an "external instrument", and one can follow
the methods spelled out in Stock and Watson (2018).60 One can also do Jord`      a (2005) style local
projections, regressing Et [Yt+h ] = t Xt , and instrumenting some of the regressors Xt by a GIV.
Both methods give a way to do impulse responses with GIVs.


8.2     Comparison with Bartik instruments and other procedures
Comparison with Bartik instruments The GIV estimator shares some similarities with Bartik
instruments,61 but also major dierences To put it simply, Bartik instruments allow to estimate the
cross-sectional (or micro) sensitivities to shocks, but not aggregate sensitivities; whereas GIVs are
mostly designed to estimate aggregate (or macro) elasticities. Hence, they are complementary.
    To see this, let us use the notation established earlier. Shift-share estimators aim to estimate
                                                      P f
the coe cients f  1 in the structural equation yit =
                                                                  f       f   y                 f
                                                         f ( 0 + 1 xit )Ft + t + uit using xit gt as an
instrument for xit Ftf . In this notation, the "shares" are xit and the "shifters" are gt
                                                                                        f
                                                                                          (for instance
 f                                                           y
gt could be the China shock, and be correlated with t ). Shift-share estimators have been the
study of much recent econometric work including Goldsmith-Pinkham et al. (2020); Adao et al.
(2019); Borusyak et al. (2020). Borusyak et al. (2020) lay out su cient identifying conditions for
the shift-share estimator to estimate the structural parameter. Shift-share estimators estimate f     1
                                                f 62
but are unable to estimate the mean eect 0 . In contrast, the GIV estimator provides a general
strategy to estimate f                    f
                         0 if the shock Ft is aected by some large idiosyncratic shocks.


Procedures containing elements of GIVs A few papers have explored the idea of using id-
iosyncratic shocks as instruments to estimate spillover eects, such as Leary and Roberts (2014b)
  59
     See Brownlees and Mesters (2020) for a potential way to extend this approach when G is unknown.
  60
     See Plagborg-Moller and Wolf (2020) for a recent development in this area.
  61
     Known as "shift-share estimators," they were first introduced in Bartik (1991) and popularized in Blanchard
and Katz (1992).
  62
     If we have just one date, one can identify f   f
                                                 1 Ft for that date t by a cross-sectional regression. Hence, a Bartik
approach is viable with just one cross-section, whereas the GIV needs a whole panel (fixed N , large T ).


                                                         43
in the context of firms' capital structure choice and Amiti et al. (2019) in the context of firms' price
setting decisions. The structure of the estimating equations in these papers is similar to the model
that we consider here:63
                                         yt = ywt + mCt + ut ,

where ywt = w0 yt can be equally-weighted (Leary and Roberts (2014b)) or size-weighted (Amiti et
al. (2019)), depending on the weights w. Both papers use industry and/or year fixed eects, which
can be viewed as a choice of controls or exogenous factors, t , to which all firms in a given industry
have the same exposure.
    There are two main dierences compared to GIV. First, both papers use idiosyncratic shocks
to another variable than yt , say gt , to construct an instrument for ywt . Leary and Roberts (2014b)
use idiosyncratic stock returns and Amiti et al. (2019) use shocks to competitors' marginal cost,
exchange rates, or export prices. We, instead, propose to use idiosyncratic shocks to yt rather than
another instrument (this way requiring fewer times series). Second, and related, we control for
heterogeneous exposures to common factors to extract the idiosyncratic shocks, which is important
in asymptotic theory and in practice in realistic samples (see Section 5).
    A third dierence is specific to Leary and Roberts (2014b). GIVs crucially depend on the
dierence between size- and equal-weighted averages of variables. If the estimating equation depends
on equal-weighted averages, GIV cannot be applied. In most models, however, not all competitors
receive equal weight and larger firms, or perhaps firms that are closer in product space, receive a
larger weight.
    Lastly, the use of model-based idiosyncratic shocks has some similarities with Amiti and We-
instein (2018), who extract bank supply shocks from Japanese data using a panel of fixed eects,
and then estimate the sensitivity of aggregate investment to these shocks. However, unlike our
model, Amiti and Weinstein (2018) assume a uniform sensitivity to the aggregate shocks ( i t with
  i = 1 for all i), and do not allow for feedback loops: shocks to banks aect aggregate investment,
but aggregate investment does not circle back around to aect individual bank behavior (so, they
assume f = 0 in our notations). This is the key source of endogeneity in many of the models we
consider, and by tackling it we are able to estimate a richer set of parameters.

Other methods to estimate aggregate elasticities Rigobon (2003) introduces another method
that can be used to estimate spillover eects and aggregate multipliers using time-variation in sec-
ond moments. If shocks are heteroskedastic and the structural parameters are stable across regimes,
then the dierent volatility regimes add additional equations to the system so that the structural
parameters can be identified. GIV does not require heteroskedasticity, but can accommodate it,
and is therefore complementary to identification methods that rely on heteroskedasticity.
  63
     Amiti et al. (2019) study the price setting decision of firms. In their model, the pricing equation features two
endogenous variables, namely the same firm's marginal cost and the size-weighted average of competitors' prices. We
focus on the spillover eects of competitors' prices in our discussion in this section.


                                                         44
Influence and the "reflection problem" The "reflection problem" (Manski (1993); Kline and
Tamer (2020)) studies a related form of contagion. The traditional literature does not use idiosyn-
cratic shocks in its identification strategies. Hence a GIV approach can be useful to complement
existing approaches. This is sketched in (66) and Section D.15 develops this in some detail.64

Other literatures In a tangentially related recent paper, Sarto (2018) uses factor analysis to
extract values of  f (much as we do when we "recover" a factor  f ). Take the basic example in our
paper. Then, Sarto does not identify : even if  (the aggregate shock to demand) were perfectly
identified, that would not allow to estimate p. In the supply and demand example, Sarto would
identify the demand elasticity d , but not the supply elasticity s .
    Spatial econometrics. In some applications of GIVs we have considered separately, growth in a
region aects that of the other regions. So there is a similarity between our setup and that of spatial
econometrics (e.g. Kelejian and Prucha (1999)). However, the estimators are quite dierent. The
reason is that spatial econometrics studies the "local" influence (e.g. of neighboring cities on a city),
while GIVs study the global influence. Hence, the sources of variation, identifiability conditions and
methods are quite dierent. Certainly, the spatial literature has not identified, as we do, the GIVs
as a simple way to estimate elasticities in contexts such as supply and demand problems, and models
with feedback loops from banks to sovereign yields (and vice versa). Still, some of the sophisticated
techniques of the spatial literature might be used one day to enrich a GIV-type analysis.

Quasi-experimental instruments and identification by functional form A large literature
explores identification by functional form, where consistency of the estimator depends on functional
form or distributional assumptions. Classic examples include the Heckman (1978) selection model,
identification via heteroskedasticity, as in Rigobon (2003) and Lewbel (2012), and Arellano and
Bond (1991) and Blundell and Bond (1998) in the context of dynamic panel data models. The
typical concern with these approaches, compared to quasi-experimental instruments that are outside
of the model, is that the estimators are inconsistent when the model is misspecified.
    In the case of GIVs, we generally start from a structural model that motivates the estimating
equation, as we will see in the empirical examples below. This prescribes the definition of the
size vector S and, in some cases, the characteristics that determine the exposures xit . To extract
idiosyncratic shocks, we rely on statistical factor models.65
    Instead of viewing this last step as a merely statistical exercise that is hard to validate externally,
GIVs provide an empirical strategy to understand the economic drivers of the instrument by screen-
ing the top shocks narratively. By understanding the nature of the shock based on news coverage
(as in the narrative examination we just discussed), for instance, we can ensure that the shocks are
  64
     Somewhat related, Graham (2008) explores the identification of peer eects using conditional variance restrictions
on the outcomes by exploiting dierences in the sizes of the peer group. Intuitively, smaller peer group sizes lead to
a larger contribution of each individual peer on the peer component.
  65
     We discuss the robustness of GIVs to various forms of misspecification in Section 2.6.


                                                         45
truly idiosyncratic and interpretable. For instance, a large negative return associated with a failed
stress test of a bank in the context of doom loops, a negative supply shock in Kuwait and Iraq
during the First Gulf War, or a positive demand shock in China in the early 2000s in the context
crude oil markets, are all valid instruments. While alternative identification methods might rely on
functional form assumptions only, GIVs, by being able to screen the shocks economically, provide
a systematic way to construct instruments more in the spirit of quasi-experimental instruments.


8.3    When aggregate shocks are made of idiosyncratic shocks
We now discuss how GIVs extend to economies where aggregate shocks t are themselves made of
idiosyncratic shocks uit , as in Carvalho and Gabaix (2013). Take the basic supply and demand
model of Section 2.1. In the case without loops, we achieved identification provided that u t ? "t ;
we did not need u t ? t , so aggregate demand shocks can be influenced by idiosyncratic shocks,
but not aggregate supply shocks.
    If aggregate supply shocks are aected by idiosyncratic shocks, the elementary strategy does
not work, but a variant does work. We suppose disaggregated supply and demand data (for the
commodity in question, e.g. oil) is available, at least for large countries. We model country i's
supply and demand with the following the factor model:

                                         k      k          k k
                                        yit =       pt +   i t   + uk
                                                                    it ,                            (67)
                                                                                     
where k = s, d indicates supply or demand, respectively. We allow E us             d
                                                                               it it to be nonzero: for
                                                                                 u
instance, if the US has a "fracking shock" that aects both supply and demand, it will be captured
by both us           d
            it and uit for i = USA. This is a concrete case in which supply and demand shocks are
correlated: this happens via the correlations in country-level shocks. Suppose that this correlation
                                            s
captures the common shocks, so that t         ? ud d t (where d are the residual granular weights given
by the demand-side relative size): then, we can identify the elasticity of supply, via ud d t . Likewise,
    s
if t  ? us s t then the GIV us s t allows to estimate the supply elasticity s . Section D.4 details this,
and gives more variants.
    One can also consider an economy as a network (Long and Plosser (1983); Gabaix (2011);
Acemoglu et al. (2012); Carvalho and Gabaix (2013); Carvalho and Grassi (2019)). Under some
assumptions, one can obviate the network structure, for instance via aggregation theorems such
as Hulten's theorem. This is developed in Section D.13. It shows that we can identify important
multipliers even if we have only crude proxies for the primitive shocks such as TFP. The GIV for a
general network is a rich topic, potentially for another paper ­ Section D.14 lays out some of the
basics.
    In conclusion, one can often handle cases where aggregate shocks are made of idiosyncratic
shocks: then, some more disaggregated data and economic reasoning allows to use a GIV to estimate
macro parameters of interest.

                                                      46
9     Conclusion
We developed granular instrumental variables (GIVs): we remark that idiosyncratic shocks oer
a rich source of instruments, and we lay out econometric procedures to optimally extract them
from aggregate shocks. Many econometric extensions might be useful, for instance with stochastic
volatility and various dimensions of autocorrelations. We leave those extensions to future research.
    We provided two empirical applications. Many more applications seem within reach, and the
introduction listed some. We hope that GIVs will aid identifications in new settings and help
researchers investigate and understand causal relationships in the economy.


References
Acemoglu, Daron, Vasco M Carvalho, Asuman Ozdaglar, and Alireza Tahbaz-Salehi, "The network
  origins of aggregate fluctuations," Econometrica, 2012, 80 (5), 1977­2016.

Adao, Rodrigo, Michal Koles´  ar, and Eduardo Morales, "Shift-share designs: Theory and inference," The
 Quarterly Journal of Economics, 2019, 134 (4), 1949­2010.

Amiti, Mary and David E Weinstein, "How much do idiosyncratic bank shocks aect investment? Evidence
 from matched bank-firm loan data," Journal of Political Economy, 2018, 126 (2), 525­587.

Amiti, Mary, Oleg Itskhoki, and Jozef Konings, "International shocks, variable markups, and domestic prices,"
 The Review of Economic Studies, 2019, 86 (6), 2356­2402.

Anderson, T. W. and Yasuo Amemiya, "The Asymptotic Normal Distribution of Estimators in Factor Analysis
 under General Conditions," The Annals of Statistics, 1988, 16 (2), 759­771.

Andrews, Isaiah, James H Stock, and Liyang Sun, "Weak instruments in instrumental variables regression:
 Theory and practice," Annual Review of Economics, 2019, 11, 727­753.

Antol´
     in-D´iaz, Juan and Juan F Rubio-Ram´
                                        irez, "Narrative sign restrictions for SVARs," American Economic
  Review, 2018, 108 (10), 2802­29.

Arellano, Manuel and Stephen Bond, "Some tests of specification for panel data: Monte Carlo evidence and an
  application to employment equations," The review of economic studies, 1991, 58 (2), 277­297.

Autor, David H, David Dorn, and Gordon H Hanson, "The China syndrome: Local labor market eects of
 import competition in the United States," American Economic Review, 2013, 103 (6), 2121­68.

Bai, Jushan, "Inferential theory for factor models of large dimensions," Econometrica, 2003, 71 (1), 135­171.

Bai, Jushan and Serena Ng, "Determining the number of factors in approximate factor models," Econometrica,
  2002, 70 (1), 191­221.

Baqaee, David Rezza and Emmanuel Farhi, "The macroeconomic impact of microeconomic shocks: beyond
  Hulten's Theorem," Econometrica, 2019, 87 (4), 1155­1203.




                                                       47
Bartik, Timothy J, Who benefits from state and local economic development policies?, W.E. Upjohn Institute for
  Employment Research, 1991.

Baumeister, Christiane and James D Hamilton, "Structural interpretation of vector autoregressions with
  incomplete identification: Revisiting the role of oil supply and demand shocks," American Economic Review,
  2019, 109 (5), 1873­1910.

Blanchard, Olivier Jean and Lawrence F. Katz, "Regional Evolutions," Brookings Papers on Economic Ac-
  tivity, 1992, 23 (1), 1­76.

Blundell, Richard and Stephen Bond, "Initial conditions and moment restrictions in dynamic panel data
  models," Journal of econometrics, 1998, 87 (1), 115­143.

Borusyak, Kirill, Peter Hull, and Xavier Jaravel, "Quasi-experimental shift-share research designs," NBER
  Working Paper No. 24997, 2020.

Brownlees, Christian and Geert Mesters, "Detecting granular time series in large panels," Journal of Econo-
  metrics, 2020.

Caballero, Ricardo J and Alp Simsek, "A model of fickle capital flows and retrenchment," Journal of Political
  Economy, 2020, 128 (6), 2288­2328.

Caldara, Dario, Michele Cavallo, and Matteo Iacoviello, "Oil price elasticities and oil price fluctuations,"
  Journal of Monetary Economics, 2018.

Camanho, Nelson, Harald Hau, and H´    el`
                                         ene Rey, "Global portfolio rebalancing and exchange rates," Technical
  Report, National Bureau of Economic Research 2020.

Caporin, Massimiliano, Loriana Pelizzon, Francesco Ravazzolo, and Roberto Rigobon, "Measuring
  Sovereign Contagion in Europe," Journal of Financial Stability, 2018, 34, 150­181.

Carvalho, Vasco and Xavier Gabaix, "The great diversification and its undoing," American Economic Review,
  2013, 103 (5), 1697­1727.

Carvalho, Vasco Miguel and Basile Grassi, "Large Firm Dynamics and the Business Cycle," American Eco-
  nomic Review, 2019.

Chodorow-Reich, Gabriel, "Geographic cross-sectional fiscal spending multipliers: What have we learned?,"
  American Economic Journal: Economic Policy, 2019, 11 (2), 1­34.

Chodorow-Reich, Gabriel, Andra Ghent, and Valentin Haddad, "Asset insulators," Review of Financial
  Studies, 2021.

di Giovanni, Julian and Andrei A Levchenko, "Country size, international trade, and aggregate fluctuations
   in granular economies," Journal of Political Economy, 2012, 120 (6), 1083­1132.

di Giovanni, Julian, Andrei A Levchenko, and Isabelle M´
                                                       ejean, "Firms, destinations, and aggregate fluctu-
   ations," Econometrica, 2014, 82 (4), 1303­1340.

Fama, Eugene F and Kenneth R French, "Common risk factors in the returns on stocks and bonds," Journal
  of Financial Economics, 1993, 33 (1), 3­56.


                                                     48
Forbes, Kristin J. and Roberto Rigobon, "No Contagion, Only Interdependence: Measuring Stock Market
  Comovements," The Journal of Finance, 2002, 57 (5), 2223­2261.

Gabaix, Xavier, "Power Laws in Economics and Finance," Annual Review of Economics, May 2009, 1 (1), 255­294.

Gabaix, Xavier, "The granular origins of aggregate fluctuations," Econometrica, 2011, 79 (3), 733­772.

Gabaix, Xavier and Matteo Maggiori, "International liquidity and exchange rate dynamics," The Quarterly
 Journal of Economics, 2015, 130 (3), 1369­1420.

Gabaix, Xavier and Ralph SJ Koijen, "In Search of the Origins of Financial Fluctuations: The Inelastic Markets
 Hypothesis," Available at SSRN 3686935, 2020.

Galaasen, Sigurd, Rustam Jamilov, Ragnar Juelsrud, H´
                                                    el`
                                                      ene Rey et al., "Granular credit risk," Technical
 Report, NBER Working Paper No. 27994 2020.

Gaubert, Cecile and Oleg Itskhoki, "Granular comparative advantage," Forthcoming at the Journal of Political
 Economy, 2020.

Goldsmith-Pinkham, Paul, Isaac Sorkin, and Henry Swift, "Bartik Instruments: What, When, Why, and
 How," American Economic Review, August 2020, 110 (8), 2586­2624.

Graham, Bryan S, "Identifying social interactions through conditional variance restrictions," Econometrica, 2008,
  76 (3), 643­660.

Heckman, James, "Dummy Endogenous Variables in a Simultaneous Equation System," Econometrica, 1978, 46
  (4), 931­59.

Jord`   `
    a, Oscar  , "Estimation and inference of impulse responses by local projections," American economic review,
  2005, 95 (1), 161­182.

Kelejian, Harry H and Ingmar R Prucha, "A generalized moments estimator for the autoregressive parameter
  in a spatial model," International Economic Review, 1999, 40 (2), 509­533.

Kilian, Lutz, "Not all oil price shocks are alike: Disentangling demand and supply shocks in the crude oil market,"
  American Economic Review, 2009, 99 (3), 1053­69.

Kilian, Lutz and Daniel P Murphy, "The role of inventories and speculative trading in the global market for
  crude oil," Journal of Applied Econometrics, 2014, 29 (3), 454­478.

Kline, Brendan and Elie Tamer, "Econometric analysis of models with social interactions," in "The Econometric
  Analysis of Network Data," Elsevier, 2020, pp. 149­181.

Koijen, Ralph SJ and Motohiro Yogo, "An equilibrium model of institutional demand and asset prices," Journal
 of Political Economy, 2019.

Kramarz, Francis, Julien Martin, and Isabelle Mejean, "Volatility in the small and in the large: The lack of
  diversification in international trade," Journal of International Economics, 2020, 122, 103276.

Kundu, Shohini and Nishant Vats, "Banking Networks and Economic Growth: From Idiosyncratic Shocks to
 Aggregate Fluctuations," Technical Report, Working paper Chicago Booth 2020.


                                                        49
Leary, Mark T and Michael R Roberts, "Do peer firms aect corporate financial policy?," The Journal of
  Finance, 2014, 69 (1), 139­178.

Lee, Youngki, Lu´  is A Nunes Amaral, David Canning, Martin Meyer, and H Eugene Stanley, "Universal
  features in the growth dynamics of complex organizations," Physical Review Letters, 1998, 81 (15), 3275.

Lewbel, Arthur, "Using heteroscedasticity to identify and estimate mismeasured and endogenous regressor models,"
  Journal of Business & Economic Statistics, 2012, 30 (1), 67­80.

Long, John B and Charles I Plosser, "Real business cycles," Journal of Political Economy, 1983, 91 (1), 39­69.

Ludvigson, Sydney C, Sai Ma, and Serena Ng, "Shock restricted structural vector-autoregressions," Technical
  Report, National Bureau of Economic Research 2020.

Manski, Charles F, "Identification of endogenous social eects: The reflection problem," The Review of Economic
 Studies, 1993, 60 (3), 531­542.

Montiel Olea, Jos´e Luis and Carolin Pflueger, "A robust test for weak instruments," Journal of Business &
 Economic Statistics, 2013, 31 (3), 358­369.

Nakamura, Emi and Jon Steinsson, "Identification in Macroeconomics," Journal of Economic Perspectives,
 August 2018, 32 (3), 59­86.

Newey, Whitney K and Kenneth D West, "Automatic lag selection in covariance matrix estimation," The
  Review of Economic Studies, 1994, 61 (4), 631­653.

Onatski, Alexei, "Testing hypotheses about the number of factors in large factor models," Econometrica, 2009, 77
 (5), 1447­1479.

Pasten, Ernesto, Raphael Schoenle, and Michael Weber, "Price Rigidity and the Origins of Aggregate
  Fluctuations," NBER Working Paper No. 23750, 2020.

Plagborg-Moller, Mikkel and Christian K Wolf, "Instrumental Variable Identification of Dynamic Variance
  Decompositions," Technical Report 2020.

Ramey, Valerie A, "Macroeconomic shocks and their propagation," in "Handbook of Macroeconomics," Vol. 2,
  Elsevier, 2016, pp. 71­162.

Rigobon, Roberto, "Identification through heteroskedasticity," Review of Economics and Statistics, 2003, 85 (4),
  777­792.

Sarto, Andres Pablo, "Recovering Macro Elasticities from Regional Data," Working Paper, 2018.

Schubert, Gregor, Anna Stansbury, and Bledi Taska, "Monopsony and Outside Options," Working Paper,
  2020.

Stock, James H and Mark W Watson, "Dynamic factor models, factor-augmented vector autoregressions, and
  structural vector autoregressions in macroeconomics," in "Handbook of macroeconomics," Vol. 2, Elsevier, 2016,
  pp. 415­525.

Stock, James H and Mark W Watson, "Identification and Estimation of Dynamic Causal Eects in Macroeco-
  nomics Using External Instruments," The Economic Journal, 2018, 128 (610), 917­948.


                                                      50
Stock, James H and Motohiro Yogo, "Testing for weak instruments in linear IV regression," in Donald WK
  Andrews and James H Stock, eds., Identification and Inference for Econometric Models: Essays in Honor of
  Thomas Rothenberg, Cambridge University Press, 2005.

Uhlig, Harald, "What are the eects of monetary policy on output? Results from an agnostic identification
 procedure," Journal of Monetary Economics, 2005, 52 (2), 381­419.




                                                   51
                                  Online Appendix for

                      "Granular Instrumental Variables"
                                Xavier Gabaix and Ralph S.J. Koijen

                                          December 5, 2020



Table of contents

C Proofs omitted in the paper                                                                          53
  C.1 Variance facts . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .   .   53
  C.2 Proof of Proposition 2 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .     .   53
  C.3 Proof of Proposition 3 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .     .   54
  C.4 Justification of the procedure in Section 2.5 for heterogeneous demand elasticities          .   55
  C.5 Proof of Proposition 4 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .     .   56

D Complements                                                                                          59
  D.1 Multi-dimensional actions . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .        59
  D.2 Heterogeneous demand elasticities: Non-parametric extension . . . . . . . . . . . . .            61
  D.3 Complements to the general procedure . . . . . . . . . . . . . . . . . . . . . . . . .           65
  D.4 When we have disaggregated data for both the demand and the supply side . . . . .                66
  D.5 When only some shocks are kept in the GIV . . . . . . . . . . . . . . . . . . . . . .            67
  D.6 When the researcher assumes too much homogeneity . . . . . . . . . . . . . . . . .               67
  D.7 Sporadic factors . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .     68
  D.8 Nonlinear GIV . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .        69
  D.9 GIV for dierentiated product demand systems . . . . . . . . . . . . . . . . . . . .              69
  D.10 When the variance-covariance matrix of the u's is estimated . . . . . . . . . . . . .           73
  D.11 Singular Factor Analysis . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .      75
  D.12 Full recovery when dierent factors have dierent "size" weights . . . . . . . . . . .            78
  D.13 Identification of the TFP to GDP multiplier in a production network economy . . .               79
  D.14 When the influence matrix is not proportional to size . . . . . . . . . . . . . . . . .         80
  D.15 Identification of social interactions and the reflection problem . . . . . . . . . . . .        82
  D.16 Identification of the elasticity of substitution between capital and labor / Elasticity
       of demand in partially segmented labor markets . . . . . . . . . . . . . . . . . . . .          83




                                                  52
E A Bayesian perspective on GIVs                                                                                                                                           85
  E.1 The general model: Bayesian version . . . . . .                                     .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .    85
  E.2 The supply and demand model of Section 2.2 .                                        .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .    87
  E.3 The basic example with self-loop of Section 8.2 .                                   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .    87
  E.4 The basic example without loop of Section 2.1. .                                    .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .    88
  E.5 Heterogeneous loadings . . . . . . . . . . . . . .                                  .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .    90

F Microfoundations for the model of sovereign spillovers                                                                                                                   92
  F.1 Model setup . . . . . . . . . . . . . . . . . . . . . . . . .                                           .   .   .   .   .   .   .   .   .   .   .   .   .   .   .    92
  F.2 Model solution . . . . . . . . . . . . . . . . . . . . . . .                                            .   .   .   .   .   .   .   .   .   .   .   .   .   .   .    93
  F.3 Quasi-static regime of stochastic processes . . . . . . . .                                             .   .   .   .   .   .   .   .   .   .   .   .   .   .   .    95
  F.4 Details on the data . . . . . . . . . . . . . . . . . . . . .                                           .   .   .   .   .   .   .   .   .   .   .   .   .   .   .    96


C        Proofs omitted in the paper
C.1        Variance facts
We will repeatedly use the fact that if (ui )i=1...N is a series of uncorrelated random variables with
                                2
mean 0 and common variance u      , then
                                                               
                                  E [u uE ] = 0,             E u2 = E [ uS u ] = h 2                              2
                                                                                                                  u.                                                      (68)

Hence, the standard deviation of the granular residual u t is proportional to the Herfindahl. In the
                                                                ~ = (V u ) 1
general heteroskedastic case, the quasi-equal weight vector is E      (V ) 1 
                                                                        u     . Then, for any such
that 0 = 0, we have:66
                                           E [ u uE
                                                  ~ ] = 0.                                      (69)


C.2        Proof of Proposition 2
The proof is quite elementary, and uses well-known ingredients. We have

                           e               ET [(ySt + "t ) u t ]                          E T [ "t u t ]   AT
                           T      =                                                =                     =    .
                                               ET [ySt u t ]                              ET [ySt u t ]    DT
 66                              ~ = k (V u )      1                  1
      Here is the proof. We have E                      for k =    (V u )   1
                                                                                
                                                                                   . So
                                  h               i
                                      ~ 0 u ( u0 ) = E
                                                     ~ 0 E [uu0 ]       ~ 0 V u = k  0 (V u )                     1
                  E [ u uE
                         ~] = E       E                                =E                                             V u = k 0 = 0,

as 0 = 0.




                                                                   53
Next, the law of large number gives:

                                              DT = ET [ySt u t ] !a.s. D,

with
                                                                                            
          D = E [ySt u t ] = E [(t + uSt ) u t ] = E [uSt u t ] = E [(u t + uEt ) u t ] = E u2 t =               2
                                                                                                                 u   .

    For the numerator, the central limit theorem gives the convergence in distribution:
                                                 p
                                                     T AT !d N 0,             2
                                                                              A     ,

where (assuming that "t is homoskedastic conditional on the uit 's):
                                            2          2  2 
                                    2
                                    A   = E "2
                                             t u t = E "t E u t =
                                                                                                2 2
                                                                                                " u   ,

so that
                                                 A           " u          "
                                                     =        2
                                                                   =          =:        .
                                               D              u           u

Hence,
                                             p      e
                                                 T (T         ) !d N 0,             2
                                                                                            .

Finally, if u0it s are i.i.d. across i's, then       u   =h        u,   see (68).


C.3       Proof of Proposition 3
We have
                               e               ET [(ySt + "t ) zt ]                     E T [ "t z t ]
                               T        =                                         =                    ,
                                                   ET [ySt zt ]                         ET [ySt zt ]
so the same proof as for Proposition 2 yields the asymptotic error

                                              " z                  " z                           "
                               ( )=                      =                    =                              .
                                        |E [ySt zt ]|        |E [uSt zt ]|         yS   |corr (uSt , zt )|

    So, the best estimator zt = u        t   maximizes the squared correlation C ( ) := corr (uSt , u t )2 :

                                             max C ( ) subject to 0 = 0.

We next solve this problem.
  Call V = V u the variance covariance matrix of the ui . We have:

                                                              E [uSt u t ]2   (S 0 V )2
                                    C 2 var (uSt ) =                        =     0V
                                                                                        .
                                                               var (u t )

                                                                   54
The problem is invariant to changing into     for a non-zero . So, we can fix say S 0 V at some
value. Given this, we want the minimum value of V . So, we minimize over the Lagrangian

                                                      1 0
                                              L=          V        b 0       c 0V S                                        (70)
                                                      2
                                                                                              0
with some Lagrange multipliers b, c. The first order condition in                                 is: 0 = V   b   cV S, i.e.

                                                                         1
                                                          = cS + bV          .

                                                                                      1
Now, using 0 = 0 gives 0 = c + b0 V               1                ~ :=
                                                      , i.e., with E            V
                                                                                          ,
                                                                                0 V   1


                                                                         
                                                          =c S         ~
                                                                       E .

                                                                                            e
The factor c doesn't aect the results, (as                    and c give the same estimator T ), so we may choose
c = 1.


C.4      Justification of the procedure in Section 2.5 for heterogeneous de-
         mand elasticities
                              d
In vector notation, yt =          pt + t + uit . We have
                                                                                      
                             yit =     d                                     d pt +  t + uit ,
                                       i pt   +   i t + uit = Xit


i.e.                                                                      
                                              yt = X t          d p t +  t + u t .

    The more abstract way to think about the procedure in the main text is the following. We form
the matrices R and Q from (21) (using  = X ) for any W at first, e.g. the identity matrix. We
                           t = Qut and the GIV is zt := S 0 u
        t := Qyt , so that u
define: u                                                        t . As a column of X is made of ones, we
also have zt = 0 u                                                                    t =  d pt +  t + Rut ,
                 t . Indeed, the cross-sectional regression of yit on Xit identifies y
and the residuals uit . We have y t = Ryt and u t = Qut .
                        s
    Then, we identify     using
                                         E [(st    s
                                                     pt ) zt ] = 0,                                    (71)
                                                                            1
which is valid for any W . Next, if we have W = c (V u )                         for some constant c, we can also estimate
 d using the moment (which is r-dimensional):67
                                                      h                 i
                                                  E       y
                                                          t       d p t z t = 0.                                           (72)

  67
    To see this, we form Ryt =  d pt +  t + Rut , and we have E [Rut u
                                                                     0 t ] = E [Rut ut Q ] = RV Q = 0, because (22)
                                                                                     0 0       u 0
                  u 0                  u  1
indicates that RV Q = 0 if W = K (V ) .



                                                                 55
To see this, we form Ryt =  d pt +  t + Rut , and we have E [Rut u 0t ] = E [Rut u0t Q0 ] = RV u Q0 = 0,
because (22) indicates that RV u Q0 = 0 if W = c (V u ) 1 for some scalar c.68
   To determine V u , we propose the following procedure. We first pick some W (e.g. the identity).
Then we use the N moments to identify V u (they come from V u    
                                                                   = QV u Q0 ):69
                                                2
                                                ii = (QV u Q0 )ii .
                                              E u

Now that we have V u , we form W = (V u ) 1 , and use the associated Q = QX,W and R, we form a
new GIV zt := S 0 QX,W yt , and use those to identify  d via (72).


C.5      Proof of Proposition 4
We first prove the proposition in the case where there are no controls Cit m and non-zero mean
values (so that m and the mean values do not have to be estimated). Once this is done, we treat
the case with controls and non-zero mean values.

A canonical decomposition The model can be written as:

                       yt = t +  ((M         1) uSt + "t ) + ut ,       Ftf = f M uSt + "f
                                                                                         t                      (73)

We next derive a "canonical representation" that, at the cost of some overhead and concepts and
notations, will make the identifiability very crisp.
   We take the constant case to alleviate notation, but we could have a time-varying t . We use
the Q and R matrices of (21), reproduced here:

                                                  1
                             R,W := (0 W )            0 W,       Q,W := I      R,W

where W will be specified soon and that we keep implicit here to alleviate notations.
  We decompose        =  +  0 , where  = Q is orthogonal to  --using the scalar product
modulated by W , hA, B i = A0 W B for two vectors A, B : for instance, h0 ,  i = 0 by (22)).
  This gives the following decomposition:

Proposition 5 (Canonical representation) When W = c (V u ) 1 for some constant c >0, we define
        0
 := Q S , and we have the following "canonical representation"

               yt =   t + yEt + u
                                t ,          yEt = (M         1) u t + "
                                                                       t ,                    f
                                                                              Ftf = f M u t + " t               (74)
  68
     If we take W as the identity rather than the "ideal" W above, the error in (72) is typically quite moderate: for
                                          1
instance, with X = , it is only of order N  .
  69
     See Section D.10. We assume that V u can be characterized by N moments, e.g. that V u is diagonal. In the
more general version we would use more moments from the identity E [        0
                                                                         ut u         u 0
                                                                              t ] = QV Q , and not just its diagonal
terms.


                                                         56
                                                                                                     
     t = Q ut and u t = S 0 u
with u                       t . Also, u
                                       t and u t are uncorrelated with     t , "f
                                                                       t, "     t , but the     t , "f
                                                                                            t, "     t
                                         
can be correlated between themselves; and ,  and ut are all orthogonal (using the scalar product
           0                  u 1
hA, B i = A W B with W = (V ) ). One advantage of this representation is that we have:

                       
                      R yt = t,       yEt = R yt = (M                   t
                                                               1) u t + "         Q yt = u
                                                                                         t                        (75)

with R and Q are the projection matrices defined in (21). Hence, we can recover         t and u
                                                                                              t by
                                                                             u :=
simple projections. Finally we have the following ancillary relations, with "t    R ut uncorrelated
                        f
with u
     t , u t , t, "
                   t , "t :

              t = t + " u
                        t,         t = "t + ( M
                                  "                1)      u
                                                        S "t   +   0 t,       f
                                                                              "      f   f
                                                                                t = "t +  M
                                                                                                 u
                                                                                              S "t



Proof of Proposition 5 We decompose ut = Q ut + I                         Q   ut , so:

                                           t + "u
                                      ut = u    t,             "u
                                                                t := R ut                                         (76)

Taking W = c (V u ) 1 has the important consequence that ut (an N dimensional vector) and "u
                                                                                           t (a r
dimensional vector) are uncorrelated. Indeed (dropping the superscript in R and Q for simplicity)
     h       0
               i             
    E ut R ut = E Qut (Rut )0 = E [Qut u0t R0 ] = QE [ut u0t ] R0 = QV u R0 = c 1 QW                 1
                                                                                                         R0 = 0

using (22). This is a generalization of our basic case that assumed uniform loadings on the aggregate
shock, R ut = uEt , we had that uEt and u    t were uncorrelated.
   We have
                               uSt = S 0 ut = S 0 Qut + S 0 "u            u
                                                             t = u t + S "t

We start from (73):

                   Ftf = f M uSt + "f   f
                                    t =  M (u t +
                                                                  u
                                                               S "t )   + "f   f
                                                                                       f
                                                                           t =  Mu t + " t


     f
with "      f   f      u
       t = "t +  M S "t .
   In the same way, (73) gives

               yt =       t +  ((M      1) uSt + "t ) + ut
                                                      u
                   =      t +  [(M     1) (u t +   S "t )            t + "u
                                                            + "t ] + u    t
                                                      u
                   =      t +  [(M     1) (u t +   S "t )        t with 
                                                        + "t ] + u         t = t + " u
                                                                                     t

                   = tt +  [(M                       u
                                        1) (u t + S "t ) + "t + 0        t as =  + 
                                                                   t ] + u                     0

                   = t t + yEt + u
                                 t




                                                     57
by defining
                                                                                   u
                        yEt = (M     1) u t + "
                                              t ,        "
                                                          t = "t + ( M     1)   S "t   +   0t

    
                                                      
    Note that t cannot be recovered without error by R yt , but  t can be. This is why the analysis
is easier in that space.
    This leads to the following procedure.

An identification procedure

  1. We set Q as in (21), we construct the GIV zt := S 0 Q yt , which implies that zt = S 0 Qut = u t .
                         e :=   
     We recover exactly t     R yt =     t.
                                             h            i
                                                 f
  2. To estimate  , we use the moment E Ft
                  f                                  f
                                                     ySt zt = 0, or, for more precision we can also
           h                               i
     use E Ftf f ySt        f
                               t (zt ,  t ) = 0. We can also do OLS, e.g. run Ftf = f M zt + f    t + et
       (calling et a random variable uncorrelated with zt ) and obtain an estimate of f M .

  3. We can also estimate M similarly, e.g. we can run the OLS yEt = (M                         1) zt + et , or even
                                                       e
     ySt = M zt + et . We can also add controls for t    . Indeed, as R yt = (M                  1) zt + et , we can
     regress: yEt = (M 1) zt +      t + e, with  t as control.

Proposition 5 implies that we can write

                     yEt = (M    1) zt + "
                                         t ,        ySt = M zt + "
                                                                 t ,       Ftf = f M zt + "
                                                                                          f t                  (77)

with zt uncorrelated with "t and " f
                                   t uncorrelated. Hence the assumptions of OLS are satisfied: the
OLS standard errors are thus correct. The same holds if we control for  t.
   Those standard errors are easy to calculate, repeating the arguments of the proofof Proposition
                                                                                              
                                                        f,e    f := f
                                                                                p     f,e        d
2. For instance, (77) implies that the OLS estimator  ~ T of ~      M satisfies T    ~T    ~f !
                                                                                           
        2
N 0,    ~f
        
              with
                                                f
                                                "                     1/2
                                       ~f
                                            =       ,        z   = E u2 t .                                    (78)
                                                z


Case with controls and non-zero mean values We treat the case where there are controls
  y
Cit . A very similar argument applies when there are in addition controls C F mF in the factors, and
additive constants (so that terms do not need to have a zero mean) in all equations.
     The model is then:

                                     y
   yt = t +  ((M          1) (uSt + CSt m ) + "t ) + C t m + ut ,        Ftf = f M (uSt + CSt
                                                                                           y
                                                                                              m ) + "f
                                                                                                     t         (79)

        t = R yt , i.e. y
We call y               it = yit yEt~ is the cross-sectionally demeaned value. Given a candidate
                                   
value m, we construct    t (m) := R (yt Cty m) and the associated zt (m) := S 0 Q (yt Cty m), as

                                                        58
we do in Section 4.1. Define  to be (m, M, ) and e to be the GMM estimator of  associated
with the following moments:
                                                                                
                                     E      y
                                            t         t 
                                                      x  t ( m)          ty W C
                                                                              ty = E [g1 (m)] = 0,
                                                                        mC                                  (80)
                        E [(ySt M zt (m)          y
                                                     t (m)) (zt (m) ,     t (m))] = E [g2 ()] = 0           (81)
                                                                                
                       E p t  M zt ( m )          f
                                                     t ( m) ( z t ( m) ,  t (m)) = E [g3 ()] = 0.           (82)
                                              p
Under the regularity conditions we assumed, h   T (e i ) converges
                                                             h           i in distribution a normal dis-
                                                 @ g 2 ( )     @ g 3 ( )
tribution with mean 0. Now, we notice that E @ m = E @ m = 0 (as @                    t (m )
                                                                                     @m
                                                                                             and @ z@
                                                                                                    t (m )
                                                                                                      m
                                                                                                           are
               y
proportional Ct ). Then, by Theorem 6.1 of Newey and McFadden (1994), the standard errors on
M,  are the same as if we did not have to estimate m. This is precisely the case we worked out
above, which proved that the standard errors on M and f M returned by OLS in this procedure
are valid when we do not have estimate m (or equivalently that m was known so that all Cit m terms
were removed). So this proves that this claim (that the standard errors on M and f M returned
by OLS in this procedure are valid) holds even when m needs to be estimated.70


D       Complements
D.1      Multi-dimensional actions
Suppose now that the action yit and idiosyncratic noise uit are q dimensional, for some q 1. For
instance, yit 's components might be the growth rate, and the labor share of firms of firm i, and then
q = 2. Then, the general GIV procedure extends well, as we shall now see.
    We call a 2 {1, . . . , q } (as in action) a component of y . We have:
                                                          X
                                                                  a        f
                                         yS a t =                 S a ,f F      + ua
                                                                                   Sat,
                                                           f
                                                                  X
                                            Ftf         f
                                                      = t +              f a
                                                                         a yS a ,t ,
                                                                    a

                                             P
   We can also estimate M (hence                  f   f   f
                                                              ), the f . Indeed, for "t a composite of aggregate
shocks,
                                                ySt = HySt + uSt + "t ,

where                                                              X
                                                                            f
                                                  H = A =                       f ,
                                                                     f

              a                   f
with af =     S a ,f   and Af a = a matrices with dimensions q  r and r  q respectively, so that H is
  70
    Note that the estimation of m need not be e cient: it is enough for the argument that the estimator of m be
consistent.


                                                               59
q  q , and
                                                   uSt = (ua
                                                           S a t )a=1...q .

This implies
                                                   ySt = M (uSt + "t ) ,                                                     (83)

there the multiplier M is now a q  q matrix:

                                                                          1
                                                    M = (I         H)         .

     We will form a GIV:
                                                          zt = u t ,

which is q dimensional: u = (ua a )a=1...q . We want, with E a = S a                                  a
                                                                                                          ,

                                                      E [uEt u0 t ] = 0

i.e., for all a, b, Qab = 0, where
                                                                   
                                                  Qab := E ua   b
                                                            Eatu bt .

Let us focus on the case where uit , ujt are uncorrelated for i 6= j , but for a given i, ua     b
                                                                                           it , uit can be
correlated (if a firm have a investment boom, it will likely hire more labor, so that the components
of its idiosyncratic shock in yit 2 Rq will be correlated.
    We have:                          X                                 
                               Qab =      Eia b  ab
                                              i vi ,
                                                         ab
                                                        vi  := E ua   b
                                                                  it uit .                            (84)
                                          i

For simplicity, we will suppose that that there are v ab and                          2
                                                                                      i   such that

                                                          ab       2 ab
                                                         vi  =     iv .                                                      (85)

                                     k                     P 1
Hence, we can simply take Ei =       2   with k =                  2   and set, for all a, Eia = Ei and       a
                                                                                                                  = Sa       E a.
                                     i                      j 1/   j
Then,
                                         X k                                      X
                                 Qab =               2
                                                         b 2 ab
                                                         i iv      = kv ab                 b
                                                                                           i   = 0,
                                              i      i                            i

so that we have achieved our goal that E [uEt u0 t ] = 0. In the more general case, other                                a
                                                                                                                         i   can
probably be found.
   Given (83), we have
                           ySt = M (uSt + "t ) = M (u t + uEt + "t ) ,

so
                                                          0              0
                                                  E [ySt zt ] = M E [zt zt ],



                                                              60
hence our estimator is
                                                          0          0                  1
                                              M = E [ySt zt ] E [zt zt ]                    .    (86)

     Finally, we can also estimate f M by regressing on zt :
                                   X
                          f
                    Ftf = t +           f a
                                        a           f
                                          yS a ,t = t           f
                                                      + f ySt = t + f M (u t + uEt + "t ) ,
                                    a

     f
so       = f M (a row vector) obtains by simply regressing

                                                    Ftf =        f
                                                                     z t + "f
                                                                            t,
                                 h       i
                                                  0 1
and get     f
                = f M ,   f
                              = E Ftf zt
                                       0
                                           E [zt zt ] .

Extension: causal estimation of the actor-specific multiplier The following is a refinement.
                                        P
We can also identify causally µi := i  = f f f
                                           i  . Indeed, use


                                                u   t, i   := u      t       Siu uit ,           (87)

which is the granular shock purged of a correlation with uit . Then, a shock uSt creates an impact
 dFt
duSt
     = M , hence an impact
                                          dyit
                                               = i M .
                                         duSt
Hence, we can identify µi , by regression

                                            yit = µi M u         t, i    +     i
                                                                                   C t + "y
                                                                                          it ,   (88)

with some noise "y it . This is the average impact of a causal impact of idiosyncratic shocks of the
other entities on entity i.


D.2       Heterogeneous demand elasticities: Non-parametric extension
Non-parametric version for d We present a variant of the procedure in Section 2.5, but now
with non-parametric heterogeneous demand elasticities d
                                                      i . The model is

                                                           d
                                                yt =           p t + t + u t ,                   (89)

We still assume parametric loading of unobserved factors  .




                                                                 61
D.2.1     Recommended procedure

We premultiply (89) by Q = Q and set x                      t = d pt + u
                                              t := Qxt . So y                t . With = Q0 S , we have
y t = d pt + u t . To ease on notations, we call := d . Given a candidate estimate c of we
form the associated GIV: zt ( c ) := y t      c
                                                pt .
    If we have the correct zt , the following moments hold71 , 72 , with bp = s 1 d the coe cient of the
                                                                                  S
first stage regression (34), pt = bp zt + "p
                                           t,

                                                   
                            E yt         d
                                          pt z t      = Vu ,               E [(pt bp zt ) zt ] = 0                    (92)
                                             2
                                         d p                                2
                            E y it       i t
                                                          u
                                                      = Vii ,             E zt   = 0V u                               (93)


which potentially allow to estimate, respectively, d , bp (hence s ) the Vii u
                                                                               and . Indeed, of we
                    d       p 73
know zt , we know     and b .
   We examine in more detail how to estimate := d . Calling the true value zt ( ) = u t , we
have E [zt2    2
            ]= u , where u2
                              = 0 V u is the theoretical variance of zt given in (93). So, we solve for
 c
   (a c andidate answer for ) so that the empirical variance of the GIV is equal to its theoretical
variance:
                                                   
                                       E zt ( c )2     2
                                                       u = 0

             c 2
i.e. E [p2
         t](  )  2 E [ y t pt ] c + E [ y 2 t ]        2
                                             = 0. This is a quadratic equation in c , which yields
                                                       u
                                                                                     p ]
                                                                                E [z t
two roots:74 a good (i.e. correct) root,              G
                                           = , and a bad root, B = + 2 E p               t
                                                                                           . Fortunately,
                                                                                   [2  t ]
there is an economic way to determine which is the correct root. Calling G (resp. B ) the estimation
with the good (resp. bad) root, one can show that:

                                                       bp,B =       bp,G ,                                            (94)

Hence, if we have a prior on the sign of of the first stage coe cient bp (e.g. we know that bp > 0
                                             
  71
     Indeed, we should have E yt     d
                                       p t zt = E [ u t zt ] = E [ u t ( u 0
                                                                           t )] = V
                                                                                    u
                                                                                                 =y
                                                                                      . Also, as u  p, and V u
                                                                                                             
                                                                                                                 = QV u Q0 .
  72
     As a variant, we decompose into the equal weighted version, which gives E : (we premultiply by E       ~0 )

                                                   E [(yEt
                                                        ~       ~ p t ) zt ]
                                                                E              =0                                      (90)

and the deviation from the mean, which gives i via:
                                                       
                                         E y it i pt zt = (QV u )i                                                     (91)


  73
     We recommend starting from the parametric estimates of Section 2.5, which gives potentially good starting
values for d ,zt and V u .
  74                    := c
     Indeed, calling                the error, we have
                      h           i          h            2
                                                            i   2                      2   
                                2                                           
                 0 = E zt ( c )       2
                                      u =E      zt     pt     E zt = 2 E [ zt pt ] +     E p2t




                                                             62
in a demand and supply model), we can choose the correct root as the one yielding a positive bp in
the first stage.

D.2.2     Justification

Justification of the proposed procedure Consider an econometrician who would use the bad
root:
                 B           B                     B                     E [ z t pt ]
                zt =y t        pt = u t + pt         pt = z t    pt , =2
                                                                         E [ p2  t]
                          B 
This bad root satisfies E zt pt = E [(zt  pt ) pt ] = E [zt pt ], so:
                                                                                h          i       2
                                                                                     B 2
                                E       B
                                       zt pt      =   E [ z t pt ] ,        E       zt         = E zt               (95)

    Hence, when estimating bp in the "first stage" via E [(pt bp zt ) zt ] = 0, the econometrician will
find:                                    B
                                     E   pt z        E [ pt z t ]
                             bp,B = h t i =                       = bp,eG                         (96)
                                     E (zt )
                                           B  2      E [ z 2
                                                           t ]

Hence, the coe cient in the first stage will have the wrong sign. This allows to find the correct
root.

A more general argument We show how even with other procedures there are two roots for an
nonparametric model with heterogeneous elasticities, and that fortunately (as in our recommended
procedure) there is a simple economic way to identify the correct root. The model is, in vector
form:
                             y t = t + p t + u t ,    pt = ySt + " t

with  = 1s , and we use notation "  t as we wish to keep the simpler notation "t for later. So solving
for ySt = M ( S t + S "  t + uSt ), M = 1 1 S  , we get, for a properly defined "¨t (an unimportant
linear combination of "t and t ), pt = M uSt + " ¨t , hence:

                            y t = t + "
                                      ¨t + M uSt + ut ,                              pt = "
                                                                                          ¨t + M uSt

We wish to estimate and M.
   We consider the vector Yt = (yt       0
                                           , pt )0 stacking together yt and pt . Then, with Ut = (u0t , 0)0 ,
  = ( 0 , 1)0 ,  = ( 0 , 0)0 , and adding a weight "0" to the last component of the vector S (extended
here to have 1 more component, with a mild abuse of notations) we have75

                                           Yt =  t + "
                                                     ¨t + M uSt + Ut                                                (97)
  75
    This idea of stacking together then yt and pt , with a "size 0" for the innovations to the price, could be fruitfully
used more generally.


                                                                       63
                                       1
i.e., with   := M , and "t :=            "
                                         ¨,
                                       M t


                         Yt = t + "t + uSt = t + "t + (I + S 0 ) Ut                                                (98)

   All the information is in V Y = E [Yt Yt0 ]:

                            0                   0                0
               VY    =    2
                                   +    2
                                        "           +   "   (        + 0 ) + (I + S 0 ) V U (I + S   0
                                                                                                         )         (99)
                            0               0
                     =    2
                                   +            + b0 + b         0
                                                                     +VU                                         (100)
                 b =      "       + V US                                                                         (101)
                     =    2
                          "   + S 0V U S                                                                         (102)

    The idea for the multiplicity of roots in is that we have a second degree equation in , so that
can have multiple roots ­ like in the one-dimensional case. Let us next calculate the roots, which
will lead to a procedure to identify the correct root. Forming the vector a = 1 b, we have

                                                                     1
                              (     a) (            a)0 = C :=           VY         2
                                                                                     
                                                                                      0
                                                                                          + aa0                  (103)

                                                                                                                       c
Suppose that we have estimated all the parameters, and it remains to estimate                        , i.e. solve in
(as in a candidate value for ) the equation:

                                                (   c
                                                        a) (     c
                                                                         a) 0 = C

We know that this identity holds under the correct root, so that C = (  a) ( a)0 . Now, there
are two solutions to equation XX 0 = DD0 , with X the unknown vector and D a known vector:
X = D and X = D. Hence, the two solutions are c a =               a and c a = (      a). The
                              G
first one is the "good" root,   = , and the second one is the bad root

                                                        B
                                                            = 2a                                                 (104)

Now, because p and Sp (i.e., the component of those vectors on the last coordinate, corresponding
to p) are both 0, we have bp = 0 (see 101) and thus ap = 0. So the component of the bad root on
the price is Bp = 2 ap    p =    p:
                                             B
                                             p =     p                                      (105)

This allows to distinguish between the two roots, as the right one has p = M and the other one
has p = M . Hence, if economic reasoning tells us the sign of M (e.g., it is positive in a supply
and demand context), we can pick the good root by inspecting the sign of p .




                                                                64
D.2.3    Another procedure for the nonparametric estimation of heterogeneous demand
         elasticities
                                              d
Recall the model (89). We replace                 by   for simplicity:

                                                   y t = p t + t + u t ,                                (106)

Unlike earlier, we now do not assume parametric knowledge of . We propose the following proce-
dure.

  1. Guess a candidate for , called c , and W = (V u ) 1 (initially, as it's enough to know all those
     up to a multiplicative factor, we might take c = , and W = I , or W = Diag (1/var (yit ))).
                         c
     We define Q := Q ,W , keeping W implicit in this step and the next. If c = , then

                                                   Q yt = Q           t + Q u t                         (107)


  2. We can apply the "singular factor analysis" procedure of Section D.11 to Q yt (so, in the
                                                       := Q ,  e , V u , u     
     notation of that section,
                               G
                                = Q ). This returns:             t       t = Q , ut . We form
                                     0
                                 ,
      zt := S 0 u
                t , and   := Q           S.

  3. We estimate bp and by (92). To gain some precision, instead of E [(yt                 pt ) zt ] = V u , we
                            1
     premultiply it by Q ,Vu , i.e. we solve for in the moment:
                                          h                              i
                                                1                                1
                                         E Q ,Vu (yt              pt ) zt = Q ,Vu V u                   (108)

      This is equivalent to controlling for the t in the regression.

  4. Given this new estimates of              and V u , we go back to step 1-3, and loop until convergence.

This algorithm also applies to the parametric case where we know that it = Xi  (Section 2.5), but
keep the loadings non-parametric. Then, in steps 1-2 we replace by X , and in the last step we
replace by X  and estimate  .


D.3     Complements to the general procedure
The procedure can be simplified in some cases. When we have a long time-series. Recall
that
                                      X f f
                                ySt =    St Ft + uSt .                           (109)
                                                         f

Hence, if all factors with f
                           St possibly non-zero are observables and exogenous, we can measure the
 f
 St by OLS with the regression above, and get uSt to be the residual. This is useful when we have



                                                             65
high-frequency data (e.g. daily financial returns), which can give an acceptably small error.76
    We can aggregate entities into categories . For this discussion, we replace "entity" by "firm".
We could aggregate the firms into K > 1 sub-categories (e.g. industries ­ or even an arbitrary
categorization like "blue firms" and "red firms") -- then the above works, but interpreting the
partition i as "aggregate firm category i" rather than "firm i". Indeed, (45) aggregates without
problem: if aggregate k is made of firm i 2 Ik , we just define the aggregate size of category k as
        P                                                                  S 1 2I k
S[k] := i2Ik Si , the relative weight of firm i in category k as ![k]i = iS[ik      , and the action factor
                                             P               f    P         f
                                                                                ]

loading as value-weighted averages (y[k],t = i ![k]i,t yit , [k] = i ![k]i i ). Then, the model works,
using those aggregated categories. What we do need is that categories have non-trivial idiosyncratic
shock (so that a "very small firms" category would not be valid, as it would have var (uit ) ' 0).


D.4        When we have disaggregated data for both the demand and the
           supply side
When we have disaggregated data for both the demand and the supply side, we can refine the
"exclusion restriction". So far we assumed that E [uit "t ] = 0, i.e. no covariance between idiosyncratic
demand and supply shock. If that's not the case, we can also decompose each supply with a factor
model:
                                        k
                                       yit = k pt + k     k
                                                      i t + uit ,
                                                                 k
                                                                                                      (110)
                                                                  
for type k = s, d for supply and demand. We allow E us          d
                                                            it uit to be nonzero: for instance, if the US
has a "fracking shock" that aects both supply and demand, it will be captured by both us             it and
  d
uit for i = USA.
                                                                 s       d
    The price pt adjusts so that supply equals demand, yS          st = y d
                                                                         S t
                                                                             (where Sid (resp. Sis ) is the
average fraction of demand (resp. supply) accounted by country i), i.e.

                                              ud
                                               Sd
                                                    us
                                                     Ss +
                                                               d
                                                                 d
                                                               Sd t
                                                                           s   s
                                                                           S s t
                                       pt =             s        d
                                                                                                             (111)
                                                        Ss       Sd

       Then, we have two GIVs, based on supply and demand respectively:

                                                k      k0 k
                                               zt :=     yt   = uk k t ,                                     (112)

                                                                                   k
for k = s, d (with k = S k E k in the basic case k = , and k = Q S k in the general case). We
can also form the dierence:
                                              d s      d   s
                                             zt    := zt  zt .                              (113)
                        k0
                                                                     k          
    Now, assume E uk it t   = 0 for k, k 0 in {s, d}. Then we have E yEt k
                                                                           pt zt = 0 for zt equal
                                                      
  76                                                  1
    Indeed, this time-series regressions gives an O p      error, which is good enough for large T . Using the cross
                                                       T
                                                  1
section, as in the basic procedure, gives an O pT   N
                                                       error.


                                                        66
            s     d                                                                  d     s
to either zt  or zt , or some combination of them. The optimal instrument is zt = zt    zt   , as this is
the most correlated with the price (111) (this generalizes the reasoning of Proposition 3). We can
also use an overidentification test like in Section 2.4, based on the those two GIVs based on supply
and demand.
                                ` k                                              k                 
    If we assume only that E zt  t = 0 for some (k, `), we can identify k via E yEt      k
                                                                                           pt z t`
                                                                                                    = 0.


D.5     When only some shocks are kept in the GIV
If we truncate the residuals, i.e. use
                                                X
                                         zt =              (Si (uit           uEt ))
                                                  i


for the hard thresholding function
                                                 ( x ) = x 1 |x|          b

for some b > 0, then everything works too. Indeed, we have that u   it := uit uEt is orthogonal
to uEt . Let us assume that it is independent. In our basic example of Section 2.1, we still have
E [(pt ySt ) zt ] = 0, so that the IV procedure (11) still works. Likewise, in the more complex
supply and demand case, the IV relations (31) and (33) still hold.
    Furthermore, the OLS estimates still hold. The key is that we can write:

                                                                  <
                                                u     t   = zt + zt ,

                              <
                                    P                              <
where  < (x) = x1|x|<b , and zt  = i  < ( Si uit ), so that zt ? zt  . Hence, regressing u     t   on this
truncated zt gives a coe cient of 1, and all the analysis goes through.


D.6     When the researcher assumes too much homogeneity
Take the supply and demand example, and imagine that the econometrician assumes a homogeneous
elasticity of demand d , even though there are in fact heterogeneous elasticities d
                                                                                  i . What happens
then?
    The model (24)-(25) becomes, for the demand:

                                                      d
                                          yit =       i pt   +      i t   + uit ,

and for the supply
                                                             s
                                                st =             p t + "t .




                                                             67
As supply equals demand, ySt = st , which gives the price

                                                                  uSt +         S t          "t
                                                        pt =                  s    d
                                                                                                  .                                             (114)
                                                                                   S

   In this thought experiment, the econometrician assumes identical elasticities of demand across
countries, di =
                  d
                    . He runs a panel model for yit yEt , and we assume that it's large enough that
he can extract t , successfully.77 The GIV (we use the notation Zt rather than zt to denote the GIV
before controls by t ) is then
                                                                                     d
                                                                                                 
                                  d                                                                            Z          1          Z
                Zt := y   t   =       pt +     t + u      t   =      1+         s            d
                                                                                                      u t+         ~t =
                                                                                                                              u t+       ~t ,
                                                                                             S

so
                                                                                                      s      d
                                                    1              Z                 1                       E
                                             Zt =       u t+           ~t ,                  =        s      d
                                                                                                               ,                                (115)
                                                                                                             S

where 1 = 1 in the common-elasticity case, ~t = (t , "t , uEt ) gathers the common shocks, and                                                   Z
                                                                                                                                                     is
a vector of loadings.
   Hence, when we run the first stage

                                                        p t = b p Zt +          p
                                                                                    t + " p
                                                                                          t,


we will gather
                                                                               1
                                                              bp =        s          d
                                                                                         .
                                                                                     E

If we run
                                                        st = b s Zt +           s
                                                                                    t + " s
                                                                                          t,

we will estimate                                                                s
                                                              bs =        s          d
                                                                                         .
                                                                                     E

The ratio of the two coe cients still gives s . Likewise, the IV on the elasticity of demand will give
 d
 E.
    In the polar opposite case where t cannot be estimated or controlled for, then the simple
procedure becomes biased, however, as (115) shows. To fix it, one can estimate the model with
non-parametric coe cients (Section D.2).


D.7        Sporadic factors
A potential issue is that of a "sporadic factor", i.e. a factor t that aects a few actors special
ways, but is not recurrent. An example would be a one-o policy announcement by the European
 77
      One of the factors, formally, will be pt . We assume that it is not included in the vector of factors t .


                                                                         68
Central Bank that they will buy both Italian and Spanish bonds, so that the truth is not that Italy
is aecting Spain or vice-versa, but rather the ECB aecting both.
    One solution, besides the narrative check that we just detailed, would be to filter out days with
a high "sporadicity statistic" St that we now propose. Suppose that for each date we filter out
                                                                           2
                                                                           u
the idiosyncratic shocks uit . For each date and actor i we form bit = 2 it , where a high bit is
                                                                                                    ui ,t 1
                                      2
an indicator of extra activity, and u   i ,t 1
                                               is a predictor of the volatility of uit . We may allow that
one entity has a large idiosyncratic shock, but if two (or more) do, this is suspicious, and possibly
the sign of a sporadic factor. So, calling b(2)t the activity of the second more active actor, we form
St = b(2)t .78 Over the entire sample, we might remove the days with anomalously high sporadicity
statistics, e.g. in the top 5% by that metric.


D.8        Nonlinear GIV
                                                                                                s
We imagine a nonlinear GIV. Suppose that instead of the simple st =                                 pt + "t (equation (25)) we
have a more complex
                                     st = ( p t , s ) + "t                                                               (116)

for    a nonlinear function. We can use the moment:

                                                  E [(st          (pt ,    s
                                                                               )) zt ] = 0                               (117)

and can still identify a one-dimensional s . For a higher-dimensional                                 s                   2
                                                                                                          , we might add zt as
instrument, though the instrument becomes weaker.


D.9        GIV for dierentiated product demand systems
We develop the basic ideas for the logit demand model and extend these ideas to the random-
coe cients logit model as in Berry et al. (1995a) in the next subsection.79

D.9.1       Logit demand

The utility that household h derives from product i, for i = 0, ..., N, is given by80

                                          Uhit =           it   + ehit ,
                                                                           0
                                             it    =            pit +          xit + i + it ,
  78
     We   could also sum over the most active K entities, excluding the most active one.
  79
     We   thank Robin Lee, Alex MacKay, and Ariel Pakes for very helpful feedback on this section.
  80
     We   use the log price, pit , instead of the price, Pit , in the formulation of it to simplify some of the expressions,
but the   basic logic extends to the case where it depends on Pit .




                                                                    69
where ehit follows a Type-1 extreme-value distribution, pit denotes the log price, xit observable
characteristics, and E [it ] = 0. We refer to i = 0 as the outside option and normalize 0t = 0. This
model implies that the market share sit is the probability that a given household selects product i,
meaning that sit = P (Uhit > maxj 6=i Uhjt ), and can be expressed as

                                                      exp( it )
                                              sit = PN              .
                                                     j =0 exp( jt )


Firms set prices to maximize profits and we assume that each product is produced by a single firm,
which solves
                                        max Qit (Pit Cit ) ,
                                               Pit

where Cit equals marginal cost and Qit = sit Qt with Qt the total size of the market. The firm
optimally sets the price to                         1
                                                1
                                    Pit = 1           Cit ,
                                                it
where it = @@ ln sit
               pit
                     , that is, the negative of the price elasticity of demand. The goal is to estimate
 = ( , ).
  It is convenient to rewrite the model as
                                       
                                        sit
                                  log        =     pit + 0 xit + i + it .
                                       s 0t

To identify , it is commonly assumed that E [xit it ] = 0 and we maintain this assumption. However,
as prices respond to demand shocks, it , we cannot assume E [pit it ] = 0. There are three common
approaches to create instrumental variables in the demand estimation literature. First, variables
that capture variation in marginal cost, Cit , that is unrelated to demand shocks. Second, Berry et
al. (1995a) suggest to use the average of characteristics of other firms

                                                          1      X
                                             BLP
                                            zit  =                        xjt ,
                                                      N       1 j,j 6=i

which results in valid instruments under some assumptions (see Nevo (2000) and the references
                                           BLP 
therein).81 The resulting moment is E zit       it = 0.82 Third, one can use panel data for the
same firm that operates in dierent locations. Under the assumption that demand shocks are
uncorrelated across locations, prices in other locations of the same firm will be valid instruments.
The intuition is that prices across locations share the same marginal cost but the demand shocks
are, by assumption, uncorrelated, see Nevo (2001).
  81
    For other recent advances to construct instruments, see Sweeting (2013) and MacKay and Miller (2019).
  82
    If a firm oers multiple products, the average of characteristics of other products produced by the same firm can
be used as well.



                                                        70
   GIV provides an alternative by exploiting exogenous variation in markups due to idiosyncratic
demand shocks to large firms. We assume that demand shocks follow a factor model,

                                               it = t + uit ,                                            (118)
                                                                                            P
which can be extended to allow for heterogeneous exposures, i.e. replacing t by i t = k k           k
                                                                                                 i t .
Also, we assume for simplicity that t and uit are i.i.d. over time, but the logic in this section can
be extended to persistent demand shocks (see also Sweeting (2013)).
   We propose to use the GIV instrument as the weighted sum of idiosyncratic demand shocks of
the competitors:
                                             X
                                       zit =     s
                                                 ¯j,t 1 ujt ,                                   (119)
                                                  j :j 6=i

where s
      ¯j,t 1 is the average market share for product j up to time t                 1. This allows us to add a
moment condition
                                           E [zit it ] = 0,                                              (120)

which identifies . Remember that we use E [xit it ] = 0 to identify .
     The intuition for why zit is a meaningful instrument is the following: if there is a high idiosyn-
cratic shock for Tesla cars (high ujt , with j being Tesla), this leads Ford (firm i) to reduce the price
of its cars (in this particular model, this is because the positive shock for Tesla cars reduces the
demand for Ford, which sees its market share sit falls, so that it wants to lower its price pit ).
     Generalizing this intuition, we sum over all the demand shocks of the competitors, zit =
P
   j :j 6=i s
            ¯j,t 1 ujt , weighing them by size, i.e. market share. As in our general GIV, even a single
shock ujt is a valid instrument (for j 6= i). The size-weighted sum is simply a typically useful way
to pool those idiosyncratic shocks. It is optimal in our basic GIV, and is likely to be reasonably
close to optimal in this IO context. The same idea generalizes: e.g. using a weighted sum of the
idiosyncratic cost shocks, rather than demand shocks, of the competitors would also be a valid GIV
instrument.
     A motivation for the weighting in (119) is as follows. Recall that in this simple model the
demand elasticity is
                                                  it = (1 sit ),

and also that @ log
                @ jt
                    sit
                        = sjt , so that @ @
                                          log sit
                                            ujt
                                                  = sjt (controlling for the price pjt ). This implies that
the direct impact of all idiosyncratic demand shocks to other companies on sit , and hence it , is
                                     X @ log sit             X
                                                     ujt =              sjt ujt .                        (121)
                                     j :j 6=i
                                              @ u jt
                                                             j :j 6=i


Hence, shocks to companies with larger market shares have a larger impact.



                                                       71
D.9.2    Random coe cients logit as in BLP

Berry, Levinsohn and Pakes (1995a) extend the standard logit model by allowing for random vari-
ation in the preference parameters
                                         h =  +  h ,
                     
where h = h , h and h  F ( ; ), for some vector of parameters . The market share
equation modifies to                     Z
                                         sit =        shit dF ( ; ) ,
                                                   

where                                                                              
                                           exp        it         h pit + h 0 xit
                                shit = P                                               .
                                         N
                                          j =0 exp         jt        h pjt + h 0 xjt

To estimate the model, Berry (1994) suggests to recover it from the market shares using a contrac-
tion mapping (see Nevo (2000) for an introduction). With it in hand, we form moment conditions
as before to estimate (, ).
    To construct a GIV instrument in this model, one can also use (119) as an instrument.
    One can also refine it. For instance, we can recompute the total impact of idiosyncratic shocks
to other firms on the demand elasticity, which is now slightly more involved. The negative of the
demand elasticity, which enters into the pricing equation via the markup, is given by
                                      Z
                                            shit
                                 it = h          (1 shit ) dF ( ; ) .
                                            sit

An approximation of the model around h =  yields the same weights as before, although it is
feasible to numerically calculate the optimal weights by computing
                                                 X @it
                                                               ujt .
                                                 j,j 6=i
                                                         @ ujt

This suggesting forming                               X
                                           zit :=                si
                                                                  j,t 1 ujt ,                        (122)
                                                      j :j 6=i

where si
       j,t is
                                                             @ log sit
                                             si
                                              j,t :=                   .                             (123)
                                                               @ ujt
Indeed, in the homogeneous elasticity case, si  j,t = sjt . This generalization to heterogeneous elasticity
allows to capture that if firms i and j tend to serve the same consumers (e.g., both sell family cars),
then the sij,t will be high, and ujt receives a high weight in the firm-i specific GIV zit .




                                                           72
D.10       When the variance-covariance matrix of the u's is estimated
In some cases, we'll want to identify the matrix V u . We discuss this in Section 4.2. We add some
thoughts on extensions here.
    A simple su cient condition is the following.

Assumption 3 (Restriction on the admissible variance-covariance matrix of residual ut ) (a) The
variance-covariance on ut is diagonal. (b) The function V 7! QV Q0 from the space of diagonal
matrices is injective.

     Assumption 3(a) could be relaxed in number of ways.83 Other su cient condition for identifi-
cation might be that V u is k sparse, e.g. has at most k non-zero o-diagonal elements, for some
k , e.g. N r2 (see also Zou et al. (2006)). Another is to allow for some correlation that depends
on the distance between entities i and j , perhaps via Gaussian processes (Rasmussen and Williams
(2005)). We conjecture that this proposition could be generalized in a number of ways, including in
the large T, N domain, using material such as Bai and Ng (2006). Doing this would however take
us too far afield.
     Assumption 3(b) is equivalent to saying that knowing the variance-covariance matrix of the
residuals u
          t = Qut allows to get the variance of the ui 's. We have explored su cient conditions on
the X for that to hold, but they are not particularly enlightening.84 , 85 We now show how to do that
in the most basic (and useful) case.

D.10.1     When the ui are uncorrelated (but heteroskedastic) and only ui                            uE is mea-
           sured

We suppose that the u0i s are uncorrelated, with variance             2
                                                                      i      = var (uit ). We only measure u
                                                                                                           it =
                                             2
uit uEt . Here's a bit of algebra to recover i .
               2 := 1
                       P    2
   We define E      N     i i . We have:

                                           2
                                                                                          2
                                           E                      2            2          E
                            var (uE ) =        ,   var (uit ) =   i      1            +                     (124)
                                          N                                    N          N
  83
      However, relaxations of Assumption 3 will still need to ensure some restrictions on the space of variance-
covariances allowed.
   84
      If we estimate V u via V u 
                                  , we need: 12 (N  r) (N r + 1)    N as the projection Q on a space of dimensions
                      1
N r leaves only 2 (N r) (N r + 1) degrees of freedom. So in some cases with very small N one may want
another procedure to estimate V u , perhaps simply using the whole of V y .
   85
      Note that a necessary (and often su cient) conditions is that the number of parameters to be estimated is not
too big. Take the problem where we mostly are interested in estimating multiplier M , and have not extraneous
observable factors. Matrix V y gives 1    2 N (N + 1) parameters. We want to estimate: the nV
                                                                                               u (equal to N if we

assume a diagonal matrix V u , equal to 1 is we assume homoskedasticity), parameter M , and matrix V  (which has
1
2 r (r + 1) degrees of freedom). If the factor model is parametric with Xit a r dimensional vector, then we need:
1
2 N (N + 1)      1+ 12 r (r + 1) + nV .
                                      u




                                                        73
which implies:                                                                                      
                                         2        1 X                            2              1
                                         u
                                         ^,E   :=     var (uit ) =               E      1                                            (125)
                                                  N i                                           N
So, we can recover
                                                                                 2
                                                                                 u
                                                                                 ^ ,E
                                                    2
                                                                var (uit )       N 1
                                                    i   =                    2                                                       (126)
                                                                     1       N

If the estimation has a small error, the optimal thing to do is to define E as E 0 in (518), and then
   = S E.

D.10.2        A simple recovery procedure

More generally, suppose that we have u   t = Qut for a known square matrix Q (e.g. that in (21)).
Suppose that we assume that V is diagonal, and we know V u
                                u                              
                                                                . Call D and D  the vectors with the
diagonal elements of V u and V u                                              i = var (
                                  , respectively, so that Di = var (ui ) and D         ui ). Then we
have with the matrix Hij := Q2ij , we have:
                                            86



                                                                 = HD
                                                                D                                                                    (127)

                                                                                      2
Hence, when H is invertible (which is typically true), we can recover the variance of u i
                                                                                          = Di by
         1  87
D = H D. One disadvantage of this procedure is that it does not guaranty that Di is positive
(indeed, in (126), the right-hand side is not necessarily positive).

D.10.3        An MLE-based recovery procedure
                                                                   2
Here is another procedure, which guaranties to recover positive u    i
                                                                       . We suppose that we know
u
t = Qut for a known matrix Q (e.g. that in (21), but not necessarily), do not know the underlying
ut . We want to recover V u , assumed to be diagonal. The dimensions of ut and ut are respectively
n and m, with potentially m 6= n. So Q has dimensions m  n.
                                                                                                           P
  86
       Proof: Calling ei the vector with 1 at coordinate i and 0 elsewhere, we have V u =                      j   ej e0          u
                                                                                                                                       u 0
                                                                                                                       j Dj . As V = QV Q ,
                                                        X                               X                  X
                        i = e0
                       D        u      0   u 0
                             i V ei = ei QV Q ei =               e0      0 0
                                                                  i Qej ej Q ei Dj =            Q2
                                                                                                 ij Dj =       Hij Dj .
                                                            j                               j              j


  87                                                          2
    Numerically, with in finite samples, we can get negative u  i
                                                                  (see (126)). So, one can imagine variants that
guaranty positivity, e.g. adding a winsorization step, Di := max (Di ,  median (Dj )) for a low  such as  = 0.5.
Another procedure is to do
                                 min D HD 2 subject to minDi  median(Dj )
                                     D

                                     i . Yet another variant is to minimize kV u                                          2
or another constraints, e.g. Di     D                                          
                                                                                                       QDiag (Di ) Q0 k , subject to those
constraints.




                                                                    74
   We do a singular value decomposition of Q. We call its rank k . We can write:

                                                Q = U DV                                                (128)

where U and V are unitary matrixes with dimensions m  m and n  n respectively, and D is
rectangular diagonal with dimensions m  n, and V  is the conjugate transpose. We order the
diagonal elements of D, di , so that
                                   the first d1 , . . . , dk are non zero, while the remaining di 's are
zero. We set  := Ikk 0k(m k) and set B :=  U  , both with dimension k  m. We define

                                                  u
                                                  ¯t := B u
                                                          t                                             (129)

which is a k dimensional vector that gathers the useful k degrees of freedom in u     t . While V u
                                                                                                     was
                      u
                      ¯
singular, typically V has full rank. So, u¯t = M ut with M = BQ.
     To recap, we have u¯t = M ut with M a k  n matrix of rank k  n. So, V u      ¯
                                                                                    = M V u M 0 . We call
           ¯ 1                                           1
                                                           P T
Wu ¯
      = (V u ) the theoretical inverse variance, V u
                                                   ¯,e
                                                       = T       ¯0t u
                                                             t=1 u   ¯t the variance of u
                                                                                        ¯t . We assumed
        u           2        2
that V = Diag u1 , . . . , un . We assume that

                                               1
                                                 k (k + 1)    n
                                               2
The left-hand side is the number of degrees of freedom in V u
                                                            ¯
                                                              : it should be higher than the number
                                           u
of parameters n we want to estimate for V .
    The log likelihood L is (we omit some constants in 2 , and use the notation |W u       ¯
                                                                                             | for the
determinant of W u ¯
                     ),

                     2L
             ` :=        = ET [tr (¯  u0t W u
                                            ¯
                                              ¯t )] + ln |W u
                                                            ¯
                                              u               |=   tr (ET [¯  ¯0t ] W u
                                                                           ut u       ¯           ¯
                                                                                        ) + ln |W u |
                     T
             ` =             ¯,e
                       tr (V u   Wu
                                  ¯
                                    ) + ln |W u ¯
                                                  |                                                     (130)

   We recover V u by maximizing numerically ` over the             2
                                                                   ui   > 0.


D.11      Singular Factor Analysis
We propose a tool useful in the advanced parts of this project: A way to do factor analysis with
singular matrices.
    Suppose that we have an underlying factor model:

                                              Yt =  t + ut ,

where Yt and ut have dimension N , and t dimension r, but we only observe:

                                                 Yt = GYt

                                                      75
for a known matrix G such that G2 = G (e.g. G could be a Q matrix as in (21)). But potentially
G has less than full rank, so that V Y is singular. We present a procedure to estimate V u (assuming
that it has some structure, here that it is diagonal), and also recover  := G and a proxy for the
t .

Projecting Yt in into a lower-dimensional yt We do an eigendecomposition of G. Calling K
the rank of G, we can write:
                                             G = A 1 DA                                      (131)
                      !
                 IK 0
where D =               , and A 1 is the matrix whose columns are the corresponding eigenvectors of
                  0 0
                                    
   88 , 89
G.         We introduce  := IK 0 and set B :=  A, both with dimension K  N . . We have90

                  D =  0 ,         D = ,            B =  A,              BG = B,        A 10B = G                (132)

       We call
                                                        yt := BYt                                                (133)

which is a K dimensional vector that gathers the useful K degrees of freedom in Yt . While V Y was
singular, typically V y has full rank. With := B  (dimension: K  r) and vt := BGut = But
(dimension: K  1) we have:
                                           y t = t + v t                                      (134)

Doing PCA on yt           We have

                                                                0
                                                Vy = V              + V v,

   The first PCs in a PCA of V y will not be , unless V v is proportional to the identity matrix.91
Ideally, we'd like then to estimate the PCA on Lyt = L t + Lvt , for L = k (V v ) 1/2 (with k an
  88
    We order the columns of A 1 with first the eigenvectors with eigenvalue 1, then those with eigenvalue 0.
  89
    We found that Matlab could get lost, and return complex eigenvectors, even though G2 = G ensures that the
eigenvalues are 0 and 1, and all eigenvectors are real. One fix to this numerical implementation issue is the following.
We observe that in practice the G = Q ,W come from 21. Then, calling H = W 1/2 ,then G              ~ = H 1 GH is a
symmetric matrix,
                    sothat Matlab recognizes that the eigenvectors should be all real (to be numerically safe, we
                ~
entered it as G + G ~ 0 /2). Then, if e is an eigenvector of G~ with eigenvalue k , He is an eigenvector of G~ with the
sam eigenvalue k . This way, we recover real eigenvectors of G.
  90
     Indeed, BG = ( A) A 1 DA =  DA =  A = B , and
                                       1 0        1 0               1
                                   A    B=A          AG = A             DAG = GG = G.


  91
    Indeed, if V v is proportional to the identity matrix, then V y is proportional to , so that the column vectors
of are eigenvectors of V y (and PCA, which extracts the eigenvectors, will successfully recover ). But this is not
the case if V v is not proportional to the identity matrix.


                                                           76
constant) because then the covariance of residuals Lvt will be proportional to the identity, and the
PCA will correctly recover L . But we do not know V v : we need to estimate it.
   This motivate the following algorithm. For an invertible matrix V of dimensions K  K , call92
                                                               r
                                                         1/2       |tr (V )|
                                           J (V ) := V                                                        (135)
                                                                      K

The trace (tr) factor is there so that the transformation V 7! J (V ) V J (V ) keeps the "size" of V
(as measured by its trace) fixed:
                                       tr (J (V ) V J (V )) = tr V                             (136)

Also, if V is proportional to the identity matrix I , then J (V ) = I .
   So we can envisage the following scheme: We start with L0 = IK .

   1. We do a PCA on ynt := Ln yt , so do ynt = Ln t + v
                                                        nt and get the residuals, v
                                                                                   nt .

   2. We define ut := A 1  0 Ln 1 v
                                   nt . We note that v nt = QLn ,IK Ln vt and vt = But , so that
      nt = qn ut with matrix qn := A 1  0 Ln 1 QLn ,IK Ln B . As the rank of is r, matrix qn as
      u
      dimension N  N but only rank K r. From V un we obtain Vn          u
                                                                          , using the procedure in
      Section D.10.2, observing that u nt = qn ut .
                                                                                                      2
       (a) We can use the procedure in Section D.10.2, but it does not guaranty that                  ui   is always
                                                            2
           positive. (Then, some winsorization can impose u   i
                                                                > 0).
       (b) Alternatively, we can use the MLE procedure of Section D.10.3 which does guaranty that
            2               93
            ui is positive.

                       v           v :=    u 0
   3. Set Ln+1 := J (Vn  ), with Vn     BVn B.
                                                     1
   4. Iterate steps 1-4 until convergence (e.g. Ln+1   Ln I < 0.01). As a check, we note that
                          L n vt        v
      at convergence, V          = Ln Vn Ln should be close to proportional to the identity matrix
           Ln V nvL
      ( tr(Ln V v Lnn)/K I should be small).
               n


The procedure returns V u,e = Vnu
                                  . It also returns the factors  t (up to a rotation, as usual). We
also obtain an estimator of :
                                        e = A 1  0 L n 1 ( Ln )                                (137)

where Ln is estimated from the PCA in Step 1.94
  92
     Given a positive definite matrix V , and  a scalar, V  is defined as follows. Do an eigendecomposition V =
P P 1 , where the columns of P are the eigenvectors of V , and         = Diag ( i ) is the diagonal matrix with V 's
eigenvalues. Then, we define V  = P Diag (    i )P
                                                   1
                                                     . We apply this to  = 1   2.
  93
     We can alternatively use the same procedure to v  nt = QLn ,IK Ln But as the observed vector, rather than going
through the higher-dimensional u t as the measured vector.
  94
     Indeed, then at convergence e = A 1  0 = A 1  0 B  = G = GG = G = , by (132).



                                                         77
D.12      Full recovery when dierent factors have dierent "size" weights
In the basic model, we can identify f , M =                             P1          f f      , but not                f
                                                                                                                          .
                                                                1           f

     We give some conditions under which we can actually also identify the f (in addition to f
and M ). We show here that this is the case if we assume that the size S f diers across all factors
f , and this knowledge is given to us (from a model).
     Here we take the basic set up as in Section 3.1, in the simplified case where f i =
                                                                                          f
                                                                                             for all
                                                       f
"endogenous" factors, i.e. for the factors f such that  6= 0, the other exogenous factors  all have
an impact of 1:
                                                                        X
                                           yit = uit +                                   f
                                                                                             Ftf + t
                                                                                                   y
                                                                                                     ,                                                     (138)
                                                                            f

                                           Ftf              f      f
                                                      =  yS f ,t + t .                                                                                     (139)

This implies                                                                                                                       
                                 X                                                  X
                                                                                                                              f0
                   y t = ut +          f
                                           Ftf   +    y
                                                      t     = ut +                                    f       f
                                                                                                              t           f  y
                                                                                                                  +  S yit + t .
                                 f                                                    f

With ""k " denoting some combination of the various  's, and as usual M =                                                                 P1           ,
                                                                                                                                      1    f   f   f


                                                                                             !            1
                                                            X
                                                                        f       f     f0
                                 yt =            I                           S                                ut + "1
                                                                                                                    t
                                                            f
                                                                                                      !
                                                                X                                 0
                                                                                f
                                       =         I + M                              f S f                     ut + "1
                                                                                                                    t
                                                                    f
                                                            X
                                 y t = ut + M                               f
                                                                                f uS f ,t + "y
                                                                                             t,                                                            (140)
                                                                f


i.e., since that Ftf = t
                       f
                         + f yS f ,t this gives:
                                                                                                                  !
                                                                            X
                                 Ftf   = f            uS f ,t + M                            g
                                                                                                 g uS g ,t            + "f
                                                                                                                         t.                                (141)
                                                                                g


   Hence, suppose that we extracted the uit = uit uEt (following our usual procedure). Then, we
form
                                              0
                                  z f t := S f ut = uS f t uEt .                          (142)

Then, regressing Ftf on the various z            gt


                                                            X
                                                 Ftf =                  bf
                                                                         gz         gt    + "f,
                                                                                             t
                                                                                                1
                                                                                                                                                           (143)
                                                                g




                                                                        78
(for "f 1 some residual noise) yields a regression coe cient:

                                         bf   f
                                          g =  (1f =g + M
                                                                      g
                                                                          g ) .                       (144)

      This allows to recover everything, and with several overidentifying restrictions. Indeed,
                                                                                  !
                                     X                           X
                             bf :=       bf
                                          g = 
                                               f
                                                    1+M                   g
                                                                              g       = f M,
                                     g                            g


which identifies f M . Next, for f 6= g ,
                                                   bf
                                                    g       g
                                                      =         g ,
                                                   bf
which gives g g (and should be equal for all f ), hence M . Hence, we obtained f M , M and              g
                                                                                                            g
-- hence all quantities: f , f , M .


D.13        Identification of the TFP to GDP multiplier in a production net-
            work economy
Suppose a two-period model with a production network, as in Long and Plosser (1983); Gabaix
(2011); Acemoglu et al. (2012); Carvalho and Gabaix (2013); Carvalho and Grassi (2019). There
are both idiosyncratic TFP shocks    ^ it and a government reform that creates correlated shocks t
                                                          L 1+1/
to TFP and change in labor supply L  ^ t . Utility is Ct et
                                                           Lt    ,
                                                                 so that is the Frisch elasticity of
                                                    ^
labor supply. So, as Ct = t Lt , labor supply is Lt =      ^    L 95
                                                          t t , and GDP is Y     ^t = L^t + ^ t , i.e.

                                     ^t = m
                                     Y     ^t         L
                                                      t ,             m=1+                            (145)

    We seek to find the "GDP multiplier" m = 1 + , so that a TFP of 1 percent translates into a
GDP increase of m percent.96
    This is potentially a complicated problem, as for instance, in the Long and Plosser (1983) case
with input-output matrix A, output changes are Y    ^t = (I A) 1     ^ +L^ , so that output changes
are correlated in complicated ways. However, one can sidestep using this disaggregated production
data. We assume that TFP change in industry i is:

                                             ^ it =
                                                         
                                                       i t      + uit .                               (146)

In the neoclassical equilibrium, TFP follows Hulten's theorem, so is ^ t = P si ^ it where si is the
                                                                            i
Domar weight (sales of industry i over GDP).
                                                                 
                                  L  1+1/                           1/           L
 95
    The problem is maxLt t Lt et Lt       , which leads to 1 + 1 Lt = t e t ,hence the announced expression.
 96
    If more than one factor change, m has the broader interpretation of a multiplier between TFP and GDP.



                                                       79
   We can identify the multiplier m if we have disaggregated TFP data. In the simplest case, we
assume that industry-level productivities are available, and we get the residuals ue
                                                                                   it . Then, we can
identify the multiplier m by GIV.
   We can identify the multiplier m if we have even crude proxies for disaggregated TFP. The same
procedure works (with less e ciency) if our data is made of proxies for productivities    ^
                                                                                          ~ it growth
(where the tilde indicates that we deal with a proxy). An example could be growth of sales per
employee, or even the growth rate of sales. We assume a factor model

                                           ^
                                           ~ it = ~ i 
                                                       
                                                      ~t +u
                                                          ~it .                                 (147)

The proxy is of better quality when the proxy's idiosyncratic shock u ~it has a high correlation with
                                                          e
the true idiosyncratic shock uit . Then, we h
                                            extract the ~it i
                                                        u   from a factor model, form zt = u~eSt  ~e
                                                                                                  u Et
(with Si = Psisj ), and use the moment E Y     ^t m  ^ t zt = 0, which identifies the TFP to GDP
                j
multiplier m.
    Using more general models (e.g. taking into account imperfections as in Baqaee and Farhi
(2020)) would be very interesting, but would be a new paper by itself. Indeed, even in that case
zt is likely to be a useful instrument, even though it won't be the optimal one. In any case, those
examples show how GIV, with some economic reasoning, translate to more complex economies
where aggregate shocks can be made of idiosyncratic shocks.


D.14     When the influence matrix is not proportional to size
D.14.1    Position of the problem

Suppose a model                            X
                                   yit =         Gij yjt +   i t   + uit ,                      (148)
                                             j

i.e.
                                       yt = Gyt + t + ut ,                                      (149)

with a given "influence" matrix G. For instance, if we have an "industrial similarity" matrix H
with entries Hij (for instance Hij = 1 i i and j are in the same industry, and 0 otherwise) we
might set
                                               Hij Sj
                                        Gij = P          .
                                                k Hik Sk

In our basic setup G = S 0 . We'd like to identify .

D.14.2    A simple approach

We study the model(149), where the factor loading  (an N  r matrix) is not necessarily equal to
 (but we keep imposing that the  spans , i.e. there is a q such that  = q ). As before, t is a

                                                   80
low-dimensional vector of factors.
                                                                                                                    e
    First, we suppose that we have a first estimate of , which we call                                                  . We will later iterate on
it. Then, we form:
                                     y ~t ( e ) := (I e
                                                        G) yt .                                                                                 (150)

If e = , then y                                                      ~t ( e ), which recovers  and
                ~t ( ) = t + ut . Hence, we run a factor analysis on y
W = (V u ) 1 . We introduce Q as in (21) so that Q = 0 and set

                                                               e := Qy
                                                               u     ~t ( e ) ,

                                                                                                           1
so that at e = , u   et = Qut . We observe that Gyt = G (I                                            G)       ut + B t for some B . This
suggests the following procedure.
   We define the GIV zt as a vector (with dimension N ):

                                                 e         1                                1
                                zt := G (1           G)        e
                                                               u t = G (1
                                                                                   e
                                                                                       G)       Q (I           e
                                                                                                                   G) yt .                      (151)

Indeed that zt will imitate the movements of the idiosyncratic shocks on yt .
   Our key moment is:97
                                                           
                                    E ( yt    Gyt )0 W u zt = ,                                                                                 (153)

where       is a discrepancy term
                                                                                        1
                                                      := tr QG (1                 G)        .                                                   (154)

This yields an estimate of .98
     The discrepancy term is often 0. For instance, in our basic example, G = S 0 and Q = 0,so
we have = 0: the discrepancy was 0. Hence, (153) generalizes out basic GIV. Likewise, take the
                                  (k )
case of a block-diagonal Gij = Sj if i and j belong to industry k , and Gij = 0 otherwise, where
 (k )                                              P      (k )
Sj is the relative size of firm j in industry k (so j 2k Sj = 1). Also, assume that the vector of
characteristics have industry dummies. Then, QG = 0, and again = 0.
  97                                                             e
       Here is the proof. At the right estimator           =         ,
                                                      1                                           1
                                 zt = G (1       G)       Q (I           G) yt = G (1       G)        Qut = Hut ,                                (152)
                            1
for H = G (1           G)    Q. We also have yt  Gyt = t + ut . This implies that
                                 0                     0       
              E ( yt        Gyt ) W u zt = E (t + ut ) W u Hut = E [tr (u0    u                u     0
                                                                          t W Hut )] = E [tr (W Hut ut )] ,
                                         =   tr (W u HV u ) = tr (HV u W u ) = tr (H ) .


  98                                         e                                                                                  e
    We have a fixed point: an initial            gives an estimate of ; that's then the new estimate                                , and we re-iterate
the process, until convergence.




                                                                          81
D.15         Identification of social interactions and the reflection problem
Superficially, there seems to be a contradiction between Section 8.2's finding that we do achieve
identification, and Manski (1993)'s Proposition 2 and Bramoull´   e et al. (2009)'s Proposition 1,
which seem also to state the impossibility of identification. Bramoull´
                                                                      e et al. (2009) analyze social
interactions of the type:
                                  y t = Gy t + xt + Gxt + "t                                  (155)

with E ["t |xt ] = 0. In their main result, they conclude that if the matrices I, G, G2 are not linearly
independent, then the system is not identified. However, in our setup G = S 0 (where  is a vector
of 1's) so that G2 = G and we satisfy Bramoull´    e et al. (2009)'s condition that seems to guarantee
the impossibility of identification. However, we can identify the parameters, as we saw in Section
8.2. How do we solve that seeming contradiction?
    The short answer is that Manski (1993) and Bramoull´     e et al. (2009) do not consider anything like
a GIV, as they immediately reason on averages based on observables, eschewing any exploration of
the noise. In contrast, GIVs are all about exploring some structure in the noise -- the idiosyncratic
shocks of large entities. For instance Manski (1993) considers something akin to:

                                     E [y t |xt ] = GE [y t |xt ] + xt + Gxt ,                               (156)

where all the noise has been averaged out.
  Indeed, we do impose some structure, namely:

                                 "it = t + uit ,       uit i.i.d., orthogonal to t ,                         (157)

We could generalize to richer factor models, like in the body of the paper.
    Second, we can generalize to the case where G2 = G (the case where G2 is a linear combination
of G and I is similar99 ), which seems to leads to the impossibility of identification in Bramoull´
                                                                                                  e et
al. (2009). This is formalized here.

Proposition 6 (Identification achieved in the Bramoull´ e et al. (2009) setup). Suppose that G2 =
G, which is satisfied in our basic setup, but leads to the impossibility of identification in the
Bramoull´e et al. (2009) setup without further assumptions. Suppose also the "simple noise struc-
ture" assumption (157). Suppose also the existence of two n-dimensional vectors S and satisfying

                              G0 S = S,        G0 = 0,         0 S 6= 0,           0
                                                                                       S 6= 0.               (158)

                                                                            0
Then GIV is possible in that setup, i.e. with the GIV zt =                      yt , we can identify the coe cients
( , , ).
 99
      It can be reduced to that case by rescaling H = b0 + b1 G with the right coe cient, with H 2 = H .



                                                          82
                                                                                                 
   In our basic setup, we had Si the relative sizes, and G = S 0 ,                   =S          N
                                                                                                   .   Hence (158) is an
abstract generalization of our concrete conditions.

    Hence, in many situations of interest we can be quite confident that condition (158) is satisfied.100
    There could be another way to analyze social influence with a matrix of influence, like in Section
D.14.
    In conclusion: our GIV approach gives some renewed hope for identification in the context of
social influence and reflection problems. Indeed, it provides a way to achieve identification where
it seemed impossible. Informally, this is by exploiting the idiosyncratic noise of "large players".
Formally, and less intuitively, it is by exploiting a little bit of structure in the noise (so that there
is a low-dimensional common noise). Future research might profitably firm up the exact necessary
and su cient conditions for this.

Proof of Proposition 6 The identification goes as follows. By rescaling S , we impose 0 S = 1.
                          1
Define E := S   (which is N  in our framework), and form

                                         yEt = E 0 yt ,          ySt := S 0 yt ,

which are our generalized "equal weighted" and "value weighted" averages ­ for more abstract
setting. Then, premultiplying (155) by 0 gives:

                                                     0
                                            zt :=        yt = x t + u t .

                                                                                                             2
Hence, estimating this by OLS we can obtain , and var (u t ), so that we obtain also                         u.   Next,

                                      y E = y S + x E + x S +  + uE ,

so that
                                                                           
                         E (yEt       ySt      xEt         xSt )0 (z, xSt ) = (EuEt u t , 0) .                      (159)

The right-hand side is known, as EuEt u t = E 0 u
                                                2
                                                  , which is known. So, we have two unknowns ,
y and two equations: we can solve the system. The condition 0 S = 0 ensures that E [ySt zt ] 6= 0. 


D.16       Identification of the elasticity of substitution between capital and
           labor / Elasticity of demand in partially segmented labor markets
Here we show how GIVs can estimate the elasticity of substitution between capital and labor; and
how the estimate the elasticity of demand in partially segmented markets. The first problem uses
the second one.
 100
    As G2 = G, one can always find vectors , S satisfying the first 3 conditions (provided n is big enough and G is
not the identity nor 0), and the last one is rather "generically" easy to satisfy.


                                                            83
       As a motivation, imagine that industry i has the CES production function101

                                                            i       1       1         i       1
                                                                                                         i
                                                                                                             1
                                                                                                     i
                                   Qit = Bit Kit                i
                                                                        + Ait Lit
                                                                             i            i
                                                                                                                                                     (160)

                                                                                                                          1                1
                                                                                                                                  Lit       i       Wit
   The first order condition of the problem maxKit ,Lit Qit                               R t Kt             Wit Lit is Aiti      Kit
                                                                                                                                                =   Rt
                                                                                                                                                        ,i.e.
a demanded labor / capital ratio:
                                                                                      i
                                        Lit         Wit
                                            = Ait                                                                                                    (161)
                                        Kit          Rt
We'd like to estimate the elasticity of substitution i between capital and labor. This is the wage
elasticity of demand. GIV allow to estimate that, as we shall see.
                                                   d
    Let us use our general notations, and define yit = ln Lit , pit = ln Wit , Cit = ln Kit , and d
                                                                                                  i = i
(as this is the elasticity of labor demand). Then, we can write (161) as:

                                           d       d                            d
                                          yit =    i pit   + Cit +              i t   + ud
                                                                                         it                                                          (162)

where Cit is a control, and as usual vector t is a common shock, and udit is a demand shock (those
in turn come from the productivity Ait ). For notational simplicity we will drop it Cit , but this is
not important.
    Now, log labor supply is modeled as:

                                       s          s                                 s
                                      yit =       i pit             i pSt   +       i t   + us
                                                                                             it                                                      (163)

It is increasing in wage pit in industry i, and decreasing in the wage in the other industries (pSt ).
One could imagine replacing i pSt by a dierent average for each industry, and we will examine
that in an extension. But for now we keep the simple structure.
                                                   d      s
    As supply equals demand in each market (yit      = yit  ), we obtain the price of labor in each market
i:
                                                 d
                                        i pSt + uit    us
                                                        it +
                                                                 d
                                                                 i
                                                                      s
                                                                      i t
                                 pit =                s       d
                                                                                                     (164)
                                                                        i       i

i.e.
                                                                                     p
                                            pit =         i pSt     + vit +          i it                                                            (165)
                                     ud   pus                   d       s
when we define i = s i d , vit = its  d ,
                                      it
                                          i = s
                                                  i
                                                     d.
                                                     i
                     i   i         i  i           i  i
   Problem (165) is a standard GIV. In the general case, we can estimate i as in Section (D.2).102
                           e                                                        u
   So, we obtain i and vit   (the proxy for vit ) in (165). We also form zit = zt   i vit as in (453).
This is the GIV formed of the idiosyncratic shock of all industries but industry i. We will use the
 101
     We thank Julieta Caunedo for prompting us to think about this identification problem.
 102
     This procedure is much simplified if the i and p   i are  assumed to be constant. Then, we can just define
                                                   v + p t s
zt := p t = pSt pEt , so that zt = v t and as pSt = St1      , regressing pSt = bzt + "p
                                                                                       t yields b = 1
                                                                                                      1
                                                                                                        .


                                                                    84
shock to those other industries, and their impact on the outside wage, as an instrument to estimate
labor demand. Indeed, we go back to the labor demand equation (162), and instrument for pit using
the zit
                                            pit = bi zit + "p
                                                            it                                 (166)

we estimate bi , and define pe
                             it = bi zit the price in industry i instrumented by the changes in other
                                     e
industries. We use the estimated t      as controls, and run

                                      d             d e                 d e
                                     yit =          i pit   + Cit +     i t   + ud
                                                                                 it              (167)

                                        d
which yields a consistent estimate      i   of the labor demand.

Extension We can extend (163) to
                                                            X
                                 s          s                                  s
                                yit =       i pit       i         Gij pjt +    i t   + us
                                                                                        it       (168)
                                                             j


where the "influence" matrix Gij capture the influence of the price in market j on market i. This
might be proxied by various measures of distance between the market. We can then use the material
in Sections 8.1 and D.14 to handle this case.


E     A Bayesian perspective on GIVs
We will see that, under conditions of Gaussianity, our estimators are basically the MLE. As variables
may not be Gaussian, we keep the general exposition (showing identification) free of distributional
assumptions. If we assume that variables (uit , t ) are Gaussian, then a Bayesian analysis can be
performed. We detail it here.


E.1     The general model: Bayesian version
Here we treat the general model of Section 3.1, in the case where the it are the same, and equal
                                                  y              P
to 1, and all factors are observed (except the t    , as in yit = f f Ftf + uit + t
                                                                                  y
                                                                                    ). The general case
with heterogeneous loadings
                           is done    later, in Section E.5, and uses much the same ideas.
                                f
    The data D is D = yt , Ft                   , made of i.i.d. draws from a fixed distribution. To
                                  f =1...dF ,t=1...T
simplify the notations, we'll just denote by f the collection of all variables corresponding to factors
(without explicitly mentioning that f = 1 . . . dF ).
   The solution of the system features:

                                               ySt          My    t   = b y "t ,
                                            Ftf      f M y        t   = b f "t ,

                                                                 85
                                                
                                          y   f
for some vector by , bf , and "t := uEt + t , t  .
   Hence, we form:  = M, f M ; ! V a parametrization of the relevant variance matrices ­ so the
variance matrix V u depends on ! V (for instance, if V u is diagonal, ! V is the vector of its diagonal
                                                                                    1
                 V                                                       V u (! V ) 
terms); ! = , ! the set of parameters to be estimated; E (! ) = 0 V u (!V ) 1  the corresponding
quasi-equal weights vector, and form the key quantities:
                                                                                                   
                                                                          f
                                Yt (! ) := ySt          My     (! ),t , Ft    f M y       (! ),t      .                     (169)

We also keep track of
                                                    y
                                                    it (! ) = yit       yE (!),t                                            (170)

and stack those two vectors together as Xt (! ), which contains all our information:

                                               X t ( ! ) = (Y t ( ! ) , y
                                                                        t (! )) .                                           (171)

The key "trick to tractability" is to transform the data into that Xt .
    There is an invertible matrix A () such that Dt = A () Xt . Hence, there is no loss of information
in using Xt as "conveniently processed" data, rather than the "unprocessed" data Dt . Hence, instead
of ln P (Dt |! ), we'll consider

                                       ln P (Xt |! ) = ln P (Dt |! ) + ln |A ()| .                                          (172)

The Jacobian |A ()| := det A is independent of all parameters ! .103 Hence it can be discarded as
a constant in the calculations.
   The key simplifying observation is that (under the correct model), E [ yt yEt ] = 0, so that Yt (! )
and y
    t (! ) have zero covariance. Hence, the log likelihood decouples, and we have

                                           1                                       1
    2 ln P (Dt |! ) = Yt0 (! ) V Y ! V                  t (! )0 V y
                                               Yt (! )+ y         
                                                                    (! )               t (! )+ln V Y ! V
                                                                                       y                                
                                                                                                                  +ln V y . (173)

As yt lives in a space of dimension N 1 (as E 0 y
                                                t = 0), the value of V y
                                                                       
                                                                         is understood as being of
the corresponding dimensions, (N 1)  (N 1).
    Now, imagine that ! V has already been estimated, and do only the optimization w.r.t. . That
gives:                              h                               i
                                                        1
                             min ET Yt0 , ! V V Y ! V     Yt  , ! V .                        (174)
                                    

The first order conditions are:
                                                                                                         
                       ET (y t , 0) V Y         1
                                                    Yt = 0 ,         ET (0, y t ) V Y              1
                                                                                                       Yt = 0 ,
 103                     ~ t = (Ft , ySt , y
    First, go from Xt to D                 t ), which is upper triangular with 1 on the diagonal, so has determinant 1;
                 ~
second, go from D to D, which is independent of the ! .



                                                               86
                                           
i.e. (given that 0 = ET y   t   VY   1
                                         Yt = V Y         1
                                                              ET [y t Yt ]) we have ET [y t Yt ] = 0, yielding
                                  h                                                 i
                                ET y t ySt        M y t , Ftf       f M y       t       = 0.                     (175)

Those are precisely the first order conditions of the OLS estimation:
                                                                                                    2
                                                 2
                    min ET (ySt          M y t) ,             min ET          Ftf       f M y   t       .        (176)
                      M                                       f M


Hence, our GIV is also the MLE estimator of M, M f , when we have Gaussian distributions.
   We can also go beyond MLE, and calculate full Bayesian posteriors. Then, the GIV gives an
easy way to do finite-sample Bayesian updating. Assuming again for simplicity that we know the
variance matrices, we have

                                                   1X                          1
                    ln P (|D) = ln P ()                Yt (  ) V Y                  Yt (  ) + K ( D ) ,          (177)
                                                   2 t

where K (D) ensures that the probability sums to 1.
  The rest of this section examines instantiations and variants of the general idea we just saw.


E.2    The supply and demand model of Section 2.2
                                                                                          f
This model corresponds exactly to the general case, with a factor Ftf = pt , pt = f ySt + t with
f = 1s and  f = "s . Then, everything goes through.


E.3    The basic example with self-loop of Section 8.2
We give a Bayesian treatment of this model of Section 8.2:

                                             yit = ySt + t + uit .

We are given Dt = yt . We wish to estimate M = 1 1 . The vector of parameters of interest is
 = M:
                                  Yt (! ) = ySt M y (!V ),t .

As in the general procedure, we set:

                                            y
                                            it (! ) = yit        yE (!V ),t                                      (178)

and
                                          X t ( ! ) = (Y t ( ! ) , y
                                                                   t (! )) .                                     (179)



                                                         87
In the true model, we have Yt = M (uEt + t ), so104

                                             Yt2 (! )                      1
                         2 ln P (Dt |! ) =      2
                                                         t (! )0 V y
                                                        +y         
                                                                               y
                                                                               t (! ) + ln      2
                                                                                                Y   + ln V y
                                                                                                           
                                                                                                             .
                                                Y

       Suppose first that we know the variance terms. Then, the MLE is simply to do
                                                                   
                                                    max ET Yt (! )2 ,
                                                        M


which is the identification condition we used, and it corresponds to running the OLS

                                                                                  2
                                              min ET ySt           My   (! V )t       .
                                               M

                                                                                          2
Next, for the estimation of the variance terms, we optimize on                            Y,   Vy
                                                                                                
                                                                                                  . Asymptotically, that gives
the true values.


E.4        The basic example without loop of Section 2.1.
We now detail the Bayesian version of our example in Section 2.1:

                                          yit = t + uit ,          pt = ySt + "t .

We'd like to estimate  especially (or, in a Bayesian context, update our prior on ). This example
is actually a bit non-generic, as it endows the economist with a knowledge that f = 0, which
creates some subtle changes: it features the "recovered" factor yEt , used as a regressor. We can also
write pt = y t + yEt + "?   t for some .
    The data D is a set of D = (yt , pt )t=1...T , assumed to be i.i.d. draws from a fixed distribution.
    We call  = (, ) the set of "key" model parameters, and ! V , the parametrization of the
variance-covariance matrix V (u+,") (e.g. if we assume that u is diagonal), the auxiliary parameter,
and ! = , ! V the full set of parameters. The correct value is !  .
    Given yt , pt , we form
                                      Yt () = pt (y t + yEt )

and Xt () = (Yt () , yt ). At the correct parameter !  ,

                                                        Yt (   ) = " ?
                                                                     t ,


which is defined in the analysis is the "enriched OLS estimator" that comes from running the
regression: pt = y t + yEt + "? t . Hence, at the correct value, Yt and yt are uncorrelated. Call
  X
V (! ) the variance-covariance matrix of Xt .
 104
       The inverse of V y
                        
                          is taken in the space of matrices operating on vectors orthogonal to E .


                                                              88
       We can start the Bayesian analysis:

                                               P (! |D ) / P (D |! ) P (! )

and                                                               X
                                              ln P (D|! ) =                 ln P (Dt |! )
                                                                    t

with
                                              Yt (  ) 2       0
                          2 ln P (Dt |! ) =      2
                                                          + yt V y (W ) yt + ln             2
                                                                                            "?   + ln |V y (W )| ,   (180)
                                                 "?

where here |A| is the determinant of a matrix A.
                                         P
   Hence, the MLE estimator maximizes t ln P (Dt |! ) over ! = (, W ) . The problem for  sepa-
rates as:                                    X
                                         min     Yt (  ) 2 ,
                                                       ,
                                                              t

i.e.                                             X
                                          min          ( pt       (y t + yEt ))2 ,
                                          ,
                                                   t

which is the "enriched OLS estimator" pt = y t + yEt + "?        t . This shows that, with Gaussian
distributions, the MLE is just our enriched GIV-OLS estimator.
    Maximizing over the other parameters W will allow to recover the variance matrix (including
that of "t , t ).
    If we have a small sample, we can just update rather than do MLE. The above shows that the
"simplifying trick" is to form that statistic Yt (), which allows for an interpretable updating of the
parameters. For simplicity, suppose that we know the value of V y (W ) , and "     2 105
                                                                                    ?.   However, we
have a prior on  = (, ), perhaps Gaussian. Then, our posterior after observing the data D is:

                                                                    X Yt (  ) 2
                                  ln P (|D) = ln P ()                              2
                                                                                        + K (D ) ,
                                                                        t
                                                                               2   "?


where K (D) ensures that the probability sums to 1.
 105
       Otherwise, we can update our knowledge of those, which is standard though tedious to lay out.




                                                                  89
E.5     Heterogeneous loadings
E.5.1   Bayesian model with heterogeneous loadings

Here we extend the basic model of this section to heterogeneous, nonparametric loadings. The
model is
                                  X                K
                                                   X
                                       f f     y       k k
                            yit =       F t + t  +     i t + uit ,                      (181)
                                          f                        k=1

                                                                        k
where now there are K unobserved factors, with unknown factors t          , and non-uniform loadings
 k                                                                            y
 i . As in the more basic Section E.1, we assume the existence of a factor t with uniform loadings
(which can be taken to be uncorrelated with t ), and factors Ftf are endogenous and observed. More
compactly, we can write the model as:

                                                   F        y
                                         yt =          Ft + t + t + u t .                                           (182)

   We will now see how this case can be reduced to the one of Section E.1. We define the theoretical
object:
                                                  XK
                                                        k k
                                       ~it := yit
                                       y                i t .                                 (183)
                                                                k=1

Then, the results of Section E.1 apply to y
                                          ~t , conditional on ( , t ). Equation (173) becomes:
                                                                                   1
                                     ~                                                                ~             
                           ~ 0 (! ) V Y (W )
   2 ln P (Dt |! , , t ) = Y t
                                               1
                                                   Y         ~t (! )0 V y
                                                             
                                                   ~t (! ) + y          ~
                                                                          (! )         ~t (! ) + ln V Y (W ) + ln V y
                                                                                       y                            ~

                                                                                                                 (184)
with                                                                                       
                             ~t (! ) := y
                             Y          ~St          ~
                                                    My    (W ),t , Ft
                                                                     f
                                                                          f M y
                                                                              ~   (W ),t      ,                     (185)

                                              y
                                              ~it (! ) = y
                                                         ~it      y
                                                                  ~E (W ),t .                                       (186)

   So, given , t , the procedure is as in Section E.1, applied to the tilde variables. In turn, suppose
that we have some priors on (we'll take them to be diuse) and on t (we'll normalize them to
be independent standard normals). Then, the full likelihood is:
                                                                                                        1
                                                                                              K/2          0
                 P (Dt |! ) = P (Dt |! , , t ) P ( , t ) ,            P ( , t ) = (2 )              e   2 t t   .   (187)

So, we can estimate       and t by Bayesian methods, e.g the E-M method summarized in Section
E.5.2.

What the MLE gives It is worth pausing to see what the MLE does. Consider the MLE
estimator of M (keeping the f M constant). It is as the analysis of (175) but in y
                                                                                 ~t space, i.e. it is



                                                           90
equivalent to running the OLS regression:

                                                           y
                                                           ~St = M y
                                                                   ~ t + et ,                                                     (188)

i.e.,
                                                     ySt         S t      = M z t + et ,                                          (189)

where
                                   zt := z t + zt ,               z   t   := u t ,                zt :=        t t .              (190)

   This means that the MLE uses two primitive sources of shocks for identification (i) z t := u t ,
which is the "pure" GIV, and (ii) zt := t t , which traces the ripple eects of the aggregate shocks
t on the aggregate action ySt , after controlling for the "direct" eects (this is why ySt        S t is
on the left-hand side of (189)). Those are two economically very dierent styles of identification.
For economic clarity we find it useful to single out solely the "pure" GIV identification (i.e. regress
only on z t rather than on z t + zt ).

E.5.2   Maximum likelihood estimation with heterogeneous loadings

We consider the model with heterogeneous loadings

                                                     yt = ySt  + t + ut ,

where ut  N (0, Vu ) and t  N (0, 1). Define t ( ) = yt                                           ySt  = t + ut and note that the log
likelihood contribution of yt is
                                 P (yt ) = P ( t ) + ln (1                                        ).

The likelihood of t can be computed e ciently using the expectation-maximization (EM) algorithm.
The steps are as follows, and we refer to Ghahramani and Hinton (1997) for details, where subscripts
(n) refer to the n-th iteration of the algorithm.

    · Expectation step

        ­ E ( n ) [ t |   t]   =   (n) t ,where       (n )   =    0
                                                                          1
                                                                              and (n) =                      0
                                                                                                       ( n ) (n )   + V u(n ) .
                                                                                   2
        ­ E ( n ) [ t
                    2
                      |   t]   =1      (n ) ( n )   + E ( n ) [ t |           t]       .

    · Maximization step
                          P                          1   P
        ­    (n+1)   =     E ( n ) [ t
                               t
                                     2
                                       | t]                  t t E (n )   [ t |        t ].
                                   P
                                                         (n+1) E(n)
                       1                  0                                               0
        ­ Vu(n+1)     =T diag         t t t                               [ t |        t] t   .




                                                                         91
The log likelihood can be computed as (omitting constants that do not depend on the parameters)

                                                       1                  1 0 1
                                     P(n ) ( t ) =       ln (n)               t,
                                                       2                  2 t (n )
and we iterate until convergence. To initialize the algorithm, we start from estimates of                  and Vu
based on PCA.


F       Microfoundations for the model of sovereign spillovers
In this model, spillovers happens because debt defaults are partially mutualized. This is a stand-in
for potentially much richer economics. For instance, contagion might work via GDP spillovers, or
the limited risk capacity of specialized arbitrageurs. Still, the specification that this model delivers
might be broadly similar, as we shall see.


F.1     Model setup
We make a number of simplifying assumptions. The safe interest rate is normalized to 0, and pricing
is risk neutral. Time is continuous in [0, T ]. We neglect the O (dt) terms, which are irrelevant for
the regression analysis we are interested in, i.e. will write df (Xt ) = f 0 (Xt ) dXt .106 , 107
    Payos are realized at a date T , which should be thought about as faraway. Country i's out-
standing debt is Bi , and the value of the debt (per unit of face value) is thus:
                                                            
                                       Qit = Et 1        L+
                                                          iT = e
                                                                          (T t)yit
                                                                                     ,                       (191)

where x+ := max (x, 0), yit is the yield spread over the safe interest rate (which we normalized to
0), and LiT is the relative "vulnerability" of the government's bonds, defined as

                                                                  FiT
                                                      LiT =           ,                                      (192)
                                                                  Bi

where FiT is the value of potential losses from government defaults (in euros). We assume that FiT
follows:

                                                     FiT =    iT GiT ,                                       (193)

where    iT   2 [0, 1] is a propensity to pass on raw government fiscal losses GiT to bondholders. A
  106
      Formally, we write all the dierential expressions dYt = at dZt modulo an equivalence by terms bt dt (or, to be
pedantic, we quotient by the ring of expressions of the type bt dt where bt is an adapted function). So, df (Xt ) =
f 0 (Xt ) dXt modulo dt, where we keep the "modulo dt" implicit.
  107
      We only care, for the regressions, about the "dZt " terms, that depends on innovation to underlying Brownian
shocks dZt , as those are the loading detected by the regressions.



                                                             92
financially virtuous country (say Germany) has iT close to 0, and a laxer country has a high iT .
To gain intuition, it is useful to think that most variation in yield spreads comes from the political
willingness to not pay bondholders, iT .
    This raw position GiT is in turn:

                                                                             +
                                                   GiT = ViT               FiT + mi F T ,                   (194)

where ViT is a stochastic "latent loss", and the total amount lost on bonds is:
                                                                       X
                                                                                  +
                                                             FT =               FiT .                       (195)
                                                                           i

                                                                                      +
Debts are partially mutualized with intensity 2 [0, 1]: a fraction of the loss Fit      is passed on to
                                               P
other countries, with a share mi to country i ( i mi = 1, mi 0). This mutualization creates the
sovereign yield spillovers.
    To simplify the analysis, we assume that ViT is strictly positive with probability 1, so that FiT ,
GiT and LiT are all strictly positive with probability 1. This is less restrictive that it may appear:
losses could be very small. This is simply to make the analysis very tractable.


F.2     Model solution
Solving the model,

                                                        iT
                                      LiT =                  (ViT              FiT + mi FT )
                                                       Bi
                                                        iT
                                                   =         (ViT              Bi LiT + mi BLT ) ,
                                                       Bi
           P                         FT
with B =       i   Bi and LT =       B
                                          , i.e.
                                                                       X Bi
                                                            LT =                   LiT .                    (196)
                                                                       i
                                                                               B
                      mi
   We call i =       Bi /B
                           ,   the ratio between country i's mutualization share mi and its debt share.108 , 109 .
This leads to:                                                                                 
                                                             iT            ViT   mi
                                           LiT =                               +    BLT           .
                                                       1+         iT       Bi    Bi
 108
     The ECB's capital key, which defines the equity shares of member states in the ECB, is defined using 50% of
GDP shares and 50% of population shares. However, we do not focus exclusively on spillovers that operate via the
ECB and there may be other eects via trade linkages, demand shocks from investors, et cetera. We maintain the
assumption that the losses, or exposures, to Eurozone-wide losses are proportional to GDP. Alternatively, we could
change the measure mi to be a function of both population and GDP shares.
 109
     One can imagine i ' 1 as a simple baseline where most variations come from the political willingness it .




                                                                       93
So, if we define
                                                                    iT
                                                  iT   =                         ,                   (197)
                                                            1+              iT

we have:                                                                             
                                                            ViT
                                       LiT =        iT          + i L T                 .            (198)
                                                            Bi
This shows the "contagion" in the space of vulnerabilities, LiT .
   To move to yields, we do a Taylor expansion for small yield spreads, so that (191) gives:

                                                 yit = at Et [LiT ] ,                                (199)

where
                                                                    1
                                                    at =                                             (200)
                                                             T          t
is a slowly-varying parameter (as T is far from the interval of times
                                                                    h ti under study ­ so we'll take
                                                                     ViT
the approximation dat ' 0). We define it = Et [ iT ], vit = at Et Bi . Also, we place ourselves
in the "quasi-static" regime, where all noises are small--see Section F.3 for details. Hence, (198)
becomes, in yield space:
                                      yit = it (vit + i ySt ) ,                                (201)

where                                                       P
                                                        Bi yit  i
                                                 ySt =         .                                     (202)
                                                        B
    This shows that the yield spread depends on a country-specific fundamental vit and a "spillover"
proportional to . At the same time, for a very financially virtuous country with it ' 0, the yield
spread is close to 0, so that yield contagion is close to 0: as the country is quite safe anyway, external
disruptions cannot move the yield much away from 0.
    We have

                            dyit   d    it            dvit        i ySt dySt
                                 =           +              +                ,
                            yit        it        vit + i ySt vit + i ySt ySt
hence
                                             dyit                             dySt
                                                  = dwit +               it                          (203)
                                             yit                              ySt
                                                                 i ySt
for dwit := d it
               it
                  + vit +dvit
                           i ySt
                                  and for a coe cient it := vit +  i ySt
                                                                         2 [0, 1]. In the simple benchmark
where all countries have a similar vit (fundamental government finances) but dier mostly in it
(the propensity to absorb the shocks rather than pass it on to debt holders by defaulting) and
i = 1, we have it = vt +ySt    ySt
                                   .
    Written another way, call
                                                 ~it := ln yit .
                                                 y                                                    (204)



                                                            94
Then, we have
                                              dy
                                               ~it = dwit +     it dy
                                                                    ~St
                                                                      ~ ,                                 (205)

where
                                                 ~it = PBi yit ,
                                                 S                                                        (206)
                                                        j Bj yjt

                                         X                 X Bi yit dy it
                                                                          dy
                                dy
                                 ~St
                                   ~ =
                                              ~it dy
                                              S    ~it =     P yit = St .                                 (207)
                                          i                i   j Bj yjt   ySt
Hence, if we reason in "log yield spread" space, the proper weights are proportional to Bi yit , i.e.
debt value times yield spread. This is the formulation that motivates our empirical specification
(58). In particular, if it = 0, then the change is dyit = 0 always. The importance of the spillovers
            P
is given by j Bj dyjt , the change in the yield weighted by debt value, summed over all countries.


F.3     Quasi-static regime of stochastic processes
Suppose a stochastic process, governed by some noise size , as in dYt = µ (Yt ) dt + v (Yt ) dBt ,
where Bt is a Brownian motion. The "quasi-static" regime is the one where is very close to 0.
Then, things are much simpler to analyze, especially for non-linear processes, provided we accept
O ( 2 ) approximations.
   Indeed, consider that vector-valued process Yt (for t  T )

                                                Xt = Et [F (YT )]                                         (208)

where F is a C 2 function. Then, in the quasi-static regime, we can write

                                         Xt = F (Et [YT ]) + O              2
                                                                                                          (209)

i.e. we swap Et and F .110 So, that, assuming now that Yt is a martingale,

                                                                      2
                                              X t = F ( Yt ) + O                                          (210)

and
                                         dXt = F 0 (Yt ) dYt + O            2
                                                                                                          (211)

or, more informally (as we do in the economic part of this section),

                                               dXt ' F 0 (Yt ) dYt .                                      (212)
 110
     We do not formally prove this, as this is purely mathematical as opposed to economic. One could do it, e.g.
using the Clark-Ocone formula from the Malliavin calculus.




                                                           95
       Table F.7: Bloomberg identifiers of countries included in the sovereign yield model.

      Country Government bond ticker ID                        Country     Government bond ticker ID
      Austria G0063Z BLC2 Curncy                               Ireland     G0062Z BLC2 Curncy
      Belgium G0006Z BLC2 Curncy                               Italy       G0040Z BLC2 Curncy
      Finland G0081Z BLC2 Curncy                               Netherlands G0020Z BLC2 Curncy
      France  G0014Z BLC2 Curncy                               Portugal    G0084Z BLC2 Curncy
      Germany G0016Z BLC2 Curncy                               Slovenia    G0259Z BLC2 Curncy
      Greece  G0156Z BLC2 Curncy                               Spain       G0061Z BLC2 Curncy

                                                             
   To work out a concrete example, take Yt = Bt ,and Xt = Et eYT . The exact values are:
                                               2
                                Xt = e Yt +   2
                                                 (T   t)
                                                           ,       dXt = Xt dYt                        (213)

and the quasi-static approximation gives

                          Xt = e Yt + O    2
                                                ,              dXt = eYt dYt + O   2
                                                                                       .               (214)


F.4    Details on the data
Table F.7 describes the tickers of the yields that we use in our empirical analysis.


References for Online Appendix
Acemoglu, Daron, Vasco M Carvalho, Asuman Ozdaglar, and Alireza Tahbaz-Salehi,
 "The network origins of aggregate fluctuations," Econometrica, 2012, 80 (5), 1977­2016.

Bai, Jushan and Serena Ng, "Confidence intervals for diusion index forecasts and inference for
 factor-augmented regressions," Econometrica, 2006, 74 (4), 1133­1150.

Baqaee, David Rezza and Emmanuel Farhi, "Productivity and misallocation in general equi-
 librium," The Quarterly Journal of Economics, 2020, 135 (1), 105­163.

Berry, Steven, James Levinsohn, and Ariel Pakes, "Automobile prices in market equilib-
 rium," Econometrica, 1995, pp. 841­890.

Berry, Steven T., "Estimating Discrete-Choice Models of Product Dierentiation," The RAND
 Journal of Economics, 1994, 25 (2), 242­262.

Bramoull´e, Yann, Habiba Djebbari, and Bernard Fortin, "Identification of peer eects
 through social networks," Journal of Econometrics, 2009, 150 (1), 41­55.


                                                           96
Carvalho, Vasco and Xavier Gabaix, "The great diversification and its undoing," American
 Economic Review, 2013, 103 (5), 1697­1727.

Carvalho, Vasco Miguel and Basile Grassi, "Large Firm Dynamics and the Business Cycle,"
 American Economic Review, 2019.

Gabaix, Xavier, "The granular origins of aggregate fluctuations," Econometrica, 2011, 79 (3),
 733­772.

Ghahramani, Zoubin and Georey E. Hinton, "The EM Algorithm for Mixtures of Factor
 Analyzers," Unpublished working paper, University of Toronto., 1997.

Long, John B and Charles I Plosser, "Real business cycles," Journal of Political Economy,
  1983, 91 (1), 39­69.

MacKay, Alexander and Nathan Miller, "Estimating models of supply and demand: Instru-
 ments and covariance restrictions," Available at SSRN 3025845, 2019.

Manski, Charles F, "Identification of endogenous social eects: The reflection problem," The
 Review of Economic Studies, 1993, 60 (3), 531­542.

Nevo, Aviv, "A practitioner's guide to estimation of random-coe cients logit models of demand,"
 Journal of economics & management strategy, 2000, 9 (4), 513­548.

Nevo, Aviv, "Measuring Market Power in the Ready-to-Eat Cereal Industry," Econometrica, 2001,
 69 (2), 307­342.

Newey, KW and D McFadden, "Large sample estimation and hypothesis," Handbook of Econo-
 metrics, IV, Edited by RF Engle and DL McFadden, 1994, pp. 2112­2245.

Rasmussen, Carl and Christopher Williams, Gaussian Processes for Machine Learning, The
 MIT Press, 2005.

Sweeting, Andrew, "Dynamic Product Positioning in Dierentiated Product Markets: The Ef-
 fects of Fees for Musical Performance Rights on the Commercial Radio Industry," Econometrica,
 2013, 81 (5), 1763­1803.

Zou, Hui, Trevor Hastie, and Robert Tibshirani, "Sparse principal component analysis,"
  Journal of Computational and Graphical Statistics, 2006, 15 (2), 265­286.




                                              97
