                                 NBER WORKING PAPER SERIES




    SEGREGATED SECURITY EXCHANGES WITH EX ANTE RIGHTS TO TRADE:
 A MARKET-BASED SOLUTION TO COLLATERAL-CONSTRAINED EXTERNALITIES

                                       Weerachart T. Kilenthong
                                        Robert M. Townsend

                                          Working Paper 20086
                                  http://www.nber.org/papers/w20086


                       NATIONAL BUREAU OF ECONOMIC RESEARCH
                                1050 Massachusetts Avenue
                                  Cambridge, MA 02138
                                       May 2014




This paper previously circulated under the title "Endogenous Valuation of Collateral and Ex Ante
Trade in Market Fundamentals, 2007" and "Market Based Segregated Exchanges with Default Risk,
2009". We would like to thank Anmol Bhandari, Mikhail Golosov, Lars Hansen, Bengt Holmstrom,
Edward S. Prescott, Thomas Sargent, Alp Simsek, Harald Uhlig, Randall Wright, Haoxiang Zhu, seminar
participants at Boston FED, Richmond FED, MIT, UCSB, UTCC, 2008 SED conference, Bewley
conference, and LAFE conference. Sartja Duangchaiyoosook provided excellent research assistance.Tee
Kilenthong is grateful to financial support from David Marshall-Merrill Lynch Faculty Fellowship
at UCSB. Robert Townsend is grateful to financial support from the Eunice Kennedy Shriver National
Institute of Child Health and Human Development (NICHD) under grant R01 HD027638, NSF, the
John Templeton Foundation, and the Consortium on Financial Systems and Poverty at the University
of Chicago through a grant from the Bill & Melinda Gates Foundation. The findings and conclusions
contained in the report are those of the author(s) and do not necessarily represent the views of the funders.
The views expressed herein are those of the authors and do not necessarily reflect the views of the
National Bureau of Economic Research.

NBER working papers are circulated for discussion and comment purposes. They have not been peer-
reviewed or been subject to the review by the NBER Board of Directors that accompanies official
NBER publications.

© 2014 by Weerachart T. Kilenthong and Robert M. Townsend. All rights reserved. Short sections
of text, not to exceed two paragraphs, may be quoted without explicit permission provided that full
credit, including © notice, is given to the source.
Segregated Security Exchanges with Ex Ante Rights to Trade: A Market-Based Solution to
Collateral-Constrained Externalities
Weerachart T. Kilenthong and Robert M. Townsend
NBER Working Paper No. 20086
May 2014
JEL No. D52,D53,D61,D62

                                              ABSTRACT

This paper studies a competitive general equilibrium model with default and endogenous collateralized
contracts. The possibility of trade in spot markets creates externalities, as spot prices and the bindingness
of collateral constraints interact. We propose a market based solution which overcomes the externalities
problem and obviates the needs for any government policy intervention. If agents are allowed to contract
ex ante on market fundamentals determining the state-contingent spot prices used to unwind collateral,
over and above contracting on true underlying states of the world, then standard existence and welfare
theorems apply, that is, competitive equilibria are equivalent with Pareto optima.


Weerachart T. Kilenthong
Faculty of Economics, and
Research Institute for Policy Evaluation and Desig
University of the Thai Chamber of Commerce
126/1 Vibhavadee-Rangsit, Dindaeng
Bangkok 10400
Thailand
tee@riped.utcc.ac.th

Robert M. Townsend
Department of Economics, E17-230
MIT
77 Massachusetts Avenue
Cambridge, MA 02139
and NBER
rtownsen@mit.edu
                                            Abstract

         This paper studies a competitive general equilibrium model with default and en-
      dogenous collateralized contracts. The possibility of trade in spot markets creates
      externalities, as spot prices and the bindingness of collateral constraints interact. We
      propose a market based solution which overcomes the externalities problem and obvi-
      ates the needs for any government policy intervention. If agents are allowed to contract
      ex ante on market fundamentals determining the state-contingent spot prices used to
      unwind collateral, over and above contracting on true underlying states of the world,
      then standard existence and welfare theorems apply, that is, competitive equilibria are
      equivalent with Pareto optima.


Keywords: Default; endogenous collateral; externalities; segregated exchanges; Walrasian
equilibrium; limited commitment; financial crises
JEL Code: D52, D53, D61, D62.



1     Introduction
This paper uses a competitive general equilibrium with directly-collateralized and asset-
backed securities to analyze the interaction between the endogenous valuation of collat-
eral and corresponding default decisions. The interaction creates a “pecuniary externality”,
which causes a collateral-constrained equilibrium to be inefficient. The externality exists
because the consumption feasibility set of an agent directly depends on the spot price and
the prices of asset backed securities through the decisions of other agents in the contracting
period. This impact on the feasible set in turn impacts the allocations of all agents whenever
the collateral or borrowing constraints of any types of agents is binding.
    The primary contribution of this paper is not the discovery of the externality, as this
is now quite clear from a growing literature, (e.g., Allen and Gale, 2004; Caballero and
Krishnamurthy, 2001, 2004; Farhi et al., 2009; Geanakoplos, 2003; Geanakoplos and Pole-
marchakis, 1986; Golosov and Tsyvinski, 2007; Greenwald and Stiglitz, 1986; Jacklin, 1987;
Lorenzoni, 2008). Much of this literature is linked to modeling the recent financial crisis
and emphasizes fire sales that come about from too much initial credit that has to be un-

                                                 2
wound, falls in asset prices, and a further tightening of financial constraints. This of course
relates to the larger financial accelerator literature, e.g., Aghion et al. (1999); Bernanke and
Gertler (1989); Bernanke et al. (1996); Cooley et al. (2004); Kiyotaki and Moore (1997); Kr-
ishnamurthy (2003); Lamont (1995); Rampini (2004); Ranciere et al. (2008). These papers
use endogenous borrowing constraints as amplification mechanisms. In particular our paper
which focuses on collateral constraints is closely related to Kiyotaki and Moore (1997) and
Krishnamurthy (2003).
   Recently Hart and Zingales (2113) have emphasized that externalities can result in too
much saving, providing a model where limited ability to borrow against future human capital
raises the demand for liquid assets which in turn raises the price of goods purchased. Our
paper is closely related. Indeed in our class of models in which collateral is required to
back promises, the over-savings phenomena is a general result. As a consequence of this, a
constrained optimal system will make traders pay for the right to bring the collateral good
or be compensated for not doing so, though this is relative to a market fundamental that
determines the equilibrium spot prices.
   The primary contribution of our paper, though, the one we emphasize, is a solution to all
these pecuniary externality problems using market-based, segregated exchanges in securities.
These internalize the externality by creating otherwise missing markets. The contrast with
the literature is evident. We do not require portfolio restrictions, restrictions on savings,
interest rate manipulation, fiscal policy, or taxes and subsidies levied by the government.
We do not have to quantify any particular policy response. Rather, appropriate designed
markets in rights to trade will deliver the correct prices at the Walrasian, non intervention
outcomes and so deliver an efficient outcome. Lump sum taxes and subsidies can be used to
compensate potential losers from the creation of there new markets and achieve any desired
Pareto optimal allocation. We also do give a public finance tax/subsidy interpretation of
the market based solution through the lens of the budget constraint, to make clear both
the lump sum redistributive and marginal considerations that lead to a constrained optimal
structure.
   We now go over some of theses points in more detail. A contract or security consists of
two items, a state-contingent promise and the collateral backing that promise. We take it


                                               3
as a primitive that default is possible or, equivalently, that collateral is required to make
borrowers (or issuers of securities) repay their loans. A borrower may choose to default
on a particular loan, or a particular state-contingent promise, and in doing so would lose
the value of collateral backing that particular loan or security1 . A rational borrower will
base her default decision security by security on the value of the collateral backing each
liability, compared to the original promise to pay. Of course the value of the collateral good
at the time of repayment decisions (called the execution period) and in the market for asset
backed securities (in the contract period) is an equilibrium phenomenon. Yet this market-
clearing price of collateral determines whether borrowers default or not and hence the overall
amount of debt and saving. In particular, the model is a general equilibrium model with
endogenously determined collateral and so aggregate collateral (hence saving) is a result of
the actions in the contracting period of all agents as a group. This in turns implies that
the market fundamental, the price in the spot market, the price used to unwind collateral,
is endogenously determined by the actions in the contracting period of all agents as a group
(aggregate savings).
       Contracts that promise to pay and which do not default have to be backed by a sufficient,
minimum level of collateral, again depending on the promise and the value of collateral.
Likewise asset-backed securities which are issued as a promise to pay have to be backed in
collateral by an equivalent value of asset-backed securities acquired, the promises of others.
Further, for every set of securities which actually default, handing over collateral, there is
another set which would be equivalent, with the same overall payoff and no default. Adding
up all such promises, over state-contingent security promises directly backed by collateral and
over state-contingent securities backed by the promises of others, generates a state-contingent
collateral constraint on trades which is in play in the ex ante contract market. Of course
contracts which do default naturally also require collateral that is to be handed over when
the borrower does not repay. That is, partially collateralized securities are still intimately
   1
       This paper is related to the literature on decentralization with autarky as the penalty for reneging, e.g.,
Alvarez and Jermann (2000); Kehoe and Levine (1993); Kocherlakota (1996). Similar to our model, they
allow ex ante complete contracts, and focus on decentralization of constrained optimal allocations. On the
other hand, the punishment mechanism is different from ours, as for us defaulting agents will only lose their
collateral.


                                                         4
associated with the exact amount of collateral which serves a backing. But rescaling these
latter contracts delivers collateral constraints which are equivalent. We label such constraints
collateral constraints, for brevity.
       The externality problem2 is in general a missing-market problem, as Arrow (1969), which
was build on an earlier work of Meade (1952), made clear some time ago. For us, here in
this paper, the markets for contracts over the “market fundamentals”, those aspects of
the environment which determine the market-clearing price, the valuation of collateral, are
missing.
       There are several key ingredients in our approach to creating these missing markets. First,
we define a new object called a type’s “discrepancy from the market fundamental”, and in
equilibrium, by definition, the sum of individual discrepancies must be zero (but discrepancies
are nontrivial, some types on one side of the market and some on the other). Second, we
give this discrepancy a common price per unit discrepancy, determined by a market (but the
quantity discrepancy depends in part on observed heterogeneity). Third, we allow agents to
contract ex-ante on the market fundamental determining the state-contingent spot-market-
clearing price. That is, we create security exchanges at which the value of collateral used for
clearing ex post is pre-determined, for the entire range of values for collateral, including out
of equilibrium values.
       The particular security exchanges which emerge in equilibrium are determined by the
forces of demand and supply. In any active exchange the clearing price of collateral, allowing
retrade within the exchange, is indeed one that is sustained in equilibrium given the types
and numbers of agents attracted to that particular exchange3 . We then prove that the
   2
       This externality problem is multilateral. That is, without further restrictions, every agent will experience,
as a common price ratio, the same market fundamental, regardless of the fact that other agents are also
experience the same thing. In this sense the externality is a nondepletable externality. Indeed, this might
suggest that one way to internalize the externality is with personalized prices, using a Lindahl equilibrium
concept (Lindahl, 1958). Yet, to the contrary, here we apply a market-based solution concept with a common
price per unit discrepancy. The connection is that the total paid, or received, does depend on type-specific
pretrade endowment ratios and in that sense is personalized.
   3
     A price island is a language one can use to conceptualize the consistent execution of the contingencies
on fundamentals. That is, a price island specifies the spot price, the value of collateral ex post, and the
set of agents that end up there through their ex ante purchases or sales have to support that price. Agents


                                                          5
competitive equilibria with endogenous collateral constraints in this extended commodity
space are equivalent with Pareto optima. Indeed, working through the optimum problem
and its Lagrange multipliers, we are able to derive the price of rights to trade even for
markets which will not exist in equilibrium. It is crucial that any agent thinks about the
consequences of off-equilibrium deviations to different exchanges, so to speak.
    One could view these results as normative, indicative of the need for a systematic but
market-determined way for traders to unwind commitments. We elaborate on what actual
implementation might look like in the conclusion of this paper.
    Here to elaborate is the main idea of the paper: we internalize the externality by making
household types pay or be paid for their influence on the spot market prices determining
the value of collateral, when their pretrade endowment ratio is different from the ratio
determining the market fundamental. Specifically, household types who enter into a market
in which the price is high for the collateral good with which they are abundantly endowed
and/or have as a consequence of collateral/savings (they have a smaller pretrade endowment
ratio than the market fundamental) will pay for demanding rights to trade on that market
(and no other) . On the flip side, those types who are entering into a market with relatively
little of the collateral good (they have a pretrade endowment ratio larger than the market
fundamental) must be paid for accepting the restriction to trade on that market (and no
other).
    In another interpretation, ex post spot trades are replaced by ex ante trade in asset
backed securities. In this interpretation, a household has to pay or be paid for the rights to
trade in a particular security exchange ex ante, but these exchanges still determine the price
at which asset backed securities are unwound.
can carry in goods or securities in such a way that their pretrade ratio of endowments or portfolio in a
spot market deviates from the market fundamental, but the sum of the discrepancies must, by the definition
of consistency, be zero so that the spot price that indexed ex ante contracts is the one which prevails in
equilibrium. This is like a club constraint in other literature, e.g., Prescott and Townsend (2006). See also
consumption right in Bisin and Gottardi (2006). This solution concept with segregated security exchanges
is also related to the assignment literature (e.g., Koopmans and Beckmann, 1957; Prescott and Townsend,
1984a,b). Mortensen and Wright (2002) internalizes a search externality using directed search into segregated
submarkets that promise different expected waiting times. See also Guerrieri et al. (2010).



                                                     6
       The collateralization structure in this model incorporates both “tranching” and “pyra-
miding” (see also Geanakoplos, 1997). With “tranching”, a specific piece of collateral can
be used to back up several contracts as long as their promises to pay are in different states,
i.e., no conflicting claims. With “pyramiding”, agents are allowed to use financial assets, the
contracts for promises to receive goods of others, as collateral for their own promises. This
is different from the contract-specific collateralization structure as in Geanakoplos (2003),
among others, where the collateral of a contract cannot be used as collateral for any other
contract. On the other hand, our structure is similar to that of Chien and Lustig (2010),
where several state-contingent contracts can be backed by the same collateral. However, the
main results of this paper are valid under any contract-specific collateralization structure4 ;
that is, the externality exists, and more importantly, our solution concept to the externality
problem still works5 .
       Of course agents are allowed to retrade in spot markets, and that is what delivers the
spot-market-clearing prices. This is the easiest interpretation of what is going on in the
model. However, with pyramiding, agents are indifferent between ex-ante contracting versus
ex post retrading in spot markets. This is because anything which can be done in the spot
market, trading one good for another, can be done in the ex ante contract market, with
promises to receive one good backing promises to surrender the other. Hence agents do not
need to retrade in spot markets (but they may well do so).
       The remaining of the paper proceeds as follows. Section 2 describes the primitive ingre-
dients of the model. We establish the existence of the externality in section 3. Section 4
presents our market-based solution concept with illustrative numerical examples. Section 5
formally defines the competitive equilibrium with extended commodity space using lotteries,
and proves the existence and welfare theorems. Section 6 concludes the paper. Appendix
   4
       Note that the need for securities with default in Geanakoplos (2003) is not a result of the contract-specific
collateralization structure. As shown in Kilenthong (2011), if all promises are feasible, there will be no need
for securities with default even when the collateralization structure is contract-specific. In fact, collateralized
securities with default are needed in Geanakoplos (2003) because he rules out state-contingent promises ex
ante, i.e., only debt-like collateralized securities are allowed.
   5
     Of course, the collateral constraints are slightly different under different structures. That difference
could lead to different quantitative, but not qualitative conclusions and the existence and welfare theorems.



                                                          7
A contains all proofs. Appendix B presents more related results, and Appendix C shows
detailed derivations for numerical examples.



2      The Model Economy
This is a two-period economy, t = 0, 1. All financial (debt and insurance) contracts are
traded in period t = 0, henceforth called the “contracting period”. In addition, in period
t = 0, both of two consumption goods can be traded and consumed. One of them can
be saved. All contracts will be executed in period t = 1, henceforth called the “execution
period”. There are a finite number S of possible states of nature in this period t = 1,
i.e., s = 1, 2, ..., S. This allows S = 1 so there is only intertemporal trade, borrowing and
lending, from t = 0 to t = 1. For S > 1 in which contingent claims, Arrow-Debreu securities
are traded, let 0 < πs < 1 be the objective and commonly assessed probability of state s
                  P
occurring, where s πs = 1. Again the two underlying goods can be traded and consumed
in each state s. We refer to these t = 1 markets as spot markets.
     Again there are two underlying goods, called good 1 and good 2. Good 1 cannot be stored
(is completely perishable) from t = 0 to t = 1, while good 2 is storable. The good 2 that
can be stored is collateralizable, i.e., can serve as collateral to back promises. Henceforth,
good 2 and collateral good will be used interchangeably. Furthermore, good 1 will be the
numeraire good in every date and state. In the concluding section, we interpret good 1 as
a money and good 2 as treasuries. That is, treasuries are collateral backing all promises to
pay at t = 1.
     There is a continuum of agents of measure one. So in this paper we are not concerned
with small numbers. The agents are however divided into H types, each of which is indexed
by h = 1, 2, · · · , H. Each type h consists of αh ∈ [0, 1] fraction of the population such that
P h                                                                          h     h   h
                                                                                                   2
  h α = 1. Each agent type h is endowed with good 1 and good 2, e0 = e10 , e20 ∈ R+ in
                                                                                                    
period t = 0 and ehs = eh1s , eh2s ∈ R2+ , in each state s = 1, · · · , S. Let eh = eh0 , · · · , ehS ∈
 2(1+S)
R+        be the endowment profile of agent type h over period t = 0 and all states s in period
t = 1. There are thus 2 (1 + S) commodities in total. Heterogeneity of agents originates
in part from the endowment profiles eh (and not in preferences, but we could easily allow


                                                  8
this extension). As a notational convention, vectors or matrices will be represented by bold
letters. We also assume that the endowments in all periods and all states are publicly known.
Hence, the limited commitment considered in this paper comes from a contract enforceability
problem, not from an informational problem. We leave the latter for future work. In the
concluding section, we interpret an agent as a trader (insurance company and/or hedge
fund) and think of endowments as pretrade portfolios determined by considerations outside
the model.
   Let k h ∈ R+ denote the collateral holding (equivalent to the holding of good 2) of an
agent type h at the end of period t = 0. Note that this collateral allocation does not need to
be equal to his initial endowment of good 2. In particular, since good 2 can be exchanged or
acquired in the contracting period (at date t = 0), k h will be equal to the net-position in the
collateral good after trading in period t = 0. The collateral good as legal collateral backing
claims is assumed to be fully registered and kept in escrow, i.e., cannot be taken away either
by borrowers or lenders. However, the holding of good 2 can also include normal saving. The
storage technology of good 2 whether in collateral or normal saving is linear but potentially
with a random return. In some applications, it is natural to treat the returns as a constant,
and focus on how collateral interacts with intertemporal trade. In other applications, the
risk is in the collateral itself. Each unit of good 2 stored will become Rs units of good 2
in state s = 1, · · · , S. Specifically, storing I units of good 2 at date t = 0 will deliver Rs I
units of good 2 in state s. It is noteworthy that the results in this paper are valid even if
the technology R is not random. In most of the exposition, uncertainty originates in the
endowment, primarily. In the concluding section, we can interpret Rs as determined outside
the model, e.g., world events determine the price of treasuries, as if in a small open economy.
                                                                                       
   The preferences of agent type h are represented by the utility function u ch1 , ch2 : R2+ →
                  
R, where ch1 , ch2 are the consumption of good 1 and good 2 of agent type h, respectively.
Let 0 < β ≤ 1 be the common discount factor. The discounted expected utility of h is thus
                                                                          S
                                                                          X
                              h       h
                                                   ch10 , ch20                  πs u ch1s , ch2s
                                                                                                 
                          U       c           =u                     +β
                                                                          s=1
                                                                     2(1+S)
where, as with the notation for endowments, ch = ch0 , · · · , chS ∈ R+      is the consumption
                                                             
allocation with ch0 ≡ ch10 , ch20 ∈ R2+ and chs ≡ ch1s , ch2s ∈ R2+ for s = 1, . . . , S as the

                                                                 9
consumption of good 1 and good 2 in period t = 0, and in state s, respectively. In our trader
interpretation in the concluding section, consumption removes securities from a portfolio,
though the reason utility is derived from this is not modeled there.
                                                                        
Assumption 1. For each agent type h, common utility function u ch1 , ch2 is homothetic,
continuous, strictly concave, strictly increasing in both arguments, and satisfies the usual
Inada conditions.

   Homotheticity is special but will allow us to construct closed form solutions in the de-
termination of spot prices. This has great expositional advantage when it comes to under-
standing how security markets work to correct the externality. Risk aversion with random
endowments motivates trade in state-contingent securities. Heterogeneous intertemporal en-
dowments motivates trade in bonds. We will on occasion put superscript h on the utility
function for clarity, but again preference heterogeneity per se is not an essential part of what
we do here.


2.1    Market Fundamentals

Each agent can trade in spot markets in each state s. In principle, the market-clearing prices
in these spot markets depend on the distribution of pretrade (before ex post spot trade)
endowments or the composition of agents. To be precise, let zs be a market fundamental
that determines the spot-market-clearing price of good 2 in state s, and accordingly p(zs )
be the spot-price function.
    With identical homothetic preferences, the aggregate ratio of good 1 to good 2 in state s
                                                       P h h
                                                          α e
is the market fundamental in state s; that is, zs = Rs K+hP α1sh eh ∈ R+ , where K = h αh k h is
                                                                                    P
                                                          h    2s

the aggregate (endogenous) saving including collateral. Here then the spot price function can
be represented by a single-valued function p(zs ). In other words, the market fundamental,
a ratio of goods in state s, is necessary and sufficient to pin down the spot price in state s.
We summarize:

Lemma 1. With identical homothetic preferences, the market fundamental in state s is given




                                              10
by
                                                 h h
                                               P
                                              h α e1s
                               zs =                                 .                          (1)
                                                          αh eh2s
                                           P h h
                                                   P
                                      Rs   hα k +     h

Market clearing price p(zs ) is a one-to-one function, i.e. p(zs ) is a single-valued, and p(zs ) =
p(zs0 ) implies that zs = zs0 . In addition, with strictly concavity of u(·), p(zs ) is strictly
monotone increasing.

     Condition (1) is called a consistency constraint. It ensures that the market fundamental
is consistently well-defined in that p(zs ) is exactly the spot price that constitutes a spot
market equilibrium. This is where we exploit the homotheticity assumption; ratios of the
aggregate are enough to pin down equilibrium prices.


2.2     Collateralization Structure

A specific piece of collateral can be used to back up several contracts as long as their promises
to pay are in different states. Thus, there is no conflict in a given state s. This is known as
tranching. This is distinct from the contract-specific collateralization structure (in Geanako-
plos, 2003, among others), in which the collateral of a given security cannot be used as
collateral for any other security. For full generality here, we will consider state-contingent
securities as the primitives and otherwise let the security structure be endogenous. Accord-
ingly, we focus on securities paying in each state s with market fundamental zs , one at a
time. In words, we are dealing with an Arrow-Debreu complete security environment, but
collateral will limit the securities which emerge in equilibrium.
     A (contingent) security promising to pay one unit of good 1, the numeraire, in period
t = 1 and state s with C
                       b units of good 2 as collateral is a promise to pay a unit of good

1 if the state of nature is s and nothing otherwise. For notational convenience, we use b
to distinguish securities paying in good 1, the numeraire, from securities paying in good 2.
With limited commitment, that is, allowing default on the part of the person making the
promise, the payoff of this security is given by
                                                   
                                min 1, CR b s p(zs )      if state is s,
                         Db=                                                                   (2)
                                0                         otherwise,

                                                   11
where this payoff is in units of good 1 in period t = 1, and p(zs ) is the price of good 2 (in units
of good 1) in state s converting good 2 with its potentially random return into units of good
1. That is, the person pays off as promised in good 1 or defaults surrendering collateral. The
issuer or “borrower” in period t = 0 may not wish to honor the state-contingent obligation.
This creates the limited commitment problem; that is, she will keep the promise if that
promise is no larger than the value of the collateral, i.e., 1 ≤ CR
                                                                 b s p(zs ), and will “default”

otherwise, CR
           b s p(zs ) < 1. In case of default, the payoff of the contract in state s is equal to

the value of its collateral in that state, CR
                                           b s p(zs ) units of good 1. Note in particular that

this defaulting condition depends on the spot price p(zs ).
   Ironically, it can be shown that there is no loss of generality in restricting attention to
securities without default. Intuitively a security which would default has a known payoff
structure, so we may as well start with that in the first place. But the possibility of de-
fault does restrict securities, and collateral constraints can be binding. The discussion is
summarized in the following lemma.

Lemma 2. For any state-contingent security, there exists a security with no default that
can generate the same total payoffs using the same amount of collateral.

   In Appendix A, we present the result for a security paying in good 1 in state s with good
2 as collateral, and then argue that the same logic applies for all other types of securities. See
Kilenthong (2011) for a similar result with contract-specific collateralization. Further, issuing
securities that do default requires no less collateral than (an equivalent set of) securities that
do not. In other words, and this again may seem counterintuitive, securities with default,
i.e., with little collateral, do not really economize on collateral. In addition, we also show in
Appendix B.1 that default cannot make collateral constraints, formally defined below, less
binding.
   In addition, with perfectly divisible collateral, there is no loss of generality in excluding
over-collateralized securities, whose collateral value is strictly larger than the promise. More
precisely, an over-collateralized security paying in good 1 in state s is a contract with a
collateral C
           b such that CR
                       b s p(zs ) > 1. The payoff of this security in state s is 1. This security
                                                  1
is equivalent to a no-default security with    Rs p(zs )
                                                           <C
                                                            b units of good 2 as collateral, whose


                                                12
payoff in state s is also 1. A similar result applies to other types of securities as well.
        It is worthy of emphasis, however, that own saving should not be interpreted as over-
collateralization, as no securities are acquired from others; that is, each agent can save.
This saving will result in the slackness of the collateral constraint (3) defined below. In
particular, an agent may hold at the end of period t = 0 more collateral good than the
(minimum) amount needed to collateralize all securities issued.



3         Collateral Constraints and Externality
There is no loss of generality in considering at most only two classes of securities6 ; (i) θ̂sh
- securities paying in good 1 in state s, (ii) θsh - securities paying in good 2 in state s.
Here a positive number denotes the purchaser or holder, and negative the issuer. When
negative, each of the state-contingent securities must be backed by the issuer either by good
2 itself or by purchased assets (other people’s promises). In other words, θ̂sh and θsh include
both directly collateralized and asset-backed securities. As established in Appendix B.2, the
collateral constraints7 for an agent type h take the intuitive form

                                    p(zs )Rs k h + θ̂sh + p (zs ) θsh ≥ 0, ∀s.                              (3)

        The collateral constraint (3) states that, for each state s, the net-value of all assets,
including collateral good and securities, must be non-negative. If θ̂sh and θsh were negative,
as promises, we could write this as p (zs ) Rs k h ≥ −θ̂sh − p (zs ) θsh . That is, there is sufficient
collateral in value in state s to honor the value of all such promises. Note that all promises
are converted to units of good 1 using the spot market price of the collateral good p (zs ).
Also as θ̂sh and θsh include both asset-backed and directly backed securities, these collateral
    6
        With spot markets we actually need securities θ̂sh paying in the numeraire only. We proceed here in more
generality as what we do will not require active spot markets.
   7
     These collateral constraints are different from the ones in Geanakoplos (2003) in that they now include
all state contingent collateralized securities with tranching and pyramiding. See Appendix B.2 for more
details. Similar collateral constraints are discussed in liquidity literature, e.g., Caballero and Krishnamurthy
(2001); Holmström and Tirole (1998); Rampini and Viswanathan (2010).




                                                        13
types per se do not matter, either8 .
       The collateral constraints (3) can be written in consumption space as follows. Suppose
for the moment that securities are such that there is no spot trade in equilibrium (see Lemma
6 in Appendix B.4). The consumption for an agent type h in state s is given by

                                          ch1s = eh1s + θ̂sh ,                                              (4)

                                          ch2s = eh2s + Rs k h + θsh .                                      (5)

Substituting these two equations into the collateral constraint (3) yields

                                     ch1s + p(zs )ch2s ≥ eh1s + p(zs )eh2s .                                (6)

This condition implies that, due to limited commitment and the possibility of default, the
market value of consumption in a state s of an agent cannot be lower than the market
value of her endowment (without collateral k h ) in the same state (related to Golosov and
Tsyvinski, 2007; Kehoe and Levine, 1993, among others). Intuitively, if this constraint were
to be violated, an agent type h would have promised to deliver some part of the value of
her endowments, over and above her consumption, but other things equal there will be no
incentive to deliver ex post. Collateral will preclude (6) from being violated.
       The interaction between the bindingness of collateral constraints and spot prices generates
an externality. Technically, there is an externality because the consumption feasibility set of
an agent type h depends on other agents’ choices of saving k h̃ through the spot price. This
dependency results from the collateral constraints (6), or borrowing constraints in general.
Conceivably, if there were no binding collateral constraint, the consumption feasibility set
would be independent of other agents’ choices (and therefore there would be no externality).


3.1        Competitive Collateral Equilibrium

Let Pbas and Pas be the prices of securities in the ex ante t = 0 market paying in good 1 and
in good 2 in state s, respectively. We allow spot price p (zs ) but we do not require agents to
   8
       In addition, we can show that the markets economize on collateral; that is, there is no gain from pooling
collateral across agents type h (see Lemma 5 in Appendix B.3).



                                                        14
be active in these markets since they could have all ex ante contingent commodity securities
trade at t = 0. A collateral equilibrium is defined:

Definition 1. A competitive collateral equilibrium is a specification of prices of good 2 in
period t = 0, P20 , the prices of securities paying in good 1, Pbas , and the prices of securities
paying in good 2, Pas , the spot price of good 2 in each state s, p(zs ), and an allocation
                 
   h    h h h
  c0 , k , θ̂ , θ   such that
                h
                                                            
  (i) for any agent type h,           ch0 , k h , θ̂h , θh       solves
                                                                     X                                                         
                                           ch10 , ch20                                eh1s       θ̂sh , eh2s        h
                                                                                                                          θsh
                                                         
                          max u                              +β            πs u              +                 + Rs k +              (7)
                    (ch0 ,kh ,θ̂h ,θh )                                s

      subject to the collateral constraints for each state s:

                                       p (zs ) Rs k h + θ̂sh + p (zs ) θsh ≥ 0, ∀s,                                                  (8)

      and the budget constraint at t = 0:
                                          X             X
                    ch10 + P20 ch20 + k h +  Pbas θ̂sh +   Pas θsh ≤ eh10 + P20 eh20 ,                                               (9)
                                                             s                    s
                                             
      taking prices P20 , Pbas , Pas , p (zs ) as given;

 (ii) markets clear for good 1 at t = 0, for good 2 at t = 0, for θ̂sh in state s, and for θsh in
      state s, respectively:
                                                             X                          X
                                                                 αh ch10 ≤                       αh eh10 ,                          (10)
                                                             h                             h
                                           X                      X
                                                  αh ch20 + k h ≤   αh eh20 ,
                                                              
                                                                                                                                    (11)
                                             h                                             h
                                                             X
                                                                     αh θ̂sh   = 0, ∀s,                                             (12)
                                                             h
                                                             X
                                                                     αh θsh = 0, ∀s;                                                (13)
                                                             h


(iii) the consistency constraint
                                                                            h h
                                                                     P
                                                                        h α e1s
                                           zs =                                                                                     (14)
                                                                                           αh eh2s
                                                             P                P
                                                    Rs           h   αh k h +          h

      holds for all s.

                                                                     15
   The necessary maximizing condition for a collateral equilibrium (ce) related to collateral
allocation k h (an interior solution to the consumer problem) is given by, for any h,
                                                                                   h
                                    uh20             X                uh2s      X γcc−s
                         P20 =                  =          πs β            Rs +         p(zs )Rs ,               (15)
                                    uh10   ce
                                                     s
                                                                      uh10      s
                                                                                   uh
                                                                                    10

               ∂u(ch
                   10 ,c20 )
                        h                  ∂u(ch
                                               1s ,c2s )
                                                    h
where uhi0 =      ∂ci0
                             ,   uhis =       ∂cis
                                                                                h
                                                             for i = 1, 2, and γcc−s is the Lagrange multiplier for
the collateral constraint (8) in state s for an agent type h.


3.2    Collateral Constrained Optimality

Attainable allocations are those that can be achieved by exchanges of securities and collateral
in date t = 0 and exchanges of consumption goods in date t = 1 at state s, respecting spot
prices p(zs ). In other words, a planner can only reallocate goods with the same instruments
as the agents. Accordingly, attainable allocations are defined using the spot-price function
p(zs ). Again as will be later proved (see Lemma 6 in Appendix B.4), the asset-backed
securities in this model are simply substitutes for spot markets.
                                                 
Definition 2. An allocation ch0 , k h , θ̂sh , θsh is attainable if
                                                                            h

  (i) it satisfies resource constraints:
                                                              X                              X
                                                                        αh ch10 ≤                    αh eh10 ,   (16)
                                                                  h                              h
                                                X                                            X
                                                         h
                                                                 ch20            h
                                                                                                     αh eh20 ,
                                                                                    
                                                     α                  +k               ≤                       (17)
                                                 h                                               h
                                                                 X
                                                                            αh θ̂sh      = 0, ∀s,                (18)
                                                                   h
                                                                 X
                                                                            αh θsh = 0, ∀s;                      (19)
                                                                   h

 (ii) for each agent type h, it satisfies the collateral constraints for each state s:

                                            p(zs )Rs k h + θ̂sh + p(zs )θsh ≥ 0, ∀s,                             (20)

(iii) the consistency constraint
                                                                                   h h
                                                                            P
                                                                               h α e1s
                                                zs =                                                             (21)
                                                                                                 αh eh2s
                                                                 P                   P
                                                         Rs             h   αh k h +         h

      holds for all s.

                                                                            16
       We note in passing with a non-constant, s-contingent spot-price function that the attain-
able set is non-convex. The main source of the non-convexity is the product of spot-price
                                                                                
function and the sum of collateral and contract allocations, p(zs ) Rs k h + θsh , in the col-
lateral constraints (3). Thus there are hints already that mixed strategies or lotteries may
come into play. We turn to this issue later in the paper but earmarked it here for future
reference.

Lemma 3. With identical homothetic and strictly concave preferences, the attainable set is
non-convex.

       A constrained optimal allocation is characterized using the following planner’s problem.
         h
Let U be the reservation utility level for an agent type h.

Program 1. The Pareto Program with collateral constraints:
                                                              X
                                            u c110 , c120 + β   πs u e11s + θ̂s1 , e12s + Rs k 1 + θs1
                                                                                                      
                           max                                                                             (22)
                     (ch0 ,kh ,θ̂h ,θh )h                      s

subject to (16)-(21), and the participation constraint for each h = 2, · · · , H,
                                         X                                           h
                       u ch10 , ch20 + β   πs u eh1s + θ̂sh , eh2s + Rs k h + θsh ≥ U ,
                                                                                
                                                                                                           (23)
                                                 s

and non-negativity constraints for consumption and collateral allocations.

       As is typically the case, it suffices to consider only equal-treatment-of-equals in the Pareto
problem. More generally, the externalities in this class of models, if they exist, have nothing
to do with the equal treatment of equals property. Let µhcc−s , and µhū denote the Lagrange
multipliers for the collateral constraint (3) for agent h in state s, and for the participation
constraint (23) for agent h, respectively. For notational convenience, let µ1ū = 1. A necessary
condition9 for constrained optimality10 (op) related to collateral allocation k h is given by,
for any h,
   9
       Given that the constraint set is not convex (Lemma 3), this optimality condition is necessary but may
not be sufficient. Nevertheless, this does not cause any problem to our externality argument, as we simply
need to show that a collateral equilibrium cannot be constrained optimal, i.e. does not satisfy the necessary
optimal condition (24).
  10
     For expositional simplicity and without any real loss, we consider only equal-treatment (for each type),
and interior solutions (i.e., the non-negativity constraint for k h is neglected). With homothetic and strictly


                                                                17
          uh20             X           uh2s      X µhcc−s             X αh p0 (zs ) ∂zs X
                       =       πs β         Rs +           p(zs )Rs −                     µh̃cc−s θ̂sh̃ , (24)
          uh10    op
                           s
                                       uh10      s
                                                   µ h h
                                                       u
                                                     ū 10            s
                                                                        µ h h p(z ) ∂K
                                                                            u
                                                                          ū 10  s
                                                                                                 h̃

                           ∂p(zs )
where p0 (zs ) =                                    αh k h , µhcc−s is the Lagrange multiplier for the collateral
                                              P
                            ∂zs
                                   ,   K =      h

constraint (20) for state s for an agent type h and µhū is the Lagrange multiplier for the
participation constraint (23) for an agent type h = 1, 2, . . . , H with a normalization of
µ1ū = 1.
       Of special interest, the last term depends not only on the bindingness of collateral con-
straints for h but also the bindingness of other agents’ collateral constraints. This implies
that if an agent type’s collateral constraint were binding, it would impact everyone. This
is the source of the externality. Again such results are easily surmised from an extensive
literature, but we quickly review in the next section.


3.3         The Externality

Note that an infinitesimal agent of type h takes a spot price, p(zs ), as invariant to his or
her own actions. To the contrary, the constrained planner can influence the spot prices
p(zs ) through collateral assignments, k h , for the agents of type h = 1, 2, . . . , H, in period
t = 0, which affect in turn the market fundamentals zs . This key influence is the term in
p0 (zs ) ∂zs
p(zs ) ∂K
             .   The difference between the impact of the planner and that of the agents creates
the externality and causes an inefficiency. If the last term in (24) were zero and we set
 h               µh
                  cc−s
γcc−s =           µh
                       ,   then condition (15) is exactly the same as (24), and there would be no
                    ū

externality.
                                                                                            p0 (zs ) ∂zs
       The last term in (24) could be zero if either µh̃cc−s = 0 for all h̃ or              p(zs ) ∂K
                                                                                                           = 0. With
a strictly concave utility function, the spot price varies with the market fundamental11 (is
concave preferences, and no non-convexity, agents of the same type will optimally choose the same allocation
in an equilibrium; that is, given the same market prices in equilibrium. Thus, a collateral equilibrium
allocation has equal-treatment-of-equals property.
  11                                                                                            p0 (zs ) ∂zs
       If the utility function is linear in both goods, then the spot price is constant, i.e.   p(zs ) ∂K      = 0. This
clearly results in constrained efficiency. Similarly, if the amount of aggregate saving is fixed exogenously,
then the market fundamental (the ratio of good 1 to good 2) is fixed. This also implies that the last term is
zero, and so constrained efficiency.


                                                               18
                           p0 (zs ) ∂zs
not constant), i.e.        p(zs ) ∂K
                                          6= 0. As a result, when at least one of the collateral constraints
is binding, i.e., µh̃cc−s > 0 for some h̃, the last term in (24) will be non-zero. With this
non-zero term, a collateral equilibrium will not be constrained efficient. It is true that, as
an exceptional case, a collateral equilibrium could be a full first-best optimum, that is, the
environment could be such that despite the focus of the paper we could ignore the collateral
constraint. But, otherwise, the collateral equilibrium must be constrained suboptimal, and
that is the assumed benchmark case of interest that motivates the paper. The result is
summarized in the following proposition.

Proposition 1. Under Assumption 1, a competitive collateral equilibrium is constrained
                                                                         h
optimal if and only if all collateral constraints are not binding, i.e. γcc−s = µhcc−s = 0 for
all h and all s. As a result, a competitive collateral equilibrium is constrained suboptimal if
and only if it is not first-best optimal.

    In particular when the last term in (24) is not zero, we can show that it must be pos-
                  h    0
itive, i.e., s µhαuh pp(z(zss)) ∂z
            P                        P h̃        h̃
                                      h̃ µcc−s θ̂s > 0. As a result, the equilibrium price of good 2 in
                                   s
                   ū 10        ∂K

period t = 0 will be too high relative to its shadow price from the (constrained) optimal
             uh
allocation    20
             uh
                    .   In addition, this implies that the competitive collateral equilibrium level
              10 op

of (endogenous) aggregate saving K ce is too large relative to the (constrained) optimal level
of aggregate saving/collateral K op . Intuitively, the planner can do better by lowering the
aggregate saving or collateral. This is our analogous here to the result of Hart and Zingales
(2113) that it is possible for agents to be saving too much. The result is summarized in the
following proposition.

Proposition 2. Under Assumption 1, if a competitive collateral equilibrium is not first-best
optimal, then

                                                                                                uh
  (i) the equilibrium price of good 2 in period t = 0, P20 , is too high, i.e., P20 >            20
                                                                                                uh
                                                                                                       ,   and
                                                                                                 10 op



 (ii) the (endogenous) aggregate saving/collateral in a competitive collateral equilibrium,
      K ce , is too large, i.e., K ce > K op .




                                                           19
4        Internalizing The Externality: The Economy with
         Segregated Security Exchanges
This section presents the key contribution of this paper, a market-based solution to the
externality problem. A key object is the discrepancy from the market fundamental of each
type, as this reflects the “marginal impact” of each type on others at an equilibrium price.
This new object when priced then makes each type pay or be paid according to their marginal
impact on the price used to unwind collateral, adding to or alleviating congestion, so to speak.
But this object exists and is priced for out-of-equilibrium prices as well. Taken together these
internalize the externality.
       In particular, let z = (zs )Ss=1 denotes a vector of the market fundamentals in all states
s. Being in a security exchange zs in state s means that an agent h can trade in spot
markets and value collateral at spot price p(zs ), as determined by the market fundamental
zs . Equivalently, even if the spot markets were shut down12 , an agent on a security exchange
zs can accomplish the same thing by trading in ex-ante securities (θ̂s , θs ), which has a relative
price equal to the same p (zs ).
       Now let ∆hs (zs ) ∈ R define “type h’s discrepancy from the market fundamental in state
s” a scalar13 :

                                   ∆hs (zs ) = zs eh2s + Rs k h − eh1s , ∀s,
                                                               
                                                                                                          (25)

which can be rewritten as
                                                                               eh1s
                                                                                         
                          ∆hs             eh2s            h
                                                              
                                (zs ) =          + Rs k            zs −                       , ∀s.       (26)
                                                                          eh2s + Rs k h
                                                     eh
Note that if ∆hs (zs ) = 0, then zs =             h
                                                      1s
                                                 e2s +Rs kh
                                                              and type h’s pretrade endowment is exactly equal
to the market fundamental. But typically with heterogeneity and active trade an agent type
h will be on one side or the other of the market fundamental, buying or selling the collateral
good 2 for good 1. Of course it takes at least two sides to make open an active market.
  12
       As proved in Lemma 6 in Appendix B.4, the spot markets are redundant in that agents are indifferent
between trading in ex-ante contracts or in spot markets. Importantly, the spot markets are opened.
  13
     If we were in the underlying spaces of k and zs , they would enter multiplicatively, hence and so we would
have a non convexity problem. This is not a problem with lotteries, however.


                                                                  20
                                    eh
If ∆hs (zs ) > 0, then zs >     eh
                                     1s
                                    +R  sk
                                           h   and type h holds a relative low amount of good 1 and
                                 2s

abundant amount of good 2, that is, relative to zs . Such an agent type h brings in good two,
the collateral good, in such a way that they push the valuation of collateral (the spot price
of good 2 here) downward; that is, his pretrade actions have a negative marginal impact on
the valuation of collateral to unwind commitments. As a result, he would need to pay for
the right to trade or unwind in this market. Conversely, when ∆hs (zs ) < 0, an agent type
h has a relatively high amount of good 1 and scarce amount of good 2, relative to zs . We
know that there is oversaving in general, so this type will be compensated. Specifically, his
pretrade actions have a positive marginal impact on the valuation of collateral. Therefore
he would need to be paid to enter a high zs , high p (zs ) market.
    Adding one unit of good 2 (via collateral k) adds to the discrepancy ∆hs (zs ) by exactly
zs Rs (see Eq.25). This is the same for all agent types. But note also that there is a part of
∆hs (zs ) over which h has no control, namely her endowments. However, we assume that types,
hence the endowments are publicly known. The “type h discrepancy from the fundamental”
will be priced in a competitive equilibrium. The per unit price, denote P∆ (zs , s) below, will
be common. But the payment or subsidy for rights to trade in each security exchange will be
proportional to the “type h discrepancy from the fundamental”, that is price times quantity,
and again the latter can be negative.
    More formally, let an indicator function δ h (zs ) ∈ {0, 1}, that is δ h (zs ) = 0 or δ h (zs ) = 1,
denote an agent type h’s discrete choice of security market zs in each state s = 1, 2, . . . , S.
That is, each agent must choose one but only one fundamental spot market in each state s.
With vector z = (zs )Ss=1 , we write this function as δ h (z) such that z δ h (z) = 1. Specifically,
                                                                       P

δ h (z) = ΠSs=1 δ h (zs ) = 1 if only if δ h (zs ) = 1 for all s. Let P∆ (zs , s) denote the market price
of rights to trade in security exchange zs in state s, ∆hs (zs ). But consistent with key notion
of segregated exchanges, these choices of z are bundled with the consumption good, secu-
                                                                                                             
rities and collateral. Notationally, let xh (z) = δ h (z) , k h (z) , ch10 (z) , ch20 (z) , θ̂sh (z) , θsh (z)
denote a typical bundle or allocation for an agent type h.
    A competitive equilibrium with segregated security exchanges is defined as follows.

Definition 3. A competitive equilibrium with segregated security exchanges is a specifica-
                                                                                             
tion of allocation xh (z) h and prices P20 , P̂a (zs , s) , Pa (zs , s) , P∆ (zs , s) , p (zs ) such that

                                                       21
                                                                                                           
  (i) for any agent type h, allocation xh (z) = δ h (z) , k h (z) , ch10 (z) , ch20 (z) , θ̂sh (z) , θsh (z)
      solves
                            "                                                                            #
               X                                   X                                                  
                   δ h (z) u ch10 (z) , ch20 (z) +   πs u eh1s + θ̂sh (z) , eh2s + Rs k h (z) + θsh (z) (27)
                                                
      max
      xh (z)
               z                                                     s

      subject to collateral constraints
                      X          h                                       i
                          δ h (z) p (zs ) Rs k h (z) + θsh (z) + θ̂sh (z) ≥ 0, ∀s,
                                                             
                                                                                                                               (28)
                                z

      and budget constraints
                 X         n                                X
                    δ (z) ch10 (z) + P20 ch20 (z) + k h (z) +
                      h
                                                               P̂a (zs , s) θ̂sh (z)
                                        
                        z                                                                          s
                            X                                       X                                o
                       +            Pa (zs , s) θsh (z) +                    P∆ (zs , s) ∆hs (zs )       ≤ eh10 + P20 eh20 ,   (29)
                                s                                    s
                                                                                  
      taking prices prices P20 , P̂a (zs , s) , Pa (zs , s) , P∆ (zs , s) , p (zs ) as given;

 (ii) markets clear for good 1 in period t = 0, for good 2 in period t = 0, for securities
      paying good 1, for securities paying good 2, and for rights to trade, respectively,


                                                   XX                                                X
                                                                     δ h (z) αh ch10 (z) =                 αh eh10 ,           (30)
                                                       h        z                                      h
                                    XX                                     X
                                               h            h
                                              δ (z) α ch20 (z) + k h (z) =   αh eh20 ,
                                                                       
                                                                                                                               (31)
                                     h    z                                                            h
                                                   XX
                                                                         h
                                                                     δ       (z) αh θ̂sh   (z) = 0, ∀s; zs ,                   (32)
                                                       h    z−s
                                                   XX
                                                                     δ h (z) αh θsh (z) = 0, ∀s; zs ,                          (33)
                                                       h    z−s
                                                   XX
                                                                    δ h (z) αh ∆hs (zs ) = 0, ∀s; zs ,                         (34)
                                                   h       z−s

      where z−s = (z1 , . . . , zs−1 , zs+1 , . . . , zS ) is a vector of market fundamentals in all states
      but state s.


4.1     Public Finance Interpretation

This section presents an alternative interpretation of the market based solution. The budget
constraint with its prices for discrepancies from the market fundamentals has a public finance

                                                                         22
interpretation, as if we were to try to implement the optimum solution by taxes and subsidies,
both lump sum and marginal.
                                                                
   Specifically, substituting (25), ∆hs (zs ) = zs eh2s + Rs k h − eh1s , into the budget constraint
for an agent type h (29) gives
   X         n                                  X                         X
      δ h (z) ch10 (z) + P20 ch20 (z) + k h (z) +  P̂a (zs , s) θ̂sh (z) +   Pa (zs , s) θsh (z)
                            
    z                                                        s                                       s
                                             X                                                       o
                                                                  eh2s            h
                                                                                              eh1s        ≤ eh10 + P20 eh20 , (35)
                                                                                      
                                         +       P∆ (zs , s) zs          + Rs k           −
                                             s

which can be rewritten as
          X        n                             X                        X                   o
               h      h
                                 h         h                      h                      h
             δ (z) c10 (z) + P20 c20 (z) + k (z) +  P̂a (zs , s) θ̂s (z) +   Pa (zs , s) θs (z) ≤
                z                                                         s                                     s
        X             n        X                           X                      X                        o
            δ h (z)
                                                h                          h                         h
                           1+       P∆ (zs , s) e10 + P20 −   P∆ (zs , s) zs e20 −    P∆ (zs , s) zs Rs k (z) .(36)
        z                       s                                 s                                         s

We can now see that we need to have three types of taxes/subsidies, (i) saving/collateral
       P
tax of s P∆ (zs , s) zs Rs per unit of saving/collateral, (ii) capital good endowment tax of
P
  s P∆ (zs , s) zs per unit of collateral good endowment, and (iii) income or consumption good
                                    P
endowment (negative) tax of − s P∆ (zs , s) per unit of consumption good endowment. The
endowment/income taxes are easy to see and since endowments are fixed, they can be viewed
as lump sum taxes/subsidies or budget shifters. The saving/collateral tax enters the budget
too but it is also endogenous as saving is; hence we can think of this as a marginal tax
rate the agent type is facing for a given, fixed security exchanges zs that the agent chooses.
However, the security exchange zs itself is a choice as far as the household is concerned, so
in some sense even the fixed budget shifters are a choice for the agent. This is like looking
up fixed and marginal rates in a big tax book and settling on which page (or pages) to use,
indexed by active security exchanges zs that the agent chooses.


4.2         Example Economies with Segregated Security Exchanges

The following three examples illustrate the competitive equilibrium with segregated security
exchanges.

Environment 1 (Intertemporal Smoothing). There are two periods, t = 0, 1, and a single
state, S = 1 in period t = 1. So this is a pure intertemporal economy. Henceforth we drop

                                                           23
all subscript s from the notation. There are two types of agents, H = 2, both of which have
an identical constant relative risk aversion (CRRA) utility function

                                                           1  1
                                       u(c1 , c2 ) = −       − , ∀h.                           (37)
                                                           c1 c2
                        1
Each type consists of   2
                            fraction of the population, i.e. αh = 12 . In addition, the discount
factor β = 1. The storage technology is given by R = 1. The endowment profiles of the
agents are shown in Table 1 below. Recall that ehit is an agent h’s endowment of good i in
period t. Note that endowments for both agents are symmetric. In particular, an agent type
1 is well endowed with both goods in period t = 0 and vice versa for type 2.

                            Table 1: Endowment profiles of the agents.
                                     endowments                first-best allocations
                              eh10    eh20   eh11   eh21      kh   ch10   ch20   ch11   ch21
                   h=1         3       3      1      1        0     2      2      2      2
                   h=2         1       1      3      3        0     2      2      2      2


   The symmetry of endowments and preferences together with β = 1 implies that the first-
best aggregate saving is zero, and each agent gets the average 2 units of each good in each
                                                                                      fb
period (see Table 1). Accordingly, the first-best price of good 2 in period t = 0 is P20 =1
(“fb” stands for first-best), and the market fundamental is z = 1. Unfortunately, but to
make our point, the first-best allocation is not attainable; that is, it violates the collateral
constraints.
   We now consider the economy with default and collateral (with an externality). The
endowment profile and the first-best allocation suggest that agent 2 would like to move
resources backwards in time from t = 1 to t = 0, i.e., borrow and therefore will be constrained.
Hence, we will assume that agents type 2 hold no collateral, i.e. k 1 = k ex (“ex” stands for
externality) and k 2 = 0. We will then solve for an equilibrium k ex . Note that if agent type
1 wants to save and if there is no lending to another agent, this saving must be in good 2.
   As shown in Appendix C.1, the equilibrium collateral is k ex = 1.3595. In addition, there
is no loss of generality to consider a solution with no security trading, i.e., θh = θ̂h = 0
for all h. As a result, agents actively trade in spot markets, which we denote by trades

                                                         24
τ h below. Despite this seeming triviality, this is a good starting point, a good example
economy as there remains the issue of the value for unwinding collateral. The zero debt
aspect resembles Hart and Zingales (2113) in which an entire market in human-capital-
backed trade is shut down. It is worthy of emphasis, however, that all spot trades can be
done using ex-ante security trades and we return to that interpretation below. The price
                                            2
of good 2 in period t = 0 is P20ex
                                   = 4−k4 ex = 2.2948, and the market fundamental in
                           4
period t = 1 is z ex =   4+kex
                                 = 0.7463, which implies that the spot price is p(z ex ) = 0.5570.
Note that the collateral price at t = 0 is higher in the equilibrium with an externality, i.e.,
 fb        ex
P20 = 1 < P20 = 2.2948. On the other hand, the spot price of good 2 in period t = 1 is
lower in the equilibrium with the externality, i.e., p(z f b ) = 1 > p(z ex ) = 0.5570. In words,
the collateral distortion makes the price of good 2 higher in the first period and lower in the
second period relative to the first-best.
   Figure 1 illustrates the competitive collateral equilibrium allocation (with externality)
in period t = 0. It shows that an agent type 1, the unconstrained agent, sells good 1 and
buys good 2, and vice versa for agent 2. In addition, the allocation is on the budget line of
constrained agent 2, which is the line passing through e20 . An unconstrained agent effectively
does all the saving, k 1 = k ex = 1.3595 and k 2 = 0. In the spot market the direction of trades
                                             1                                      1
is reversed. That is, an agent type 1 buys τ̂ex = 0.3252 units of good 1 and sells τex = −0.5839
units of good 2 at price p(z ex ) = 0.5570 in spot markets, and vice versa. See figure 2a below.
                                                                     1
In addition, the expected utility of an agent type 1 and type 2 are Uex = −2.2527 and
 2
Uex = −2.5724, respectively.
   We will now turn to a corresponding competitive equilibrium with segregated security
exchanges (without an externality). There is one active security exchange, z op = 0.7729
(“op” stands for optimality), even though all security exchanges are available for trade.
That is, in equilibrium, both types optimally choose to trade in the same security ex-
change with specified market fundamental z op = 0.7729. More formally, δ 1 (z op = 0.7729) =
δ 2 (z op = 0.7729) = 1. The collateral allocation in the competitive equilibrium with segre-
gated security exchanges is k 1 (z op = 0.7729) = k op = 1.1753 and k 2 = 0. The equilibrium av-
erage or per capita saving (without externality) is h z αh δ h (z) k h (z) = α1 k op = 0.5877,
                                                       P P

which clearly smaller than the aggregate saving in the equilibrium with the externality


                                                 25
                                                                                                                                                 e10
                                                                                                                                                         e210 = 1
                                                                                                                                                                      Agent 2




                                                     good 2 in period 0
                                                                                                                                                          ex
                                                                                                                                                         k = 1.3595




                                                                                                                                                                            e220 = 1
                                                                                                                                       A


                  e120+e220-kex= 2.6405
                                          e120 = 3
                                                                                                                                                e20


                                                                                                                                           budget line in period 0




                                                                          with externality: kex = 1.3595
                                                                                                                                                       good 1 in period 0
                                                      Agent 1                                              e110 = 3
                                                                                                                      e110+e210   =4



Figure 1: Point A is the competitive collateral equilibrium allocation (with externality) in
period t = 0 with c10 = (2.6899, 1.7756) and c20 = (1.3101, 0.8649). An agent type 1 sells
0.3101 units of good 1, buys 0.1128 units of good 2, and k ex = 1.3595 saves units of good 2,
and vice versa.


      αh k h = α1 k ex = 0.6798, though more than the first-best which is zero. In this sense
P
  h

the distortion is corrected, and we shall see below the contracted second best allocation. In
                                 1                                      1
addition, an agent type 1 buys τ̂op = 0.2970 units of good 1 and sells τop = −0.4972 units of
good 2 at price p (z op ) = 0.5974 in spot markets, and vice versa for agent 2. See figure 2b
below.
      Table 2 presents equilibrium prices/fees of rights to trade in security exchanges P∆ (z)
for different market fundamental levels. Notice that as anticipated, the prices/fees of rights
to trade in security exchanges are increasing with the market fundamentals z; that is, the
larger the specified market fundamental of a security exchanges, the higher the fee of the
security exchanges will be. Note also that the prices/fees of out-of-equilibrium (non-active)
security exchanges are available, but at such prices agents do not want to trade them.
      An agent type 1 is coming in with good 2 in storage, and therefore his discrepancy is
positive. On the other hand, an agent type 2’s discrepancy is negative. Thus, with a positive
equilibrium fee P∆ (z op ) = 0.5375, an agent type 2 whose discrepancy from the fundamental
is negative must get paid for the access to the security exchange. In particular, a constrained



                                                                                                                      26
                                                                                     Agent 2                                                                                    Agent 2



                                                                                                                                           τ1 = -τ2 = 0.2970
                                               1      2
                                           τ = -τ = 0.3252




                                                                                                       e121 + e221 + Rkop = 5.1753
 e121 + e221 + Rkex = 5.3595




                                                                                                    e121 + e221 + Rkex = 5.3595
                                             eex                                                                                           eop
                                                                   1      2                                                                                      τ1 = -τ2 = - 0.4972
                                                                τ = -τ = - 0.5839
                                                                                                                                                       D
                                                          C                                                                                            C




                                                                                                                                  without externality kop = 1.1753
                                   with externality   kex = 1.3595                                                                with externality     kex = 1.3595
                               Agent 1                    e111 + e211 = 4 good 1 in period 1                                  Agent 1                 e111 + e211 = 4 good 1 in period 1

                                                          (a)                                                                                        (b)

Figure 2: (a) Point C is the competitive collateral equilibrium allocation (with externality)
in period t = 1 with c11 = (1.3252, 1.7756) and c21 = (2.6748, 3.5839). An agent type 1 buys
0.3252 units of good 1, sells 0.5839 units of good 2 at price p(z ex ) = 0.5570 in spot markets,
and vice versa. Note that eex is the pre-trade allocation (with externality) in period t = 1. (b)
Point D is the competitive equilibrium with segregated security exchanges allocation (without
externality) in period t = 1 with c11 = (1.2970, 1.6781) and c21 = (2.7030, 3.4972). An agent
type 1 buys 0.2970 units of good 1, sells 0.4972 units of good 2 at price p(z op ) = 0.5974 in
spot markets, and vice versa. Note that eop is the pre-trade allocation (without externality)
in period t = 1.




                                                                                               27
Table 2: Equilibrium prices of rights to trade in security exchanges P∆ (z). Bold numbers
are equilibrium prices for actively traded security exchanges.
                                                                  z = 0.7479                 z = 0.7729                z = 0.7979
                                P∆ (z)                               0.4639                       0.5375                     0.6118


agent (h = 2) with ∆2 (z op ) = −0.6813, is receiving a transfer of −P∆ (z op )∆2 (z op ) = 0.3662
in period t = 0 for being in the security exchange z op = 0.7729. Graphically, this shifts
her budget line outward by T = 0.3662 as shown in figure 3. This illustrates how trading
in rights to trade in security exchanges generates the redistribution of wealth in general
equilibrium.

                                                                                            T = 0.3662                 e10
                                                                                                                                    Agent 2
                                good 2 in period t = 0




                                                                                                                              kop= 1.1753
                                                                                                                 A
                  e120 + e220 - kex= 2.6405
                e120 + e220 - kop= 2.8247




                                                                                                             B          e20




                                                         with externality: kex = 1.3595
                                                                  without externality: kop = 1.1753
                                          Agent 1                                                                    good 1 in period t = 0
                                                                                           e110 + e210 = 4



Figure 3: Point B is the competitive collateral equilibrium allocation (without externality)
in period t = 0 with c10 = (2.6073, 1.8410) and c20 = (1.3927, 0.9837). where an agent type
1 sells 0.3927 units of good 1, buys 0.0163 units of good 2, and k op = 1.1753 saves units of
good 2, and vice versa.



   In addition, the expected utility of an agent type 1 and type 2 in this competitive equi-
                                                                      1              2
librium with segregated security exchanges (without externality) are Uop = −2.2936, Uop =
−2.3905, respectively. Recall that the expected utility of an agent type 1 and type 2 in
                                                                          1
the competitive collateral equilibrium allocation (with externality) are Uex = −2.2527 and
 2
Uex = −2.5724, respectively. This shows that internalizing the externality is beneficial to an


                                                                                             28
agent type 2 (constrained agent) but may be harmful for an agent type 1 if there is no other
remedy is employed. This is a (distributional) general equilibrium effect. Internalizing the
externality improves efficiency of the economy, but also redistributes wealth. All agents can
benefit from the efficiency effect, which shifts the Pareto frontier outward, but some agents
may be harmed by the distributional effect. To induce welfare gain for all of agents, there
must be lump sum transfers, as in the second welfare theorem which we establish below.
   Note that with lower aggregate saving, the price of good 2 in period t = 0 in this
competitive equilibrium with segregated security exchanges (without externality) is lower
  op             ex
(P20 = 2.0073 < P20 = 2.2948) but the spot price of good 2 is higher (p(z op ) = 0.5974 >
p(z ex ) = 0.5570), relative to the one in the competitive collateral equilibrium allocation (with
externality). That is, the collateral distortion makes the price of good 2 higher in the first
period and lower in the second period relative to the constrained optimality, as proved in
Proposition 2. In other words, the price of good 2 varies less over time when the externality
is internalized. In this sense we mitigate fluctuations.
   If we shut down all active spot markets in this example environment, we can still achieve
a second best allocation by allowing agents to make date t = 1 promises to deliver good
1 or good 2. A promise to deliver must be backed by a promise issued by another type.
As we establish more generally in Appendix B.2, there are collateral constraints for asset-
backed promises and a need for valuation. Intuitively, the valuation can be done using
Pa (zs , s) = p (zs ) Pba (zs , s), and the collateral constraints for an agent type h become

                    Pa (zs , s) Rs k h + Pba (zs , s) θ̂sh + Pa (zs , s) θsh ≥ 0, ∀s.           (38)

   The next economy illustrates an economy with uncertainty where collateralized securities,
θ̂, are actively traded (cannot be substituted by spot trades). All agents are constrained, but
at different states. In particular, an agent will be binding in a state where her endowment
is large. This is because she would like to transfer a part of such a large amount of wealth
backwards in time from t = 1 to t = 0 but cannot do so because of the collateral constraints.

Environment 2 (State Contingent Securities). The economy in this example is similar to
the one in example 1 with two periods, but there are two states, S = 2. There are two types
of agents, H = 2, both of which have an identical constant relative risk aversion (CRRA)

                                                     29
                                                       1
utility function as in (37). Each type consists of     2
                                                           fraction of the population, i.e. αh = 12 . In
addition, the discount factor β = 1. The storage technology is constant and given by Rs = 1
for s = 1, 2. The endowment profile is presented in Table 3. Note unlike the first example
that the agents are ex-ante identical in endowments. But agent type 1 has relatively more
of both goods in state s = 1 than in state s = 2 and vice versa for agent type 2.

                         Table 3: Endowment profiles of the agents.
                                    eh10   eh20    eh11      eh21    eh12   eh22
                         h=1         2      2          3      3       1      1
                         h=2         2      2          1      1       3      3


   First, the symmetry of the endowments and preferences implies that an equilibrium
allocation in period t = 0 should be the same for all agents; that is, ch10 = c10 and ch20 = c20 ,
for all h. Further, the indeterminacy between k h and θh (s) implies that there is no loss of
generality in considering the case with symmetric collateral allocation, i.e. k h = k, for all
h. The first-best is to assign 2 units of each goods to each agent in every period and every
state. This involves making promises which would have required collateral in our limited
commitment world.
   The competitive collateral equilibrium (with externality) is as follows. The detailed
derivation is again omitted and presented in Appendix C.3. The unique competitive collateral
equilibrium (with externality) of this economy has k h = k ex ≈ 0.4603, for all h = 1, 2.
Accordingly, the market fundamental and spot price in state s are zsex = 0.8129 and p(zsex ) =
                                                                                ex
0.6608, respectively, for all s = 1, 2. The price of good 2 in period t = 0 is P20 = 1.6872,
the prices of collateralized securities paying in units of good 1 and good 2 in state s are
Pbsex = 1.2766, Psex = 0.8436, respectively, for all s = 1, 2. Note that the symmetry also
makes the prices of collateralized securities the same across states.
   Interestingly, there are security trades in this economy. In particular, an agent type 1
issues a security paying in units of good 1 in state s = 1, θ̂11 = −0.3042 units backed by
all of his collateral k 1 = k ex = 0.4603, while an agent type 2 buys the same amount of this
security. That is, an agent type 1’s collateral constraint in state s = 1 is binding again
here with positive collateral. In addition, an agent type 1 reverse the transaction in the

                                                  30
                    1                                      1
spot market, buys τ̂ex = 0.0525 units of good 1 and sells τex = −0.0794 units of good 2
at price p(zsex ) = 0.6608 in spot markets in state s = 1, and vice versa. The positions are
reversed at state s = 2. In addition, the expected utility of an agent type 1 and type 2 are
 1     2
Uex = Uex = −2.2035. Figure 4a illustrates the competitive collateral equilibrium allocation
(with externality) in state s = 1.
   We now turn to the competitive equilibrium with segregated security exchanges (without
externality). There is one active security exchange in each state, zsop = 0.8285 for all s = 1, 2,
even though again all security exchanges are available for trade. That is, in equilibrium,
both types optimally choose to trade in the same security exchange with specified market
fundamental zsop = 0.8285 in both states. More formally, δ 1 (zop ) = δ 2 (zop ) = 1 where zop =
[0.8285, 0.8285] is the vector of active exchanges in both states. The collateral allocation
in the competitive equilibrium with segregated security exchanges is k 1 (zop ) = k 2 (zop ) =
k op = 0.4200. That is, each type holds the same amount of collateral at t = 0. The
equilibrium average or per capita saving without externality is h z αh δ h (z) k h (z) = k op =
                                                               P P

0.4200, which clearly smaller than the aggregate saving in the equilibrium with externality
P h h        ex
   hα k = k     = 0.4603, though still more than the first-best which is zero. As a result,
the market fundamental and the spot price of good 2 in each state s are higher in the
competitive equilibrium with segregated security exchanges (without externality), i.e., zsop =
0.8285 > zsex = 0.8129 and p (zsop ) = 0.6864 > p (zsex ) = 0.6608. In addition, the price
of good 2 in period 0 in the competitive equilibrium with segregated security exchanges
                          op             ex
(without externality) is P20 = 1.5903 < P20 = 1.6872, which is again lower than the one in
the competitive equilibrium with the externality.
   We can recover the positions of each security and spot trades using the same approach
as in the competitive collateral equilibrium with the externality. An agent type 1 issues a
security paying in units of good 1 in state s = 1, θ̂11 = −0.2872 units backed by all of his
collateral k 1 = k op = 0.4200, while an agent type 2 buys the same amount of this security.
That is, an agent type 1’s collateral constraint in state s = 1 is binding. In addition, an
                    1                                      1
agent type 1 buys τ̂op = 0.1266 units of good 1 and sells τop = −0.1844 units of good 2 at the
larger price p(zsop ) = 0.6864 in spot markets in state s = 1, and vice versa for an agent type 2.
The positions are reversed at state s = 2. The symmetry of the equilibrium solution implies


                                               31
                                                                                       Agent 2                                                                                      Agent 2


                                                        τ1 = -τ2 = 0.0525                                                                              τ1 = -τ2 = 0.1266

                                                       eex                    e21                                                                         eop
                                                                                                                                                      eex




                                                                                                   e121 + e221 + Rs (k1ex + k2ex) = 4.9208
                                                                                                                                                                τ1 = -τ2 = - 0.1844




                                                                                                   e121 + e221 + Rs (k1op + k2op) = 4.8400
                                                                     τ1 = -τ2 = - 0.0794
 e121 + e221 + Rs2kex = 4.9208




                                                                C
                                                                                                                                                                   D
                                                                                                                                                              C




                                                                                                                                   without externality kop = 0.4200
                                                          ex
                                     with externality k = 0.4603                                                                   with externality kex = 0.4603
                                 Agent 1              e111 + e211 = 4     good 1 in state s = 1                                Agent 1                e1 + e2 = 4      good 1 in state s = 1
                                                                                                                                                       11     11


                                                               (a)                                                                                          (b)

Figure 4: (a) Point C is the competitive collateral equilibrium allocation (with externality)
in state s = 1 with c11 = (2.7483, 3.3808) and c21 = (1.2517, 1.5397). An agent type 1
buys 0.0525 units of good 1, sells 0.0794 units of good 2 at price p(z1ex ) = 0.6608 in spot
markets, and vice versa. The positions are reversed in state s = 2. Note that eex is the
pre-trade allocation (with externality) in state s = 1, and e21 is the endowment of agent
type h = 2 in state s = 1 (excluding savings and securities trades). (b) Point D is the
competitive equilibrium with segregated security exchanges allocation (without externality)
in state s = 1 with c11 = (2.7644, 3.3449) and c21 = (1.2356, 1.4951). An agent type 1 buys
0.1266 units of good 1, sells 0.1844 units of good 2 at price p(z op ) = 0.6864 in spot markets,
and vice versa. The positions are reversed in state s = 2. Note that eop is the pre-trade
allocation (without externality) in state s = 1.




                                                                                              32
that net borrowing of each agent is zero. In addition, the expected utility of an agent type
                  1     2
1 and type 2 are Uop = Uop = −2.2024. Figure 4b illustrates the competitive equilibrium
with segregated security exchanges allocation (without externality) in state s = 1. Note that
agents trade less securities relative to the equilibrium with the externality. This is because
the agents save less, and are issuing fewer securities. That is, the externality generates too
much saving/collateral.
       Table 4 presents equilibrium prices/fees of rights to trade in security exchanges in each
state P∆ (zs , s) for different market fundamental levels. Notice that the prices/fees of rights
to trade in security exchanges are again increasing with the market fundamentals zs in
both states. Recall that the net transfer in period t = 0 for an agent type h is the sum
of all payments/subsidies for rights to trade in all active security exchanges in all states,
P h        P               h
   z δ (z)  s P∆ (zs , s) ∆s (z). The symmetry of the equilibrium solution implies that the

equilibrium rights to trade for an agent type h in state s = 1 is exactly the opposite of his
rights to trade in state s = 2, and the prices of the rights to trade in both exchanges are
identical. As a result, payments/subsidies for an agent type h from trading in those security
exchanges are canceling out each other completely, and therefore each agent type h receives
zero net transfer in period t = 0. That is, there is no distributional general equilibrium effect
in this case14 .

Table 4: Equilibrium prices of rights to trade in security exchanges P∆ (zs , s) which are
the same in both states due to symmetry. Bold numbers are equilibrium prices for actively
traded security exchanges.
                                     zs = 0.8035       zs = 0.8285        zs = 0.8535
                     P∆ (zs , s)        0.0900            0.1142             0.1400



       The following example presents an economy where it is possible to assign agents to
different security exchanges and have multiple segregated security exchanges. A formal
formulation with randomization is presented in the next section.

  14
       This is special to the example and would not happen with more heterogeneity.




                                                     33
Environment 3 (Heterogeneous Borrowers and the Role of Randomization). There are two
periods, t = 0, 1, and a single state, S = 1, in period t = 1 (no uncertainty). There are three
types of agents, two borrower types and one lender. Each agent is given the same utility
                                                 1
function as in (37). Each type consists of       3
                                                     fraction of the population, i.e. αh = 13 . Similar to
the previous example, β = 1, and R = 1. The endowment profile is given in Table 5 below.
Note that to conserve on space we do not present the first-best allocation of this economy.

                               Table 5: Endowment profiles of the agents.
                               Type of Agents          eh10        eh20          eh11    eh21
                               h=1                     4.26        11.5      0.5         0.5
                               h=2                     3.92        0.5            7       5
                               h=3                     4.32        0.5            5       7


   We first consider the competitive collateral equilibrium (with externality). The detailed
derivation is presented in Appendix C.3. With relatively large endowments in t = 1, an
agent type 2 and an agent type 3 want to move resources backwards in time from t = 1
to t = 0, i.e., borrow. The scarcity of collateral then implies that both of them will be
collateral constrained. Similar to Environment 1, we assume that only an agent type 1 hold
collateral/storage, k 1 = k ex while an agent type 2 and an agent type 3 hold no collateral,
i.e., k 2 = k 2 = 0. The unique competitive collateral equilibrium (with externality) has
k 1 = k ex = 7.2836, and there is no security trading, i.e., θ̂h = θh = 0 for all h. The
                                    ex
price of good 2 in period t = 0 is P20 = 5.7422, and the market fundamental in period
                     12.5
t = 1 is z ex =   12.5+kex
                             = 0.6318, which implies that the spot price is p (z ex ) = 0.3992. The
competitive equilibrium allocation is shown in Table 6 below.

       Table 6: The competitive collateral equilibrium allocation for Environment 3.
        Agent Type            kh      τ̂ h     τh           ch10          ch20           ch11    ch21     Uh
                  h=1        7.284   1.711    -4.285    8.384        3.499              2.211   3.499   -1.1433
                  h=2        0.000   -1.487   3.725     1.999        0.834              5.513   8.725   -1.9950
                  h=3        0.000   -0.223   0.560     2.117        0.883              4.777   7.560   -1.9460



                                                       34
       We now turn to the competitive equilibrium with segregated security exchanges15 (with-
out externality), shown in Table 7 below. Interestingly, there are two active security ex-
changes, z = 0.6113 and z = 0.8132. The security exchange z = 0.6113 consists of some
fraction of agents type 1 (19.69 percent), and all of agents type 3 (a constrained type). On
the other hand, the security exchange z = 0.8132 consists of some residual fraction of agents
type 1 (80.31 percent), and all of agents type 2 (a constrained type). In addition, an agent
type 1 holds collateral which is a weighted average of collateral for each segregated market:
k 1 = 0.1969 × 6.3082 + 0.8031 × 4.6072 = 4.9421. Note that there are more agents type 1
in security exchange z = 0.8132 than in security exchange z = 0.6113, and agent 1’s spot
trading varies across security exchanges due in part to a difference in spot prices.

Table 7: Equilibrium allocation of (non-zero-mass) lotteries. There are multiple active secu-
rity exchanges; z = 0.6113 and z = 0.8132.
                                          h=1                h=2          h=3
                           k        6.3082     4.6072        0.0000       0.0000
                           τ̂       1.3892     1.6384       -1.3159      -0.2735
                           τ       -3.7176    -2.4776        1.9898       0.7319
                           c10      5.6204     5.6204        4.4835       2.3961
                           c20      3.3982     3.3982        2.7106       1.4491
                           c11      1.8892     2.1384        5.6841       4.7265
                           c21      3.0905     2.6296        6.9898       7.7319
                           z       0.6113     0.8132        0.8132       0.6113
                           ∆        3.6618     3.6532       -2.9340      -0.7209
                           xh       0.1969     0.8031        1.0000       1.0000
                           Uh            -1.3211            -0.9110      -1.4483


       The key reason for the existence of multiple segregated exchanges in equilibrium is that it
is socially optimal to compensate constrained agents with positive transfers at period t = 0,
to try to move back toward the first best, i.e., alleviate borrowing constraints, in this case. As
  15
       The competitive equilibrium with segregated security exchanges here corresponds to a Pareto optimal
allocation (a solution to Program 2) with Pareto weights λ1 = 0.8, λ2 = λ3 = 0.1.


                                                     35
mentioned earlier, agents type 2 and agents type 3 are collateral constrained, and therefore
have relatively high marginal utility at period t = 0. As a result, it is socially optimal to
give them more resources in period t = 0. This is the case in the competitive equilibrium
with segregated security exchanges (without externality), where the discrepancy from the
market fundamental of both types are negative (the 8th row of Table 7), i.e., ∆2 = −2.9340
and ∆3 = −0.7209. With positive equilibrium price of the discrepancy, agents type 2 and
agents type 3 receive transfers from rights to trade fees P∆ (z) ∆h (z) of 6.6122 units of good
1 in period t = 0 and 0.6739 units of good 1 in period t = 0, respectively. Of course, agents
type 1 pay all these fees paid in proportion to the relative number of types assigned to
each exchange. Equilibrium fees of security exchanges, including the fees of inactive (out-of
equilibrium) security exchanges are summarized in Table 8 below.

Table 8: Equilibrium fees of security exchanges. The bold numbers are (actively traded)
equilibrium prices.
               z = 0.6088   z = 0.6113   z = 0.6138   z = 0.8088    z = 0.8132   z = 0.8138
      P∆ (z)     0.9119      0.9348        0.9589       2.2339        2.2537       2.2564


   Intuitively, agents type 1 would like to buy into the higher z security exchange, which
is z = 0.8132 in this case, where good 2 is more valuable because with (endogenous) saving
she will end up with more of good 2 than good 1 in period t = 1. The question is then
why did not all of type 1 choose that exchange with certainty in equilibrium. The answer is
that such deterministic choice is not affordable. The total expenditure for such deterministic
allocation would be of 35.7523 units of the numeraire while his income is only 35.7214 units
of the numeraire, which is not enough to cover his expenditure. On the other hand, his total
expenditure for the randomized equilibrium allocation is 35.7214 units of the numeraire,
which is exactly equal to his income.
   In addition, it is also natural to ask if it would be socially optimal to move everyone to a
unique security exchange instead of segregating them as in the actual equilibrium. Contrary
to the equilibrium outcome, if an agent type 3 were to enter into a security exchange with
z > 0.7143, he would have had to pay for the right to trade in that security exchange given
                                                             5
that her ratio of good 1 to good 2 in period t = 1 is        7
                                                                 = 0.7143. In particular, if all


                                              36
agents were in one exchange but keeping the same allocation including storage, the market
                                                          12.5
fundamental in that exchange would have been z =      12.5+4.9421
                                                                    = 0.7167 > 0.7143. As a result,
the discrepancy from the market fundamental of an agent type 3 would be ∆3 = 0.0166.
This positive discrepancy then would imply that agent type 3 would have to pay for the
right to trade in that security exchange, given that the corresponding fee is strictly positive.
As with discussion earlier, charging fees in period t = 0 to this constrained agent type 3
would move against the socially optimal direction. That is, putting all agents in only one
security exchange is not socially optimal in this case. It is socially optimal to allocate agents
to multiple segregated exchanges, though this is at the cost of divergent marginal rates of
substitution. The more general point is that mixing with lotteries can be useful, and we
incorporate that into the more notation and proofs below.
    This example also suggests that the number of active segregated exchanges is equal to
the number of constrained types. Consistent with this idea, Appendix C.6, an economy
with four agent types, three of which are constrained, has three active segregated exchanges.
Intuitively, it is socially optimal to put different types in different exchanges to face distinct
prices, as in our taxes/subsidy, budget-shifter impact from the choice of the fundamental z
in section 4.1.



5     Existence and Welfare Theorems of Competitive Equi-
      librium with Segregated Security Exchanges
This section presents a more formal representation of our competitive equilibrium with segre-
gated security exchanges. To deal with the non-convexity problem generated by the collateral
constraints, we now use a probability measure or a lottery as the commodity. That is, we
now suppose it is possible to assign agents to different security exchanges even in state s as
if by a lottery as in example 3. Security trades are also bundled into this potentially random
assignment. Security exchange assignments, by lottery or not, are still state-contingent. Im-
portantly, a member of a security exchange zs can trade securities with other members in
the same security exchange only.



                                               37
   More formally, for each agent type h, let xh (c0 , k, θ̂, θ, z, ∆) ≥ 0 denote a probability mea-
                                                                                                    
sure on c0 , k, θ̂, θ, z, ∆ , where ∆s satisfies (25) for all s. In other words, xh c0 , k, θ̂, θ, z, ∆
is the probability of receiving period t = 0 consumption, c0 ≡ (c10 , c20 ), collateral, k, securi-
ties paying in good 1, θ̂s , securities paying in good 2, θs , and being in security exchange zs
in state s where all securities are executed and all spot trades take place also. Recall that a
positive (negative) amount of trade means receiving (transferring out) the specified good.
       As a probability measure, a lottery of an agent type h satisfies
                                            X                                       
                                                          h
                                                      x           c0 , k, θ̂, θ, z, ∆ = 1,          (39)
                                     c0 ,k,θ̂,θ,z,∆

but unlike discrete choice notation δ h , this lottery may be non degenerate for some bundles,
                                                                       
i.e., 0 < xh < 1. With a continuum of agents, xh c0 , k, θ̂, θ, z, ∆ can be interpreted as
                                                                     
the fraction of agents type h assigned to a bundle c0 , k, θ̂, θ, z, ∆ . More formally, with all
choice objects gridded up as an approximation, the commodity space L is assumed to be a
finite n-dimensional linear space16 .
                                                       
   For notational purposes, let b = c0 , k, θ̂, θ, z, ∆ be a typical commodity, called a
                                             
bundle. We will use b and c0 , k, θ̂, θ, z, ∆ interchangeably. Accordingly, we can write
            
xh ≡ xh (b) b ∈ Rn+ as a typical lottery for an agent type h.
                                               
   A holder of a bundle b = c0 , k, θ̂, θ, z, ∆ will receive k units of collateral and hold
                        
portfolio of securities θ̂, θ . With limited commitment, each bundle b will be feasible only
if the collateral and security assignments satisfy the collateral constraints (3) which we repeat
here:
                                     p (zs ) Rs k + θ̂s + p (zs ) θs ≥ 0, ∀s.                       (40)

       Accordingly, we impose the following condition on a probability measure xh (b).
                                                             
               xh c0 , k, θ̂, θ, z, ∆ ≥ 0 if c0 , k, θ̂, θ, z, ∆ satisfies (25) and (40),           (41)

                                            = 0 if otherwise.

In words, a positive measure can be defined only on feasible bundles, which have to satisfy
conditions (25) and (40).
  16
       The limiting arguments under weak-topology used in Prescott and Townsend (1984a) can be applied to
establish the results if L is not finite.


                                                                    38
       More formally, the consumption possibility set of an agent type h is defined by
                 (                                                               )
                              X
            X h = xh ∈ Rn+ :     xh (b) = 1, and for any b, xh (b) satisfies (41) .                      (42)
                                         b


Let xh be a typical element of X h . Note that X h ⊂ L is compact and convex. In addition,
the non-emptiness of X h is guaranteed by assigning mass one on each agent’s endowment.


5.1        Competitive Equilibrium with Segregated Security Exchanges
                                                                           
Let P20 be the price of good 2 in period t = 0, and P c0 , k, θ̂, θ, z, ∆ be the price of a
                         
bundle c0 , k, θ̂, θ, z, ∆ . Note that the price of good 1 in period t = 0 is P10 = 1 as good 1
is the numeraire good. Each agent is infinitesimally small relative to the entire economy and
will take all prices as given. The broker-dealers introduced below will also act competitively.
Note as well that ∆ is also competitively priced.
                                                                         
       Consumers: Each agent h, taking prices, P20 , P c0 , k, θ̂, θ, z, ∆ , as given, chooses xh
in period t = 0 to maximize its expected utility:
                                                 (                                                         )
              X                                                   X                                   
                         xh c0 , k, θ̂, θ, z, ∆   u ch10 , ch20 + β   πs u eh1s + θ̂s , eh2s + Rs k + θs
                                                               
  max
   xh
        (c0 ,k,θ̂,θ,z,∆)                                            s

                                                                                                          (43)
subject to xh ∈ X h , and period t = 0 budget constraint
                     X                                                     
                                  P c0 , k, θ̂, θ, z, ∆ xh c0 , k, θ̂, θ, z, ∆ ≤ eh10 + P20 eh20 ,       (44)
                 c0 ,k,θ̂,θ,z,∆


which states that the agent sells all her endowments17 including good 2 at price P20 and uses
                                                                                           
this income to buy lotteries xh , which includes consumption in period t = 0, ch10 , ch20 .
                                                     
    In state s, a holder of bundle c0 , k, θ̂, θ, z, ∆ receives, in addition to her endowments of
                             
good 1 and good 2 eh1s , eh2s , θ̂s units of good 1 as the net-payment of portfolio θ̂, Rs k units
of good 2 from the collateral/saving good, θs units of good 2 as the net-payment of portfolio
  17
       It is worthy of emphasis that we can write an equivalent problem specifying consumption transfers
in period t = 0, instead of consumption allocation. By doing so, agents do not need to sell their entire
endowments but simply buy and sell consumption transfers. In other words, it is not restrictive that we
make agents sell their entire endowments and buy consumption allocation through lotteries.


                                                           39
θ. Of course, if θ̂s and θs are negative, these are promises to pay and require collateral. It
is worthy of emphasis that the agent will trade in security exchange zs , where she can in
principle trade good 1 and good 2 at price p(zs ) in spot markets. (Again in the equilibrium
under consideration it will not be necessary to trade in spot markets even though they believe
they could.)
   Broker-Dealers: Broker-dealers are agents who try to put together deals, much like
brokers on Wall street who put buyers and sellers of securities together. When ask and
bid prices are not matched, brokers will try to “clear the market” by communicating with
both sides of the markets (trying to change quantities and/or prices), so that demand equals
supply at a given price at the end.
                                                                        
    Formally, the broker-dealer issues (sells) y c0 , k, θ̂, θ, z, ∆ ∈ R+ units of each bundle
                                                            
  c0 , k, θ̂, θ, z, ∆ , at the unit price P c0 , k, θ̂, θ, z, ∆ . Note that the broker-dealer can issue
                                                              
any non-negative number of a bundle c0 , k, θ̂, θ, z, ∆ ; that is, the number of bundles issued
does not have to be between zero and one and is not a lottery. It is simply the number of
bundles, a real number. Let y ∈ L be the vector of the number of bundles issued as one
                              
move across c0 , k, θ̂, θ, z, ∆ . With constant returns to scale, the profit of a broker-dealer
must be zero and the number of broker-dealers becomes irrelevant. Therefore, without loss of
generality, we assume there is one representative broker-dealer, which takes prices as given.
   The objective of the broker-dealer is to maximize its profit by supplying y ∈ L as follows:
                 X                                h                                           i
       max                    y c0 , k, θ̂, θ, z, ∆ P c0 , k, θ̂, θ, z, ∆ − c10 − P20 c20 − P20 k     (45)
        y
             c0 ,k,θ̂,θ,z,∆

subject to technology constraints:
                                   X                                          
                                                  y c0 , k, θ̂, θ, z−s , zs , ∆ θ̂s = 0, ∀s; zs ,     (46)
                              c0 ,k,θ̂,θ,z−s ,∆
                                   X                                          
                                                  y c0 , k, θ̂, θ, z−s , zs , ∆ θs = 0, ∀s; zs ,      (47)
                              c0 ,k,θ̂,θ,z−s ,∆
                                  X                                       
                                              y c0 , k, θ̂, θ, z−s , zs , ∆ ∆s = 0 , ∀s; zs ,         (48)
                          c0 ,k,θ̂,θ,z−s ,∆
                                        
taking prices P20 , P c0 , k, θ̂, θ, z, ∆ as given. See our working paper Kilenthong and Townsend
(2011b) for more details.

                                                                 40
   The existence of an optimum to the broker-dealer’s problem requires, that for any bundle
                   
 c0 , k, θ̂, θ, z, ∆ ,
                                            X                    X                  X
P c0 , k, θ̂, θ, z, ∆ ≤ c10 +P20 c20 +P20 k +   Pba (zs , s) θ̂s +   Pa (zs , s) θs +   P∆ (zs , s) ∆s
                                                 s                 s                  s
                                                                                                  (49)
where Pba (zs , s), Pa (zs , s) , and P∆ (zs , s) are the Lagrange multipliers for the zero-net-supply
constraints for securities paying in good 1 (46), for the zero-net-supply constraints for secu-
rities paying in good 2 (47), and for consistency constraints (48), respectively. In particular,
for a security exchange zs in state s, Pba (zs , s), Pa (zs , s), and P∆ (zs , s) are the shadow prices
of a securities paying in good 1 and good 2, and the shadow price of “type h discrepancies
from the fundamental” in the security exchange zs , respectively. Condition (49) holds with
                                                              
equality if y c0 , k, θ̂, θ, z, ∆ > 0. Here P c0 , k, θ̂, θ, z, ∆ is the revenue from the sale of
                                     
one unit of bundle c0 , k, θ̂, θ, z, ∆ . This condition is in fact the necessary and sufficient
condition for the saddle-point profit maximization problem.
      Market Clearing: The market clearing condition for good 1 in period t = 0 is
                         X                              X
                              y c0 , k, θ̂, θ, z, ∆ c10 =   αh eh10                               (50)
                              c0 ,k,θ̂,θ,z,∆                       h

Similarly, the market clearing condition for good 2 in period t = 0 is
                         X                                      X
                                y c0 , k, θ̂, θ, z, ∆ [c20 + k] =   αh eh20                       (51)
                          c0 ,k,θ̂,θ,z,∆                               h

The market clearing conditions for lotteries in period t = 0 are
           X                                                                       
               αh xh c0 , k, θ̂, θ, z, ∆ = y c0 , k, θ̂, θ, z, ∆ , ∀ c0 , k, θ̂, θ, z, ∆          (52)
                h

Definition 4. A competitive equilibrium with segregated security exchanges (with lottery)
                                                                              
is a specification of allocation (x, y), and prices P20 , P c0 , k, θ̂, θ, z, ∆ such that

     (i) for each h, xh ∈ X h solves utility maximization problem (43) subject to period t = 0
                                                                            
         budget constraint (44), taking prices P20 , P c0 , k, θ̂, θ, z, ∆ as given;
                                n                                          o
    (ii) for the broker-dealer, y, Pba (zs , s) , Pa (zs , s) , P∆ (zs , s) solves profit maximization
        problem (45) subject to technology constraints (46), (47) and (48) taking prices P20 ,
                            
        P c0 , k, θ̂, θ, z, ∆ as given;

                                                     41
 (iii) markets for good 1, for good 2, and for lotteries in period t = 0 clear, i.e., (50), (51)
      and (52) hold.


5.2     Constrained Optimal Allocations
                             
An allocation x ≡ xh         h
                                 is attainable if xh ∈ X h for all h, and it satisfies the following
feasibility constraints.
    Recall that good 1 cannot be stored; only good 2 is storable. The aggregate endowment
of good 1 in period t = 0 is h αh eh10 . Therefore, the resource constraint for good 1 in period
                            P

t = 0 is given by
                         X       X                                          X
                                              αh xh c0 , k, θ̂, θ, z, ∆ c10 ≤   αh eh10 .                (53)
                         h   c0 ,k,θ̂,θ,z,∆                                            h


   Similarly, the resource constraint for good 2 in period t = 0 is given by
                    X        X                                                     X
                                           h h
                                          α x        c0 , k, θ̂, θ, z, ∆ [c20 + k] ≤   αh eh20 .         (54)
                     h   c0 ,k,θ̂,θ,z,∆                                                    h


Note that the non-negativity constraint on k guarantees that the aggregate saving is non-
negative.
   Recall that all securities are executed within each assigned security exchange only. In
particular, for a security exchange zs in state s, the net supply of a security paying in good
1 in state s, θ̂s must be zero:
                    X            X                                           
                                             αh xh c0 , k, θ̂, θ, z−s , zs , ∆ θ̂s = 0 , ∀s; zs ,        (55)
                     h   c0 ,k,θ̂,θ,z−s ,∆


where z−s = (z1 , . . . , zs−1 , zs+1 , . . . , zS ) is a vector of market fundamentals in all states but
state s. This feasibility condition holds for every state s and every security exchange zs .
Similarly, the feasibility or market clearing constraints for securities paying in good 2 are as
follows:
                    X            X                                                 
                                              h h
                                             α x         c0 , k, θ̂, θ, z−s , zs , ∆ θs = 0 , ∀s; zs .   (56)
                     h   c0 ,k,θ̂,θ,z−s ,∆

   The market fundamental in each security exchange must be consistent. The planner must
choose the composition of agents to set the market fundamental for each security exchange

                                                               42
to its specified level. With identical homothetic preferences, the consistency constraint for
a security exchange zs is that the aggregate ratio of good 1 to good 2 within the security
exchange zs must be exactly zs :
                                                                                             
                                               h h                                    h
                   P P
                     h     c0 ,k,θ̂,θ,z−s ,∆ α  x     c0 , k, θ̂, θ, z   ,
                                                                       −s sz , ∆     e1s +  θ̂s
             zs = P P                                                                               .   (57)
                                           h xh c , k, θ̂, θ, z , z , ∆           h
                   h  c0 ,k,θ̂,θ,z−s ,∆ α          0              −s s          e 2s +  Rs k  +   θ s

Using the feasibility conditions for securities within each security exchange, (55)-(56), and the
definition of “type h discrepancy from the fundamental” (25), these consistency constraints
can be rewritten as
                X                 X                                              
                                                 αh xh c0 , k, θ̂, θ, z−s , zs , ∆ ∆s = 0, ∀s, zs .        (58)
                      h      c0 ,k,θ̂,θ,z−s ,∆

This consistency constraint reflects the depletability of the externality.
                                      H
Definition 5. An allocation x ≡ xh h=1 ∈ X 1 ×. . .×X H is said to be attainable if xh ∈ X h
for every h, and it satisfies (53)-(56) and (58).

   Let X denote the set of all attainable allocations. With finite linear weak-inequality
constraints, the attainable set X is compact and convex. In addition, the assumption that
the endowment is on the grids also ensures that X is nonempty.
   A constrained optimal allocation is an attainable allocation such that there is no other
attainable allocation that can make at least one agent type strictly better off without making
any other agent type worse off. To be precise, the expected utility of an agent type h, holding
a lottery xh , is given by
                                              (                                                         )
                X                                              X                                   
U h xh =              xh c0 , k, θ̂, θ, z, ∆   u ch10 , ch20 + β   πs u eh1s + θ̂s , eh2s + Rs k + θs
                                                           

            c0 ,k,θ̂,θ,z,∆                                                     s

Definition 6. An attainable allocation x∗ ∈ X is said to be a constrained optimal allocation
if there is no another attainable allocation x ∈ X such that
                                                            
          U h xh ≥ U h x∗h for every h, and U h̄ xh̄ > U h̄ x∗h̄ for some h̄
                            


   We characterize constrained optimality using the following Pareto program. Let λh ≥ 0
be the Pareto weight of agent type h. There is no loss of generality to normalize the weights
such that h λh = 1. A constrained Pareto optimal allocation x∗ solves the following Pareto
         P

program.

                                                                43
Program 2. The Pareto Program with endogenous segregated security exchanges is defined
as follows:
                                                                        (                                                        )
             X                X                                                          X                                  
                 λh αh                    xh                             u ch10 , ch20 + β   πs u eh1s + θ̂s , eh2s + Rs k + θs (59)
                                                                                      
  max                                              c0 , k, θ̂, θ, z, ∆
(xh ∈X h )
         h   h           c0 ,k,θ̂,θ,z,∆                                                        s


subject to
                                  X         X                                                  X
                                                             h h
                                                         α x           c0 , k, θ̂, θ, z, ∆ c10 ≤   αh eh10 ,       (60)
                                    h   c0 ,k,θ̂,θ,z,∆                                             h
                     X             X                                                       X
                                                   h h
                                                 α x         c0 , k, θ̂, θ, z, ∆ [c20 + k] ≤   αh eh20 ,           (61)
                         h     c0 ,k,θ̂,θ,z,∆                                                      h
                    X               X                                              
                                                   αh xh c0 , k, θ̂, θ, z−s , zs , ∆ θ̂s = 0 , ∀s; zs ,            (62)
                         h    c0 ,k,θ̂,θ,z−s ,∆
                    X               X                                              
                                                   αh xh c0 , k, θ̂, θ, z−s , zs , ∆ θs = 0 , ∀s; zs ,             (63)
                         h    c0 ,k,θ̂,θ,z−s ,∆
                    X             X                                              
                                                 αh xh c0 , k, θ̂, θ, z−s , zs , ∆ ∆s = 0, ∀s, zs .                (64)
                     h       c0 ,k,θ̂,θ,z−s ,∆

    Note again that we already embedded the “individual discrepancies from the funda-
mental” (25), the probability constraints (39) and the collateral constraints (40) into the
consumption possibility sets X h .
    It is clear that the objective function now is linear in xh . Thereby it is continuous and
weakly concave. As discussed earlier, the feasible set X is non-empty, compact, and convex.
Therefore, a solution to the Pareto program for given positive Pareto weights exists and is
a global maximum. The proof of the equivalence between Pareto optimal allocations and
the solutions to the program is omitted for brevity (see Prescott and Townsend, 1984b, for
a similar proof).
    As in the classical general equilibrium model, the economy is a well-defined convex econ-
omy, i.e., the commodity space is Euclidean, the consumption set is compact and convex,
the utility function is linear. As a result, the first and second welfare theorems hold, and
a competitive equilibrium exists. In particular, this section proves that the competitive
equilibrium is constrained optimal and any constrained optimal allocation can be supported
by a competitive equilibrium with transfers. Then, we use Negishi’s method to prove the
existence of a competitive equilibrium. For brevity, all related definitions and proofs are

                                                                         44
omitted here but are available in Kilenthong and Townsend (2011b), and similar proofs are
also available in Prescott and Townsend (2006).
   The standard contradiction argument is used to prove the first welfare theorem below.
We assume that there is no local satiation point in the consumption set.

Assumption 2. For any xh ∈ X h , there exists x̃h ∈ X h such that

                                    U h x̃h > U h xh
                                                    
                                                                                           (65)
            
where U h xh is the expected utility of agent h derived from allocation xh .

   This assumption is easily satisfied using reasonable specifications of the grid of consump-
tion allocation in period t = 0. For example, with a strictly increasing utility function, if we
include a very large consumption allocation in period t = 0 into the grid (larger than what
can be attained with endowments and storage), then the local nonsatiation assumption will
be satisfied.

Theorem 1. With local nonsatiation of preferences (Assumption 2), a competitive equilib-
rium with segregated security exchanges allocation is constrained optimal.

   The Second Welfare theorem states that any constrained optimal allocation, correspond-
ing to strictly positive Pareto weights, can be supported as a competitive equilibrium with
segregated exchanges with transfers. The standard approach applies here. In particular, we
first prove that any constrained optimal allocation can be decentralized as a compensated
equilibrium with segregated exchanges. Then, we use a standard cheaper-point argument
(see Debreu, 1954) to show that any compensated equilibrium with segregated exchanges is
a competitive equilibrium with segregated exchanges with transfers.

Theorem 2. Any constrained optimal allocation corresponding with strictly positive Pareto
weights λh > 0, ∀h can be supported as a competitive equilibrium with segregated security
exchanges with transfers.

   We use Negishi’s mapping method (Negishi, 1960) to prove the existence of competitive
equilibrium with segregated exchanges. The proof benefits from the second welfare theorem.
Specifically, a part of the mapping applies the theorem in that the solution to the Pareto

                                              45
program is a competitive equilibrium with segregated exchanges with transfers. We then
show that a fixed-point of the mapping exists and it represents a competitive equilibrium
with segregated exchanges (without transfers).

Theorem 3. For any positive endowments, a competitive equilibrium with segregated security
exchanges exists.



6        Concluding Remarks on Implementation
Our solution to the externality problem is intuitive: create a market that allows agents to
contract on the state contingent price under which they will unwind their contract commit-
ments, over and above contracting on intertemporal or state-contingent security exchanges.
Of course that unwind price is still endogenous, and the contracted price must equal the
market clearing price at which supply equals demand18 , taking into account exogenous en-
dowments, saving, contract positions and who is in the market. So when agents contract on
the unwind price at which collateral is valued for clearing, they essentially are counting on
having the requisite number and types of traders around to support that contracted price.
As is usual in a Walrasian equilibrium, and in rational expectations, this presumption is
validated, there is a decentralization, and agents need only pay attention to prices, making
their own decision independently. No agent cares specifically about the identity or name of
other traders. They do care but only implicitly about the composition of traders (or in our
set up with homotheticity, the ratio of pretrade endowments) in the sense they are counting
on a promised fundamental, the contracted price. So the new market mechanism does re-
quire knowledge of which side of a market a trader will be on, contingent on the state of the
world, and hence what commitments they have made previously, in a certain well defined
sense.
  18
       We are abstracting away from broker dealers who absorb trades on their own account, to make a market
so to speak. We have jumped to the standard Walrasian limit with a large (continuum) number of traders of
each type, in which markets clear at an anticipated equilibrium price. However, the broker-deal firms in this
paper would be the outcome of completion among those trying to set up exchanges and attract customers,
as in Townsend (1983).



                                                     46
       Practically, the markets for the rights to trade can be implemented using markets for
certificates, each of which specifies the security exchange a trader wants to be in, at a price
paid, or is willing to be in, at a price received, and the amount of the discrepancy from
the fundamental that the trader will be holding. These are like market participation rights
with market access fees, but for us rather than a fixed fee independent of volume as in
contemporary markets, that volume here for us is implicit in the pretrade position of the
trader and the market fundamental. These markets for rights to trade will be opened in
the contracting period, and traders can buy any certificate they want and can afford, or
be compensated if this puts them in a disadvantageous position. When there is more than
one active exchange for a given state contingent contracted price, then we allow for queuing
with randomized execution of trade. That is traders will buy an actually fair lottery over
certificates at the beginning of the contracting period, and then a platform/utility exchange
will draw the outcome of the lottery and assign the certificate accordingly, to get the fractions
of traders right, at the end of the contracting period19 . In the execution period, markets are
segregated or restricted in the sense that a trader with a certificate can trade in the specified
security exchange only so long as its discrepancy from the fundamental on its certificate is the
same as the true one or at least the one agreed to in the contracting period. If a household
or trader comes to a wrong security exchange or holds an inconsistent discrepancy from the
fundamental, its right to trade will be forfeited. This mechanism requires a technology that
can verify ex post, in the execution period, a household’s collateral/saving and its endowment
profiles. On this we elaborate below.
       In order to visualize more clearly the mechanics of our proposed market structure, we try
to place it in a contemporary setting. We imagine that there are two commodities. One is a
money (good 1), namely deposits or accounts at the Federal Reserve used to secure payments,
  19
       Trades are executed in some dark pool equity markets in a manner which can best be thought of as
random. In a dark pool, demand is often not equal to supply, and market typically does not clear. In dark
pools that simply take the exchange price as given, allocation rules on the heavy side have two main forms:
pro-rata and time priority. An example of pro-rata: if there are 300 shares to buy and 200 shares to sell, then
2/3 of each buy order is filled. (If the dark pool runs continuously, then time priority is the most common,
but that is not the one we want to emphasize here.) The point is that by increasing her bid, a buyer can
make it more likely to sell more, but the outcome is stochastic (e.g., Zhu, 2013).


                                                      47
as in Fed wire. The second is a treasury obligation (good 2, the collateral good). All
promises to pay money in the future, whether a simple loan or a state contingent promise as
in an insurance indemnity, required collateral, the treasuries. In practice both treasuries and
money can clear and settle obligations ex post, but the rate of exchange between the two uses
the ex post spot market price or collateral valuation. Even though money and treasuries can
not be consumed directly, as can the commodities of our model, each participant (financial
institutions, e.g., banks, insurance companies, hedge funds) derives an indirect utility from
holding them in their portfolio at the end of today, this period, and also from holding them
given a certain state of the world tomorrow, next period (due to reasons that we do not
model here). But the utility is less from treasuries when they are used as collateral backing
promises to pay. It is as if they were subtracted from end of period portfolio holdings, that is,
not used for consumption/utility now. In the initial date these financial players borrow and
lend in the securities markets and buy and sell insurance obligations, again with loans and
insurance contracts dominated in money. The market fundamental in future spot markets
under a given state of the world is determined by the relative ratio of money to treasuries
at that date and state, equivalently the interest rate at that time. (Obviously, the example
requires a more generous interpretation of the model, which actually ends after the second
period.)
   Some market participants buy for cash a vector of market exchange certificates, desig-
nating the future state contingent spot price of treasures for each state of the world. Other
participants are paid to hold each item in a vector of market exchange certificates. There
can of course be active trade in the sense that traders can be long or short on treasuries, even
conditioned on a given state of the world. The arrangement we envision essentially offers a
guarantee of the spot price of treasuries which will be used to settle obligations, hence not
subject to market fluctuations beyond the usual state-of-the-world contingencies. But the
market in the certificates in effect restricts the set of traders with whom there is unwinding
of positions tomorrow in such a way that the contracted, insured price is the market clearing
spot price. Broker-dealers will clear all the markets for securities and markets of certificates.
Of course these institutional arrangements will require a registration system, to keep track
of which exchange market traders are allowed to use (and hence the securities which are


                                               48
held). It is important to ensure that agents cannot participate across markets where they
do not have the right to buy and sell and unwind trades, to forestall the obvious arbitrage
when multiple exchanges emerge in equilibrium.
   Registration and exclusivity might seem at first blush to be demanding requirements, but
these have become standard in the operation of US financial markets, as we now argue. In
contemporary financial markets, traders do not take physical possession of securities. The
US has moved from a system in which securities and money (checks) were use to complete
trades bilaterally, which one or the other in currier black bags being raced around downtown
NY via bicycle, subject to a deadline, to a system in which securities are registered and fixed
in place and do not change hands physically. A primary institution is DTCC , Depository
Trust and Clearing Corp. Essentially all issuance and ownership is now electronic. Older
securities are in a vault.
   Ownership changes by trading on financial markets. There is a Trade Reporting Facility
(TRF). One of the most obvious exchanges is New York Stock Exchange. An order to buy
comes with the name of the trader, typically an identification number, and desired trades
(limit order). Of course much of this information is not revealed to the public, but the
exchanges know, regulators can know in principal, and records are kept. That is, trades are
reported in practice such that the trading venues are disclosed to the public, whereas the
trader identities are only known to the venues and regulators. In contrast, over-the-counter
trades might seem to be bilateral or among dealers and unobserved, but at least the trade in
some derivatives (credit default insurance) is now regulated under Dodd Frank legislation,
and the point here, the collateral is recorded in a CCP, central clearing party. Further, the
responsibility to finalize trade, to transfer securities and money now lies after Trade-plus-2
days with that CCP utility. Evidently many new registration and clearing platforms are
being created. These private entities are a bit like our intermediaries, i.e., trades are netted
and cleared though them. Our more general point is that these kinds of reforms have been
implemented and in that sense our proposal would not seem to require more technology.
   Exclusivity is also not uncommon. For example, some of the dark pools do not want to
deal with hedge funds or high frequency (computer) traders, so they just prohibit them from
entering the platform.


                                              49
   Asset-backed securities are allowed in our set up and do not cause a problem. Neither are
they essential in that various combinations of securities and markets are equivalent. Asset-
backed security trades mimic spot market trade, and become an essential part of the set up if
and only if spot market exchange is for some reason more limited. As a result, all arguments
and institution stated in terms of spot markets can be restated using the language of asset-
backed securities. In particular, we can solve the externality problem by creating segregated
security exchanges where agents can trade ex ante collateralized and asset backed securities
indexed for clearing at a posted price, that is by the market fundamental. Methodologically,
we do not both allow spot trade ex post then restrict spot trade with segregated markets.
That is, even without spot markets, there is an externalities problem in the valuation of
asset backed securities which are used to underwrite promises, and this requires some kind
of market clearing valuation.
   Our methods extend to other set ups in which spot market exchange is desirable or cannot
be limited a priori. First, the model can be readily extended to incorporate the contract-
specific collateralization without pyramiding and tranching as in Geanakoplos (2003), among
others. In this case, spot trades will be necessary and cannot be substituted by ex-ante
contracting. Second, this model can also be extended to general preferences and dynamic
environments. This extended version will be used to study equilibrium cascades. This is
again closely related to Geanakoplos (2003). Third, we can use our approach to study re-
trading or anonymous trading in spot markets in incomplete market settings as in Greenwald
and Stiglitz (1986); retrade under moral hazard environments with unobserved actions as in
Acemoglu and Simsek (2008); Kilenthong and Townsend (2011a); and retrade in a Diamond
and Dybvig (1983) preference shocks bank runs environment as in Jacklin (1987). Kilen-
thong and Townsend (2014) create the requisite notation and embed all these environments,
including the collateral environment of this paper, into a common general framework.



References
Acemoglu, D. and A. Simsek (2008). Moral Hazard and Efficiency in General Equilibrium
  with Anonymous Trading. Working Paper .


                                             50
Aghion, P., A. Banerjee, and T. Piketty (1999). Dualism and Macroeconomic Volatility.
  Quarterly Journal of Economics 114 (4), 1359–1397.

Allen, F. and D. Gale (2004). Financial Intermediaries and Markets. Econometrica, 1023–
  1061.

Alvarez, F. and U. Jermann (2000). Efficiency, Equilibrium, and Asset Pricing with Risk of
  Default. Econometrica 68 (4), 775–797.

Arrow, K. (1969). The Organization of Economic Activity: Issues Pertinent to the Choice of
  Market versus Nonmarket Allocation. The Analysis and Evaluation of Public Expenditure:
  The PPB System 1, 59–73.

Bernanke, B. and M. Gertler (1989). Agency Costs, Net Worth, and Business Fluctuations.
  The American Economic Review , 14–31.

Bernanke, B., M. Gertler, and S. Gilchrist (1996). The Financial Accelerator and the Flight
  to Quality. The Review of Economics and Statistics, 1–15.

Bisin, A. and P. Gottardi (2006). Efficient Competitive Equilibria with Adverse Selection.
  Journal of Political Economy 114 (3), 485–516.

Caballero, R. and A. Krishnamurthy (2001). International and Domestic Collateral Con-
  straints in a Model of Emerging Market Crises. Journal of Monetary Economics 48 (3),
  513–548.

Caballero, R. and A. Krishnamurthy (2004). Smoothing Sudden Stops. Journal of Economic
  Theory 119 (1), 104–127.

Chien, Y. and H. Lustig (2010). The market price of aggregate risk and the wealth distri-
  bution. Review of Financial Studies 23 (4), 1596–1650.

Cooley, T., R. Marimon, and V. Quadrini (2004). Aggregate Consequences of Limited
  Contract Enforceability. Journal of Political Economy 112 (4), 817–847.

Debreu, G. (1954). Valuation Equilibrium and Pareto Optimum. Proceedings of the National
  Academy of Sciences of the United States of America 40 (7), 588.

                                            51
Diamond, D. and P. Dybvig (1983). Bank Runs, Deposit Insurance, and Liquidity. The
  Journal of Political Economy 91 (3), 401.

Farhi, E., M. Golosov, and A. Tsyvinski (2009, 07). A Theory of Liquidity and Regulation
  of Financial Intermediation. Review of Economic Studies 76 (3), 973–992.

Geanakoplos, J. (1997). Promises Promises. In Santa Fe Institute Studies in the Sciences of
  Complexity, Volume 27, pp. 285–320. Addison-Wesley Publishing Co.

Geanakoplos, J. (2003). Liquidity, Default, and Crashes. Advances in Economics and Econo-
  metrics: Theory and Applications: Eighth World Congress.

Geanakoplos, J. and H. Polemarchakis (1986). Existence, Regularity and Constrained Sub-
  optimality of Competitive Allocations when the Asset Market is Incomplete. Uncertainty,
  Information and Communication: Essays in Honor of KJ Arrow 3, 65–96.

Golosov, M. and A. Tsyvinski (2007). Optimal Taxation With Endogenous Insurance Mar-
  kets. Quarterly Journal of Economics 122 (2), 487–534.

Greenwald, B. and J. Stiglitz (1986). Externalities in Economies with Imperfect Information
  and Incomplete Markets. Quarterly Journal of Economics 101 (2), 229–264.

Guerrieri, V., R. Shimer, and R. Wright (2010). Adverse selection in competitive search
  equilibrium. Econometrica 78 (6), 1823–1862.

Hart, O. D. and L. Zingales (2113). Inefficient Provision of Liquidity. Technical report,
  Working Paper.

Holmström, B. and J. Tirole (1998). Private and Public Supply of Liquidity. Journal of
  Political Economy 106 (1), 1–40.

Jacklin, C. (1987). Demand Deposits, Trading Restrictions, and Risk Sharing. Contractual
  Arrangements for Intertemporal Trade, 26–47.

Kehoe, T. and D. Levine (1993). Debt-Constrained Asset Markets. Review of Economic
  Studies 60 (4), 865–888.


                                              52
Kilenthong, W. T. (2011). Collateral Premia and Risk Sharing under Limited Commitment.
  Economic Theory 46 (3), 475–501.

Kilenthong, W. T. and R. M. Townsend (2011a). Information-Constrained Optima with
  Retrading: An Externality and its Market-Based Solution. Journal of economic the-
  ory 146 (3), 1042–1077.

Kilenthong, W. T. and R. M. Townsend (2011b). Market Based, Segregated Exchanges in
  Securities with Default Risk. Working Paper .

Kilenthong, W. T. and R. M. Townsend (2014). A Market Based Solution to Price Exter-
  nalities: A Generalized Framework. Working Paper .

Kiyotaki, N. and J. Moore (1997). Credit Cycles. Journal of Political Economy 105 (2),
  211–248.

Kocherlakota, N. R. (1996). Implications of Efficient Risk Sharing without Commitment.
  Review of Economic Studies 63 (4), 595–609.

Koopmans, T. C. and M. Beckmann (1957). Assignment problems and the location of
  economic activities. Econometrica, 53–76.

Krishnamurthy, A. (2003). Collateral Constraints and the Amplification Mechanism. Journal
  of Economic Theory 111 (2), 277–292.

Lamont, O. (1995). Corporate-Debt Overhang and Macroeconomic Expectations. The Amer-
  ican Economic Review , 1106–1117.

Lindahl, E. (1958). Just Taxation–A Positive Solution. In R. A. Musgrave and A. T. Peacock
  (Eds.), Classics in the theory of public finance. Macmillan, London.

Lorenzoni, G. (2008). Inefficient Credit Booms. Review of Economic Studies 75 (3), 809–833.

Meade, J. E. (1952). External Economies and Diseconomies in a Competitive Situation. The
  economic journal , 54–67.



                                              53
Mortensen, D. T. and R. Wright (2002). Competitive pricing and efficiency in search equi-
  librium*. International Economic Review 43 (1), 1–20.

Negishi, T. (1960). Welfare Economics and Existence of an Equilibrium for a Competitive
  Economy. Metroeconomica 12 (2-3), 92–97.

Prescott, E. C. and R. M. Townsend (1984a). General Competitive Analysis in an Economy
  with Private Information. International Economic Review 25 (1), 1–20.

Prescott, E. C. and R. M. Townsend (1984b). Pareto Optima and Competitive Equilibria
  with Adverse Selection and Moral Hazard. Econometrica 52 (1), 21–45.

Prescott, E. S. and R. M. Townsend (2006). Firms as Clubs in Walrasian Markets with
  Private Information. Journal of Political Economy 114 (4), 644–671.

Rampini, A. (2004). Entrepreneurial Activity, Risk, and the Business Cycle. Journal of
  Monetary Economics 51 (3), 555–573.

Rampini, A. A. and S. Viswanathan (2010). Collateral, risk management, and the distribu-
  tion of debt capacity. Journal of Finance 65 (6), 2293–2322.

Ranciere, R., A. Tornell, and F. Westermann (2008). Systemic Crises and Growth. Quarterly
  Journal of Economics 123 (1), 359–406.

Townsend, R. M. (1983). Theories of intermediated structures. Carnegie-Rochester Confer-
  ence Series on Public Policy 18, 221–272.

Zhu, H. (2013). Do dark pools harm price discovery? Review of Financial Studies.




                                              54
A      Proofs
Lemma 2: For any state-contingent security, there exists a security with no default that
can generate the same total payoffs using the same amount of collateral.

Proof of Lemma 2: Default is Irrelevant under Complete Contracts. Consider a contingent
                                                                                1
security that will be in default in state s, with collateral C
                                                             b<
                                                                             Rs p(zs )
                                                                                       .   That is, an issuer of
this security will “default” in state s. Hence, according to condition (2), the payoff of this
security (in units of good 1) in state s is
                                              
                              min 1, CR
                                     b s p(zs ) = CR
                                                  b s p(zs ) < 1.                                          (66)

    We now argue that there is an alternative security that does not default but generates
exactly the same total payoffs using the same amount of collateral overall. Consider a state-s
                                                             1
contingent security with collateral amount C
                                           e =
                                                          Rs p(zs )
                                                                    .   This security will not default. It
is straightforward to show that the payoff of this security is one unit of good 1 in state s.
Now consider CR
             b s p(zs ) units of the alternative security. That collection of securities pays

in state s one per unit or CR
                           b s p(zs ) in total. This is exactly the same as the payoff of the

original security with default: see (66). In addition, the total collateral for CR
                                                                                b s p(zs ) units
                                      1
of the alternative security with   Rs p(zs )
                                               collateral per unit is C,
                                                                      b which is exactly the same as

the collateral level of the original security. Therefore, the alternative security can generate
the same payoffs using the same total amount of collateral but without default. A similar
argument also applies to all other types of securities.

Lemma 3: With identical homothetic and strictly concave preferences, the attainable set
is non-convex.

Proof of Lemma 3. For simplicity, both state and agent indices will be kept implicit here.
                                                                                             
Without loss of generality, let Rs = 1 for all s. Consider two different allocations k, θ̂, θ
                 
and k 0 , θ̂0 , θ0 with two different market fundamentals z, z 0 , respectively. The collateral
constraints (3) for an agent h in state s with these two allocations be binding:

                       p(z)k + θ̂ + p(z)θ = 0 =⇒ θ̂ = −p(z) (k + θ) .                                      (67)

                    p(z 0 )k 0 + θ̂0 + p(z 0 )θ0 = 0 =⇒ θ̂0 = −p(z 0 ) (k 0 + θ0 ) .                       (68)

                                                    55
Since we are looking for a counter example, we can pick these two allocations to satisfy

                     θ̂ = θ̂0 < 0 =⇒ p(z) (k + θ) = p(z 0 ) (k 0 + θ0 ) > 0.                                              (69)

The positivity of the prices implies that k + θ > 0 and k 0 + θ0 > 0.
   Now consider a convex combination allocation: k λ = λk + (1 − λ) k 0 , θ̂λ = λθ̂ + (1 − λ) θ̂0 ,
θλ = λθ + (1 − λ) θ0 , cλ = λc + (1 − λ) c0 , and z λ = z(cλ ), where 0 < λ < 1. Using equations
(67)-(68), we can write
                                                   
                                          k+θ
        λ   λ    λ      λ   λ
                                                            λp(z λ ) (p(z 0 ) − p(z)) + p(z) p(z λ ) − p(z 0 )
                                                                                                                
    p(z )k + θ̂ + p(z )θ        =                                                                                     .
                                          p(z 0 )

There is no loss of generality to assume that p(z) < p(z λ ) < p(z 0 ). Then, pick λ that is
smaller than λ∗ :

                                          p(z 0 ) − p(z λ )
                                                                              
                                ∗                                      p(z)
                                λ =                                                  .                                    (70)
                                          p(z 0 ) − p(z)               p(z λ )

Using the condition that p(z) < p(z λ ) < p(z 0 ), we can show that 0 < λ∗ < 1. This condition
implies that we can pick 0 < λ < λ∗ < 1 such that

                      λp(z λ ) (p(z 0 ) − p(z)) + p(z) p(z λ ) − p(z 0 ) < 0.
                                                                        
                                                                                                                          (71)

Using k + θ > 0, this clearly violates the collateral constraint (3). Therefore, the attainable
set is non-convex.

Proposition 1: Under Assumption 1, a competitive collateral equilibrium is constrained
                                                                         h
optimal if and only if all collateral constraints are not binding, i.e. γcc−s = µhcc−s = 0 for all
h and all s. As a result, a competitive collateral equilibrium is constrained suboptimal if and
only if it is not first-best optimal.

Proof of Proposition 1. We first prove that a competitive collateral equilibrium is constrained
                                                                         h
optimal if and only if all collateral constraints are not binding, i.e. γcc−s = µhcc−s = 0 for all
h and all s. The proof is based on the first-order conditions for Pareto program (22) and
the first-order conditions for a competitive collateral equilibrium. Note that the resource
constraints in the Pareto program (22) and the market-clearing constraints in the competi-
tive collateral equilibrium are clearly equivalent. In addition, the collateral constraints are

                                                             56
the same in both problems as well. Hence, we only need to match all first-order conditions
from both problems. In addition, with limited space, we will focus only on the term that
generates an externality.


Optimal Conditions for the Pareto Program (22)

Let µhcc−s and µhū denote the Lagrange multipliers for the collateral constraint (20) for state s
for an agent type h and for the participation constraint (23) for an agent type h = 1, 2, . . . , H
with a normalization of µ1ū = 1, respectively. Combining the first-order conditions with
respect to ch10 , k h , and the complementarity slackness conditions for the collateral constraints
gives:
  uh20   X     uh2s    X µhcc−s               X αh                ∂zs X h̃ h            i
                                                           0                     h   h̃
       =   πs β h Rs +             p(zs )Rs +             p (zs )      µcc−s Rs k + θs
  uh10   s
               u10     s
                         µhū uh10            s
                                                µhū uh10         ∂K
                                                                                   h̃
                 X        uh          X µhcc−s             X αh p0 (zs ) ∂zs X
           =          πs β h2s Rs   +    h h
                                                p(zs )Rs −    h h p(z ) ∂K
                                                                               µh̃cc−s θ̂sh̃ ,       (72)
                  s
                          u10         s
                                        µū u10            s
                                                             µū u10 s
                                                                                    h̃

where the last equation follows from the complementarity slackness condition with respect
to collateral constraints:
                 n      h             i      o             h             i   µh̃ θ̂h
          µh̃cc−s p(zs ) Rs k h + θsh̃ + θ̂sh = 0 ⇒ µh̃cc−s Rs k h + θsh̃ = − cc−s s .               (73)
                                                                              p(zs )
Note that (72) is exactly the same as (24).


Optimal Conditions for a Collateral Equilibrium

Let γcc−s be the Lagrange multiplier for the collateral constraint for state s. Combining the
first-order conditions with respect to ch10 and k h gives:
                                                           h
                          uh20     X βuh
                                              2s
                                                      X γcc−s
                               =       π s h     Rs +          p(zs )Rs .                            (74)
                          uh10      s
                                           u 10        s
                                                           uh
                                                            10

   We are ready to prove the lemma.
                         h
  (i) (⇐=) Suppose that γcc−s = µhcc−s = 0 for all h and all s. We then can show that
         any competitive collateral equilibrium allocation will also solve the Pareto program
         (22) by matching all necessary and sufficient conditions. In particular, we can pick
         µ20           µθ̂s                                     µh
         µ10
               = P20 , µ10  = Pbas , µµ10
                                       θs              h
                                          = Pas , and γcc−s =    cc−s
                                                                 µh
                                                                        = 0. In conclusion, any collateral
                                                                   ū
                                                           h
         equilibrium allocation is constrained optimal if γcc−s = µhcc−s = 0 for all h and all s.

                                                        57
(ii) (=⇒) Suppose that a competitive collateral equilibrium allocation is constrained opti-
    mal, i.e., solves the Pareto program (22). Hence, it must satisfy (72). Using the same
    matching conditions as above, this will be true only if the last terms in (72) is zero.
    We will prove this by a contradiction argument.

    Suppose that there are some h̃ with µh̃cc−s 6= 0, and the last terms in (72) is zero:
                                                                 
                          αh X p0 (zs ) ∂zs X h̃
                          h h
                                                      µcc−s θ̂sh̃  = 0.                  (75)
                        µū u10 s p(zs ) ∂K
                                                                         h̃

    This must be true for all h and h̃.

    We will now argue that h̃ µh̃cc−s θ̂sh̃ has the same negative sign for every state s. Using
                           P

    the first-order condition for the Pareto program with respect to θ̂sh , we can show that
                                  X                       X                          X
                                        µh̃cc−s θ̂sh̃ =        µ1s αh̃ θ̂sh̃ − βπs        µh̃ū uh̃1s θ̂sh̃ ,                        (76)
                                   h̃                     h̃                         h̃

    where µ1s is the Lagrange multiplier for the resource constraint for θ̂sh . The resource
    constraint for θ̂sh ,
                          P h̃ h̃                          P        h̃ h̃
                           h̃ α θ̂s = 0, then implies that  h̃ µ1s α θ̂s = 0 for all s. In

    addition, the first-order condition for the Pareto program with respect to ch10 implies
                     µ10 αh̃
    that µh̃ū =             .   Thus, we now have
                      uh̃
                       10
                                                                                         !
                                        X                                X       uh̃1s
                                             µh̃cc−s θ̂sh̃ = −βπs µ10                        αh̃ θ̂sh̃ .                             (77)
                                        h̃                                h̃
                                                                                 uh̃10

                                                                                                                uh̃
    The optimality requires that an agent with relative large IMRS,                                              1s
                                                                                                                      , will hold positive
                                                                                                            uh̃
                                                                                                             10

    θ̂sh̃ ≥ 0 and vice versa. This implies that the positive term of                                   h̃ h̃
                                                                                                      α θ̂s ≥         0 will be weighted
    more than the negative one. Combining this result with the resource constraint for θ̂sh ,
    P h̃ h̃                                    P  uh̃1s  h̃ h̃
     h̃ α θ̂s = 0, we can  conclude       that   h̃ uh̃   α θ̂s ≥ 0, ∀s, and therefore
                                                       10
                                                               !
                      X                            X uh̃
                                                            1s
                          µh̃cc−s θ̂sh̃ = −βπs µ10               αh̃ θ̂sh̃ ≤ 0, ∀s.    (78)
                                                           h̃
                       h̃                           h̃
                                                          u10

    With strictly concave and identical homothetic utility function, we can show that
    p0 (zs ) ∂zs
    p(zs ) ∂K
                   < 0, and therefore can conclude that
                                                             
                                    0
                                  p (zs ) ∂zs X h̃
                                                  µcc−s θ̂sh̃  ≥ 0, ∀s.                                                             (79)
                                   p(zs ) ∂K
                                                               h̃


                                                                    58
      As a result, (75) will hold only if
                                                                            !
                              X                                X    uh̃1s
                                    µh̃cc−s θ̂sh̃ = −βπs µ10                    αh̃ θ̂sh̃ = 0, ∀s.                            (80)
                               h̃                              h̃
                                                                    uh̃10

                                                                                     uh̃         uh
                             αh̃ θ̂sh̃ = 0, condition (80) implies that
                    P
      Given that        h̃
                                                                                      1s
                                                                                             =    1s
                                                                                                 uh
                                                                                                     ,    ∀h, h̃; s. Using the
                                                                                     uh̃
                                                                                      10          10
                  uh                                                                 uh̃         uh
      fact that    2s
                  uh
                        = p(zs ) for all h, we can also show that                      1s
                                                                                             =    1s
                                                                                                 uh
                                                                                                      ,   ∀h, h̃; s. In words,
                   1s                                                                uh̃
                                                                                       1ŝ        1ŝ

      the marginal rate of substitutions across times and states are equalized across agent
      types. Under the assumption 1, these equalities are necessary and sufficient conditions
      for first-best optimality, which in turn implies that all collateral constraints are not
                      h
      binding, i.e., γcc−s = µhcc−s = 0 for all h and all s. Hence, we can conclude that a
      collateral equilibrium is constrained optimal, solving the Pareto program (22), only if
      all collateral constraints are not binding.

   The rest of the proof of is by contrapositive. Suppose a competitive collateral equilibrium
is constrained optimal. The above result implies that a necessary and sufficient condition for
a competitive collateral equilibrium to be constrained optimal is that all collateral constraints
are not binding. No binding collateral constraints implies first-best optimality. In short, we
have shown that first-best optimality is a necessary and sufficient condition for constrained
optimality. Thus we can conclude that a competitive collateral equilibrium is constrained
suboptimal if and only if it is not first-best optimal.

Proposition 2: Under Assumption 1, if a competitive collateral equilibrium is not first-best
optimal, then
                                                                                                                   uh
  (i) the equilibrium price of good 2 in period t = 0, P20 , is too high, i.e., P20 >                               20
                                                                                                                   uh
                                                                                                                          ,   and
                                                                                                                    10 op


 (ii) the (endogenous) aggregate saving/collateral in a competitive collateral equilibrium,
      K ce , is too large, i.e., K ce > K op .

Proof of Proposition 2. The proof is an immediate result of the proof of proposition 1 above.
First, if a competitive collateral equilibrium is not first-best optimal, then (by proposition
1) we can show that the last term of (72) is strictly positive:
                                    X αh p0 (zs ) ∂zs X
                                       h h p(z ) ∂K
                                                        µh̃cc−s θ̂sh̃ > 0.                                                    (81)
                                    s
                                      µū u10 s
                                                               h̃


                                                          59
This implies that the marginal rate of substitution between good 1 and good 2 in period
t = 0 at the competitive collateral equilibrium is larger than the optimal level of the marginal
                                                                                    uh           uh
rate of substitution between good 1 and good 2 in period t = 0, i.e.,                20
                                                                                    uh
                                                                                             >    20
                                                                                                 uh
                                                                                                        .   This
                                                                                     10 ce        10 op

implies that the equilibrium price of good 2 in period t = 0 is too high relative to its
                                                                   uh
shadow price from the (constrained) optimal allocation              20
                                                                   uh
                                                                          .   In addition, given that the
                                                                    10 op

aggregate consumption of good 1 is fixed and preferences are identically homothetic, this
result can be true only if the (endogenous) aggregate saving/collateral in a competitive
collateral equilibrium, K ce , is too large, i.e., K ce > K op .




                                                   60
B        More Results

B.1       Default cannot Make Collateral Constraints Less Binding un-
          der Complete Contracts

This section shows that contracts that do actually default does not relax the collateral
constraints (3); that is, contracts that do default are not necessary. They may exist and get
traded, but we can support an equivalent allocation without them. In particular, we now
derive a collateral constraint with contracts that do default, and then show that the same
net-payoff and same collateral constraint can be reached using no-default contracts. This is,
in fact, a result of Lemma 2 but it is nice to be explicit, as the result seems counterintuitive.
      Let C,   bσ , and C σ be the collateral levels of defaulting contracts promising to pay
          b C, C

a unit of good 1 with good 2 as collateral, promising to pay a unit of good 2 with good
2 as collateral, promising to pay a unit of good 1 with financial assets as collateral, and
promising to pay a unit of good 2 with financial assets as collateral, respectively. Note
that, for expositional reasons, we assume that all contracts are contracts that do default.
Accordingly, the payoffs of those contracts, which by construction with default, in state s
are
                                                 
                              D
                              b s = min P2s Rs C,
                                               b 1 = P2s Rs C,
                                                            b                               (82)

                             Ds = min (Rs C, 1) = Rs C,                                     (83)
                                                 
                             b sσ = min P2s C
                             D              bσ , 1 = P2s Cbσ ,                              (84)
                                        σ 
                                σ        C          Cσ
                             Ds = min        ,1 =       .                                   (85)
                                         P2s        P2s
      The collateral requirement condition for contracts using physical good 2 as collateral is
given by
                                               
                            k h ≥ −C
                                   b min 0, ψ̂ h − C min 0, ψ h .
                                                               
                                              s              s


Multiplying by P2s Rs both sides gives
                                                    
                   P2s Rs k h ≥ −P2s Rs C
                                        b min 0, ψ̂ h − P2s Rs C min 0, ψ h
                                                                            
                                                   s                     s
                                               
                                 b s min 0, ψ̂sh − P2s Ds min 0, ψsh .
                                                                    
                              = −D                                                          (86)

                                               61
where the last equality follows from (82)-(83).
   The collateral requirement condition regarding contracts paying in good 1 using pur-
chased assets as collateral can be written as

                   Ds max 0, ψsh + Dsσ max 0, σsh ≥ −C
                                                     bσ min 0, σ̂ h ,
                                                                 
                                                                 s                                         (87)

which can be rearranged as

              P2s Ds max 0, ψsh + P2s Dsσ max 0, σsh ≥ −P2s Cbσ min 0, σ̂sh
                                                                          

                                                         b σ min 0, σ̂ h .
                                                                        
                                                      = −D s          s                                    (88)

where the last equality follows from (84).
   Similarly, the collateral requirement condition regarding contracts paying in good 2 using
purchased assets as collateral can be written as
                              
                b s max 0, ψ̂sh + Db sσ max 0, σ̂sh ≥ −C σ min 0, σsh
                                                                     
                D

                                                       = −P2s Dsσ min 0, σsh ,
                                                                            
                                                                                                           (89)

where the last equality follows from (85).
   Summing conditions (86)-(89) gives the collateral constraint in state s, for an agent h,
                    h                       i h                                  i
  P2s Rs k h ≥ −D
                b s max 0, ψ̂ h + min 0, ψ̂ h − max 0, σ̂ h + D      b σ min 0, σ̂ h
                                                                 
                              s              s                 s       s          s

               −P2s Ds max 0, ψsh + min 0, ψsh − P2s Dsσ max 0, σsh + min 0, σsh
                                                                                  
                                              
                      h         σ h            σ h
             = − Ds ψ̂s − Ds σ̂s − P2s Ds ψs − P2s Dsσ σsh .
                                                                   
                  b          b               b                                           (90)

   The above collateral constraint shows that what really matter for the collateral constraint
is the total payoff of contracts. As a result, we can find equivalent contracts with no-default
that satisfy the same collateral constraint, by re-normalizing the original contracts. In
                                                b0 =
particular, consider contracts, with collateral C        1
                                                              ,   C0 =   1
                                                                            ,   b0σ =
                                                                                C        1
                                                                                            ,   and C 0σ = P2s .
                                                       P2s Rs            Rs             P2s

Hence, their payoffs are payoffs of those contracts in state s, respectively, are
                                                        
                                  0                    0
                               Ds = min P2s Rs C , 1 = 1,
                                b                    b                                                     (91)

                               Ds0 = min (Rs C 0 , 1) = 1,                                                 (92)
                                                     
                               b s0σ = min P2s C
                               D               b0σ , 1 = 1,                                                (93)
                                           0σ 
                                  0σ        C
                               Ds = min         , 1 = 1.                                                   (94)
                                            P2s

                                                62
Note that these are no-default contracts.
    In order to reach the same total payoff as originally, let the agent hold securities ψ̂s0h =
b s ψ̂sh , σ̂s0h = D
D                  b sσ σ̂sh , ψs0h = Ds ψsh , and σs0h = Dsσ σsh . As a result, the collateral constraint (90)

becomes
                                                   
                          P2s Rs k h + ψ̂s0h + σ̂s0h + P2s ψs0h + σs0h ≥ 0,
                                                                      
                                                                                                          (95)

which is identical to the collateral constraint (3), derived from no-default contracts only.


B.2      Details of the Building Blocks of the Collateral Constraints

This section precisely defines directly collateralized and asset-back securities (pyramiding),
and derives the unified collateral constraints (3) by considering the collateral constraints of
each type of securities one at a time and adding them up (and disaggregating back down).


Collateral Constraints on Directly Collateralized Securities
                                          S                               S
To generalize a bit, let ψ̂ h ≡ ψ̂sh        s=1
                                                  ∈ RS and ψ h ≡ ψsh         s=1
                                                                                    ∈ RS denote agent h’s
portfolios of securities demanded, held at the end of period 0 paying in good 1 and in good
2, both with good 2 as collateral directly, respectively. Again, we adopt the convention that
positive means demand and negative means sale. So, holding a positive amount of a security
                                    
paying good 2 in state s, max 0, ψsh = ψsh , a positive number, is equivalent to buying that
                                                                                  
security (or lending) while holding a negative amount of a security, min 0, ψsh = ψsh , a
negative number, is equivalent to selling that security (or borrowing). In short, the max and
min operators pick off demand and supply, respectively. A wedge is created by the need to
back the supply by collateral but not the demand.
    More generally, a security paying a unit of good 1 in state s backed by good 2 pays the
minimum of 1 unit of good 1 or the value of its collateral in state s. By an argument similar
                                                                            1
to the one given earlier, the minimum no-default collateral is           p(zs )Rs
                                                                                    per unit. Similarly, with
                                                                                                            1
no-default and no-over-collateralization, a security paying in good 2 in state s requires                   Rs

units of good 2 as collateral. The results so far are summarized in the first two rows of the
Table 9 with collateral requirement in the last column.


                                                      63
                    Table 9: Collateral requirements for each type of securities.
          payment   collateral                  issued                     purchased assets               total collateral
          unit      unit                        liabilities                available                      requirement for
                                                                           as collateral                  no default securities
                                                                                                                              
                                                                                                                1
 ψ̂sh     good 1    good 2                      − min 0, ψ̂sh              max 0, ψ̂sh                    − Rs p(z     min   0, ψ̂s
                                                                                                                                   h
                                                                                                              s)
                                                                                                          − R1s min 0, ψsh
                                                                                                                            
 ψsh      good 2    good 2                      − min 0, ψsh               max 0, ψsh
                                                                                                                  
                                                                                                          − p(z1s ) min 0, σ̂sh
                                                                                                                              
 σ̂sh     good 1    securities paying           − min 0, σ̂sh              max 0, σ̂sh
                    in good 2
                                                                                                                             
 σsh      good 2    securities paying           − min 0, σsh               max 0, σsh                     −p(zs ) min 0, σsh
                    in good 1
                                                                                                                        
 ν̂sh     good 1    securities paying           − min 0, ν̂sh              max 0, ν̂sh                    − min 0, ν̂sh
                    in good 1
                                                                                                                        
 νsh      good 2    securities paying           − min 0, νsh               max 0, νsh                     − min 0, νsh
                    in good 2

                                
        For securities ψ̂sh , ψsh with good 2 as collateral, paying in good 1 and good 2, respec-
tively, agent h must hold good 2 at the end of period 0 no less than the collateral requirement
in any state (shown in Table 9):
                                                           1
                                                                                                
                                                                                                     1
                                                                                                          
                        h
                                            0, ψ̂sh                                0, ψsh
                                                                                             
                    k        ≥ − min                                       − min                              , ∀s,                (96)
                                                           Rs p(zs )                                 Rs

which can be rewritten as
                                                     
                            p(zs )Rs k h + min 0, ψ̂sh + p(zs ) min 0, ψsh ≥ 0, ∀s.
                                                                          
                                                                                                                                   (97)

These are state-contingent collateral requirement constraints with directly collateralized se-
curities. We incorporate asset-backed securities in the next section.
        Note that when an agent h’s collateral requirement constraints (96) are not binding for
every state s (i.e., the LHS of (96) exceeds its RHS or (96) holds with strict inequality
for every state s), then the agent h holds collateral k h more than needed to back issued
securities. The extra part of collateral is normal saving.




                                                                64
Pyramiding: Asset-Backed Securities

In real world economies, agents are allowed to use the promises to receive goods of others as
collateral to back their own promises. This is termed pyramiding. In other words, there are
two types of collateral, good 2 itself (described in the preceding section) and “assets” backed
by such collateral. The prototypical example of an asset-backed promise in this paper is an
ex-ante agreement for an agent to give up good 1 in the spot market in state s backed by
someone else’s promise, a receipt of good 2, or vice versa. The promise of receipt is the asset,
and this backs the promise to pay. Indeed, if the planned spot-market trade is at equilibrium
price of p(zs ), then one is moving along a budget line and so the value of collateral, the good
to be recovered, exactly equals the promise and there is no need for additional underlying
collateral.
   With two physical commodities, there are four possible types of asset-backed securities,
summarized in the last four rows of Table 9. For example, a unit of an asset-backed security
                                                      1
σ̂s paying in good 1 in state s needs               p(zs )
                                                             units of assets paying in good 2 as collateral. The
                                1
value of the payoff of        p(zs )
                                       units of securities paying in good 2 in state s equals p(zs )× p(z1s ) = 1
unit of good 1, which is exactly the face-value promise to pay. These collateral requirements
are minimum no-default levels.
   As shown in the third row of Table 9 (see the column titled total collateral requirement),
an asset-backed security paying a unit of good 1 in state s, σ̂sh , requires that the total amount
                                                                         
of purchased assets paying in good 2 in state s is no less than − p(z1s ) min 0, σ̂sh . Similarly,
                                                                                       

an asset-backed security νsh requires that the total amount of purchased assets paying in good
                                         
2 in state s is no less than − min 0, νsh (see the last row of Table 9). On the other hand, the
                                                                                           
total amount of purchased assets paying in good 2 is max 0, ψsh +max 0, σsh +max 0, νsh ,
as shown in the second, fourth and last rows of Table 9 (see the next-to-last column titled
purchased assets). Hence, the collateral requirement condition regarding issued securities σ̂sh
and νsh that require financial assets paying in good 2 as collateral can be written as, for any
state s,
                                                                                        
                                                                                  1
              0, ψsh               0, σsh               0, νsh                               min 0, σ̂sh − min 0, νsh .
                                                                                                                 
    max                    + max                + max                 ≥ −
                                                                                p(zs )

This states that the agent purchases enough assets or promises paying in good 2, θsh , σsh , νsh ,

                                                                     65
to back up her own asset-backed securities or issued promises σ̂sh , νsh . The above condition
can be rearranged as

               p(zs ) max 0, ψsh + p(zs ) max 0, σsh + p(zs )νsh ≥ − min 0, σ̂sh ,
                                                                              
                                                                                                            (98)

                                                     
where we applies the fact that max 0, νsh + min 0, νsh = νsh .
   Similarly, the collateral requirement condition for issued securities that require financial
assets paying in good 1 as collateral is given by
                            
                  max 0, ψ̂sh + max 0, σ̂sh + ν̂sh ≥ −p(zs ) min 0, σsh , ∀s,
                                                                      
                                                                                                            (99)

where the right-hand-side comes from the fourth and fifth rows of Table 9.
   We now show that the collateral constraints

                                  p(zs )Rs k h + θ̂sh + p(zs )θsh ≥ 0, ∀s                                  (100)

are equivalent to collateral requirement conditions (with three types of collateral), (97), (98),
and (99). In other words, there is no loss of generality to use the collateral constraints (100);
an allocation is attainable under (100) if and only if it is so under (97), (98), and (99).
   To be more precise, let θ̂sh = ψ̂sh + σ̂sh + ν̂sh and θsh = ψsh + σsh + νsh be contingent securities
paying in good 1 and in good 2 in state s, respectively, which can be backed either by good
2 or purchased assets (other people’s promises). Note that θ̂sh and θsh include both directly
collateralized and asset-backed securities. An attainable allocation under (97), (98), and (99)
can be defined similarly to the one under (3) by replacing (12)-(13) the following resource
constraints:
      X                X              X               X              X               X
           αh ψ̂sh =       αh ψsh =       αh σ̂sh =       αh σsh =       αh ν̂sh =       αh νsh = 0, ∀s.   (101)
       h               h              h               h              h               h

   The collateral constraint (100) results from summing (97), (98), and (99) altogether, and
then applying max(0, x)+min(0, x) = x to get rid of max and min operators. In addition, the
                                                                                                      
proof of this lemma also shows how to recover contract allocation ψ̂sh , ψsh , σ̂sh , σsh , ν̂sh , νsh
                                                                                                       h
from θ̂sh , θsh .

Lemma 4. The following statements are true:

                                                          66
                                                        
  (i) if ch0 , k h , ψ̂sh , ψsh , σ̂sh , σsh , ν̂sh , νsh is attainable, then the collateral constraint (100) and
                                             h
      the market-clearing conditions (12)-(13) hold, and
                        
 (ii) if k h , θ̂sh , θsh is attainable, then there exists a collateral and security allocation
                          h                 
        k , ψ̂s , ψs , σ̂s , σsh , ν̂sh , νsh that satisfies collateral requirement conditions (97), (98),
         h    h      h    h
                                      h
      (99) and the market-clearing conditions (101).

Proof. The first statement can be proved as follows. First, it is clear that conditions (101)
imply (12)-(13). We now only need to show that (97), (98), and (99) imply (100). Sum-
ming up all collateral requirement conditions, (97), (98), and (99), and using the fact that
max (0, x) + min (0, x) = x give, for an agent h in state s,
                                  h                  i
                    p(zs )Rs k h + ψ̂sh + σ̂sh + ν̂sh + p(zs ) ψsh + σsh + νsh ≥ 0,
                                                                             


which is the collateral constraint for an agent h in state s where θ̂sh = ψ̂sh + σ̂sh + ν̂sh and
θsh = ψsh + σsh + νsh .
                                                                                     
    The second statement is proved as follows. Consider an allocation k h , θ̂sh , θsh that satis-
                                                                                       h                  
                                                                          h       h    h  h   h     h    h
fies (100) and (12)-(13). We will now choose a corresponding allocation k , ψ̂s , ψs , σ̂s , σs , ν̂s , νs
                                                                                                                    h
that satisfies θ̂sh = ψ̂sh + σ̂sh + ν̂sh , θsh = ψsh + σsh + νsh , the collateral requirement conditions
(97), (98), (99), and the market-clearing conditions (101). Consider the following candidate
allocation:

                                      ψ̂sh = θ̂sh + p(zs )θsh ,                                           (102)

                                      ψsh = ν̂sh = νsh = 0,                                               (103)

                                      σ̂sh = θ̂sh − ψ̂sh = −p(zs )θsh ,                                   (104)

                                      σsh = θsh .                                                         (105)

(103) implies that agents hold no ψsh , ν̂sh , νsh ; they will borrow or lend through directly col-
lateralized contract paying in good 1 ψ̂sh only.
    It is straightforward to show that resource constraints (101) hold. Since the resource con-
straints are satisfied and the collateral allocations k h are the same, the market fundamentals
are the same. We now would like to show that collateral requirement conditions (97), (98),
(99) also hold. First, we will show that (98) and (99) hold. There are two cases to consider;

                                                      67
(i) θsh > 0, (ii) θsh < 0. Case I: Suppose that θsh > 0. Using (105), this implies that σsh > 0,
                                    
which in turn leads to min 0, σsh = 0. On the other hand, it is true that
                                                   
            max 0, ψ̂sh + max 0, σ̂sh = max 0, ψ̂sh + max 0, σ̂sh + ν̂sh ≥ 0,
                                                                    

                                                             
where the first equality follows from (103). Since min 0, σsh = 0, we have
                                         
 max 0, ψ̂s + max 0, σ̂s = max 0, ψ̂s + max 0, σ̂sh + ν̂sh ≥ −p(zs ) min 0, σsh ,
            h               h             h
                                                                             


which is (99). On the other hand, (104) implies that σ̂sh < 0 when θsh > 0. As a result,
           
min 0, σ̂sh = σ̂sh . Using (103), (104), (105), we then can show that

              p(zs ) max 0, ψsh + p(zs ) max 0, σsh + p(zs )νsh + min 0, σ̂sh
                                                                            

                           = 0 + p(zs )σsh + 0 + σ̂sh = p(zs )θsh − p(zs )θsh = 0,

where the second equality follows from (104) and (105). This shows that (98) holds.
                                                                          
   Case II: Suppose that θsh < 0. (104) and (105) imply that max 0, σ̂sh = σ̂sh = −p(zs )θsh
              
and min 0, σsh = σsh = θsh , respectively. We then can write
                                            
max 0, ψ̂sh + max 0, σ̂sh + ν̂sh = max 0, ψ̂sh − p(zs )θsh ≥ −p(zs )θsh = −p(zs ) min 0, σsh ,
                                                                                           


which is exactly (99). Note that the first equality follows from (103), the second inequality
                                                                                        
follows from the fact that max 0, ψ̂sh ≥ 0. Similarly, using , we can show that max 0, σsh =
           
min 0, σ̂sh = 0. This implies that

   p(zs ) max 0, ψsh + p(zs ) max 0, σsh + p(zs )νsh + min 0, σ̂sh = 0 + 0 + 0 + 0 = 0,
                                                                


which is exactly (98).
   Similarly, we can now show that (97) also holds. There are two cases to be considered as
well.
   Case I: suppose that θ̂sh + p(zs )θsh < 0. (102) implies that ψ̂sh < 0, which in turn implies
                
that min 0, ψ̂s = ψ̂sh = θ̂sh + p(zs )θsh . Using (103), we now can show that
               h

                           
   p(zs )Rs k + min 0, ψ̂s + p(zs ) min 0, ψsh = p(zs )Rs k h + θ̂sh + p(zs )θsh + 0 ≥ 0,
             h            h
                                                   


where the last inequality follows (100). This implies that (97) holds.
   Case II: we can use a similar argument to show that (97) holds when θ̂sh +p(zs )θsh = ψ̂sh > 0.
In summary, we have show that all collateral requirement conditions hold.

                                                68
B.3       Pooling Collateral versus Tranching

This section shows that the markets economize on collateral; that is, there is no gain from
pooling collateral across agents type h. Let the collateral constraints with pooling be:
                                     X                           X       n       o
                                          αh p(zs ) min 0, ψsh −   αh min 0, ψ̂sh ,
                                                       
               p(zs )Rs K ≥ −                                                                        (106)
                                      h                                h

                                                       αh k h . We then show that the group collateral con-
                                              P
where the average collateral K =                  h

straint is equivalent to individuals collateral constraints (3).
                                                  
Lemma 5. For any allocation k h , ψsh , τsh , τ̂sh satisfying the collateral constraints (106), then
there exists there exists an equivalent allocation k 0h , ψs0h , τsh , τ̂sh with
                                                                           

                                    P h h
                             01       h α ks
                           k =                  , and k 0h = 0 for h 6= 1,                     (107)
                                       α1
                           ψs0h = Rs ksh + ψsh − Rs k 0h ,
                                                   
                                                                                               (108)

              −p(zs ) min(0,ψsh )−min(0,ψ̂sh )
where ksh =              p(zs )Rs
                                               , ∀s.

Proof. This result can be proved in two steps: (i) show that the collateral constraints (106)
hold if and only if there exists ksh such that (3) hold, (ii) then show that any allocation
with state-contingent collateral, ksh , can be replicated by an allocation with fixed collateral
allocation k h .
Step I: =⇒ Suppose that collateral constraints (106) hold. Now consider an alternative
allocation with
                                                                    
                                     −p(zs ) min 0, ψsh − min 0, ψ̂sh
                             ksh =                                             , ∀s.                 (109)
                                                        p(zs )Rs

This clearly implies no default. We then only need to show that the average collateral needed
P h h                                                                             h
  h α ks is no larger than K. Summing the above equation over h with weight α gives, for

each s,
                                                                                      
                       X                   X           −p(zs ) min 0, ψsh − min 0, ψ̂sh
                             αh ksh =            αh
                         h                   h
                                                                    p(zs )Rs
                                      ≤ K,                                                           (110)

where the last inequality follows from the group collateral constraints (106).

                                                            69
       ⇐= This can be done by summing over the individuals collateral constraints with weight
αh .
                                   
Step II: Let ksh , ψsh , τsh , τ̂sh be an attainable allocation with contingent collateral; that is,
it satisfies the collateral constraint for each h and s:

                                           Rs ksh ≥ − min 0, ψsh ,
                                                                
                                                                                                         (111)

                                                                                 αh ksh for all s. In addition,
                                                                           P
and the average collateral is the same in every state; K =                   h

the consumption allocation of agent h in state s is given by

                                     ch1s = eh1s + τ̂sh ,                                                (112)

                                     ch2s = eh2s + Rs ksh + ψsh + τsh ,
                                                               
                                                                                                         (113)

where the spot trade satisfies:

                                             τ̂sh + p(zs )τsh = 0.                                       (114)

       Now consider a candidate allocation k 0h , ψs0h , τs0h , τ̂s0h with
                                                                     

                                             K
                                   k 01 =       , and k 0h = 0 for h 6= 1,                               (115)
                                             α1
                                   ψs0h    = Rs ksh + ψsh − Rs k 0h ,
                                                          
                                                                                                         (116)

                                   τ̂s0h = τ̂sh , and τs0h = τsh .                                       (117)

Using (115), we can write the securities as

                                          ψs01 =   Rs ks1 + ψs1 − k 01 ,
                                                               
                                                                                                         (118)

                                      ψ 0h = Rs ksh + ψsh for h 6= 1.                                    (119)

Using the collateral constraint (111) we can show that for each h 6= 1:

                            ψs0h = Rs ksh + ψsh ≥ Rs ksh + min 0, ψsh ≥ 0,
                                                              
                                                                                                         (120)

where the last inequality follows from the collateral constraint (111). This, ψs0h ≥ 0, implies
that the collateral constraint for any h 6= 1 holds (since he does not issue securities at all).
       We hence only need to show that the collateral constraint also holds for h = 1. We can
rewrite (118) as

                                  k 01 = Rs ks1 + ψs1 − ψs01 ≥ −ψs01 ,
                                                     
                                                                                                         (121)

                                                        70
where the last inequality follows from the collateral constraint (111) for h = 1. This shows
that the collateral constraint also holds for h = 1.
   Given that h αh ks0h = K = h αh ksh , the market fundamentals are the same for every
                P                  P

state. With the same market fundamental, zs , the spot trade is satisfied, using (117).
   Now we will show that the consumption allocations are also the same.

                             c0h    h      0h   h      h    h
                              1s = e1s + τ̂s = e1s + τ̂s = c1s ,                          (122)

where the second equality follows from (117), and the last one follows from (112). Similarly,

       c0h    h          0h    0h
                                    + τs0h = eh2s + Rs ks0h + Rs ksh + ψsh − Rs k 0h + τsh
                                                                                   
        2s = e2s + Rs ks + ψs

           = eh2s + Rs ksh + ψsh + τsh = ch2s ,
                                
                                                                                           (123)

where the second equality follows from (116) and (117), and the last one follows from (113).




B.4     Ex-ante Contracting versus Ex-post Spot Trading

Thus far we implicitly shut down trade in the spot markets in each state. This section shows
that the spot markets are redundant when all types of contracts are available (see Lemma 6
below). In other words, agents do not need to trade in spot markets, though they may well
do so. Importantly, the spot markets are open and deliver the spot price p(zs ). In addition,
we also show that the asset-backed securities are not necessary when the spot markets are
open and active (see Lemma 7 below). Put differently, agents simply are indifferent between
trading in spot markets or ex-ante asset-backed securities.
   When the spot markets are open, each agent h can trade τ̂sh units of good 1 for τsh units
of good 2 at a spot price p(zs ) according to the spot-trade constraint:

                                    τ̂sh + p(zs )τsh = 0.                                 (124)

Recall that the spot price function, p(zs ), is the price such that the spot markets for both
goods clear:
                                       X
                                            αh τ̂sh = 0,                                  (125)
                                        h
                                       X
                                            αh τsh = 0.                                   (126)
                                        h


                                               71
Hence, an attainable allocation with the spot markets is defined by adding the spot-trade
constraint (124) and market-clearing constraints (125)-(126) to Definition 2.
    To be more precise, an allocation is said to be equivalent to an attainable allocation if
it is attainable and generates the same consumption allocation and market fundamental in
each state s as the original attainable allocation.
                                                                       
Lemma 6. For any attainable allocation ch0 , k h , θ̂h , θh , τ̂ h , τ h , there exists an equivalent
                                                                        h
             h   h 0h 0h       0h   0h
allocation c0 , k , θ̂ , θ , τ̂ , τ      such that
                                                           h


                                                               τ̂s0h = τs0h = 0, ∀s, h.                                                         (127)
                                                      
Proof. Let         ch0 , k h , θ̂h , θh , τ̂ h , τ h           be an attainable allocation. We will show that we can
                                                           h
find an equivalent allocation with no spot trade, i.e., τ̂s0h = τs0h = 0. Consider the following
candidate allocation (with 0 )

                                                               c0h
                                                                0  = ch0 , ∀h,                                                                  (128)

                                                               θ̂s0h = θ̂sh + τ̂sh , ∀s, h,                                                     (129)

                                                               θs0h = θsh + τsh , ∀s, h.                                                        (130)

Note that agents here acquire or issue securities on good 1 and good 2 in state s rather than
waiting for trade in spot markets. The rest of the proof is similar to the proof of Lemma 4,
and hence is omitted (it is available in our Working Paper version).

    Condition (127) in Lemma 6 implies that the spot markets in period 1 are redundant
when all securities are allowed; that is, anything that can be done through the spot markets
and one set of securities is feasible under another set of securities without spot markets.
Henceforth (and previously), the ex-post spot trade transfers will be (were) set to zero,
(τ̂ h = 0, τ h = 0 as in (127)) and the spot-trade constraints (124) will be (were) neglected,
unless stated otherwise.
                                                                                                                                           
Lemma 7. For any attainable allocation                                      ch0 , k h , ψ̂sh , ψsh , σ̂sh , σsh , ν̂sh , νsh , τ̂ h , τ h
                                                                                                           , there exists
                                                                                                       h
an equivalent allocation ch0 , k h , ψ̂s0h , ψs0h , σ̂s0h , σs0h , ν̂s0h , νs0h , τ̂ 0h , τ 0h such that
                                                                                                                     h


                                              σ̂s0h = σs0h = ν̂s0h = νs0h = 0, ∀s, h.                                                           (131)

                                                                              72
                                                                           
Proof. Suppose ch0 , k h , ψ̂sh , ψsh , σ̂sh , σsh , ν̂sh , νsh , τ̂ h , τ h is attainable. Consider the following
                                                                             h              
                                  0       h     h       0h     0h      0h    0h 0h 0h 0h  0h
alternative allocation (with ) c0 , k , ψ̂s , ψs , σ̂s , σs , ν̂s , νs , τ̂ , τ                such that
                                                                                      h


   σ̂s0h = σs0h = ν̂s0h = νs0h = 0, ψsh = 0, ∀h, s,                                                     (132)
                                                                             
                                                   ψ̂s0h   = ψ̂sh + σ̂sh + ν̂sh + p(zs ) ψsh + σsh + νsh(133)
                                                                                                        
                                                                                                          ,

                                                   τ̂s0h   = −p(zs ) ψsh + σsh + νsh + τ̂sh ,
                                                                                     
                                                                                                        (134)

                                                   τs0h    = ψsh + σsh + νsh + τsh .
                                                                               
                                                                                                        (135)

Note that at the alternative allocation, agents will do in spot markets what they might have
done in asset-backed security markets. In addition, with active spot markets, there is no
need to trade in collateral-backed securities paying in good 2 (trade in the ones paying in
numeraire good only). The rest of the proof is similar to the proof of Lemma 6, and hence
is omitted (it is available in our Working Paper version).

    It is worthy of emphasis that Lemma 6 and Lemma 7 imply that the asset-backed secu-
rities that we need in this model are the ones that replicate spot markets. In other words,
the asset-backed securities in this model (with tranching) are simply substitutes for spot
markets. Henceforth, we let asset-backed securities play this role and shut down active trade
in spot markets. The result is summarized in the following corollary.

Corollary 1. Asset-backed securities and the spot markets are perfect substitute in this
model.


B.5      Spot Markets and Security Prices: No-Arbitrage Condition

The pyramiding mechanism puts a restriction on the prices of contracts traded within each
security exchange. The ratio of the equilibrium prices of the securities in security exchange
                 Pa (zs ,s)
zs in state s,   Pba (zs ,s)
                             ,   must be equal to the marginal rate of substitution or the spot price in
the security exchange, p(zs ). Otherwise, there will be an arbitrage possibility (by keeping the
collateral constraints satisfied with pyramiding). The result is summarized in the following
lemma.




                                                           73
Lemma 8. In a competitive equilibrium, for each s and zs ,

                                       Pa (zs , s) = p(zs )Pba (zs , s).                      (136)

     Using the no-arbitrage condition (136), the collateral constraints (100) can be rewritten
as
                      Pa (zs , s) Rs k h + Pba (zs , s) θ̂sh + Pa (zs , s) θsh ≥ 0, ∀s.       (137)

These constraints state that the value in units of good 1 at t = 0 of all ex ante securities
held (RHS) cannot exceed the value of collateral held (LHS). These constraints are applicable
when the spot markets are not available but the ex-ante asset-backed securities can be traded.


B.6      Prices of the Right to Trade

Trading in security exchanges also imposes a restriction on collateral, contract and prices
of rights to trade in security exchanges, P20 , Pa (zs , s), P∆ (zs , s). Even though collateral and
securities are indeterminate (see Lemma 10 below), holding collateral additionally impacts
the spot price p(zs ). Therefore, the equilibrium price of collateral must reflect the role of
collateral on the spot price in each security exchange.
     Again a no-arbitrage condition requires that the prices of two different bundles that result
in the same consumption allocation for an agent h must have the same prices. Using the
profit maximization condition of a broker-dealer (49) and some algebra, we can prove the
following equation must hold.
                                 S
                                 X                              S
                                                                X
                         P20 +         P∆ (zs , s) zs Rs =            Pa (zs , s) Rs .        (138)
                                 s=1                            s=1

The RHS is the price of contracts paying Rs units of good 2 in every state s. On the other
hand, the LHS is the total cost of the same return, received by buying and holding a unit
of collateral. The first term on the LHS is the price of the collateral good. The second term
on the LHS comes from the fact that holding more a unit of good 2 increases ∆ in every
state s by the amount zs Rs . In particular, an agent holding an additional unit of collateral
must pay for the marginal impact zs Rs at price P∆ (zs , s). This term prices the impact of
collateral on the market fundamental. In equilibrium, these two values must be the same.

                                                     74
Lemma 9. In a competitive equilibrium, for each set of security exchanges z = (zs )s , (138)
holds.


B.7      An Indeterminacy of Collateral Allocations

Using a similar argument to proof of Lemma 6, we show that the collateral and securities
paying in good 2 allocations are indeterminate; that is, neither k nor θs can be pinned down
(but the net-claim of good 2, Rs k + θs , will be uniquely determined). Roughly speaking,
agents are indifferent between buying contracts (θs > 0), and holding collateral (k > 0) and
selling contracts against it (θs < 0) as long as they lead to the same consumption allocation
in period 1 over state s. Note that storage technology is linear and there is no direct utility
per se from holding collateral. The formal result is summarized in the following lemma.
                                                                                                           
                                                                                     0    0 0 0 0          0h
Lemma 10. For a feasible bundle of an agent type h c0 , k, θ̂, θ, z, ∆ , any bundle c0 , k , θ̂ , θ , z , ∆
such that (i) c00 = c0 , (ii) z0 = z, (iii) θ̂0 = θ̂, and (iv) Rs k 0 + θs0 = Rs k + θs , ∀s, is also be
feasible for the agent h, and leads to the same consumption allocation as the original bundle.

Proof. The proof is similar to the one of Lemma 6.

   Condition (iv) implies that there is some indeterminacy between k and θs . In particular,
if we set k 0 = 0, then we can reach the same consumption allocation by setting the security
position to be θs0 = Rs k + θs . This implies that there is no loss of generality to assume that
all collateral is held by an unconstrained type, and the others including constrained agents
hold no collateral, k = 0, and therefore we will do so, unless stated otherwise.
   Thus a constrained agent may hold no collateral and therefore issue no directly-collateralized
securities, yet her collateral constraint is binding still. The fact that a constrained agent is
effectively not borrowing at all in equilibrium seems counterintuitive at first. In a partial
equilibrium setting when the price of collateral good is fixed exogenously, one would imagine
that the agent will try to buy more of the collateral good and then borrow against to increase
current consumption. In this general equilibrium setting where collateral price is determined
endogenously, however, the price of the collateral good rises so in effect those transactions
will offset each other and lead to a zero net transfer.


                                                  75
B.8        Trading in Security Exchanges Generates Intertemporal Trans-
           fers

Trading in security exchanges can generate additional intertemporal transfers. For example,
a constrained agent would like to smooth consumption by issuing securities or borrowing
to transfer future resources back to period 0 but cannot do so much because of the limited
commitment. Trading in security exchanges facilitates more consumption smoothing by
generating period 0 transfer for a constrained agent.
   For the sake of discussion, we will consider a case with two types of agents one of which
is constrained, and without uncertainty (i.e., S = 1). In addition, as shown in the previous
section, we assume that a constrained agent holds no collateral, k = 0. Using (25), (49), and
(136), an agent type h’s budget constraint (44) can be rewritten as
       X                                              X                    h                i
          xh (b) [c10 + P20 c20 ] ≤ eh10 + P20 eh20 +   xh (b) Pba (z1 , 1) −θ̂1 − p(z1 )θ1
          b                                             b
                                                                eh11
                                                        X                  
                                        +                   h
                                              x (b) P∆ (z1 , 1) h − z1 eh21 .
                                           b
                                                                e21
                                                                      
   The third term on the RHS is the revenue from borrowing via θ̂1 , θ1 . Using the
collateral constraint (40), p(z1 )R1 k + θ̂1 + p(z1 )θ1 ≥ 0. Since the constrained agent holds
no collateral, k = 0, her collateral constraint becomes θ̂1 + p(z1 )θ1 = 0. Of course, this
constrained agent would like to go short on the contracts (i.e., having θ̂1 + p(z1 )θ1 < 0) but
cannot do so because she holds no collateral. In other words, with zero collateral, the agent
cannot borrow from trading in contracts.
   Of special interest, the last term on the RHS shows that the constrained agent could
potentially receive positive period 0 wealth by trading in security exchanges. In particu-
lar, a constrained agent could smooth consumption intertemporally by trading in security
exchanges in such a way that this term is positive, giving her more resources to purchase
date zero consumption. For example, if P∆ (zs , s) > 0, then the constrained agent will buy
a security exchange zs whose market fundamental is lower than her own endowment, i.e.,
       eh
zs <    1s
       eh
           ,   and vice versa.
        2s

   On the other hand, an unconstrained agent will potentially hold strictly positive amount
of collateral, k > 0. She will in fact transfer out period 0 wealth from trading in security

                                                   76
                                                          eh
exchanges. For example, if a constrained agent has zs <    1s
                                                          eh
                                                              ,   then the consistency constraint
                                                           2s
                                                                                            eh
(58) implies that an unconstrained agent in security exchange zs must have zs >              1s
                                                                                         Rs k+eh
                                                                                                   .
                                                                                                2s

Hence, if P∆ (zs , s) > 0, the last term on the RHS will be negative for an unconstrained
agent.




                                            77
C      Detailed Derivations

C.1     Derivation of a Competitive Equilibrium with the Externality
        in Environment 1

The endowment profile and the first-best allocation suggest that agent 2 would like to move
resources forward from t = 1 to t = 0, and therefore will be constrained. Hence, we will
assume that agents type 2 hold no collateral, i.e. k 1 = k and k 2 = 0. We now solve for an
equilibrium k. From the market clearing conditions of contracts, we can set θ̂11 = θ̂ = −θ̂12
and θ11 = θ = −θ12 . Note that this does not mean agent 1 is demanding both securities. In
addition, using the specified collateral allocation, the market fundamental in period t = 1
              4
is now z =   4+k
                (the ratio of endowment of good 1 to the sum of endowment of good 2 and
                                                                          4
                                                                             2
saving), and consequently the spot price of good 2 in period 1 is p(z) = 4+k    .
    With homothetic preferences, the first-order conditions of the problem (7) for both types
imply that in spot markets at date t = 0
                               1 2  2 2        2
                                c10      c10     4
                       P20 =          =       =        .                                       (139)
                                c120     c220   4−k

Since agent 1’s collateral constraint is not binding, the first-order conditions of her utility-
maximization problem (7) with respect to θ11 and c110 lead to
                                              1 2
                                     u121      c10
                               P1 = 1 =               ,                                        (140)
                                     u10       c121
               ∂uh
where uhit =   ∂cit
                      is the marginal utility with respect to cit , and P1 is the price of a security
paying in good 2 in period t = 1, θ1h . Note that we put superscript h on the utility function
for clarity. Further, the first-order conditions of the consumer’s problem (7) with respect to
θ11 and k 1 (interior solutions) lead to

                                              P20 = P1 .                                       (141)

Intuitively, this is the case because their payoffs are identical and both are collateralizable.
Using (139) and (140), condition (141) implies that

                                      c110   c110
                                           =      =⇒ c120 = c121 .                             (142)
                                      c120   c121

                                                    78
That is, an unconstrained agent consumes the same amount of good 2 in both periods.
   Substituting (139) and (140) into (141) gives
                          2    1 2
                        4        c10
                              =          ;
                       4−k       c121
                          4         c110
                              =            =⇒ (4 − k) c110 = 4 + 4k + 4θ,                         (143)
                         4−k    1+k+θ

where we use c121 = 1 + k + θ.
   On the other hand, an agent type 2’s collateral constraint is binding; with k 2 = 0,
                                                                    2
               2       2                                          4
             θ̂ + p(z)θ = 0 =⇒ −θ̂ − p(z)θ = 0 =⇒ θ̂ = −                θ,              (144)
                                                               4+k
                                                                                                   4
                                                                                                      2
where the second and the last equations use θ̂2 = −θ̂ and θ2 = −θ, and p(z) =                     4+k
                                                                                                         ,
respectively.
   The budget constraint of an agent 1 (9) can be written as

                           c110 − 3 + P20 c120 + k − 3 + P̂1 θ̂ + P1 θ = 0.
                                                     
                                                                                                  (145)

A standard no-arbitrage argument (similar to the one used in Lemma 8) implies that

                                              P1 = p(z)Pb1 .                                      (146)

It thus true from (146) that
                                                          h          i
                  P̂1 θ̂ + P1 θ = Pb1 θ̂ + Pb1 p(z)θ = Pb1 θ̂ + p(z)θ p(z) = 0,                   (147)

where the last equation follows the fact that the term in the bracket is zero, from (144).
Now the LHS of the budget constraint (145) can be rewritten as

                                      c110 + P20 c120 + k − 3 = 3.
                                                            
                                                                                                  (148)

                                             4−k
                                                                                 4
                                                                                     2
Using (139), we can replace c120 by           4
                                                       c110 . Then using P20 =   4−k
                                                                                          gives
                                    2                         
                                4            4−k
                c110   +                                c110   +k−3 = 3
                               4−k            4
                                                                           3k 2 − 40k + 96
                                                   =⇒ (4 − k) c110 =                       .      (149)
                                                                                 8−k


                                                           79
   Substituting (143)into (149) gives

               3k 2 − 40k + 96                            3k 2 − 36k + 64
                               = 4 + 4θ + 4k =⇒ 4θ + 4k =                 .                          (150)
                     8−k                                        8−k

   With the identical homothetic preferences, the period t = 1 consumption allocations
must satisfy

                                 4   c1       4     1 + θ̂
                        z=          = 111 =⇒     =         .                                         (151)
                                4+k  c21     4+k   1+k+θ

Substitute (144) into (151) gives
                                                             
                                                       4+k
                                4θ + 4k = −3k                     + 4k.                              (152)
                                                       8+k

   Using (150) and (152), we have

           3k 2 − 36k + 64
                                      
                                   4+k
                           = −3k         + 4k =⇒ 4k 3 − 384k + 512 = 0.                              (153)
                 8−k               8+k

There are three roots for equation (153). Using the condition that 0 ≤ k ≤ 4, there is only
one feasible solution, i.e. k ≈ 1.3595. To sum up, the equilibrium collateral allocation is
k 1 = k = 1.3595 and k 2 = 0.


C.2     Derivation of a Competitive Equilibrium with the Externality
        in Environment 2

First of all, the price of good 2 in period t = 0 is given by
                                                    2
                                                 2
                                      P20 =                                                          (154)
                                               2−k
                                                                       2
Similarly, the market fundamental in each state s is zs =             2+k
                                                                          .   Hence, the spot price of good
2 in each state s is given by
                                                        2
                                                    2
                                    p(zs ) =                  , ∀s.                                  (155)
                                                   2+k

Further, the price of a (collateralized) security paying in good 2 in state s is given by

                                              πs uh2s
                                                     
                                 Ps = max               , ∀s.                             (156)
                                         h     uh10

                                                    80
                                                                                     πs uh
The endowment structure implies that agents type 2 will have higher MRS               uh
                                                                                         2s
                                                                                              in state 1,
                                                                                        10

and vice versa. Hence, (156) can be rewritten as
                                                 2
                          πs u221                    πs u 1
                                     
                                   1       2
                    P1 = 2 =                        = 1 22 = P2 .                                  (157)
                           u10     2 1+k+θ            u10

Note that the symmetry also implies that P1 = P2 . Using the optimal conditions with respect
to k h and θsh , we can show that
                                                    2                   2
                                                2                   2
                       P20 = P1 + P2 =⇒                   =                     .                  (158)
                                               2−k                1+k+θ

       Next, with the homotheticity of preferences, the ratio of consumption in each state of
each agent must be equal to the market fundamental; that is,

                                     1 + θ̂         2
                                            = zs =     .                                           (159)
                                    1+k+θ          2+k

       Furthermore, the collateral constraint in state s = 1 of an agent type h = 1 is binding,
i.e.
                                                                   2
                                                               2
                     p(z1 )k − θ̂ − p(z1 )θ = 0 =⇒ θ̂ =                  (k − θ) .                 (160)
                                                              2+k

Note that the same equation can be derived from the binding collateral constraint in state
s = 2 for an agent type h = 2.
      We can compute a collateral equilibrium using (158), (159), and (160) to solve for
           
    k, θ, θ̂ . We can rewrite (158) as

                              2 − k = 1 + k + θ =⇒ θ = 1 − 2k.                                     (161)

In addition, Substituting (160) into (159) gives
                                2                 
                             2                    2
                     1+             (k − θ) =          (1 + k + θ) .                               (162)
                           2+k                   2+k

Then, substituting (161) into (162) will give
                          2                          
                       2                             2
               1+             (k − 1 + 2k) =              (1 + k + 1 − 2k)
                     2+k                          2+k
                                             =⇒ 3k 2 + 16k − 8 = 0.                                (163)

The unique feasible (positive) solution to the above quadratic equation is k ≈ 0.4603.

                                                 81
C.3     Derivation of a Competitive Equilibrium with the Externality
        in Environment 3

We restrict our attention to a symmetric allocation of each type. Using Lemma , we assume
that all constrained agents hold no collateral, i.e., k h = 0 for h = 2, 3. Let k 1 = k.
   First, the first-order conditions of the consumer’s problem (7) result in
                                c110   c210   c310     12.5
                                  1
                                     =   2
                                            =  3
                                                   =          .                            (164)
                                c20    c20    c20    12.5 − k
From the endowment profile, it is clear that an agent 1 will not be constrained. The first-
order conditions of the consumer’s problem (7) with respect to θ1 and c110 lead to
                                           u121
                                                = P.                                       (165)
                                           u110
Further, the first-order conditions of the consumer’s problem (7) with respect to θ1 and k 1
(interior solutions) lead to

                                           P20 = P.                                        (166)

Combining (165), (166) and the utility function (37), gives
                                        2                   1 2
                                                     u121
                            
                                12.5                         c10
                      P20 =                 = P = 1 =              .                       (167)
                              12.5 − k               u10     c121
This implies that
           12.5     c1          c110
                  = 10                                  1                     1
                                                                                
                         =              =⇒ (12.5 − k) c 10 = 12.5 0.5 + k + θ     ,        (168)
         12.5 − k   c121   0.5 + k + θ1
where we use c121 = 0.5 + k + θ1 .
                                                                    12.5
   In addition, the market fundamental in period t = 1 is z = 12.5+k     , and consequently the
                                         12.5
                                               2
spot price of good 2 in period t = 1 is 12.5+k    . The bindingness of the collateral constraints
of agent 2 and agent 3, combining with the market-clearing conditions of securities, imply
that
                                                         2
                                     1           12.5
                                  θ̂ = −                       θ1 .                        (169)
                                               12.5 + k
   A standard no-arbitrage argument (similar to the one used in Lemma 8) implies that

                                         P1 = p(z)Pb1 ,                                    (170)

                                                  82
which can be used to show that
                                                    h            i
                  1         1       1          1       1       1
               P̂1 θ̂ + P1 θ = P1 θ̂ + P1 p(z)θ = P1 θ̂ + p(z)θ p(z) = 0,
                               b       b          b                                           (171)

where the last equation follows the bindingness of the collateral constraints of agent 2 and
agent 3, combining with the market-clearing conditions of securities. The budget constraint
of an agent 1 (9) can be written as

                                c110 − e110 + P20 c120 + k − e120 = 0.
                                                                
                                                                                              (172)

Substituting (164) and (167) into (172), we have

                                                12.52 (e120 − k) + e110 (12.5 − k)2
                      (12.5 −   k) c110       =                                     .         (173)
                                                              25 − k

Substituting (168) into (173), we have

                                          1
                                                   12.52 (e120 − k) + e110 (12.5 − k)2
                  12.5 0.5 + k + θ                =                                     .     (174)
                                                                  25 − k

   With the identical homothetic preferences, the period t = 1 consumption allocations
must satisfy

                             12.5    c1        12.5       0.5 + θ̂1
                      z=            = 11  =⇒          =              ,                        (175)
                           12.5 + k  c121    12.5 + k   0.5 + k + θ1

where the equality follows (169). This can be rewritten as
                                                                                 2    !
                                    1                                    12.5
                                                                                       θ1 .
                                      
               12.5 0.5 + k + θ           = (12.5 + k) 0.5 −                                  (176)
                                                                       12.5 + k

   Solving (174) and (176) for k and θ1 , with e110 = 4.2631 and e120 = 11.5, gives one feasible
solution (0 ≤ k ≤ 12.5) k = 7.2836, θ1 = −4.2849. To sum up, the competitive collateral
equilibrium allocation is k 1 = k = 7.2836, and k 2 = k 3 = 0.


C.4     Computing Competitive Equilibrium with Segregated Secu-
        rity Exchanges

All numerical solutions for competitive equilibrium with segregated security exchanges in
section 4 are computed using the following programming problem:

                                                         83
Program 3.
                                                                               (                                                     )
               X                  X                                                           X                                 
                    h    h                        h                                h     h              h           h
                                                                                           
  max              λ α                        x           c0 , k, θ̂, θ, z, ∆   u c10 , c20 + β   πs u e1s + θ̂s , e2s + Rs k + θs
(xh ∈Xe h )h   h             c0 ,k,θ̂,θ,z,∆                                                           s

subject to
                                          X               X                                  
                                                                     αh xh c0 , k, θ̂, θ, z, ∆ = 1,
                                           h      c0 ,k,θ̂,θ,z,∆
                                    X             X                                                  X
                                                                   h h
                                                               α x           c0 , k, θ̂, θ, z, ∆ c10 ≤   αh eh10 ,
                                      h   c0 ,k,θ̂,θ,z,∆                                                  h
                         X            X                                                          X
                                                      α h xh       c0 , k, θ̂, θ, z, ∆ [c20 + k] ≤   αh eh20 ,
                             h    c0 ,k,θ̂,θ,z,∆                                                          h
                        X             X                                                
                                                       αh xh c0 , k, θ̂, θ, z−s , zs , ∆ θ̂s = 0 , ∀s; zs ,
                          h      c0 ,k,θ̂,θ,z−s ,∆
                        X             X                                                
                                                       αh xh c0 , k, θ̂, θ, z−s , zs , ∆ θs = 0 , ∀s; zs ,
                          h      c0 ,k,θ̂,θ,z−s ,∆


where X e h is the restricted consumption possibility set for an agent type h in which we allow
                                                   
a positive mass only on a bundle c0 , k, θ̂, θ, z, ∆ that satisfies a market fundamental ratio
                            eh
                             1s +θ̂s
condition: zs =          eh
                                      .        This in turn puts restrictions on grids of securities θ̂s and θs for
                          2s +Rs k+θs

each security exchange.

     Pareto program 3 and the Pareto program 2 are equivalent but the former is more com-
putationally tractable. The restrictions on grids of securities do not affect the results because
each agent type must optimally choose securities (from a complete set of securities) in such
                                                                                                                   eh
                                                                                                                    1s +θ̂s
a way that his consumption ratio equals to the market fundamental zs =                                          eh  +R s k+θs
                                                                                                                              .   These
                                                                                                                 2s

restrictions imply that the consistency constraints (64) are redundant.
  We can then recover all prices including Pba (zs , s) , Pa (zs , s) , P∆ (zs , s) from the Lagrange
multipliers of the securities Pba (zs , s) and Pea (zs , s) (normalized by the Lagrange multiplier
                               e

of c10 ) from Pareto program 3 as follows. First, the no-arbitrage condition (136) applies
here:

                                                          Pa (zs , s) = p (zs ) Pba (zs , s) .                                    (177)

Second, the equivalence between Pareto program 3 and the Pareto program 2, and the
second welfare theorem implies that equilibrium prices Pba (zs , s) , Pa (zs , s) , P∆ (zs , s) and the

                                                                                84
Lagrange multipliers of the securities paying in good 1 and good 2, respectively, Pba (zs , s)
                                                                                   e

and Pea (zs , s) from Pareto program 3 must satisfy the following relationships:

                           Pba (zs , s) = Pba (zs , s) + P∆ (zs , s) ,                  (178)
                            e

                            Pea (zs , s) = Pa (zs , s) − zs P∆ (zs , s) .               (179)

Solving the last three equations simultaneously give equilibrium prices as follows:

                                       zs Pba (zs , s) + Pea (zs , s)
                                           e
                        Pba (zs , s) =                                ,                 (180)
                                                zs + p (zs )
                                               zs Pba (zs , s) + Pea (zs , s)
                                                   e
                        Pa (zs , s) = p (zs )                                 ,         (181)
                                                       zs + p (zs )
                                       p (zs ) Pba (zs , s) − Pea (zs , s)
                                                e
                        P∆ (zs , s) =                                      .            (182)
                                                   zs + p (zs )

C.5     Competitive Equilibrium with Segregated Security Exchanges
        with Three Agent Types but Two Constrained Types are Al-
        most Identical

This environment is similar to Environment 3. The key difference is in the endowments in
period t = 1 for agent types h = 2, 3. The endowment profile is given in Table 10 below.
Note that type 2 and type 3 are almost identical. As in Environment 3, we assume that the
Pareto weights are λ1 = 0.8, λ2 = λ3 = 0.1.

                        Table 10: Endowment profiles of the agents.
                         Type of Agents             eh10    eh20   eh11   eh21
                         h=1                     11.56     11.5    0.5    0.5
                         h=2                       0.37     0.5    7.0    5.0
                         h=3                       0.58     0.5    6.9    5.0


   They key point is that the competitive equilibrium with segregated security exchanges
still has two active exchanges as in Environment 3. Of course, the active exchanges are closer
to each other than the ones in Environment 3. It is worthy of emphasis that the number of


                                                  85
active exchanges in equilibrium equals to the number of constrained types again. See also
Appendix C.6 below for a similar result with four agent types, three of which are constrained.

Table 11: Equilibrium allocation of (non-zero-mass) lotteries. There are two active security
exchanges; z = 0.8883 and z = 0.8913.
                                     h=1                   h=2            h=3
                      k          5.6933   5.6735                   0             0
                      τ̂         2.3528   2.3575           -1.1987        -1.1565
                      τ         -2.9817   -2.9676          1.5089         1.4657
                      c10        7.3228   7.3228           2.5886         2.5886
                      c20        3.9939   3.9939           1.4114         1.4114
                      c11        2.8528   2.8528           5.8013         5.7435
                      c21        3.2116   3.2060           6.5089         6.4657
                      z         0.8883    0.8913           0.8913         0.8883
                      ∆          5.0015   5.0025           -2.5435        -2.4685
                      xh         0.4916   0.5084           1.0000         1.0000




C.6     Competitive Equilibrium with Segregated Security Exchanges
        with Four Agent Types and Three Constrained Types

The endowment profile is given in Table 12 below. There are four agent types of equal mass.
This example is constructed in such a way that agent types h = 2, 3, 4 are constrained in
equilibrium. We assume that the Pareto weights are λ1 = 0.5, λ2 = 0.2, λ3 = 0.1, λ4 = 0.2.

                           Table 12: Endowment profiles of the agents.
                            Type of Agents          eh10    eh20   eh11   eh21
                            h=1                2.06        11.5    0.5    0.5
                            h=2                1.94         0.5    6.0    4.0
                            h=3                3.52         0.5    4.0    5.0
                            h=4                4.98         1.0    2.0    3.0


                                               86
   They key point is that the number of active exchanges in equilibrium equals to the
number of constrained types again. Specifically, with four agent types, three of which are
constrained, there are three active exchanges in equilibrium.

Table 13: Equilibrium allocation of (non-zero-mass) lotteries. There are three active security
exchanges; z = 0.6034, z = 0.6719, and z = 0.8710.
                             h=1                   h=2          h=3         h=4
           k       5.8556    5.1771    3.9264            0           0           0
           τ̂      1.2550    1.3320    1.5620     -1.1713       -0.2574    -0.0714
           τ      -3.4470   -2.9505   -2.0590      1.5439       0.5702      0.1962
           c10     4.6096    4.6096    4.6096      2.9144       2.0616      2.9144
           c20     3.0344    3.0344    3.0344      1.9174       1.3529      1.9174
           c11     1.7550    1.8320    2.0620      4.8287       3.7426      1.9286
           c21     2.9086    2.7266    2.3674      5.5439       5.5702      3.1962
           z      0.6034    0.6719    0.8710      0.8710        0.6719     0.6034
           ∆       3.3350    3.3145    3.3554     -2.5160       -0.6405    -0.1898
           xh      0.0569    0.1932    0.7498      1.0000       1.0000      1.0000




                                             87
