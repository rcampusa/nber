                              NBER WORKING PAPER SERIES




                  SUPPLY AND SHORTING IN SPECULATIVE MARKETS

                                          Marcel Nutz
                                      José A. Scheinkman

                                      Working Paper 23751
                              http://www.nber.org/papers/w23751


                     NATIONAL BUREAU OF ECONOMIC RESEARCH
                              1050 Massachusetts Avenue
                                Cambridge, MA 02138
                                    August 2017




We are indebted to Pete Kyle and Xunyu Zhou for fruitful discussions. Marcel Nutz research was
supported by an Alfred P. Sloan Fellowship and NSF Grant DMS-1512900. The views expressed
herein are those of the authors and do not necessarily reflect the views of the National Bureau of
Economic Research.

NBER working papers are circulated for discussion and comment purposes. They have not been
peer-reviewed or been subject to the review by the NBER Board of Directors that accompanies
official NBER publications.

© 2017 by Marcel Nutz and José A. Scheinkman. All rights reserved. Short sections of text, not
to exceed two paragraphs, may be quoted without explicit permission provided that full credit,
including © notice, is given to the source.
Supply and Shorting in Speculative Markets
Marcel Nutz and José A. Scheinkman
NBER Working Paper No. 23751
August 2017
JEL No. G12,G4

                                          ABSTRACT

We propose a continuous-time model of trading among risk-neutral agents with heterogeneous
beliefs. Agents face quadratic costs-of-carry on their positions and as a consequence, their
marginal valuation of the asset decreases when the magnitude of their position increases, as it
would be the case for risk-averse agents. In the equilibrium models of investors with
heterogeneous beliefs that followed the original work by Harrison and Kreps, investors are risk-
neutral, short-selling is prohibited and agents face a constant marginal cost of carrying positions.
The resulting resale option guarantees that the equilibrium price exceeds the price of the asset
in a static buy-and-hold model where speculation is ruled out. Our model features three main
novelties. First, increasing marginal costs entail that the price depends on the exogenous supply.
Second, in addition to the resale option, agents may also value an option to delay, and this may
cause the market to equilibrate below the static buy-and-hold price. Third, we introduce the
possibility of short-selling; then the resale option for agents with short positions partly
compensates the resale option for long agents. We characterize the unique equilibrium of our
model through a Hamilton--Jacobi--Bellman equation of a novel form and use it to derive several
comparative statics results.


Marcel Nutz
Columbia University
1255 Amsterdam Ave
New York, NY 10027
mnutz@stat.columbia.edu

José A. Scheinkman
Department of Economics
Columbia University
New York, NY 10027
and NBER
js3317@columbia.edu
        Supply and Shorting in Speculative Markets∗
                    Marcel Nutz†            José A. Scheinkman‡

                                  August 18, 2017


                                       Abstract
            We propose a continuous-time model of trading among risk-neutral
        agents with heterogeneous beliefs. Agents face quadratic costs-of-carry
        on their positions and as a consequence, their marginal valuation of the
        asset decreases when the magnitude of their position increases, as it
        would be the case for risk-averse agents. In the equilibrium models of
        investors with heterogeneous beliefs that followed the original work by
        Harrison and Kreps, investors are risk-neutral, short-selling is prohib-
        ited and agents face a constant marginal cost of carrying positions. The
        resulting resale option guarantees that the equilibrium price exceeds
        the price of the asset in a static buy-and-hold model where speculation
        is ruled out. Our model features three main novelties. First, increasing
        marginal costs entail that the price depends on the exogenous supply.
        Second, in addition to the resale option, agents may also value an op-
        tion to delay, and this may cause the market to equilibrate below the
        static buy-and-hold price. Third, we introduce the possibility of short-
        selling; then the resale option for agents with short positions partly
        compensates the resale option for long agents. We characterize the
        unique equilibrium of our model through a Hamilton–Jacobi–Bellman
        equation of a novel form and use it to derive several comparative statics
        results.


1       Introduction
As Kindleberger and Aliber (2005) elaborate, many classical economists ar-
gued that the purchase of securities for re-sale rather than for investment
income was the engine that generated numerous historical asset price bub-
bles. To explain such speculation in a dynamic equilibrium model, Harrison
and Kreps (1978) study risk-neutral agents with fluctuating heterogeneous
    ∗
    We are indebted to Pete Kyle and Xunyu Zhou for fruitful discussions.
    †
    Columbia University. Research supported by an Alfred P. Sloan Fellowship and NSF
Grant DMS-1512900.
  ‡
    Columbia University, Princeton University and NBER.


                                           1
beliefs. In their model, long positions can be financed at a constant interest
rate and short-selling is ruled out. The buyer of an asset thus acquires both
a stream of future dividends and an option to resell which in combination
with fluctuating beliefs guarantees that speculators are willing to pay more
for an asset than they would pay if they were forced to hold the asset to
maturity; that is, risk-neutral investors would pay to be allowed to specu-
late. Scheinkman and Xiong (2003) added trading costs and showed that
these models generate a correlation between trading volume and overpric-
ing,1 a characteristic of several of the major bubble episodes in the last three
centuries.2
    Another stylized fact is that bubble implosions often follow increases in
supply. For instance, the implosion of the dotcom bubble was preceded by
a vast increase in the float of internet shares.3 The South Sea bubble lasted
less than one year, but in that period the amount of outstanding shares of the
South Sea Company more than doubled, and many other joint-stock com-
panies were established.4 However, the assumption of risk-neutral investors
facing constant marginal costs in the earlier literature on disagreement and
bubbles implies that supply is irrelevant for pricing.5 Hong et al. (2006)
analyzed a two-period model with risk-averse investors where unexpected in-
creases in supply could deflate bubbles. The economics is straightforward—
when agents are risk-averse, their marginal valuation for a risky asset de-
creases with the amount they hold.
    Short-selling an asset can be seen as a source of additional supply. The
collapse of prices for mortgage backed securities in 2007 was preceded by
a series of financial innovations that facilitated shorting: the creation of
a standardized CDS for MBS in 2005, the introduction of traded indexes
for subprime mortgage backed credit derivatives in 2006, and finally the
invention of the synthetic CDO that allowed Wall Street to satisfy the global
demand for US AAA mortgage bonds without going through the relatively
   1
     See also Berestycki et al. (2016).
   2
     See e.g. Carlos et al. (2006) on the South Sea bubble, Hong and Stein (2007) on
the Roaring Twenties, Ofek and Richardson (2003) and Cochrane (2002) on the internet
bubble, Xiong and Yu (2011) on the Chinese warrant bubble.
   3
     See Ofek and Richardson (2003).
   4
     The directors of the SSC understood that the bubble companies competed with the
SSC’s conversion scheme and could deflate its own bubble. Harris (1994) documents that
the Bubble Act of 1720, which banned joint-stock companies except if authorized by Royal
Charter, was produced at the behest of the company to limit the competition for capital.
   5
     Except for the assumption of positive net supply, issues concerning supply of the asset
subject to bubbles are also ignored in the rational bubbles literature (Santos and Woodford
(1997)).



                                             2
slow process of building new housing.6 These innovations allowed pessimists
to profit from the excessive optimism prevailing among many investors.
    We propose a model with a population of investors trading a single asset
and aiming to maximize expected cumulative net gains from trade. These in-
vestors are risk-neutral and have fluctuating heterogeneous beliefs, including
possibly beliefs about future changes in supply. In contrast to the previous
literature, shorting is allowed, albeit at a higher cost when compared to go-
ing long: holders of short or long positions pay costs which are proportional
to the square of their positions.7 The two constants of proportionality may
be different; the assumptions in the earlier literature correspond to an infi-
nite cost for short positions and zero cost for long positions. The quadratic
holding costs reflect monetary costs of holding a long position or borrowing
stocks to establish a short position but could also stand in for risks that
we do not explicitly model, such as market-wide liquidity shocks that would
force agents to liquidate their positions at unfavorable prices. Since costs are
quadratic, an agent’s marginal valuation of the asset will decrease as their
position increases, as it would be the case for risk-averse agents. Thus we
view our setup as a tractable alternative to a much more difficult-to-analyze
model with risk aversion, with many of the same forces present. In par-
ticular, we will show that the supply of the asset does affect prices in our
model.
    A buyer of the asset today may forecast that at some future date she
would be able to sell the asset at a price that would exceed her own valuation
of the asset at that date. Because of this resale option, she may be willing to
pay more than what she believes is the discounted value of the payoff of an
asset. In the classical models, this option causes equilibrium prices to exceed
the price that would prevail if re-trading is ruled out—we call the latter the
static price for brevity. In addition, there is also an option to delay which
has not been highlighted in the earlier literature. A speculator that buys y
units today may plan to buy additional units of the asset in future states of
the world where there would be a larger difference between the asset price
and her marginal valuation for the asset if she holds y units. However, if the
cost of holding a long position is zero, this delay option has no impact in
equilibrium. The intuition is that, since agents are risk-neutral and there is
no cost-of-carry, a buyer of the asset must be indifferent as to the amount of
the asset she buys. Hence, the delay option has no value, and in particular,
   6
      See Scheinkman (2014) for a summary or Lewis (2015) for an excellent detailed ac-
count.
    7
      For tractability, we assume that costs are a function of the size rather than the value
of the position.


                                             3
the dynamic equilibrium price cannot be smaller than the static price.8 In
Example 4.6, we show that in the presence of a positive cost, the option
to delay may outweigh the resale option and cause the dynamic price to be
lower than the static one, even when shorting is prohibited.
    When shorting is allowed, the short party also has the corresponding
options. An agent that acquires a short position today may forecast that at
some future date he would be able to repurchase the asset at a price that
would be below his own valuation of the asset at that date. This option to
resell a short position, that is the option to cover shorts, in turn, decreases
the minimum amount pessimists would be willing to receive for shorting the
asset, putting downward pressure on prices. The short party also enjoys an
option to delay. In Example 4.9, we show that when the cost of holding a
short position is close to the cost of holding a long position, the equilibrium
price may be less than the static price. We argue that this happens because
the long party values the resale option less than the short party values the
repurchase option. This example also illustrates that an unexpected lowering
of the cost of shorting can lead to a collapse of an asset price bubble.

1.1    Overview
In Section 2 we describe in detail a continuous-time model where n types of
agents trade a single asset. The agents disagree on the future evolution of a
Markov state whose time T value determines the asset’s payoff. In equilib-
rium, they find a price process for the asset, given by a function of time and
Markov state. Types that expect prices to increase on average over the next
instant choose to go long, where the amount they go long depends on their ex-
pected price changes and the cost of carrying long positions. The other types
choose to go short, by amounts that depend on their expected price changes
and the cost of carrying short positions. Equilibrium requires that the longs
absorb the shorts plus an exogenous supply. Theorem 2.1 shows that there
is a unique equilibrium price function and that it can be characterized by
a partial differential equation (PDE). This equation is of Hamilton–Jacobi–
Bellman-type with a novel form where the optimization runs over the ways
to divide the agents into two groups at any time and state; at the optimum,
these are the optimists (holding long positions in equilibrium) and the pes-
simists (holding shorts). The price can also be seen as the value function of
a stochastic optimal control problem (Proposition 2.3) where the controller
chooses among a set of laws of motion; this is useful for the derivation of
   8
    This delay option is surely valuable in the “complete markets” model with difference
in beliefs analyzed by Dumas et al. (2009), but it is not examined there.


                                           4
our subsequent results. An economic interpretation of the PDE is given by
the solution to a problem of a planner with limited instruments who tries to
maximize the initial price (Theorem 2.4). In either problem, a noteworthy
feature is that the supply enters mathematically as a running cost (i.e., like
intermediate consumption in Merton’s problem).
    In Section 3 we provide several comparative statics and limiting results.
In particular, we show that an increase in supply decreases the equilibrium
price and that a decrease (increase) in the cost for long (short) positions
increases the price. We also establish that as the cost for long positions
converges to zero, the equilibrium price function converges to a function
that does not depend on the cost of holding a short position or the amount
supplied. Thus, the crucial assumption in the earlier literature is not that
shorting is impossible, but that the marginal cost of carrying long positions
is constant. On the other hand, as the cost of shorting becomes prohibitive,
the equilibrium price converges to a function that does depend on the cost
of carrying long positions as well as the exogenous supply of the asset.
    In Section 4 we discuss the impact of speculation in our model. To that
end, we first characterize the static equilibrium price; that is, the price that
prevails when re-trading is not allowed and agents are forced to use buy-and-
hold strategies. Then we compare this static price with the dynamic one
(where re-trading is possible) and in particular we provide examples that
illustrate the effect of the resale and delay options, both when shorting is
ruled out and when shorting is allowed. The difference between the dynamic
price and the static price has been identified as the size of the bubble in
the previous literature. With this identification, the examples in this section
can be used to illustrate that, in the presence of increasing marginal costs-
of-carry, lowering the cost for shorts or increasing the cost for long positions
can lead not only to a bubble implosion but even to a negative bubble.
    The concluding remarks are stated in Section 5 and the proofs for our
results in Sections 2–4 are reported in Appendix A.
    The assumption that costs are proportional to the square of the posi-
tion does not accommodate the fact that borrowers of stock typically pay a
fee quoted as an annualized percentage of the value of the loaned securities
(the rebate rate). This assumption is made to simplify the exposition and
allow us to concentrate on the effects of the size of a position on an agent’s
marginal valuation. In Appendix B we discuss how our results can be gener-
alized if an additional linear term is added to the costs-of-carry. The agents
are then divided into three rather than two groups: while strongly optimistic
and pessimistic agents hold long and short positions, respectively, an inter-
mediate group expects that prices will not move enough to compensate for

                                       5
the first-order costs and stays out. However, the qualitative properties of
equilibria remain the same as without the linear term, so we have chosen
to use the simpler model in the body of the paper. We also examine in
Appendix C how the model changes if costs of going long and/or short vary
across agents. While the structure of the equilibrium remains similar, ceteris
paribus, agents with lower costs take larger positions and have a larger influ-
ence on the coefficients of the PDE that determines the equilibrium price.


2       Equilibrium Price
In this section, we detail our formal setup and show that it leads to a unique
equilibrium. The corresponding price is described by a partial differential
equation which, in turn, leads us to a stochastic control problem. Finally,
an economic interpretation for the latter is provided through a planning
problem.

2.1     Definition of the Equilibrium Price
We consider n ≥ 1 types, each with a unit measure of agents, who trade a
security over a finite time interval [0, T ]. For brevity, we will often refer to a
type as an agent. The security has a single payoff f (X(T )) at the horizon,
where f : Rd → R is a bounded continuous function and X is the state
process. While there is no ambiguity about f , the agents agree to disagree
on the evolution of the state process. Mathematically, we take X to be the
coordinate-mapping process on the space Ω = C([0, T ], Rd ) of continuous,
d-dimensional paths, equipped with the canonical filtration and sigma-field.
The view of agent i is represented by a probability measure Qi on Ω under
which X follows the stochastic differential equation (SDE)

           dX(t) = bi (t, X(t)) dt + σi (t, X(t)) dWi (t),     X(0) = x,         (2.1)

where Wi is a Brownian motion of dimension d0 and the functions
                                                                      0
                bi : [0, T ] × Rd → Rd ,   σi : [0, T ] × Rd → Rd×d

are deterministic. We assume9 throughout that (the components of) bi and
σi are in Cb1,2 , the set of all bounded continuous functions g : [0, T ] ×
    9
   These conditions could be relaxed considerably. The present form allows for a simple
exposition avoiding issues of technical nature.




                                           6
Rd → R whose partial derivatives ∂t g, ∂xi g, ∂xi xj g exist and are continu-
ous and bounded on [0, T ) × Rd . Moreover, we assume that10 σi2 is uni-
formly parabolic; that is, its eigenvalues are uniformly bounded away from
zero. These conditions imply in particular that the SDE (2.1) has a unique
(strong) solution.
    Notice that we allow for the differences in beliefs to affect both drift
and diffusion coefficients. While much of the literature on disagreement in
asset markets deals with constant volatility processes and thus naturally
assumes that disagreement concerns only drifts, there is plenty of evidence
that more complex processes involving stochastic and time-varying volatility
are necessary to understand empirical features of asset prices. In this context,
it is quite plausible that agents may also differ in their forecasts for the
volatility.
    Agents trade the security throughout the interval [0, T ], at a time t price
P (t) to be determined in equilibrium. The agents are subject to an instan-
taneous cost-of-carry c which is different for long and short positions,
                                   (
                                      1   2
                                     2α+ y , y ≥ 0,
                           c(y) =     1   2
                                                                           (2.2)
                                     2α− y , y < 0.

Here the (inverse) cost coefficients α± are given constants satisfying

                                        0 < α− ≤ α+ ,

meaning that the cost of shorting is higher than the cost of going long. An
admissible portfolio Φ for an agent is a bounded11 , progressively measurable
process, and we write A for the collection of all these portfolios. The value
Φ(t) indicates the number of units of the security held by the agent at time t,
and this number can be negative in the case of a short position. Given a
(semimartingale) price process P , agent i seeks to maximize the expected
net payoff12          Z         T        Z             T
                       Ei            Φ(t) dP (t) −           c(Φ(t)) dt ;            (2.3)
                             0                       0
here the first integral represents the profit-and-loss from trading and the
second integral is the cumulative cost-of-carry incurred. Criterion (2.3) can
  10
     Given a matrix A, we write A2 for the product AA> of A with its transpose A> .
  11
     Boundedness could be replaced by suitable integrability conditions without altering
our results.
  12
     To ensure that the expectation is well-defined a priori, we set Ei [Y ] := −∞ whenever
Ei [min{0, Y }] = −∞, for any random variable Y . For the processes P that occur in our
results below, (2.3) will be finite for any Φ ∈ A.


                                               7
be rationalized by assuming that agents have access to borrowing and lend-
ing at a zero interest rate and that the cost function c is measured in the
unit of account but it can also be taken as a primitive utility function.13
An admissible portfolio Φi will be called optimal for agents of type i if it
maximizes (2.3) over all Φ ∈ A. We will examine symmetric equilibria in
which agents of the same type choose the same portfolio.
    As the final input of our model, we introduce a nonnegative, progressively
measurable process S representing exogenous supply. The latter is owned
by third parties that supply their endowment inelastically.14 We assume
that S(t) = s(t, X(t)) for a deterministic and nonnegative supply function
s ∈ Cb1,2 .15 Let P be a continuous, progressively measurable process which
is a semimartingale with P (T ) = f (X(T )) a.s. under all Qi . We say that P
is an equilibrium price if there exist admissible portfolios Φi , i ∈ {1, . . . , n}
such that Φi is optimal for agent i and the market clearing condition
                                    n
                                    X
                                          Φi (t) = S(t)
                                    i=1

holds. We are interested in Markovian equilibria; that is, equilibrium prices
of the form P (t) = v(t, X(t)) for a deterministic function v which we refer
to as an equilibrium price function.

2.2    Existence and PDE for the Equilibrium Price
The following notation will be useful to state our first result. Given v ∈ Cb1,2 ,
we define the function Li v by
                                                          1
             Li v(t, x) = ∂t v(t, x) + bi ∂x v(t, x) +      Tr σi2 ∂xx v(t, x).
                                                          2
Here ∂x v denotes the gradient vector, ∂xx v the Hessian matrix, and Tr σi2 ∂xx v
is the trace of the matrix σi2 ∂xx v; that is, the sum of the entries on the
diagonal. Finally, for a subset I ⊆ {1, . . . , n}, we denote by I c = {1, . . . , n}\I
the complement and by |I| the number of elements in I.
    Before stating the characterization of equilibria it is worthwhile to ex-
amine the homogeneous case where all agents have the same views, rep-
resented by coefficients bi = b and σi = σ. Thus, Li v(t, x) = Lv(t, x)
  13
     By adding notation we could accommodate a constant non-zero interest rate or dis-
count rate.
  14
     Since the utility function in (2.3) is separable, the equilibrium price is invariant to
endowments. Hence, we could have alternatively assumed an arbitrary ownership structure
for the endowment across the types of investors—we opted for the simpler presentation.
  15
     Notice that this formalism allows for the payoff f (X(T )) to depend on S(T ).


                                             8
is also independent of i. The quadratic costs imply that the optimal po-
sitions are unique and identical across agents; in particular, there is no
short-selling in equilibrium. Positions are determined by the first-order
condition Φi (t) = α+ Lv(t, X(t)) and thus market clearing requires that
α+ Lv(t, X(t)) = S(t)/n or

                                                   1                            s(t, x)
         ∂t v(t, x) + b(t, x)∂x v(t, x) +            Tr σ 2 (t, x)∂xx v(t, x) −         = 0.
                                                   2                             nα+

Notice that supply enters as a running cost: the equilibrium price must
compensate for the cost-of-carry.
   The following theorem characterizes equilibria in the general case of het-
erogeneous agents. In contrast to the above, the PDE becomes nonlinear
and depends on the cost of shorting.

Theorem 2.1. (i) There exists a unique equilibrium price function v ∈
Cb1,2 . The corresponding optimal portfolios are unique16 and given by Φi (t) =
φi (t, X(t)), where

                               φi (t, x) = αsign(Li v(t,x)) Li v(t, x).                                (2.4)

    (ii) The function v ∈ Cb1,2 can be characterized as the unique solution of
the PDE
                                                                                  
∂t v(t, x) + sup      µI (t, x)∂x v(t, x) + 21 Tr Σ2I (t, x)∂xx v(t, x) − κI (t, x) = 0
               I⊆{1,...,n}
                                                                                 (2.5)
on [0, T ) × Rd with terminal condition v(T, x) = f (x), where the supremum
is taken over all subsets I ⊆ {1, . . . , n} and the coefficients are defined as

       µI (t, x) = |I|α−α+|I                            α+
                                    X                               X
                          −
                             c |α
                                  +
                                      bi (t, x) + |I|α − +|I c |α
                                                                  +
                                                                      bi (t, x), (2.6)
                                          i∈I                                    i∈I c

                             α−                                     α+
                                          X                                      X
         Σ2I (t, x) =   |I|α− +|I c |α+         σi2 (t, x) +   |I|α− +|I c |α+           σi2 (t, x),   (2.7)
                                          i∈I                                    i∈I c

                                                        s(t, x)
                                   κI (t, x) =                       .                                 (2.8)
                                                    |I|α− + |I c |α+
   For the sake of brevity, we will often suppress the arguments (t, x) in our
notation for the statements below. To explain the formulas (2.6) and (2.7)
  16
       Uniqueness is understood up to (Qi × dt)-nullsets.



                                                      9
for µI and ΣI , let I ⊆ {1, . . . , n}; we think of I and I c as two groups of
agents. We may first form the average volatilities within each set,
                          1 X 2                    1 X 2
                   σI2 =           σi ,    σ̄I2c = c    σ ,
                         |I|                      |I | c i
                                 i∈I                               i∈I

and then take a weighted average between these two to obtain
                                  |I|α−                    |I c |α+
                      Σ2I =                    2
                              |I|α− +|I c |α+ σI   +                    2
                                                       |I|α− +|I c |α+ σI c ,

where the weights contain the cost coefficients α± that each type is subject
to—their interpretation will be discussed in more detail in Theorem 2.4 be-
low. The coefficients µI are formed from the initial drifts bi in the same
fashion. The running cost κI of (2.8) depends linearly on the exogenous
supply s which is divided by a weighted sum of the cost coefficients, the
weights being the size of set I and its complement I c , respectively. Since
α− ≤ α+ , the cost increases with the number |I| of types in the group I.
Remark 2.2. The equilibrium price v(t, x) is 0-homogeneous in (α− , α+ , s),
indicating that supply and costs are closely linked in our model. That is, if
these parameters are replaced by (λα− , λα+ , λs) for some λ > 0, the price
does not change. This follows from Theorem 2.1 (ii) after observing that
the coefficients µI , ΣI and κI are invariant under this substitution. For
instance, increasing the supply by a factor λ has the same effect on the
price as increasing both costs-of-carry by the same factor: (α− , α+ , λs) and
(λ−1 α− , λ−1 α+ , s) produce the same equilibrium price.
    In the special case s = 0, the homogeneity entails that the price de-
pends on (α− , α+ ) only through the ratio α+ /α− ; in fact, we will show in
Proposition 3.2 below that the price is increasing with respect to α+ /α− .

2.3    Optimal Control Representation
The PDE (2.5) is the Hamilton–Jacobi–Bellman equation of a stochastic op-
timal control problem where the controller can choose a subset I ⊆ {1, . . . , n}
at any time and state, and that choice determines the instantaneous drift
and volatility coefficients µI and ΣI as well as the running cost κI .
    To formulate this problem precisely, consider a filtered probability space
carrying a d0 -dimensional Brownian motion W and let Θ be the collection
of all progressively measurable processes I with values in the family of all
subsets of {1, . . . , n}.17 For each I ∈ Θ, let XIt,x (r), r ∈ [t, T ] be the solution
  17
     While this collection of control processes appears somewhat non-standard, there is no
difficulty involved in defining it—this family of subsets is simply a discrete set with 2n
elements; it can be identified with {0, 1}n .


                                             10
of the controlled SDE

      dX(r) = µI(r) (r, X(r)) dr + ΣI(r) (r, X(r)) dW (r),         X(t) = x     (2.9)

on the time interval [t, T ]. It follows from the assumptions on the coefficients
bi , σi that this SDE with random coefficients has a unique strong solution.
Therefore, we may consider the control problem
                                           Z T                      
                                  t,x                      t,x
          V (t, x) = sup E f (XI (T )) −        κI(r) (r, XI (r)) dr       (2.10)
                   I∈Θ                         0

for (t, x) ∈ [0, T ] × Rd , which gives rise to a second characterization for the
equilibrium price function v.
Proposition 2.3. The equilibrium price function v from Theorem 2.1 co-
incides with the value function V of (2.10). Moreover, an optimal control
for (2.10) is given by I∗ (t) = I∗ (t, X(t)), where

                   I∗ (t, x) = {i ∈ {1, . . . , n} : Li v(t, x) < 0}.          (2.11)

    Proposition 2.3 shows the equivalence between the equilibrium price v
and the solution to an abstract control problem where the controller chooses
at each instant one among 2n possible laws of motion and associated cost
functions. This will be mathematically useful later on but has no direct eco-
nomic interpretation. Next, we introduce a planner with limited instruments,
or a principal–agent problem, to provide this interpretation.

2.4    A Planner with Limited Instruments
In this section, we characterize the equilibrium price function as the optimal
value for a planner with limited instruments. We take the stochastic control
representation (2.10) as our starting point and first remark that the value of
V (t, x) does not change if we replace Θ by the set of all feedback controls;
that is, controls of the form I(r) = I(r, X(r)) for some deterministic (and
measurable) function I. This follows, for instance, from the fact that the
optimal control in Proposition 2.3 is of this form.
    Consider a planner who can choose to tax or subsidize specific types at
each date and event. More specifically the planner assigns to each type at
each date event pair, a “total cost coefficient” αi ∈ {α− , α+ }. If an agent of
a type that is assigned α+ decides to go short y units, she will be subsidized
so that her effective cost is 2α1+ y 2 . If an agent of a type that is assigned α−
decides to go long y units, she will be taxed so that her effective cost is 2α1− y 2 .

                                          11
That is, types are taxed or subsidized so that their cost is not affected by
the sign of their chosen position in the asset. Otherwise every agent is free
to choose a position at each date event pair taking prices as given and the
market settles on prices that equilibrate supply and demand for the asset.
Aggregate taxes collected by the planner are returned lump-sum to agents.
We postulate that the planner’s objective is to maximize the initial price,
perhaps because she wants to maximize the welfare of the time-zero sellers
who inelastically supply their holdings.
    Since taxes are returned lump-sum, given the costs and tax-subsidy
scheme faced by agents at each (t, x) their objective is to maximize the
expected (net of lump-sum transfers) payoff
                    Z T               Z T                       
                 Ei      Φ(t) dP (t) −     ci (t, X(t), Φ(t)) dt
                       0                   0

which is similar to (2.3), except that now the cost-of-carry is given by the
assigned coefficient,
                            ci (t, x, y) = αi (t, x)y 2 ,
irrespectively of the position being long or short. We may then again look
for an equilibrium price P (t) = v(t, X(t)) with P (T ) = f (X(T )) a.s. under
all Qi and corresponding optimal portfolios Φi that clear the market. Of
course, all these quantities depend on the assignment made by the planner,
which we summarize as a mapping

                   I(t, x) = {i ∈ {1, . . . , n} : αi (t, x) = α− }.

That is, I designates the group of agents with effective cost coefficient α− ,
and correspondingly agents in I c have α+ . The following result establishes
the connection with the control problem (2.10) if the assignment I is seen
as a control I(t) = I(t, X(t)) in feedback form.
Theorem 2.4. (i) For any assignment I(t) = I(t, X(t)) of the planner,
there exists a unique equilibrium price process PI (t) = vI (t, X(t)) with vI ∈
Cb1,2 , and vI is given by
                                     Z T                     
                            t,x                      t,x
          vI (t, x) = E f (XI (T )) −     κI(r) (r, XI (r)) dr .          (2.12)
                                           0

    (ii) If the planner’s aim is to maximize the price PI (0) = vI (0, x), then
the assignment (2.11) is optimal and V (0, x) of (2.10) is the optimal price.18
  18
    The analogous result holds for maximizing the price at a positive time t ∈ (0, T )
instead of t = 0.


                                          12
    Thus, in the optimal assignment, no taxes or subsidies are collected, and
in the resulting equilibrium, agents assigned α− go short and agents assigned
α+ go long. In particular, the planner penalizes pessimists by assigning the
higher cost-of-carry to short positions, which then leads to the maximal price
that the planner can produce given her constraints.


3      Comparative Statics and Limiting Cases
In the first part of this section, we establish comparative statics with respect
to the supply and cost parameters, showing that our model has the desired
monotonicity properties. In the second part, we analyze the limit α+ → ∞
where there is no cost-of-carry for long positions, as well as the limit α− → 0
where short positions are ruled out.

3.1     Comparative Statics
We start with the dependence on the supply.

Proposition 3.1. The equilibrium price function v is monotone decreasing
with respect to the supply function s: the price decreases with an increase in
supply.

   Next, we turn to the cost parameters α− and α+ . The following shows
that the equilibrium price is decreasing with respect to the cost-of-carry for
long positions and increasing with respect to the cost for short positions.

Proposition 3.2. The equilibrium price function v is

    (i) increasing with respect to α+ ,

 (ii) decreasing with respect to α− ,

(iii) increasing with respect to the quotient α+ /α− if s ≡ 0.

   The following is a partial extension of (iii) to the case of non-zero supply
which is useful if α− and α+ are varied simultaneously.

Remark 3.3. Let α− ≤ α+ and α−        0 ≤ α0 be two pairs of cost coefficients
                                             +
                  0
and let v and v be the corresponding equilibrium price functions. If the
coefficients satisfy α+ /α− ≤ α+0 /α0 and α ≤ α0 , then v ≤ v 0 .
                                     −        −     −
    For instance, it follows that if the costs-of-carry for long and short posi-
tions are increased by a common factor, then the price decreases.


                                          13
3.2     Limiting Models
We discuss two limits for the cost coefficients which help to understand
the relationship between our model and the earlier ones mentioned in the
Introduction. To make the dependence on the parameters explicit, we denote
by v α− ,α+ (t, x) the equilibrium price function v(t, x) for α− , α+ as introduced
in Theorem 2.1.

3.2.1    Zero Cost for Long Positions
We first consider the limit α+ → ∞ when the cost-of-carry for long positions
tends to zero.
Proposition 3.4. As α+ → ∞, the function v α− ,α+ converges to the unique
solution v ∞ ∈ Cb1,2 of the PDE

                                bi ∂x v + 12 Tr σi2 ∂xx v = 0
                                                         
                   ∂t v + sup                                       (3.1)
                         i∈{1,...,n}

with terminal condition v(T, x) = f (x); in particular, v ∞ is independent
of α− and s. The convergence is locally uniform in (t, x), and monotone
increasing as α+ ↑ ∞.
    We now discuss the limiting model that arises in Proposition 3.4; that is,
a variant of our model with no cost-of-carry for long positions. We state these
results without proofs since the mathematical arguments are very similar to
the proof of Theorem 2.1.
    The limiting model has an equilibrium price function v := v ∞ that is
unique and independent of the supply s and the cost coefficient α− for short
positions. The optimal portfolios Φi (t) = φi (t, X(t)) for the equilibrium,
however, do depend on s and α− . Given (t, x), we may distinguish two cases
for an agent i. If the index i is not a maximizer in (3.1), or equivalently if
Li v(t, x) < 0, then
                            φi (t, x) = α− Li v(t, x)
as in (2.4); in particular, agent i holds a short position. On the other hand,
the “most optimistic” agents i which attain the maximum, or equivalently
satisfy Li v(t, x) = 0, only require that φi (t, x) be nonnegative—they are
invariant with respect to the amount as long as the position is nonnegative.
In equilibrium, the amounts held by the most optimistic types are set by the
market clearing condition: if there is only one maximizer i, then
                                           X
                   φi (t, x) = s(t, x) −           α− Lj v(t, x)
                                       j∈{1,...,n}\{i}


                                        14
is uniquely determined—the most optimistic type absorbs all the exogenous
supply plus the short positions of the other agents. This explains why the
price does not depend on s and α− ; in fact, the price is solely determined
by the characteristics of the most optimistic type. If there is more than
one maximizer i, meaning that several types are equally optimistic, then the
optimal portfolios are not unique—any distribution of the available amount
(supply plus short positions) over those types gives an optimal allocation.
    The properties described above for α+ = ∞ continue to hold if in addi-
tion α− = 0; i.e., when there is no cost for long positions and short positions
are prohibited. In particular, all but the most optimistic agents hold a flat
position, and only the most optimistic characteristics play a role in deter-
mining the price.19 Thus, we retrieve the results of previous models with
risk-neutral agents in this limiting regime, as mentioned in the Introduction.

Remark 3.5. Proposition 3.4 shows that in the limiting case α+ = ∞, the
price is determined by the most optimistic agent at any state. This may
be contrasted with the opposite extreme case where the cost coefficients
α+ = α− are equal. Then, the drift and volatility coefficients
                                n                                     n
                             1X                                    1X 2
                 µ := µI =      bi ,         Σ2 := Σ2I =             σi
                             n                                     n
                               i=1                                   i=1

are independent of I and equal to the arithmetic average of the coefficients in
the agents’ models, meaning that all agents contribute equally to the price.
The running cost is κ := κI = s/(nα+ ). Thus, the PDE (2.5) becomes
linear,
                     n                        n
                  1X                  1 X                 s
           ∂t v +    bi ∂x v(t, x) +      Tr σi2 ∂xx v −     = 0,
                  n                  2n                  nα+
                     i=1                     i=1

and the equilibrium price is
                                  Z          T                                   
                             t,x                           t,x
          v(t, x) = E f (X (T )) −                s(r, X         (r))/(nα+ ) dr       (3.2)
                                          0

where X t,x follows the SDE (2.9) with coefficients µ and Σ. That is, the
equilibrium price is simply the expected value of the security under the
averaged coefficients of the agents, minus a cost term related to the supply.
  19
     This model was studied in detail by Muhle-Karbe and Nutz (2016), under the the
assumption of a unit net supply.



                                        15
3.2.2   Infinite Cost for Short Positions
We now discuss the limit α− → 0; that is, the cost-of-carry for short positions
tends to infinity.

Proposition 3.6. As α− → 0, the function v α− ,α+ converges to the unique
solution v 0,α+ ∈ Cb1,2 of the PDE
                                                                       !
                            X                      X               s
  ∂t v +     sup         1
                        |J|    bi ∂x v + 12 Tr |J|
                                                1
                                                     σi2 ∂xx v −         = 0 (3.3)
         ∅6=J⊆{1,...,n}                                          |J|α+
                          i∈J                  i∈J

with terminal condition v(T, x) = f (x). In the special case where s = 0, this
PDE coincides with (3.1) and in particular the solution v 0,α+ = v ∞ is inde-
pendent of α+ . The convergence is locally uniform in (t, x), and monotone
increasing if α− ↓ 0.

    The limiting model that arises in Proposition 3.6, where there is an infi-
nite cost for short positions, corresponds to a prohibition of shorting-selling.
This model has a unique equilibrium price function v := v 0,α+ , and in con-
trast to the above, the price does depend on the supply s and the cost
coefficient α+ for long positions. The optimal portfolios Φi (t) = φi (t, X(t))
are unique and given by
                               (
                                α+ Li v(t, x), Li v(t, x) ≥ 0,
                   φi (t, x) =
                                0,             Li v(t, x) < 0,

and both cases may indeed occur. At every state (t, x), we can think of the
types as being divided into a group J = {i ∈ {1, . . . , n} : Li v(t, x) ≥ 0}
of relatively optimistic agents and the complement J c of pessimists. We
have J 6= ∅ by market clearing. While the agents in J hold positions of
different magnitude depending on how optimistic they are, the entire group
J determines the price. Agents in J c , however, hold zero units and their
precise characteristics do not enter the formation of the price. For instance,
if we replace a pessimistic type i ∈ J c by an even more pessimistic type, the
equilibrium price will not change.
    We remark that the case s = 0 is degenerate in the limiting model: while
the above assertions are valid, the portfolios are in fact given by Φi ≡ 0 for
all i. Indeed, the PDE implies Li v(t, x) ≤ 0. Alternately, this follows from
the fact that there is neither supply nor shorting in this case.




                                       16
4     Speculation
In this section, we highlight the impact of non-linear costs-of-carry and short-
selling on the pricing mechanism by comparing the above “dynamic” equi-
librium price at time t = 0 with a “static” equilibrium price; that is, an
equilibrium without speculation. We shall see that, as in previous models,
the dynamic price dominates the static price when cost-of-carry and short-
selling are removed from our model. This can be attributed to the resale
option. However, we show that the cost-of-carry (i.e., risk aversion) gives rise
to a delay effect that may act in opposition to the resale option and reverse
the order of the prices in extreme cases—even if short-selling is prohibited.
Moreover, we illustrate that the possibility of short-selling tends to depress
the dynamic price, as it gives rise to a repurchase option for pessimists.

4.1    Equilibrium without Speculation
Let us consider a situation where trading occurs only at the initial time t = 0;
that is, agents are forced to use buy-and-hold strategies and speculation is
ruled out. The agents use the same models Qi for the dynamics (2.1) of the
state process X and maximize the same expected net payoff (2.3). However,
the admissible portfolios Φ are restricted to be constant, and we will use
the letter q to denote a generic portfolio. This market can only clear if the
exogenous supply S ≡ s is constant, so we restrict our attention to that
case. A static equilibrium price is defined like the dynamic equilibrium price
above, except that we only look for a constant psta ∈ R at time t = 0 at
which the trading happens.

Proposition 4.1. (i) There exists a unique static equilibrium price and it
is given by
                                                                                 !
                      α−
                                   ei + |I|α−α+|I
                                 X                       X
                                               +                      sT
  psta = max     |I|α− +|I c |α+                  c |α
                                                       +
                                                           ei − |I|α− +|I c |α
                                                                               +
                                                                                   ,
         I⊆{1,...,n}
                                   i∈I                      i∈I c
                                                                     (4.1)
where ei = Ei [f (X(T ))]. The corresponding optimal static portfolios are
unique and given by

                        qi = αsign(ei −psta ) T −1 (ei − psta ).              (4.2)

    We may observe that the formula (4.1) for the static price is reminiscent
of the PDE (2.5) for the dynamic price; however, the averaging of the models
of the different types now occurs at the level of the expected values ei =

                                          17
Ei [f (X(T ))] instead of the drift and volatility coefficients bi , σi . Informally,
we may think of the PDE as describing a repeated version of the static
problem over infinitesimal intervals.
    In parallel to our analysis above, we can consider limiting cases for the
cost coefficients in the static case. The limiting models have interpretations
analogous to the dynamic limiting models in Section 3.2, so we confine our-
                                                                               α ,α
selves to stating the formulas for the limiting prices. We denote by psta− +
the static equilibrium price for cost parameters α− , α+ and initial value
X(0) = x as given by (4.1).
Proposition 4.2. (i) In the limit α+ → ∞ with zero cost for long positions,
           α ,α
the price psta− + converges to

                          p∞
                           sta =     max Ei [f (X(T ))].                       (4.3)
                                   i∈{1,...,n}

                                                                              α ,α
(ii) In the limit α− → 0 with infinite cost for short positions, the price psta− +
converges to
                                                                  !
               0,α+                  1
                                        X                     sT
              psta =     max              Ei [f (X(T ))] −           .       (4.4)
                     ∅6=J⊆{1,...,n} |J|                     |J|α+
                                          i∈J


4.2    Resale and Delay Options
Next, we compare the dynamic equilibrium price pdyn := P (0) at time t = 0
with the static equilibrium price psta . For the latter to be well-defined, we
assume throughout that the supply s is constant. We discuss two options
that are present under dynamic trading and are valued by agents—the resale
and delay options—and the effect on prices of eliminating these options by
forcing agents to trade only at time zero. In particular, we shall see that the
ordering of pdyn and psta may be different than in the earlier models.
     Previous papers, starting with Harrison and Kreps (1978), considered
models with risk-neutral agents that face a constant marginal cost-of-carry
for long positions (the interest rate) and cannot sell short. In such models,
it is known that the dynamic equilibrium price exceeds the static one, and
the difference is attributed to the “resale option.” Indeed, the possibility of
reselling the asset increases the price—agents may want to buy today in order
to resell to agents that are more optimistic tomorrow. In these “classical”
models, agents may also choose to delay their purchases, because they believe
that while today’s price exceeds their marginal valuation, in some states of
the world tomorrow’s prices may be more favorable. This possibility however
does not alter the ranking between the dynamic and static equilibrium prices.

                                           18
    Indeed, since agents are risk-neutral and the marginal cost of carrying
a long position is independent of the size of the position, we may assume
generically that only one type i would acquire the asset in the static equi-
librium. When re-trading is allowed, i’s marginal valuation for holding the
full supply of the asset at time zero is at least as large, since an agent can
always choose a buy-and-hold strategy. As the market price must exceed the
marginal valuation of any type, the dynamic equilibrium price must exceed
the static equilibrium price.
    The next two results confirm this intuition by showing how this mecha-
nism carries over to limiting cases of our model. First, we show that when
there is no cost for long positions, the dynamic price exceeds the static one.
This holds even when shorting is allowed, because in this extreme case, only
the most optimistic agents contribute to the price formation, just like in the
classical models (see also Propositions 3.4 and 4.2).
Proposition 4.3. In the limit α+ → ∞, the dynamic equilibrium price
dominates the static price: p∞      ∞
                             dyn ≥ psta .

    Next, we show that if short-sales are prohibited and if in the static equi-
librium only one type holds the asset, the dynamic equilibrium price again
exceeds the static price, even when longs pay a cost-of-carry.
Proposition 4.4. In the limit α− → 0 with no short-selling, suppose that a
single type i holds the entire market in the static equilibrium; that is, qi = s
and qj = 0 for j 6= i. Then, the dynamic equilibrium price dominates the
               0,α      0,α
static price: pdyn+ ≥ psta + .
    We now turn to our model with positive costs-of-carry. Here, the same
options to resell and to delay are present, but the effects are more subtle. The
option to delay now has an effect on equilibrium prices because the marginal
valuation of buyers varies with the size of their position. More importantly,
trading may occur in the dynamic equilibrium even though one type remains
the most optimistic. Indeed, in the classical models (and the limiting model
of Proposition 3.4) the most optimistic type always holds the full supply and
trading requires that relative optimism changes sign. When there is a cost-
of-carry for long positions, the magnitude of relative optimism determines
equilibrium holdings—it is no longer true that a less optimistic type would
always hold a non-positive amount. Example 4.6 below illustrates that the
delay option may have an important impact on prices and even reverse the
ordering of dynamic and static prices.
    If shorting is allowed, buying today in order to resell needs to be com-
pared with entering a short position tomorrow. The choice will depend,

                                      19
among other factors, on the costs-of-carry for long and short positions. The
option to resell a short position—that is, the option to cover shorts—in
turn, decreases the minimum amount pessimists would be willing to receive
for shorting the asset, putting downward pressure on prices. Shorts also
may exercise the option to delay by building up a short position over time.
Example 4.9 below illustrates how the ordering of dynamic and static prices
can be reversed if the cost of shorting is sufficiently low.

Remark 4.5. In the remainder of this section, we use a quadratic payoff
function f as this is convenient to obtain explicit formulas. Of course, that
violates our standing assumption that f is bounded. However, our results
still apply with the appropriate modifications; in particular, the equilibrium
price function v and the admissible portfolios φi are of polynomial growth
instead of being bounded. The formulas in our examples can also be verified
by direct calculation.

4.3    Illustrating the Effect of the Delay Option
In this section, we show that the static price may dominate the dynamic
one even when short-selling is prohibited. That cannot be explained with
a resale option; instead, it highlights the delay option. Consider first the
dynamic equilibrium and suppose that type i expects with high probability
that their portfolio Φi (t) will increase over time. In the static equilibrium,
we eliminate the possibility of changing the portfolio in the future. Thus,
an agent of type i will consider anticipating the increase of the portfolio
by augmenting the position already at time t = 0, and if the additional
expected gains outweigh the additional costs-of-carry, the agent will indeed
have a higher demand at the previous price pdyn . Then, the equilibrium can
adjust in two ways. First, other types may reduce their positions at the
same price. For instance, this may happen because they are anticipating a
decrease in position or because they are indifferent to the amount they are
holding (see also Example 4.8 below). Second, if all types have the same or
even a higher demand20 in the static case, the equilibrium must adjust by
an increase in price, and then the static equilibrium price may exceed the
dynamic one, despite the resale option. In practice, we may often observe a
mixture of these two cases: other types may reduce their positions after an
increase in price.
  20
    Note that since the types disagree, it may indeed happen that all agents expect to
increase their positions over time in the dynamic case, without contradicting the market
clearing condition.



                                          20
    To demonstrate this in more detail, we prohibit short-selling (α− = 0),
impose a positive cost for long positions (α+ = 1), and construct an exam-
ple where some agents expect to increase their positions over time but no
agent expects to decrease their position. To obtain explicit formulas despite
the nonlinear context, we consider the limiting case of zero volatility, and
show later (Proposition 4.7) that this is indeed the continuous limit for equi-
libria with small volatility coefficients σi . Similarly as in Remark 4.5, the
zero volatility case violates our standing assumption that the coefficients are
uniformly parabolic (and indeed v is not smooth in our example), but the
formulas we present can be verified by direct calculation.
Example 4.6. Consider n = 2 types with volatility coefficients σi = 0 and
constant, opposing drifts

                            b1 = 1,        b2 = −1.

The payoff function is f (y) = y 2 and the supply s > 0 is constant. Moreover,
α− = 0 and α+ = 1. Then, the dynamic equilibrium price is
                        (
                          x2 − sT /2,        |x| + T /2 ≤ s/4,
                pdyn =              2
                          (|x| + T ) − sT, |x| + T /2 > s/4,

and corresponding optimal portfolios in feedback form are given by
                      
                      0,
                                 |x| + (T − t)/2 > s/4, x < 0,
           φ1 (t, x) = s/2 + 2x, |x| + (T − t)/2 ≤ s/4,
                      
                       s,         |x| + (T − t)/2 > s/4, x > 0,
                      

                      
                      s,
                                 |x| + (T − t)/2 > s/4, x < 0,
           φ2 (t, x) = s/2 − 2x, |x| + (T − t)/2 ≤ s/4,
                      
                       0,         |x| + (T − t)/2 > s/4, x > 0.
                      

The static equilibrium price is
                        (
                         x2 + T 2 − sT /2,   |x| ≤ s/4,
                 psta =   2     2
                         x + T + 2|x|T − sT, |x| > s/4,

and corresponding optimal portfolios are given by
                                            
           
           0,         x < −s/4,             s,
                                                      x < −s/4,
      q1 = s/2 + 2x, |x| ≤ s/4,         q2 = s/2 − 2x, |x| ≤ s/4,
                                            
            s,         x > s/4,                0,      x > s/4.
                                            


                                      21
The static equilibrium price exceeds the    dynamic price; more precisely,
                        
                            2                |x| ≤ s/4 − T /2,
                        T ,
                        
          psta − pdyn = (s/2 − 2|x|)T,       s/4 − T /2 < |x| < s/4,
                        
                          0,                 |x| ≥ s/4.
                        

    The calculations for our examples are carried out in Appendix A, together
with the rest of the proofs. Next, we discuss in more detail how the delay
effect explains the difference psta −pdyn in this example. To that end, it will be
useful to record the portfolios as expected by the agents: since X(t) = x+bi t
Qi -a.s. and Φi (t) = φi (t, X(t)), we have
                      
                      0,
                                         |x + t| + (T − t)/2 > s/4, x + t < 0,
 Q1 -a.s., Φ1 (t) = s/2 + 2t + 2x, |x + t| + (T − t)/2 ≤ s/4,
                      
                        s,                |x + t| + (T − t)/2 > s/4, x + t > 0,
                      

                     
                     s,
                                    |x − t| + (T − t)/2 > s/4, x − t < 0,
 Q2 -a.s.,   Φ2 (t) = s/2 + 2t − 2x, |x − t| + (T − t)/2 ≤ s/4,
                     
                      0,             |x − t| + (T − t)/2 > s/4, x − t > 0.
                     

Below, we abuse this notation and simply write Φ1 (t) and Φ2 (t) for the ex-
pressions on the right hand side. We consider various intervals for the initial
value x; by symmetry, we may focus on x ≥ 0 without loss of generality. We
also assume that s > T , mainly to avoid distinguishing even more cases.
    Case 1: x ≥ s/4 + T . In this regime, the expected dynamic portfolios
Φ1 and Φ2 are constant, and thus the delay option is never exercised. The
static portfolios coincide with their initial values, q1 = s = Φ1 (0) and q2 =
0 = Φ2 (0), and the static and dynamic prices are equal: psta = pdyn .
    Case 2: s/4 ≤ x < s/4 + T . As before, q1 = s = Φ1 (0) and Φ1 is
constant. However, Φ2 (t) equals zero initially but may become positive for
t close to T (for suitable parameter values). Nevertheless, type 2 does not
choose to anticipate her trading in the static case, because the cost-of-carry
outweighs the expected gains—we still have q2 = 0 = Φ2 (0) and psta = pdyn .
    Case 3: (s/4 − T /2)+ < x < s/4. Once again, Φ1 ≡ s is constant,
Φ2 (0) = 0, and Φ2 increases for some t > 0. Furthermore, the increase in
type 2’s position is larger for smaller x. Type 2 now does anticipate some of
that increase in the static case and for this reason pdyn is now too low to be
an equilibrium price. The increase in price changes the optimal portfolio for
agents of type 1. We are in the mixed case where portfolios and prices adjust.
Type 1 decreases his initial position to q1 = s/2 + 2x < s = Φ1 (0) and type 2

                                       22
increases her position to q2 = s/2 − 2x > 0 = Φ2 (0). At the same time, the
static equilibrium price is augmented, psta − pdyn = (2x − s/2)T > 0. As
x decreases from s/4 to s/4 − T /2, this difference increases linearly from 0
to T 2 , and the portfolios (q1 , q2 ) change linearly from (s,0) to (s − T, T ).
In summary, the elimination of the delay option in the static case results in
portfolio adjustments and a price increase.
    Case 4: 0 ≤ x ≤ s/4 − T /2. In this last regime, both Φ1 and Φ2
are increasing in time, so both types are exercising the delay option when
re-trading is allowed and have an anticipatory motive when they can only
trade at t = 0. The initial dynamic portfolios are Φ1 (0) = s/2 + 2x > 0 and
Φ2 (0) = s/2 − 2x > 0. Since both types want to anticipate in the static
case, the static price must be higher. More precisely, the aggregate excess
demand at price pdyn equals 2T 2 and thus is independent of x. Since we are
in the region where both types have positive demand, the marginal effect of
an increase in price is −1, for each type. Thus, the price adjustment that is
necessary to clear the static market is exactly T 2 for every value of x in this
region.
    Finally, we show that the conclusions of the example also hold when
volatilities are small but positive, rather than vanishing.
Proposition 4.7. Consider the setting of Example 4.6 with constant volatil-
ities σ := σ1 = σ2 ≥ 0 and denote the corresponding static and dynamic equi-
librium prices by pσsta and pσdyn , respectively. Then, pσsta ↓ p0sta and pσdyn ↓ p0dyn
as σ ↓ 0. As a consequence, we have
                          
                               2                |x| ≤ s/4 − T /2,
                          T ,
                          
            σ      σ
           psta − pdyn → (s/2 − 2|x|)T, s/4 − T /2 < |x| < s/4,
                          
                             0,                 |x| ≥ s/4.
                          

    The above example of the delay effect should be contrasted with Propo-
sition 4.3, where we have seen that when there is no cost-of-carry for long
positions (α+ = ∞), the dynamic equilibrium price always exceeds the static
one, even if short-selling is possible. We have argued that this is due to the
most optimistic agent holding the entire market. The following example
illustrates the mechanics of the delay option in this situation.
Example 4.8. Let α+ = ∞ and α− = 1. We consider n = 2 types with
drift coefficients
                       b1 = 1,  b2 = 0
and volatility coefficients σ1 = σ2 = 0. The payoff is f (y) = y 2 and the
initial value is x = 0, so that the first type is more optimistic at any time.

                                          23
   As in Proposition 4.2, the static equilibrium price given by the optimist’s
expectation e1 = E1 [f (X(T ))] = T 2 . Following Proposition 3.4, the same
holds for the dynamic price, so that psta = pdyn . The static and dynamic
portfolios of the pessimist are given by

      q2 = T −1 (e2 − psta ) = −T,       φ2 (t, x) = ∂t v(t, x) = −2(x + T − t).

Under Q2 , the state process X ≡ 0 is constant, so that Φ2 (t) = φ2 (t, X(t)) =
−2(T − t) a.s. Thus, the static position q2 = −T anticipates some of the
increase from Φ2 (0) = −2T to Φ2 (T ) = 0. However, this does not affect
the static equilibrium price because an optimistic agent is indifferent to the
size of her (nonnegative) position—the absence of a cost-of-carry for long
positions allows the portfolios to adjust without affecting the prices.

4.4     Illustrating the Effect of Shorting
The following example illustrates that when shorting is allowed, the static
price may exceed the dynamic price—this is quite natural once we observe the
symmetry between optimists and pessimists in the extreme case α− = α+ .
The difference between the dynamic price and the static price has been
identified as the size of the “speculative bubble” in the previous literature.
If we maintain this identification, this example can be used to illustrate how
lowering the cost of shorting can lead not only to a bubble implosion but
even to a negative bubble.

Example 4.9. To facilitate the computations we assume symmetric costs-
of-carry α− = α+ = 1. Consider n = 2 types with constant coefficients bi ∈ R
and σi > 0, and an asset in zero aggregate supply with payoff f (y) = y 2 .
Writing Σ2 := (σ12 + σ22 )/2 and µ := (b1 + b2 )/2, the dynamic and static
equilibrium prices at t = 0 for the initial value X(0) = x are

                                                b1 + b2 2 2
                                                       
                                                       
                   pdyn = x2 + 2xµT + Σ2 T +              T ,
                                                   2
                                              b2 + b22 2
                   psta   = x2 + 2xµT + Σ2 T + 1      T ;
                                                 2
in particular,
                                 "             2               #
                                      b1 + b2          b21 + b22
                 pdyn − psta =                       −             T 2 ≤ 0.
                                         2                 2



                                           24
The optimal dynamic and static portfolios are given by

           φi (t, x) = x(bi − bj ) + 12 (T − t)(b2i − b2j ) + 12 (σi2 − σj2 ),
                 qi = x(bi − bj ) + 12 T (b2i − b2j ) + 12 (σi2 − σj2 ),

where j = 2 if i = 1 and vice versa; in particular, the demands at t = 0
coincide. In the special case b1 = b2 where all agents agree on the drift, we
have pdyn = psta and the demands coincide at all times. Whenever b1 6= b2 , a
continuity result similar to the results established in Section 3.2 guarantees
that pdyn < psta for cost parameters close to α− = α+ = 1.

    To obtain some intuition for this example, consider the case were σ1 = σ2 ,
b1 > 0 and b2 = 0. Then if x > 0, type 1 is long and type 2 is short
when re-trading is allowed. Notice that an agent who is short expects on
average to cover some of her shorts in the future. When re-trading is ruled
out, she prefers to cut her short position at time zero. This would place
upward pressure on the static price. The long party also expects to reduce
his position if x would stay constant, but because b1 > 0, he expects the
state X(t) to grow, thus dampening his need to anticipate the reduction
when re-trading is ruled out. In other words, the long party values the resale
option less than the short party values the repurchase option. As a result,
the static market presents excess demand at price pdyn and thus the static
price must rise to clear the market.


5    Conclusion
In this paper, we considered a continuous-time model of trading among risk-
neutral agents with heterogeneous beliefs. Agents face quadratic costs-of-
carry and as a consequence, their marginal valuation of the asset decreases
when the magnitude of their position increases, as it would be the case
for risk-averse agents. In previous models of heterogeneous beliefs, it was
assumed that agents face a constant marginal cost-of-carry for a positive
position and an infinite cost for a negative position. As a result, buyers
benefit from a resale option and are willing to pay for an asset in excess
of their own valuation of the dividends of that asset. Moreover, the supply
does not affect the equilibrium price. We show that when buyers face an
increasing marginal cost-of-carry, in equilibrium, they may also value an
option to delay. We illustrate with an example that even when shorting is
impossible, this delay option may cause the market to equilibrate below the
price that would prevail if agents were restricted to buy-and-hold strategies.

                                           25
Moreover, we introduce the possibility of short-selling and show how this
gives pessimists the analogous options. In our model, the price depends
on the supply. We characterize the unique equilibrium of our model as
the solution to a Hamilton–Jacobi–Bellman of a novel form and use this to
derive several comparative statics: the price decreases with an increase in the
supply of the asset, with an increase in the cost of carrying long positions,
and with a decrease in the cost of carrying short positions. The conclusions
of earlier models are shown to hold in a limiting case of the model when the
cost-of-carry for long positions tends to zero.
    In our model the demand for the asset is satisfied by the sum of two
components—the exogenous supply and the short positions of the market
participants. While the shorts are determined endogenously, the supply is
independent of the current price and the beliefs of agents. It would be inter-
esting to model this supply as originating from parties solving an appropriate
optimization problem.


A       Proofs
This appendix collects the proofs for the results in Sections 2–4.

A.1       Proofs for Section 2
Before proving the main result of Theorem 2.1, we record two lemmas for
later reference. The first one guarantees the passage from almost-sure to
pointwise identities.
Lemma A.1. For all i ∈ {1, . . . , n} and all t ∈ (0, T ], the support of X(t)
under Qi is the full space Rd .
Proof. Since bi is bounded and σi2 is uniformly parabolic, the support of Qi
in Ω is the set of all paths ω ∈ C([0, T ], Rd ) with ω(0) = x; see (Stroock and
Varadhan, 1972, Theorem 3.1). The claim is a direct consequence.

      The second lemma provides an expression for the optimal portfolios.
Lemma A.2. Let v ∈ Cb1,2 and consider the (price) process P (t) = v(t, X(t)).
The portfolio defined by Φi (t) = φi (t, X(t)), where

                           φi (t, x) = αsign(Li v(t,x)) Li v(t, x),       (A.1)

is the unique21 optimal portfolio for type i.
 21
      We recall that uniqueness is understood up to (Qi × dt)-nullsets.


                                             26
Proof. We note that Φi is admissible since v ∈ Cb1,2 . Let Φ be any admissible
portfolio. By Itô’s formula,
Z T              Z T               Z T
    Φ(t) dP (t)−      c(Φ(t)) dt =     {Φ(t)Li v(t, X(t))−c(Φ(t))} dt+Mi (T )
 0                   0                         0

where Mi (T ) is the terminal value of a (true) martingale with vanishing
expectation; recall that σi and ∂x v are bounded. Thus, the expected final
payoff (2.3) is given by
                      Z T                                
                                 i
                   Ei      {Φ(t)L v(t, X(t)) − c(Φ(t))} dt .
                            0

As a result, Φ is optimal if and only if it maximizes the above integrand (up
to (Qi × dt)-nullsets). The unique maximizer is given by Φi , and the claim
follows.

     We can now prove the main result on the pricing PDE.

Proof of Theorem 2.1. (a) We first show that a given equilibrium price func-
tion v ∈ Cb1,2 solves the PDE. Since v(T, X(T )) = f (X(T )) Qi -a.s. for all i,
the terminal condition v(T, ·) = f follows from Lemma A.1. At any state
(t, x), we introduce the set

                     I∗ (t, x) = {i ∈ {1, . . . , n} : Li v(t, x) < 0}.                     (A.2)

Next, we recall the unique optimal portfolios Φi Pfrom Lemma A.2. Using
again Lemma A.1, the market clearing condition i Φi = S can be stated
as                        X             X
                       α−    Li v + α +    Li v = s.              (A.3)
                                 i∈I∗                    i∈I∗c

If i ∈ I∗ , then Li v ≤ 0 and α− ≤ α+ implies α− Li v ≥ α+ Li v. Conversely, if
i ∈ I∗c , then Li v ≥ 0 and α+ Li v ≥ α− Li v. It follows that the set I∗ of (A.2)
maximizes the left hand side of (A.3) among all subsets I ⊆ {1, . . . , n}. That
is,                                                         !
                                X               X
                     max     α−      Li v + α+      Li v − s = 0             (A.4)
                   I⊆{1,...,n}
                                        i∈I                  i∈I c

and the set I∗ is a maximizer, or equivalently,
                                                                                 !
                                              X                  X
                          1                          i                    i
          max                c      α−              L v + α+             L v−s       = 0.   (A.5)
        I⊆{1,...,n} |I|α− +|I |α+
                                              i∈I                i∈I c


                                                    27
After plugging in the definition of Li v and using the definitions of µI , ΣI
and κI in (2.6)–(2.8), this is the desired PDE (2.5).
    (b) Conversely, let v ∈ Cb1,2 be a solution of the PDE (2.5) with termi-
nal condition f and define Φi , φi as in part (i) of Theorem 2.1. Then, the
terminal condition v(T, X(T )) = f (X(T )) is satisfied and Φi are optimal
by Lemma A.2. Since v is a solution of the equivalent PDE (A.4) and I∗
of (A.2) is a maximizer, we have that
                   X              X            X
                         φi = α−     Li v + α+      Li v = s;
                  1≤i≤n           i∈I∗                i∈I∗c

that is, the market clears. This shows that v is an equilibrium price function.
    (c) Since (a) and (b) established a one-to-one correspondence between
equilibria and solutions of the PDE (2.5) with terminal condition f , it re-
mains to observe that the latter has a unique solution in Cb1,2 . Indeed,
existence holds by (Krylov, 1987, Theorem 6.4.3, p. 301); the conditions in
the cited theorem can be verified as in (Krylov, 1987, Example 6.1.4, p. 279).
Uniqueness holds by the comparison principle for parabolic PDEs; see (Flem-
ing and Soner, 2006, Theorem V.9.1, p. 223).

    Next, we prove the optimal control representation for the equilibrium
price function.

Proof of Proposition 2.3. By Theorem 2.1, the function v ∈ Cb1,2 is a solution
of the PDE (2.5) which is the Hamilton–Jacobi–Bellman equation of the
control problem (2.10). Moreover, I∗ (t, x) maximizes the Hamiltonian as
noted after (A.4). Thus, the verification theorem of stochastic control, cf.
(Fleming and Soner, 2006, Theorem IV.3.1, p. 157), shows that v is the value
function and I∗ is an optimal control.

   It remains to analyze the planner’s problem.

Proof of Theorem 2.4. (i) In what follows, we fix the assignment I(t) =
I(t, X(t)) and often omit the dependence on I in the notation. Suppose that
w is an equilibrium price function; we show that w satisfies (2.12). As in
Lemma A.2, the unique optimal portfolio for agent i is given by Φi (t) = φi (t),
where
                         φi (t, x) = αi (t, x)Li w(t, x).                (A.6)
The market clearing condition then implies
                         X              X
                      α−     Li w + α +    Li w = s,
                            i∈I               i∈I c


                                         28
which is equivalent to
                                                                                 !
                                          X                      X
                     1
               |I|α− +|I c |α+     α−           Li w + α +               Li w − s      =0
                                          i∈I                    i∈I c

or
                      ∂t w + µI ∂x w + 12 Tr Σ2I ∂xx w − κI = 0.
Given the terminal condition f , this linear PDE has a unique solution in
Cb1,2 which, by the Feynman–Kac formula (Karatzas and Shreve, 1991, The-
orem 5.7.6, p. 366), has the representation (2.12).
    Conversely, starting with the unique solution w = vI ∈ Cb1,2 of that PDE,
reversing the above arguments shows that w is an equilibrium price function,
and that completes the proof of (i).
    (ii) In view of (2.12), (2.10) and Proposition 2.3, the supremum of vI (t, x)
over all assignments I(t) = I(t, X(t)) is given by V (t, x) and (2.11) is an
optimal assignment in feedback form.

A.2     Proofs for Section 3
We start with the comparative statics for the dependence of the price on the
supply.

Proof of Proposition 3.1. Since the function s enters linearly in the running
cost (2.8) of the control problem (2.10) and nowhere else, it follows imme-
diately that the value function V is monotone decreasing in s, and now the
claim follows from Proposition 2.3.

     Next, we consider the dependence on the cost coefficients.

Proof of Proposition 3.2 and Remark 3.3. Let α− ≤ α+ and α−          0 ≤ α0 be
                                                                             +
two pairs of cost coefficients and let v and v 0 be the corresponding equilibrium
price functions. Let I∗ be the optimal feedback control for α± as defined
in (A.2), then by (A.4) we have
                            X              X
                        α−      Li v + α +     Li v − s = 0.
                                 i∈I∗                  i∈I∗c

    0 ≤ α and α0 ≥ α , then                            Li v ≤ 0 and                   Li v ≥ 0 yield that
                                           P                               P
If α−    −     +    +                           i∈I∗                          i∈I∗c
                                 X                     X
                          0                      0
                         α−             Li v + α +             Li v − s ≥ 0.
                                 i∈I∗                  i∈I∗c



                                                  29
In the special case where s ≡ 0, this conclusion also holds under the weaker
condition that α+ /α− ≤ α+  0 /α0 , which covers the case (iii), and the same
                                −
holds under the conditions of Remark 3.3. It then follows that
                                                       !
                              X             X
                            0       i     0      i
                  max     α−      L v + α+     L v − s ≥ 0,
                 I⊆{1,...,n}
                                    i∈I              i∈I c

which is a version of (A.4) with inequality instead of equality, for the coeffi-
        0 . Following the same steps as after (A.4), we deduce that
cients α±
                                                0
                                                               
              ∂t v + sup       µ0I ∂x v + 12 Tr ΣI2 ∂xx v − κ0I ≥ 0,
                      I⊆{1,...,n}

                                                              0 instead of α .
where µ0I , Σ0I , κ0I are defined as in (2.6)–(2.8) but with α±             ±
In other words, v is a subsolution of the PDE satisfied by v 0 . As v and
                                       22

v 0 satisfy the same terminal condition f , the comparison principle (Fleming
and Soner, 2006, Theorem V.9.1, p. 223) implies that v ≤ v 0 .

       We continue with our result on the limit α+ → ∞.

Proof of Proposition 3.4. We first notice that since s ≥ 0, the optimal set I∗
of (A.2) for the Hamiltonian of the PDE (2.5) must satisfy |I∗ | < n due to
the market clearing condition—at least one agent has to hold a nonnegative
position. As a result, the PDE (2.5) remains the same if the supremum is
taken only over sets I with |I c | > 0.
    Taking that into account, the limiting PDE for (2.5) as α+ → ∞ is
                                    X
                                 1                1      2
                                                                  
             ∂t v +    sup      |J|     bi ∂x v + 2 Tr σi  ∂ xx v   = 0. (A.7)
                     ∅6=J⊆{1,...,n}       i∈J

Notice that given a set of real numbers, the largest average over a subset is
in fact equal to the largest number in the set. As a result, (A.7) coincides
with (3.1). Using again (Krylov, 1987, Theorem 6.4.3, p. 301) and (Fleming
and Soner, 2006, Theorem V.9.1, p. 223), this equation has a unique solution
v ∞ ∈ Cb1,2 for the terminal condition f , and the solution is independent of
α− and s since these quantities do not appear in (3.1).
    To see that v α− ,α+ (t, x) → v ∞ (t, x), one can apply a PDE technique
called the Barles–Perthame procedure to the equations under consideration;
see (Fleming and Soner, 2006, Section VII.3). Alternately, and to give a
  22
    Note that the sign convention chosen here is opposite to the one of Fleming and Soner
(2006), so that a subsolution corresponds to the inequality ≥ 0 in the PDE.



                                                30
more concise proof, we may use the representation (2.10) of v α− ,α+ as a
value function as well as the corresponding representation for v ∞ . Then, a
result on the stability of value functions, cf. (Krylov, 1980, Corollary 3.1.13,
p. 138), shows that v α− ,α+ → v ∞ locally uniformly; that is,

                         sup         |v α− ,α+ (t, x) − v ∞ (t, x)| → 0
                    (t,x)∈[0,T ]×K


for any compact set K ⊆ Rd . The monotonicity property of the limit follows
from Proposition 3.2.

   Finally, we turn to the limit α− → 0.

Proof of Proposition 3.6. The arguments are similar to the ones for Propo-
sition 3.4. In this case, the limiting PDE for (2.5) as α− → 0 is (3.3). As
in the proof of Proposition 3.4 we have that the limiting PDE has a unique
solution v 0,α+ ∈ Cb1,2 and v α− ,α+ (t, x) → v 0,α+ (t, x) locally uniformly, with
monotonicity in α− . In the special case where s = 0, the PDE (3.3) coincides
with (A.7), and thus with (3.1) as shown in the proof of Proposition 3.4.

A.3    Proofs for Section 4
We first prove our formula for the static equilibrium price.

Proof of Proposition 4.1. We set ei = Ei [f (X(T ))]. Given any price p, the
expected net payoff for agent i using portfolio q is
                                                     T        2
                                q(ei − p) −       2αsign(q) q


and the unique maximizer is qi = αsign(ei −p) T −1 (ei − p) as stated in (4.2).
    Let p be a static equilibriumPprice. Setting I∗ = {i ∈ {1, . . . , n} : ei < p},
the market clearing condition i qi = s for these optimal portfolios yields
                        X                  X
                     α−      (ei − p) + α+    (ei − p) = sT                    (A.8)
                         i∈I∗                     i∈I∗c

and we observe that I∗ maximizes the left hand side; that is,
                                                          !
                        X                X
            max     α−    (ei − p) + α+     (ei − p) − sT = 0.
           I⊆{1,...,n}
                             i∈I                     i∈I c

This is equivalent to the claimed representation (4.1) for p.


                                             31
    Conversely, define p by (4.1) and qi by (4.2), then qi is optimal for agent i
as mentioned in the beginning of the proof. Moreover, reversing the above,
p satisfies (A.8) and thus
            n
            X                X                           X
                  qi = α −          T −1 (ei − p) + α+           T −1 (ei − p) = s,
            i=1              i∈I∗                        i∈I∗c

establishing market clearing.
    We can now deduce the formulas for the limiting cases of the static equi-
librium.
Proof of Proposition 4.2. Formula (4.3) follows by taking the limit α+ → ∞
in (4.1). Similarly, (4.4) is obtained by taking the limit α− → 0 in (4.1).
    Next, we show that in the limit α+ → ∞ with no cost on long positions,
the dynamic price exceeds the static one.
Proof of Proposition 4.3. By the formula (4.3) for p∞      sta , it suffices to verify
that Ei [f (X(T ))] ≤ pdyn for fixed i ∈ {1, . . . , n}. Indeed, let u = ui ∈ Cb1,2
                       ∞

be the unique solution of
                  ∂t u + bi ∂x u + 21 Tr σi2 ∂xx u = 0,          u(T, ·) = f.
Then, by the Feynman–Kac formula (Karatzas and Shreve, 1991, Theo-
rem 5.7.6, p. 366), we have u(0, x) = Ei [f (X(T ))]. Moreover, u is clearly
a subsolution of the PDE (3.1) for v ∞ , and now the comparison principle
(Fleming and Soner, 2006, Theorem V.9.1, p. 223) yields that Ei [f (X(T ))] =
u(0, x) ≤ v ∞ (0, x) = p∞
                        dyn as claimed.

   In what follows, we show that in the limit α− → 0 where short-selling is
prohibited, the same inequality holds, provided one agents holds the static
market.
                                                                    0,α
Proof of Proposition 4.4. In view of (4.4), we have psta + = Ei [f (X(T ))]− αsT+
since the maximizing set is J = {i}. Using again the Feynman–Kac formula
                                                                         0,α
(Karatzas and Shreve, 1991, Theorem 5.7.6, p. 366), we deduce that psta + =
u(0, x) where u ∈ Cb1,2 is the solution of
                                                   sT
              ∂t u + bi ∂x u + 12 Tr σi2 ∂xx u −      = 0,           u(T, ·) = f.
                                                   α+
In particular, u is a subsolution of the PDE (3.3) for v 0,α+ , and now the com-
parison principle (Fleming and Soner, 2006, Theorem V.9.1, p. 223) yields
      0,α                                0,α
that psta + = u(0, x) ≤ v 0,α+ (0, x) = pdyn+ as desired.

                                              32
   We turn to our example where the static price exceeds the dynamic one
due to the delay effect.

Proofs for Example 4.6. We begin with the static case. For later use, we
consider the more general situation where σ := σ1 = σ2 may be positive
(but constant). We have ei = Ei [f (X(T ))] = x2 + 2xbi T + T 2 + σ 2 T and
thus, as in (4.4), the static price psta is
                                                !
                                1
                                  X         sT
            psta = max                 ei −
                   ∅6=J⊆{1,2} |J|           |J|
                                   i∈J
                 = x2 + σ 2 T + max T 2 − sT /2, T 2 + 2|x|T − sT
                                      

or
                        (
                         x2 + σ 2 T + T 2 − sT /2, |x| ≤ s/4,
               psta   =   2     2       2
                                                                                     (A.9)
                         x + σ T + T + 2|x|T − sT, |x| > s/4

and the portfolios qi are as stated in Example 4.6.
    We turn to the dynamic case and restrict to σ = 0. The limiting equation
for (3.3) is

                  ∂t v + max (|∂x v| − s, −s/2) = 0,        v(T, ·) = f.            (A.10)

In analogy to Proposition 2.3, this can be seen as the Hamilton–Jacobi equa-
tion of a deterministic control problem where the drift µ of the controlled
state dX(t) = µ(t, X(t)) dt can be chosen to be ±1 or 0 and the running cost
is s or s/2, respectively. We can check directly that an optimal control for
this problem is
                           (
                            sign(x), |x| + (T − t)/2 > s/4,
                 µ(t, x) =
                            0,         |x| + (T − t)/2 ≤ s/4,

and then the value function is found to be
                 (
                  (|x| + T − t)2 − s(T − t), |x| + (T − t)/2 > s/4,
       v(t, x) =
                  x2 − s(T − t)/2,           |x| + (T − t)/2 ≤ s/4.

Indeed, v is continuous and the unique viscosity23 solution of (A.10). The
indicated formulas for pdyn −psta = v(0, x)−psta and for the optimal controls
φi follow.
  23
    As is often the case for deterministic control problems, the value function is not C 1,1
and (A.10) has no classical solution.


                                            33
   Next, we prove the continuity of the prices in the small volatility limit.

Proof of Proposition 4.7. For the static case, the formula for pσsta stated
in (A.9) shows that pσsta − p0sta = σ 2 T ↓ 0. Turning to the dynamic case,
we first show that pσdyn = v σ (0, x) is monotone with respect to σ. Since f is
convex, x 7→ v σ (t, x) is convex and thus ∂xx v σ ≥ 0. Given σ1 ≥ σ2 > 0, it
follows that v σ2 is a subsolution to the equation (3.3) for v σ1 , and thus the
comparison principle for parabolic PDEs implies that v σ1 ≥ v σ2 . To see that
v σ (t, x) → v 0 (t, x) and in particular pσdyn → p0dyn , we may again use a general
result on the stability of value functions; cf. (Krylov, 1980, Corollary 3.1.13,
p. 138).

   It remains to provide the calculations for our symmetric example with
α− = α+ = 1.

Proofs for Example 4.9. Following Remark 3.5, the equilibrium price func-
tion in the dynamic case is

             v(t, x) = E[f (x + µτ + ΣBτ )],          where τ := T − t

and Bτ is a centered Gaussian with variance τ . As f (y) = y 2 ,

                        v(t, x) = x2 + 2xµτ + µ2 τ 2 + Σ2 τ

and the optimal portfolios in feedback form are given by

        φi (t, x) = Li v(t, x) = x(bi − bj ) + 12 τ (b2i − b2j ) + 12 (σi2 − σj2 ).

For the static case, we have

                          ei = x2 + 2xbi T + b2i T 2 + σi2 T

and thus
                        e1 + e2              b2 + b22 2
               psta =           = x2 + 2xµT + 1      T + Σ2 T
                           2                    2
as well as
                                ei − ej
qi = T −1 (ei − psta ) = T −1           = x(bi − bj ) + 12 T (b2i − b2j ) + 12 (σi2 − σj2 ).
                                   2




                                            34
B     Adding Linear Costs
In this section, we generalize the cost-of-carry by adding linear terms and
discuss the corresponding changes in our main results. Broadly speaking,
the generalized model does not alter the economic conclusions.
    Indeed, let              (
                                 1  2
                               2α+ y + β+ y,     y ≥ 0,
                      c(y) =     1  2
                                                                      (B.1)
                               2α− y + β− |y|, y < 0,

where β− , β+ ≥ 0 are constants; as discussed in the Introduction, the main
case of interest is β− > 0 and β+ = 0. While this cost function is still strictly
convex, it fails to be differentiable at y = 0 unless β− = β+ = 0.
    Following the proof of Lemma A.2, the optimal portfolio (A.1) then be-
comes                    
                                 i                 i
                         α+ (L v(t, x) − β+ ), L v(t, x) ≥ β+ ,
                         
              φi (t, x) = α− (Li v(t, x) + β− ), Li v(t, x) ≤ −β− ,        (B.2)
                         
                           0,                    else.
                         

That is, there is an interval [−β− , β+ ] of values of Li v(t, x) where it is optimal
to have a zero position, due to the kink in the function c.
    The main PDE (2.5) needs to be adapted correspondingly. Indeed, in-
stead of considering only the group I of agents holding a short position, we
now need to distinguish a group J of agents holding a (strict) long position—
the group J may be smaller than the complement I c . More precisely, the
generalized PDE (2.5) reads as follows (the proof is analogous to Theo-
rem 2.1).

Theorem B.1. The unique equilibrium price function v ∈ Cb1,2 can be char-
acterized as the unique solution of the PDE
                                                                               
∂t v(t, x)+ sup µI,J (t, x)∂x v(t, x)+ 12 Tr Σ2I,J (t, x)∂xx v(t, x)−κI,J (t, x) = 0
           I∩J=∅
                                                                              (B.3)
on [0, T ) ×Rd    with terminal condition v(T, x) = f (x), where the supremum
is taken over all disjoint subsets I, J ⊆ {1, . . . , n} and the coefficients are
defined as

          µI,J (t, x) = |I|α−α+|J|α                      α+
                                      X                          X
                               −
                                    +
                                        bi (t, x) + |I|α− +|J|α+   bi (t, x),
                                        i∈I                                 i∈J

                              α−                                  α+
                                        X                                   X
        Σ2I,J (t, x) =   |I|α− +|J|α+         σi2 (t, x) +   |I|α− +|J|α+         σi2 (t, x),
                                        i∈I                                 i∈J


                                                35
                                     s(t, x) − |I|α− β− + |J|α+ β+
                     κI,J (t, x) =                                 .
                                             |I|α− + |J|α+
    In particular, the additional constants β− , β+ enter only through the
running cost κI,J . It follows that the results on the comparative statics
in Propositions 3.1 and 3.2 remain valid; in addition, the equilibrium price
function v is increasing with respect to β− and decreasing with respect to β+ .
    In the limiting case of zero cost for long positions, we now need to send
α+ → ∞ and β+ → 0. Then, the result of Proposition 3.4 is unchanged; i.e.,
the limiting equilibrium price function is the solution of

                                   bi ∂x v + 12 Tr σi2 ∂xx v = 0.
                                                            
                   ∂t v + sup
                            i∈{1,...,n}

On the other hand, for the limit α− → 0 of infinite cost for shorting, the re-
sult of Proposition 3.6 changes slightly because the long positions are subject
to β+ which becomes an additional running cost in the limiting equation
                                                                       !
                        1
                           X
                                       1     1
                                                X
                                                   2           s
 ∂t v +     sup        |J|   bi ∂x v + 2 Tr |J|   σi ∂xx v −       − β+ = 0.
        ∅6=J⊆{1,...,n}                                       |J|α+
                            i∈J                      i∈J

The results for the static equilibrium problem can be generalized with anal-
ogous changes.


C     Heterogeneous Costs
In this section, we show how the equilibrium of Theorem 2.1 changes if the
cost coefficients α− , α+ depend on the type rather than being the same for all
agents. We write α−   i , αi for the coefficients of type i. The following result
                           +
shows that while the structure of the equilibrium remains similar, agents
with lower costs have a larger influence on the coefficients of the PDE that
determines the equilibrium price.

Theorem C.1. The unique equilibrium price function v ∈ Cb1,2 can be char-
acterized as the unique solution of the PDE (2.5) with coefficients
                                                                             !
                         1              X
                                             i
                                                           X
                                                                  i
     µI (t, x) = P     i +
                           P          i
                                            α− bi (t, x) +       α+ bi (t, x) ,
                     α
                  i∈I −       i∈I c α + i∈I                i∈I c
                                                                                              !
                          1                   X                        X
    Σ2I (t, x)   =P     i +
                            P       i
                                                     i 2
                                                    α− σi (t, x)   +            i 2
                                                                               α+ σi (t, x)       ,
                      α
                   i∈I −     i∈I c α+         i∈I                      i∈I c


                                            36
                                          s(t, x)
                     κI (t, x) = P     i
                                               P     i
                                                       .
                                  i∈I α−    + i∈I c α+
    The proof is analogous to Theorem 2.1. As in Lemma A.2, the optimal
portfolios are given by α± i Li v(t, x). Thus, as expected, types with lower

costs hold larger positions.


References
Berestycki, H., C. Bruggeman, R. Monneau, and J. A. Scheinkman.
  2016.     Bubbles in assets with finite life. Available at SSRN:
  https://ssrn.com/abstract=2617078 .

Carlos, A., L. Neal, and K. Wandschneider. 2006. Dissecting the anatomy of
  exchange alley: The dealings of stockjobbers during and after the South
  Sea bubble. Unpublished paper, University of Illinois .

Cochrane, J. H. 2002. Stocks as money: Convenience yield and the tech-stock
  bubble. Tech. rep., National Bureau of Economic Research.

Dumas, B., A. Kurshev, and R. Uppal. 2009. Equilibrium portfolio strategies
 in the presence of sentiment risk and excess volatility. Journal of Finance
 64 (2):579–629.

Fleming, W. H. and H. M. Soner. 2006. Controlled Markov Processes and
  Viscosity Solutions. Springer, New York, 2nd ed.

Harris, R. 1994. The Bubble Act: Its passage and its effects on business
  organization. The Journal of Economic History 54 (3):610–627.

Harrison, J. M. and D. M. Kreps. 1978. Speculative investor behavior in
  a stock market with heterogeneous expectations. Quarterly Journal of
  Economics 92 (2):323–336.

Hong, H. and J. C. Stein. 2007. Disagreement and the stock market. Journal
  of Economic Perspectives 21 (2):109–128.

Hong, H., J. A. Scheinkman, and W. Xiong. 2006. Asset float and speculative
  bubbles. Journal of Finance 61 (3):1073–1117.

Karatzas, I. and S. E. Shreve. 1991. Brownian Motion and Stochastic Cal-
 culus. Springer, New York, 2nd ed.



                                     37
Kindleberger, C. P. and R. Z. Aliber. 2005. Manias, Panics, and Crashes.
  John Wiley and Sons, Hoboken.

Krylov, N. V. 1980. Controlled Diffusion Processes. Springer, New York.

———. 1987. Nonlinear elliptic and parabolic equations of the second or-
 der, vol. 7 of Mathematics and its Applications (Soviet Series). D. Reidel
 Publishing Co., Dordrecht.

Lewis, M. 2015. The Big Short: Inside the Doomsday Machine. Norton &
  Company, New York.

Muhle-Karbe, J. and M. Nutz. 2016.           A           risk-neutral equilib-
 rium leading to uncertain volatility pricing.           Available at SSRN:
 https://ssrn.com/abstract=2891478 .

Ofek, E. and M. Richardson. 2003. Dotcom mania: The rise and fall of
  internet stock prices. Journal of Finance 58 (3):1113–1138.

Santos, M. S. and M. Woodford. 1997. Rational Asset Pricing Bubbles.
  Econometrica 65 (1):19–57.

Scheinkman, J. A. 2014. Speculation, Trading, and Bubbles. Columbia Uni-
  versity Press, New York.

Scheinkman, J. A. and W. Xiong. 2003. Overconfidence and speculative
  bubbles. Journal of Political Economy 111:1183–1219.

Stroock, D. W. and S. R. S. Varadhan. 1972. On the support of diffusion pro-
  cesses with applications to the strong maximum principle. In Proceedings
  of the Sixth Berkeley Symposium on Mathematical Statistics and Proba-
  bility, Vol. III: Probability theory, 333–359. University of California Press,
  Berkeley.

Xiong, W. and J. Yu. 2011. The Chinese Warrants Bubble. American Eco-
  nomic Review 101 (6):2723–53.




                                      38
