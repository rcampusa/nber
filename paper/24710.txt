                             NBER WORKING PAPER SERIES




         INEQUALITY, BUSINESS CYCLES, AND MONETARY-FISCAL POLICY

                                       Anmol Bhandari
                                        David Evans
                                      Mikhail Golosov
                                      Thomas J. Sargent

                                     Working Paper 24710
                             http://www.nber.org/papers/w24710


                    NATIONAL BUREAU OF ECONOMIC RESEARCH
                             1050 Massachusetts Avenue
                               Cambridge, MA 02138
                                    June 2018




We thank Adrien Auclert, Benjamin Moll, and seminar participants at numerous seminars and
conferences for helpful comments The views expressed herein are those of the authors and do not
necessarily reflect the views of the National Bureau of Economic Research.

NBER working papers are circulated for discussion and comment purposes. They have not been
peer-reviewed or been subject to the review by the NBER Board of Directors that accompanies
official NBER publications.

Â© 2018 by Anmol Bhandari, David Evans, Mikhail Golosov, and Thomas J. Sargent. All rights
reserved. Short sections of text, not to exceed two paragraphs, may be quoted without explicit
permission provided that full credit, including Â© notice, is given to the source.
Inequality, Business Cycles, and Monetary-Fiscal Policy
Anmol Bhandari, David Evans, Mikhail Golosov, and Thomas J. Sargent
NBER Working Paper No. 24710
June 2018
JEL No. C63,E52,E63

                                        ABSTRACT

We study optimal monetary and fiscal policy in a model with heterogeneous agents, incomplete
markets, and nominal rigidities. We develop numerical techniques to approximate Ramsey plans
and apply them to a calibrated economy to compute optimal responses of nominal interest rates
and labor tax rates to aggregate shocks. Responses differ qualitatively from those in a
representative agent economy and are an order of magnitude larger. Taylor rules poorly
approximate the Ramsey optimal nominal interest rate. Conventional price stabilization motives
are swamped by an across person insurance motive that arises from heterogeneity and incomplete
markets.

Anmol Bhandari                                Mikhail Golosov
Department of Economics                       Department of Economics
University of Minnesota                       University of Chicago
1925 Fourth Street South                      1126 E. 59th Street
Minneapolis, MN 55455                         Chicago, IL 60637
and NBER                                      and NBER
bhandari@umn.edu                              golosov@uchicago.edu

David Evans                                   Thomas J. Sargent
Economics Department                          Department of Economics
University of Oregon                          New York University
devans@uoregon.edu                            19 W. 4th Street, 6th Floor
                                              New York, NY 10012
                                              and NBER
                                              thomas.sargent@nyu.edu
1 Introduction
We study monetary and scal policy in a New Keynesian economy populated by

agents who face aggregate and idiosyncratic risks. Agents dier in wages, exposures to

aggregate shocks, holdings of nancial assets, and abilities to trade assets. Incomplete

nancial markets prevent agents from fully insuring risks. Firms are monopolistically

competitive. Price adjustments are costly. We examine how the Ramsey planner's

choices of nominal interest rates, transfers, and proportional labor tax rates respond

to aggregate shocks.

   Analysis of Ramsey policies in settings like ours faces substantial computational

challenges. The aggregate state in a recursive formulation of the Ramsey problem in-

cludes the joint distribution of individual asset holdings and auxiliary promise-keeping

variables that had been chosen by the planner earlier. The law of motion for that

high-dimensional object must be jointly determined with the optimal policies. This

feature renders inapplicable existing numerical techniques that rely on approximating

around a known invariant distribution associated with xed government policies.

   To overcome this challenge, we develop a new computational approach that can

be applied to economies with substantial heterogeneity and does not require knowing

their long-run properties in advance. Our approach builds on a perturbation theory

that uses small-noise expansions with respect to a one-dimensional parameterization

of uncertainty. Each period along a sample path, we apply a perturbation algorithm

evaluated at the current cross-sectional distribution to approximate policy functions.

We use approximate decision rules for the current period to determine outcomes

including the cross-sectional distribution next period. Then we obtain approximations

of next period's decision rules by perturbing around that new distribution. In this

way we update points around which policy functions are approximated along the

equilibrium path.

   Our perturbation approach requires computing derivatives of policy functions

with respect to all state variables. One state variable is a distribution over a multi-

dimensional space of agents' characteristics. Except for very simple models of hetero-

geneity, it is impractical to compute the derivative with respect to this distribution

(i.e., the Frechet derivative). We make progress by showing that our expansion re-

quires only the value of that derivative at a point that corresponds to the optimal

Ramsey response. We derive an expression for this value and show that it is a linear




                                           2
function of variables that are easy to compute. That mathematical structure allows

us to compute approximations to each agent's policy function by solving low dimen-

sional linear systems of equations that are independent across agents. This feature

enables us to solve our model quickly even though it has ample sources of hetero-

geneity. Furthermore, we proceed to show that the same computationally convenient

linear structure is preserved for second- and higher-order expansions. That allows us

to capture precautionary and hedging motives.

   We apply our approach to a textbook New Keynesian sticky price model (see, e.g.,

GalÃ­ (2015)) augmented with heterogeneous agents in the spirit of Bewley-Aiyagari.

Agents' wages are subject to idiosyncratic and aggregate shocks that we calibrate to

match empirical facts about labor earnings documented by Storesletten et al. (2004)

and Guvenen et al. (2014).    We make the initial joint distribution of assets and

wages match cross-sectional moments in the Survey of Consumer Finances. We posit

two types of aggregate shocks: a productivity shock and a shock to the elasticity

of substitution between dierentiated intermediate goods that aects rms' optimal

markups.   Financial markets are incomplete and agents can trade only non-state-

contingent nominal debt. We study two types of Ramsey policies. First, a purely

monetary policy planner is required to keep the labor tax rate xed, an assumption

commonly used with New Keynesian models. In this case, the planner can adjust only

nominal interest rates and a uniform lump-sum transfer.     Second, a more powerful

monetary-scal Ramsey planner can adjust tax rates in addition to interest rates

and transfers.

   Two motives inherited from the Ramsey planner's objective function shape optimal

policies. One is the usual New Keynesian motive to use government policies to oset

ineciencies caused by sticky prices.   A second is a desire to provide insurance.

Without a complete set of Arrow securities, agents cannot hedge risk, so aggregate

shocks aect dierent agents dierentially.   A planner can use monetary and scal

tools to even out the impact of those shocks and provide insurance. In our calibrated

economy, we nd that the insurance motive quantitatively swamps price stability

considerations. That makes optimal policy responses dier signicantly from those in

a representative agent economy where they are primarily driven by the price stability

motive.

   Consider rst the optimal monetary response to a positive markup shock. One

eect of a markup shock is that rms want to increase their prices. Nominal rigidities




                                          3
make that costly. When price stability is its only motive, the planner increases the

nominal interest rate in response to a positive markup shock. That lowers aggregate

demand and marginal costs and thereby reduces rms' incentives to raise prices. GalÃ­

(2015) dubs this optimal response in representative agent New Keynesian economies

as leaning against the wind.   With heterogeneous agents, a markup shock redis-

tributes resources among households. Higher markups shift factor income from wages

to dividends, beneting rm owners and hurting wage recipients. To provide insur-

ance, the planner can decrease interest rates in order to boost aggregate demand and

real wages. The planner does that to oset the negative eect of the markup shock

on wage-earners. The net eect of the markup shock on optimal policy depends on

the relative strengths of the planner's price stability and insurance motives. When

we calibrate the distribution of equity ownership to U.S. data, we nd that a one

standard deviation positive markup shock, which implies a 0.5 percentage point in-

crease in rms' optimal markups, calls for a 0.3 percentage point decrease in the

nominal interest rate versus a 0.05 percentage point increase with a representative

agent calibration.

   Price stability and insurance motives also bring dierent prescriptions for the

optimal scal response.   To ensure price stability in response to a positive markup

shock, the planner wants to lower the marginal tax rate one for one with the shock.

This requires lowering transfers to satisfy the government's budget constraint, making

the average taxes more regressive. To provide insurance, the planner needs to raise

taxes and transfers to increase progressivity and oset the distributionary impact of

the shock. In the calibrated economy, the insurance channel dominates: in response

to a one standard deviation positive markup shock, a planner increases tax rates by

2 percentage points. This scal response comes on top of a cut in nominal interest

rates by about 0.25 percentage points and a 1 percentage point spike in ination.

The tax increase is short-lived, which contrasts with the very persistent eects of

aggregate shocks on optimal tax rates in non-monetary economies, such as Barro

(1979) and Aiyagari et al. (2002).    The reason for this is that deadweight losses

from temporary tax changes in New Keynesian models are lower than those from

permanent tax changes:     rms choose not to adjust nominal prices to temporary

shocks, and consequently a transitory tax change mostly aects tax incidence but not

the labor wedge.

   The insurance motive also substantially aects Ramsey responses to TFP shocks.




                                          4
With heterogeneous agents, eects of productivity shocks are not shared equally: bor-

rowers in state-non-contingent nominal debt are hurt more than lenders. This eect

is further amplied when, as in the data, nancial and wage income are positively

correlated and because labor incomes of low earners are especially adversely aected

by recessions (see Guvenen et al. (2014)). To even out adverse eects of the shock,

the planner cuts nominal interest rates, thereby generating ination and lowering

realized returns on debt holdings. This contrasts with a typical New Keynesian re-

sponse that would maintain stable prices by adjusting nominal rates one-for-one with

the natural rate of interest.
                                  1 In our calibrated economy, we nd that in response

to a productivity shock that lowers output by 3 percentage point, nominal rates are

lowered by 0.6 percentage point.

    In our heterogeneous agent economy, Taylor rules perform substantially worse

than in a representative agent counterpart. Without heterogeneity, the main purpose

of optimal policy is to stabilize ination; Taylor rules meet this objective well. But

they do poorly in the presence of heterogeneity for two reasons. First, in response

to markup shocks it is optimal to move interest rates in the opposite direction from

that prescribed by standard Taylor rules. Second, while Taylor rules make nominal

interest rates and ination as persistent as exogenous shocks, the Ramsey planner

prefers more transient nominal interest rates and ination to provide insurance.

    We also investigate the eects of trading frictions on optimal policy.                 Typical

Bewley-Aiyagari models poorly match observed cross-section distributions of MPCs.

We alter our economy to include a set of agents who can hold assets and consume

their returns but cannot trade them. We choose the distribution of such agents to

match MPC heterogeneity estimated by Jappelli and Pistaferri (2014). We nd that

in such an economy the optimal response of nominal interest rates is smaller than in

our benchmark calibration to markup shocks, but not to productivity shocks. This

outcome emerges because in response to a markup shock the Ramsey planner would

like to alter aggregate demand and real wages. These quantities are determined by

average   actions across agents. Changes in interest rates have a direct eect only on

agents who can trade their assets. By reducing the number of such agents, trading

frictions make monetary policy less eective, an outcome emphasized by Auclert

(2017) and Kaplan et al. (2018). But in response to a TFP shock the planner wants

   1 The natural interest rate is dened as the real interest rates that would prevail in an economy
without nominal rigidities.




                                                 5
to aect returns on nancial assets that are determined by a                marginal   investor and

do not depend on the number of such investors.                 We also nd that the presence

of trading frictions increases the importance of scal instruments like transfers that

directly aect the consumption of high MPC agents.



1.1 Earlier works
A number of contributions characterized and approximated competitive equilibria

with exogenously xed government policies.               These employ one of two broad ap-

proaches that either (i) compute non-linear policies after summarizing the distribu-

tional state variable with a low dimensional vector of its moments, for instance Krusell

and Smith (1998), or (ii) apply a rst-order Taylor expansion of policy functions with

respect to the aggregate shocks around an invariant distribution for an economy with-

out aggregate shocks, for instance Reiter (2009).
                                                            2 Neither approach is suitable for

our problem. First, for us an invariant distribution depends on a key object that we

want to compute, namely, the Ramsey policy. Furthermore, the invariant distribution

under a Ramsey plan for an incomplete markets without aggregate shocks looks very

dierent from the invariant distribution of the same economy with small aggregate

shocks.   In addition, the speed of convergence to this invariant distribution is slow

and the behavior of optimal policies around the invariant distribution diers signi-

cantly from the behavior of policies away from the invariant distribution.
                                                                                       3 Finally, the

state space in an economy under the Ramsey plan is much larger because it includes

promise-keeping variables for the planner in addition to all of states that appear in a

corresponding economy with an arbitrary exogenous government policy.

    Our computational approach uses a one dimensional scaling of uncertainty and a

sequence of small-noise expansions along an equilibrium path. Our approach is most

closely related to Fleming (1971), Fleming and Souganidis (1986), and Anderson et al.

(2012). State variables in the models studied by Anderson et al. are low dimensional,

for example just an aggregate capital stock. In contrast, our state variable is a joint

   2 See Algan et al. (2014) for variants of the Krusell and Smith method and Ahn et al. (2017);
Winberry (2016); Childers et al. (2018) for the variants of the Reiter method.
   3 Such outcomes are evident in Barro (1979), Aiyagari et al. (2002), and Farhi (2010). In Bhandari
et al. (2017a), we consider a simplied version of the economy studied in this paper and show that
while the invariant distribution in a Ramsey problem without aggregate shocks is pinned down by
initial conditions (such as the initial distribution of wealth), the invariant distribution in a corre-
sponding problem with aggregate shocks is determined by motives to hedge such shocks. Therefore,
the invariant distribution is discontinuous in the degree of aggregate risk around zero risk.




                                                  6
distribution over a multi-dimensional domain. That renders direct application of the

Anderson et al. technique computationally infeasible. We overcome this problem by

proving and applying a factorization theorem (see section 3) that allows us to break

one big problem into a manageable collection of much smaller ones. We show how

these ideas can be used to construct second- and higher-order approximations. Our

approach builds on Evans (2015).

      Most studies of optimal policy have been restricted to economies with very lim-

ited or no heterogeneity.         Schmitt-Grohe and Uribe (2004) and Siu (2004) are two

notable quantitative studies of Ramsey policies in representative agent New Keyne-

sian models. Our parameterization follows theirs. So as might be expected, when all

heterogeneity is shut down, we obtain quantitative results similar to theirs. Bilbiie

and Ragot (2017), Nuno and Thomas (2016), Challe (2017), and Debortoli and Gali

(2017) study optimal monetary policy in economies with very limited heterogeneity.

In those settings, the aggregate distribution disappears from the formulation of the

Ramsey problem and the analysis can be done using traditional techniques. Like us,

they emphasize that uninsurable risk creates reasons for a planner to depart from

price stability. A recent paper by Legrand and Ragot (2017) develops a method dif-

ferent from ours to approximate Ramsey allocations in incomplete market economies

with heterogeneity. They apply their method to a neoclassical economy.




2 Environment
Our economy is populated by a continuum of innitely lived households. Individual

i's   preferences over nal consumption good                      {ci,t }t    and hours      {ni,t }t   are ordered by


                                           â
                                                             c1âÎ½   n1+Î³
                                           X                                    
                                                     t
                                      E0         Î²                â                  ,                                 (1)
                                           t=0
                                                             1âÎ½ 1+Î³

where    Et   is an expectations operator conditioned on time                            t information and Î² â (0, 1)
is a time discount factor.

      Agent    i   who works   ni,t   hours supplies              i,t ni,t   units of eective labor, where           i,t
is an exogenous productivity process.                        Eective labor receives nominal wage                   Pt W t ,
where    Pt   is the nominal price of the nal consumption good at time                                 t.   Labor income

is taxed at a proportional labor tax rate                     Î¥t .   All agents receive a uniform lump sum




                                                              7
transfer   Tt Pt .   Agents trade a one-period risk-free nominal bond with price                                                  Qt   in units

of the nal consumption good. We use                                    Pt bi,t , Pt Bt        to denote bond holdings of agent

i   and the debt position of the government respectively.                                                       Î t   denotes the net ination

rate. Finally,       di,t   denotes dividends from intermediate goods producers measured in

units of the nal good. Agent                   i's      budget constraint at                               t   is


                                                                                                                      bi,tâ1
                        ci,t + Qt bi,t = (1 â Î¥t )Wt i,t ni,t + Tt + di,t +                                                 .             (2)
                                                                                                                     1 + Î t

The government's budget constraint at time                                       t   is

                                                                                         Z
                                         1
                            GÌ + Tt +        Btâ1 = Î¥t Wt                                     i,t ni,t di + Qt Bt ,
                                      1 + Î t                                              i


where   GÌ   is the level of non-transfer expenditures.

     A nal good        Yt is produced by competitive rms                                           that use a continuum of inter-

mediate goods         {yt (j)}jâ[0,1] in a production function

                                                         Z     1                             Î¦Î¦â1
                                                                                                 t
                                                                              Î¦t â1             t
                                               Yt =                 yt (j)     Î¦t     dj                    ,
                                                            0


where the elasticity of substitution                       Î¦t       is stochastic. Final good producers take nal

good prices     Pt    and intermediate goods prices                               {pt (j)}j             as given and solve


                                               Z    1                            Î¦Î¦â1
                                                                                     t              Z       1
                                                                    Î¦t â1            t
                             max          Pt             yt (j)      Î¦t     dj                â                 pt (j)yt (j)dj.            (3)
                        {yt (j)}jâ[0,1]          0                                                      0


Outcomes of optimization problem (3) are a demand function for intermediate goods

                                                                                 âÎ¦t
                                                                         pt (j)
                                                yt (j) =                                      Yt ,
                                                                          Pt

and a nominal price satisfying

                                                                                              1
                                                         Z         1                      1âÎ¦
                                                                                                    t
                                                                                 1âÎ¦t
                                               Pt =                     pt (j)                          .
                                                                0




                                                                          8
Intermediate goods             yt (j)   are produced by monopolists with production function

                                                                    Î±
                                                    yt (j) = nD
                                                            
                                                              t (j)    ,

where       nD                                   Î± â (0, 1]. These intermediate goods
             t (j) is eective labor hired by rm j                    and
                                                              âÎ¦t
                                                        pt (j)
monopolists face downward sloping demand curves
                                                         Pt
                                                                    Yt and choose prices
                                                                                        2
                                                                              pt (j)
pt (j) while bearing quadratic Rotemberg (1982) price adjustment costs Ï2 ptâ1    (j)
                                                                                      â 1
measured in units of the nal consumption good. Firm j chooses prices {pt (j)}t that

solve
                                            ï£±
                                        âÎ½ ï£²              âÎ¦t
                                                                       ï£®
                                                                                                  âÎ¦t        ! 1âÎ± ï£¹
                                                                                                              Î±
                     X             Ct          pt (j)             pt (j) Wt              pt (j)
         max E0           Î²t                                 Yt ï£°       â                                Yt         ï£»
        {pt (j)}t
                      t
                                   C0        ï£³ Pt                  Pt      Î±              Pt
                                                                      2 )
                                                      Ï   pt (j)
                                                    â             â1        ,                                           (4)
                                                      2 ptâ1 (j)

where we have imposed that each rm values prot streams with a stochastic discount

                                                                     Ct = ci,t di.4
                                                                          R
factor that is driven by aggregate consumption

    In a symmetric equilibrium,                     pt (j) = Pt , yt (j) = Yt for all j .            Market clearing

conditions in labor, goods, and bond markets are:

                                        Z
                                                                                         Ï 2
                               Nt =         i,t ni,t di,       Dt = Yt â Wt Nt â         Î ,                            (5)
                                                                                         2 t

                                                     yt (j) = Yt = NtÎ± ,                                                (6)

                                                                   Ï
                                                  Ct + GÌ = Yt â Î 2t ,                                                  (7)
                                                                   2
                                                     Z
                                                        bi,t di = Bt .                                                  (8)
                                                            i

    There are aggregate and idiosyncratic shocks. Aggregate shocks are a markup

shock
        5    Î¦t   and an aggregate productivity                    Ît .    The markup shock follows an AR(1)

   4 In economies with heterogeneous agents and incomplete markets one has to take a stand on
how rms are valued.           Using stochastic discount factor induced by aggregate consumption makes
our exposition most transparent. We have experimented with other alternatives such as weighted
means of individual intertemporal marginal rates of substitutions and found them to have negligible
eects on the main results.
   5 The New Keynesian literature has utilized markup or cost-push shocks to account for patterns
observed during business cycles (see, e.g., Smets and Wouters (2007)). The literature has proceeded
to study implications of those shocks for optimal monetary policy in a representative agent framework




                                                                   9
stochastic process



                                  ln Î¦t = ÏÎ¦ ln Î¦tâ1 + (1 â ÏÎ¦ ) ln Î¦Ì + EÎ¦,t ,

where   EÎ¦,t     is mean-zero and i.i.d. over time. We consider two alternative specication

for productivity shocks. In the rst specication, we simply assume that                           ln Ît    follows

an AR(1) process described by



                                 ln Ît = ÏÎ ln Îtâ1 + (1 â ÏÎ ) ln ÎÌ + EÎ,t ,                                   (9a)



where    EÎ,t is mean zero and i.i.d. over time. In                the second specication we assume

that   ln Ît follows a growth rate shock process

                                               ln Ît = ln Îtâ1 + EÎ,t ,                                          (9b)



where again       EÎ,t is mean zero and i.i.d.        over time. Under the growth rate specication,

we scale government expenditures at time                    t to equal Gt = GÌÎt where GÌ is a non-
negative constant and menu cost so that                  Ït = ÏÌÎt for some non-negative constant ÏÌ
to achieve stationarity.
                                  6

    Individual productivity             i,t   follows a stochastic process described by



                                         ln i,t = ln Ît + ln Î¸i,t + Îµ,i,t ,                                    (10)



                                 ln Î¸i,t = ÏÎ¸ ln Î¸i,tâ1 + f (Î¸i,tâ1 ) EÎ,t + ÎµÎ¸,i,t ,                            (11)


where   Îµ,i,t   and   ÎµÎ¸,i,t   are mean-zero, uncorrelated with each other and i.i.d. over time.

This specication of idiosyncratic shocks builds on formulations of wage dynamics

used by Storesletten et al. (2001) and Low et al. (2010)) in which                      Îµ,i,t   and   ÎµÎ¸,i,t   corre-

spond to transitory and persistent shocks to individual productivities. We augment

this specication with a function               f (Î¸i,tâ1 ) that makes an aggregate productivity shock
have dierent loadings for agents with dierent earning histories. Doing that allows

(see, e.g., Clarida et al. (2001), GalÃ­ (2015), Woodford (2003)). As in GalÃ­ (2015), we interpret these
shocks as changes in desired markups arising from uctuations in the elasticity of substitution
parameter   Î¦.    We leave for future work the study of other shocks such as wage markups.
   6 General insights are similar from these two alternative specications, but the i.i.d growth speci-
cation provides a convenient benchmark to study monetary policy because without market incom-
pleteness and nominal frictions, the real interest rate is constant.




                                                         10
us to capture some of the facts documented by Guvenen et al. (2014).

    We normalize the initial price level                       Pâ1 = 1.       Agent    i   in period 0 is characterized

by a triple         (Î¸i,â1 , bi,â1 , si ),   where   Î¸i   is   agent i's      persistent productivity component,

bi,â1   the initial holding of debt, and                  si    the ownership of equity. Agent                 i's   dividends

in period       t   are given by        di,t = si Dt .      This imposes that agents do not trade equity

and that       si   is a permanent characteristic. We refer to the collection                              {Î¸i,â1 , bi,â1 , si }i
as an initial condition.


Denition 1.             Given an initial condition and a monetary-scal policy                               {Qt , Î¥t , Tt }t , a
                                                            
competitive equilibrium is a sequence                           {ci,t , ni,t , bi,t }i , Ct , Nt , Bt , Wt , Pt , Yt , Dt t such
that:      {ci,t , ni,t , bi,t }i,t maximize (1) subject to (2) and natural debt limits; (ii)
         (i)

nal goods rms choose {yt (j)}j to maximize (3); (iii) intermediate goods producers'

prices solve (4) and satisfy pt (j) = Pt ; and (iv) market clearing conditions (5)-(8) are

satised.


A utilitarian Ramsey planner orders allocations by


                                                â
                                                            "               #
                                                                c1âÎ½   n1+Î³
                                              Z X
                                                                 i,t    i,t
                                         E0            Î²t            â        di.                                           (12)
                                                 t=0
                                                                1âÎ½ 1+Î³

Denition 2. Given an initial condition and a constant tax sequence {Î¥t }t satisfying
Î¥t = Î¥Ì for some Î¥Ì, an optimal monetary policy                            is a sequence      {Qt , Tt } t that supports a
competitive equilibrium allocation that maximizes (12). Given an initial condition,                                           an
optimal monetary-scal policy                  is a sequence           {Qt , Î¥t , Tt }t    that supports a competitive

equilibrium allocation that maximizes (12).                              A maximizing monetary or monetary-

scal policy is called the              Ramsey plan ; an associated allocation is called the Ramsey
allocation.
    A few remarks about our baseline formulation.                                   We begin by assuming natural

debt limits. This provides us with a useful benchmark and also avoids issues about

normative implications in economies with ad hoc debt limits being sensitive to as-

sumptions one makes on a government's ability to enforce debt and tax repayments.
                                                                                                                                7

   7 In Bhandari et al. (2017b) we provide a comprehensive treatment of a Ramsey problem with ad
hoc debt limits. In the economy with ad hoc debt limits the planner can simply choose the timing
of transfers to undo such ad hoc debt limits. If the planner enforces debt and tax liabilities equally
then welfare in the economies with ad hoc and natural debt limits coincides. Welfare can sometimes
be improved in the economy with ad hoc debt limits if the planner commits not to enforce private
debt contracts (see also Yared (2013) for a related result).




                                                                  11
After presenting results with natural debt limits, we introduce credit market frictions

in section 6. We discipline these frictions by matching observed heterogeneity in the

marginal propensities to consume and study how these frictions aect the Ramsey

plans. Assuming that equity ownership is xed provides us with a simple way to cal-

ibrate portfolio shares.
                                   8 We have distinguished between purely monetary and mixed

monetary-scal policies because doing so allows us to respect a common argument

that institutional constraints make it dicult to adjust tax rates in response to typical

business cycle shocks, leaving nominal interest rates as the government's only tool for

ameliorating such shocks. We capture that argument by studying optimal monetary

policy when tax rates              {Î¥t }t   are xed at some level            Î¥Ì.   The monetary-scal Ramsey

plan evaluates the optimal policies when this restriction is dropped.




3 Solution method
Following steps used by Lucas and Stokey (1983), Schmitt-Grohe and Uribe (2004),

and others it is straightforward to establish that a monetary-scal policy                              {Qt , Î¥t , Tt }t
      
and       {ci,t , ni,t , bi,t }i , Ct , Nt , Wt , Pt , Yt , Dt   t
                                                                     are a competitive equilibrium if and only

if they satisfy (2), (5)-(7) and


                                                                       Î³
                                              (1 â Î¥t )Wt i,t câÎ½
                                                                i,t = ni,t ,                                       (13)


                             âÎ½                         â1
                       Qtâ1 ci,tâ1 = Etâ1 câÎ½
                                           i,t (1 + Î t )   ,                                                       (14)

                                                    âÎ½
 1                Wt                               Ct+1
   Yt 1 â Î¦t 1 â           â Î t (1 + Î t ) + Î²Et              Î t+1 (1 + Î t+1 ) = 0.                                 (15)
 Ï               Î±NtÎ±â1                             Ct
To formulate the Ramsey problem, it is convenient to rewrite some of these con-

straints.       After dening          ai,t â¡ bi,t Qt câÎ½
                                                       i,t ,         substituting for   Qt   and   (1 â Î¥t )Wt ,   and

solving the budget constraint forward, equations (2) can be expressed as a sequence

of measurability constraints inherited from the risk-free nature of one-period debt:

                                     "â                                                    #
      ai,tâ1 câÎ½
              i,t (1 + Î t )
                             â1       X
                                                        âÎ½                         1+Î³
                                          Î² s c1âÎ½
                                                                                         
                                = Et           i,t+s â ci,t+s (Tt+s + si Dt+s ) â ni,t+s                           (16)
      Î²Etâ1 câÎ½i,t (1 + Î  t )â1
                                      s=0

   8 More generally, one needs some adjustment costs to reconcile agents' portfolio choices with those
observed in data. Exploring normative implications of alternative cost specications is interesting
but outside the scope of the paper.




                                                                 12
fort â¥ 1 as well as a similar constraint at t = 0 in which the left hand side is replaced
            âÎ½
with bi,â1 ci,0 . Dene
                                         1/Î½   ci,t
                                       mi,t â¡                                        (17)
                                               Ct
and rewrite Euler equation (14) as


                                 âÎ½
                                Ctâ1 Qtâ1 = Î²mi,tâ1 Etâ1 câÎ½           â1
                                                          i,t (1 + Î t ) .                                   (18)



Variable   mi,t    can be interpreted as a time-t Pareto-Negishi weight of agent                     i.   It will

serve as a state variable in a recursive formulation of the Ramsey problem.

      We formulate the Ramsey problem using ideas of Marcet and Marimon (2011). Let

Î² t Ît , Î² t Î¾i,t be Lagrange multipliers    on (15) and (16), respectively. Dene                Âµi,0 â¡ Î¾i,0 ,
Âµi,t = Âµi,tâ1 + Î¾i,t . Given an initial      condition    {Î¸i,â1 , bi,â1 , si }i ,   and   Îâ1   = ai,â1 = 0,
the Ramsey monetary-scal problem solves:


                   â
                              (Z "                  !
                   X                 c1âÎ½
                                      i,t   n1+Î³
                                             i,t                                       1+Î³
                         Î²t                                1âÎ½
                                                               â câÎ½
                                                                                           
      inf sup E0                          â             + ci,t    i,t (Tt + si Dt ) â ni,t   Âµi,t
                   t=0
                                     1âÎ½ 1+Î³
                 ai,tâ1 câÎ½   (1 + Î t )â1 Î¾i,t
              â          i,t âÎ½              + (1 â Î²)câÎ½
                                                         i,0 bi,â1 Âµi,0 di                                  (19)
                Î²Etâ1 ci,t (1 + Î t )â1
                                                                                   
                     âÎ½                         Wt                         âÎ½
              + Ît Ct Yt 1 â Î¦t 1 â                      + (Îtâ1 â Ît )Ct ÏÎ t (1 + Î t ) ,
                                               Î±NtÎ±â1

subject to (5), (6), (7), (13), (17), (18) and               Âµi,t = Âµi,tâ1 + Î¾i,t , where the sup is
                     
with respect to {ci,t , ni,t , bi,t }i , Ct , Nt , Bt , Wt , Pt , Yt , Dt , and inf is with respect to
                                                                          t
the multipliers {Âµi,t , Ît }t . The Ramsey monetary problem is the same except the

sequence {Î¥t }t is exogenously xed.

     We call the subsequence of the Ramsey plan for t â¥ 1 a continuation Ramsey plan.

It is recursive in aggregate states (Îtâ1 , Î¦tâ1 ), the Lagrange multiplier on the Phillips

curve equation Îtâ1 , and the joint distribution over zi,tâ1 â¡ (mi,tâ1 , Âµi,tâ1 , Î¸i,tâ1 , si )

that we denote by â¦tâ1 . Time t policy functions for aggregate variables depend on

(Îtâ1 , Î¦tâ1 , â¦tâ1 , Îtâ1 , EÎ,t , EÎ¦,t ) while time t policy functions for individual variables
also depend on (zi,tâ1 , Îµ,i,t , ÎµÎ¸,i,t ). The Ramsey plan includes choices at time 0 and

solves time t = 0 rst-order conditions subject to the restriction that future variables

conform to the continuation Ramsey plan.

      Dependence of policy functions on the history-dependent endogenous distribu-




                                                   13
tion   â¦   makes computing the Ramsey plan challenging.                The law of motion of the

high-dimensional state variable         â¦ depends on optimal monetary-scal policies.               As we

discussed in the introduction, a key diculty is that before optimal policies are com-

puted little can be said about properties of the stochastic process              â¦t   and its invariant

distribution. This structure renders inapplicable computational techniques for solv-

ing heterogeneous agent economies that approximate around a stationary distribution

associated a xed set of government policies.

    To overcome this diculty we develop a new computational method that builds

on the perturbation theory of Fleming (1971), Fleming and Souganidis (1986), and

Anderson et al. (2012) as well as on Evans (2015). The method constructs a sequence

of small-noise expansions of policy functions around pertinent time                   t   state variables.

Using this approach, we rst approximate optimal policy functions at time                       t   around

the time-t state including         â¦tâ1 ,   then use those to compute    â¦t ,   and nally construct

approximations of optimal policy functions at time             t+1    around the time-t         +1   state

including   â¦t .   To begin, we illustrate our approach in a simple setting. We next extend

things to the more general setting of section 2. Detailed derivations, proofs, and other

details are relegated to the online appendix where we also show how our method can

be used to solve for a competitive equilibrium with xed government policies and

we use that economy to test the accuracy of our approximations by comparing our

solution to one obtained with standard numerical methods.



3.1 Approximations in the simple economy
We focus here on a special case designed to show the main steps and insights trans-

parently. We assume that all shocks are i.i.d. and that there is a single non-trivial

aggregate shock       E   and a single non-trivial idiosyncratic shock      Îµ   (say,   EÎ,t and ÎµÎ¸,i,t ).
Furthermore, we assume that agents have identical equity holdings                     si = 1, in which
case one can show that   Ît = 0 for all t. These assumptions make â¦ the only aggregate
state variable for the t â¥ 1 continuation Ramsey plan; â¦ becomes a distribution over

the two-dimensional space of z = (m, Âµ). This is the minimal structure needed to

illustrate our method.
                             9

   9 The distribution of states   â¦ is dened over a two-dimensional space because the Ramsey planner
needs to keep track of two variables for each agent: a variable capturing agent's current assets and
a variable capturing past implicit promises of the planner which comes from the need to search for
optimal policies. In the recursive formulation of competitive equilibrium with xed policies,        â¦   is a
distribution over a one dimensional space of agents' Pareto-Negishi weights (or, equivalently, their




                                                    14
     We use tildes to denote policy functions in the                                 tâ¥1       continuation Ramsey plan.

The aggregate policy functions consist of all upper-case choice variables in problem

(19) as well as Lagrange multipliers on aggregate resource constraints (5)-(7).                                                      We

denote the vector of these functions by                               XÌ .   Individual policy functions consist of

all lower-case choice variables in problem (19) as well as Lagrange multipliers on

individual constraints (13), (17), (18); we denote the vector of these variables by                                              xÌ.
Policy functions for individual states                      zÌ   are included in the vector                  xÌ   and we    dene p

to be the selection matrix that returns                          zÌ   from   xÌ,   i.e.,   zÌ = pxÌ.
     Consider the full set of rst-order optimality conditions to problem (19). These

conditions can be split into two groups.                              The rst group consists of the optimality

conditions for individual policy functions. They show the relationship between current

period individual and aggregate policy functions                               xÌ, XÌ ,     current period realizations of

shocks
  h     Îµ, E, and expectations of currenti and next period policy functions E [xÌ|z, â¦],
E xÌ(Â·, Â·, zÌ(z, â¦, Îµ, E), â¦Ì(â¦, E))|Îµ, E, z, â¦ . To keep the notation short, we denote the
two expectations terms by Eâ xÌ and E+ xÌ respectively.
                                                               10 These conditions can be

written as
                                                                                     
                                         F Eâ xÌ, xÌ, E+ xÌ, XÌ, Îµ, E, z = 0                                                     (20)


for some mapping            F.         The remaining optimality conditions are various aggregate

feasibility constraints and rst-order conditions with respect to                                            XÌ    that show the

relationship between aggregate policy functions and integrals of individual policy

functions. They can be written as

                                                      Z                      
                                                  R        xÌdâ¦, XÌ, E             =0                                            (21)



for some mapping            R.       The law of motion for the distribution                        â¦   is

                                            Z
                   â¦
                   e (E, â¦) (z) =                 Î¹ (zÌ (Îµ, E, y, â¦) â¤ z) d Pr (Îµ) dâ¦ (y)                     âz,                (22)



where     Î¹ (zÌ â¤ z)   is   1    if all elements of              zÌ    are less than all elements of                   z,   and zero

otherwise. Equations (20)-(22) jointly determine the Ramsey allocation.

asset holdings).
  10 Strictly speaking, if      xÌ   consists of all lower-case choice variables and multipliers in problem (19),
then the relevant object is           Eâ f (xÌ)   and   E+ g(xÌ)      for some transformations         f    and   g.   Our exposition
is without loss of generality once we expand the denition of                          xÌ   to also include variables       f (xÌ)   and
g (xÌ).



                                                                      15
   To approximate policy functions, we consider a family of economies parameter-

ized by a positive scalar          Ï               Îµ, E . We construct rst-, second-,
                                       that scales all shocks

and higher-order approximations with respect to Ï evaluated at Ï = 0. Since, the

parameter Ï aects policy functions directly in addition to scaled shocks (ÏÎµ, ÏE), we

record it as an extra argument. The rst-order expansion of XÌ reads

                                                                     
         XÌ(ÏE, â¦; Ï) = XÌ(0, â¦; 0) + Ï XÌE (0, â¦; 0)E + XÌÏ (0, â¦; 0) + O(Ï 2 )

                      â¡ XÌ + Ï XÌE E + XÌÏ + O(Ï 2 ),
                                           
                                                                                                     (23)



where   XÌE   and   XÌÏ   are derivatives with respect to the rst and third arguments, and

bars indicate that functions are evaluated at                (0, â¦; 0).   The same convention applies

to the law of motion        â¦
                            e (ÏE, â¦; Ï),      e.g.   â¦Ì = â¦
                                                           e (0, â¦; 0).   Individual policy functions   xÌ
are expanded analogously as



          xÌ(ÏÎµ, ÏE, z, â¦; Ï) = xÌ(z) + Ï (xÌÎµ (z)Îµ + xÌE (z)E + xÌÏ (z)) + O(Ï 2 ).                 (24)



We describe next how to obtain the coecients that appear in these expansions by

using the implicit function theorem.



3.1.1 Points of expansion and zeroth-order terms
Our point of expansion         Ï=0        is a deterministic economy. It is easy to see that the

law of motion for distribution            â¦t   is particularly simple in this case: if the economy

starts with any given       â¦0 ,   it remains with that distribution forever. Formally,


Lemma 1. For any â¦, policy functions satisfy zÌ(z) = z for any z and therefore
â¦Ì(â¦) = â¦.

   The fact that the distribution remains stationary at                   Ï=0   simplies our analysis.

Although at rst sight this result appears to be sensitive to the simplifying assump-

tions made in this section, we show later that by a careful choice of the individual

state variables one can obtain an analogue of lemma 1 even if the                      Ï = 0   economy

features non-trivial deterministic dynamics.

   Lemma 1 implies that the expectation of next period's functions is simply equal

to their current period value at the point of expansion. Therefore, we can nd                  XÌ   and




                                                        16
xÌ(z)   as a solution to a non-linear system of equations

                                                               Z                    
                                              
         F xÌ(z), xÌ(z), xÌ(z), XÌ, 0, 0, z = 0,           R        xÌ(z)dâ¦(z), XÌ, 0 = 0.

This system can be solved eciently using standard root nding algorithms.

    Using the zeroth-order terms       XÌxÌ(z), we construct several objects that will be
                                             and

used to nd higher-order terms. Let Rx and RX be the derivatives of the R mapping

with respect to its rst two arguments, and let RE be the derivative with respect to the

scaled shock ÏE , all evaluated Ï = 0. Similarly, let subscripts xâ, x, x+, X , Îµ, E and

z denote the analogous derivatives of F with respect to each of its arguments. From
                                                                              â1
the implicit function theorem we have xÌz (z) = [Fxâ (z) + Fx (z) + Fx+ (z)]     Fz (z).

3.1.2 First-order terms
That aggregate shocks in period          t   aect the distributional state      â¦   in period   t+1
makes calculating mathematical expectations of next period variables in equation

(20) hard. A principal contribution of our approach is to simplify calculation of these

expectations. The rst step towards this goal is to use lemma 1 to show that

  h                                             i                                       
 E xÌ(Â·, Â·, zÌ(z, â¦, Îµ, E), â¦Ì(â¦, E))|Îµ, E, z, â¦ =xÌ(z) + xÌz (z)pxÌE (z) + â xÌ(z) Â· â¦ÌE ÏE

                                                        + [xÌz (z)pxÌÎµ (z)] ÏÎµ + xÌÏ (z)Ï + O(Ï 2 ),
                                  E [xÌ(Â·, Â·, z, â¦)] =xÌ(z) + xÌÏ (z)Ï + O(Ï 2 ),

where   â xÌ is the Frechet derivative of xÌ with respect to the distribution â¦.11 The
term â xÌ(z) Â· â¦ÌE tells how current period's shock E inuences the expectation of next

period's policy function through its eect on next period's distribution â¦. Formally,

â¦ÌE is the derivative of the law of motion (22) with respect to ÏE evaluated at Ï = 0
and â xÌ(z) Â· â¦ÌE is the Frechet derivative â xÌ(z) evaluated at the point â¦ÌE .

    The derivative â xÌ(Â·) is high dimensional. Calculating it explicitly would be infea-

sible when the state space is large. Luckily, we need to know the derivative only at

  11 A Frechet derivativeâ xÌ(z) is a linear operator from the space of distributions â¦ to R with a
                       kxÌ(z,â¦+â)âxÌ(z,â¦)ââ xÌ(z)Â·âk
property that limkâkâ0                               = 0. It can be found by xing a feasible direction
                                    kâk
â and calculating a directional (Gateaux) derivative since â xÌ(z) Â· â = limÎ±â0 xÌ(z,â¦+Î±â)âxÌ(z,â¦)
                                                                                             Î±         .
See Chapter 7 of Luenberger (1997). Throughout, we assume that â vanishes on the boundaries of
its domain,   R+ Ã R.



                                                   17
the point     â¦ÌE . The next theorem shows that there exists                a simple linear relationship

between      â xÌ Â· â¦ÌE and xÌE that can be solved explicitly.

Theorem 1. (Factorization) From the zeroth-order expansion one can construct
matrices A(z) and C(z) such that

                                             â xÌ(z) = C(z)â XÌ,                                        (25a)
                                                           Z
                      â xÌ(z) Â· â¦ÌE = C(z)â XÌ Â· â¦ÌE = C(z) A(y)xÌE (y)dâ¦ (y) .                         (25b)
                                          | {z }
                                               XÌE0


Proof.   Evaluate the Frechet derivatives of (20) and (21) at an arbitrary point                       â    and

use the fact that       â â¦Ì = 1    from lemma 1 to show that



                  (Fxâ (z) + Fx (z) + Fx+ (z)) â xÌ(z) Â· â + FX (z)â XÌ Â· â = 0,                        (26a)
                                      Z                
                                 Rx â    xÌ (y) dâ¦ (y) Â· â + RX â XÌ Â· â = 0.                           (26b)



The rst equation yields (25a) with            C(z) = â (Fxâ (z) + Fx (z) + Fx+ (z))â1 FX (z).
   By calculating directional            derivatives in direction â we can show that

                 Z                     Z                       Z
             â        xÌ (y) dâ¦ (y) Â· â = (â xÌ (y) Â· â) dâ¦ (y) + xÌ (y) dâ (y) .                           (27)



We want to evaluate the integral on the right side at                   â = â¦ÌE .   Dierentiating (22) at

any   z = (m, Âµ)       and applying lemma 1, we show that

                           Z                                        Z
      â¦ÌE (m, Âµ) = â                mÌE (m, y2 ) Ï (m, y2 ) dy2 â           ÂµÌE (y1 , Âµ) Ï (y1 , Âµ) dy1 ,
                            y2 â¤Âµ                                   y1 â¤m


where    Ï   is the density of      â¦.   The density of    â¦ÌE (m, Âµ)    is then


                                   d                          d
                 ÏÌE (m, Âµ) = â      [mÌE (m, Âµ) Ï (m, Âµ)] â    [ÂµÌE (m, Âµ) Ï (m, Âµ)] .
                                  dm                         dÂµ




                                                      18
Substitute this equation and (25a) into (27) to get

     Z                         Z                         Z
                                                                  d
 â          xÌ (y) dâ¦ (y) Â· â¦ÌE = C(y)â XÌ Â· â¦ÌE dâ¦ (y) â xÌ (y)     [mÌE (y) Ï (y)] dy
                                                                 dm
                                   Z
                                           d
                                 â xÌ (y)     [ÂµÌE (y) Ï (y)] dy
                                          dÂµ
                                 Z                         Z
                                = C(y)â XÌ Â· â¦ÌE dâ¦ (y) + xÌz (y) pxÌE (y) dâ¦ (y) ,

where the second equality is obtained using integration by parts.                        Substitute this

expression into (26b) and solve for         â XÌ Â· â¦ÌE    to obtain

                                                    Z
                            XÌE0   â¡ â XÌ Â· â¦ÌE =        A(y)xÌE (y)dâ¦ (y) ,                        (28)


                        R                        â1
where     A(z) = â Rx       C(y)dâ¦ (y) + RX              Rx xÌz (z)p.   Together with (25a) this proves

(25b).


     The factorization theorem makes our approach computationally tractable when

state space   â¦ is large. To see its signicance, suppose that we approximate â¦ on a
grid with K points. In that case, the Frechet derivative of individual policy func-
                         2
tions â xÌ(Â·) contains K unknown elements. Since the number of the unknowns grows

exponentially with the number K of grid points, calculating this derivative directly

would be infeasible for large K . Theorem 1 circumvents this problem by providing an

explicit formula for the value of the derivative â xÌ(Â·) at the point â¦ÌE as a linear func-

tion of (yet unknown) xÌE (z) weighted with coecients given by matrices A(z), C(z).

Matrices A(z), C(z) can be calculated quickly from the zeroth-order terms since the

only non-linear operation required is inversion of matrices of dimension no greater

than     max {dim x, dim X}.       Because   A(z), C(z)      can be calculated for dierent values

of   z   independently, the algorithm is easy to parallelize, a good thing when               K   is very

large.

     An economic intuition underlies derivations in the proof of theorem 1. In com-

petitive equilibrium agents care about the distribution                 â¦   only to the extent it aects

aggregate prices and income. Thus, the eect from any perturbation of distribution

â¦    on individual variables,   â xÌ, can   be factorized into the eect of that perturbation

on aggregate variables,      â XÌ , and a    known loading matrix            C   that captures how indi-

vidual variables respond to changes in the aggregates. Equation (25a) captures this




                                                    19
relationship. Feasibility and market clearing constraints impose a tight relationship

between individual policy function responses to aggregate shocks in the current pe-

riod,   xÌE (z),    and expected future changes in the aggregates,                       XÌE0 .    Conceptually, this

relationship is the a xed point problem and we derive an explicit solution in equation

(28). Together with (25a), this allows us to nd                   â xÌÂ· â¦ÌE   in terms of         xÌE   without having

to compute         â xÌ(Â·).
     We can now take the rst-order expansion of (20) and (21), apply the factorization

theorem, and use the method of undetermined coecients to nd                                     XÌE , XÌÏ , xÌE , xÌÎµ , xÌÏ .
We illustrate how this is done for               XÌE , xÌE .   Consider the rst-order expansion of the

left hand side of equations (20) and (21). Because this expansion should be equal to

0   for all values of         E,   the matrices of coecients that multiply                  E     should equal         0   as

well. Solving for these matrices explicitly, we obtain a system of equations



    (Fx (z) + Fx+ (z)xÌz (z)p) xÌE (z) + Fx+ (z)C(z)XÌE0 + FX (z)XÌ E + FE (z) = 0,                                    (29a)
      Z
    Rx xÌE (y)dâ¦ (y) + RX XÌ E + RE = 0.                                                                              (29b)



This is a linear system with unknowns                 XÌE , xÌE   after we substitute the denition of                   XÌE0
from (28). Solving the discretized version directly would require inverting a square

matrix of dimension                K dim x,   which is impractical when the dimension of the grid

(K ) is large. A more computationally ecient approach is to split this system into

K   independent systems of dimensions                  dim x      that can be solved in parallel. To this

end, use equation (29a) to calculate matrices                     D0 (z)   and   D1 (z)      that dene the linear

relationship
                                                                   h                iT
                                   xÌE (z) = D0 (z) + D1 (z) Â·         XÌ E XÌE0         .

Then use this relationship to substitute into equations (29b) and (28) to nd                                           XÌ E .
Values of    xÌE (z)    can be found either by substituting back into the previous equation

or from (25a).

     The remaining unknown rst-order coecients                       XÌÏ , xÌÎµ , xÌÏ   can be found using sim-

ilar steps. The steps for computing them are much simpler since they do not depend

on the Frechet derivative             â xÌ.




                                                          20
3.1.3 Second- and higher-order expansions
Our approach extends to second- and higher-order expansions while preserving the

computationally convenient linear structure. The key insight is that the factorization

theorem generalizes to higher order expansions. The analogue of equation (25a) holds

for any order of perturbations of          â¦.    This allows us to solve for higher order analogues

of   â xÌ Â· â¦ÌE   explicitly as weighted sums of higher-order coecients               xÌEE , xÌEÏ , xÌÏÏ . . .,
with weights known from lower-order expansions.                        We then can form higher order

analogues of the system of equations (29). As before, the mathematical structure of

these equations allows us to split one large system of equations into a large number of

low dimensional linear problems that can be solved fast and simultaneously. Formal

proofs and constructions are notation-intensive but the steps mirror those in section

3.1.2 and we conne them to the online appendix.



3.2 Approximations in the general case
We now turn to the economy described in section 2. For concreteness we focus on the

case when         ln Ît follows an AR(1) process (9a).           This economy has two dierences from

the section 3.1 simpler economy. First, since shocks are persistent, policies also depend

on previous period values            Î = (Î, Î¦)      and    Î¸.    Second, the Philips curve constraint

(15) generally binds and its Lagrange multiplier                Î becomes a state variable. Thus, in
the general economy           z = (m, Âµ, s, Î¸)     is the   individual state, â¦ is a distribution over

this four-dimensional state space, and the aggregate and individual policy functions

are mappings           XÌ (E, â¦, Î, Î)   and   xÌ (E, Îµ, z, â¦, Î, Î)   respectively.

      To make progress, we assume that persistence of idiosyncratic shocks                    ÏÎ¸   is close to

1 so that we can represent it as           ÏÎ¸ = 1 â ÏÏ      for some    Ï â¥ 0.   We follow the approach

of the previous section by considering a sequence of economies with scaled shocks                          ÏE
and    ÏÎµ   and persistence        1 â ÏÏ. We take their rst- and second-order expansion with
respect to        Ï   evaluated   at Ï = 0 around any given distribution â¦. Let XÌ (Î, Î) and

xÌ (z, Î, Î)      be their zeroth-order values.

      Our general economy can have non-trivial dynamics even when                      Ï = 0.   This would

present a diculty if the complicated part of the state space  the distribution                          â¦   

also changed over time. A judicious choice of state variables allows us to avoid this

complication.




                                                       21
Lemma 2. For any â¦, policy functions satisfy zÌ (z, Î, Î) = z for any (z, Î, Î) and
therefore â¦Ì (Î, Î) = â¦ for any Î, Î.

     The intuition is as follows.       There are multiple mathematically equivalent ways

to choose individual state variables.         We chose them to be Pareto-Negishi weights

m    and multipliers on implementability constraints       Âµ.   In the deterministic economy

(or, more generally, in a complete market economy as in Lucas and Stokey (1983)

or Werning (2007)) these weights are constant over time, even when other choices of

state variables, such as agents' debt levels, would not be.

     Lemma 2 paves a way for the natural extension of our algorithm from section

3.1.   Start with any      (Î0 , Î0 )   and compute the deterministic transition dynamics

as {Ît , Ît }t   converge to the steady state.       The steady state value of    Î    is simply
            
ÎÌ = ÎÌ, Î¦Ì ,    while the steady state value ofÎ, that we denote by ÎÌ, is pinned down
                                                  
by a single non-linear equation ÎÌ 0, â¦, ÎÌ, ÎÌ; 0 = ÎÌ. Theorem 1 and its higher-order

generalizations continue to hold along the transition path of {Ît , Ît }t , allowing one to

solve for the coecients in expansions of policy functions using backward induction,

as in Anderson et al. (2012).           This procedure can be further simplied by simply

expanding    xÌ (E, Îµ, z, â¦, Î, Î)    XÌ (E, â¦, Î, Î) around Î = ÎÌ and Î = ÎÌ rather
                                     and

than solving for the full transition dynamics {Ît , Ît }t . The online appendix describes

how implement both approaches.




4 Calibration and computations
We choose three sets of parameters: (i) parameters governing preferences, technol-

ogy and aggregate shocks; (ii) initial conditions; and (iii) stochastic processes for

idiosyncratic shocks.



Preferences, technology, aggregate shocks
Our settings of aggregate parameters align with standard representative agent cal-

ibrations such as Schmitt-Grohe and Uribe (2004) and Siu (2004).                 We set utility

function parameters at       Î½ = 1 , Î³ = 2,   and the discount factor   Î²   at 0.96. We assume

that rms operate a constant returns to scale technology and set Î± = 1. To a rst
                                          â1
approximation, average markups are Î¦Ì â 1      and the slope of the Phillips curve is
       
 Î¦Ì â 1 /Ï .     We set   Î¦Ì = 6   to attain average markups of   20%   and   Ï = 20   to match




                                                22
the slope of the Phillips curve as estimated by Sbordone (2002).
                                                                            12 We set government

non-transfer expenditures      GÌ at 0.09 in order to match the average federal government
current expenditures net of transfer payments to annual GDP from the NIPA for the

period 1947-2016.

   The stochastic process for the markup shocks is calibrated to be consistent with

that estimated in Smets and Wouters (2007) with the AR coecient of                   0.65   and the

volatility of the innovation to     ln Î¦   such that a one standard deviation negative shock

EÎ¦ raises rms' optimal markups by about 0.5 percentage points. We set the standard
deviation of EÎ at 3% to approximate the process for output per worker in the U.S.

In the AR(1) specication of TFP shocks we set ÏÎ = 0.8 and ÎÌ = 1.



Initial conditions
We use the 2007 wave of the Survey of Consumer Finances (SCF) to calibrate the

initial distribution of wages, debt, and equity holdings.              We restrict our sample to

married households who work at least 100 hours.                   To measure bond holdings, we

sum direct and indirect holdings of government bonds through mutual funds (taxable

and nontaxable), saving bonds, liquid assets (net of unsecured credit), money market

accounts, and components of retirement accounts that are invested in government

bonds. To measure equity holdings we sum direct holdings of equities and indirect

holdings through mutual funds and retirement accounts.
                                                                     13

   To t initial states     {Î¸i,â1 , bi,â1 , si }   to data, we sample directly from the SCF

log wages, debt and shares of equity using 2007 wave sampling weights.                   The SCF

provides population weights for each observation.                Given these weights, we set the

initial condition by drawing with replacement a random sample of 100000 agents from

a discrete distribution. In our SCF sample,              30% of households hold zero equities;   the

distribution of equities among the remaining households is right skewed with the top

10% of agents holding about 60% of total equities. Debt holdings, equity holdings,

and wages are positively correlated. Table I reports summary statistics of the data

and our t.
  12 Using quarterly data, Sbordone (2002) estimates the slope of the U.S. Phillips curve to be about
0.06. Since our calibration uses annual frequency, we multiply her number by 4.
  13 We drop observations where equity or bond holdings are more than 100 times average yearly
wage. These turned out to be about 0.5% of the total sample.




                                                    23
                        TABLE I: FIT OF THE INITIAL DISTRIBUTION



                                                                                 Data          Model
  fraction of pop. with zero equities                                            30%                30%
  std. share of equities                                                         2.62               2.61
  std. bond                                                                      4.90               5.23
  std. ln wages                                                                  0.81               0.82
  corr(share of equities,ln wages)                                               0.40               0.39
  corr(share of equities,bond holdings)                                          0.59               0.55
  corr(bond,ln wages)                                                            0.32               0.30


Notes: The moments in the data column corresponds to SCF 2007 wave with sample restrictions

explained in the text and after scaling wages, equity holdings, and debt holdings by the average

yearly wage in our sample. The share of equities refers to the ratio of individual equity holdings to

the total in our sample such that the weighted sum of shares equals one.




Stochastic process for idiosyncratic shocks
We set the stochastic process for idiosyncratic shocks to match some facts about

labor earnings reported by Storesletten et al. (2004) and Guvenen et al. (2014). In

the model, labor earnings depend both on the stochastic process for skill                    i,t   and on

monetary-scal policy. We calibrate them to t a competitive equilibrium in which

interest rates and tax rates are set to match stylized features of U.S. policies, namely,


                                            1
                                Qâ1
                                 t â1 =       + 1.5Î t ,     Î¥t = 0.25.                                 (30)
                                            Î²

This Taylor rule parameterization for nominal rates is common in the literature, while

the calibrated tax rate matches estimates of the federal average marginal income tax

rate reported by Barro and Redlick (2011), who also show that it is largely acyclical

at business cycle frequencies.

    To calibrate parameters governing stochastic processes (10) and (11), we simulate

log earnings for 100000 agents using a competitive equilibrium with the initial con-

dition and government policies as described above. Shocks               Îµ,i,t , ÎµÎ¸,i,t   are Gaussian.

Storesletten et al. (2004) estimates a transitory/persistent component model of log

earnings using the PSID. We targeted their estimates by setting the parameter                         ÏÎ¸   to

match the autocorrelation of the persistent component of log earnings, parameters

std(Îµ,i,t ), std(ÎµÎ¸,i,t )   to match the standard deviation of the transitory and persistent




                                                  24
         TABLE II: PARAMETERS FOR IDIOSYNCRATIC SHOCKS PROCESSES



    Parameters                Values            Targeted moment                          Values    Source


    s.d of   Îµ                   0.17          s.d. of transitory                       0.25      Storesletten
                                                component in log earnings                          et al. (2004)
    s.d. of    ÎµÎ¸                 0.12          s.d. of persistent                       0.12
                                                component in log earnings
    ÏÎ¸                            0.99          autocorr of persistent                   0.99
                                                component in log earnings
    f2 , f1 , f0         0.28,â0.52,            relative (to median)                     see       Guvenen
                                                                 th   th
                             0.00               earnings losses 5 , 50         &         text      et al. (2014),
                                                95th percentiles                                   see gure I

Notes: The parameters in this table characterize the stochastic processes in equations (10) and (11).




components of log earnings.
                                               14

    Guvenen et al. (2014) report earnings losses in the four recessions between 1978-

2010 by percentiles of 5 year averages of pre-recession earnings.                                 These provide us

with moments that we use to construct the loading function                                    f (Î¸). We assume a
                                                           2
quadratic form           f (Î¸) = f0 + f1 Î¸ + f2 Î¸              and calibrate   {f0 , f1 , f2 } as follows. We rst
normalize Guvenen et al. (2014) reported earning losses for each percentile by the

median earnings losses and average across all four recessions to obtain a prole of

relative (to median) earnings losses.                          This is the dashed line in gure I.          We next

simulate the competitive equilibrium for 50 periods with a recession that is ignited

by one standard deviation negative TFP shock. Following the empirical procedure

in Guvenen et al. (2014), we rank workers by percentiles of their average log labor

earnings   5   years prior to the shock and compute the percent earnings loss for each

percentile relative to the median. The parameters                         f0 , f1 , f2   are set to match earnings
                    th         th          th
losses of the      5     ,   50     and   95        percentiles. Our model's counterpart to Guvenen et al.

(2014) is the solid line in gure I. Parameters governing the process for idiosyncratic

shocks are summarized in table II.
  14 In the model, we compute these cross-sectional moments by simulating a panel of log earnings
from the competitive equilibrium with 100000 agents after turning o aggregate shocks for a sample
of length 50 periods.




                                                                 25
                   Earnings losses (relative to median) in a recession

2.5
                                                                               data
                                                                              model


  2


1.5


  1


0.5
      0    0.1    0.2     0.3     0.4    0.5        0.6   0.7    0.8    0.9      1
                                        percentiles


Figure I: Relative (to median) earnings losses by percentiles of 5 year average pre-recession
log earnings. The data line is constructed using moments from Guvenen et al. (2014) who
report the prole of earnings losses in the last 4 recessions (1978-2010). In the model line,
we use simulated earnings before and after a one standard deviation TFP shock.




                                               26
Computations
We use our second-order expansion formulas to approximate Ramsey policies. To com-

pute the optimal monetary policy, we set              Î¥Ì to the optimal level in the non-stochastic
environment with the same the initial condition. At every history we discretize the

distribution across agents with           K = 2000     grid points that we choose each period us-

ing a k-means clustering algorithm. We apply our algorithm to approximate optimal

policies, use Monte Carlo simulation to draw idiosyncratic shocks and nally compute

the aggregate distribution next period for a given history of aggregate shocks. The al-

gorithm is then repeated with the new distribution. The details of how to implement

the simulation steps are in the online appendix.

    We focus on optimal policy responses to aggregate shocks                       EÎ¦,t , EÎ,t .   These re-

sponses depend on the underlying state. To compute them we draw 100 histories of

shocks   {EÎ¦,t , EÎ,t }25
                       t=0 . To calculate an impulse response, say, to productivity shock
EÎ,k , of size Î´ in period k , we create two replicas of these draws. In one replica we
replace EÎ,k from 0 and in the other with Î´ . We then integrate over all histories to ob-

tain expected paths conditional on EÎ,k = 0 and on EÎ,k = Î´ . Our impulse responses

are the dierences in the two paths. Since those paths are the same by construction

for all   t < k,   we draw all the graphs starting with            t = k.   For concreteness we report

all responses for     k = 5.15


5 Results
We study optimal monetary and monetary-scal responses to one standard deviation

negative shocks to      EÎ¦,t   and   EÎ,t .   These responses are primarily shaped by two goals.

The rst is price stability, which is also present in representative agent New Keynesian

models.       Price changes are costly and by pursuing stable prices the planner can

mitigate these costs.      The second is provision of insurance, a goal that arises from

heterogeneity and market incompleteness because aggregate shocks aect dierent

agents dierently.       If agents could trade a complete set of Arrow securities, they

would insure these shocks away and maintain constant consumption shares.                                Our

  15 As often occurs (for example, see Lucas and Stokey (1983), Schmitt-Grohe and Uribe (2004))
Ramsey policy at time    t=0     diers from continuation Ramsey policies for          t > 1, being functions
of dierent arguments. In our economy, by          t = 5,   transient eects of time   0 actions have mostly
dissipated.




                                                      27
assumptions rule out those trades. The planner uses monetary and scal policies to

make the distribution of gains and losses more equal.

   In what follows we compare optimal responses in our economy to those in a rep-

resentative agent version that shuts down all idiosyncratic shocks and heterogeneity

across agents. The RANK economy provides a useful benchmark because it isolates

the role of price stability concerns. We refer to our baseline setting with heteroge-

neous agents as HANK and the representative agent counterpart as RANK. When we

study Ramsey monetary policy, for each economy we x      Î¥Ì   at the associated optimal

level in the non-stochastic environment. In the RANK economy it is         Î¥Ì = â1/Î¦Ì.


5.1 Optimal Responses to Markup Shocks
We start by considering the optimal response to a negative innovation in     EÎ¦,t .   As this

shock increases the desired markup   1/(Î¦t â 1),   we refer to it as a positive markup

shock.   Figure II shows (solid line) that the planner responds to a 0.5 percentage

points increase in markups by cutting the nominal interest rate by 0.3 percentage

points. This response boosts output, ination and real wages. The optimal policy

response to a markup shock diers signicantly from that in the representative agent

model (dashed line).

   To understand economic forces behind these results, consider implications of the

shock for price stability and insurance. A negative innovation to   EÎ¦,t   increases rms'

desired markups over marginal costs which,     ceteris paribus,   makes rms want to

increase nominal prices.   To reduce the cost of price changes the planner can aim

to lower marginal costs by increasing the nominal interest rate, thereby depressing

aggregate demand and real wages, which reduces marginal costs.         Dubbed leaning

against the wind by GalÃ­ (2015), this response is optimal in representative agent

New Keynesian economies. The interest rate increase that maintains stable prices is

modest (see the dashed line).

   Now turn to the insurance considerations. Higher markups increase dividends and

lower the real wage. This benets agents who own a lot of equities and hurts agents

who mainly rely on labor income. To provide insurance that osets the dierential

impact of the markup shock, the planner can aim to increase the real wage by cutting

the nominal interest rate and boosting aggregate demand.

   Thus, the Ramsey planner's concerns about price stability and insurance have




                                         28
                    Nominal rate                        Ination                           Tax rate

                                                                              2
           0
                                         0.5
 %pts




                              RANK
                                           0                                  0
                              HANK
        â0.5                                                               â1
                0   2     4   6   8 10         0    2     4    6    8 10          0    2    4   6     8 10
                    Log output                     Pre-tax wage                       Markup shock


          0.5                              1
    pts




                                                                              0
    %




           0                               0
                                                                           â1
                0   2     4   6   8 10         0    2     4    6    8 10          0    2    4   6     8 10
                          years                           years                             years


                        Figure II: Optimal monetary response to a markup shock



opposite implications for an optimal monetary response. Figure II shows that quanti-

tatively the planner's intention to provide insurance swamps the intention to stabilize

prices. To understand why the insurance motive is so strong, think about how the

distribution of gains and losses from the shock depends on asset inequality. The in-

surance motive is least active when rm ownership is widely dispersed among agents

and most active when ownership is very skewed.                      Data portray the distribution of

stock market wealth as highly unequal, much more than the distribution of labor

earnings. That makes the insurance motive relatively strong.

    Figure III shows optimal monetary-scal responses to a markup shock. The plan-

ner temporarily increases tax rates and lowers nominal interest rates. This combina-

tion of policies increases the pre-tax wage             W     and ination.

    Labor taxes allow the planner to completely oset the inationary consequences

of the markup shock. If taxes are decreased to make the path of                       1âÏ   mirror the path

of the shock, then the after-tax wage              (1 â Ï ) W      and ination are both unchanged.

Since this tax response osets the eect of the shock on ination, the planner need not

change the nominal interest rate. In representative agent New Keynesian economies

(dashed line) this policy achieves the rst best.

    In our economy, this scal response to an aggregate shock damages insurance pro-



                                                     29
                     Nominal rate                     Ination                        Tax rate

                                                                          2
            0
                                        0.5
   pts
   %



                             RANK
                                         0                                0
                             HANK
         â0.5                                                            â1
                 0   2   4   6   8 10         0   2     4   6    8 10         0   2    4    6    8 10
                     Log output                   Pre-tax wage                    Markup shock

                                         3
           0.5
                                         2
     pts




                                         1                                0
     %




            0                            0
                                                                         â1
                 0   2   4   6   8 10         0   2     4   6    8 10         0   2    4    6    8 10
                         years                          years                          years


                 Figure III: Optimal monetary-scal response to a markup shock



vision. When tax rates are lowered, the planner has to decrease transfers in order to

satisfy the government's budget constraint. That makes average taxes more regres-

sive and amplies the adverse eect of the markup shock on low-wage households.

To provide insurance, the planner wants to make the tax system more progressive by

increasing transfers funded by higher marginal tax rates.                 It is optimal to combine

this scal policy with loose monetary policy because that osets the negative eect of

tax rate increases on output. Quantitatively, the insurance considerations dominate

the optimal scal response.

   In contrast to tax-smoothing prescriptions of Barro (1979) and Aiyagari et al.

(2002), the optimal tax rate increase is short-lived.             This is because transitory tax

changes are less distortionary than permanent changes when price are sticky.                            A

permanent increase in tax rates has no eect on real pre-tax wages                    W    as in the long

run rms set their prices as a constant markup over wages. As a result, a permanent

tax rate change increases the labor distortion              (1 â Ï ) W   one for one.       In contrast,

rms nd it suboptimal to adjust prices fully to a transient tax rate increase. Thus, a

transitory tax rate increase raises the pre-tax wage and has little (zero, in a continuous

time limit) eect on the labor distortion.




                                                   30
5.2 Optimal Responses to Productivity Shocks
Price stability and insurance provision also shape Ramsey responses to productivity

shocks. A well-known prescription for price stability is to move nominal interest rates

one for one with changes in the natural rate of interest  the real interest rate that

would prevail without nominal frictions. Consumers' Euler equations then ensure that

ination remains unchanged in response to the shock. The growth rate specication

for productivity shocks in (9b) keeps the natural rate constant providing us with a

clean way to isolate the insurance motive.

    Figure IV shows the optimal monetary response to a negative innovation in                EÎ,t .
This response is driven purely by insurance concerns: in the RANK economy where

these concerns are absent, the planner optimally keeps interest rates and ination

unchanged. Several economic forces explain why lower aggregate productivity gener-

ates insurance motives in our model. One is heterogeneity in bond holdings. Incomes

of agents who hold a lot of non-state-contingent bonds suer less from an adverse

productivity shock than incomes of agents who are in debt.               This eect is present

even if wages of all agents are the same.         Two features in the data that we target

amplify this dierential eect: (i) low wage workers typically have fewer assets, and

(ii) the direct exposures of labor earnings to aggregate productivity shocks are large

for low wage workers, captured by the shape of our loading function             f.
    To provide insurance, the planner wants to transfer resources from high income to

low income agents. Since debt is nominal, that can be done by lowering ex-post real

returns on debt after a negative       EÎ,t   shock. A lower return makes the distribution

of losses between savers and borrowers more equal. The planner lowers realized real

returns on the nominal asset by cutting nominal interest rates, thereby increasing

ination. The policy response is sizable but short lived.
                                                                 16

    Figure V shows an optimal monetary-scal response to an aggregate productivity

shock. When the planner has access to scal policy, increasing transfers funded by

higher labor tax rates provides insurance against the adverse productivity shock.

First, more progressive average taxes redistribute labor income towards low-wage,

low-asset agents.     This by itself would mandate a persistent increase in tax rates

  16 Recall that we follow the usual convention in the New Keynesian literature and assume that
debt matures in one period. With longer debt maturity, the decreases in nominal interest rates and
increases in ination are smaller but more persistent which allows the planner to lower the cost of
nominal price adjustments.




                                                31
                   Nominal rate                         Ination                       Tax rate

                                                                           2
           0
                                          0.5
 %pts




                            RANK                                           0
        â0.5                HANK           0                              â1
               0    2   4   6   8 10            0   2    4   6     8 10        0   2    4     6   8 10
                   Output growth                Ex-post real returns               TFP growth

           0                               0                               0
    pts
    %




          â2                          â0.5                                â2

               0    2   4   6   8 10            0   2    4   6     8 10        0   2    4     6   8 10
                        years                            years                          years


          Figure IV: Optimal monetary response to a productivity growth rate shock



because the increase in inequality is long lived.                But a second force works through

changes in the pre-tax wage.         With costly price adjustments, a temporary spike in

marginal taxes rates raises real wages. Together these two eects explain the responses

of optimal tax rates in gure V. Although nominal interest rates move little, that

behavior masks a substantial departure from natural interest rate targeting.                         The

response of optimal tax rates increases the natural rate in the rst period, putting

the nominal rate substantially below it. The dierence between nominal and natural

interest rates follows a path that is similar to that in gure IV. This explains the spike

in ination that provides insurance through lower realized returns on bond holdings.

    Now consider the alternative AR(1) specication of productivity shocks in equa-

tion (9a). A negative shock        EÎ,t   predicts a higher growth rate of         Ît+k     in the future.

This raises the natural rate, so in order to attain price stability the planner would

want to raise the nominal interest rate as well. This is the main dierence from the

growth rate specication of productivity shocks. In particular, once we look at the

dierence between nominal and natural rates instead of the nominal interest rate it-

self, counterparts of gures IV and V are very similar in both cases. We report them

in the online appendix where we also explain how to extend the notion of the natural

rate to our HANK economy.



                                                    32
                     Nominal rate                      Ination                       Tax rate
          0.5                            0.5                              2
  pts




             0
  %




                              RANK                                        0
                              HANK         0
        â0.5                                                             â1
                 0    2   4   6   8 10         0   2    4   6     8 10        0   2    4   6     8 10
                     Output growth             Ex-post real returns               TFP growth


             0                                                            0
                                           0
    pts




          â2                                                             â2
    %




                                      â0.5
                 0    2   4   6   8 10     0       2    4   6     8 10        0   2    4   6     8 10
                          years                         years                          years


        Figure V: Optimal monetary-scal response to a productivity growth rate shock



5.3 Taylor Rules
We explore how well a Taylor rule approximates the Ramsey plan. To this end we

x tax rates as in sections 5.1 and 5.2 but assume that monetary policy follows the

interest rule specied in equation (30).

    Figure VI compares responses of interest rates and ination under the Ramsey

plan and the Taylor rule.           The left panel (black lines) in gure VI shows that the

responses implied by the Taylor rules are too small, too persistent, and, in the case of

markup shocks, are in the opposite direction of the optimal responses. We could have

anticipated that a Taylor rule does a poor job of approximating the Ramsey responses.

In sections 5.1 and 5.2, we emphasized that the main economic force driving optimal

policy is the need to provide insurance; Taylor rules are designed to achieve price

stability.       In the right panel (red lines) in gure VI we plot responses to markup

and TFP shocks in the representative agent economy and nd that qualitatively, the

interest rate and ination both behave similarly under Ramsey and Taylor policies.
                                                                                                    17

  17 In the RANK economy it easy to improve the t further by small changes in the coecients in
the Taylor rule. For example, if we set the coecient on ination to 5, the two responses lie almost
perfectly on top of each other. This is not surprising and previous studies, for instance Woodford
(2003) and GalÃ­ (2015), also nd that Taylor rules approximate the optimal Ramsey policies well in




                                                   33
                                                  HANK                                                                     RANK

                              Nominal rate                      Ination                 Nominal rate                      Ination
 Markup shocks




                          0                           0.5            Taylor                                                     Taylor
                                                                    Optimal                                                    Optimal
                 pts




                                                                                0.05                          0.05
                 %




                                                       0
                                                                                     0                            0
                       â0.5
                              0   2    4      6   8         0   2    4      6   8        0   2    4      6   8         0   2    4      6   8


                                                                                     1                            1
                          0
 TFP shock




                                                      0.5
                 pts




                                                                                     0                            0
                 %




                       â0.5                            0                            â1                           â1
                              0   2    4      6   8         0   2    4      6   8        0   2    4      6   8         0   2    4      6   8
                                      years                         years                        years                         years


Figure VI: Comparing optimal monetary responses to Taylor rule in HANK (black, left
panel) and RANK (red, right panel) models. The solid line is the optimal response and the
dashed line is the response in a competitive equilibrium with it                                      = iÌ + 1.5Ït .   For TFP shocks
we use the growth rate specication (9b).



                 The diculty with a Taylor rule lies not only in its conventional parameterization

but in a restriction that it implicitly imposes on the persistence of interest rates and

ination. Under a Taylor rule, persistence of nominal interest rates is inherited from

the persistence of exogenous aggregate shocks. Thus, a long-lived markup shock im-

plies long-lived changes in nominal rates and ination. A motive to provide insurance

in the HANK economy often requires transient and short-lived changes in interest

rate and ination. These are dicult to implement with standard Taylor rules.




6 Extensions and robustness
We consider several extensions to the section 2 environment.

a class of representative agent settings.




                                                                         34
6.1 Heterogeneity in the marginal propensity to consume
Our baseline specication combines a New Keynesian framework with a standard

Bewley-Aiyagari model of idiosyncratic shocks and imperfect insurance. A well known

limitation of Bewley-Aiyagari models is that they fail to generate sucient hetero-

geneity in marginal propensities to consume (MPCs).
                                                                   18 That prediction is at odds

with the data. For example, Jappelli and Pistaferri (2014) document large dierences

in MPCs across agents and show that MPCs systematically co-vary with wealth.

Recent studies (Auclert (2017), Kaplan et al. (2018)) stress the role of MPC hetero-

geneity in transmitting changes in interest rates. We are interested in implications of

MPC heterogeneity for         optimal      monetary policy.

      We follow Jappelli and Pistaferri (2014) and augment our model with hand-to-

mouth agents. These agents can own equities and consume dividends (in addition

to labor income) but cannot trade nancial assets over time. Thus, we modify our

baseline set up to allow two dimensions of permanent heterogeneity, equity holding

si   and a new variable     hi ,   where   hi â {0, 1}   indicates whether or not individual    i   is a

hand-to-mouth type. We assume that the probability of being hand-to-mouth is



                             Pr(hi = 1|si ) = a0 + a1 ÃPercentile (si ),

and re-calibrate our model by choosing parameters                  a0   and   a1   to match the MPC

gradient with respect to wealth reported in Jappelli and Pistaferri (2014) in addition

to our calibration targets in section 4. Table III shows Jappelli and Pistaferri (2014)

numbers and the goodness of t of our calibration.

      This approach is in line with Kaplan et al. (2018) who model MPC heterogeneity

using a Bewley-Aiyagari model with costly adjustment between liquid and illiquid

assets. Their baseline calibration makes MPC higher for agents with low liquid wealth,

and about two thirds of agents with zero liquid wealth have positive illiquid wealth.

Our specication captures both features, with high-s hand-to-mouth agents behaving

like wealthy hand-to-mouth agents in Kaplan et al. (2018).

      Frictions in trading nancial assets segment agents into those who are uncon-

strained and are on their Euler equation and those who are constrained and at strict

     18 In our baseline model agents trade subject to the natural borrowing limit. The same conclusion
also holds for economies when agents face ad-hoc borrowing limits, except for a small mass of agents
near that limit.    Krusell and Smith (1998) refer to this property in such models as approximate
aggregation.




                                                    35
                    TABLE III: MODEL FIT FOR MPC HETEROGENEITY



      Parameters         Values       Moment                                              Data      Model


      a0                  -0.35       MPC for 10 percentile of Cash on Hand                0.62      0.63


      a1                   0.75       MPC for 90 percentile of Cash on Hand                0.35      0.33

Notes: The data column is obtained from gure 2 of Jappelli and Pistaferri (2014) who report average MPC out
of transitory income shock by percentiles of cash on hand (CoH) where CoH is dened as the sum of household
disposable income and nancial wealth, net of consumer debt. In the model we compute CoH as the sum post - tax
wage earnings, holdings of debt and equities.


Euler inequalities. Ramsey plans are still determined by price stability and insurance

concerns but now they take the dierent policy responses of these two groups into

account. In a setting with trading frictions, the eectiveness of monetary policy de-

pends on the mechanism through which nominal rates provide insurance. To see this

we compare the responses to markup and TFP shocks.

    In the top row of gure VII we see that in response to a positive markup shock

the planner still decreases the nominal interest rate, but not by as much as in the

baseline model. Recall from section 5.1 that, by stimulating aggregate demand, cuts

in interest rates provide insurance after a markup shock. Changes in interest rates

directly aect only agents who are on their Euler equation, and so trading frictions

diminish the ability of monetary policy to inuence aggregate demand. In contrast,

the bottom row of gure VII shows that the response of interest rates to a TFP

shock is virtually unaected by trading frictions. In this case, the planner provides

insurance by lowering real returns on nominal debt. Asset prices are determined only

by a marginal investor. Thus, in spite of trading frictions, monetary policy behaves

similarly to the benchmark case.

    Figure VII also shows the importance of transfers in providing insurance when

agents face frictions in trading assets. In our baseline economy agents borrow subject

to natural debt limits, so Ricardian equivalence holds and the timing of transfers

is irrelevant. When some agents are constrained in their abilities to trade nancial

assets, transfers become an eective tool for aecting aggregate demand and real

wages. For example, in response to a markup shock the planner increases transfers

to stimulate aggregate demand. This leads to a spike in ination of about the same

magnitude as in the baseline economy despite a much smaller cut in nominal interest




                                                     36
                                   Nominal rate                            Ination                Transfers/Output

                           0
Markup shock


                                                        0.4
                                                                                          0.15
                        â0.1
                  pts

                                                        0.2                                0.1
                        â0.2
                 %


                                                         0                                0.05
                        â0.3                                                                 0
                                                    â0.2
                               0   2   4   6     8 10    0             2    4   6     8 10     0     2    4   6    8 10


                           0                            0.6                                  0
TFP shock


                  pts




                        â0.2                            0.4
                                                                                          â0.2
                 %




                        â0.4               HTM          0.2
                                       Benchmark
                                                         0                               â0.4
                               0   2   4   6     8 10         0        2    4   6     8 10    0      2    4   6    8 10
                                       years                                years                         years


                        Figure VII: Optimal monetary responses with hand-to-mouth agents.



rates. Transfers are cut in response to a TFP shock because lower tax revenues make

it harder for the government to nance its outstanding liabilities.



6.2 Alternative assumptions about welfare criterion and scal
    instruments
We consider other extensions of our baseline specication where we alter the welfare

criteria; turn o heterogeneous exposures of TFP shocks by setting                                   f = 0;   and turn

o nominal rigidities by setting                   Ï = 0.          We summarize main insights from these

extensions here and more details are in the online appendix.

               In our baseline specication we assumed that the Ramsey planner is utilitarian

meaning that he puts equal Pareto weights on all agents.                                   This assumption is not

essential for our results. The focus of our analysis has been on the role of monetary

policy in providing insurance against aggregate shocks, and the need for this insurance

is driven by market incompleteness not Pareto weights. To conrm this insight we

tried a range of alternative Pareto weights, for example weights that rationalize the

observed average marginal tax rates or alternative weights that prefer more redistri-

bution. Dierent choices of Pareto weights have a big inuence on the                                    average   levels



                                                                  37
of optimal tax rates and transfers but have little eect on how tax rates, transfers,

and nominal interest rates respond to aggregate shocks.

      We explored how assumptions about the menu of available scal instruments af-

fect conclusions. Some of heterogeneous impacts of recessions in the data are driven

by unemployment. Targeted instruments such as unemployment insurance (UI) can

be more eective than nominal interest rates in helping agents to smooth their con-

sumption.    But even the best designed programs are likely to provide only partial

insurance, due, for example, to moral hazard.      Modeling these eects realistically

would take us too far from the focus of this paper.     One way to estimate a rough

upper bound on the eectiveness of UI programs is to assume that they fully elimi-

nate all heterogeneous wage impacts by setting    f = 0.   In this case, we nd that the

optimal response to a markup shock is essentially unaected and that the response

to a productivity shock is cut by about 50 percent. Unemployment insurance is not

eective at providing insurance against shocks that aect wage earners and nancial

asset holders dierently.

      We also study the sensitivity of our ndings to the size of nominal rigidities.

Monetary policy remains eective even if prices are completely exible because it still

can inuence the nominal price level and real returns on nominal debt.        When we

set   Ï=0   we nd that ination responds by 0.5% to markup shocks and by 2.5% to

productivity shocks. These eects are larger than the baseline case where      Ï = 20.
The insight that nominal rigidities lower the optimal response of ination is consistent

with RANK studies (Schmitt-Grohe and Uribe (2004)), but unlike those papers the

volatility of nominal interest rates and ination remains sizable under conventional

calibrations of nominal rigidities.




7 Concluding Remarks
James Tobin described macroeconomics as a eld that explains aggregate quantities

and prices while ignoring distribution eects. Tobin's characterization describes much

work about real business cycles, asset pricing, Ramsey tax and debt, and New Key-

nesian models. In each of these lines of research, an assumption of complete markets

and/or of a representative consumer allows the analyst to compute aggregate quan-

tities and prices without also determining distributions across agents.     This paper

departs from Tobin's aggregative economics by assuming heterogeneous agents and




                                          38
incomplete markets.

   Our paper makes two contributions. It develops a way to approximate optimal

plans in economies with heterogeneous agents. Our method can be more broadly ap-

plied to settings that feature incomplete markets, idiosyncratic and aggregate shocks.

Our quantitative application reevaluates lessons for monetary and scal policy drawn

from New Keynesian economies.      Relative to price stability motives that typically

drive policy prescriptions, heterogeneity adds a quantitatively important insurance

motive.   Our ndings complement a message in Kaplan and Violante (2018 forth-

coming) that monetary policy is inextricably connected with scal policy and about

distributional eects.




                                         39
References
Ahn, SeHyoun, Greg Kaplan, Benjamin Moll, Thomas Winberry, and
 Christian Wolf. 2017. When Inequality Matters for Macro and Macro Matters
  for Inequality. In   NBER Macroeconomics Annual 2017, volume 32.:     University of

  Chicago Press.


Aiyagari, S. Rao, Albert Marcet, Thomas J. Sargent, and Juha Seppala.
  2002.  Optimal Taxation without State-Contingent Debt.        Journal of Political
  Economy, 110(6):      12201254.


Algan, Yann, Olivier Allais, Wouter J. Den Haan, and Pontus Rendahl.
  2014. Chapter 6 - Solving and Simulating Models with Heterogeneous Agents and

  Aggregate Uncertainty. In    Handbook of Computational Economics Vol. 3.     eds. by

  Karl Schmedders, and Kenneth L. Judd, 3 of Handbook of Computational Eco-

  nomics: Elsevier, 277  324.


Anderson, Evan W, Lars Peter Hansen, and Thomas J Sargent. 2012. Small
  noise methods for risk-sensitive/robust economies.   Journal of Economic Dynamics
  and Control, 36(4):    468500.


Auclert, Adrien. 2017. Monetary Policy and the Redistribution Channel. Working
  Paper 23451, National Bureau of Economic Research.


Barro, Robert J.        1979.  On the Determination of the Public Debt.    Journal of
  Political Economy, 87(5):    940971.


Barro, Robert J., and Charles J. Redlick. 2011. Macroeconomic Eects From
  Government Purchases and Taxes.        Quarterly Journal of Economics,   126(1): 51

  102.


Bhandari, Anmol, David Evans, Mikhail Golosov, and Thomas Sargent.
  2017a. Fiscal Policy and Debt Management with Incomplete Markets.        Quarterly
  Journal of Economics, 132(2):      617663.


Bhandari, Anmol, David Evans, Mikhail Golosov, and Thomas J. Sargent.
  2017b.  Public debt in economies with heterogeneous agents.   Journal of Monetary
  Economics, 91 3951.


                                            40
Bilbiie, Florin Ovidiu, and Xavier Ragot.           2017.  Optimal Monetary Policy

  and Liquidity with Heterogeneous Households. CEPR Discussion Papers 11814,

  C.E.P.R. Discussion Papers.


Challe, Edouard.      2017.  Uninsured Unemployment Risk and Optimal Monetary

  Policy. Working Papers 2017-54, Center for Research in Economics and Statistics.


Childers, David et al. 2018. On the Solution and Application of Rational Expec-
  tations Models with Function-Valued States.    Unpublished manuscript.

Clarida, Richard, Jordi Gali, and Mark Gertler.             2001. Optimal Monetary

  Policy in Open versus Closed Economies:       An Integrated Approach.        American
  Economic Review, 91(2):     248252.


Debortoli, Davide, and Jordi Gali. 2017.  Monetary Policy with Heterogeneous
  Agents: Insights from TANK models. working papers, Department of Economics

  and Business, Universitat Pompeu Fabra.


Evans, David. 2015. Perturbation Theory with Heterogeneous Agents:            Theory and

  Applications. Ph.D. dissertation, New York University.


Farhi, Emmanuel.       2010.  Capital Taxation and Ownership When Markets Are

  Incomplete.   Journal of Political Economy, 118(5):   908948.


Fleming, Wendell H. 1971. Stochastic Control for Small Noise Intensities. SIAM
  Journal on Control, 9(3):   473517.


Fleming, Wendell H, and PE Souganidis.             1986. Asymptotic series and the

  method of vanishing viscosity.    Indiana University Mathematics Journal,       35(2):

  425447.


GalÃ­, Jordi. 2015. Monetary policy, ination, and the business cycle: an introduction
  to the new Keynesian framework and its applications.:    Princeton University Press.


Guvenen, Fatih, Serdar Ozkan, and Jae Song. 2014. The Nature of Counter-
  cyclical Income Risk.   Journal of Political Economy, 122(3):    621660.


Huggett, Mark.       1993. The risk-free rate in heterogeneous-agent incomplete-

  insurance economies.    Journal of Economic Dynamics and Control, 17(5):      953969.




                                          41
Jappelli, Tullio, and Luigi Pistaferri. 2014. Fiscal Policy and MPC Heterogene-
  ity.   American Economic Journal: Macroeconomics, 6(4):      10736.


Kaplan, Greg, Benjamin Moll, and Giovanni L. Violante.                  2018. Monetary

  Policy According to HANK.       American Economic Review, 108(3):      697743.


Kaplan, Greg, and Giovanni L. Violante.              2018 forthcoming. Microeconomic

  Heterogeneity and Macroeconomic Shocks.        Journal of Economic Perspectives.

Krusell, Per, and Anthony A Smith, Jr. 1998. Income and wealth heterogeneity
  in the macroeconomy.    Journal of Political Economy, 106(5):    867896.


Legrand, Francois, and Xavier Ragot.              2017. Optimal policy with heteroge-

  neous agents and aggregate shocks : An application to optimal public debt dynam-

  ics.Technical report.


Low, Hamish, Costas Meghir, and Luigi Pistaferri.                 2010. Wage risk and

  employment risk over the life cycle.   American Economic Review,       100(4): 1432

  1467.


Lucas, Robert E, and Nancy L Stokey.               1983.  Optimal scal and monetary

  policy in an economy without capital.        Journal of Monetary Economics,       12(1):

  5593.


Luenberger, David G.       1997.   Optimization by Vector Space Methods.       New York,

  NY, USA: John Wiley & Sons, Inc., , 1st edition.


Marcet, Albert, and Ramon Marimon. 2011. Recursive contracts.
Nuno, Galo, and Carlos Thomas. 2016.  Optimal monetary policy with hetero-
  geneous agents. Working Papers 1624.


Reiter, Michael. 2009. Solving heterogeneous-agent models by projection and per-
  turbation.   Journal of Economic Dynamics and Control, 33(3):      649665.


Rotemberg, Julio J. 1982. Monopolistic Price Adjustment and Aggregate Output.
  Review of Economic Studies, 49(4):    517531.


Sbordone, Argia M. 2002.  Prices and unit labor costs:        a new test of price sticki-

  ness.   Journal of Monetary Economics, 49(2):    265292.



                                           42
Schmitt-Grohe, Stephanie, and Martin Uribe. 2004. Optimal scal and mon-
  etary policy under sticky prices.   Journal of Economic Theory, 114(2):   198230.


Siu, Henry E.     2004. Optimal Fiscal and Monetary Policy with Sticky Prices.

  Journal of Monetary Economics, 51(3):      575607.


Smets, Frank, and Rafael Wouters. 2007. Shocks and frictions in US business
  cycles: A Bayesian DSGE approach.      American Economic Review, 97(3):    586606.


Storesletten, Kjetil, Chris I Telmer, and Amir Yaron. 2001. How important
  are idiosyncratic shocks? Evidence from labor supply.   American Economic Review,
  91(2): 413417.


Storesletten, Kjetil, Christopher I Telmer, and Amir Yaron.               2004. Con-

  sumption and risk sharing over the life cycle.    Journal of Monetary Economics,
  51(3): 609633.


Werning, Ivan. 2007.  Optimal Fiscal Policy with Redistribution,. Quarterly Jour-
  nal of Economics, 122(August):   925967.


Winberry, Thomas.      2016. A Toolbox for Solving and Estimating Heterogeneous

  Agent Macro Models.    Forthcoming Quantitative Economics.

Woodford, Michael. 2003. Interest and prices.:      Princeton University Press.


Yared, Pierre.   2013.  Public Debt Under Limited Private Credit.    Journal of the
  European Economic Association, 11(2):      229245.




                                           43
                                Online Appendix

A Recursive Representation of Ramsey Plan
For completeness and ease of readability, we repeat the planning problem with a full set of

implementability constraints below.         Given an initial condition    {bi,â1 , Î¸i,â1 , si }, Îâ1 = 0,
ai,â1 = 0   and the multipliers, the Ramsey allocation solves:


                â
                            (Z "                     !
                X                  c1âÎ½
                                    i,t   n1+Î³
                                           i,t                                          1+Î³
                       Î²t                                   1âÎ½
                                                                â câÎ½
                                                                                            
   inf sup E0                           â                + ci,t    i,t (Tt + si Dt ) â ni,t   Âµi,t
                 t=0
                                   1âÎ½ 1+Î³
                 ai,tâ1 câÎ½           â1
                         i,t (1 + Î t ) Î¾i,t
              â            âÎ½
                                            + (1 â Î²)câÎ½
                                                       i,0 bi,â1 Âµi,0 di                           (31)
                Î²Etâ1 ci,t (1 + Î t )    â1
                                                                                 
                     âÎ½                       Wt                         âÎ½
              + Ît Ct Yt 1 â Î¦t 1 â                    + (Îtâ1 â Ît )Ct ÏÎ t (1 + Î t ) ,
                                            Î±NtÎ±â1

subject to


                                                       Î³
                              câÎ½
                               i,0 (1 â Î¥0 )W0 i,0 = ni,0
                                          â1/Î½
                                        mi,0 ci,0 = C0
                                         Z
                                            ci,0 di = C0
                                                              Ï 2
                                          C0 + GÌ = N0Î± â      Î 
                                                              2 0
                                                                   Ï
                                                 D0 = N0Î± â W0 N0 â Î 20
                                                      Z            2
                                                 N0 = i,0 ni,0 di




                                                    1
and


                                                         Î³
                                câÎ½
                                 i,t Wt (1 â Î¥t )i,t = ni,t                                                                     (32)
                                                                           h                    i
                                                    Qtâ1     = Î²mi,tâ1 Etâ1 câÎ½
                                                                             i,t (1 + Î  t+1 )â1
                                                                                                                                 (33)

                                                 â1/Î½
                                             mi,t       ci,t = Ct                                                                (34)
                                              Z
                                                    ci,t di = Ct                                                                 (35)

                                                                             Ï 2
                                                 Ct + GÌ = NtÎ± â              Î                                                   (36)
                                                                             2 t
                                                                          Ï
                                                        Dt = NtÎ± â Wt Nt â Î 2t                                                   (37)
                                                             Z            2
                                                        Nt = i,t ni,t di                                                        (38)


                                                       Âµi,t = Âµi,tâ1 + Î¾i,t .

                                   âÎ½
for    t â¥ 1,   where      Qtâ1 â¡ Ctâ1 Qtâ1 ,            with



                                         ln i,t = ln Ît + ln Î¸i,t + Îµ,i,t
                                        ln Î¸i,t = ÏÎ¸ ln Î¸i,tâ1 + f (Î¸i,tâ1 )EÎ,t + ÎµÎ¸,i,t
                                         ln Ît = ÏÎ ln Îtâ1 + (1 â ÏÎ ) ln ÎÌ + EÎ,t
                                         ln Î¦t = ÏÎ¦ ln Î¦tâ1 + (1 â ÏÎ¦ ) ln Î¦Ì + EÎ¦,t ,
                                                                                   
where the inf is over multipliers                 {Âµi,t , Ît }t and the sup is over {ci,t , ni,t , bi,t }i , Ct , Nt , Bt , Wt , Pt , Yt , Dt   .

       The state for the         t â¥ 1 continuation problem is the joint distribution of (mi,0 , Âµi,0 , Î¸i,0 , si ),
Î0 ,   and aggregate shocks                (Î0 , Î¦0 ).     For the remainder of this appendix we'll focus on the

rst-order conditions for the continuation problem and how to approximate solutions to

those rst-order conditions recursive in the distribution over                                 (mi , Âµi , Î¸i , si )   and   (Î, Î, Î¦).
Once that approximation has been obtained, the solution to the time 0 problem can be

found by solving the time 0 rst-order conditions with the knowledge that some variables

will be given by the continuation policy rules.                                    We omit those rst-order conditions for

brevity.

       Let   Î² t Ïi,t , Î² t Ïi,tâ1 , Î² t Ïi,t , Î² t Ït , Î² t Ît , Î² t Î¶t ,Î² t Îºt   be the Lagrange multipliers on (32)-(38)

respectively. After taking derivatives, the rst-order condition with respect to                                        ai,tâ1   com-

bined with        Âµi,t = Âµi,tâ1 + Î¾i,t          imply

                                                              h                          i
                                                          Etâ1 câÎ½
                                                                i,t  (1 + Î  t )â1 Âµ
                                                                                     i,t
                                              Âµi,tâ1    =       h                     i ,
                                                           Etâ1 câÎ½i,t (1 + Î   t ) â1




                                                                         2
and the rst-order conditions with respect to                          mi,t   and   Qtâ1   give

                                                                Z
                                                                    Ïi,t = 0.

Due to the timing of the planner's problem (at time                                 t   but before shocks have been real-
ized) policy functions will be a functions of both the previous log of the shocks,               Îtâ1 =
(ln Îtâ1 , ln Î¦tâ1 ); the innovations, E t = (EÎ,t , EÎ¦,t ) and Îµ = (Îµ , ÎµÎ¸ ); as well as the individual
states, ztâ1 = (mtâ1 , Âµtâ1 , Î¸tâ1 , s), and the distribution over those states, â¦tâ1 . The rst
order conditions of the planner's problem can then be written recursively as


                                                                                                                    pÌ(Îµ, E, Î, z, â¦, Î)
0 =nÌ(Îµ, E, Î, z, â¦, Î)1+Î³ + cÌ(Îµ, E, Î, z, â¦, Î)âÎ½ (TÌ (E, Î, â¦, Î) + sDÌ(E, Î, â¦, Î)) + aÌ(Î, z, â¦, Î)
                                                                                                                   Î²E [pÌ(Â·, Â·, Î, z, â¦, Î)]
    â c(Îµ, E, Î, z, â¦, Î)1âÎ½ â aÌ(ÏÎ Î + (1 â ÏÎ )ÎÌ + E, zÌ(Îµ, E, Î, z, â¦, Î), â¦Ì(E, Î, â¦, Î), ÎÌ(E, Î, â¦, Î))                        (39)
0 =cÌ(Îµ, E, Î, z, â¦, Î)   âÎ½
                               WÌ (E, Î, â¦, Î)(1 â Î¥Ì(E, Î, â¦, Î))Ë
                                                                  (Îµ, E, Î, z, â¦, Î) â nÌ(Îµ, E, Î, z, â¦, Î)   Î³
                                                                                                                                       (40)
0 =mÌ(Îµ, E, Î, z, â¦, Î)   â1/Î½
                          cÌ(Îµ, E, Î, z, â¦, Î) â CÌ(E, Î, â¦, Î)                                                                        (41)
      h                                                                                    i
0 =Î²E %Ì(Â·, Â·ÏÎ Î + (1 â ÏÎ )ÎÌ + E, zÌ(Îµ, E, Î, z, â¦, Î), â¦Ì(E, Î, â¦, Î), ÎÌ(E, Î, â¦, Î))
        1
    +     mÌ(Îµ, E, Î, z, â¦, Î)â1/Î½â1 cÌ(Îµ, E, Î, z, â¦, Î)ÏÌ(Îµ, E, Î, z, â¦, Î)                                                          (42)
        Î½
                                                                                                               %Ì(Îµ, E, Î, z, â¦, Î)
0 =cÌ(Îµ, E, Î, z, â¦, Î)âÎ½ + (1 â Î½)cÌ(Îµ, E, Î, z, â¦, Î)âÎ½ ÂµÌ(Îµ, E, Î, z, â¦, Î) â Î²Î½ mÌ(Îµ, E, Î, z, â¦, Î)
                                                                                                               cÌ(Îµ, E, Î, z, â¦, Î)
                                                                   
    â Î½cÌ(Îµ, E, Î, z, â¦, Î)âÎ½â1 TÌ (E, Î, â¦, Î) + s(z)DÌ(E, Î, â¦, Î) ÂµÌ(Îµ, E, Î, z, â¦, Î)
        Î½aÌ(Î, z, â¦, Î)rÌ(Îµ, E, Î, z, â¦, Î)
    +                                       (ÂµÌ(Îµ, E, Î, z, â¦, Î) â Âµ)
               cÌ(Îµ, E, Î, z, â¦, Î)
    + Î½cÌ(Îµ, E, Î, z, â¦, Î)âÎ½â1 WÌ (E, Î, â¦, Î)(1 â Î¥Ì(E, Î, â¦, Î))Ë
                                                                   (Îµ, E, Î, z, â¦, Î)ÏÌ(Îµ, E, Î, z, â¦, Î)
    + mÌ(Îµ, E, Î, z, â¦, Î)â1/Î½ ÏÌ(Îµ, E, Î, z, â¦, Î) â ÏÌ(E, Î, â¦, Î)                                                                   (43)
                          Î³                                 Î³
0 =nÌ(Îµ, E, Î, z, â¦, Î) â (1 + Î³)nÌ(Îµ, E, Î, z, â¦, Î) ÂµÌ(Îµ, E, Î, z, â¦, Î)
    + Î³ nÌ(Îµ, E, Î, z, â¦, Î)Î³â1 ÏÌ(Îµ, E, Î, z, â¦, Î) + Ë(Îµ, E, Î, z, â¦, Î)ÎºÌ(E, Î, â¦, Î)                                              (44)
0 =%Ì(Îµ, E, Î, z, â¦, Î) â cÌ(Îµ, E, Î, z, â¦, Î)âÎ½ (1 + Î Ì(E, Î, â¦, Î))â1 ÏÌ(z, â¦, Î)                                                    (45)
0 =pÌ(Îµ, E, Î, z, â¦, Î) â cÌ(Îµ, E, Î, z, â¦, Î)   âÎ½
                                                      (1 + Î Ì(E, Î, â¦, Î))   â1
                                                                                                                                       (46)
                          pÌ(Îµ, E, Î, z, â¦, Î)ÂµÌ(Îµ, E, Î, z, â¦, Î)
0 =rÌ(Îµ, E, Î, z, â¦, Î) â                                                                                                              (47)
                                   Î²E [pÌ(Â·, Â·, Î, z, â¦, Î)]
0 =Âµ â Î²E [rÌ(Â·, Â·, Î, z, â¦, Î)]                                                                                                       (48)
0 =QÌ(Î, â¦, Î) â Î²mE pÌ(Â·, Â·, Î, z, â¦, Î))â1                                                                                           (49)
                                            

0 = ln Ë(Îµ, E, Î, z, â¦, Î) â ln Î¸Ì(Îµ, E, Î, z, â¦, Î) â Îµ â ÏÎ ln Î â (1 â ÏÎ¸ ) ln ÎÌ â EÎ                                            (50)
0 = ln Î¸Ì(Îµ, E, Î, z, â¦, Î) â ÏÎ ln Î¸ â f (Î¸) â ÎµÎ¸
0 =sÌ(Îµ, E, Î, z, â¦, Î) â s                                                                                                            (51)




                                                                      3
while the aggregate constraints are

          Z Z
     0=       cÌ(Îµ, E, Î, z, â¦, Î)âÎ½ ÂµÌ(Îµ, E, Î, z, â¦, Î)dPr(Îµ)dâ¦(z)                                                    (52)
                           Z Z
     0 =CÌ(E, Î, â¦, Î) â         cÌ(Îµ, E, Î, z, â¦, Î)dPr(Îµ)dâ¦(z)                                                        (53)
                            Ï
     0 =YÌ (E, Î, â¦, Î) â Î Ì(E, Î, â¦, Î)2 â CÌ(E, Î, â¦, Î) â GÌ                                                         (54)
         Z Z                2
     0=        Ë(Îµ, E, Î, z, â¦, Î)nÌ(Îµ, E, Î, z, â¦, Î)dPr(Îµ)dâ¦(z) â YÌ (E, Î, â¦, Î)                                    (55)
                                                            Ï
     0 =YÌ (E, Î, â¦, Î) â WÌ (E, Î, â¦, Î)NÌ (E, Î, â¦, Î) â Î Ì(E, Î, â¦, Î)2 â DÌ(E, Î, â¦, Î)                             (56)
                                                            2
                                                                                                     
                       âÎ½                                          1
     0 =CÌ(E, Î, â¦, Î) YÌ (E, Î, â¦, Î)       1 â Î¦Ì(E, Î, â¦, Î)(1 â WÌ (E, Î, â¦, Î)NÌ (E, Î, â¦, Î)1âÎ± )
                                                                   Î±
                                h                                                            i
         â âµÌ(E, Î, â¦, Î) + Î²E âµÌ(Â·, ÏÎ Î + (1 â ÏÎ )ÎÌ + E, â¦Ì(E, Î, â¦, Î), ÎÌ(E, Î, â¦, Î))                            (57)
                                                 âµÌ(E, Î, â¦, Î)
     0 =ÏÌ(E, Î, â¦, Î) â ÎÌ(E, Î, â¦, Î) + Î½                (ÎÌ(E, Î, â¦, Î) â Î)
                                           CÌ(E, Î, â¦, Î)
                                               h                                           i
         â Î½ CÌ(E, Î, â¦, Î)âÎ½â1 YÌ (E, Î, â¦, Î) 1 â Î¦Ì(E, Î, â¦, Î)(1 â WÌ (E, Î, â¦, Î)) ÎÌ(E, Î, â¦, Î)                  (58)
                               Z Z
     0 =(1 + Î Ì(E, Î, â¦, Î))â1      aÌ(Î, z, â¦, Î)rÌ(Îµ, E, Î, z, â¦, Î)(ÂµÌ(Îµ, E, Î, z, â¦, Î) â Âµ)

          â Î² %Ì(Îµ, E, Î, z, â¦, Î)dPr(Îµ)dâ¦(z) â Ï Î Ì(E, Î, â¦, Î)ÎÌ(E, Î, â¦, Î)                                          (59)
                                                                  âÎ½
        â Ï Î Ì(E, Î, â¦, Î)Î¶Ì(E, Î, â¦, Î) â Ï CÌ(E, Î, â¦, Î) (1 + 2Î Ì(E, Î, â¦, Î))(ÎÌ(E, Î, â¦, Î) â Î)                   (60)
        Z Z
     0=       cÌ(Îµ, E, Î, z, â¦, Î)âÎ½ Ë(Îµ, E, Î, z, â¦, Î)ÏÌ(Îµ, E, Î, z, â¦, Î)dPr(Îµ)dâ¦(z)                                (61)
        Z
     0 = cÌ(Îµ, E, Î, z, â¦, Î)âÎ½ sÂµÌ(Îµ, E, Î, z, â¦, Î)dPr(Îµ)dâ¦ â Î¶Ì(E, Î, â¦, Î)                                          (62)
         1
     0 = ÎÌ(E, Î, â¦, Î)CÌ(E, Î, â¦, Î)âÎ½ Î¦Ì(E, Î, â¦, Î) â Î¶Ì(E, Î, â¦, Î)                                                 (63)
        Î±
                                                                                                                
                                                                                 1
     0 =ÎÌ(E, Î, â¦, Î)CÌ(E, Î, â¦, Î) Î±NÌ (E, Î, â¦, Î)Î±â1 (1 â Î¦Ì(E, Î, â¦, Î)) + Î¦Ì(E, Î, â¦, Î)WÌ (E, Î, â¦, Î)           (64)
                                                                                 Î±
                                                               
         + Î±NÌ (E, Î, â¦, Î) Î±â1
                                 ÎÌ(E, Î, â¦, Î) + Î¶Ì(E, Î, â¦, Î) â WÌ (E, Î, â¦, Î)Î¶Ì(E, Î, â¦, Î) â ÎºÌ(E, Î, â¦, Î)       (65)
     0 =âµÌ(E, Î, â¦, Î) â CÌ(E, Î, â¦, Î) âÎ½
                                                Ï Î Ì(E, Î, â¦, Î)(1 + Î Ì(E, Î, â¦, Î))                                    (66)
     0 =YÌ (E, Î, â¦, Î) â NÌ (E, Î, â¦, Î)   Î±
                                                                                                                        (67)
     0 =Î¦Ì(E, Î, â¦, Î) â exp(ÏÎ¦ ln Î¦ + (1 â ÏÎ¦ ) ln Î¦Ì + EÎ¦ )                                                           (68)
        Z
     0 = ÏÌ(Î, z, â¦, Î)dâ¦                                                                                               (69)
          h               i
     0 =E TÌ (Â·, Î, â¦, Î)                                                                                               (70)


These are in addition to the implicit restrictions that                         QÌ, aÌ   and   ÏÌ   do not depend on period

t   shocks.     The additional constraint (70) is required because of Ricardian equivalence as

without it there would be multiple solutions to the FOC corresponding to dierent paths of

government debt.




A.1 Slack Phillips Curve When si = 1
Here we demonstrate the result that when all agents have the same equity ownership,                                  si = 1



                                                                   4
for all i, the Phillips curve, equation (15), does not bind at the optimal allocation and hence

Ît = 0           for all     t.    Let    {ci,t , ni,t }    and     {Ct , Î t , Wt , Tt , Î¥t , Dt , Qt , Yt }     be the allocation that

maximizes a relaxed planner's problem without the Phillip's curve constraint.                                                     Dene   WÌt
                                                                                  Ï 2
such that (15) is satised;                     DÌt = (1 â WÌt )Yt â              2 Î t ;   Î¥Ìt   such that   (1 â Î¥Ìt )WÌt = (1 â Î¥t )Wt ;
and    TÌt   such that            TÌt + si DÌt = Tt + si Dt .               It is clear from this denition that all equilib-

rium conditions will then be satised with                                  {Ct , Î t , WÌt , TÌt , Î¥Ìt , DÌt , Qt , Yt }   for the allocation

{ci,t , ni,t },    and therefore this allocation maximizes the full planner's problem which implies

that the Phillip's curve is slack.




B Additional Details for Section 3
This section contains the omitted steps and proofs from section 3 in the main text.                                                       In

section B.1 we dene the                      F   and      R   functions used in the expansion provided in section B.2.

We prove lemma 1 and lemma 2 of the main text in section B.3. In sections B.4-B.7, we

derive equations (74)-(79) which extend the factorization theorem, theorem 1, to the more

general Ramsey problem, and then exploit this factorization to derive equations (76)-(96)

which give all the derivatives needed for the second-order Taylor expansions of the Ramsey

policies using matrices known from the lower-order expansions and requiring only small

dimensional matrix inversions.




B.1 Deriving functions F and R
                                                                            |
Let    xÌ =            mÌ, ÂµÌ, Î¸Ì, sÌ, cÌ, nÌ, aÌ, %Ì, ÏÌ, ÏÌ, ÏÌ, rÌ, pÌ, Ë     denote the household specic variables and
                                                                                   |
let   XÌ =            ÎÌ, CÌ, YÌ , Î Ì, WÌ , DÌ, NÌ , âµÌ, ÏÌ, ÎÌ, Î¦Ì, Î¶Ì, ÎºÌ, TÌ , Î¥Ì             denote the aggregate variables.          By

assumption,             ÎÌ   is contained in          XÌ   and     zÌ   is contained in          xÌ   so there exist projection matrices

P   and      p   that satisfy          ÎÌ = PXÌ         and     zÌ = pxÌ.             Equations (39)-(51) represent the individual

constraints of the problem and can be summarized by the following function which extends

(20) of section 3




      0 = F z, ExÌ(Â·, Â·, Î, z, â¦, Î), xÌ(Îµ, E, Î, z, â¦, Î),
       h                                                                                     i
      E xÌ(Â·, Â·, ÏÎ Î + (1 â ÏÎ )ÎÌ + E, zÌ(Îµ, E, Î, z, â¦, Î), â¦Ì(Î, z, â¦, Î), ÎÌ(Î, z, â¦, Î) ,                                         (71)
                           !
      XÌ(Î, â¦, Î), Îµ, E, Î


and must hold for all                     z   in the support of              â¦.        Equations (52)-(70) capture the aggregate




                                                                                  5
constraints which must hold across all agents and can be dened by the following function

which extends (21) of section 3
                                             19

          Z
     0=        R z, xÌ(Îµ, Î, z, â¦, Î), XÌ(Î, â¦, Î),
                                                                                                             !
                       E[XÌ(Â·, ÏÎ Î + (1 â ÏÎ )ÎÌ + E, â¦Ì(Î, â¦, Î), ÎÌ(Î, â¦, Î))], Îµ, Î, Î dPr(Îµ)dâ¦.

                                                                                                                         (72)



The law of motion for            â¦Ì   is given by

                                                  Z
                       â¦
                       e (E, Î, â¦, Î) (y) =            Î¹ (zÌ (Îµ, E, Î, z, â¦, Î) â¤ y) d Pr (Îµ) dâ¦ ây,                     (73)



where     Î¹ (zÌ (Îµ, E, Î, z, â¦, Î) â¤ y)           is    1   i all elements of       zÌ (Îµ, E, Î, z, â¦)    are less than all

elements of        y   and zero otherwise.




B.2 Setting up the expansions
Section 3 presented two approaches to approximating                              xÌ   and    XÌ :    expanding around the

deterministic transition dynamics                 {Ît , Ît } and expanding around the non-stochastic steady
state    (ÎÌ, ÎÌ).     We rst present how to expand around the non-stochastic steady state                            (ÎÌ, ÎÌ)
in sections B.2-B.6. In section B.7 we describe the full expansion along the transition path.

To expand around             (ÎÌ, ÎÌ),   we consider a positive scalar           Ï    that scales all shocks, deviations

of   Î   and   Î     from their respective steady states              ÎÌ   and   ÎÌ(â¦),     and     ÏÎ¸ (Ï) = 1 â ÏÏ.   We let

xÌ(ÏÎµ, ÏE, Ï(Î â ÎÌ) + ÎÌ, z, â¦, Ï(Î â ÎÌ(â¦)) + ÎÌ; Ï)                     and   XÌ(ÏE, Ï(Î â ÎÌ) + ÎÌ, z, â¦, Ï(Î â
ÎÌ(â¦)); Ï)     denote the policy rules with scaling parameters                       Ï,   and approximate these policies

with a Taylor expansion with respect to                      Ï. For example, a rst-order Taylor expansion would
be of the form

                                                                                        
           xÌ(Îµ, Î, z, â¦, Î) = xÌ(z, â¦) + xÌÎµ (z, â¦)Îµ + xÌE (z, â¦)E + xÌÎ (z, â¦)(Î â ÎÌ) Ï
                             + xÌÎ (z, â¦)(Î â ÎÌ(â¦)) + xÌÏ Ï + O(Ï 2 )
                                                           

     19 The   R   presented here nests that of section 3 with two main dierences.                               The rst is
the inclusion of expectations of future aggregate variables. The second is that we choose to
integrate over          R   rather than over           x.   Both choices are without loss of generality but they
allow for equations (39)- (51) and (52)-(70) representing the Ramsey plan to be expressed
in a more condensed form.




                                                                  6
and



XÌ(Î, â¦, Î) = XÌ(â¦) + XÌE (â¦)E + XÌÎ (â¦)(Î â ÎÌ) + XÌÎ (â¦)(Î â ÎÌ(â¦)) + XÌÏ Ï + O(Ï 2 ),
                                                                           


while second-order expansions can be dened analogously.




B.3 Proof of Lemma 1 and Lemma 2
We begin by showing that when            Ï = 0, zÌ(0, 0, ÎÌ, z, â¦, ÎÌ; 0) = z and hence that â¦Ì(0, ÎÌ, â¦, ÎÌ; 0) = â¦.
                                                                Âµ
From (47) it is clear that        rÌ(0, 0, ÎÌ, z, â¦, ÎÌ; 0) =   Î² and thus equation (48) implies


                                           ÂµÌ(0, 0, ÎÌ, z, â¦, ÎÌ; 0) = Âµ.

In absence of shocks, we conclude from equations (41) and (49) that



                     cÌ(0, 0, ÎÌ, z, â¦, ÎÌ; 0) = mÌ(0, 0, ÎÌ, z, â¦, ÎÌ; 0)1/Î½ CÌ(0, ÎÌ, â¦, ÎÌ; 0)

and
                                                                                   1/Î½
                                              1/Î½              Î²
          cÌ(0, 0, ÎÌ, z, â¦, ÎÌ; 0) = m
                                         QÌ(ÎÌ, â¦, ÎÌ; 0)(1 + Î (0, ÎÌ, â¦, ÎÌ; 0))
   R 1                                                          1/Î½
                                               Î²
As  m Î½ dâ¦(z) = 1, this implies QÌ(ÎÌ,â¦,ÎÌ;0)(1+Î (0, ÎÌ,â¦,ÎÌ;0))
                                                                      = CÌ(0, ÎÌ, â¦, ÎÌ; 0) and hence

                                                                1
                                 cÌ(0, 0, ÎÌ, z, â¦, ÎÌ; 0) = m Î½ CÌ(0, ÎÌ, â¦, ÎÌ; 0).

We, therefore, conclude that          mÌ(0, 0, ÎÌ, z, â¦, ÎÌ; 0) = m.
      By assumption      sÌ(0, 0, ÎÌ, z, â¦, ÎÌ; 0) = s and, as ÏÎ¸ â 1 as Ï â 0, Î¸Ì(0, 0, 0, z, â¦, ÎÌ; 0) = Î¸.
All combined, we obtain           zÌ(0, 0, ÎÌ, z, â¦, ÎÌ; 0) = z     and therefore   â¦Ì(0, ÎÌ, â¦, ÎÌ; 0) = â¦.    Note

that we obtained       â¦Ì(0, ÎÌ, â¦, ÎÌ; 0) = â¦ by exploiting that, in absence of risk, the expectations
in (41) and (49) drop out. This would hold apply along any deterministic transition path

for   (Î, Î)   and thus    zÌ(0, 0, Î, z, â¦, Î; 0) = z      and     â¦Ì(0, Î, â¦, Î; 0) = â¦   for any   (Î, Î).   This

proves the statement of lemma 2 and, therefore, also of lemma 1 as it is a special case of

lemma 2.




B.4 Frechet Derivatives: â xÌ(z), â XÌ
Dierentiate     F   and   R   with respect to      z   to obtain



                               (Fxâ (z) + Fx (z) + Fx+ (z))xÌz (z) + Fz (z) = 0,


                                                            7
where we exploited         zÌz = I.   This yields   xÌz (z) = (Fxâ (z) + Fx (z) + Fx+ (z))â1 Fz (z).
      We begin by solving for the derivatives w.r.t           Î.   Exploiting   zÌ(0, 0, 0, z, â¦, Î; 0) = z   and

â¦Ì(0, 0, â¦, Î; 0) = â¦      and hence    zÌÎ = 0   and   â¦ÌÎ = 0,
                                                                  
               Fxâ (z)xÌÎ (z) + Fx (z)xÌÎ (z) + Fx+ (z) xÌÎ (z)ÎÌÎ + FX (z)XÌÎ = 0

and             Z
                     Rx (z)xÌÎ (z) + RX (z)XÌÎ + RX+ (z)XÌÎ ÎÌÎ + RÎ (z)dâ¦(z) = 0.

In order to proceed, we need to nd the derivative                 ÎÌÎ .   This requires solving a nonlinear

equation but still involves only operations involving small matrices. First note that



                          xÌÎ (z) = â(Fxâ (z) + Fx (z) + ÎÌÎ Fx+ (z))â1 FX (z)XÌÎ

Let   C(z) = â(Fxâ (z) + Fx (z) + ÎÌÎ Fx+ (z))â1 FX (z),             then

                    Z                                                        â1 Z              
                                                           
        XÌÎ = â            Rx (z)C(z) + RX (z) + ÎÌÎ RX+ (z) dâ¦(z)                     RÎ (z)dâ¦(z) .


Therefore,   ÎÌÎ    must solve

                     Z                                                       â1 Z                   
                                                            
        ÎÌÎ = âP            Rx (z)C(z) + RX (z) + ÎÌÎ RX+ (z) dâ¦(z)                     RÎ (z)dâ¦(z) .

This can be found easily with a 1-dimensional root solver as all the inversions involve small

matrices.

      The Frechet derivative w.r.t        â¦   is computed as follows:



            (Fxâ (z) + Fx (z) + Fx+ (z)) â xÌ(z) + Fx+ (z)xÌÎ (z)Pâ XÌ + FX (z)â XÌ = 0

which gives



  â xÌ(z) = â(Fxâ (z) + Fx (z) + Fx+ (z))â1 (Fx+ (z)xÌÎ (z)P + FX (z)) â XÌ â¡ C(z)â XÌ.                       (74)



      To solve for   â XÌ ,   we dierentiate   R   in the direction   â,   with density   Î´,   to obtain

          Z                                                        Z             
        1
0 = lim      R(z, xÌ(z, â¦ + Î±â), XÌ(â¦ + Î±â))(Ï(z) + Î±Î´(z))dz â R(z)Ï(z)dz
    Î±â0 Î±
    Z               Z
                                                                                                
  = R(z)Î´(z)dz +        Rx (z)â xÌ(z) Â· â + RX+ (z) (â XÌ Â· â) + XÌÎ P(â XÌ Â· â) + RX (z)â XÌ Â· â Ï(z)dz




                                                          8
where         R(z)   is dened by       R(z) = R(z, xÌ(z), XÌ, XÌ, 0, ÎÌ, ÎÌ).              Substituting for     â xÌ(z) =
C(z)â XÌ,       we get

                        Z                                                                       â1 Z
                                                                                        
     â XÌ Â· â = â               Rx (z)C(z) + RX+ (z)(I + XÌÎ P) + RX (z) dâ¦(z)                              R(z)dâ(z)
                            Z
                 â¡ Dâ1          R(z)dâ(z).                                                                              (75)




B.5 First-Order Terms
Next we dierentiate both             F   and    R    with respect to     Ï    and use the method of undetermined

coecients to group the terms that multiply                       Îµ, E   and   Î   and set each equal to zero. For        Îµ,
this yields

                                 Fx (z)xÌÎµ (z) + Fx+ (z)xÌz (z)pxÌÎµ (z) + FÎµ (z) = 0

or

                        xÌÎµ (z) = â (Fx (z) + Fx+ (z)xÌz (z)p)â1 FÎµ (z) â¡ E(z)â1 G(z).                                  (76)


For      Î,   we nd that (after noting imposing               â¦ÌÎ = 0    and   zÌÎ = 0)
                                                                
Fxâ (z)xÌÎ (z) + Fx (z)xÌÎ (z) + Fx+ (z) xÌÎ (z)ÏÎ + xÌÎ (z)PXÌÎ + FX (z)XÌÎ + FÎ (z) = 0.

This yields a linear equation in                xÌÎ   and   XÌÎ   which we can solve for        xÌÎ .20    Plugging in for

the linear relationship between             xÌÎ       and   XÌÎ   in

     Z
          Rx (z)xÌÎ (z) + RX (z)XÌÎ + RX+ (z)XÌÎ ÏÎ + RX+ (z)XÌÎ PXÌÎ + RÎ (z)dâ¦(z) = 0.


yields a linear equation for            XÌÎ .
         Finally, for   E   we nd

                                                                             
Fx (z)xÌE (z)+Fx+ (z) xÌÎ (z) + xÌz (z)pxÌE (z) + â xÌ(z) Â· â¦ÌE + xÌÎ (z)PXÌE +FX (z)XÌE +FE (z) = 0

and

     Z
                                                                         
          Rx (z)xÌE (z) + RX (z)XÌE + RX+ (z) XÌÎ + â XÌ Â· â¦ÌE + XÌÎ PXÌE + RE (z)dâ¦(z) = 0.
                                                       
  20 Easiest to exploit                     ÏÎ 0
                                 ÏÎ =                        and solve for each column of         xÌÎ     separately.
                                             0 ÏÎ¦




                                                                  9
Substituting for      â xÌ,   we obtain and dening                     XÌE0 = â XÌ Â· â¦ÌE

Fx (z)xÌE (z)+Fx+ (z) xÌÎ (z) + xÌz (z)pxÌE (z) + C(z)XÌE0 + xÌÎ PXÌE +FX (z)XÌE +FE (z) = 0,
                                                                     


or
                                                                          h                            i|
                                          H(z)xÌE (z) = I(z)                  I XÌE        XÌE0                                               (77)


     Solving for these derivatives rst requires determining    â¦ÌE . Dierentiating equation (73)
with respect to   E                  i
                        and letting z represent the i
                                                     th element of z yields

                                     Z X                                                        Y
                                                 Î´(zÌ i (Îµ, E, Î, z, â¦, Î) â y i )                     Î¹ zÌ j (Îµ, E, Î, z, â¦, Î) â¤ y j
                                                                                                                                               
 â¦ÌE (E, Î, â¦, Î)(y) = â
                                            i                                                   j6=i

                                          Ã zÌEi (Îµ, E, Î, z, â¦) dPr(Îµ)dâ¦(z)

which evaluated at        Ï=0            gives

              Z X                         Y                                                 XZ                             Y
                              i      i                 j        j
â¦ÌE (y) = â            Î´(z ây )                  Î¹(z â¤ y            )zÌEi (z)dâ¦(z)     =â                   Î´(z i ây i )          Î¹(z j â¤ y j )zÌEi (z)dâ¦(z).
                  i                       j6=i                                                   i                         j6=i

                                                                       â nz
The density of    â¦ÌE    is given by             ÏÌE (y) =       ây 1 ây 2 Â·Â·Â·ây nz
                                                                                      â¦ÌE (y)   so


                     X â Z Y                               X â
                                 j     j i
                                                                 zÌEi (y)Ï(y) .
                                                                             
         ÏÌE (y) = â     i
                             Î´(z   â y  ) zÌE (z)dâ¦(z) = â     i
                      ây                                    ây
                              i                   j                                                     i


Plugging in for the denition of                      XÌE0     we nd


                                                  X â  Z
                              XÌE0               â1
                                                             zÌEi (z)Ï(z) dz
                                                                         
                                     = âD                 i
                                                             R(z)
                                                       âz
                                                    i
                                           Z X            
                                        â1        â
                                     =D               R(z) zÌEi (z)Ï(z)dz
                                                 âz i
                                             i
                                           Z X
                                     = Dâ1     (Rzi (z) + Rx (z)xÌzi (z)) zÌEi dâ¦(z)
                                                           i
                                                  Z
                                     = Dâ1 (Rz (z) + Rx (z)xÌz (z)) pxÌE (z)dâ¦(z)
                                       Z
                                     â¡ A(z)xÌE (z)dâ¦(z)                                                                                       (78)



where we arrive at the second equality through integration by parts. This implies

                                                                         Z
                                         â xÌ(z) Â· â¦ÌE = C(z)                 A(z)xÌE (z)dâ¦(z).                                               (79)




                                                                        10
Substituting for          xÌE (z)   using equation (77) in (78) plus

           Z
               Rx (z)xÌE (z) + RX (z)XÌE + RX+ XÌÎ + XÌE0 + XÌÎ PXÌE + RE (z)dâ¦(z) = 0
                                                                    


yields a linear system
                                                        h                   i|
                                                   KÂ·       XÌE    XÌE0          =J                                          (80)


where      K   and   J   are matrices with dimensions given by the number of aggregate variables or

number of aggregate shocks, both of which are small relative to number of agents.

      Finally our last term, the derivative w.r.t                      Ï.     Since we have the AR(1) parameter of

idiosyncratic shock           ÏÎ¸    scale with    Ï , FÏ    is non-zero.

                                                                                                                                  
 Fxâ (z)xÌÏ (z) + Fx (z)xÌÏ (z) + Fx+ (z) xÌÏ (z) + xÌz (z)pxÌÏ (z) + â xÌ(z) Â· â¦ÌÏ + xÌÎ (z)PXÌÏ
 + FX (z)XÌÏ + FÏ (z) = 0

and
      21

           Z
                                                                              
               Rx (z)xÌÏ (z) + RX (z)XÌÏ + RX+ (z) XÌÏ + â XÌ Â· â¦ÌÏ + XÌÎ PXÌÏ dâ¦(z) = 0.


Substituting for          â xÌ,   we obtain and dening           XÌÏ0 = â XÌ Â· â¦ÌÏ

     Fxâ (z)xÌÏ (z) + Fx (z)xÌÏ (z) + Fx+ (z) xÌÏ (z) + xÌz (z)pxÌÏ (z) + C(z)XÌÏ0 + xÌÎ (z)PXÌÏ
                                                                                                                              

     + FX (z)XÌÏ + FÏ (z) = 0,

or
                                                                   h                        i|
                                        L(z)xÌÏ (z) = M(z)             I XÌÏ XÌÏ0                 .                          (81)


Dierentiating with respect to                Ï   yields

                                      Z X                                                Y
                                              Î´(zÌ i (Îµ, E, Î, z, â¦, Î) â y i )                 Î¹ zÌ j (Îµ, E, Î, z, â¦, Î) â¤ y j
                                                                                                                                  
 â¦ÌÏ (E, Î, â¦, Î)(y) = â
                                          i                                              j6=i

                                              zÌÎµi (Îµ, E, Î, z, â¦) Îµ          zÌÏi
                                                                                                    
                                        Ã                                 +          (Îµ, E, Î, z, â¦) dPr(Îµ)dâ¦(z)

which evaluated at            Ï=0      gives (as    Îµ   is mean 0)


                                              XZ                     Y
                            â¦ÌÏ (y) = â              Î´(z i â y i )          Î¹(z j â¤ y j )zÌÏi (z)dâ¦(z).
                                              i                      j6=i

  21 Note, we have dropped all the expectations as they are zero.




                                                                  11
and
                                                          X â
                                                                zÌÏi (y)Ï(y) .
                                                                            
                                        ÏÌE (y) = â           i
                                                           ây
                                                            i

Plugging in for the denition of             XÌÏ0    we nd

                                            Z
                              XÌÏ0 = Dâ1         (Rz (z) + Rx (z)xÌz (z)) pxÌÏ (z)dâ¦(z)                                          (82)



Substituting for       xÌÏ (z)   in (82) and

          Z
               Rx (z)xÌÏ (z) + RX (z)XÌÏ + RX+ XÌÏ + XÌÏ0 + XÌÎ PXÌÏ + RÏ (z)dâ¦(z) = 0
                                                                    


yields a linear system
                                                      h                i|
                                                 NÂ·       XÌÏ   XÌÏ0        =O                                                   (83)


which is composed of small matrices.




B.6 Second-Order Terms
Here we describe how to compute all the second-order terms required for the Taylor expan-

sion. To save on space, when obvious we drop dependence on                                 z.


B.6.1 Derivatives w.r.t. states
We start by dierentiating with respect to the states                           z   and    â¦.   The term        â xÌz (z)   can be

computed by dierentiating              F   w.r.t.    z   and then taking the Frechet derivative with respect

to   â¦   to nd

                                                                                        
0 =Fxâ â xÌz + Fx â xÌz + Fx+ â xÌz + xÌzÎ â ÎÌ + FxâX Â· xÌz , â XÌ + FxX Â· xÌz , â XÌ
   + Fx+X Â· xÌz , â XÌ + Fzxâ Â· (I, â xÌ) + Fzx Â· (I, â xÌ) + FzX Â· I, â XÌ + Fzx+ Â· I, â xÌ+
                                                                                            

   + Fxâxâ Â· (xÌz , â xÌ) + Fxâx Â· (xÌz , â xÌ) + FxâX Â· xÌz , â XÌ + Fxâx+ Â· xÌz , â xÌ+
                                                                                         

   + Fxxâ Â· (xÌz , â xÌ) + Fxx Â· (xÌz , â xÌ) + FxX Â· xÌz , â XÌ + Fxx+ Â· xÌz , â xÌ+
                                                                                     

   + Fx+xâ Â· (xÌz , â xÌ) + Fx+x Â· (xÌz , â xÌ) + Fx+X Â· xÌz , â XÌ + Fx+x+ Â· xÌz , â xÌ+
                                                                                         


where     I   represents the identity matrix and we use                    a Â· (b, c)    to denote a bilinear map
                                                                                                                            22   and

â xÌ+ (z)     â¡ â xÌ(z) + xÌÎ (z)â ÎÌ   . This linear system is easily solved to give

                                                                                    
                                                â xÌz (z) = Q(z) Â· I, â XÌ                                                       (84)

  22 Specically, if     a   is a   n1 Ã n2 Ã n3     tensor,    b   is a   n2 Ã n4      matrix and   c   is a   n3 Ã n5     matrix



                                                                12
where     Q(z) is nx Ã nz Ã nX . The derivatives of xÌzz (z), xÌzÎ (z) and xÌzÎ (z) are equally easy
as they do not eect aggregates.

      Next, twice dierentiating with respect to                      Î   (again with the knowledge that        zÌÎÎ = 0
and    â¦ÌÎÎ = 0)   implies



0 =Fxâ xÌÎÎ + Fx xÌÎÎ + FX XÌÎÎ + Fx+ xÌÎ PXÌÎÎ + xÌÎÎ ÎÌ2Î
                                                                                     

      + Fxâxâ Â· (xÌÎ, xÌÎ ) + 2Fxâx Â· (xÌÎ , xÌÎ ) + 2FxâX (xÌÎ , XÌÎ ) + 2Fxâx+ Â· (xÌÎ , xÌÎ ÎÌÎ ) + 2FxâÎ xÌÎ
      + Fxx Â· (xÌÎ , xÌÎ ) + 2FxX Â· (xÌÎ , XÌÎ ) + 2Fxx+ Â· (xÌÎ , xÌÎ ÎÌÎ ) + 2FxÎ xÌÎ + FXX Â· (XÌÎ , XÌÎ )
      + 2FXx+ Â· (XÌÎ , xÌÎ ÎÌÎ ) + 2FXÎ XÌÎ + Fx+x+ Â· (xÌÎ ÎÌÎ , xÌÎ ÎÌÎ ) + 2Fx+Î xÌÎ ÎÌÎ + FÎÎ

and

      Z
             Rx (z)xÌÎÎ (z) + RX (z)XÌÎÎ + RX+ (z) XÌÎ PXÌÎÎ + XÌÎÎ ÎÌ2Î + Rxx (z) Â· (xÌÎ (z), xÌÎ (z))
                                                                        
0=
                                                                    
             + 2RxX (z) Â· xÌÎ (z), XÌÎ + 2RxX+ (z) Â· xÌÎ (z), XÌÎ ÎÌÎ + 2RxÎ (z)xÌÎ (z)
                                                              
             + RXX (z) Â· XÌÎ , XÌÎ + 2RXX+ (z) Â· XÌÎ , XÌÎ ÎÌÎ + 2RXÎ (z)XÌÎ
                                                                     !
                                        
             + RX+X+ Â· XÌÎ ÎÌÎ , XÌÎ ÎÌÎ + 2RX+Î XÌÎ ÎÌÎ + RÎÎ (z) dâ¦(z)


From the rst set of equations, we obtain

                                                                          h              i
                                     S(z)xÌÎÎ (z) = T(z)                      I XÌÎÎ                                     (85)



which we can then plug into the             R   equation to yield



                                                 U(z)XÌÎÎ = V(z).                                                        (86)



A identical approach can be used to obtain expressions for                          xÌÎÎ (z), xÌÎÎ (z), XÌÎÎ   and       XÌÎÎ
which take the same form.

      Next   â xÌÎ (z) is computed by dierentiating F                    and   R w.r.t Î and then taking the Frechet

then   d = a Â· (b, c)   is   n1 Ã n4 Ã n5   tensor dened by

                                                         X
                                                dilm =             aijk bjl ckm .
                                                             j,k

This denition generalizes to when              a, b,   or   c     is innite dimensional, such as with        â xÌz .




                                                                 13
derivative with respect to       â¦    to nd (exploiting   â â¦ÌÎ = 0)
                                                                                                  
0 =Fxâ â xÌÎ + Fx â xÌÎ + FX â XÌÎ + Fx+ xÌÎ Pâ XÌÎ + â xÌÎ ÎÌÎ + xÌÎÎ Â· ÎÌÎ , â ÎÌ
      + Fxâxâ Â· (xÌÎ, â xÌ) + Fxâx Â· (xÌÎ , â xÌ) + FxâX (xÌÎ , â XÌ) + Fxâx+ Â· (xÌÎ , â xÌ+ ) + Fxxâ Â· (xÌÎ , â xÌ)
      + Fxx Â· (xÌÎ , â xÌ) + FxX Â· (xÌÎ , â XÌ) + Fxx+ Â· (xÌÎ , â xÌ+ ) + FXxâ Â· (XÌÎ , â xÌ) + FXx Â· (XÌÎ , â xÌ)
      + FXx+ Â· (XÌÎ , â xÌ+ ) + Fx+xâ Â· (xÌÎ ÎÌÎ , â xÌ) + Fx+x Â· (xÌÎ ÎÌÎ , â xÌ) + Fx+X Â· (xÌÎ ÎÌÎ , â XÌ)
      + Fx+x+ Â· (xÌÎ ÎÌÎ , â xÌ+ )

and

      Z
                                                                 
0=            RÎ (z) + Rx (z)xÌÎ (z) + RX (z)XÌÎ + RX+ (z)XÌÎ ÎÌÎ Î´(z)dz
          Z
                                                                                                             
      +          Rx (z)â xÌÎ (z) Â· â + RX+ (z) XÌÎ Pâ XÌÎ Â· â + â XÌÎ Â· âÎÌÎ + XÌÎÎ Â· ÎÌÎ , â ÎÌ Â· â

      + RX (z)â XÌÎ Â· â + Rxx (z) Â· (xÌÎ (z), â xÌ(z) Â· â) + RxX (z) Â· (xÌÎ (z), â XÌ Â· â)
      + RxX+ (z) Â· (xÌÎ (z), â XÌ + Â· â) + RXx (z) Â· (XÌÎ , â xÌ(z) Â· â) + RXX (z) Â· (XÌÎ , â XÌ Â· â)
      + RXX+ (z) Â· (XÌÎ , â XÌ + Â· â) + RX+x (XÌÎ ÎÌÎ , â xÌ(z) Â· â) + RX+X Â· (XÌÎ ÎÌÎ , â XÌ Â· â)
                                                                                                                   !
      + RX+X+ Â· (XÌÎ ÎÌÎ , â XÌ + Â· â) + RÎx (z)â xÌ(z) Â· â + RÎX (z)â XÌ Â· â + RÎX+ (z)â XÌ + Â· â dâ¦(z),


where     â XÌ + â¡ â XÌ + XÌÎ â ÎÌ.   From   F   equations we immediately obtain

                                                           h                 i|
                                  W(z)â xÌÎ (z) = X(z)         â XÌÎ â XÌ                                   (87)



which can be plugged into the equations from            R      to obtain

                                 Z
                                                                                          
 Yâ XÌÎ Â· â = Zâ XÌ Â· â +              RÎ (z) + Rx (z)xÌÎ (z) + RX (z)XÌÎ + RX+ (z)XÌÎ ÎÌÎ Î´(z)dz.
                                                                                                            (88)

A similar approach can be used to obtain expressions for                â xÌÎ (z)   and   â XÌÎ   which take the

same form.




                                                      14
     Finally the second-order Frechet derivative of               F   in the directions of   â1    and   â2    yields



0 =Fxâ â 2 xÌ Â· (â1 , â2 ) + Fx â 2 xÌ Â· (â1 , â2 ) + Fx+ â 2 xÌ Â· (â1 , â2 ) + FX â 2 XÌ Â· (â1 , â2 )
   + Fx+ xÌÎ Pâ 2 XÌ Â· (â1 , â2 ) + xÌÎÎ Â· â XÌ Â· â1 , â XÌ Â· â2 + (â xÌÎ Â· â1 ) â ÎÌ Â· â2 + (â xÌÎ Â· â2 ) â ÎÌ Â· â1
                                                                                                                   

   + Fxâxâ Â· (â xÌ Â· â1 , â xÌ Â· â2 ) + Fxâx Â· (â xÌ Â· â1 , â xÌ Â· â2 ) + Fxâx+ Â· â xÌ Â· â1 , â xÌ+ Â· â2
                                                                                                         
                                       
   + FxâX Â· â xÌ Â· â1 , â XÌ Â· â2 + Fxxâ Â· (â xÌ Â· â1 , â xÌ Â· â2 ) + Fxx Â· (â xÌ Â· â1 , â xÌ Â· â2 )
   + Fxx+ Â· â xÌ Â· â1 , â xÌ+ Â· â2 + FxX Â· â xÌ Â· â1 , â XÌ Â· â2 + Fx+xâ Â· â xÌ+ Â· â1 , â xÌ Â· â2
                                                                                                        

   + Fx+x Â· â xÌ+ Â· â1 , â xÌ Â· â2 + Fx+x+ Â· â xÌ+ Â· â1 , â xÌ+ Â· â2 + Fx+X Â· â xÌ+ Â· â1 , â XÌ Â· â2
                                                                                                          

   + FXxâ Â· â XÌ Â· â1 , â xÌ Â· â2 + FXx Â· â XÌ Â· â1 , â xÌ Â· â2 + FXx+ Â· â XÌ Â· â1 , â xÌ+ Â· â2
                                                                                                        
                                      
   + FXX Â· â XÌ Â· â1 , â XÌ Â· â2

Substituting for         â xÌ(z) = C(z)â XÌ   and   â xÌÎ (z),   and then solving for   â 2 xÌ   gives



              â 2 xÌ(z) Â· (â1 , â2 ) =C(z)â 2 XÌ Â· (â1 , â2 ) + AA1 (z) Â· â XÌ Â· â1 , â XÌ Â· â2
                                                                                                
                                                                                              
                                      + AA2 (z) â XÌÎ Â· â1 â ÎÌ Â· â2 + â XÌÎ Â· â2 â ÎÌ Â· â1 .                     (89)



     To nd     â 2 XÌ   we dierentiate   R   w.r.t   â¦   in the direction   â1   and then      â2   to nd

     Z
0=           Rx (z)â 2 xÌ(z) Â· (â1 , â2 ) + RX (z)â 2 XÌ Â· (â1 , â2 ) + RX+ (z)â 2 XÌ Â· (â1 , â2 )
                                                                                             
     + RX+ (z) XÌÎÎ (â ÎÌ Â· â1 )(â ÎÌ Â· â2 ) + â XÌÎ Â· â1 â ÎÌ Â· â2 + â XÌÎ Â· â2 â ÎÌ Â· â1
                                                                                     
     + Rxx (z) Â· (â xÌ(z) Â· â1 , â xÌ(z) Â· â2 ) + RxX (z) Â· â xÌ(z) Â· â1 , â XÌ Â· â2
     + RxX+ (z) Â· â xÌ(z) Â· â1 , â XÌ + Â· â2 + RXx (z) Â· â XÌ Â· â1 , â xÌ(z) Â· â2 + RXX (z) Â· â XÌ Â· â1 , â XÌ Â· â2
                                                                                                                  

     + RXX+ (z) Â· â XÌ Â· â1 , â XÌ + Â· â2 + RX+x (z) Â· â XÌ + Â· â1 , â xÌ(z) Â· â2
                                                                                        
                                                                                             !
     + RX+X (z) Â· â XÌ + Â· â1 , â XÌ Â· â2 + RX+X+ (z) Â· â XÌ + Â· â1 , â XÌ + Â· â2 dâ¦(z)
                                                                                          

         Z
              Rx (z)â xÌ(z) Â· â1 + RX (z)â XÌ Â· â1 + RX+ (z)â XÌ + Â· â1 dâ2 (z)
                                                                       
     +
         Z
              Rx (z)â xÌ(z) Â· â2 + RX (z)â XÌ Â· â2 + RX+ (z)â XÌ + Â· â2 dâ1 (z)
                                                                       
     +




                                                           15
A bit of rearranging and substituting for                    â 2 xÌ   yields

                            Z
    2
                                    Rx (z)â xÌ(z) Â· â1 + RX (z)â XÌ Â· â1 + RX+ (z)â XÌ + Â· â1 dâ2 (z)
                                                                                             
Dâ XÌ Â· (â1 , â2 ) =
                                Z
                                 Rx (z)â xÌ(z) Â· â2 + RX (z)â XÌ Â· â2 + RX+ (z)â XÌ + Â· â2 dâ1 (z)
                                                                                          
                            +
                                                                                                
                            + BB Â· â XÌ Â· â1 , â XÌ Â· â2 + CC â XÌÎ Â· â2 â ÎÌ Â· â1 + CC â XÌÎ Â· â1 â ÎÌ Â· â2 .
                                                                                                                (90)



B.6.2 Derivatives w.r.t. shocks
Next we proceed by taking derivatives w.r.t.                             Ï   and then use the method of undeter-

mined coecients to nd the derivatives associated with each pair of shocks. Solving for

xÌÎµÎµ , xÌÎµÎ , xÌÎµÎ , xÌÎµÏ   and     xÌÎµE   are trivial as these interactions do not eect aggregates so we

omit those formulas them for brevity.

     For    xÌEÎ   we see (after dening             xÌ+
                                                       E = xÌÎ + xÌz zÌE + â xÌ Â· â¦ÌE + xÌÎ ÎÌE )

                                                                                                               
0 =Fx xÌEÎ + FX XÌEÎ + Fx+ xÌÎÎ ÎÌÎ + xÌzÎ xÌE ÎÌÎ + â xÌÎ Â· â¦ÌE ÎÌÎ + xÌz pxÌEÎ + â xÌ Â· â¦ÌEÎ
        + Fx+ xÌÎ PXÌEÎ + Fxxâ Â· (xÌE , xÌÎ ) + Fxx Â· (xÌE , xÌÎ ) + FxX Â· (xÌE , XÌÎ ) + Fxx+ Â· (xÌE , xÌÎ ÎÌÎ ) + FxÎ xÌE
        + FXxâ Â· (XÌE , xÌÎ ) + FXx Â· (XÌE , xÌÎ ) + FXx+ Â· (XÌE , xÌÎ ÎÌÎ ) + FXÎ XÌÎ + Fx+xâ Â· (xÌ+
                                                                                                    E , xÌÎ )

        + Fx+x Â· (xÌ+                     +                      +                       +
                    E , xÌÎ ) + Fx+X Â· (xÌE , XÌÎ ) + Fx+x+ Â· (xÌE , xÌÎ ÎÌÎ ) + Fx+Î (xÌE )

        + FExâ xÌÎ + FEx xÌÎ + FEX XÌÎ + FEx+ xÌÎ ÎÌÎ + FEÎ

Most of these terms are already known, but there are a few that are new and need to be

computed:       â xÌ Â· â¦ÌEÎ   and    â xÌÎ Â· â¦ÌE .   For the rst,
                                                                                                              0 .
                                                                        â xÌ Â· â¦ÌEÎ = C(z)â XÌ Â· â¦ÌEÎ â¡ C(z)XÌEÎ    For

the second, we have



                        â xÌÎ (z) Â· â¦ÌE = Y(z)â1 z1 (z)â XÌÎ Â· â¦ÌE + Y(z)â1 z2 (z)XE0

where

                                           Z
â XÌÎ Â· â¦ÌE = Yâ1 ZXE0 + Yâ1
                                                                                                  
                                               RÎ (z) + Rx (z)xÌÎ (z) + RX (z)XÌÎ + RX+ (z)XÌÎ ÎÌÎ ÏÌE (z)dz
                                           Z
                                              â           â
               = Yâ1 ZXE0 + Yâ1                 RÎ (z) +    RÎ (z)xÌÎ (z) + RÎ (z)xÌÎz (z)
                                             âz          âz
                                                                               !
                                       â               d
                                    +    RX (z)XÌÎ +     RX+ (z)XÌÎ ÎÌÎ zÌE (z) Ï(z)dz
                                      âz              dz




                                                                 16
where the last term is easily computable from known terms.
                                                                                        23    Thus, we can show that the

derivative   xÌEÎ   solves the following system of equations

                                                                    h                         i
                              DD(z)xÌEÎ = EE(z)                                  0
                                                                        I XÌEÎ XÌEÎ               .                       (91)



   To determine
                                 0 , proceed in the same manner as the rst-order terms.
                      XÌEÎ and XÌEÎ                                                                                     Recall

we had,

                              Z X                                                    Y
                                              Î´(zÌ i (Îµ, E, Î, z, â¦, Î) â y i )             Î¹ zÌ j (Îµ, E, Î, z, â¦, Î) â¤ y j
                                                                                                                              
 â¦ÌE (E, Î, â¦, Î)(y) = â
                                      i                                              j6=i

                                   Ã      zÌEi    (Îµ, E, Î, z, â¦) dPr(Îµ)dâ¦(z),

and thus

                              Z X                                                    Y
                                              Î´(zÌ i (Îµ, E, Î, z, â¦, Î) â y i )             Î¹ zÌ j (Îµ, E, Î, z, â¦, Î) â¤ y j
                                                                                                                              
â¦ÌEÎ (E, Î, â¦, Î)(y) = â
                                    i                                                j6=i
                                        i
                                  Ã   zÌEÎ (Îµ, E, Î, z, â¦, Î) dPr(Îµ)dâ¦(z)
                              Z         X                                                Y
                                                  Î´ 0 (zÌ i (Îµ, E, Î, z, â¦, Î) â y i )          Î¹ zÌ j (Îµ, E, Î, z, â¦, Î) â¤ y j
                                                                                                                                  
                          â
                                              i                                          j6=i
                                                                                                          !
                                              Ã   zÌEi   (Îµ, E, Î, z, â¦, Î) zÌÎi (Îµ, E, Î, z, â¦, Î)           dPr (Îµ) dâ¦(z)

                              Z         XX
                          +                              Î´(zÌ i (Îµ, E, Î, z, â¦, Î) â y i )Î´(zÌ j (Îµ, E, Î, z, â¦, Î) â y j )
                                              i   j6=i
                                  Y                              
                                   Î¹ zÌ k (Îµ, E, Î, z, â¦, Î) â¤ y k zÌEi (Îµ, E, Î, z, â¦, Î)
                                  k6=i,j
                                                                                
                                              Ã   zÌÎi (Îµ, E, Î, z, â¦, Î)        dPr (Îµ) dâ¦(z)


Evaluating this term at       Ï=0             and exploiting        zÌÎ (z) = 0    we have


                                      XZ                            Y
                       â¦ÌEÎ = â                     Î´(z i â y i )          Î¹(z j â¤ y j )zÌEÎ
                                                                                          i
                                                                                             (z)dâ¦(z)
                                          i                         j6=i

  23 For compactness we have not expanded terms like â R (z), but this is easily accom-
                                                           âz Î
                      â
plished. For example
                     âz RÎ (z) = R Îz (z) + R Îx (z) xÌÎ (z) .




                                                                  17
and thus

                     X â Z Y                                X â
                                 j     j i                           i
                                                                               
        ÏÌEÎ (y) = â         Î´(z   â y  ) zÌEÎ (z)dâ¦(z) = â       zÌ EÎ (y)Ï(y)
                      ây i                                   ây i
                          i             j                                         i


and hence

                                            ZX â
                           0           â1                  i
                                                                     
                         XÌEÎ   = âD             R(z)   zÌEÎ (z)Ï(z)   dz
                                                  âz i
                                               i
                                      Z X            
                                   â1        â             i
                                =D               R(z) zÌEÎ   (z)Ï(z)dz
                                            âz i
                                        i
                                      Z X
                                = Dâ1                                  i
                                          (Rzi (z) + Rx (z)xÌzi (z)) zÌEÎ dâ¦(z)
                                                i
                                        Z
                                = Dâ1        (Rz (z) + Rx (z)xÌz (z)) qxÌEÎ (z)dâ¦(z)


which combined with the second derivative of                  R   w.r.t.   EÎ   (dening   XÌE+ = XÌÎ + XÌE0 +
XÌÎ ÎÌE )


Z
                                                                                     0
                                                                                                                   
     Rx (z)xÌEÎ (z) + RX (z)XÌEÎ + RX+ (z) XÌÎÎ ÎÌÎ + â XÌÎ Â· â¦ÌE + XÌÎÎ ÎÌÎ ÎÌE + XÌEÎ + XÌÎ PXÌEÎ
                                                                                      
      + Rxx (z) Â· (xÌE (z), xÌÎ (z)) + RxX (z) Â· xÌE (z), XÌÎ + RxX+ Â· xÌE (z), XÌÎ ÎÌÎ + RxÎ (z)xÌE (z)
                                                                                   
      + RXx (z) Â· XÌE , xÌÎ (z) + RXX (z) Â· XÌE , XÌÎ + RXX+ (z) Â· XÌE , XÌÎ ÎÌÎ + RXÎ (z)XÌE
      + RX+x (z) Â· XÌE+ , xÌÎ (z) + RX+X (z) Â· XÌE+ , XÌÎ + RX+X+ (z) Â· XÌE+ , XÌÎ ÎÌÎ + RX+Î (z)XÌE+
                                                                                       
                                                                   !
      + REx (z)xÌÎ (z) + REX (z)XÌÎ + REX+ (z)XÌÎ ÎÌÎ + REÎ (z) dâ¦(z) = 0


gives a linear relationship
                                                 h                i
                                            FF              0
                                                     XÌEÎ XÌEÎ        = GG                                 (92)


to solve for   XÌEÎ .   A similar approach can be used to obtain expressions for                xÌEÎ (z), XÌEÎ ,
xÌÏÎ (z), XÌÏÎ , xÌÏÎ (z),    and   XÌÏÎ ,   which take the same form.




                                                         18
     For   xÌEE   we see


                                                                                                                    
0 =Fx xÌEE + FX XÌEE + Fx+ xÌz pxÌEE + â xÌ Â· â¦ÌEE + xÌÎ PXÌEE + xÌÎÎ + xÌÎz Â· (I, zÌE ) + â xÌÎ Â· I, â¦ÌE
                                                                                                                    
     + xÌÎÎ Â· I, ÎÌE + xÌzz Â· (zÌE , zÌE ) + xÌzÎ Â· (zÌE , I) + â xÌz Â· zÌE , â¦ÌE + xÌzÎ Â· zÌE , ÎÌE + â xÌÎ Â· â¦ÌE , I
     + â xÌz Â· â¦ÌE , zÌE + â xÌÎ Â· â¦ÌE , I + â xÌz Â· â¦ÌE , zÌE + â 2 xÌ Â· (â¦ÌE , â¦ÌE ) + â xÌÎ Â· â¦ÌE , ÎÌE
                                                                                                        
                                                                                       !
                                                             
     + xÌÎÎ Â· ÎÌE , I + xÌÎz Â· ÎÌE , zÌE + â xÌÎ Â· ÎE , â¦ÌE + xÌÎÎ Â· (ÎE , ÎE ) + Fxx Â· (xÌE , xÌE )

     + FxX Â· xÌE , XÌE + Fxx+ Â· xÌE , xÌ+
                                                                                              
                                         E + FxE Â· (xÌE , I) + FXx Â· XÌE , xÌE + FXX Â· XÌE , XÌE

     + FXx+ Â· XÌE , xÌ+                                +                     +                  +  +
                                                                                                 
                       E + FXE Â· XÌE , I + Fx+x Â· xÌE , xÌE + Fx+X Â· xÌE , XÌE + Fx+x+ Â· xÌE , xÌE

     + Fx+E Â· xÌ+                                                     +
                                                                      
                E , I + FEx Â· (I, xÌE ) + FEX Â· I, XÌE + FEx+ Â· I, xÌE + FEE


     Once again, almost all of these terms are already known with the exception of                      â 2 xÌ Â·
(â¦ÌE , â¦ÌE )   which is computable from the expressions for          â 2 XÌ   above and   â xÌ Â· â¦ÌEE   which

equals
                                                                      0
                             â xÌ(z) Â· â¦ÌEE = C(z)â XÌ Â· â¦ÌEE = C(z)XÌEE .

Thus, we have that
                                                        h                     i|
                             H(z)xÌEE (z) = HH(z)           I XÌEE     0
                                                                     XÌEE          ,                     (93)


where    H(z) is the same as in the rst-order expansion equation (80) and HH(z) is computable
from the rst-order terms.

     To solve for    XÌEE   and
                                    0
                                  XÌEE   we rst need   â¦ÌEE   which we nd by dierentiating the law




                                                    19
of motion for   â¦   to get

                                 Z X                                                         Y
                                            Î´(zÌ i (Îµ, E, Î, z, â¦, Î) â y i )                       Î¹ zÌ j (Îµ, E, Î, z, â¦, Î) â¤ y j
                                                                                                                                      
â¦ÌEE (E, Î, â¦, Î)(y) = â
                                        i                                                    j6=i
                                         i
                                     Ã zÌEE (Îµ, E, Î, z, â¦, Î) dPr(Îµ)dâ¦(z)
                                 Z          X                                                     Y
                                                 Î´ 0 (zÌ i (Îµ, E, Î, z, â¦, Î) â y i )                    Î¹ zÌ j (Îµ, E, Î, z, â¦, Î) â¤ y j
                                                                                                                                           
                             â
                                            i                                                     j6=i
                                                                                                                   !
                                                Ã   zÌEi   (Îµ, E, Î, z, â¦, Î) zÌEi         (Îµ, E, Î, z, â¦, Î) dPr (Îµ) dâ¦(z)
                                 Z XX
                             +                             Î´(zÌ i (Îµ, E, Î, z, â¦, Î) â y i )Î´(zÌ j (Îµ, E, Î, z, â¦, Î) â y j )
                                            i       j6=i
                                                     Y                              
                                                Ã     Î¹ zÌ k (Îµ, E, Î, z, â¦, Î) â¤ y k zÌEj (Îµ, E, Î, z, â¦, Î)
                                                    k6=i,j
                                                                                                              !
                                                Ã zÌEi (Îµ, E, Î, z, â¦, Î) dPr (Îµ) dâ¦(z) .


Evaluated at    Ï = 0,   this becomes

                         Z X                               Y
       â¦ÌEE (y) = â                  Î´(z i â y i )                Î¹(z j â y j )zÌEE
                                                                                 i
                                                                                    (z)dâ¦(z)
                                 i                         j6=i
                         Z X                               Y                            2
                                     Î´ 0 (z i â y i )             Î¹(z j â y j ) zÌEi (z) dâ¦(z)
                                                                               
                     â
                                 i                         j6=i
                         Z X
                                                                                           Î¹(z k â y k )zÌEj (z)zÌEi (z)dâ¦(z)
                                                           X                      Y
                     +               Î´(z i â y i )                Î´(z j â y j )
                                 i                         j6=i                   k6=i,j


and


                  â nz                      X â                              Z Y
ÏÌEE (y) =     1  2        n
                              â¦Ì EE (y) = â                                           Î´(z j â y j )zÌEE
                                                                                                     i
                                                                                                        (z)dâ¦(z)
             ây ây Â· Â· Â· ây z                ây i
                                                                  i               j
                                                             X â Z                    Y                           2
                                                                          0 i     i
                                                           â      i
                                                                        Î´  (z â y   )      Î´(z j â y j ) zÌEi (z) dâ¦(z)
                                                               ây
                                                             i                        j6=i
                                                             X X â2 Z Y
                                                           +                          Î´(z j â y j )zÌEj (z)zÌEi dâ¦(z)
                                                                    ây i ây j
                                                                  i   j6=i                    j
                                                              X â
                                                                       i
                                                                                 X X â2  i               j
                                                                                                                    
                                                      =â            zÌ   (y)Ï(y) +             zÌ   (y) zÌ   (y)Ï(y)  .
                                                               ây i EE               ây i ây j    E       E
                                                                  i                                       i    j




                                                                       20
Thus,

                    ï£«                                                           ï£¶
          Z            X â                        â 2                        
                                                          zÌEi (z)zÌEj (z)Ï(z) ï£¸ dz
                                            X X
  0                            i
                                         
XÌEE =         R(z) ï£­â     i
                             zÌEE (z)Ï(z) +       i   j
                        âz                      âz âz
                          i                                 i    j
          Z
      =     (Rz (z) + Rx (z)xÌz (z)) pxÌiEE (z)Ï(z)dz
            Z                                                                                           
          +      Rzz (z) + Rxz (z) Â· (I, xÌz (z)) + Rzx (z) Â· (xÌz (z), I) + Rxx (z) Â· (xÌz (z), xÌz (z))

                 Â· (pxÌE (z), pxÌE (z)) Ï(z)dz

which when combined with the second derivative of                     R    w.r.t    EE
     Z            
           RX+ (z) XÌÎÎ + â XÌÎ Â· I, â¦ÌE + XÌÎÎ Â· I, ÎÌE + â XÌÎ Â· â¦ÌE , I + â 2 XÌ Â· â¦ÌE , â¦ÌE
                                                                                             
0=
                                                                                                                           !
                                                                                    0
              + â XÌÎ Â· â¦ÌE , ÎE + XÌÎÎ Â· ÎÌE , I + â XÌÎ Â· ÎÌE , I + XÌÎÎ ÎÌ2E + XÌEE
                                                                                 
                                                                                       + XÌÎ PXÌEE
                                                                                                                     
              + Rx (z)xÌEE (z) + RX (z)XÌEE + Rxx (z) Â· (xÌE (z), xÌE (z)) + RxX (z) Â· xÌE (z), XÌE
              + RxX+ (z) Â· xÌE (z), XÌE+ + RxE (z) Â· (xÌE (z), I) + RXx (z) Â· XÌE , xÌE (z)
                                                                                          

              + RXX (z) Â· XÌE , XÌE + RXX+ (z) Â· XÌE , XÌE+ + RXE (z) Â· XÌE , I
                                                                                   

              + RX+x (z) Â· XÌE+ , xÌE (z) + RX+X (z) Â· XÌE+ , XÌE + RX+X+ (z) Â· XÌE+ , XÌE+
                                                                                              

              + RX+E (z) Â· XÌE+ , I + REx (z) Â· (I, xÌE (z)) + REX (z) Â· I, XÌE
                                                                               
                                              !
              + REX+ (z) Â· I, XÌE+ + REE (z) dâ¦(z)
                                    



gives a system of linear equations of the form

                                             h                       i|
                                        KÂ·       XÌEE         0
                                                            XÌEE          = II.                                     (94)



A similar approach can be used to obtain expressions for                          xÌEÏ (z)   and   XÌEÏ   which take the

same form.

     Finally, for the second-order expansion we need the eect of the presence of risk. Dier-




                                                            21
entiation of        F   gives, after dening   xÌ+
                                                 Ï = xÌz zÌÏ + â xÌ Â· â¦ÌÏ + xÌÎ ÎÌÏ + xÌÏ ,
                                                                                                                           !
0 =Fx xÌÏÏ + FX XÌÏÏ + Fx+ E [xÌÎµÎµ Â· (Îµ, Îµ) + xÌEE Â· (E, E)] + xÌz pxÌÏÏ + â xÌ Â· â¦ÌÏÏ + xÌÎ PXÌÏÏ


       + Fx+ xÌzz Â· (zÌÏ , zÌÏ ) + 2â xÌz Â· (â¦ÌÏ , zÌÏ ) + 2xÌzÎ Â· (zÌÏ , ÎÌÏ ) + 2xÌzÏ zÌÏ + â 2 xÌ Â· (â¦ÌÏ , â¦ÌÏ )
                                                                                               !
       + 2â xÌÎ Â· (â¦ÌÏ , ÎÌÏ ) + 2â xÌÏ Â· â¦ÌÏ + xÌÎÎ Â· (ÎÌÏ , ÎÌÏ ) + 2xÌÎÏ ÎÌÏ + xÌÏÏ             + Fxâxâ Â· (xÌÏ, xÌÏ )

       + 2Fxâx Â· (xÌÏ , xÌÏ ) + 2FxâX (xÌÏ , XÌÏ ) + 2Fxâx+ Â· (xÌÏ , xÌ+
                                                                       Ï ) + 2FxâÏ xÌÏ

       + Fxx Â· (xÌÏ , xÌÏ ) + 2FxX Â· (xÌÏ , XÌÏ ) + 2Fxx+ Â· (xÌÏ , xÌ+
                                                                     Ï ) + 2FxÏ xÌÏ + FXX Â· (XÌÏ , XÌÏ )

       + 2FXx+ Â· (XÌÏ , xÌ+                           +     +             +
                          Ï ) + 2FXÏ XÌÏ + Fx+x+ Â· (xÌÏ , xÌÏ ) + 2Fx+Ï xÌÏ + FÏÏ

       + Fxâ E [xÌÏÏ + xÌÎµÎµ Â· (Îµ, Îµ) + xÌEE Â· (E, E)] = 0.

or
  24

                                                                                                                       !
0 =Fx xÌÏÏ + FX XÌÏÏ + Fx+ xÌÎµÎµ Â· var(Îµ) + xÌEE Â· var(E) + xÌz pxÌÏÏ + â xÌ Â· â¦ÌÏÏ + xÌÎ PXÌÏÏ


       + Fx+ xÌzz Â· (zÌÏ , zÌÏ ) + 2â xÌz Â· (â¦ÌÏ , zÌÏ ) + 2xÌzÎ Â· (zÌÏ , ÎÌÏ ) + 2xÌzÏ zÌÏ + â 2 xÌ Â· (â¦ÌÏ , â¦ÌÏ )
                                                                                               !
       + 2â xÌÎ Â· (â¦ÌÏ , ÎÌÏ ) + 2â xÌÏ Â· â¦ÌÏ + xÌÎÎ Â· (ÎÌÏ , ÎÌÏ ) + 2xÌÎÏ ÎÌÏ + xÌÏÏ

       + Fxâxâ Â· (xÌÏ, xÌÏ ) + 2Fxâx Â· (xÌÏ , xÌÏ ) + 2FxâX (xÌÏ , XÌÏ ) + 2Fxâx+ Â· (xÌÏ , xÌ+
                                                                                             Ï ) + 2FxâÏ xÌÏ

       + Fxx Â· (xÌÏ , xÌÏ ) + 2FxX Â· (xÌÏ , XÌÏ ) + 2Fxx+ Â· (xÌÏ , xÌ+
                                                                     Ï ) + 2FxÏ xÌÏ + FXX Â· (XÌÏ , XÌÏ )

       + 2FXx+ Â· (XÌÏ , xÌ+                           +     +             +
                          Ï ) + 2FXÏ XÌÏ + Fx+x+ Â· (xÌÏ , xÌÏ ) + 2Fx+Ï xÌÏ + FÏÏ

       + Fxâ [xÌÏÏ + xÌÎµÎµ Â· var(Îµ) + xÌEE Â· var(E)]

       Dening
                                                              0 ,
                     â xÌ(z) Â· â¦ÌÏÏ = C(z)â XÌ Â· â¦ÌÏÏ â¡ C(z)XÌÏÏ        we nd that           xÌÏÏ (z)   solves the linear

system
                                                             h                       i|
                                    JJ(z)xÌÏÏ (z) = KK(z)                 0
                                                                 I XÌÏÏ XÌÏÏ              .                          (95)


  24 Recall          xÌÎµÎµ is    a 3-dimensional tensor.      We dene       xÌÎµÎµ Â·   var(Îµ) by the contraction
P
     jk [xÌ ÎµÎµ ]ijk var (Îµ)jk




                                                          22
To solve for
                 0
               XÌÏÏ   we need to nd               â¦ÌÏÏ    by dierentiating the law of motion for                 â¦ 25
                                Z         X                                              Y
                                                  Î´(zÌ i (Îµ, E, Î, z, â¦, Î) â y i )              Î¹ zÌ j (Îµ, E, Î, z, â¦, Î) â¤ y j
                                                                                                                                     
â¦ÌÏÏ (E, Î, â¦, Î)(y) = â
                                           i                                             j6=i
                                                                                                                                 !
                                                           i                                  i
                                                                                                                             
                                                         zÌÎµÎµ (Îµ, E, Î, z, â¦, Î) Â· (Îµ, Îµ) + zÌÏÏ (Îµ, E, Î, z, â¦, Î)                  dPr(Îµ)dâ¦(z)

                                Z         X                                                 Y
                                                  Î´ 0 (zÌ i (Îµ, E, Î, z, â¦, Î) â y i )             Î¹ zÌ j (Îµ, E, Î, z, â¦, Î) â¤ y j
                                                                                                                                     
                           â
                                           i                                                j6=i


                                                 zÌÎµi (Îµ, E, Î, z, â¦, Î) ÎµzÌÎµi (Îµ, E, Î, z, â¦, Î) Îµ
                                                                                                                  !!
                                                     + zÌÏi (Îµ, E, Î, z, â¦, Î) zÌÏi (Îµ, E, Î, z, â¦, Î)                dPr (Îµ) dâ¦(z)
                                Z XX
                           â                             Î´(zÌ i (Îµ, E, Î, z, â¦, Î) â y i )Î´(zÌ j (Îµ, E, Î, z, â¦, Î) â y j )
                                           i      j6=i
                                        Y                             
                                             k                       k
                                         Î¹ zÌ (Îµ, E, Î, z, â¦, Î) â¤ y     zÌÎµj (Îµ, E, Î, z, â¦, Î) ÎµzÌÎµi (Îµ, E, Î, z, â¦, Î) Îµ
                                    k6=i,j
                                                                                             !
                                             zÌÏj (Îµ, E, Î, z, â¦, Î) zÌÏi (Îµ, E, Î, z, â¦, Î)   dPr (Îµ) dâ¦(z)


Evaluating at   Ï=0        we nd

               Z X                        Y
                       Î´(z i â y i )             Î¹(z j â y j ) zÌÏÏ
                                                                 i          i
                                                                                       
â¦ÌÏÏ (y) = â                                                        (z) + zÌÎµÎµ Â· var(Îµ) dâ¦(z)
                  i                       j6=i
               Z X                        Y                             2                  2
                       Î´ 0 (z i â y i )           Î¹(z j â y j ) zÌÎµi (z) Â· var(Îµ) + zÌÏi (z) dâ¦(z)
                                                                                  
          â
                  i                        j6=i
               Z X                        X                       Y
                       Î´(z i â y i )              Î´(z j â y j )            Î¹(z k â y k ) zÌÎµj (z)zÌÎµi (z) Â· var(Îµ) + zÌÏj (z)zÌÏi (z)dâ¦(z)
                                                                                                         
          +
                  i                       j6=i                    k6=i,j


which gives

                           X â
                                                 i          i
                                                                               
         ÏÌÏÏ (y) = â                          zÌÏÏ (y) + zÌÎµÎµ (y) Â· var(Îµ) Ï(y)
                            ây i
                            i
                           XX              â2
                                                             zÌÎµi (y)zÌÎµj (y) Â· var(Îµ) + zÌÏi (y)zÌÏj (y) Ï(y) .
                                                                                                            
                       +
                                         ây i ây j
                            i       j

  25 For simplicity we drop the cross terms between                               Ï   and    Îµ     which integrate to 0 when
evaluated at   Ï = 0.



                                                                   23
Thus,

           Z                   X â
  0                                     i          i
                                                                    
XÌÏÏ   =       R(z)        â       i
                                     (zÌÏÏ (z) + zÌÎµÎµ (y)var(Îµ))Ï(z)
                                âz
                                i
                                                                                              !
               XX            â2
                                       zÌÎµi (z)zÌÎµj (z)var(Îµ)        zÌÏi (z)zÌÏj (z)
                                                                                           
           +                                                    +                       Ï(z) dz
                           âz i âz j
                   i   j
           Z
                                          i          i
                                                                 
       =       (Rz (z) + Rx (z)xÌz (z)) zÌÏÏ (z) + zÌÎµÎµ (y)var(Îµ) Ï(z)dz
               Z                                                                                                         !
           +           Rzz (z) + Rxz (z) Â· (I, xÌz (z)) + Rzx (z) Â· (xÌz (z), I) + Rxx (z) Â· (xÌz (z), xÌz (z))

                           Â· (zÌÎµ (z), zÌÎµ (z)) Â· var(Îµ)Ï(z)dz
               Z                                                                                                         !
           +           Rzz (z) + Rxz (z) Â· (I, xÌz (z)) + Rzx (z) Â· (xÌz (z), I) + Rxx (z) Â· (xÌz (z), xÌz (z))

                           Â· (zÌÏ (z), zÌÏ (z)) Â· var(Îµ)Ï(z)dz

which combined with the second derivative of                          R    w.r.t   ÏÏ   , after dening   XÌÏ+ = XÌÏ0 +
XÌÎ ÎÌÏ + XÌÏ
Z
                                                                      0
                                                                                                              
       Rx (z) (xÌÏÏ (z) + xÌÎµÎµ (z) Â· var(Îµ)) + RX (z)XÌÏÏ + RX+ (z) XÌÏÏ + XÌÎ PXÌÏÏ

       + RX+ (z) XÌÎÎ ÎÌ2Ï + 2â XÌÎ Â· â¦ÌÏ ÎÌÏ + 2XÌÎÏ ÎÌÏ + â 2 XÌ Â· (â¦ÌÏ , â¦ÌÏ ) + 2â XÌÏ Â· â¦ÌÏ + XÌ ÏÏ
                                                                                                                         

       + Rxx (z) Â· (xÌÏ (z), xÌÏ (z)) + 2RxX (z) Â· (xÌÏ (z), XÌÏ ) + 2RxX+ (z) Â· (xÌÏ (z), XÌÏ+ ) + RXX (z) Â· (XÌÏ , XÌÏ )
       + 2RXX+ (z) Â· (XÌÏ , XÌÏ+ ) + 2RX+X+ (z) Â· (XÌÏ+ , XÌÏ+ ) + Rxx (z) Â· (xÌÎµ (z), xÌÎµ (z)) Â· var(Îµ)
                                                    !
       + 2 (RxÎµ (z)xÌÎµ (z)) Â· var(Îµ) + RÎµÎµ (z) Â· var(Îµ) dâ¦(z) = 0


gives a system of linear equations of the form

                                                   h                    i|
                                            LL Â·              0
                                                       XÌÏÏ XÌÏÏ             = MM.                                    (96)




B.7 Expansion Along Path
We now demonstrate how to compute the expansion along transition path when assuming

Ï   scales only the shocks and              ÏÎ¸ .   Given the current             (Î, Î),   we will assume knowledge

of the non-stochastic transition path                  {ÎÌn , ÎÌn }    with    (ÎÌ0 , ÎÌ0 ) = (Î, Î)   and   (ÎÌN , ÎÌN ) =




                                                                24
(ÎÌ, ÎÌ)   as well as the associated paths                  {xÌn , XÌ n }.26   Sections B.4-B.6 give the derivatives
                              N    N
of the policy functions at (ÎÌ , ÎÌ )                    = (ÎÌ, ÎÌ).    We then proceed by backward induction,

assuming that all the derivatives of                xÌ and XÌ   are known at the point         (0, ÎÌn+1 , â¦, ÎÌn+1 ; 0) and
computing derivatives evaluated at                  (0, ÎÌn , â¦, ÎÌn ; 0). We will denote derivatives evaluated at
(0, ÎÌn , â¦, ÎÌn ; 0)   by superscript        n.
      Dierentiating with respect to                Î,

             Fnxâ (z)xÌnÎ (z) + Fnx (z)xÌnÎ (z) + Fnx+ (z) xÌn+1     n    n      n
                                                                       
                                                             Î (z)PXÌÎ + FX (z)XÌÎ = 0


and              Z
                      Rnx (z)xÌnÎ (z) + RnX (z)XÌÎn + RnX+ (z)XÌÎn+1 PXÌÎn + RnÎ (z)dâ¦ = 0.

Solving for     xÌnÎ (z)    gives

                                                             â1
                  xÌnÎ (z) = â Fnxâ (z) + Fnx (z)                   Fnx+ (z)xÌn+1          n
                                                                                                  n
                                                                              Î   (z)P + F X (z)  XÌÎ ,

and therefore        XÌÎn   equals

   Z                                                                                 â1
      n       n         n
                               â1 n        n+1       n
                                                              n        n       n+1
                                                                                    
â     âRx (z) Fxâ (z) + Fx (z)     Fx+ (z)xÌÎ (z)P + FX (z) + RX (z) + RX+ (z)XÌÎ P dâ¦
  Z            
      n
Ã    RÎ (z)dâ¦(z) .

The Frechet derivative w.r.t              â¦   is computed as follows:



Fnxâ (z)â xÌn (z) + Fnx (z)â xÌn (z) + Fnx+ (z)â xÌn+1 (z) + Fnx+ (z)xÌn+1       n   n        n
                                                                       Î (z)Pâ XÌ + FX (z)â XÌ = 0


which gives

                                              â1 
  â xÌn (z) = â Fnxâ (z) + Fnx (z)                    Fnx+ (z)xÌn+1          n           n     n          n+1
                                                                                                                 
                                                                Î   (z)P + F X (z)  â XÌ   + F x+ (z)â xÌ     (z)
                N
                X ân
            =           Cnj (z)â XÌ n+j ,
                 j=0


where for the last expression we our knowledge that                            â XÌ N = â XÌ   and   â xÌN (z) = â xÌ(z) =
                                          PN ân
C(z)â XÌ    and then        â xÌn (z) =       j=0     Cnj (z)â XÌ n+j   is derived from the recursion.


  26 The fact that          â¦Ì(0, Î, â¦, Î; 0) = â¦         for any   (Î, â¦, Î)     makes computation of these terms
straightforward using a shooting algorithm.




                                                                 25
     To nd       â XÌ   we then take the Frechet derivative of                             R   to get

     Z
              Rnx (z)â xÌn (z) Â· â + RnX+ (z) (â XÌ n+1 Â· â) + XÌÎn+1 P(â XÌ n Â· â) + RnX (z)â XÌ n Â· â Ï(z)dz
                                                                                                      
0=
          Z
     +         Rn (z)Î´(z)dz.


     Substituting for        â xÌn (z) = â XÌ n ,       we get

                    Z                                                                                    â1 Z
     n
                            Rnx (z)Cn0 (z)           RnX+ (z)XÌÎn+1 P                 RnX (z)                   Rn (z)Î´(z) + Rnx (z)â xÌn (z) Â· âdz
                                                                                                 
â XÌ Â· â = â                                     +                              +                    dâ¦(z)
                         ï£«                                   ï£¶
                          Z           N ân
               â¡ (Dn )â1 ï£­ Rn (z)dâ +
                                      X
                                           Enj â XÌ n+j Â· â ï£¸
                                                           

                                                       j=1


     Finally we can compute the response to shock                                 E   (note we only need to do this for        n = 0)

               F0x xÌ0E + F0x+ ÏÎ xÌ1Î + xÌ1z pxÌ0E + â xÌ1 Â· â¦Ì0E + xÌ1Î PXÌE0 + F0X XÌE0 + F0E = 0.
                                                                               


Substituting for         â xÌ1   we obtain, after dening                   XÌ j E = â XÌ j Â· â¦Ì0E
                                 ï£«                                                                                         ï£¶
                                                                                  N â1
                                                                                            C1j (z)XÌEj+1 + xÌ1Î (z)PXÌE0 ï£¸+F0X (z)XÌE0 +F0E (z) = 0,
                                                                                  X
F0x (z)xÌE (z)+F0x+ (z) ï£­ÏÎ xÌ1Î (z) + xÌ1z (z)pxÌnE (z) +
                                                                                      j=0

or
                                                                 h                                            i|
                             M0 (z)xÌ0E (z) = N0 (z)                  I XÌE0           XÌE1      Â· Â· Â· XÌEN        .

We obtain the following expression for                        XÌ jE   for   j = 1, . . . , N

                                                                                 N âj
                                        Z                                                                              !
                                 j â1
                 XÌ jE = D                                                            Ejk XÌEj+k
                                                                                 X
                                              j        j      j
                                                                   0
                                             Rz (z) + Rx (z)xÌz (z) pxÌE (z)dâ¦ +
                                                                                                            k=1

which, when combined with



      Z
          R0x (z)xÌ0E (z) + R0X (z)XÌE0 + R0X+ (z) ÏÎ XÌÎ
                                                        1
                                                          + XÌE1 + XÌÎ1 PXÌE0 + R0E (z)dâ¦ = 0,
                                                                             


yields the linear system

                                             h                                                  i|
                                        OÂ·       I     XÌE0      XÌE1       Â·Â·Â·       XÌEN           = P.




                                                                      26
C Simulation and Clustering
To simulate an optimal policy at each date with                             N   agents, we discretize the distribution

across agents with          K   grid points that we nd each period using a k-means clustering al-

gorithm. Let       {zi }N
                        i=1     represent the current distribution of agents. The k-means algorithm

generates     K   points    {zÌk }K
                                  k=1      with each agent           i   assigned to a cluster       k(i)   to minimize the

                                           k2 .
                    P
squared error         i kzi     â zÌk(i)           We let     â¦    represent the distribution of            N   agents and       â¦Ì
represent our approximating distribution of                         clusters.
                                                                              27      At each history, we apply our al-

gorithm to approximate the optimal policies around                              â¦Ì.    Moreover, by allowing            Ï   to also

scale deviations of         â¦   from   â¦Ì,   we can increase the accuracy of our approximate the policy

rules as follows. Let           xÌ(ÏÎµ, ÏE, Ï(Î â ÎÌ) + ÎÌ, z, â¦Ì + Ï(â¦ â â¦Ì), Ï(Î â ÎÌ(â¦)) + ÎÌ; Ï)                            and

XÌ(ÏE, Ï(Î â ÎÌ) + ÎÌ, â¦Ì + Ï(â¦ â â¦Ì), Ï(Î â ÎÌ(â¦)); Ï)                            denote the policy rules with scaling

parameters      Ï. We can them approximate these policies with a Taylor expansion with respect
to   Ï.   For example, a rst-order Taylor expansion would be

                                                                                                 
     xÌ(Îµ, Î, z, â¦, Î) â xÌ + xÌÎµ Îµ + xÌE E + xÌÎ (Î â ÎÌ) + â xÌ Â· (â¦ â â¦Ì) + xÌÎ (Î â ÎÌ) + xÌÏ Ï

and

                                                                                       
      XÌ(Î, â¦, Î) â XÌ + XÌE E + XÌÎ (Î â ÎÌ) + â XÌ Â· (â¦ â â¦Ì) + XÌÎ (Î â ÎÌ(â¦)) + XÌÏ Ï.

Both      â xÌ Â· (â¦ â â¦Ì)   and    â XÌ Â· (â¦ â â¦Ì)          are easily computed from terms already computed

during the expansion, so these extra corrections have no additional computational cost.
                                                                                                                                 28

Note that when       K=N          we exactly approximate around                     â¦,   but for   K<N      we can speed up
                                N
the computations by a factor of
                                K . We choose                           K   so that increasing      K   does not change the

impulse responses reported in section 5 which results in a                          K    of   2000 to 3000 and N = 100000
depending on the experiment.




D Competitive Equilibrium with xed government
  policies
We demonstrate the application of our method outlined in section 3.1 to a problem of nding

a competitive equilibrium for xed government policies. We have two goals in mind: First,

  27 Formally                        1                           1
                                P                                               P
                  dâ¦(z) =          i N Î´(z        â zi )       i N Î´(z â zÌk(i) ).
                                                           while   dâ¦Ì(z) =
   28 Following the steps in section (B.5) it can readily be seen that â XÌ Â·(â¦â â¦Ì)
                                                                                                                    R
                                                                                                                =       A(z)(z â
zÌ(z))dâ¦Ì(z) = i N1 A(zÌk(i) )(zi â zÌk(i) ) and â xÌ(zÌk ) = C(zÌk )â XÌ Â· â¦ÌÏ .
                 P




                                                                   27
the problem with xed policies is simpler and explicit expressions for terms that arise in

many of the steps in section 3 as well as those in appendix B can be derived. Second, we use

this economy as a test case to analyze the accuracy of the our approximations by comparing

the second-order expansions to solutions obtained with global methods.

      To make our exposition most transparent, we assume that government has no expendi-

tures, sets taxes       Î¥t = Tt = 0     and implements ination     Î t = 0       in all periods. We assume all

agents have equal ownership of rms and that there is no permanent component of labor

productivity,        Î¸i,t = 0.   Finally, we assume that the aggregate shock is i.i.d., which removes

Î   as a state variable.          These assumptions deliver a version of Huggett (1993) economy

with natural borrowing limits extended to allow for endogenous labor supply and aggregate

shocks.

      Individual decisions are expressed recursively. The aggregate variables depend on the

realized aggregate shock          E   and the beginning of the period distribution of assets           â¦.   Since we

assumed that government has no revenues, it also cannot issue debt, and so the distribution
                 R
â¦   satises         bdâ¦ = 0.     We denote the space of such distributions by                W.     We use tildes
                                                       h                iT
to denote policy functions, and let             XÌ =       QÌ WÌ   DÌ        be a vector of aggregate policy

functions capturing interest rates, wages and dividends. Individual policy functions depend

both on aggregate state            (E, â¦)   and on idiosyncratic state       (Îµ, b)   where   Îµ   is the realization

of the idiosyncratic shock that aects individual with asset beginning of period assets                           b.
             h              iT
Let   xÌ =
        bÌ cÌ nÌ                 be the triplet of the individual policy functions. Finally,              â¦
                                                                                                          e (E, â¦) :
R Ã W â W be the             law of motion describing how the aggregate distribution of debt next

period is aected by the aggregate shock in the current period.

      Individual optimality conditions consist of the budget constraint (2) and the optimality

conditions (13)-(14). In our recursive notation, these conditions read



          cÌ (Îµ, E, b, â¦) + QÌ (E, â¦) bÌ (Îµ, E, b, â¦) = WÌ (E, â¦) exp (E + Îµ) nÌ (Îµ, E, b, â¦)                  (97a)

          + b + DÌ (E, â¦) ,
             n h                               i     o
          Î²E uc cÌ Â·, Â·, bÌ (E, b, â¦) , â¦
                                        e (E, â¦)   E, â¦ = QÌ (E, â¦) uc [cÌ (Îµ, E, b, â¦)] ,                    (97b)


          WÌ (E, â¦) exp (E + Îµ) uc [cÌ (Îµ, E, b, â¦)] = âun [nÌ (Îµ, E, b, â¦)] ,                                 (97c)



for all   Îµ, E, b, â¦.    These constraints construct the function            F   as in (20) of section 3.       The




                                                           28
aggregate constraints after imposing rm's optimality (15) can be written as

                 Z                                            Î±       Z
                      exp(E + Îµ)nÌ (Îµ, E, b, â¦) d Pr (Îµ) dâ¦         =       cÌ (Îµ, E, b, â¦) d Pr (Îµ) dâ¦,    (98a)

                       Z                                       Î±â1
                 â1
                     Î±    exp(E + Îµ)nÌ (Îµ, E, b, â¦) d Pr (Îµ) dâ¦      = WÌ (E, â¦) ,                          (98b)
                   
                            Z                                       Î±
                      â1
                  1â      Î±      exp(E + Îµ)nÌ (Îµ, E, b, â¦) d Pr (Îµ) dâ¦ = DÌ (E, â¦) ,                        (98c)
                        

for all   E, â¦   which construct the function (21) of section 3. Finally, the law of motion for the

distribution of debts induced by the savings behavior of the agents is given by

                                           Z                       
                         â¦
                         e (E, â¦) (y) =        Î¹ bÌ (Îµ, E, b, â¦) â¤ y d Pr (Îµ) dâ¦ ây,                         (99)



where     Î¹   is the indicator variable.

    Equations (97), (98), and (99) fully describe the equilibrium behavior.




D.1 Points of expansion and zeroth-order terms
Consider the expansion around deterministic economy with a given distribution of assets                       â¦.
Observe that we have

                                           bÌ (b, â¦) = b   for all b,â¦.                                     (100)


This counterpart of lemma (1) implies that equations for deterministic economy are



                           cÌ (b, â¦) + QÌ (â¦) b = WÌ (â¦) nÌ (b, â¦) + b + DÌ (â¦) ,                          (101a)

                                               Î² = QÌ (â¦) ,                                                (101b)

                           WÌ (â¦) uc [cÌ (b, â¦)] = âun [nÌ (b, â¦)] ,                                       (101c)



for all   (b, â¦)   and aggregate constraints

                                           Z                  Î±       Z
                                                nÌ (b, â¦) dâ¦        =       cÌ (b, â¦) dâ¦,
                                     Z               Î±â1
                               â1
                                   Î±    nÌ (b, â¦) dâ¦       = WÌ (â¦) ,                                       (102)
                                
                                     Z               Î±
                               â1
                            1â     Î±        nÌ (b, â¦) dâ¦ = DÌ (â¦) ,
                                 

and the law of motion

                                                   â¦Ì (â¦) = â¦                                               (103)




                                                       29
that hold for all       â¦.For    a given       â¦,   we solve the system of equations above for                xÌ(b, â¦), XÌ(â¦).
       To obtain the coecients of the rst-order expansion of the policy functions, we will

need to know how policy functions are aected by perturbations to the individual state                                        b.
Dierentiate (101a) and (101c) with respect to                          b   to get a linear system and then solving for

xÌb   yields


                           ï£®              ï£¹       ï£®                                             ï£¹â1 ï£®          ï£¹
                                bÌb (b)                  1                  0             0               1
                xÌb (b) â¡ ï£° cÌb (b) ï£» = ï£° QÌ â 1                            1            WÌ            ï£° DÌ ï£» ,         (104)
                          ï£¯         ï£º ï£¯                                                         ï£º      ï£¯    ï£º
                                                                                                ï£»
                                nÌb (b)                  0       WÌ ucc [cÌ (b)] unn [nÌ (b)]             0
where all the terms on the right hand side are known from the zeroth-order expansion.




D.2 First-order terms and factorization theorem
Consider the rst order expansion with respect to                               Ï   of equations (98) and (97) and use

method of undetermined coecients to nd the derivatives that multiply                                    ÏÎµ   and   ÏE .   The

derivatives     xÌÎµ (b) are easy to nd since they cancel out from the expansions of the feasibility
constraints and appear only in the individual optimality conditions



                                                  cÌÎµ (b) + QÌbÌÎµ (b) = WÌ (nÌ (b) + nÌÎµ (b)) ,                        (105a)

                                                    QÌucc [cÌ(b)]cÌÎµ (b) = Î²ucc [cÌ(b)]cÌb (b)bÌÎµ (b),                 (105b)

                         WÌ (uc [cÌ (b)] + ucc [cÌ (b)] cÌÎµ (b)) = âunn [nÌ (b)] nÌÎµ (b) .                             (105c)



for all    b.   All variables apart from                bÌÎµ (b) , cÌÎµ (b) , nÌÎµ (b),   are known from the zeroth-order

expansion. Thus we can nd                    bÌÎµ (b) , cÌÎµ (b) , nÌÎµ (b)   separately for each   b   by solving this       3Ã3
system of equations. In the direct analogy with (104) we can write this solution compactly

as

                                                       xÌÎµ (b) = E(b)â1 G(b)                                            (106)


for matrices        K(b),L(b)    known from the zeroth-order expansion. Similarly it can be shown

that    XÌÏ , xÌÏ   are all zero vectors.

       Solving for the eect of the aggregate shocks is more complicated because they aect the

distribution of debts and the aggregate constraints. Dierentiating individual constraints

implies that



                               cÌE (b) + QÌbÌE (b) + QÌE bÌ (b) = WÌ (nÌ (b) + nÌE (b)) + WÌE nÌ (b) + DÌ E,
                                                                                                        (107a)
                                                              
                    Î²ucc [cÌ(b)] cÌb (b)bÌE (b) + âcÌ(b) Â· â¦ÌE = QÌucc [cÌ(b)]cÌE (b) + uc [cÌ(b)]QÌE , (107b)
      WÌ (uc [cÌ (b)] + ucc [cÌ (b)] cÌE (b)) + WÌE uc [cÌ (b)] = âunn [nÌ (b)] nÌE (b) .                              (107c)




                                                                   30
while dierentiating the aggregate constraints gives

                                                        Z                               Z
                                                  Î±â1
                                            Î±NÌ             (nÌ (b) + nÌE (b)) dâ¦ =          cÌE (b) dâ¦,
                           â1
                                                        Z
                               Î± (Î± â 1) NÌ Î±â2 (nÌ (b) + nÌE (b)) dâ¦ = WÌE ,                                            (108)
                             
                                    
                               â1
                                               Z
                            1â     Î± Î±NÌ Î±â1 (nÌ (b) + nÌE (b)) dâ¦ = DÌE ,
                                

where     NÌ   is the aggregate labor supply in the zeroth-order expansion.                                 Furthermore, by

dierentiating equation (99) with respect to                  E   and evaluating at         Ï = 0 it can readily be seen
that
     29

                                           â¦ÌE (b) = âÏ(b)bÌE (b)        for all   b.                                    (109)


This leads to the main diculty of this problem:                              in order to solve for the response of

aggregates         XÌE   we must jointly solve equations (107a)-(108) for               xÌE (b) for all b.      Our resolution

is to apply the factorization theorem, theorem (1), to show that                                xÌE (b)   can be constructed
                         0
as loadings on XÌE and XÌE             = â XÌ Â· â¦ÌE (b)     which can be solved for independently.

     Begin by dierentiating the individual constraints with respect to                             â¦.    Exploiting   â â¦Ì = 1
yields



                                   âcÌ(b) + bâ QÌ + Î²â bÌ(b) = nÌ(b)â WÌ + WÌ â nÌ(b) + â DÌ
                                                             
                         Î²ucc [cÌ(b)] cÌb (b)â bÌ(b) + âcÌ(b) = uc [cÌ(b)]â QÌ + Î²ucc [cÌ(b)]âcÌ(b)
                         WÌ ucc [cÌ(b)]âcÌ(b) + uc [cÌ(b)]â WÌ = unn [nÌ(b)]â nÌ(b).

This can be represented by the matrix expression

ï£®                                                             ï£¹ï£®               ï£¹   ï£®                                     ï£¹ï£®          ï£¹
               Î²                  1               âWÌ               â bÌ(b)               âb               nÌ(b)     1        â QÌ
ï£° Î²ucc [cÌ(b)]cÌb (b)             0                0          ï£» ï£° âcÌ(b) ï£» = ï£° uc [cÌ(b)]                   0        0 ï£» ï£° â WÌ ï£»
ï£¯                                                             ï£ºï£¯         ï£º ï£¯                                           ï£ºï£¯       ï£º

               0             WÌ ucc [cÌ(b)] âunn [nÌ(b)]            â nÌ(b)                 0         âuc [cÌ (b)] 0          â DÌ

which we can solve to yield the counterpart to the rst result of theorem (1):



                                                   â xÌ(b) = C(b)â XÌ.

To obtain the second result we dierentiate equations (98a)-(98c) in an arbitrary direction

    29 For the derivation in detail see section B.5.




                                                               31
â    evaluated at        Ï=0     to nd

                                                         Z                               Z                
                                                   Î±â1
                                           Î±NÌ    nÌ (b) dâ¦ Â· â =                                   cÌ (b) dâ¦ Â· â
                                                         Z
                          â1              Î±â2
                              Î± (Î± â 1) NÌ        nÌ (b) dâ¦ Â· â = â WÌ Â· â,                                                        (110)
                           
                                             Z          
                             â1           Î±â1
                          1â      Î± Î±NÌ           nÌ (b) dâ¦ Â· â = â DÌ Â· â.
                               

As noted in section (3),

                                Z                           Z                                Z
                                      cÌ (b) dâ¦ Â· â =             âcÌ (b) Â· âdâ¦ +                   cÌ(b)dâ.


Evaluating this integral at            â(b) = â¦ÌE (b) = âÏ(b)bÌE (b)                    and exploiting integration by parts

we nd

Z                             Z                         Z                         Z                               Z
       cÌ (b) dâ¦ Â· â¦ÌE =            âcÌ (b) Â· â¦ÌE dâ¦ +        cÌ(b)dâ¦ÌE =                C1 (b)dâ¦â XÌ Â· â¦ÌE +           cÌb (b)bÌE (b)dâ¦


where     C1 (b) represents the rst row of C(b). As a similar relationship can be derived for
 R             
     nÌ (b) dâ¦ Â· â¦ÌE , plugging these into equations (110) yields a system of equations of the
form                                                              Z
                                             Dâ XÌ Â· â¦ÌE =             B(b)xÌE (b)dâ¦

where    D   and        B(b)   are both known from zeroth-order terms.                                  Solving for   â XÌ Â· â¦ÌE   gives
                    R
â XÌ Â· â¦ÌE =            A(b)xÌE (b)dâ¦.     When combined with our expression for                                 â xÌ(b),   we get the

analogue of (75) of theorem 1

                                                                      Z
                                         â xÌ(b) Â· â¦ÌE = C(b)              A(b)xÌE (b)dâ¦.


      Finally we can exploit this knowledge to solve for                            XÌE    and      xÌE (b)   by rst dening



                                       â xÌ(b) Â· â¦ÌE = C(b)â XÌ Â· â¦ÌE â¡ C(b)XÌE0 .

After substituting for           â xÌ(b) Â· â¦ÌE ,   equation (107) now denes a linear relationship between
                                                                          h                    i
policy functions          xÌE (b)   and aggregate variables                   XÌE       XÌE0        which is independent of any

other   xÌE (bÌ).   Thus, we can write (107) for each                  b   as

                                                                       h                       iT
                                         M(b)xÌE (b) = N(b) Â·                 XÌE       XÌE0        ,                              (111)




                                                                  32
where     M(b)   is a    3Ã3    matrix, and all coecients of                        M(b)   and   N(b)   are known from the

zeroth-order expansion. Thus we can solve for each                               xÌE (b)   as a function of aggregate vari-

ables independently for each           b.   This simplies analysis by breaking one system of                            3K Ã 3K
equations into       K   system of   3Ã3      equations for each of                  K   levels of debt. We can substitute

the obtained expressions for          xÌE (Â·)   into equations (108) and

                                                             Z
                                                XÌE0     =        A(b)xÌE (b)dâ¦                                               (112)



to generate a      6Ã6     system of equations of the form

                                                     h                     iT
                                                OÂ·       XÌE        XÌE0        = P.                                          (113)



Equation (113) can be easily solved numerically for                              XÌE , XÌE0 .   This completes the solution

for the rst-order responses to the aggregate shock                             E.


D.3 Second and higher order terms
To construct a second-order expansion of policy functions we need additional terms. These

are   xÌÎµÎµ (b), xÌÎµÏ (b), xÌEE (b), xÌEÏ (b), xÌÏÏ (b), XÌEE , XÌEÏ , XÌÏÏ .             Calculations of   xÌÎµÎµ ,xÌEE ,XÌEE    then

proceeds analogously to their rst-order counterparts, while the cross-partials                                    xÌÎµÏ , xÌEÏ , XÌEÏ
are all zeros. Unlike the rst-order expansion, the intercept terms                                  xÌÏÏ , XÌÏÏ   are no longer

zero.     They depend on var(Îµ), var(E) and capture such eects as precautionary savings.

Solution for     xÌÏÏ (b), XÌÏÏ   involves steps similar to those used to solve for                          xÌE (b), XÌE    in the

previous section. Details are provided in section B.6.




D.4 Numerical implementation and accuracy
To implement our algorithm numerically, we approximate                                      â¦   with a discrete distributions

with    K   points   {bk }k   with masses       {Ïk }k .         All the integrals in our expressions collapse then

to sums. For example, our expression (112) for                          XE0     becomes

                                                         X
                                             XÌE0 =               A(bk )Ïk bÌE (bk ).
                                                             k

All intermediate terms, such as              E(bk ),     can be computed independently for each                        k,   making

the algorithm highly parallelizable. Once we compute approximations of the policy functions

in the current period, we use Monte-Carlo methods described in section C to obtain the next

period distribution of assets         â¦Ì,   for which we repeat this procedure.




                                                                   33
      We now discuss the numerical accuracy of our approximations. To compare our (second-

order) approximated policy rules with those solved via global methods we shut down the

aggregate shocks and compute the steady state distribution of assets the model presented

in section D.3.      Optimal policies of each agent are computed using the endogenous grid

method of Carol (2005). The steady-state distribution is approximated using a histogram

and computed using the transition matrix constructed from the policy rules following Young

(2010). We then compare the approximated policy rules using our method, around the same

stationary distribution, to those of the global solution.                As noted in section D.3, even in

absence of aggregate shocks our techniques are still necessary, for a second-order expansion,

to determine the eect of the presence idiosyncratic risk on policies through                        xÌÏÏ   and   XÌÏÏ .
      We calibrate the 6 parameters of this model,              Î½ ,Î³ ,Î² , Î± ,    and    ÏÎµ ,   as follows.   We set

Î½=1      and   Î³=2   to match of calibration in section 4.           Î²   is set to target an interest rate of

2%.    =6      targets a markup of 20% and the decreasing returns to scale parameter,                            Î±,   is

chosen to target a labor share of         0.66.   The standard deviation          ÏÎµ   is set at .25 to match our

calibration in section 4. We choose very loose ad-hoc borrowing constraints,                          b = â100         to

approximate a natural debt limit. To ensure an accurate approximation to the global policy

rules, we approximated the consumption and labor policy rules using cubic splines with 200

grid points and the steady-state distribution with a histogram with 1000 bins.

      Agents' policies and aggregate variables are then approximated using a second-order

approximation around the stationary distribution                â¦Ì   with the expressions derived in this

section. The equilibrium policy rules and aggregates, around this distribution of 1000 points,

can be approximated using single processor in 0.8 seconds.                    The equilibrium interest rate

found by perturbation code was 2.0013%. The percent error in the aggregate labor supply

was 0.036%.       Finally, we can evaluate the policy errors for the individual agents.                       In the

rst panel of gure VIII we plot the percentage errors for consumption relative to the global

solution for a median shock to        Ï   along with a   Â±2.5   standard deviation shock.

      For almost all of the agents, the perturbation methods perform well with errors less

than    0.1%   which would correspond making an error in consumption of less than a dollar on

every   $1000   dollars spent. As expected, since the quadratic approximation assumes natural

borrowing limits, the accuracy deteriorates near the borrowing limit assumed by the global

solution. The range plotted in gure VIII contains 99.2% of the agents in the stationary

distribution. As a robustness check, we also observe how accuracy behaves as we change                              ÏÎµ .
For values of    ÏÎµ â [0.1, 0.5],   we compute the average absolute percentage error as


                               cglobal (ÏÎµ Îµ, b; ÏÎµ ) â cpertub (ÏÎµ Îµ, b; ÏÎµ )
                       Z Z
                                                                               dPr(Îµ)dâ¦
                                            cglobal (ÏÎµ Îµ, b; ÏÎµ )




                                                       34
         0.4                                                                                      Ï = â0.6
                                                                                                   Ï = 0.0
 error


                                                                                                   Ï = 0.6
         0.2
%




           0
               â90          â50          â10        30              70          110        150              190
                                                           assets




         0.2
 error




         0.1
%




           0
                     0.15         0.2      0.25      0.3           0.35        0.4      0.45          0.5
                                                              ÏÏ

Figure VIII: Percentage error of consumption policy functions relative to global solution in
top panel. Bottom panel plots average (with respect to the stationary distribution) absolute
consumption error relative to global solution as              ÏÏ   varies.



and plot it in the bottom panel of gure VIII. We see that the average error remains very

low around the level of our calibration and increases moderately for higher                    ÏÎµ .



E Robustness
We provide details for several cases that are discussed in sections 5 and 6 but omitted

from the main text. These include stationary TFP shocks, alternative welfare criteria, no

inequality shocks           f = 0,   and no menu costs   Ï = 0.
         Stationary TFP shocks are modeled as an AR(1) process (see equation 9a) in the text,

with autocorrelation           ÏÎ = 0.954   and std of   EÎ = 3%.        All other parameters and the initial

condition are kept as the same as the baseline calibration in section 4. The impulse responses

are computed to a one standard deviation negative shock. As mentioned in section 5.2, we

extend the denition of natural rate for our heterogeneous agent economy to be the real

interest rates in a competitive equilibrium with              Ï=0     that implements exible prices, scal

policy set       Î¥t   at the non-stochastic optimum and initial conditions as in section 4.                  The

optimal response of the nominal rate in Figure IX is plotted as a deviation from this natural

rate and we see that it quite closely tracks the response in the baseline with the i.i.d growth

rate specication.




                                                         35
           Nominal rate-Natural rate                     Ination                           Tax rate
                                                                                1
             0                             0.6
                                                                             0.5
         â0.2
   pts



                                           0.4
                                                                                0
         â0.4
   %



                              AR(1)        0.2
                                                                         â0.5
         â0.6                  BM
                                             0
                 4   6    8   10 12              4   6     8   10 12                4   6     8   10 12
                         Output                  Ex-post real returns                        TFP

             0                             0.5                                  0
           â1                                                                â1
     pts




                                    pts




                                                                       pts
                                             0
           â2
     %




                                    %




                                                                       %
                                                                             â2
           â3                             â0.5
                                                                             â3
                 4   6    8   10 12              4   6     8   10 12                4   6     8   10 12
Figure IX:       Optimal monetary response to an AR(1) productivity shock. The solid line is
the baseline calibration with i.i.d growth rate shocks.



   To illustrate the role of alternative preferences for the planner, we modify the objective
                                                                       Î±Ï
function (12) to introduce time-invariant Pareto weights         Ïi â Î¸â1,i .   We calibrate the       Î±Ï   such

that the optimal non-stochastic tax rate equals           24%.   Our estimate suggests an         Î±Ï = 0.75
indicating higher Pareto weights to productive agents which rationalizes low marginal tax

rates. We keep all other parameters and the initial condition as in the baseline calibration

and compute optimal monetary responses to a TFP shock in gure X and the markup

shock in gure XI.        The fact that the responses are similar to the utilitarian case in the

baseline underlines that changes in Pareto wights primarily map into changes in the steady

state level of the tax rate while the response of policies to shocks is governed by insurance

motives arising mainly due to incomplete markets.

   Next we turn to the case where we study TFP shocks with                   f = 0,     implying that the

aggregate TFP shock results in the same proportional change labor productivity for all

agents.    As mentioned in the text, even in absence of changes in inequality, a permanent

drop in wages with agents heterogeneous in asset holdings creates needs for insurance. The

exercise in gure XII allows us decompose the eect into the part that comes because initial

wealth dierences and the part that comes because of heterogeneous exogenous exposure to

the shock.

   Finally we study the case without nominal rigidities by setting              Ï â 0.      In response to a

TFP shock (gure XIII), the planner provides insurance through ination which generates




                                                     36
                     Nominal int. rate                  Ination                       Tax rate
                                                                          1
            0                             0.6
                                                                        0.5
                                          0.4
   pts




         â0.5                                                             0
                                          0.2
   %




                            Non util.
                                            0                          â0.5
                               BM
           â1
                                                                        â1
                 4     6   8   10 12            4   6     8   10 12           4    6     8   10 12
                      Output growth             Ex-post real returns              TFP growth


            0                               0                             0
                                                                        â1
     pts




           â1
                                         â0.5
     %




                                                                        â2
           â2
                                                                        â3
                 4     6   8   10 12            4   6     8   10 12           4    6     8   10 12
Figure X: Optimal monetary response to a productivity shock with non-utilitarian Pareto
weights. The solid line is the baseline calibration with utilitarian Pareto weights




                     Nominal int. rate                  Ination                       Tax rate
                                                                          1
            0                             0.4
         â0.1                                                           0.5
   pts




                                          0.2
         â0.2                                                             0
   %




                            Non util.       0
         â0.3                                                          â0.5
                               BM
                                         â0.2                           â1
                 4     6   8   10 12            4   6     8   10 12           4    6     8   10 12
                       Log Output           Log Wages (aftertax)                  Markup Shock

           0.4
                                            1                           0.4
     pts




           0.2                            0.5
                                                                        0.2
     %




            0                               0
                                         â0.5                             0
                 4     6   8   10 12            4   6     8   10 12           4    6     8   10 12
Figure XI: Optimal monetary response to a markup shock with non utilitarian Pareto
weights. The solid line is the baseline calibration with utilitarian Pareto weights




                                                    37
                    Nominal int. rate                     Ination                        Tax rate
                                                                            1
            0                               0.6
                                                                          0.5
   pts



         â0.2                               0.4
                                                                            0
   %



         â0.4                 f =0          0.2
                                                                         â0.5
                                  BM
                                              0
                                                                          â1
                4     6   8   10 12               4   6     8   10 12           4     6      8   10 12
                     Output growth                Ex-post real returns               TFP growth

            0                                 0                             0
                                          â0.2                            â1
     pts




           â1
                                          â0.4
     %




                                                                          â2
           â2
                                          â0.6
                                                                          â3
                4     6   8   10 12               4   6     8   10 12           4     6      8   10 12
Figure XII: Optimal monetary response to a productivity shock with                  f = 0.   The solid line
is the baseline case with     f   calibrated as in section 4.



state contingent returns. The size of response is about 3 to 4 times larger than the baseline

mainly driven by the fact that price changes are less costly and an eective way of insuring

against permanent TFP shocks. In response to a markup shock (gure XIV), we see that

real wages drop and then follow the path of the shock.               This is quite dierent from the

baseline where planner increased real wages to redistribute to towards the wage earners from

equity holders. The reason for this dierence is that absent nominal rigidities, the ability

of the planner to aect aggregate demand and wages through changes in nominal rates is

substantially diminished. The planner still induces some ination on impact because bonds

and equities are correlated and lowering returns partially redistributes towards low wage

agents.




                                                      38
                     Nominal int. rate                  Ination                        Tax rate
                                                                          1
            0
                                            2                           0.5
   pts




         â0.2                                                             0
                                            1
   %




         â0.4                  Ï=0
                                                                       â0.5
                                BM
                                            0
                                                                        â1
                 4     6   8   10 12            4   6     8   10 12           4     6      8   10 12
                      Output growth             Ex-post real returns               TFP growth

            0                               0                             0
           â1                                                           â1
     pts




                                          â1
           â2
     %




                                                                        â2
                                          â2
           â3                                                           â3
                 4     6   8   10 12            4   6     8   10 12           4     6      8   10 12
Figure XIII: Optimal monetary response to a productivity shock with               Ï = 0.   The solid line
is the baseline calibration with      Ï = 20.



                     Nominal int. rate                  Ination                        Tax rate
                                                                          1
            0                             0.5
                                                                        0.5
   pts




                                            0
         â0.5                                                             0
   %




                               Ï=0       â0.5
                                                                       â0.5
                                BM
                                          â1                            â1
                 4     6   8   10 12            4   6     8   10 12           4     6      8   10 12
                       Log Output           Log Wages (after tax)                 Markup Shock

           0.4                              1
                                                                        0.4
           0.2                            0.5
   pts




            0                               0                           0.2
   %




         â0.2                            â0.5
                                                                          0
                 4     6   8   10 12            4   6     8   10 12           4     6      8   10 12
Figure XIV: Optimal monetary response to a markup shock with              Ï = 0.        The solid line is
the baseline calibration with     Ï = 20.



                                                    39
