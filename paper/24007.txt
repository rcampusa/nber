                             NBER WORKING PAPER SERIES




         PRODUCTIVITY AND MISALLOCATION IN GENERAL EQUILIBRIUM

                                    David Rezza Baqaee
                                     Emmanuel Farhi

                                     Working Paper 24007
                             http://www.nber.org/papers/w24007


                    NATIONAL BUREAU OF ECONOMIC RESEARCH
                             1050 Massachusetts Avenue
                               Cambridge, MA 02138
                         November 2017, Revised October 2020




We thank Philippe Aghion, Pol Antras, Andrew Atkeson, Susanto Basu, John Geanakoplos, Ben
Golub, Gita Gopinath, Dale Jorgenson, Marc Melitz, Ben Moll, Matthew Shapiro, Dan Trefler,
Venky Venkateswaran and Jaume Ventura for their valuable comments. We are especially
grateful to Natalie Bau for detailed conversations. We thank German Gutierrez, Thomas
Philippon, Jan De Loecker, and Jan Eeckhout for sharing their data. We thank Thomas
Brzustowski and Maria Voronina for excellent research assistance. The views expressed herein
are those of the authors and do not necessarily reflect the views of the National Bureau of
Economic Research.

NBER working papers are circulated for discussion and comment purposes. They have not been
peer-reviewed or been subject to the review by the NBER Board of Directors that accompanies
official NBER publications.

© 2017 by David Rezza Baqaee and Emmanuel Farhi. All rights reserved. Short sections of text,
not to exceed two paragraphs, may be quoted without explicit permission provided that full
credit, including © notice, is given to the source.
Productivity and Misallocation in General Equilibrium
David Rezza Baqaee and Emmanuel Farhi
NBER Working Paper No. 24007
November 2017, Revised October 2020
JEL No. D24,D33,D42,D43,D5,D50,D57,D61,E01,E1,E25,E52,O4,O41

                                           ABSTRACT

This paper develops a general theory of aggregation in ineﬃcient economies. We provide non-
parametric formulas for aggregating microeconomic shocks in economies with distortions such as
taxes, markups, frictions to resource reallocation, financial frictions, and nominal rigidities. We
allow for arbitrary elasticities of substitution, returns to scale, factor mobility, and input-output
network linkages. We show how to separately measure changes in technical and allocative
eﬃciency. We also show how to compute the social cost of distortions. We pursue applications
focusing on firm-level markups in the U.S. We find that improvement in allocative eﬃciency,
due to the reallocation over time of market share to high-markup firms, accounts for about half of
aggregate TFP growth over the period 1997-2015. We also find that eliminating the misallocation
resulting from the large and dispersed markups estimated in the data would raise aggregate TFP
by about 15%, increasing the economy-wide cost of monopoly distortions by two orders of
magnitude compared to the famous 0.1% estimate by Harberger (1954). These exact numbers
should be interpreted with care since the data is imperfect and requires substantial imputation.


David Rezza Baqaee
Department of Economics
University of California at Los Angeles
Bunche Hall
Los Angeles, CA 90095
and CEPR
and also NBER
baqaee@econ.ucla.edu

Emmanuel Farhi
Harvard University
and CEPR




A Online Appendix is available at http://www.nber.org/data-appendix/w24007
1    Introduction
The foundations of macroeconomics rely on Domar aggregation: changes in a constant-
returns-to-scale index are approximated by the sales-weighted average of the changes in
its components. Hulten (1978), building on the work of Solow (1957) and Domar (1961),
provided a rationale for using Domar aggregation to construct measures of aggregate
productivity. He showed that in perfectly competitive economies

                             ∆Y X ∆L f X ∆TFPk
                               − Λf    ≈ λk      ,
                             Y      Lf      TFPk
                                     f            k


up to the first order of approximation, where Y is real GDP, L f is the supply of factor f ,
Λ f is its income share in GDP, TFPk is the TFP of producer k, and λk is its sales as a share
of GDP, also known as its Domar weight. In other words, aggregate productivity, defined
output growth minus share-weighted input growth, is equal to a Domar-weighted sum
of microeconomic changes in technology.
    Although Hulten’s theorem is most prominent for its use in growth accounting, where
it is used to measure movements in the economy’s production possibility frontier, it is
also the benchmark result in the resurgent literature on the macroeconomic impact of
microeconomic shocks in multi-sector models and models with production networks,
where it is used to make counterfactual predictions.
    The generality of Hulten’s theorem comes from exploiting a macro-envelope condition
resulting from the first welfare theorem. This means that the theorem requires perfect
competition and frictionless markets — without these conditions, Hulten’s theorem does
not apply.
    How then does aggregation work in inefficient economies? This article answers
this question by providing an aggregation result for inefficient disaggregated economies
with arbitrary neoclassical production functions, input-output networks, and distortion
wedges. Rather than relying on a macro-envelope condition like the first welfare theo-
rem, our results are built on micro-envelope conditions, namely that all producers are cost
minimizers. They can be used both to measure and to predict changes in aggregate TFP.
    Our results suggest a new and structurally interpretable decomposition of changes in
aggregate TFP into pure (exogenous) changes in technology and (endogenous) changes in
allocative efficiency. Loosely speaking, when a producer becomes more productive, the
impact on aggregate TFP can be broken down into two components. First, given the initial
distribution of resources, the producer increases its output, and this in turn increases
the output of its direct and indirect customers; we call this the pure technology effect.

                                             2
Second, the distribution of resources across producers shifts in response to the shock,
increasing some producers’ output and reducing that of others; we call the impact of this
reallocation of resources on aggregate TFP the change in allocative efficiency. In efficient
economies, changes in allocative efficiency are zero to a first order, and so the overall effect
characterized by Hulten (1978) boils down to the pure technology effect. In inefficient
economies, changes in allocative efficiency are nonzero to a first order. Our theoretical
contribution is to fully characterize the macroeconomic impact of microeconomic shocks
as well as their decomposition into pure technology effects and changes in allocative
efficiency in inefficient economies.
    More precisely, we define a new measure of aggregate TFP growth which nets out the
purely technological impact of factor growth from output growth. We show that in the
presence of misallocation, it is our residual, rather than the traditional Solow residual,
which correctly measures aggregate TFP growth.
    We then show that this new measure of aggregate TFP growth can be further decom-
posed into changes in technical efficiency and changes in allocative efficiency. We explain
why our decomposition of aggregate TFP into pure technology effects and changes in
allocative efficiency is preferable on conceptual grounds to those of Gollop et al. (1987),
Basu and Fernald (2002), and Petrin and Levinsohn (2012). We show that these differences
matter quantitatively in empirical applications. For example, when we apply our de-
composition to U.S. data, we find that changes in allocative efficiency play a significantly
larger role in explaining aggregate productivity growth than in the other decompositions.
    Furthermore, we provide an analytical formula for the social cost of distortions, gener-
alizing misallocation formulas like those of Hsieh and Klenow (2009) to economies with
arbitrary input-output network linkages, numbers of factors, microeconomic elasticities of
substitution, and distributions of distorting wedges. We show that these generalizations
matter quantitatively in empirical applications. For example, we find that accounting for
these details of the production structure triples the aggregate TFP losses from markups in
the U.S.
    By bringing together the growth-accounting literature, which is concerned with mea-
surement, and the misallocation literature, which is concerned with counterfactuals, we
also hope to clarify some potentially confusing subtleties. Namely, the growth-accounting
notion of changes in allocative efficiency due to the reallocation of resources to more or less
distorted parts of the economy over time, is very different to the misallocation literature’s
notion of allocative efficiency measured as the distance to the Pareto-efficient frontier. Our
theoretical formulas characterize and relate these two different notions, and our empirical
applications show that these subtleties are important for understanding patterns in the


                                               3
data.
   We demonstrate the framework’s empirical relevance and scope of applicability with
some proof-of-concept examples. We focus on markups in light of the accumulating evi-
dence that average markups have increased over the past decades in the U.S. Specifically,
we answer two different questions about the role of firm-level markups in determining
aggregate TFP.

   1. How have changes in the allocation of resources contributed to TFP growth in the
      U.S. over the past 20 years?
       We perform a non-parametric decomposition of measured TFP growth into pure
       changes in technology and changes in allocative efficiency. We implement our de-
       composition in the U.S. over the period 1997-2014. Focusing on firm-level markups
       as a source of distortions, we find that the improvements in the allocation of re-
       sources across firms accounts for about 50% of the cumulated growth in aggregate
       TFP.
       A rough intuition for this surprising result is that average markups have been
       increasing primarily due to a between-firm composition effect, whereby firms with
       high markups have been getting larger, and not to a within-firm increase in markups.1
       From a social perspective, these high-markup firms were too small to begin with,
       and so the reallocation of resources towards them increases measured aggregate TFP
       over time.

   2. What are the gains from eliminating markups in the U.S., and how have these gains
      changed over time?
       Using our structural results, we find that in the U.S. in 2015, eliminating markups
       would raise aggregate TFP by about 10-25% (depending on the markup series). This
       increases the estimated cost of monopoly distortions by two orders of magnitude
       compared to the famous estimate of 0.1% of Harberger (1954).2
       The reasons for this dramatic difference are that we use firm-level data, whereas
       Harberger only had access to sectoral data, and that the dispersion of markups is
   1
      This finding is consistent with Vincent and Kehrig (2019) and Autor et al. (2019) who argue that the
labor share of income has decreased because low labor-share firms have become larger, and not because the
labor share has declined within firms. Our finding that this composition effect also holds for markups has
since been corroborated by Autor et al. (2019) and De Loecker et al. (2019).
    2
      Like Harberger, we measure only the static gains from eliminating markups, holding fixed technology,
and abstract away from the possibility that lower markups may reduce entry and innovation. In other
words, even though markups play an important role in incentivizing entry and innovation, their presence
also distorts the allocation of resources, and this latter effect is what we quantify.


                                                    4
      higher across firms within a sector than across sectors.3 Moreover, the relevant
      elasticity of substitution is higher in our exercise than in Harberger’s since it applies
      across firms within a sector rather than across sectors. Finally, the use of firm-
      level data and higher elasticities of substitution is not enough: accounting for the
      existence of input-output linkages, instead of assuming value-added production
      functions, almost triples the losses.
      We also find that the distance from the Pareto-efficient frontier has increased since
      1997. This has happened because the dispersion in markups has increased over time.
      This finding may appear to contradict our conclusion that reallocation has made a
      positive contribution to measured TFP growth over the period. The resolution is
      that these results are conceptually different: the first is about how changes in the
      allocation of resources relative to the past have changed output, whereas the latter
      is about how output has changed relative to output under the optimal allocation of
      resources.. We find that the reallocation of resources over time has contributed pos-
      itively to output growth, but at the same time, output under the optimal allocation
      has grown more quickly, increasing the distance to the frontier.

    Our empirical results are tentative due to a variety of compromises we are forced to
make in mapping data to the theory. First, the theory demands that we observe input-
output connections at the level of the distortions. Therefore, if there are heterogenous
markups at the firm-level, then the input-output data must, in principle, also be at the
firm-level. Since this data does not exist, we impute a firm-level network from sectoral
input-output data by assuming that the productions functions within each industry are
the same. Second, our firm-level dataset is Compustat, and to the extent that the patterns
in Compustat are non-representative of the broader economy, this can contaminate our
empirical conclusions about the behavior of economic aggregates. Finally, in our empir-
ical applications, unlike in our theoretical results, we assume that markups are the only
distorting wedges. In our view, convincingly measuring other wedges such as financial
frictions for a whole economy is even more difficult than measuring markups. Nonethe-
less, the presence of unobserved wedges which interact with markups in non-trivial ways
can contaminate our empirical conclusions.
    Despite their generality, our theoretical results also have some important theoretical
limitations. First, our basic framework abstracts away from entry and external econ-
omy effects such as those studied by Baqaee (2016).4 Second, in this paper we focus on
   3
     See also Asker et al. (2019), who use micro-data from the oil industry to show much higher amounts of
economic waste than the classic Harberger analysis suggested.
   4
     Our results allow for a form of entry relying on individual demand curves with choke-prices. In this

                                                    5
first-order approximations.5 Finally, we model frictions using wedges, which we take as
primitives. The advantage is that we characterize the response of the equilibrium to a
change in the wedges without committing to any particular theory of wedge determina-
tion. The downside is that this makes it hard to perform counterfactuals when wedges
are endogenous. However, in these cases, our results are still relevant as part of a larger
analysis that accounts for the endogenous response of wedges.6
    The outline of the paper is as follows. In Section 2, we set up the general model,
prove our growth-accounting results, and introduce our decomposition of aggregate TFP
changes into pure changes in technology and changes in allocative efficiency. In Sec-
tion 3, we define a new residual, show that it correctly measures aggregate productivity
in inefficient economies, and compare our results to the existing literature, like Gollop
et al. (1987), Basu and Fernald (2002), and Petrin and Levinsohn (2012). Section 4 shows
explicitly how the components of our decomposition depend on microeconomic primi-
tives. In the body of the paper, we use a parametric version of the general model with
nested CES production and consumption functions with an arbitrary number of nests,
input-output patterns, returns to scale, factors of production, and elasticities to show this
dependence, but the more general results are in Appendix I. In Section 5, we use these
results to characterize the distance to the efficient frontier, and we discuss different no-
tions of changes in allocative efficiency which can all be computed with our structural
results. In Section 6, we discuss the data requirements of our results and some subtleties
in implementing and interpreting them. In Section 7, we apply our results to the data by
performing non-parametric decompositions of the sources of growth in the U.S., as well
as exercises measuring the distance from the efficient frontier. In Section 8, we mention
some extensions of the basic framework.


Related Literature
Our paper is related to the literature on misallocation, growth-accounting, and production
networks. The misallocation literature is perhaps the oldest of the three, tracing its way
from Alfred Marshall and Jules Dupuit to Arnold Harberger. More recently, the literature
case, small shocks can push a producer to enter a market, but at a small scale commensurate with the shocks,
so that all producer-level variables evolve smoothly. This is in contrast to models with fixed costs and their
associated non-convexities. We refer the reader to Baqaee and Farhi (2019a) for a general treatment of such
models.
    5
      In Appendix I, we discuss conditions under which the nonlinear analysis of efficient economies in
Baqaee and Farhi (2017) can be leveraged to characterize nonlinearities in inefficient economies.
    6
      In Appendix G, we provide an example with endogenous markups using an oligopolistic model à
la Atkeson and Burstein (2008). In Appendix E, we show how to use our results to analyze the effect of
monetary policy and productivity shocks in a model with sticky prices captured as endogeneous markups.


                                                      6
has been reinvigorated by Restuccia and Rogerson (2008) and Hsieh and Klenow (2009).
Perhaps closest to us are Edmond et al. (2018) who use a calibrated model to study the
costs of markup distortions in the U.S.. They find that the social costs of markups are lower
than we do primarily because they focus on size-related markup dispersion, whereas we
take into account the total dispersion in markups.
    The growth-accounting literature began with Solow (1957), and was extended by
Domar (1961), Hulten (1978), Hall (1990), Gollop et al. (1987), Basu and Fernald (2002),
Petrin and Levinsohn (2012), and Osotimehin (2019), among others.
    Finally, our paper is related to other studies of inefficient production networks. Jones
(2013) considers an input-output economy with Cobb-Douglas production and consump-
tion functions, distortionary wedges, and two factors. Bigio and La’O (2019) expand on
Jones (2013) by considering input-output economies with Cobb-Douglas production and
consumption functions with distortionary wedges and elastic labor supply. They charac-
terize the elasticity of output with respect to productivities and wedges. They present an
application to the 2008-09 financial crisis in the U.S. and find that input-output linkages
double the output effects of financial frictions. Our non-parametric results show that the
Cobb-Douglas case, while tractable, is also special. For example, it implies that the allo-
cation of resources is invariant to productivity shocks and this matters both qualitatively
and quantitatively.
    Baqaee (2016) also considers input-output economies with distortionary wedges (due
to endogenous markups) but allows for CES production and consumption functions with
two nests, assuming that the cross-industry elasticities of substitution are the same for
all agents. He studies how productivity shocks affect aggregate TFP in this environment,
allowing for the possibility that there is free entry and external economies of scale. Grassi
(2017) considers input-output economies that are Cobb-Douglas across sectors, CES within
sectors, and without entry. He allows for oligopolistic competition within industries and
studies the way productivity shocks propagate through the network. Our analysis differs
from Baqaee (2016) and Grassi (2017) in that our results are non-parametric, allowing for
more general substitution elasticities and multiple factors, but do not allow for free entry
or explicitly model oligopolistic competition.
    Finally, Liu (2019) considers an input-output economy with one factor, constant returns
to scale, and some pre-existing non-tax wedge distortions. Unlike in the previous papers
mentioned above, but like in our paper, his results are non-parametric. However, the
object of interest of his analysis is not GDP but GDP minus the revenues generated by
non-tax wedges (taken to be offset by non-pecuniary costs). The main result characterizes
the elasticity of this object with respect to taxes at the zero-tax point. It shows that


                                             7
this elasticity depends on the network and on the wedges but not on the elasticities of
substitution. The paper applies this result to conclude that in South Korea and China,
industrial policy rightfully targets upstream sectors which are more distorted. Our non-
parametric results show that the irrelevance of elasticities of substitution for aggregates,
while convenient, is also special. This irrelevance breaks away from the zero-tax point,
when there are multiple factors or decreasing returns to scale, or when the object of interest
is GDP or aggregate TFP.
    Since we apply our results to data on U.S. markups, our analysis is also related to
the debate about the recent trends in factor and profit shares in the U.S. See for example,
Elsby et al. (2013), Rognlie (2016), Barkai (2019), Caballero et al. (2017), Gutierrez (2017),
Farhi and Gourio (2018), Koh et al. (2019), Vincent and Kehrig (2019), Autor et al. (2019),
and De Loecker et al. (2019). Here our contribution is to point out that the changes in
the aggregate profit share (and in the aggregate markup) seem primarily to be driven by
composition effects within industries, whereby the high profit (and high markup) firms
have been getting larger. Our analysis shows that this composition effect has implications
for aggregate TFP growth.


2     Ex-Post Reduced-Form Results
In this section, we set up our framework, characterize how shocks to wedges and produc-
tivity affect output and TFP, and define a notion of change in allocative efficiency.


2.1   Set up
The model has N producers indexed by i and F factors indexed by f with inelastic supply
L f . Each producer uses intermediate inputs and factors, and sells its output as both an
intermediate good to other producers and as a final good.


Final Demand

Real GDP is the maximizer of a constant-returns aggregator of final uses of goods

                                  Y = max D(c1 , . . . , cN )
                                       {c1 ,...,cN }




                                                       8
subject to the budget constraint

                                N
                                X                   F
                                                    X         N
                                                              X
                                  (1 + τ0i )pi ci =   wf Lf +   πi + τ,
                                  i                     f =1           i=1


where pi and ci are the price and quantity of good i, w f is the wage of factor f , τ0i is the
consumption wedge on good i, πi is the profits of the producer of good i, and τ is a net
lump-sum rebate.7


Producers

Good i is produced using a constant-returns technology described by the cost function

                 1                                                 f                      f
                                                                                                
                    Ci (1 + τi1 )p1 , . . . , (1 + τiN )pN , (1 + τi1 )w1 , . . . , (1 + τiF )wF yi ,
                 Ai

where Ai is a Hicks-neutral productivity shifter, yi is total output, τi j is the input-specific
                              f
tax wedge on good j, and τig is a factor-specific tax wedge on factor g. We assume that
producer i sets a price pi = µi Ci /Ai equal to an exogenous markup µi times marginal cost
Ci /Ai .


General Equilibrium
                                                                         f
Given productivities Ai , markups µi , wedges τi j and τi j , a general equilibrium is a set of
prices pi , factor wages w f , intermediate input choices xi j , factor input choices li f , outputs yi ,
and final demands ci , such that: each producer minimizes its costs and charges the relevant
markup on its marginal cost; final demand maximizes the final demand aggregator subject
to the budget constraint, where profits and revenues from wedges are rebated lump sum;
and the markets for all goods and factors clear.


Variable Returns to Scale, Non-Hicks-Neutral Shocks, and Markup-Wedge Equivalence

Without loss of generality, we exploit three simplifications.8 First, despite specifying
constant-returns cost functions, our setup can accommodate variable (increasing or de-
   7
       The existence of a constant-returns-to-scale aggregate final demand aggregator allows us to unam-
biguously define real GDP and to avoid index-number complications. We assume its existence mostly for
expositional convenience. It is not required for our ex-post reduced-form results (as long as changes in real
GDP are defined using the Laspeyre index). In Baqaee and Farhi (2018), we show how our ex-ante structural
results can be generalized to environments with heterogenous consumers or non-homothetic preferences
(i.e. non-homothetic final demand).
     8
       In Section 6, we discuss how these simplifications affect the mapping of the theory to the data.


                                                          9
creasing) returns to scale. This is because, as pointed out by McKenzie (1959), variable
returns to scale can be modeled with constant returns to scale and producer-specific fixed
factors. Going forward, we proceed with our constant-returns setup with the under-
standing that it can be reinterpreted to capture variable returns to scale provided that the
original set of factor is expanded to include producer-specific fixed factors.
    Second, although the model is written in terms of Hicks-neutral productivity shocks,
this is done without loss of generality. We can always capture non-neutral (biased)
productivity shocks to the use of input j by producer i by introducing a fictitious producer
buying input j and selling to producer i with a linear technology, and by considering
Hicks-neutral shocks to this fictitious producer. Demand shocks can also be modeled in
this way by considering combinations of positive and negative non-neutral productivity
shocks to the different inputs of producer i.9
                                       f
    Third, all the wedges τij and τig can be represented as markups in a setup with
additional producers. For example, the good-specific wedge τij in the original setup can
be modeled in a modified setup as a markup charged by a new producer which buys
input j and sells it to producer i. Going forward, we take advantage of this equivalence
and assume that all wedges take the form of markups. We do this to simplify the notation.


2.2    Input-Output Definitions
To state our generalization of Hulten’s theorem, we introduce some input-output notation
and definitions. Our results are comparative statics describing how, starting from an initial
decentralized equilibrium, the equilibrium level of output changes in responses to shocks
to productivities Ak and markups/wedges µk . Without loss of generality, we normalize the
initial productivity levels to one. We now define accounting objects such as input-output
matrices, Leontief inverse matrices, and Domar weights. Each of these quantities has a
revenue-based version and a cost-based version, and we present both. All these objects
are defined at the initial equilibrium.
   9
     In an efficient economy, Hulten’s theorem implies that such changes in the composition of demand
have no effect on aggregate TFP, since the positive demand shock cancels out the negative demand shock
to the rest. However, in a model with distortions, the change in the composition of demand can affect TFP
by changing allocative efficiency.




                                                   10
Final Expenditure Shares

Let b be the N × 1 vector whose ith element is equal to the share of good i in the budget of
the final consumers
                                                pi ci
                                       b i = PN            ,
                                               j=1 p j c j

where the sum of final expenditures Nj=1 p j c j is nominal GDP.
                                      P


Input-Output Matrices

To streamline the exposition, we treat factors as special endowment producers which do
not use any input to produce. We form an (N + F) × 1 vector of producers, where the first
N elements correspond to the original producers and the last F elements to the factors.
For each factor, we interchangeably use the notation w f or pN+ f to denote its wage, and
the notation Li f or xi(N+ f ) to denote its use by producer i.
   The revenue-based input-output matrix Ω is the (N + F) × (N + F) matrix whose i jth
element is equal to i’s expenditures on inputs from j as a share of its total revenues

                                                    p j xi j
                                           Ωi j ≡            .
                                                    pi yi

The first N rows and columns of Ω correspond to goods, and the last F rows and columns
correspond to the factors of production. Since factors require no inputs, the last F rows of
Ω are zeros.
    The cost-based input-output matrix Ω̃ is the (N + F) × (N + F) matrix whose ijth element
is equal to the elasticity of i’s marginal costs with respect to the price of j

                                         ∂ log Ci      p j xi j
                                Ω̃ij ≡             = PN+ f         .
                                         ∂ log p j          pk xik
                                                             k=1


The second equality uses Shephard’s lemma. Since factors require no inputs, the last F
rows of Ω̃ are identically zero.
   The revenue-based and cost-based input-output matrices are related by

                                         Ω̃ = diag(µ)Ω

where µ is the vector of markups/wedges, and diag(µ) is the diagonal matrix with ith
diagonal element equal to µi .



                                                 11
Leontief Inverse Matrices

We define the revenue-based and cost-based Leontief inverse matrices as

        Ψ ≡ (I − Ω)−1 = I + Ω + Ω2 + . . .          and      Ψ̃ ≡ (I − Ω̃)−1 = I + Ω̃ + Ω̃2 + . . . .

While the input-output matrices Ω and Ω̃ record the direct exposures of one producer
to another, in revenues and in costs respectively, the Leontief inverse matrices Ψ and Ψ̃
record instead the direct and indirect exposures through the production network. This can
be seen most clearly by noting that (Ωn )ij and (Ω̃n )ij measure the weighted sums of all
paths of length n from producer i to producer j.
    As we shall see, these two Leontief inverse matrices encode different propagation chan-
nels. The revenue-based Leontief inverse matrix Ψ encodes the backward propagation
of demand. By contrast the cost-based Leontief inverse matrix Ψ̃ encodes the forward
propagation of costs.


Domar Weights

The revenue-based Domar weight λi of producer i is its sales as a fraction of GDP

                                                   pi yi
                                            λi ≡ PN        .
                                                       p
                                                  j=1 j jc

Note that Ni=1 λi > 1 in general since some sales are not final sales but intermediate sales.
         P

The accounting identity
                                                                         
                                        X                  XN            X
                      pi yi = pi ci +       pi x ji = bi     p j c j  +  Ω ji p j y j
                                                                          
                                                                          
                                        j                  j=1               j


relates Domar weights to the Leontief inverse via

                              λ0 = b0 Ψ = b0 I + b0 Ω + b0 Ω2 + . . . .                                 (1)

Similarly, we define cost-based Domar weights to be

                              λ̃0 ≡ b0 Ψ̃ = b0 I + b0 Ω̃ + b0 Ω̃2 + . . . .

We choose the name cost-based Domar weight for λ̃ to contrast it with the traditional
revenue-based Domar weight λ. Intuitively, λ̃k measures the importance of k as a supplier


                                                     12
in final demand, both directly and indirectly through the network. This can be seen most
clearly by noting that the i-th element of b0 Ω̃n measures the weighted sum of all paths of
length n from producer i to final demand.
    For expositional convenience, for a factor f we use Λ f and Λ̃ f instead of λ f and λ̃ f .
Note that the revenue-based Domar weight Λ f of factor f is simply its income share.


2.3     Ex-Post Reduced-Form Results
In this section, we derive our comparative-static results stated in terms of ex-post reduced-
form sufficient statistics. Take as given the factor supplies L f , the cost functions Ci , and
final demand D. Let X be an (N+F)×(N+F) admissible allocation matrix, where Xi j = xi j /y j
is the share of the physical output y j of producer j used by producer i. Specify the vector
of productivities A and denote by Y(A, X) the output Y achieved by this allocation.10,11
Finally, define Xij (A, µ) to be equal to xi j (A, µ)/y j (A, µ) at the decentralized equilibrium
when the vector of productivities is A and the vector of markups/wedges is µ. The level
of output at this equilibrium is given by Y(A, X(A, µ)).
    Now consider shocks d log A and d log µ and the associated change in the equilib-
rium allocation matrix d X = (d X/ d log A) d log A + (d X/ d log µ) d log µ. The change in
aggregate output in response to these shocks is given by

                                              ∂ log Y           ∂ log Y
                                d log Y =             d log A +         dX .
                                              ∂ log A              ∂X
                                              |     {z      }   | {z }
                                                  ∆Technology         ∆Allocative Efficiency


The change in output can be broken down into two components: the direct or pure effect
of changes in technology d log A, holding the distribution of resources X constant; and
the indirect changes in allocative efficiency arising from the equilibrium changes in the
distribution of resources d X, holding technology constant.
    We now provide an aggregation theorem characterizing the change in output in re-
sponse to changes in productivities and markups/wedges in inefficient economies. We also
   10
       The allocation matrix is admissible if the following conditions are verified: 0 ≤ Xi j ≤ 1 for all i and j;
Xi j = 0 for all j and for N + 1 ≤ i ≤ N + F; N+F
                                                                                    PN+F
                                                                                      i=1 Xi j = 1 for all N + 1 ≤ j ≤ N + F;
                                                   P
                                                    i=1 Xi j ≤ 1 for all 1 ≤ j ≤ N;
and there exists a unique resource-feasible allocation such that the share xi j /y j of the output y j of producer
                                                                       x
j which is used by producer i is equal to Xi j , so that Xi j = yijj .
    11
       To see how to construct this allocation, consider the production functions Fi defined as dual to the
cost functions Ci in the usual way. Then the vector of outputs yi solves the system of equations yi =
Fi (X1i y1 , . . . , X(N+F)i yN+F ) for 1 ≤ i ≤ N and yN+ f = L f for 1 ≤ f ≤ F. The corresponding level of final
consumption of good i is ci = yi (1 − N+F       j=1 X ji ) and the level of output is D(c1 , . . . , cN ).
                                              P




                                                            13
characterize the decomposition of these effects into pure technology effects and changes
in allocative efficiency.

Theorem 1. Consider some distribution of resources X corresponding to the general equilibrium
allocation at the point (A, µ), then

                                   d log Y          X d log Λ f
                                            = λ̃k −  Λ̃ f          ,                                       (2)
                                   d log Ak               d log Ak
                                                        f


and

                                   d log Y           X d log Λ f
                                            = −λ̃k −  Λ̃ f          .                                      (3)
                                   d log µk                d log µk
                                                            f


Furthermore, the decomposition of output changes into pure changes in technology and changes in
allocative efficiency is given by

                            d log Y = λ̃0 d log A −λ̃0 d log µ − Λ̃0 d log Λ .                             (4)
                                      | {z } |                {z           }
                                         ∆Technology        ∆Allocative Efficiency


     Theorem 1 not only provides a formula for the macroeconomic output impact of mi-
croeconomic productivity and markup/wedge shocks, but it also provides an interpretable
decomposition of the effect. Specifically, the first component (∂ log Y/∂ log A) d log A =
λ̃0 d log A is the pure technology effect: the change in output holding fixed the share of
resources going to each user. The second component (∂ log Y/∂X) d X = −λ̃0 d log µ −
Λ̃0 d log Λ is the change in allocative efficiency effect: the change in output resulting from
the reallocation of shares of resources across users.12
     Hulten’s theorem obtains as a special case of Theorem 1 when there are no markups/wedges.
Even this special case is actually a slight generalization of Hulten’s theorem since it only
requires the initial equilibrium to be efficient, whereas Hulten’s theorem applies only to
the case where the equilibrium is efficient before and after the shock.

Corollary 1 (Hulten). If the initial equilibrium is efficient so that there are no markups/wedges
µ = 1 , then
                              d log Y                 d log Y
                                       = λk and                 = 0.
                             d log Ak                 d log µk
   12
      The term −Λ̃0 d log Λ can be interpreted as the change in the gap between the probability distribution
defined by Λ̃ and Λ, as measured by relative entropy. That is, when there are no shocks to wedges, an
increase in the distance between Λ̃ and Λ implies an improvement in allocative efficiency due to reallocation.
At the efficient allocation, the change in this distance is zero, so reallocation has no effects on efficiency.


                                                       14
    In efficient economies, the first-welfare theorem implies that the allocation matrix
X(A, µ) maximizes output given resource constraints. The envelope theorem then implies
that (∂ log Y/∂X) d X = 0 so that there are no changes in allocative efficiency. Further-
more, because of marginal cost pricing, the direct effect of changes in technology are
based on the vector of sales shares or revenue-based Domar weights λ and are given
by (∂ log Y/∂ log A) d log A = λ0 d log A. Hence, Hulten’s theorem is a macro-envelope
theorem of sorts.
    When the initial equilibrium is inefficient so that µ , 1, this macro-envelope theorem
fails. Intuitively, in equilibrium, from a social perspective, resources are misallocated.
Equilibrium changes in the allocation of resources d X can therefore lead to changes in
output. This is precisely what we call a change in allocative efficiency (∂ log Y/∂X) d X =
−λ̃0 d log µ − Λ̃0 d log Λ, which is nonzero in general. Furthermore, because of wedges
between prices and marginal costs, the direct effect of changes in technology are now
based on the vector of cost-based Domar weights λ̃ rather than on the vector of revenue-
based Domar weights λ and are given by (∂ log Y/∂ log A) d log A = λ̃0 d log A.
    In the case of productivity shocks, Theorem 1 implies that changes in allocative ef-
ficiency are given by a simple sufficient statistic −Λ̃0 d log Λ = − f Λ̃ f d log Λ f . This
                                                                          P

is simply a weighted average of the reductions in factor shares − d log Λ f with weights
given by cost-based factor shares Λ̃ f and satisfying f Λ̃ f = 1. A decrease in the weighted
                                                          P

average of factor shares f Λ̃ f d log Λ f < 0 indicates that resources are reallocated to the
                            P

more monopolized or downwardly distorted parts of the economy. Allocative efficiency
improves because from a social perspective, these monopolized or downwardly distorted
parts of the economy received too few resources to begin with.
    Similarly, in the case of markup/wedge shocks, Theorem 1 implies that changes in
allocative efficiency are given by a simple sufficient statistic: −λ̃0 d log µ − Λ̃0 d log Λ =
− k λ̃k d log µk − f Λ̃ f d log Λ f . Now the reduction in factor shares − f Λ̃ f d log Λ f
   P                 P                                                           P

reflects both the direct reduction k λ̃k d log µk of factor shares from increased markups
                                      P

for a given allocation of resources and the reallocation of resources towards or away from
more distorted producers. To isolate the changes in allocative efficiency, which arise from
the latter, we must net out the former.
    It is remarkable that in both cases, it is not necessary to track how the allocation
of every single good changes across its users. Instead, it suffices to track how factor
income shares change. In Section 4, we also provide an explicit characterization of
− f Λ̃ f d log Λ f / d log Ak and − f Λ̃ f d log Λ f / d log µk in terms of the microeconomic
   P                                 P

elasticities of substitutions of the production functions and final demand, the properties
of the input-output network, and the markups/wedges. In the main body of the paper,


                                             15
we focus on nested-CES economies. In Appendix I, we show how to fully generalize the
results to general non-CES economies.


2.4    Illustrative Examples
In this section, we introduce some bare-bones examples to illustrate the intuition of The-
orem 1. In Section 4, we specialize Theorem 1 to the case of general nested constant-
elasticity-of-substitution (CES) economies with arbitrary input-output linkages. The ex-
amples here are special cases of these upcoming general results.


                      L                            L                              L


                                      1           ···           N
         ···          N                                                           1




          1         HH                           HH                             HH

       (a) Vertical Economy           (b) Horizontal Economy           (c) Round-about Economy

Figure 1: Vertical, horizontal, and round-about economies. The green and blue nodes
represent the factor and the household. The arrows represent the flow of goods.

    Consider the three economies depicted in Figure 1. In all three economies, there is a
single factor called labor. The only distortions in these examples are the markups charged
by the producers.
    The vertical economy in Figure 1a is a production line where producer N produces
linearly using labor and downstream producers transform (linearly) the output of the
producer immediately upstream from them. The household purchases the output of the
most downstream producer. The horizontal economy in Figure 1b features downstream
producers who produce linearly from labor.13 The household purchases the output of the
downstream producers according to a CES aggregator with elasticity θ0 . The roundabout
economy in Figure 1c features only one producer, who combines labor and its own product
using a CES production function.
    These different economies help illustrate the two ways Hulten’s theorem can break
down: (1) the equality of revenue-based and cost-based Domar weights (used to weigh
  13
    The terms “vertical” and “horizontal” economies are due to Bigio and La’O (2019), although for our
example, we relax the Cobb-Douglas assumption.

                                                 16
the pure effects of technology); and (2) the absence of changes in allocative efficiency
(reflecting the efficiency of the initial allocation). The vertical economy breaks (1) but not
(2), the horizontal economy breaks (2) but not (1), and the round-about economy breaks
(1) and (2).


Vertical Economy

For the economy in Figure 1a, Theorem 1 implies that

                d log Y              d log ΛL         d log ΛL
                         = λ̃k − Λ̃L          = λ̃k −          = λ̃k = 1
                d log Ak             d log Ak         d log Ak

and

               d log Y               d log ΛL          d log ΛL
                        = −λ̃k − Λ̃L          = −λ̃k −          = −λ̃k + λ̃k = 0,
               d log µk              d log µk          d log µk

where for this special case, λ̃k = 1, Λ̃L = 1, d log ΛL / d log Ak = 0, and d log ΛL / d log µk =
−1.
    In this economy, there is only one feasible allocation of resources, so the equilibrium
allocation is efficient regardless of the wedges. Therefore, our decomposition detects no
changes in allocative efficiency in response to shocks since −λ̃0 d log µ − Λ̃L d log ΛL =
− k λ̃k d log µk − d log ΛL = 0.
  P

    Even though its equilibrium is efficient, Hulten’s theorem fails for the vertical economy.
This is because for this example, the revenue-based Domar weight λk = k−1       i=1 µi is not the
                                                                                     −1
                                                                             Q

same as the cost-based Domar weight λ̃k = 1. When markups are positive so that µi > 1
for all i, we have λ̃k > λk . This is a consequence of downstream double-marginalization
which divorces the revenues earned by a producer from that producer’s share in the costs
faced by the household.


Horizontal Economy

Next consider the horizontal economy represented in Figure 1b. The consumption of the
household, or final output, is given by
                                                             θ0
                                                   θ0 −1  θ −1
                                                  !          0
                                   Y X     ci θ0 
                                    =    ω0i                 ,
                                   Y  i       ci          




                                                17
where θ0 is the elasticity of substitution in consumption, ω0i are consumption weights,
and variables with overlines in the denominator are normalizing constants measured in
the same units as the numerator.
   Theorem 1 then yields
                                                                                    
                  d log Y              d log ΛL                        µ−1         
                           = λ̃k − Λ̃L          = λk − λk (θ0 − 1)  P k −1 − 1                (5)
                  d log Ak             d log Ak                          j λ jµ j


and

                                      d log ΛL            µ−1
                                                                     !
                d log Y                                     k
                         = −λ̃k − Λ̃L          = λk θ0 P           −1 .                               (6)
                d log µk              d log µk           i λ i µi
                                                                −1



    In the horizontal economy, λ̃k = λk since there is no markup downstream from producer
k and 1 = Λ̃L , ΛL since there are markups downstream from labor. The pure effects of
a technology shock are still given by λ0 d log A = k λk d log Ak exactly as in Hulten’s
                                                          P

theorem. However, technology shocks and markup shocks can now trigger nonzero
changes in allocative efficiency −λ̃0 d log µ − Λ̃L d log ΛL = − k λk d log µk − d log ΛL .
                                                                    P

    Consider equation (5): the effects of a positive technology shock d log Ak to producer
k. For this economy, the allocation matrix X determines the share of labor used by
each producer. Holding fixed the allocation matrix, the productivity shock increases the
output of producer k. However, the shock also reduces its price, which in turn increases
the demand for its output via a substitution effect. Whether workers are reallocated
towards or away from producer k depends on whether the increase in demand from the
substitution effect is stronger than the increase in supply from the productivity shock.
This in turn hinges on the whether θ0 is greater than or less than 1, i.e. on the direction
of the departure from Cobb Douglas. When θ0 > 1, workers are reallocated towards
producer k. When θ0 < 1, workers are reallocated away from producer k. And when
θ0 = 1, the allocation of workers is unchanged. Whether this reallocation of workers
increases or decreases allocative efficiency and output in turn depends of the comparison
of the markup µk to the (harmonic) average markup ( i λi µ−1         )−1 .
                                                           P
                                                                  i
    When θ0 > 1, workers are reallocated towards producer k. If its markup is larger
than the (harmonic) average markup µk > ( i λi µ−1        )−1 , then this producer is too small
                                                 P
                                                        i
from a social perspective to begin with.14 The reallocation of labor towards producer k
therefore improves allocative efficiency and increases output.15 The opposite occurs when
  14
     Note that the average markup is simply the inverse of the labor share so that ( i λi µ−1 )−1 = 1/ΛL .
                                                                                    P
                                                                                           i
  15
     When θ0 > 1 and producer k is significantly more competitive than the average producer µk <


                                                   18
the markup of producer k is smaller than the average markup. This effect works in the
opposite direction when θ0 < 1, since in that case, the shock would reallocate workers
away from producer k. Of course, in the Cobb-Douglas case when θ0 = 1, the allocation
of labor remains unchanged, and hence there are no changes in allocative efficiency.16
    Finally, note that there are no changes in allocative efficiency if µk = ( i λi µ−1 )−1 , since
                                                                                P
                                                                                      i
in this case the initial allocation of resources between k and the rest the economy is efficient,
and therefore, we recover Hulten’s theorem.
    All of this information is summarized by a simple sufficient statistic: the change in
allocative efficiency is exactly the reduction in the labor share − d log ΛL . The labor share of
income decreases (increases), and allocative efficiency improves (worsens), when workers
are reallocated to producers that were too small (large) from a social perspective to begin
with because they were charging above-average (below-average) markups.
    For a markup shock d log µk to producer k, as long as θ0 > 0, the price of producer k
increases, the demand for its output decreases, and workers are reallocated away from it.
Allocative efficiency and output decrease (increase) if its markup is larger (smaller) than
the average markup. All of this information is again summarized by a simple sufficient
statistic −λ̃k d log µk − d log ΛL . Now the reduction in the labor share − d log ΛL reflects
both the direct reduction λ̃k d log µk of the labor share from the increase in the price of
good k for a given wage, and the reallocation of workers towards or away from more
distorted producers. To isolate the changes in allocative efficiency, which arise from the
latter, we must net out the former.
    When consumption is Leontief θ0 = 0 the household consumes a fixed quantity of
each good regardless of its price. As a result, the allocation of labor does not change in
response to d log µk , and there are therefore no associated changes in allocative efficiency.
    To summarize, with productivity shocks, the benchmark elasticity with no changes
in allocative efficiency d X/ d log A is Cobb Douglas θ0 = 1. With markup shocks, the
benchmark elasticity with no changes in allocative efficiency d X/ d log µ is Leontief θ0 = 0
instead. In Section 4, we show that these are generic properties of Cobb-Douglas and
Leontief economies.
( i λi µ−1 θ0 /(θ0 − 1))−1 , then the reduction in allocative efficiency can be so extreme that a positive pro-
 P
        i
ductivity shock can actually reduce output.
   16
      This last property is a more general property of Cobb-Douglas economies which we shall encounter in
Section 4: productivity shocks do not lead to any change in allocative efficiency for Cobb-Douglas economies
since their allocation matrix does not depend on the level of productivity.




                                                      19
Round-about Economy

Finally, we consider the round-about economy in Figure 1c. There is a single producer
producing using labor and its own goods according to
                                                                        θ0
                                             θ0 −1            θ0 −1  θ −1
                                            !                !          0
                          y1          x11 θ0            L1 θ0 
                             = A1 ω11             + ω1L                   .
                                    
                                                                     
                          y1           x11               L1          

    Theorem 1 implies that

               d log Y              d log ΛL
                        = λ̃1 − Λ̃L          = λ̃1 − (θ0 − 1)λ1 (λ̃1 − 1)(µ−1 − 1),
               d log A1             d log A1

and

              d log Y               d log ΛL
                       = −λ̃1 − Λ̃L          = θ0 λ1 (λ̃1 − 1)(µ−1 − 1).
              d log µ1              d log µ1

    The round-about economy combines features of the vertical economy and of the hori-
zontal economy. As in the vertical economy, revenue-based and cost-based Domar weights
differ since λ̃1 = µ1 /[µ1 − 1 + λ−1
                                  1
                                     ] , λ1 as long as µ1 , 1. As in the horizontal economy,
we have non-trivial changes in allocative efficiency in response to shocks. The intuitions
for these results combine those of the vertical economy and of the horizontal economy.


3     Growth Accounting
In this section, we explain how the results derived in Section 2 can be used for growth
accounting. We show that in inefficient economies, the traditional Solow residual, which
weighs factor growth according to factor shares, cannot be interpreted as a measure of
changes in aggregate TFP. To remedy this problem, we propose a distortion-adjusted
Solow residual that weighs factor growth according to cost-based factor shares. The
modified Solow residual can be decomposed into changes in pure technology and changes
in allocative efficiency. We argue that our decomposition is preferable to the related
decompositions of Gollop et al. (1987), Basu and Fernald (2002), and Petrin and Levinsohn
(2012).




                                                 20
3.1     Distortion-Adjusted Solow Residual and Aggregate TFP Decompo-
        sition
For the purpose of this section, we introduce a small but simple modification to allow
for changes in factor supplies. We denote the supply of factor f by L f and by L the
vector of factor supplies. The impact of a shock to the supply of a factor is given by
d log Y/ d log L f = Λ̃ f − g Λ̃ g d log Λ g / d log L f .
                            P

    The appropriate measure of aggregate TFP growth ∆ log Yt − Λ̃0t−1 ∆ log Lt is the part of
the growth in aggregate output ∆ log Y that cannot be attributed to the pure technology
effect Λ̃0t−1 ∆ log Lt of the growth of factors. This distortion-adjusted Solow residual weighs
the change in L f,t by the cost-based Domar weight Λ̃ f,t rather than by its share in aggregate
income.17
    A clear example of why the traditional Solow residual is an inappropriate measure of
TFP growth in the presence of distortions is the vertical economy in Figure 1a. In that
example, since the equilibrium is efficient, output increases one-for-one with an increase
in labor. Since Λ̃L = 1, this means that the distortion-adjusted Solow residual does not
change in response to changes in labor supply. However, if the profit share is non-zero,
then the traditional Solow residual ∆ log Y − ΛL ∆ log L increases in response to an increase
in the quantity of labor, despite there being no change in either physical or allocative
productivity. In other words, the Solow residual detects changes in aggregate TFP even
though aggregate TFP has not changed.18
    We now show how to decompose changes in aggregate TFP, captured by the distortion-
adjusted Solow residual, into pure changes in technology and changes in allocative effi-
ciency.

Proposition 1 (Distortion-Adjusted Solow Residual and Decomposition). To the first order,
we can measure aggregate TFP with the distortion-adjusted Solow residual ∆ log Yt − Λ̃0t−1 ∆ log Lt
   17
      In practice, the traditional Solow residual attributes all non-labor income to capital (and has no room
for profit income). The capital share of the traditional Solow residual would therefore be different from our
capital share.
   18
      This point relates to Hall (1988, 1990) who considers environments where aggregate output is generated
from factors L = (L1 , · · · , LF ) by a representative producer charging an aggregate markup µ via a structural
aggregate production function Y = AF(L). Hall showed that under these restrictive assumptions implying
that there is no misallocation given factor supplies, changes in aggregate TFP can be recovered via a modified
Solow residual ∆ log A = ∆ log Y − (µΛ)0 ∆ log L, where the growth of each factor ∆ log L f is weighted by its
share of total cost µΛ f rather than by its share of total revenue Λ f . This can be seen as a particular case of
our result since under these assumptions, µΛ f = Λ̃ f and so Hall’s modified Solow residual coincides with
our distortion-adjusted Solow residual.




                                                       21
and decompose it into pure changes in technology and changes in allocative efficiency as

                   ∆ log Yt − Λ̃0t−1 ∆ log Lt ≈ λ̃0t−1 ∆ log At −λ̃0t−1 ∆ log µt − Λ̃0t−1 ∆ log Λt .                                   (7)
                   |         {z            } | {z } |                          {z               }
                             ∆ Aggregate TFP                      ∆ Technology                     ∆ Allocative Efficiency


    In the case of an efficient economy, the envelope theorem implies that the reallocation
terms are zero (to a first order) and can be ignored. Furthermore, the appropriate weights
on the technology shocks λ̃t coincide with the observable sales shares. In the presence of
distortions, these serendipities disappear. However, given the input-output expenditure
shares across producers, the level of markups/wedges and their changes, and the changes
in factor income shares, we can compute the right-hand side of equation (7) without having
to make any parametric assumptions. This is an ex-post decomposition in the sense that
it requires us to observe factor income shares and factor supplies at the beginning and at
the end of the period.19,20


3.2         Gollop et al., Basu-Fernald, and Petrin-Levinsohn
Seminal papers by Gollop et al. (1987), Basu and Fernald (2002), and Petrin and Levinsohn
(2012) propose alternative decompositions of aggregate TFP changes into pure technology
changes and changes in allocative efficiency for economies with markups/wedges. Just
like our decomposition, changes in allocative efficiency seek to isolate the aggregate TFP
changes which are due to the reallocation of resources to more or less distorted parts
of the economy. In this section, we discuss how these alternative decompositions differ
from ours, point out that they suffer from a conceptual problem, and argue that our
     19
          We can cumulate the distortion-adjusted Solow residual over time to get
                   t1
                   X                                       t1
                                                           X                             t1
                                                                                         X
                          ∆ log Yt − Λ̃0t−1 ∆ log Lt   ≈          λ̃0t−1 ∆ log At    +          −λ̃0t−1 ∆ log µt − Λ̃0t−1 ∆ log Λt .
                   t=t0   |         {z            }        t=t0   |       {z     }       t=t0   |              {z                }
                              ∆ Aggregate TFP                         ∆ Technology                     ∆ Allocative Efficiency


This is a (Riemann-sum) approximation to the integral of (7). The approximation is exact in the limit of
small time intervals (assuming the shocks are continuous in time) where we get the exact integral formula
R t1            R t1                 R t1                R t1                R t1
 t
     d log Yt −  t
                     Λ̃0
                       t d log L t =  t
                                          λ̃0
                                            t d log At −  t
                                                              λ̃0
                                                                t d log µt −  t
                                                                                  Λ̃0t d log Λt . Note that the cost-based Domar
 0                 0                   0                          0                       0
weights Λ̃t and λ̃t are updated over time, just like the factor shares Λt are updated over time in the
cumulation of the traditional Solow residual. Cumulated pure changes in technology do reflect changes in
the allocation of resources across producers over time via changes in λ̃t . But these effects are not first-order,
and can only be detected at higher orders of approximation or over time when the cumulated shocks are
large. Furthermore, they are also present in efficient economies, and we refer the reader to Baqaee and Farhi
(2017) for a comprehensive analysis of these nonlinearities in this context.
    20
       We can use the exact integral formula to give a second-order approximation of changes in real output
∆ log Yt ≈ (Λ̃0t + ∆Λ̃0t /2)∆ log Lt + (λ̃0t + ∆λ̃0t /2)∆ log At − (λ̃0t + ∆λ̃0t /2)∆ log µt − (Λ̃0t + ∆Λ̃0t /2)∆ log Λt via a
Törnqvist adjustment.

                                                                           22
decomposition is preferable.21
    Gollop et al. only allow for markups/wedges in factor markets, but not in intermediate
input markets. Unlike ours, this decomposition is therefore inapplicable when there are
also markups/wedges in intermediate input markets. When there are no markups/wedges
in intermediate input markets, it coincides with the decomposition of Petrin and Levin-
sohn (2012) up to the first order. In what follows, we therefore restrict our discussion to
Basu-Fernald, and Petrin-Levinsohn.22
    Whereas we decompose changes in aggregate TFP as appropriately measured by the
distortion-adjusted Solow residual, these alternatives decomposition actually adopt dif-
ferent, and as we have argued inadequate, measures of changes in aggregate TFP: the
traditional Solow residual for Petrin-Levinsohn and a Solow residual which strips out
profits from capital income to compute the share of capital for Basu-Fernald. But the
differences between these approaches and ours go beyond this observation. To make this
clear, we conduct the whole discussion under the assumption that factor supplies are
fixed. All the aforementioned notions of changes in aggregate TFP then coincide with
changes in aggregate output.
    At a high level, the difference between these alternative decompositions and our
approach is that our approach decomposes output changes into two feasible counterfactual
allocations: the allocation where the allocation matrix is held constant but productivities
change, and the allocation where productivities are held constant but the allocation matrix
changes. The alternative decompositions we discuss in this section do not have a similar
interpretation in terms of feasible counterfactual allocations.
    Each of these decompositions defines changes in pure technology by weighting mi-
croeconomic productivity shocks, and then constructs changes in allocative efficiency as
the residual between the pure technology effect and aggregate output growth. To under-
stand the differences between these decompositions, it is enough to compare their pure
   21
      Like ours, these approaches are economic decompositions based on explicit general equilibrium models.
This feature distinguishes them from a popular set of purely statistical decompositions, such as, for example,
Baily et al. (1992), Griliches and Regev (1995), Olley and Pakes (1996), and Foster et al. (2001). These statistical
approaches start by defining an ad-hoc aggregate TFP index. They (wrongly) take changes in this index to
be changes in aggregate TFP. They then somewhat arbitrarily decompose them into technology effects and
reallocation effects. Beyond the fact that the object that they decompose is not aggregate TFP (neither the
distortion-adjusted nor the traditional Solow residual), these decompositions are problematic because they
detect reallocation effects even in efficient economies and in economies where there are no reallocations
of resources. This happens for example in the acyclic economies discussed below. See Osotimehin (2019)
for related criticisms. Nevertheless, such decompositions provide moments in the data that can be used to
distinguish between competing models (e.g. Bartelsman et al., 2013).
   22
      Technically, Basu-Fernald only allows for one type of intermediate input (“materials”), which is restric-
tive. However, their decomposition can be extended to allow for multiple types of intermediate inputs. We
use this extension in our discussion.


                                                        23
technology components since the allocative efficiency components are just the residual
differences between aggregate output changes and pure technology changes. The pure
technology terms for Petrin-Levinsohn are
                                             X
                                                      λkt ∆ log Akt ,
                                                  k


while for Basu-Fernald they are
                                       X           1 − sMkt
                                            λkt                ∆ log Akt ,
                                                  1 − µkt sMkt
                                        k


where sMkt is k’s expenditures on intermediate inputs as a share of its revenues in period t.
These expressions, like ours, are weighted averages of technology changes ∆ log Akt across
producers, but the weights are different. For Petrin-Levinsohn, the weight λkt attached to
producer k is the usual sales share λkt . With Basu-Fernald, the weight λkt (1 − sMkt )/(1 −
µkt sMkt ) attached to a given producer k is its share in aggregate value added λkt (1 − sMkt )
multiplied by a correction 1/(1 − µkt sMkt ) involving its own intermediate input share in
revenues sMkt and its own markup µkt .
     In either case, the weights differ from the cost-based Domar weights λ̃kt of our decom-
position. In fact, the (micro) information required to calculate their weights for producer
k — its sales share, value added share, intermediate-input share, and markup — is not
enough in general to calculate our cost-based Domar weight which requires more (macro)
information — the whole input-output matrix and the whole set of markups. This (macro)
information is used in our pure technology term precisely because it is corresponds to a
counterfactual feasible allocation and not simply to a grouping of residual terms.23 Over-
all, the pure technology components of these alternative decompositions are different
from ours, and by implication, so are the allocative efficiency components.
     To see the problem with the decompositions of Gollop et al., Basu-Fernald, and Petrin-
Levinsohn consider an economy where the production network Ω is an acylic graph, as
illustrated in Figure 2. The term acyclic here means that any two goods are connected to
   23
     Relative to the decompositions of Basu-Fernald, and Petrin-Levinsohn, there is a sense in which our
decomposition also economizes on information by recognizing that the system of first-order conditions
arising from cost-minimization by every producer gives rise to a system that can be solved. This is what
allows us to summarize all the information necessary to compute changes in allocative efficiency into
changes in the markups/wedges and changes in the primary factor shares. By contrast, to isolate changes
in allocative efficiency, the other decompositions require tracking the change of every output and input
quantity for every producer (for brevity, we do not reproduce here their exact expressions for changes in
allocative efficiency). This requirement leads to another disadvantage: it necessitates the observation of
prices and quantities at the micro level, which is typically only possible in selected datasets. By contrast,
our approach does not require such information.

                                                         24
one another by exactly one undirected path, so that each factor and each good has a unique
consumer. Such economies have a unique feasible allocation, simply because there is no
option to allocate a given factor or good to different uses. This allocation is necessarily
efficient. Markups/wedges have no effect on the allocation of resources, and as a result,
there is no misallocation. As consequence, it is unambiguous a priori that there should be
no changes in allocative efficiency in response to shocks.

                                     F1       ···       FK
                              ···                             ···

                                     1        ···        N


                                             HH

Figure 2: Acyclic economies.The green and blue nodes represent the factor and the house-
hold. The arrows represent the flow of goods.


Corollary 2 (Acyclic Economies). If the production network of the economy is acyclic, then

                               d log Y              d log Y
                                        = λ̃k ,              = 0.                            (8)
                               d log Ak             d log µk

    This corollary follows immediately from the fact that by construction, acyclic economies
hold the allocation matrix fixed. An important consequence of this corollary is that for
acyclic economies, our decomposition correctly identifies that there are no changes in
allocative efficiency in response to productivity (or wedge shocks). On the other hand,
the decompositions of Basu-Fernald, and Petrin-Levinsohn, which are not based on coun-
terfactual allocations but instead on grouping of residual terms, do detect changes in
allocative efficiency in response to productivity shocks. This follows from the fact that, as
explained above, their pure changes in technology differ from ours. For a fully worked-out
example, we refer the reader to Appendix F.
    Of course, acyclic economies are not realistic. They are only useful because they reveal
clearly a conceptual problem with these alternative decompositions, but this conceptual
problem applies to generic economies.
    In this section, we have highlighted the conceptual advantage of our approach over
these alternative approaches. It turns out that these approaches also lead to very different
empirical results. In Section 7, we empirically implement our decomposition in the U.S.
at the firm level in the presence of markups. In Appendix B we do the same for the

                                              25
Petrin-Levinsohn decomposition.24 The results, displayed in Figures 6b and 8, illustrate
material quantitative differences between the results of these two approaches. In particu-
lar, changes in allocative efficiency are much lower under the Petrin-Levinsohn approach
than under ours.


4        Ex-Ante Structural Results
Our results so far rely on the response of factor shares d log Λ, which are endogenous
objects determined in equilibrium. In this section, we show how d log Λ depends on
the (exogenous) primitives of the model. This allows us to use Theorem 1, not just for
measurement, but also for predictions.
    For expositional clarity, in this section, we focus on a special parametric class of
models. In particular, we work with nested CES-economies, where every production and
consumption function can be written as a nested-CES function (albeit with an arbitrary
number of nests, weights, and elasticities). Working through this parametric class of
models greatly helps build intuition and allows us to calibrate a structural model for
quantifying the mechanisms that we identify. The examples in Section 2.4 (the vertical,
horizontal, and round-about economies) are all special cases. In Appendix I, we show how
to generalize these results to non-CES economies with arbitrary production functions.


4.1      Model Setup
Any CES economy with a representative consumer, an arbitrary numbers of nests, elas-
ticities, and intermediate input use, can be re-written in what we call standard form, which
is more convenient to study. A nested CES economy in standard form is one where every
CES aggregator, in production or in final demand, is treated as a separate producer in
the input-output matrix.25 This means that every row of the input-output matrix i, or
equivalently every producer i, has associated with it a unique elasticity of substitution
parameter θi . For more details, see Appendix H.
    In order to state our results, we introduce the following input-output covariance operator:
                                                                                                          
                                                X                       X               X
                 CovΩ̃(j) (Ψ̃(k) , Ψ( f ) ) =       Ω̃ ji Ψ̃ik Ψi f −    Ω̃ ji Ψ̃ik    Ω̃ ji Ψi f  ,
                                                                                                             
                                                i                          i                   i
    24
      We could not perform the same comparison for Basu-Fernald because its implementation would require
data on the quantity of intermediate-input changes at the firm level which are not available.
   25
      Note that this may require expanding the set of producers: first because each original producer can
feature a production function with several CES nests; and second because we treat CES nests in final demand
as producers.

                                                             26
where Ω̃(j) corresponds to the jth row of Ω̃, Ψ̃(k) to kth column of Ψ̃, and Ψ( f ) to the f th
column of Ψ. In words, this is the covariance between the kth column of Ψ̃ and the f th
column of Ψ using the jth row of Ω̃ as the distribution. Since the rows of Ω̃ always sum to
one for each producer j, we can formally think of this as a covariance (when j corresponds
to a factor, the operator always returns 0).


4.2     Ex-Ante Structural Results
Propositions 2 and 3 below characterize the macroeconomic impact of microeconomic
productivity and markup/wedge shocks as well as their decomposition into pure changes
in technology and changes in allocative efficiency as a function of the properties of the
network and the elasticities of substitution.


Productivity Shocks

We first consider the case of productivity shocks.

Proposition 2 (Productivity Shocks). In response to a productivity shock, the following linear
system describes the change in factor income shares:

                 d log Λ f X λ j                             X       d log Λ g Ψ( f )
                          =       (θ j − 1)CovΩ̃(j) (Ψ̃(k) −   Ψ̃(g)          ,       ).            (9)
                 d log Ak   j
                              µ j                            g
                                                                     d log A k Λf



Given d log Λ f / d log Ak , we know, from Theorem 1 that

                                  d log Y          X d log Λ f
                                           = λ̃k −  Λ̃ f          .
                                  d log Ak               d log Ak
                                                        f


   Technically, equation (9) encapsulates both forward and backward linkages. The
forward equations describe how upstream shocks affect downstream prices through costs:

                                d log pi           X       d log Λ f
                                         = −Ψ̃ik +   Ψ̃i f           ,
                                d log Ak                   d log Ak
                                                            f


where prices are quoted in the nominal GDP numeraire (so that nominal i pi ci = 1).26
                                                                      P

The backward equations describe how downstream shocks to prices affect factor shares
   26
   A price pi in the nominal GDP numeraire can easily be converted into a price pi Y in the GDP deflator
numeraire, so that d log(pi Y) = d log pi + d log Y.




                                                   27
through substitution:

                        d log Λ f X λ j                      d log p Ψ( f )
                                 =      (θ j − 1)CovΩ̃(j) (−         ,      ).
                        d log Ak   j
                                     µj                      d log Ak Λ f

    To gain some intuition for equation (9), it is useful to start with the case where there is
a single factor F = 1. We call this factor labor L and apply the equation to f = L. In this
case, the term g Ψ̃(g) d log Λ g / d log Ak − d log Y can be dropped in the covariance on the
               P

right-hand side of equation (9) because all the elements of this vector are identical, and so
we get27
                         d log ΛL X λ j                                 Ψ(L)
                                    =        (θ j − 1)CovΩ̃(j) (Ψ̃(k) ,      ).           (10)
                         d log Ak       j
                                          µj                            ΛL

    The numbers ΨiL are the payments to labor as a share of the total revenue of i taking
into account the entire supply chain of i. In an efficient economy with one factor, we have
ΨiL = Ψ̃iL = 1 and ΛL = Λ̃L = 1. By contrast, in an inefficient economy we still have
Ψ̃iL = 1, and Λ̃L = 1 but we no longer necessarily have ΨiL = 1 or ΛL = 1. For example,
if all markups/wedges are positive, we have ΨiL < 1 and ΛL < 1. A low value of ΨiL
indicates that on average, markups/wedges are high along the supply chain of i, and a
low value of ΛL indicates that on average, markups/wedges are high in the economy as
a whole. The lower ΨiL /ΛL , the more marked up is the supply chain of i relative to the
economy as a whole.
    In response to a positive productivity shock to producer k, the relative prices of all
producers i change according to their exposure to k, measured by Ψ̃ik . If θ j > 1, the jth
producer substitutes its expenditures across its inputs towards the producers with higher
exposure Ψ̃ik to k, since their relative prices decline by more. If CovΩ̃(j) (Ψ̃(k) , Ψ(L) /ΛL ) < 0,
then those producers also have more marked up supply chains, and substitution by j
lowers the labor share. Of course, these effects on the labor share must be summed over
all producers j with weights given by their costs λ j /µ j . If the overall effect is a decline in
the labor share, then resources are overall reallocated towards more marked up parts of
the economy, and there are positive changes in allocative efficiency which increase output
over and above the pure technology effect of the shock.28
    The complication brought on by having multiple factors is that relative factor prices
   27
      This follows immediately from the fact that Ψ̃iL = 1 for all i
   28
      Baqaee and Farhi (2017) show that for an economy like the one in Proposition 2, if the economy
is efficient, then the output response to a shock to producer k depends only on k’s role as a supplier.
Proposition 2 shows that this fails if the equilibrium is inefficient. In particular, Ψ(L) — which captures
information about how distorted the supply chain of each producer is (i.e. it depends on the producer’s
role as a consumer of inputs), also matters, since it affects the response of misallocation.


                                                    28
change in response to substitution, and changes in factor prices can trigger additional
substitution. To understand how things work with multiple factors, we rewrite equation
(9) as the following linear system

                                         d log Λ     d log Λ
                                                  =Γ          + δ(k) ,                              (11)
                                         d log Ak    d log Ak

with
                                          X λj                                        Ψ( f )
                                Γfg = −                  (θ j − 1)CovΩ̃(j) (Ψ̃(g) ,          ),
                                               j
                                                    µj                                Λf

and
                                         X λj                                        Ψ( f )
                                 δfk =                  (θ j − 1)CovΩ̃(j) (Ψ̃(k) ,          ).
                                           j
                                                   µj                                Λf

    We call δ the factor share impulse matrix. Its kth column encodes the effects of a shock
to the productivity of producer k on factor income shares, taking relative factor prices
as given. We call Γ the factor share propagation matrix. It encodes the effects of changes
in relative factor prices on factor income shares and is independent of the source of the
shock k. When there is only factor, Γ is a zero 1 × 1 matrix, and we are left with only the
first-round effects δ(k) . However, when there are multiple factors, productivity shocks lead
to changes in factor prices, which lead to further changes in factor income shares, etc. ad
infinitum via higher-round effects captured by Γ.29
    We now turn to the effects of markups/wedge shocks. We rely on the intuitions
developed for the effects of productivity shocks and emphasize only the main differences.


Markup/Wedge Shocks

We now consider the case of markup/wedge shocks. We leverage the intuitions developed
for the case of productivity shocks.

Proposition 3 (Markup/Wedge Shocks). In response to a markup/wedge shock, the following
linear system describes the change in factor income shares:

             d log Λ f    X λj                             X       d log Λ g Ψ( f )        Ψk f
                       =−       (θ j − 1)CovΩ̃(j) (Ψ̃(k) +   Ψ̃(g)          ,       ) − λk      .   (12)
             d log µk     j
                            µ j                            g
                                                                   d log µk   Λ f          Λ f

  29
       See Example K.1 in Appendix K for a simple illustration.




                                                               29
Given d log Λ f / d log µk , we know, from Theorem 1 that

                                   d log Y           X d log Λ f
                                            = −λ̃k −  Λ̃ f          .
                                   d log µk                d log µk
                                                         f


    As with productivity shocks, equation (12) combines forward and backward linkages
together. To gain some intuition, it is again useful to focus on the case where there is a single
factor F = 1. We call this factor labor and apply the equation to f = L. In this case, exactly
like for productivity shocks and for the same reason, the term g Ψ̃(g) d log Λ g / d log µk
                                                                       P

can be dropped in the covariance on the right-hand side of the equation, so we get

                       d log ΛL    X λj                             Ψ(L)        ΨkL
                                =−      (θ j − 1)CovΩ̃( j) (Ψ̃(k) ,      ) − λk     .         (13)
                       d log µk    j
                                     µj                             Λf          ΛL

    An increase in the markup/wedge of producer k changes the labor share via two
effects. First, it changes relative prices like a negative productivity shock to producer k
and triggers corresponding substitution effects, with an overall effect on labor demand
and on the labor share captured by the first term on the right-hand side of equation (13).
Second, it reduces the wage by reducing input and hence ultimately labor demand, which
reduces the labor share according to the second term −λk ΨkL /ΛL on the right-hand side of
equation (13).30
    To get the effect on output, we must isolate the part of the reduction in the labor share
− d log ΛL / d log µk which is due to the reallocation of resources to more distorted parts
of the economy. To do so, we must net out from the reduction in the labor share the
mechanical reduction λ̃k in the labor share arising, for a given wage, from the increase in
prices. Overall, the positive markup shock to producer k acts on output like a negative
productivity shock to producer k combined with a release of resources λk ΨkL /ΛL (since
unlike negative productivity shocks, positive markups do not destroy physical resources).


4.3      Cobb-Douglas and Leontief
In this section, we isolate two benchmark specifications with no changes in allocative
efficiency: Cobb-Douglas with productivity shocks and Leontief with markup/wedges
shocks.

Proposition 4 (Cobb-Douglas and Leontief). If the economy is Cobb-Douglas with θ j = 1 for
all j, then there are no changes in allocative efficiency in response to productivity shocks and we
  30
       See Example K.3 in Appendix K for a simple illustration with a Cobb-Douglas example.


                                                    30
have
                                            d log Y
                                                     = λ̃k .
                                            d log Ak
If the economy is Leontief with θ j = 0 for all j, then there are no changes in allocative efficiency in
response to markup/wedge shocks and we have

                                             d log Y
                                                      = 0.
                                             d log µk

    The Cobb-Douglas result follows directly from Proposition 2. Basically, when all
elasticities are unitary, the allocation matrix is not a function of productivity shocks.
Productivity shocks only affect output via pure changes in technology captured by the
cost-based Domar weights.
    The Leontief result can be obtained by manipulating the expressions in Proposition 3
to obtain the following useful general formula

                d log Y X X λ j                        X       d log Λ g Λ̃ f
                         =       θ j CovΩ̃(j) (Ψ̃(k) +   Ψ̃(g)           ,     Ψ( f ) ),           (14)
                d log µk   j
                             µ j                       g
                                                               d log µ k   Λ f
                              f


where d log Λ g / d log µk is given by equation (12). From this, it is immediate that output
does not change all elasticities θ j = 0. This means that for a Leontief economy, the
allocation matrix is not a function of the wedges. Hence, shocks to markups/wedges have
no effect on output.


4.4     Endogenous Productivities and Wedges
Our framework treats productivity and wedges as exogenous primitives. However, our
results can also be used to study situations in which these are endogenous to some more
fundamental parameter.31 For example, consider some parameter Z which gives rise to
some endogenous vector of equilibrium productivities A(Z) and markups/wedges µ(Z),
for example a theory of innovation or market structure. These functions are not primitives
of the model, instead they are equilibrium objects, the determination of which could be
complex and interesting in and of itself. This is however not the focus of our paper. Our
results can be used to understand the comparative statics of output with respect to Z by
using the chain rule. The effect of a shock to Z can then be decomposed in two: how A
and µ respond to a change in Z, and how output responds to the change in A and µ. The
   31
    Of course, conditional on knowing the changes in productivity and the wedges, we can use our results
without modification (for example, as we do in the growth accounting application in Section 7.2).



                                                  31
advantage of our approach is that we can characterize the latter effect, in general, without
committing to a specific theory of productivity or markup/wedge determination.
   Our ex-post reduced form results,

                          d log Y = λ̃0 d log A − λ̃0 d log µ − Λ̃0 d log Λ,                       (15)

can be used with no modification if the changes in productivities d log A = (d log A/ d Z) d Z
and wedges (d log µ/ d Z) d Z in response to a shock d Z are observed. Our ex-ante struc-
tural results
                  d log Y X d log Y d log Ak X d log Y d log µk
                          =                        +                     ,               (16)
                    dZ          d log Ak d Z            d log µk d Z
                                  k                         k

can also be used for counterfactuals since the expressions for d log Y/ d log Ak and for
d log Y/ d log µk are still given by Propositions 2 and 3.
    In Appendix G, we follow this approach to fully solve a simple example of an economy
with endogenous markups inspired by Atkeson and Burstein (2008). We use our results
to characterize by how much incomplete pass-through of productivity shocks to prices
mitigates the impact of microeconomic productivity shocks on aggregate output.32


5        Distance to the Frontier and Other Efficiency Measures
In this section, we show how the ex-ante structural results of Section 4 can be used to
calculate the “distance to the frontier,” that is, the increase in aggregate productivity that
would result from the elimination of all wedges. We then discuss the relation between
our notion of changes in allocative efficiency and alternative measures such as the change
in the distance to the frontier. We use the nested-CES setup of Section 4 throughout. We
refer the reader to Appendix I for an explanation of how to generalize the results of this
section to non-CES economies with arbitrary production functions.


5.1      Distance to the Frontier
Recall that Y(A, µ) = Y(A, X(A, µ)) is the equilibrium level of output given the productivity
vector A and the markup/wedge vector µ. By the first welfare theorem, the efficient level
of output is Y∗ = Y(A, 1) and the distance to the frontier is L = log(Y∗ /Y).
    32
     For a different example we refer the reader to Appendix E where we show how to handle nominal
rigidities. The model can be recast as a model with endogenous markups ensuring that the relevant prices
stay constant and can be analyzed via the chain rule.




                                                  32
Second-Order Approximation

We use equations (12) and (14) derived in Section 4 to compute a second-order approxi-
mation of the distance to the frontier for small markups/wedges.

Proposition 5 (Distance to the Frontier). For small markups/wedges µk = exp ∆ log µk , the
distance to frontier up to the second-order in the markups/wedges ∆ log µk is

          1X                   X
  L≈          λ j θ j VarΩ(j) (   Ψ(k) ∆ log µk )
          2 j
                                k
                                           1X                      X                   X
                                         +        λ j θ j CovΩ(j) (   Ψ(g) ∆ log Λ g ,   Ψ(l) ∆ log µl ), (17)
                                           2 j                      g                l


with ∆ log Λ g = k (d log Λ g / d log µk )∆ log µk , where d log Λ g / d log µk is given by equation
                   P

(12), applied either at the distorted equilibrium with markups/wedges or at the efficient equilibrium
without markups/wedges.

   This approximation gives the distance to the frontier as a function of the markups/wedges,
the elasticities of substitution, and the production network. It generalizes the results of
Hsieh and Klenow (2009) to arbitrary production networks and patterns of elasticities of
substitution, and without imposing distributional assumptions on markups/wedges and
productivities.
   The approximation simplifies greatly in the case of a single factor F = 1. In this case,
the terms on the second line of equation (17) drop out and we are left with33

                                      1X                   X
                                 L≈       λ j θ j VarΩ(j) (  Ψ(k) ∆ log µk ).                            (18)
                                      2 j
                                                            k


    Some general lessons are immediately available. First, all the terms scale with the
square of the markups/wedges µ. There is therefore a sense in which misallocation
increases with the markups/wedges. Second, all the terms scale with the elasticities of
substitution θ of the different producers. There is therefore a sense in which higher
elasticities of substitution magnify the extent of misallocation. For example, the distance
to the frontier is always zero when the economy is Leontief. Third, all the terms also
scale with the sales shares λ of the different producers and with the square of the Leontief
inverse matrix Ψ. There is therefore also a sense in which accounting for intermediate
inputs magnifies the extent of misallocation from markups/wedges. Fourth, all the terms
mix the markups/wedges, the elasticities of substitution, and of properties of the network.
  33
       Osotimehin and Popov (2018) present related results.

                                                      33
Hence, in general, the distance to the frontier depends on how the markups/wedges are
distributed over the network and not simply on their univariate probability distribution,
a point to which we will return in the context of a simple example below. Fifth, in
general, the distance to the frontier is not zero when markups/wedges are uniform due to
double-marginalization (for instance, consider the round-about economy in Figure 1c).


Relation to Hsieh-Klenow in a Simple Example

Applying this formula to the horizontal economy of Section 2.4, we get

                         1            X                  1
                      L ≈ θ0 VarΩ(0) (  Ψ(k) ∆ log µk ) = θ0 Varλ (∆ log µ).                          (19)
                         2                               2
                                          k


In words, the distance to the frontier depends positively on the elasticity of substitution θ0
and the sales-share weighted variance of the markups/wedges. The specialization of the
general formula to this simple example clarifies a potential source of confusion: whether
the joint distribution of productivities and wedges matters. Formula (19) shows that
in general, the joint distribution of productivities and wedges does matter via the joint
distribution of sales shares and markups/wedges.
    In the particular case where producers differ only by their productivities and markups,
and where productivities and markups are jointly log-normally distributed, Hsieh and
Klenow (2009) show that the distance to the frontier can be approximated, up to the second
order, by
                                         1
                                    L ≈ θ0 Var(∆ log µ).                                  (20)
                                         2
In contrast to formula (19), this formula implies that the joint distribution of (A, µ) is
irrelevant, and only the marginal distribution of the markups/wedges matters.
    Only under the assumption that A and µ are jointly log-normal is equation (20) consis-
tent with equation (19). In this special case, Var(∆ log µ) is, to a second-order approxima-
tion, equal to Varλ (∆ log µ).34 Formula (19) is a generalization of formula (20) beyond the
jointly log-normal case. It captures the general dependence of misallocation on the joint
distribution of sales and wedges. It sheds light on the results of Restuccia and Rogerson
   34
     The reason for the irrelevance of the joint distribution of markups and sales shares in this lognormal
case is best understood using the decomposition Varλ (∆ log µ) = Eλ [Var(∆ log µ|λ)] + Varλ [E(∆ log µ|λ)].
Under joint log-normality, changes in the variance of sales or in its covariance with markups/wedges create
exactly-offsetting changes in Eλ [Var(µ|λ)] and Varλ [E(µ|λ)] up to the second order in the markups/wedges.
For example, increasing the covariance between sales and markups/wedges reduces the average variance
of markups/wedges given sales Eλ [Var(µ|λ)] but increases the variance of average markups given sales
Varλ [E(µ|λ)], but the two effects exactly offset each other up to the second order in the markups/wedges.



                                                    34
(2008), who do not assume log-normality, and who find that the correlation of wedges
and sales matters greatly for their results. See Appendix A for a worked out example.


5.2   Three Different Notions of Changes in Allocative Efficiency
In this section, we define and discuss different notions of changes in allocative efficiency
to the one defined in Section 7.2. We discuss their interpretations, differences, and con-
nections.


Definitions and Interpretation

In general, changes in allocative efficiency can defined relative to a benchmark alternative
allocation rule. For example, in Theorem 1, we defined changes in allocative efficiency
relative to the allocation of resources in the previous period:

                                     ∂ log Y           ∂ log Y
                         d log Y =           d log A +         dX .
                                     ∂ log A              ∂X
                                     |     {z      }   | {z }
                                         ∆Technology        ∆Allocative Efficiency


So, if resources are reallocated in such a way that they yield more output relative to
the previous period for given microeconomic technologies and factor supplies, then this
represents an improvement in the efficiency of the allocation relative to the previous
allocation matrix. We call this changes in allocative efficiency due to reallocation.
    However, other notions of changes in allocative efficiency can be defined relative
to other allocation rules. For example, one could also compute changes in allocative
efficiency relative to the allocation where wedges are kept constant:

                      ∂ log Y ∂ log Y ∂X                ∂ log Y ∂X
                     "                      #
           d log Y =          +               d log A +               d log µ .
                      ∂ log A    ∂X ∂ log A                ∂X ∂ log µ
                     |             {z               } |         {z          }
                                     ∆Technology                          ∆Allocative Efficiency

This notion, due to Osotimehin (2019), measures changes in the efficiency of the allocation
relative to the allocation where wedges are held constant, and may be called changes in
allocative efficiency due to changes in wedges.
    Finally, an alternative is to define allocative efficiency relative to the optimal allocation:

                           d log Y = d log Y∗ + d log Y − d log Y∗ ,
                                     | {z } |          {z       }
                                       ∆Technology      ∆Allocative Efficiency




                                                   35
where Y∗ is the efficient level of output. This notion goes back to Debreu (1951) and Farrell
(1957). We call this changes in allocative efficiency relative to the frontier, because it measures
changes in the efficiency of the allocation relative to the optimal allocation.
   These three different concepts of changes in allocative efficiency are all admissible.
Actually, they coincide when there are only changes in the wedges/markups.35 By contrast,
they typically differ when there are also changes in productivities. They then have different
economic interpretations based on different underlying counterfactuals and different data
requirements.


Differences in Results in a Simple Example

These three measures of changes in allocative efficiency may easily move in different
directions. To see how this could happen, consider a horizontal economy with two pro-
ducers and θ0 > 1. Suppose that µ1 > µ2 and A1 /µ1 < A2 /µ2 so that λ1 < 1/2 < λ2 .
Write µi = exp(∆ log µi ) and consider for simplicity the case of small markups/wedges
with ∆ log µi close to 0. Now suppose that the first producer receives a positive pro-
ductivity shock d log A1 > 0, but that A2 , µ1 , and µ2 remain unchanged. Allocative
efficiency due to reallocation (the first concept) increases by approximately λ1 λ2 (θ0 −
1)(∆ log µ1 − ∆ log µ2 ) d log A1 because workers are reallocated from the lower-markup
producer 2 to the higher-markup producer 1. Allocative efficiency due to changes in
wedges (the second concept) stays unchanged because markups/wedges do not change.
Allocative efficiency relative to the frontier (the third concept) decreases by approximately
(1/2)θ0 Varλ (∆ log µ)(1 − 2λ1 )(θ0 − 1) d log A1 because the sales-weighted dispersion of
markups increases.


Differences in Data Requirements

Other than answering different questions, these three different concepts also have dif-
ferent information requirements. The first and second concepts are both local notions
computing the effects of local changes along the equilibrium path. The third concept is
    35
       It follows from this observation that the first and second concepts can be used to compute the level of
the distance to the frontier. Take an economy with productivity vector A and markup vector µ. Consider
a transformation of each markup µ̂i (t) = (1 − t)µi + t. When t = 0, this transformation leaves markups as
they are. On the other hand, all distortions are eliminated at t = 1. The distance to the frontier is then the
integral along this path of changes in allocative efficiency due to reallocation/wedges:
                         1
                             ∂ log Y(A, X(A, µ̂(t))) d log µ̂(t)            1
                                                                                ∂ log Y(A, µ̂(t)) d log µ̂(t)
                    Z                                                   Z
               L=                                                dt =                                         d t.
                     0              ∂ log µ              dt             0           ∂ log µ           dt




                                                             36
a global notion comparing local changes in equilibrium output to changes in the glob-
ally efficient frontier.36 The first concept requires the least information: the network and
the markups/wedges. The second concept requires more information: the network, the
markups/wedges, and the elasticities. The third concept requires the most information:
not just the network, the markups/wedges, and the elasticities, but also the full global
nonlinear functional forms of the production and final demand functions. However, with
small markups/wedges, the full global nonlinear functional forms are not needed and
the network, markups/wedges, and elasticities are enough to approximate it. Given the
required information, all these notions can be computed using the results in Sections 2
(first concept) and 4 (second and third concepts).


6    Applying and Interpreting the Results
Before moving on to applications, we pause to discuss some implementation and inter-
pretation issues. Applying our formulas for inefficient economies requires more care than
when handling Hulten’s theorem for efficient economies. Over and above the difficulties
involved with reliably estimating wedges, there are three important issues that have to
be confronted: the identification of the factors of production, the level of aggregation of
the data, and the mapping of model wedges to the data frictions. We discuss these issues
in turn after reviewing data requirements. We also discuss how to account for issues like
endogenous wedges in interpreting our results.


Observability

The vector of final expenditure shares b and the revenue-based input-output matrix Ω are
directly observable from input-output data at the industry level and even sometimes even
at the firm-level using value-added tax data. The vector of revenue-based Domar weights
λ is observable even without input-output data. Unlike revenues, however, we do not
typically directly observe costs, and so the cost-based input-output matrix Ω̃ and the
vector of cost-based Domar weights λ̃ are not readily observable from input-output data.
Instead, these cost-based objects must be inferred from their observable revenue-based
counterparts using the vector of wedges µ:

                      Ω = (diag µ)−1 Ω̃,      Ψ̃ = (I − Ω̃)−1 ,   and    λ̃0 = b0 Ψ̃.
   36
      For growth accounting purposes, the first two concepts seem more natural since the change in aggregate
TFP along the equilibrium path measured by the traditional or distortion-adjusted Solow residual is also a
local notion.


                                                    37
Of course, this requires knowledge of the vector of wedges. These wedges can sometimes
be directly observed (taxes for example) or independently estimated (as in our markups
applications for example). Alternatively, the cost-based objects can be inferred from
elasticities of the production or cost function, if these objects can be directly estimated.


Identification of the Factors

One issue we have to confront when working with inefficient models is that we have
to identify the factors of production. For an efficient economy, we do not need to worry
about reallocation of resources, and hence we do not need to specifically identify and track
the changes in factor income shares. For an inefficient economy, we must take a stance on
this issue. The most challenging problem here is to identify “fixed” or quasi-fixed factors
of production – namely, those factors whose presence gives rise to decreasing returns to
scale for a producer, and whose factor payments need to be separated from pure profits.
    In other words, when the equilibrium is inefficient, we need to take a stance on whether
factors are “stuck” due to technological restrictions or market imperfections. In mapping
the model to the data, we need to choose whether two factors that receive a different
wage are being paid different wages due to frictions, or due to the fact that there are
technological differences between the factors. These are issues that we do not have to
confront when the equilibrium is efficient, since the consequences of reallocation are null
to the first order.


Data Aggregation Level

The second issue is the aggregation of the data before it reaches the researcher. Up to
a first-order approximation, efficient economies have a tremendously useful aggregation
property: for a common productivity shock A to a collection of producers S ⊂ {1, . . . , N},
the first order impact of the shock is given by d log Y/ d log A = i∈S λi . In other words, the
                                                                   P

total sales of all producers in S will yield the impact of an aggregate shock to all producers
in S.37 So, we only need to observe sales data at the level of disaggregation at which a
shock occurs.
    This aggregation property does not hold for distorted economies, even in the Cobb-
Douglas or acyclic cases where we do not need to account for changes in allocative
efficiency. Unlike sales, cost-based Domar weights λ̃ are not directly observable, and
instead need to be computed from input-output data at the level of disaggregation at
   37
     Baqaee and Farhi (2017) present an important caveat to this observation: this first-order approximation
can be highly unreliable in certain contexts.



                                                    38
which the wedges appear. If wedges apply at the firm or establishment level, then firm or
establishment-level input-output data is in general necessary, even if shocks are aggregate.
See Appendix J for a worked-out example.38 When we discuss quantitative and empirical
applications in Section 7, we return to how aggregation bias can affect our results.


Mapping Model Wedges to the Data Frictions

Throughout, we model distortions via wedges. The wedges act like linear taxes, the
revenues of which are rebated lump sum.39 Beyond actual taxes, these wedges can also
implicitly capture frictions preventing the reallocation of resources.
      In mapping our results to the data, we assume that expenditures by i on inputs from
j are recorded gross of the wedge τi j . This is an accounting convention which does not
change anything about the underlying allocation or real GDP. It is the natural convention
for markups where sales are recorded inclusive of markups, but for other distortions, it
might not coincide with the accounting convention for expenditures in the data. In that
case, the data must be converted into the format required by our theory.
      To make this point very clearly, consider two examples based on different modifications
of the horizontal economy in Section 2.4. The first example introduces three modifications
to capture an economy with financial frictions: the factor of production is capital K instead
of labor L; producers do not charge any markup; and producers incur a non-pecuniary
proportional cost δi ≥ 1 from using capital. The cost δi is a wedge which changes the cost of
capital perceived (but not paid) by producer i.40 To apply our formulas, the revenue-based
input-output matrix which would be observed would need to be adjusted as follows: for
each producer i, introduce a new fictitious producer φ(i) purchasing capital, selling it to
producer i, and charging a markup µφ(i) = δi ; take the expenditure share of i on φ(i) to be
1 = δ−1 i
          δi , which is the expenditure share δ−1
                                               i
                                                  of i on capital in the data reflated by a factor
δi ; take the expenditure share of φ(i) on capital to be equal to δ−1  i
                                                                         . The sales shares λi of
producer i is the same in the data and in the adjusted model. The capital share in the data
is also the same as in the adjusted model i λi δ−1
                                                P
                                                       i
                                                         ≤ 1. This is because in the data, the
   38
       In Section 7, we apply our results in the case of markups using firm-level data. Firms are grouped into
industries. We make the assumption that all firms within an industry have the same production function but
have heterogenous markups and productivities. Given this assumption, we can recover, using the structure
of the model, the input-output data at the firm level (which we do not observe) from the input-output data
at the industrial level and the joint distribution of markups and size at the firm level within an industry
(which we observe).
    39
       If the taxes were not rebated, then they would act as reductions in productivity since resources would
actually be destroyed, and hence the first welfare theorem and Hulten’s theorem would still apply.
    40
       In some cases, financial frictions take the form of credit constraints, in which case they have to be
interpreted as the Lagrange multipliers on the constraints in the individual firms’ cost minimization problem.



                                                     39
expenditure share on capital of producer i is recorded net of the wedge δi , and therefore
corresponds to the expenditure share on capital of producer φ(i) in the adjusted model.
     The second example introduces the following modification to capture an economy
with compensating differentials: producers do not charge any markup; and labor incurs
a non-pecuniary proportional cost δi when employed by producer i. The cost δi ≥ 1 is a
wedge which changes the cost of labor wi paid by producer i, with wi /w j = δi /δ j . To apply
our formulas, the revenue-based input-output matrix which would be observed would
need to be adjusted as follows: for each producer i, introduce a new fictitious producer
φ(i) purchasing labor, selling it to producer i, and charging a markup µφ(i) = δi ; take the
expenditure share of i on φ(i) to be 1, which is the expenditure share of i on labor in the
data; and take the expenditure share of φ(i) on labor to be δ−1   i
                                                                    . The sales shares λi of
producer i is the same in the data and in the adjusted model. But now the labor share in
the data i λi = 1 is not the same as in the adjusted model i λi δ−1
           P                                                   P
                                                                      i
                                                                        ≤ 1. This is because
in the data, the expenditure share on labor of producer i is recorded gross of the wedge
δi , and is therefore higher by a factor δi than the expenditure share on labor of producer
φ(i) in the adjusted model. The labor share in the data therefore needs to be deflated by a
factor ( i λi δ−1 )−1 ≥ 1.
         P
               i




7        Applications
In this section, we pursue some quantitative applications of our results, focusing on
markups as the source of inefficiency. These applications are proofs of concept for the
usefulness of the theoretical framework laid out above.
   In Section 7.1, we describe our data and its mapping to the theory. In Section 7.2,
we measure changes in allocative efficiency in the U.S. over time, and decompose the
distortion-adjusted Solow residual into changes in pure-technology and changes in al-
locative efficiency. In Section 7.3, we use our structural results to measure the distance to
the frontier in a version of the parametric model calibrated to match firm-level size and
markup data as well as industry-level input-output data.41
    41
     In Appendix L, we also use the structural model to estimate the amount of macroeconomic volatility
arising from microeconomic shocks. We find that markups materially affect the impact of microeconomic
productivity and markup shocks on output, both at the sector and at the firm level. They amplify some
shocks and attenuate others. Unlike a perfectly competitive model, shocks to industries and firms have
different effects on output, even controlling for size. Firm-level shocks trigger larger reallocations of
resources across producers than industry-level shocks (since firms are more substitutable). On the whole,
we find that output is more volatile than in a perfectly competitive model, especially with respect to
firm-level shocks.




                                                   40
7.1   Data
We apply our results to U.S. data assuming markups are the only wedges in the economy.
The details of how we clean and map the data to the model are in Appendix C. Here, we
give a brief account of how we proceed.
    To apply our formulas, we need a measure of the input shares and markup of each
producer. This data is not available at the firm level and so we are forced to make
compromises and rely on a large degree of imputation.
    We use the annual U.S. input-output data from the BEA, dropping the government,
noncomparable imports, and second-hand scrap industries. The dataset contains indus-
trial output and inputs from 1997 to 2015 with 66 industries. We also use sales and markup
data from publicly listed firms in Compustat. We assume that each firm produces a single
output. We explain below the different methods that we use to estimate markups for
Compustat firms.
    We make the following assumptions. Compustat firms are assigned to BEA industries.
The outputs of the different firms in a given industry are aggregated into an industry
bundle using a homothetic aggregator. The inputs used by firms and by households
are these industry bundles. All the firms in a given industry have the same production
functions up to Hicks-neutral productivity shifters. Finally, we assume that within each
industry, the sales-share-weighted distribution of markups and its transition matrix can
be extrapolated from Compustat. These assumptions imply that we can construct both
Ω and Ω̃ using industry-level input-output data from the BEA and firm-level data from
Compustat.
    With a slight abuse of notation, we denote industry variables with capital letters
(e.g. I) and firm-level variables with lower-case letters (e.g. i), where i ∈ I to means
firm i is in industry I. In the data, we observe: the industry-level sales shares λI and
input-output entries ΩIJ for industries I and J; the sales shares of the Compustat firms
i in industry I, which we rescale so that i∈I λi = λI ; and the markup µi of Compustat
                                             P

firm i (see below). We then compute: industry-level markups as µI = ( i∈I (λi /λI )µ−1      )−1 ;
                                                                             P
                                                                                          i
industry-level cost-based input-output matrix entries as Ω̃IJ = µI ΩIJ ; firm-level cost-based
input-output matrix entries as Ω̃ij = (λ j /λ J )Ω̃IJ when firms i and j belong to industries I
and J; and firm-level revenue-based input-output matrix entries as Ωij = µ−1    i
                                                                                  Ω̃ij .
    For the estimates of firm-level markups, we use three different measures: (1) the
user-cost approach (UC), (2) the production function estimation approach (PF), and (3)
the accounting profits approach (AP). Our benchmark estimates use the UC approach,
which we compute following Gutiérrez and Philippon (2016) and Gutierrez (2017). This
markup estimate relies on measuring each firm’s total costs and computing the markup

                                               41
by comparing total costs to sales. This method is also used by Foster et al. (2008), and (as
a robustness check) by De Loecker et al. (2019). Measuring total costs requires estimating
each firm’s user-cost of capital and capital stock. We compute the user-cost of capital in
the spirit of Hall and Jorgenson (1967) where the rental price takes into account, not just
the riskless rate and industry-specific depreciation, but also industry-level risk premia.
    The second measure comes from estimates of the production function similar to the
benchmark estimates from De Loecker et al. (2019) and following the methodology of
De Loecker and Warzynski (2012). These markups are given by the ratio of the elasticity
of the production function to a variable input (estimated at the industry-year level) to the
share of that input in revenues (estimated at the firm-year level). This measure bypasses
having to estimate a firm’s total costs by instead relying on the firm’s first-order condition
that equates the output elasticity with respect to a variable input to the expenditures on
that input as a share of costs (in our case, the variable input is the “cost of goods sold”).
    The last set of estimates are the accounting profits approach, where we assume that
operating income is equal to profits, and hence markups are equal to sales divided by
costs (sales minus profits). Although quite simplistic, this approach has the virtue of
requiring very little manipulation of the raw data and is similar to the method employed
by Harberger (1954). Since this accounting approach yields roughly similar conclusions
as the more sophisticated approaches, it suggests that firms’ reports of their operating
income (which is all the AC markups rely on) is the important source of the variation
across the different approaches.
    Each markup series comes with its own pros and cons. The UC markups require
industry-level estimates of the risk premium and depreciation, both of which are notori-
ously difficult to measure, and assumes that all inputs are flexible in production. The PF
markups on the other hand, rely on more parametric methods, and face tough identifi-
cation challenges. On the other hand, while the UC and AP markups capture “average”
markup margins (by stripping out expenses from revenues), the PF markups are designed
to capture markups at the margin (gaps between the expenditure shares and output elas-
ticities). For our empirical application, we maintain the assumption of constant returns, so
there is no theoretical reason to prefer one set of markups over another on these grounds.
    We use the UC markups for our benchmark numbers, and we report numbers for the
other two markup series in the tables and in Appendix A.42 Our hope is that by reporting
estimates using three different measures, we uncover patterns that are reasonably robust.
   42
      Note that our method allows for capital-biased technical change. In particular, we measure changes
in allocative efficiency independently of the nature of productivity shocks (Hicks neutral or factor biased).
For more details see the discussion in Section 6.



                                                     42
             0.08
                           Average
                           Within
                           Between
             0.06



             0.04



             0.02



             0.00



           −0.02
               1985          1990          1995         2000         2005         2010         2015

Figure 3: Decomposition of the increase in the average markup into a between and a
within effect, using the user-cost approach markup data. All the changes are cumulated
over time.


    The three markup series give different levels of markups: the UC markups are the
smallest (and average around 5%), the AP markups are higher (averaging around 10%),
and the PF markups are the largest (averaging around 16%).
    Despite their differences, all three markup series share some commonalities. Average
markups (as measured by the profit share) have been increasing over the sample for all
three series, as has been documented by Gutierrez (2017). More importantly for us, we
find that for all three series, this increase in the average markup is driven by compositional
effects. Namely, when we decompose changes in the average markup into a within-firm
effect and a between-firm effect, we find that the trend is overwhelmingly due to the
between effect. In other words, average markups are increasing mostly because high-
markup firms are getting larger on average, and not because firms are increasing their
markups on average. Figure 3 illustrates this decomposition for the UC markups.43 This
   43
      The average markup is computed as the harmonic sales-weighted average (λ̂0t µ−1     t )
                                                                                              −1
                                                                                                 of firm markups,
where the vector of weights λ̂t is proportional to the vector λt of firm sales shares, with the constant of
proportionality given by the inverse of the sum of the firm sales shares, so that the weights sum up to
one, and µt is the vector of firm markups. This is the correct way to aggregate markups to match the
aggregate profit share. The change in the average markup is computed as d log((λ̂0t µ−1     −1
                                                                                         t ) ). The contribution
of the within effect is (λ̂t µt d log µt )/(λ̂t µt ). The contribution of the between effect is the residual. For
                           0 −1               0 −1

the purposes of documentation, in this figure, we have rolled back the data to 1985 because these purely
statistical calculations do not require the input-output matrix, which we only have from 1997 onwards.


                                                       43
accords with the contemporaneous findings of Autor et al. (2019) and Vincent and Kehrig
(2019) who find a similar composition effect in firms’ labor shares. It has also been
corroborated by De Loecker et al. (2019), who find a similar pattern in U.S. markups. As
we shall see shortly, this composition effect has profound implications for the evolution
of aggregate TFP, since it implies positive contributions of changes in allocative efficiency
due to reallocation.


7.2   Decomposing Aggregate TFP Growth
In this section, we implement our growth accounting results to decompose the sources of
TFP growth as measured by the cumulated distortion-adjusted Solow residual in the U.S.
over the period 1997-2015, in the presence of these changing markups.
     Since we are interested in long-run trends, we assume that the only factors are labor
and capital, and we abstract away from barriers to reallocation of factors like adjustment
costs as well as from variable capacity utilization which matter more at business-cycle
frequencies.
     Conditional on markups and the input-output matrix at a given point in time t, we
calculate −Λ̃0t−1 ∆ log Λt from t − 1 to t using the change in observed factor income shares.
Then we can decompose aggregate TFP using Theorem 1. The results are plotted in Figure
4 using the UC markups. The red line (allocative efficiency) is measured as −λ̃0t−1 ∆ log µt −
Λ̃0t−1 ∆ log Λt , and the yellow line (pure technology) is the residual difference between the
red line and the distortion-adjusted Solow residual.
     Since the start of the sample, cumulated changes in allocative efficiency due to real-
location account for about 50% of aggregate TFP growth as measured by the cumulated
Solow residual. This implies that pure changes in technology, which are computed as a
residual, also account for about 50% of aggregate TFP growth.
     The fundamental intuition behind these large cumulated improvements in allocative
efficiency is that the increase over time in average markup is largely driven by a compo-
sition effect, whereby firms with high markups, which were too small to begin with have
been getting larger.
     In Figure 5, we repeat our exercise but instead using data that has been aggregated to
the industry-level. That is, we assume that each industry contains a representative firm
charging a markup equal to the harmonic industry average. In this case, the cumulated
contributions of changes in allocative efficiency due to reallocation are drastically reduced
and even flip signs. Basically, the compositional effects in Figure 3, and the reallocation
effects in Figure 4, have occurred across firms within industries and not across industries.


                                             44
          0.16
                     Disorted Solow Residual
                     Allocative Efficiency
          0.14       Technology


          0.12

          0.10

          0.08

          0.06

          0.04

          0.02

          0.00
             1996   1998   2000      2002      2004   2006   2008   2010   2012   2014

Figure 4: Cumulative decomposition of changes in aggregate TFP (distortion-adjusted
Solow residual) into pure changes in technology and changes in allocative efficiency
along the lines of equation (7), with markups obtained from the user-cost approach.
                     Disorted Solow Residual
                     Allocative Efficiency
          0.15       Technology




          0.10




          0.05




          0.00

            1996    1998   2000      2002      2004   2006   2008   2010   2012   2014

Figure 5: The same decomposition as in Figure 4 but the user-cost markup data was first
aggregated to the industry-level. In effect, this decomposition assumes that each industry
contains a representative firm (ruling out reallocations within the industry).


                                                 45
Once we aggregate up to the industry-level the pattern disappears, underscoring the
importance of disaggregation in inefficient economies, as discussed in Section 6.
    These patterns are also borne out when we use the PF and AP markups, although the
magnitudes are somewhat different (see Figures 7a- 6b in Appendix A). The contribution
of changes in allocative efficiency due to reallocation to aggregate TFP growth is large at
the firm level, and becomes negligible at the industry level. In Appendix B, we use the
Petrin and Levinsohn (2012) decomposition on the firm-level data and also find that it
vastly undermeasures the importance of reallocation effects.


7.3   Gains From Eliminating Markups
In this section, we calibrate a simplified version of the parametric model presented in
Section 4 and use our structural results to compute the gains to aggregate TFP from
eliminating markups. Our calculation in this section quantitatively illustrates the intuition
from Proposition 5, namely that accounting for intermediate inputs and higher elasticities
of substitution (say, across firms within an industry as opposed to across industries)
magnifies the losses from misallocation.
    To calibrate the model, we need estimates for industry-specific firm-level and industry-
level structural elasticities of substitution. Unfortunately, detailed disaggregated esti-
mates of these elasticities do not exist. We consider a nested CES structure where each
firm i in industry j produces using a CES aggregator of value-added and intermediate in-
puts with an elasticity of substitution θ. The value-added component is a CES aggregator
of labor and capital with an elasticity of substitution η. The intermediate input compo-
nent is a CES aggregator of inputs from other industries with an elasticity of substitution
ε .Finally, inputs purchased by firms in industry j from industry k are a CES aggregate of
all varieties in that industry with elasticity of substitution ξ.
    Following our previous work in Baqaee and Farhi (2017), and drawing on estimates
from Atalay (2017) and Boehm et al. (2014), we set θ = 0.5, θ0 = 0.9, and ε = 0.2. We set η =
1 which is a focal point in the literature about the micro-elasticity of substitution between
labor and capital. Finally, we set ξ = 8, which is within the range of estimates of the
variety-level elasticity of substitution from the industrial organization and international
trade literatures. We also experiment with ξ = 4, reflecting a lower elasticity of substitution
across firms within each industry.
    We use the calibrated model to approximate the gains to aggregate TFP from elimi-
nating markups following the result in Proposition 5. This corresponds to the sum of the
areas of the deadweight loss triangles in our general equilibrium model. The results are


                                              46
                    User Cost (UC) Accounting (AP) Production Function (PF)
           2015     13%            11%             25%
           1997     3%             5%              23%

   Table 1: Gains from eliminating markups for the beginning and end of our sample.


reported in Table 1.
    Using the benchmark UC markups, we find that eliminating markups, holding fixed
technology, would increase aggregate TFP by around 13%. The AP markups imply
somewhat smaller gains of 11% and the PF markups imply larger gains of 25%.
    Our estimate that eliminating markups in the U.S. economy in 2015 would increase
TFP by between 11% and 25% raises the estimated cost of monopoly distortions by two
orders of magnitude compared to the famous 0.1% estimate of Harberger (1954).44 The
reasons for this dramatic difference can be traced back to Proposition 5. First, we use
firm-level data, whereas Harberger only had access to sectoral data, and the dispersion of
markups is higher across firms within a sector than across sectors. Second, a key elasticity
of substitution is higher in our exercise than in Harberger’s since it applies across firms
within a sector rather than across sectors. Finally, we properly take into account the
input-output structure of the economy to aggregate the numbers in all industries whereas
Harberger only focused on manufacturing and did not offer a full treatment of input-
output linkages.
    Of course, both our estimate and Harberger’s are static, taking as given the level of
productivity in the economy. Markups may be playing an important role in incentivizing
innovation and entry, so that exogenously eliminating markups may harm productivity.
But even if markups do play an important role in incentivizing innovation, they also distort
the allocation of resources and our calculation shows that this effect is quantitatively large.
    Furthermore, like Harberger, we are interested in gains to aggregate TFP. With elastic
factor supplies, markups also depress factor supplies. Removing markups then increases
aggregate output not only by increasing aggregate TFP, as we have analyzed, but also by
stimulating factor supplies. We refer the reader to Appendix I for an extension of our
results allowing for elastic factor supplies.
    Interestingly, we find that the gains from reducing markups have increased substan-
tially since the start of the sample for all three series. For example, using our benchmark
   44
      Harberger’s result had a profound impact on the economics discipline by providing an argument for
de-emphasizing microeconomic inefficiencies in comparison to Keynesian macroeconomic inefficiencies.
This impact is perhaps best illustrated by Tobin’s famous quip that “it takes a heap of Harberger triangles
to fill an Okun gap”.



                                                    47
              Benchmark      CD + CES     ξ=4     Cobb-Douglas     No IO    Sectoral
        UC       13%           14%         8%         3%            5%       0.7%
        AP       11%           12%         6%         3%            5%        1%
        PF       25%           29%        14%         10%           14%       4%

Table 2: Gains in aggregate TFP from eliminating for different markup series and different
calibrations. The first column are the benchmark numbers in Table 1. The third column sets
all elasticities except ξ equal to one. The third column lowers the elasticity of substitution
ξ between firms within each industry. The fourth column sets all elasticities in the model
to be equal to one. The fifth column recalibrates the model using value-added production
functions, ignoring the input-output connections, similar to Hsieh and Klenow (2009).
The final column uses data aggregated to the sectoral level rather than firm-level similar
to Harberger (1954).


UC markups, we find that the gain from eliminating markups is 3% in 1997, much smaller
than the 13% in 2014. As we described in Section 5.2, this finding is entirely consistent
with our other finding that changes in allocative efficiency due to reallocation have con-
tributed positively to aggregate TFP growth since the start of the sample. Intuitively, the
distance to the frontier has increased because markups have become more dispersed over
time. By contrast, changes in allocative efficiency have contributed positively to measured
aggregate TFP growth because high-markup firms have been getting larger. The frontier
has shifted faster, resulting in a simultaneous increase in the distance to the frontier.
    In Table 2, we repeat the markup reduction exercise for some alternative specifications
of the structural model. The first column repeats the benchmark numbers from Table 1.
The second column considers a situation where all elasticities of substitution are set equal
to one except the one across firms within industries (which is kept at 8). The distance to
the frontier is not very sensitive to this change, which is in line with Proposition 5 since
most of the dispersion in markups is across firms within a sector and not across sectors or
factors, and since the change keeps the elasticities across industries and factors relatively
low (from values below one to one).
    The third column shows the gains implied by a much lower elasticity of substitution
across firms within industries ξ = 4 rather than ξ = 8. Halving this elasticity more or less
halves the losses from misallocation, which is in line with Proposition 5 since most of the
dispersion between markups is across firm within industries.
    The fourth column shows the gains implied by a Cobb-Douglas specification of the
model which imposes that all elasticities of substitution are equal to 1, including those
across firms within industries. This model conforms to the assumption in Harberger (1954)
that all demand curves are unit elastic, though we use a more detailed model with multiple


                                             48
factors, intermediate inputs, and disaggregated at the firm level. Once again, moving to
the Cobb-Douglas specification significantly reduces the losses from misallocation.
    The fifth column shows the gains implied by using value-added production functions
which ignore the role of the production network. We find that working with value-added
productions can cut the estimated gains from reducing markups by more than half, which
is in line with Proposition 5 given that the distance to the frontier scales in both the sales
shares and the Leontief inverse. Value-added production functions are commonly used in
the literature on misallocation, and our results suggest that relying on this simplification
can substantively reduce the gains from eliminating distortions.
    Finally, the last column shows the losses from using a sectoral version of the model
— one which aggregates each industry to contain a single firm charging a markup equal
to the harmonic average of markups in that industry. This model is similar to the one
used by Harberger (1954), although we stray from his unit-elastic demand assumption,
model the whole economy rather than just manufacturing, and properly take input-output
linkages into account. But at any rate, as expected, the numbers in this case are much
smaller, and not drastically dissimilar to Harberger’s 0.1% estimate. All in all, Table 2
shows the importance of modeling micro-level heterogeneity, the input-output network,
and realistic elasticities when using structural models to measure economic waste.


8    Robustness and Extensions
In Appendix I, we extend our results to address some limitations. We discuss, and in
some cases fully characterize, how our basic framework can be adapted to handle the
following complications: arbitrary non-CES production functions, elastic factor supplies,
capital accumulation, adjustment costs, variable capacity utilization, and nonlinearities.
All these issues introduce additional forces into the model, and we plan to squarely focus
on these in future work. However, these discussions show that the intuitions gleaned from
the basic framework continue to be useful in analyzing these more complex scenarios.


9    Conclusion
We provide a non-parametric framework for analyzing and aggregating productivity and
wedge shocks in a general equilibrium economy with arbitrary neoclassical production.
We show how, locally, the impact of a shock can be decomposed into a pure technology
effect and an allocative efficiency effect. We also show how to compute the distance to


                                             49
the efficient frontier. Although our results are comparative statics that take productivity
and markups as exogenous, they can be used, in conjunction with the chain rule, to study
models where productivity or markups are themselves endogenous.
   We apply our findings to the firm-level markups in the U.S.. We find that from 1997-
2015, allocative efficiency in the U.S. accounts for about 50% of aggregate TFP growth.
We also find that the gains from reducing markups have increased since 1997, and that
eliminating markups would increase aggregate TFP by around 15%. These numbers are
two orders of magnitude higher than classic estimates like those of Harberger (1954).


References
Asker, J., A. Collard-Wexler, and J. De Loecker (2019). (mis) allocation, market power, and
 global oil extraction. American Economic Review 109(4), 1568–1615.

Atalay, E. (2017). How important are sectoral shocks? American Economic Journal: Macroe-
  conomics (Forthcoming).

Atkeson, A. and A. Burstein (2008). Pricing-to-market, trade costs, and international
  relative prices. American Economic Review 98(5), 1998–2031.

Autor, D., D. Dorn, L. Katz, C. Patterson, and J. Van Reenen (2019). The fall of the labor
 share and the rise of superstar firms.

Baily, M. N., C. Hulten, and D. Campbell (1992). Productivity Dynamics in Manufacturing
  Plants. Brookings Papers on Economic Activity 23(1992 Micr), 187–267.

Baqaee, D. R. (2016). Cascading failures in production networks.

Baqaee, D. R. and E. Farhi (2017). The macroeconomic impact of microeconomic shocks:
  Beyond Hulten’s Theorem.

Baqaee, D. R. and E. Farhi (2018). Macroeconomics with heterogeneous agents and input-
  output networks. Technical report, National Bureau of Economic Research.

Baqaee, D. R. and E. Farhi (2019a). Aggregating with Scale: Entry, Exit, and Selection.
  Working paper, Harvard.

Baqaee, D. R. and E. Farhi (2019b). Networks, Barriers, and Trade. Technical report.

Barkai, S. (2019). Declining labor and capital shares.


                                            50
Bartelsman, E., J. Haltiwanger, and S. Scarpetta (2013, February). Cross-Country Dif-
  ferences in Productivity: The Role of Allocation and Selection. American Economic
  Review 103(1), 305–334.

Basu, S. (1995). Intermediate goods and business cycles: Implications for productivity
  and welfare. The American Economic Review, 512–531.

Basu, S. and J. G. Fernald (2002). Aggregate productivity and aggregate technology.
  European Economic Review 46(6), 963–991.

Bigio, S. and J. La’O (2019). Financial frictions in production networks. Technical report.

Boehm, C., A. Flaaen, and N. Pandalai-Nayar (2014). Complementarities in multinational
  production and business cycle dynamics. Technical report, Working paper, University
  of Michigan.

Bouakez, H., E. Cardia, and F. J. Ruge-Murcia (2009). The transmission of monetary policy
  in a multisector economy. International Economic Review 50(4), 1243–1266.

Caballero, R. J., E. Farhi, and P.-O. Gourinchas (2017, May). Rents, technical change, and
  risk premia accounting for secular trends in interest rates, returns on capital, earning
  yields, and factor shares. American Economic Review 107(5), 614–20.

Chetty, R., A. Guren, D. Manoli, and A. Weber (2011). Are micro and macro labor supply
 elasticities consistent? a review of evidence on the intensive and extensive margins. The
 American Economic Review 101(3), 471–475.

De Loecker, J., J. Eeckhout, and G. Unger (2019). The rise of market power and the
 macroeconomic implications. Technical report, National Bureau of Economic Research.

De Loecker, J. and F. Warzynski (2012). Markups and firm-level export status. The American
 Economic Review 102(6), 2437–2471.

Debreu, G. (1951). The coefficient of resource utilization. Econometrica: Journal of the
 Econometric Society, 273–292.

Domar, E. D. (1961). On the measurement of technological change. The Economic Jour-
 nal 71(284), 709–729.

Edmond, C., V. Midrigan, and D. Y. Xu (2018). How costly are markups? Technical report,
  National Bureau of Economic Research.


                                            51
Elsby, M. W., B. Hobijn, and A. Şahin (2013). The decline of the us labor share. Brookings
  Papers on Economic Activity 2013(2), 1–63.

Farhi, E. and F. Gourio (2018). Accounting for macro-finance trends: Market power,
  intangibles, and risk premia. Technical report, National Bureau of Economic Research.

Farrell, M. J. (1957). The measurement of productive efficiency. Journal of the Royal Statistical
  Society: Series A (General) 120(3), 253–281.

Foster, L., J. Haltiwanger, and C. Syverson (2008). Reallocation, firm turnover, and ef-
  ficiency: Selection on productivity or profitability? American Economic Review 98(1),
  394–425.

Foster, L., J. C. Haltiwanger, and C. J. Krizan (2001, September). Aggregate Productivity
  Growth: Lessons from Microeconomic Evidence. In New Developments in Productivity
  Analysis, NBER Chapters, pp. 303–372. National Bureau of Economic Research, Inc.

Galı́, J. (2008). Monetary policy, inflation, and the business cycle: An introduction to the
 New Keynesian Framework.

Gollop, F. M., B. M. Fraumeni, and D. W. Jorgenson (1987). Productivity and us economic
 growth.

Gopinath, G. and O. Itskhoki (2010). Frequency of price adjustment and pass-through.
 The Quarterly Journal of Economics 125(2), 675–727.

Gopinath, G. and O. Itskhoki (2011). In search of real rigidities. NBER Macroeconomics
 Annual 25(1), 261–310.

Grassi, B. (2017). IO in I-O: Competition and volatility in input-output networks. Technical
  report.

Griliches, Z. and H. Regev (1995, January). Firm productivity in Israeli industry 1979-1988.
  Journal of Econometrics 65(1), 175–203.

Gutierrez, G. (2017). Investigating global labor and profit shares.

Gutiérrez, G. and T. Philippon (2016). Investment-less growth: An empirical investigation.
 Technical report, National Bureau of Economic Research.

Hall, R. E. (1988). The relation between price and marginal cost in us industry. Journal of
 political Economy 96(5), 921–947.

                                               52
Hall, R. E. (1990). Growth/ Productivity/Unemployment: Essays to Celebrate Bob Solow’s Birth-
 day, Chapter 5, pp. 71–112. MIT Press.

Hall, R. E. and D. W. Jorgenson (1967). Tax policy and investment behavior. American
 economic review 57(3), 391–414.

Harberger, A. C. (1954). Monopoly and resource allocation. In American Economic Associ-
 ation, Papers and Proceedings, Volume 44, pp. 77–87.

Hsieh, C.-T. and P. J. Klenow (2009). Misallocation and manufacturing TFP in China and
 India. The quarterly journal of economics 124(4), 1403–1448.

Hulten, C. R. (1978). Growth accounting with intermediate inputs. The Review of Economic
 Studies, 511–518.

Jones, C. I. (2013). Input-Output economics. In Advances in Economics and Econometrics:
  Tenth World Congress, Volume 2, pp. 419. Cambridge University Press.

Kimball, M. S. (1995). The quantitative analytics of the basic neomonetarist model. Journal
  of Money, Credit, and Banking 27(4).

Koh, D., R. Santaeulàlia-Llopis, and Y. Zheng (2019). Labor share decline and intellectual
 property products capital.

Liu, E. (2019). Industrial policies and economic development. Technical report.

McKenzie, L. W. (1959). On the existence of general equilibrium for a competitive market.
 Econometrica: journal of the Econometric Society, 54–71.

Nakamura, E. and J. Steinsson (2010). Monetary non-neutrality in a multisector menu cost
 model. The Quarterly journal of economics 125(3), 961–1013.

Olley, G. S. and A. Pakes (1996, November). The Dynamics of Productivity in the Telecom-
  munications Equipment Industry. Econometrica 64(6), 1263–1297.

Osotimehin, S. (2019, April). Aggregate productivity and the allocation of resources over
 the business cycle. Review of Economic Dynamics 32, 180–205.

Osotimehin, S. and L. Popov (2018). Misallocation and intersectoral linkages. Technical
 report.

Pasten, E., R. Schoenle, and M. Weber (2016). The propagation of monetary policy shocks
  in a heterogeneous production economy.

                                             53
Pasten, E., R. Schoenle, and M. Weber (2017). Price rigidity and the granular origin of
  aggregate fluctuations.

Petrin, A. and J. Levinsohn (2012). Measuring aggregate productivity growth using plant-
  level data. The RAND Journal of Economics 43(4), 705–725.

Restuccia, D. and R. Rogerson (2008). Policy distortions and aggregate productivity with
  heterogeneous establishments. Review of Economic dynamics 11(4), 707–720.

Rognlie, M. (2016). Deciphering the fall and rise in the net capital share: accumulation or
  scarcity? Brookings papers on economic activity 2015(1), 1–69.

Solow, R. M. (1957). Technical change and the aggregate production function. The review
  of Economics and Statistics, 312–320.

Vincent, N. and M. Kehrig (2019). The Micro-Level Anatomy of the Labor Share Decline.
  Nber working papers, National Bureau of Economic Research, Inc.




                                            54
Appendix A                                Additional Figures

0.25
            Disorted Solow Residual
                                                                                                  Disorted Solow Residual
            Allocative Efficiency
                                                                                       0.30       Allocative Efficiency
            Technology
                                                                                                  Technology
0.20


                                                                                       0.20
0.15


                                                                                       0.10
0.10



0.05                                                                                   0.00



0.00                                                                                  −0.10
   1996    1998    2000     2002       2004   2006   2008   2010   2012   2014            1996   1998   2000      2002      2004   2006   2008   2010   2012   2014

                             (a) Firm Level                                                                   (b) Sectoral Level

Figure 6: Cumulative decomposition of changes in aggregate TFP into pure changes in
technology and changes in allocative efficiency following equation (7), with markups
obtained from the production-function approach, at the firm level (left panel) and at the
sectoral level (right panel).


 0.20                                                                                  0.25
             Disorted Solow Residual                                                              Disorted Solow Residual
             Allocative Efficiency                                                                Allocative Efficiency
             Technology                                                                           Technology
                                                                                       0.20
 0.15

                                                                                       0.15
 0.10

                                                                                       0.10

 0.05
                                                                                       0.05

 0.00
                                                                                       0.00


−0.05                                                                                 −0.05
    1996    1998    2000     2002      2004   2006   2008   2010   2012   2014            1996   1998   2000      2002      2004   2006   2008   2010   2012   2014

                             (a) Firm Level                                                                   (b) Sectoral Level

Figure 7: Cumulative decomposition of changes in aggregate TFP into pure changes in
technology and changes in allocative efficiency following equation (7), with markups
obtained from the accounting profits approach, at the firm level (left panel) and at the
sectoral level (right panel).




                                                                                 55
                    Online Appendix to
         Productivity and Misallocation in General
                        Equilibrium

                     David Rezza Baqaee                   Emmanuel Farhi

                                        October 19, 2020




   ∗
     Emails: baqaee@econ.ucla.edu, efarhi@harvard.edu. We thank Philippe Aghion, Pol Antras, Andrew
Atkeson, Susanto Basu, John Geanakoplos, Ben Golub, Gita Gopinath, Dale Jorgenson, Marc Melitz, Ben
Moll, Matthew Shapiro, Dan Trefler, Venky Venkateswaran and Jaume Ventura for their valuable comments.
We are especially grateful to Natalie Bau for detailed conversations. We thank German Gutierrez, Thomas
Philippon, Jan De Loecker, and Jan Eeckhout for sharing their data. We thank Thomas Brzustowski and
Maria Voronina for excellent research assistance.


                                                  56
B Empirical Comparison with Petrin-Levinsohn                                                              58

C Data                                                                                     59
  C.1 Input-Output and Aggregate Data . . . . . . . . . . . . . . . . . . . . . . . . 59
  C.2 Estimates of Markups . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 60

D Proofs                                                                                                  63

E Nominal Rigidities                                                                                      70

F Basu-Fernald and Petrin-Levinsohn in a Simple Example                                                   79

G Applying our Results with Endogenous Markups in a Simple Example                                        80

H Standard-Form for Nested CES Economies                                                                  82

I   Robustness and Extensions                                                                             83
    I.1 Beyond CES . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .    .   .   .   .   .   84
    I.2 Elastic Factor Supplies . . . . . . . . . . . . . . . . . . . . . . . . . .   .   .   .   .   .   85
    I.3 Capital Accumulation, Adjustment Costs, and Capacity Utilization              .   .   .   .   .   86
    I.4 Nonlinear Impact of Shocks and Duality with Industry Structure .              .   .   .   .   .   87

J   Aggregation of Cost-Based Domar Weights                                                               91

K Extra Examples                                                                                          92

L Volatility of Aggregate TFP                                                                             95




                                               57
Appendix B           Empirical Comparison with Petrin-Levinsohn
Figure 8 constructs the Petrin-Levinsohn decomposition with markups obtained from the
production-function approach, at the firm level. The factor-growth-miscounting term is
introduced to correct for the fact that the Petrin-Levinsohn decomposition applies to the
Solow residual, whereas ours applies to the distortion-adjusted Solow residual, where
both residuals weigh the growth of each factor differently. It does not affect the pure
technology and changes in allocative efficiency effects constructed using their procedure.
    Figures 6a and 8 allow us to compare the different results that are obtained using our
decomposition and the Petrin-Levinsohn decomposition. Compared to ours, the Petrin-
Levinsohn decomposition finds lower contributions both for pure technology and for
allocative efficiency. The different weights used to weigh labor and capital growth in the
Solow residual vs. the distortion-adjusted Solow also lead to a sizable difference between
the Solow residual and the distortion-adjusted Solow residual. The cumulated Solow
residual is significantly lower than the cumulated distortion-adjusted Solow residual, and
this is reflected in a sizable positive contribution of factor-growth miscounting.

                      Distorted Solow Residual
                      Allocative Efficiency a la PL
          0.20        Technology a la PL
                      Reweighting of Factor Growth




          0.10




          0.00




         −0.10


             1996   1998     2000     2002      2004       2006   2008   2010   2012   2014

Figure 8: Petrin-Levinsohn decomposition of changes in aggregate TFP into pure changes
in technology, changes in allocative efficiency, and factor under-counting, with markups
obtained from the production-function approach, at the firm level.




                                                      58
Appendix C                 Data
We have two principal datasources: (i) aggregate data from the BEA, including the input-
output tables and the national income and product accounts; (ii) firm-level data from
Compustat. Below we describe how we treat the input-output data, merge it with firm-
level estimates of markups, and how we estimate markups at the firm-level.


C.1       Input-Output and Aggregate Data
Our measure of real GDP growth, and growth in real factor quantities (labor and capi-
tal) come from the San Francisco Federal Reserve’s dataset on total factor productivity.1
Specifically, we use the variable “dY” for real GDP growth, “dK” for real capital growth,
and “dLQ+dhours” for labor input growth.
    Our input-output data comes from the BEA’s annual input-output tables. We calibrate
the data to the use tables from 1997-2015 before redefinitions. We also ignore the dis-
tinction between commodities and industries, assuming that each industry produces one
commodity. For each year, this gives us the revenue-based expenditure share matrix Ω as
well as the final demand budget shares b. We drop the government, scrap, and noncom-
parable imports sectors from our dataset, leaving us with 66 industries. We define the
gross-operating surplus of each industry to be the residual from sales minus intermediate
input costs and compensation of employees. The expenditures on capital, at the industry
level, are equal to the gross operating surplus minus the share of profits (how we calculate
the profit share is described shortly). If this number is negative, we set it equal to zero. If
any value in Ω is negative, we set it to zero.
    We have three sources of markup data. For each markup series, we compute the profit
share (amongst Compustat firms) for each industry and year, and then we use that profit
share to separate payments to capital from gross operating surplus in the BEA data for that
industry and year. Conditional on the harmonic average of markups in each industry-
year, we can recover the cost-based Ω̃ = µΩ. If for an industry and year we do not observe
any Compustat firms, then we assume that the profit share (and the average markup) of
that industry is equal to the aggregate profit share (and the industry-level markup is the
same as the aggregate markup).
    We assume that the economy has an industry structure along the lines of Appendix
I.4, so that all producers in each industry have the same production function up to a
Hicks-neutral productivity shifter. This means that for each producer i and j in the same
   1
       Available at https://www.frbsf.org/economic-research/indicators-data/total-factor-productivity-tfp/



                                                      59
industry Ω̃ik = Ω̃ jk . To populate each industry with individual firms, we divide the sales
of each industry across the firms in Compustat according to the sales share of these firms
in Compustat. In other words, if some firm i’s markup is µi and share of industry sales in
Compustat is x, then we assume that the mass of firms in that industry whose markups
are equal to µi is also equal to x. These assumptions allow us to use the markup data
and market share information from Compustat, and the industry-level IO matrix from the
BEA, to construct the firm-level cost-based IO matrix.


C.2     Estimates of Markups
Now, we briefly describe how our firm-level markup data is constructed. Firm-level
data is from Compustat, which includes all public firms in the U.S. The database covers
1950 to 2016, but we restrict ourselves to post-1997 data since that is the start of the
annual BEA data. We exclude firm-year observations with assets less than 10 million,
with negative book or market value, or with missing year, assets, or book liabilities. We
exclude firms with BEA code 999 because there is no BEA depreciation available for them;
and Financials (SIC codes 6000-6999 or NAICS3 codes 520-525). Firms are mapped to
BEA industry segments using ‘Level 3’ NAICS codes, according to the correspondence
tables provided by the BEA. When NAICS codes are not available, firms are mapped to
the most common NAICS category among those firms that share the same SIC code and
have NAICS codes available.


C.2.1   Accounting Profits Approach

For the accounting-profit approach markups, we use operating income before deprecia-
tion, minus depreciation to arrive at accounting profits. Our measure of depreciation is the
industry-level depreciation rate from the BEA’s investment series. The BEA depreciation
rates are better than the Compustat depreciation measures since accounting rules and tax
incentives incentivize firms to depreciate assets too quickly. We use the expression
                                                      !
                                                   1
                                  pro f itsi = 1 −      salesi ,
                                                   µi

to back out the markups for each firm in each year. We winsorize markups and changes
in markups at the 5-95th percentile by year. Intuitively, this is equivalent to assuming that
the cost of capital is simply the depreciation rate (equivalently, the risk-adjusted rate of
return on capital is zero).



                                               60
C.2.2   User Cost Approach

The user-cost approach markups are similar to the accounting profits but require a more
careful accounting for the user cost of capital. For this measure, we rely on the replication
files from Gutiérrez and Philippon (2016) provided German Gutierrez. For more informa-
tion see Gutiérrez and Philippon (2016). To recover markups, we assume that operating
surplus of each firm is equal to payments to both capital as well as economic rents due to
markups. We write                                           !
                                                         1
                               OSi,t = rki ,t Ki,t + 1 −      salesi,t ,
                                                         µi
where OSi,t is the operating income of the firm after depreciation and minus income taxes,
rki ,t is the user-cost of capital and Ki,t is the quantity of capital used by firm i in industry
j in period t. This equation uses the fact that each firm has constant-returns to scale. In
other words,                                               !
                                    OSi,t                1 salesi,t
                                          = rki ,t + 1 −            ,                        (21)
                                     Ki,t                µi Ki,t
To solve for the markup, we need to account for both the user cost (rental rate) of capital
as well as the quantity of capital. The user-cost of capital is given by

                              rki ,t = rst + KRP j − (1 − δki ,t )E(Πkt+1 ),

where rst is the risk-free real rate, KPR j is the industry-level capital risk premium, δ j is the
industry-level BEA depreciation rate, and E(Πkt+1 ) is the expected growth in the relative
price of capital. We assume that expected quantities are equal to the realized ones. To
calculate the user-cost, the risk-free real rate is the yield on 10-year TIPS starting in 2003.
Prior to 2003, we use the average spread between nominal and TIPS bonds to deduce the
real rate from nominal bonds prior to 2003. KRP is computed using industry-level equity
risk premia following Claus and Thomas (2001) using analyst forecasts of earnings from
IBES and using current book value and the average industry payout ratio to forecast future
book value. The depreciation rate is taken from BEA’s industry-level depreciation rates.
The capital gains E(Πkt+1 ) is equal to the growth in the relative price of capital computed
from the industry-specific investment price index relative to the PCE deflator. Finally, we
use net property, plant, and equipment as the measure of the capital stock. This allows us
to solve equation (21) for a time-varying firm-level measure of the markup. We winsorize
markups and changes in markups at the 5-95th percentile by year.




                                                   61
C.2.3   Production Function Estimation Approach

For the production function estimation approach markups, we follow the procedure PF1
described by De Loecker et al. (2019) with some minor differences. We estimate the
production function using Olley and Pakes (1996) rather than Levinsohn and Petrin (2003).
We use CAPX as the instrument and COGS as a variable input. We use the classification
based on SIC numbers instead of NAICS numbers since they are available for a larger
fraction of the sample. Finally, we exclude firms with COGS-to-sales and XSGA-to-sales
ratios in the top and bottom 2.5% of the corresponding year-specific distributions. As
with the other series, we use Compustat excluding all firms that did not report SIC or
NAICS indicators, and all firms with missing sales or COGS. Sales and COGS are deflated
using the gross output price indices from KLEMS sector-level data. CAPX and PPEGT –
using the capital price indices from the same source. Industry classification used in the
estimation is based on the 2-digit codes whenever possible, and 1-digit codes if there are
fewer than 500 observations for each industry and year.
    To compute the PF Markups, we need to estimate elasticity of output with respect
to variable inputs. This is because once we know the output-elasticity with respect to a
variable input (in this case, the cost of goods sold or COGS), then following Hall (1988),
the markup is
                                       ∂ log Fi /∂ log COGSi
                                  µi =                       ,
                                              Ωi,COGS
where Ωi,COGS is the firm’s expenditures on COGS relative to its turnover.
   The output-elasticities are estimated using Olley and Pakes (1996) methodology with
the correction advocated by Ackerberg et al. (2015). To implement Olley-Pakes in Stata,
we use the prodest Stata package. OP estimation requires:

  (i) outcome variable: log sales,

 (ii) ”free” variable (variable inputs): log COGS,

(iii) ”state” variable: log capital stock, measured as log PPEGT in the Compustat data,

 (iv) ”proxy” variable, used as an instrument for productivity: log investment, measured
      as log CAPX in Compustat data.

 (v) in addition, SIC 3-digit and SIC 4-digit firm sales shares were used to control for
     markups .

   Given these data, we run the estimation procedure for every sector and every year.
Since panel data are required, we use 3-year rolling windows so that the elasticity estimates

                                             62
based on data in years t − 1, t and t + 1 are assigned to year t. The estimation procedure
has two stages: in the first stage, log sales are regressed on the 3-rd degree polynomial
of state, free, proxy and control variables in order to remove the measurement error and
unanticipated shocks; in the second stage, we estimate elasticities of output with respect
to variable inputs and the state variable by fitting an AR(1) process for productivity to
the data (via GMM). Just like in De Loecker et al. (2019), we control for markups using a
linear function of firm sales shares (sales share at the 4-digit industry level).
    We use a Cobb-Douglas specification of industry production functions because of its
simplicity and stability. This means that to be entirely internally consistent, in our struc-
tural counterfactual exercise regarding the effect of removing markups on aggregate TFP,
we should focus on specifications with unitary elasticities across industries and factors.
For example, the benchmark should now be the CD+CES specification in the second col-
umn of Table 2 instead of that in the first column. Imposing elasticities across industries
and factors would only introduce minor quantitative differences as we navigate through
the other columns, and would not change the corresponding quantitative conclusions
much.


Appendix D             Proofs
Throughout this appendix, we let the nominal GDP be the numeraire, so that PY =
PN                                       PN
   i=1 pi ci = 1 or equivalently d log( i=1 pi ci ) = 0. This numeraire is different from the GDP
deflator defined such that the ideal price index of the household is unitary P = 1, or
equivalently d log P = N     i=1 bi d log pi = 0. A price pi in the nominal GDP numeraire can
                           P

easily be converted into a price pi Y in the GDP deflator numeraire, so that d log(pi Y) =
d log pi + d log Y.

Proof of Theorem 1. We start by proving some preliminary results. Let Ω̃p be the N × N
matrix corresponding to the first N rows and columns (corresponding to goods prices)
                 p      p
of Ω̃, so that Ω̃ij = Ω̃ij for (i, j) ∈ [1, N]2 . Since Ω̃ is block-diagonal over goods prices and
factor prices, we have that for all (i, j) ∈ [1, N]2 ,

                               [(I − Ω̃p )−1 ]i j = [(I − Ω̃)−1 ]ij = Ψ̃ij .                 (22)

In addition, using
                                            N
                                            X                F
                                                             X
                                       1=          Ω̃i j +          Ω̃i f ,                  (23)
                                             j=1             f =1




                                                     63
which we can rewrite as
                                            1p = Ω̃p 1p + Ω̃1 f ,                                             (24)

where 1p is a N × 1 vector of ones and 1 f is a F × 1 vector of ones. This in turn implies that

                                           1p = (I − Ω̃p )−1 Ω̃1 f ,                                          (25)

and hence
                                                 1p = Ψ̃1 f ,                                                 (26)

                                                1 = b0 Ψ̃1 f ,                                                (27)

and finally, using
                                                 b0 Ψ̃ = λ̃0 ,                                                (28)

we get
                                                     F
                                                     X
                                                1=           Λ̃ f .                                           (29)
                                                      f =1

   We now move on to the main proof. By Sheppard’s lemma, we have

                                                       N
                                                       X                           F
                                                                                   X
                 d log pi = −d log Ai + d log µi +             Ω̃i j d log p j +          Ω̃i f d log w f .   (30)
                                                       j=1                         f =1


In the nominal GDP numeraire where pi ci = 1, we have w f L f = Λ f . Since we hold factor
                                   P

supplies fixed, we have
                               d log w f = d log Λ f .                                (31)

This implies that

                                                       N
                                                       X                           F
                                                                                   X
                 d log pi = −d log Ai + d log µi +            Ω̃i j d log p j +           Ω̃i f d log Λ f .   (32)
                                                       j=1                         f =1


We can rewrite this as
                N
                X                                             F X
                                                              X N
   d log pi =     [(I − Ω̃p )−1 ]ik (−d log Ak + d log µk ) +     [(I − Ω̃p )−1 ]ik Ω̃k f d log Λ f .         (33)
                k=1                                                   f =1 k=1




                                                     64
This implies that

                            N
                            X                                                F X
                                                                             X N
               d log pi =         Ψ̃ik (−d log Ak + d log µk ) +                        Ψ̃ik Ω̃k f d log Λ f .   (34)
                            k=1                                              f =1 k=1


This in turn implies that

                                  N
                                  X                                              F
                                                                                 X
                     d log pi =          Ψ̃ik (−d log Ak + d log µk ) +                 Ψ̃i f d log Λ f .        (35)
                                   k=1                                           f =1


This can be rewritten in vector form as
                                N
                                X                                               F
                                                                                X
                    d log p =           Ψ̃(k) (−d log Ak + d log µk ) +                 Ψ̃( f ) d log Λ f ,      (36)
                                  k=1                                            f =1


where Ψ̃(k) and Ψ̃( f ) are the k-th and f -th columns of Ψ̃, respectively. Since

                                                                       N
                                                                       X
                                  d log Y = −b d log p = −
                                                   0
                                                                             bi d log pi ,                       (37)
                                                                       i=1


and since
                                                       b0 Ψ̃ = λ̃0 ,                                             (38)

we get finally get

                                  N
                                  X                       N
                                                          X                       F
                                                                                  X
                    d log Y =            λ̃k d log Ak −         λ̃k d log µk −            Λ̃ f d log Λ f .       (39)
                                  k=1                     k=1                      f =1


which proves Theorem 1.
                                                                                                                   

Proofs of Propositions 2 and 3. We have
                                                                                        
                                           1                       X                   
                  dΩ ji = −Ω ji d log µ j − (θ j − 1) d log pi −   Ω̃ jl d log pl  .                     (40)
                                           µj
                                                                                    l


or equivalently
                                                         1
                        dΩ ji = −Ω ji d log µ j −           (θ j − 1)CovΩ̃( j) (d log p, I(i) ),                 (41)
                                                         µj



                                                           65
where I(i) is the ith column of the identity matrix I. Using
                                             X                                X                          X
                             d log p = −               Ψ̃(k) d log Ak +               Ψ̃(k) d log µk +           Ψ̃( f ) d log Λ f ,       (42)
                                               k                              k                          f


we can rewrite this as

                                       1                     X                  X                  X
dΩ ji = −Ω ji d log µ j +                 (θ j −1)CovΩ̃( j) (  Ψ̃(k) d log Ak −   Ψ̃(k) d log µk −   Ψ̃(g) d log Λ g , I(i) ),
                                       µj                                                          g
                                                                          k                     k
                                                                                                                                           (43)
Using Ψ = (I − Ω) , we get        −1

                                                                          dΨ = ΨdΩΨ.                                                       (44)

Combining, we get
                     X                          X
  dΨmn = −                    Ψmj d log µ j                    Ω ji Ψin
                         j                             i
      X Ψmj                             X                  X                  X                   X
  +                  (θ j − 1)CovΩ̃(j) (  Ψ̃(k) d log Ak −   Ψ̃(k) d log µk −   Ψ̃(g) d log Λ g ,   I(i) Ψin ).
        j
                µj                                                                                           g                         i
                                                   k                              k

                                                                                                                                           (45)

Using ΩΨ = Ψ − I, we can re-express this as
                     X
  dΨmn = −                    Ψmj (Ψ jn − δ jn )d log µ j
                         j
        X Ψmj                                X                  X                  X
    +                    (θ j − 1)CovΩ̃( j) (  Ψ̃(k) d log Ak −   Ψ̃(k) d log µk −   Ψ̃(g) d log Λ g , Ψ(n) ). (46)
            j
                 µj                                                                                              g
                                                           k                          k


Using Ψ0n = λn in turn implies that
                 X
  dλn = −                λ j (Ψ jn − δ jn )d log µ j
                     j
                 λj                   X                  X                  X
                + (θ j − 1)CovΩ̃( j) (  Ψ̃(k) d log Ak −   Ψ̃(k) d log µk −   Ψ̃(g) d log Λ g , Ψ(n) ). (47)
                 µj                                                         g
                                                           k                          k


Finally, dividing trough by λn , we get

                             X         Ψ jn − δ jn
  d log λn = −                    λj               d log µ j
                              j
                                           λn



                                                                              66
            λj                    X                  X                  X                   Ψ(n)
        +      (θ j − 1)CovΩ̃(j) (  Ψ̃(k) d log Ak −   Ψ̃(k) d log µk −   Ψ̃(g) d log Λ g ,      ). (48)
            µj                                                          g
                                                                                            λn
                                     k                     k


Applying this to a factor share yields

                 X         Ψj f
 d log Λ f = −        λj        d log µ j
                  j
                           Λf
            λj                    X                  X                  X                   Ψ( f )
        +      (θ j − 1)CovΩ̃(j) (  Ψ̃(k) d log Ak −   Ψ̃(k) d log µk −   Ψ̃(g) d log Λ g ,        ). (49)
            µj                                                          g
                                                                                            Λ f
                                     k                     k


   Re-arranging the indices to make them consistent with the results stated in the main
text, we get

                X   Ψki − δki
 d log λi = −         λk        d log µk
                       λi
              k
           λj                  X                     X                  X                   Ψ(i)
          + (θ j − 1)CovΩ̃(j) (     Ψ̃(k) d log Ak −   Ψ̃(k) d log µk −   Ψ̃(g) d log Λ g ,      ). (50)
           µj                                                           g
                                                                                            λ i
                                      k                    k


Applying this to a factor share yields

                 X Ψk f
 d log Λ f = −        λkd log µk
                   Λf
              k
         λj                  X                  X                  X                   Ψ( f )
        + (θ j − 1)CovΩ̃(j) (  Ψ̃(k) d log Ak −   Ψ̃(k) d log µk −   Ψ̃(g) d log Λ g ,        ). (51)
         µj                                                        g
                                                                                       Λf
                                     k                     k


                                                                                                       

Proof of Proposition 5. From Baqaee and Farhi (2019b), we know that the output losses can
be expressed as
                                     1X
                               L=−       (d log µl )λl d log yl .                    (52)
                                     2
                                                 l

We have
                                        d log yl = d log λl − d log pl ,                             (53)
                                           X                   X
                               d log pl =     Ψl f d log Λ f +    Ψlk d log µk ,                     (54)
                                            f                   k




                                                      67
where, from Proposition 3

             X      λk               X λj                  X                 X
d log λl =    (δlk − Ψkl )d log µk −      (θ j −1)CovΩ(j) (  Ψ(k) d log µk +   Ψ(g) d log Λ g , Ψ(l) ),
                    λl               j
                                       λl                                    g
                 k                                                                k
                                                                                                             (55)
                     X          Ψk f            X                      X                 X                  Ψ( f )
d log Λ f = −                λk      d log µk −   λ j (θ j −1)CovΩ(j) (  Ψ(k) d log µk +   Ψ(g) d log Λ g ,        ).
                                Λf              j                                        g
                                                                                                            Λf
                         k                                                    k
                                                                                (56)
   We will now use these expressions to replace in formula for the second-order loss
function. We get


           1 X X δlk Ψkl Ψlk                                   1X                 X
  L=−              ( −       −      )λk λl d log µk d log µl +        λl d log µl   Ψl f d log Λ f
           2        λk   λl    λk                              2
             l  k                                                  l              f
                  1 X  X                                  X                   X
               +         (d log µl )λ j (θ j − 1)CovΩ(j) (   Ψ(k) d log µk +      Ψ(g) d log Λ g , Ψ(l) ).
                  2    j                                                        g
                                l                                         k


We can rewrite this expression as
                                                               L = LI + LX                                      (57)

where

          1 X X Ψkl − δkl Ψlk − δlk δkl
  LI =          [        +         +    − 1]λk λl d log µk d log µl
          2        λl        λk      λl
            k l
                                 1 XXX
                               +             d log µk d log µl λ j (θ j − 1)CovΩ(j) (Ψ(k) , Ψ(l) ),
                                 2         j               k     l




           1 X X Ψl f
  LX =           (    − 1)λl Λ f d log µl d log Λ f
           2       Λf
             l f
                                     1 XX                          X
                                   +            d log µl d log Λ g   λ j (θ j − 1)CovΩ(j) (Ψ(g) , Ψ(l) ),
                                     2        g                    j
                                                       l


where d log Λ is given by the usual expression.2 The proof is finished by use of the
   2
       We have used the intermediate step


          1 XX                           1 XX
  LX =         λk λl d log µk d log µl +      d log µl d log Λ f λl Ψl f
          2                              2
             l       k                             l       f




                                                                     68
following lemma.                                                                                                                           

Lemma 2. The following identity holds:

                  X                                                          Ψ̃lk − δlk Ψkl − δkl δlk λ̃k
                        λ j µ−1
                             j CovΩ̃( j) (Ψ̃(k) , Ψ(l) ) = λl λk [                     +         +   − ].                            (58)
                    j
                                                                                 λk        λl      λk λk

This holds for inefficient economies with multiple factors and applies when k and l are goods or
factors.

Proof. We have
     X
              j CovΩ̃(j) (Ψ̃(k) , Ψ(l) ) =
         λ j µ−1
     j
                                                                                                                     
                                              X                  X                     X                   X
                                                       λ j µ−1     Ω̃ jm Ψ̃mk Ψml −   Ω̃ jm Ψ̃mk    Ω̃ jm Ψml  ,
                                                               
                                                                                    
                                                                                                     
                                                                                                                      
                                                            j  
                                                   j                m                             m                  m


or
     X
              j CovΩ̃(j) (Ψ̃(k) , Ψ(l) ) =
         λ j µ−1
     j
                                                                                                                                
                                          X        X                               X             X                   X
                                              λj           Ω jm Ψ̃mk Ψml −             λ j µ−1     Ω̃ jm Ψ̃mk    Ω̃ jm Ψml  ,
                                                                                               
                                                                                                              
                                                                                                                                
                                                                                            j  
                                          j            m                           j                m                  m


or
     X
         λ j µ−1
              j CovΩ̃(j) (Ψ̃(k) , Ψ(l) ) =
     j
                                       X           X                               X
                                              λj           Ω jm Ψ̃mk Ψml −             λ j Ψ̃ jk Ψ jl
                                          j            m                           j
                                                                                                                                
                                                           X                       X             X              X
                                                       +        λ j Ψ̃ jk Ψ jl −       λ j µ−1       Ω̃    Ψ̃           Ω̃    Ψ      .
                                                                                                                                   
                                                                                                        jm    mk           jm   ml
                                                                                                                 
                                                                                            j                                     
                                                            j                      j                m                  m


From the fact that                                                           
                                    X                        X
                                          λ j Ψ jk Ψ jl −   Ω jm Ψmk Ψml  = λk λl .
                                                                            
                                                                                                                                     (59)
                                      j                             m

                                                                    1 XX                    X
                                                                +        d log µl d log Λ g   λ j (θ j − 1)CovΩ(j) (Ψ(g) , Ψ(l) ).
                                                                    2  g l                              j




                                                                        69
the equation above can be simplified to
       X                                                    X                      X                  
           λ j µ−1
                j CovΩ̃( j) (Ψ̃(k) , Ψ(l) )   = −λ̃k λl +       λ j Ψ̃ jk Ψ jl −       λ j Ψ̃ jk − δ jk (Ψ jl − δ jl ),   (60)
       j                                                    j                      j


and finally

                  X                                                 Ψ̃lk − δlk Ψkl − δkl δlk λ̃k
                        λ j µ−1
                             j CovΩ̃(j) (Ψ̃(k) , Ψ(l) ) = λl λk [             +         +   − ].                          (61)
                    j
                                                                        λk        λl      λk λk

                                                                                                                            


Appendix E                    Nominal Rigidities
In this section, we apply our general framework to study the effects of sticky prices in
economies with arbitrary production structures.3 In general, sticky prices can be modeled
via variable markups: markups which move to ensure that the relevant nominal prices
stay constant. This is the point of connection with our framework. We show how to solve
for these endogenous markups, and then to trace their impact on the economy.
    In this section, we have two goals: first, we show how the existence of nominal rigidities
changes the mapping from microeconomic productivity shocks to aggregate output or TFP
in economies with distorted steady states; second, we show how monetary policy shocks
can be analyzed using our results in economies with distorted steady states, leading to a
clean separation the oft-neglected effects of monetary policy shocks on allocative efficiency
from their traditional aggregate demand effects. In these applications, the steady-state
distortions are the estimated markups discussed above in a given year. The endogenous
response of markups to shocks is solved for to ensure that the relevant prices remain fixed.
    These exercises are useful demonstrations of how to apply our results more generally
in cases where markups are endogenous or variable. Typically, models with sticky prices
are linearized around an efficient steady state, which ensures that reallocation terms dis-
appear. We use our framework to study the model’s behavior away from the efficient
steady-state using empirically estimated steady-state markups, and with a realistic mi-
croeconomic production structure featuring input-output connections, complementarities
in production, and substitutability among heterogenous firms within an industry.
    The size and direction of the TFP effects of monetary shocks depend crucially on the
   3
     Starting with Basu (1995), a literature has grown to emphasize the importance of intermediate goods
for understanding the business cycle properties of models with sticky prices. See for example Bouakez et al.
(2009), Nakamura and Steinsson (2010), Pasten et al. (2016, 2017).

                                                                70
correlation pattern between price-stickiness and the level of markups. They can be large
and positive if goods with higher markups have stickier prices. Our results draw attention
to the fact that the typical loglinearization of New Keynesian models around undistorted
steady states is potentially misleading since the allocative efficiency effects can be large
away from the efficient steady state.
    To model money demand we use the simplest formulation and assume that there is a
cash in advance constraint
                                           P y Y = M,

where M is the instrument of monetary policy.
   We index each individual producer by i, and write a firm-level input-output matrix in
standard form. To model sticky prices, let s denote the set of producers with fixed prices,
and let es be the N × |s| matrix given by es = [ei ]{i∈s} , where ei is the ith standard basis vector.
Using the firm-level formulation, we can solve for the change in markups d log µ that
would keep the price of sticky-firms constant, in response to the vector of productivity
shocks d log A the vector of changes in factor prices d log w:

                              d log µ = (e0s Ψ̃es )−1 e0s Ψ̃(d log A − α̃ d log w).              (62)

To solve for how the change in factor prices, we use

                                  d log w = d log Λ + d log M − d log L.

Combining these two equations characterizes how output responds to productivity or
money shocks in general equilibrium

                     d log Y − Λ̃0 d log L = λ̃0 d log A − λ̃0 es d log µ + d H(Λ̃, Λ),          (63)

where d log µ is now determined according to (62).4
   To finish our characterization, we need to make an assumption about labor supply,
since equation (63) takes the change in factor supply as given. To fix ideas, we follow con-
vention in the New Keynesian literature, and assume labor is the only factor of production
and that the household utility function takes the form:

                                                                L1+1/ν
                                       U(C, L) = log(C) −              ,
                                                               1 + 1/ν
   4
       See Proposition 8 in the Appendix for a formal statement and proof of these results.




                                                      71
where ν is the Frisch elasticity of labor supply. Under these conditions, we can combine
equations (63), (84), and (85) to explicitly solve out the labor supply decision.

Proposition 6 (Nominal Rigidities). Suppose that labor is the only factor of production. Then

                                                                1
                                                                   
                                                                   
                        d log Y = λ̃ d log A − λ̃ es d log µ −
                                       0            0
                                                                     Λ̃ d log Λ,
                                                               1+ν

with

                                                                           1
                                                                                    
                  d log µ = (e0s Ψ̃es )−1 e0s Ψ̃(d log A − α̃ d log M +         d log Λ ,
                                                                          1+ν

where Λ is the labor share of income. If the economy has a nested CES form, then
                                                      !
          N X   N                                                               N
          X                                        Ψ(L)                     X λk ΨkL
d log Λ =      (θ j − 1)µ j λ j CovΩ( j) Ψ̃(k) ,
                           −1
                                                          d log Ak − d log µk −         d log µk .
                                                      
               
                  j=0
                                                   Λ   L                         Λ                L
            k=1                                                                           k=1


    Equation (63) gives the change in aggregate TFP in response to either monetary or tech-
nology shocks in a New Keynesian type environment and decomposes it into a “pure”
change in technology component and change in allocative efficiency component. Propo-
sition 6 characterizes the corresponding changes in output.
    Typically, New Keynesian models are log-linearized around the efficient steady state,
and in those cases, the changes in allocative efficiency are second-order and are therefore
neglected.5 In these cases, our results deliver the same conclusion.6 Outside of these
special cases, for inefficient steady states, changes in allocative efficiency are not zero, and
our results then permit us to isolate these effects.
    In their important study, Pasten et al. (2016) characterize the response of output to
shocks in a model with Calvo frictions and production networks. They write the input-
output matrix at the industry level, and suppose that some fraction δi of firms in industry
i have flexible prices. Their sharpest analytical result is for the case with log utility in
       5
     See, for example, Galı́ (2008).
       6
     The case of the efficient steady-state is immediate in Proposition 6, since at the efficient steady-state
Ψ(L) is a vector of all ones, and the covariances are all zero. Hence, at the efficient steady state, Proposition
6 implies that the change in allocative efficiency, to a first order, is

                               N                   N                     N
                               X                   X λk ΨkL              X               X
−λ̃ d log µ − Λ̃ d log Λ = −
   0
                                     λk d log µk +          d log µk = −   λk d log µk +   λk d log µk = 0.
                                                      ΛL
                               k=1                k=1                       k=1                 k

Of course, for a monopolistic economy, if the production network is irregular (or asymmetric), then the equi-
librium is generically inefficient (due to the heterogeneity in markups implied by double marginalization)
even if every producer charges the same markup.


                                                        72
consumption and an infinite Frisch elasticity of labor supply. In this special case, the
response of output to shocks takes a very simple form — sticky prices act like shock
absorbers to productivity shocks. Using Proposition 6, we can recover their result and
shed light on why this happens.

Proposition 7. [Pasten et al. 2016] Suppose that utility is log in consumption and the Frisch
elasticity of labor supply is infinite. Then Proposition 6 implies
                                                       
               d log Y = λ̃0 I − es (e0s Ψ̃es )−1 e0s Ψ̃ d log A + λ̃0 es (e0s Ψ̃es )−1 e0s 1 d log M.

In the special case where some fraction δi in industry i are flexible, then

                      d log Y = d log M − b0 (I − δΩ̃)−1 δ(α̃ d log M − d log A).

    Proposition 7 is simple to interpret: for productivity shocks, the impact of a shock
is the same as one in a model with flexible prices, but where productivity shocks affect
only some fraction δi of each industry i’s costs, or in other words, productivity shocks are
attenuated by some weight δi at each industry. The impact of monetary policy shocks on
output is given by 1 − b0 (I − δΩ̃)−1 δα̃, or the total share of value-added which is sticky in
the economy.
    Crucially, information about elasticities of substitution and changes in allocative effi-
ciency disappear from these calculations. This is due to assumption of infinitely elastic
labor supply. In this model, labor supply moves exactly in such a way as to offset changes
in allocative efficiency, so that output fluctuations boil down to only how the productivity
shocks travel from suppliers into consumer prices. Hence, although output responses
can easily be determined without information on elasticities of substitution, allocative
efficiency is changing in this environment, and is given by

                       d log Y − d log L = λ̃0 d log A − λ̃0 es d log µ − d log Λ,

which is nonzero.7
   We now turn our attention to an application of our results. We calibrate a version
of our quantitative model from Section 7, but augmented with a labor-leisure choice,
and a Frisch elasticity of labor supply of ν = 1/2 , which is broadly consistent with the
recommendation of Chetty et al. (2011). We create two copies of each firm in our sample,
   7
     The fact that changes in allocative efficiency are not required to compute the changes in output is a
generic property of infinitely elastic labor supply, and does not depend on parametric assumptions about
the production functions, see footnote (13) for more details.


                                                        73
one copy has sticky prices while the other has flexible prices. We then use Proposition 6
to compute the impact of monetary policy shocks and firm-level productivity shocks.


Monetary Policy Shocks
In Figure 9, we show the response of output and aggregate TFP for a shock to the money
supply. We consider different specifications of the model with different elasticities of
substitution. For each specification, consider how output and TFP respond to a 1 log
point monetary shock as we vary the ratio of the average markup between the flexible
and sticky firms (keeping the average constant).
    We find that the movements in aggregate TFP, which are purely caused by changes
in allocative efficiency, can become very large if the elasticity of substitution across firms
is high, and if average markups are not the same between the flexible and sticky firms.
The size and sign of these movements depend crucially on the correlation between price
rigidity and markups. These results suggest that empirical work on understanding the
correlation between microeconomic price rigidities and the levels of markups could be of
great importance.8 They also suggest that the literature on the New Keynesian model, by
assuming that the steady-state is efficient, and by assuming away correlations between
price rigidities and levels of markups, could potentially be missing important first-order
effects.9
    In Figure 10, we plot the output response for the benchmark model and a one sector
version of the model with a value-added production function. Comparing the benchmark
model to the one-sector model, we recover the famous insight by Basu (1995) that inter-
mediate goods can increase stickiness. If intermediate inputs are sticky, then flexible firms
adjust their prices less in response to shocks. The degree of amplification caused by the
intermediate-input share is hump-shaped in the fraction of firms δ that have sticky prices.
In the limit, as all firms become sticky, the intermediate input share becomes irrelevant,
and the same occurs when all firms become flexible.10
    8
       The sign of this correlation is not ex-ante obvious. In models where the price elasticity of demand
is not constant, the pass-through of costs to markups can depend on the level of the markup, so that the
desired markups of firms with high markups are less sensitive to changes in costs. In the presence of price-
adjustment costs, this means that high markup firms will have stickier prices (see Gopinath and Itskhoki,
2011, 2010; Atkeson and Burstein, 2008; Kimball, 1995). On the other hand, in a Calvo model where the
markups are uncorrelated with stickiness on impact, in response to an expansion in the money supply,
firms that do not adjust their markups for longer will over time have lower effective markups, inducing a
negative correlation between stickiness and markups. Studying these sorts of effects requires a dynamic
model however, and we leave this for future work.
     9
       Typically, second-order effects on allocative efficiency are taken into account only in the computation
of welfare, but not in the computation of the equilibrium allocation.
    10
       Relatedly, Nakamura and Steinsson (2010) and Pasten et al. (2016) have emphasized that heterogeneity


                                                     74
                                                                                         0.4
                          Benchmark                                                               Benchmark
                  0.5     CD                                                                      CD
                          One sector                                                     0.2      One sector

                  0.4
                                                                    d log TFP/d log M
                                                                                           0
d log Y/d log M




                  0.3                                                                   −0.2


                                                                                        −0.4
                  0.2

                                                                                        −0.6
                  0.1

                                                                                        −0.8
                   0.94   0.96   0.98     1   1.02   1.04   1.06                           0.94   0.96   0.98     1   1.02   1.04   1.06
                                 Ratio of Markups                                                        Ratio of Markups

Figure 9: The elasticity of output and aggregate TFP with respect to monetary policy
shocks (d log Y/ d log M, d log TFP/ d log M) for Calvo parameter δ = 0.5. The parameter δ
is the fraction of each industry with sticky prices. We show the results for the benchmark
model, a Cobb-Douglas specification that sets all elasticities equal to one (CD + CD), and
a single-industry model with a value-added production function. We then vary the ratio
of the markup between the sticky and flexible portions of each sector.




                                                                   75
                            1
                                     Benchmark
                                     One sector
                           0.8
         d log Y/d log M




                           0.6



                           0.4



                           0.2



                            0
                                 0      0.2        0.4       0.6    0.8         1
                                                  Calvo Parameter

Figure 10: The elasticity of output and aggregate TFP with respect to monetary policy
shocks (d log Y/ d log M, d log TFP/ d log M) as a function of the Calvo parameters δ. The
parameter δ is the fraction of each industry with sticky prices. We show the results for the
benchmark model, a Cobb-Douglas specification that sets all elasticities equal to one (CD
+ CD), and a single-industry model with a value-added production function. The ratio of
the markup between the sticky and flexible portions of each sector is 1.




                                                     76
Proofs of this section
Proof of Proposition 8. Order the producers so that the first s producers are the ones with
sticky prices. For a vector x, denote x(s) = e0s x. From the cash in advance constraint, we
know that

        d log Y = d log M − d log Pc ,
                 = d log M − b0 d log p,
                 = d log M − b0 Ψ̃ α̃ d log w − d log A + b0 Ψ̃es d log µ,
                                                       

                 = d log M − Λ̃0 d log w + λ̃0 d log A − λ̃es d log µ,
                 = d log M − Λ̃0 d log Λ + d log M − d log L + λ̃0 d log A − λ̃es d log µ,
                                                                 

                 = d log M − Λ̃0 d log Λ − d log L − d log M + λ̃0 d log A − λ̃es d log µ,
                                                    


which implies that

                    d log Y − Λ̃0 d log L = λ̃0 d log A − λ̃0(s) d log µ − Λ̃0 d log Λ.                 (64)

    To get the markups necessary to keep p(s) sticky, we impose

                           d log p(s) = d log µ + e0s Ω̃ log p − d log A(s) = 0.                        (65)

This implies
                          d log µ = −e0s Ω̃ d log p − α̃(s) d log w + d log A(s) .                      (66)

On the other hand, we have

                           d log p = Ψ̃ α̃ d log w − d log A + Ψ̃es d log µ.
                                                            
                                                                                                        (67)

Substituting this back into the previous expression gives

  d log µ = −e0s Ω̃Ψ̃α̃ d log w − e0s Ω̃Ψ̃es d log µ + e0s Ω̃Ψ̃ d log A − e0s α̃ d log w + e0s d log A. (68)

in the frequency of price changes across industries is also quantitatively important. This is mostly because,
even in the basic New Keynesian model with a trivial input-output structure, the mapping between the
frequency of price changes and the degree of monetary non-neutrality is convex, and so for a given average
frequency of price changes, increasing dispersion in the frequency of price changes increases monetary
non-neutrality. This is an important dimension of heterogeneity that, for now, we abstract away from in our
quantitative examples.




                                                     77
Solve this to get

                    d log µ = (e0s (I + Ω̃Ψ̃)es )−1 e0s (I + Ω̃Ψ̃) d log A − α̃ d log w ,
                                                                                       

                            = (e0s Ψ̃es )−1 e0s Ψ̃ d log A − α̃ d log w .
                                                                        


                                                                                                      

     To prove Proposition 6, we first prove the following:

Proposition 8. Consider an economy with a cash-in-advance constraint, and nominal rigidities.
Then,
                d log Y − Λ̃0 d log L = λ̃0 d log A − λ̃0 es d log µ + d H(Λ̃, Λ),

where
                             d log µ = (e0s Ψ̃es )−1 e0s Ψ̃(d log A − α̃ d log w),                  (69)

and
                                d log w = d log Λ + d log M − d log L.

In the special case where some fraction δi in industry i are flexible. Then,
                                                      
      λ̃0(s) d log µ = b0 (I − Ω̃)−1 − b0 (I − δΩ̃)−1 δ d log A − (1 − b0 (I − δΩ)−1 δα) d log w,   (70)
                                            
                     = λ̃ − b0 (I − δΩ̃)−1 δ d log A − (1 − b0 (I − δΩ)−1 δα) d log w.

Proof of Proposition 6. The labor-leisure condition and the cash-in-advance condition imply
that
                                                  w      w
                                                       
                                     L 1/(ν)
                                             =         =    .                           (71)
                                                 Pc C    M
Hence,

              1
                d log L = d log w − d log M = d log Λ − d log L + d log M − d log M,                (72)
              ν

or
                                                      ν
                                         d log L =       d log Λ.                                   (73)
                                                     1+ν
Therefore,
                                                1
                                  d log w =        d log Λ + d log M                                (74)
                                               ν+1
To finish, apply Propositions 2 and 3.                                                                

Proof of Proposition 7. With log utility in consumption and infinite Frisch elasticity of labor


                                                     78
supply we have that
                                    d log w − d log Pc = d log Y,                                 (75)

or in other words, substituting in the cash in advance constraint

                                          d log w = d log M.                                      (76)

Furthermore, the cash in advance constraint implies that

                 d log Y = d log M − d log Pc ,
                          = d log M − Λ̃0 d log w + λ̃0 d log A − λ̃0 es d log µ,
                          = d log M − d log M + λ̃0 d log A − λ̃0 es d log µ,
                          = λ̃0 d log A − λ̃0 es d log µ,

substituting equation (69) from Proposition 8 completes the proof

                          = λ̃0 d log A − λ̃(s) (e0s Ψ̃es )−1 e0s Ψ̃(d log A − α̃ d log w),
                          = λ̃0 d log A − λ̃(s) (e0s Ψ̃es )−1 e0s Ψ̃(d log A − α̃ d log M).

In the special case where some fraction δi in industry i are flexible. Then,
                                                    
    λ̃0(s) d log µ = b0 (I − Ω̃)−1 − b0 (I − δΩ̃)−1 δ d log A − (1 − b0 (I − δΩ)−1 δα) d log w,   (77)
                                          
                   = λ̃ − b0 (I − δΩ̃)−1 δ d log A − (1 − b0 (I − δΩ)−1 δα) d log w.

At the industry level, equation (77) shows that the changes in markups can be interpreted
as if some fraction of the firms in each industry change their markup in response to
shocks.                                                                                 


Appendix F Basu-Fernald and Petrin-Levinsohn in a Sim-
                       ple Example
To compare our decomposition with that of Basu-Fernald and Petrin-Levinsohn, we con-
sider the simple economy in Figure 11. There are two factors L1 and L2 . There are two
producers 1 and 2. Producer 2 produces linearly from factor L2 with productivity A2 . It
does not charge any markup µ2 = 1. Producer 1 uses the factor L1 and output of producer
2 to produce according to a CES production function with steady-state revenue-based

                                                    79
expenditure shares ω1L1 and ω12 , and with elasticity of substitution θ1 (this elasticity will
not matter in the calculations below). It charges a markup µ1 > 1.
   Because this economy is acyclic, there is a unique feasible allocation, and it is efficient.
There is no misallocation, and there cannot be any change in allocative efficiency. Our
decomposition gives
                            d log Y
                                    =     λ̃2  +        0        ,
                           d log A2    |{z}           |{z}
                                        ∆Technology   ∆Allocative Efficiency

and the decompositions of Basu-Fernald and Petrin-Levinsohn both give

                           d log Y
                                    =      λ2  +           λ̃2 − λ2            ,
                           d log A2       |{z}             | {z }
                                        ∆Technology   ∆Allocative Efficiency


where λ2 = ω12 , and λ˜2 = µ1 ω12 .Since λ̃2 = µ1 λ2 > λ2 , this immediately implies that
while our decomposition does not detect any change in allocative efficiency, those of
Basu-Fernald, and Petrin-Levinsohn do detect changes in allocative efficiency.


                                                L1                     L2




                            HH                  1                       2


Figure 11: Acyclic economy where the solid arrows represent the flow of goods. The flow
of profits and wages from firms to households has been suppressed in the diagram. The
two factors in this economy are L1 and L2 .




Appendix G             Applying our Results with Endogenous Markups
                       in a Simple Example
Consider the following endogenous-markup economy. There is a large number of indus-
tries indexed by I. Within each industry, there is a finite number of producers i ∈ I.
Each producer produces linearly from labor with productivity Ai and charges a markup
µi . The outputs of the different producers in each industry are combined into an industry
output via a CES aggregator with elasticity θ1 > 1. The outputs of the different industries

                                                80
are combined into a final good via a Cobb-Douglas aggregator so that θ0 = 1. Following
Atkeson and Burstein (2008), assume that producers play a static game of quantity com-
petition. Specifically, each producer chooses its quantity taking as given the quantities
chosen by the other producers as well as the wage and the price quantity of the final good.
Under this assumption, producers do recognize that industry prices and quantities vary
when that they change their quantities. This gives rise to endogenous markups i:

                                         1          λi        1
                                            = (1 −       )(1 − ),                                   (78)
                                         µi        λI(i)      θ1

where I(i) is the industry of i, λi is its sales share, and λI(i) is the sales share of its industry.
Hence, the markup of i is increasing in the relative sales share λi /λI(i) of i in its industry,
and decreasing in the elasticity of substitution θ1 across producers within an industry.
    Suppose that all the industries are ex-ante identical. In each industry I, there is a
large producer k with λk /λI > 0 and a continuum of atomistic producers, each with
an infinitesimal relative sales share, but with strictly positive total relative sales share
1 − λk /λI(k) > 0. This implies that the markups of the atomistic producers are all constant
at 1/(1 − 1/θ1 ).
    Now consider a shock the productivity Ak of a single large producer k in a single
industry I(k). The markup of producer i does not change if it is not in the industry of the
shocked producer. The markup of an atomistic producer in the industry of the shocked
producer does not change. And we can solve jointly for the change d log µk in the markup
of producer k and for the change d log λk in its sales share:

                λk /λI(k)
 d log µk =                 d log λk ,    d log λk = (θ1 − 1)(1 − λk /λI(k) )(d log Ak − d log µk ), (79)
              1 − λk /λI(k)

where the first equation can be obtained by differentiating the markup equation (78),
and where the second equation can be obtained by applying the propagation equations
in Propositions 2 and 3 applied to producer k’s sales share rather than to factor shares.
This in turn implies that the markup µk of producer k increases endogenously with its
productivity Ak according to

                                               λk
                                   d log µk   λI(k)
                                                    (θ1 − 1)
                                            =                > 0.                                   (80)
                                   d log Ak 1 + λk (θ1 − 1)
                                                λI(k)


There is therefore imperfect pass-through of productivity shocks to prices. We then
use the chain rule equation (16) with Z = log Ak , in conjunction with the expressions


                                                    81
for d log Λ/ d log Ak and for d log Λ/ d log µk given by Propositions 2 and 3. We find that
taking into account the endogenous change of the markups responsible for imperfect pass-
through, the change d log Y resulting from an increase d log Ak > 0 in the productivity of
producer k is

                                   d log Y                  d log Y d log µk
                       d log Y =              d log Ak +                             d log Ak
                                   d log Ak                 d log µk d log Ak
                                                 1 − λλI(k)      λi
                                                        k
                                                                                 
                                                              λ
                                                                       (θ1 − 1) 
                                 = λk 1 +                                       d log Ak .
                                                                 I(k)           
                                                  λk                      λk
                                            1 + λI(k) (θ1 − 1) 1 + λI(k) 

If instead markups were exogenously fixed, we would have
                                                                     λk                
                               d log Y                             λI(k)
                                                                           (θ1    − 1) 
                     d log Y =          d log Ak = λk 1 +                              d log Ak ,
                                                                                       
                                                                                 λk
                               d log Ak                                1+   λI(k)
                                                                                          

which is strictly higher. We therefore see that imperfect pass-through via endogenous
markups mitigates the impact of the shock.


Appendix H                  Standard-Form for Nested CES Economies
Throughout this section, variables with over-lines are normalizing constants equal to the
values in steady-state. Since we are interested in log changes, the normalizing constants
are irrelevant.11


Nested CES Economies in Standard Form

A CES economy in standard form is defined by a tuple (ω, θ, µ, F) and a set of normalizing
constants (y, x). The (N + F + 1) × (N + F + 1) matrix ω is a matrix of input-output
parameters where the first row and column correspond to the reproducible final good,
the next N rows and columns correspond to reproducible goods and the last F rows and
columns correspond to non-reproducible factors. The (N + 1) × 1 vector θ is a vector
of microeconomic elasticities of substitution. Finally, the N × 1 vector µ is a vector of
markups/wedges for the N non-final reproducible goods.12
   11
      We use normalized quantities since it simplifies calibration, and clarifies the fact that CES aggregators
are not unit-less.
   12
      For convenience we use number indices starting at 0 instead of 1 to describe the elements of ω and θ,
but number    indices starting at 1 to describe the elements of µ. We impose the restriction that ωi j ∈ [0, 1],
   ω   =        all 0 ≤ i ≤ N, ω f j = 0 for all N < f ≤ N + F, ω0 f = 0 for all N < f ≤ N + F, and ωi0 = 0 for all
P
  j ij    1 for


                                                         82
   The F factors are modeled as non-reproducible goods and the production function of
these goods are endowments
                                       yf
                                          = 1.
                                       yf
The other N + 1 other goods are reproducible, and the production of a reproducible good
k can be written as                                               θk
                                                    ! θθk −1  θk −1
                              yk         X      xkl k 
                                 = Ak     ωkl                       ,
                                        
                                                               
                              yk         
                                           l
                                                 xkl            

where xlk are intermediate inputs from l used by k. Each producer charges a markup over
its marginal cost µk . Producer 0 represents final-demand and its production function the
final-demand aggregator so that
                                          Y y0
                                             = ,                                     (81)
                                          Y y0
where Y is output and y0 is the final good.
    Through a relabelling, this structure can represent any CES economy with an arbitrary
pattern of nests, markups/wedges and elasticities. Intuitively, by relabelling each CES
aggregator to be a new producer, we can have as many nests as desired.
    Consider some initial allocation with markups/wedges µ and productivity shifters
normalized, without loss of generality, at A = 1. The normalizing constants (y, x) are
chosen to correspond to this initial allocation. Let b and Ω̃ be the corresponding vector
of consumption shares and cost-based input-output matrix. Then we must have ω0i = bi
and ω(i+1)( j+1) = Ω̃ij . From there, all the other cost-based and revenue-based input-output
objects can be computed exactly as in Section 2.2.


Appendix I Robustness and Extensions
In this section, we discuss some of the extensions mentioned in the body of the paper.
Specifically, we address in more detail how are results extend to situations with arbi-
trary non-CES production functions, elastic factors, capital accumulation/dynamics, and
nonlinearities. Proofs for the results are at the end of this section.
0 ≤ i ≤ N.




                                             83
I.1    Beyond CES
The input-output covariance operator defined in Section 4 is a key concept capturing the
substitution patterns in economies where all production and utility functions are nested-
CES functions. In this section, we generalize this input-output covariance operator in
such a way that allows us to work with arbitrary production functions.
    For a producer j with cost function C j , we define the Allen-Uzawa elasticity of substi-
tution between inputs x and y as

                                                   C j d2 C j /(dpx dp y )    j (x, y)
                                  θ j (x, y) =                             =            ,
                                                 (dC j /dpx )(dC j /dp y )      Ω jy

where  j (x, y) is the elasticity of the demand by producer j for input x with respect to the
price p y of input y, and Ω jy is the expenditure share in cost of input y.
   Note the following properties. Because of the symmetry of partial derivatives, we
have θ j (x, y) = θ j (y, x). Because of the homogeneity of degree one of the cost function in
the prices of inputs, we have the homogeneity identity 1≤y≤N+1+F Ω jy θ j (x, y) = 0.
                                                            P

   We define the input-output substitution operator for producer j as
                                             X
              Φ j (Ψ̃(k) , Ψ( f ) ) = −                 Ω jx [δxy + Ω jy (θ j (x, y) − 1)]Ψ̃xk Ψ y f ,   (82)
                                          1≤x,y≤N+1+F
                                  1                                                           
                                 = EΩ(j) (θ j (x, y) − 1)(Ψ̃k (x) − Ψ̃k (y))(Ψ f (x) − Ψ f (y)) ,        (83)
                                  2

where δxy is the Kronecker symbol, Ψ̃k (x) = Ψxk and Ψ f (x) = Ψx f , and the expectation on
the second line is over x and y. The second line can be obtained from the first using the
symmetry of Allen-Uzawa elasticities of substitution and the homogeneity identity.
    In the CES case with elasticity θ j , all the cross Allen-Uzawa elasticities are identical
with θ j (x, y) = θ j if x , y, and the own Allen-Uzawa elasticities are given by θ j (x, x) =
−θ j (1 − Ω jx )/Ω jx . It is easy to verify that we then recover the input-output covariance
operator:
                               Φ j (Ψ̃(k) , Ψ( f ) = (θk − 1)CovΩ(j) (Ψ̃(k) , Ψ( f ) ).

    Even outside the CES case, the input-output substitution operator shares many prop-
erties with the input-output covariance operator. For example, it is immediate to verify,
that: Φ j (Ψ̃(k) , Ψ( f ) ) is bilinear and symmetric in Ψ̃(k) and Ψ( f ) ; Φ j (Ψ̃(k) , Ψ( f ) ) = 0 whenever
Ψ̃(k) or Ψ( f ) is a constant.
    Luckily, it turns out that all of the results stated in Sections 4 and 5 can be generalized
to non-CES economies simply by replacing terms of the form (θ j − 1)CovΩ(j) (Ψ̃(k) , Ψ( f ) ) by


                                                              84
Φ j (Ψ̃(k) , Ψ( f ) ).
     Intuitively, Φ j (Ψ̃(k) , Ψ( f ) ) captures the way in which j redirects demand expenditure
towards f in response to proportional unit decline in the price of k. To see this, we make use
of the following observation: the elasticity of the expenditure share of producer j on input
x with respect to the price of input y is given by δxy +Ω jy (θ j (x, y)−1). Equation (82) requires
considering, for each pair of inputs x and y, how much the proportional reduction Ψ yk in
the price of y induced by a unit proportional reduction in the price of k causes producer
j to increase its expenditure share on x (as measured by −Ω jx [δxy + Ω jy (θ j (x, y) − 1)]Ψ̃ yk )
and how much x is exposed to f (as measured by Ψx f ).
     Equation (83) says that this amounts to considering, for each pair of inputs x and
y, whether or not increased exposure to k as measured by Ψ̃k (x) − Ψ̃k (y), corresponds to
increased exposure to i as measured by Ψi (x)−Ψi (y), and whether x and y are complements
or substitutes as measured by (θ j (x, y) − 1). If x and y are substitutes, and Ψ̃k (x) − Ψ̃k (y)
and Ψ f (x) − Ψ f (y) are both positive, then substitution across x and y by k, in response to
a shock to a decrease in the price of k, increases demand for f .


I.2   Elastic Factor Supplies
In this section, we fully flesh out one such extension by showing to generalize our analysis
to allow for endogenous factor supplies.
    To model elastic factor supplies, let G f (w f Y, Y) be the aggregate supply of factor f ,
where w f Y is the price of the factor in the GDP deflator numeraire (w f is the price of
the factor in the nominal GDP numeraire) and Y is real aggregate income. Let ζ f =
∂ log G f /∂ log(w f Y) be the elasticity of the supply of factor f to its real wage, and γ f =
−∂ log G f /∂ log Y be its income elasticity. We then have the following characterization:
                                                                      
                           d log Y            X 1          d log Λ f
                                                                       
                                    = % λ̃k −         Λ̃ f            ,                    (84)
                                                                     
                           d log Ak             1 + ζf      d log Ak 
                                                 f


and                                                                    
                          d log Y              X 1          d log Λ f
                                                                        
                                   = % −λ̃k −         Λ̃ f             ,                  (85)
                                                                        
                          d log µk               1 + ζf      d log µk 
                                                     f

                       1+γ
where % = 1/( f Λ̃ f 1+ζ ff ).
               P

   With inelastic factors, a decline in factor income shares, ceteris paribus, increases output
since it represents a reduction in the misallocation of resources and an increase in aggregate
TFP. With elastic factor supply, the output effect is dampened by the presence of 1/(1+ζ f ) <


                                                 85
1. This is due to the fact that a reduction in factor income shares, while increasing aggregate
TFP, reduces factor payments and factor supplies, which in turn reduces output. Hence,
when factors are elastic, increases in allocative efficiency from assigning more resources
to more monopolistic producers are counteracted by reductions in factor supplies due to
the associated suppression of factor demand.13
    We can provide an explicit characterization of d log Λ f and d log Y in terms of microe-
conomic elasticities of substitution in a nested-CES structure similar to the one in Section
4. Changes in factor shares and output solve the following system of equations:

                  X              Ψk f           X        λj         X                  X                  Ψ( f )
  d log Λ f = −             λk        d log µk + (θ j −1) CovΩ̃(j) (  Ψ̃(k) d log Ak −   Ψ̃(k) d log µk ,        )
                                 Λf             j
                                                         µj                                               Λf
                    k                                                  k                   k
                    X                λj         X          1                X       γg − ζg          Ψ( f )
                −           (θ j − 1) CovΩ̃(j) (   Ψ̃(g)        d log Λ g +   Ψ̃(g)         d log Y,        ),
                        j
                                     µj          g
                                                         1 + ζg             g
                                                                                    1 + ζg           Λf

                                                                                         
                            X                X                X        1                
              d log Y = ρ    λ̃k d log Ak −   λ̃k d log µk −   Λ̃ f        d log Λ f  .
                                                                                          
                                                                      1 + ζf              
                                      k                  k                 f

Equations (84) and (85) can also be applied to frictionless economies with endogenous
factor supplies. They show that even without any frictions, Hulten’s theorem cannot be
used to predict how output will respond to microeconomic TFP shocks, due to endogenous
responses of factors. These results therefore also extend Hulten’s theorem to efficient
economies with endogenous factor supplies.


I.3     Capital Accumulation, Adjustment Costs, and Capacity Utilization
In mapping this set-up to the data, there are two ways to interpret this model: either we
could interpret final demand as a per-period part of a larger dynamic problem, or we
could interpret final demand as an intertemporal consumption function where goods are
also indexed by time à la Arrow-Debreu. When we interpret the model intratemporally,
the output function encompasses demand for consumption goods and for investment
goods. When we interpret the model intertemporally, the process of capital accumulation
is captured via intertemporal production functions that transform goods in one period
   13
     In the limit where factor supplies become infinitely elastic, the influence of the allocative efficiency
effects disappear from output, since more factors can always be marshaled on the margin at the same
real price. To see this, consider the case with a single factor called labor, and factor supply function
GL (wY, Y) = Y−ν (wY)ν , which can be derived from a standard labor-leisure choice model. In this case,
ζL = γL = ν, and so equation (84) implies that d log Y/ d log Ak = λ̃k − 1/(1 + ν) d log ΛL / d log Ak . When
labor supply becomes infinitely elastic ν → ∞, this simplifies to d log Y/ d log Ak = λ̃k , so that changes in
allocative efficiency have no effect on output, even though they affect TFP.

                                                             86
into goods in other periods. This modeling choice would also be well-suited to handle
technological frictions to the reallocation of factors such as adjustment costs and variable
capacity utilization. Our formulas would apply to these economies without change, but of
course, in such a world, input-output definitions would now be expressed in net-present
value terms.


I.4   Nonlinear Impact of Shocks and Duality with Industry Structure
Another limitation of our results is that we neglect nonlinearities. As discussed by Baqaee
and Farhi (2017), models with production networks can respond very nonlinearly to pro-
ductivity shocks. We plan to extend these results to inefficient economies in full generality,
but as a first step, we stipulate some conditions under which we can directly leverage
these results to inefficient economies. In particular, we show that the amplification of
negative shocks due to complementarities emphasized in Baqaee and Farhi (2017) can
also work to amplify the negative effects of misallocation.
   Consider the quantitative parametric model in Section 7. Let δk (i), µk (i), and Ak (i)
denote firm i in industry k’s share of industry sales, markup, and productivity. Define
industry k’s average markup and productivity to be
                                                         −1
                                              X δk (i) 
                                       µk =            
                                                  µ (i) i
                                                                   k


and
                                                                 µk /µk
                            Ak /Ak =                                                              ,
                                                                                1−ξk ! 1−ξ1 k
                                                                 µk (i)/µk (i)
                                                 δk (i)
                                         P
                                             i                   Ak (i)/Ak (i)

where overline variables denote steady-state values.
    To the original firm-level economy, we associate a dual industry-level economy, for
which the input output-matrix is aggregated at the industry level. Define the output level
of the dual economy by Y̌ and the revenue-based Domar weight of industry k by λ̌k . The
dual industry-level economy has initial industry-level markups equal to
                                                         −1
                                              X δk (i) 
                                       µk =             .
                                                  µ (i) 
                                                     i
                                                                   k


The next proposition shows that productivity and markup shocks in the original firm-level
economy can be translated into productivity and markup shocks in the dual industry-level


                                                         87
economy.

Proposition 9 (Exact Duality). The discrete (nonlinear) output response ∆ log Y to shocks to
productivities and markups of the original economy is equal to the output response ∆ log Y̌ to the
dual shocks to productivity and markups of the dual economy.

Corollary 3 (Efficient Duality). Consider an economy where µk = 1 for every k, and consider a
transformation µk (i)(tk ) which changes markups but maintains µk = 1. Then

                                 d log Y d log Y̌        d log Ǎk
                                         =         = λ̌k                                          (86)
                                 d log tk d log tk       d log tk

and                                                                 !2
                 d2 log Y     d2 log Y̌       d log λ̌k d log Ǎk                d2 log Ǎk
                            =           = λ̌k                            + λ̌k                ,   (87)
                  d log t2k   d log t2k       d log Ǎk d log tk                 d log t2k

where d log λ̌k / d log Ǎk is given by the formulas in Baqaee and Farhi (2017).

    If firms within an industry are substitutes, then increases in the dispersion of markups,
which keep the harmonic average of markups equal to one, are isomorphic to negative
productivity shocks in a model which is efficient at the industry level. Hence, shocks
which increase markup dispersion in an industry can have outsized nonlinear effects on
output, if those industries are macro-complementary with other industries in the sense
defined by Baqaee and Farhi (2017) so that d log λ̌k / d log Ǎk < 0.
    This helps flesh out the insight in Jones (2011) that complementarities can interact with
distortions to generate large reductions in output, and that these can be quantitatively
important enough to explain the large differences in cross-country incomes. Given the
examples in Baqaee and Farhi (2017), it should be clear how misallocation in a key industry
like energy production can significantly reduce output through macro-complementarities.
Investigating these nonlinear forces more systematically is an interesting exercise that we
leave for future work.

Proof of Proposition 9. To streamline the exposition, we focus on a single industry, and we
use different but more straightforward notation. Consider an industry where: all firms i
use the same upstream input bundle with cost C; firms transform this input into a firm-
specific variety of output using constant return to returns to scale technology; each firm i
has productivity ai and charges a markup µi ; the varieties are combined into a composite
good by a competitive downstream industry according to a CES production function with
elasticity σ on firm i. Without loss of generality, and only for convenience, we normalize


                                                 88
all prices in steady-state to be equal to C, which means that we normalize the levels of
productivities in steady state (and only in steady state) to be equal to the markups.
    We denote the quantity of composite good produced as
                                                                           σ
                                                                  σ−1
                                              X          1
                                                                         σ−1
                                       Q=                 σ
                                                         bi qi     σ
                                                                                .      (88)

Firm i charges a price
                                                          µi
                                                  pi =       C.                        (89)
                                                          ai
The resulting demand for firm i’s variety is

                                                pi
                                          qi = ( )−σ bi Q,                             (90)
                                                P

where the price index is given by

                                              hX                       1
                                                                    i 1−σ
                                       P=                bi p1−σ
                                                             i                  .      (91)

Total profits are given by
                                         X             pi
                                   Π=         (pi − C)( )−σ bi Q.                      (92)
                                          i
                                                       P

   We solve out the price index and profits explicitly and get

                                                          1
                                          X  µi 1−σ  1−σ
                                          
                                    P =   bi           C,                         (93)
                                              i
                                                a         
                                                              i

                                                                    −σ
                                                                   
                                                        µ
                                                                    
                                                          i
                            X  µi 1                ai
                                                                       
                         Π=
                                                                        
                                   −                            #  bi CQ.           (94)
                                                                       
                                                                  1
                                a    a
                                             "
                                 i    i                   1−σ 1−σ 
                            i
                                               j b j µ j
                                             
                                              P                        
                                                                          
                                                        aj


For completeness we can also solve for the sales of each firm as a fraction of the sales of
the industry
                                                  µ 1−σ
                                                    i
                                    pi qi    b i   ai
                               λi =       =               .                            (95)
                                     PQ P  µ j 1−σ
                                              j b j aj

   We want to understand how to aggregate this industry into homogenous industry




                                                     89
with productivity A and markup µ. These variables must satisfy

                                              µ
                                                C,                 P=                                                                                  (96)
                                              A
                                         µ
                                                1
                                                  
                                    Π=       −      CQ.                                                                                                (97)
                                          A A
This implies that A and µ are the solutions of the following system of equations

                                                                      1
                                                     µ X  µi   1−σ
                                                                1−σ

                                                      =  bi         ,                                                                              (98)
                                                     A  i    ai      

                                                                             −σ
                                                                            
                                                                µ
                                                                             
                         µ      X µ                           i             
                              1            1
                                               
                                       i                        ai
                                 =                                       #  bi .
                                                                                 
                            −            −                                                                                                             (99)
                                                                                
                                                                           1
                          A A        a     a
                                                     "
                                      i      i                     1−σ 1−σ 
                                   i
                                                       j b j µ j
                                                     
                                                      P                         
                                                                                   
                                                                aj


The solution is

                                                                                      1
                   A=                                                                                   −σ        ,                                 (100)
                                                          1
                                                                                            µi
                                                                                                         
                                                                                                         
                          P                 µ 1−σ    1−σ    P                        ai           µi
                                                                                                         
                                   i bi
                                               i
                                              ai
                                                               − i 1 − µ1i                        1    ai bi
                                                                                P  µ j 1−σ  1−σ    
                                                                                  j b j a      
                                                                                                            j



                                                                                               1
                                                                P                  µ 1−σ  1−σ
                                                                                       i
                                                                          i   bi      ai
                    µ=                                                                                  −σ      .                                   (101)
                                                        1
                                                                                          µi
                                                                                                         
                                                                                                         
                          P                 µ 1−σ  1−σ      P                       ai
                                                                                                           µi
                                               i                       1 
                                       bi                      − i 1 − µi                                    b
                                                                              P  µ j 1−σ  1−σ  ai i
                                   i
                                                                                                   1
                                                                                                           
                                             ai
                                                                                j b j a               
                                                                                                            j


We can also rewrite this in a useful way as

                                       1                              1                                           1                      1
                  A=                                                                      =                                                     ,   (102)
                                                                                                                                        i µi λi
                                                    1                          1−σ                                            1          1
                                                                      
                                                                          µi
                                                                                                                                    P
                      P             µ 1−σ       1−σ                                bi     P                    µ 1−σ    1−σ
                                        i                                 ai                                          i
                              bi                               1                                        bi
                                                         P
                          i            ai                    i µi P             µ 1−σ             i             ai
                                                                                 j
                                                                      j   bj    aj



                                                                   1                                1
                                               µ=                                          =P                     .                                   (103)
                                                                                                i µi λi
                                                                   
                                                                          µi 1−σ
                                                                                                 1
                                                                          ai     bi
                                                               1
                                                         P
                                                             i µi P             µ 1−σ
                                                                                 j
                                                                      j   bj    aj




                                                                               90
    The theorem follows by applying this analysis to an industry k, with δk (i) = λi and
bi = δk (i).
                                                                                       


Appendix J           Aggregation of Cost-Based Domar Weights
In this Appendix we show that recovering cost-based Domar weights from aggregated
data is, in principle, not possible. The vertical economy in Figure 1a also shows the failure
of the aggregation property implied by Hulten’s theorem. The easiest way to see this is to
consider aggregating the input-output table for the economy in Figure 1a. For simplicity,
suppose that markups are the same everywhere so that µi = µ for all i. Since there is no
possibility of reallocation in this economy, and since markups are uniform, this is our best
chance of deriving an aggregation result, but even in this simplest example, such a result
does not exist. Suppose that we aggregate the whole economy S = {1, . . . , N}. Then, in
aggregate, the economy consists of a single industry that uses labor and inputs from itself
to produce. In this case, the input-output matrix is a scalar, and equal to the intermediate
input share of the economy
                                                     1
                                               1 − µN−1
                                        ΩSS =           ,                               (104)
                                                1 − µ1N

and the aggregate markup for the economy is given by µ. Therefore, λ̃S constructed using
aggregate data is
                                                µN−1 − µ1
                            λ̃S = 1 (I − µΩ) =
                                   0        −1
                                                          .                        (105)
                                                 1 − µ1

However, we know from the example that

                           d log Y X                     µN−1 − µ1
                                   =     λ̃i = N , λ̃S =      1
                                                                   ,                   (106)
                           d log A   i∈S
                                                          1 − µ


except in the limiting case without distortions µ → 1. Therefore, even in this simplest case,
with homogenous markups and no reallocation, aggregated input-output data cannot be
used to compute the impact of an aggregated shock.




                                              91
Appendix K            Extra Examples
Example K.1. We build a simple example to underscore the importance of properly ac-
counting for the multiplicity of factors to assess the macroeconomic impact of microeco-
nomic shocks in inefficient economies. The example is depicted in Figure 12.

                         L             1


                                                HH               3                    K
                                       2

Figure 12: An economy with two factors of production L and K. The subgraph from
L to the household contains a cycle, and hence can be subject to misallocation. On the
other hand, there is only a unique path connecting K to the household, so there is no
misallocation.

   We have                                                                                
                                     Covb (Ψ̃(L) , Ψ(L) ) Covb (Ψ̃(K) , Ψ(L) )
                    Γ = −(θ0 − 1)                                                         ,
                                                                                           
                                                                                                        (107)
                                       Covb (Ψ̃(L) , Ψ(K) ) Covb (Ψ̃(K) , Ψ(K) )             

and                                                                          
                                                  Covb (Ψ̃(i) , Ψ(L) )
                               δ(i) = (θ0 − 1)                               .
                                                                              
                                                    Covb (Ψ̃(i) , Ψ(K) )        

Substituting in the values and solving the system of equations (11), using Proposition 2,
and noting that λi = λ̃i for all i, we find that
                                                                                  
              d log Y                                       µ−1
                                                               i
                                                                                   
                       = λi + λi (θ0 − 1) 1 −     λ1               λ2
                                                                                     ,   (i = 1, 2)
              d log Ai                                    µ−1   +             µ −1 
                                                                                     
                                                    λ1 +λ2 1         λ1 +λ2      2


but
                                      d log Y
                                               = λi ,      (i = 3).
                                      d log Ai
A lesson is that changes in allocative efficiency are only present for shocks to producers 1
and 2 which share a factor of production, but not for producer 3 which has its own factor
of production. Moreover, the changes in allocative efficiency for shocks to producers 1
and 2 only depends on the markups of these two producers and not on the markup of
producer 3.

Example K.2. We consider a simple example with two elasticities of substitution, which
demonstrates the principle that changes in misallocation are driven by how each node

                                                    92
switches its demand across its supply chain in response to a shock. To this end, we apply
Proposition 2 to the economy depicted in Figure 13.

                                                       L




                            3                          4                 2




                                          1




                                                       HH

               Figure 13: An economy with two elasticities of substitution.



            d log Y         1          h                                                 i
                     =λ̃3 −    (θ0 − 1) b1 (ω13 µ−1 (ω   µ
                                                       13 3
                                                           −1
                                                              +  ω   µ
                                                                   14 4
                                                                       −1
                                                                          )) − ω     b Λ
                                                                                   13 1 L
            d log A3        ΛL                   1
                                      h                                     i
                                 1 λ1 ω13 µ3 − ω13 ω13 µ3 + ω14 µ4
                       +(θ1 − 1)µ−1         −1                −1          −1
                                                                                 .

The term multiplying (θ0 − 1) captures how the household will shift their demand across
1 and 2 in response to the productivity shock, and the relative degrees of misallocation in
1 and 2’s supply chains. The term multiplying (θ1 − 1) takes into account how 1 will shift
its demand across 3 and 4 and the relative amount of misallocation of labor between 3 and
4. Not surprisingly, if instead we shock industry 1, then only the household’s elasticity of
substitution matters, since industry 1 will not shift its demand across its inputs in response
to the shock to industry 2:

                 d log Y        1          h                                i
                          =b1 −    (θ0 − 1) b1 µ−1
                                                1 (ω13 µ3 + ω14 µ4 ) − b1 ΛL .
                                                        −1       −1
                 d log A1       ΛL



This illustrates the general principle in Proposition 2 that an elasticity of substitution θ j
matters only if j is somewhere downstream from k.

                                                  93
Example K.3. We build a simple example to illustrate the macroeconomic impact of mi-
croeconomic markup/wedge shocks and their difference with microeconomic productivity
shocks.
   We consider a Cobb-Douglas economy, which helps to isolate the importance of the new
term in Proposition 3. For a Cobb-Douglas economy, the only source factor reallocation
comes from the fact that the producer which increases its markup/wedge releases some
labor. Let θ j = 1 for every j, which is the Cobb-Douglas special case. Now, applying
Proposition 3, we get

                                             ΨkL            λk ΨkL
                                                                   !
                        d log Y
                                 = −λ̃k + λk     = −λ̃k 1 −          .
                        d log µk             ΛL             λ̃k ΛL

As before, ΨkL /ΛL is a measure of how distorted the supply chain of k is relative to the
economy as a whole. If ΨkL /ΛL < 1, then this means that for each dollar k earns, a
smaller share reaches workers than it would if that dollar was spent by the household. In
other words, producer k’s supply chain has inefficiently too few workers. On the other
hand, λk /λ̃k is a measure of how distorted the demand of chain of k is. If λk /λ̃k < 1, this
implies that k is facing double-marginalization. When the product of the downstream
and upstream terms is less than one, this means that producer k is inefficiently starved of
demand and workers. Hence, an increase in the markup/wedge of k reduces the allocative
efficiency of the economy. On the other hand, when the product of these two terms is
greater than one, the path connecting the household to labor via producer k is too large.
Therefore, an increase in the markup/wedge of k reallocates resources to the rest of the
economy where they are more needed and increases allocative efficiency.
    With multiple factors, we get
                                                                                   
                 d log Y                X        Ψk f            λk X       Ψ kf 
                                                                                    
                          = −λ̃k + λk       Λ̃ f      = −λ̃k 1 −       Λ̃ f       .
                                                                                    
                 d log µk                        Λf                λ̃k f      Λ f 
                                        f


This generalizes the intuitions discussed earlier for markup/wedge shocks in the Cobb-
Douglas economy with a single factor to the case of multiple factors. In particular, the
amount of factor f released by sector k as a fraction of total factor f per unit of shock is
λk Ψk f /Λ f and the impact of that release on output per unit of shock is Λ̃ f . We also see
again the roles of the index of downstream distortions λk /λ̃k and of the generalized index
of upstream distortions f Λ̃ f Ψk f /Λ f .
                          P


Example K.4. We consider an example showing how, in general, the correlation between
productivity and wedges matters. Consider the horizontal economy example discussed in

                                                 94
Section 5.1, but instead of assuming log-normality, consider the binomial case where Ai ∈
{0, A} with probability 1/2 and ∆ log µi ∈ {0, ∆ log µ} with probability 1/2. An immediate
application of formula (19) shows that L ≈ (1/8)θ0 (∆ log µ)2 if Ai and µi are independent,
but that L ≈ 0 if Ai and µi are perfectly correlated.


Appendix L Volatility of Aggregate TFP
In this section, we use the quantitative structural model of Section 7.3 to assess the
volatility of aggregate output arising from firm-level and industry-level productivity and
markup shocks.14 For this section, we do not assume that each Compustat firms’ share
of industry sales in Compustat is the same as its share of total industry sales in the BEA
data. Instead, we assign to each firm its actual sales, and assume that any leftover sales are
sold by a residual producer whose markup is equal to the average industry-level markup
and who experiences no shocks (this effectively means we assume that the residual (non-
Compustat) producer in each industry is really a representative of a mass of infinitesimal
firms and experiences no shocks due to the law of large numbers).
    We use our ex-post structural results on the elasticities of aggregate output to these
shocks                            X d log Y               X d log Y
                  log Y ≈ log Y +             d log Ai +              d log µi ,
                                   i
                                     d log Ai              i
                                                             d log µi

to approximate the implied volatility of output in response to microeconomic shocks.
Assuming productivity shocks and markup shocks are independent and identically dis-
tributed, get

                        X d log Y !2                  X d log Y !2
           Var(log Y) ≈              Var(d log Ai ) +              Var(d log µi ),
                        i
                          d log Ai                    i
                                                        d log µi
                         = kDlog A log Yk2 Var(d log A) + kDlog µ log Yk2 Var(d log µ).

Hence, the Euclidean norm kDlog A log Yk of the Jacobian of log Y with respect to log A
gives the degree to which microeconomic productivity shocks are not “diversified” away
in the aggregate. Similarly, kDlog µ log Yk measures the diversification factor relative to
markup shocks.15
   14
       When we consider firm-level shocks, we assess only the contribution of shocks to Compustat firms, i.e.
we account for the macro-volatility arising from firm-level shocks when only Compustat firms are being
shocked, and not non-Compustat firms. We focus on this exercise because we do not have the data required
to compute the contribution of shocks to all firms.
    15
       Although Baqaee and Farhi (2017) suggest that log-linear approximations can be unreliable for model-


                                                     95
                                               Benchmark        Competitive       Cobb-Douglas         Constant X

 Firm Productivity Shocks (UC)                 0.0491           0.0376            0.0396               0.0396
 Firm Markup Shocks (UC)                       0.0296           0.0000            0.0077               0.0000
 Industry Productivity Shocks (UC)             0.3162           0.3118            0.3259               0.3259
 Industry Markup Shocks (UC)                   0.0084           0.0000            0.0391               0.0000



 Firm Productivity Shocks (AP)                 0.0524           0.0376            0.0415               0.0415
 Firm Markup Shocks (AP)                       0.0368           0.0000            0.0085               0.0000
 Industry Productivity Shocks (AP)             0.3188           0.3118            0.3375               0.3375
 Industry Markup Shocks (AP)                   0.0127           0.0000            0.0500               0.0000



 Firm Productivity Shocks (PF)                 0.0598           0.0376            0.0398               0.0398
 Firm Markup Shocks (PF)                       0.0321           0.0000            0.0112               0.0000
 Industry Productivity Shocks (PF)             0.3299           0.3418            0.3618               0.3618
 Industry Markup Shocks (PF)                   0.0216           0.0000            0.0760               0.0000


Table 3: Diversification factor for different productivity and markup shocks at firm and
industry level for different specifications of the model. A diversification factor of 1 means
that the variance of microeconomic shocks moves aggregate variance one-for-one. A
diversification factor of 0 means that microeconomic shocks are completely diversified
away at the aggregate level. The final column is the allocation that holds the allocation
matrix X constant in response to shocks.


    Table 3 displays the diversification factor, for both markup shocks and productivity
shocks at the firm level and at the industry level, for our benchmark model. We also com-
pute the results for a Cobb-Douglas distorted economy where all elasticities are unitary, as
well as for a perfectly competitive model without wedges. Across the board, the distorted
model is more volatile than the competitive model, however the extent of this depends
greatly on the type of shock and the level of aggregation. We discuss these different cases
in turn.
    First, consider the case of productivity shocks: as mentioned previously, the benchmark
model is more volatile than the perfectly competitive model for both sets of shocks.
ing the mean, skewness, or kurtosis of output in the presence of microeconomic shocks, their results indicate
the log-linear approximations of variance are less fragile (although still imperfect). In the final section of
this paper, we discuss how our results can be extended to understanding the nonlinear impact of shocks.



                                                     96
However, the more interesting comparison is with respect to the distorted Cobb-Douglas
economy. As explained in Section 4, the allocation of factors is invariant to productivity
shocks in the Cobb-Douglas model. Hence, the Cobb-Douglas model lacks the reallocation
channel, and hence can tell us in which direction the reallocation force is pushing. In
the case of industry-level shocks, the benchmark model is slightly less volatile than the
Cobb-Douglas model, whereas in the case of firm-level shocks, the benchmark model is
significantly more volatile.
    A partial intuition here relates to the elasticities of substitution: whereas industries
are complements, firms within an industry are strong substitutes. Recall that loosely
speaking, changes in allocative efficiency scale with the elasticity of substitution minus
one. Firm-level shocks cause a considerable amount of changes in allocative efficiency
whereas industry-level shocks cause much milder changes. At both levels of aggregation,
these changes in allocative efficiency amplify some shocks and mitigate some others
compared to the Cobb-Douglas model with no change in allocative efficiency.16 On the
whole, at the firm level, the changes in allocative efficiency are so large that they dwarf the
pure technology effects picked up by the Cobb-Douglas model and amplify the volatility
of these shocks. By contrast, at the industry level, changes in allocative efficiency are more
moderate and turn out to slightly mitigate the volatility of these shocks.
    These intuitions are confirmed in the first two columns of Figure 14, where we plot the
output elasticity with respect to productivity shocks to specific firms or industries relative
to their revenue-based Domar weight. This represents a comparison of our benchmark
model to a competitive model where Hulten’s theorem holds. We find considerable
dispersion in the response of the model relative to both, but much more so at the firm
level than at the industry level. We could plot the same graph but with the cost-based
Domar weight as a reference point in order to represent the comparison of our benchmark
model to the Cobb-Douglas model, and the results would be visually similar.
    Next, consider the effects of markup shocks. In this case, the distorted Cobb-Douglas
economy is not necessarily a very natural benchmark since even with Cobb-Douglas,
shocks to markups will reallocate factors across producers. Nonetheless, it is still instruc-
tive to compare the benchmark model to the Cobb-Douglas one to find that a similar
lesson applies as with productivity shocks. The volatility of firm-level shocks is amplified
relative to Cobb-Douglas while the volatility of industry-level shocks is attenuated rela-
tive to Cobb-Douglas. This follows from the fact that industries are more complementary
than firms, and hence, in line with the intuition from the horizontal economy, the effect
   16
     There is another difference: reallocation occurs towards the firm receiving a positive shock; but reallo-
cation occurs away from the industry receiving a positive shock.


                                                     97
                                 (a)                                                        (b)


     number                                                             200




                                                               number
              100
                                                                        100



                  0                                                         0
                  −5.00          0.00              5.00                     −5.00           0.00        5.00

                                 (c)                                                        (d)




                 20
        number




                                                                  number
                                                                           10



                                                                                                        *
                                               *
                  0                                                         0
                   0.80   1.00          1.20                                −0.10   −0.05     0.00   0.05

Figure 14: The left column contains histograms of d log Y/ d log A and the right
d log Y/ d log µ relative to λ for firm-level and industry-level shocks respectively. The
top row are shocks to firms and the bottom row are shocks to industries. The bunching
at the extremes, winsorizing at 4 standard deviations, marked with a star arise solely for
displaying purposes. In all cases, the degree of dispersion around the response implied
by the competitive model (the size of the producer) is substantial.

of the shock are monotonically increasing in the degree of substitutability. The last two
columns of Figure 14 plot the output elasticity with respect to markup shocks to specific
firms or industries relative to their revenue-based Domar weight.


Online References
Ackerberg, D. A., K. Caves, and G. Frazer (2015). Identification properties of recent
 production function estimators. Econometrica 83(6), 2411–2451.

Atkeson, A. and A. Burstein (2008). Pricing-to-market, trade costs, and international
  relative prices. American Economic Review 98(5), 1998–2031.

Baqaee, D. R. and E. Farhi (2017). The macroeconomic impact of microeconomic shocks:
  Beyond Hulten’s Theorem.

Claus, J. and J. Thomas (2001). Equity premia as low as three percent? evidence from
  analysts’ earnings forecasts for domestic and international stock markets. The Journal of
  Finance 56(5), 1629–1666.

                                                          98
De Loecker, J., J. Eeckhout, and G. Unger (2019). The rise of market power and the
 macroeconomic implications. Technical report, National Bureau of Economic Research.

Gutiérrez, G. and T. Philippon (2016). Investment-less growth: An empirical investigation.
 Technical report, National Bureau of Economic Research.

Hall, R. E. (1988). The relation between price and marginal cost in us industry. Journal of
 political Economy 96(5), 921–947.

Jones, C. I. (2011). Intermediate goods and weak links in the theory of economic develop-
  ment. American Economic Journal: Macroeconomics, 1–28.

Levinsohn, J. and A. Petrin (2003). Estimating production functions using inputs to control
  for unobservables. The review of economic studies 70(2), 317–341.

Olley, G. S. and A. Pakes (1996). The dynamics of productivity in the telecommunications
  equipment industry. Econometrica: Journal of the Econometric Society, 1263–1297.




                                            99
