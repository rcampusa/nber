                              NBER WORKING PAPER SERIES




      A MARKET BASED SOLUTION FOR FIRE SALES AND OTHER PECUNIARY
                            EXTERNALITIES

                                    Weerachart T. Kilenthong
                                     Robert M. Townsend

                                       Working Paper 22056
                               http://www.nber.org/papers/w22056


                     NATIONAL BUREAU OF ECONOMIC RESEARCH
                              1050 Massachusetts Avenue
                                Cambridge, MA 02138
                                     March 2016




Tee Kilenthong is grateful to financial support from UTCC. Robert Townsend is grateful to
financial support from the NICHD under grant R01 HD027638, the CEPR and the DFID under
grant MRG002 1255, the John Templeton Foundation, and the CFSP at the University of Chicago
through a grant from the Bill & Melinda Gates Foundation. The findings and conclusions
contained in the report are those of the author(s) and do not necessarily represent the views of the
funders, nor of the National Bureau of Economic Research.

NBER working papers are circulated for discussion and comment purposes. They have not been
peer-reviewed or been subject to the review by the NBER Board of Directors that accompanies
official NBER publications.

© 2016 by Weerachart T. Kilenthong and Robert M. Townsend. All rights reserved. Short
sections of text, not to exceed two paragraphs, may be quoted without explicit permission
provided that full credit, including © notice, is given to the source.
A Market Based Solution for Fire Sales and Other Pecuniary Externalities
Weerachart T. Kilenthong and Robert M. Townsend
NBER Working Paper No. 22056
March 2016
JEL No. D52,D53,D61,D62

                                         ABSTRACT

We show how bundling, exclusivity and additional markets internalize fire sale and other
pecuniary externalities. Ex ante competition can achieve a constrained efficient allocation. The
solution can be put rather simply: create segregated market exchanges which specify prices in
advance and price the right to trade in these markets so that participant types pay, or are
compensated, consistent with the market exchange they choose and that type's excess demand
contribution to the price in that exchange. We do not need to identify and quantify some policy
intervention. With the appropriate ex ante design we can let markets solve the problem.


Weerachart T. Kilenthong
Faculty of Economics, and
Research Institute for Policy Evaluation and Desig
University of the Thai Chamber of Commerce
126/1 Vibhavadee-Rangsit, Dindaeng
Bangkok 10400
Thailand
tee@riped.utcc.ac.th

Robert M. Townsend
Department of Economics, E52-538
MIT
77 Massachusetts Avenue
Cambridge, MA 02139
and NBER
rtownsen@mit.edu
1         Introduction
Our paper is a tale of several literatures and the importance of bringing them together.
One in the wake of the financial crisis is a literature on pecuniary externalities that has
regained the interest of researchers as they seek policy interventions and regulations to
remedy externality-induced distortions, e.g., balance sheet effects, amplifiers and fire sales.
Solutions range from regulation of portfolios, restrictions on saving or credit, interest rate re-
strictions, fiscal policy, or taxes and subsidies levied by the government1 . A second literature
in the general equilibrium tradition is the exogenous incomplete security markets literature,
which shows generically that competitive equilibria are inefficient. However, there is a third
literature in general equilibrium theory which dates back to work of one of the founding
fathers, Arrow (1969), namely how bundling, exclusivity and suitably designed additional
markets can internalize externalities, without the need of further policy interventions (or
the need to quantify those interventions). In this world ex ante competition and equilib-
rium, market-determined prices for rights to trade in these additional markets can achieve a
constrained-efficient allocation. The contribution of our paper can be seen as bridging the
gap among these literatures and, more importantly, formulating a proposal for an ex ante
optimal market design of financial markets which eliminates fire sales inefficiencies and other
pecuniary externalities. What we do does have precedents in the literature: Coase (1960)
who specifies property rights to remedy externalities (related to the cap and trade idea in
pollution) and Lindahl (1958) who uses agent specific prices to solve a public goods problem.
We build on these ideas but provide new results.
        As pointed out by Lorenzoni (2008) and many others2 , both developed and emerging
economies have experienced episodes of rapid credit expansion followed, in some cases, by
a financial crisis, with a collapse in asset prices, credit, and investment. As an example, he
takes the case of the banking sector in Thailand prior to the crisis of 1997. In the first half
of the 1990s, Thai banks increased their investment in real estate. When the crisis erupted,
    1
        See, for example, Bianchi (2010); Bianchi and Mendoza (2012); Farhi et al. (2009); Jeanne and Korinek
(2013); Korinek (2010).
   2
     For the main stylized facts on boom-bust cycles, see Bordo and Jeanne (2002); Gourinchas et al. (2001);
Tornell and Westermann (2002), and many others.



                                                       2
the fall in real estate prices eroded the real estate value of those collateral guarantees. This
prompted a cut in bank lending, which in turn, led to a further reduction in the demand for
real estate and a further drop in real estate prices. This is but one example. There is also a
literature on fire sales in New York financial markets, e.g Begalle et al. (2013); Duarte and
Eisenbach (2014); Gorton and Metrick (2012); Krishnamurthy et al. (2012).
   However, as Lorenzoni (2008) emphasizes, if the private sector had accurate expectations
and correctly incorporated risk in its optimal decisions, yet still decided to borrow heavily
during booms, it means that the expected gain from increased investment more than com-
pensated for the expected costs of financial distress. Thus one needs to understand how,
and under what conditions, this private calculation leads to inefficient decisions at the social
level. The answer is that since they are atomistic, private agents do not take into account
the general equilibrium effect of asset purchases and subsequent sales on prices. We empha-
size here that this general equilibrium effect kicks in only when contracts and markets are
limited by obstacles to trade that depend on prices, such as collateral constraints, that the
value of a contracted promise to pay cannot exceed the value of the associated collateral
which is marked to spot prices. This is the pecuniary externality that is at the basis of the
inefficiency result. Indeed in Geanakoplos and Polemarchakis (1986) more generally, the key
is that prices enter into constraints beyond budgets so that the set of feasible allocations at
the individual level is moving around with the decisions of others as those decisions influence
those prices.
   Now we go back to Arrow (1969) for some insights about how to remedy such problems.
He deals directly with the most obvious specification of a non-pecuniary externality, prefer-
ences that depend on what others are consuming. Suppose the utility function of each agent
depends not only on her own consumption of each commodity, but also the consumption of
commodities of the other agents. Still, in a standard competitive equilibrium, each agent
buys her own consumption goods and has no control over the consumption of others, though
she does care about this. From the first order condition, taking advantage of the insight
that the marginal utility of income in the budget is equal to the inverse Pareto weight in the
planning problem, the weighted marginal utility of consumption for a given commodity of
each agent is equal to the price of that commodity. In contrast a Pareto optimal allocation


                                               3
of resources can be characterized by maximizing a Pareto weighted sum of utilities subject
to resource constraints for each commodity, that consumption not exceed aggregate endow-
ment. As consumption of a given commodity for a given household enters into the utility of
all of them, the first- order condition is that the weighted sum of marginal utilities equal the
common shadow price of that commodity. Obviously, the first order conditions to these two
problems, necessary for competitive equilibrium and optimality, respectively, do not match.
The competitive equilibrium is inefficient due to the externality.
   Arrow (1969) then writes down an equivalent programming problem for the determination
of optima with a subtle shift in notation which, nevertheless, embodies in it a lot of the
economics. Namely, Arrow extends the commodity space letting each given agent have the
right to specify the consumption of the others, as if buying the consumption of others, so that
as far as the given agent is concerned, this looks like a normal private ownership economy
without externalities. Notationally, the variables appearing in the utility function relating
to the given named agent are proper to him alone and appear in no one else’s utility. But
this is done for every agent. This then necessitates another equation which specifies that
what every single agent wants some other target agent to consume is exactly the same, what
all of them want for that agent, and is what that target agent is actually consuming. This
consistency in assignments is an explicit extra constraint in the programming problem. Both
this and the usual resource constraints pick up Lagrange multipliers. The first is like a price
for the right of a given agent to specify consumption of a given commodity for another named
agent, and the second is the common price of the underlying commodity. The first order
condition for a given agent is that her weighted marginal utility of consumption of the good
of the other target agent equals the shadow price in the consistency constraint, the price of
rights. The other first order condition is that the sum over all agents of these prices of rights
equals the price of the underlying commodity. Thus, by substitution, the sum of weighted
marginal utilities for a given commodity of a given agent will equal the common shadow
price of that commodity, the same overall optimum condition as before.
   The real point is that it is now a short step to decentralize the rewritten optimum problem
so that it can be achieved as competitive equilibrium with prices that correspond to the above
shadow prices, everyone acting in their own narrow self interest only, not worrying about


                                               4
over all consistency in assignments nor market clearing, though everything is consistent in
equilibrium. The problem of an agent as consumer is to maximize utility by specifying
consumption not only for herself but for each of the others, and each of these consumptions
has a rights price. The sum of expenses cannot exceed wealth. The problem of an agent as
supplier is to maximize profits from buying a consumption good and then selling the rights to
specify her own consumption to the others, thus receiving the sum of rights prices that each
of the others is willing to pay. Essentially, for these concave Lagrangian problems (utilities
can be assumed to be concave, resources and assignment constraints are linear, budgets
are linear, etc.) first order conditions are not only necessary but also sufficient. Thus the
allocations of the decentralized market solution and the centralized planner problem are the
same. Both are optimal.
   Likewise, as Arrow (1969) does, one might have supposed that each agent cares about
the sum of consumption of a given commodity in the population. Then obviously the rights
prices for assigning consumption to one target agent is the same as assigning to any other
target agent. By extension, one might have supposed that ratios of commodity aggregates
enter into utility functions directly. What we do in our first leading example, since we
care about pecuniary rather than non-pecuniary externalities, is closely related but a bit
different. We let prices enter into collateral constraints and, with homothetic utilities, prices
are determined by ratios of commodity aggregates. So in this first example we can naturally
refer to the commodity ratio as the market fundamental, as it alone determines prices. Then,
to internalize the externality following Arrow, we extend the commodity space so that in the
decentralized competitive problem agents can buy the right to specify any ratio of commodity
aggregates they want as if they had ownership over that ratio as well as the quantity they
wish to buy or sell at that market fundamental. But of course these rights have market
prices, as we now explain in more detail.
   As a buyer, the object is the number of rights purchased, namely, the fundamental ratio
which determines the price and positive excess demand at that price. As a seller, the agent
specifies the fundamental ratio and negative excess demand at that associated price, so that
such an agent is compensated for agreeing to trade a given market fundamental. The size
and sign of the discrepancy, which can be positive or negative, is the difference between an


                                               5
agent’s pretrade endowment ratio, inclusive of collateral, and the overall market average3 .
Conceivably an agent’s net excess demand at the fundamental could be zero, in which case
nothing is paid or received for specifying that fundamental. In general though there will
be active trade among some agent types. But the sum of type-weighted discrepancies must
by construction be zero (not everyone can be above average in equilibrium). The intuition,
again, apart from scale parameters, is that a type’s discrepancy is its net excess demand,
and consistency thus requires that the type weighted sum of excess demands be zero in any
equilibrium. That is, a type’s “contribution” to the price is that type’s excess demand.
Market determined prices will allow agents to pay or be paid for their “contribution”.
       Importantly, security trades and the rights to trade at spot prices are tied together. A
security is a promise made by the issuer to the investor and the associated, specified collateral
that goes with the promise. The spot market specifies in addition the value of collateral ex
post, the unwind price. That price is now for us here also an intrinsic part of the security.
       This is related to but not identical with Lindahl’s pricing of public goods. With the
latter, each agent can buy the amount of the public good they want at an agent specific
price. Under individual agent maximization, that agent’s price is equal to that agent’s
marginal utility gain. A producer of the public good then maximizes revenue as the sum of
the per unit prices times the quantity produced less production cost. This yields the sum
of marginal utilities equal to the marginal cost, an optimum, achieved in a decentralized
market with agent specific prices for rights to specify the quantity of the public good. In
equilibrium the amount of the public good is common to all of the agents, but there are
agent-specific prices. In contrast, in what we do, the relevant quantity is the agent-specific
excess demand, which can be positive, negative, or zero, which can vary over agent types,
and in equilibrium must sum to zero. The price per unit excess demand is common, not
   3
       This object is related to consumption rights in Bisin and Gottardi (2006), which internalizes the con-
sumption externality due to adverse selection problem. The key difference is that our “discrepancy from the
market fundamental” only requires own type information (endowments and savings/collateral position) and
the knowledge of the equilibrium price, which is a standard Walrasian assumption, while the determination
of the consumption rights for each type in an adverse selection environment utilizes information on other
types (see Eq. (3.2) in Bisin and Gottardi (2010) which specifies correct conjectures of what other types are
doing and the related no-envy conditions in Prescott and Townsend (1984a,b)).


                                                       6
agent specific, but quantities demanded or supplied are agent specific. Thus agent types
have varying levels of expenditures. Bewley (1981) rigorously establishes Tiebout’s result
but argues that it requires special assumptions and that is not true in general. Lindahl prices
can work but in his view they eliminate the essential part of the public goods problem. We
note in particular that without Lindahl pricing, without taxes, and with the quantity of
public goods in common, expenditure must be the same across agent types.4 For us, prices
are the same across types, so no Lindahl pricing, but quantities, the excess demands, vary
because excess demands are different across different types. This makes the point that our
formulation is different from public goods or pollution in that these quantities are held
in common, whereas in our formulation agent types are buying the rights to a price and to
trade their own specific excess demand at that price (which is what influences the equilibrium
price).
       Equilibrium is achieved by adding a supply side, a set of competitive broker dealers who
put together deals with the various agent types and make markets, that is, ensure that in
equilibrium supply and demand for securities in the initial market and the demand for rights
all net to zero. Indeed, any one broker dealer is of negligible size, and each takes prices
as given, so with constant returns to scale in clearing in securities and rights to trade, this
generates the equilibrium fees for the market exchanges (platforms) and the rights to trade
there. The important point is that the overall Walrasian equilibrium is efficient.
       In our second leading example, a classic environment with incomplete securities, spot
markets are essential. Dropping homotheticity, we no longer refer to a market fundamental
per se; the aggregate excess demand can be a high dimensional and complex mapping from
the entire array of individual pre trade endowments. Further, securities need not be state
dependent, so a given trade in securities ex ante can have implications for the distribution of
income across states; with insufficient ways to hedge, this is precisely why a standard incom-
plete market equilibrium can be generically inefficient (e.g., Geanakoplos and Polemarchakis,
1986; Greenwald and Stiglitz, 1986). Here, to remove the externality, we do not expand the
   4
       This is the reason why the analogy of our approach to pollution, and cap and trade, breaks down. With
pollution there is a common level and agents pay for the right to pollute. For us, the problem is two sided,
with the position having to do with the influence on the price, and positions must net to zero.



                                                      7
set of securities. We do not complete the markets of securities. Rather we do expand the
types of markets. We allow forward contracting in the price vector (with dimension equals to
the number of states). A given segregated exchange specifies a given price vector. We allow
in principle many possible vectors, hence many possible exchanges. Agent types are buying
the rights to trade at these spot prices. We specify the quantities of rights to trade as the
vector of excess demands over states given any chosen segregated exchange. These rights are
priced so that in equilibrium these exchanges clear. There are active exchanges with trade
that clear in the usual sense and inactive exchanges with no trade that clear trivially, with
no trade by anyone.
       Finally, with these two examples in hand, we generalize our arguments to a large class
of environments. These include that of Lorenzoni (2008), which is a cousin to our collateral
example; Hart and Zingales (2013), which is a cousin to our incomplete market example;
and we extend to information imperfections, a moral hazard contract economy with multiple
goods and retrade in spot markets, and a Diamond-Dybvig preference shock economy with
retrade in bond markets. In none of these do we actually recover the first best optimum but
rather remove the externality and deliver a constrained efficient allocation. The key, and
common ingredient across environments, is a set of constraints which contain prices.
       The analysis requires excludability (hence the term segregation above). Interestingly,
Arrow (1969) is less concerned about excludability, an intrinsic part of creating the necessary
markets, as he feels this has a natural counterpart in many, though not all, real world
problems. We take this up in our implementation section. Arrow (1969) is more concerned
about the obvious small numbers problem. That is, his markets are not thick. There is
only one supplier of the own-specific commodity, for example. So while the price-taking
assumption of the Walrasian equilibrium allows one to carry out the analysis above, it is
not realistic. However, this part is easy to remedy if we consider limit economies with a
continuum of traders and positive mass of each traders type, identical in preferences and
endowments within type.5
   5
       In both the optimum problem and the decentralized problem we restrict attention to type symmetric
allocations (a core allocation has to have this property or otherwise it can be blocked and the maximization
problem facing each agent of a given type is identical. Then the populations weights are in both sides of



                                                     8
    There is, however, an assignment problem that allows yet another extension of the com-
modity space and reinforces the notion of excludability. Due to some inherent nonconvexities
in the way prices enter into constraints, namely collateral times the price of collateral as in
our first example economy, it may be necessary to convexify the problem by allowing mix-
tures. These are priced so that in the decentralized problem each agent can control the
probability that they are assigned to given markets and are excluded from others. What is
a probability in the way an individual of a given type is treated from the individual point
of view is also a fraction of the way that type is treated in the aggregate. The continuum
sets of agent types allows us to do this. Thus resource constraints, market clearing, and
broker dealer technologies are relatively easy to write down and do not involve lotteries. The
lotteries at the individual level, and mixtures at the aggregate level, are part of our techni-
cal apparatus, working for us much the way it does for Koopmans and Beckmann (1957);
Prescott and Townsend (1984a,b); Prescott and Townsend (2006).
    We emphasize also that our proofs in space of mixtures are standard in that preferences,
upper contour sets, are convex and constraints are linear. Further, in many applications these
individual lotteries are degenerate, that is, agents purchase deterministic assignments, so the
notation of a lottery is essentially only an indicator function. But in other environments they
do play an active role, and we display an example.
    The remainder of the paper proceeds as follows. Section 2 presents two key leading
examples including a collateral economy and an exogenous incomplete markets economy.
Section 3 describes briefly how to map a large variety of example economies into a general-
ized framework in which our market-based solution concept is applicable. We discuss how to
implement our market-based solution in the financial markets in Section 4. Section 5 con-
cludes. Appendix A generalizes to mixtures and Appendix B contains some formal proofs.
Additional results are contained in Appendix C.
first order conditions and cancel out.) The intuition above remains exactly the same.




                                                    9
2     Leading Examples
This section features two example economies, a collateral economy (Kilenthong and Townsend,
2014b) and an exogenous incomplete markets economy (Geanakoplos and Polemarchakis,
1986; Greenwald and Stiglitz, 1986).


2.1    A Collateral Constrained Economy

This is a two-period economy, t = 0, 1. All financial (debt and insurance) contracts are
traded in period t = 0, henceforth called the “contracting period”. In addition, in period
t = 0, both of two consumption goods can be traded and consumed. All contracts will be
executed in period t = 1, henceforth called the “execution period”. The two goods are also
traded there. There are a finite number S of possible states of nature in this execution period
t = 1, i.e., s = 1, 2, ..., S. This allows as a special case S = 1, so there is only intertemporal
trade, borrowing and lending, from t = 0 to t = 1. For S > 1 in which contingent claims,
Arrow-Debreu securities are traded, let 0 < πs < 1 be the objective, commonly assessed,
                                                  P
and actual probability of state s occurring, where s πs = 1. Again, the two underlying
goods can be traded and consumed in each state s. We refer to these t = 1 markets as spot
markets.
    The two underlying goods are called good 1 and good 2. Good 1 cannot be stored (is
completely perishable), while good 2 is storable from t = 0 to t = 1. Good 2 can serve
as collateral to back promises issued in the contracting period. Henceforth, good 2 and the
collateral good will be referred to interchangeably. Furthermore, good 1 will be the numeraire
good in every date and state. The price in terms of the numeraire at which the collateral
good 2 can be unwound in spot markets is the key object associated with the pecuniary
externality.
    There is a continuum of agents of measure one. The agents are however divided into H
heterogeneous types, each of which is indexed by h = 1, 2, · · · , H. Each type h consists of
αh ∈ (0, 1) fraction of the population, so that h αh = 1. Each agent type h is endowed
                                                  P
                                                                                        
with good 1 and good 2, eh0 = eh10 , eh20 ∈ R2+ in period t = 0 and ehs = eh1s , eh2s ∈ R2+ ,
                                                                             2(1+S)
in each state s = 1, · · · , S at period t = 1. Let eh = eh0 , · · · , ehS ∈ R+      be the entire


                                               10
endowment profile of agent type h over period t = 0 and all states s in period t = 1. As a
notational convention, vectors or matrices will be represented by bold letters. Heterogeneity
of agents originates in part from the endowment profiles eh (and not in preferences, but
we could easily allow this extension). We also assume that the endowments in all periods
and all states are publicly known. Hence, the limited commitment considered in this paper
comes from a contract enforceability problem, not from an informational problem. But see
our comments in Section 3 on generalizations.
   Let k h ∈ R+ denote the collateral holding (equivalent to the holding of good 2) of an
agent type h at the end of period t = 0 to be carried to period t = 1. Note that this collateral
allocation does not need to be equal to the initial endowment of good 2, eh20 . In particular,
since good 2 can be exchanged or acquired in the contracting period (at date t = 0), k h
will be equal to the net-position in the collateral good after trading in period t = 0. The
collateral good as legal collateral backing claims is assumed to be fully registered and kept
in escrow, i.e., cannot be taken away or stolen neither by borrowers nor lenders. However,
the holding of good 2 can also include normal saving. The storage technology of good 2,
whether in collateral or normal savings, is linear but with a potentially random return. In
some applications, it is natural to treat the returns as a constant and focus on how collateral
interacts with intertemporal trade. In other applications, the risk is in the collateral itself.
Each unit of good 2 stored will become Rs units of good 2 in state s = 1, · · · , S. Specifically,
storing I units of good 2 at date t = 0 will deliver Rs I units of good 2 in state s at t = 1.
   The contemporary preferences of agent type h are represented by the utility function
           
u ch1 , ch2 : R2+ → R, which is assumed to be continuous, strictly concave, strictly increasing
in both consumption goods, and to satisfy the usual Inada conditions. Let 0 < β ≤ 1 be the
common discount factor. The discounted expected utility of agent type h is thus
                                                                      S
                                                                      X
                              h   h
                                               ch10 , ch20                  πs u ch1s , ch2s
                                                                                             
                          U       c       ≡u                     +β
                                                                      s=1
                                                                     2(1+S)
where, as with the notation for endowments, ch = ch0 , · · · , chS ∈ R+      is the consumption
allocation.
   For full generality here, we will consider state-contingent securities as the primitives and
otherwise let the security structure be endogenous. That is, we are dealing with an Arrow-

                                                         11
Debreu complete security environment, but collateral will limit the securities which emerge
in equilibrium.6
       We consider at most only two classes of securities7 ; (i) θ1s
                                                                  h
                                                                     - securities paying in good 1 in
               h
state s, (ii) θ2s - securities paying in good 2 in state s. Here a positive number denotes the
purchaser or holder, and negative the issuer, the one making the promise. When negative,
each of the state-contingent securities must be backed. The collateral constraints for an
agent type h thus take the intuitive form

                                      ps Rs k h + θ1s
                                                   h        h
                                                      + ps θ2s ≥ 0, ∀s.                                     (1)

       The collateral constraint (1) states that, for each state s, the net-value of all assets,
                                                                    h       h
including collateral good and securities, must be non-negative. If θ1s and θ2s were negative,
as promises, we could write this as ps Rs k h ≥ −θ1s
                                                  h        h
                                                     − ps θ2s . That is, there is sufficient
collateral in value in state s to honor the value of all such promises. Note that all promises
are converted to units of good 1 using the spot market price of the collateral good ps .


2.1.1       Competitive Collateral Equilibrium (with an externality)

                                           h
Agents can trade in spot markets, and let τ`s be the amount of good ` = 1, 2 bought by an
agent type h in the spot markets at state s at prices ps , respectively. Let p0 be the price
   6
       A specific piece of collateral can be used to back up several contracts as long as their promises to pay
are in different states. Thus there is no conflict in a given state s. This is known as tranching. This is
distinct from the contract-specific collateralization structure (in Geanakoplos, 2003, among others), in which
the collateral of a given security cannot be used as collateral for any other security. A security which would
default has a known payoff structure, so we may as well start with that in the first place. So it can be shown
that there is no loss of generality in restricting attention to securities without default. But the possibility
of default does restrict securities, and collateral constraints can be binding. Further, issuing securities that
do default requires no less collateral than (an equivalent set of) securities that do not. See Kilenthong and
Townsend (2014b) for more details.
  7                                                h
    Actually with spot markets we need securities θ1s paying in the numeraire only. We proceed here in
more generality as what we do will not require active spot markets. As shown in Kilenthong and Townsend
(2014b), spot markets are redundant when all types of state contingent contracts are available ex-ante. In
other words, agents do not really need to trade in spot markets even though they may well do so. But
promises in ex ante markets still need to be backed by collateral in escrow.



                                                       12
of good 2 in period t = 0, and Q`s be the prices of securities in the ex ante t = 0 market
paying in good ` = 1, 2 in state s, respectively, all priced in the numeraire good 1 at t = 0.
For notational convenience, let p ≡ (p1 , . . . , pS ) and Q ≡ [Q`s ]`,s . A collateral equilibrium is
thus defined:

Definition 1. A competitive collateral equilibrium is a specification of prices (p0 , Q, p), and
an allocation ch0 , k h , θ h , τ h h such that
                                    


  (i) for any agent type h as a price taker, ch0 , k h , θ h , τ h solves
                                                                      

                                                   X
                                 u ch10 , ch20 + β   πs u eh1s + θ1s
                                                                  h     h
                                                                           , eh2s + Rs k h + θ2s
                                                                                              h     h
                                                                                                      
                   max                                               + τ1s                       + τ2s   (2)
             (ch0 ,kh ,θh ,τ h )                   s

      subject to the collateral constraints (1) for each state s, and the budget constraint at
      t = 0:
                                               X           X
                          ch10 + p0 ch20 + k h +       h
                                                  Q1s θ1s +        h
                                                              Q2s θ2s ≤ eh10 + p0 eh20 ,                     (3)
                                                               s                 s

      and the spot budget constraint at each state s:
                                                                h        h
                                                               τ1s + ps τ2s = 0,                             (4)

                                                                   h                       h
 (ii) markets clear for good 1 at t = 0, for good 2 at t = 0, for θ`s in state s, and for τ`s in
      state s, respectively:
                                                       X                   X
                                                               αh ch10 ≤             αh eh10 ,               (5)
                                                           h                 h
                                           X                    X
                                                 α ch20 + k h ≤
                                                   h
                                                                  αh eh20 ,
                                                            
                                                                                                             (6)
                                             h                               h
                                                       X
                                                               αh θ`s
                                                                   h
                                                                      = 0, ∀s; ` = 1, 2;                     (7)
                                                           h
                                                       X
                                                               αh τ`s
                                                                   h
                                                                      = 0, ∀s; ` = 1, 2;                     (8)
                                                           h

    The necessary maximizing condition for a collateral equilibrium (ce) related to collateral
allocation k h (an interior solution to the consumer problem) is given by, for any h,
                                                           h
                             uh       X       uh        X γcc−s
                       p0 = h20 =         πs β h2s Rs +      h
                                                                ps Rs ,                                      (9)
                             u10 ce     s
                                              u 10      s
                                                           u 10

                ∂u(ch
                    10 ,c20 )
                         h                 ∂u(ch
                                               1s ,c2s )
                                                    h
where uh`0 =       ∂c`0
                              ,   uh`s =      ∂c`s
                                                                              h
                                                           for ` = 1, 2, and γcc−s is the Lagrange multiplier for
the collateral constraint (1) in state s for an agent type h.

                                                                   13
2.1.2   Homothetic Preferences

In principle, the market-clearing prices in these spot markets depend on the distribution of
pretrade (before ex post spot trade) endowments across agents. So to generate intuition and
to allow closed-form solutions we make a strong simplifying assumption, namely homoth-
eticity. With identical homothetic preferences, the aggregate ratio of good 1 to good 2 in
state s is the market fundamental in state s, zs , that determines price ps = p (zs ); that is,
                                         P h h
                                            h α e1s
                               zs =                      ,                                  (10)
                                     Rs K + h αh eh2s
                                              P

where K = h αh k h is the aggregate (endogenous) saving including collateral. This is where
             P

we exploit the homotheticity assumption; ratios of the aggregate are enough to pin down
equilibrium prices ps .
                                 
   Now let ∆hs = zs eh2s + Rs k h − eh1s denote agent type h’s contribution to the equilibrium
price. The discrepancy ∆hs (zs ) thus reflects the good-2-weighted gap between the market
pretrade ratio and that of type h, namely, rewriting,

                                                                  eh1s
                                                                            
                          h         h         h
                                                
                        ∆s (zs ) = e2s + Rs k      zs −                          .         (11)
                                                             eh2s + Rs k h

This expression can be positive if k h is large so that agent type h is adding a lot of the
collateral good in state s, in effect lowering the price, or negative if say type h is well
endowed with good 1, raising the price. Finally note that ∆hs (zs ) for type h is a function of
both the market fundamental zs and type h’s own pretrade endowment, which if different
from zs will determine the extent of spot trade. If the discrepancy ∆hs (zs ) is positive there
is net excess demand for good 1 and net supply of good 2. In addition, summing over h,
weighted by mass of type h, αh , yields the following market clearing condition:
                      X                     X                    X h h
                              αh ∆hs = zs       αh eh2s + Rs k h − α e1s = 0,              (12)
                          h                 h                     h

where the last equality results from condition (10). In the ultimate decentralization below,
this will be a clearing condition for the rights to trade. It is the inclusion of both the
fundamental and the extent and direction of trade under that fundamental that removes
externalities. Both will be chosen by each agent type. This relates back to Arrow (1969).


                                                     14
2.1.3        Collateral Constrained Optimality

Attainable allocations are those that can be achieved by exchanges of securities and collateral
in date t = 0 as well as exchanges of consumption goods in date t = 1 at state s, but respect-
ing that agents can trade good 1 for good 2 freely in each state s, and the planner cannot
prevent it8 . In other words, a planner can only reallocate goods with the same instruments as
the agents, the security holdings and promises, and must respect the possibility of active spot
market trade. Thus the planner must respect the associated collateral constraints assigning
collateral to promises but allowing collateral to be unwound at the implicit or explicit spot
price inherent in the proposed allocation9 . Accordingly, attainable allocations are defined
using the spot-price function p(zs ). Likewise Geanakoplos and Polemarchakis (1986) search
for a Pareto improving allocation of assets recognizing the influence of an asset allocation on
spot prices, that spot prices are determined by the conditions that aggregate excess demands
must equal zero.10

Definition 2. An allocation ch0 , k h , θ h , τ h
                                                    
                                                    h
                                                         is attainable if

  (i) it satisfies resource constraints (5)-(8);

 (ii) for each agent type h, it satisfies the collateral constraints for each state s:

                                    p(zs )Rs k h + θ1s
                                                    h           h
                                                       + p(zs )θ2s ≥ 0, ∀s,                            (13)

         and the type h spot budget constraints

                                              h             h
                                             τ1s + p (zs ) τ2s = 0, ∀s;                                (14)


 (iii) the consistency constraint (10) holds for all s.

       A constrained optimal allocation is characterized using the following planner’s problem.
         h
Let U be the reservation utility level for an agent type h.
   8
       An individual agent, in contrast, has zero mass and no influence on prices regardless of the market
structure.
   9
     Or using a forward price ratio to value promises made in good 1 in terms of good 2, as in footnote 7.
  10
     See Section 7.2, page 87 in that paper.



                                                        15
Program 1. The Pareto Program with collateral constraints:
                                                         X
                                       u c110 , c120 + β   πs u e11s + θ1s
                                                                        1     1
                                                                                 , e12s + Rs k 1 + θ2s
                                                                                                    1     1
                                                                                                            
                  max                                                      + τ1s                       + τ2s     (15)
         ((ch0 ,kh ,θh ,τ h )h ,zs )                           s

subject to (5)-(8), (10), (13)-(14) and the participation constraint for each h = 2, · · · , H,
                                    X                                                        h
                  u ch10 , ch20 + β   πs u eh1s + θ1s
                                                   h     h
                                                            , eh2s + Rs k h + θ2s
                                                                               h     h
                                                                                       
                                                      + τ1s                       + τ2s   ≥ U ,                  (16)
                                            s

and non-negativity constraints for consumption and collateral allocations.

       As is typically the case, it suffices to consider only equal-treatment-of-equals in the Pareto
problem11 . Let µhcc−s , and µhū denote the Lagrange multipliers for the collateral constraint
(13) for agent h in state s, and for the participation constraint (16) for agent h, respectively.
For notational convenience, let µ1ū = 1. A necessary condition12 for constrained optimality
(op) related to collateral allocation k h is given by, for any h,


         uh20            X             uh2s      X µhcc−s              X αh p0 (zs ) ∂zs X
                     =         πs β         Rs +            p(zs )Rs −                     µh̃cc−s θ1s
                                                                                                    h̃
                                                                                                       , (17)
         uh10   op
                           s
                                       uh10      s
                                                   µ h h
                                                     ū u10            s
                                                                         µ h h p(z ) ∂K
                                                                           ū u 10 s
                                                                                                     h̃

                          ∂p(zs )
where p0 (zs ) =                                    αh k h .
                                            P
                           ∂zs
                                  ,    K=       h



2.1.4        The Externality

Note that an infinitesimal agent of type h takes a spot price, p(zs ), as invariant to his
or her own actions in the collateral equilibrium. To the contrary, the constrained planner
  11
       Again, for exposition simplicity and without any real loss, we consider only equal-treatment (for each
type), and interior solutions (i.e., the non-negativity constraint for k h is neglected). With homothetic
and strictly concave preferences, and no non-convexity, agents of the same type will optimally choose the
same allocation in an equilibrium; that is, given the same market prices in equilibrium. Thus, a collateral
equilibrium allocation has equal treatment of equals property. More generally, externalities in this class of
models, if they exist, have nothing to do with the equal treatment of equals property.
 12
    Given that the constraint set is not convex, this optimality condition is necessary but may not be
sufficient. Nevertheless, this does not cause any problem to our externality argument, as we simply need to
show that a collateral equilibrium cannot be constrained optimal, i.e. does not satisfy the necessary optimal
condition (17).



                                                                   16
can influence the spot prices p(zs ) through collateral assignments for the agents of type
h = 1, 2, . . . , H, in period t = 0, namely k h , which affect in turn the market fundamentals
                                                  p0 (zs ) ∂zs
zs . This key influence is the term in            p(zs ) ∂K
                                                               .   If the very last term in (17) were zero and
        h            µh
                      cc−s
we set γcc−s =        µh
                             , then condition (9) is exactly the same as (17), and there would be no
                        ū

externality. The last term in (17) could be zero if either µh̃cc−s = 0, that is, no collateral
                                           p0 (zs ) ∂zs
constraint is binding for any h̃ or        p(zs ) ∂K
                                                          = 0.13

Proposition 1. With continuous, strictly concave, strictly increasing, and identical homo-
thetic utility functions, a competitive collateral equilibrium is constrained optimal if and only
                                                     h
if all collateral constraints are not binding, i.e. γcc−s = µhcc−s = 0 for all h and all s.

Proof. See Appendix C.

       In particular when the very last term in (17) is not zero so not first-best, we can show that
it must be positive. As a result, the equilibrium price of good 2 in period t = 0 will be too
                                                                                                   uh
high relative to its shadow price from the (constrained) optimal allocation                         20
                                                                                                   uh
                                                                                                          .   In addition,
                                                                                                    10 op

this implies that the competitive collateral equilibrium level of (endogenous) aggregate saving
K ce is too large14 relative to the (constrained) optimal level of aggregate saving/collateral
K op . Intuitively, the planner can do better by lowering the aggregate saving/collateral. The
result is summarized in the following proposition.

Proposition 2. With continuous, strictly concave, strictly increasing, and identical homo-
thetic utility functions, if a competitive collateral equilibrium is not first-best optimal, then

                                                                                                          uh
  (i) the equilibrium price of good 2 in period t = 0, p0 , is too high, i.e., p0 >                        20
                                                                                                          uh
                                                                                                                 ,   and
                                                                                                           10 op


  13
       But under homothetic preferences the later is not possible. With a strictly concave utility function, the
                                                                               p0 (zs ) ∂zs
spot price varies with the market fundamental (is not constant), i.e.          p(zs ) ∂K      6= 0. As a result, when at
least one of the collateral constraints is binding, i.e., µh̃cc−s > 0 for some type h̃, the last term in (17) will be
non-zero. With this non-zero term, a collateral equilibrium will not be constrained efficient. It is true that,
as an exceptional case, a collateral equilibrium could be a full first-best optimum, that is, the environment
could be such that despite the focus of the paper we could ignore the collateral constraint.
  14
     This is our analogous here to the result of Hart and Zingales (2013) that it is possible for agents to be
saving too much.




                                                            17
 (ii) the (endogenous) aggregate saving/collateral in a competitive collateral equilibrium,
         K ce , is too large, i.e., K ce > K op .

Proof. See Appendix C.

       This is also our most simple version of Lorenzoni (2008) and the fire sales model. There
is too much debt and hence too much collateral, and this is moving (distorting) prices.


2.1.5       New Markets for the Rights to Trade in Segregated Exchanges and Their
            Prices

The externality problem is in general a missing-market problem. For us, here in this example,
the missing markets are those over the “market fundamentals”; that is, those aspects of the
environment which determine the spot-market-clearing price. The forces determining the
valuation of collateral, are as yet, in the previous section, not contracted.15 Therefore, our
solution is to create new markets for rights to trade. The right for type h in state s at market
fundamental zs is the discrepancy from the fundamental16 , as discussed earlier, namely,
  h         h         h
                                 eh
                                         
∆s (zs ) = e2s + Rs k      zs − eh +Rs kh . In effect, agent types choose the fundamental zs ,
                                    1s
                                                2s

or price, at which they want to trade and also the amount they will trade at that zs . This
discrepancy when priced will make each type pay or be paid according to the marginal impact
  15
       It is true when there are states of the world, agents are implicitly trading securities that are contingent
on realized prices. But what we do is different. Suppose, as in our Environment 1 in Section 2.1.6, there is
no uncertainty, hence nothing contingent. The future spot price is a known, deterministic number. There
remains an externality problem, however, through the collateral constraints. Hence we allow agents to commit
to trade at different alternative spot prices, essentially any price they want and can afford. The prices of
these markets then guide agents to a new equilibrium which is constrained efficient, with a deterministic
price which is different from the original one.
  16
     In the general model of Kilenthong and Townsend (2014a), much like the consumption constraints
in Arrow (1969), rights to trade can be determined by excess demand functions. In fact, we can map
∆hs into the excess demand as follows. For example, with the following common CRRA utility function
                 c11−γ −1       c21−γ −1
u (c1 , c2 ) =      1−γ     +      1−γ ,   we can show that the excess demand function for good 1 with the market
                                                   γ−1 
                                                    zs                                               zsγ−1
fundamental zs is given by           τ1h∗  (zs ) = 1+z γ−1 ∆hs (zs ). Note that the additional term 1+z γ−1 depends on
                                                       s                                              s

zs only so, to go back and forth between discrepancy and excess demand, we have to only redefine units
traded in each state s. A key advantage of the discrepancy ∆hs defined in (11) is the independence from the
utility function form.


                                                                18
of that type on the price. These prices of rights will come from the planner problem and
reflect the marginal valuation of the market-clearing constraint (12), h αh ∆hs (zs ) = 0.
                                                                      P

       Let P∆ (zs , s) be the unit price of rights to trade at spot-market price ps = p (zs ), where
the latter is the price used to unwind collateral. The fee for the rights to trade in a security
exchange zs is given by that price P∆ (zs , s) times the quantity of the discrepancy, ∆hs (zs ),
namely the total expenditures is P∆ (zs , s) ∆hs (zs ) (or revenue if negative).
       To internalize the externality, agents who bring in too much of good 2 relative to the
market fundamental would have to pay for rights to trade, and vice versa. For example,
                                       eh
if ∆hs (zs ) > 0, then zs >        eh
                                        1s
                                       +R  sk
                                              h   and type h holds a relative low amount of good 1 and
                                    2s

abundant amount of good 2 relative to zs . As a result, that type h would need to pay for the
right to trade or unwind in this market. This makes intuitive sense since the problem, the
inefficiency, is oversaving. Conversely, when ∆hs (zs ) < 0, an agent type h has a relatively
high amount of good 1 and scarce amount of good 2, relative to zs . With oversaving in the
aggregate this type will be compensated.
       Note that if type h’s pretrade endowment is exactly equal to the market fundamental,
    eh
 h
     1s
e2s +Rs kh
             = zs , then ∆hs (zs ) = 0. But typically with heterogeneity and active trade an agent
type h will be on one side or the other of the market fundamental, buying or selling the
collateral good 2 for good 1. Of course it takes at least two sides to open an active market.
Finally, an agent type h is making these commitments over all states s, so the total impact
on its budget in the contracting period is s P∆ (zs , s) ∆hs (zs ).
                                          P


Competitive Equilibrium with Segregated Exchanges

Each agent must choose one but only one fundamental spot market in each state s, that
is, one forward price at which collateral will be unwound. More formally, let an indicator
function δ h (zs ) ∈ {0, 1}, that is, δ h (zs ) = 0 or δ h (zs ) = 1, denote an agent type h’s discrete
choice of spot and security market zs in each state s = 1, 2, . . . , S. With vector z = (zs )Ss=1 ,
we write this function as δ h (z) so that the particular zs in each s is specified. These choices
                                          h
of z are jointly bundled with spot trade τ`s in state s, rights ∆h (zs ) and securities θ`s
                                                                                         h 17
                                                                                            . In
  17
       It may seem the consumption goods are also indexed but in fact they are the residual implied by the choice
               h
of securities θ`s (z) and the associated collateral k h (z) at t = 0. However, spot markets for consumption and


                                                          19
sum, notationally, let xh (z) = δ h (z) , ch0 (z) , k h (z) , θ h (z) , τ h (z) , ∆h (zs ) denote a typical
                                                                                          

bundle or allocation for an agent type h, where ∆h (z) ≡ ∆hs (zs ) s . Again the entire vector
                                                                              

is now indexed by choice of z and the latter is captured by δ h (z).18 Likewise prices other
                                                                              h
than p0 will be indexed by zs . Let Q` (zs , s) denote the price of security θ`s (z) with with
Q ≡ [Q (zs , s)]s,zs , and P∆ (zs , s) denote the market price of rights to trade in security
exchange zs in state s, the price of rights ∆hs (zs ) with P∆ ≡ [P∆ (zs , s)]s,zs .
    Otherwise, apart from the bundling and these prices, a competitive equilibrium with
segregated exchanges is similar to Definition 1 except that the objective function and con-
straints are premultiplied by the discrete choice, the budget is augmented by expenditures
on rights and there is an additional clearing equation for these rights.

Definition 3. A competitive equilibrium with segregated exchanges is a specification of
                
allocation xh (z) h,z and prices (p0 , Q, P∆ , p) such that
                                                                         
  (i) for any agent type h as a price taker, allocation xh (z) z solves
                X         h
                   δ h (z) u ch10 (z) , ch20 (z)
                                                 
        max
       [xh (z)]z z
                              X                                                                           i
                            +      πs u eh1s + θ1s h        h
                                                     (z) + τ1s (z) , eh2s + Rs k h (z) + θ2s
                                                                                          h         h
                                                                                             (z) + τ2s (z)
                                          s

       subject to collateral constraints
                          X
                                    δ h (z) p (zs ) Rs k h (z) + θ2s
                                                                  h         h
                                                                               
                                                                     (z) + θ1s (z) ≥ 0, ∀s,                                (18)
                            z

       budget constraint at t = 0
          X          n
              δ h (z) ch10 (z) + p0 ch20 (z) + k h (z)
                                                     
             z
                            XX                                        X                           o
                                                           h
                        +                     Q` (zs , s) θ`s (z) +       P∆ (zs , s) ∆hs (zs )       ≤ eh10 + p0 eh20 ,   (19)
                                s     `                               s

       and budget constraint at state s
                                              X
                                                  δ h (z) τ1s
                                                          h                 h
                                                                                   
                                                              (z) + p (zs ) τ2s (z) = 0, ∀s;                               (20)
                                              z

collateral at t = 0 are not segregated in that everyone can trade consumptions including the collateral good
together in the t = 0 market.
  18
     If δ h (z) = 0, then the rest need not be specified.


                                                                20
 (ii) markets clear for good 1 in period t = 0, for good 2 in period t = 0, for securities, spot
         trades, and for rights to trade, respectively,
                                                 XX                                     X
                                                                δ h (z) αh ch10 (z) =       αh eh10 ,                  (21)
                                                     h     z                            h
                                  XX                                       X h h
                                             δ h (z) αh ch20 (z) + k h (z) =
                                                       
                                                                             α e20 ,                                   (22)
                                    h    z                                              h
                                                 XX
                                                                δ h (z) αh θ`s
                                                                            h
                                                                               (z) = 0, ∀s, `, zs ,                    (23)
                                                     h    z−s
                                                 XX
                                                                δ h (z) αh τ`s
                                                                            h
                                                                               (z) = 0, ∀s, `, zs ,                    (24)
                                                     h    z−s
                                                XX
                                                               δ h (z) αh ∆hs (zs ) = 0, ∀s, zs ,                      (25)
                                                 h       z−s


         where z−s = (z1 , . . . , zs−1 , zs+1 , . . . , zS ) is a vector of market fundamentals in all states
         but state s.19

       Note that from the market clearing condition of the rights to trade (25), for any active
spot market chosen by multiple types, spot markets must clear and in this sense the valuation
of collateral is self-fulfilling.


Public Finance Interpretation

The budget constraint with the prices of the rights to trade has a public finance interpreta-
tion, as if we were to try to implement the optimum solution by taxes and subsidies.
                                                           
    Specifically, substituting ∆hs (zs ) = zs eh2s + Rs k h − eh1s into the budget constraint for
an agent type h, equation (19) gives
 X             n                                 XX
        δ h (z) ch10 (z) + p0 ch20 (z) + k h (z) +                h
                                                                     (z) ≤ eh10 + p0 eh20
                             
                                                     Q` (zs , s) θ`s
   z                                                             s    `
                              X                                 X                               X                     ho
                          −       [P∆ (zs , s) zs ] eh2s   −          [−P∆ (zs , s)] eh1s   −        P∆ (zs , s) zs Rs k
                              s                                   s                              s

We can now see that we need to have three types of taxes/subsidies, (i) saving/collateral
      P
tax of s P∆ (zs , s) zs Rs per unit of saving/collateral, (ii) state-contingent collateral good
  19
       Note that (21)-(22) are summed over all z while (23)-(25) are conditional on partition zs . The difference
reflects the fact that markets for good 1 and good 2 in period t = 0 are not segregated but the others are.


                                                                 21
endowment tax of P∆ (zs , s) zs per unit of collateral good endowment in state s, and (iii)
state-contingent subsidy, negative tax −P∆ (zs , s) per unit of consumption good endowment
of good 1 in state s. Note that it is not sufficient to tax/subsidize only saving/collateral.
The tax/subsidy rate on endowments also depends on the security exchange zs . That is,
the security exchange zs itself is a choice as far as the household is concerned. This is like
looking up marginal rates in a big tax book and settling on which page (or pages) to use,
indexed by the exchanges zs that the agent chooses.
   But again we do not need the taxes. We let the markets decide. Markets determine
prices and prices determine allocations.


2.1.6   Example Economies with Segregated Security Exchanges

Before we generalize, and prove the welfare theorems, we present a series of three examples.
The first illustrates the basic mechanics of rights to trade we have featured so far in the
simplest possible setting without uncertainty (in which in equilibrium there are no securities
beyond simple saving). The second features two states of the world in which insurance
contracts are actively traded in both the equilibrium with and without the externalities.
The third is an example which has mixtures at the aggregate level and lotteries at the
individual level, and this provides an illustrative transition to the more general notation in
Appendix A, and proofs of the welfare theorems in Appendix B.

Environment 1 (Intertemporal Smoothing). There are two periods, t = 0, 1, and a single
state, S = 1 in period t = 1. So this is a pure intertemporal economy. We make the point
that the problem and its remedy has nothing to do with uncertainty. In particular, our rights
are not trades on financial options. Indeed, in this example economy no securities will be
traded, in equilibrium, and in this way we focus on the market for rights to trade in spot
markets, only. Henceforth we drop all subscript s from the notation.
   There are two types of agents, H = 2, both of which have an identical constant relative
risk aversion (CRRA) utility function
                                                        1  1
                                      u(c1 , c2 ) = −     − .                              (26)
                                                        c1 c2
                        1
Each type consists of   2
                            fraction of the population, i.e. αh = 12 . In addition, the discount

                                                22
factor is β = 1. The storage technology is given by R = 1. The endowment profiles of the
agents are shown in Table 1 below. Note that an agent type 1 is well endowed with both
goods in period t = 0 and vice versa for type 2. The first best allocation has both agents
consuming 2 units of each good in every period. The first-best allocation thus suggests that
agent 2 would like to move resources backwards in time from t = 1 to t = 0, i.e., borrow,
and therefore will be constrained in the competitive collateral equilibrium. But borrowing
requires collateral, and agent 2 is short of this as well. The equilibrium will have agent 2
borrowing nothing and only trading in spot markets. Agent 1 will be saving on its own to
smooth consumption. Finally, in the equilibrium with rights to trade in spot markets, agent
1 will be paying more the higher is her storage/saving and this will be a force to do less.
Likewise, agent 2 will be compensated for her participation in the rights markets, in effect
providing resources for consumption in the first period, i.e., moving in the direction of the
first best.
   We summarize the equilibrium allocation in Table 1 featuring collateral k h and con-
sumption ch`s . See Appendix C for the derivation of the competitive equilibrium with the
externality.

                                      Table 1: Endowment profiles of the agents.
                endowments               equilibrium with the externality (ex)          equilibrium with rights to trade (op)
         eh10    eh20   eh11   eh21     kh       ch10     ch20        ch11    ch21     kh       ch10     ch20    ch11     ch21
 h=1      3       3      1      1      1.3595   2.6899   1.7756 1.3252       1.7756   1.1753   2.6073   1.8410 1.2970 1.6781
 h=2      1       1      3      3        0      1.3101 0.8649     2.6748     3.5839     0      1.3927 0.9837 2.7030     3.4972


                                                                                          h
   There is no loss of generality to consider a solution with no security trading, i.e., θ`s =0
for all h and for all `. Agents do actively trade in spot markets. The price of good 2 in
                          4
                             2
period t = 0 is pex
                  0 = 4−kex     = 2.2948, and the market fundamental in period t = 1 is
           4
z ex =   4+kex
                      = 0.7463, which implies that the spot price is p (z ex ) = 0.5570. Note that
the collateral price at t = 0 is higher in the equilibrium with the externality than in the
first-best, “fb”, i.e., pf0 b = 1 < pex
                                     0 = 2.2948. On the other hand, the spot price of good 2

in period t = 1 is lower in the equilibrium with the externality than in the first-best, i.e.,
       
p z f b = 1 > p (z ex ) = 0.5570.
   We will now turn to a corresponding competitive equilibrium with rights to trade in

                                                                 23
segregated exchanges (without the externality). There is one active spot market, z op = 0.7729
(“op” stands for optimality), even though all spot markets are available in principle for trade.
That is, in equilibrium, both types optimally choose to trade in the same spot market with
specified market fundamental, z op = 0.7729.
       Table 2 presents equilibrium prices/fees of rights to trade in spot markets, that is P∆ (z)
not only for z op but also other, different market fundamental levels z. Note again that the
prices/fees of out-of-equilibrium (non-active) spot markets are available, but at such prices
agents do not want to trade in them.

Table 2: Equilibrium prices of rights to trade in spot markets P∆ (z). Bold numbers are
equilibrium prices for actively traded spot markets.
                                     z = 0.7479        z = 0.7729          z = 0.7979
                        P∆ (z)         0.4639               0.5375            0.6118


       An agent type 1 is coming in with good 2 in storage, and therefore his discrepancy is
positive. Type 1 pays for right to trade. On the other hand, an agent type 2’s discrepancy
is negative. Thus, with a positive equilibrium fee P∆ (z op ) = 0.5375, an agent type 2 must
get paid for the access to the spot market. In particular, a constrained agent (h = 2) with
∆2 (z op ) = −0.6813, is receiving a transfer of −P∆ (z op )∆2 (z op ) = 0.3662 in period t = 0 for
being in the spot market z op = 0.7729. Graphically, this shifts her budget line outward at
t = 0 by T = 0.3662.20
       Note that with lower aggregate saving, the price of good 2 in period t = 0 in this
competitive equilibrium with segregated exchanges (without the externality) is lower (pop
                                                                                       0 =

2.0073 < pex                                                              op
          0 = 2.2948) but the spot price of good 2 at t = 1 is higher (p(z ) = 0.5974 >

p(z ex ) = 0.5570), relative to the one in the competitive collateral equilibrium allocation (with
  20
       Trading in rights to trade generates a redistribution of wealth and welfare in general equilibrium. The
expected utility of an agent type 1 and type 2 in this competitive equilibrium with segregated exchanges
                               1              2
(without the externality) are Uop = −2.2936, Uop = −2.3905, respectively. The expected utility of an agent
                                                                                                   1
type 1 and type 2 in the competitive collateral equilibrium allocation (with the externality) are Uex = −2.2527
     2
and Uex = −2.5724, respectively. Thus if nothing else is done, internalizing the externality is beneficial to an
agent type 2 (constrained agent) but harmful for an agent type 1. To induce welfare gains for all of agents,
there must be lump sum transfers, as in the second welfare theorem, which we prove below.


                                                       24
the externality). That is, the price of good 2 varies less over time when the externality is
internalized. In this sense we mitigate fluctuations. We do not move all the way to the first
best.

   The next example illustrates an economy with uncertainty where collateralized securities,
 h
θ1s , are actively traded (cannot be substituted by spot trades). All agents are constrained,
but at different states. In particular, an agent will be binding in a state where her endowment
is large. This is because she would like to transfer a part of such a large amount of wealth
backwards in time from t = 1 to t = 0 but cannot do so because of the collateral constraints.

Environment 2 (State Contingent Securities). The economy in this example is similar to
the one in Environment 1 with two periods, but there are two states, S = 2. There are
two types of agents, H = 2, both of which have an identical constant relative risk aversion
                                                                 1
(CRRA) utility function as in (26). Each type consists of        2
                                                                     fraction of the population, i.e.
αh = 12 . In addition, the discount factor β = 1. The storage technology is constant and
given by Rs = 1 for s = 1, 2. The endowment profiles are presented in Table 3. Note, unlike
the first example, that the agents are identical in endowments at t = 0. But agent type 1
has relatively more of both goods in state s = 1 than in state s = 2 and vice versa for agent
type 2.

                         Table 3: Endowment profiles of the agents.
                                   eh10   eh20    eh11    eh21   eh12    eh22
                        h=1         2      2          3    3         1    1
                        h=2         2      2          1    1         3    3


   We will now solve for a competitive equilibrium with the externality. The detailed deriva-
                                                                              h
tion is again omitted and presented in Appendix C. Collateralized securities θ`s (or borrowing
                1      1                2     2
contracts) are θ11 = −θ12 = −0.3042 = −θ11 = θ12 . In words, an agent h = 1 issues (bor-
       1
rows) θ11 = −0.3042 units of collateralized security paying good 1 at s = 1, and vice versa
for an agent h = 2. We now turn to the competitive equilibrium with rights to trade. Each
type of agent holds the same amount of collateral good k h = 0.4200 < 0.4603, less than the
one in competitive equilibrium with the externality. Collateralized securities (or borrowing

                                                 25
                1      1                2     2
contracts) are θ11 = −θ12 = −0.2872 = −θ11 = θ12 . Note that agents trade less securities
relative to the equilibrium with the externality. This is because the agents save less and are
issuing fewer securities. That is, the externality generates too much borrowing.

   The following example presents an economy where it is possible to assign agents to
different exchanges and have multiple segregated exchanges.

Environment 3 (Heterogeneous Borrowers and the Role of Mixtures). There are three
                                                                                                   1
types of agents, two borrower types 2, 3 and one lender type 1. Each type consists of              3

fraction of the population, i.e. αh = 31 , and all other aspects of the environment are as in
Environment 1. The endowment profiles are given in Table 4 below.

                            Table 4: Endowment profiles of the agents.
                            Type of Agents       eh10   eh20   eh11   eh21
                            h=1                  4.26   11.5   0.5    0.5
                            h=2                  3.92   0.5     7      5
                            h=3                  4.32   0.5     5      7


   Interestingly, there are now two active spot markets, z = 0.6113 and z = 0.8132 in the
competitive equilibrium with segregated exchanges. The spot market z = 0.6113 consists
of some fraction of agents type 1 (19.69 percent), and all of agents type 3 (a constrained
type). On the other hand, the spot market z = 0.8132 consists of some residual fraction
of agents type 1 (80.31 percent), and all of agents type 2 (a constrained type). We use the
term mixtures to refer to the fact that agent 1 is allocated to two active markets in some
nontrivial proportions.
   Equilibrium fees of rights to trade in spot markets, including the fees of inactive (out-of
equilibrium) spot markets are summarized in Table 5 below.

Table 5: Equilibrium fees of rights to trade in spot markets. The bold numbers are (actively
traded) equilibrium prices.
               z = 0.6088     z = 0.6113   z = 0.6138   z = 0.8088     z = 0.8132     z = 0.8138
      P∆ (z)     0.9119         0.9348       0.9589       2.2339             2.2537     2.2564



                                                26
   It is socially optimal to compensate constrained agents with positive transfers at period
t = 0, to try to move back toward the first best, i.e., alleviate borrowing constraints. In this
example the number of active segregated spot markets is equal to the number of constrained
types, to allow this to happen.
   In the competitive equilibrium with segregated exchanges (without the externality), the
discrepancy from the market fundamental of both constrained types are negative, i.e., ∆2 =
−2.9340 and ∆3 = −0.7209. With positive equilibrium price of the discrepancy, agents type
2 and agents type 3 receive transfers from rights to trade fees P∆ (z) ∆h (z) of 6.6122 units
of good 1 in period t = 0 and 0.6739, respectively. Agents type 1 buy a lottery which is
actuarially fair and thus pay fees paid in proportion to the relative number of its type assigned
to each exchange. Agents type 1 would like to buy into the higher spot market, which is
z = 0.8132 in this case, where good 2 is more valuable because with (endogenous) saving
she will end up with more of good 2 than good 1 in period t = 1 but such a deterministic
choice is not affordable.


2.1.7   The Existence of Competitive Equilibrium with Segregated Exchanges
        and the Welfare Theorems

The formal notation for competitive equilibrium with mixtures is in Appendix A. Suffice it
to note here that as in the classical general equilibrium model, the economy is a well-defined
convex economy, i.e., the commodity space is Euclidean, the consumption set is compact
and convex, the utility function is linear. As a result, the first and second welfare theorems
hold, and a competitive equilibrium exists.
   The standard contradiction argument is used to prove the first welfare theorem below.
We assume that there is no local satiation point in the consumption set.

Theorem 1. With local nonsatiation of preferences, a competitive equilibrium with segregated
exchanges allocation is constrained optimal.

Proof. See Appendix B.

   The Second Welfare theorem states that any constrained optimal allocation, correspond-
ing to strictly positive Pareto weights, can be supported as a competitive equilibrium with

                                               27
segregated exchanges with transfers. The standard approach applies here. Essentially, de-
centralized prices are coming from the Lagrange multipliers for the resource constraints of
the planning problem.

Theorem 2. With locally non-satiated utility functions that satisfy the Inada conditions, any
constrained optimal allocation corresponding with strictly positive Pareto weights λh > 0, ∀h
can be supported as a competitive equilibrium with segregated exchanges and with lump sum
transfers.

Proof. See Appendix B.

   We use Negishi’s mapping method (Negishi, 1960) to prove the existence of competitive
equilibrium with segregated exchanges.

Theorem 3. With locally non-satiated utility functions that satisfy the Inada conditions and
positive endowments, a competitive equilibrium with segregated exchanges exists.

Proof. See Appendix C.


2.2    An Exogenous Incomplete Markets Economy

As before, consider again an economy with two periods, t = 0, 1. There are S possible states
of nature in the second period t = 1, i.e., s = 1, . . . , S, each of which occurs with probability
              P
πs such that s πs = 1. There are 2 goods, labeled good 1 and good 2, in each date and
in each state. Because the endowment profiles are the same as specified in the collateral
economy discussed above, we omit notational details in this section for brevity. We do stress
that now there is no saving as our focus is no longer on collateral.
   There are J securities available for purchase or sale in the first period, t = 0. Let
D = [Djs ] be the payoff matrix of those assets where Djs be the payoff of asset j in units of
good 1 (the numeraire good) in state s = 1, 2, . . . , S in the second period t = 1. Here we do
not include securities paying in good 2 as there must be spot markets anyway. Let θjh denote
the amount of the j th security acquired by an agent of type h at t = 0 with θ h ≡ θjh j ,
                                                                                        

and Qj denote the price of security j with Q ≡ [Qj ]j . An exogenous incomplete markets


                                                28
assumption specifies that D is not full rank; that is, J < S. This is crucial for the model of
this section. In particular, spot trades become essential but create an externality.
                   h
   As before, let τ`s denote spot trade amount of good ` = 1, 2 in spot markets in state s
acquired by an agent of type h. Let p0 and ps denote the prices of good 2 in units of good
1 in period t = 0 and at state s in period t = 1, respectively. Here spot market trade is
generically essential given the incomplete security structure.
                                                                                             
   The preferences of an agent of type h are represented by the utility function uh ch1 , ch2 ,
and the discounted expected utility of h is defined by:
                                                                                 S
                                                                                 X
                                h       h             h
                                                          ch10 , ch20                   πs uh ch1s , ch2s ,
                                                                                                       
                            U       c           ≡u                          +β                                                           (27)
                                                                                 s=1

where β is the discount factor. Note that there would be no externalities if preferences were
identically homothetic, as spot prices are determined by ratio of aggregate endowment only,
which, with no storage, no one can influence. So we assume otherwise; that is, preferences
are now not identically homothetic.

Definition 4 (Competitive Equilibrium with Exogenous Incomplete Market). A competitive
equilibrium is a specification of prices (p0 , Q, p), and an allocation ch0 , θ h , τ h h such that
                                                                                       


   • for any agent type h as a price taker, ch0 , θ h , τ h solves
                                                           

                                                                                                                                     !
                                                            X                               X
                            h
                                    ch10 , ch20                             h
                                                                                 eh1s           Djs θjh        h
                                                                                                                  , eh2s        h
                                                  
                  max u                               +β          πs u                  +                 +   τ1s          +   τ2s       (28)
                      h h
                 ch
                  0 ,θ ,τ                                     s                             j


      subject to the budget constraints in the first period
                                                                  J
                                                                  X
                                        ch10 + p0 ch20 +                    Qj θjh ≤ eh10 + p0 eh20 ,                                    (29)
                                                                  j=1


      and the spot budget constraint in state s

                                                 h        h
                                                τ1s + ps τ2s = 0, for s = 1, . . . , S;                                                  (30)


   • markets clear for good ` = 1, 2 at t = 0, for θjh for all j = 1, . . . , J, and for spot trade




                                                                        29
          h
         τ`s in state s, respectively:
                                              X                      X
                                                    αh ch`0 =                αh eh`0 , ∀` = 1, 2,                           (31)
                                                h                        h
                                               X
                                                       αh θjh = 0, ∀j,                                                      (32)
                                                h
                                              X
                                                    αh τ`s
                                                        h
                                                           = 0, ∀s; ` = 1, 2.                                               (33)
                                                h


       The key constraints that generate the externality in this problem are the spot-budget
constraints (30) for an agent of type h. Note that the spot price ps is determined by pretrade
position of endowments and securities where endowments are exogenous but securities are
endogenous, and we write this as ps = ps (θ, e). As in Geanakoplos and Polemarchakis
(1986), the dependency generates an indirect price effect from security reallocations. This
indirect effect then produces an externality when the security markets are incomplete21 .


2.2.1         Competitive Equilibrium with Segregated Exchanges

Each security exchange in this case must deal with S spot markets as a bundle. This is due
to the restriction of the incompleteness of the markets; we cannot separately write down
contingent contracts for each state. More formally, each security exchange trades the vector
bundle of the rights to trade in the spot markets at particular vector of prices p = (ps )Ss=1 ,
and for an agent type h the right to trade in the spot markets at the same particular vector
                                          S
p is defined as a vector ∆h (p) = ∆hs (p) s=1 .
                                  

       More specifically, type h’s right to trade in exchange p for particular state s is ∆hs (p)
and is defined as the excess demand for good 1 of an agent type h in spot markets in state
                                                   ehs , θ h , ps , which is the solution to the following utility
                                                                 
s, i.e., ∆hs (p1 , . . . , ps , . . . , pS ) = τ1s
                                                h∗


maximization:
                                                                                                                     
                                                                                 J
                                                                                       X
              h∗
             τ1s ehs , θ h , ps , τ2s
                                   h∗
                                      ehs , θ h , ps        = argmax uh eh1s +              Djs θjh + τ1h , eh2s + τ2h    (34)
                                                                h ,τ h
                                                               τ1s  2s                 j=1


subject to the spot-budget constraints (30).
  21
       When the security markets are complete, these indirect price effects are canceling each other out, and as
a result, the competitive equilibrium with exogenous security markets is (constrained) efficient as expected.
This statement is formally proved in a proposition in Appendix C.


                                                                  30
   As with our initial formulation in the collateral economy, we allow each agent to choose
one but only one exchange indexed by p = (p1 , . . . , ps , . . . , pS ), where it can trade good 2
at spot price ps in each state s. An agent’s choice ranges over all potential price vector p.
More formally, let δ h (p) ∈ {0, 1}, that is δ h (p) = 0 or δ h (p) = 1, denote an agent type h’s
discrete choice of an exchange indexed by p.
   At t = 0, each agent type h is choosing both the spot market prices it desires and the
security trades jointly. Thus the consistency constraint for each exchange p that is active
then can be derived from the spot market clearing condition, which can be rewritten as
follows.
                                       X
                                               αh δ h (p) ∆hs (p) = 0, ∀s, p.                                           (35)
                                           h

Each consistency constraint ensures that the composition of agent types in an exchange
p = (p1 , . . . , ps , . . . , pS ) is such that the spot market clearing prices in each state s is ps .
Notice that these constraints are for active exchanges, not for every possible p.
   Let Qj (p) denote the price of security j traded in exchange p with Q ≡ [Qj (p)]j,p , and
P∆ (p, s) denote the market price of rights to trade in exchange p for state-s spot market,
∆hs (p) with P∆ ≡ [P∆ (p, s)]s,p .

Definition 5. A competitive equilibrium with segregated exchanges is a specification of
allocation xh (p) h,p ≡ δ h (p) , ch0 (p) , θ h (p) , τ h (p) , ∆h (p) h,p and prices (p0 , Q, p, P∆ )
                                                                     

such that
                                                 
   • for any agent type h as a price taker, xh (p) p solves
                                                                                                                            
                  X                                    X                    X
        max           δ h (p) u ch10 (p) , ch20 (p) +         πs u eh1s +            Djs θjh (p) + τ1s
                                                                                                      h
                                                                                                         (p) , eh2s + τ2s
                                                                                                                       h
                                                                                                                          (p)
      [xh (p)]p   p                                        s                      j

       subject to the budget constraints in the first period
                                                                                                       
           X                                       X                       X
               δ h (p) ch10 (p) + p0 ch20 (p) +        Qj (p) θjh (p) +              P∆ (p, s) ∆hs (p) ≤ eh10 + p0 eh20 ,
           p                                        j                         s

       and the spot-budget constraint in state s
                             X          h                    i
                                 δ h (p) τ1s
                                          h            h
                                             (p) + ps τ2s (p) = 0, ∀s,
                                       p



                                                           31
    • markets clear for good ` in t = 0, for securities j paying good 1, for good ` in state s,
         and for rights to trade in exchange p for state s, respectively,
                              XX                            X
                                      δ h (p) αh ch`0 (p) =   αh eh`0 , ∀` = 1, 2,
                                  h   p                         h
                                      X
                                          δ h (p) αh θjh (p) = 0, ∀j; p,
                                      h
                                      X
                                          δ h (p) αh τ`s
                                                      h
                                                         (p) = 0, ∀s; p; ` = 1, 2,
                                      h
                                      X
                                          δ h (p) αh ∆hs (p) = 0, ∀s; p.
                                      h

       As in the collateral economy, markets for the rights to trade can remove the externality.
The formal argument22 is quite similar to the collateral economy in Section 2.1.
       Of course, one might wonder if our method solves the externality problem by simply
completing the markets? By allowing agents to choose markets with pre-specified spot
prices in each state s, we effectively create state-contingent transfers of wealth at least to
some degree. But is it enough to achieve the first best allocation? The answer is generally,
no. Exogenous incomplete markets and the positivity of spot prices still restrict how much
wealth transfers we can make in each state. Technically, the feasible set with incomplete
markets and rights to trade is generically a strict subset of the feasible set with the complete
markets.
       See Figure 1 for an illustrative example. This example assumes the stereotypical debt
contract that pays the same amount of good 1 in each two states. However, in state s = 2,
there is more of good 1 and good 2 overall. Then, no matter what the price ratio ps in state
s = 2, certain regions cannot be reached. The main point is that the scarcity in state s = 1
can affect the feasibility in state s = 2 because the markets are incomplete.



3        Mapping Economies into A Generalized Framework
The key point is that our market-based solution concept is applicable to many economies
in which agents face a friction that generates constraints containing spot market prices. So
  22
       In Kilenthong and Townsend (2014a), we prove the welfare theorems for a general model that fits each
of the two leading examples as special cases.


                                                      32
                                                                                                          Agent 2




                               11   21                                                  (e12,e22)




                                                          Agent 1


    (a) A feasible set in state s = 1 when only avail-        (b) A feasible set in state s = 2 when only avail-
    able security pays the same amount of good 1              able security pays the same amount of good 1 in
    in both states.                                           both states. The shaded areas are not feasible.


         Figure 1: Feasible Sets in state s = 1 and s = 2 when markets are incomplete.

here we proceed in reverse and lay out a generalized framework much as in Prescott and
Townsend (1984b), then show several well known environments in the literature are special
cases.
   There are at least 6 prototype economies that fit into our framework. These include
collateral economy as in Section 2.1, exogenous incomplete markets as in Section 2.2, fire
sales economy (Lorenzoni, 2008), liquidity constrained economy (Hart and Zingales, 2013),
moral hazard with retrading (Acemoglu and Simsek, 2012; Kilenthong and Townsend, 2011),
and hidden information with retrading (Diamond and Dybvig, 1983). For brevity, this section
presents only the key constraints in each economy without describing the entire environment
of the model nor the equilibrium with the new markets for rights to trade. See Kilenthong
and Townsend (2014a) for the general notation that encompasses all these examples.
   The general form of those constraints generating pecuniary externalities is actually easy
to write. It is denoted by C h ch , θ h , τ h , yh , p , where yh is the vector of inputs and outputs
                                                      

for an associated production technology and p is the vector of spot prices. The notation of
consumption ch , securities θ h , and trades τ h is as before. The key feature is the introduction
of price vector p.
   For the collateral economy, the key friction can be written as the following constraints:

                          Csh θ`s
                               h     h             h     h        h
                                            
                                  , y2s , ps ≡ ps y2s + θ1s + ps θ2s ≥ 0, ∀s, h,                                    (36)


                                                         33
                                                             h
which are equivalent to the collateral constraints (1) with y2s = Rs k h .
   For exogenous incomplete markets, the key constraints are

                               Csh τ`s
                                    h          h        h
                                           
                                       , ps ≡ τ1s + ps τ2s = 0, ∀s, h,                          (37)

which is identical to the spot budget constraints (30).
   For the fire sales economy of Lorenzoni (2008), the key constraint that causes an ineffi-
ciency is the following no-default condition:

      e     e      e     e                                    e      e     e
     Ced1 (yn00 , θ1s , θ2s , ps ) = (ηas + max {ps − γ, 0}) yn00 + θ1s + θ2s ≥ 0, ∀s = 1, 2.   (38)

Constraints (38) imply that the entrepreneur is better off not defaulting at state s = 1, 2
                       e
in period t = 1. Here yn00 is the capital input in period t = 0, as is the productivity in
                                                                     e
state s, γ is the cost to repair a unit of capital in period t = 0, θts are securities paying in
unit of consumption goods at state s in period t = 1, 2, and 1 − η ∈ (0, 1) is the fraction of
the firm’s current profit that the entrepreneur could keep if he decided to default. For more
detail see Kilenthong and Townsend (2014a). The key point is that this constraint depends
on equilibrium prices ps which in turn are determined by collective ex-ante choices of the
agents.
   The next economy is the liquidity constrained economy of Hart and Zingales (2011), where
there are two types of agents, namely doctors d and builders b. The key constraints that
cause an inefficiency are the following spot market constraints in period t = 1, 2, respectively:

                          C1h τfh1 , τbh , pb = τfh1 + pb τbh = 0, ∀h = b, d,
                                             
                                                                                                (39)

                          C2h τfh2 , τdh , pd = τfh2 + pd τdh = 0, ∀h = b, d.
                                             
                                                                                                (40)

These constraints state that each agent can trade building or doctor service when it is
available with their storage claim (as the numeraire goods in each period) received at that
time, which is the liquidity in the model. Note that this is an incomplete market model.
Here τfht , τbh , and τdh are the storage outcome at period t, spot trade for building service, and
spot trade for doctor service, respectively, and pb and pd are the spot-market-clearing prices
of building and doctor services in period t = 1 and t = 2, respectively.
    For the moral hazard with retrading economy of (Acemoglu and Simsek, 2012; Kilenthong
and Townsend, 2011), the key constraints that cause an inefficiency are the following incentive

                                                  34
compatibility constraints (IC):
                        X                                            X
     C1,a,a0 (c, p) =        u (c1 (q, a), c2 (q, a), a) f (q|a) −       v (c1 (q, a), c2 (q, a), a0 , p) f (q|a0 ) ≥ 0, ∀a, a0 .   (41)
                         q                                           q


The incentive compatibility constraints ensure that the agent takes the recommended action
a and so a0 = a. Mor especifically, here a is the recommended action, a0 is an alternative
action, q = (q1 , q2 ) is the output vector of good 1 and good 2, f (q|a) is the probability
production technology, c` (q, a) is the optimal consumption of good ` condition on realized
output q and recommended action a, and the value function under the alternative action a0
is

                 v (c1 (q, a), c2 (q, a), a0 , p) = max u (c1 (q, a) + τ1 , c2 (q, a) + τ2 , a0 )                                   (42)
                                                          τ1 ,τ2


subject to the spot budget constraint:

                                                       τ1 + pτ2 = 0,                                                                (43)

taking the spot price p as given.
     The last prototype economy is the hidden information with retrading economy of (Dia-
mond and Dybvig, 1983). The key constraints that causes an inefficiency are the following
truth-telling constraints (IC):

                C1,η,η0 (c, p) = u (c1 (η) , c2 (η) , η) − v (c1 (η 0 ) , c2 (η 0 ) , η, p) ≥ 0, ∀η, η 0 ,                          (44)

The truth-telling constraints ensure that the agent report the true shock, and so η 0 = η.
Here η is the true shock/state, η 0 is the reported shock, c` (η 0 ) is consumption under the true
shock, c` (η 0 ) is consumption conditional on the reported shock η 0 , and the value function
under the reported shock η 0 is

                        v (c1 (η 0 ) , c2 (η 0 ) , η, p) = max u (c1 (η 0 ) + τ1 , c2 (η 0 ) + τ2 , η)                              (45)
                                                           τ1 ,τ2


subject to the spot budget constraint:

                                                       τ1 + pτ2 = 0,                                                                (46)

taking the spot price p as given.

                                                                    35
    To sum up, agents in each of these economies face a set of frictions that generates con-
straints containing spot market prices similar to the ones in the collateral economy and
the exogenous incomplete markets economy, which are presented in Section 2.1 and 2.2,
respectively. Our new concept of the markets for rights to trade in segregated exchanges
can be applied in the same way to remove an externality in these economies. Formally,
let ∆hs (p) denote the amount of the rights to trade in a particular security exchange in
state s with a specified price ps . That is, in order to be eligible to trade in this exchange
p ≡ (p1 , ps , . . . , ps , . . . , pS ), an agent of type h must hold the rights to trade ∆hs (p) equals
to its excess demand for good 1 in that spot market dhs ehs , θ h , yh , ps . These rights to trade
                                                                                 

at p have its own unit of account market prices, P∆ (p, s). See Kilenthong and Townsend
(2014a) for more details.



4     Discussion on Implementation
Virtually all the technological ingredients of what would be needed to implement our solution
are available in actual securities markets, including financial markets that are currently
susceptible to fire sales. Below we try to be as specific as possible in a particular application,
with parenthetical remarks to more general considerations.
    We begin with the Generalized Collateral Financing Repo. This is a financial platform
organized by the Fixed Income Clearing Corporation (FICC), designed to allow securities
dealers to buy/sell, borrow/lend securities and cash among themselves and to do the netting.
It originated in 1998 and came from a merger of two separate platforms. (This makes
the point that new financial platforms can be created, here with a merger but divisions
and segmentation are also possible). US Treasuries and Fannie Mae & Fredie Mac MBS
are the most common securities traded among other government issued or backed financial
instruments. (Here we imagine our model environment which is written for agent types with
utility over consumption goods is actually an economy with traders/dealers with indirect
preferences over cash and securities having to do with their customer demands, which we
do not model.) Securities are held, maintained, and registered on electronic book entry
systems of FICC, the Clearing Banks, the Federal Reserve and the US Treasury. Some


                                                   36
direct transfers of securities are made through Fedwire Securities Service with payment in
Fedwire Funds. It is not possible to transfer legal ownership of securities outside of these
utilities. Our assumptions of exclusivity do not require new technology.
       A typical repossession or repo transaction is a sale of a security with an agreed upon price,
ex ante, at which it will be bought back. These are like borrowing and lending transactions,
in which a borrower in need of cash from an investor gives up securities to be held in escrow
until the loan is repaid. In the GCF repo market securities are placed at the principal-plus-
interest loan amount only (the FICC acts as a guarantor). The difference between the sale
price and the higher repurchase price is the interest rate. We emphasize that the repurchase
price is part of the contract. All initial contracts, agreed upon transactions, and collateral
are recorded and trades executed with the two major clearing banks.
       Repo markets are potentially subject to fire sale risks. There is post-default risk. When a
dealer borrower defaults on the repo, its investors receive the securities posted as collateral.
(Please recall that the securities in our model may well default. No default was assumed
without loss of generality as any security which does default, with collateral passing to the
investor is equivalent with another, that we use explicitly in the analysis, which does not
default. We model the sale of collateral by investors as if in a competitive market.)23 We
emphasize here this default and sale aspect. Related, a borrower may wish to get some of
the securities used as collateral back during the trading cycle and in that case the clearing
bank determines the cash value at current market prices, at that point in time. Our point
here is that the clearing banks could value and unwind collateral in these instances at pre
specified prices, agreed at the time when the trade is entered into. Some exchanges have
liquidation auctions to value assets, for example, those of a defaulting member of a clearing
house, with the auction restricted to members as named players. Our point here is that one
could imagine something like index credit default swaps traded ex ante in market exchanges
as insurance against default, and also that traders would pay or be paid to participate in
this bidding. Payment would be debited/credited from payment accounts in the contract
  23
       There is also a pre-default risk of fire sales which is reminiscent of Lorenzoni’s tale of Thailand. Stressed
dealers face difficulties raising funds in tri-party repo when investors worry about the counterparty risk,
causing them to de-lever and sell securities.



                                                         37
period, so there would be no time inconsistency problem on that dimension.
   In practice trades in the GCF repo market are among dealers and are placed with inter-
dealer brokers (IDBs). In 2012 there were roughly 120 dealers and 5 IDB platforms. All deal-
ers must be approved by the FICC. Trades of a dealer with an IDB are conducted by voice,
allowing negotiation or electronically, allowing anonymous trading with platform/market de-
termined prices. Though buyers are matched with sellers, the bilateral nature of the market
can fade away; that is, in many models, in the limit with a large number of traders, the
outcome is Walrasian as we assume here from the get go. See in particular Townsend (1983)
and Kilenthong and Qin (2014) for an intermediary that could be interpreted as an IDB
announcing prices and trying to attract trades. Our point here, again, is that one could
imagine financial platforms which post prices in advance for unwinding collateral and charge
fees or provide compensation for participation.
   Again exclusivity is not a problem given current technology. The current market structure
has exclusivity embedded, as is clear in this discussion of broker dealers, FICC, clearing
banks, and the Fed for trade, clearing, and settlement. More generally, the Fed has a list of
authorized broker dealers for the OTC treasury market. Mutual funds and other investors
are not allowed to deal directly on Fedwire funds and Fedwire securities and go through
broker dealers. More generally, some market exchanges are said to restrict access to high
frequency traders. Or in yet another example, exchange traded funds name a restricted set
of Authorized Participants who are allowed to deal with the sponsor of the fund. Finally,
as a consequence of Dodd Frank regulation, market participants in CDS index contracts
are required to trade in a Swap Execution Facility and to clear in a CCP platform. These
platforms charge fees and commission, based typically on volume.
   To sum up, the technology exists to register securities, to monitor trades, to enforce
agreements, to auction assets, and to hedge default risk and security price movements ex
ante.




                                             38
5      Conclusion
Here we draw on the insights of Coase (1960) and Lindahl (1958), extend the commodity
space as in Arrow (1969), overcome some conceptual and technical hurdles, and show how
the appropriate set of markets can eliminate fire sale externalities and the inefficiency of
incomplete security markets. Our solution concept extends to many other well known envi-
ronments in the literature. By its nature, a pecuniary externality has to do with the impact
of prices in constraints beyond the role of prices in budget constraints, as happens in many
models. The solution can be put rather simply: create segregated market exchanges which
specify prices in advance (but with the same prices that also clear active markets ex post)
and price the right to trade in these markets so that participant types pay, or are com-
pensated, consistent with the market exchange they choose and that type’s excess demand
contribution to the price in that exchange.



References
Acemoglu, D. and A. Simsek (2012). Moral Hazard and Efficiency in General Equilibrium
    with Anonymous Trading. Working Paper .

Arrow, K. (1969). The Organization of Economic Activity: Issues Pertinent to the Choice of
    Market versus Nonmarket Allocation. The Analysis and Evaluation of Public Expenditure:
    The PPB System 1, 59–73.

Begalle, B., A. Martin, J. McAndrews, and S. McLaughlin (2013). The risk of fire sales in
    the tri-party repo market. Technical report, Federal Reserve Bank of New York.

Bewley, T. F. (1981). A critique of tiebout’s theory of local public expenditures. Economet-
    rica: Journal of the Econometric Society, 713–740.

Bianchi, J. (2010). Credit externalities: Macroeconomic effects and policy implications. The
    American Economic Review , 398–402.

Bianchi, J. and E. Mendoza (2012). Overborrowing, financial crises and macro-prudential
    policy. Working Paper .

                                              39
Bisin, A. and P. Gottardi (2006). Efficient Competitive Equilibria with Adverse Selection.
  Journal of Political Economy 114 (3), 485–516.

Bisin, A. and P. Gottardi (2010). Decentralizing Efficient Allocations in Economies with
  Adverse Selection: The General Case. Working Paper .

Bordo, M. D. and O. Jeanne (2002). Boom-busts in asset prices, economic instability, and
  monetary policy. Technical report, National Bureau of Economic Research.

Coase, R. H. (1960). The problem of social cost. Journal of Law and Economics 3, 1.

Debreu, G. (1954). Valuation Equilibrium and Pareto Optimum. Proceedings of the National
  Academy of Sciences of the United States of America 40 (7), 588.

Diamond, D. and P. Dybvig (1983). Bank Runs, Deposit Insurance, and Liquidity. The
  Journal of Political Economy 91 (3), 401.

Duarte, F. and T. M. Eisenbach (2014). Fire-sale spillovers and systemic risk. FRB of New
  York Staff Report (645).

Farhi, E., M. Golosov, and A. Tsyvinski (2009, 07). A Theory of Liquidity and Regulation
  of Financial Intermediation. Review of Economic Studies 76 (3), 973–992.

Geanakoplos, J. (2003). Liquidity, Default, and Crashes. Advances in Economics and Econo-
  metrics: Theory and Applications: Eighth World Congress.

Geanakoplos, J. and H. Polemarchakis (1986). Existence, Regularity and Constrained Sub-
  optimality of Competitive Allocations when the Asset Market is Incomplete. Uncertainty,
  Information and Communication: Essays in Honor of KJ Arrow 3, 65–96.

Gorton, G. and A. Metrick (2012). Securitized banking and the run on repo. Journal of
  Financial Economics 104 (3), 425–451.

Gourinchas, P.-O., R. Valdés, O. Landerretche, E. Talvi, and A. V. Banerjee (2001). Lending
  booms: Latin america and the world [with comments]. Economia, 47–99.



                                              40
Greenwald, B. and J. Stiglitz (1986). Externalities in Economies with Imperfect Information
  and Incomplete Markets. Quarterly Journal of Economics 101 (2), 229–264.

Hart, O. D. and L. Zingales (2011). Inefficient provision of liquidity. Technical report,
  National Bureau of Economic Research.

Hart, O. D. and L. Zingales (2013). Inefficient Provision of Liquidity. Technical report,
  Working Paper.

Jeanne, O. and A. Korinek (2013). Macroprudential regulation versus mopping up after the
  crash. Technical report, National Bureau of Economic Research.

Kilenthong, W. T. and C.-Z. Qin (2014). Trade through endogenous intermediaries. Journal
  of Mathematical Economics 50, 262–268.

Kilenthong, W. T. and R. M. Townsend (2011). Information-Constrained Optima with
  Retrading: An Externality and its Market-Based Solution. Journal of economic the-
  ory 146 (3), 1042–1077.

Kilenthong, W. T. and R. M. Townsend (2014a). A Market Based Solution to Price Exter-
  nalities: A Generalized Framework. NBER Working Paper .

Kilenthong, W. T. and R. M. Townsend (2014b). Segregated Security Exchanges with Ex
  Ante Rights to Trade. NBER Working Paper .

Koopmans, T. C. and M. Beckmann (1957). Assignment problems and the location of
  economic activities. Econometrica, 53–76.

Korinek, A. (2010). Regulating capital flows to emerging markets: An externality view.
  Working Paper .

Krishnamurthy, A., S. Nagel, and D. Orlov (2012). Sizing up repo. Technical report, National
  Bureau of Economic Research.

Lindahl, E. (1958). Just Taxation–A Positive Solution. In R. A. Musgrave and A. T. Peacock
  (Eds.), Classics in the theory of public finance. Macmillan, London.


                                              41
Lorenzoni, G. (2008). Inefficient Credit Booms. Review of Economic Studies 75 (3), 809–833.

Negishi, T. (1960). Welfare Economics and Existence of an Equilibrium for a Competitive
  Economy. Metroeconomica 12 (2-3), 92–97.

Prescott, E. C. and R. M. Townsend (1984a). General Competitive Analysis in an Economy
  with Private Information. International Economic Review 25 (1), 1–20.

Prescott, E. C. and R. M. Townsend (1984b). Pareto Optima and Competitive Equilibria
  with Adverse Selection and Moral Hazard. Econometrica 52 (1), 21–45.

Prescott, E. S. and R. M. Townsend (2005). Firms as Clubs in Walrasian Markets with
  Private Information: Technical Appendix. mimeo Federal Reserve Bank of Richmond .

Prescott, E. S. and R. M. Townsend (2006). Firms as Clubs in Walrasian Markets with
  Private Information. Journal of Political Economy 114 (4), 644–671.

Tornell, A. and F. Westermann (2002). Boom-bust cycles in middle income countries: Facts
  and explanation. Technical report, National Bureau of Economic Research.

Townsend, R. M. (1983). Theories of intermediated structures. Carnegie-Rochester Confer-
  ence Series on Public Policy 18, 221–272.




A      Mixture Representation of the New Markets
To deal with the non-convexity problem generated by the collateral constraints, we now use
a probability measure, which is a mixture at the aggregate and a lottery at the individual
level. That is, we now suppose it is possible to assign agents to different exchanges even in
state s. Security trades are also bundled into this potentially random assignment.
    More formally, with a continuum of agents, let xh (c0 , k, θ, τ , z, ∆) be the fraction of
agents type h assigned to a bundle (c0 , k, θ, τ , z, ∆). At the individual level, for each agent
type h, let xh (c0 , k, θ, τ , z, ∆) ≥ 0 denote a probability measure on (c0 , k, θ, τ , z, ∆). In
other words, xh (c0 , k, θ, τ , z, ∆) is the probability of receiving period t = 0 consumption


                                               42
c0 ≡ (c10 , c20 ), collateral k, securities θ = [θ`s ]`,s , spot trade τ = [τ`s ]`,s , and being in
exchanges indexed by z ≡ [zs ]s with rights to trade ∆ ≡ [∆s (zs )]s .
       All securities contracts are entered into ex-ante at t = 0, and spot trades and the valuation
of collateral take place at spot price p (zs ). Unlike the previous discrete choice xh notation
in Section 2.1.5, it is not necessary to index all the objects in the commodity vector by z.
This is because a probability of objects conditioned on z times the marginal probability of z
can be rewritten as a joint probability with z is an object in the commodity vector. But this
still allows many of the objects chosen to be degenerate, as in the example of Environment
3 earlier, where only agent type 1 chooses a lottery on z and securities conditioned on that
draw of z are degenerate.
       As a probability measure, a lottery of an agent type h satisfies
                                         X
                                                      xh (c0 , k, θ, τ , z, ∆) = 1.                      (47)
                                     c0 ,k,θ,τ ,z,∆


       Each bundle (c0 , k, θ, τ , z, ∆) will be feasible only if the collateral and security assign-
ments satisfy the collateral constraints (13), and there is a relationship among z and the
∆s (zs ), s = 1, 2, . . . , S for each zs , namely equation (11).
       Accordingly, we impose the following condition on a probability measure

               xh (c0 , k, θ, τ , z, ∆) ≥ 0 if (c0 , k, θ, τ , z, ∆) satisfies (11) and (13),            (48)

                                         = 0 if otherwise.

       More formally, the consumption possibility set24 of an agent type h is defined by
                 (                                                                )
                                X
           X h = xh ∈ Rn+ :           xh (c0 , k, θ, τ , z, ∆) = 1, and (48) holds .                     (49)
                                  c0 ,k,θ,τ ,z,∆


Note that X h is compact and convex. In addition, the non-emptiness of X h is guaranteed
by assigning mass one to each agent’s endowment, i.e., no trade is a feasible option.
  24
       More formally, with all choice objects gridded up as an approximation, the commodity space L is assumed
to be a finite n-dimensional linear space. The limiting arguments under weak-topology used in Prescott and
Townsend (1984a) can be applied to establish the results if L is not finite.




                                                             43
Pareto Program with Segregated Exchanges

We now can write down the programming problem for the determination of ex ante Pareto
optimal allocations. Instead of maximizing type 1 utility subject to parametric reservation
utilities for the other type, as Program 1, here we just maximize the λ-weighted sum of
expected utilities. But there are utilities and λ’s which make them equivalent. Of course we
need all the resource constraints on consumption, securities, and transfers. In sum we have

Program 2.
                               X                     X
                max                     λh α h                 xh (c0 , k, θ, τ , z, ∆) V h (c0 , k, θ, τ , z, ∆)   (50)
              (xh ∈X h )   h       h             c0 ,k,θ,z,∆

                                                                                                     
where V h (c0 , k, θ, τ , z, ∆) = u ch10 , ch20 + β s πs u eh1s + θ1s + τ1s , eh2s + Rs k + θ2s + τ2s
                                                   P

is the expected utility value derived from a bundle (c0 , k, θ, τ , z, ∆) by an agent type h.
Objective function (50) is subject to resource constraints for good 1 at t = 0, good 2 at
t = 0, securities θ`s , spot trades τ`s , and the rights to trade ∆s (zs ), respectively:
                               X                X                                             X
                                       αh                    xh (c0 , k, θ, τ , z, ∆) c10 =       αh eh10 ,         (51)
                               h            c0 ,k,θ,τ ,z,∆                                    h
                  X                    X                                                      X
                        αh                         xh (c0 , k, θ, τ , z, ∆) [c20 + k] =           αh eh20 ,         (52)
                    h           c0 ,k,θ,τ ,z,∆                                                h
                        X                      X
                                αh                           xh (c0 , k, θ, τ , z, ∆) θ`s = 0, ∀s; zs ; ` = 1, 2,   (53)
                           h           c0 ,k,θ,τ ,z−s ,∆
                        X                      X
                                αh                           xh (c0 , k, θ, τ , z, ∆) τ`s = 0, ∀s; zs ; ` = 1, 2,   (54)
                           h           c0 ,k,θ,τ ,z−s ,∆
                 X                     X
                        αh                          xh (c0 , k, θ, τ , z, ∆) ∆s (zs ) = 0, ∀s; zs ; ` = 1, 2.       (55)
                  h            c0 ,k,θ,τ ,z−s ,∆


   Note again that the resource constraints (51) and (52) imply that all agent types can
trade good 1 and good 2 at t = 0 regardless of their choice of exchange zs . On the other
hand, constraints (53)-(55) imply that each member of an exchange zs can trade ex-ante
securities, spot trades, and rights to trade with other members in the same exchange only.
   The optimal condition with respect to any particular xh (c0 , k, θ, τ, z, ∆) for Pareto Pro-




                                                                      44
gram 2 is
                                                                                            X
             λh V h (c0 , k, θ, τ , z, ∆) ≤ Pe10 c10 + Pe20 c20 + Pe20 k + +                       Q
                                                                                                   e ` (zs , s) θ`s
                                                                                             `,s
                                                                X                           X
                                                           +           Pe` (zs , s) τ`s +          Pe∆ (zs , s) ∆s + Pelh           (56)
                                                                 `,s                         s
     n                                             o
where P`0 , Q` (zs , s) , P` (zs , s) , P∆ (zs , s) are the shadow prices of the resource constraints,
       e    e             e             e

P̃lh is the Langrange multiplier for the probability constraint (49), and the inequality holds
with equality if xh (c0 , k, θ, τ , z, ∆) > 0. Of course, the choice objects xh (c0 , k, θ, τ , z, ∆)
can be zero, no mass, if the marginal gain is less than the costs at shadow prices. One might
note in particular that constraint (55) delivers shadow prices not only for each s but also
for every possible zs conditioned on state s. All of them are satisfied at equality, with the
inactive exchanges trivially since there is no mass there (in the underlying commodity space
excess demands are zero for all types in inactive exchanges).


Competitive Equilibrium with Segregated Exchanges in The Mixture Represen-
tation

To decentralize, let P (c0 , k, θ, τ , z, ∆) be the price for a commodity point (c0 , k, θ, τ , z, ∆).
However we can already guess from the planning problem that, apart from a normalization
to express in terms of the numeriare good 1, in the equilibrium
                                                        X                          X                         X
   P (c0 , k, θ, τ , z, ∆) = c10 + p0 c20 + p0 k +             Q` (zs , s) θ`s +         P` (zs , s) τ`s +       P∆ (zs , s) ∆s .   (57)
                                                         `,s                       `,s                       s


Thus we have a representation of prices on the objects separately; that is, on consumption
goods at t = 0, security purchases or issues, spot market consumption, and the market rights.
For convenience, though we retain the short-hand P notation. Thus, for consumers: each
agent type h chooses xh in period t = 0 to maximize its expected utility:
                                      X
                         max                       xh (c0 , k, θ, τ , z, ∆) V h (c0 , k, θ, τ , z, ∆)                               (58)
                          xh
                                  c0 ,k,θ,τ ,z,∆

subject to xh ∈ X h , and period t = 0 budget constraint
                    X
                                P (c0 , k, θ, τ , z, ∆) xh (c0 , k, θ, τ , z, ∆) ≤ eh10 + p0 eh20 ,                                 (59)
                c0 ,k,θ,τ,z,∆

taking price of good 2 at t = 0, p0 , and prices of lottery, P (c0 , k, θ, τ , z, ∆) as given.

                                                                  45
       As with Arrow’s original paper, we need something on the production side, since a
type’s action enters into the clearing constraints for the market rights ∆s (zs ) (the con-
sistency constraints) and hence helps to determine fundamental zs . Here we create broker
dealers as intermediaries producing trades. Broker-dealers are agents who try to put to-
gether deals, put buyers and sellers of securities together. Formally, the broker-dealer issues
(sells) y (c0 , k, θ, τ , z, ∆) ∈ R+ units of each bundle (c0 , k, θ, τ , z, ∆), at the unit price
P (c0 , k, θ, τ , z, ∆). Note that y (c0 , k, θ, τ , z, ∆) at a particular bundle (c0 , k, θ, τ , z, ∆)
is the number of units of that bundle. There is nothing random. Another distinct bundle
(c0 , k, θ, τ , z, ∆) has its own quantity, number of units y (c0 , k, θ, τ , z, ∆). With θ 6= θ 0 , the
intermediary is taking distinct positions in the market. The clearing constraints below will
ensure that when we add up over all bundles, the net positions add up to zero.25
       Let y ∈ L be the vector of the number of bundles issued as one move across the underlying
commodity points (c0 , k, θ, τ , z, ∆). With constant returns to scale (see below), the profit of
a broker-dealer must be zero and the number of broker-dealers becomes irrelevant. Therefore,
without loss of generality, we assume there is one representative broker-dealer, which takes
prices as given.
       The objective of the broker-dealer is to maximize its profit by supplying y (c0 , k, θ, τ , z, ∆)
as follows:
                               X
            max                             y (c0 , k, θ, τ , z, ∆) [P (c0 , k, θ, τ , z, ∆) − c10 − p0 c20 − p0 k]   (60)
       y(c0 ,k,θ,τ ,z,∆)
                           c0 ,k,θ,τ ,z,∆

subject to clearing constraints:
                                  X
                                                y (c0 , k, θ, τ , z−s , zs , ∆) θ`s = 0, ∀s; zs ; ` = 1, 2,           (61)
                            c0 ,k,θ,τ ,z−s ,∆
                                  X
                                                y (c0 , k, θ, τ , z−s , zs , ∆) τ`s = 0, ∀s; zs ; ` = 1, 2,           (62)
                            c0 ,k,θ,τ ,z−s ,∆
                                 X
                                                y (c0 , k, θ, τ , z−s , zs , ∆) ∆s = 0 , ∀s; zs ,                     (63)
                           c0 ,k,θ,τ ,z−s ,∆

again taking prices p0 , P (c0 , k, θ, τ , z, ∆) as given. Note that constraints (61) ensure that the
books of the broker dealer are balanced in that the value of issuing and holding securities are
  25
       Our intermediary is different from Lindahl’s producer in that our intermediary does not produce public
goods. But the decentralization concept is similar.


                                                                    46
equal. Similarly, constraints (62) imply that total supply of collateral including the unwind
collateral in a particular exchange is equal to the total commitment to buy the collateral in
the same exchange, and constraints (63) ensure that the net supply of the rights to trade in
an exchange is zero.
    The existence of a maximum to the broker-dealer’s problem requires, that for any bundle
(c0 , k, θ, τ , z, ∆),
                                                      X                           X                          X
    P (c0 , k, θ, τ , z, ∆) ≤ c10 + p0 c20 + p0 k +          Q
                                                             b ` (zs , s) θ`s +         Pb` (zs , s) τ`s +       Pb∆ (zs , s) ∆s ,   (64)
                                                       `,s                        `,s                        s


 where Q
       b` (zs , s), Pb` (zs , s) and Pb∆ (zs , s) are the shadow price of an ex-ante security paying

in good ` of constraints (61), the shadow price of the spot trade of good ` of constraints (62),
and the shadow price of the right to trade in the security exchange zs of constraints (63),
respectively. Condition (64) holds with equality if y (c0 , k, θ, τ , z, ∆) > 0. On the other
hand, if the inequality (64) is strict, then y (c0 , k, θ, τ , z, ∆) = 0 as when implicit shadow
costs are greater than revenue.
    Market Clearing: The market clearing condition for good 1 in period t = 0 is
                                    X                                                   X
                                                 y (c0 , k, θ, τ , z, ∆) c10 =                αh eh10                                (65)
                                c0 ,k,θ,τ ,z,∆                                            h

Similarly, the market clearing condition for good 2 in period t = 0 is
                                X                                                             X
                                             y (c0 , k, θ, τ , z, ∆) [c20 + k] =                  αh eh20                            (66)
                            c0 ,k,θ,τ ,z,∆                                                    h

The market clearing conditions for mixtures in period t = 0 are
               X
                    αh xh (c0 , k, θ, τ , z, ∆) = y (c0 , k, θ, τ , z, ∆) , ∀ (c0 , k, θ, τ , z, ∆) .                                (67)
                h

Definition 6. A competitive equilibrium with segregated exchanges (with mixtures) is a
                                  
specification of allocation xh , y , and prices (p0 , P (c0 , k, θ, τ , z, ∆)) such that

  (i) for each h, xh ∈ X h solves utility maximization problem (58) subject to period t = 0
       budget constraint (59), taking prices as given;
                                       n                                            o
 (ii) for the broker-dealer,            y, Q
                                           b` (zs , s) , Pb` (zs , s) , Pb∆ (zs , s) solve profit maximization

       problem (60) subject to clearing-trade constraints (61)-(63) taking prices as given;

                                                                47
 (iii) markets for good 1, for good 2, and for mixtures in period t = 0 clear, i.e., (65), (66)
      and (67) hold.

    Note that market clearing (67) when substituted into the broker dealer problem gives
the Pareto programming problem. Indeed, intuitively, one can go back and forth between
the shadow prices of the Pareto problem and the prices and Lagrange multipliers of the
consumer and intermediary Lagrangian problems, as first order conditions are necessary and
sufficient.



B      Proofs
Proof of Proposition 1. We first prove that a competitive collateral equilibrium is constrained
                                                                         h
optimal if and only if all collateral constraints are not binding, i.e. γcc−s = µhcc−s = 0 for all
h and all s. The proof is based on the first-order conditions for Pareto program (15) and
the first-order conditions for a competitive collateral equilibrium. Note that the resource
constraints in the Pareto program (15) and the market-clearing constraints in the competi-
tive collateral equilibrium are clearly equivalent. In addition, the collateral constraints are
the same in both problems as well. Hence, we only need to match all first-order conditions
from both problems. In addition, with limited space, we will focus only on the term that
generates an externality.


Optimal Conditions for the Pareto Program (15)

Let µhcc−s and µhū denote the Lagrange multipliers for the collateral constraint (13) for state
s for an agent type h and for the participation constraint (16) for an agent type h =
1, 2, . . . , H with a normalization of µ1ū = 1, respectively. Combining the first-order conditions
with respect to ch10 and k h , and the complementarity slackness conditions for the collateral
constraints gives:

  uh20   X     uh2s    X µhcc−s               X αh                ∂zs X h̃ h            i
                                                           0                     h   h̃
       =   πs β h Rs +             p(zs )Rs +             p (zs )      µcc−s Rs k + θ2s
  uh10   s
               u10     s
                         µhū uh10            s
                                                µhū uh10         ∂K
                                                                            h̃
              X       uh          X µhcc−s             X αh p0 (zs ) ∂zs X
        =         πs β h2s Rs   +    h h
                                            p(zs )Rs −    h h p(z ) ∂K
                                                                           µh̃cc−s θ1s
                                                                                    h̃
                                                                                       ,       (68)
              s
                      u10         s
                                    µū u10            s
                                                         µū u10 s
                                                                             h̃


                                                   48
where the last equation follows from the complementarity slackness condition with respect
to collateral constraints:
                n      h              i       o              h              i    µh̃ θh̃
         µh̃cc−s p(zs ) Rs k h̃ + θ2s
                                   h̃      h̃
                                        + θ1s   = 0 ⇒ µh̃cc−s Rs k h̃ + θ2s
                                                                         h̃
                                                                              = − cc−s 1s .        (69)
                                                                                  p(zs )
Note that (68) is exactly the same as (17).


Optimal Conditions for a Collateral Equilibrium

Let γcc−s be the Lagrange multiplier for the collateral constraint for state s. Combining the
first-order conditions with respect to ch10 and k h gives:
                                                  h
                            uh20   X βuh
                                         2s
                                               X γcc−s
                                 =   πs h Rs +         p(zs )Rs .                                  (70)
                            uh10   s
                                       u10     s
                                                  uh10

   We are ready to prove the lemma.

                         h
  (i) (⇐=) Suppose that γcc−s = µhcc−s = 0 for all h and all s. We then can show that
      any competitive collateral equilibrium allocation will also solve the Pareto program
      (15) by matching all necessary and sufficient conditions. In particular, we can pick
      µ20                                        µh
      µ10
            = p0 , µµ10
                     `s              h
                        = Q`s , and γcc−s =       cc−s
                                                  µh
                                                         = 0. In conclusion, any collateral equilibrium
                                                    ū
                                            h
      allocation is constrained optimal if γcc−s = µhcc−s = 0 for all h and all s.

 (ii) (=⇒) Suppose that a competitive collateral equilibrium allocation is constrained opti-
      mal, i.e., solves the Pareto program (15). Hence, it must satisfy (68). Using the same
      matching conditions as above, this will be true only if the last terms in (68) is zero.
      We will prove this by a contradiction argument.

      Suppose that there are some h̃ with µh̃cc−s 6= 0, and the last terms in (68) is zero:
                                                                
                              h X 0
                           α        p (zs ) ∂zs X h̃         h̃ 
                           h h
                                                       µcc−s θ1s   = 0.                     (71)
                          µū u10 s p(zs ) ∂K
                                                               h̃

      This must be true for all h and h̃.

      We will now argue that h̃ µh̃cc−s θ1s
                                         h̃
                             P
                                            has the same negative sign for every state s. Using
                                                                        h
      the first-order condition for the Pareto program with respect to θ1s , we can show that
                          X                      X                        X
                                 µh̃cc−s θ1s
                                          h̃
                                             =        µ1s αh̃ θ1s
                                                               h̃
                                                                  − βπs        µh̃ū uh̃1s θ1s
                                                                                            h̃
                                                                                               ,   (72)
                            h̃                   h̃                       h̃


                                                         49
                                                                       h
where µ1s is the Lagrange multiplier for the resource constraint for θ1s . The resource
                h
                     P h̃ h̃                          P          h̃ h̃
constraint for θ1s ,  h̃ α θ1s = 0, then implies that    h̃ µ1s α θ1s = 0 for all s. In

addition, the first-order condition for the Pareto program with respect to ch10 implies
                 µ10 αh̃
that µh̃ū =             .   Thus, we now have
                  uh̃
                   10

                                                                                           !
                                   X                                    X          uh̃1s
                                         µh̃cc−s θ1s
                                                  h̃
                                                     = −βπs µ10                                αh̃ θ1s
                                                                                                    h̃
                                                                                                       .                              (73)
                                    h̃                                    h̃
                                                                                   uh̃10

                                                                                                                 uh̃
The optimality requires that an agent with relative large IMRS,                                                   1s
                                                                                                                       , will hold positive
                                                                                                                 uh̃
                                                                                                                  10
 h̃
θ1s                                                                 h̃
    ≥ 0 and vice versa. This implies that the positive term of αh̃ θ1s ≥ 0 will be weighted
                                                                                    h
more than the negative one. Combining this result with the resource constraint for θ1s ,
P h̃ h̃                                 
                                    P uh̃1s  
 h̃ α θ1s = 0, we can conclude that  h̃   h̃
                                               αh̃ θ1s
                                                    h̃
                                                       ≥ 0, ∀s, and therefore
                                                                    u10
                                                                                   !
                             X                                 X           uh̃1s
                                   µh̃cc−s θ1s
                                            h̃
                                               = −βπs µ10                              αh̃ θ1s
                                                                                            h̃
                                                                                               ≤ 0, ∀s.                               (74)
                              h̃                                   h̃
                                                                           uh̃10

With strictly concave and identical homothetic utility function, we can show that
p0 (zs ) ∂zs
p(zs ) ∂K
               < 0, and therefore can conclude that
                                                                              
                                          0
                                         p (zs ) ∂zs    X
                                                              µh̃cc−s θ1s
                                                                       h̃ 
                                                                            ≥ 0, ∀s.                                                  (75)
                                         p(zs ) ∂K
                                                         h̃


As a result, (71) will hold only if
                                                                                   !
                             X                                 X           uh̃1s
                                   µh̃cc−s θ1s
                                            h̃
                                               = −βπs µ10                              αh̃ θ1s
                                                                                            h̃
                                                                                               = 0, ∀s.                               (76)
                              h̃                                   h̃
                                                                           uh̃10

                                                                                                  uh̃        uh
                            αh̃ θ1s
                                 h̃
                  P
Given that             h̃           = 0, condition (76) implies that                               1s
                                                                                                        =     1s
                                                                                                             uh
                                                                                                                 ,   ∀h, h̃; s. Using the
                                                                                               uh̃
                                                                                                10            10
                uh                                                                         uh̃          uh
fact that        2s
                uh
                      = p(zs ) for all h, we can also show that                             1s
                                                                                                   =     1s
                                                                                                        uh
                                                                                                             ,   ∀h, h̃; s. In words, the
                 1s                                                                        uh̃
                                                                                            1ŝ          1ŝ

marginal rate of substitutions across times and states are equalized across agent types.
Under the assumption stated in the proposition, these equalities are necessary and
sufficient conditions for first-best optimality, which in turn implies that all collateral
                                    h
constraints are not binding, i.e., γcc−s = µhcc−s = 0 for all h and all s. Hence, we
can conclude that a collateral equilibrium is constrained optimal, solving the Pareto
program (15), only if all collateral constraints are not binding.

                                                              50
   The rest of the proof is by contrapositive. Suppose a competitive collateral equilibrium is
constrained optimal. The above result implies that a necessary and sufficient condition for a
competitive collateral equilibrium to be constrained optimal is that all collateral constraints
are not binding. No binding collateral constraints implies first-best optimality. In short, we
have shown that first-best optimality is a necessary and sufficient condition for constrained
optimality. Thus we can conclude that a competitive collateral equilibrium is constrained
suboptimal if and only if it is not first-best optimal.

Proof of Proposition 2. The proof is an immediate result of the proof of proposition 1 above.
First, if a competitive collateral equilibrium is not first-best optimal, then (by Proposition
1) we can show that the last term of (68) is strictly positive:
                             X αh p0 (zs ) ∂zs X
                                 h h p(z ) ∂K
                                                 µh̃cc−s θ1s
                                                          h̃
                                                             > 0.                                                      (77)
                             s
                               µ   u
                                 ū 10  s
                                                           h̃

This implies that the marginal rate of substitution between good 1 and good 2 in period
t = 0 at the competitive collateral equilibrium is larger than the optimal level of the marginal
                                                                                               uh           uh
rate of substitution between good 1 and good 2 in period t = 0, i.e.,                           20
                                                                                               uh
                                                                                                        >    20
                                                                                                            uh
                                                                                                                   .   This
                                                                                                10 ce        10 op

implies that the equilibrium price of good 2 in period t = 0 is too high relative to its
                                                                            uh
shadow price from the (constrained) optimal allocation                       20
                                                                            uh
                                                                                   .    In addition, given that the
                                                                             10 op

aggregate consumption of good 1 is fixed and preferences are identically homothetic, this
result can be true only if the (endogenous) aggregate saving/collateral in a competitive
collateral equilibrium, K ce , is too large, i.e., K ce > K op .

Proof of Theorem 1. Let (x, y), and (p0 , P (c0 , k, θ, τ , z, ∆)) be a competitive equilibrium.
Suppose the competitive equilibrium allocation is not Pareto optimal, i.e. there is an at-
                                                                                  
tainable allocation x̃ ∈ X such that U h x̃h ≥ U h xh for all h and U h x̃h̃ > U h xh̃
for some h̃. For notational purposes, let b ≡ (c0 , k, θ, τ , z, ∆) be a typical bundle. With
local nonsatiation of preferences, we have b P (b) xh (b) ≤                   h
                                              P                   P
                                                                    b P (b) x̃ (b) for all h, and
            ĥ                ĥ                                                            h
P                  P
   b P (b) x (b) <  b P (b) x̃ (b) for some ĥ. Summing over all agents with weights α , we

have
                           X             X                 X                X
                                 P (b)       αh xh (b) <            P (b)       αh x̃h (b) .                           (78)
                             b           h                      b           h




                                                      51
 The optimal condition (64) for the market-maker’s profit maximization problem implies
that, for any typical bundle b,
                                                                                                                      
                                              X                          X                          X
  P (b)y(b) = c10 + p0 c20 + p0 k +                Q
                                                    b ` (zs , s) θ`s +         Pb` (zs , s) τ`s +        Pb∆ (zs , s) ∆s  y(b).
                                              s,`                        s,`                        s

                                                                                                                              (79)

Using the market-clearing condition for mixtures in period t = 0, (67), we can substitute
P h h
 h α x (b) for y(b) for every bundle b on the left hand side. Then, summing over all bundles

b gives
                           X             X                     X                       X
                                 P (b)        αh xh (b) =            αh eh10 + p0            αh eh20 ,                       (80)
                           b             h                       h                       h

where we apply the technology constraints of the broker-dealer (61)-(63) and the market
clearing conditions (65)-(66). Similarly, from what we know already about expenditures for
the supposed dominating bundle at the outset of this proof, we can also show that
                    X         X              X               X
                        P (b)   αh x̃h (b) ≤    αh eh10 + p0   αh eh20 .                                                     (81)
                           b              h                      h                      h

Using (80) and (81), (78) can be rewritten as
                  X                X           X              X
                      αh eh10 + p0   αh eh20 <   αh eh10 + p0   αh eh20
                       h                      h                  h                      h

This is a contradiction!

Proof of Theorem 2. We will first prove that any constrained optimal allocation can be de-
centralized as a compensated equilibrium. Then, we will use a standard cheaper-point ar-
gument (see Debreu, 1954) to show that any compensated equilibrium is a competitive
equilibrium with transfers. The compensated equilibrium is defined as follows.

Definition 7. A compensated equilibrium is a specification of allocation (x, y), and prices
p0 , P (c0 , k, θ, τ , z, ∆) such that

  (i) for each h as a price taker, xh ∈ X h solves
                               X
                       min             P (c0 , k, θ, τ , z, ∆) x̂h (c0 , k, θ, τ , z, ∆)                                     (82)
                           x̂h
                                 (c0 ,k,θ,τ ,z,∆)

      subject to
                                                      U h x̂h ≥ U h xh ;
                                                                     
                                                                                                                             (83)

                                                              52
                           n                                            o
 (ii) for the market-maker, y, Q
                               b` (zs , s) , Pb` (zs , s) , Pb∆ (zs , s) solves (60), taking prices as

     given,

(iii) in period-0, markets for good-1, good-2 and mixtures clear, i.e., (65)-(67) hold.

   Given that the optimization problems are well-defined concave problems, Kuhn-Tucker
conditions are necessary and sufficient. The proof are divided into three steps.

  (i) Kuhn-Tucker conditions for a compensated equilibrium allocation: Let γ h (0) and γ h (l)
     be the Lagrange multiplier for constraint (83), and for the probability constraint (47),
     respectively. The optimal condition for xh (c, k, θ, τ , z) is given by

                             γ h (0)V h (c0 , k, θ, τ , z, ∆) ≤ P (c0 , k, θ, τ , z, ∆) + γ h (l),                                                (84)

     where the inequality holds with equality if xh (c0 , k, θ, τ , z, ∆) > 0. Recall that the
     optimal condition (64) for the market-maker’s profit maximization problem implies
     that, for any typical bundle b,
                                                                                                                                            
                                                       X                          X                           X
        P (b) ≤ c10 + p0 c20 + p0 k +                       Q
                                                             b ` (zs , s) θ`s +          Pb` (zs , s) τ`s +           Pb∆ (zs , s) ∆s  . (85)
                                                       s,`                        s,`                            s


      where the condition holds with equality if y (c0 , k, θ, τ , z, ∆) > 0.

 (ii) Kuhn-Tucker conditions for Pareto optimal allocations: A solution to the Pareto
     program satisfies condition (56). In addition, for any bundle (c0 , k, θ, τ , z, ∆) with
                                                                                                   Q
                                                                                                   e 2 (zs ,s)             uh
     xh (c0 , k, θ, τ , z, ∆) > 0 for some h, we can show that                                     Q
                                                                                                   e 1 (zs ,s)     =        2s
                                                                                                                           uh
                                                                                                                                  = p(zs ). This
                                                                                                                            1s

     result is derived using a variational principle with respect to θ1s and θ2s , and using
     the fact that the agent can trade in spot markets at price p(zs ), which implies that
      uh
       2s
      uh
            = p(zs ).
       1s


                                                                                                        λh                       Pe20
(iii) Matching dual variables and prices: We then set γ h (0) =                                        Pe10
                                                                                                            ,     p0 =           Pe10
                                                                                                                                      ,   Q
                                                                                                                                          b` (zs , s) =
      Q
      e ` (zs ,s)                      Pe` (zs ,s)                         Pe∆ (zs ,s)                            Pelh
         Pe10
                  ,   Pb` (zs , s) =      Pe10
                                                   ,   Pb∆ (zs , s) =         Pe10
                                                                                         and γ h (l) =           Pe10
                                                                                                                       ,   which imply that
     the optimal conditions of the Pareto program are equivalent to the optimal conditions
     for consumers’ and market-maker’s problems in the compensated equilibrium. That
     is, a solution to the Pareto program also solves the consumer’s and market-maker’s
     problems. Again the resource and consistency constraints in the Pareto program are

                                                                      53
      identical to the market-clearing and consistency conditions in equilibrium. To sum up,
      any Pareto optimal allocation is a compensated equilibrium.

   Next we show that any compensated equilibrium, corresponding to λh > 0, is a com-
petitive equilibrium with transfers using the cheaper point argument. First of all, let the
wealth of an agent type h in the compensated equilibrium be wh = b P (b) xh (b), which
                                                                       P
                  P h h     P h h                
is feasible, i.e.  hα w =     hα    e10 + p0 eh20 . In addition, with λh > 0, for every h, an
Inada condition guarantees that a solution to the Pareto program, which is a compensated
equilibrium allocation, will not have a strictly positive mass on c = 0.
     We can pick a cheaper allocation as x̂, with c0 = 0. More specifically, let 0 ∈ C, and set
x̂h (0, k, θ, τ , z, ∆) = c0 xh (c0 , k, θ, τ , z, ∆) and x̂h (c0 , k, θ, τ , z, ∆) = 0, for any c0 6= 0.
                         P

Note that the alternative allocation put strictly positive masses on bundles with c0 = 0. The
strictly increasing utility function implies that p0 > 0. Consequently, the optimal condition of
the market-maker (64) implies that P (c0 , k, θ, τ , z, ∆) > P (0, k, θ, τ , z, ∆), for any c0 ≥ 0
and c0 6= 0. As a result, we can show that b P (b) xh (b) > b P (b) x̂h (b).
                                            P                   P

   To sum up, we have shown that there exists an allocation x̂h that is cheaper than the
compensated equilibrium allocation, xh , for every agent h. As a result, using the cheaper-
point argument, a compensated equilibrium is a competitive equilibrium with transfers.

Proof of Theorem 3. For notational convenience, we redefine the grid to include the endow-
ment profiles, i.e.,

                  eh (b) = 1,      for b = (e0 , k = 0, θ = 0, τ = 0, z = 0, ∆ = 0)

                            = 0,   otherwise

In addition, the optimal condition of the market-maker (64) implies that the price of bundle
                                                                
 eh0 , k = 0, θ = 0, τ = 0, z = 0, ∆ = 0 is P eh0 , 0, 0, 0, 0, 0 = eh10 +p0 eh20 . Therefore, the total
value of period-0 endowment lottery of an agent h, eh , is given by
                    X
                       P (b) eh (b) = P eh0 , 0, 0, 0, 0, 0 = eh10 + p0 eh20
                                                           
                                                                                                    (86)
                        b

which is exactly income in the budget constraint (59).
   Let P = [P (b)]b be the prices of all bundles. In addition, we also add the price of good 2
in period t = 0, p0 into the price space as p0 = P (c = (0, 1), 0, 0, 0, 0, 0). As in Prescott and

                                                   54
Townsend (2005), with the possibility of negative prices, we restrict prices P to the closed
unit ball;
                                     n        √         o
                                  D = P ∈ Rn | P · P ≤ 1 ,                                   (87)

where “·” is the inner product operator. Note that the set D is compact and convex.
   Consider the following mapping (λ, x, P) → (λ0 , x0 , P0 ), where λ, λ0 ∈ S H−1 , xh ∈ X h .
Recall that the consumption possibility set X h is non-empty, convex, and compact. Let X
be the cross-product over h of X h : X = X 1 × . . . × X H .
   The first part of the mapping is given by λ −→ (x0 , P0 ), where x0 is the solution to the
Pareto program given the Pareto weight λ, and P0 is the renormalized prices. With the
second welfare theorem, the solution to the Pareto program for a given Pareto weight λ also
gives us (compensated) equilibrium prices P∗ . The nonlocal satiation of preferences implies
that P∗ 6= 0. The normalized prices are given by

                                                  P∗
                                          P0 =
                                                 P∗ · P∗

Note that P0 · P0 = 1. In order to preserve the convexity of the mapping while prices in
the unit ball D, we define the convex hull of the normalized prices. Let D
                                                                         e be the sets of all
                                     e be its convex hull. Since P0 ∈ D,
normalized prices, and accordingly coD                                e P0 ∈ coD,
                                                                               e which

is compact and convex. Note that extending D
                                           e to its convex hull does not add any new

relative prices. It is not too difficult to show that this mapping, λ −→ (x0 , P0 ), is non-empty,
compact-valued, convex-valued. By the Maximum theorem, it is upper hemi-continuous. In
addition, the upper hemi-continuity is preserved under the convex-hull operation.
   The second part of the mapping is given by (λ, x, P) −→ λ0 . The new weight can be
formed as follows:
                                          (                      )
                                                P · e h − xh
                            λ̂h   = max 0, λh +                                              (88)
                                                     A

                             0h      λ̂h
                          λ = P                                                    (89)
                                          h
                                      h λ̂
                                                    
where A is a positive number such that h P · eh − xh ≤ A. It is clear that this mapping
                                       P

is also non-empty, compact-valued, convex-valued, and upper hemi-continuous. In conclu-
sion, (λ, x, P) → (λ0 , x0 , P0 ) is a mapping from S H−1 × X × S n−1 −→ S H−1 × X × S n+1 .

                                                 55
Since each set is non-empty, compact, and convex, so does its cross-product. In addition, the
overall mapping is non-empty, compact-valued, convex-valued, and upper hemi-continuous
since these properties are preserved under the cross product operation. By Kakutani’s fixed
point theorem, there exists a fixed point (λ, x, P).
    Proved in Theorem 2, any Pareto optimal allocation can be supported as a compensated
equilibrium. In addition, the strictly increasing utility function implies that p0 > 0. Hence,
with positive endowments, an agent h’s wealth at the fixed point is strictly positive;

                                wh = P · eh = eh10 + p0 eh20 > 0

With strictly positive wealth, a compensated equilibrium is a competitive equilibrium with
transfers (using a cheaper-point argument as in the proof of Theorem 2).
    We now need to show that there is no need for wealth transfers in equilibrium, i.e., the
budget constraint without transfers

                                       P · eh − x h = 0
                                                   


holds for every agent h. It is not difficult to show that
                                  X
                                       α h P · e h − xh
                                                          
                                                              = 0
                                   h
                                             
   In addition, at a fixed point P · eh − xh must be the same sign for every h. Hence,
           
P· eh − xh = 0 for every agent h. This clearly confirms that the budget constraint (without
transfers) of every agent h holds. Hence, a competitive equilibrium (without transfers)
exists.



C         More Results
Lemma 1. For any state-contingent security, there exists a security with no default that
can generate the same total payoffs using the same amount of collateral.

Proof of Lemma 1: Default is Irrelevant under Complete Contracts. Consider a contingent
                                                                       1
security that will be in default in state s, with collateral C
                                                             b<
                                                                    Rs p(zs )
                                                                              .   That is, an issuer of


                                                56
this security will “default” in state s. Hence, according to condition (??), the payoff of this
security (in units of good 1) in state s is
                                             
                             min 1, CRs p(zs ) = CR
                                    b            b s p(zs ) < 1.                                     (90)

   We now argue that there is an alternative security that does not default but generates
exactly the same total payoffs using the same amount of collateral overall. Consider a state-s
                                                             1
contingent security with collateral amount C
                                           e =
                                                          Rs p(zs )
                                                                    .   This security will not default. It
is straightforward to show that the payoff of this security is one unit of good 1 in state s.
Now consider CR
             b s p(zs ) units of the alternative security. That collection of securities pays

in state s one per unit or CR
                           b s p(zs ) in total. This is exactly the same as the payoff of the

original security with default: see (90). In addition, the total collateral for CR
                                                                                b s p(zs ) units
                                      1
of the alternative security with   Rs p(zs )
                                               collateral per unit is C,
                                                                      b which is exactly the same as

the collateral level of the original security. Therefore, the alternative security can generate
the same payoffs using the same total amount of collateral but without default. A similar
argument also applies to all other types of securities.


C.1     Details of the Building Blocks of the Collateral Constraints

This section precisely defines directly collateralized and asset-back securities (pyramiding),
and derives the unified collateral constraints (1) by considering the collateral constraints of
each type of securities one at a time and adding them up (and disaggregating back down).


Collateral Constraints on Directly Collateralized Securities

     h       h
Let ψ1s and ψ2s denote agent h’s demand at the end of period 0 for a security paying in
good 1 and in good 2, both with good 2 as collateral directly, respectively. Again, we
adopt the convention that positive means demand and negative means sale. So, holding
                                                                  h
                                                                         h
a positive amount of a security paying good 2 in state s, max 0, ψ2s   = ψ2s , a positive
number, is equivalent to buying that security (or lending) while holding a negative amount
                       h
                              h
of a security, min 0, ψ2s   = ψ2s , a negative number, is equivalent to selling that security (or
borrowing). In short, the max and min operators pick off demand and supply, respectively.
A wedge is created by the need to back the supply by collateral but not the demand.

                                                    57
   More generally, a security paying a unit of good 1 in state s backed by good 2 pays the
minimum of 1 unit of good 1 or the value of its collateral in state s. By an argument similar
                                                                                       1
to the one given earlier, the minimum no-default collateral is                      p(zs )Rs
                                                                                                 per unit. Similarly, with
                                                                                                                                   1
no-default and no-over-collateralization, a security paying in good 2 in state s requires                                          Rs

units of good 2 as collateral. The results so far are summarized in the first two rows of the
Table 6 with collateral requirement in the last column.

                 Table 6: Collateral requirements for each type of securities.
       payment   collateral               issued                        purchased assets                  total collateral
       unit      unit                     liabilities                   available                         requirement for
                                                                        as collateral                     no default securities
                                                                                                                     
                                                                                                                1
  h                                                          h
                                                                                 h
                                                                                                                                h
                                                                                                                                   
 ψ1s   good 1    good 2                   − min 0, ψ1s                  max 0, ψ1s                        − Rs p(z s)
                                                                                                                        min 0, ψ1s
                                                                                                             
                                                                                                          − R1s min 0, ψ2s
  h                                                 h
                                                                                 h
                                                                                                                           h
                                                                                                                              
 ψ2s   good 2    good 2                   − min 0, ψ2s                  max 0, ψ2s
                                                                                                                  
                                                                                                          − p(z1s ) min 0, σ1s
  h                                                 h
                                                                                 h
                                                                                                                             h
                                                                                                                                
 σ1s   good 1    securities paying        − min 0, σ1s                  max 0, σ1s
                 in good 2
  h                                                 h
                                                                               h
                                                                                                                         h
                                                                                                                               
 σ2s   good 2    securities paying        − min 0, σ2s                  max 0, σ2s                        −p(zs ) min 0, σ2s
                 in good 1
  h                                                 h
                                                                               h
                                                                                                                   h
                                                                                                                         
 ν1s   good 1    securities paying        − min 0, ν1s                  max 0, ν1s                        − min 0, ν1s
                 in good 1
  h                                                 h
                                                                               h
                                                                                                                   h
                                                                                                                         
 ν2s   good 2    securities paying        − min 0, ν2s                  max 0, ν2s                        − min 0, ν2s
                 in good 2


                   h     h
                            
   For securities ψ1s , ψ2s   with good 2 as collateral, paying in good 1 and good 2, respec-
tively, agent h must hold good 2 at the end of period 0 no less than the collateral requirement
in any state (shown in Table 6):
                                                                                                   
                     h                    h
                                                         1                        h
                                                                                                1
                 k         ≥ − min    0, ψ1s                           − min   0, ψ2s                     , ∀s,                (91)
                                                       Rs p(zs )                                 Rs

which can be rewritten as

                         p(zs )Rs k h + min 0, ψ1s
                                                h                     h
                                                                        
                                                     + p(zs ) min 0, ψ2s   ≥ 0, ∀s.                                            (92)

These are state-contingent collateral requirement constraints with directly collateralized se-
curities. We incorporate asset-backed securities in the next section.

                                                            58
   Note that when an agent h’s collateral requirement constraints (91) are not binding for
every state s (i.e., the LHS of (91) exceeds its RHS or (91) holds with strict inequality
for every state s), then the agent h holds collateral k h more than needed to back issued
securities. The extra part of collateral is normal saving.


Pyramiding: Asset-Backed Securities

In real world economies, agents are allowed to use the promises to receive goods of others as
collateral to back their own promises. This is termed pyramiding. In other words, there are
two types of collateral, good 2 itself (described in the preceding section) and “assets” backed
by such collateral. The prototypical example of an asset-backed promise in this paper is an
ex-ante agreement for an agent to give up good 1 in the spot market in state s backed by
someone else’s promise, a receipt of good 2, or vice versa. The promise of receipt is the asset,
and this backs the promise to pay. Indeed, if the planned spot-market trade is at equilibrium
price of p(zs ), then one is moving along a budget line and so the value of collateral, the good
to be recovered, exactly equals the promise and there is no need for additional underlying
collateral.
   With two physical commodities, there are four possible types of asset-backed securities,
summarized in the last four rows of Table 6. For example, a unit of an asset-backed security
                                                1
σ̂s paying in good 1 in state s needs         p(zs )
                                                       units of assets paying in good 2 as collateral. The
                           1
value of the payoff of   p(zs )
                                  units of securities paying in good 2 in state s equals p(zs )× p(z1s ) = 1
unit of good 1, which is exactly the face-value promise to pay. These collateral requirements
are minimum no-default levels.
   As shown in the third row of Table 6 (see the column titled total collateral requirement),
                                                               h
an asset-backed security paying a unit of good 1 in state s, σ1s , requires that the total amount
                                                                        
of purchased assets paying in good 2 in state s is no less than − p(z1s ) min 0, σ1sh
                                                                                      
                                                                                        . Similarly,
                             h
an asset-backed security ν2s   requires that the total amount of purchased assets paying in good
                                         h
                                           
2 in state s is no less than − min 0, ν2s    (see the last row of Table 6). On the other hand, the
                                                                   h
                                                                                h
                                                                                              h
                                                                                                 
total amount of purchased assets paying in good 2 is max 0, ψ2s        +max 0, σ2s   +max 0, ν2s  ,
as shown in the second, fourth and last rows of Table 6 (see the next-to-last column titled
purchased assets). Hence, the collateral requirement condition regarding issued securities

                                                          59
 h       h
σ1s and ν2s that require financial assets paying in good 2 as collateral can be written as, for
any state s,
                                                                                    
              h                    h                    h                     1                  h
                                                                                                      − min 0, νsh .
                                                                                                              
   max    0, ψ2s       + max   0, σ2s       + max   0, ν2s        ≥ −                    min 0, σ1s
                                                                            p(zs )
                                                                                  h     h     h
This states that the agent purchases enough assets or promises paying in good 2, θ2s , σ2s , ν2s ,
                                                               h     h
to back up her own asset-backed securities or issued promises σ1s , ν2s . The above condition
can be rearranged as

                              h                     h             h              h
                                                                                  
               p(zs ) max 0, ψ2s   + p(zs ) max 0, σ2s   + p(zs )ν2s ≥ − min 0, σ1s   ,                             (93)

                                       h
                                                     h
                                                             h
where we applies the fact that max 0, ν2s   + min 0, ν2s   = ν2s .
   Similarly, the collateral requirement condition for issued securities that require financial
assets paying in good 1 as collateral is given by

                           h              h       h                    h
                                                                        
                   max 0, ψ1s   + max 0, σ1s   + ν1s ≥ −p(zs ) min 0, σ2s   , ∀s,                                   (94)

where the right-hand-side comes from the fourth and fifth rows of Table 6.
   We now show that the collateral constraints

                                   p(zs )Rs k h + θ1s
                                                   h           h
                                                      + p(zs )θ2s ≥ 0, ∀s                                           (95)

are equivalent to collateral requirement conditions (with three types of collateral), (92), (93),
and (94). In other words, there is no loss of generality to use the collateral constraints (95);
an allocation is attainable under (95) if and only if it is so under (92), (93), and (94).
                            h     h     h     h       h     h     h     h
   To be more precise, let θ1s = ψ1s + σ1s + ν1s and θ2s = ψ2s + σ2s + ν2s be contingent
securities paying in good 1 and in good 2 in state s, respectively, which can be backed either
                                                                    h       h
by good 2 or purchased assets (other people’s promises). Note that θ1s and θ2s include both
directly collateralized and asset-backed securities. An attainable allocation under (92), (93),
and (94) can be defined similarly to the one under (1) by replacing (7) the following resource
constraints:
    X                  X               X                X                   X               X
         αh ψ1s
             h
                =           αh ψ2s
                                h
                                   =         αh σ1s
                                                 h
                                                    =            αh σ2s
                                                                     h
                                                                        =       αh ν1s
                                                                                    h
                                                                                       =          αh ν2s
                                                                                                      h
                                                                                                         = 0, ∀s.   (96)
     h                  h               h               h                   h                 h

   The collateral constraint (95) results from summing (92), (93), and (94) altogether, and
then applying max(0, x)+min(0, x) = x to get rid of max and min operators. In addition, the

                                                             60
                                                                   h     h     h     h     h     h
                                                                                                                    
proof of this lemma also shows how to recover contract allocation ψ1s , ψ2s , σ1s , σ2s , ν1s , ν2s                     h
        h    h
                
from θ1s  , θ2s  .

Lemma 2. The following statements are true:
                                                         
  (i) if ch0 , k h , ψ1s
                      h     h
                         , ψ2s    h
                               , σ1s    h
                                     , σ2s    h
                                           , ν1s    h
                                                 , ν2s       h
                                                                 is attainable, then the collateral constraint (95) and
       the market-clearing conditions (7) hold, and
                           
 (ii) if k h , θ1s
                h     h
                   , θ2s   h
                              is attainable, then there exists a collateral and security allocation
                                                
        k h , ψ1s
               h     h
                  , ψ2s    h
                        , σ1s    h
                              , σ2s    h
                                    , ν1s    h
                                          , ν2s  h
                                                   that satisfies collateral requirement conditions (92), (93),
       (94) and the market-clearing conditions (96).

Proof. The first statement can be proved as follows. First, it is clear that conditions (96)
imply (7). We now only need to show that (92), (93), and (94) imply (95). Summing up all
collateral requirement conditions, (92), (93), and (94), and using the fact that max (0, x) +
min (0, x) = x give, for an agent h in state s,

                    p(zs )Rs k h + ψ1s
                                   h     h     h
                                                             h     h     h
                                                                              
                                       + σ1s + ν1s   + p(zs ) ψ2s + σ2s + ν2s   ≥ 0,

                                                                    h     h     h     h
which is the collateral constraint for an agent h in state s where θ1s = ψ1s + σ1s + ν1s and
 h     h     h     h
θ2s = ψ2s + σ2s + ν2s .
                                                                                                         
    The second statement is proved as follows. Consider an allocation k h , θ1s
                                                                             h     h
                                                                                , θ2s      that satis-    h
                                                                                                         
fies (95) and (7). We will now choose a corresponding allocation k h , ψ1s
                                                                        h     h
                                                                           , ψ2s    h
                                                                                 , σ1s    h
                                                                                       , σ2s    h
                                                                                             , ν1s    h
                                                                                                   , ν2s  h
                h     h     h     h     h     h     h     h
that satisfies θ1s = ψ1s + σ1s + ν1s , θ2s = ψ2s + σ2s + ν2s , the collateral requirement conditions
(92), (93), (94), and the market-clearing conditions (96). Consider the following candidate
allocation:

                                           h     h           h
                                          ψ1s = θ1s + p(zs )θ2s ,                                                 (97)
                                           h     h     h
                                          ψ2s = ν1s = ν2s = 0,                                                    (98)
                                           h     h     h            h
                                          σ1s = θ1s − ψ1s = −p(zs )θ2s ,                                          (99)
                                           h     h
                                          σ2s = θ2s .                                                            (100)

                                  h     h     h
(98) implies that agents hold no ψ2s , ν1s , ν2s ; they will borrow or lend through directly
                                          h
collateralized contract paying in good 1 ψ1s only.

                                                                    61
   It is straightforward to show that resource constraints (96) hold. Since the resource con-
straints are satisfied and the collateral allocations k h are the same, the market fundamentals
are the same. We now would like to show that collateral requirement conditions (92), (93),
(94) also hold. First, we will show that (93) and (94) hold. There are two cases to consider;
     h             h                             h                                       h
(i) θ2s > 0, (ii) θ2s < 0. Case I: Suppose that θ2s > 0. Using (100), this implies that σ2s > 0,
                                   h
                                     
which in turn leads to min 0, σ2s      = 0. On the other hand, it is true that

                  h              h              h              h       h
                                                               
          max 0, ψ1s   + max 0, σ1s   = max 0, ψ1s   + max 0, σ1s   + ν1s ≥ 0,

                                                          h
                                                             
where the first equality follows from (98). Since min 0, σ2s   = 0, we have

         h              h              h              h       h                    h
                                                                                  
 max 0, ψ1s   + max 0, σ1s   = max 0, ψ1s   + max 0, σ1s   + ν1s ≥ −p(zs ) min 0, σ2s   ,

                                                          h           h
which is (94). On the other hand, (99) implies that σ1s     < 0 when θ2s > 0. As a result,
         h
               h
min 0, σ1s   = σ1s . Using (98), (99), (100), we then can show that

                            h                     h             h            h
                                                                              
             p(zs ) max 0, ψ2s   + p(zs ) max 0, σ2s   + p(zs )ν2s + min 0, σ1s
                                       h         h           h           h
                          = 0 + p(zs )σ2s + 0 + σ1s = p(zs )θ2s − p(zs )θ2s = 0,

where the second equality follows from (99) and (100). This shows that (93) holds.
                           h                                          h
                                                                             h            h
   Case II: Suppose that θ2s   < 0. (99) and (100) imply that max 0, σ1s   = σ1s = −p(zs )θ2s
             h
                   h     h
and min 0, σ2s   = σ2s = θ2s , respectively. We then can write

        h              h       h            h             h            h                    h
                                                                                            
max 0, ψ1s   + max 0, σ1s   + ν1s = max 0, ψ1s   − p(zs )θ2s ≥ −p(zs )θ2s = −p(zs ) min 0, σ2s   ,

which is exactly (94). Note that the first equality follows from (98), the second inequality
                                    h
                                                                                        h
                                                                                            
follows from the fact that max 0, ψ1s   ≥ 0. Similarly, using , we can show that max 0, σ2s   =
          h
            
min 0, σ1s    = 0. This implies that

                 h                     h             h            h
                                                                   
  p(zs ) max 0, ψ2s   + p(zs ) max 0, σ2s   + p(zs )ν2s + min 0, σ1s   = 0 + 0 + 0 + 0 = 0,

which is exactly (93).
   Similarly, we can now show that (92) also holds. There are two cases to be considered as
well.


                                                62
                          h           h                           h
   Case I: suppose that θ1s  + p(zs )θ2s  < 0. (97) implies that ψ1s < 0, which in turn implies
              h
                    h      h           h
that min 0, ψ1s   = ψ1s = θ1s + p(zs )θ2s . Using (98), we now can show that

   p(zs )Rs k h + min 0, ψ1s
                          h                     h
                                                     = p(zs )Rs k h + θ1s
                                                                       h           h
                                                  
                               + p(zs ) min 0, ψ2s                        + p(zs )θ2s + 0 ≥ 0,

where the last inequality follows (95). This implies that (92) holds.
                                                                        h           h
   Case II: we can use a similar argument to show that (92) holds when θ1s + p(zs )θ2s =
 h
ψ1s > 0. In summary, we have show that all collateral requirement conditions hold.


C.2     Ex-ante Contracting versus Ex-post Spot Trading

Thus far we implicitly shut down trade in the spot markets in each state. This section shows
that the spot markets are redundant when all types of contracts are available (see Lemma 3
below). In other words, agents do not need to trade in spot markets, though they may well
do so. Importantly, the spot markets are open and deliver the spot price p(zs ). In addition,
we also show that the asset-backed securities are not necessary when the spot markets are
open and active (see Lemma 4 below). Put differently, agents simply are indifferent between
trading in spot markets or ex-ante asset-backed securities.
                                                           h                       h
   When the spot markets are open, each agent h can trade τ1s units of good 1 for τ2s units
of good 2 at a spot price p(zs ) according to the spot-trade constraint:

                                       h           h
                                      τ1s + p(zs )τ2s = 0.                                       (101)

Recall that the spot price function, p(zs ), is the price such that the spot markets for both
goods clear:
                                         X
                                              αh τ1s
                                                  h
                                                     = 0,                                        (102)
                                          h
                                         X
                                              αh τ2s
                                                  h
                                                     = 0.                                        (103)
                                          h

Hence, an attainable allocation with the spot markets is defined by adding the spot-trade
constraint (101) and market-clearing constraints (102)-(103) to Definition 2.
   To be more precise, an allocation is said to be equivalent to an attainable allocation if
it is attainable and generates the same consumption allocation and market fundamental in
each state s as the original attainable allocation.

                                                 63
                                                             
Lemma 3. For any attainable allocation ch0 , k h , θ`s
                                                    h     h
                                                       , τ`s   h
                                                                 , there exists an equivalent allo-
                    0h    0h
                             
cation ch0 , k h , θ`s , τ`s  h
                                such that
                                                   0h
                                                  τ`s = 0, ∀s, h, `.                                     (104)
                                   
Proof. Let ch0 , k h , θ`s
                        h     h
                           , τ`s       h
                                           be an attainable allocation. We will show that we can find an
                                                 0h
equivalent allocation with no spot trade, i.e., τ`s = 0. Consider the following candidate
allocation (with 0 )

                                                c0h
                                                 0  = ch0 , ∀h,                                          (105)
                                                 0h    h     h
                                                θ1s = θ1s + τ1s , ∀s, h,                                 (106)
                                                 0h    h     h
                                                θ2s = θ2s + τ2s , ∀s, h.                                 (107)

Note that agents here acquire or issue securities on good 1 and good 2 in state s rather than
waiting for trade in spot markets. The rest of the proof is similar to the proof of Lemma 2,
and hence is omitted (it is available in our Working Paper version).

    Condition (104) in Lemma 3 implies that the spot markets in period 1 are redundant
when all securities are allowed; that is, anything that can be done through the spot markets
and one set of securities is feasible under another set of securities without spot markets.
Henceforth (and previously), the ex-post spot trade transfers will be (were) set to zero,
  h
(τ`s = 0 as in (104)) and the spot-trade constraints (101) will be (were) neglected, unless
stated otherwise.
                                                                                    
Lemma 4. For any attainable allocation ch0 , k h , ψ`s          h    h
                                                                  , σ`s    h
                                                                        , ν`s    h
                                                                              , τ`s  h
                                                                                       , there exists an equiva-
                             0h    0h    0h    0h
                                                  
lent allocation ch0 , k h , ψ`s , σ`s , ν`s , τ`s   h
                                                      such that
                                      0h         0h         0h    0h
                                   σ1s    = σ2s       = ν1s    = ν2s = 0, ∀s, h.                        (108)
                                                       
Proof. Suppose ch0 , k h , ψ`s h
                                 , σ`sh      h
                                         , ν`s      h
                                                , τ`s   h
                                                            is attainable. Consider the following alternative
allocation (with 0 ) ch0 , k h , ψ`s
                                   0h      0h     0h     0h
                                                            
                                      , σ`s   , ν`s  , τ`s   h
                                                               such that for all h and all s
                            0h    0h     0h     0h      h
                           σ1s = σ2s  = ν1s  = ν2s = ψ2s   = 0,                                          (109)
                            0h      h      h     h                h     h     h
                                                                                
                           ψ1s = ψ1s   + σ1s  + ν1s   + p(zs ) ψ2s   + σ2s + ν2s   ,                     (110)
                            0h               h     h      h       h
                                                             
                           τ1s = −p(zs ) ψ2s   + σ2s  + ν2s    + τ1s ,                                   (111)
                            0h      h      h     h        h
                                                    
                           τ2s = ψ2s   + σ2s  + ν2s   + τ2s .                                            (112)


                                                           64
Note that at the alternative allocation, agents will do in spot markets what they might have
done in asset-backed security markets. In addition, with active spot markets, there is no
need to trade in collateral-backed securities paying in good 2 (trade in the ones paying in
numeraire good only). The rest of the proof is similar to the proof of Lemma 3, and hence
is omitted.

     It is worthy of emphasis that Lemma 3 and Lemma 4 imply that the asset-backed secu-
rities that we need in this model are the ones that replicate spot markets. In other words,
the asset-backed securities in this model (with tranching) are simply substitutes for spot
markets. Henceforth, we let asset-backed securities play this role and shut down active trade
in spot markets. The result is summarized in the following corollary.

Corollary 1. Asset-backed securities and the spot markets are perfect substitute in this
model.


C.3      Spot Markets and Security Prices: No-Arbitrage Condition

The pyramiding mechanism puts a restriction on the prices of contracts traded within each
security exchange. The ratio of the equilibrium prices of the securities in security exchange
                 Q2s
zs in state s,   Q1s
                     ,   must be equal to the marginal rate of substitution or the spot price in the
security exchange, p(zs ). Otherwise, there will be an arbitrage possibility (by keeping the
collateral constraints satisfied with pyramiding). The result is summarized in the following
lemma.

Lemma 5. In a competitive equilibrium, for each s and zs ,

                                             Q2s = p(zs )Q1s .                                (113)

     Using the no-arbitrage condition (113), the collateral constraints (95) can be rewritten
as
                                   Q2s Rs k h + Q1s θ1s
                                                     h         h
                                                        + Q2s θ2s ≥ 0, ∀s.                    (114)

These constraints state that the value in units of good 1 at t = 0 of all ex ante securities
held (RHS) cannot exceed the value of collateral held (LHS). These constraints are applicable
when the spot markets are not available but the ex-ante asset-backed securities can be traded.

                                                     65
C.4     Derivation of a Competitive Equilibrium with the Externality
        in Environment 1

The endowment profile and the first-best allocation suggest that agent 2 would like to move
resources forward from t = 1 to t = 0, and therefore will be constrained. Hence, we will
assume that agents type 2 hold no collateral, i.e. k 1 = k and k 2 = 0. We now solve for an
                                                                             1      2
equilibrium k. From the market clearing conditions of contracts, we can set θ11 = −θ11 = θ̂
     1      2
and θ21 = −θ21 = θ. Note that this does not mean agent 1 is demanding both securities. In
addition, using the specified collateral allocation, the market fundamental in period t = 1
                4
is now z =      (the ratio of endowment of good 1 to the sum of endowment of good 2 and
               4+k
                                                                          4
                                                                             2
saving), and consequently the spot price of good 2 in period 1 is p(z) = 4+k    .
   With homothetic preferences, the first-order conditions of the problem (2) for both types
imply that in spot markets at date t = 0
                                                 2                  2                   2
                                          c110                c210
                                                                              
                                                                                     4
                               p0 =                   =                   =                    .   (115)
                                          c120                c220                  4−k

Since agent 1’s collateral constraint is not binding, the first-order conditions of her utility-
                                          1
maximization problem (2) with respect to θ21 and c110 lead to
                                                                                2
                                                   u1                    c110
                                                                     
                                           Q21    = 21  =                            ,             (116)
                                                   u110                  c121
               ∂uh
where uhit =   ∂cit
                      is the marginal utility with respect to cit , and Q21 is the price of a security
paying in good 2 in period t = 1. Note that we put superscript h on the utility function for
                                                                                            1
clarity. Further, the first-order conditions of the consumer’s problem (2) with respect to θ21
and k 1 (interior solutions) lead to

                                                      p0 = Q21 .                                   (117)

Intuitively, this is the case because their payoffs are identical and both are collateralizable.
Using (115) and (116), condition (117) implies that

                                          c110  c110
                                           1
                                               = 1 =⇒ c120 = c121 .                                (118)
                                          c20   c21

That is, an unconstrained agent consumes the same amount of good 2 in both periods.

                                                                66
   Substituting (115) and (116) into (117) gives
                        2       1 2
                     4             c10
                             =             ;
                   4−k             c121
                        4             c110
                             =               =⇒ (4 − k) c110 = 4 + 4k + 4θ,                       (119)
                      4−k        1+k+θ
where we use c121 = 1 + k + θ.
  On the other hand, an agent type 2’s collateral constraint is binding; with k 2 = 0,
                                                                   2
               2       2                                         4
             θ̂ + p(z)θ = 0 =⇒ −θ̂ − p(z)θ = 0 =⇒ θ̂ = −               θ,              (120)
                                                              4+k
                                                                                       4
                                                                                         2
where the second and the last equations use θ̂2 = −θ̂ and θ2 = −θ, and p(z) = 4+k           ,
respectively.
   The budget constraint of an agent 1 (3) can be written as

                            c110 − 3 + p0 c120 + k − 3 + Q11 θ̂ + Q21 θ = 0.
                                                     
                                                                                                  (121)

A standard no-arbitrage argument (similar to the one used in Lemma 5) implies that

                                              Q21 = p(z)Q11 .                                     (122)

It thus true from (122) that
                                                         h          i
                Q11 θ̂ + Q21 θ = Q11 θ̂ + Q11 p(z)θ = Q11 θ̂ + p(z)θ p(z) = 0,                    (123)

where the last equation follows the fact that the term in the bracket is zero, from (120).
Now the LHS of the budget constraint (121) can be rewritten as

                                        c110 + p0 c120 + k − 3 = 3.
                                                             
                                                                                                  (124)

                                              4−k
                                                                                 4
                                                                                     2
Using (115), we can replace c120 by            4
                                                        c110 . Then using p0 =   4−k
                                                                                          gives
                                     2                         
                                 4            4−k
                 c110   +                                c110   +k−3 = 3
                                4−k            4
                                                                            3k 2 − 40k + 96
                                                    =⇒ (4 − k) c110 =                       .     (125)
                                                                                  8−k
   Substituting (119)into (125) gives
                3k 2 − 40k + 96                            3k 2 − 36k + 64
                                = 4 + 4θ + 4k =⇒ 4θ + 4k =                 .                      (126)
                      8−k                                        8−k

                                                            67
   With the identical homothetic preferences, the period t = 1 consumption allocations
must satisfy

                            4   c111   4     1 + θ̂
                        z=     = 1 =⇒     =         .                                       (127)
                           4+k  c21   4+k   1+k+θ

Substitute (120) into (127) gives
                                                           
                                                     4+k
                                4θ + 4k = −3k                   + 4k.                       (128)
                                                     8+k

   Using (126) and (128), we have

           3k 2 − 36k + 64
                                      
                                   4+k
                           = −3k         + 4k =⇒ 4k 3 − 384k + 512 = 0.                     (129)
                 8−k               8+k

There are three roots for equation (129). Using the condition that 0 ≤ k ≤ 4, there is only
one feasible solution, i.e. k ≈ 1.3595. To sum up, the equilibrium collateral allocation is
k 1 = k = 1.3595 and k 2 = 0.


C.5     Derivation of a Competitive Equilibrium with the Externality
        in Environment 2

First of all, the symmetry of the environment implies that the equilibrium collateral alloca-
tion is also symmetric, i.e. k h = k for all h. As a result, the price of good 2 in period t = 0
is given by
                                                      2
                                                  2
                                      p0 =                  ,                               (130)
                                                 2−k

and the spot price of good 2 in each state s is given by
                                               2
                                            2
                                  ps =             , ∀s.                                    (131)
                                         2+k

Further, the price of a (collateralized) security paying in good 2 in state s is given by

                                               πs uh2s
                                                      
                                 Q2s = max               , ∀s.                            (132)
                                          h     uh10
                                                                              πs uh
The endowment structure implies that agents type 2 will have higher MRS        uh
                                                                                  2s
                                                                                       in state 1,
                                                                                 10
                                                              1     2             1       2
and vice versa. In addition, the structure also implies that θ21 = θ22 =θ   and θ11    = θ12 = θ̂.

                                                  68
Hence, (132) can be rewritten as
                                                  2                          2                                2
               πs u221                                                                                                   πs u122
                                                                                         
                         1            2                    1         2                 1            2
       Q21 =           =                               =                           =                                 =           = Q22 .
                u210     2       1 + k1 +    1
                                            θ21            2       1+k+θ               2       1 + k2 +    2
                                                                                                          θ22             u110
                                                                                                                                     (133)

That is, the symmetry structure implies that Q21 = Q22 . Using the optimal conditions with
respect to k h and θ2s
                    h
                       , we can show that
                                                                        2                       2
                                                                    2                    2
                             p0 = Q21 + Q22 =⇒                                =                         .                            (134)
                                                                   2−k                 1+k+θ

       Next, with the homotheticity of preferences, the ratio of consumption in each state of
each agent must be equal to the market fundamental; that is,

                                                    1 + θ̂    2
                                                           =     .                                                                   (135)
                                                   1+k+θ     2+k

       Furthermore, the collateral constraint in state s = 1 of an agent type h = 1 is binding,
i.e.
                                                                                      2
                                                                               2
                                 p1 k − θ̂ − p1 θ = 0 =⇒ θ̂ =                               (k − θ) .                                (136)
                                                                              2+k

Note that the same equation can be derived from the binding collateral constraint in state
s = 2 for an agent type h = 2.
      We can compute a collateral equilibrium using (134), (135), and (136) to solve for
           
    k, θ, θ̂ . We can rewrite (134) as

                                       2 − k = 1 + k + θ =⇒ θ = 1 − 2k.                                                              (137)

In addition, Substituting (136) into (135) gives
                                2                 
                             2                    2
                     1+             (k − θ) =          (1 + k + θ) .                                                                 (138)
                           2+k                   2+k

Then, substituting (137) into (138) will give
                          2                          
                       2                             2
               1+             (k − 1 + 2k) =              (1 + k + 1 − 2k)
                     2+k                          2+k
                                             =⇒ 3k 2 + 16k − 8 = 0.                                                                  (139)

The unique feasible (positive) solution to the above quadratic equation is k ≈ 0.4603.

                                                                    69
C.6     Derivation of a Competitive Equilibrium with the Externality
        in Environment 3

We restrict our attention to a symmetric allocation of each type. Using Lemma , we assume
that all constrained agents hold no collateral, i.e., k h = 0 for h = 2, 3. Let k 1 = k.
   First, the first-order conditions of the consumer’s problem (2) result in
                                c110   c210   c310     12.5
                                  1
                                     =   2
                                            =  3
                                                   =          .                            (140)
                                c20    c20    c20    12.5 − k
From the endowment profile, it is clear that an agent 1 will not be constrained. The first-
                                                                1
order conditions of the consumer’s problem (2) with respect to θ21 and c110 lead to
                                         u121
                                              = Q21 .                                      (141)
                                         u110
                                                                                   1
Further, the first-order conditions of the consumer’s problem (2) with respect to θ21 and k 1
(interior solutions) lead to

                                            p0 = Q21 .                                     (142)

Combining (141), (142) and the utility function (26), gives
                                      2                     1 2
                                                      u121
                          
                              12.5                           c10
                     p0 =                 = Q21 = 1 =              .                       (143)
                            12.5 − k                  u10    c121
This implies that
          12.5     c1          c110
                 = 10                                   1                     1
                                                                                
                        =               =⇒ (12.5 − k) c 10 = 12.5 0.5 + k + θ21   ,        (144)
        12.5 − k   c121              1
                          0.5 + k + θ21
where we use c121 = 0.5 + k + θ21
                               1
                                  .
                                                                    12.5
   In addition, the market fundamental in period t = 1 is z = 12.5+k     , and consequently the
                                         12.5
                                               2
spot price of good 2 in period t = 1 is 12.5+k    . The bindingness of the collateral constraints
of agent 2 and agent 3, combining with the market-clearing conditions of securities, imply
that
                                                          2
                                  1               12.5           1
                                 θ11   =−                       θ21 .                      (145)
                                                12.5 + k
   A standard no-arbitrage argument (similar to the one used in Lemma 5) implies that

                                       Q21 = p(z)Q11 ,                                     (146)

                                                   70
which can be used to show that

              1         1         1             1
                                                         1         1
                                                                       
         Q11 θ11 + Q21 θ21 = Q11 θ11 + Q11 p(z)θ21 = Q11 θ11 + p(z)θ21   p(z) = 0,              (147)

where the last equation follows the bindingness of the collateral constraints of agent 2 and
agent 3, combining with the market-clearing conditions of securities. The budget constraint
of an agent 1 (3) can be written as

                              c110 − e110 + p0 c120 + k − e120 = 0.
                                                             
                                                                                                (148)

Substituting (140) and (143) into (148), we have

                                           12.52 (e120 − k) + e110 (12.5 − k)2
                     (12.5 − k) c110 =                                         .                (149)
                                                         25 − k
Substituting (144) into (149), we have

                                  1
                                              12.52 (e120 − k) + e110 (12.5 − k)2
                  12.5 0.5 + k + θ21       =                                       .            (150)
                                                             25 − k
   With the identical homothetic preferences, the period t = 1 consumption allocations
must satisfy
                           12.5    c1        12.5              1
                                                        0.5 + θ11
                    z=            = 11  =⇒          =               ,                           (151)
                         12.5 + k  c121    12.5 + k               1
                                                      0.5 + k + θ21
where the equality follows (145). This can be rewritten as
                                                                           2     !
                               1
                                                                  12.5           1
               12.5 0.5 + k + θ21 = (12.5 + k) 0.5 −                             θ21 .          (152)
                                                                 12.5 + k
                                      1
   Solving (150) and (152) for k and θ21 , with e110 = 4.2631 and e120 = 11.5, gives one feasible
                                     1
solution (0 ≤ k ≤ 12.5) k = 7.2836, θ21 = −4.2849. To sum up, the competitive collateral
equilibrium allocation is k 1 = k = 7.2836, and k 2 = k 3 = 0.


C.7     Source of Inefficiency in the Incomplete Markets Example

Proposition 3. The competitive equilibrium with exogenous security markets is (constrained)
                                                                      
efficient if and only if the equilibrium allocation ch , θh , τ h , yh is first-best optimal or the
                                                          ∂ps
spot price is independent of security positions, i.e.,    ∂θjh
                                                                 = 0 for every state s, every security
j and every agent of type h.

                                                 71
Proof. We begin the proof by deriving the necessary and sufficient conditions for the first-
best optimality. The social planner’s problem for the first-best optimality is as follows:

Program 3.
                                                      X
                  max u1 e110 + θ10
                                 1
                                    , e120 + θ20
                                              1
                                                        πs u1 e11s + θ1s
                                                                      1
                                                                         , e12s + θ2s
                                                                                   1
                                                                                     
                                                   +β                                                                   (153)
              (θi0  is )i,s,h
                h ,θ h
                                                      s

subject to the participation constraints and the resource constraints, respectively,
                                 X                                    h
            h
 uh eh10 + θ10           h
               , eh20 + θ20                      h
                                   πs uh eh1s + θ1s           h
                                                    , eh2s + θ2s   ≥ U , for h = 2, ..., H,
                                                                
                              +β
                                              s
                                                                         X
                                                                              αh θis
                                                                                  h
                                                                                     = 0, for i = 1, 2; s = 0, 1, ..., S
                                                                         h
Lemma 6. The necessary and sufficient conditions for the first-best optimality are as follows:
                     γuh uhi0   γuh̃ uh̃i0
                              =            , ∀h, h̃ = 1, ..., H; i = 1, 2                     (154)
                       αh         αh̃
                γuh βπs uhis    γuh̃ βπs uh̃is
                              =                , ∀h, h̃ = 1, ..., H; i = 1, 2, s = 1, ..., S, (155)
                     αh               αh̃
where γuh is the Lagrange multipliers for the participation constraints for h (normalize by
                                       ∂uh
setting γu1 = 1) and uhis =            ∂ch
                                              is the marginal utility of an agent of type h with respect to cis .
                                         is


   We now consider the following social planner’s problem for the economy with exogenous
security markets.

Program 4.
                                                                X
                                u1 e110 + θ10
                                           1
                                              , e120 + θ20
                                                        1
                                                                  πs u1 e11s + θs1 + τ1s
                                                                                      1
                                                                                         , e12s + τ2s
                                                                                                   1
                                                                                                     
              max                                            +β                                                         (156)
      (θ10  20 j 1s 2s )h
        h ,θ h ,θ h ,τ h ,τ h
                                                                         s

subject to the participation constraints, the resource constraints, and the obstacle-to-trade
constraints, respectively,
                                                                                                      !
                                              X                      X                                        h
   uh eh10 + θ10
              h
                 , eh20 + θ20
                           h
                                                      πs uh eh1s +       Djs θjh + τ1s
                                                                                    h
                                                                                       , eh2s + τ2s
                                                                                                 h
                                                                                                          ≥ U , ∀h,
                                   
                              +β                                                                                        (157)
                                                  s                  j
                                                                                             X
                                                                                                  αh θi0
                                                                                                      h
                                                                                                         = 0, ∀i,       (158)
                                                                                              h
                                                                                             X
                                                                                                  αh θjh = 0, ∀j,       (159)
                                                                                              h
                                                                                            X
                                                                                                  αh τ1s
                                                                                                      h
                                                                                                         = 0, ∀s,       (160)
                                                                                              h
                                                                              h
                                                                                 + p̃s θs1 , ..., θsH τ2s
                                                                                                      h
                                                                             τ1s                          = 0, ∀s, h.   (161)


                                                                72
                                                          h
Note that the resource (market-clearing) constraints for τ2s are omitted due to Walras law.
A solution to this social planner’s problem is called a constrained optimal allocation.
                                   h     h     h     h
   The first order conditions for θ10 , θ20 , τ1s , τ2s , θjh are as follows:

                                              γuh βπs uh10 + αh µθ10 = 0,                            (162)

                                              γuh βπs uh20 + αh µθ20 = 0,                            (163)

                                        γuh βπs uh1s + αh µτ1s + γsh = 0, ∀s = 1, ..., S,            (164)

                                             γuh βπs uh2s + p̃s γsh = 0, ∀s = 1, ..., S,             (165)
                    X                        X ∂ p̃s X
              γuh β   πs uh1s Djs + αh µθj +         h
                                                           γsh̃ τ2s
                                                                 h̃
                                                                    = 0, ∀j = 1, ..., J,             (166)
                    s                        s
                                                  ∂θ j
                                                          h̃


where γsh , γsh , µτs , µθj are the Lagrange multipliers for the obstacle to trade or spot-market
constraints in state s, for the participation constraints for h (normalize by setting γu1 = 1), for
                              h                                                                        ∂uh
the resource constraints for τ1s , and for the resource constraints for θjh . Note that uhis =         ∂ch
                                                                                                            .
                                                                                                         is

   The proof is divided into two parts as follows:

  (i) (⇐) We now show that an allocation that satisfies the necessary and sufficient condi-
      tions for the first-best optimality (154)-(155) must satisfies the first order conditions
      (162)-(166). It is not difficult to see that this will be the case if the externality term,
      the last term of (166), is vanished, i.e.,
                                          X ∂ p̃s X
                                                h
                                                    γsh̃ τ2s
                                                          h̃
                                                             =0                                      (167)
                                          s
                                            ∂θj
                                                     h̃

                                                                                            ∂ p̃s
      It is obvious that if the spot price is independent of security positions, i.e.,      ∂θjh
                                                                                                    = 0 for
      every state s, every security j and every agent of type h, then condition (167) holds.

      We now need to show that if the constrained optimal allocation is first-best optimal,
      then the no-externality condition (167) must hold. Since the allocation is first- best
                                                                              h̃ 
      optimal, it must satisfies conditions (154) and (155), which imply that αγsh̃ must be
      constant across agents, i..e, for each s

                                          γsh   γsh̃
                                              =      = Γs , ∀h, h̃.                                  (168)
                                          αh    αh̃



                                                    73
    Using these conditions, we can then show that
                                                    !
            X ∂ p̃s X             X ∂ p̃s X γ h̃
                                                 s
                  h
                             h̃
                       γsh̃ τ2s =       h
                                                        αh̃ τ2s
                                                             h̃
                                                                                                (169)
            s
              ∂θj                 s
                                    ∂θj        α h̃
                    h̃                    h̃
                                  X ∂ p̃s X                  X ∂ p̃s X
                                                  h̃ h̃
                                =       h
                                             Γs α   τ 2s =             Γ
                                                                     h s
                                                                         αh̃ τ2s
                                                                              h̃
                                                                                 = 0,           (170)
                                  s
                                    ∂θ  j                       s
                                                                  ∂θ j
                                                  h̃                            h̃

                                                                       h
    where the last equation results from the resource constraints for τ2s . This proves
    that the no-externality condition (167) holds. To sum up, we prove that there is no
    externality if the constrained optimal allocation is first-best optimal or the spot price
                                                   ∂ p̃s
    is independent of security positions, i.e.,    ∂θjh
                                                           = 0 for every state s, every security j and
    every agent of type h.

(ii) (⇒) Unfortunately, we cannot generally prove the reversed statement but, as shown
    in Geanakoplos and Polemarchakis (1986), it is true generically (it is true except for
    some unlikely cases). The key idea is that the indirect price effects could be canceling
    each other out only if the equilibrium allocation is first-best optimal in most cases.
    But this does not happen generally.




                                             74
