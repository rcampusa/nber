                              NBER WORKING PAPER SERIES




            CORRECTIVE REGULATION WITH IMPERFECT INSTRUMENTS

                                        Eduardo Dávila
                                        Ansgar Walther

                                      Working Paper 29160
                              http://www.nber.org/papers/w29160


                    NATIONAL BUREAU OF ECONOMIC RESEARCH
                             1050 Massachusetts Avenue
                               Cambridge, MA 02138
                                   August 2021




We would like to thank Franklin Allen, Javier Bianchi, Dean Corbae, Peter Diamond, Emmanuel
Farhi, Borys Grochulski, Kinda Hachem, Raj Iyer, Anton Korinek, Arvind Krishnamurthy, Guido
Lorenzoni, Gregor Matvos, Jose-Luis Peydro, Dimitrios Tsomocos, Aleh Tsyvinski, and Wei
Xiong for useful discussions and conversations, and the audiences at various conferences and
seminars for their comments. Eduardo D vila gratefully acknowledges financial support from the
European Central Bank's Lamfalussy Fellowship. Alex Kane, Jack Kelly, Flint O'Neil, and Ran
Wang provided excellent research assistance. The views expressed herein are those of the authors
and do not necessarily reflect the views of the National Bureau of Economic Research.

NBER working papers are circulated for discussion and comment purposes. They have not been
peer-reviewed or been subject to the review by the NBER Board of Directors that accompanies
official NBER publications.

© 2021 by Eduardo Dávila and Ansgar Walther. All rights reserved. Short sections of text, not to
exceed two paragraphs, may be quoted without explicit permission provided that full credit,
including © notice, is given to the source.
Corrective Regulation with Imperfect Instruments
Eduardo Dávila and Ansgar Walther
NBER Working Paper No. 29160
August 2021
JEL No. D62,G18,G28,H21

                                          ABSTRACT

This paper studies the optimal design of second-best corrective regulation, when some agents or
activities cannot be perfectly regulated. We show that policy elasticities and Pigouvian wedges
are sufficient statistics to characterize the marginal welfare impact of regulatory policies in a
large class of environments. We show that the optimal second-best policy is determined by a
subset of policy elasticities: leakage elasticities, and characterize the marginal value of relaxing
regulatory constraints. We apply our results to scenarios with unregulated agents/activities and
with uniform regulation across agents/activities. We illustrate our results in applications to
shadow banking, scale-invariant regulation, asset substitution, and fire sales.


Eduardo Dávila
Yale University
Department of Economics
28 Hillhouse Avenue, Room 304
New Haven, CT 06520-8268
and NBER
eduardo.davila@yale.edu

Ansgar Walther
Imperial College Business School Tanaka Building
South Kensington Campus
London SW7 2AZ, UK
ansgar.walther@gmail.com
1       Introduction
In the aftermath of the 2007­2009 financial crisis, most economies have expanded the set and
scope of regulations faced by the financial sector. This expansion has been guided by theories of
corrective policy in the presence of a diverse set of market failures, including fire-sale externalities
and distortive government subsidies (e.g., Lorenzoni, 2008; Farhi and Tirole, 2012; Bianchi, 2016;
Farhi and Werning, 2016; Dávila and Korinek, 2018). However, the instruments available to
regulators remain imperfect along various dimensions. First, some imperfectly regulated institutions
-- such as money market funds and asset managers -- are still outside of the regulatory framework
that applies to traditional banks. Second, regulators are frequently forced to impose uniform
regulations on heterogeneous institutions and activities. For example, capital regulation is the same
across different institutions and often imposes the same risk weights on different investments within
coarse buckets. Finally, even within the regulated sector, there are imperfectly regulated activities.
Leverage and liquidity charges, for instance, are often based on ratios of assets to liabilities, leaving
the scale of each institution's activities as a free, unregulated decision.
    These imperfections are often viewed as having "unintended consequences" for regulation. For
instance, the presence of unregulated institutions may have caused leakage of activity to the
unregulated financial sector in the US and China in recent years (e.g., Adrian and Ashcraft,
2016; Hachem, 2018). Relatedly, the uniformity of regulation has led to concerns about asset
substitution, whereby institutions tilt their portfolios towards the riskier end of each regulatory
bucket. In this context, the natural normative question is how regulators should proceed once they
are aware of these consequences. This second-best policy problem appears daunting because, as we
have outlined, there are many possible market failures to consider and many seemingly disparate
imperfections in policy instruments.
    This paper characterizes, for a broad class of economies, how the presence of imperfect
regulatory instruments affects the design of corrective regulation. Our goal is to identify a set
of unifying economic principles for regulation in an imperfect world. Therefore, our results build
on and complement the existing theoretical literature, which focuses on the properties of particular
types of market failures and regulatory imperfections.
    We initially consider a general model in which multiple investors have access to a rich set
of investment and financing opportunities, which may induce externalities.1 A regulator can, in
principle, impose corrective Pigouvian taxes/subsidies on each investment and financing decision to
address these externalities. However, the regulator has to choose such regulations from a constrained
set. Our main characterization imposes little structure on the nature of regulatory constraints. We
show four results in this general framework before considering its various applications.
    First, we characterize the marginal welfare impact of varying any given regulatory instrument.
We show that the marginal welfare effects of varying corrective regulations are determined by two
sets of statistics: i) policy elasticities and ii) Pigouvian wedges. Policy elasticities correspond to
    1
   This model includes a general specification for possible externalities. In Section 4, we map this environment to
commonly studied market failures in a sequence of applications.



                                                        2
the equilibrium responses of financing and investment decisions, both across and within investors.
Pigouvian wedges correspond to the difference between the existing corrective regulation that
directly affects a given activity and the actual marginal distortion (externality) generated by that
activity. These wedges, which can take positive or negative values, capture the extent to which
different activities are regulated too strictly or too leniently for any given set of corrective policies.
This characterization and the results that follow from it revisit and extend the classical analysis of
general second-best policy in Lipsey and Lancaster (1956).2
    Second, as a benchmark, we characterize the optimal first-best policy, and note that the
Pigouvian principle applies when the regulator has access to an unconstrained set of regulations.
In that case, the optimal regulation is chosen so that all Pigouvian wedges are exactly equal to
zero, with Pigouvian regulations set to equal marginal distortions. An important insight is that
policy elasticities do not form part of the first-best policy. In other words, policy elasticities are
only inherently important for corrective regulation in second-best scenarios, in which the set of
regulatory instruments is imperfect.
    Third, we characterize optimal second-best policy. The second-best regulation of a given
investor's decision is equal to the sum of i) the associated marginal distortion, guided by the first-
best Pigouvian principle, and ii) a second-best correction. We show that two sets of sufficient
statistics determine the sign of this correction and, therefore, whether an activity should be
overregulated relative to the Pigouvian principle (super-Pigouvian regulation) or underregulated
(sub-Pigouvian regulation). The first set of statistics contains the Pigouvian wedges associated
with all imperfectly regulated decisions (i.e., all decisions associated with a binding regulatory
constraint). The second is a subset of policy elasticities, which we refer to as leakage elasticities,
and which measure the responses of imperfectly regulated decisions to the changes in the regulation
of perfectly regulated decisions. Intuitively, under the second-best policy, regulators want to
discourage imperfectly regulated activities that are underregulated (with a negative Pigouvian
wedge), and encourage those that are overregulated (with a positive wedge). The leakage elasticities
measure how these activities respond to the regulator's unconstrained policy choices. In particular,
we demonstrate that the nature of the second-best correction depends crucially on whether perfectly
and imperfectly regulated decisions are gross substitutes or gross complements. In our applications
in Section 4, we discuss natural examples of both cases.
    Fourth, the last of our general results characterizes the welfare effect of relaxing regulatory
constraints. This is a relevant quantity in light of recent policy proposals that aim to extend the
scope of institution- or activity-level financial regulation (e.g., Gorton, Metrick, Shleifer and Tarullo,
2010; Adrian and Ashcraft, 2016). We decompose this welfare effect into two terms. The first is
the direct effect, which is determined by the policy elasticities of imperfectly regulated decisions
and the associated Pigouvian wedges. For example, it is most valuable to relax constraints if
   2
    It is worth highlighting that our results apply beyond the sphere of financial regulation. Indeed, we provide a
formal counterpart of our results using classical consumer theory in Section D of the Online Appendix. However,
we have decided to focus this paper on a macro-finance environment because regulatory constraints are particularly
pervasive in this setting, since financial activity is inherently hard to regulate.




                                                        3
doing so discourages activities that are severely underregulated, with large negative wedges. The
second effect features an adjustment for the responses of both perfectly and imperfectly regulated
activities in general equilibrium. Interestingly, this effect dampens the welfare benefit of relaxing
constraints, regardless of whether decisions are substitutes or complements. The logic behind this
result is reminiscent of the Le Chatelier principle (e.g., Milgrom and Roberts, 1996), which states
that the qualitative differences between short- and long-run adjustments of a system are invariant
to whether choices are substitutes or complements.
    Next, we specialize these results to characterize two classes of imperfections in detail, given
their practical relevance. First, we consider the case in which some investors or activities are
entirely unregulated. In this case, the optimal second-best regulation is given by a weighted sum
of distortions in both the regulated and unregulated segments, with the sign and magnitude of
the appropriate weights determined by the leakage elasticities. This part of our analysis bears an
interesting relationship to the well-known Tinbergen (1952) rule, and refines this rule by deriving the
optimal policy when the number of policy instruments is less than the number of targets. Second, we
consider the case of uniform regulation, where the same regulations must apply to different investors
or activities, even if they impose externalities of different magnitudes. We derive the optimal second-
best uniform regulation in a general environment, in which other (non-uniform) regulations may
remain freely adjustable. The optimal uniform regulation, which generalizes insights from Diamond
(1973), takes the form of a weighted average of distortions, once these are modified in proportion
to the Le Chatelier adjustment discussed above, which accounts for the equilibrium responses of
perfectly and imperfectly regulated decisions to each other.
    Finally, to demonstrate the usefulness of these general principles, we consider four applications.
These applications show how our results can be employed in common regulatory scenarios, each with
different kinds of regulatory instruments and constraints. The applications further illustrate how
our results apply to different rationales for regulation, including bailouts, pecuniary externalities,
and behavioral models with internalities. The economic insights from our applications can be
summarized as follows:

  1. Shadow Banking/Unregulated Investors: We study a model with two types of leveraged
     investors, which are interpreted as regulated banks and unregulated (shadow) banks.
     Regulation is imperfect in the sense that shadow banks cannot be subject to any corrective
     regulation. We derive optimal second-best leverage regulation in a setting where the
     government provides ex-post bailouts without commitment. We find that the optimal policy
     in the regulated segment is commonly sub-Pigouvian. Concretely, the optimal policy imposes
     regulations below marginal distortions whenever i) shadow banks' leverage imposes negative
     externalities, and ii) leverage choices between regulated and unregulated investors are gross
     substitutes. Existing direct measurements of leakage elasticities (e.g., Irani, Iyer, Meisenzahl
     and Peydro, 2021) suggest that the substitutes case is the empirically relevant one. Our results
     further clarify how optimal second-best policy responds to potential changes in marginal
     distortions that arise from unregulated activities in general equilibrium.


                                                  4
  2. Scale-Invariant Regulation /Unregulated Activities : We derive optimal policy under the
     assumption that the planner can regulate investors' leverage, i.e., the ratio of borrowing
     to risky investment, but not the overall scale of investment. In this situation, regulated and
     unregulated activities (e.g., leverage and the scale of risky investment) are commonly gross
     complements. We consider a model in which financial regulation is motivated by a type of
     internality, namely, distortions in investors' and creditors' beliefs about investment returns
     (Dávila and Walther, 2020b). Here, we show that the optimal policy is super-Pigouvian, and
     features corrective regulation that raises private marginal costs above social marginal costs.

  3. Asset Substitution/Uniform Activity Regulation: We consider an environment where investors
     choose between two types of risky investment, but where regulation is imperfect in that the
     regulator imposes a uniform regulation across both types of investments, for example, by
     imposing the same risk weights on different investments. Regulation in this application
     is motivated by the fact that investors, which we once again interpret as large regulated
     institutions, are too-big-to-fail and enjoy an implicit government subsidy. This case leads to
     a classical asset substitution problem (e.g., Jensen and Meckling, 1976). The optimal second-
     best regulation is a weighted average of the downside distortions imposed by different types
     of investment, with weights proportional to the policy elasticities of investment. Our general
     formula also leads us to a deeper characterization of the optimal weights, which reveals that
     they are closely related to the elasticity of the probability of receiving a bailout.

  4. Fire-Sale Externalities with Heterogeneous Investors/Uniform Investor Regulation: Finally,
     we consider an environment along the lines of Lorenzoni (2008) in which the investment
     decisions of investors/entrepreneurs are associated with distributive pecuniary/fire-sale
     externalities. While most of the related literature focuses on characterizing constrained-
     efficient allocations, often assuming that a planner has access to investor-specific regulations,
     we assume that all investors must face the same regulation. Consistent with our general
     results, we show that the optimal second-best regulation is a weighted average of the
     induced distortions (pecuniary externalities), which in this case are given by differences
     in marginal valuations, net trade positions, and price sensitivities. This application is of
     independent interest, since it shows that even when a planner does not have access to investor-
     specific regulations, it may still be desirable to set corrective regulation to address pecuniary
     externalities.

In each of these applications, we provide numerical illustrations of the optimal second-best policy,
and how it compares to the first-best policy. When possible, we discuss how the existing empirical
findings can be used to guide the optimal policy.

Related Literature Our paper is directly related to the literature on imperfect financial
regulation. The issue of regulatory arbitrage and shadow banking has been widely studied in recent
years. Within the theoretical literature, Plantin (2015), Farhi and Tirole (2017), Huang (2018), and


                                                 5
Martinez-Miera and Repullo (2019) study the impact of capital requirements on banking activity
and financial stability. Hachem and Song (2017) explore how increased liquidity requirements
can generate credit booms when banks are heterogeneous. Grochulski and Zhang (2019) show, in
an environment in which regulation is motivated by a pecuniary externality as in Farhi, Golosov
and Tsyvinski (2009), how regulation is constrained by the presence of shadow banks. Gennaioli,
Shleifer and Vishny (2013) and Moreira and Savov (2017) develop theories that highlight the fragile
nature of shadow banking arrangements. Ordoñez (2018) shows how shadow banking enables
better-informed banks to avoid blunt regulations. Bengui and Bianchi (2018), building on Bianchi
(2011), provide a theoretical and quantitative analysis of macroprudential policy with imperfect
instruments based on a collateral pecuniary externality. Dávila and Korinek (2018) briefly discuss
the impact of specific regulatory constraints on policy in a setup with pecuniary externalities,
while Korinek (2017) provides a systematic study of optimal corrective policy in environments
with multiple regulators. Clayton and Schaab (2021) study regulatory policy in the presence of
shadow banks when there are pecuniary externalities. Begenau and Landvoigt (2021) provide a
quantitative general equilibrium assessment of regulating commercial banks for financial stability
and macroeconomic outcomes in the presence of ex-post subsidies -- see also Dempsey (2020) for
a related quantitative assessment. Xiao (2020) characterizes the transmission of monetary policy
in an environment with shadow banks. One can view monetary policy as an example of uniform
corrective regulation with potentially heterogeneous responses. There is also a growing empirical
literature on regulatory arbitrage and shadow banking, which includes the work of Acharya, Schnabl
and Suarez (2013), Demyanyk and Loutskina (2016), and Buchak, Matvos, Piskorski and Seru
(2018a,b), among others.
    Methodologically, our approach develops a sufficient statistic approach to account for imperfect
regulation. Related work in the context of credit markets, banking, and financial intermediation
includes Matvos (2013), who uses sufficient statistics to estimate the benefits of contractual
completeness; Dávila (2020), who studies the optimal determination of bankruptcy exemptions;
Sraer and Thesmar (2018), who show how to produce aggregate estimates from individual firm's
experiments; Dávila and Goldstein (2018), who explore the determination of deposit insurance; and
Van den Heuvel (2018), who studies the welfare effects of bank liquidity and capital requirements.
    At a broader level, our results are connected to the public economics literature that deals with
imperfect corrective regulation. Along this dimension, we contribute by showing that several classic
results can be obtained and expanded using a common set of equations. For instance, the imperfect
corrective taxes derived in Diamond (1973) are seemingly distinct from the characterization of
second-best policy in Lipsey and Lancaster (1956), but both can be derived as special cases from
Proposition 1 in this paper. Other contributions in this literature, often focused on whether indirect
regulation is effective or even more desirable than direct regulation, include Baumol (1972), Sandmo
(1975), Green and Sheshinski (1976), Balcer (1980), Wijkander (1985), and Cremer, Gahvari and
Ladoux (1998) -- see also the textbook treatment of Salanié (2011) and the lecture notes of Werning
(2012).
    Our results are also related to Hendren (2016), from whom we adopt the terminology "policy


                                                  6
elasticity". We identify the special role that a subset of policy elasticities, leakage elasticities, play
when studying second-best regulation. Finally, second-best corrective regulation is often discussed
in the context of environmental policy and congestion -- see Bovenberg and Goulder (2002) for a
comprehensive review of that literature -- as well as rent-seeking. Rothschild and Scheuer (2014,
2016) study optimal taxation with both corrective and redistributive motives in environments with
rent-seeking, highlighting the importance of general equilibrium effects.

Outline The structure of the paper is as follows. Section 2 introduces our general framework and
characterizes its equilibrium. Section 3 characterizes the general marginal effects that determine
the optimal regulation and presents their implications for optimal regulation. Section 4 provides
concrete illustrations of the general results in a set of tractable applications. Section 5 concludes.
All proofs and derivations are in the Appendix.


2       General Framework
This section lays out our general framework, which is general enough to capture a wide range of
scenarios, but sufficiently tractable to yield precise insights and highlight the channels at work.
We consider an environment in which a group of agents (investors) make multiple financing and
investment decisions that can be subject to a potentially rich set of regulations.
    In this section, we assume that the decisions made by an investor directly induce externalities on
others, providing a rationale for corrective regulation. In Section 4, we provide concrete illustrations
of our results in a set of tractable applications. These applications illustrate how our general
formulation encompasses widely studied rationales for regulation, including bailouts, pecuniary
externalities, and internalities.

2.1     Environment
There are two dates t  {0, 1} and a single consumption good (dollar), which serves as numeraire.
At date 1, there is a continuum of possible states of nature s  [s, s]. The state s is a random
variable with cumulative distribution function F (s).
    There are two sets of agents: investors and creditors. There is a finite number of investor
types (investors, for short), with each type in unit measure and indexed by i, j,  I , where
I = {1, 2, . . . , |I|}.3 There is a unit measure of representative/identical creditors, indexed by C .
Finally, there is also a social planner/regulator/government, who sets regulatory policy.
    At date 0, investors have access to a set of financing opportunities, given by B = {1, 2, . . . , |B|},
and a set of investment opportunities, given by K = {1, 2, . . . , |K|}. We denote the financing and
                                               |B|             |K|
investment choices of investor i by bi  R+ and ki  R+ , respectively. We often collect the
    3
     The notion of investor used in this paper is meant to be understood broadly. We could have referred to investors
as financial intermediaries, experts, or entrepreneurs.




                                                         7
financing and investment choices/decisions/activities of an investor i in a balance-sheet vector

                                           xi = bi , ki .

When needed, we denote the set of balance-sheet opportunities by X = B  K, so |X | = |B| + |K|
            |X |
and xi  R+ .
    At date 1, once s is realized, investors receive the return on their investments and pay back
(fully or partially) their financial obligations. Creditors provide financing to investors at date 0
and receive (full or partial) repayments from investors at date 1. We define these repayments in
detail below.

Investors.   Investor i's preferences are of the form:

                                  ui ci    i
                                      0 , c1 (s)        , xj         ,                             (1)
                                                   sS          j I


where ui (·) is a function of ci      i
                               0 and c1 (s), which denote the consumption of investor i at date 0 and
at date 1 in state s, respectively, as well as xj , which denotes the balance-sheet choices of type j
investors as a whole. In equilibrium, as explained below, it will be the case that xj = xj , j  I .
Importantly, by virtue of being infinitesimal, an individual type i investor does not account for the
impact on xi when choosing xi .
    Investor i faces the following budget constraints:

                              ci   i    i i  i i  i   i   i
                               0  n0 + Q x -  x -  · x + T0                                        (2)

                           ci       i          i
                            1 (s)  n1 (s) + i x , s ,     s,                                       (3)

where we use · to denote the inner product between two vectors. At date 0, investor i is initially
endowed with ni                                                                          i  i
                 0 dollars. We denote the amount of financing raised by investor i by Q x , whose
determination in equilibrium is described below. Investor i makes balance-sheet (financing and
                                                          |X |
investment) decisions via the vector xi = bi , ki  R+ . Moreover, the balance-sheet decisions
made by investor i are associated with a cost i xi  0. This term can capture technological
adjustment costs associated with investing or other costs associated with making financing choices.
    Importantly, in principle, each investor faces investor-specific taxes/subsidies on balance-sheet
decisions, via the vector  i  R|X | , i. Regulating bi can be interpreted as setting liability-side
regulation, while regulating ki can be interpreted as setting asset-side regulation. In Section 3,
our main results consider alternative regulatory scenarios by imposing constraints on  i . Finally,
investor i receives a lump-sum transfer T0 i  0 at date 0, as described below.

    At date 1, investor i is endowed with ni  1 (s) dollars when state s is realized. We denote the
final return on the investments of investor i in state s, net of any financial obligations contained
in the balance-sheet xi , by i xi , s . As shown in the Appendix, this general formulation of i (·)
can accommodate the possibility of default by investors, as we also illustrate in our applications.


                                                   8
Creditors. Creditors' preferences are of the form:

                                        uC cC    C
                                            0 , c1 (s)                 , xj           ,                              (4)
                                                                  sS            j I

where uC (·) is a function of cC         C
                                0 and c1 (s), which denote the consumption of creditors at date 0
and at date 1 in state s, respectively, as well as xj , which denotes the balance-sheet choices of type
j investors as a whole.
    Creditors face the following budget constraints:

                                       cC   C
                                        0  n0 -              hC  i
                                                              i Q x
                                                                   i
                                                                                                                     (5)
                                                        iI

                                   cC       C
                                    1 (s)  n1 (s) +                hC C
                                                                    i i xi , s ,          s.                         (6)
                                                             iI


At date 0, creditors are initially endowed with nC                                          C
                                                    0 dollars. They choose to fund a share hi of each
investor i's financing needs Qi (·), although, in equilibrium, hC
                                                                i = 1, as we explain below. At date 1,
when state s is realized, creditors are endowed with n1 (s) dollars and receive repayments C
                                                         C                                        i
                                                                                             i x ,s
from investor i. As we show in the Appendix and illustrate through our applications, this general
formulation of C  i (·) can accommodate deadweight losses associated with the possibility of default
by investors.

Regulation. As explained when introducing the investors' problem, the regulator has access to
investor-specific taxes/subsidies on all balance-sheet decisions. Formally, the regulator controls the
vector   R|X ||I| , given by stacking the investor-specific vectors  i  R|X | , as follows:
                                                                                          
                                         1                                       i
                                                                                 1 
                                         .                                       .
                                           
                                         .                                       .
                                                                                   
                                         .                                       .        
                                   =  i            ,      where  i =  ni
                                                                                          ,                          (7)
                                                                                          
                                      .                               .
                                                                                          
                                      .                               .
                                                                                          
                                      . 
                                                   
                                                                      .         
                                                                                          
                                                                                          
                                             |I|                                    i
                                                                                   |X |


where n i denotes the regulation that directly affects the balance-sheet decision n of investor i.

   Any revenue raised by the regulator is returned back to investors in the form of lump-sum
transfers T0i
              iI , whose sum across investors must satisfy

                                                         i
                                                        T0 =         i · xi .                                        (8)
                                                   iI          iI


Our results are valid for any set of lump-sum transfers that satisfies Equation (8).4
   The main focus of this paper is on situations where there are constraints on the set of instruments
                                                                i
   4
    Models of corrective regulation sometimes impose that T0      =  i · xi , i, which implies that any revenue raised
from type i investors is returned to themselves. Equation (8) is trivially satisfied when this more restrictive condition
holds. In that case, our results can also be interpreted as a form of quantity regulation.


                                                               9
available to the regulator. We flexibly model those possible constraints by assuming that the
regulator chooses taxes/subsidies subject to M  0 predetermined constraints, which we write as

                                                ( )  0,

where the vector-valued function  : R|X ||I|  RM defines the set of feasible regulations. This
general specification captures several regulatory scenarios. For instance, when  (·)  0, then the
regulator is unconstrained and can achieve the first-best policy, which we characterize in Section
3.3. Alternatively, we also consider second-best scenarios in which the regulator i) only regulates
the activities of a particular subset of investors, ii) only regulates a specific subset of activities, or
iii) faces constraints on the level that the regulation on investors or activities can take.

Equilibrium definition. An equilibrium, given corrective taxes/subsidies  i iI and lump-
               i
sum transfers T0                                       i i                C C
                 iI , consists of consumption bundles c0 , c1 (s) iI and c0 , c1 (s) , investors'
                                                                           i    i
balance-sheet (financing and investment) decisions         xi   iI   =   b ,k            , creditors' funding
                                                                                    iI
decisions   hC
             i      , financing schedules       Qi xi    iI ,   investors' investment returns net of
                 iI
repayments i      xi , s  iI , and creditors' received repayments     C     i
                                                                        i x , s iI given investors'
default decisions such that i) investors maximize utility, Equation (1), subject to budget constraints
(2) and (3); ii) creditors maximize utility, Equation (4), subject to budget constraints (5) and (6);
iii) any revenue raised is returned back to investors, satisfying Equation (8); iv) financing decisions
satisfy market clearing, that is, hCi = 1, i; and v) investors' balance-sheet decisions are consistent
                              i   i
in the aggregate, that is, x = x , i.
     Our notion of equilibrium, in which investors internalize that their balance-sheet decisions
can affect the payoffs of creditors in equilibrium, is standard in models that allow for default
(e.g., Dubey, Geanakoplos and Shubik, 2005; Aguiar and Amador, 2013; Livshits, 2015). Until
we introduce our applications in Section 4, we proceed as if the environment considered here is
well-behaved. We discuss the necessary regularity conditions for this to be the case within each of
our applications.

Remarks. Before characterizing the equilibrium of the model, we conclude the description of the
environment with four remarks.
    First, assuming that the utility functions of investors or creditors depend directly on the choices
of others -- in Equations (1) and (4) -- immediately justifies the desirability of corrective regulation.
Given that the main insights of this paper do not rely on the exact rationale behind the corrective
regulation, we adopt this formulation since it is the simplest. In Section 4, we show how our
formulation encompasses widely studied rationales for regulation, including bailouts, pecuniary
externalities, and internalities.
    Second, note that we model investors and creditors as distinct groups of agents mostly for
tractability. One can interpret creditors in our model as a type of investor who is only allowed to
fund other investors, and does so without generating welfare-relevant externalities. Therefore, as

                                                   10
we show in Section 3.3, it is sufficient to regulate the balance-sheet decisions of investors to reach
the first-best outcome of the model.5
    Third, note that our environment, which allows for both complete and incomplete markets and
can accommodate default, is quite general. Moreover, in Section D of the Online Appendix, we
provide a formal counterpart of our results using classical consumer theory.
    Finally, note that by suitably interpreting the utility of creditors, our model captures non-
pecuniary benefits that may accrue to creditors from some particular form of financing. For
instance, the liabilities of some investors are often seen as special, featuring a convenience yield,
which is fully consistent with our framework -- see, in related contexts, Stein (2012), Sunderam
(2015), or Begenau and Landvoigt (2021).

2.2    Equilibrium characterization
For given corrective taxes/subsidies and lump-sum transfers, we now succinctly characterize the
equilibrium conditions of the model. First, we present the optimality conditions associated with
creditors' optimal funding decisions, which are given by
                                       ^
                            Q x = mC (s) C
                              i   i
                                                   i  xi , s dF (s) , i,                     (9)


where mC (s) denotes the creditors' stochastic discount factor. Equation (9), which is an Euler
equation for creditors, will determine the financing conditions that investors face. Note that the
creditors' stochastic discount factor mC (s) is an equilibrium object, which depends on the choices
of all investors in the model and the regulatory policy. Hence, regulating an investor j impacts
the balance-sheet of investor i in equilibrium through Qi xi , via changes in creditors' stochastic
discount factor.
    Next, we present the optimality conditions associated with investors' optimal balance-sheet
decisions, which are given by
                                                             ^
                           Qi xi    i xi                                  i xi , s
                       -         +       + i =                   mi (s)            dF (s) , i,                      (10)
                             xi      xi                                     xi

where mi (s) denotes the stochastic discount factor of investor i. Note that Equation (10)
represents the |X | optimality conditions that determine the optimal balance-sheet of investors.
These conditions are Euler equations for both financing and investment. Given Equations (9) and
(10), which fully characterize the equilibrium of the model once xi = xi , we can now study the
optimal corrective regulation.
   5
    In an earlier version of this paper, we allowed for investors to invest in each other's liabilities and for creditors'
decisions to also be associated with welfare-relevant externalities. Since the main insights are identical in both
formulations, we adopt the current formulation since it substantially simplifies the notation.




                                                           11
3        Optimal Corrective Regulation
In this section, which contains the main contributions of this paper, we study the problem of a
planner who can set the optimal corrective regulation under different constraints on the set of
regulatory instruments  . First, we provide a general characterization of the marginal welfare
effect of adjusting corrective regulation. Subsequently, we characterize the optimal first-best and
second-best regulations. In Subsection 3.1, we preemptively introduce the notation and definitions
necessary to formulate our results.

3.1        Notation and definitions
We denote by V i ( ) iI and V C ( ) the indirect utilities of investors and creditors, respectively,
as a function of the full set of regulatory instruments   R|X ||I| . In order to abstract from
redistributional concerns and focus on the corrective nature of the regulation, we assess the
aggregate welfare gains/losses of a marginal change in regulation by aggregating money-metric
utility changes across all agents.6
    Formally, we express the change in social welfare induced by a marginal change in a given
variable (or vector) z , denoted by dW
                                     dz , as follows:

                                                 dW             dVmi  dV C
                                                     =               + m,                                                    (11)
                                                  dz       iI
                                                                 dz    dz

               i        i              C        C
where dV       dV           dVm     dV
        dz = dz /0 and dz = dz /0 denote the money-metric change in indirect utility for
         m          i                     C


investors and creditors, respectively, and where i        C
                                                  0 and 0 denote the marginal value of a dollar at
date 0 for investors and creditors.7 In particular, we will characterize the marginal welfare effect
of varying the set of balance-sheet regulations  , given by

                                                                                          dW
                                                                                                
                                               dW                                           j
                                                                                          d1
                                               d 1
                                                                                           .
                                                                                                
                                                 .
                                                       
                                                 .                                         .
                                                                                           .
                                                                                                
                                                 .                         
                                                                           
                                                                                                
                                                                                                
                                  dW  
                                               dW
                                                                      dW                  dW    
                                     =                 ,    where         =                     ,                            (12)
                                                       
                                                                                            j
                                  d            d j                    d j                 dn    
                                                 .                                         .
                                                                                                
                                      
                                                 .
                                                 .     
                                                                           
                                                                                           .
                                                                                           .    
                                                                                                
                                                       
                                                dW                                      dW
                                                                                                
                                               d |I|                                     j
                                                                                       d|X |



and where dW        |X ||I| and dW  R|X | . Each element of dW denotes the marginal welfare effect
            d  R                d j                         d j
of varying the regulation that investor j faces. By vertically stacking dW
                                                                         d j
                                                                             , we collect the set of
marginal welfare effects associated with varying each of the elements of  in the vector dWd
    6
    This approach can be interpreted as selecting an equal-weighted set of "generalized social marginal welfare
weights," using the approach in Saez and Stantcheva (2016). It is straightforward to allow for traditional social
welfare weights in our framework.
                                                                      i       V i          C        V C
    7                                                                Vm       z           Vm        z
        We use the same notation for partial derivatives, that is,   z
                                                                          =   i
                                                                                    and   z
                                                                                                =   C
                                                                                                          . The sub-index m stands
                                                                               0                     0
for money-metric.


                                                                12
    We also define the vectors of investors' balance-sheets x  R|X ||I| and marginal
distortions/externalities   R|X ||I| , given by stacking the vectors xi  R|X | and  i  R|X | , as
follows:
                                                                                                                          
                  x1                    1                                    xi1                            i
                                                                                                            1 
                  .                     .                                    .                              .
                                                                            
                  .                     .                                    .                              .
                                                                                                              
                   .                    .                                     .                             .             
                            and  =   i                    where xi =  xi                   and  i =  n
                                                                                                     i
         x =  xi                                   ,                                                                      ,   (13)
                                                                                                                          
                                                                      n
              .                     .                                 .                              .
                                                                                                                          
              .                     .                                 .                              .
                                                                                                                          
               . 
                           
                                    .              
                                                                       .    
                                                                                          
                                                                                                     .                    
                                                                                                                          
                    x|I|                     |I|                                 xi
                                                                                  |X |
                                                                                                                   i
                                                                                                                   |X |


where xi                                                        i
       n denotes the balance-sheet decision n of investor i and n corresponds to the money-metric
aggregate of marginal externalities associated with balance-sheet decision n of investor i,8 given by
                                                                                      
                                            i                  1 u    1        uC
                                            n = -                   + C    .                                                  (14)
                                                          I
                                                               0 xi
                                                                  n      i
                                                                      0 xn


We define the square Jacobian matrix of investors' balance-sheets x with respect to  , of dimension
|X | |I| × |X | |I|, as follows:

                                                                                                          dxi
                                                                                                                    
                                                                                          dxi               |X |
                           
                              dx1            dx|I|
                                                                                            1
                                                                                            j      ···      j
                              d 1
                                      ···     d 1
                                                                                          d1               d1       
                                                                         dxi                .               .
                                                                                                                    
                    dx          .              .
                                                      
                                                                                            .      dxi      .
                                .              .
                                                                                                                    
                      =
                                      dxi             
                                                      ,        where           =            .        n
                                                                                                            .       ,         (15)
                    d           .     d j
                                               .                         d j                       dnj              
                               dx1           dx|I|                                                        dxi
                                                                                                                    
                                      ···                                                 dxi               |X |
                                                                                                                    
                              d |I|          d |I|                                         j
                                                                                             1
                                                                                                   ···      j
                                                                                         d|X   |
                                                                                                          d|X |


           dxi
where        n
             j   denotes how the balance-sheet decision n of investor i changes when regulating the
           dn
balance-sheet decision n of investor j . Following Hendren (2016), we refer to the elements of d x
                                                                                                d ,
which represent the equilibrium responses of balance-sheets x to changes in regulation  , as policy
elasticities.
    Finally, we define Pigouvian wedges   R|X ||I| between corrective regulations  and marginal
distortions  as follows:
                                              =  - .                                          (16)

As we show in Proposition 2, Pigouvian wedges are zero at the first-best, so they define the distance
between a given set of regulations and the first-best regulation. Outside of the first-best, Pigouvian
wedges can be positive or negative. If a wedge n    i is positive, the balance-sheet decision n of investor

i is overregulated, in the sense that it is welfare-improving to increase the level of the associated xi n.
                             i
Alternatively, if a wedge n is negative, the balance-sheet decision n of investor i is underregulated,
in the sense that it is welfare-improving to reduce the level of the associated xi   n . Therefore, we say
   8                                                                        u         uC                            i
       Intuitively, an activity generates negative externalities when       xi
                                                                                 or   xi
                                                                                                is negative, making n positive. An
                                                                             n         n
                                                     u         uC                       i
activity generates positive externalities when       xi
                                                          or   xi
                                                                    is positive, making n negative.
                                                      n         n




                                                                 13
that:

                   i
                   n > 0  Overregulation increasing xi
                                                     n is welfare-improving
                   i
                   n < 0  Underregulation decreasing xi
                                                      n is welfare-improving .


Our results below demonstrate that both over and underregulation can arise as part of the optimal
second-best policy, depending on the nature of the constraints faced by the planner.

3.2     Marginal welfare effects of corrective regulation
Given these definitions, we are ready to present Proposition 1, which characterizes the marginal
welfare effects of varying the set of balance-sheet regulations, dW
                                                                 d . Proposition 1 highlights that
dW
 d can be exclusively characterized in terms of two sets of sufficient statistics: policy elasticities
and Pigouvian wedges.
Proposition 1. [Marginal Welfare Effects of Corrective Regulation: Policy Elasticities and
Pigouvian Wedges] The marginal welfare effects of varying the set of balance-sheet regulations  ,
dW
d , are given by

                                          dW   dx          dx
                                             =    ( -  ) =    ,                                                (17)
                                          d    d           d

where dW                                                                      dx
       d is a vector of dimension |X | |I| × 1, defined in Equation (12); d is the square Jacobian
matrix of policy elasticities of dimension |X | |I|×|X | |I|, defined in Equation (15); and  and  are
vectors of dimension |X | |I| × 1, where the vector of regulations  is defined in Equation (7) and the
vector of marginal distortions  is defined in Equation (13). Therefore, the marginal welfare effects
dW
 d can be exclusively characterized in terms of two sets of sufficient statistics: policy elasticities,
dx                               9
d , and Pigouvian wedges,  .

     Proposition 1 shows that in order to characterize the welfare impact of any change in regulation
it is sufficient to understand i) how the balance-sheet decisions of all investors react in equilibrium
to such a change, via the matrix of policy elasticities, and ii) the size of the marginal uncorrected
externalities associated with each individual balance-sheet decisions, via the vector of Pigouvian
wedges.10
     The first set of sufficient statistics are the policy elasticities, d x
                                                                         d , defined in Equation (15),
which capture the general equilibrium responses of the balance-sheet decisions of investor i to
   9
    Note that Equation (17) implies that the marginal welfare effects of varying the balance-sheet regulations that
directly affect agent j can also be expressed as follows:

                               dW    dx             dxi i            dxi
                                                                       n i   i
                                   =     =               =               n - n .
                               d j   d j            d j              d j
                                               iI            iI nX

  10
    Note that the planner accounts for the welfare impact of policy changes on equilibrium prices. As we show in
the Appendix, the impact of changes in equilibrium prices is zero-sum on aggregate. Using the language of Dávila
and Korinek (2018), the distributive pecuniary impact of a policy change nets out on aggregate, which simplifies the
characterization of dW
                    d
                       .


                                                        14
changes in the regulation that affect every other investor. Note that policy elasticities both across
                   i                                                                         dxi
investors, e.g., dxn
                   j , and across balance-sheet activities within the same investor, e.g., d i , are
                                                                                               n
                   dn                                                                                 n
relevant. Equation (17) implies that, for a given Pigouvian wedge, whether balance-sheet activities
                        dxi                               dxi
are gross substitutes ( d j
                            > 0) or gross complements ( d  j
                                                              < 0) becomes critical to determine the
welfare impact of policy changes. The substitutes/complements distinction is central to the design
of optimal second-best regulation.
    The second set of sufficient statistics are the Pigouvian wedges between corrective
taxes/subsidies and marginal distortions. For any given set of regulations, these wedges capture
the extent to which different balance-sheet activities are regulated too strictly or too leniently. For
example, if n  i =  i -  i < (>) 0, then the corrective regulation on the balance-sheet activity n
                    n     n
of investor i is smaller (larger) than the marginal distortion that this activity creates. Therefore,
negative wedges imply that the private marginal cost of an activity is smaller than social marginal
cost, while positive wedges imply that the private marginal cost exceeds the social marginal cost.
    Moreover, Equation (17) shows that the marginal welfare effects of any regulatory change can
be interpreted as a linear transformation of wedges, with the matrix d  x
                                                                       d of policy elasticities acting
as a transformation matrix.11 Intuitively, welfare will increase if a policy reform discourages
                                  i
(encourages) activities, e.g., dxnj < (>) 0, that are currently regulated too leniently (strongly),
                                 dn
      i < (>) 0, or vice versa. The overall marginal welfare effect corresponds to adding up over
e.g., n
the products of leakage elasticities and Pigouvian wedges.
    The marginal welfare effects presented in Proposition 1 are useful to characterize the form of
the optimal regulation in alternative regulatory scenarios. In the remainder of this section, we show
how to employ Proposition 1 to characterize the optimal first-best and second-best regulations.

3.3      First-best regulation: Benchmark
Under the first-best regulation, a planner is allowed to set arbitrary corrective regulations  
R|X ||I| for all investors. In that case, Proposition 2 provides a well-known characterization of the
first-best policy, which provides a benchmark against which we evaluate the optimal second-best
policy.

Proposition 2. [First-Best Regulation/Pigouvian Principle] If the planner can freely regulate all
investors without constraints, and the matrix of policy elasticities has full rank, then the first-best
regulation satisfies:

                                            = 0   =  .

Therefore, the first-best regulation does not depend directly on the magnitude of the policy
elasticities.

       This is an instance of the Pigouvian principle, i.e., the "polluter pays" (Pigou, 1920; Sandmo,
   If T (·) is a linear transformation mapping Rn to Rm and x  Rn is a column vector, then T (x) = Ax for some
  11

m × n matrix A, which is called the transformation matrix of T (·).


                                                     15
1975). The first-best regulation on investors is set to perfectly align private and social incentives
across every activity undertaken by each agent. In terms of the Pigouvian wedges defined in
Equation (16), the optimal regulation is such that all wedges are set to zero. Proposition 2 directly
                                                                       uj          uC
implies that an economy without externalities, i.e., one for which x     i = 0 and xi = 0, i, j  I ,
                                                                         n            n
is efficient.
    An important consequence of Proposition 2 is that the first-best regulation does not directly
depend on the magnitude of the policy elasticities. It is exclusively a function of the Pigouvian
wedges. Intuitively, the first-best regulation must satisfy dW       dx
                                                               d = d  = 0, which defines a system
of homogeneous linear equations in  . If the matrix of policy elasticities d   x
                                                                              d is invertible (i.e., has
full rank), the only solution to this system is the trivial solution, in which  = 0 and  =  .
    Importantly, while Proposition 2 characterizes the optimal first-best regulation, it does not
provide a solution in terms of primitives unless the marginal distortions  are invariant to the
level of regulation (this will be the case in several of our applications). Whenever the marginal
distortions are endogenous to the level of the regulation, our claims here become statements about
the form of the optimal policy formulas. The same caveat applies to our discussions of Propositions
3 through 4.

3.4   Second-best regulation
Now we consider scenarios in which the planner faces a set of predetermined constraints on the
set of instruments  , providing a novel general characterization of the optimal second-best policy.
Formally, the optimal second-best policy is given by

                                          = arg max W ( )
                                                  

                                                 s.t.  ( )  0,

where the vector-valued function  (·) : R|X ||I|  RM defines a set of M  0 constraints on the
set of instruments  . This general specification of  (·) allows us to consider a wide range of
regulatory constraints. For instance, when the planner cannot regulate agent j , the appropriate
constraints are nj = 0, n  X . Similarly, when the planner cannot regulate a particular activity

n, the appropriate constraints are n i = 0, i  I . Alternatively, when all agents are regulated at

the same rate or when all activities are regulated at the same rate, the appropriate constraints are
ni =  , i  I , or  i =  i , n  X , respectively. Many other scenarios of practical relevance can
       n             n
be interpreted as combinations of these.
    Consequently, the second-best regulation must satisfy

                                           dW   d
                                              -   µ = 0,                                           (18)
                                           d    d
        
where d
      d denotes the Jacobian of the constraints -- a matrix of dimension |X | |I| × M -- and
where µ  RM denotes the vector of Lagrange multipliers associated with the constraints, formally



                                                  16
given by
                                                                      dm
                                                                                
                      d1             dM
                                                                                                 
                      d 1     ···    d 1                              d j
                                                                        1
                                                                                              µ1
           d            .              .                  dm    
                                                                        .
                                                                        .
                                                                                              . 
                        .     dm       .                                        ,    and µ =   . 
             =                                  where         =                               . .
                                                                                
           d            .     d j      .     
                                             
                                                          d j
                                                                        .
                                                                      dm
                                                                                
                       d1            dM
                      d |I|
                              ···    d |I|                            d j
                                                                                              µM
                                                                        |X |



   At this point, we make a distinction between i) perfectly regulated decisions and ii) imperfectly
regulated decisions. We say that a balance-sheet decision of a given investor is perfectly regulated
when all constraints associated with that decision are slack, and imperfectly regulated when its
regulation is subject to a binding constraint. Formally, we denote the mutually exclusive sets of
perfectly regulated (R) and imperfectly regulated (U ) decisions by12

                                                j
                     R = (j, n) : j  I , n  X , n =0             Perfectly Regulated
                                                j
                     U = (j, n) : j  I , n  X , n =0             Imperfectly Regulated,

where   R|X ||I| is defined as the |X | |I| × 1 vector

                                                          d
                                                    =       µ.
                                                          d

The vector  quantifies, for each regulatory instrument in  , the shadow cost of increasing the
regulation associated with the regulatory constraints. Notice that, because we have a general
specification of constraints, the shadow costs in  can be negative. For example, if one of the
constraints embedded in  ( ) imposes a binding lower bound on a tax/subsidy n           j , then the

corresponding shadow cost is n   j < 0. It is important not to confuse this property of  with the

Lagrange multipliers µ, which must be non-negative.
    Accordingly, we define the values of the perfectly and imperfectly regulated decisions by xR =
 xj                U       j
   n (j,n)R and x = xn (j,n)U , and similarly partition other vectors such as  =  , 
                                                                                             R   U ,

 =  R ,  U , and  =  R ,  U . The Jacobian matrix                       dx
                                                                        d      of policy elasticities, introduced in
                                                                                            U    U     R           R
Equation (15), can also be decomposed into smaller Jacobian matrices: d    x
                                                                              , dx , dx , and d
                                                                          d R d U d U
                                                                                                x
                                                                                              d R
                                                                                                  ,
as described in the Appendix. For the remainder of this section, we will assume that the matrices
                            xU       xR
of own-regulatory effects d
                          d U
                               and d
                                   d R
                                        are invertible.
    In this paper, we introduce the notion of leakage elasticities to refer to the elements of the
                   xU
Jacobian matrix d d R
                      , which capture the responses of imperfectly regulated decisions to changes
in regulation. In Proposition 3, we show that leakage elasticities are a key determinant of the
second-best policy.

Proposition 3. [Second-Best Regulation: General Case] The optimal second-best regulation
  12
     We choose U to denote the set of imperfectly regulated decisions since "unregulated" decisions are a leading case
of imperfectly regulated decisions.




                                                         17
satisfies
                                                                 -1
                                          R     R  dxR                dxU U
                                              = + - R                      ,                                     (19)
                                                   d                  d R
                                                                         R           U
where  R is a vector of distortions of dimension |R| × 1, d      x
                                                                d R
                                                                    and d  x
                                                                          d R
                                                                                are Jacobian matrices of
                                                          U     U     U
dimension |R| × |R| and |R| × |U|, respectively, and  =  -  is a vector of Pigouvian wedges
of dimension |U|× 1. Therefore, the optimal second-best regulation only depends directly on a subset
                              xR                     xU
of all policy elasticities: d
                            d R
                                 and, importantly, d
                                                   d R
                                                        (leakage elasticities).

     Proposition 3 provides direct insights into the form of the optimal second-best policy. Since the
first-best solution is given by  R =  R , whether the optimal second-best policy overregulates or
                                                                                   -1
                                                                               xR     dxU U
underregulates perfectly regulated decisions is a function of the sign of - d d R     d R
                                                                                           , which we
                                         13
refer to as the second-best correction. First, we provide a heuristic interpretation of the general
characterization in Equation (19), which explains the most relevant economic effects. Next, we
provide formal insights in the context of two illustrative examples.
     At a heuristic level, as long as perfectly regulated activities decrease when their regulation
                 xR
is tightened ( dd R
                     is "negative"), the sign of the second-best correction becomes a product of
the leakage elasticities and the Pigouvian wedges of imperfectly regulated choices. Under the
natural presumption that the constraints are such that imperfectly regulated activities are indeed
underregulated ( U <  U or, equivalently,  U < 0), whether the optimal second-best policy
overregulates or underregulates an activity becomes a function of whether such an activity is a
gross substitute or a gross complement with respect to imperfectly regulated decisions. Therefore,
it is optimal to underregulate the regulated relative to the first-best ( R < 0), when regulated
                                             xU
and unregulated are gross substitutes ( d   d R
                                                > 0). Alternatively, it is optimal to overregulate the
                                       R
regulated relative to the first-best ( > 0) when regulated and unregulated are gross complements
   xU
(dd R
       < 0). Indeed, our applications below demonstrate that both gross substitutes and gross
complements are common in standard scenarios, depending on which activities are imperfectly
regulated.
     To provide formal insights, it is useful to study two special cases. First, we consider a scenario
in which there is a single fully regulated decision. Second, we consider a scenario in which the
responses of perfectly regulated activities to changes in regulation are independent of one another.
In both cases, the formulas for second-best regulation simplify because we do not have to account
for the responses of different regulated activities on one another.

Example 1. [Single Decision] Consider the simple scenario in which there are two investors |I| = 2,
and each investor has a single decision |X | = 1. Assume that only investor 1 can be regulated, with
regulatory constraints dictating that  2  0. In that case, it follows from Proposition 3 that the
  13
     As explained when describing the first-best regulation, Equation (19) does not characterize the optimal second-
best regulation in terms of primitives. When the set of marginal distortions  =  R ,  U is invariant to the level
of regulation, any statement on whether the second-best policy overregulates or underregulates a decision relative to
the first-best is an exact directional statement -- this will be the case in several of our applications. Whenever the
marginal distortions are endogenous to the level of the regulation, our claims here become statements about the form
of the optimal policy formulas.


                                                         18
optimal regulation for the regulated is simply given by
                                                                       -1
                                                                dx1         dx2 2
                                               1 = 1 - -                         .                          (20)
                                                                d 1         d 1

This case clearly shows the relationships discussed above. The optimal regulation on investor
type 1 is equal to the first-best equivalent  1 plus a weighted sum of the distortion imposed by
the other unregulated agent. Assume, for instance, that the distortion by the unregulated agent
satisfies  2 > 0. The weight on the distortion by the unregulated agent is negative, implying
that it pushes  1 towards underregulation, whenever i) the regulated agent responds negatively
                                                    1
to increased regulation (the "regular" case with dx
                                                  d 1
                                                      < 0), and ii) the associated leakage elasticity
                                 dx2     14
indicates gross substitutes with d 1 > 0.
                                                           dxR
Example 2. [Diagonal Case] Assume that                     d R
                                                                     is a diagonal matrix. Then, the second-best
regulation on choice (j, n)  R is

                                                                 -1
                                      j       j         dxj
                                                          n                      dxj
                                                                                   n   j
                                      n   =   n   + -    j                      j      n .
                                                        dn            (j ,n )U dn


The simplified formula again shows the importance of leakage elasticities, which are weighted by
wedges and summed across all unregulated activities (j , n )  U . It is clear in this case that it is
                                        j <  j ) if each of the imperfectly regulated activities is
optimal to underregulate the regulated (n    n
                  j                                                                          dxj
underregulated (n   < 0) and is a gross substitute to the regulated activity ( n
                                                                               j > 0). In addition,
                                                                              dn
the formula shows that, even when not every activity satisfies gross substitutes, it is optimal to
underregulate the regulated when a weighted average of leakage elasticities -- with the weights
proportional to the associated wedges -- is positive.

    We conclude with a remark explaining how our characterization of the optimal second-best
policy relates to the classic results in Lipsey and Lancaster (1956).
Remark 1. [Connection to Lipsey and Lancaster (1956)] Equation (19) immediately implies that
                                    xU
 R = 0 as long as  U = 0 and d     d R
                                       = 0. This insight is related to the discussion of second-best
policy in Lipsey and Lancaster (1956), who show that price distortions for one good imply optimal
distortions in other goods in the context of second-best tariff and monopoly regulation. The results
of Lipsey and Lancaster (1956) are often perceived as implying that there is little structure to
the problem of the second-best.15 While it is true that over and underregulation relative to the
  14
    While this is the simplest example for building intuition, note that the same insight extends to any economy
with a single regulated decision R = {(j , n )}, and with an arbitrary set of unregulated decisions U for which
taxes/subsidies are forced to be zero. In this more general example, the optimal policy formula becomes
                                                                            -1
                                                                     dxR         dxj
                                           R = R -               -                 n j
                                                                                     n .
                                                                     d R         d R
                                                       (j,n)U


  15
       Lipsey and Lancaster (1956) explicitly write:


                                                                19
first-best are possible, our results show that there is significant structure on how the optimal second-
best regulation must be conducted. Our formal general results show that leakage elasticities, and
through these elasticities whether particular decisions are gross complements or substitutes, are
critical to determine the optimal second-best regulation. Lipsey and Lancaster (1956) are also
often credited with the insight that social welfare can decrease when relaxing a constraint. We
revisit this argument after Proposition 4, which comes next and characterizes the welfare effects of
relaxing regulatory constraints.

3.5   Welfare effects of relaxing regulatory constraints
We now characterize the marginal welfare impact of relaxing regulatory constraints or, equivalently,
the shadow value of regulating imperfectly regulated choices xU . Formally, Proposition 4 evaluates
the marginal welfare effects of hypothetical (i.e., unconstrained) adjustments to the constrained
taxes/subsidies  U under the optimal second-best regulation.

Proposition 4. [Welfare effects of relaxing regulatory constraints] The marginal welfare effects of
regulating the set of imperfectly regulated decisions,  U , under the optimal second-best regulation,
are given by
                                       dW      dxU
                                          U
                                            =       (I - L)  U ,                                 (21)
                                       d       d U
          U
where d  x
        d U
            is a Jacobian matrix of dimension |U| × |U|, I is the identity matrix of dimension
|U| × |U|, L is a matrix of dimension |U| × |U|, given by

                                                   -1                 -1
                                            dxU         dxR    dxR         dxU
                                    L=                                         ,                                  (22)
                                            d U         d U    d R         d R

and where  U =  U -  U is a vector of dimension |U| × 1.

    Equation (21) decomposes the value of regulating xU into two parts. First, we have the
direct effect of adjusting  U , which would prevail in a scenario where all decisions are imperfectly
                                                                        xU U
regulated. By Proposition 1, this quantity is equal to the product d   d U
                                                                            of policy elasticities and
wedges on all imperfectly regulated decisions.
    Second, the equation makes an adjustment for the indirect policy effect, that is, for the
                                                                                             xU
responses of perfectly regulated decisions xR . The appropriate adjustment is given by - d  d U
                                                                                                 L U .
Interestingly, this adjustment tends to reduce the welfare effect of regulating the imperfectly
regulated, regardless of whether unregulated and regulated choices are substitutes or complements.
    To illustrate this effect most clearly, we revisit the simple case from Example 1:

Example 3. [Single Decision, cont.] Assume, as in Example 1, that there are two agents, each of
whom makes a single decision, and only agent 1 is regulated, with  2 = 0. Then, substituting the
      "It is important to note that in general, nothing can be said about the direction or the magnitude of the
      secondary departures from optimum conditions made necessary by the original non-fulfillment of one
      condition".



                                                         20
optimal second-best regulation from Equation (20), the welfare effect of marginally increasing  2
above zero is                                            
                                                               dx2   dx1
                                                dx2
                                                                           
                                        dW                     d 1   d 2
                                                                            2
                                            = -        1 -
                                                               dx1   dx2
                                                                            .
                                        d 2     d 2                        
                                                               d 1   d 2   
                                                                 =L

To interpret this expression, assume that the distortion  2 > 0, and that we are in the "regular"
                                                              1             2
case where the own-regulatory responses are negative with dxd 1
                                                                < 0 and dxd 2
                                                                              < 0. First, consider
                                dx2           dx1
the substitutes case, in which d 1 < 0 and d 2 < 0. We have L > 0, so that the welfare gain
from increasing  2 is smaller than it would be in the absence of an indirect effect on agent type
1. Intuitively, regulating the unregulated pushes distorted activity back to the regulated sector,
                                                                                             2
which dampens the direct welfare gains. Second, consider the complements case, in which dx d 1
                                                                                               >0
     dx1
and d 2 > 0. Once again, we have L > 0. This result arises from the nature of the second-best
regulation of agent type 1, which in the case of complements involves overregulation ( 1 > 0; see
Example 1). Raising  2 in this scenario reduces the activity of agent 1 which, due to the initial
overregulation, dampens the associated welfare benefit.16

    Notice that Proposition 4 generalizes this reasoning to the case with multiple decisions.
Heuristically, suppose that we are in the regular case where the own-regulatory responses are
               xR        xU
"negative" ( d
             d R
                  < 0, dd U
                            < 0). Then, the adjustment matrix L is "positive", both in the case of
                    dxR        xU                                  dxR        xU
gross substitutes ( d U < 0, dd R
                                   < 0) and gross complements ( d   U
                                                                       > 0, dd R
                                                                                 > 0), implying once
                                                                               U
again that the welfare effect of regulating the imperfectly regulated choices x is dampened. These
insights bear a connection to the Le Chatelier principle, which we discuss in the following remark.
Remark 2. [Connection to Le Chatelier Principle (Samuelson, 1948; Milgrom and Roberts, 1996)]
A prominent result in economic theory in which either complementarity or substitutability plays
the same role is the Le Chatelier Principle. In its simplest form, it states that whenever choices are
either complements or substitutes, the long-run response of a system is larger than its short-term
response -- see Milgrom and Roberts (1996) for a modern treatment. Note that Proposition 4
has a similar flavor, but it actually has the opposite conclusions in welfare terms: when we let our
system adjust further via the implementation of the optimal second-best policy, the shadow welfare
gains from regulation are lower.
    Finally, it is interesting to note that, starting from the second-best, the planner does not always
wish to push regulations for imperfectly regulated choices towards their first-best value. As noted
                                                                          xU U
above in our discussion of Lipsey and Lancaster (1956), even when d      d U
                                                                              > 0, it is possible that
dW
d U
     < 0, showing that loosening some regulation can be welfare-decreasing in our environment.
  16
    Note that it is conceivable to construct environments in which decisions are neither complements nor substitutes.
                                             dx1     dx2
In this example, this would correspond to d    2 and d 1 having opposite signs. Our characterization also applies to
these cases, which are rare in common economic applications -- see the related discussion in Milgrom and Roberts
(1996).




                                                         21
3.6     Common Scenarios of Regulatory Constraints
Finally, before illustrating our general results in the context of the applications, we specialize our
results in the case of two common scenarios of regulatory constraints. First, we consider the case
in which some investors or activities cannot be regulated at all. Second, we consider the case in
which the same corrective regulation must apply to all activities and/or investors.

3.6.1    Unregulated investors/activities

A particular type of regulatory constraint that is highly relevant in practice is when some investors
or activities cannot be regulated at all. Formally, here we assume that the planner faces a constraint
of the form
                                             ( ) =  U = 0,

so a subset of investors/activities are not subject to regulation at all.17 In that case, a specialized
version of Equation (19) applies.

Proposition 5. [Second-Best Regulation: Unregulated Investors/Activities] When some investors
and/or activities cannot be regulated at all, i.e.,  ( ) =  U = 0, the optimal second-best regulation
satisfies
                                                         -1
                                                    dxR     dxU U
                                   R = R - - R                   ,                               (23)
                                                    d       d R
                                                                                                              dxR
where  R and  U are vectors of distortions of dimensions |R| × 1 and |U| × 1, respectively, and               d R
      xU
and d
    d R
         are Jacobian matrices of dimensions |R| × |R| and |R| × |U|, respectively.

    As in Proposition 3, whether the regulated and unregulated decisions are gross complements or
substitutes is critical for the determination of the optimal second-best policy. In the case in which
some activities are unregulated,  U = - U , so the planner only relies on the value of the distortion
of the unregulated  U , instead of the value of the Pigouvian wedge of the unregulated.
Remark 3. [Connection to the Tinbergen (1952) rule] Proposition 5 relates to the classical analysis
of policy instruments in Tinbergen (1952). The Tinbergen (1952) rule states that first-best policy
must have access to as many instruments as it has targets. A concordant interpretation of Equation
(23) is that a second-best planner must use the |R| instruments contained in the free taxes/subsidies
 R (on the left-hand side of the equation) to target |R| + |U| distortions contained in  R and  U (on
the right-hand side). It is immediate from the equation that first-best cannot be achieved unless
 U = 0, consistent with the Tinbergen rule. The characterization of second-best regulation in the
equation offers a further refinement of the Tinbergen rule: with insufficient policy instruments, the
optimal tax/subsidy equals a weighted sum of all distortions in the economy, whose weights are
linked directly to leakage elasticities.
  17
    Slightly more generally, one could consider the case in which  ( ) =  U -  U = 0, so same regulations are fixed
at a predetermined value  U .




                                                        22
3.6.2    Uniform regulation

A second type of regulatory constraints that is highly relevant in practice is when the same corrective
regulation must apply to all activities and/or investors, despite the fact that each activity and/or
investor may be associated with externalities of different magnitudes. Formally, here we assume
that the planner is forced to set the same regulation for a subset U of choices, that is, the planner
faces constraints of the following form:18

                                         j   j
                                         n = n ,  (j, n) , j , n  U .

                                  d                                                                           d
It follows immediately that       d    for the subset of regulated decisions, which we denote by              d U
                                                                                                                  ,   is
given by                                                                            
                                                     1                ···      0
                                                                               .
                                                                               .
                                                                                 
                                               -1           1                  . 
                                                                                 
                                        d     
                                                           ..         ..
                                                                                 
                                            =                 .            .     .
                                                                                 
                                        d U
                                              
                                                                                 
                                               .
                                               .
                                                                                 
                                               .                      -1       1 
                                                     0    ···                  -1
                                                          |U |×(|U |-1)

We say that in this case the planner's regulation is imperfectly targeted. In Proposition 6, we show
that Equation (19) can be specialized to conclude that second-best policy is given by a weighted
average of distortions.

Proposition 6. [Second-Best Regulation: Imperfect Targeting] When some investors and/or
activities must be regulated at the same rate, i.e., nj =  j ,  (j, n) , (j , n )  U , the optimal second-
                                                            n
best regulation satisfies
                                             U
                                j         dxU
                                                (I - L)  U
                              n   =  U = dd    U             ,  (j, n)  U ,                           (24)
                                           dx  U ( I - L ) 
                                                                  U
where  is a vector of ones with dimension |U| × 1, d x
                                                   d U
                                                        is a Jacobian matrix of dimension |U| × |U|,
and L is the matrix of dimensions |U| × |U| that is defined in Proposition 4, with

                                                    -1                         -1
                                             dxU         dxR      dxR               dxU
                                     L=                                                 .
                                             d U         d U      d R               d R

    Unlike our previous characterizations, Proposition 6 provides an explicit formula for
taxes/subsidies on imperfectly regulated activities, leveraging the special case where regulation
must be uniform on a subset of activities. Equation (24) demonstrates that the optimal second-
best uniform regulation  U is a weighted average of the distortions  U generated by the associated
activities. Notice that, if distortions are symmetric across activities with  U =  , then Equation
(24) implies that the planner should set the first-best regulation  U =    ¯. However, if there is any
  18
    Note that all choices in U will be generically associated with a binding constraint, so this notation is consistent
with the way we introduced the set U .


                                                          23
asymmetry, the first-best cannot be achieved with uniform regulation.
    To build further intuition for this result, it is useful to first consider the special case where all
activities are subject to uniform regulation (xU = x). In that case, it follows from Proposition 6
that the optimal uniform regulation is given by

                                                             dxj
                                                               n j
                                               j I        nX d U n
                                       U =                         ,                                (25)
                                                              dxjn
                                                 j I       nX d U


where we have re-written the total response of activity xj
                                                         n to the uniform regulation as

                                         dxj
                                           n           dxj
                                                         n
                                             =             .
                                         d U   j I n X dn
                                                         j



This optimal regulation is a weighted average of distortions generated by imperfectly regulated
activities, and the weights are equal to the total policy elasticities of each activity. Intuitively, the
optimal regulation is large when activities with large (positive) distortions are most responsive to
uniform regulation.
    Equation (24) generalizes this idea to the case where there may also be perfectly regulated
activities xR , on which the planner can set regulation freely, in addition to the uniformly regulated
activities xU . In the general case, the optimal weights are adjusted for the endogenous responses
of perfectly regulated activities xR . Interestingly, the necessary adjustment is captured by the
same matrix L that features in the value of relaxing regulatory constraints in Proposition 4. In
                               dxR          xU
the special case where either d U
                                   = 0 or dd R
                                               = 0, we have L = 0, and we recover the expression in
Equation (25).
    We close this section by relating these results to the classical analysis of uniform corrective
taxation in Diamond (1973):
Remark 4. [Connection to Diamond (1973)] The insight that uniform regulation of heterogeneous
externalities is given by a weighted average of the distortions can be traced back to Diamond
(1973). Indeed, the special case where all activities are subject to uniform regulation in our
model yields Equation (25), which corresponds to Diamond's result that the optimal weights on
different distortions are equal to policy elasticities. The general analysis in Proposition 6 provides
further insights by characterizing the necessary adjustments when some policy instruments are
freely adjustable.


4    Applications
In this section, we present four specific applications of our general results. This section has several
purposes. First, the study of these applications allows us to show how our results can be employed
to determine the optimal second-best policy in several scenarios of practical relevance. Second,
these applications, which are special cases of the general framework studied in Sections 2 and 3,
illustrate how our results encompass widely studied rationales for regulation, including bailouts,

                                                     24
pecuniary externalities, and internalities.19 Third, by studying specific applications, we can connect
leakage (and policy) elasticities and Pigouvian wedges to model primitives. Finally, we discuss how
our results can be used to interpret existing empirical findings and guide future measurement efforts
in the context of each application.
    Table 1 provides a schematic summary of our applications. Each application is designed to be
the simplest one that illustrates the form of the optimal second-best policy in a particular second-
best scenario. In the Online Appendix, we provide detailed derivations for each application.20

                                       Table 1: Summary of Applications
                        Application                                Restricted Instrument              |I|    |X |
       #1               Shadow Banking                             Unregulated Investors               2      1
       #2          Scale-Invariant Regulation                     Unregulated Activities               1      2
       #3              Asset Substitution                       Uniform Activity Regulation            1      2
       #4     Heterogeneous Fire-Sale Externalities             Uniform Investor Regulation            2      1

    In Application 1, we study a model of shadow banking in which some banks/investors are
unregulated and regulation is motivated by the presence of implicit government subsidies to
traditional and shadow banks. In Application 2, we study an environment where regulation
constrains the ratio of investors' risky investments to borrowing. Such scale-invariant regulations
form a large part of financial regulatory policy in practice. In this application, to illustrate how
our model applies to a different rationale for intervention, we consider a behavioral distortion
(distorted beliefs). In Application 3, regulation is constrained to be uniform across different
investment activities, with intervention motivated by government bailouts, which gives rise to an
asset substitution problem. In the final application, we analyze a model of fire-sale externalities,
along the lines of Lorenzoni (2008), in which regulation is also constrained to be uniform across
different types of investors.

4.1    Application 1: Shadow Banking/Unregulated Investors
The notion of shadow banking is typically used to describe the financial activities that take place
outside of the regulated financial sector.21 In this application, we consider an environment with
two types of investors, in which only one type of investor can be regulated (the traditional sector),
while the other is outside of the scope of the regulation (the shadow sector).
   19
      Note that our formulation of investors' and creditors' preferences in Equations (1) and (4) is more general than
it may seem since, as we show in this section, there is no need to write an explicit representation of investors'
and creditors' preferences to study the welfare implications of first-best and second-best regulation under different
rationales for intervention.
   20
      These applications are not exhaustive. For instance, one could study the role of imperfect corrective regulation in
models of strategic behavior and imperfect competition, as in Corbae and D'Erasmo (2010) and Corbae and Levine
(2018, 2019), or in the context of regulation of asset markets, as in Dávila (2014) or Cai, He, Jiang and Xiong (2020).
   21
      Pozsar, Adrian, Ashcraft and Boesky (2010), Gorton, Metrick, Shleifer and Tarullo (2010), and Claessens, Pozsar,
Ratnovski and Singh (2012) provide a detailed overview of shadow banking institutions, activities, and regulations.




                                                           25
Environment We assume that there are two types of investors i  {1, 2}. In this application,
investors should be broadly interpreted as financial intermediaries or banks. Investors have risk-
neutral preferences of the form:             ^
                                               ci
                                                0+
                                                   i
                                                           ci
                                                            1 (s) dF (s) ,

with budget constraints given by

                             ci    i    i i  i i    i
                              0 = n0 + Q b - b b + T0

                          ci        i            i     i i       i
                           1 (s) = n1 (s) + max v s + t b , s - b , 0 ,                   s.

At date 0, an investor i endowed with ni                                                        i
                                             0 dollars chooses the face value of its debt, b , which
determines the amount of financing obtained at date 0, Qi bi , determined in equilibrium by
creditors, as described below. Investor i faces a corrective tax b    i per unit of bi due at date 0. At

date 1, once a state s is realized, investor i receives v i s dollars, as well as a bailout transfer that
potentially depends on the amount of debt issued by such an investor: ti bi , s . This specification
of bailouts corresponds to a model where the government has limited commitment, which connects
our work to the treatment of bailouts in Farhi and Tirole (2012), Bianchi (2016), Chari and Kehoe
(2016), Keister (2016), Gourinchas and Martin (2017), Cordella, Dell'Ariccia and Marquez (2018),
Dávila and Walther (2020a), and Dovis and Kirpalani (2020), among others.
    We allow for the possibility of default, so an investor will find it optimal to default whenever
v s + ti bi , s - bi < 0, and to repay otherwise. After default, creditors receive a fraction i of the
 i

gross returns to investment -- the remainder 1 - i measures the deadweight loss associated with
default -- and any bailout funds.
    Creditors are risk-averse, with preferences of the form
                                                ^
                                       C      C
                                   u c0 +          u cC1 (s) dF (s) .


Their budget constraints are given by

                         cC    C
                          0 = n0 -            hi Qi bi
                                        iI

                    cC
                     1   (s) =   nC
                                  1   (s) +        hi P i bi , s - (1 + )         ti bi , s ,   s,
                                              iI                             iI


where hi is the fraction of bonds purchased from investor i, and P i bi , s denotes the repayment
received by creditors from investor i in state s, explicitly described in the Online Appendix. At
date 1, all bailout funds are raised from creditors, with a constant net marginal cost of public funds
  0. Note that investors only interact in this application through changes in the price of credit,
                                                                      C u (cC
                                                                            1 (s))
i.e., through the stochastic discount factor of creditors: mC (s) = u cC           .
                                                                          ( 0)




                                                           26
                           0.1


                          0.08


                          0.06


                          0.04


                          0.02


                            0


                         -0.02


                         -0.04


                         -0.06


                         -0.08


                          -0.1
                                 0   0.01     0.02     0.03     0.04    0.05     0.06     0.07     0.08




                    Figure 1: Shadow Banking/Unregulated Investors (Application 1)
Note: Figure 1 compares the marginal welfare effects of varying corrective regulations in two different scenarios. The
                                                                                                                       1     2
green dashed line corresponds to the first-best scenario in which the horizontal axis corresponds to b = b               = b   .
                                                                                2                                            1
The solid blue line corresponds to a second-best scenario in which b = 0 and the horizontal axis corresponds to b .
Since we assume that both types of investors are symmetric, the value of b that makes the first-best marginal welfare
                                                                     1
effect zero defines the first-best regulation. The value of b          that makes the second-best marginal welfare effect zero
defines the second-best regulation. To generate this figure, we assume that the bailout policy is linearly separable:
                                                                                      1-
t i b i , s = 0   i   i
                    - s s + bi i
                              b , and that creditors' utility is isoelastic: u (c) = c
                                                                                     1-
                                                                                         . The parameters used to generate this
figure are  = 0.7,  = 0.25, v = 1, 0 = s = 0, b = 0.02, for i  {1, 2}. Also  = 0,  = 4,  C = 0.98, nC
                i          i          i       i     i         i
                                                                                                                       0 = 50,
and nC    1 (s) = 50 + 0.1s, where s is normally distributed with mean 1.3 and standard deviation 0.3, truncated to
the interval [0, 3]. For reference, the optimal first-best regulation is 4.88%, while the optimal second-best regulation,
when the second type of investors cannot be regulated, is 4.39%. Since borrowing decisions are gross substitutes in
this application, the optimal second-best policy is sub-Pigouvian .


Equilibrium In this application, for given corrective taxes/subsidies b          1 ,  2 , lump-sum transfers
                                                                                     b
 T01 , T 2 , and bailout transfers t1 b1 , s , t2 b2 , s , an equilibrium is fully determined by investors'
        0
borrowing decisions, b1 , b2 , and financing schedules, Q1 b1 , Q2 b2 , such that investors
maximize their utility, given the financing schedules, and creditors set the schedules optimally,
so that h1 = h2 = 1.
    In the first-best scenario, the planner is able to set b  1 and  2 freely. However, we are interested
                                                                      b
in scenarios in which the planner cannot regulate type 2 investors, so

                                                              2
                                                              b = 0,

                                                1 a second-best problem.
which makes the problem of choosing the optimal b




                                                                27
Optimal Corrective Policy/Simulation First, in Proposition 7, we characterize the form of
the optimal second-best policy. Next, we explore a numerical simulation of this application,

Proposition 7. [Shadow Banking/Unregulated Investors]
                                                                                            1 , is given
a) The marginal welfare effect of varying the corrective regulation of regulated investors, b
by
                                   dW      db1 1       1     db2 2
                                      1 =    1   b -   b  -    1 b ,
                                   db      db                db
where the marginal distortions in this application are defined by
                                                  ^
                                   i                            ti bi , s
                                   b   = (1 + )        mC (s)             dF (s) ,                              (26)
                                                                  bi

where mC (s) denotes the stochastic discount factor of creditors.
b) The optimal corrective regulation satisfies

                                                                  -1
                                         1        1      db1            db2 2
                                         b   =    b   - - 1               1 b .
                                                         db             db

    Proposition 7 is the counterpart of Propositions 3 and 5 and exploits the structure of this
application to extract further insights. In this application, the marginal distortions associated with
                                                                        i i
borrowing, b i , are determined by the expected marginal bailout t (b ,s) , augmented by default
                                                                         bi
deadweight losses  if present, valued using the creditors' stochastic discount factor. The departure
                                                                                               db2
of the optimal regulation from the first-best critically depends on the leakage elasticity d     1 and
                                                                                                            b
the unregulated distortion b   2 . As we show in the Online Appendix, in this application, consistent

with the empirical literature, we find that tighter regulation on the regulated sector (higher b    1)
                                                                        db 2
increases the activities carried out by the unregulated/shadow sector ( d  1 > 0), so leverage choices
                                                                                     b
are gross substitutes. Therefore, we expect the optimal second-best policy to be sub-Pigouvian.22
    Moreover, the presence of unregulated investors may exacerbate the welfare distortion b         1

associated with regulated investors. Concretely, when unregulated investors receive bailouts in
state s, the marginal utility of creditors increases in this state due to taxation. In Equation (26),
this increases the distortion associated with marginal increases in regulated investors' leverage. In
this sense, our results reconcile two common narratives. On the one hand, leakage to the shadow
banking system motivates sub-Pigouvian regulation. On the other hand, the optimal corrective
policy must also adjust to increases in overall leverage, which raise marginal distortions b     1 in

  22
     Note that one can also use this model to analyze quantity-based policies, such as capital requirements. For
instance, suppose that regulated investors are subject to a binding quantity regulation b1  ¯        b1 , where the
regulator chooses the upper bound ¯ b . In our model, a marginal change d¯
                                      1                                      1
                                                                            b is equivalent to the local tax reform
             -1                                                    -1
   1     db1     ¯1                                       db2  db1    db2
db =    d  1    db . The associated leakage elasticity is ¯1 =
                                                         db      1d     1 , and the optimal corrective regulation in
                                                                            d
          b                                                         b        b
Proposition 7 can be alternatively expressed as

                                                  1   1       db2 2
                                                  b = b +         b .
                                                              d¯
                                                               b1



                                                         28
general equilibrium.
    An instructive special case, which we use to solve the model numerically, is obtained by using
a linearly separable bailout policy: ti bi , s = 0i - i s + i bi , where i , i  0. In this case,
                                                        s    b           s    b
marginal distortions bi = 1+ i are invariant to policy, and the optimal corrective regulation is
                           Rf b
                                                                                 
                                                                      -1
                                    1   1+ 1      db1                      db2 2 
                                    b =     b
                                              - -   1                        1 b ,
                                         Rf       db                       db

               ´ C               -1
where Rf =        m (s) dF (s)      denotes the creditors' riskless discount rate.
    Figure 1 illustrates the comparison between the first-best and second-best policy when
simulating this model.23 To more clearly illustrate the insights that we present in this paper, in
Figure 1 we assume that both types of investors are ex-ante identical, and that the only difference
between the two is that investor 2 cannot be regulated. Given this symmetry assumption, it is
possible to represent the marginal value of varying the regulation b = b     1 =  2 for both investors,
                                                                                   b
which yields the first-best regulation when dWdb  = 0 .
    In contrast, the solid line in Figure 1 shows the marginal value of varying the regulation that
investor 1 faces (the traditional sector), when investor 2 (the shadow sector) is unregulated, that
is, when b 2 = 0. As implied by our theoretical results, since db2 > 0 and db1 < 0, we find that the
                                                                 db1          db1

optimal second-best policy is sub-Pigouvian, so the optimal second-best regulation that investor
1 faces is lower than the first-best regulation. In this particular simulation, the optimal first-best
regulation is b 1 =  2 = 4.88%, while the second-best regulation (when  2 = 0) is  1 = 4.39%.24
                    b                                                       b          b


4.2    Application 2: Scale-Invariant Regulation/Unregulated Activities
In practice, it is common for regulators to impose constraints on ratios of investors' liabilities to
risky assets, while leaving the overall scale of risky investment as a free, unregulated choice.25 In
this application, we characterize the form of the optimal scale-invariant policy in a model in which
regulation is motivated by belief distortions.
  23
     Figure OA-1 in the Online Appendix illustrates comparative statistics of different endogenous outcomes of the
model that are useful to better understand the form of the optimal second-best policy. Figures OA-2 through OA-4
in the Online Appendix do the same for the remaining applications.
  24
     Buchak, Matvos, Piskorski and Seru (2018a) and Irani, Iyer, Meisenzahl and Peydro (2021), among other recent
studies, directly quantify leakage elasticities between traditional and shadow banks. This work focuses on the elasticity
of substitution between the market share of regulated and unregulated investments. Due to space constraints, we
have held the scale of investment fixed in this application, but one could easily extend the framework to account for
both leverage and investment choices, in which case the measured elasticities of substitution in those papers become
directly relevant. In addition, our application highlights that the elasticity of substitution between regulated and
unregulated leverage is a key statistic for second-best regulation.
  25
     It is possible to justify this assumption, for example, because the private sector has superior information about
investment opportunities (e.g., Walther, 2015). Perhaps for this reason, many relevant regulatory constraints in
practice (e.g., capital requirements, leverage limits, liquidity coverage ratios, and net stable funding requirements
in Basel III) focus on ratios of financial institutions' assets to liabilities. Similarly, household finance regulations
are based on loan-to-value and debt-to-income ratios. All of these regulatory tools leave the scale of investment
unconstrained.




                                                           29
                         0.1




                           0




                         -0.1




                         -0.2




                         -0.3




                         -0.4


                                0     0.005   0.01   0.015   0.02   0.025   0.03   0.035   0.04   0.045   0.05




              Figure 2: Scale-Invariant Regulation/Unregulated Activities (Application 2)
Note: Figure 2 compares the marginal welfare effects of varying the corrective regulation in two different scenarios.
                                                             i
The green dashed line corresponds to a scenario in which k     is set at the first-best level. The solid blue line corresponds
                                       i                                 i
to a second-best scenario in which k = 0. Therefore, the value of b        that makes the first-best marginal welfare effect
                                                        i                                                         i
zero defines the first-best leverage regulation, since k is already set at the first-best level. The value of b     that makes
the second-best marginal welfare effect zero defines the second-best regulation. To generate this figure, we assume
                                                           2
that the adjustment cost is quadratic:  ki = a       2
                                                        ki . The parameters used to generate this figure are  i = 0.9,
 C = 0.95, i = 0.8, and a = 1. We assume that investors and creditors perceive s to be normally distributed
with mean 1.5 and standard deviation 0.4, and the planner perceives the mean to be 1.3 instead. For reference,
                                                   i                  i
the optimal first-best regulation is given by b      = 3.48% and k      = 18.5%, while the second-best regulation, when
                                         i
investment cannot be regulated, is b = 4.31%. Since leverage and investment decisions are gross complements in
this application, the optimal second-best policy is super-Pigouvian .


Environment We assume that there is a single type of investor, in unit measure and indexed by
i, and a unit measure of creditors, indexed by C . Both investors and creditors have risk-neutral
preferences, respectively given by
                              ^                            ^
                      i     i    i       i          C    C
                     c0 +       c1 (s) dF (s) and c0 +        cC       C
                                                               1 (s) dF (s) ,


where F i (s) and F C (s) respectively denote the beliefs (cumulative distribution functions) of
investors and creditors over the possible states.
    The budget constraints of investors at date 0 and date 1 are given by

                                       ci    i    i i i
                                        0 = n0 + Q b k -  k
                                                            i   i i
                                                              - b     i i
                                                                  b - k      i
                                                                        k + T0

                                    ci        i                i     i
                                     1 (s) = n1 (s) + max s - b , 0 k ,               s.

At date 0, investors, endowed with ni
                                    0 dollars, choose how much to invest and borrow. An investment


                                                                    30
of k i units of capital is associated with a cost of  k i dollars, where  k i is a convex adjustment
cost. Investors finance their investment by issuing bonds with face value bi and price Qi bi per
unit of investment, which is determined by creditors in equilibrium. Therefore, the total face value
of debt issued is bi k i , the total amount raised via borrowing at date 0 is Qi bi k i , and an investor's
leverage ratio is simply bi . Investors face corrective taxes b      i and  i per unit of leverage and
                                                                             k
investment, respectively. We allow for default, which is optimal for an investor whenever s - bi < 0.
After default, creditors receive a fraction i of the gross returns to investment. The remainder
1 - i measures the deadweight loss associated with default.
    Creditors' budget constraints are simply given by

                                    cC    C    i i i
                                     0 = n0 - h Q b k
                                                      i


                                 cC        C        i i
                                  1 (s) = n1 (s) + h P  bi , s k i ,   s,

where P i bi , s denotes the repayment received by creditors from investors in state s per unit of
investment, explicitly described in the Online Appendix. Creditors' and investors' endowments are
such that their consumption is never negative. Since creditors are risk-neutral, they simply value
investors' debt breaking even in expectation.
    We assume that the planner computes welfare using different probability assessments than
those used by investors and creditors to make decisions. This provides a corrective rationale for
intervention. As highlighted in Dávila and Walther (2020b) and Proposition 8 below, the rationale
for regulation is determined by the difference between private agents' and the planner's valuations
per unit of risky investment, which represent a levered version of Tobin's q . These valuations are,
respectively, given by
                               ^                              ^
                  M bi =  i max s - bi , 0 dF i (s) +  C P i bi , s dF C (s)
                               ^                               ^
                 M P bi =  i max s - bi , 0 dF P (s) +  C P i bi , s dF P (s) ,


where F P (s) denotes the probability distribution used by the planner to calculate welfare.

Equilibrium In this application, for given corrective taxes/subsidies b           i,  i and lump-sum
                                                                                     k
           i , an equilibrium is defined by an investment decision, k i , a leverage decision, bi , and a
transfers T0
default decision rule such that i) investors maximize their utility given Qi (·), and ii) creditors set
the schedule Qi (·) optimally, so that hi = 1.
                                                           i and  i freely. However, in practice it
    In the first-best scenario, the planner is able to set b        k
is common to impose regulation on ratios of assets to liabilities, leaving scale decisions -- here
investment -- unregulated. Formally, we are interested in scenarios in which the planner cannot
regulate investment, so
                                                 i
                                                k  = 0,
                                                i a second-best problem.
which makes the problem of choosing the optimal b

                                                    31
Optimal Corrective Policy/Simulation In Proposition 8, we characterize the form of the
optimal second-best policy, which we discuss along with a numerical simulation.

Proposition 8. [Scale-Invariant Regulation/Unregulated Activities]
                                                                                 i , is given by
a) The marginal welfare effect of varying the regulation of investors' leverage, b

                                     dW    dbi i    i   dk i i
                                       i =   i b -  b -    i k ,
                                     db    db           db

where the marginal distortions in this application are defined by

                                    i       dM bi   dM P bi
                                    b =           -                    ki
                                              dbi     dbi
                                    i
                                    k = M bi - M P bi .

b) The optimal corrective regulation satisfies

                                                           -1
                                      i   i          dbi        dk i i
                                      b = b - -        i           i k .
                                                     db         db

    Proposition 8 is the counterpart of Propositions 3 and 5, and it identifies the distortions
associated with leverage and investment the planner perceives. In this application, the welfare
distortion associated with leverage, b  i , is driven by the difference in marginal valuations, while

the distortion associated with investment, k    i , is driven by the difference in the level of valuations.

Dávila and Walther (2020b) provide a detailed discussion of these effects. In this application we
      dbi
have d  i < 0 and, critically, the leakage elasticity from leverage to investment is negative, that is,
       b
dki
dbi  < 0, implying that leverage and investment are gross complements. As implied by our results
in Section 3, the optimal second-best regulation on leverage is super-Pigouvian.
     Importantly, a comparison between this application with the previous one (shadow banking)
highlights that both leakage elasticities featuring substitutes and those featuring complements are
important in common regulatory scenarios. A number of recent empirical studies confirm that the
leakage elasticity from leverage to risky investments is negative, in the sense that banks with lower
capital ratios originate a larger volume of risky loans (e.g., Jiménez, Ongena, Peydró and Saurina,
2014; Dell'Ariccia, Laeven and Suarez, 2017; Acharya, Eisert, Eufinger and Hirsch, 2018).
     Figure 2 compares the marginal welfare effects of varying regulation in the first-best and second-
best scenarios when simulating this model. To illustrate the first-best solution for leverage, we fix
k i to its first-best value when showing the marginal welfare associated with varying  i . The second-
                                                                                         b
                                            i
best marginal welfare gain simply sets k = 0. As implied by our theoretical results, the optimal
second-best policy is super-Pigouvian, so it is optimal for the planner to overregulate leverage
relative to the first-best scenario. In this particular simulation, the optimal first-best regulation is
b i = 3.48% and  i = 18.5%, while the second-best regulation (when  i = 0) is  i = 4.31%.
                     k                                                    k          b




                                                    32
                         0.02


                         0.01


                           0


                        -0.01


                        -0.02


                        -0.03


                        -0.04


                        -0.05


                        -0.06


                        -0.07

                                0   0.005   0.01   0.015   0.02   0.025   0.03   0.035   0.04   0.045   0.05




              Figure 3: Asset Substitution/Uniform Activity Regulation (Application 3)
Note: Figure 3 compares the marginal welfare effects of varying the corrective regulation in two different scenarios.
The green dashed line and the light blue dotted line illustrate the first-best regulation. The green dashed line
                                          2
corresponds to a scenario in which k        is set at the first-best level, while the light blue dotted line corresponds to
                         1                                                            1       2
a scenario in which k is set at the first-best level. Therefore, the values of k        and k   that respectively make each
line zero define the first-best regulation. The solid dark blue line corresponds to a second-best scenario in which
       1     2
 k = k   = k   , so its zero defines the second-best regulation. To generate this figure, we assume that the adjustment
                                         i 2          i 2
cost is quadratic:  k1     i    i
                             , k2  = z2
                                      1
                                        k1     + z2
                                                  2
                                                    k2    . We also assume that d1 (s) = µ1 + 1 s and d2 (s) = µ2 + 2 s
when s is distributed as a standard normal. The parameters used to generate this figure are  i = 0.8,  C = 1,
 = 0.1, z1 = z2 = 1, bi = 1.4, µ1 = 1.5, µ2 = 1.3, 1 = 0.3, and 2 = 0.5. For reference, the optimal first-best
                           1                 2
regulation is given by k       = 2.27% and k   = 0.39%, while the second-best regulation, when the regulation is uniform,
is  k = 1.33%.


4.3     Application 3: Asset Substitution/Uniform Activity Regulation
A common concern in financial regulation is that corrective policy instruments are somewhat coarse
in practice. For example, when imposing capital requirements on banks, financial regulators tend
to set risk weights for wide classes of risky investments (e.g., mortgage loans), but within the
class, banks can freely optimize their portfolios (e.g., among loans to borrowers with different
credit scores) without any change in the associated capital charge. In our model, this situation
corresponds to a uniform regulation across different capital investments. In this application, we
consider uniform corrective policy in a model where investors enjoy government guarantees. We
demonstrate that uniform regulation leads to a classical asset substitution problem (e.g., Jensen
and Meckling, 1976), and characterize the optimal second-best policy.

Environment We assume that there is a single type of investor, in unit measure and indexed by
i, and a unit measure of creditors, indexed by C . Both investors and creditors have risk-neutral


                                                                  33
preferences, respectively given by
                               ^                                                ^
                       i     i
                      c0 +       ci
                                  1 (s) dF (s)              and    cC
                                                                    0   +   C
                                                                                    cC
                                                                                     1 (s) dF (s) .


The budget constraints of investors at date 0 and date 1 are respectively given by

                           ci    i     i    i   1 i    2 i     i
                            0 = n0 -  k1 , k2 - k k1 - k k2 + T0

                       ci                   i           i      i    i i          i
                        1 (s) = max d1 (s) k1 + d2 (s) k2 + t k1 , k2 , b , s - b , 0 ,               s.

    At date 0, investors, endowed with ni   0 dollars, choose the scale of two risky capital investments
  i           i
k1 and k2 , which are subject to an adjustment cost of  k1       i , k i . Hence, investors make |X | = 2
                                                                      2
free choices regarding their balance-sheet.
    At date 1, investors earn the realized returns on capital investments k1    i and k i , which are given
                                                                                        2
by d1 (s) and d2 (s) respectively and are increasing in s. In addition, they receive a bailout transfer
t k1i , k i , bi , s from the government. We further assume that investors have legacy debt (i.e., debt
         2
issued before the start of the model) with face value bi . Hence, investors owe a predetermined
repayment of bi to creditors at date 1. We make this simplifying assumption in order to sharpen
our focus on asset substitution, which describes investors' choice between different risky investments,
as opposed to leverage choices. At date 1, investors consume the difference between i) the cash
flow from investments augmented by the bailout transfer and ii) the debt owed, if this difference is
positive. Otherwise, they default and consume zero.
    For simplicity, we focus on a particular form of bailout that fully prevents default -- this may
correspond to an investor that is "too big to fail". Concretely, we assume that the government
bailout is equal to the minimum amount required to avoid default

                                   i    i i
                                t k1 , k2 , b , s = max bi - d1 (s) k1
                                                                     i           i
                                                                       - d2 (s) k2 ,0 .                                 (27)

Given this form of bailout policy, creditors are guaranteed a repayment of bi at date 1. We write
s k1i , k i for the threshold state below which bailouts are positive.26
         2
   Hence, the budget constraints of creditors at date 0 and date 1 are respectively given by

                                     cC    C
                                      0 = n0

                                 cC        C        i            i    i i
                                  1 (s) = n1 (s) + b - (1 + ) t k1 , k2 , b , s , s.


Even though creditors are always repaid bi in every state, we assume that in order to finance
the bailout, the government imposes a tax of (1 + ) per dollar of bailout on creditors, where
 > 0 measures the deadweight fiscal cost of bailout transfers. The rationale for regulation in this
environment is a classical "moral hazard" argument. Investors, whose debt is implicitly guaranteed
by the government, do not internalize the impact of their risky capital investments on fiscal costs,
  26
       Formally, for a fixed value bi of legacy debt, this threshold is the unique solution to bi - d1 (s) k1
                                                                                                            i           i
                                                                                                              - d2 (s) k2 = 0.



                                                              34
which ultimately reduces the consumption of creditors.

Equilibrium In this application, for given corrective taxes/subsidies k              1 ,  2 , lump-sum transfers
                                                                                         k
T0i =  1 k i +  2 k i , bailout policy t k i , k i , bi , s , and legacy debt bi , an equilibrium is defined by
       k 1     k 2                        1 2
investment decisions such that investors maximize their utility. In the first-best scenario, the
planner is able to set k     1 and  2 freely. However, we are interested in a scenario in which the
                                     k
planner is unable to treat investments differentially for regulation purposes. Thus, the planner
chooses k 1  0 and  2  0 subject to the uniform regulation constraint:
                         k

                                                       1   2
                                                   k = k = k .

Optimal Corrective Policy/Simulation In Proposition 9 we characterize the form of the
second-best policy, which we discuss along with a numerical simulation.

Proposition 9. [Asset Substitution/Uniform Activity Regulation]
a) The marginal welfare effect of varying the uniform corrective regulation of capital investments,
 k = k1 =  2 , is given by
          k
                              dW      dk i           dk i
                                   = 1 ( k - 1 ) + 2 ( k - 2 ) ,
                              d k     d k            d k
where the marginal distortions in this application are defined by
                                                        ^          i ,k i
                                                                 (k1
                                                             s         2)
                                                   C
                                   j = (1 + )                               dj (s) dF (s) .
                                                         s


b) The optimal corrective regulation satisfies
                                                    i
                                                  dk1                         i
                                                                            dk2
                                                  d k                       d k
                                      k =     i
                                            dk1           i 1
                                                        dk2
                                                                  +     i
                                                                      dk1           i 2 .
                                                                                  dk2
                                            d k   +     d k           d k    +    d k

    Proposition 9 identifies the distortions associated with the different types of investment
decisions in this application. The shape of the distortions j highlights the nature of the asset
substitution problem: investors' private incentives are driven by the returns to investment in
"upside" states s  s k1   i , k i , while the planner's concern about bailouts focuses on "downside"
                               2
                 i  i
states s < s k1 , k2 . The optimal uniform regulation is a weighted average of the downside
distortions imposed by both types of capital. As implied by our general results in Section 3, the
appropriate weight assigned by the planner to each of the distortions in the optimal second-best
                                                                                                        i
                                                                                                      dk1
                                                                                                     d k
policy is given by how sensitive each capital decision is to changes in the regulation,           dki     dki
                                                                                                                and
                                                                                                    1+      2
                                                                                                  d k    d k
      i
    dk2
   d k
dki     dki
              . Figure 3 illustrates this intuition by comparing the marginal welfare effects of varying
  1+      2
d k    d k
regulation in the first-best and second-best scenarios.



                                                             35
      In the Online Appendix, assuming that investment costs are quadratic, we provide further
                                     i
                                   dk1       i
                                           dk2
intuition on how the weights d k       and d k are determined. We show that the sufficient statistics for
the optimal weights are i) the sensitivity of the probability of receiving a bailout to the uniform
regulation, and ii) the marginal contribution dn (s ) of each asset class at the bailout boundary.
                           d2 (s )
Intuitively, a large ratio d 1 (s )
                                    means that changes in the default boundary affect mostly returns to
k2i , which makes investors' optimal investment in k i more sensitive to the uniform regulation.
                                                        2


4.4    Application 4:          Heterogeneous Fire-Sale Externalities/Uniform Investor
       Regulation
Pecuniary externalities coupled with incomplete markets and/or collateral constraints provide
a well-studied rationale for corrective financial regulation. The natural notion of efficiency in
those environments, constrained efficiency, typically requires individual-specific regulations. In this
application, we study the form of the second-best policy in an environment in which it would be
optimal to set investor-specific regulations, but the planner is constrained to set the same corrective
regulation for all investors.

Environment We assume that there are two types of investors/entrepreneurs, indexed by
i  {1, 2}, and households, indexed by H -- who in a richer model would also play the role of
creditors. There are three dates, t  {0, 1, 2} and no uncertainty.27 Investors, who for simplicity
do not discount the future, have preferences of the form:

                                               ui = ci    i    i
                                                     0 + c1 + c2 ,


subject to non-negativity constraints, ci      i      i
                                        0  0, c1  0, c2  0, where their budget constraints are
given by

                                        ci    i   i i   i i     i
                                         0 = n0 -  k0 - k k0 + T0

                                        ci      i    i   i i
                                         1 = q k0 - k1 -  k0

                                        ci    i i
                                         2 = z k1 .


At date 0, an investor i endowed with ni                                                        i
                                                  0 dollars chooses how much to produce, k0 , given a
technology i k0   i . Investor i also faces a corrective tax  i per unit invested at date 0. At date 1,
                                                                k
an investor i faces a reinvestment need  i > 0 per unit of invested capital at date 0, which needs
to be satisfied by selling k0i - k i units of capital at a market price q -- this is a simple way to
                                   1
generate a fire-sale. At the final date, whatever capital is left yields an output z i k1
                                                                                        i . For simplicity,

we assume that, in equilibrium, T0   i =  i k i , i.
                                          k 0
    Households, who exclusively consume at date 1, have access to a decreasing returns to scale
technology to transform capital into output at date 1. Formally, the utility of households is given
   27
      It is well known that for pecuniary externalities to matter there must be more than one trading stage. The two
final dates in this application can be mapped to the second date in Section 2.


                                                        36
                         0.07


                         0.06


                         0.05


                         0.04


                         0.03


                         0.02


                         0.01


                           0


                        -0.01



                                0   0.005   0.01    0.015   0.02   0.025   0.03   0.035   0.04   0.045   0.05




   Figure 4: Heterogeneous Fire-Sale Externalities/Uniform Investor Regulation (Application 4)
Note: Figure 4 compares the marginal welfare effects of varying the corrective regulation in two different scenarios.
The green dashed line and the light blue dotted line illustrate the first-best regulation. The green dashed line
                                          2
corresponds to a scenario in which k        is set at the first-best level, while the light blue dotted line corresponds to
                          1                                                               1       2
a scenario in which k is set at the first-best level. Therefore, the values of k            and k   that respectively make
each line zero define the first-best regulation. The solid dark blue line corresponds to a second-best scenario in
        1       2
which k   = k      =  k , so its zero defines the second-best regulation. To generate this figure, we assume that the
                                                               i   i 2
adjustment cost of investment is quadratic: i k0       i
                                                          = a 2
                                                                 k0    , and that the technology of households is isoelastic:
               H 
     H     ( k   )
F k1    = 1    
                    . The parameters used to generate this figure are  = 0.5, a1 = a2 = 1, z 1 = z 2 = 1.5,  1 = 0.3,
      2                                                                             1                 2
and  = 0.4. For reference, the optimal first-best regulation is given by k             = 3.43% and k    = 4.57%, while the
second-best regulation, when the regulation is uniform, is  k = 3.99%.


by
                                                   uH = cH      H
                                                         1 = F k1
                                                                      H
                                                                  - qk1 ,
                                                    H denotes the amount of capital purchased
where F (·) is a well-behaved concave function and k1
by households at date 1. The solution to the households' problem will define a downward sloping
demand curve for sold capital at date 1.

Equilibrium In this application, for given corrective taxes/subsidies k         1 ,  2 and lump-sum
                                                                                    k
              1   2       1   1   2 2
transfers T0 , T0 = k k0 , k k0 , an equilibrium is fully determined by investors/entrepreneurs'
investment decisions k0   i , k i at dates 0 and 1, households' capital allocation k H at date 1, and
                               1                                                      1
an equilibrium price q , such that investors' and households' utilities are maximized, subject to
constraints, and the capital market clears, that is, i k0    i - ki = kH .
                                                                  1    1
                                                           1 and  2 freely. However, we are interested
    In the first-best scenario, the planner is able to set k        k




                                                                   37
in scenarios in which the planner must regulate both investors equally, so

                                                      1   2
                                                  k = k = k ,

which makes the problem of choosing the optimal  k a second-best problem.
   In Section C of the Online Appendix, we provide a detailed characterization of the equilibrium.
At date 1, the non-negativity constraint of investors' consumption will necessarily bind, so the
                                                                                i - k i =  i k i . The
amount sold by investor i at date 1 will be proportional to date 0 investment: k0    1    q 0
                                                    H . When combined with market clearing and
households' optimality condition is given by q = F k1
with the characterization of optimal investment at date 0 that we present in the Online Appendix,
we show that the equilibrium price can be characterized in terms of primitives as the solution to
                                                                                       -1
                                            i          i      i            i
                                                                                       
                               q=                  z       1-         -    k                ,
                                       i
                                            ai                q

                                                                                  ai        2
where we have assumed quadratic adjustment costs i k0
                                                    i =
                                                                                  2
                                                                                        i
                                                                                       k0       and the isoelastic production
                    H 
            H = (k1 ) .
function F k1       


Optimal Corrective Policy/Simulation In Proposition 10 we characterize the form of the
second-best policy, which we discuss along with a numerical simulation.

Proposition 10. [Fire-Sale Externalities/Uniform Investor Regulation]
a) The marginal welfare effect of varying the uniform corrective regulation of investments,  k =
k1 =  2 , is given by
     k
                             dW     dk 1             dk 2
                                  = 0  k - k   1
                                                  + 0  k - k    2
                                                                   ,
                             d k    d k              d k
where
                                                   2
                                 i     q                   z
                                 k   =- i                    -1            k0 - k1 .
                                       k0          =1
                                                           q

b) The optimal corrective regulation satisfies
                                                   1
                                                 dk0                        2
                                                                          dk0
                                                 d k       1              d k       2
                                  k =        1
                                           dk0           2 k
                                                       dk0
                                                                +     1
                                                                    dk0           2 k .
                                                                                dk0
                                           d k   +     d k          d k   +     d k

    Proposition 10 identifies the distortions associated with the investment choices of
investors/entrepreneurs. In this application, the distortion is generated by a distributive pecuniary
externality, using the terminology of Dávila and Korinek (2018). Consistent with the results in that
                                                                                    q
paper, this type of externality is determined by price sensitivities, in this case k  i ; differences in
                                                                                                            0

marginal valuations, in this case zq - 1; and net trade positions, in this case k0 - k1 . Note that k
                                                                                                    i

includes the sum of the latter two terms across both types of investors, since a given investor does
not internalize how his individual investment decision affects prices and consequently the welfare


                                                           38
of other investors of the same and different types.
    As implied once again by our general results in Section 3, the appropriate weight assigned by
the planner to each of the distortions in the optimal second-best policy is given by how sensitive
each capital decision is to changes in the regulation. Figure 4 illustrates this intuition by comparing
the marginal welfare effects of varying regulation in the first-best and second-best scenarios. By
comparing Application 3 with Application 4, it becomes evident that the principles that guide the
second-best regulation when it is forced to be uniform across choices for a given agent or across
agents for a given choice are identical.


5    Conclusion
This paper provides a systematic study of optimal corrective regulation with imperfect instruments.
We have shown that leakage elasticities and Pigouvian wedges are sufficient statistics to account for
the marginal welfare impact of imperfect regulatory policies in a large class of environments. The
same statistics can also serve to characterize the social value of relaxing regulatory constraints. We
have characterized the optimal regulatory policy with unregulated investors, unregulated activities,
and with uniform regulation across heterogeneous investors and activities.
    A central insight is that leakage elasticities from perfectly regulated to imperfectly regulated
activities play a crucial role in determining second-best policy. In particular, we show that
the optimal second-best policy depends crucially on whether perfectly and imperfectly regulated
decisions are gross substitutes or gross complements. Our work provides concrete examples of the
relevant elasticities, with the hope that they guide future measurement efforts. We have leveraged
the general methodology to highlight the common fundamental economic principles in a number
of practical scenarios, such as shadow banking, scale-invariant regulation, asset substitution, and
fire-sale externalities with heterogeneous investors.




                                                  39
References
Acharya, Viral V, Philipp Schnabl, and Gustavo Suarez. 2013. "Securitization without Risk Transfer."
  Journal of Financial Economics, 107(3): 515­536.
Acharya, Viral V, Tim Eisert, Christian Eufinger, and Christian Hirsch. 2018. "Real Effects of
  the Sovereign Debt Crisis in Europe: Evidence from Syndicated Loans." The Review of Financial Studies,
  31(8): 2855­2896.
Adrian, Tobias, and Adam B Ashcraft. 2016. "Shadow Banking: A Review of the Literature." In
  Banking Crises. , ed. Garett Jones, 282­315. Springer.
Aguiar, Mark, and Manuel Amador. 2013. "Sovereign debt." Handbook of International Economics, 4.
Balcer, Yves. 1980. "Taxation of Externalities: Direct versus Indirect." Journal of Public Economics,
  13(1): 121­129.
Baumol, William J. 1972. "On Taxation and the Control of Externalities." American Economic Review,
  62(3): 307­322.
Begenau, Juliane, and Tim Landvoigt. 2021. "Financial Regulation in a Quantitative Model of the
  Modern Banking System." Review of Economic Studies (Forthcoming).
Bengui, Julien, and Javier Bianchi. 2018. "Macroprudential Policy with Leakages." NBER Working
  Paper.
Bianchi, Javier. 2011. "Overborrowing and Systemic Externalities in the Business Cycle." American
  Economic Review, 101(7): 3400­3426.
Bianchi, Javier. 2016. "Efficient Bailouts?" American Economic Review, 106(12): 3607­3659.
Bovenberg, A Lans, and Lawrence H Goulder. 2002. "Environmental Taxation and Regulation."
  Handbook of Public Economics, 3: 1471­1545.
Buchak, Greg, Gregor Matvos, Tomasz Piskorski, and Amit Seru. 2018a. "Beyond the Balance
  Sheet Model of Banking: Implications for Bank Regulation and Monetary Policy." NBER Working Paper.
Buchak, Greg, Gregor Matvos, Tomasz Piskorski, and Amit Seru. 2018b. "Fintech, Regulatory
  Arbitrage, and the Rise of Shadow Banks." Journal of Financial Economics, 130(3): 453­483.
Cai, Jinghan, Jibao He, Wenxi Jiang, and Wei Xiong. 2020. "The Whack-a-Mole Game: Tobin Taxes
  and Trading Frenzy." The Review of Financial Studies, Forthcoming.
Chari, VV, and Patrick J Kehoe. 2016. "Bailouts, Time Inconsistency, and Optimal Regulation: A
  Macroeconomic View." American Economic Review, 106(9): 2458­2493.
Claessens, Stijn, Zoltan Pozsar, Lev Ratnovski, and Manmohan Singh. 2012. "Shadow Banking:
  Economics and Policy." IMF Staff Discussion Note.
Clayton, Cristopher, and Andreas Schaab. 2021. "Shadow Banks and Optimal Regulation." Working
  Paper.
Corbae, Dean, and Pablo D'Erasmo. 2010. "A Quantitative Model of Banking Industry Dynamics."
  Working Paper.
Corbae, Dean, and Ross Levine. 2018. "Competition, Stability, and Efficiency in Financial Markets."
  Jackson Hole Symposium: Changing Market Structure and Implications for Monetary Policy, Kansas City
  Federal Reserve.
Corbae, Dean, and Ross Levine. 2019. "Competition, Stability, and Efficiency in the Banking Industry."
  Working Paper.
Cordella, T., G. Dell'Ariccia, and R. Marquez. 2018. "Government Guarantees, Transparency, and
  Bank Risk Taking." IMF Economic Review, 66: 116­143.




                                                  40
Cremer, Helmuth, Firouz Gahvari, and Norbert Ladoux. 1998. "Externalities and Optimal
  Taxation." Journal of Public Economics, 70(3): 343­364.
Dávila, Eduardo. 2014. "Optimal Financial Transaction Taxes." Working Paper.
Dávila, Eduardo. 2020. "Using Elasticities to Derive Optimal Bankruptcy Exemptions." Review of
  Economic Studies, 87(2): 870­913.
Dávila, Eduardo, and Ansgar Walther. 2020a. "Does Size Matter? Bailouts with Large and Small
  Banks." Journal of Financial Economics, 136(1): 1­22.
Dávila, Eduardo, and Ansgar Walther. 2020b. "Prudential Policy with Distorted Beliefs." Working
  Paper.
Dávila, Eduardo, and Anton Korinek. 2018. "Pecuniary Externalities in Economies with Financial
  Frictions." Review of Economic Studies, 85(1): 352­395.
Dávila, Eduardo, and Itay Goldstein. 2018. "Optimal Deposit Insurance." Working Paper.
Dell'Ariccia, Giovanni, Luc Laeven, and Gustavo A Suarez. 2017. "Bank Leverage and Monetary
  Policy's Risk-Taking Channel: Evidence from the United States." The Journal of Finance, 72(2): 613­654.
Dempsey, Kyle. 2020. "Macroprudential Capital Requirements with Non-Bank Finance." ECB Working
  Paper.
Demyanyk, Yuliya, and Elena Loutskina. 2016. "Mortgage Companies and Regulatory Arbitrage."
  Journal of Financial Economics, 122(2): 328­351.
Diamond, Peter A. 1973. "Consumption Externalities and Imperfect Corrective Pricing." The Bell Journal
  of Economics and Management Science, 4(2): 526­538.
Dovis, Alessandro, and Rishabh Kirpalani. 2020. "Fiscal Rules, Bailouts, and Reputation in Federal
  Governments." American Economic Review, 110(3): 860­888.
Dubey, P., J. Geanakoplos, and M. Shubik. 2005. "Default and Punishment in General Equilibrium."
  Econometrica, 73(1): 1­37.
Farhi, Emmanuel, and Iván Werning. 2016. "A Theory of Macroprudential Policies in the Presence of
  Nominal Rigidities." Econometrica, 84(5): 1645­1704.
Farhi, Emmanuel, and Jean Tirole. 2012. "Collective Moral Hazard, Maturity Mismatch, and Systemic
  Bailouts." American Economic Review, 102(1): 60­93.
Farhi, Emmanuel, and Jean Tirole. 2017. "Shadow Banking and the Four Pillars of Traditional Financial
  Intermediation." NBER Working Paper.
Farhi, Emmanuel, Mikhail Golosov, and Aleh Tsyvinski. 2009. "A Theory of Liquidity and Regulation
  of Financial Intermediation." Review of Economic Studies, 76(3): 973­992.
Gennaioli, Nicola, Andrei Shleifer, and Robert W Vishny. 2013. "A Model of Shadow Banking."
  The Journal of Finance, 68(4): 1331­1363.
Gorton, Gary, Andrew Metrick, Andrei Shleifer, and Daniel K Tarullo. 2010. "Regulating the
  Shadow Banking System." Brookings Papers on Economic Activity, 261­312.
Gourinchas, Pierre Olivier, and Philippe Martin. 2017. "Economics of Sovereign Debt, Bailouts and
  the Eurozone Crisis." Working Paper.
Green, Jerry, and Eytan Sheshinski. 1976. "Direct versus Indirect Remedies for Externalities." Journal
  of Political Economy, 84(4, Part 1): 797­808.
Grochulski, Borys, and Yuzhe Zhang. 2019. "Optimal Liquidity Regulation with Shadow Banking."
  Economic Theory, 68(4): 967­1015.
Hachem, Kinda. 2018. "Shadow Banking in China." Annual Review of Financial Economics, 10(1): 287­
  308.




                                                   41
Hachem, Kinda, and Zheng Michael Song. 2017. "Liquidity Rules and Credit Booms." Journal of
  Political Economy (Forthcoming).
Hendren, Nathaniel. 2016. "The Policy Elasticity." Tax Policy and the Economy, 30(1): 51­89.
Huang, Ji. 2018. "Banking and Shadow Banking." Journal of Economic Theory, 178: 124­152.
Irani, Rustom M, Rajkamal Iyer, Ralf R Meisenzahl, and Jose-Luis Peydro. 2021. "The Rise of
  Shadow Banking: Evidence from Capital Regulation." The Review of Financial Studies, 34(5).
Jensen, Michael C, and William H Meckling. 1976. "Theory of the Firm: Managerial Behavior, Agency
  Costs and Ownership Structure." Journal of Financial Economics, 3(4): 305­360.
Jiménez, Gabriel, Steven Ongena, José-Luis Peydró, and Jesús Saurina. 2014. "Hazardous Times
  for Monetary Policy: What do Twenty-Three Million Bank Loans Say about the Effects of Monetary
  Policy on Credit Risk-Taking?" Econometrica, 82(2): 463­505.
Keister, Todd. 2016. "Bailouts and Financial Fragility." The Review of Economic Studies, 83(2): 704­736.
Korinek, Anton. 2017. "Currency Wars or Efficient Spillovers? A General Theory of International Policy
  Cooperation." NBER Working Paper.
Lipsey, Richard G, and Kelvin Lancaster. 1956. "The General Theory of Second Best." Review of
  Economic Studies, 24(1): 11­32.
Livshits, Igor. 2015. "Recent Developments in Consumer Credit and Default Literature." Journal of
  Economic Surveys, 29(4): 594­613.
Lorenzoni, Guido. 2008. "Inefficient Credit Booms." Review of Economic Studies, 75(3): 809­833.
Martinez-Miera, David, and Rafael Repullo. 2019. "Markets, Banks, and Shadow Banks." ECB
  Working Paper.
Mas-Colell, Andreu, Michael D. Whinston, and Jerry R. Green. 1995. Microeconomic Theory.
  Oxford University Press.
Matvos, Gregor. 2013. "Estimating the Benefits of Contractual Completeness." The Review of Financial
  Studies, 26(11): 2798­2844.
Milgrom, Paul, and John Roberts. 1996. "The LeChatelier Principle." American Economic Review,
  58(2): 173­179.
Moreira, Alan, and Alexi Savov. 2017. "The Macroeconomics of Shadow Banking." The Journal of
  Finance, 72(6): 2381­2432.
Ordoñez,      Guillermo. 2018. "Sustainable Shadow Banking." American Economic Journal:
  Macroeconomics, 10(1): 33­56.
Pigou, Arthur Cecil. 1920. The Economics of Welfare. London, Macmillan and Co.
Plantin, Guillaume. 2015. "Shadow Banking and Bank Capital Regulation." The Review of Financial
  Studies, 28(1): 146­175.
Pozsar, Zoltan, Tobias Adrian, Adam Ashcraft, and Hayley Boesky. 2010. "Shadow Banking." New
  York Fed Staff Report No. 458.
Rothschild, Casey, and Florian Scheuer. 2014. "A Theory of Income Taxation under Multidimensional
  Skill Heterogeneity." NBER Working Paper.
Rothschild, Casey, and Florian Scheuer. 2016. "Optimal Taxation with Rent-Seeking." Review of
  Economic Studies, 83(3): 1225­1262.
Saez, Emmanuel, and Stefanie Stantcheva. 2016. "Generalized Social Marginal Welfare Weights for
  Optimal Tax Theory." American Economic Review, 106(1): 24­45.
Salanié, Bernard. 2011. The Economics of Taxation. The MIT Press.
Samuelson, Paul Anthony. 1948. Foundations of Economic Analysis. Harvard University Press.




                                                  42
Sandmo, Agnar. 1975. "Optimal Taxation in the Presence of Externalities." The Swedish Journal of
  Economics, 77(1): 86­98.
Sraer, David, and David Thesmar. 2018. "A Sufficient Statistics Approach for Aggregating Firm-Level
  Experiments." NBER Working Paper.
Stein, Jeremy C. 2012. "Monetary Policy as Financial Stability Regulation." The Quarterly Journal of
  Economics, 127(1): 57­95.
Sunderam, Adi. 2015. "Money Creation and the Shadow Banking System." The Review of Financial
  Studies, 28(4): 939­977.
Tinbergen, Jan. 1952. On the Theory of Economic Policy. North-Holland Publishing Company,
  Amsterdam.
Van den Heuvel, Skander. 2018. "The Welfare Effects of Bank Liquidity and Capital Requirements."
  Working Paper, Federal Reserve Board.
Walther, Ansgar. 2015. "Jointly Optimal Regulation of Bank Capital and Liquidity." Journal of Money,
  Credit and Banking, 48(2-3): 415­448.
Werning, Ivan. 2012. "Lecture Notes on Corrective Taxation." Unpublished.
Wijkander, Hans. 1985. "Correcting Externalities through Taxes on/Subsidies to Related Goods." Journal
  of Public Economics, 28(1): 111­125.
Xiao, Kairong. 2020. "Monetary Transmission Through Shadow Banks." The Review of Financial Studies,
  33(6): 2379­2420.




                                                 43
A      Proofs and derivations: Section 2
Investors' problem: The problem solved by investor i in Lagrangian form is

                                                                   max         Li ,
                                                             0 ,{c1 (s)},x
                                                            ci    i        i




where Li is given by

                              Li = ui ci    i
                                       0 , c1 (s)             sS
                                                                      , xj         j I

                                 -    i
                                      0    ci
                                            0   -   ni
                                                     0   -Q x  i      i                       i
                                                                          + i xi +  i · xi - T0
                                      ^
                                 -        i      i        i          i
                                          1 (s) c1 (s) - n1 (s) - i x , s                      dF (s) ,

where i        i
        0 and 1 (s) denote the Lagrange multipliers that correspond to investor i's budget constraints.
                                                                                                       28
                                                          i                        i
                                                       u                        u
The consumption optimality conditions imply that i               i
                                                   0 = ci and 1 (s) dF (s) = ci (s) . The balance-sheet
                                                         0                       1
optimality conditions for investor i are given by
                                                                               ^
                             Qi xi    i xi                                                  i xi , s
                  - i
                    0    -         +       + i                            +         i
                                                                                    1 (s)            dF (s) = 0, i,                   (28)
                               xi      xi                                                     xi

                                                                                                                  i
                                                                                                                  1 (s) 29
where Equation (28) corresponds to Equation (10) in the text, and where mi (s) =                                  i
                                                                                                                       .     Formally, the
                                                                                                                    0
                Qi (xi )  i (xi )
|X | × 1 vectors  xi ,  xi , and  i are given by:

                                 Qi                                        i
                                                                                   
                                                                                                                  
                                 bi                                       bi                                i
                                  1                                        1                              b,  1
                          
                                  .
                                  .       
                                                         
                                                                          .
                                                                          .
                                                                                   
                                                                                                            .     
                                  .                                       .                                 .
                                                                                                            .     
                                      i
                                                                       i
                                                                                                                  
                                Q
                                                                                                          i
                     Qi                               i
                                                                                                                  
                                bi
                                 |B|      ,
                                                                      bi
                                                                       |B|         ,
                                                                                             i
                                                                                                          b,|B|   
                       i
                         =       Qi                   i
                                                        =                  i
                                                                                         and  =  i
                                                                                                                  .
                     x    
                                  i
                                                     x   
                                                                           i
                                                                          k1
                                                                                   
                                                                                                 k,1
                                                                                                                  
                                 k1                                                
                                                                                                 .
                                                                                                                  
                                  .                                       .
                                                                                                                  
                                  .                                       .                      .
                                                                                                 .
                                                                                                                  
                                  .                                       .                                       
                                                                       i                         i
                                                                                   
                                Qi                                                               k,
                                 i                                     i
                                                                      k|K|                          |K|
                                k|K|


                                                ´           i (xi ,s)
Similarly, we define the |X | × 1 vector            i
                                                    1 (s)     xi      dF           (s) as follows:
                                                      ´                                                   
                                                        i     i (xi ,s)
                                                      1 (s) bi      1
                                                                           dF                         (s) 
                                                                 .
                                                                 .
                                                                                                          
                                                                 .                                        
                                                      ´
                                                                                                          
                          ^                                      ( xi ,s)
                                                               i
                                                                                                          
                                      i               i (s)                dF                         (s) 
                                  i x   , s             1     bi
                            i
                                                                   |B|
                                                                                                          
                            1 (s)           dF (s) =  ´              i
                                                                                                          .
                                    x i              
                                                      i
                                                               i ( x   ,s)                                
                                                        1 (s)   k1  i      dF                         (s) 
                                                                 .
                                                                 .
                                                                                                          
                                                                 .                                        
                                                      ´
                                                                                                          
                                                               i ( xi ,s)                                 
                                                        i
                                                        1 (s) ki           dF                         (s)
                                                                                              |K|
  28
    Without loss of generality, we define the state s multipliers                   i
                                                                   (s) inside the expectation.
                                                                                    1
  29
    Note that a sufficient regularity condition for the second term of Equation (28) to be valid is that i xi , s is
                                                                        ´ i
continuous. Otherwise, all results follow when the second term is   xi
                                                                          1 (s) i xi , s dF (s) .



                                                                      44
Creditors' problem: The problem solved by creditors in Lagrangian form is

                                                            max           LC ,
                                                      0 ,{c1 (s)},{hi }
                                                     cC    C        C




where LC is given by


                  LC = uC cC    C
                           0 , c1 (s)          sS
                                                     , xj   j I
                                                                      - C
                                                                        0       cC    C
                                                                                 0 - n0 +            hC  i
                                                                                                      i Q x
                                                                                                            i

                                                                                              iI
                           ^
                       -       C      C        C
                               1 (s) c1 (s) - n1 (s) -                hC C  i
                                                                       i i x , s          dF (s) ,
                                                                iI


where C       C
       0 and 1 (s) denote the Lagrange multipliers that correspond to the creditors' budget constraints.
                                                       uC                         uC
The consumption optimality conditions imply that C               C
                                                  0 = cC and 1 (s) dF (s) = cC (s) . The optimality
                                                                            0                                 1
conditions for creditors regarding hC
                                    i          are
                                                     ^
                                 -C
                                  0Q
                                    i
                                         x i
                                                 +       C     C  i
                                                         1 (s) i x , s dF (s) = 0, i,                                    (29)


where we use the fact that xi = xi in equilibrium. Equation (29), which exactly corresponds to Equation
                                        C (s)
(9) in the text once we define mC (s) = 1C
                                              , characterizes the financing schedules Qi xi that investors
                                          0
face.


B     Proofs and derivations: Section 3
Proof of Proposition 1 [Marginal Welfare Effects of Corrective Regulation: Policy
Elasticities and Pigouvian Wedges]:
                                                                 dV i           dV C
                                                                 d j            d j
Proof. We initially characterize the |X | × 1 vectors             j
                                                                        and      C
                                                                                       , which correspond to the money-metric
                                                                   0              0

welfare changes of type i investors and creditors when  j changes. In vector form, these are given by

                                                                                                      dV C
                                                                                                              
                                          dV i
                                            j                                                            j
                                          d                                                           d
                                            1                                                            1
                                           i                                                           C
                                                                                                              
                      i  dV i               0                               C  dV C                     0     
                    dVm  d j
                                             .
                                             .
                                                                          dVm   d j
                                                                                                          .
                                                                                                          .
                                                                                                              
                                                                                                              .
                      j
                        = i =                .                  and         j
                                                                              = C =                       .
                    d     0   
                                          dV i
                                                     
                                                                          d     0   
                                                                                                      dV C    
                                                                                                              
                                           j                                                            j     
                                         d                                                            d
                                           |X |                                                        |X |
                                           i0                                                          C0


Investors. We express the financing schedules faced by investors as a function of the stochastic discount
factor of creditors mC (s), which is in turn in equilibrium a function of the consumption of creditors in
all dates and states. This allows us to separately account for any general equilibrium pecuniary effects.
Formally, we represent the equilibrium financing schedules in Equation (9) for an investor i as follows:
                                                            ^
                                   Qi xi ; mC (s) =             mC (s) C  i
                                                                       i x , s dF (s) ,


where we make explicit the dependence on mC (s). The money-metric change in indirect utility for investor




                                                                 45
i when varying the regulation that investor j faces is given by the following |X | × 1 vector:

                                                                                =0
                                         =0
                                                                       ui
                                                                                                 
                                                       ^
                                 
                                    ui
                                                                       ci (s)
                dV i
                           dci            -   i            dci
                                                                        1
                                                                                -    i   (s) 
                d j          0      ci        0              1 (s)     dF (s)        1
                                     0
                                                                   
                       =                           +                                          dF (s)
                i 0        d j           i
                                         0                  d j                 i
                                                                                0
                                                                                             

                                                                           =0
                                                                                      ^
                           dxi      Qi xi ; mC (s)    i xi                                            i xi , s
                       +                           -       - i +                            mi (s)             dF (s)
                           d j           xi            xi                                               xi
                             i
                           dT0   d i i Qi xi ; mC (s) dmC (s)                                      dx 1 ui
                       +       -     x +                      +                                            ,
                           d j   d j     mC (s)        d j                                         d j i
                                                                                                       0 x
                                                                                            I

                                   i
                                 dT0
where the |X | × 1 vectors       d j   and xj are given by
                                                                                                
                                                                                      bi1         i             
                                                                                       .           x
                                                                                                  .1
                                                                                                
                                               i
                                             dT0
                                                                                       .
                                                                                       .          .             
                                             d j                                                  .
                                                                                                                
                                               1
                             i                                                       bi
                                                                           
                           dT0   
                                              .
                                                   
                                                                                      |B|
                                                                                                                
                                              .                       xi = 
                                                                                                  i
                               =                            and                                 = x             ,
                                                                                                                
                           d j
                                              .                             ki                    n
                                 
                                           dT0i
                                                                            1                     .             
                                                                            .                     . .
                                                                                                                
                                          d j                               .                                   
                                                                            .
                                            |X |
                                                                                                
                                                                                                   i
                                                                                                  x|X |
                                                                                                
                                                                             i
                                                                            k|K|

                           d i
and where the matrix       d j ,   of dimension |X | × |X |, is given by
                                                             
                                                       d i   I , if i = j
                                                              |X |
                                                         j
                                                           =
                                                       d     0|X | , if i = j,
                                                             

which is either a |X |-dimensional identity matrix, I|X | , when i = j , or a |X | × |X | matrix of zeros, 0|X | , when
                                           Qi (xi ;mC (s)) dmC (s)
i = j . We also define the |X | × 1 vector    mC (s)        d j    as

                                                                   ´     dmC (s) C
                                                                                                                
                                                                          d1j   i               xi , s dF (s)
                            Qi xi ; mC (s) dmC (s)                                          .
                                                                                                                
                                                  =
                                                                                            .
                                                                                            .                   .
                                                                                                                
                              mC (s)        d j     ´
                                                                         dmC (s) C
                                                                                                                
                                                                           j
                                                                          d|X
                                                                                i               xi , s dF (s)
                                                                              |



Note that we use the fact that

                                     dQi xi ; mC (s)   dxi Qi   Qi dmC (s)
                                              j
                                                     =   j  i
                                                              +            ,
                                          d            d  x     mC (s) d j

as well as
                                          d  i · xi - T0
                                                       i
                                                           d i i dxi i dT0  i
                                                         =     x +      -     .
                                               d j         d j     d j    d j




                                                                  46
                                                     dxi
Note that we define the |X | × |X | matrix           d j      as follows:
                                                                                                     
                                                                dxi                    dxi
                                                                                         |X |
                                                                d1
                                                                  1
                                                                  j           ···        j
                                                                                        d1           
                                              dxi                   .
                                                                    .         dxi           .
                                                                                            .
                                                                                                     
                                                  =                 .           n
                                                                                            .        .                                           (30)
                                                                                                     
                                                                                j
                                              d j                             dn
                                                    
                                                                                                     
                                                                dxi                    dxi
                                                                                         |X |
                                                                                                     
                                                                 j
                                                               d|X
                                                                   1
                                                                              ···        j
                                                                                       d|X
                                                                     |                     |



This matrix is the Jacobian of the equilibrium vector of the balance-sheet decisions of investor i with respect
                                                                         ui
to a change in the set of regulations that agent j faces. Note also that  x
                                                                            denotes a |X | × 1 gradient vector.
                                                                                                         dV C
                                                                                                         d j
Creditors. In the case of creditors, we can express the |X | × 1 vector                                   C
                                                                                                                as follows:
                                                                                                           0


                                                          =0
                             =0
                                                 uC
                                                                           
                       uC                 ^
                                                 cC (s)
    dV C
               dcC            -   C               1
                                                          -    C        (s)  dcC
                                                                             1 (s) dF (s)
                       cC         0              dF (s)        1
    d j          0      0
                                              
           =                          +       
    C 0        d j         C
                           0
                                                          C
                                                          0
                                                                             d j

                                                               =0
                                                          ^
                         dhC
                           i
                -                  Qi xi ; mC (s) -            mC (s) C  i
                                                                      i x , s dF (s)
                         d j
                    iI
                                                   ^
                               dQi xi ; mC (s)                  dC      i
                                                                   i x ,s               dx 1 uC
                -        hC
                          i                      -   m  C
                                                          ( s )            dF ( s ) +
                                     d j                             d j                d j C0 x
                    iI                                                                I
                                     ^
                     dxi       Qi        C       C    i
                                                  i x ,s                      Qi dmC (s)         dx 1 uC
           =-                      -    m  ( s )             dF  ( s ) -                    +            ,
                     d j        xi                  xi                       mC (s) d j          d j C
                                                                                                     0 x
                iI                                                        iI                   I
                                                   =0

                                                                                                                dC   i
                                                                                                                 i (x ,s)       dxi i
                                                                                                                                      C
where in the second equality we use the fact that hC
                                                   i = 1 and the fact that                                        d j       =   d j  xi ,   and where
                       C
the |X | × 1 vector      i
                        xi    is given by
                                                                              C
                                                                                       
                                                                               i
                                                                              xi
                                                                               1
                                                          C i
                                                                
                                                                               .
                                                                               .
                                                                                       
                                                              =                        .
                                                                                       
                                                           xi
                                                                               .
                                                                           C
                                                                                       
                                                                             i
                                                                           xi
                                                                            |X |

                                                                                   C
             dx                                           u
Note that d    j is defined as in Equation (30), and that  x denotes a |X | × 1 gradient vector.
Social Welfare: First, we can express the sum among investors of the change in money-metric indirect
utilities as follows:
                         i                 i
                       dVm               dT0   d i i                       Qi dmC (s)                                dx 1 ui
                           =                 -     x           +                      +
                       d j               d j   d j                         mC (s) d j                                d j i
                                                                                                                         0 x
                iI                 iI                               iI                                     iI I
                                          i                                                      i        C
                                        dx                    1 u                      Q dm (s)
                               =              i +                          +                      ,
                                   iI
                                        d j
                                                        I
                                                              0  xi             iI
                                                                                       mC (s) d j

where we use the fact that Equation (8) implies that

                                                       i
                                                     dT0   d i i                                dxi i
                                                         -     x                   =                 ,
                                                     d j   d j                                  d j
                                              iI                                       iI



                                                                         47
as well as the following identity:

                                                 dx 1 ui                     dxi 1 u
                                                         =                             .
                                                 d j i
                                                     0 x                     d j 0  xi
                                      iI I                         iI I

                            dW
Therefore, we can express   d j   as follows:

                                             i
                           dW              dVm  dV C
                               =               + m
                           d j             d j  d j
                                      iI

                                           dxi                1 u                 dxi 1 uC
                                  =               i +                    +
                                      iI
                                           d j
                                                         I
                                                              0  xi          iI
                                                                                  d j C
                                                                                      0 x
                                                                                          i

                                                                                              

                                           dxi                               1 uC
                                                                                              
                                                  i
                                                  -                  1 u                      
                                  =                       -                +                  ,
                                      iI
                                           d j   
                                                                I
                                                                     0  xi   C
                                                                             0 x
                                                                                 i            
                                                                                              
                                                                          = i


which, after being stacked, corresponds to Equation (17) in the text -- see also Footnote 9. Note that  i is
a |X | × 1 vector.

Proof of Proposition 2 [First-Best Regulation/Pigouvian Principle]:
Proof. The optimal first-best regulation is characterized by

                                                         dx
                                                             = 0,
                                                         d
                                                                                                      dx
which defines a system of homogeneous linear equations in  . If the matrix of policy elasticities     d    is
invertible (i.e., has full rank), the only solution to this system is the trivial solution  = 0.

Proof of Proposition 3 [Second-Best Regulation: General Case]:
                                             dxR
Proof. Note that the Jacobian matrix         d U
                                                 ,   of dimensions |U| × |R|, can be written as
                                                                             
                                                                   ···
                                                 dxR   .
                                                       .           dxi   .
                                                                         .
                                                                           
                                                     = .                 . ,
                                                                     n
                                                   U                 j
                                                 d                 dn
                                                                   ···

                                                                                                           U
                                                                                                       dx
where the balance-sheet activities are such that (i, n)  R and (j, n )  U . One can similarly define d  U
                                                                                                           ,
   U          R
dx          dx
d R
     , and d R , with dimensions |U| × |U |, |R| × |U|, and |R| × |R| respectively, by switching the sets of
coefficients.
     Consider the marginal welfare effects of increasing the perfectly regulated taxes/subsidies  R . By
                                                                                                   dW
definition of the perfectly regulated activities, we have  R = 0, so that Equation (18) yields d    R
                                                                                                        = 0
at the second-best optimum. Using Equation (17) (or, more directly, its expanded version in Footnote 9) we
obtain:
                           dW      dx              dxU         U     dxR
                      0=        =      (  -   ) =         U
                                                            -      +        R - R .
                           d R    d R              d R               d R




                                                              48
                             dxR
Assuming that the matrix     d R
                                   is invertible, we rearrange this equation as follows to complete the proof:

                                                                                                            -1
            dxR       R     dxU                                                                     dxR            dxU
                 R
                   -    = -      U - U                                        R
                                                                                  = -R
                                                                                                                             U - U .
            d R             d R                                                                     d R            d R
                                                                                                    |R|×|R|      |R|×|U |        |U |×1




Derivations with diagonal policy elasticities: When the own-regulatory policy elasticity matrix
dxR
d R
      is diagonal, we have

                                                                                              dxU     dxU
                                                                                                                                  
                                            -1                                                  1       2
                              
                                    dxR                                                       d1R     d1R
                                      1
                                      R            0                                            U
                                                                                                                                   
                                                                                                                                    1U
                                                                                                                                             
                                    d1                                                        dx1     dxU
                                                                                                                                  
                -1
                                                                                                        2
            R         U                                                                                                           
         dx          dx   U
                                                  ..                                          d2R     d2R                          .
                                                                                                                                   .
                                                                                                                                             
                            =
                              
                                      0                .                                                       ..                  .
                                                                                                                                             
         d R         d R
                              
                                                                          -1                                        .
                                                                                                                                             
                                                                dxR                                                                 U
                                                                                                                                  
                                                                  |R|                                                   dxU
                                                                                                                                    |U |
                                                                 R
                                                                d|R|                                                      |U |
                                                                                                                         R
                                                                                                                        d|R|
                                            -1                       -1                                                     
                                    dxR
                                      1          dxU
                                                   1           dxR
                                                                 1            dxU
                                                                                2
                                    d1R          d1R           d1R            d1R
                                                                                                                                          
                                            -1                       -1                                                       U
                              
                                    dxR
                                      2          dxU
                                                   1           dxR
                                                                 2            dxU
                                                                                2                                           
                                                                                                                             1
                                    d2R          d2R           d2R            d2R                                            .            
                             =                                                                                               .
                                                                                     ..                                      .
                                                                                                                                          
                                                                                          .
                                                                                                                                          
                                                                                                                             U
                                                                                                                            
                                                                                                              -1             |U |
                                                                                                    dxR
                                                                                                      |R|          dxU
                                                                                                                     |U |
                                                                                                                            
                                                                                                     R
                                                                                                    d|R|            R
                                                                                                                   d|R|
                                             -1                                                       
                                      dxR              dxU U             dxU U
                                      d1
                                        1
                                        R              d1R 1
                                                         1
                                                                     +   d1R 2
                                                                           2
                                                                                    + ···
                                                                                                      
                                             -1
                                      dxR              dxU               dxU
                                                                                                      
                                                           U                 U
                              
                              
                                      d2
                                        2
                                        R              d2R 1
                                                         1
                                                                     +   d2R 2
                                                                           2
                                                                                    + ···             
                                                                                                      
                             =                                   .                                    .
                              
                                                                 .
                                                                 .
                                                                                                      
                                                                                                      
                                             -1                                                       
                                    dxR
                                      |R|               dxU U              dxU U
                                                                                                      
                                     R
                                    d|R|                  R 1
                                                          1
                                                       d|R|
                                                                     +       R 2
                                                                             2
                                                                          d|R|
                                                                                      + ···

It follows that the second-best regulation on choice (j, n)  R is given by

                                                                     -1
                                      j   j                dxj
                                                             n                        dxj
                                                                                        n       j
                                      n = n -               j                              j
                                                                                                n .
                                                           dn             (j ,n )U
                                                                                          dn


Proof of Proposition 4 [Welfare effects of relaxing regulatory constraints]:
Proof. Using Equation (17) (or, more directly, its expanded version in Footnote 9) we obtain the welfare
effects of changes in the imperfectly regulated taxes/subsidies  U :

                                   dW    dxU                                      dxR
                                       =                    U - U +                    R - R .
                                   d U   d U                                      d U

From the characterization of  R at the second-best optimum from Proposition 3, we have that
                                                                         -1
                                                               dxR            dxU
                                     R - R =               -                       U - U .
                                                               d R            d R




                                                                     49
Combining, we obtain the required expression as follows:
                                                                          -1
                      dW    dxU                dxR                  dxR        dxU
                        U
                          =            U - U -                                      U - U
                      d     d U                d U                  d R        d R
                                                                                   
                                                        -1                     -1
                               dxU              dxU            dxR      dxR         dxU 
                                                                                          - U
                                                                                         U
                           =          I -
                                      
                               d U              d U            d U      d R         d R 
                                                                    L                         U
                                  U
                               dx
                           =       (I - L)  U .
                               d U



Proof of Proposition 5 [Second-Best Regulation: Unregulated Investors/Activities]:
Proof. This proposition follows directly from Proposition 3 and the observation that, at the second-best
optimum, the constraints are binding with  U = 0. Concretely, we have
                                                           
                                           -1                                                -1
                            dxR                 dxU  U               dxR                          dxU U
                 R   = R + - R                         -  U
                                                            =  R
                                                                 - -                                   ,
                            d                   d R                  d R                          d R
                                                          =0


as required.

Proof of Proposition 6 [Second-Best Regulation: Imperfect Targeting]:
Proof. Given the constraints specified in the text for this case, we can write the Lagrangian for the optimal
second-best policy as
                                                          |U |-1
                                        L = W ( ) +                µu  U    U
                                                                       u -  u+1 ,
                                                          u=1

                                                                                     j
where, without loss of generality, we have re-indexed the set U = (j, n)  |X | : n     = 0 using the auxiliary
index u  {1, 2, ..., |U|}. The first-order necessary conditions for the second-best optimum are:

                                       dW
                                             = µ1
                                       d U
                                         1
                                       dW
                                             = µu - µu-1 , u  {2, ..., |U| - 1}
                                       d U
                                         u
                                       dW
                                             = -µ|U |-1 .
                                      d U
                                        |U |


Adding up across the auxiliary index u, we obtain

                               |U |                   |U |-1
                                   dW
                                       = µ1 +                  (µu - µu-1 ) - µ|U |-1 = 0,
                               u=1
                                   dUu                u=2

or, in equivalent vector notation,
                                                          dW
                                                              = 0,
                                                          d U




                                                               50
                                                                                        dW
where  is a column vector of ones with dimension |U|. Substituting the expression for   d U
                                                                                              from Proposition
4, we obtain

                                         dxU
                                     0=      (I - L)  U
                                         d U
                                         dxU
                                       =     (I - L)  U -  U
                                         d U
                                         dxU
                                       =     (I - L)  U  -  U ,
                                         d U

where the last line uses the fact that all elements of  U must be equal to the same scalar, denoted  U , at
the constrained solution. We solve as follows for  U to complete the proof:
                                                                          U
                     dxU             U    dxU            U   U
                                                                  dx
                                                                  d U
                                                                      (I - L)  U
                         ( I - L )     =      ( I - L )        =   dxU
                                                                                 .
                     d U                  d U                     d U
                                                                       (I - L) 
                        scalar                scalar




                                                       51
                                          Online Appendix
    Section C of this Online Appendix includes detailed proofs and derivations associated with the four
applications described in Section 4 of the paper. Section D of this Online Appendix shows that the results
of the paper apply unchanged to a classical consumer theory scenario.


C      Proofs and derivations: Section 4
C.1     Application 1
Default and repayments: Investor i optimally defaults at date 1 if v i s + ti bi , s - bi < 0.30 Assuming
           ti (bi ,s)
that v i +    s       > 0, there exists a unique threshold si bi such that default occurs if and only if
s < si bi . Therefore, the definition of the repayment eventually received by creditors, P i bi , s , is
                                                   
                                                   i v i s + ti bi , s          s  s, si bi
                                Pi        bi , s =
                                                   bi                           s  si bi , s .

In our simulation, we let ti bi , s = 0i   i
                                         - s s + b i i
                                                    b , with si
                                                                < v i , so that we can solve explicitly for the
default threshold
                                                       i
                                                1 - b            1
                                    si bi =               bi - i        i .
                                                                      i 0
                                               v i - s  i     v - s
We further assume that creditors have constant relative risk aversion with coefficient  .

Creditors' optimal choices and asset pricing: We conjecture and verify that the price
Qi bi ; mC (s) of investors' debt is a function of bi and creditors' stochastic discount factor mC (s) =
    u (cC (s))
 C u 1cC . Substituting creditors' budget constraints into their objective, we obtain the simplified version
       ( 0)
of their maximization problem:


        V C bi , mC (s) = max
                          i
                              u nC
                                 0 -                        hi Qi bi ; mC (s)
                            {h }iI
                                                       iI
                                                  ^
                                          + C          u nC
                                                          1 (s) +          hi P i bi , s - (1 + )         ti bi , s   dF (s) ,
                                                                      iI                            iI


where V C (·) denotes creditors' indirect utility as a function of investors' debt choice and market prices.
The first-order conditions for this problem, combined with market clearing (hi = 1), yield the following
debt-pricing equation:
                                ^    si   (bi )                                             ^   s
              i   i   C                            C          i i     i    i
            Q b ; m (s) =                         m (s)  v s + t b , s           dF (s) +              mC (s) bi dF (s) .
                                 s                                                          si (bi )


Note that the stochastic discount factor in equilibrium must satisfy the fixed-point equation

                                          u nC
                                             1 (s) +
                                                           i  i
                                                      iI P b , s - (1 + )
                                                                                i i
                                                                            iI t b , s
                      mC (s) =  C                                                                             .
                                                    u nC
                                                       0 -
                                                                 i i    C
                                                             iI Q (b ; m (s))
  30
    Note that it is straightforward to make bailouts depend on the decisions of all investors, as in, e.g., Farhi and
Tirole (2012).


                                                                    OA-1
     0.76
                                                                                             0.413
     0.74

     0.72                                                                                    0.412

      0.7
                                                                                             0.411
     0.68

     0.66
                                                                                              0.41
     0.64

     0.62                                                                                    0.409
            0   0.01   0.02     0.03   0.04    0.05        0.06     0.07     0.08                    0     0.01     0.02     0.03   0.04   0.05   0.06   0.07   0.08




   0.0489                                                                                     0.03

                                                                                              0.02
   0.0488
                                                                                              0.01

   0.0487                                                                                       0

                                                                                             -0.01
   0.0486
                                                                                             -0.02

   0.0485                                                                                    -0.03

                                                                                             -0.04
   0.0484
            0   0.01   0.02     0.03   0.04    0.05        0.06     0.07     0.08                    0     0.01     0.02     0.03   0.04   0.05   0.06   0.07   0.08




                                                   0


                                               -0.5


                                                -1


                                               -1.5


                                                -2


                                                       0     0.01     0.02     0.03   0.04    0.05       0.06     0.07     0.08




                              Figure OA-1: Application 1: Second-Best Comparative Statics
                                                                                                         1         2
Note: Figure OA-1 illustrates relevant comparative statics of Application 1 for different values of b      , when b  = 0.
The top left plot shows equilibrium borrowing bi for both types of investors. The top right plot shows the equilibrium
creditors' riskless rate, defined on page 29. The middle left plot shows the distortion associated with the borrowing
                           1       2
choice of each investor, b    and b  , defined in Equation (31) -- note that the distortions move inversely with changes
in the riskless rate Rf and quantitatively the changes are small. The middle right plot shows the Pigouvian wedge
                                                              1       2                                               db1
associated with the borrowing decision of each investor, b      and b   . The bottom plot shows the policy elasticity d 1
                                                                                                                                                                 b
                                              db2
and the critical leakage elasticity           d 1
                                                       > 0. The parameters used are described in Figure 1.
                                               b




                                                                                OA-2
Investors' optimal choices: Substituting investors' budget constraints into their objective, and
ignoring exogenous endowments, we obtain the simplified version of their maximization problem:

                                                                                  ^   s
                           i    i    i
                       V        b , T0 , mC      (s) = max
                                                        i
                                                                              i
                                                                                              v i s + ti bi , s - bi dF (s)
                                                              b                    si (bi )

                                                                      + Qi bi ; mC (s) - b
                                                                                         i i    i
                                                                                           b + T0 ,

where V i (·) denotes investors' indirect utility as a function of regulation and market prices. The first-order
condition determining the optimal bi is
                                    ^   s
                                i                        ti i                                        Qi bi ; mC (s)   i
                           -                      1-        b ,s                      dF (s) +                      = b ,
                                    si (bi )             b                                               bi

where
                                                 ^   s                                        ^      si   (bi ) ti
                 Qi bi ; mC (s)
                                =                            mC (s) dF (s) +                                       bi , s mC (s) dF (s)
                     bi                           si (bi )                                       s              b
                                                              C           i           i    i i
                                            - (1 - ) m                s           b       vs          bi f si      bi   .

                                                                                               j
Marginal welfare effects: The money-metric marginal welfare effects of changing the regulation b of
investor type j  {1, 2} are given by

                                                         dW           1 dV C      dV i
                                                          j
                                                              =            j
                                                                             +      j
                                                                                       ,
                                                         db           C
                                                                      0 db     iI
                                                                                  db

where C          C          i
        0 = u c0 , since 0 = 1. Using an envelope argument parallel to our general results in Proposition
1, we obtain, abstracting from pecuniary effects that cancel after aggregating,
                                                                  ^
                               dV C                           C                                      ti bi , s dbi
                                j
                                        = - (1 + )                    u (c1 (s))                                 j
                                                                                                                   dF (s) ,
                               db                                                                      bi      db
                                                                                              iI


and
                                                                  dV i              i     dbi
                                                                       j
                                                                                  = b      j
                                                                                                 ,
                                                                      db                  db
                                        i   i i
where we have used the assumption that T0 = b b . Thus, we obtain
                                                                                                                            
                                                                  ^
                               dW                dbi  i              C       ti bi , s          
                                        =               - (1 +  )   m  ( s )           dF ( s ) .                                         (31)
                                                                                                
                                j                  j  b
                                                     
                                                                               bi
                               db           iI
                                                 db                                             
                                                                                                      i
                                                                                                     =b


                                                   i   i
It follows that the first-best policy must satisfy b = b , i  {1, 2}.

Proof of Proposition 7 [Shadow Banking/Unregulated Investors]:
Proof. The proposition follows directly by evaluating Equation (31) in the case where the planner is forced
       2
to set b  0.



                                                                                  OA-3
Further simulation results: Figure OA-1 illustrates comparative statics of the model in the context
                                    2
of the second-best policy, in which b = 0.


C.2     Application 2
Default and repayments: At date 1, investors optimally decide to default when s < bi , and to repay
otherwise. Therefore, the definition of the repayment eventually received by creditors per unit of capital k i ,
P i bi , s , is                                      
                                                     i s s  s, bi
                                        P i bi , s =
                                                     bi   s  bi , s .

Creditors' optimal choices and asset pricing: Since creditors are risk-neutral, they must be
indifferent between all quantities of debt purchase in equilibrium. Hence, the valuation of debt per unit of
capital in equilibrium satisfies
                                                         ^       s                        ^    bi
                                 i     i            C                 i     C
                               Q b          =                        b dF (s) +                     sdF C (s) .
                                                             bi                            s


Investors' optimal choices: Substituting the valuation of debt and the budget constraints into
investors' objective function, and ignoring exogenous endowments, we obtain the simplified version of their
maximization problem:

                                     max
                                      i i
                                          M bi k i -  k i - b
                                                            i i   i i
                                                              b - k      i
                                                                    k + T0 ,
                                     b ,k

where M bi is given by
                                                             ^    s
                                               i         i
                                     M b           =                      s - bi dF i (s) + Qi bi .
                                                              bi
                                                                                 i   i i    i i
We assume that all corrective taxes/subsidies are reimbursed to investors with T0  = b b + k k . The first-
order conditions in this problem, which yield demand functions for credit and investment, are given by the
solution to

                                                        dM bi i   i
                                                              k - b =0                                                 (32)
                                                          dbi
                                                    M bi -  k i - k
                                                                  i
                                                                    = 0,                                               (33)

where                                      ^                                ^
                                               s                                s
                      dM bi
                            = C                    dF C (s) -  i                    dF i (s) - (1 - )  C bi f C bi .
                        dbi                 bi                                bi

As shown in Dávila and Walther (2020b), assuming that 0 <  i <  C  1 and that  is not too small
                                                                  i
guarantees an interior solution for leverage. Note that when b      = 0, the equilibrium value of bi is independent
of k i , and consequently of k i
                                 . This explains why the first-best and second-best marginal values of regulating
  i                        i
b are identical when b = 0. In our simulation, we assume that investment adjustment costs are quadratic,
                    i 2
i.e.,  k i = a  2 k     , in which case Equation (33) takes the form

                                                                     1
                                                        ki =           M bi - k
                                                                              i
                                                                                .
                                                                     a



                                                                          OA-4
Marginal welfare effects: As shown by Dávila and Walther (2020b), social welfare for a planner who
computes welfare using beliefs F i,P and F C,P is given by

                                              W = M P bi k i -  k i ,

where M P bi denotes the present value of payoffs under the planner's beliefs

                            ^   s                             ^    s                        ^   bi
              M P bi =  i           s - bi dF i,P (s) +  C             bi dF C,P (s) +               sdF C,P (s) .
                              bi                                  bi                        s


                                        i
The marginal welfare effects of varying b , after differentiating and substituting investors' first-order
conditions, can be written as

            dW    dM P bi i dbi                                    dk i
              i
                =         k   i
                                + M P bi -  k i                       i
            db      dbi     db                                     db
                                            
                                                                                                             
                                                              
                   
                    i        dM bi   dM P bi                   dbi                                            dk i
                 = b  -            -                       ki  i +  i - M bi - M P bi                         d i .      (34)
                                                                                                             
                               dbi     dbi                     db  k                                                 b
                                                                              i
                                                              
                                                                                                k
                                          i
                                          b


Proof of Proposition 8 [Scale-Invariant Regulation/Unregulated Activities]:
Proof. The proposition follows directly by evaluating Equation (34) in the case where the planner is forced
       i
to set k  0.

Further simulation results: Figure OA-2 illustrates comparative statics of the model in the context
                                    i
of the second-best policy, in which k = 0.


C.3     Application 3
Default and repayments: The bailout policy specified in Equation (27) implies that investors always
(weakly) prefer not to default. Creditors are therefore guaranteed a repayment equal to the face value of
legacy debt, bi . We treat bi as an exogenous constant throughout this application. The threshold state below
                                           i    i
which bailouts are positive, denoted s k1    , k2 , is implicitly defined by

                                    bi = d1 s     i
                                                 k1    i
                                                    , k2    i
                                                           k1 + d2 s        i
                                                                           k1    i
                                                                              , k2    i
                                                                                     k2 .

Notice that this equation has a unique solution because we have assumed that the returns to investment,
d1 (s) and d2 (s), are increasing in s.

Creditors' optimal choices and asset pricing: In this application, we assume for simplicity that
investors' debt bi is legacy debt, i.e., issued before the start of the model. Therefore, there is no market for
debt, and no market price, at date 0. Creditors are passive agents who simply consume their endowments
and debt repayments, and pay the taxes raised for bailouts. Creditors' indirect utility, as a function of




                                                           OA-5
   0.86
                                                                                                  0.065                                           0.19
                                                   1.385
   0.84

                                                                                                   0.06                                          0.189
   0.82                                           1.3845

    0.8                                            1.384                                                                                         0.188
                                                                                                  0.055

   0.78
                                                  1.3835
                                                                                                   0.05                                          0.187
   0.76
                                                   1.383
   0.74                                                                                           0.045                                          0.186
                                                  1.3825
   0.72
                                                                                                                                                 0.185
                                                                                                   0.04
    0.7                                            1.382


   0.68                                                                                                                                          0.184
                                                  1.3815                                          0.035

   0.66
                                                   1.381                                                                                         0.183
           0   0.01   0.02   0.03   0.04   0.05            0   0.01   0.02   0.03   0.04   0.05           0   0.01   0.02   0.03   0.04   0.05           0   0.01   0.02   0.03   0.04   0.05




                                                  -0.183                                             -3

   0.01
                                                  -0.184                                           -3.5
                                                                                                                                                 -0.05
      0                                                                                              -4
                                                  -0.185
   -0.01                                                                                           -4.5
                                                                                                                                                  -0.1
                                                  -0.186
   -0.02                                                                                             -5

                                                  -0.187                                           -5.5                                          -0.15
   -0.03

                                                                                                     -6
   -0.04                                          -0.188
                                                                                                                                                  -0.2
                                                                                                   -6.5
   -0.05                                          -0.189
                                                                                                     -7
   -0.06                                                                                                                                         -0.25
                                                   -0.19
                                                                                                   -7.5
           0   0.01   0.02   0.03   0.04   0.05            0   0.01   0.02   0.03   0.04   0.05           0   0.01   0.02   0.03   0.04   0.05           0   0.01   0.02   0.03   0.04   0.05




                                    Figure OA-2: Application 2: Second-Best Comparative Statics
Note: Figure OA-2 illustrates relevant comparative statics of Application 2 for different values of b , when k = 0.
The top left plot and the top middle-left plot show equilibrium leverage b and investment k. The top middle-right
and right plots show the leverage distortion b and the capital distortion k , respectively. The bottom left plot and
the bottom middle-left plot show the associated Pigouvian wedges, b and k , respectively. The bottom middle-right
                                                       db                              dk
plot and bottom right plot show the policy elasticity d b
                                                           and the leakage elasticity d b
                                                                                          . The parameters used are
described in Figure 2.




                                                                                           OA-6
investment choices, is then given by
                                                                          ^   s
                                                                              ¯
                    i
               V C k1    i
                      , k2 = C                bi - (1 + )                            i
                                                                                  t k1    i i
                                                                                       , k2 , b , s dF (s)
                                                                          s
                                                                          ^   s     i
                                                                                  (k1   i
                                                                                      ,k2 )
                                      C           i
                                =             b - (1 + )                                        bi - d1 (s) k1
                                                                                                             i           i
                                                                                                               - d2 (s) k2 dF (s) .
                                                                          s


Investors' optimal choices: Substituting investors' budget constraints into their objective, and
ignoring exogenous endowments, we obtain the simplified version of their maximization problem:
                                                           ^   s
                                                               ¯
                   i            i                      i                              i           i
               V       1 2
                       k , k , T0   = max
                                       i i
                                                                              d1 (s) k1 + d2 (s) k2 - bi dF (s) -  k1
                                                                                                                    i    i
                                                                                                                      , k2
                                        k1 ,k2                 (k1   2)
                                                           s     i ,k i


                                      1 i    2 i     i
                                    - k k1 - k k2 + T0 ,

where V i k1 2
            , k , T0i
                      denotes investors' indirect utility as a function of taxes/subsidies.
   Investors' first-order conditions are given by
                                        ^     s
                                              ¯                                                   i    i
                                                                                                 k1 , k2
                                    i                          d1 (s) dF (s) -                     i
                                                                                                           1
                                                                                                         - k =0
                                          s   (k1   2)
                                                i ,k i                                          k1
                                        ^     s
                                              ¯                                                   i    i
                                                                                                 k1 , k2
                                    i                          d2 (s) dF (s) -                     i
                                                                                                           2
                                                                                                         - k = 0.
                                          s   (k1   2)
                                                i ,k i                                          k2

                                                                                 j
Marginal welfare effects: The marginal welfare effect of changing the regulation k of investment
type j  {1, 2} is given by

                                                                    dW             dV C          dV i
                                                                     j
                                                                              =     j
                                                                                           +      j
                                                                                                        .
                                                                    dk             dk            dk

Using the envelope theorem, parallel to our general results in Proposition 1, we obtain
                                                                                      ^    s     i
                                                                                               (k1   i
                                                                                                   ,k2 )
                               dV C                                 C
                                                                                                                              i
                                                                                                                            dkm
                                j
                                      = - (1 + )                                                            dm (s) dF (s)    j
                                                                                                                                  ,
                               dk                                       m{1,2}         s                                    dk

and

                                                                   dV i       V i              V i dT0
                                                                                                     i
                                                                    j
                                                                          =       j
                                                                                       +         i   j
                                                                   dk             k            T0 dk
                                                                                                     i
                                                                                                   dkm
                                                                          =                    m    j
                                                                                                            ,
                                                                              m{1,2}
                                                                                                   dk

                                        i   1 i    2 i
where we have used the assumption that T0 = k k1 + k k2 . Thus, we obtain
                                                                                                                                      
                                                        i                  ^ s (k1
                                                                                 i   i
                                                                                   ,k2 )
                          dW                          dkm                C
                                                                                                          
                                =                             - (1 +  )                  d  ( s ) dF ( s ).
                                                                                                          
                           j                             j  m
                                                                                          m
                          dk        m{1,2}
                                                      dk                    s                             
                                                                                                            =m




                                                                                  OA-7
Proof of Proposition 9 [Asset Substitution/Uniform Activity Regulation]:
Proof. To establish this proposition, we can use the general expression for optimal uniform regulation from
Proposition 6

                                                                        dxU
                                                          U             d U
                                                                            (I - L)  U
                                                              =          dxU
                                                                                                        .
                                                                         d U
                                                                             (I - L) 

We have L = 0 in this application, because there is no perfectly regulated choice. Hence, we obtain
                                                                                        i        i
                                                                                                      
                                                                                      dk1      dk2
                                 dxU U                                                dk1      dk1                1
                                      =                   1         1                   i
                                                                                      dk1        i
                                                                                               dk2
                                                                                                      
                                 d U                                                    2        2
                                                                                                                  2
                                                                                      dk       dk

                                                            i
                                                          dk1               i
                                                                          dk1            i
                                                                                       dk2            i
                                                                                                    dk2           1
                                                =         dk1       +     dk2          dk1    +     dk2
                                                                                                                  2
                                                            i     i                                   i     i
                                                          dk1   dk1                                 dk2   dk2
                                                =           1 +   2                    1 +            1 +   2             2 ,
                                                          dk    dk                                  dk    dk

and
                                           dxU                  i
                                                              dk1  dk i                             i
                                                                                                  dk2  dk i
                                               =                1 + 12                    +         1 + 22            .
                                           d U                dk   dk                             dk   dk
Combining the last three expressions yields the required result, since
                                                         i            i                         i             i
                                                       dk1          dk1                       dk2           dk2
                                                       dk1     +    dk2       1 +             dk1   +       dk2   2
                                           k =                  i
                                                              dk1           i
                                                                          dk1                   i
                                                                                              dk2             i
                                                                                                            dk2
                                                              dk1   +     dk2         +       dk1   +       dk2

                                                            i                                 i
                                                          dk1                               dk2
                                                          d k                               d k
                                               =      i
                                                    dk1              i
                                                                   dk2
                                                                         1 +            i
                                                                                      dk1           i
                                                                                                  dk2
                                                                                                          2 ,
                                                    d k   +        d k                d k     +   d k

                                             i
where we have defined the total response of km to a change in the uniform regulation as

                                                            i
                                                          dkm  dk i  dk i
                                                              = m 1 + m 2 .
                                                          d k  dk    dk




Derivation of leakage elasticities with separable costs: Assume that the adjustment cost takes
           i    i     z1    i   2       z2     i   2
the form  k1 , k2 =   2    k1       +   2     k2 . Investors' first-order conditions now become

                                                               ^    s
                                                                    ¯
                                         i     1          i                                           1
                                        k1   =                                        d1 (s) dF (s) - k
                                               z1               s   (k1   2)
                                                                      i ,k i

                                                               ^    s
                                                                    ¯
                                         i     1
                                        k2 =           i                                              2
                                                                                      d2 (s) dF (s) - k               .
                                               z2               s   (    i ,k i
                                                                        k1   2    )




                                                                          OA-8
Applying the implicit function theorem and Leibniz rule to investors' first-order conditions, and imposing
                    1    2
uniform regulation k  = k  =  k , we have

                                i                                                                       i    i
                              dkn    1                                                         ds      k1 , k2
                                  =        - i dn s        i
                                                          k1    i
                                                             , k2     f s          i
                                                                                  k1    i
                                                                                     , k2                      -1 .
                              d k   zn                                                                d k

Notice that the probability of bailout is

                                                      i    i                     i    i
                                                   P k1 , k2 =F s               k1 , k2       ,

and has the property that
                                               i    i                                          i    i
                                           dP k1 , k2                    i    i      ds       k1 , k2
                                                      =f s              k1 , k2                       .
                                              d k                                            d k
Hence, we can write
                                          i                                            i    i
                                        dkn    1                                   dP k1 , k2
                                            =        - i dn s          i
                                                                      k1    i
                                                                         , k2                 -1 .
                                        d k   zn                                      d k

It follows that the sufficient statistics for leakage elasticities are i) the scaling factor zn of the cost function,
ii) the sensitivity of the probability of bailout to the regulation, and iii) the marginal contribution dn (s )
of each asset class at the bailout boundary. Notice that the weight on 1 in the optimal tax formula now
becomes
                                                                                                 i   i
                                                     1                                      dP (k1 ,k2 )
                i
              dk1
                                                     z1    - i d1 s         i
                                                                           k1    i
                                                                              , k2             d k         -1
              d k
          i
        dk1           i
                    dk2
                          =
              +               1                 i , ki    dP (k1   2)
                                                               i ,k i
                                                                                     1                         i , ki   dP (k1   2)
                                                                                                                             i ,k i
        d k         d k       z1   - i d1 s    k1    2       d k        -1 +         z2      - i d2 s         k1    2      d k        -1
                                1
                          =         ,
                              1 + 1

where                                                                      i   i
                                                             i        dP (k1 ,k2 )
                                                     z1 1 +  d2 (s ) d k
                                                 1 =                               .
                                                     z2               dP (ki ,ki )
                                                        1 +  i d1 (s ) d1k 2

Further simulation results Figure OA-3 illustrates comparative statics of the model in the context
                                         1   2
of the second-best policy, in which  k = k = k .


C.4     Application 4
Households' optimal choices and asset pricing: Households' optimization problem at date 1 can
be expressed as
                                                   V H (q ) = max F k1
                                                                     H     H
                                                                       - qk1 ,
                                                                  H
                                                                 k1

where V H (·) denotes households' indirect utility as a function of market prices. The solution to the
                                                   H
households' problem is characterized by q = F k1      . When combined with market clearing, given by
     i    i     H
  i k0 - k1 = k1 , we find the following equation, which the price q must satisfy:


                                               H                     i    i                       1
                                   q=F        k1 =F                 k0 - k1         =F                      i k0
                                                                                                               i
                                                                                                                   .
                                                             i
                                                                                                  q   i



                                                                    OA-9
    -1.9

   -1.91                                                                                                          1.15

   -1.92

   -1.93                                                                                                           1.1

   -1.94

   -1.95                                                                                                          1.05

   -1.96

   -1.97                                                                                                                1

           0   0.005   0.01   0.015   0.02   0.025   0.03         0.035   0.04     0.045   0.05                             0       0.005      0.01   0.015     0.02   0.025   0.03   0.035   0.04   0.045    0.05




   0.025
                                                                                                                  0.04

                                                                                                                  0.03
    0.02

                                                                                                                  0.02
   0.015
                                                                                                                  0.01


    0.01                                                                                                                0

                                                                                                                 -0.01
   0.005
                                                                                                                 -0.02
           0   0.005   0.01   0.015   0.02   0.025   0.03         0.035   0.04     0.045   0.05                             0       0.005      0.01   0.015     0.02   0.025   0.03   0.035   0.04   0.045    0.05




                                                     -1.04

                                                     -1.05

                                                     -1.06

                                                     -1.07

                                                     -1.08

                                                     -1.09

                                                       -1.1

                                                     -1.11

                                                     -1.12

                                                              0       0.005      0.01   0.015     0.02   0.025   0.03           0.035   0.04     0.045   0.05




                                Figure OA-3: Application 3: Second-Best Comparative Statics
                                                                                                             1      2
Note: Figure OA-3 illustrates relevant comparative statics of Application 3 for different values of  k = k       = k  .
                                                                                                      i        i
The top left plot shows the default threshold s . The top right plot shows risky capital investments k1 and k2   . The
middle left plot shows the distortions associated with each investment decisions, 1 and 2 , and the middle right plot
                                                                                                                                                                                                       i
                                                                                                                                                                                                     dk1
shows the associated Pigouvian wedges, 1 and 2 . The bottom plot shows the leakage/policy elasticities                                                                                               d k
                                                                                                                                                                                                             and
  i
dk2
d k
    .   The parameters used are described in Figure 3.




                                                                                                OA-10
                                                                                      i
Notice that this equation defines q as an implicit function of capital investments k0   . Below, we derive a
solution for the equilibrium value of q in terms of primitives under standard functional forms.

Investors' optimal choices: We solve investors' problem recursively. At date 1, the non-negativity
constraint on consumption is necessarily binding. It follows that the investor optimally chooses ci
                                                                                                  1 = 0 and


                                                  i                 i        i
                                                 k1 =         1-            k0 .
                                                                    q

Thus, investor i's maximized utility (i.e., value function) from date 1 onwards is

                                           i     i                          i
                                          v1 q, k0 = zi 1 -                         i
                                                                                   k0 .
                                                                            q

At date 0, ignoring exogenous endowments, we can express investors' optimization problem as

                           i
                       V i k    i
                             , T0 , q = max
                                         i
                                             i
                                            v1     i
                                               q, k0 - i k0
                                                          i   i i
                                                            - k       i
                                                                k0 + T0 ,
                                          k0

                                                               i
                                     = max zi 1 -                    i
                                                                    k0 - i k0
                                                                            i   i i
                                                                              - k       i
                                                                                  k0 + T0 ,
                                        i k0                   q

where V i (·) denotes investors' indirect lifetime utility as a function of taxes and market prices. The first-
                                                    i
order condition determining optimal investment k0      is given by

                                                      i
                                          zi 1 -               = i k0
                                                                    i   i
                                                                      + k .
                                                      q

Assuming quadratic adjustment costs, we obtain the closed form solution

                                           i     1                  i
                                          k0 =            zi 1 -               i
                                                                             - k .
                                                 ai                 q

                                                                                 j
Marginal welfare effects: The marginal welfare effect of changing the regulation k of investor type
j is given by
                                               dW              dV           dV H
                                                j
                                                      =         j
                                                                        +     j
                                                                                   .
                                               dk         I
                                                               dk            dk

Using the envelope theorem, parallel to our general results in Proposition 1, we obtain

                                                 dV H          V H dq
                                                     j
                                                           =         j
                                                                       .
                                                    dk         q dk

Similarly, we have

                                     dV          V            V dT0   V dq
                                      j
                                           =     j
                                                          +       j
                                                                    +     j
                                     dk          k            T0 dk   q dk
                                                    dk0        v1 dq
                                           = k       j
                                                           +        j
                                                                      ,
                                                    dk         q dk




                                                           OA-11
where we have used the assumption that T0 = k k0 . Combining, we obtain

                                   dW       H         dq                  dk0         v1 dq
                                    j
                                        = -k1          j
                                                           +          k    j
                                                                                +          j
                                   dk                 dk                  dk          q dk
                                                                 I
                                                    i
                                                i dk0                    v1    H         dq
                                        =       k   j
                                                            +               - k1          j
                                                                                               .                              (35)
                                                  dk                     q               dk
                                             iI                      I

                                                                               i
Since q in equilibrium is an implicit function of initial capital investments k0 , i  {1, 2}, we can write

                                                                         i
                                                      dq             q dk0
                                                       j
                                                           =          i  j
                                                                           .
                                                      dk        iI
                                                                     k0 dk

Moreover, notice that

                             v1    H              z       H                           z
                                - k1 =               k - k1 =                           -1         k0 - k1 ,
                             q                    q q 0                               q
                         I                    I                            I

                                                                    H
where the last equality follows from the market clearing condition k1 =                             I   k0 - k1 . Substituting into
(35) yields

                                              i                                                  i
                          dW            i   dk0                 z                            q dk0
                           j
                               =        k    j
                                                  +               -1      k0 - k1             i  j
                          dk                dk                  q                            k0 dk
                                   iI                 I                                 iI
                                                                                                
                                                                                               
                                         q                               z                      dk i
                                                                                       k0 - k1  0
                                     i
                               =    k - - i                                -1                        .
                                                                                               
                                         k                               q                      dk j
                                 iI 
                                          0                       I                            
                                                                          i
                                                                         =k


Proof of Proposition 10 [Fire-Sale Externalities/Uniform Investor Regulation]:
                                                                1   2
Proof. With uniform taxation, the planner is forced to set  k = k = k . The marginal welfare effect of
changing the uniform tax is

                                             dW                 dW
                                                 =               j
                                             d k                dk
                                                          j I
                                                                                   i
                                                                 i   i           dk0
                                                      =          k - k            j
                                                          iI               j I
                                                                                 dk
                                                                                i
                                                                      i       dk0
                                                      =           k - k           ,
                                                                              d k
                                                          iI

                                            dW
and solving for the optimal regulation      d k   = 0, we obtain the required second-best solution:

                                                                      i
                                                                    dk0   i
                                                                 iI d k k
                                                      k =            dk0i   .
                                                                  iI d k




                                                                OA-12
                                                                                        H      
                                                    H                                 (k1 )                                 H
Closed-form solutions: Under the assumption that F k1 =                                           , which implies that F   k1 =
  H -1
 k1    ,    we can express the equilibrium price in closed form as
                                                                            -1
                                                                            

                                                     q=              i k0
                                                                        i
                                                                                  .                                         (36)
                                                                i

                                                      ai        2
With quadratic adjustment costs i k0
                                   i
                                     =                2
                                                            i
                                                           k0 , investors' optimal choices at date 0 satisfy

                                                i     1                 i
                                               k0 =         zi 1 -              i
                                                                              - k .
                                                      ai                q
              i             i
             k0        zi                                           i
Note that    q    =    ai q 2 >   0. Note also that z i 1 -         q
                                                                          i
                                                                        - k                      i
                                                                            > 0 is required for k0 > 0. Combining the
                        i
optimal choice of     k0  with    the characterization of the price in Equation (36) yields a solution for q in terms
of primitives:
                                                                                      -1
                                                                                      
                                                      i                i
                                          q=               zi       1-          i
                                                                              - k          .
                                                 i
                                                      ai               q
                                  i
As expected, the same change in k0  has a stronger impact on the price at date 1 for those investors with a
                                                                                       1
        i                                                                q      i -1 1-        q
higher  , who are forced to sell more at date 1. Note that we can write k i =      q
                                                                                          , so
                                                                                               k0i is higher
                                                                          0
in absolute, when q is higher.

Further simulation results Figure OA-4 illustrates comparative statics of the model in the context
                                         1   2
of the second-best policy, in which  k = k = k .


D      Classical Consumer Theory Formulation
In this section, we show that Proposition 1 holds unchanged in the context of classical consumer theory
after suitably reinterpreting some of the variables. Since the remaining propositions in the body of the
paper follow from Proposition 1, showing that Proposition 1 holds unchanged in a classical consumer theory
scenario is sufficient to establish that all other results are also applicable in that case. Here, we follow closely
the notation in Mas-Colell, Whinston and Green (1995).

Environment There is a finite number of consumer types, indexed by i, j, m  I , where I = {1, 2, . . . , I }.
There are L different commodities, indexed by . The preferences of a type i consumer are represented by
the following utility function, which directly depends on the consumption of all consumers:

                                                      ui xi , xj        j I
                                                                              ,                                             (37)

where xi  RL denotes the consumption bundle of a type i consumer. As in Section 2, we denote by xj  RL
the consumption bundles of type j consumers as a whole.
    Thus a type i consumer maximizes Equation (37) subject to the budget constraint

                                             p · xi - ei  wi -  i · xi + T0
                                                                          i
                                                                            ,                                               (38)

where p  RL is the vector of commodity prices, ei  RL is the endowment in terms of the different
commodities of a type i consumer, wi is the wealth of a type i consumer, and  i  RL and T0 i
                                                                                             are


                                                                OA-13
    1.35                                             1.14                                                0.31

   1.345
                                                     1.12                                                 0.3
    1.34
                                                      1.1
                                                                                                         0.29
   1.335

                                                     1.08
    1.33                                                                                                 0.28


   1.325                                             1.06
                                                                                                         0.27

    1.32                                             1.04
                                                                                                         0.26
   1.315
                                                     1.02
                                                                                                         0.25
    1.31
           0   0.01   0.02     0.03   0.04   0.05             0     0.01     0.02   0.03   0.04   0.05           0   0.01   0.02   0.03   0.04   0.05




                                                                                                          -0.7
                                                     0.01
   0.055

                                                                                                         -0.71
                                                          0

    0.05
                                                                                                         -0.72
                                                     -0.01

                                                                                                         -0.73
   0.045                                             -0.02

                                                                                                         -0.74
                                                     -0.03

    0.04
                                                                                                         -0.75
                                                     -0.04

                                                                                                         -0.76
   0.035                                             -0.05

                                                                                                         -0.77
           0   0.01   0.02     0.03   0.04   0.05             0     0.01     0.02   0.03   0.04   0.05           0   0.01   0.02   0.03   0.04   0.05




                             Figure OA-4: Application 4: Second-Best Comparative Statics
                                                                                                      1    2
Note: Figure OA-4 illustrates relevant comparative statics of Application 4 for different values of k   = k  =  k . The
top left plot shows the price of capital in equilibrium q . The top middle plot shows investment at date 0 for both
                 1       2
investor types, k0 and k0  . The top right plot shows the amount of capital sold at date 1 for both investor types,
  1    1       2    2
k0  - k1 and k0  - k1 . The bottom left plot and the bottom middle plot show the distortions associated with the
                                        1      2                                          1       2
investment decisions of each investor, k  and k  , and the associated Pigouvian wedges, k   and k   . The bottom right
                                                      1               2
                                                    dk0             dk0
plot shows the leakage/policy elasticities          dk
                                                              and   dk
                                                                        .   The parameters used are described in Figure 4.




                                                                           OA-14
the (potentially consumer-type specific) taxes/subsidies and the transfer received by a type i consumer,
respectively. As a whole, the transfers must satisfy

                                                      i · xi =         i
                                                                      T0 .                                            (39)
                                                iI               iI


    An equilibrium, given corrective taxes/subsidies  i iI and lump-sum transfers T0         i
                                                                                               iI
                                                                                                  , consists of
                         i
consumption bundles x iI and prices p, such that i) investors maximize utility, Equation (37), subject
to budget constraint (38), ii) any revenue raised is returned back to investors, satisfying Equation (39), iii)
markets clear, that is, iI xi - ei = 0, and iv) consumption allocations are consistent in the aggregate,
that is, xi = xi , i.

Result Here we provide the counterpart of Proposition 1 in the text. As in Section 3, welfare is computed
in money-metric terms.

Proposition 11. [Marginal Welfare Effects of Corrective Regulation: Classical Consumer Theory] The
marginal welfare effects of varying the set of regulations  , dW
                                                              d , are given by

                                            dW   dx          dx
                                               =    ( -  ) =    ,                                                     (40)
                                            d    d           d

where dW                                     dx
       d is a vector of dimension L · I × 1, d is the square Jacobian matrix of policy elasticities of dimension
L · I × L · I , and  and  are vectors of dimension L · I × 1, where

                      1                     1                                    i                   i
                                                                                                         
                                                                                1                   1
                      .
                      .
                                            .
                                            .
                                                                                .
                                                                                .
                                                                                                    .
                                                                                                    .
                                                                                                         
                
                      .    
                           
                                   
                                            .   
                                                                   
                                                                                .    
                                                                                     
                                                                                             
                                                                                                    .    
                                                                                                         
                                                                 i                        i
               =      i     and  =          i   ,      where      =             i     and  =        i    ,
                                                                                                         
                      .                     .                                   .                   .
                                                                                                         
                
                      .
                      .    
                                   
                                            .
                                            .
                                                
                                                                   
                                                                                .
                                                                                .    
                                                                                     
                                                                                             
                                                                                                    .
                                                                                                    .
                                                                                                         
                                                                                                         
                      I                     I                                   Li                  i
                                                                                                    L

                           xi um (·)
and where  i = -      mI    m        .

Proof. First, we characterize the change in indirect utility of consumer-type i when varying the vector of
taxes/subsidies on consumer-type j :

     dV i   dxi                     dxm                    dxi     dp             d i i dxi i dT0  i
          =      i ui (·) +             xm ui (·) - i          p +     x i
                                                                           - ei
                                                                                +     x +      -
     d j    d j x                   d j                    d j     d j            d j     d j    d j
                               mI
            dxi                                      dxm                             dp             d i i dT0 i
          =     xi ui (·) - i p +  i        +            xm ui (·) - i                   x i
                                                                                             - ei
                                                                                                  +     x -       ,
            d j                                      d j                             d j            d j     d j
                                                mI
                               =0

                                                                dxi dxm     dp        d i
which follows from the Envelope Theorem when we define          d j , d j , d j , and d j as L × L Jacobians and
                           i                                             i
                         dT0                                                                                 dxi
x ui (·), x ui (·), and  d jas L × 1 gradient vectors.      Note that dV
                                                                       d j is a L × 1 vector and that we use d j
    dxi
and d j indistinctly going forward, since they are equal in equilibrium.
   Normalizing by the marginal value of wealth, we can express this change in money-metric terms as




                                                       OA-15
follows:
                          dV i
                          d j             dxm xm ui (·)   dp    i    i   d i i dT0 i
                                 =                      -     x   - e  -     x +     .
                           i              d j   i         d j            d j     d j
                                     mI


Now, adding up across consumer types, we have

                   dV i
                   d j                dxm xm ui (·)   dp                                   d i i dT0 i
                          =                         -                     xi - ei -            x -
                    i                 d j   i         d j                                  d j     d j
              iI              iI mI                                  iI               iI
                                           i      m                   i
                                      dx xi u (·)                  dx i
                          =                       +                     ,
                                      d j  m                       d j
                              iI mI                           iI

                                                                         i    i
where the second line follows from the market-clearing condition,    iI x - e   = 0, and the fact that
Equation (39) implies that
                                     d i i       dxi i        dT0 i

                                       j
                                         x +        j
                                                       -         j
                                                                    = 0.
                                     d           d            d
                                      iI               iI                 iI

Therefore, we can write the aggregate marginal welfare change in money metric terms as

                                                       dV i
                                          dW           d j             dxi i
                                              =               =             - i ,
                                          d j           i              d j
                                                  iI              iI


where
                                                                   xi um (·)
                                                  i = -                      ,
                                                                     m
                                                          mI

so Equation (40) follows immediately after stacking.




                                                              OA-16
