                                 NBER WORKING PAPER SERIES




                                 PAIRWISE KIDNEY EXCHANGE

                                             Alvin E. Roth
                                            Tayfun Sönmez
                                            M. Utku Ünver

                                         Working Paper 10698
                                 http://www.nber.org/papers/w10698


                       NATIONAL BUREAU OF ECONOMIC RESEARCH
                                1050 Massachusetts Avenue
                                  Cambridge, MA 02138
                                      August 2004




We would like to thank Anna Bogomolnaia, Frank Delmonico, Hervé Moulin, Muriel Niederle, Susan
Saidman, and Jen Stack for helpful comments and conversations. Sönmez gratefully acknowledges the
research support of KoçBank via the KoçBank scholar program and Turkish Academy of Sciences in the
framework of the Young Scientist Award Program via grant TS/TÜBA-GEBIP/2002-1-19, and Roth and
Ünver acknowledge support from the NSF. Any errors are our own responsibility. The views expressed
herein are those of the author(s) and not necessarily those of the National Bureau of Economic Research.

©2004 by Alvin E. Roth, Tayfun Sönmez, and M. Utku Ünver. All rights reserved. Short sections of text, not
to exceed two paragraphs, may be quoted without explicit permission provided that full credit, including ©
notice, is given to the source.
Pairwise Kidney Exchange
Alvin E. Roth, Tayfun Sönmez, and M. Utku Ünver
NBER Working Paper No. 10698
August 2004
JEL No. C7

                                           ABSTRACT


In connection with an earlier paper on the exchange of live donor kidneys (Roth, Sönmez, and Ünver

2004) the authors entered into discussions with New England transplant surgeons and their

colleagues in the transplant community, aimed at implementing a Kidney Exchange program. In the

course of those discussions it became clear that a likely first step will be to implement pairwise

exchanges, between just two patient-donor pairs, as these are logistically simpler than exchanges

involving more than two pairs. Furthermore, the experience of these surgeons suggests to them that

patient and surgeon preferences over kidneys should be 0-1, i.e. that patients and surgeons should

be indifferent among kidneys from healthy donors whose kidneys are compatible with the patient.

This is because, in the United States, transplants of compatible live kidneys have about equal graft

survival probabilities, regardless of the closeness of tissue types between patient and donor (unless

there is a rare perfect match). In the present paper we show that, although the pairwise constraint

eliminates some potential exchanges, there is a wide class of constrained-efficient mechanisms that

are strategy-proof when patient-donor pairs and surgeons have 0-1 preferences. This class of

mechanisms includes deterministic mechanisms that would accomodate the kinds of priority setting

that organ banks currently use for the allocation of cadaver organs, as well as stochastic mechanisms

that allow considerations of distributive justice to be addressed.

Alvin E. Roth                    Tayfun Sönmez             M. Utku Ünver
Department of Economics          Koc University            Koc University
Harvard University               Department of Economics   Department of Economics
Cambridge, MA 02138              College of Administrative College of Administrative
and NBER                         Sciences and Economics    Sciences and Economics
aroth@hbs.edu                    Rumeli Feneri Yolu        Rumeli Feneri Yolu
                                 Sariyer, Istanbul 34450   Sariyer, Istanbul 34450
                                 Turkey                    Turkey
1         Introduction
As of this writing, there are 58,480 kidney patients in the United States who are registered on
a waiting list for a transplant of a cadaver kidney.        The median waiting time is 1,144 days (for
registrations in 1999), and in 2003, 4,233 patients died while on the waiting list, or were removed
from it after having become too ill for a transplant. In 2003 there were 8,665 transplants of cadaver
kidneys.1
        Because healthy people have two kidneys (and can remain healthy on only one), it is also possible
for a kidney patient to receive a live-donor transplant. There were 6,464 live-donor transplants in
2003. However, a willing, healthy donor is not always able to donate to his intended patient, because
of blood type or immunological incompatibilities between them. In this case, most often, the donor
is sent home, and becomes once again invisible to the health care system.
        However, in a few cases, an exchange has been arranged between one incompatible patient-donor
pair and another. In such an exchange, the donor from each pair gives a kidney to the patient from
the other pair. Since 2001, there have been 6 such paired exchanges in the fourteen transplant
centers that make up the New England region (Allen, 2004), and, in the United States, there have
even been two exchanges among three incompatible patient-donor pairs.2 These exchanges do not
violate the 1984 National Organ Transplant Act (NOTA), which prohibits the sale or purchase of
human organs.3
        While there is a national database of tissue types of kidney patients, used for allocating cadaver
kidneys, there is no national (and few regional) databases of incompatible patient-donor pairs, despite
earlier proposals to set up such databases (Rapaport, 1986, Ross et al 1997).4               Nor is there a
systematic method used for arranging exchanges between incompatible pairs.
        Roth, Sönmez, and Ünver (2004) showed how to identify e¢ cient exchanges in a way that gave
patients and their surgeons dominant strategy incentives to straightforwardly reveal their preferences
(i.e. in a strategy-proof way). And, using tissue typing statistics from the Caucasian patient popu-
lation, Roth, Sönmez and Ünver (2004) showed that the bene…ts of such an exchange could be very
substantial, increasing live organ donations between unrelated donors from about 54% to as much as
91% if multiple-pair exchanges are feasible, and to as much as 75% even if only pairwise exchanges
    1
     United Network for Organ Sharing (UNOS) - The Organ Procurement and Transplantation Network (OPTN)
national data, retrieved on 6/12/2004 from http://www.optn.org/data.
   2
     As of this writing, both of these have been arranged at the Johns Hopkins Comprehensive Transplant Center in
Baltimore. Lucan et al (2003) also reports on three pair and four pair exchanges conducted in Romania.
   3
     See the legal opinion to this e¤ect obtained by the UNOS at http://asts.org/ezefiles/UNOSSection_301_NOTA_.pdf.
   4
     Some hospitals have started to generate their own databases of incompatible patient-donor pairs, that could be
used for exchanges. We are aware of such databases in Alabama, Baltimore (Johns Hopkins) and Ohio (Medical
College of Ohio).



                                                      2
are feasible.5
       In subsequent discussions aimed at organizing such exchange in the New England region of the
transplant system, it became clear that a likely …rst step will be to implement pairwise exchanges,
between just two patient-donor pairs, as these are logistically simpler than exchanges involving more
than two pairs. That is because, all transplantations in an exchange need to be carried out simulta-
neously, for incentive reasons, since otherwise a donor may withdraw her consent after her intended
recipient receives a transplanted kidney (and so even a pairwise exchange involves four simultaneous
surgical teams, operating rooms, etc.). Furthermore, the experience of American surgeons suggests to
them that patient and surgeon preferences over kidneys should be 0-1, i.e. that patients and surgeons
should be indi¤erent among kidneys from healthy donors that are blood type and immunologically
compatible with the patient.6          This is because, in the United States, transplants of compatible
live kidneys have about equal graft survival probabilities, regardless of the closeness of tissue types
between patient and donor (Gjertson and Cecka (2000) and Delmonico (2004)).7
   The present paper explores how to organize such exchanges. While the constraint that only
pairwise exchanges be conducted means that the number of live donor transplants that can be
arranged by exchange is smaller than if larger exchanges are feasible, it is still substantial. And, in
the constrained problem, e¢ cient and strategy-proof mechanisms will be shown to exist. This class
of mechanisms includes deterministic mechanisms that would accommodate the kinds of priority
setting that organ banks currently use for the allocation of cadaver organs, and which therefore may
be especially appealing to transplant organizations. Also included are random matching mechanisms,
such as the egalitarian mechanism, a stochastic mechanism that arises in connection with elementary
notions of distributive justice. Interestingly, the constrained exchange problem is closely related
to elegant results from graph theory, which will prove very useful, in ways recently pioneered by
Bogomolnaia and Moulin (2004).
   5
     Subsequent investigation of a database constructed by Dr. Susan Saidman of Massachusetts General Hospital, of
patients who had an incompatible donor (and who were consequently on the waiting list for a cadaver kidney), showed
that 18% of them could participate in live donor exchanges involving only paired exchanges among patient-donor pairs
in the database, and 27% could receive transplants if larger exchanges among them were feasible.
   6
     Bogomolnaia and Moulin (2004), on whose work the present paper builds, refer to such preferences (in settings
quite di¤erent than kidney exchange) as dichotomous. That the surgeons with whom we are working on implementing
kidney exchange have dichotomous preferences was forcefully brought to our attention when we began to work with
Dr. Saidman’s database of current patients with incompatible donors.
   7
     This is contrary to the “European” view which maintains that the graft survival rate increases as the tissue type
mismatch decreases. See Opelz (1997, 1998).




                                                          3
1.1       Related Literature
This paper intersects with the literatures on transplantation, graph theory, and mechanism design.
The idea of paired kidney exchange between one incompatible patient-donor pair and another was
…rst proposed by Rapaport (1986) and then again by Ross et al (1997). UNOS initiated pilot testing
of a paired kidney exchange program in 2000, and the same year the transplantation community
issued a consensus statement indicating that the paired kidney exchange program is considered to
be “ethically acceptable”(Abecassis et al 2000).
       While the transplantation community approved the use of kidney exchanges to increase live kidney
donation, it has provided little guidance about how to organize such exchanges. Roth, Sönmez and
Ünver (2004) proposed an e¢ cient and strategy-proof mechanism that uses both pairwise and larger
exchanges. The present paper di¤ers from Roth, Sönmez and Ünver (2004) in two major ways:

   1. Here we only consider exchanges involving two patients and their donors.

   2. In the current paper we adopt the assumption of many American transplant surgeons (includ-
      ing those we are working with in New England) that each patient is indi¤erent between all
         compatible kidneys (cf. Gjertson and Cecka (2000) and Delmonico (2004)).

       These two assumptions considerably change the mathematical structure of the kidney exchange
problem, and e¢ cient exchange becomes an application of what is known in the graph theory lit-
erature as the cardinality matching problem (see for example Korte and Vygen (2002)).8 For
this purpose consider an undirected graph whose vertices each represent a particular patient and her
incompatible donor(s), and whose edges connect those pairs of patients between whom an exchange
is possible, i.e. pairs of patients such that each patient in the pair is compatible with a donor of the
other patient. Finding an e¢ cient matching then reduces to …nding a maximum cardinality matching
in this undirected graph (see Lemma 1), a problem well analyzed in this literature. More speci…cally
the Gallai (1963,1964)-Edmonds (1965) Decomposition Lemma (henceforth GED Lemma) character-
izes the set of maximum cardinality matchings. Technical aspects of our contribution heavily build
on the GED Lemma.
   We …rst concentrate on deterministic outcomes, and show that there exists a wide class of e¢ cient
and strategy-proof mechanisms that accommodate the kinds of priority setting that organ banks
currently use for the allocation of cadaver organs. We then allow stochastic outcomes as well,
and show that there exists an e¢ cient and strategy-proof mechanism, the egalitarian mechanism,
   8
   If we instead only consider exchanges involving two pairs (as in this paper) but assume strict preferences over
compatible kidneys (as in Roth, Sönmez and Ünver (2004)), the problem becomes an application of what is known as the
roommates problem (Gale and Shapley (1962)). See Abeledo and Rothblum (1994), Chung (2000), Diamantoudi,
Miyagawa and Xue (2004) and Teo and Sethuraman (2000).


                                                         4
which equalizes as much as possible the individual probabilities of receiving a transplant. If stochastic
mechanisms can be accepted by the transplantation community, this mechanism can serve as a basis
for discussion of how to address equity issues while achieving e¢ ciency and strategy-proofness.
   Our paper builds on the closely related recent paper by Bogomolnaia and Moulin (2004). They
considered two-sided matching i.e. matching between two sets of agents that can be speci…ed exoge-
nously (e.g. …rms and workers), such that an agent on one side of the market can only be matched
with an agent on the other side (cf. Roth and Sotomayor 1990), modeled as a bipartite graph, with
0-1 preferences. It was their paper that made us aware of some of the graph-theoretic results that
we also use here. Our results on the egalitarian mechanism generalize their corresponding results to
general, not necessarily bipartite graphs. Kidney exchange cannot be modelled as a two-sided mar-
ket, since any patient with incompatible donors can potentially be matched with any other.9 The
extensions to the general case are of interest not only because of the importance of the application,
but also because of the technical challenges that the generalization to arbitrary graphs presents.


2        Pairwise Kidney Exchange
Let N = f1; 2; :::; ng be a set of patients each of whom has one or more incompatible donors. Each
patient is indi¤erent between all compatible donors and between all incompatible donors, except she
strictly prefers her donor(s) to any other incompatible donor, and any compatible donor to her own
donor(s). Since we are considering only pairwise exchanges in this paper, the above assumptions
induce the following preference relation %i for patient i over the set of patients N :

    1. For any patient j with a compatible donor for patient i we have j              i   i,

    2. for any patient j without any compatible donor for patient i we have i                  i   j;

    3. for any patients j; h each of whom has a compatible donor for patient i we have j                i   h;

    4. for any patients j; h neither of whom has a compatible donor for patient i we have j                  i   h:

        Here   i   denotes the strict preference relation and   i   denotes the indi¤erence relation induced by
%i . A (pairwise kidney exchange) problem is a pair (N; %) where %= (%i )i2N denotes the list
of patient preferences.
    9
    Note that, since each donor comes to the exchange in the company of his incompatible patient, there isn’t an
option of modeling a two-sided market in which the sides are donors and patients. There is a very small population
of undirected donors, who wish to donate but not to a speci…c patient, and such a formulation might be applicable to
them, but we do not consider such unattached donors here.




                                                         5
       Throughout the paper with the exception of the proofs of the results on incentives, we …x a
problem (N; %).
       We consider the case in which an exchange can involve only two pairs. Patients i; j 2 N are
mutually compatible if i j j and j i i. That is, two patients are mutually compatible if each
one has a donor whose kidney is compatible for the other patient.
       A matching      : N ! N is a function such that:

                            (i) = j () (j) = i for any pair of patients i; j 2 N:

A matching         is individually rational if for any patient i 2 N

                                               (i) 6= i ) (i)     i   i.

Let M be the set of individually rational matchings for the problem (N; %). Throughout the paper
we consider only individually rational matchings. That is, exchange is possible only between mutually
compatible patients. A matching denotes an individually rational matching throughout the rest of
the paper.
       For each matching      2 M and patient i 2 N ,           (i) = i means that the patient i remains
              10
unmatched. For any matching 2 M and pair of patients i; j 2 N , (i) = j means that patient
i receives a compatible kidney from a donor of patient j and patient j receives a compatible kidney
from a donor of patient i. Since exchange is possible only among mutually compatible pairs, it is
su¢ cient for our purposes to keep track of the symmetric jN j by jN j mutual compatibility matrix
R = [ri;j ]i2N;j2N de…ned by
                                               (
                                                   1 if j i i and i        j   j
                                      ri;j =
                                                   0 otherwise
for any pair of (not necessarily distinct) patients i; j 2 N .
    We will refer to the pair (N; R) as the reduced problem of (N; %). Occasionally it will be helpful
to think of the reduced problem as a graph G = (N; R) whose vertices N are the patients (and their
incompatible donors), and whose edges R are the connections between mutually compatible pairs of
patients; i.e. there is an edge (i; j) 2 R if and only if ri;j = 1. (It will be clear from the context
whether R is the mutual compatibility matrix or the set of edges indicating mutual compatibility.)
A matching then can be thought of as a subset of the set of edges such that each patient can appear
in at most one of the edges. With this alternative representation
  10
    A patient who is unmatched does not receive a live-donor transplant, nor does her donor donate a kidney. Such
a patient may wait for a cadaver kidney, or the patient and incompatible donor may participate in an exchange
arranged at a later date when other incompatibe patient-donor pairs have become available. Note that when a patient
is matched, only one of her donors donates a kidney (no matter how many incompatible donors the patient has).


                                                         6
    1. if (i; j) is an edge in the matching , patients i and j are matched by        and,

    2. if patient i does not appear in any edge in the matching , she remains unmatched.

    A mechanism is a systematic procedure that selects a matching for each problem.


3     E¢ cient Exchange
A matching     2 M is Pareto-e¢ cient if there exists no other matching            2 M such that (i) %i
 (i) for all i 2 N and (i)     i    (i) for some i 2 N . In the present setting,   is Pareto e¢ cient if and
only if the set M = fi 2 N : (i) 6= ig of patients matched by is maximal, i.e. if there does not
exist any other matching 2 M such that M        M . Let E be the set of Pareto-e¢ cient matchings
for the problem (N; %) :
    A well known result from abstract algebra will help clarify the structure of the set of e¢ cient
matchings (see e.g. Lovasz and Plummer, 1986 on matchings, and Korte and Vygen, 2002 on ma-
troids).
    A matroid is a pair (X; I) such that X is a set and I is a collection of subsets of X (called the
independent sets) such that

M1        if I is in I and J       I then J is in I; and

M2        if I and J are in I and jIj > jJj then there exists an i 2 InJ such that I [ fig is in I.

Proposition 1 Let I be the sets of simultaneously matchable patients, i.e. I = fI             N :9 2M
such that I    M g. Then (N; I) is a matroid.

    For any matching       2 M, let j j = jM j = jfi 2 N : (i) 6= igj denote the number of patients
who are matched with another patient. The following well known property of matchings, which
follows immediately from the second property of matroids, states that the same number of patients
will receive a transplant at every Pareto-e¢ cient matching.

Lemma 1 For any pair of Pareto-e¢ cient matchings ; 2 E, j j = j j.

    If exchange is possible among more than two pairs, the conclusion of Lemma 1 no longer holds.
Example 1 Let N = f1; 2; 3; 4g and suppose preferences are such that

                                                2   1   4   1   1   1   3
                                                3   2   2   2   1   2   4
                                                1   3   3   3   2   3   4
                                                1   4   4   4   2   4   3

                                                        7
Consider the following two Pareto e¢ cient trades:

      Patient 1 receives a kidney from a donor of Patient 4 and Patient 4 receives a kidney from a
      donor of Patient 1. (This is the only possible pairwise trade, since only Patients 1 and 4 are
      mutually compatible.)

      Patient 1 receives a kidney from a donor of Patient 2, Patient 2 receives a kidney from a donor
      of Patient 3, and Patient 3 receives a kidney from a donor of Patient 1.

   Two patients receive transplants if the …rst trade is carried out whereas three patients receive
transplants if the second trade is carried out.



3.1    Priority Mechanisms
Because there is presently no organized exchange of live-donor kidneys, the experience of transplant
centers is mostly with the priority allocation systems used to allocate cadaver organs. It is therefore
natural to consider how priority mechanisms would function in the context of live kidney exchange.
   A priority ordering is a permutation of patients such that the k th patient in the permutation
is the patient with the k th priority. Without loss of generality let the priority ordering of patients be
the natural ordering (1; 2; :::; n), i.e. patient k is the k th priority patient for each k.
   While we will concentrate on ordinal priorities here, priorities may depend on quanti…able patient
characteristics such as the patient’s “percent reactive antibody”(PRA), which is correlated with how
di¢ cult it will be to …nd a compatible kidney for that patient. (So it might be desirable, for example,
for a high PRA patient to have a high priority for a compatible kidney in the relatively rare event
that one becomes available.) In general, we will say that a non-negative function : N ! R+ is a
priority function if it is increasing in priority, i.e. if (i)    (i + 1).
   Consider a transplant center T whose decision makers wish to …nd the set of exchanges that
maximizes a preference T de…ned over matchings (more speci…cally, over sets of matched patients).
We will say that T is a priority preference if it is responsive to the priority ordering (Roth,
1985), i.e. if     T    whenever M         M , or when M and M di¤er in only one patient, i.e.
M nM = fig; M nM = fjg, for some i; j 2 N , and i < j. That is, whenever M and M
di¤er in only one patient, the matching with the higher priority patient is preferred, and adding
additional matched patients to an existing matching always results in a preferred matching. (For a
given priority ordering of patients, there remain many possible priority preferences       T   over sets of
matched patients.)
    A priority mechanism produces a match as follows, for any problem (N; R) and priority ordering
(1; 2; :::; n) among the patients:

                                                    8
     Let E 0 = M (i.e. the set of all matchings).

     Let E 1   E 0 be such that
                              (
                                      f 2 E 0 : (1) 6= 1g           if 9 2 E 0 s.t.         (1) 6= 1
                          E1 =
                                              E0                    otherwise

     In general for k    n, let E k     Ek   1
                                                 be such that
                             (
                                      2 Ek   1
                                                 :     (k) 6= k     if 9 2 E k   1
                                                                                     s.t.     (k) 6= k
                        Ek =                     k 1
                                             E                      otherwise

   For a given problem (N; R) and priority ordering (1; 2; :::; n), we refer to each matching in E n as a
priority matching, and a priority mechanism is a function which selects a priority matching for
each problem. A priority matching matches as many patients as possible starting with the patient
with the highest priority and following the priority ordering, never “sacri…cing” a higher priority
patient because of a lower priority patient.
   By construction, a priority matching is maximal, and hence Pareto-e¢ cient, i.e. E n                  E. Propo-
sition 1 implies, through the second property of matroids, that the “opportunity cost”of matching a
higher priority patient will never be more than one lower priority patient who could otherwise have
been matched. (For example, there might be two patients each of whom is mutually compatible only
with the same third patient, and so matching the higher priority of the two patients will preclude
matching the lower priority patient. But it cannot happen that, by matching a higher priority pa-
tient, two lower priority patients are excluded who otherwise could both have been matched.) And
of course, by Lemma 1, the same total number of patients will be matched at each Pareto-e¢ cient
matching, so there is no trade-o¤ between priority allocation and the number of transplants that can
be arranged. In the matroid literature, a priority mechanism is called a greedy algorithm (since it
“greedily”takes the highest priority remaining patient at each stage). The following proposition by
Rado(1957) and Edmonds (1971) from the matroid literature will be helpful in understanding the
resulting priority matchings.

Proposition 2 For a matroid (N; I) and any priority function                          on N , a priority matching
(obtained by a greedy algorithm with respect to                 ) identi…es an element M of I that maximizes
P
  i2I (i) over all I 2 I.


   Example 1 shows that if larger exchanges were permitted, the conclusions of Proposition 2 would
not carry over (e.g. suppose that patient 4 has the highest priority, so the priority mechanism chooses
the pairwise trade even if the 3-way trade has a higher sum of priorities).

                                                            9
   For ordinal priorities, Proposition 2 allows us to quickly prove the following corollary, which
helps explains the appeal that priority algorithms may have to transplant centers accustomed to
prioritizing their patients.

Corollary 1 For any priority preference       T   a priority matching   maximizes     T   on the set of all
matchings, i.e.      T   for all   2 M.

3.1.1   Incentives in priority mechanisms

We turn next to consider the incentives facing patients (and the surgeons advocating for them) in
a priority matching mechanism. Two apparently di¤erent issues arise that, upon examination, turn
out to be closely related. The …rst has to do with patients who have multiple incompatible donors
willing to donate on their behalf. We show that a patient maximizes her chance of being included
in an exchange by revealing all of her willing donors.      The second issue involves revealing which
compatible kidneys the patient is willing to accept. Again, we show that a patient maximizes her
chance of being able to take part in an exchange by accepting her full set of compatible kidneys.
That is, we show that with respect to both donors and kidneys, priority mechanisms do not give
participants perverse incentives, but rather make it a dominant strategy to fully reveal which willing
donors are available, and which kidneys are acceptable.
  These two conclusions have the same cause. A patient enlarges the set of other patients with
whom she is mutually compatible by coming to the exchange with more donors, and by being able
to accept a kidney from more of those other patients’donors. And a patient’s probability of being
included in an exchange is monotonic in the set of other patients with whom she is compatible.
    For a given set of patients and their available donors, the basic data for the problem (N; R) is
determined by the tissue typing laboratory. So, once each patient has revealed a set of donors, the
tissue typing lab establishes for each patient i a set of compatible kidneys Ki = fj 2 N : rij = 1g.
But a kidney exchange is a complicated event involving a patient and a donor on each side of the
exchange, and so there will be no way to prevent a patient from declining a medically compatible
kidney (e.g. for logistical reasons such as location of the other patient-donor pair, or, for that matter,
for unspeci…ed reasons related e.g. to the preferences of the patient’s donor). So the strategy set
of each agent (i.e. each patient and donor, or each surgeon acting on behalf of a patient) is the
set of all possible subsets of acceptable kidneys Ai Ki that she might declare. (A kidney that is
declared not acceptable can be thought of as being incompatible for reasons not initially revealed
by the medical data.) A mechanism can only arrange exchanges between patient-donor pairs who
are willing to accept each other’s donor kidneys. A mechanism is strategy-proof in this dimension
if a patient’s probability of being included in an exchange with a compatible donor is maximized


                                                    10
by declaring truthfully that Ai = Ki .11          That is, a patient would have an incentive to declare a
smaller acceptable set Ai        Ki only if this could cause the mechanism to include the patient in an
exchange when truthful revelation of preferences (Ai = Ki ) would not. The …rst part of Theorem
1 states that a patient can never bene…t by declaring a compatible kidney to be unacceptable under
a priority mechanism.12 The second part states the similar result for revelation of available donors.

Theorem 1 A priority mechanism makes it a dominant strategy for a patient to reveal both a) her
full set of acceptable kidneys; and b) her full set of available donors.

   The proof of Theorem 1 a) is contained in the Appendix. The proof of part b) follows quickly from
the proof of part a). In particular, a mechanism is donor-monotonic if a patient never su¤ers from
the addition of one additional (incompatible) donor for her. The addition of one extra donor for a
patient has the e¤ect of enlarging her set of mutually compatible patients. But the proof of part a) of
Theorem 1 shows that a patient never su¤ers from enlarging her set of mutually compatible patients
in a priority mechanism, which therefore implies that priority mechanisms are donor monotonic in
pairwise kidney exchange.

Corollary 2 A priority mechanism is donor-monotonic.

       Looking ahead to implementation of actual kidney exchanges, it is worth emphasizing some
limits on what these results establish. The motivations for donating a kidney to a loved one may
be complex. When multiple potential donors prove to be incompatible, there may still be complex
family preferences involved in going forward with an exchange, e.g. a family might prefer to have
a sibling donate a kidney to its patient only after the possibility of a parent’s donation had been
exhausted, and such a family might prefer to initially look for an exchange by only revealing the
availability of the parent as a donor. Theorem 1 b) does not rule out this possibility. Similarly,
it might be that, even if a patient is willing to accept all compatible kidneys, her donor is for some
reason unwilling to donate a kidney to some of the patients who are compatible with him (i.e. with
  11
     For simplicity here we assume that all compatible kidneys are in fact acceptable, i.e. that patients do not have
logistical or other concerns not already re‡ected in the mutual compatibility matrix R. More generally, we are
considering a system in which patients may freely indicate in advance that there are some kidneys that they will not
accept, but cannot back out of an exchange for a kidney that they have already indicated is acceptable without paying
an unacceptably high cost (e.g. because this would mean that they could not participate in the current exchange and
might receive very low priority for future exchanges). Consequently we do not consider any strategies at which a
patient declares unacceptable kidneys to be acceptable, but only strategies in which patients may choose which set of
acceptable kidneys to reveal.
  12
     See Roth (1982a, 1982b), Svensson (1994, 1999), Abdulkadiro¼   glu and Sönmez (1999, 2003b), Bogomolnaia, Ehlers
and Deb (2000), Papai (2000), Ehlers (2002), Ehlers, Klaus and Papai (2002), and Ehlers and Klaus (2003), for
strategy-proofness in various related models with indivisibilities.


                                                         11
his kidney), which would reduce the set of acceptable kidneys in a way not precluded by Theorem
1 a).13 What Theorem 1 does establish is that a priority mechanism introduces no new reasons for
available donors to be concealed, or compatible kidneys to be rejected.


3.2       Gallai-Edmonds Decomposition
The structure of Pareto-e¢ cient pairwise matchings has been an active area of research in the com-
binatorial optimization literature. Understanding this structure will both enable us to gain added
insight into priority mechanisms and allow us to apply a central concept in distributive justice -
egalitarianism - to pairwise kidney exchange. The following partition of the set of patients is key to
the structure of the set of Pareto-e¢ cient matchings. Partition N as fN U ; N O ; N P g such that

                             N U = fi 2 N : 9 2 E s.t.           (i) = ig ,
                             NO =        i 2 N nN U : 9j 2 N U s.t. ri;j = 1 , and
                             NP = Nn NU [ NO .

N U is the set of patients for each of whom there is at least one Pareto-e¢ cient matching which leaves
her unmatched. N O is the set of patients each of whom is not in N U (i.e., each of whom is matched
with another patient at each Pareto-e¢ cient matching) but is mutually compatible with at least one
patient in N U . N P is the set of remaining patients (i.e., the set of patients who are matched with
another patient at each Pareto-e¢ cient matching and who are not mutually compatible with any
patient in in N U ).
    Consider the reduced problem (N; R). For I      N , let RI = [ri;j ]i2I;j2I . We refer to the pair
(I; RI ) as the reduced subproblem restricted to I.
       A reduced subproblem (I; RI ) is connected if there exists a sequence of patients i1 ; i2 ; :::; im
(possibly with repetition of patients) such that rik ;ik+1 = 1 for all k 2 f1; 2; :::; m              1g and I =
fi1 ; i2 ; :::; im g :
     A connected reduced subproblem (I; RI ) is a component of (N; R) if ri;j = 0 for any i 2 I and
j 2 N nI:
       We refer to a component (I; RI ) as an odd component if jIj is odd and as an even component
if jIj is even. The following result due to Gallai (1963, 1964) and Edmonds (1965) is central to our
paper:

Lemma 2 (Gallai-Edmonds Decomposition Lemma) Let (I; RI ) be the reduced subproblem
with I = N nN O and let        be a Pareto-e¢ cient matching for the original problem (N; R).
  13
    Donations of cadaver organs are often carried out under a screen of anonymity. This will be more di¢ cult in the
case of live donor exchange, since the full medical history of each donor will be an essential part of such exchange.


                                                         12
   1. For any patient i 2 N O ; (i) 2 N U .

   2. For any even component (J; RJ ) of (I; RI ) ; J             N P and for any patient i 2 J, (i) 2 Jn fig.

   3. For any odd component (J; RJ ) of (I; RI ), J               N U and for any patient i 2 J it is possible
         to match all remaining patients in J with each other (so that any patient j 2 Jn fig can be
         matched with a patient in Jn fi; jg).
         Moreover for any odd component (J; RJ ), either

          (a) one and only one patient i 2 J is matched with a patient in N O under the Pareto-e¢ cient
              matching     whereas all remaining patients in J are matched with each other so that                (j) 2
              Jn fi; jg for any patient j 2 Jn fig, or
          (b) one patient i 2 J remains unmatched under the Pareto-e¢ cient matching whereas all
              remaining patients in J are matched with each other so that (j) 2 Jn fi; jg for any
              patient j 2 Jn fig :

       Based on the Gallai-Edmonds Decomposition Lemma (GED Lemma), we refer to N U as the set
of underdemanded patients, N O as the set of overdemanded patients and N P as the set of
perfectly matched patients.14
  A Pareto-e¢ cient matching matches each perfectly matched patient with another perfectly
matched patient in the same even component; each overdemanded patient is matched with an under-
demanded patient; and one patient in each odd component is either matched with an overdemanded
patient or remains unmatched, whereas the remaining underdemanded patients in the same odd
component are matched with one another. So each even component is self su¢ cient whereas the odd
components compete for the overdemanded patients.
       Let D = fD1 ; D2 ; :::; Dp g be the partition of the set of underdemanded patients N U such that
 Dk ; RDk is an odd component of N nN O ; RN nN O               for all k 2 f1; 2; :::; pg :
       The following is an immediate implication of the GED Lemma:

Corollary 3 jDj > N O whenever N U is nonempty, and j j = jN j                        jDj      NO    for each Pareto-
e¢ cient matching .

       That is, the e¢ cient matchings each leave unmatched jDj              N O patients, each one in a distinct
odd component. Note that Lemma 1 is an immediate corollary to the GED Lemma as well.
  14
    Edmonds (1965) introduced the …rst polynomial-time algorithm for construction of an e¢ cient matching and
construction of partition fN U ; N O ; N P g of N . Faster algorithms were introduced in later dates. An excellent survey
of combinatorial matching theory including e¢ cient matching algorithms are given in Lovász and Plummer (1986).



                                                           13
3.3       The Induced Two-Sided Matching Market
Loosely speaking there is competition at two levels: At the …rst level, odd components (of under-
demanded patients) compete for overdemanded patients. With the addition of an overdemanded
patient to an odd component, all the patients in the augmented odd component can be matched to
one another. The second level of competition is between the members of odd components that do
not secure an overdemanded patient. If the odd component is of size one, its member will remain
unmatched, but members of each larger odd component compete against each other not to be the
one patient in the component who remains unmatched.
  In this subsection we focus on the …rst level of competition, between odd components for overde-
manded patients. Since this competition does not involve perfectly matched patients (who are all
matched to one another at every e¢ cient outcome), we will not need to consider them for this discus-
sion. Instead, we focus on an “induced” two-sided market, one side consisting of the overdemanded
patients, and the other side consisting of the (odd) components of underdemanded patients.15
   For each odd component J 2 D and overdemanded patient i 2 N O , let
                                        (
                                           1 if 9 j 2 J s.t. ri;j = 1
                                r~i;J =
                                           0 otherwise

and let R~ = [~
              ri;J ]i2N O ;J2D . Whenever r~i;J = 1 for i 2 N O and J 2 D, we say there is a link between
patient i and set J.
   Given the problem (N; %) ; we refer to the triple N O ,D; R     ~ as the induced two-sided match-
ing market.
       A pre-matching is a function ~ : N O [ D ! N O [ D [ f;g such that

   1. ~ (i) 2 D [ f;g for any i 2 N O ,

   2. ~ (J) 2 N O [ f;g for any J 2 D,

   3. ~ (i) = J , ~ (J) = i for any pair i 2 N O , J 2 D, and

   4. ~ (i) = J ) r~i;J = 1 for any pair i 2 N O , J 2 D.
    f denote the set of pre-matchings.
Let M
   A pre-matching ~ 2 M f is e¢ cient if it assigns each overdemanded patient i 2 N O to an odd
component J 2 D. Let E~ be the set of e¢ cient pre-matchings. Note that E~ is non-empty by the
GED Lemma.
  15
    So the induced two-sided matching market di¤ers from natural two-sided markets (such as the medical labor
market studied in Roth, 1984) in two ways. First, one of the sides is made up not of individual patients (and
their donors), but of groups (odd components) of patients (and their donors). Second, these sides aren’t speci…ed
exogenously, but are determined by the preferences (compatibilities) of the patients.

                                                       14
3.4    Priority Mechanisms Revisited
The GED Lemma allows us to see in detail how competition for compatible kidneys plays out in
priority mechanisms. The outcome of a priority mechanism is Pareto-e¢ cient and by the GED
Lemma, each overdemanded as well as each perfectly matched patient is matched at each Pareto-
e¢ cient matching. So the competition in a priority mechanism is among the underdemanded patients.
Moreover, for any odd-component J and any patient j 2 J, it is possible to match all patients in
Jn fjg among themselves. So a priority mechanism determines which odd components will be fully
matched (one member with an overdemanded patient and remaining patients with each other) and
which odd components will have all but one of its patients matched (all with each other). This will
depend on the relative priority ordering among the set of patients each of whom is the lowest priority
patient at an odd component.
   For each odd component J 2 D, let `J 2 J be the lowest priority patient in J. Since if any patient
is unmatched the remaining patients in each odd component can be matched among themselves, all
patients in N U n f`J : J 2 Dg will be matched at each priority matching (i.e. if a patient remains
unmatched at an odd component, she will be the lowest priority patient in the odd component).
Relabel odd components in D such that D1 2 D hosts the highest priority patient in f`J : DJ 2 Dg,
D2 2 D hosts the second highest priority patient in f`J : DJ 2 Dg, and so on (i.e. the components
are ordered in priority order of their lowest priority patient). For each J D and I     N O , de…ne
the neighbors of the set of odd components J among overdemanded patients in I as

                             C (J ; I) = fi 2 I : 9J 2 J with r~i;J = 1g :

That is, each overdemanded patient in C (J ; I) is mutually compatible with at least one patient in
S
  J2J J. Which odd components will be fully matched and which ones will have all but its lowest
priority member matched will be determined by the hierarchy among the odd components (where the
priority of an odd component is determined by the priority of its lowest priority member) together
with the following version of Hall’s Theorem (Hall (1935)):

Hall’s Theorem: Let J         D. There exists a pre-matching which matches all odd components in
J with a distinct overdemanded patient in N O if and only if

                                  8J 0   J,    C J 0 ,N O      jJ 0 j .



   Under the priority mechanism, odd components D1 ; D2 ; :::; Dp are considered one at a time and
the following iterative procedure will determine which odd components will have all its members
matched and which ones will have all but its lowest priority member matched.

                                                  15
Step 1.

         If C fD1 g ; N O         jfD1 gj = 1 then let J1 = fD1 g and in this case all members of D1 will
         be matched.

         If C fD1 g ; N O       < jfD1 gj = 1 then let J1 = ; and in this case all members of D1 except its
         lowest priority patient `1 will be matched.

In general, at
Step k.

         If C J [ fDk g ; N O          jJ [ fDk gj for every J    Jk       1   then let Jk = Jk       1   [ fDk g and in
         this case all members of Dk will be matched.

         If C J [ fDk g ; N O        < jJ [ fDk gj for some J    Jk    1   then let Jk = Jk       1   and in this case
         all members of Dk but its lowest priority patient `k will be matched.


4        Stochastic Exchange
So far our emphasis has been on deterministic exchange. One important tool to achieve equity
in resource allocation problems with indivisibilities is using lotteries and allowing for stochastic
outcomes.16
       A lottery    = (     )   2M  is a probability distribution over the set of matchings M. For each
                                                                                     P
matching       2 M,       2 [0; 1] is the probability of matching in lottery , and       2M   = 1: Let L
be the set of lotteries for the problem (N; %).
   A stochastic mechanism is a systematic procedure that selects a lottery for each problem.
       Given a lottery      2 L, the allocation matrix A ( ) = [ai;j ( )]i2N;j2N summarizes the total
probability that patient i will be matched with patient j for any pair of patients i; j 2 N . Note
that two distinct lotteries can induce the same allocation matrix. Let A be the set of all allocation
matrices for the problem (N; %) : That is, A = fA ( )g 2L .
       Each lottery (and hence each allocation matrix) speci…es the probability that each patient will
receive a transplant. Given a lottery            2 L, de…ne the utility of patient i to be the aggregate
probability that she receives a transplant. Given       2 L, the induced utility pro…le is a non-
                                                           P
negative real vector u ( ) = (ui ( ))i2N such that ui ( ) = j2N ai;j ( ) for any patient i 2 N . Let
U be the set of all feasible utility pro…les for the problem (N; %) : That is, U = fu ( )g                  2L .
  16
    For other discussions of stochastic matching, see Roth and Vande Vate (1990), Roth, Rothblum and Vande Vate
(1993), Roth and Xing (1997), Abdulkadiro¼ glu and Sönmez (1998, 2003a), Bogomolnaia and Moulin (2001), Cres and
Moulin (2001), and Sönmez and Ünver (2001).

                                                        16
   A lottery is ex-post e¢ cient if its support is a subset of the set of Pareto-e¢ cient matchings.
That is, lottery       2 L is ex-post e¢ cient if   > 0 implies   2 E.
   An allocation matrix A 2 A is ex-ante e¢ cient if there exists no allocation matrix B 2 A such
    P            P                             P           P
that j2N bi;j       j2N ai;j for all i 2 N and  j2N bi;j >  j2N ai;j for some i 2 N .
   A utility pro…le u 2 U is e¢ cient if there exists no other utility pro…le v 2 U such that vi ui
for all i 2 N and vi > ui for some i 2 N .
   An immediate implication of Lemma 1 (as well as the GED Lemma) is the “equivalence” of
ex-ante and ex-post e¢ ciency in the present context. This result is also stated by Bogomolnaia and
Moulin (2004).

Lemma 3 An allocation matrix A 2 A is ex-ante e¢ cient if and only if there is an ex-post e¢ cient
lottery 2 L such that A( ) = A.

    The notions for the induced two-sided matching market N O ; D; R    ~ can be similarly extended
to allow for stochastic outcomes.
    A pre-lottery ~ = ~ ~                                                                     f Let
                                  is a probability distribution over the set of pre-matchings M.
                                     f
                                  ~ 2M
L~ be the set of all pre-lotteries.
    A pre-allocation (matrix) A=[~  ~ ai;J ] O
                                            i2N ;J2D is a non-negative valued matrix such that

       P
  1.    J2D   a
              ~i;J     1 for any i 2 N O ,
       P
  2.    i2N O   a
                ~i;J    1 for any J 2 D, and

     ~i;J > 0 ) r~i;J = 1 for any pair i 2 N O , J 2 D:
  3. a

Let Ae be the set of all pre-allocations.
   A pre-lottery ~ 2 L~ induces the pre-allocation A~ 2 Ae if for each pair i 2 N O and J 2 D, a
                                                                                               ~i;J is
the cumulative probability that patient i 2 N O is matched with set J 2 D under the pre-lottery ~ .
By Lemma 2.1 in Bogomolnaia and Moulin (2002), for each pre-allocation there is a pre-lottery that
induces it.
   A pre-lottery ~ 2 L~ is ex-post e¢ cient if its support is a subset of the set of e¢ cient pre-
matchings. That is, pre-lottery ~ is ex-post e¢ cient if

                                               ~ ~ > 0 ) ~ 2 E:
                                                             ~

Pre-matchings, pre-lotteries and pre-allocations will be very useful in our analysis.




                                                      17
4.1       The Egalitarian Mechanism
It is rare that a cardinal representation of preferences, i.e. a utility function, has a direct interpreta-
tion in a resource allocation problem. In the present context, however, a patient’s utility corresponds
to the probability that she receives a transplant, and thus equalizing utilities as much as possible be-
comes very plausible from an equity perspective. This approach is widely known as egalitarianism
in distributive justice.17 In this section we analyze the egalitarian mechanism. The GED Lemma
will be key to the construction of egalitarian utilities.
       Recall that C (J ; I) denotes the neighbors of the set of odd components J                   D among overde-
                             O                                    O
manded patients I         N . For each J          D and I       N , de…ne a real-valued function f through

                                                  j[J2J Jj     (jJ j jC (J ; I)j)
                                    f (J ; I) =                                   :
                                                              j[J2J Jj

Recall that at most one patient in each odd component remains unmatched at every Pareto-e¢ cient
                                                                   S
matching and therefore no more than jJ j patients among patients in J2J J can remain unmatched
at any Pareto-e¢ cient matching. Consider a situation where only overdemanded patients in I N O
                                                             S
are available to be matched with underdemanded patients in J2J J. By de…nition of a neighbor,
                           S
underdemanded patients in J2J J can only be matched with overdemanded patients in C (J ; I) I
and therefore at least (jJ j         jC (J ; I)j) of these patients remain unmatched at a Pareto-e¢ cient
matching (provided that jJ j      jC (J ; I)j).18 Therefore if only overdemanded patients in I   NO
                                                  S
are available to be matched with patients in J2J J, the quantity f (J ; I) is an upper-bound of
                                                                                              S
the utility (i.e. the probability of receiving a transplant) of the least fortunate patient in J2J J,
                                                                                        S
and this upper-bound can only be reached if not only all underdemanded patients in J2J J receive
                                                                                              S
the same utility but also all overdemanded patients in C (J ; I) are matched to patients in J2J J.
This motivates the following recursive construction that partitions D as fD1 ; D2 ; :::; Dq g and N O as
 N1O ; N2O ; :::; NqO :

Step 1: Let19
                              D1 = arg min f J ; N O          and N1O = C D1 ; N O :
                                         J   D




       In general, at
  17
     The two most related economic applications of egalitarianism to our setup are Bogomolnaia and Moulin (2004)
and Dutta and Ray (1989).
  18
     For the sets of odd components J that we consider below, jJ j > jC (J ; I)j.
  19
     If there are multiple sets that minimizes f , their union minimizes f as well and we pick the largest such set as the
arg min. See Lemma 4 in the Appendix for a proof of this result.



                                                           18
Step k: Let
                                                     -k 1           !                            -k 1          !
                                                      [                                           [
         Dk = arg        min
                          S
                                        f   J ; NO            N`O       and NkO = C   Dk ; N O           N`O       .
                             k 1
                    J   Dn         D`
                             `=1                        `=1                                        `=1



   For each j 2 N U , let k(j) be the step at which the odd component that contains patient j leaves
the above procedure. That is, k(j) 2 f1; 2; :::; qg is such that j 2 J 2 Dk(j) :
   We construct a vector uE = uE
                               i              i2N
                                                     as follows:

      uE                      U
       i = 1 for each i 2 N nN ; and

      uE              O                  U
       i = f Dk(i) ; Nk(i) for each i 2 N .

Theorem 2 The vector uE is a feasible utility pro…le.

   Theorem 2 states that for each of the collections of under and overdemanded patients (Dk ; NkO )
in the above construction, the overdemanded patients can be probabilistically matched to all of
the indicated odd components of underdemanded patients, in lotteries that divide the resulting
probabilities equally among the underdemanded patients, and thus achieve the upper bound on the
utility of the least fortunate patients.
   For any utility pro…le u 2 U; re-order individual utilities in an increasing order as u(t)                      t2f1;2;:::;ng
such that u(1) u(2) ::: u(n) .
    A utility pro…le u 2 U Lorenz-dominates a utility pro…le v 2 U if
                                          P           Pt
   1. for each t 2 f1; 2; :::; ng we have ts=1 u(s)          (s)
                                                        s=1 v , and
                                                P            P
   2. there is some t 2 f1; 2; :::; ng such that ts=1 u(s) > ts=1 v (s) .

   A utility pro…le is Lorenz-dominant if and only if it Lorenz-dominates every other utility pro…le.
If it exists, a Lorenz-dominant utility pro…le is e¢ cient and as “evenly”distributes the probability of
receiving a transplant among patients as possible constrained by the mutual compatibility constraints.

Theorem 3 The utility pro…le uE is Lorenz-dominant.

   We refer to the utility pro…le uE as the egalitarian utility pro…le. We refer to any lottery that
induces the egalitarian utility pro…le as an egalitarian lottery. Similarly we refer to any allocation
matrix that induces the egalitarian utility pro…le as an egalitarian allocation matrix. We refer
to a stochastic mechanism that selects an egalitarian lottery for each problem as an egalitarian
mechanism.
    Our next result states that, as for priority mechanisms, truthful revelation of private information
is a dominant strategy under an egalitarian mechanism.

                                                               19
Theorem 4 An egalitarian mechanism makes it a dominant strategy for a patient to reveal both a)
her full set of acceptable kidneys; and b) her full set of available donors.

    As discussed when we proved the similar result for the priority mechanisms, the second part of
the Theorem follows from the …rst. Revelation of the full set of acceptable kidneys increases the set
of patients with whom a given patient is mutually compatible, and, for the same reason, a patient
never su¤ers because of an addition of one more incompatible donor. That is:

Corollary 4 An egalitarian mechanism is donor-monotonic.


5     Concluding Remarks
One of the most challenging steps in implementing new market designs is addressing the constraints
that arise in the …eld. Because all surgeries in a kidney exchange must be done simultaneously,
even the simplest exchange, between two patient-donor pairs, requires four simultaneous surgeries
among the two donors and two recipients. It therefore seems overwhelmingly likely that, at least
initially, some transplant centers are correct in anticipating that they will only be able to proceed
with exchange among two pairs. Roth, Sönmez and Ünver (2004) showed that, even under this
constraint, implementing kidney exchange could substantially increase the number of live organ
kidney transplants. The present paper shows that when exchange is constrained in this way, and
when the 0-1 nature of American surgeons’preferences regarding compatible/incompatible kidneys
are taken into account, it is still possible to arrange exchange in an e¢ cient and incentive compatible
manner.
    Another challenge in implementing new market designs arises in meeting the perceived needs and
desires of the institutions, organizations, and individuals who must adopt and use the new design.
Here too, the results are encouraging, and we show that the kinds of priority allocation that already
govern the allocation of cadaver kidneys can be adapted to work e¤ectively in organizing live donor
kidney exchange.     Since there are virtually no constraints on the kinds of priorities that can be
used in an e¢ cient and incentive compatible mechanism, we anticipate that priority mechanisms
may appeal to di¤erent transplant centers that do not necessarily agree on how patients should be
prioritized.
    Indeed, there is lively discussion and disagreement about, and frequent revision of the priorities
that di¤erent kinds of patients should have for cadaver organs, and we don’t doubt that similar
discussions about live organ exchange will take place as exchange becomes more common. The debate
about cadaver organs frequently refers to considerations of distributive justice, and in this connection
we have discussed stochastic mechanisms of exchange, and the egalitarian mechanism in particular.


                                                   20
We do not anticipate or propose that this be taken as the last word on distributive justice in kidney
exchange, but rather intend merely to show how the tools we assemble here can be used to address
the kinds of distributional questions that arise. An interesting area of future research might be the
extent to which egalitarian (and weighted-egalitarian) exchange mechanisms can be approximated
by priority mechanisms with appropriately chosen priorities, taking into account di¤erent patients’
likelihoods of …nding compatible donors with whom to exchange, the size and frequency of exchanges,
etc., in the dynamic environment in which new patients and donors arrive, and exchanges are carried
out periodically.
   More generally, as economists start to take a more active role in practical market design, we
often …nd we have to deal with constraints, demands, and situations di¤erent than those that arise
in the simplest theoretical models of mechanism design.20 In the present paper we address some
of the issues that have arisen as we try to help surgeons implement an organized exchange of live-
donor kidneys among incompatible donor-patient pairs. Not only do these issues appear to allow
satisfactory practical solutions, they suggest new directions in which to pursue the underlying theory.


6        Appendix: Proofs
The proof of Proposition 1 is a standard exercise in combinatorial optimization theory, for example
see Gommens (2004). Proposition 2 is due to Rado (1957) and Edmonds (1971). Lemma 1 and
Lemma 3 are corollaries of the GED Lemma (Lemma 2) and see Lovász and Plummer (1986) for a
proof of the GED Lemma.

Proof of Theorem 1: First, we introduce some notation. For each reduced problem R, consider the
construction of a priority matching and sets of matchings E 0 (R); E 1 (R),...,E n (R) under the natural
ordering; we de…ne sets of agents M 0 (R); M 1 (R); :::; M n (R) as

                                               M 0 (R) = ; and
          M k (R) = i 2 f1; 2; :::; kg : (i) 6= i for any   2 E k (R)       for each k 2 f1; 2; :::; ng .

Note that M k 1 (R)       M k (R) for any k 2 f1; 2; :::; ng.
       Without loss of generality, we will prove the strategy-proofness of a priority mechanism which
selects a priority matching under the natural ordering for each reduced problem. Let be a priority
mechanism for the natural ordering and R = [ri;h ]i2N;h2N be a reduced problem. Construct sets of
matchings E 0 (R); E 1 (R),...,E n (R) and sets of patients M 0 (R); M 1 (R); :::; M n (R).
  20
    See for instance Roth and Peranson (1999), Roth (2002), Wilson (2002), Abdulkadiro¼
                                                                                      glu and Sönmez (2003b),
Milgrom (2004), Niederle and Roth (2004) for some examples. Indeed, one of the principal motivations of Roth,
Sönmez and Ünver (2004) was to organize e¢ cient kidney exchange under the social/ethical/legal prohibitions on
monetized markets.

                                                       21
   Any patient j 2 M n (R) is matched at (R) 2 E n (R), hence she cannot possibly bene…t by under-
reporting the set of her compatible patients under . Let j 2 N nM n (R) : Patient j is unmatched at
 (R). We will prove that patient j cannot receive a transplant by declaring a mutually compatible
patient to be incompatible, and repeated application of this argument will conclude the proof.
   Let j 0 2 N n fjg such that rj;j 0 = 1. Let Q = [qi;h ]i2N;h2N be the reduced problem obtained from
R by patient j declaring patient j 0 to be incompatible. Note that M (Q) = f 2 M (R) :                                             (j) 6= j 0 g.
Construct sets of matchings E 0 (Q); E 1 (Q),...,E n (Q) and sets of patients M 0 (Q); M 1 (Q); :::; M n (Q).
   We conclude the proof with a claim that implies M n (Q) = M n (R) and this together with
 = M n (R) imply that j 2
j2                      = M n (Q).

Claim: For each k 2 f0; 1; :::; ng,

  (i) M k (Q) = M k (R) and

 (ii) E k (Q) =      2 E k (R) :       (j) 6= j 0 .

Proof of Claim: We prove the Claim by induction.

      Let k = 0. By construction, M 0 (Q) = ; = M 0 (R). Since E 0 (R) = M (R), E 0 (Q) = M (Q)
      and M (Q) = f 2 M (R) :                    (j) 6= j 0 g, we have

                   E 0 (Q) = M (Q) = f 2 M (R) :                          (j) 6= j 0 g =     2 E 0 (R) :        (j) 6= j 0 .

      Let k > 0.        For all ` with 0                 ` < k assume that M ` (Q) = M ` (R) and E ` (Q) =
          2 E ` (R) :   (j) 6= j 0 .
      We will prove that M k (Q) = M k (R) and E k (Q) =                              2 E k (R) :       (j) 6= j 0 . Consider patient
      k. We have either k 2 M k (R) or k 2
                                         = M k (R). We consider these two cases separately:

        1. k 62 M k (R) : We have M k (R) = M k                      1
                                                                         (R) and E k (R) = E k      1
                                                                                                        (R). For all             2 Ek   1
                                                                                                                                            (R) ;
             (k) = k. By the inductive assumption E k                             1
                                                                                      (Q)     Ek    1
                                                                                                        (R), therefore for all                 2
             k 1                                                                        k                 k                k 1
           E    (Q) ; we have (k) = k; and hence, k 62 M (Q) and E (Q) = E                                                       (Q). This
           together with the inductive assumption imply

                  M k (Q) = M k             1
                                                (Q) = M k   1
                                                                (R) = M k (R) and
                   E k (Q) = E k        1
                                            (Q) =        2 Ek        1
                                                                         (R) :   (j) 6= j 0 =           2 E k (R) :        (j) 6= j 0 .

        2. k 2 M k (R) : We have M k (R) = M k                   1
                                                                     (R)[fkg and E k (R) =                    2 Ek   1
                                                                                                                         (R) :     (k) 6= k .
           We prove the two statements separately:

                                                                 22
           (i) Let       2 E n (R). Since k 2 M k (R)                       M n (R),         (k) 6= k. Since j 62 M n (R),              (j) = j.
                                                                                                      n                   k 1
               These together with the inductive assumption and E (R)                                                 E         (R) imply that
                                k 1                        0            k 1
                   2       2E         (R) :    (j) 6= j            =E           (Q). This together with (k) 6= k imply that

                                                       E k (Q) =            2 Ek     1
                                                                                         (Q) :     (k) 6= k                                       (1)

               and
                                    M k (Q) = M k              1
                                                                   (Q) [ fkg = M k           1
                                                                                                 (R) [ fkg = M k (R) :

           (ii) First let       2       2 E k (R) :            (j) 6= j 0 . Since             2 E k (R)          Ek   1
                                                                                                                          (R) and (j) 6= j 0 ,
               we have          2       2 Ek       1
                                                       (R) :       (j) 6= j 0     = Ek       1
                                                                                                 (Q) where the last equality follows
               from the inductive assumption. Since k 2 M (R) and 2 E k (R), we have (k) 6= k:
                                                                                         k

               These imply that 2      2 E k 1 (Q) : (k) 6= k = E k (Q) by Eq 1.
               Next let          2 E k (Q) =                   2 Ek     1
                                                                            (Q) :        (k) 6= k . Since E k (Q)                  Ek   1
                                                                                                                                            (Q)
                   k 1
               E         (R) where the last set inclusion follows from the inductive assumption,
               we have     2 E k 1 (R).  This together with (k) 6= k imply that        2
                    k 1                   k                k          k               0
                 2E     (R) : (k) 6= k = E (R). Therefore E (Q) =  2 E (R) : (j) 6= j
               completing the proof of the Claim as well as Theorem 1.


   The following Lemma is useful to construct the egalitarian utility pro…le:

Lemma 4 Fix G          D and I                N O . Suppose G1 ; G2 2 arg minJ                            G   f (J ; I) : Then G1 [ G2 2
arg minJ G f (J ; I) as well.

Proof of Lemma 4: Fix G             D and I            N O . Suppose

                                               G1 ; G2 2 arg min f (J ; I) :
                                                                      J     G


Let G3 = G1 \ G2 and G4 = G1 [ G2 . For all i 2 f1; 2; 3; 4g de…ne

                                       [
                            ni =             J ;       Ci = C(Gi ; I);              and fi = f (Gi ; I):
                                      J2Gi

By de…nition we have

                            jG1 j + jG2 j = jG3 j + jG4 j               and         n1 + n2 = n3 + n4 :

Moreover
                                               jC1 j + jC2 j              jC3 j + jC4 j:


                                                                     23
That is because, in the LHS of the inequality not only the neighbors of G3 = G1 \ G2 (i.e. members
of C3 ) are counted twice but also there may be additional common neighbors of G1 and G2 ; RHS of
the inequality accounts for the double counting of members of C3 but not the remaining common
neighbors of G1 and G2 .
   Since G1 , G2 each minimize the function f ,
                     (n1       (jG1 j   jC1 j))       (n2        (jG2 j       jC2 j))     (n3    (jG3 j   jC3 j))
                                                  =
                                  n1                                n2                              n3
                     |            {z         }        |             {z              }    |          {z              }
                                 =f1                                  =f2                           =f3

and hence

                                             f1 n1 = n1                   (jG1 j    jC1 j);
                                             f1 n2 = n2                   (jG2 j    jC2 j);
                                             f1 n3               n3       (jG3 j    jC3 j):

Adding the …rst two lines and subtracting the third line

            f1 (n1 + n2         n3 )    (n1 + n2          n3 )        (jG1 j + jG2 j     jG3 j) + (jC1 j + jC2 j        jC3 j)
                |    {z          }       |    {z           }           |        {z          }      |        {z             }
                         =n4                  =n4                               =jG4 j                      jC4 j

and therefore
                                                  f1 n4          n4         jG4 j + C4
or equivalently
                                              (jG4 j jC4 j))
                                                      (n4
                                            f1               = f4 :
                                                 n4
But since G1 minimizes f , we shall have f4 = f1 and hence G4 = G1 [ G2 minimizes f as well.

   We next present two lemmata that will be useful in our proofs for Theorem 2 and Theorem 3.
   The following lemma is a part of Lemma 3.2.2 in Lovász and Plummer (1986) pp 95:

Lemma 5         For each i 2 N O , the Gallai-Edmonds decomposition of the reduced subproblem
 N n fig ; RN nfig   is given by N U ; N O n fig ; N P                     where N U is the set of underdemanded patients,
N O n fig is the set of overdemanded patients, and N P is the set of perfectly matched patients for the
reduced subproblem N n fig ; RN nfig .

Lemma 6 For each k 2 f1; 2; :::; qg, we have
                             /S                                           /S
                                   k 1                                       k 1
  i. C Dk ; NkO = C Dk ; N O       `=1 N O
                                         `  and f D k ; Nk
                                                          O
                                                            = f D k ; N O         O
                                                                             `=1 N` ,

  ii. f Dk ; NkO < 1:

                                                                      24
                                                                   S
Proof of Lemma 6: For any k 2 f1; 2; :::; qg, let Jk =                 J2Dk   J. Note that Jk is the set of patients in
sets of Dk . Pick k 2 f1; 2; :::; q
                                 1g.
                                    /S                                   /S
                                       k 1                                  k 1
   i. First observe that C Dk ; N O    `=1 N O
                                             `   =  C  D k ; C D k ; N O         O
                                                                            `=1 N`   . This together
                            /S                                                     /S
                                k 1                                                   k 1
      with NkO = C Dk ; N O          O
                                `=1 N`    implies that C Dk ; NkO = C Dk ; N O             O
                                                                                      `=1 N`  . Fur-
      thermore
                                   -k 1           !                                               /S
                                                                                              O        k 1
                                    [                     jJk j    jDk j      C Dk ; N                 `=1   N`O
                               O
                  f   Dk ; N                N`O       =
                                      `=1
                                                                                      jJk j
                                                          jJk j    jDk j      C Dk ; NkO
                                                      =                                            = f Dk ; NkO .
                                                                           jJk j

   ii. Consider the construction of the partition fD1 ; D2 ; :::; Dq g of D and N1O ; N2O ; :::; NqO of N O .
       We prove Lemma 6 (ii) by iteration on steps k 2 f1; 2; :::; qg of the construction.

            First consider k = 1. We have

              f D1 ; NkO       = f D1 ; N O                                            by Lemma 6 (i)
                                    f D; N O                                           by construction of D1
                                    NU            (jDj    C(D; N O ) )
                               =                                                       by de…nition of f
                                                     jN U j
                                    NU            (jDj    NO )
                               =                                                      by C(D; N O ) = N O
                                                  jN U j
                               < 1                                                     since N O < jDj by Corollary 3

            If D1 = D, then q = 1 and we are done. Otherwise we proceed with k = 2.
            Next consider k = 2: Consider the reduced subproblem N nN1O ; RN nN O . Since N1O
                                                                                   1
            N O , Lemma 5 implies that the Gallai-Edmonds decomposition for the reduced subproblem
              N nN1O ; RN nN O
                             is given by N U ; N O nN1O ; N P . Since N1O = C(D1 ; N O ), there is no
                            S1
            patient j 2 J1 = J2D1 J who is mutually compatible with a patient in N nN1O . Therefore,
            (J; RJ ) is a component of reduced subproblem N nN1O ; RN nN O for each J 2 D1 ; which in
                                                                                              1

            turn implies N U nJ1 ; N O nN1O ; N P is the Gallai-Edmonds decomposition for the reduced
            subproblem N n N1O [ J1 ; RN n            . Therefore, DnD1 is the set of odd components
                                           (N1O [J1 )
            of the reduced subproblem which is obtained by removing overdemanded patients from
            the reduced subproblem                N n N1O [ J1 ; RN n                   .
                                                                         (N1O [J1 )



                                                              25
           By Corollary 3 jDnD1 j > N nN1O and at this point the proof of f D2 ; N2O < 1 follows
           from the same sequence of arguments as in k = 1:

                          f D2 ; N2O         = f D2 ; N O N1O
                                                  f D nD1 ; N O N1O
                                                  N U nJ1          (jDnD1 j     C(D nD1 ; N O N1O ) )
                                             =
                                                                          jN U nJ1 j
                                                  N U nJ1          (jD nD1 j    N O N1O )
                                             =
                                                                    jN U nJ1 j
                                             < 1

           If D1 [ D2 = D then q = 2 and we are done. Otherwise, we iteratively proceed in a similar
           way with k = 3, and so on.


Proof of Theorem 2: Let k 2 f1; 2; :::; qg and J 2 Dk . Recall that J is a set of underdemanded
patients and (J; RJ ) is an odd component of N nN O ; RN nN O . Under a Pareto-e¢ cient matching,
at most one patient in J is matched with an overdemanded patient, and for each j 2 J, it is possible
to match the remaining jJj 1 patients in Jn fjg with each other by the GED Lemma. Therefore the
set J, by itself, generates an aggregate utility of jJj                 1 for its members under each e¢ cient utility
pro…le without any help of the overdemanded patients. Moreover jJj :f (Dk ; NkO ) is the aggregate
utility of patients in set J under uE and jJj :f (Dk ; NkO )                jJj      1 by construction of f . Therefore,
   E
if u is a feasible utility pro…le, then patients in J should be matched with overdemanded patients
with a cumulative probability of jJj :f (Dk ; NkO ) (jJj 1) under any lottery that induces uE . Let

                                         J   = jJj :f (Dk ; NkO )        (jJj     1) .

   Note that f (Dk ; NkO ) < 1 by Lemma 6 (ii), and therefore f (Dk ; NkO )                       J.   Also note that for
each k 2 f1; 2; :::; qg and J 2 Dk we have

                      J   = jJj :f Dk ; NkO            (jJj        1)
                                  S           0
                                    J 0 2Dk J           jDk j           C Dk ; NkO
                          = jJj :                      S                                   (jJj   1)
                                                         J 0 2Dk   J0
                               S
                                   J 0 2Dk   J0    jJj : jDk j      C Dk ; NkO
                          =                          S            0
                                                                                                                      (2)
                                                        J 0 2Dk J

   We will show that uE is a feasible utility pro…le in two major steps: In the …rst step (Claim 1),
we will show that it is possible to assign overdemanded patients N O to odd components D such that
each odd component J 2 D is assigned with an overdemanded patient with an aggregate probability

                                                           26
of     J.   In the second step (Claim 2) we will show that for each odd component J 2 Dk , it is possible
to evenly divide the aggregate utility                J   + (jJj   1) among jJj members as f Dk ; NkO .

Claim 1: There exists a pre-allocation matrix A~ 2 Ae such that
                                    P
     1. For each i 2 N O ,            J2D   ~i;J = 1, and
                                            a

     2. For each k 2 f1; 2; :::; qg and J 2 Dk

                ~i;J = 0 for all i 2 N nNkO , and
            (a) a
                P
            (b)          ~i;J = J .
                   i2N O a
                        k




Proof of Claim 1: Let k 2 f1; 2; :::; qg. We will show that it is possible to share the aggregate NkO
units of “weight” of members of NkO (1 unit weight from each member) among (only) members of
Dk such that the share of odd component J 2 Dk is J . Formally, we will show that there exists a
non-negative valued matrix A~k;k = [~
                                    ai;J ]i2N O ;J2Dk such that
                                                            k

          P
     1.      J2Dk    ~i;J = 1 for all i 2 NkO ,
                     a
          P
     2.      i2NkO   ~i;J =
                     a        J   for all J 2 Dk , and

        ~i;J > 0 ! r~i;J = 1 for any pair i 2 NkO , J 2 Dk .
     3. a

       We will show this by de…ning an auxiliary task assignment problem and applying Hall’s The-
orem to the auxiliary task assignment problem.21 Given NkO and Dk , construct the task assignment
problem (X; T ; ) as follows:
                                                                                   S
          For each overdemanded patient i 2 NkO ; introduce           J 0 identical agents. Let Xi be the
                                                                                       J 0 2Dk
                                                                          S
          set of the identical agents associated with patient i; and X = i2N O Xi .
                                                                                                          k

                                                                    S
          For each odd component J 2 Dk , introduce                      J 0 2Dk   C Dk ; NkO
                                                                                   J0        jJj : jDk j
                                                                                               identical
                                                                                     S
          tasks. Let TJ be the set of identical tasks associated with set J, and T = J2Dk TJ .

          Finally, introduce a matrix             =       x;T x2X;T 2T   such that               x;T   = 1 if r~i;J = 1 for x 2 Xi and
          T 2 TJ ; and x;T = 0 otherwise: Intuitively agent x is …t to perform task T if and only if
          patient i associated with agent x has a link with the odd component J that is associated with
          task T in the induced two-sided matching market N O ; D; R  ~ .

  21
    This can be interpreted as the proof of a continuous version of Hall’s theorem that deals with probabilistic
assignments.

                                                                   27
   Given NkO and Dk we refer to (X; T ; ) as the auxiliary task assignment problem. Note that
                                                            !
               X      [
      jT j =              J0     jJj : jDk j  C Dk ; NkO
                  J2Dk        J 0 2Dk

                              [                   [
              = jDk j :                J0               J 0 : jDk j    C Dk ; NkO
                             J 0 2Dk          J 0 2Dk

                    [
              =              J 0 : C Dk ; NkO
                   J 0 2Dk

                    [
              =              J 0 : NkO                                                         by NkO = C Dk ; NkO
                   J 0 2Dk

                   X         [
              =                    J0
                  i2NkO J 0 2Dk

              = jXj :

   An auxiliary task assignment is a bijection : X                            ! T . An auxiliary task assignment     is
feasible if and only if (x) = T implies that x;T = 1.
   Here is the point of introducing the above auxiliary task assignment problem: Each agent or task
                                               1
in X[T corresponds to a fraction         S              of its “owner”in NkO [Dk . Therefore if we show that there
                                        j J 0 2Dk J 0 j
exists a feasible auxiliary task assignment , this would mean that it is possible to assign each agent in
                                                                                     S
X to a distinct compatible task in T ; and therefore the aggregate NkO : J 0 2Dk J 0 : S 1 J 0 = NkO
                                                                                                 j J 0 2Dk j
                              O
weight of the patients in Nk can be allocated among odd components of Dk such that the share of
                              S
the odd component J is          J 0 2Dk J
                                          0
                                                 jJj : jDk j      C Dk ; NkO   . S 1 J0 = J .
                                                                                 j J 0 2Dk j
    We next prove that there exists a feasible auxiliary task assignment for the above task assign-
ment problem. Given               T de…ne

                                        C( ; X) = x 2 X : 9T 2              with    x;T   =1

That is, C( ; X) is the set of agents each of whom is …t to perform at least one of the tasks in : By
Hall’s Theorem there exists a feasible auxiliary task assignment if and only if

                                            j j   jC( ; X)j            for every      T:

That is, no matter what subset of tasks is considered, the number of agents who are …t for at least
one of these tasks should be no less than the number of the tasks in this subset. We will prove this
by contradiction.
   Suppose there exists a subset                        T of tasks such that j j > jC( ; X)j. Next construct the
following set of tasks                  . For any task T 2 , include all tasks which are identical to task T in

                                                                  28
set    . Note that since C( ; X) = C( ; X); we have

                                                j j      j j > jC( ; X)j = jC( ; X)j                                                           (3)

   Let J   Dk be the set of odd components each of which is associated with a task in                                                      . Note
    S
that J2J TJ =   and therefore
                                                                     !
                           X      [
                 j j =               J0   jJj : jDk j  C Dk ; NkO
                                         J2J          J 0 2Dk

                                                      [                      [
                                    = jJ j :                    J0                     J 0 : jDk j      C Dk ; NkO                             (4)
                                                   J 0 2D   k              J 0 2J

      Moreover
                                                                          [
                                              jC( ; X)j =                             J 0 : C(J ; NkO )                                        (5)
                                                                         J 0 2D   k

By Eq (3), Eq (4), and Eq (5)

                      [                    [                                                            [
            jJ j :             J0                 J 0 : jDk j               C Dk ; NkO           >               J 0 : C(J ; NkO ) ;
                     J 0 2Dk             J 0 2J                                                        J 0 2Dk

rearranging the terms, we have

                                        jDk j      C Dk ; NkO      jJ j     C(J ; NkO )
                                                S            0
                                                                >       S            0
                                                   J 0 2Dk J               J 0 2J J
                                    |               {z         } |          {z         }
                                              =f (Dk ;Nk ) 1
                                                        O             =f (J   ;N k )
                                                                                 O   1


and therefore,
                                           f Dk ; NkO > f J ; NkO :                                                                            (6)
                                            /S                                                                                /S
                                               k 1                                                                                 k 1
However f Dk ; NkO             = f Dk ; N O
                                               `=1 N`
                                                     O
                                                        and f J ; NkO                                        = f J ; NO            `=1   N`O   by
Lemma 6, and this together with Eq (6) imply that
                                  -k 1      !                                                        -k 1          !
                                     [                                                                [
                       f Dk ; N O        N`O > f                                          J ; NO             N`O
                                                         `=1                                           `=1

contradicting the de…nition of Dk and showing that for each                                          T we have j j        jC( ; X)j. Therefore
there exists a feasible auxiliary task assignment by Hall’s Theorem.
   We next construct matrix A~k;k = [~  ai;J ]i2N O ;J2Dk using the auxiliary task assignment . For each
                                                                     k
J 2 Dk and i 2 NkO ; de…ne

                                        i;J   = fx 2 Xi : (x) = T for some T 2 TJ g :

                                                                             29
By de…nition j     i;J j   is the total number of tasks associated with odd component J each of which is
assigned to an agent associated with the overdemanded patient i. For each J 2 Dk and i 2 NkO , let

                                                                      j    i;J j
                                                           ~i;J = S
                                                           a
                                                                      J 0 2Dk      J0

    and let A~k;k = [~
                     ai;J ]i2N O ;J2Dk :
                                      k
    For each odd component J 2 Dk ; we have
                            P
                X             i2N O j i;J j          jTJ j
                     a
                     ~i;J =  S k          0
                                            = S              0
               i2NkO           J 0 2Dk J          J 0 2Dk J
                            S           0
                              J 0 2Dk J     jJj : jDk j        C Dk ; NkO
                          =                   S            0
                                                 J 0 2Dk J
                          = J                                                                    by Eq (2)   (7)

    Moreover for each overdemanded patient i 2 NkO ; we have
                               P                              S
                     X           J2D    j i;J j  jX   i j       J 0 2Dk J
                                                                          0
                         ~i;J = S k 0 = S
                         a                                0
                                                            = S           0
                                                                            = 1:                             (8)
                                  J 0 2D J      J 0 2D J        J 0 2D J
                     J2D          k     k               k             k



  We conclude                                                                 ~
        n      o the proof of Claim 1 by constructing a pre-allocation matrix A 2 A using the
matrices A~k;k           constructed above.
                   k2f1;2;:::;qg
                                                                          ~i;J = 0. Let A~k;k =
                                                                                             0
    For each k, k 0 with k 6= k 0 , for each i 2 NkO and each J 2 Dk0 let a
[~
 ai;J ]i2N O ;J2D 0
          k      hk   i
     Let A = A~k;k
           ~        0
                                    = [~ai;J ]i2N O ;J2D .
                           k2f1;2;:::;qg;k0 2f1;2;:::;qg  P            P
For each k and each odd component J 2 Dk ; we have i2N O a       ~i;J = i2N O a~i;J = J by Eq (7) and
                                   O
                                                   P              P          k
for each overdemanded patient i 2 Nk , we have J2D a       ~i;J = J2Dk a~i;J = 1 by Eq (8) concluding
the proof of Claim 1.

    The next claim completes the proof of Theorem 2.

                                                                       E                     E
Claim 2: There exists an ex-post e¢ cient lottery                          2 L such that u       = uE :

Proof of Claim 2: By Claim 1 there exists a pre-allocation A~ 2 Ae such that
                                 P
   1. For each i 2 N O ,              J2D   ~i;J = 1, and
                                            a

   2. For each k 2 f1; 2; :::; qg and J 2 Dk

            ~i;J = 0 for all i 2 N nNkO , and
        (a) a

                                                                 30
              P
        (b)     i2NkO   ~i;J =
                        a        J.

                                                      P
    For each k 2 f1; 2; :::; qg and J 2 Dk ; we have i2N O a ~i;J = J and a  ~i;J = 0 for all i 2 N nNkO :
                                                          k
By Lemma 2.1 in Bogomolnaia and Moulin (2002) there exists an ex-post e¢ cient pre-lottery ~ 2 L~
that implements A.~
    We will “build on” the pre-lottery ~ to construct the lottery E . For each pre-matching ~ 2 M     f
in the support of pre-lottery ~ , partition set D as fDm (~ ) ; Du (~ )g where

       Dm (~ ) = fJ 2 D : ~ (J) 6= ;g is the set of matched odd components, and

       Du (~ ) = DnDm (~ ) is the set of unmatched odd components.

                               f in the support of pre-lottery ~ construct Q u jJj distinct
     For each pre-matching ~ 2 M                                            J2D (~ )
matchings as follows:
                                                             Q
  Pick one patient from each J 2 Du (~ ). Note that there are J2Du (~ ) jJj possible combinations.
For each combination construct a Pareto-e¢ cient matching                              such that:

       each of the chosen patients is matched to herself,

       each remaining patient in each odd component J 2 Du (~ ) is matched with another patient in
       the same odd component J, and

       one patient in each odd component J 2 Dm (~ ) is matched with an overdemanded patient
       i 2 N O whereas all other patients in each such odd component J is matched with another
       patient in J.

By the GED Lemma, there exists at least one such matching. Pick one and only one such matching
                Q
for each of the J2Du (~ ) jJj possible combinations: Let M(~ ) be the resulting set of matchings.
                 Q
Clearly jM(~ )j = J2Du (~ ) jJj :
     We are …nally ready to construct a lottery E which induces the utility pro…le uE . The lottery
 E
     is constructed from the pre-lottery ~ by simply replacing each pre-matching ~ in the support of
~ with the uniform lottery over M(~ ). That is:
                                  ( ~
                              E
                                        ~
                                     jM(~ )j
                                             if 2 M(~ ) and ~ ~ > 0
                                =
                                       0     otherwise
                E
     Clearly,       is a lottery:
                                            0            1               0                      1
                    X                X          X                 X          X          ~~           X
                           E
                                 =          @            EA
                                                              =          @                      A=          ~~ = 1
                     2M
                                                                                      jM(~ )j
                                        f
                                     ~ 2M       2M(~ )               f
                                                                  ~ 2M       2M(~ )                     f
                                                                                                     ~ 2M


                                                                   31
                                         E
   Moreover by construction                  is an ex-post e¢ cient lottery.
                                                                                                         E
   We conclude the proof of Claim 2 and Theorem 2 by showing that u(                                         ) = uE :
   Each patient in N nN U is matched with another patient in every e¢ cient matching by the GED
                 E                                                                                              E
Lemma. Since         is ex-post e¢ cient, for each patient i 2 N nN U we have ui                                     = uE
                                                                                                                        i = 1:
   Consider a patient i 2 N U . Let i 2 J 2 Dk for some k.
           f be a pre-matching with ~ ~ > 0:
   Let ~ 2 M

  1. If J 2 Dm (~ ) then all patients in J are matched under every matching                                        2 M (~ ).

  2. If J 2 Du (~ ) then jJj             1 patients in J are matched under every matching                                    2 M (~ ) and
                                                                                                                         jJj 1
     patient i (just as any other patient in J) is matched with another patient in                                         jJj
                                                                                                                                 jM (~ )j of
     these matchings.
         P
   Since i2N O a ~i;J = J is the probability that the odd component J is assigned a patient in NkO
               k
under the pre-lottery ~ , we have
                           X                                                        X
                                             ~~ =     J       and                                  ~~ = 1           J                      (9)
                    f s.t. J2Dm (~ )
                 ~ 2M                                                           f s.t. J2Du (~ )
                                                                             ~ 2M


Therefore
                          X
         E                               E
    ui       =
                     2M s.t.    (i)6=i
                                            0                       1                            0                                     1
                           X                    X           ~~                    X                          X                 ~~
             =                              @                       A+                           @                                     A
                                                          jM(~ )j                                                            jM(~ )j
                    f s.t. J2Dm (~ )
                 ~ 2M                           2M(~ )                        f s.t. J2Du (~ )
                                                                           ~ 2M                      2M(~ ) s.t.    (i)6=i
                           X                               X              jJj 1 ~
             =                               ~~ +                               : ~
                                                                            jJj
                    f s.t. J2Dm (~ )
                 ~ 2M                                  f s.t. J2Du (~ )
                                                    ~ 2M

                                            jJj 1
             =       J   + (1        J) :                                                             by Eq 9
                                              jJj
                 jJj        1+      J
             =
                           jJj
                          jDk j     C Dk ; NkO
             = 1                  S           0
                                                                                                       by Eq 2
                                    J 0 2Dk J
             = f Dk ; NkO
             = uE
                i


   completing the proof of Claim 2 as well as the proof of Theorem 2.



                                                                    32
                                                                                                               S
Proof of Theorem 3: Let Jk be the set of patients in sets of Dk ; i.e. Jk =                                        J2Dk   J for any k 2
                            E
f1; 2; :::; qg. Construct u and …x a feasible utility pro…le v 2 U: We prove Theorem 3 through three
claims.

Claim 1: f Dk ; NkO < f Dk+1 ; Nk+1    O
                                           for each k 2 f1; 2; :::; q 1g.
                                                               /S
                                                                     k 1
Proof of Claim 1: Pick k 2 f1; 2; :::; q 1g. Let I = N O                  O
                                                                     `=1 N` : Consider the construction of
                                               /S
                                                   k 1
fD1 ; D2 ; :::; Dq g : Note that Dk [ Dk+1 D       `=1 D` . Since

                                            f (Dk ; I) =              min
                                                                       S
                                                                                   f (J ; I)
                                                                 J   Dn k`=11 D`
                                                /S
                                                      k 1
and Dk is the largest subset J              D         `=1     D` of satisfying this equality, we have

f (Dk ; I) < f (Dk [ Dk+1 ; I)
             jJk [ Jk+1 j (jDk [ Dk+1 j jC (Dk [ Dk+1 ; I)j)
           =
                                 jJk [ Jk+1 j
             jJk j + jJk+1 j (jDk j + jDk+1 j jC (Dk [ Dk+1 ; I)j)
           =                                                               by Dk \ Dk+1 = ;
                                  jJk j + jJk+1 j
             jJk j + jJk+1 j   jDk j + jDk+1 j jC (Dk ; I)j C Dk+1 ; InNkO
           =
                                          jJk j + jJk+1 j
                                                                              by C (Dk [ Dk+1 ; I) = C (Dk ; I) [ C Dk+1 ; InNkO
                                                                                      and C (Dk ; I) \ C Dk+1 ; InNkO = ;
               jJk j (jDk j jC(Dk ;I)j)             jJk+1 j    (jDk+1 j jC (Dk+1 ;InNkO )j)
                         jJk j
                                          jJk j +                     jJk+1 j
                                                                                            jJk+1 j
           =
                                         jJk j + jJk+1 j
             f (Dk ; I) jJk j + f Dk+1 ; InNkO jJk+1 j
           =                                                                                                   by de…nition of f
                             jJk j + jJk+1 j
Rearranging the terms in this inequality, we …nd

                                                f (Dk ; I) < f Dk+1 ; InNkO :

We conclude the proof of Claim 1 observing that f Dk ; NkO                                                           O
                                                                                          = f (Dk ; I) and f Dk+1 ; Nk+1 =
f Dk+1 ; InNkO by Lemma 6 (i).

Claim 2: For any k 2 f1; 2; :::; qg, we have
                                                                                                          !!
                        X
                        k X                     X
                                                k                    X
                                                                     k                   [
                                                                                         k
                 (i)               uE
                                    i =               jJ` j                jD` j    C          D` ; N O        , and
                        `=1 i2J`                `=1                  `=1                 `=1

                        X
                        k X                     X
                                                k X
                 (ii)              uE
                                    i                         vi :
                        `=1 i2J`                `=1 i2J`


                                                                     33
Proof of Claim 2:

   i. For any k 2 f1; 2; :::; qg ; we have
                  X
                         uE
                          i = jJk j :f Dk ; NkO
                  i2Jk
                                                             -k 1             !
                                                              [
                                 = jJk j :f      Dk ; N O               N`O                           by Lemma 6 (i)
                                                                  `=1
                                                                                   /S
                                                                                          k 1
                                             jJk j       jDk j     C Dk ; N O             `=1   N`O
                                 = jJk j :
                                                                         jJk j
                                                                                 -k 1          !!
                                                                                  [
                                 = jJk j         jDk j       C     Dk ; N O              N`O          :                (10)
                                                                                   `=1


     We prove part (i) by induction.

           For k = 1 :
                          X
                                 uE
                                  i = jJ1 j          jD1 j       C D1 ; N O                                 by Eq 10
                          i2J1


           For k > 1 : For the inductive step assume that for each k 0 < k we have
                             k0 X         k0         k0               k0
                                                                                  !!
                            X            X          X               [
                                    E                                           O
                                   ui =      jJ` j      jD` j   C        D` ; N      :
                                  `=1 i2J`            `=1               `=1                    `=1




                                                                  34
        We have
        Xk X       X
                   k 1X      X
                E
              ui =      uE
                         i +   uE
                                i
        `=1 i2J`           `=1 i2J`              i2Jk
                                                                                           !!
                           X
                           k 1               X
                                             k 1                       k[1                             X
                    =            jJ` j               jD` j         C         D` ; N O             +           uE
                                                                                                               i       by the inductive step
                           `=1                 `=1                     `=1                             i2Jk
                                                                                           !!
                           X
                           k 1               X
                                             k 1                       k[1
                    =            jJ` j               jD` j         C         D` ; N O
                           `=1                 `=1                     `=1
                                                                                      -k 1             !!
                                                                                       [
                                  + jJk j            jDk j         C    Dk ; N O                 N`O                     by Eq 10
                                                                                           `=1
                                                                                           !                         -k 1              !!
                           X
                           k                 X
                                             k                         k[1                                            [
                    =            jJ` j               jD` j         C         D` ; N O              C      Dk ; N O               N`O
                           `=1               `=1                       `=1                                                 `=1
                                                                                        !!
                           Xk                Xk                        [k
                    =            jJ` j               jD` j         C         D` ; N O
                           `=1                 `=1                     `=1
                                               Sk                               Sk                                             /S
                                                                   O                   1           O                       O        k 1
                                   by C              D` ; N
                                                   `=1          =C          D` ; N   `=1[ C Dk ; N                                  `=1   N`O
                                                          Sk 1                             /S
                                                                        O                O    k 1  O
                                                  and C     `=1 D ` ; N   \ C    D k ; N      `=1 N`                             =;

   concluding the proof Part (i).
                                                              S
ii. Fix k 2 f1; 2; :::; qg. Consider the set of odd components k`=1 D` . By the GED Lemma, at
             S
    most C( k`=1 D` ; N O ) of these odd components can have all its members matched under a
                                                                                             S
    Pareto-e¢ cient matching. Therefore, the number of patients remaining unmatched in k`=1 J`
                                                            S              S
    under a Pareto-e¢ cient matching is bounded below by k`=1 D`         C( k`=1 D` ; N O ) : Hence,
   the di¤erence
                                                               !                                                                    !!
         [k          [
                     k                    [
                                          k                            X
                                                                       k                   X
                                                                                           k                       [
                                                                                                                   k
            J`             D`        C(          D` ; N O )        =         jJ` j               jD` j        C          D` ; N O
         `=1         `=1                 `=1                           `=1                 `=1                     `=1
                                                                              Sk
   is an upper bound for the number of patients in `=1 J` matched under a Pareto-e¢ cient
                                                                 S
   matching and consequently the aggregate utility of patients in k`=1 J` under any ex-post e¢ -
   cient lottery is bounded above by
                                                                                                  !!
                                   X
                                   k                     X
                                                         k                      [
                                                                                k
                                         jJ` j                 jD` j    C             D` ; N O
                                   `=1                   `=1                    `=1

   This together with Part (i) of Claim 2 and the equivalence of ex-post and ex-ante e¢ ciency by
   Lemma 3 imply
                                       Xk X         Xk X
                                              uE
                                               i           vi
                                                     `=1 i2J`            `=1 i2J`


                                                                35
         for any feasible utility pro…le v completing the proof of Part (i).


Claim 3: For any t 2 f1; 2; :::; ng ; we have

                                                         X
                                                         t                        X
                                                                                  t
                                                                      E (s)
                                                                  u                     v (s) :
                                                          s=1                     s=1




Proof of Claim 3: We use indices k; k 0 ; and ` 2 f1; 2; :::; qg to denote indexes of sets in fD1 ; D2 ; :::; Dq g ;
and indexes t, t0 ; t00 ; s 2 f1; 2; :::; ng to denote the order statistics22 of a feasible utility pro…le. Let
     P
nk = k`=1 jJ` j for each k 2 f1; 2; :::; qg and let n0 = 0.
       Following equations will be useful in proving Claim 3:
       By the de…nition of order statistics, we have
                                               00                             0
                                       1     X
                                             t
                                                                     1     X
                                                                           t
                                                     v (s)                         v (s) for all t00 > t0 > t:                        (11)
                                 t00       t s=t+1              t0       t s=t+1

That is because, since t00 > t0 , the average of (t + 1)th through (t00 )th lowest utilities cannot be less
than the average of (t + 1)th through (t0 )th lowest utilities.
       By de…nition of the order statistics, we also have

                                   X
                                   k X                   nk
                                                         X
                                                vi              v (s)         for all k 2 f1; 2; :::; qg :                            (12)
                                   `=1 i2J`              s=1


       For all k; k 0 2 f1; 2; :::; qg with k 0 < k, and for all i 2 Jk , j 2 Jk0 we have uE    E
                                                                                           i < uj by Claim 1.
Moreover for all k 2 f1; 2; :::; qg, and for all i; j 2 Jk we have uE    E                     E
                                                                    i = uj by construction of u . Hence,
the tth order statistic of uE is given by
                          (t)
                     uE         = uE
                                   i for every i 2 Jk with k and t such that nk                             1   <t   nk .             (13)

   Fix k 2 f1; 2; :::; qg. Fix t 2 f1; 2; :::; ng such that nk                                    1   < t       nk . We next show that
Pt      E (s)
              Pt        (s)
  s=1 u          s=1 v :

  22
   For a feasible utility pro…le v = v (t)           t2f1;2;:::;qg
                                                                     ; we refer to v (t) (i.e. the tth smallest utility under v) as the tth
order statistic of v.




                                                                          36
                     nk
X
t                    X1                           X
                                                  t
          (s)                     (s)
      v         =             v         +                        v (s)
s=1                  s=1                    s=nk          1 +1
                     nk                                                   nk
                     X    1
                                            t       nk        1
                                                                          X
                                  (s)
                              v         +                                              v (s)                          by jJk j = nk   nk     1       and Eq 11
                     s=1
                                                  jJk j           s=nk          1 +1
                         nk 1                                                         nk
                  nk t X (s) t nk                                                1
                                                                                      X
                =             v +                                                              v (s)                  by jJk j = nk     nk       1   and reorganizing the terms
                   jJk j s=1      jJk j                                          s=1

                                  t XX                                        nk 1 X X
                                    k 1                                             k
                     nk                                           t
                                                      vi +                                              vi            by Eq 12
                      jJk j         `=1 i2J`
                                                                          jJk j            `=1 i2J`

                     nk t           X
                                    k 1X
                                                                      t         nk     1
                                                                                           X
                                                                                           k X
                                                      uE
                                                       i      +                                           uE
                                                                                                           i          by Claim 2 (ii)
                      jJk j         `=1 i2J`
                                                                              jJk j            `=1 i2J`
                                    nk 1                                                         nk
                     nk t           X                                     t      nk             X
                                           E (s)                                           1                    (s)
                =                                 u              +                                      uE            by Eq 13
                      jJk j         s=1
                                                                               jJk j            s=1
                     nk                                                           nk
                     X1                 (s)           t      nk           1
                                                                                  X                       (s)
                =             uE                +                                                 uE                  by jJk j = nk     nk       1   and reorganizing the terms
                     s=1
                                                           jJk j              s=nk      1 +1
                     nk
                     X1                                    X
                                                           t
                                   E (s)                                               (s)
                =             u                 +                              uE                                     by Eq 13
                     s=1                              s=nk        1 +1

                     X
                     t
                                        (s)
                =             uE              :
                     s=1

      This concludes the proof of Claim 3 and Theorem 3.

      The next Lemma will be useful in proving Theorem 4:

Lemma 7              Let u; v 2 U be such that u Lorenz-dominates v. Then for any                                                                         2 (0; 1), vector
 u + (1             ) v Lorenz-dominates v.

Proof of Lemma 7: Let u; v 2 U be such that u Lorenz-dominates v, let                                                                                   2 (0; 1) and w =
 u + (1             ) v. Since u 2 U there is a lottery                                                2 L that induces u, and since v 2 U there is a lottery
 2 L that induces v. Let                                  =               + (1                  ) . For each i 2 N , we have

                                        ui ( ) = ui ( ) + (1                                           ) ui ( ) = ui + (1         ) vi = wi .

This implies that                   induces w = (wi )i2N 2 U.



                                                                                                         37
   Next, we show that w Lorenz-dominates v. By the de…nition of order statistics, for any t 2
f1; 2; :::; ng and any t member subset N 0                          N of patients we have
                                                              X
                                                              t                        X
                                                                        v (s)                  vi .                                                               (14)
                                                              s=1                      i2N 0
                                                        Pt                          Pt
Moreover since u Lorenz-dominates v,                      s=1       v (s)               s=1     u(s) for any t 2 f1; 2; :::; ng and this inequal-
ity holds strictly for some t 2 f1; 2; :::; ng. This together with the de…nition of order statistics imply
that for any t 2 f1; 2; :::; ng and any t member subset N 00                                            N of patients we have
                                                    X
                                                    t                     X
                                                                          t                      X
                                                              (s)
                                                          v                         u(s)                    ui                                                    (15)
                                                    s=1                       s=1               i2N 00
                                                                                    Pt      (s)
where the second inequality holds strictly for some t 2 f1; 2; :::; ng. We have       s=1 w     =
  P                  P                      0    00
     i2N 0 vi + (1 )    i2N 00 ui for some N ; N    N with jN 0 j = jN 00 j = t. Therefore Eq 14
and Eq 15 imply that
                                         !                                    !                             !                              !
    X
    t                    X
                         t                                X
                                                          t                                    X                             X                     X
                                                                                                                                                   t
               (s)                 (s)                                  (s)
           v         =         v             + (1   )               v                                  vi        + (1    )            ui       =         w(s) :
     s=1                 s=1                              s=1                                  i2N 0                         i2N 00                s=1

where the inequality holds strictly for some t 2 f1; 2; :::; ng, completing the proof of Lemma 7:

Proof of Theorem 4: First we introduce some additional notation that we will use in the proof of
Theorem 4. Fix the set of agents N and hence each mutual compatibility matrix R de…nes a distinct
reduced problem. For any reduced problem R, let
                                    [
                         Jk (R) =       J and                                              e (R) = max j j :
                                                                                                                 2M(R)
                                                    J2Dk (R)

Recall that for any            2 M(R), we have                 2 E(R) () j j = e (R). For any reduced problem R and
any two sets I; J         N , de…ne neighbors of J among I as

                                     C (J; I; R) = fi 2 I n J : ri;j = 1 for some j 2 Jg :

For a singleton set J = fjg, we slightly abuse the notation and use C(j; I; R) instead of C(fjg; I; R).
           E
   Let           denote an egalitarian mechanism and R = [ri;h ]i2N;h2N be a reduced problem. Construct:

  1. the Gallai-Edmonds Decomposition N U (R) ; N O (R) ; N P (R) of the set of patients N ,

  2. the partition D (R) of the set of underdemanded patients N U (R),
                                                                        n                          o
                                                                          O                O
  3. the partition D1 (R) ; : : : ; Dq(R) (R) of D (R) and the partition N1 (R) ; : : : ; Nq(R) (R) of
      N O (R), and

                                                                                  38
   4. the egalitarian utility pro…le uE (R).

   Note that u E (R) = uE (R).
   For any patient j 2 (N O (R) [ N P (R)) we have uE                                      O
                                                    j (R) = 1 and therefore no patient in N (R) [
N P (R) can possibly bene…t by underreporting her set of compatible patients.
   Let j 2 N U (R) such that j 2 J 2 D (R). Note that uE
                                                       j (R) < 1. We will prove that patient j
cannot increase her probability of receiving a transplant by declaring a mutually compatible patient
to be incompatible, and repeated application of this argument will conclude the proof.
   Let j 0 2 C (j; N; R). Either j 0 2 J or j 0 2 N O (R). Let Q = [qi;h ]i2N;h2N be the reduced problem
obtained from R by patient j declaring patient j 0 to be incompatible. Note that C (j; N; Q) =
C (j; N; R) n fj 0 g, C (j 0 ; N; Q) = C (j 0 ; N; R) n fjg, C (i; N; Q) = C (i; N; R) for all i 2 N n fj; j 0 g,
and M (Q) = f 2 M (R) : (j) 6= j 0 g. Construct:

   1. the Gallai-Edmonds Decomposition N U (Q) ; N O (Q) ; N P (Q) of the set of patients N ,

   2. the partition D (Q) of the set of underdemanded patients N U (Q),
                                                                         n                           o
                                                                                             O
   3. the partition D1 (Q) ; : : : ; Dq(Q) (Q) of D (Q) and the partition N1O (Q) ; : : : ; Nq(Q) (Q) of
      N O (Q), and

   4. the egalitarian utility pro…le uE (Q).

                      E
   Note that u            (Q) = uE (Q). We will prove three claims that will be useful in our proof.

Claim 1:

  (i) e (Q) = e (R),

 (ii) E (Q)     E (R) and       2 E (R) \ M (Q) )       2 E (Q), and

 (iii) j 2 N U (Q).


Proof of Claim 1:

  (i) Since M (Q)          M (R) we have e (Q)     e (R). Since j 2 N U (R), there exists a Pareto-e¢ cient
      matching        2 E (R) such that     (j) = j. We have j j = e (R) and          2 M (Q) which implies
      e (Q)    j j = e (R). Therefore e (Q) = e (R).




                                                       39
 (ii) First let    2 E (Q). We have      2 M (Q)     M (R). Moreover j j = e (Q) and e (Q) = e (R) by
     Claim 1 (i) implying that j j = e (R). Therefore        2 E (R).
     Next let       2 E (R) \ M (Q). Since      2 E (R), we have j j = e (R) = e (Q) and this together
     with     2 M (Q) imply       2 E (Q).

(iii) Since j 2 N U (R), there exists a Pareto-e¢ cient matching           2 E (R) such that    (j) = j.
     We have         2 M (Q) : Moreover j j = e(R) and e(R) = e(Q) by Claim 1 (i) implying that
        2 E (Q). This together with      (j) = j imply that j 2 N U (Q).


Claim 2:

  (i) N O (R)      N O (Q) [ N P (Q),

 (ii) N U (R)      N U (Q) and for all I 2 D (R) nfJg, either I 2 D (Q) or I     N P (Q).


Proof of Claim 2:

  (i) We prove Claim 2 (i) by contradiction. Suppose there exists a patient i 2 N O (R) \ N U (Q).
     Then there exists a Pareto-e¢ cient matching         2 E (Q) such that (i) = i. By Claim 1 (ii)
     E (Q)        E (R), and therefore   2 E (R). This together with     (i) = i imply that i 2 N U (R)
     contradicting i 2 N O (R). Therefore N O (R) \ N U (Q) = ; and hence N O (R)              N O (Q) [
     N P (Q) :

 (ii) We prove Claim 2 (ii) in four steps:

  Step 1. We …rst prove that N U (Q)         N U (R). Pick a patient i 2 N U (Q). There exists a Pareto-
            e¢ cient matching      2 E (Q) such that     (i) = i. By Claim 1 (ii), E (Q)       E (R) and
                                                                                  U
            therefore    2 E (R). This together with     (i) = i imply that i 2 N (R).
  Step 2. Let I 2 D (R) nfJg. Clearly I        N U (R). We will show that I \ N O (Q) = ; by
          contradiction. Suppose there exists a patient i 2 I \ N O (Q). Since i 2 N O (Q), there
            exists a patient h 2 N U (Q) \ C (i; N; Q). Since i 62 J, we have i 6= j and since i 62 J
            and i 62 N O (R) we have i 6= j 0 . Therefore C (i; N; Q) = C (i; N; R) and since I 2 D (R),
            we have C(i; N; R) = C (i; I; R) [ C i; N O (R) ; R . These imply h 2 C i; N O (R) ; R or
            h 2 C (i; I; R). By Claim 2 (i), no overdemanded patient under R is underdemanded under
            Q. Therefore h, who is underdemanded under Q, is not a member of C i; N O (R) ; R
            N O (R), which in turn implies h 2 C (i; I; R)    I. Since h 2 N U (Q), there exists a Pareto-
            e¢ cient matching     2 E (Q) such that (h) = h. By Claim 1 (ii), we have E (Q)         E (R)

                                                    40
        which in turn implies     2 E (R). Since (h) = h and I 2 D (R), we have (h0 ) 2 In fh; h0 g
        for all h0 2 In fhg by the GED Lemma. Construct the following Pareto-e¢ cient matching
         2 E (R):
             (i) = i and     (h0 ) 2 In fi; h0 g for all h0 2 In fig ; and
              (h0 ) =   (h0 ) for all h0 2 N nI.
        Such a Pareto-e¢ cient matching            2 E (R) exists by the GED Lemma. Since         2 E(Q),
         (j) 6= j 0 and since j; j 0 2 N nI,        (j) 6= j 0 either. Therefore     2 M (Q) and hence
          2 E (Q) by Claim 1(ii). This together with (i) = i imply i 2 N U (Q) which in turn
        contradicts i 2 N O (Q). Therefore I \ N O (Q) = ; as desired.
Step 3. Let I 2 D (R) nfJg. We will show that I \ N U (Q) 6= ; implies I                     N U (Q) : Let
        i 2 I \ N U (Q). Then there is a Pareto-e¢ cient matching             2 E(Q) such that    (i) = i.
        By Claim 1 (ii) E (Q)       E (R), and therefore        2 E (R). Since     (i) = i and I 2 D (R) ;
        we have (h) 2 In fi; hg for all h 2 In fig by the GED Lemma. Let h 2 I. Construct the
        following Pareto-e¢ cient matching 2 E (R):
             (h) = h and      (h0 ) 2 In fh; h0 g for all h0 2 In fhg ; and
              (h0 ) =   (h0 ) for all h0 2 N nI.
        Such a Pareto-e¢ cient matching            2 E (R) exists by the GED Lemma. Since        2 E (Q),
                  0                 0                       0
         (j) 6= j and since j; j 2 N nI, (j) 6= j either. Therefore 2 M (Q) and hence
         2 E (Q) by Claim 1 (ii). This together with (h) = h imply h 2 N U (Q) and since h 2 I
        was arbitrary, we have I        N U (Q) as desired.
Step 4. Let I 2 D (R) nfJg such that I        N U (Q) : We will show that I 2 D (Q). We need to show
        that there is no patient i 2 C (I; N; Q) \ N U (Q). Suppose there is such a patient i. Then
        since N U (Q) N U (R) by Step 1 and C (I; N; Q) = C (I; N; R) by I N n fj; j 0 g, we have
        i 2 C (I; N; R) \ N U (R) contradicting I is an odd component of N nN O (R) ; RN nN O (R)
        and completing the proof of Step 4. Recall that N O (Q) is the set of patients each of whom
        is not underdemanded under Q and is a neighbor of an underdemanded patient under Q.
        Since N O (R)   N O (Q) [ N P (Q) by Claim 2 (i), no patient in C I; N O (R) ; Q
        N O (R) is underdemanded under Q. Since I                N U (Q) by assumption, no patients in
        C I; N O (R) ; Q are perfectly matched under Q either. Therefore, C I; N O (R) ; Q
        N O (Q). This together with C (I; N; Q) = C I; N O (R) ; Q imply that (I; QI ) is an odd
        component of N nN O (Q) ; QN nN O (Q) .

   We are ready to complete the proof of Claim 2(ii). By Step 1, N U (R)                    N U (Q). Let
   I 2 D (R) nfJg. By Step 2, I         N U (Q) [ N P (Q). Therefore if I \ N U (Q) = ; then I     N P (Q)
   and if I \ N U (Q) 6= ; then I 2 D(Q) by Steps 3 and 4.

                                                     41
Claim 3: uE
          i (Q)         uE
                         j (Q) for any i 2 J.


Proof of Claim 3: Recall that patient j 0 is the patient who is declared to be incompatible by patient
j under Q, although they are mutually compatible under R. Also recall that either j 0 2 N O (R) or
j 0 2 J. We consider these two cases separately:

Case 1. j 0 2 N O (R): In this case QJ = RJ . First, we will show that J                      N U (Q). Recall that
J 2 D (R). Let i 2 J. Since i 2 N U (R), there exists a Pareto-e¢ cient matching                     2 E (R) such
that (i) = i. By the GED Lemma, (h) 2 Jn fh; ig for all h 2 Jn fig. In particular (j) 6= j 0 and
therefore 2 M (Q) which in turn implies 2 E(Q) by Claim 1(ii). This together with (i) = i
imply that i 2 N U (Q) and since i 2 J is arbitrary, J               N U (Q). Moreover since J was an odd
component under R and QJ = RJ , J remains part (or all) of an odd component under Q. Hence
by construction of uE (Q), all patients in J, including patient j, are assigned the same utility under
uE (Q).
                                                      E                  E
Case 2. j 0 2 J: Consider the support of lottery          (Q). Since         (Q) is ex-post e¢ cient, the support
     E
of       (Q) is a subset of E (Q). We will prove that uE
                                                       i (Q)        uE
                                                                     j (Q) for all i 2 Jn fjg by contradiction.
Suppose there exists a patient i 2 Jn fig such that uE        E             E
                                                     i (Q) < uj (Q). Since ui (Q) < 1, there exists
a Pareto-e¢ cient matching 2 E (Q) with E (Q) > 0 such that (i) = i. Since by Claim 1 (ii)
E (Q)       E (R), we have     2 E (R). Since J 2 D (R), by the GED Lemma there exists one and only
one patient h 2 J such that (h) 2 N O (R) [ fhg. Therefore since (i) = i, we have (j) 2 Jn fjg.
Construct the following Pareto-e¢ cient matching          2 E (R):

          (j) = j and    (h) 2 Jn fj; hg for all h 2 Jn fjg.

          (h) =   (h) for all h 2 N nJ.

     Such a matchingexists by the GED Lemma. Moreover since (j) = j wenhave 2 M (Q) which  o
                                                                             uE (Q) uE (Q)
in turn implies 2 E (Q) by Claim 1(ii). Let " be such that 0 < " min E (Q) ; j 2 i           :
Let = ( ) 2M(Q) 2 L (Q) be such that
                                                          8    E
                                                          >
                                                          <        (Q)   "    if   =
                                                               E
                         for all   2 M (Q) ;         =             (Q) + "    if   =      .
                                                          >
                                                          :    E
                                                                   (Q)        otherwise

That is, lottery     is constructed from lottery E (Q) by subtracting " and adding " . We have
                                           8
                                           >    E
                                           < uh (Q) " if h = j
                                  uh ( ) =     uE
                                                h (Q) + " if h = i
                                           >
                                           : uE (Q)
                                                h         otherwise

                                                     42
Since there is “utility transfer” from the higher utility patient j to the lower utility patient i, util-
ity pro…le u ( ) Lorenz-dominates the egalitarian pro…le uE (Q) under Q contradicting Theorem 3.
Therefore uE
           i (Q)        uE
                         j (Q) for all i 2 Jn fjg.


   We are ready to complete the proof of Theorem 4. Suppose patient j strictly bene…ts from
declaring patient j 0 incompatible. That is, suppose

                                                   uE        E
                                                    j (Q) > uj (R):

We will show that this will lead to a contradiction. Let J 2 Dk (R). Since E (Q) is an ex-post
e¢ cient lottery under Q; E (R) is an ex-post e¢ cient lottery under R; and e (Q) = e (R) by Claim
1 (i), we have
                                   X                                    X
                                         uE
                                          i (Q) = e (Q) = e (R) =             uE
                                                                               i (R) .
                                   i2N                                  i2N

Therefore, since   uE
                    j   (Q) >   uE
                                 j   (R), there exists a patient h 2 N such that uE        E
                                                                                  h (Q) < uh (R). This
implies uE                                    U            U
         h (Q) < 1 which in turn implies h 2 N (Q). Since N (Q)                          N U (R) by Claim 2 (ii),
                                                                                               E
h 2 N U (R) as well. In a way of speaking, the utility of patient j increases under                (Q) with respect
to E (R) at the expense of the utility of some other patients each of whom is underdemanded under
R. That is, some utility
                     nS is transferred    from someounderdemanded patients under R to patient j. We
                         k            S q(R)
partition N U (R) as     `=1 J` (R) ;   `=k+1 J` (R) .
                          Sq(R)
    Consider patients in `=k+1 J` (R) : By the construction of uE (R), at any matching 2 E (R)
                                             Sq(R)
in the support of E (R), any patient in `=k+1 J` (R) either remains unmatched or she is matched
                                             Sq(R)
with another underdemanded patient in `=k+1 J` (R) or is matched with an overdemanded patient
   Sq(R)                               S                                        Sq(R)
in `=k+1 N`O (R). Since patients in k`=1 J` (R) are handled before patients in `=k+1 J` (R) during
                                                      S
the construction of uE (R), there is no patient in k`=1 J` (R) that is mutually compatible with any
           Sq(R)                                     S                             Sq(R)
patient in `=k+1 N`O (R). Since any patient in k`=1 J` (R) and any patient in `=k+1 J` (R) are
                                                        S
in di¤erent odd components, there is no patient in k`=1 J` (R) that is mutually compatible with a
           Sq(R)                                          S
patient in `=k+1 J` (R), either. Therefore for any i 2 k`=1 J` (R) ; we have
                                                    q(R)
                                                     [
                                   C (i; N; R) \             N`O (R) [ J` (R) = ;.
                                                    `=k+1
                           Sq(R)                                          Sq(R)
Therefore, patients in        N`O (R) shall be committed for patients in `=k+1 J` (R) under the
                             `=k+1
                                                                    Sq(R)
pro…le Q as well, and therefore the aggregate utility of patients in `=k+1 J` (R) cannot decrease
under Q. Since aggregate utility remains constant at e (Q) = e (R), and since only patients in
N U (Q)    N U (R) can have a utility reduction,
                                           [
                                           k
                                   9 h2          J` (R)     s.t.   uE        E
                                                                    h (Q) < uh (R) :
                                           `=1


                                                             43
      Since j 2 Jk (R), we have uE
                                 h (R)                  uE
                                                         j (R) by Claim 1 in the proof of Theorem 3. This together
with uE        E
      j (Q) > uj (R) imply that

                                           uE        E
                                            h (Q) < uh (R)                  uE        E
                                                                             j (R) < uj (Q) .                                          (16)

      Recall that patient j 0 is the patient that j declared as incompatible under Q although they were
mutually compatible under R. Since j 2 J 2 D(R) and rj;j 0 = 1, we have either j 0 2 Jn fjg or j 0 2
N O (R). If j 0 2 Jn fjg then, uEj (Q)              uE                         0     O          0    O    P
                                                      j 0 (Q) by Claim 3. If j 2 N (R) then j 2 N (Q) [ N (Q)
by Claim 2 (i) and we have uE   j (Q)               1 = uE  j 0 (Q). These together with Eq 16 imply that

                                 uE        E
                                  h (Q) < uh (R)                     uE        E
                                                                      j (R) < uj (Q)          uE
                                                                                               j 0 (Q) .                               (17)
                   E                   E
      Let     =        (R) and ' =         (Q). Given , construct lottery                      as follows: For any matching               in
the support of ;

      1. If   (j) 6= j 0 , then do not alter this “portion” of the lottery (i.e. let                           =      for any         in the
                                            0
         support of       with   (j) 6= j ):

      2. If   (j) = j 0 , then

          (a) construct the matching                j;j 0    from       by “breaking” the match between j and j 0 (leaving
               each one unmatched) and preserving the rest of the matching ; and
          (b) replace matching         with          j;j 0   for each such matching in lottery                (i.e. let   j;j 0
                                                                                                                                  =      for
               any      in the support of           with           (j) = j 0 .

Note that          is feasible under Q and ui ( ) = ui ( ) = uE                          0
                                                              i (R) for all i 2 N n fj; j g. Given " 2 (0; 1),
let
                                 "                                                 "
                                     = " + (1               ") '       and             = " + (1       ") '.
Note that ui ( " ) = ui ( " ) for all i 2 N n fj; j 0 g by construction of                           from .
   Since ' is feasible under R, ' 2 L (R). Therefore since is a Lorenz-dominant lottery for the
reduced problem R by Theorem 3; Lorenz-dominates ' which in turn implies " Lorenz-dominates
' by Lemma 7.
      Pick " 2 (0; 1) small enough such that uj ( " ) > uh ( " ) = uh ( " ) and uj 0 ( " ) > uh ( " ) = uh ( " ).
This can be done by Eq 17.
   Let h be the patient with sth                            th
                              1 lowest utility under ' and s2 lowest utility under
                                                                                                                          "
                                                                                                                              . Let s =
min fs1 ; s2 g.
               "
      Since        Lorenz-dominates ' by Lemma 7,
                                 X
                                 t
                                                    (`)
                                                              X
                                                              t
                                       (u ( ))  "
                                                                      (u ('))(`)         for all t     n.
                                 `=1                          `=1


                                                                         44
Since " 2 (0; 1) is such that uj ( " ) > uj ( " ) > uh ( " ) and uj 0 ( " ) > uj 0 ( " ) > uh ( " ), neither j
nor j 0 is one of the s lowest utility agents under                                 "
                                                                                        . Therefore, since only patients j,j 0 are a¤ected
                               "           "
between lotteries                  and         ,

                                           X
                                           t
                                                                    (`)
                                                                          X
                                                                          t
                                                       (u ( )) "
                                                                                (u ('))(`)       for all t         s.                                       (18)
                                           `=1                            `=1

We will show that Inequality 18 holds strictly for some t                                     s which in turn will contradict ' is Lorenz-
dominant under Q completing the proof. Suppose not. Then Inequality 18 holds with equality which
in turn implies
                                                       (u ( " ))(t) = (u ('))(t)             for all t        s.                                            (19)

Observe that there is t                        s such that the tth smallest utility patient is di¤erent under these two
lotteries. In particular this is the case for t = s, because (1) uh ( " ) = uh ( " ) > uh (') and (2) h
is the sth smallest utility agent under one of the two lotteries " ,' although not in both since that
would contradict Eq 19. Pick the smallest such t. That is under " and ', not only the t^th smallest
utility patient is the same patient for any t^ < t, but she also has the same utility. On the other hand
the tth lowest utility patient di¤ers under the two lotteries although they have the same utility by
Eq 19:
                                                   1    "                   "                                                                           "
   Now consider the lottery                        2
                                                            + 12 '. Since       and ' are both feasible under Q, the lottery                        1
                                                                                                                                                    2
                                                                                                                                                            + 12 '
is feasible under Q as well. Under this lottery

                                                                                                         "
      the smallest utility patient is the same patient as in both                                             ,' and she has the same utility
             1   "       1         (1)                  "    (1)            (1)
         u   2
                     +   2
                           '             = (u ( ))                 = (u (')) ;

                                                                    ..                                   ..
                                                                     .                                    .

      the (t 1)th smallest utility patient is the same patient as in both                                                   "
                                                                                                                                ,' and she has the same
                            (t 1)
      utility u 21 " + 12 '       = (u ( " ))(t 1) = (u ('))(t 1) .

But the utility of the tth smallest utility patient under 12 " + 12 ' is strictly larger than the utility
of the tth smallest utility patient under '. That is because, whoever she is, her utility is no less
than (u ('))(t) under both                         "
                                                       ; ' by Eq 19 and strictly larger in at least one, since the tth smallest
                                                   "                                                                    1       "
utility patient di¤ers under                           and '. Hence ' does not Lorenz-dominate                          2
                                                                                                                                    + 12 ', a feasible lottery
under Q, a contradiction. Therefore Inequality 18 holds strictly for some t s. But then ' does not
Lorenz-dominate " , a feasible lottery under Q, leading to another contradiction and completing the
proof.



                                                                                  45
References
 [1] A. Abdulkadiro¼
                   glu and T. Sönmez (1998) “Random serial dictatorship and the core from random
    endowments in house allocation problems.”Econometrica 66: 689-701.

 [2] A. Abdulkadiro¼
                   glu and T. Sönmez (1999) “House allocation with existing tenants.” Journal of
    Economic Theory 88: 233-260.

 [3] A. Abdulkadiro¼
                   glu and T. Sönmez (2003a) “Ordinal e¢ ciency and dominated sets of assign-
     ments”Journal of Economic Theory 112: 157-172.

 [4] A. Abdulkadiro¼
                   glu and T. Sönmez (2003b) “School choice: A mechanism design approach”
     American Economic Review 93: 729-747.

 [5] M. Abecassis et. al (2002) “Consensus statement on the live organ donor.” The Journal of the
    American Medical Association 284: 2919-2926.

 [6] H. Abeledo and U.G. Rothblum (1994) ”Stable matchings and linear inequalities.” Discrete
    Applied Mathematics 54: 1-27.

 [7] S. Allen (2004) “Cross-donor system planned for region’s kidney patients.” The Boston Globe,
    June 5.

 [8] A. Bogomolnaia, L. Ehlers and R. Deb (2002) “Incentive-compatible assignment on the full
    preference domain.”Journal of Economic Theory forthcoming.

 [9] A. Bogomolnaia and H. Moulin (2001) “A new solution to the random assignment problem.”
    Journal of Economic Theory 100: 295-328.

[10] A. Bogomolnaia and H. Moulin (2002) “A simple random assignment problem with a unique
     solution.”Economic Theory 19: 623-635.

[11] A. Bogomolnaia and H. Moulin (2004) “Random matching under dichotomous preferences.”
     Econometrica 72: 257-279.

[12] H. Cres and H. Moulin (2001) “Scheduling with opting out: Improving upon random priority.”
    Operations Research 49: 565-577.

[13] K.-S. Chung (2000) “On the existence of stable roommate matchings.” Games and Economic
    Behavior 33: 206-230.



                                               46
[14] F.L. Delmonico (2004) “Exchanging kidneys –Advances in living-donor transplantation.” The
    New England Journal of Medicine 350: 1812-1814.

[15] E. Diamantoudi, E. Miyagawa and L. Xue (2004) “Random paths to stability in the roommate
     problem,”Games and Economic Behavior 48: 18-28.

[16] B. Dutta and D. Ray (1989) “A concept of egalitarianism under participation constraints.”
    Econometrica 57: 615-635.

[17] J. Edmonds (1965) “Paths, trees, and ‡owers.”Canadian Journal of Mathematics 17: 449-467.

[18] J. Edmonds (1971) “Matroids and the greedy algorithm.” Mathematical Programming 1: 127-
    136.

[19] L. Ehlers (2002) “Coalitional strategy-proof house allocation.”Journal of Economic Theory 105:
    298-317.

[20] L. Ehlers and B. Klaus (2003). “Coalitional strategy-proof and resource monotonic solutions for
     multiple assignment problems.”Social Choice and Welfare 21: 265-280.

[21] L. Ehlers, B. Klaus and S. Papai (2002) “Strategy-proofness and population-monotonicity in
     house allocation problems.”Journal of Mathematical Economics 38: 329-339.

[22] D. Gale and L.S. Shapley (1962) “College admissions and the stability of marriage.” American
    Mathematical Monthly 69: 9-15.

[23] T. Gallai (1963) “Kritische graphen II.”Magyar Tud. Akad. Mat. Kutató Int. Közl. 8: 373-395.

[24] T. Gallai (1964) “Maximale systeme unabhängiger kanten.” Magyar Tud. Akad. Mat. Kutató
    Int. Közl. 9: 401-413.

[25] D.W. Gjertson and J.M. Cecka (2000) “Living unrelated donor kidney transplantation.”Kidney
     International 58: 491-499.

[26] M.X. Gommens (2004) Lecture Notes on Topics in Combinatorial Optimization, Massachusetts
     Institute of Technology Lecture Notes.

[27] P. Hall (1935) “On representatives of subsets.” Journal of London Mathematical Society 10:
    26-30.

[28] B. Korte and J. Vygen (2002) Combinatorial Optimization: Theory and Algorithms. Secon
    Edition. Springer: Berlin, Heidelberg, New York.

                                                47
[29] L. Lovász and M.D. Plummer (1986) Matching Theory. North-Holland: Amsterdam, New York,
    Oxford, Tokyo.

[30] M. Lucan, P. Rotariu, D. Neculoiu and G. Iacob (2003) “Kidney exchange program: A viable
    alternative in countries with low rate of cadaver harvesting.” Transplantation Proceedings 35:
    933-934.

[31] P. Milgrom (2004), Putting Auction Theory to Work, Cambridge University Press.

[32] M. Niederle, and A. E. Roth (2004), “The Gastroenterology Fellowship Match: How it failed,
    and why it could succeed once again,”Gastroenterology, forthcoming.

[33] G. Opelz (1997) “Impact of HLA compatibility on survival of kidney transplants from unrelated
    live donors.”Transplantation 64, 1473-1475.

[34] G. Opelz, for the Collaborative Transplant Study (1998) “HLA compatibility and kidney grafts
    from unrelated live donors.”Transplantation Proceedings 30: 704-705.

[35] S. Papai (2000) “Strategyproof assignment by hierarchical exchange.” Econometrica 68: 1403-
    1433.

[36] R. Rado (1957) “Note on independence functions.” Proceedings of the London Mathematical
    Society 7: 300-320.

[37] F.T. Rapaport (1986) “The case for a living emotionally related international kidney donor
    exchange registry.”Transplantation Proceedings 18: 5-9.

[38] L.F. Ross, D.T. Rubin, M. Siegler, M.A. Josephson, J.R. Thistlethwaite, Jr. and E.S. Woodle
    (1997) “Ethics of a paired-kidney-exchange program.” The New England Journal of Medicine
    336: 1752-1755.

[39] A.E. Roth (1982a) “Incentive compatibility in a market with indivisible goods.”, Economics
    Letters 9: 127-132.

[40] A.E. Roth (1982b) “The economics of matching: stability and incentives”, Mathematics of
     Operations Research 7: 617-628.

[41] A.E. Roth (1984). "The Evolution of the Labor Market for Medical Interns and Residents: A
    Case Study in Game Theory", Journal of Political Economy, 92, 991 1016.

[42] A.E. Roth, (1985)"The College Admissions Problem is not Equivalent to the Marriage Prob-
    lem," Journal of Economic Theory, Vol. 36, 277-288.

                                               48
[43] A.E. Roth, (2002) “The Economist as Engineer: Game Theory, Experimental Economics and
    Computation as Tools of Design Economics,”Econometrica, 70, 4, 1341-1378.

[44] A.E. Roth, and E. Peranson (1999), "The Redesign of the Matching Market for American
     Physicians: Some Engineering Aspects of Economic Design,” American Economic Review, 89,
    4, September, 748-780.

[45] A.E. Roth, U.G. Rothblum and J.H. Vande Vate (1993) “Stable matchings, optimal assignment
     and linear programming.”Mathematics of Operations Research 18: 803-828.

[46] A.E. Roth, T. Sönmez and M.U. Ünver (2004) “Kidney Exchange.” Quarterly Journal of Eco-
     nomics 119: 457-488.

[47] A.E. Roth and J.H. Vande Vate (1990) "Random Paths to Stability in Two-Sided Matching,"
    Econometrica, 58, 1475-1480.

[48] A. E. Roth and X. Xing (1997) “Turnaround time and bottlenecks in market clearing: decen-
    tralized matching in the market for clinical psychologists.” Journal of Political Economy 105:
    284-329.

[49] T. Sönmez and M.U. Ünver (2001) “House allocation with existing tenants: An equivalence.”
    Games and Economic Behavior forthcoming.

[50] L-G. Svensson (1994) “Queue allocation of indivisible goods.” Social Choice and Welfare 11:
    323-330.

[51] L.-G. Svensson (1999) “Strategy-proof allocation of indivisible goods.”Social Choice and Welfare
    16: 557-567.

[52] C.-P. Teo and J. Sethuraman (2000) “On a cutting plane heuristic for the stable roommates
    problem and its applications.”European Journal of Operational Research 123: 195-205.

[53] R.B. Wilson (2002) “Architecture of Power Markets,” Econometrica, Vol. 70, No. 4 (July),
    1299-1340.




                                                 49
