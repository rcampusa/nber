                              NBER WORKING PAPER SERIES




   QUANTIFYING FAMILY, SCHOOL, AND LOCATION EFFECTS IN THE PRESENCE
                 OF COMPLEMENTARITIES AND SORTING

                                         Mohit Agrawal
                                        Joseph G. Altonji
                                      Richard K. Mansfield

                                       Working Paper 25167
                               http://www.nber.org/papers/w25167


                     NATIONAL BUREAU OF ECONOMIC RESEARCH
                              1050 Massachusetts Avenue
                                Cambridge, MA 02138
                                    October 2018




We thank David Card, Julie Berry Cullen, Mel Stevens, two anonymous referees, participants in
the NBER Youth Labor Markets pre-conference and conference and participants in seminars at
EIEF, Oxford, Princeton, the University of Chicago Harris School, UCSD and Yale for many
valuable comments. This research uses data from the National Center for Education Statistics
under a restricted use data license. The shortcomings of the paper are our sole responsibility. The
views expressed herein are those of the authors and do not necessarily reflect the views of the
National Bureau of Economic Research.

NBER working papers are circulated for discussion and comment purposes. They have not been
peer-reviewed or been subject to the review by the NBER Board of Directors that accompanies
official NBER publications.

© 2018 by Mohit Agrawal, Joseph G. Altonji, and Richard K. Mansfield. All rights reserved.
Short sections of text, not to exceed two paragraphs, may be quoted without explicit permission
provided that full credit, including © notice, is given to the source.
Quantifying Family, School, and Location Effects in the Presence of Complementarities and
Sorting
Mohit Agrawal, Joseph G. Altonji, and Richard K. Mansfield
NBER Working Paper No. 25167
October 2018
JEL No. C1,C31,I20,I24,I26,R23

                                         ABSTRACT

We extend the control function approach of Altonji and Mansfield (2018) to allow for multiple
group levels and complementarities. Our analysis provides a foundation for causal interpretation
of multilevel mixed effects models in the presence of sorting. In our empirical application, we
obtain lower bound estimates of the importance of school and commuting zone inputs for
education and wages. A school/location combination at the 90th versus 10th percentile of the
school/location quality distribution increases the high school graduation probability and college
enrollment probability by at least .06 and .17, respectively. Treatment effects are heterogeneous
across subgroups, primarily due to nonlinearity in the educational attainment model.


Mohit Agrawal                                   Richard K. Mansfield
Yale University                                 Economics Building Room 04B
PO Box 208268                                   University of Colorado-Boulder
New Haven, CT 06520-8268                        Boulder, CO 80309
mohitii@gmail.com                               and NBER
                                                richard.mansfield@colorado.edu
Joseph G. Altonji
Department of Economics
Yale University
Box 208264
New Haven, CT 06520-8264
and NBER
joseph.altonji@yale.edu




An online appendix is available at https://www.nber.org/data-appendix/w25167
1    Introduction
    Designers of policy interventions often must choose whether to target neighborhoods, schools,
or broader local or regional areas. They would like to know which policies are most effective for
each area, but research has been very slow in providing answers (Katz 2015). In this paper, we focus
on the more modest goal of measuring the overall importance of neighborhoods, schools, and local
areas for adult outcomes. Information about where inequality arises provides guidance about where
the most potential progress can be made, even if it does not provide a specific plan of action.
    The efficacy of particular policies and the relative importance of neighborhood vs. school. vs.
broader local area factors is likely to vary across students. For example, school-level dropout pre-
vention policies may improve outcomes for struggling students but not stronger or better-supported
students, while opening a satellite campus of a flagship research university might benefit high
achieving low income students the most. Such considerations motivate us to work with a multi-
level mixed effects (MME) model in which individual characteristics interact with observed and
unobserved school and area characteristics.
    The use of MME models (also known as hierarchical linear models and random coefficients
models) was stimulated by interest in the interplay among the student, classroom, and school factors
that determine educational outcomes.1 However, the MME literature is mindful of but does not
address sorting bias arising from school and neighborhood choice. As Durlauf (2004) and Graham
(2018) emphasize, differences in outcomes across neighborhoods combine the causal effects of
neighborhood with differences across neighborhoods in the observed and unobserved attributes of
children that matter for their outcomes. Sorting poses similar problems for assessing schools.
    Our main methodological contribution is to address the sorting problem present in MME mod-
els. We do this by using a flexible production function specification and a rich but tractable model
of school and neighborhood choice to derive exact formulas relating the slope parameters and error
component variances of a standard MME specification to the corresponding production function pa-
rameters. We then use these formulas combined with MME estimates to characterize the importance
of school and location choices for students’ long-run education and labor market outcomes.
    We postpone precise statements of our theoretical results and the assumptions, but the questions
about MME models that we address and the answers that we give may be summarized as follows.
Consider the following MME level regression model:


                  Ygi = X i B + X g G 1 + Z 2g G 2 + Mi X g r 1 + Mi Z 2g r 2 + vg + (vgi − vg ).         (1)

    Here i denotes the student and g denotes the neighborhood, school, and associated local area
the student is exposed to. Ygi is a long-run student outcome, such as wages at age 25. X i is a
set of observed student characteristics such as mother’s education. X g is a set of observed peer

    1 Garnerand Raudenbush (1991) is a good example. The early editions of Goldstein (2011) and Raudenbush and
Bryk (2002) became key references for empirical researchers.


                                                        1
characteristics—averages of X i among the students in g. Z 2g is a set of observed characteristics
of the school and location that influence wages, such as student/teacher ratio. Mi is a student
characteristic that interacts with X g and Z 2g in influencing outcomes, such as minority status. vg
is a group specific error and (vgi − vg ) is an idiosyncratic error. The error components are treated
as random effects and are defined to be uncorrelated with the explanatory variables. The slope
coefficients and error variances are defined to be what one recovers using a random effects estimator
with a very large sample.
   The production function that actually determines the outcome Ygi is assumed to take the same
linear form with interaction terms as the above estimating equation. However, it also includes
unobserved (by the econometrician) counterparts to X i , X g , Z 2g , Mi X g and Mi Z 2g . In general,
sorting-driven differences across school/locations in unobserved student characteristics as well as
other forms of omitted variables bias lead the parameters of (1) to differ from the production function
parameters.
   We then build upon and extend to an interactive setting the control function approach of Altonji
and Mansfield (2018) (hereafter, AM). In particular, they show that even a flexible version of a
standard multinomial choice model implies a relationship between school/neighborhood averages of
observed student characteristics and averages of unobserved student characteristics. Consequently,
                                                                  X g ) can serve as controls for the
school/neighborhood averages of observed student characteristics (X
averages of unobserved student characteristics that would otherwise bias estimates of the importance
of school and neighborhood effects.
   Under somewhat stronger assumptions (discussed below) we show that the coefficient vector r 2
on the interaction between a student characteristic Mi such as mother’s education and a set of ob-
served “group” characteristics Z 2g is the sum of two components. The first is the causal effect of the
interaction between mother’s education and the observed group characteristics. The second is the
effect of the interaction between mother’s education and the part of the contribution of unobserved
group characteristics (e.g. the quality of a principal) that covary with the observed group charac-
teristics, holding observed and unobserved student characteristics fixed. Analogously, r 1 combines
two components. The first is the causal effect of interactions between Mi and both observed and un-
observed peer characteristics (such as average mother’s education and average unobserved parental
motivation). The second is the causal effect of part of the interaction between Mi and unobserved
school and location characteristics. The key point is that under the assumptions of the model the
estimates of both r 1 and r 2 exclusively reflect interactions between the student and the environment
and not sorting.
   We also show that AM’s expression for G 2 , the coefficient vector on the main effects of observed
school and area characteristics, remains unchanged when observed and unobserved interactions are
introduced to the production function. Specifically, it picks up the causal effect of the observed
school and area characteristics plus a second component that reflects their association with unob-
served school and area characteristics that affect outcomes. It is not contaminated by sorting bias or
unobserved interactions. AM’s result that school and neighborhood error components vg are simi-

                                                  2
larly uncontaminated by the effects of sorting also carries over to the model with interaction effects.
Finally, we also justify a causal interpretation for a random slope coefficient on Mi that captures
the interaction of an observed student characteristic with an index of unobserved school and area
characteristics.
   Taken together, these identification results reveal that even in the presence of endogenous sorting
of individuals to groups, multilevel mixed effects estimates can distinguish among four sources of
the variation in outcomes. The sources are individual contributions that are common across groups,
group contributions that are common across individuals, contributions that consist of interactions
between student and group inputs, and a set of ambiguous contributions (associated with X g G 1 )
that either reflect common group inputs or group-averages of individual inputs. We then show that
this decomposition is sufficient to generate meaningful (albeit conservative) answers to two key
questions. How much do the schools and locations we choose for our children matter for their
outcomes? And how much does the importance of schools and locations depend on the students’
and parents’ own inputs?
   As in AM’s analysis, the use of school/location averages of observed student characteristics X g
to control for school/location averages of unobserved characteristics is likely to lead to an under-
statement of the importance of school and neighborhood. The main reason is that by treating the
averages as controls that absorb sorting bias, we are discarding the main effects of peers on out-
comes. A second reason is that the group averages will absorb a portion of the unobserved school
or area components that are uncorrelated with the observed components and are correlated with the
amenities that families sort on. Consequently, our analysis only places a lower bound on the overall
importance of school and area factors for student outcomes.
   We use the above analysis as the theoretical foundation to interpret MME model estimates from
two cohort-specific panel surveys, the National Educational Longitudinal Survey of 1988 (NELS88)
and the Educational Longitudinal Survey of 2002 (ELS2002). These data sets provide a rich set of
student characteristics for samples of students from each of a large sample of schools. Students are
followed for several years, which permits investigation of longer run outcomes such as high school
graduation, attendance at a four year college, and attainment of a college degree. In addition, they
contain location of residence (ZIP code or block group) and school identifiers.
   We use the multilevel model estimates to measure the consequences of exposure to a low-quality
school versus a high-quality school, and a low-quality commuting zone versus a high-quality com-
muting zone. Here we define “quality” narrowly as collections of attributes that contribute to the
outcomes we consider (educational attainment or log wages). Our main results concern the “treat-
ment effects” of 10th -to-90th percentile shifts in school quality, in commuting zone quality, and in
combined school and commuting zone quality. First, we consider average effects. We take the
average over the student population of the effect of a 10th -to-90th percentile shift in the combined
school/commuting zone environment. Such a shift increases the high school graduation probability
by 0.088 in NELS88 and by about 0.061 in ELS2002 (which has a higher baseline graduation rate–
0.92). The effect of the school treatment is 0.06 in NELS and about 0.044 in ELS. The values for

                                                  3
the 10th -to-90th quantile shift in commuting zone quality are between 0.039 and 0.067.
   For the college enrollment probability, the combined school and commuting zone treatment
effect is between 0.17 and 0.18 for both NELS and ELS. The values for the school treatment are
about 0.125, while the values for the commuting zone treatment are about 0.115 in each dataset.
The effects of the combined treatment, the school treatment and the commuting zone treatment on
the probabilility of completing a BA degree are somewhat smaller in both datasets (0.085, 0.077,
and 0.046 in NELS and around 0.085, 0.070, and 0.065 in ELS). For wage rates at age 25, the
combined school and commuting zone treatment ranges between 11 and 12 percent. The values for
the school treatment range from 6.2 to 7.1 percent. The commuting zone effects range from 7.8 to
10.7 percent. Overall, the results suggest that large changes in school and commuting zone inputs
can make a substantial difference for students’ educational attainment and wage rates.
   We also present estimates of school and commuting zone “treatment” effects for particular pop-
ulation groups: blacks, Hispanics, whites with single mothers who did not attend college, whites
with two resident parents with college degrees, as well as for students at each percentile of an index
of student level variables that predict the outcomes. We do not find strong evidence that wages or
the latent indices governing the binary educational attainment outcomes depend on the interaction
between observed student characteristics and characteristics of the school and commuting zone,
although we cannot rule out modest interactions. Nevertheless, we do find important differences
in treatment effects across students. The heterogeneity is primarily due to the fact that the probit
function that we use for the education outcomes naturally imposes greater sensitivity to school and
location environment for students predicted to be close to the decision margin. Specifically, high
school graduation rates of subpopulations that tend to be disadvantaged are particularly sensitive to
the external environment, while few students from advantaged subpopulations are near the margin.
For college enrollment and college graduation, superior school and commuting zone inputs are im-
portant for all, but particularly important for students near or above the middle of the distribution of
student and family background.
   Finally, we provide a richer picture of sorting than is possible with two level models featuring
individual and school (Coleman et al. 1966; Jencks and Brown 1975; Betts 1995; Altonji and
Mansfield 2011; Alexander and Morgan 2016) or individuals and neighborhood (Solon et al. 2000).
We find that segregation by student quality (defined by an index of characteristics that promote
education and wages) is primarily across schools and commuting zones rather then within ZIP code
or block group among schoolmates. Our variance decompositions of educational attainment and
wages consistently show that individual level factors account for the lion’s share of the variance,
with school and commuting zone level variation making modest contributions, and neighborhood
level factors playing a smaller role. For example, in ELS2002 for college attendance, the within-
neighborhood (block group) share is 71.4 percent, while the neighborhood share is 3.1 percent, the
school share is 15.9 percent, and the commuting zone share is 9.7 percent. School and commuting
zone account for about 9 and 6 percent of the variance in log wages respectively, and block group
within a school accounts for about 3%. Within a school there is very little clustering in any of our


                                                   4
outcomes at the ZIP code level.
    Our paper builds on and contributes to several literatures. The model of school and location
choice that we use to address sorting on unobserved student characteristics is essentially that of
AM, although we are more specific about the distinction between neighborhood choice, school
choice, and region.2 AM in turn draw on the rich theoretical and empirical literature on equilibrium
sorting and matching other contexts.3 Control function approaches are widely used in econometric
work.
    On the empirical side, the literatures on the importance of families, neighborhoods, schools,
and region are each too vast to discuss meaningfully here. The most directly relevant are the large
number of studies that descend from the Coleman Report’s (Coleman et al. 1966) examination
of the importance of family background, peer characteristics, and school inputs using data with
a multilevel structure similar to the NELS88 and ELS2002.4 They found, in keeping with most
subsequent research, that family background is by far the most important determinant of education
success. Jencks and Brown (1975), Betts (1995), and Altonji and Mansfield (2011) are contributions
to the large literature in economics, sociology, and education that performs variance decompositions
separating the contribution of school- or neighborhood-level factors versus student-level factors for
test scores, educational attainment, and in a few cases wage rates. Focusing on neighborhood,
Jencks and Mayer (1990) provide a comprehensive review of earlier studies from economics and
sociology. They conclude that there is no strong evidence for neighborhood effects. However, some
of the studies they summarize do find effects. More recent reviews include Sampson et al. (2002),
Durlauf (2004), Durlauf and Ioannides (2010), Harding et al. (2011), Sharkey and Faber (2014),
and Graham (2018).5 Many of the papers emphasize that estimates of the impacts of particular
characteristics, such as percent minority, segregation measures, and poverty rates on socioeconomic
outcomes of children, often by racial group and poverty status, are subject to the problem of sorting
bias. A good example is Card and Rothstein (2007), who carefully address the issue in their analysis
of the effects of segregation on the test score gap between blacks and whites.
    Meghir and Rivkin (2011) discuss alternative approaches to estimating school fixed effects and
the effects of particular school inputs, and highlight the problem of endogenous selection of schools
and neighborhoods, among other econometric issues.
    There is also a small but growing experimental or quasi-experimental literature that attempts to
measure neighborhood or school effects. Oreopoulos (2003) and Jacob (2004) use quasi-random
assignment of neighborhood in the wake of housing project closings to estimate the magnitude of
neighborhood effects on student outcomes. They obtain small estimates, in contrast to Chyn (2018).
    2 The  multinomial choice formulation that we use to characterize the school/location choice problem with heteroge-
nous preferences is standard in the consumer choice literature, drawing on McFadden (1984), Berry (1994), and many
subsequent papers, including Bayer et al. (2007)’s study of the demand for housing and location.
    3 These include marriage (eg., Browning et al. 2014), the labor market (eg., Rosen 1974; Ekeland et al. 2004; Lise

2016; Lindenlaub 2017), and neighborhoods and schools (eg., Epple and Platt 1998; Epple and Sieg 1999).
    4 See Alexander and Morgan (2016) and Lucas (2016) for a recent discussions of the legacy of the Coleman Report

and its influence on subsequent research.
    5 Kline and Moretti (2014) provide a recent analysis of placed based policies.



                                                          5
A number of authors, including Kling et al. (2007), use the Moving to Opportunity experiment to
study effects of growing up in a low poverty neighborhood. Most of the work finds small effects.
However, Chetty et al. (2016) revisit the MTO experiment using Internal Revenue Service data on
young adult outcomes, including earnings, college attendance, and single parenthood. They find
substantial benefits for children who move before age 13 but not for older children.
    Using a sibling differences approach that also exploits high quality tax data, Chetty and Hendren
(2018a; 2018b) identify county-level and commuting zone level neighborhood effects on earnings
that are larger than but qualitatively consistent with our results. Aaronson (1998) finds substantial
effects of the census tract-level poverty rate and high school dropout rate on dropout rates and years
of education using a sibling differences design and PSID data.6
    Bergman (2016) finds that a lottery based opportunity to transfer from a predominantly minority
school district to a high income predominantly white district increases college enrollment by 10
percentage points. Deming et al. (2014) exploit randomized lottery outcomes from the school choice
plan in the Charlotte-Mecklenburg district and find large effects of attending a chosen public school
on high school graduation, college enrollment, and college completion for students coming from low
quality urban schools. Angrist et al. (2016) also use admissions lotteries. They find positive effects
of attending a Boston charter high school on performance on both high and low stakes exams and on
attendance at four-year colleges relative to two-year colleges. On the other hand, Cullen et al. (2006)
use a similar identification strategy with lotteries in Chicago Public Schools and do not find an effect
on the high school graduation probability. Dobbie and Fryer (2011) and Laliberte (2018) are rare
quasi-experimental attempts to distinguish neighborhood effects from school effects. Dobbie and
Fryer (2011) finds that the Harlem Children’s Zone has little effect on test scores, while Promise
Academy Charter schools have large effects that do not vary with residence in the zone. Laliberte
(2018) also finds that school effects are much more important than neighborhoods in determining
postsecondary enrollment and completion, at least in Montreal.
    The paper continues in Section 2, which presents the model of location and school choice and
AM’s control function result. Section 3 presents the model of outcomes used in the paper. Section
4 specifies the MME estimating equation used in the paper and establishes key identification results
relating slope parameters and error terms of the estimating equation to the parameters of the un-
derlying production function. Section 5 discusses the data and variables used in the study. Section
6 presents the estimation methodology. Section 7 presents the model estimates and the variance
decompositions that are derived from them. Section 8 presents lower bound estimates of treatment
effects on various educational outcomes and on log wages generated by shifts in school and com-
muting zone quality, both on average and for particular subpopulations. Section 9 concludes.




    6 Using  a sibling difference design, Altonji and Dunn (1996) find that higher teacher salaries and teacher/student
ratios (considered separately) increase wage rates.


                                                          6
2    A Multinomial Model of School and Location Choice and Sorting
    In this section we present AM’s model of how families choose school systems and associated
neighborhoods, recasted slightly to more explicitly consider neighborhood, school, and labor market
area.7 The presentation draws very heavily on AM, with small sections verbatim. We repeat some
of the discussion here so that the assumptions required for identification of the main effects of school
and location characteristics as well as their interactions with student characteristics (not considered
in AM) will be clear.        We use the terms “area” or “location” to refer to the joint influence of
neighborhood and commuting zone inputs. Throughout the paper, matrices, vectors, and matrix- or
vector-valued functions are in bold. The “prime” symbol denotes matrix or vector transposes.
    Parents choose a neighborhood n from the set N of neighborhoods. Due to attendance bound-
aries and travel costs, the choice of n then restricts the choice of school s to the subset S (n) of the
full set S . Since neighborhoods are embedded in labor market areas, the choice of neighborhood
also implicitly involves the choice of a commuting zone c. In our main specification we assume
parents choose among all available (n, s) pairs. To conserve notation, we introduce the subscript
g ≡ (n, s, c) to denote the combined neighborhood-school-commuting zone combination or “group”
experienced by a given child.
    We use a money-metric representation of the expected utility that the parents of student i receive
from choosing g, so that the utility function Ui (g) can be interpreted as the family’s consumer
surplus from their choice. We assume Ui (g) takes the following linear form:

                                           Ui (g) = W i A g + εgi − Pg .                                          (2)

A g ≡ [A1g , . . . , AKg ]0 is a K × 1 vector of underlying latent amenities that characterize the neighbor-
hood, the school and the commuting zone combination to which g refers. W i ≡ [W1i , . . . ,WKi ] is
a 1 × K vector of weights that captures the increases in family i’s willingness to pay for a neigh-
borhood and school per unit increase in each of its K amenity factors A1g , . . . , AKg , respectively. Pg
is the price of living in n plus a fixed utility cost associated with the logistics of attending school
s from neighborhood n. The component εgi is an idiosyncratic taste of the parent/student i for the
particular location and school.
    Next we specify an equation for willingness to pay (WTP) for particular amenities:

                                        W i = X i Θ + X Ui ΘU + Q i Θ Q .                                         (3)

where the row vectors X i , X Ui and Q i have L, LU , and LQ elements, respectively. The coefficient
matrix Θ is an L × K matrix whose `k-th entry captures the extent to which the willingness to pay
for the k-th element of the amenity vector A g varies with the `-th element of X i . The LU × K matrix
ΘU and the LQ × K matrix Θ Q are the corresponding coefficient matrices for X Ui and Q i . We define
X Ui so that [X
              X i , X Ui ] represents the complete set of student attributes that determine Ysi . Q i is a set
    7 AM model the choice of school attendance area, defining the choices of school and neighborhood to be synonymous.



                                                          7
of variables that influence WTP for amenities but have no direct effect on student outcomes. It is
convenient to define Q i , Θ and ΘU so that Q i is orthogonal to [X
                                                                  X i , X Ui ].
    Substituting equation (3) into equation (2), we obtain:

                                         X i Θ + X Ui ΘU + Q i Θ Q )A
                               Ui (g) = (X                          Ag + εgi − Pg                                  (4)

As AM discuss, this formulation of utility allows for a fairly general pattern of relationships between
different student characteristics (observable or unobservable) and tastes for different school/neighborhood
amenities, subject to the additive separability assumed in (2).
    Expected utility is taken with respect to the information available when n and s are chosen.
The information set includes the price and the amenity vector in each school and neighborhood as
                                        X i , X Ui , Q i ] and the values of εgi in each school and neighbor-
well as student/parent characteristics [X
hood. The information set excludes any local shocks that are determined after the start of secondary
school. It also excludes components of neighborhood, school quality and commuting zone quality
that are not observable to families when a location is chosen. Some elements of A g may depend
on neighborhood and school characteristics that influence educational attainment and labor mar-
ket outcomes (denoted X ∗g or Z ∗2g in the production function introduced later). The amenities may
also include or depend on aspects of the demographic composition of the neighborhood and school.
Thus, some of the amenities are influenced by the sorting equilibrium.
   The parents of i choose g(i) = g if net utility Ui (g) is the highest among the options. Parents
behave competitively in the sense that prices Pg and amenities A g are taken as given, and choice is
unrestricted. In equilibrium the values of some elements of A g may in fact depend on the averages
of X i and X Ui for the parents who choose g. Parents ignore the externalities they are imposing on
others.
   Proposition 1 of AM establishes that the expectation X Ug ≡ E [XX Ui |g(i) = g] is linearly dependent
on the expectation X g ≡ E [XX i |g(i) = g] if five assumptions hold. Decompose X Ui into its linear
                                                            U
                                                          Xi :
prediction given X i and an uncorrelated residual vector X̃

                                                                     U
                                              X Ui = X i Π X U X + X̃
                                                                   Xi .                                            (5)

                                               U
Use (5) to rewrite (3) as W i = X i Θ̃  X i ΘU + Q i Θ Q , where Θ̃
                                    Θ + X̃                            Θ + Π X U X ΘU ].8 In the rewritten
                                                                 Θ = [Θ
form, the three components of W i are mutually orthogonal.
    Proposition 1: (AM) Assume the following assumptions hold:

    A1: Preferences are given by (4).
    A2: Parents take Pg and A g as given when choosing location, and face a common choice set.
    A3: The idiosyncratic preference components εgi have a mean of 0 and are independent of X i ,

    8 Throughout    the paper we use the symbol Π H V to denote the vector or matrix of partial regression coefficients
relating the scalar or vector H to the explanatory variables V . In the case of ΠX U X , H = X U
                                                                                               i and V = X i .


                                                          8
X Ui , Q i , and A g for all g.
           X i |W
    A4: E (X                 X Ui |W
                W i ) and E (X     W i ) are linear in W i .
    A5: (Spanning Assumption) The row space of the WTP coefficient matrix Θ̃
                                                                          Θ spans the row space
                               U                           U
of the WTP coefficient matrix Θ relating tastes for A to X i . That is,

                                                        ΘU = R Θ̃
                                                               Θ                                                         (6)

for some LU × L matrix R .
    Then the expectation X Ug is linearly dependent on the expectation X g . Specifically,

                                                                                     U
                                   X Ug = X g [Π       V a r ( X i ) −1 R 0V a r ( X̃
                                               ΠX U X +V                           X i )]                                (7)

    The proof is in AM. Proposition 1 states that the sorting model introduced in this section implies
that the vector X g can serve as a set of controls for X Ug . This is key to distinguishing the causal
effects of school and location on outcomes from sorting on unobservable student characteristics that
affect these outcomes. The intuition behind the proposition is that X Ug and X g are related across g
because both X i and X Ui influence tastes for A g . As a result the means X Ug and X g are both functions
of A g , and under A1-A5, the maps from A g to X g and from A g to X Ug determines a map from X g to
X Ug that takes form (7).9
    AM provide a detailed discussion of the assumptions. We will not repeat that discussion here, but
a few words about A4 and A5 are in order. A sufficient condition for A4 is that the joint distribution
    X i , X Ui , Q i ] is a member of the continuous elliptical class. This class includes the normal, the
of [X
Laplace, and the multivariate exponential power family. In our application X i includes several
discrete variables, so the sufficient condition will not be satisfied. AM show that if the assumption
fails, an approximation error will appear in (7) that is likely to contribute to the error component vg
of (1) and lead to some upward bias in our estimator of the importance of school/location effects.
But AM also provide reasons to believe the approximation error will be small.
    We consider the spanning condition A5 to be the key assumption for Proposition 1; it ensures
that X g fully determines X Ug . Roughly speaking, two conditions must hold for X Ug to be a function
of X g . The first is that the number of elements of X i must be greater than or equal to the number of
amenities that X i and/or X Ui affect tastes for. Otherwise, A g and thus X Ug will vary conditional on
X g .10
    The second condition is that there cannot exist any elements of X Ui that are both uncorrelated

    9 Note that the proposition characterizes the relationship between expected values of observable and unobservable
student characteristics conditional on choice of school and neighborhood; the exact linear dependence need not hold
when samples of students are taken at each school. However, AM provide a monte carlo analysis suggesting that (7) is
a good approximation even with samples of 20 students at each school (around the number observed per school used to
construct X s in the samples we employ below).
   10 The plausibility of the first condition depends on the number and breadth of coverage of the variables in X . The
                                                                                                                      i
condition implies that the number of factors that determine X g is less than or equal to L. AM formally test this restriction
and find that the number of factors is considerably less then L.


                                                             9
with X i and that shift preferences for amenity factors that neither X i nor those elements of X Ui
that are correlated with X i shift preferences for. Otherwise such amenity factors will shift the
distribution of these remaining X Ui elements across schools in a way that X g cannot predict. While
this condition is untestable without further structure, we have struggled to find an example of an
unobserved variable that would cause its violation given the rich set of X i variables that we have.11


3     The Production Function for Education and Wages
     In this section we present the model of outcomes. This is the “production function”, as dis-
tinct from the MME estimating equation presented in the introduction. The model is similar to its
counterpart from AM but 1) introduces potential interactions or complementarities between indi-
vidual inputs and each category of group-level inputs, and 2) allows for separate roles played by
neighborhood, school, and local area inputs.
     Our outcomes are high school graduation, attendance at a four-year college, graduation from
a four-year college, and log wages. The outcome Yi of student i whose family has chosen the
neighborhood/school/commuting zone combination g(i) is determined according to

                                   Yi = X ∗i β ∗ + Z ∗g Γ ∗ + Mi Z ∗g ρ ∗ + ηgi + ξgi                               (8)

where we have dropped the dependence of the neighborhood, school, and commuting zone subscript
on the student subscript i to simplify the notation. The parameters of equation (8) also implicitly
depend on the outcome. For the education outcomes, Yi is the latent variable that determines the
binary outcome.
                            X i , X Ui ] denotes the exhaustive set of child and family characteristics. As
     The row vector X ∗i ≡ [X
a reminder, the superscript U denotes “unobserved” throughout the paper. It indicates variables
that are unobserved to the econometrician and their associated parameters. The row vector Z ∗g ≡
 X g , X Ug , Z 2g , Z U2g ] contains four components. The vectors X g and X Ug consist of neighborhood,
[X
school, and commuting zone averages of [X          X i , X Ui ] that capture peer influences. The vectors Z 2g
and Z U2g consist of the set of other observed and unobserved location and school characteristics
that affect outcomes and are not mechanically related to peer characteristics. All are normalized
to have a population mean of 0. To simplify the derivation and presentation of our identification
results relating to interactions between individual-level and group-level inputs, we delay explicitly
distinguishing between the components of Z ∗g that represent neighborhood, school and commuting
zone inputs, respectively, until Section 4.5.
   The parameter vectors β ∗ = [β β 0 , β U0 ]0 and Γ ∗ ≡ (Γ
                                                           Γ01g , ΓU0     0     U0 0
                                                                   1g , Γ 2g , Γ 2g ) are the corresponding slope
coefficients or input productivities, some of which may be zero. By virtue of our normalization Γ ∗
captures the effects of school and location variables at the mean of Mi .
    11 SeeAM for a more complete discussion, including a Monte Carlo analysis suggesting that (7) is quite robust to
violations of the spanning condition in which just a few outcome-relevant unobservables in X U
                                                                                             i affect WTP for just a few
additional amenities that are not weighted by any elements of X i .


                                                          10
    Mi is a scalar-valued linear function of X i . We focus on the scalar case to simplify the pre-
sentation and the proofs of identification results in Propositions 2 and 3 below. In the empirical
specification, Mi is replaced with a vector.
    The parameter ρ ∗ captures the extent to which students with different Mi values respond dif-
ferently to the same school and location inputs or policies. But it also captures how students with
different Mi values tend to receive different inputs within a school/location. For example, one might
expect a school variable such as tracking to influence the relationship between X i and the quality
of the teachers a student receives at the school. Thus, the relevant elements of ρ ∗ are defined to
also capture the degree to which school and location variables affect which group g resources get to
allocated to students with higher Mi values relative to their group g peers.
                      ρ 01 , ρ U0
    The vector ρ ∗ = [ρ              0     U0 0                                           U
                               1 , ρ 2 , ρ 2 ] has four components. The vectors ρ 1 and ρ 1 capture the
strength of interactions or complementarities between student characteristics and observed and un-
observed peer characteristics such as average family income. The vectors ρ 2 and ρ U2 capture inter-
actions between student characteristics and observed and unobserved nonpeer school and location
characteristics, such the quality of law enforcement, average class size, and availability of a nearby
four-year college.12 Our current identification results and empirical analysis exclude interaction
variables that are functions of the unobservables X Ui . We leave the task of relaxing this restriction
to future work.
    The unobserved scalar index ηgi captures the remaining random variation among students within
a neighborhood/school combination in the neighborhood and school inputs they experience, such
as the characteristics of immediate neighbors and characteristics of nearby children, and the luck of
the draw in teacher quality at the school. ηgi is defined to have a mean of zero within each g, and
given the definition of ρ ∗ , it is uncorrelated with the interaction terms in the production function.
    The component ξgi is the sum of influences at the n, s, and c level that are determined after
secondary school and are unrelated to the other variables in the model, both within and across
groups. We use the g subscript to allow for shocks at all three levels, but we primarily have in mind
shocks at the commuting zone level. These might include the opening of a local college or local
labor demand shocks that occur after high school is completed. It will prove useful to write ξgi as
ξg +ξi , where ξg is common to all students in g and ξi is idiosyncratic. ξg is taken to be 0 for the high
school graduation outcome. Akin to ηgi , any systematic relationships between conditions after high
school and observed and unobserved student, location and school characteristics are not deemed
shocks and thus are properly reflected in the production function parameters, so that the “shock”
component ξgi should only contain an unpredictable residual uncorrelated with other inputs.
    Note that the characteristics/inputs at each level of observation can represent non-linear func-
tions of other inputs from that level. For example, an element of X ∗i can represent the square of
another element of X ∗i or the product of two elements. Thus, the linear-in-parameters specification
for Yi is more general than it first appears.
   12 In the empirical work, we will place restrictions on the ρ 1 and ρ 2 vectors and will often use estimated parameter
vectors to construct the Mi values from X i .


                                                          11
     This production function yields a clear definition of the causal effect associated with group mem-
bership for a particular student type (indexed by Mi ). Compared to a group featuring population-
                                                  Z ∗g = 0), a randomly selected student with a partic-
average values of all school and location inputs (Z
                     a
ular value Mi = Mi who grows up in group g1 featuring external inputs Z ∗g1 can expect an increase
                                Z ∗g1 Γ ∗ + Mia Z ∗g1 ρ ∗ ]. A student with the population mean value
(or decrease) in outcome Yi of [Z
Mi = 0 can expect an increase of Z ∗g1 Γ ∗ . In the case of college attendance, college graduation, and
wage rates, the expected outcome from growing up in a particular school/location combination g1
will also reflect ξg1 , which is common to all individuals in group g but is determined after high
school.13 Expressions for school effects, commuting zone effects, and a particular neighborhood-
school-commuting zone combination are similar, and will be introduced later.
   The productivity coefficients β ∗ do not have a straightforward causal interpretation. Some com-
ponents of X ∗i associated with student inputs (for example, student aptitude) are determined by past
parental inputs such as family income (Todd and Wolpin 2003; Cunha et al. 2006). Consequently,
we do not attempt to tease apart the distinct influences of child characteristics, family characteris-
tics, and early childhood schooling and location inputs, respectively. We do not attempt to estimate
β.
   Nor do we attempt to estimate the causal effects of particular neighborhood, school, or com-
muting zone inputs (and so we will not aim to separately identify particular elements of Γ2 and
ρ 2 ). This is because the control function variables only address sorting bias. They do not eliminate
omitted variable bias that arises because observed neighborhood, school, or region inputs may be
correlated with unobserved inputs. Instead, we aim to distinguish the combined outcome effects
of neighborhood factors, of school factors, and of commuting zone factors, respectively, from the
effects of student, family, and prior school and location factors.


4     Identification Results for the MME Model
     We now return to the MME model (1) for the outcome Yi that we started with in the introduction,
versions of which serve as our estimating equation. We discuss the relationship between the slope
parameters and error components recovered from estimation and the parameters of the outcome pro-
duction function (8) presented in Section 3. In particular, we show that the regression coefficients
and error components estimated via a random effects procedure allow us to divide the contribu-
tion of student inputs and school/location inputs to Yi into four components. The first component
consists of the main effect of student inputs on the outcome. Its effect is common across groups
(school/location combinations). The second component consists of the main effect of group-level
inputs. These effects are common to all students. The third consists of interactions between stu-
dent inputs and group inputs. The fourth component is associated with the control function X g . It
captures a combination of group inputs (mostly peer influences) and group averages of student in-

    13 Theoutcomes of a specific student i will also differ across neighborhoods, schools and commuting zones because
the values of the idiosyncratic terms ηgi differ.


                                                         12
puts that affect outcomes regardless of the school and location (reflecting sorting). In Section 8 we
show how to use the identification results to provide conservative estimates of the average impact
associated with “treatments” where group-level inputs are shifted. We also show how to estimate
the impact of group treatments on particular student types (allowing a characterization of the de-
gree of treatment effect heterogeneity). As we explain below, we are not able to fully distinguish
among the roles of unobserved neighborhood characteristics, unobserved school characteristics, and
unobserved commuting zone characteristics.


4.1     Distinguishing Observables and Unobservables
      We start by rewriting the production function (8) to distinguish between observables and unob-
servables. This facilitates the analysis in subsections 4.2 and 4.3 of what estimation of the MME
model identifies. Let xUi ≡ X Ui β U denote the scalar index of unobserved student characteristics and
let zU2g ≡ Z U2g ΓU2 denote the scalar index of the unobserved location and school inputs. Using these
definitions and the subcomponents of the coefficient vectors β ∗ , Γ∗ , and ρ ∗ and the variables X ∗g
and Z ∗g , one may rewrite (8) as

                         Yi = X i β + X g Γ 1 + Z 2g Γ 2 + Mi X g ρ 1 + Mi Z 2g ρ 2
                                    +Mi X Ug ρ U1 + Mi Z U2g ρ U2 + xUi + zUg + ηgi + ξgi .                  (9)

Recall that the superscript “U” denotes “unobserved” variables and parameters associated with
them.
      Using the same notation, our estimating equation takes the form

  Ygi = X i B + X g G 1 + Z 2g G 2 + Mi X g r 1 + Mi Z 2g r 2 + Mg X g G 3 + Mg Z 2g G 4 + vg + (vgi − vg ). (10)

      The parameters refer to the coefficient vectors from the linear least-squares projection of Ygi on
the right hand side variables.
   Including Mg X g and Mg Z 2g ensures that identification of r 1 and r 2 is obtained exclusively from
within-group variation in Mi X g and Mi Z 2g . We show below that Assumptions A1-A5 of the sorting
model plus assumptions A6 and A7 below imply that G 3 and G 4 are 0. So in the end we exclude
Mg X g and Mg Z 2g from the models we estimate.
   We now consider how the parameters of the estimating equation (10) relate to the production
function parameters in (9). We first consider the individual-level coefficients B and the interaction
coefficients r 1 and r 2 . Next we turn to the group-level coefficients G 1 , G 2 , G 3 , and G 4 and then to
the error components vg + (vgi − vg ).




                                                         13
4.2       Interpretation of Student-Level Coefficients and Interaction Coefficients
      First we consider B , r 1 , and r 2 , which are identified from variation within g. Let D represent an
operator that subtracts group means, so that DYgi ≡ Ygi −E[Ygi |g(i) = g] ≡ Ygi −Yg . The within-group
counterpart of our estimating equation (10) can be written as:

                                                   X g ]rr 1 + [(DMi )Z
                           DYgi = D X i B + [(DMi )X                  Z 2g ]rr 2 + Dvgi .              (11)

Given the presence in (10) of the group means X g , Mg X g and Mg Z 2g , OLS estimation of B , r 1 , and
r 2 using (10) is equivalent to OLS estimation using the within-group equation (11). Thus, we can
restrict attention to (11).
      The statement of Proposition 2 below refers to the coefficients from the following projection
equations:

                                    D X Ui = D X i Π D X Ui D X i + D
                                                                    ] X Ui                             (12)
                                    Dηgi = D X i Π Dηgi D X i + Dη̃gi .                                (13)
                                    X Ug = X g Π X Ug X g                                              (14)

                                    Z U2g = X g Π Z U X g + Z 2g Π Z U Z 2g + Zf
                                                                               U
                                                                               2g .                    (15)
                                                    2g               2g



Note that X Ug is perfectly predicted by X g under the assumptions A1-A5, with Π X Ug X g ≡ [Π
                                                                                             ΠX U X +
                            U
V a r ( X i )−1 R0V a r (X̃
                         X i )]. This is why (14) does not have an error term. Let Dx̃Ui ≡ D
                                                                                           ] X Ui β where
D
] X U is defined in (12).
      i

      Two additional assumptions are needed when the interaction terms are present.


      Assumption A6: Cov(Dx̃Ui DMi , X g ) = 0 and Cov(Dx̃Ui DMi , Z 2g ) = 0
                          U
                     Z 2g ⊥ (X
      Assumption A7: Z̃      X g , Z 2g , D X i )

      Assumption A6 says that Dx̃Ui DMi is uncorrelated with [X
                                                              X g , Z 2g ]. It addresses a potentially
important identification problem. The variation that identifies interaction effects in our estimating
equation consists of differences in the strength of the relationship between individual characteris-
tics and outcomes across groups with different values of group characteristics (e.g. student-teacher
ratio). Suppose that the covariance between parental income (observed) and parental motivation
(unobserved) is larger in schools with smaller student-teacher ratios. In this case, parental income
may predict greater increases in outcomes at schools with smaller student-teacher ratios because
parental income better predicts parental motivation at such schools, even if students of richer par-
ents are not differentially sensitive to low student-teacher ratios. If one added the interaction term
Dincomei ∗ (students/teachersg ) to (11), it would enter with a negative coefficient. One can see that
if Mi was parental income, and student-teacher ratio was part of Z 2g , then the interaction coefficient
r 2 would be affected. Such a mechanism would yield spurious “interaction” effects.


                                                            14
   Assumption A6 rules out this possibility. As a result, any differential impact of Mi across groups
with different values of X g or Z 2g can be interpreted as evidence of true student-group interactions
                                                                             D X i , D X Ui ] across groups.
rather than evidence of differential sorting-induced joint distributions of [D
    A6 is a statement about the residual component Dx̃Ui of the unobservable DxUi , and so is not
directly testable. How plausible is it? Note first that since (12) is a projection equation, Dx̃Ui is
orthogonal to D X i . Thus the population mean of Dx̃Ui DMi is 0 because DMi is a linear function of
D X i . It is possible, however that the relationship between D X Ui and D X i and thus DMi varies across
g. If in addition, E(Dx̃Ui DMi |g) varies systematically with X g or Z 2g , A6 will fail.
   The model of school/location choice implies that the distribution of X Ui and X i varies with the
amenities, which may be related to Z 2g . While Proposition 1 directly implies that the mean X Ug
varies linearly with X g , this need not imply a violation of A6, since A6 fully allows the means
of Mi , X i and X Ui to vary across g and even systematically with Z 2g . A6 can also accommodate
variation in the within-group variances of Mi and XiU across groups, as long as DMi and D X Ui move
together in the same way in each group. Then any differential covariance between DMi and D X Ui
across groups is stripped out by D X i Π D X U D X , leaving no correlation between DMi and the residual
                                             i
index Dx̃Ui .
                                                                                   X i , X Ui , Q i ] such
    We have not found sufficient conditions concerning the distribution of Ag and [X
that A6 is exactly satisfied. In Online Appendix B4 we describe and present results from monte
carlo simulations of the sorting equilibrium for a case in which [X X i , X Ui , Q i ] is jointly normally
distributed and A g is also jointly normally distributed. People choose from 100 groups, with 250
individuals per group. We show that departures from A6 are truly negligible in this example: the
                                 U
                              X i and any element of X g is only .008.
mean correlation between DMi DX̃
    A7 strengthens a zero correlation property to statistical independence. To see this, note that the
                  U
error component Zf 2g in the projection equation (15) is uncorrelated with X g and Z 2g by definition
                                 U
and D X is uncorrelated with Zf
         i                         by construction. Strengthening zero correlation to independence
                                  2g
rules out the possibility that X g or Z 2g might be predictive of the value of the average interaction
Mg Z U2g , even conditional on Mg X g and Mg Z 2g . It also rules out the possibility that higher moments
                                                                                              U
of the distribution of D X for a given g predict the mean of the residual component Zf
                           i                                                                 2g . Consider
the race indicator variable BLACKi and the group mean BLACKg . These variables are included in
                                              U
X i and X g , respectively. A7 would fail if Zf
                                              2g is not independent of BLACKg and/or DBLACKi even
though it is uncorrelated with both. A7 seems likely to be a reasonable approximation in most
contexts. Furthermore, we show in Online Appendix B4 that A7 nearly holds in the sorting process
used in our monte carlo simulations, and the minor violations produce no discernable bias in the
estimates of the key coefficients.
    We are now ready to present the relationship between B, r 1 , and r 2 in the estimating equation
(11) (or equivalently (10)) and the production function parameters in (9).


    Proposition 2:


                                                    15
      Suppose assumptions A1-A7 hold. Then:



                                  B = β + ΠD X U D X i β U + ΠD η gi D X i                                (16)
                                               i

                                  r1 =      ρ 1 + Π X Ug X g ρ U1   + Π Z U X g ρ U2                      (17)
                                                                          2g

                                  r 2 = ρ 2 + Π Z U Z 2g ρ U2 .                                           (18)
                                                       2g



      The proof is in Online Appendix B1. Note that the coefficient vector B on X i is the same as
the coefficient vector in the model without interactions considered by AM. It captures a blend of
effects of observable and unobservable student characteristics that are common across groups as
well as differential treatments received by students that can be predicted based on X i . It does not
capture any true interaction effects nor any effects of group characteristics that are common to all
members. The coefficient r 1 consists of the true coefficients ρ 1 on the interaction between Mi and
the group averages of the observable student characteristics X g , plus two other terms. The second
term Π X U X g ρ U1 captures interactions between Mi and the group average of the unobservables X Ug .
           g
(Recall that under Proposition 1, X Ug = X g Π X Ug X g ). Thus, the first two terms of r 1 capture the fact
that the effect of X i on Yi depends upon the characteristics of the population in g. The third term
Π Z U X g ρ U2 is present because the unobserved school and area characteristics Z U2g that interact with
   2g
Mi may vary with X g conditional on Z 2g . The coefficient vector r 2 is the sum of ρ 2 , the effects of
the interactions between Mi and Z 2g , along with the effects of the interactions between Mi and the
portion of Z U2g that is predictable by Z 2g holding X g constant. Importantly, both r 1 and r 2 exclusively
reflect interactions between X i and group-level characteristics, rather than individual contributions
that are common across groups or group-level contributions that are common across individuals.
We have assumed away interactions between components of X Ui and Z 2g and Z 2g . We speculate
that such interactions will be partially picked up by r 2 to the extent that Mi predicts X Ui .


4.3      Interpretation of Group-Level Coefficients
    This subsection presents Proposition 3, which establishes the relationship between the produc-
tion parameters in (9) and the group-level coefficients G1 , G2 , G3 , and G4 identified by OLS es-
timation of the MME model (10). Note that just as B , r 1 , and r 2 are identified exclusively from
within-group variation, G 1 , G 2 , G 3 , and G 4 are identified exclusively from between-group varia-
tion. This fact means that the OLS coefficients G 1 , G 2 , G 3 , and G 4 are numerically identical to the
                                                                           X g B + Mg X g r 1 + Mg Z 2g r 2 ] ,
coefficients of the projection of the adjusted group g mean of Ygi , Yg − [X
onto X g , Z 2g , Mg X g , and Mg Z 2g .
      First we need to define additional projection coefficients that appear in Proposition 3. Let the
projection of the unobserved production function index zU2g onto the space of group-level observables
 X g , Z 2g , Mg X g , Mg Z 2g ] be given by
[X




                                                        16
              zU2g = X g Π zU X g + Z 2g Π zU Z 2g + Mg X g Π zU ,Mg X g + Mg Z 2g Π zU ,Mg Z 2g + e
                                                                                                   zU2g
                            2g              2g                  2g                     2g


   Let xUg ≡ X Ug β U and note that the projection matrix Π xUg X g = Π X Ug X g β U .


   Proposition 3:


   Suppose assumptions A1-A7 hold. Then:

                       G 1 = [(β                        Γ1 + Π X U X g ΓU1 + Π zU X g ]
                               β − B ) + Π xUg X g ] + [Γ
                                                                 g                      2g

                       G 2 = Γ 2 + Π zU Z 2g
                                             2g

                       G3 = 0
                       G4 = 0



   The proof is in Online Appendix B2. Proposition 3 states that under A1-A7 the coefficients G 1
and G 2 on X g and Z 2g in the model with interactions are exactly the same as the corresponding
coefficients in the model without interactions considered by AM (See Proposition 2 in AM). G 1
consists of the causal peer effects of X g and X Ug plus the part of the effect of unobserved group inputs
Z U2g predicted by X g conditional on Z 2g . However, it also picks up the bias term (ββ −BB) and the term
Π xUg X g , which captures differences across school and location in xUg . Since these last two components
represent student contributions to Yi rather than group-level contributions, we exclude X g G 1 when
constructing lower bound estimates for school and location treatment effects. We are unable to
assign the variation in X g G 1 exclusively to groups or individuals because X g also serves as a control
function for X Ug . This is the price of preserving meaningful assignment of other components of
variance in the absence of random group assignment.
   G 2 captures the causal effects of the observed group-level inputs Z 2g along with the causal
effects of associated variation in unobserved group-level inputs zUg on the outcome of a student
at the population mean of M i . Thus, the index Z 2g G 2 only reflects the contributions of group-
level inputs whose impacts are common across all students. It does not include student inputs or
interactions between student- and group-level inputs. This result is key to our ability to characterize
both average treatment effects associated with shifts in neighborhood quality as well as the degree
of treatment effect heterogeneity across types of students.
   Finally, G 3 and G 4 are both zero. Consequently, we can drop both Mg X g and Mg Z 2g from the
estimating equation (10).




                                                         17
4.4     Interpretation of the Error Components
      The final proposition establishes the relationship between the individual-level and group-level
error components in (9) and (10).


      Proposition 4:


      Suppose assumptions A1-A7 hold. Then:

                                                                  U
                                                             Z 2g ρ U2 + ξg
                                             vg = z̃U2g + Mg Z̃                                                               (19)
                                                        gU + Dη + Dξ .
                                             vgi − vg = Dx                                                                    (20)
                                                           i   gi   gi


      We relegate the proof to a footnote.14 Equation (19) reveals that vg is the sum of group-level
effects that are common across students (z̃U2g and ξg ) and group-averages of interactions between
                                    eU2g ρ U ). In principle, one could estimate the distribution of
student inputs and group inputs (Mg Z      2
   eU2g ρ U by incorporating random neighborhood-, school-, and commuting zone-specific slopes
Mg Z       2
with respect to Mi into an MME procedure. This would complete the full separation of the contribu-
tions of interaction components from the common impacts of group-level inputs that we discuss in
the introduction. However, we have had trouble identifying such random slopes in our application.
      Finally, (20) shows that vgi −vg reflects only student level inputs and perhaps (via Dηgi ) differen-
tial treatments within groups (e.g. the sequence of assigned teachers), rather than interactions with
group-level inputs that would reflect heterogeneity in the impact of the same group-level treatments.


4.5     Explicitly Incorporating Multiple Group Levels
      To this point we have lumped neighborhood-level, school-level, and CZ-level variables together
to simplify the notation, but we wish to assess the relative importance of these different categories
of external inputs in the empirical work. Thus, we now break up X g , X Ug , Z 2g , Z U2g , the interaction
terms, and the associated parameters into their n level, s level, and c level subcomponents and rewrite
the production function and estimating equation in the expanded notation. Let X ∗g ≡ [ X ∗n , X ∗s , X ∗c ] ,
Z ∗g ≡ [ Z N∗    S∗ C∗                                                                         ∗     ∗
           n , Z s , Z c ] , with corresponding notation for the level-specific subvectors of Γ and ρ .
Then define the subcomponents of these level-specific subvectors analogously to those defined in
Section 3 (e.g. ρ N ≡ [ ρ N0    NU0   N0    NU0 0
                          1 , ρ 1 , ρ 2 , ρ 2 ] ). Also, replace the scalar Mi with the vector M i . Then




   14 Proposition 4 can be proved simply by (1) substituting into the estimating equation (10) the expressions from
Propositions 2 and 3 for B , r 1 , r 1 , G 1 , G 2 , G 3 , and G 4 , (2) subtracting off all the observed regression indices from
the production function for Yi given by (9), and (3) taking group means and within-group deviations of the production
function components that remain. To obtain z̃U                                                          U
                                                    2g in (19) we also use the fact that by definition zg , which appears in (9), is
              U                          U U
equal to X U       U           U
           g Γ1 + z2g , where z2g = Z 2g Γ2 .


                                                                18
the production function (9) becomes

Yi = X i β + X n Γ N1 + X s Γ S1 + X c ΓC1 + Z N2n Γ N2 + Z S2s Γ S2 + Z C2c ΓC2c
           M i ⊗ X n ρ N1 + M i ⊗ X s ρ S1 + M i ⊗ X c ρ C1 + M i ⊗ Z N2n ρ N2 + M i ⊗ Z S2s ρ S2 + M i ⊗ Z C2c ρ C2
          +M
           X Un Γ NU
          +X            U SU      U CU      NU NU      SU SU      CU CU
                  1 + X s Γ 1 + X c Γ 1 + Z 2N Γ 2 + Z 2s Γ 2 + Z 2c Γ 2

          M i ⊗ X Un ρ NU          U SU            U CU            CU NU            SU SU            CU CU
                       1 + M i ⊗ X s ρ 1 + M i ⊗ X c ρ 1 + M i ⊗ Z 2n ρ 2 + M i ⊗ Z 2s ρ 2 + M i ⊗ Z 2c ρ 2

          +xUi + ηnsci + ξnsci ,                                                                                                 (21)

where ⊗ is the Kronecker product. Note that by decomposing Z ∗g into distinct neighborhood, school,
and commuting zone subcomponents, we have implicitly assumed away cross-level interactions of
neighborhood, school and commuting zone characteristics, such as average teacher salary with the
availability of local four year colleges.15
    The corresponding MME model (10), becomes

                       Ygi = X i B + X n G N1 + X s G S1 + X c GC1 + Z N2n G N2 + Z S2s G S2 + Z C2c GC2
                          M i ⊗ X n ]rr N1 + [M
                       + [M                   M i ⊗ X s ]rr S1 + [M
                                                                  M i ⊗ X c ]rrC1
                          M i ⊗ Z N2n ]rr N2 + [M
                       + [M                     M i ⊗ Z S2s ]rr S2 + [M
                                                                      M i ⊗ Z C2c ]rrC2
                       + (vn − vs ) + (vs − vc ) + vc + (vi − vn ),                                                     (22)

    where we have imposed the fact that Proposition 3 implies that G 3 and G 4 are zero.

4.5.1    The Challenge of Separately Identifying Unobserved Neighborhood, School and Com-
         muting Zone Influences

    The expanded notation facilitates discussion of an important limitation on our ability to fully
identify the relative contributions of neighborhood, school, and commuting zone inputs. The prob-
lem stems from the unobservables Z U2g . While the school component Z S2s G S2 will not include any
peer effects or individual-level contributions, Proposition 3 implies that it may include unobserved
neighborhood inputs if they cluster at the school (but not CZ) level. To see this, note first that
                                                                     NU    SU SU     CU CU
G2 = Γ2 + ΠzU Z 2g from Proposition 3. Next, note that zU2g ≡ Z NU
                                                                2n Γ 2 + Z 2s Γ 2 + Z 2c Γ 2 , and
                  2g
                                                       NU
that Z S2s is the school subvector of Z 2g . If Z NU
                                                  2n Γ 2 is clustered at the school level and predictable
by Z S2s , this will be reflected in the columns of Π zU Z 2g corresponding to Z S2s . As a result, Proposition
                                                                 2g

3 says that the school component G S2 of G 2 will pick up part of Z NU   NU                  NU NU
                                                                    2N Γ 2 . Similarly, if Z 2n Γ 2 or
       SU                                                                                        C
Z SU
  2s Γ 2 is clustered at the commuting zone level, it may be reflected in the CZ component G 2 . For
example, if the commuting zones that feature many colleges have schools with better principals on
average, and this advantage is not predictable based on the observed school characteristics X s and

   15 One could define a school effect for a particular type of commuting zone,   or an effect of the marginal distribution of
commuting zone characteristics. We lack the statistical power to identify such effects, especially given the large number
of possibilities and the lack of guidance from prior literature, so we do not pursue this here.


                                                                19
Z S2s , then it will be reflected in GC2 if Z 2c includes a variable capturing the number of colleges in the
CZ.
                                                              NU
  Furthermore, vs − vc and vc will include the part of Z NU
                                                         2n Γ 2 that varies across schools or across
CZs (respectively) that is not predictable by X g and Z 2g . Analogous problems occur with unob-
served school inputs that cluster at the CZ level. For example, if the commuting zone containing
Boston has schools with better average principal quality than would be predicted by X g and Z 2g ,
then vc will be higher for the Boston CZ.
    Similar issues also affect interpretation of the interaction coefficients r S2 and r C2 . Proposition 3
states that r 2 = ρ 2 + ΠZ U Z 2g ρ U2 , where ΠZ U Z 2g is defined in (15). The CZ subvector rC2 of r 2 will
                              2g                     2g
capture not just interactions involving Z CU                                              NU       SU
                                           2c , but also part of interactions involving Z 2n and Z 2s to
the extent that Z 2c predicts Z NU       SU                        N          S
                                2n and Z 2s conditional on X g , Z 2n , and Z 2s .
                                                                   CU
   What about CZ-level unobservables represented by Z CU       2c Γ 2c ? If the full set of commuting zone
averages of Z N2n and Z S2s were included in Z C2c , then we could rule out the possibility that any unob-
served commuting zone inputs could project onto either Z S2n or Z S2s and be captured by G N2 or G S2 .
This is because neighborhoods and schools are nested within commuting zones. More generally,
with nested levels, one can prevent unobservable inputs from being captured by regressors (includ-
ing interactions) associated with lower levels of aggregation by including the appropriate higher
level averages of lower-level characteristics. Thus, with nested levels one could in principle place a
lower bound on the relative importance of inputs at the lowest level (neighborhoods in our empirical
work) and an upper bound on the relative importance of inputs at the highest level (CZs). We seek
to approximate this approach, though we cannot fully implement it due to concerns about overfitting
given limited numbers of units at each level.


5      Data, Variable Selection, and Specification of Interactions
5.1     Overview of Data Sources
      We use two panel data sets, the National Educational Longitudinal Survey of 1988 (NELS88)
and the Educational Longitudinal Survey of 2002 (ELS2002).16 These data sources possess a num-
ber of common properties that make them well-suited for our analysis. First, each samples an entire
cohort of American students. The cohorts are students who were 8th graders in 1988 for NELS88,
and 10th graders in 2002 for ELS2002. Second, each source provides a representative sample of
American 8th grades and high schools, respectively, and samples of students are selected within
each school. Public, private, and parochial schools are represented.17 Enough students are sam-
pled from each school to permit construction of estimates of the school means of a large set of
    16 The  section draws heavily on Section 5 of AM, with some material verbatim.
    17 We  include private schools because they are an important part of the education landscape. The model in Section 2
implies that we should include group averages for the neighborhood/school pairs to control for sorting on unobservables,
but that is not practical, because sample sizes are too small. We include X s for the school and census-based demographic
variables at the ZIP code or block group level, which we denote X n even though they include characteristics of residents
who are not students or parents.


                                                          20
student-specific variables and to provide sufficient within-school variation to support the variance
decomposition described below. Third, each survey administered questionnaires to school adminis-
trators in addition to sampling individuals at each school. This provides us with a rich set of both
individual-level and school-level variables to examine, allowing a meaningful decomposition of ob-
servable versus unobservable variation at both levels of observation. Fourth, each survey contains
information on the student’s location of residence. In the case of NELS, we observe the student’s
ZIP code in grade 8. In ELS, we observe the student’s census block and ZIP code of residence in
grade 10. Observing residential location is critical for characterizing the relative contributions of
neighborhood versus school inputs as well as the relative importance of neighborhood versus school
amenities in driving student sorting. Finally, each survey collects follow-up information from each
student past high school graduation, facilitating analysis of the impact of high school environment
on outcomes economists and policymakers particularly care about: educational attainment and wage
rates.
    While there is considerable overlap in the survey questionnaires associated with NELS88 and
ELS2002, we chose not to restrict attention to the set of variables that are available and measured
consistently across the two datasets. This is because the efficacy of the control function approach
depends on the richness and diversity of our student-level measures, and using the intersection of
the two datasets limits the diversity of student characteristics. In practice, the variables lists are
similar, as one can see in Appendix A1. Section 5.3 describes the process by which we chose
which variables to include in X i , X n , X s , X c , Z S2s , and Z C2c . Unfortunately, the panel surveys do
not contain neighborhood-level variables, though we do merge in Census-based and LODES-based
neighborhood-level demographic averages to bolster the control function.
    Coding of most of the variables is straightforward, but in some cases variables are the first
principal components constructed from the responses to batteries of questions about topics such as
the home environment, school policies for reducing dropout rates, and quality of school facilities,
among others.
    As AM discuss, a drawback of the surveys is that the number of students sampled per school is
only about 24 for NELS and 20 for ELS.18 Simulation results in AM indicate that samples of this
size may reduce to a small degree the ability of sample school averages of observable characteristics
to serve as an effective control function for variation in average unobservable student contributions
across schools. In Online Appendix B4 we present additional simulations featuring estimates of G 2
and r 2 from specifications in which X g is formed using only 10, 20, or 40 individuals per group. We
show that the estimates are close to the corresponding true values unless the correlation between the
amenity factors and the elements of Z 2g is quite high. In this case the use of small samples causes
slight underestimates of the magnitude of the interaction coefficients r 2 and overestimates of the
magnitude of the main effects G 2 .
    We restrict our samples to those individuals whose school administrator filled out a school sur-
   18 School  averages are computing using all students in the base year surveys of NELS and ELS, respectively, not just
those in the estimation samples.


                                                          21
vey, and who have non-missing information on the outcome variable and the following key charac-
teristics: race, gender, SES, test scores, region, and urban/rural status. We then impute values for
the other explanatory variables to preserve the sample size, since no other single variable is critical
to our analysis.19


5.2     Outcome Measures and Weighting
      HSGRAD is an indicator for whether a student has a high school diploma (not including a GED)
as of two years after the high school graduation year of his/her cohort. ENROLL is an indicator for
whether the student is enrolled in a four year college in October of the second year beyond the high
school graduation year of his/her cohort. COLLBA is an indicator for whether the student has a
four-year degree at around age 25. Log wages are hourly and in 2009 dollars. They are reported at
about age 25.
      Use of COLLBA and log wage results in a loss of sample, because it requires use of the NELS 4th
follow-up and the ELS 3rd follow-up. High school graduation rates and four year enrollment rates
in the previous follow-up surveys are somewhat higher among respondents who are also observed
in the final followups.20 Summary statistics for the outcome measures are in Table 1-1.
      We do not use panel weights because we experienced convergence problems when we attempted
to estimate the variance components of the mixed level models using weights. One might want to
use weights for three reasons. The first is to account for the stratified sampling regime used by the
sample designers. The second is differential attrition associated with the explanatory variables. The
third is because follow-up probabilities are based on outcomes. The slope parameter estimates are
not sensitive to weighting, but we do not know whether weighting would affect the estimates of the
error component variances.


5.3      Selection of X i , X n , X s , Z N      S          C
                                          2n , Z 2s , and Z 2c

      AM discuss the principles governing variable selection. X i should include variables that directly
affect the outcome and/or are correlated with unobserved student level characteristics that affect the
outcome. We focus attention on a “full” specification which includes in X i measures of student
behavior, parental expectations, and student academic ability (standardized test scores). Such mea-
sures may be influenced directly by school and location inputs, so including them could cause an
underestimate of the contribution of school and location inputs. As a result, our lower bound esti-
mates will be too conservative. On the other hand, excluding such measures could instead cause an
overestimate of the contribution of location- and school-level inputs if the more limited set of student
   19 We   include mother’s education combined with a missing indicator for mother’s education when performing impu-
tation, along with school averages of all the key characteristics above.
    20 This partly contributes to the higher mean of COLLBA than ENROLL in NELS: the mean of ENROLL among

sample members of the 3rd follow-up survey in NELS is 0.353 vs. 0.327 among those in the 2nd follow-up (when
the outcome is determined), suggesting some differential attribution is taking place. However, transfers from two-year
colleges and other delayed entrants to four year college could also account for a higher graduation than enrollment rate,
given the way these outcomes are defined.


                                                          22
observables no longer satisfies the spanning condition A5 stated in Proposition 1. In that case, there
would exist differences in average unobservable student contributions to outcomes across schools
that are not predicted by the vector of school averages of observable characteristics. We also discuss
results for a “basic” specification that only includes student-level characteristics that are unlikely to
be affected by the neighborhood and high school the child attends.
    For purposes of the control function, X g should contain aggregates of X i at the (n, s) school/neighborhood
level. In practice, due to sample size limitations we include X s as well as X n variables, but not av-
erages over (n, s) pairs. The X n variables are census-based measures of the demographic makeup
of the neighborhood.21
    Z N2n , Z S2s , and Z C2c should include observed neighborhood, school and commuting zone charac-
teristics that could plausibly influence the socioeconomic outcome of interest, including school and
location policies that may be partially affected by student composition. Z N2n and Z S2s should exclude
variables that are simple aggregates of parent/student traits that might also affect willingness to pay
for neighborhood characteristics and thus lead to sorting. These are X n or X s variables regardless
of whether the source is aggregates of the student micro data, Census data, or administrative data
from the schools. Unfortunately, we do not observe any neighborhood-level variables that are not
population aggregates, so we do not include any Z N2n variables in our empirical work. As a result,
below we primarily focus attention on the impact of shifts in school- and commuting zone-level
treatments. If the composition variables included in X n and X s are sufficiently rich to plausibly sat-
isfy the spanning assumption A5, then the coefficients on commuting-zone demographic averages
that would otherwise belong in X c should not capture any student sorting on unobservables under
the assumptions of the model. In this case such averages may be considered part of Z C2c , since they
are likely to only absorb the impacts of unobserved causal commuting zone characteristics.
    As AM discuss, group-level variables such as a school’s frequency of fights or average test
scores that capture earlier outcomes that were jointly produced by both individual- and group-level
variables fall in a grey area. We exclude such variables entirely from the baseline specification on
the grounds that they are determined by other observed and unobserved variables in the model. We
include them in the control function X g in the full specification. To the extent that school policy
and the skill of teachers and the administration have a large effect on fighting and/or test scores,
assigning these measures to the control function leads to conservative estimates of group effects.
    Appendix A1 lists the final choices of individual-level and school-level explanatory measures
used in each dataset.22 Online Appendix table B2 provides the mean, standard deviation, and percent

    21 As AM discuss, in principle the control function variables can be augmented with aggregates of outcome-irrelevant

characteristics Q i or even directly observed amenities in A g , since its purpose is to span the space of amenities that drive
sorting on X Ui .
    22 In preliminary work we experimented with a grouped backward stepwise regression procedure to pare down the

variable sets at each unit level. One could also consider other procedures, such as group lasso (Meier et al. 2008; Yuan
and Lin 2006). Ultimately, we chose not to use these procedures because of uncertainty about how to do statistical
inference, about the computational feasibility, about statistical properties of a bootstrap procedure that accounts for both
variable selection and sampling error given variable choice, and about how to correct for finite sample bias in the variance
estimates. The three step estimation method we use is computationally demanding.


                                                             23
of observations imputed for each individual-level and school-level characteristics for each of our
data sets.
      Table 1-2 provides the number of neighborhoods, schools, and commuting zones for each com-
bination of dataset and outcome. While the number of commuting zones and schools is substantial,
the demands of estimating our model are also substantial given the lack of prior information about
which school and commuting zone variable are likely to have large effects. The precision of our
estimates is reduced by the need to work with a fairly large number of Z S2s and Z C2c variables, along
with large numbers of variables in the control functions X n and X s .


6      Estimation Methods
6.1     Restricting the Estimating Equation
      We estimate the following restricted version of the MME estimating equation (22):

             Ygi = X i B + X n G N1 + X s G S1 + Z S2s G S2 + Z C2c GC2
              + ( X i B ) ( X n G N1 ) r1N + ( X i B ) ( X s G S1 ) r1S + M i ⊗ ( Z S2s G S2 ) r S2 + M i ⊗ ( Z C2c GC2 ) r C2
              + (vi − vn ) + (vn − vs ) + (vs − vc ) + vc ,                                                                      (23)

where Ygi is a latent index for the binary education outcomes. Several restrictions merit mention.
First, we have excluded Z N2n G N2 and (M
                                        M i ⊗ Z N2n )rr N2 because our only neighborhood-level variables
are demographic means that belong in X n . Second, we have also excluded X c GC1 because average
student characteristics at the neighborhood and school levels should fully control for sorting bias.
This is because CZ is implicitly a part of the choice of n and s. Thus, to prevent overly conserva-
tive treatment effect estimates, CZ composition variables are placed in Z C2c . We also exclude the
                  M i ⊗ X c )rrC1 .
interaction term (M
      Third, to retain sufficient precision, we have to reduce the dimensionality of the interactions
between student characteristics and peer characteristics as well as between student characteristics
and neighborhood, school, and commuting zone characteristics. We set M i to consist of the index
X i B and indicators for whether the student is female, a member of an underrepresented minority
group (denoted 1(URM) below and coded as Hispanic or non-Hispanic black), and whether the
student’s family is in the bottom quartile in our sample of the ratio of family income to average rent
in the commuting zone (1(LOWINC)). Thus, using the definition of the Kronecker product ⊗ ,

       M i ⊗ Z S2s G S2 = [(X      Z S2s G S2 , 1(Female)Z
                            X i B )Z                     Z S2s G S2 , 1(URM)Z
                                                                            Z S2s G S2 , 1(Low Income)Z
                                                                                                      Z S2s G S2 ],

           Z C2c GC2 ) has the same form. Including X i B in M i imposes the restriction that for white
and M i ⊗ (Z
males from high income families, the strength of interactions depends upon components of X i in
proportion to their direct effects on the outcome. Including the three additional indicator variables in
M i allows a somewhat more general pattern of interactions for particular subpopulations for whom


                                                                    24
differential interactions have often been posited in the literature.
    In addition, to keep the main specification parsimonious, we only allow student characteristics to
interact with the indices X n G N1 , X s G Ss , Z S2s G S2 , and Z C2c GC2 . 1(Female), 1(URM), and 1(LOWINC)
are further restricted to interact only with Z S2s G S2 and Z C2c GC2 and not with X n G N1 or X s G Ss . We
experimented with additional interactions, but did not find sufficiently compelling evidence for them
given the loss of precision they required.23
      Finally, as discussed in section 4.5.1, to improve the allocation of school-level factors to esti-
mates of the school treatment effects and the allocation of community-level factors to the estimates
                                                                                                N
of CZ-level effects, we also include school and commuting zone averages of the index X n Ĝ   G1 as
                                                                          S              S
                                                       G1 and Z S2s Ĝ
well as the commuting zone averages of the indices X s Ĝ           G2 with separate coefficients.
                                                 N                                           S
                                              G1 and the commuting zone average of X s Ĝ
The school and commuting zone averages of X n Ĝ                                           G1 are
treated as control function variables and are excluded from the estimates of school and commuting
                                                                                         S
zone treatment effects described below. The commuting zone average of the index Z S2s Ĝ
                                                                                       G2 is treated
as a commuting zone characteristic that is contained in Z C2c in (23). It contributes to our estimates
of the variance in commuting zone treatment effects described below. Since its coefficient should
not be affected by sorting bias under assumptions A1-A7, and is identified purely from between-
commuting zone variation, it is likely to capture unobserved commuting zone inputs.


6.2     Estimating the Model Parameters
      For estimation of (23), we assume that the random effects are all normally distributed. Our anal-
ysis of the importance of neighborhood, school and commuting zone depends heavily on estimating
the student-weighted standard deviations and covariances of the indices X n G N1 , X s G S2 , Z S2s G S2 , and
Z C2c GC2 as well as the standard deviations of vc , vs − vc , vn − vs , and vi − vn . In principle, one could
estimate (23) in one step by maximum likelihood with index restrictions imposed. Due to the com-
putational burden, we estimate the slope parameters B , G N1 , G S1 , G S2 , GC2 , r1N , r1S , r S2 , and r C2 and obtain
                                     X n G N1 ) , sd(X
                        X i B ) , sd(X
initial estimates of sd(X                            X s G Ss ) , sd(Z
                                                                     Z S2s G S2 ) , sd(Z
                                                                                       Z C2c GC2 ) and sd(vc ), sd(vs − vc ),
sd(vn − vs ), and sd(vi − vn ) in two steps. First, we estimate the slope parameters with nonlinear
restrictions imposed, but treat the error term as a composite. We use nonlinear least squares for log
wages and MLE probit (given the normality assumption) for the binary education outcomes. In both
cases we ignore the error correlation structure. In the second step we estimate sd(vc ), sd(vs − vc ),
sd(vn − vs ), and sd(vi − vn ) and update r1N , r1S , r S2 , and r C2 . We also implicitly allow the elements of
                                                                                                     N     S     S    C
B to update by a common factor of proportionately, and we do the same for Ĝ
B̂                                                                        G1 , Ĝ
                                                                               G1 , Ĝ
                                                                                    G2 , Ĝ
                                                                                         G2 (in
practice, this made little difference). We experienced computational difficulties when using max-
imum likelihood in the second step. Instead, we adopt a Bayesian approach, which we treat as a



   23 We  considered specifications in which 1) all of the variables in Mi interact with X n G N           S
                                                                                               1 and X s G s , 2) 1(Hispanic)
and 1(Non − Hispanic Black) entered with separate interactions with the indices of external inputs, and 3) interactions
between 1(Female) ∗ 1(Black) and Z S2s G S2 and Z C2c GC2 were introduced to allow race-by-gender specific sensitivity to
external inputs. Unfortunately, such interactions were so noisy that even large effects were statistically insignificant.


                                                            25
computational device that we use to compute MLE estimates.24 Appendix B3.1 provides a more
detailed description of the two-step procedure.
   The third step of the estimation procedure is to adjust the updated estimates of sd(X                        X n G N1 ),
                                                                                                    X i B ), sd(X
sd(X                               Z C2c GC2 ) and the estimates of sd(vc ), sd(vs − vc ), sd(vn − vs ), and sd(vi −
                  Z S2s G S2 ), sd(Z
   X s G Ss ), sd(Z
vn ) from step 2 for finite sample bias. This would be necessary even if we had estimated the model
                                                                                                  S
via MLE in one step. Consider sd(Z   Z S2s GS2 ). The initial estimate corresponds to sd(Z
                                                                                         Z S2s Ĝ
                                                                                               G2 ), the stan-
                                                                    S
dard deviation of the index based on the estimate ĜG2 . It will be biased upward by sampling error
      S                                      N             S                   C
   G2 . The same problem affects sd(X
in Ĝ                                     G1 ) , sd(X
                                      X n Ĝ                          Z C2c Ĝ
                                                        Gs ) , and sd(Z
                                                    X s Ĝ                  G2 ) . The bias arises for the
same reason R2 overstates the explanatory power of a linear regression in finite samples. Because
the hierarchical nature of the model and the control function strategy we adopt requires the use of
a large number of variables at four different levels, finite sample bias from sampling error is not
negligible given our sample sizes. Keeping in mind that all variables are mean zero, we separate the
                                                                    S
signal and noise subcomponents of the initial estimate sd(ZZ S2s Ĝ
                                                                 G2s ) using the equation

                       S         1                                  1                S           S
                    G2 )]2 =
               Z 2s Ĝ
           [sd(Z                   ∑  Z S2s(i) G S2 G S0
                                     (Z                   S0
                                                      2 Z 2s(i) ) +               G2 − G S2 ][Ĝ
                                                                        Z S2s(i) [Ĝ          G2 − G S2 ]0 Z S0
                                                                                                             2s(i) ,   (24)
                                 N i                                N∑i

where N is the sample size. The expectation of the second (sampling variance) term, conditional on
Z S2s(i) , is
                                    1                        S
                                       ∑  Z S2s(i) v a r (Ĝ
                                                          G2 ) Z S0
                                                                 2s(i)                        (25)
                                    N i

                                                 Z S2s G S2 ) is
    Using (25) the bias-adjusted estimator of sd(Z

                           b Z 2s G S ) = [sd(Z       S      1                    S
                           sd(Z     2              G2 ).5 − [ ∑ Z S2s(i)Vd
                                              Z 2s Ĝ                          G2 ) Z S0
                                                                         a r ( Ĝ
                                                                                             .5
                                                                                      2s(i) ] .
                                                             N i

However, we do not adjust the r coefficients on the interaction terms (where we conjecture that the
sampling error in the indices might bias estimates of interaction effects toward zero).25
   Since the sampling error in the regression indices reflects true contributions of the error compo-
                                                         N              S                S                    C
                                                  X n Ĝ
nents to Yi , the flip side of upward bias in Var(X   G1 ) , Var(X
                                                                 X s Ĝ         Z S2s Ĝ
                                                                     Gs ) , Var(Z                    Z C2c Ĝ
                                                                                      G2 ) , and Var(Z     G2 )
is downward bias in the estimates of Var(vc ), Var(vs − vc ), Var(vn − vs ), and Var(vi − vn ), which do
not account for degrees of freedom used in estimation.26 We discuss how we allocate the bias ad-

    24 Specifically, we assign prior distributions from which our slope parameters and random effect variances are drawn,

and use Markov-chain Monte Carlo methods to estimate the means of the posterior distributions governing these parame-
ters. We use these posterior means in place of the fixed parameters defined in (23) when reporting results and computing
estimates of the impact of alternative group-level treatments below. The estimates are not very sensitive to modest changes
in the priors for Var(vc ), Var(vs − vc ), Var(vn − vs ).
    25 We estimate V            S
                      d      G2 ) using the formula for the asymptotic variance of the Step 1 estimates. We account for
                       a r ( Ĝ
clustering at the commuting zone level but not for the use of imputed data. We perform similar adjustments to the Step 2
estimates of the other index standard deviations.
    26 The same issue arises in linear regression with one normally distributed error component. In this case, the MLE

estimator of the error variance is the sum of squared residuals divided by the sample size. The unbiased estimator adjusts
for degrees of freedom by dividing by the sample size minus 1 plus the number of regressors. This is a restricted maximum
likelihood estimator (REML). Unfortunately, the REML estimator does not exist for multilevel probit models. AM use


                                                              26
justments across these error components to remove this downward bias in Online Appendix B3.2.27
      In the case of the log wage outcome, vi contains the age 25 or 26 error component and thus
includes both permanent and transitory variation. We lack the wage panel data necessary to isolate
the permanent component. Consequently, we estimate the variance of the permanent component
of vi under the assumption that the transitory component of the wage makes up the same 52.3%
share of cross-sectional wage variance at age 25 in the ELS and NELS samples as it did for the high
school class of 1972 cohort (sampled in NLS72) examined in Altonji and Mansfield (2011).
    The standard errors in the paper are based on a bootstrap approach encompassing the entire
estimation procedure, including the construction of X s , imputation of missing data, and the bias
corrections to the standard deviations of the regression indices. In particular, they account for the
fact that the coefficients that define the index variables used in the second step are estimated.28
Across outcome variables, data sets, and specifications, we find that the means of the bootstrap
replications of sd(X          b X s G S ) , sd(Z
                b X n G N ) , sd(X                        b Z C GC ) are above the point estimates. Not
                                            b Z S G S ) , sd(Z
                             1              s          2s   2          2c   2
surprisingly, the disparity is even greater for the variance component estimates based on them, which
underlie the variance decompositions in Tables 2 and 3. The distribution of the bootstrap estimates
display a right skew as well as a mean shift. For this reason, we report 5th and 95th percentile values
of the bootstrap distribution of our estimated variance components. The distribution of the estimates
of the treatment effects of a 10th -90th percentile shift in school and/or commuting zone quality are
less sensitive to the issue. More work on the best way to implement bias corrections and perform
related statistical inference is needed.


6.3     Variance Decomposition Methodology
      Here we describe the simple variance decomposition procedure that we use to 1) provide an
initial, descriptive sense of the relative importance of inputs at each level (individual, neighborhood,
school, commuting zone) in determining the outcomes of interest, and 2) assess the degree to which
amenities at the neighborhood, school, and commuting zone level are driving student sorting.


the ML estimator for the two level random effects probit and then correct for bias based on the formulas relating the
unbiased estimators and the ML estimators in the case of a continuous outcome. We explored the possibility of extending
AM’s approach to the four level case, but were not able to find (or derive) the necessary formulas for four-level ML and
REML variance component estimators.
    27 If the bias-adjusted estimate of a variance is negative, we set it to 0. The bias-adjusted estimate of the covariance

between two terms is set to 0 if the estimate of the variance of one of the terms is 0. If the correlation between two terms
implied by bias-adjusted estimates exceeds 1 in absolute value, we adjust the covariance to make the correlation 1 in
absolute value.
    28 The standard error estimates are based on re-sampling commuting zones with replacement. To preserve the size

distribution of the samples of students from particular commuting zones, we divide the sample into ten CZ sample size
classes and resample CZs within class. For CZs in the largest size class, we break the CZs into two groups, each containing
half the schools. We sample these half CZs instead to prevent any one bootstrap cluster from accounting for too large a
share of the sample. Due to the considerable computational burden of the model estimation and the simulations relative
to the computer resources available for use with the restricted-use versions of ELS and NELS, we use 200 replications
to form the bootstrap estimates. Furthermore, we use fewer (8) MCMC chains of length 500 rather than the 30 chains
of length 1000 that we use to compute the point estimates after first verifying that estimates are not very sensitive to this
choice. This might lead to an overstatement of the standard errors.


                                                            27
      To simplify the empirical analysis we define neighborhoods to be nested within schools, which
are themselves nested within commuting zones.29 We use a version of our estimating equation with
interaction terms excluded.30

        Yi = X i B + X n G N1 + X s G S1 + Z S2s G S2 + Z C2c GC2 + (vi − vn ) + (vn − vs ) + (vs − vc ) + vc .   (26)

      One can then write the outcome as the sum of orthogonal components:

                                    Yi = (Yi −Yn ) + (Yn −Ys ) + (Ys −Yc ) +Yc .                                  (27)

      Because the components in (27) are mutually orthogonal, Var(Yi ) is:

                       Var(Yi ) = Var(Yi −Yn ) +Var(Yn −Ys ) +Var(Ys −Yc ) +Var(Yc )                              (28)

    We are not able to fully characterize sorting on both observed and unobserved student level char-
acteristics because group averages of X i absorb not only the unobserved group averages of X Ui but
also part of the group treatment effect. Instead, we use an analogous four-component decomposition
to analyze the structure of sorting on the index of observable characteristics X i B that best predicts
the outcome:

           X i B ) = Var(((X i − X n ) B ) +Var(((X n − X s ) B ) +Var(((X s − X c ) B ) +Var(X
       Var(X                                                                                  X cB)               (29)

To our knowledge, we are the first to perform such a decomposition based on commuting zone,
school and census block group combinations.


6.4     Measuring the Effect of Shifts in School and Commuting Zone Quality
      Decompositions of variance provide an overall sense of the relative importance of individ-
ual, neighborhood, school, and commuting zone inputs in determining later educational outcomes.
However, they do not permit one to easily gauge the impact that a substantial improvement in exter-
nal environment can have on a student’s expected educational attainment. Consequently, we extend
to models with student-specific slopes AM’s methodology for converting variance components into
expected impacts on outcomes of particular shifts in school and/or community input quality. Here
we describe the three distinct treatments we consider.
   29 Inthe empirical work our narrowest definition of neighborhood is the census block group. In a few cases, students
from the same block group choose different schools. We treat students from the same block group who attend different
schools as if they live in different block groups by using school-block group combinations as our definition of a neigh-
borhood. Nesting neighborhood within school is required by the routine we use to estimate the variances of the error
components. But it may diminish the precision of our estimates of neighborhood and school effects on outcomes. The
same issue arises when ZIP code is the neighborhood definition. Note that the choice model in Section 2 allows families
who live in a given neighborhood to choose different schools.
   30 When interactions are included in the model, the within-neighborhood variance will differ across neighborhoods

based on the degree to which students sensitive to environment are located in neighborhoods/schools offering more
supportive environments, preventing a simple decomposition.


                                                            28
6.4.1    The Combined School and Commuting Zone Treatment

    First, we evaluate the expected change in outcomes associated with moving a randomly cho-
sen student from a school/commuting zone combination at the 10th percentile of the combined
school/commuting zone quality distribution to the 90th percentile. From our production function (8),
the true distribution of combined school/commuting zone quality may be defined as the distribution
         S∗     C∗ C∗
of Z S∗
     s Γ + Z c Γ . We approximate this combined school/commuting zone quality distribution
using the distribution of T = Z S2s G S2 + Z C2c GC2 + (vs − vc ) + vc , where we use T to denote the particu-
lar “treatment” chosen. Because we exclude the control function X n G N1 + X s G S1 , which may capture
peer effects and other unobserved school and commuting zone inputs in addition to student sort-
ing, our estimated impacts of 10th -to-90th percentile shifts in school/commuting zone quality will
                                                                                          S∗  C∗ C∗
likely understate the impact of the corresponding 10th -to-90th percentile shifts in Z S∗
                                                                                       s Γ + Zc Γ .
On the other hand, as the discussion in subsection 4.5.1 made clear, to the extent that unobserved
neighborhood inputs are clustered in particular schools and commuting zones, such inputs could
contribute to GS2 , GC2 , vs − vc , and vc .31
    Building an estimator of the impact of these quantile shift “treatments” is complicated by the
interaction terms in (10). First, we assume that the treatment distribution T ≡ Z S2s G S2 + Z C2c GC2 +
(vs − vc ) + vc is normally distributed, so that the q-th treatment quantile (denoted T q ) is given by
        ˆ
T q = Var(T   ).5 Φ−1 (q) where Φ−1 (∗) is the inverse CDF of the standard normal distribution. Next,
note that the interaction terms M i ⊗ (Z    Z S2s G S2 )rr S2 and M i ⊗ (Z
                                                                         Z C2c GC2 )rrC2 depend separately on the sub-
components Z S2s G S2 and Z C2c GC2 of the full treatment T . We handle this by integrating over the
joint conditional distribution f (ZZ S2s G S2 , Z C2c GC2 |T = T q ). We do this by taking P draws of the vector
 Z S2s G S2 , Z C2c GC2 ] from the appropriate joint multivariate normal conditional distribution and averag-
[Z
ing our predicted outcomes over these P draws. The parameters of that distribution are based on the
estimates of the variances and covariances of the components of the vector. In our main results we
also integrate over the distribution of student and neighborhood inputs. We use the empirical joint
distribution of observed student and neighborhood inputs from our sample by averaging over the
                         N        S
observed [XX i B̂
               B, X n Ĝ
                      G1 , X s Ĝ
                               G1 ] vectors of all I students in the sample.
    Thus, our estimator of the expected outcome at a chosen quantile q of the “treatment effect”
distribution is:

                                     1   1                     N        S
                        E[Ŷ q ] =     ∑   ∑    X i B̂
                                             Φ([X   B + X n Ĝ       G1 + T q
                                                            G1 + X s Ĝ
                                     P p I i
                                           N                         S
                            X i B̂
                         + (X   B)(X   G1 )r̂1N + (X
                                   X n Ĝ          X i B̂
                                                       B)(X
                                                          X s Ĝ                Z S2s G S2 ) p r̂r S2
                                                              G1 )r̂1S + M i ⊗ (Z
                                  Z C2c GC2 ) p r̂rC2 )]/[1 +Var(vn − vs )])
                         + M i ⊗ (Z                                                                              (30)

where (Z Z S2s G S2 ) p and (Z
                             Z C2c GC2 ) p represent the p-th draws of these regression indices from the condi-
tional joint distribution f (Z     Z S2s G S2 , Z C2c GC2 |T = T q ). Note that Var(vi − vn ) has been normalized to 1

   31 Even if such clustering is significant, one could interpret our estimates instead as lower bound estimates of the
                                                                                             N∗ Z S∗ ΓS∗ Z C∗ ΓC∗
impact of a shift in the combined neighborhood/school/commuting zone quality index Z N∗  n Γ   + s      + c       .


                                                             29
in the denominator, because the scale of the latent index for binary outcomes is not identified.
    We then compute the difference E[Ŷ 90 ] − E[Ŷ 10 ] to estimate the change in expected outcome
(e.g. the increase in the probability of high school graduation) for a randomly chosen high school
student from a 10th -to-90th percentile shift in school/commuting zone quality. Alternatively, this
quantity can be thought of as the increase in the population average outcome if we placed every stu-
dent in a 10th percentile school/commuting zone, and then moved each of them to a 90th percentile
school/commuting zone, but held the distribution of peer effects fixed. We refer to this counterfac-
tual as the “School and CZ” counterfactual in our tables and discussion.

6.4.2    The School Treatment and the Commuting Zone Treatment

    The school counterfactual thought experiment or “treatment” consists of replacing each student’s
school inputs with those of the school at the 10th percentile versus 90th percentile of the school
quality distribution (defined by Z Ss Γ S∗ ), holding neighborhood and commuting zone inputs fixed.
We approximate the distribution of true school quality with the distribution of T ≡ Z S2s G S2 +(vs −vc ).
This variable excludes the peer effects components X s Γ S1 and X Us Γ SU                      SU SU
                                                                       1 and also part of Z 2s Γ 2s and
so is likely to understate school effects. But as we discussed in 4.5.1, it may capture unobserved
neighborhood inputs that are clustered in particular schools.
    The commuting zone counterfactual “treatment” replaces each student’s commuting zone inputs
with those of the commuting zone at the 10th percentile versus 90th percentile of the CZ qual-
ity distribution defined by Z Cc ΓC∗ , holding neighborhood and school inputs fixed. Importantly,
this treatment does not include the subcomponent of school inputs that varies across commuting
                                                    S∗
zones (given by the commuting zone average of Z S∗
                                                s Γ ). Thus, this counterfactual is designed to
gauge the importance of commuting zone-level inputs in their own right, rather than the impor-
tance of the choice of commuting zone in which to live (which combines commuting zone inputs
with differences in the distributions of neighborhood and school inputs across commuting zones).
We approximate the distribution of true commuting zone quality Z Cc ΓC∗ with the distribution of
T ≡ Z C2c GC2 + vc (and we do not include the between-CZ component of Z S2s G S2 , since G S2 is identified
using between-school/within-CZ variation and is designed to capture school effects).32 This is again
an approximation due to the possibility that Z C2c GC2 and vc could partly reflect unobserved school or
neighborhood inputs. We refer to this counterfactual as the “CZ only” counterfactual in our tables
and discussion.
    Computation of the school and CZ treatments are similar to the combined school and CZ treat-
ment. The formulas are in Online Appendix B3.3.




   32 Recall that the commuting zone average of Z S2s G S2 enters our estimating equation as a separate commuting zone
variable with its own coefficient. Because the coefficient on this index is identified purely from between-commuting zone
variation, we include this index as part of our commuting zone treatment.


                                                          30
6.4.3    Estimating Impacts of Shifts in School and Commuting Zone Quality for Particular
         Subpopulations

     In contrast to AM, the introduction of interaction terms in the estimated production function (10)
in this paper allows us to characterize the degree to which the outcomes of specific subpopulations
are particularly sensitive to the quality of external inputs at the neighborhood, school, or commuting
zone levels.33
     The most straightforward approach is simply to restrict the sample used for the counterfactual
treatments to members of a particular subpopulation. We report results for the following subpopu-
lations: Hispanic students, non-Hispanic black students, white students in a single-mother house-
hold where the mother has a high-school education or less, and white students in a two-parent-
college-educated household. We use the empirical distribution of individual and neighborhood in-
                    N        S
puts X i B̂               G1 , so restricting the sample naturally imposes the chosen sample’s joint
                 G1 + X s Ĝ
         B + X n Ĝ
distribution of observed individual and neighborhood inputs. All elements of M i take on the values
for i, so that the results for Hispanic students, for example, reflect not only the interaction terms
involving the minority (non-Hispanic black or Hispanic) indicator but also the subgroup-specific
distribution of the other elements of M i , such as low income status, weighted by the corresponding
elements of the interaction coefficients r̂r S2 and r̂rC2 .
     Our rich set of observed individual characteristics also allow us to investigate the degree to
which school and CZ treatment effects vary with the individual’s own contribution to the outcome,
as summarized by X i B . To do this, we fix X i B at each ventile dividing point [.05, . . . , .95] in its em-
pirical distribution in the sample, and compute the change in expected outcome for each of our three
counterfactual quality shifts (“School and CZ”, “School only”, and “CZ only”, described above) for
randomly chosen individuals at the chosen ventile of X i B . We do not hold fixed the kind of neigh-
borhood such students tend to experience, but are instead randomly assigning a neighborhood from
the full population distribution for both the low (T 10 ) and high (T 90 ) treatment values.
     See Online Appendix B3.3.2.
     As we discuss in detail in Section 8.1.1, part of the differential sensitivity for binary outcomes
arises from the nonlinearity of the probit function. Even if each of the interaction parameters
{r1N , r1S , r S2 , r C2 } were equal to zero, we should expect heterogeneity in outcome sensitivity. This
is because some subpopulations have more students near the decision margin (as evidenced by dif-
ferent mean outcome values).


7     Results
     We begin by presenting in Section 7.1 the decompositions of variance described in Section 6.3.
Section 7.2 then presents estimates of the interaction coefficients and the standard deviations of
the regression indices and random effects from the interactive specification (23). We focus on the

    33 The   only non-linearity in AM comes from the probit function for binary outcomes.


                                                            31
estimates for the “full” set of X i variables. Model estimates and variance decompositions for the
“basic” set are in the online appendix. As expected, they usually imply a more important role
for school and commuting zone factors in education and wages. We present the treatment effect
estimates based on them in Section 8.

7.1     Decompositions of Variance
7.1.1    The Extent of Neighborhood-, School-, and Commuting Zone-Level Clustering in Out-
         comes

      Table 2 decomposes the variance of log wages and the latent probit indices Yi that determine the
three education outcomes into components at the individual, neighborhood, school, and commuting
zone levels. These are based on results for the linear version of (26) in which the interaction param-
eters {r1N , r1S , r S2 , r C2 } have been restricted to zero. We report 5th and 95th quantile confidence interval
estimates in brackets in the text in a few instances. The NELS, ELS block group and ELS ZIP code
results are in the columns labeled NELS, ELSbg and ELSz. We sometimes report pooled estimates
that place half of the weight on the NELS estimate and half on the ELS ZIP code and block group
estimates. These are not reported in Table 2.
      The main finding across data sets and outcomes is that individual-level factors account for the
lion’s share of the variance, with school and commuting zone level variation making modest con-
tributions, and neighborhood level factors playing a smaller role. In the case of HSGRAD, the
individual-level component accounts for 81.9% [77.5, 85.0] of the outcome variance for NELS,
81.6% [75.2, 85.0] for the ELS block group specification, and 85.6% [77.2, 87.1] for the ELS
ZIP code specification. The percentage of variance at the individual level is similar for wages and
slightly lower for college graduation. Interestingly, individual level factors are somewhat lower for
enrollment in a four-year college, averaging 72.3% across NELS and the two ELS specifications.
We do not have a good explanation for this.34
      The school level accounts for a substantial fraction of the variance in education outcomes. The
average of the NELS and the ELS estimates is 9.7% for high school graduation, 15.9% for 4 year
enrollment, and 10.8% for COLLBA. For wages, the estimates are about 9.0% for ELS but only
3.1% for NELS.
      Variation at the commuting zone level accounts for between 3.9% and 6.6 of the latent variable
for high school graduation, about 10% for college enrollment, between 6.2% and 7.9% for college
graduation and between 6.2% and 7.6% for wages.
      We were surprised to find that differences across neighborhoods among students attending the
same schools do not account for much variation, even at the census block level. In the ZIP code case,
the percentage varies between 0.6% and 1.3% across education outcomes. For wages the estimates
   34 It bears repeating that we are not using sampling weights due to computational difficulties in the second step and

so are not accounting for differences in designs of the ELS and NELS samples. This could contribute to differences in
the estimates across ELS and NELS, although we noted earlier that the first step estimates of parameters involving the
observables are not sensitive to weighting.


                                                          32
are 0.7% for NELS and 1.1% for ELS. The ELS block group estimates are larger: 2.2% for HS-
GRAD, 3.1% for ENROLL, and 2.4% for COLLBA and 3.2% for wages. While the relatively small
neighborhood component is surprising, this does not necessarily mean that neighborhood effects
and neighborhood-level sorting are unimportant. Alternatively, the high and low quality neighbor-
hoods might be sufficiently grouped within school attendance zones that most of the variation in
neighborhood inputs is across schools. As discussed in sections 4.5.1 and 6.3, the variance decom-
positions are crafted to prevent higher-level inputs (eg., commuting zone) from being reflected in
lower-level variance components, but between-school variation in neighborhood quality will still be
captured by the between-school variance components. This may be reinforced by the fact that the
ELS and NELS samples are clustered at the school level rather than at the neighborhood level. In
addition, ZIP code may be too coarse a measure of neighborhood, with many ZIP codes containing
a mix of both good and bad neighborhoods (so that the bulk of neighborhood variation is assigned
to the “within-neighborhood” category in Table 2). But the estimates are still relatively small when
we use block group. Clustering is clearly much stronger across schools.

7.1.2   The Extent of Student Sorting at the Neighborhood, School, and Commuting Zone
        Levels

   The decompositions in Table 2 convey the degree to which outcomes are clustered at each level
of aggregation, but they combine group-level differences that are attributable to student sorting with
true group-level inputs. Table 3 examines the degree to which neighborhood, school, and commut-
ing zone amenities and job opportunities segregate the population on the observable individual char-
acteristics that best predict educational outcomes and wages. Note that the individual observables
X i have a fair amount of predictive power for Yi , especially for postsecondary education (bottom
row). Across NELS and the two ELS specifications, the average of the estimates of the share of
outcome variance attributable to X i B is 23.9% for HSGRAD and considerably larger for ENROLL
(38.6%) and COLLBA (35.6%). For wages, the share is 13.9% for NELS and about 23.3% for ELS.
                                                                             X i B ) that is within
   The row labeled “Individual Share of Var(XB)” reports the fraction of var(X
neighborhood. The estimates average 70.5% for both HSGRAD and for the wages, but are some-
what smaller for ENROLL (65.0%) and COLLBA (63.1%). The individual shares are about 3%
lower when the neighborhood definition is block group rather than ZIP code.
   We also find substantial sorting across schools both within and across commuting zones. The
school level share estimates average 17.2% for HSGRAD, 20.8% for ENROLL, 22.3% for COLLBA
and 17.6% for wages. The corresponding commuting zone shares are 10.8% for HSGRAD, 12.6%
for ENROLL, 13.2% for COLLBA and 10.2% for wages. The substantial amount of sorting on
X i B underscores the need for econometric techniques to distinguish the contribution of school and
commuting zone inputs from sorting. A large portion of differences in raw outcome means across
schools and commuting zones is directly attributable to differences in the kinds of students these
schools and areas attract.



                                                 33
      Consistent with the results in the previous section, there is not much evidence of outcome-
relevant sorting across ZIP codes within school attendance zones. In the case of HSGRAD, the
neighborhood-level shares of Var(XX i B ) are 1.5% for NELS and 0.5% for ELS ZIP code. They
average less than 1% for each of the other three outcomes. This might simply indicate that ZIP codes
are poor proxies for neighborhoods. The ELS block group estimates are substantially larger: 2.3%
for HSGRAD, about 3.5% for ENROLL, 3.6% for COLLBA, and 4.6% for wages, underscoring the
importance of finer neighborhood designations.35


7.2     Model Estimates
7.2.1    Regression Indices and Random Effects

   Because we do not seek to interpret the particular elements of the coefficient vectors B , G 1 ,
or G 2 , we focus on characterizing the relative importance of student and family, neighborhood,
school, and commuting zone levels in determining outcomes. To this end, the columns of Panels A,
B, and C of Table 4 present estimates from (23) of the effects of a one standard deviation change
in X i B, X n GN1 , X s GS1 , Z S2s GS2 , and Z C2c GC2 on the latent probit indices that determine the education
outcomes, as well as the corresponding standard deviations of the random effects. Panel D presents a
corresponding set of estimates for ln(wage) at about age 25. Zero values for point estimates of these
standard deviations indicate that the bias correction led to a negative value. The estimates of the
interaction coefficients are somewhat noisy, so we also present the average of the point estimates
for the NELS sample and the ELS ZIP code sample in the columns labeled “N + E”, along with
standard errors for this average.
      The results reconfirm that the observed individual-level factors are powerful determinants of
educational attainment. The neighborhood, school and commuting zone level components of the
model have quite small standard deviations relative to sd(vi − vn ), which is normalized to 1, and
b X i B ), which averages about 0.60 for high school, 0.90 for ENROLL and about 0.86 for COLLBA.36
sd(X
As we will demonstrate in Figure 1a below, the NELS results indicate that one can predict educa-
tional attainment quite well using observed student and family characteristics even in 8th grade. A
one standard deviation increase in X i B raises the permanent wage by 0.163 (0.006) in the case of
ELS and 0.134 (0.007) in the case of NELS, while sd(v  b i − vn ) is around twice as large, ranging
from 0.274 (.008) to 0.318 (.007). These values are substantial relative to the estimated standard
deviations of the permanent wage, which are 0.338 for ELS and 0.361 for NELS. The mid-20’s
wage used here does not fully capture the divergence that will occur later in life.
                                                         b X n G N ), indicate that the ZIP code and
      The estimates for the observed neighborhood index, sd(X    1
block group characteristics taken from Census Bureau and LODES data have relatively little pre-

   35 The differences in across-neighborhood means of X and xU of students drawn to a given school from different
                                                          i       i
quality neighborhoods may understate differences in the mean of X i and xU
                                                                         i of the full set students from the neighborhoods
they come from. We do not have a good way to quantify this sample design effect.
   36 We obtain similar estimates of these parameters when we exclude interaction terms (see Online Appendix Table

B5).


                                                           34
dictive power across outcomes and datasets. Indeed, once the bias correction has been applied, in 5
of the 12 education cases the estimated variance of the neighborhood index is less than one would
                                     b X n GN ) is set to 0). sd(v
expect due to sampling variance (so sd(X                      b n − vs ) is typically modest in size.
                                                  1
For all three outcomes, it lies between 0.153 and 0.181 at the block group level in ELS and between
0.096 and 0.134 at the ZIP code level for both ELS and NELS. For the wage, sd(v    b n − vs ) is .049
(.006) log points in the ELS block group case. It is around .03 (.004) at the ZIP code level for both
ELS and NELS.
    In contrast to the neighborhood component of the control function, the index X s G S1 exhibits
sizable and statistically significant standard deviations between .1 and .2 for all education outcomes
and datasets (except for COLLBA in ELS, where it is around .07), showing that the school-level
demographic averages are absorbing a meaningful share of the outcome variation. They are similar
in relative magnitude for the wage.
   Next, we turn to the indices of observed group-level inputs that are not averages of individual
inputs, Z S2s and Z C2c . The ability of these indices to predict outcomes, along with the standard
deviations of vs − vc and vc , form the core of our counterfactual shifts in school- and commuting
zone-level inputs presented in the next section.
                        Z S2s G S2 ) are concentrated around 0.10 for HSGRAD and ENROLL. They
    The estimates of sd(Z
are about 0.08 for COLLBA. The ELS estimates tend to be slightly smaller when using block
group rather than ZIP code to define neighborhoods. The estimates of sd( vs − vc ) are around
0.1 across data sets and specifications for HSGRAD, around 0.14 for ENROLL, and around 0.065
for COLLBA. We do not have strong priors as to whether to expect a larger value for the lower-level
education outcomes than for COLLBA.
                        Z C2c GC2 ) are relatively robust across datasets, alternative neighborhood def-
    The estimates of sd(Z
initions, and inclusion/exclusion of interaction terms for both high school graduation and four-year
college enrollment. They are concentrated between .11 and .16, with slightly larger NELS88 values
for college enrollment. Standard deviations for college graduation are somewhat smaller, between
.062 and .091. Standard errors are typically around .03. The estimates are typically about one quar-
                                    Z S2s G S2 ) . The standard deviation of vc is typically half to two thirds
ter larger than the estimates of sd(Z
as large as sd(v
             b s − vc ). Overall, observed and unobserved school inputs are slightly more important
                                                                        b Z C GC ) and sd(v
for education outcomes than CZ inputs. But as we will see in Section 8, sd(Z           b c)
                                                                             2c 2
are large enough to imply that shifting from low to high quality commuting zone environments
substantially increases educational attainment.
                                                                      b Z S G S ) generally between .01
   Neither Z S2s nor Z C2c predicts log wages particularly well, with sd(Z 2s 2
              b Z C GC ) between .02 and .04. In comparison the values of sd(X
and .02 and sd(Z                                                                   b X i B ) are between
                    2c   2
                               b Z S GS ) are only reach statistical significance when NELS and
0.134 and 0.163. The values of sd(Z 2s 2
ELS are pooled. The estimates of sd(vs − vc ) and sd(vc ) are also relatively small—about .02 (.002)
and 0.013 (.002) respectively. This may reflect the early age at which log wages are measured in
both NELS and ELS.



                                                      35
7.2.2   Estimates of the Interaction Coefficients

      Table 4 also reports estimates of the coefficients r1N , r1S , rS2 , and r C2 on interactions between
                                                                             N             N          S          S
student-level variables and the standardized regression indices X n Ĝ     G1 /sd(X                G1 /sd(X
                                                                                        G1 ) , X s Ĝ
                                                                                    X n Ĝ                    G1 ) ,
                                                                                                          X s Ĝ
         S            S                C            C
Z S2s Ĝ     Z S2s Ĝ
      G2 /sd(Z     G2 ) , and Z C2c Ĝ     Z C2c Ĝ
                                    G2 /sd(Z     G2 ) . In the case of the interactions between X i B (also in
standard deviation units) and the neighborhood composition index X Nn GN1 , the estimates of r1N are
almost always negative, suggesting that disadvantaged students disproportionately benefit from liv-
ing in a stronger neighborhood. For ENROLL and COLLBA, the pooled estimates are negative and
significant at the 0.15 and 0.01 levels, respectively. However, we do not make too much of this result
because the bias corrected estimates of the main effect of X Nn G N1 are weak, making identification
of interaction effects suspect. Furthermore, the negative interaction is not present for high school
graduation or for ELS log wages.
    The coefficient r1S capturing interactions between X i B and X s G S1 varies in sign. The pooled
estimates and standard error are each around .02 for the three education outcomes. The estimate is
essentially 0 for log wages.
    The estimates of the interactions between X i B and the non-peer school inputs and policies cap-
                  S            S
tured in Z S2s Ĝ     Z S2s Ĝ
               G2 /sd(Z     G2 ) show consistent negative signs across all educational outcomes. The
pooled estimates are -0.048 (0.023) and -0.059 (0.024) for ENROLL and COLLBA, respectively. In
the case of ENROLL, the pooled estimate implies that the effect on the probit index of a one stan-
                                    S
dard deviation increase in Z S2s Ĝ
                                 G2 is -0.048 (0.023) lower for a student 1 standard deviation above
the mean of X i B than for a student at the mean. This difference is small compared to the pooled
estimate of 0.901 (0.020) of the main effect of X i B , although one could not rule out a difference
of -0.063 at the 90% level. This value is about half of the main effect of Z S2s G S2 . The estimates
do suggest increased sensitivity to external inputs for disadvantaged students. The relatively low
predictive power of Z S2s G S2 in the case of wages inhibits identification of interactions with Z S2s G S2 .
                                                                                                            C          C
    The pooled estimates of the interactions between X i B and the commuting zone index Z C2c Ĝ     Z C2c Ĝ
                                                                                              G2 /sd(Z     G2 )
are positive for the education outcomes and negative for log wages, and always small and statisti-
cally insignificant.
   The interactions between the indicators for female, minority status, and low income with Z S2s G S2
or Z C2c GC2 tend to be statistically insignificant as well as inconsistent in sign across datasets and
outcomes. In the case of minority status and low income status, none of the pooled estimates are
significant at the 10% level, and the point estimates are typically small relative to the main effects
of Z S2s G S2 and Z C2c GC2 .
    Overall, we do not find strong evidence of interaction effects. The standard errors are sufficiently
large that we cannot rule out moderately important interactions. But we can rule out interactions
that would substantially alter the relationship between X i B and the latent variables for education
and for log wages. In the education case, the non-linearity of the probit function may be enough
to capture the differential sensitivity of students with higher versus lower observed inputs to group-
level inputs. We investigate this further in Sections 8.1.1 and 8.2.1.


                                                        36
8      The Impact of Shifts in School and Commuting Zone Quality
      This section reports estimates of the effects of the three types of counterfactual shifts in school
and commuting zone quality described in Section 6.4, both for the full population and for partic-
ular subpopulations. We organize the discussion by outcome. We focus on the treatment effects
estimates for the full set of X i variables but briefly discuss estimates using the basic set, which are
typically larger.


8.1     High School Graduation
      The row labeled “School only” in Panel A of Table 5 reports the average treatment effect for
the full student population of attending a 90th quantile school instead of a 10th quantile school. The
rows labeled “CZ only” and “School+CZ” report the impact of a 10th to 90th quantile shift in the
commuting zone environment and a 10th to 90th quantile shift in combined school and commuting
zone quality, respectively. Standard errors are in parentheses. As in prior tables, NELS, ELS block
group, and ELS ZIP code results are denoted by the column headings NELS, ELSbg, and ELSz
respectively.
      Focusing first on the NELS results, we see that shifting from a 10th to a 90th quantile school/commuting
zone increases the high school graduation probability from 0.816 to 0.904, an increase of 0.088
(0.014). This is very large relative to the dropout rate. A corresponding shift in the school en-
vironment only (while receiving a random draw from the distribution of commuting zone inputs)
changes the graduation probability from 0.831 to 0.891, an increase of 0.06 (0.014). The effect of a
10th -to-90th quantile shift in commuting zone inputs is 0.067 (0.017).
      The estimates for ELS are somewhat smaller. In the ELS block group case, the “School and
CZ” treatment raises the graduation probability by 0.062 (0.011), from 0.896 to 0.958. The school
treatment raises it by 0.045 (0.010), and the CZ treatment raises it by 0.041 (0.009). The values are
slightly smaller when we use ZIP code as the neighborhood measure. One reason for the smaller
ELS estimates is that the unweighted high school graduation probability in the sample is very high:
0.92. Thus, there is not much room for increases in the graduation probability. Online Appendix
Table B7 displays estimates of the impacts of 10th -to-50th quantile shifts for the same treatments.
Despite the nonlinearity in the probit function, the estimates are only slightly more than half as large
as the corresponding 10th -to-90th shifts, so the shift from the 50th -to-90th quantile matters almost as
much as the shift from the 10th -to-50th quantile.
      The estimates for the combined “School and CZ” treatment for ELS are essentially identical to
the school-level estimates from the full specification in AM that implicitly incorporate CZ inputs as
well. The NELS estimates are about .04 smaller than the corresponding estimates in AM, indicating
some sensitivity to the changes in specification introduced in this paper: the exclusion of weights,
the addition of interactions, and the addition of neighborhood-level control function variables Xn
                          C.
and CZ-level observables Z2c



                                                     37
    While the estimates are somewhat noisy, taken together the results for HSGRAD indicate that
large shifts in school and commuting zone inputs could generate socially significant impacts on
                                                                             Z S2s GS2 , Z C2c GC2 , (vs −
graduation probabilities. Note that this is true even though the components (Z
vc ), vc ) that we ascribe to school and commuting zone inputs comprise relatively small fractions of
the outcome variance. Row 8 of Appendix Table A1 reports that the variance of Z S2s G S2 + Z C2c GC2 +
(vs − vc ) + vc , which drives the “School and CZ” treatment, comprises just 2.2 percent of the full
latent index variance in NELS, and only 3.0 percent in the ELS block group specification.37 Rows 9
and 10 report that the school inputs that matter for the “School Only” treatment and the commuting
zone inputs that matter for the “CZ Only” treatment each account for only about 1 to 1.5 percent of
the latent index variance in NELS.
    Why do 10th -to-90th quantile shifts in distributions featuring such small variances generate such
substantial outcome changes? One reason is that variance components, by virtue of squaring devia-
tions, tend to exacerbate differences in the relative importance of various inputs; standard deviations
of these components are considerably closer in size to those corresponding to individual-level in-
puts. The second reason is that for binary outcomes even a small shift in the underlying propensity
to graduate can have a significant impact on graduation outcomes if many students are near the
decision margin.
    The ELS estimates using the basic set of X i variables in Online Appendix Table B9 are typically
larger by less than 1 percentage point for each treatment. The NELS estimates are each around 1
percentage point larger. As we have discussed in Section 5.3, the estimates based on the full set are
                                                                          S          N
                                                                       G1 and X n Ĝ
more conservative. Both estimates exclude peer effects captured by X s Ĝ         G1 .

8.1.1    Subpopulation Results for High School Graduation

    We now examine heterogeneity in treatment effects. Treatment effect heterogeneity across
groups arises through three pathways. First, the model includes interactions involving female, un-
derrepresented minority, and low income indicator variables. As we discussed in Section 7.2.2, the
coefficients on the interactions between female, minority status, or low income and either Z S2s G S2
or Z C2c GC2 tend to be statistically insignificant as well as inconsistent in sign across datasets and
outcomes.
   The second and third pathways both arise from differences in the distributions of X i B across sub-
populations. The second pathway arises because the model contains interactions between X i B and
Z S2s G S2 and Z C2c GC2 . As we have already discussed, the interactions between X i B and the non-peer
                                                  S             S
school inputs and policies captured in Z S2s Ĝ        Z S2s Ĝ
                                                G2 /sd(Z     G2 ) show consistent negative signs across all
educational outcomes but are small for high school graduation. The interactions between X i B and
         C            C
Z C2c Ĝ     Z C2c Ĝ
      G2 /sd(Z     G2 ) are typically too small to matter much, regardless of the outcome. Conse-
   37 Note that these variance components are computed based on the specification in Columns 1-3 of Table 4. In com-

puting variance fractions, we ignore the variance contribution of the interaction terms because a simple variance de-
composition does not exist for the model with interactions. The interactions are accounted for in the 10-90 estimates.
The corresponding table for the linear specification is available upon request. The values are close for all outcomes and
samples.


                                                          38
quently, the interaction terms are not a primary source of differences across groups in treatment
effects, at least for HSGRAD.
    The third pathway arises because differences in the locations of the X i B distribution across sub-
groups produces treatment effect heterogeneity for binary outcomes even in the absence of explicit
interaction terms. Due to the nonlinearity of the probit function that links Yi to the binary outcome
indicators for education, the sensitivity to school and commuting zone quality is higher for subpop-
                            B that place them closer to an outcome probability of 0.5. Consequently,
ulations with values of X i B̂
HSGRAD is more sensitive to school or commuting zone quality for disadvantaged subpopulations
and less sensitive for advantaged subpopulations. The opposite tends to be true for ENROLL and
COLLBA. In the extreme case, if every member of the subpopulation had a sufficiently high X i B
value, they would all attain the positive outcome regardless of their school/commuting zone envi-
ronment. We think this is main source of heterogeneity in the treatment effects, to which we now
turn.
    Table 6 displays the impacts on high school graduation of the 10th -to-90th quantile shifts in
quality for each of our three counterfactuals for six subpopulations, which are indicated by the
column headings. We consider Hispanic students, non-Hispanic black students, non-Hispanic white
students, non-Hispanic white students with a single mother with a high school education or less,
and non-Hispanic white students living with two biological parents with four-year college degrees
or above.
    We start with NELS. White students dominate the sample, and so estimates are similar to but
a bit smaller than those for the full sample. Black students are moderately more sensitive to each
of the three treatments than the population at large. Hispanic students and non-Hispanic white
students with a single mother with a high school education or less have the lowest mean X i B values
and are the most sensitive. For non-Hispanic blacks, the “School and CZ” 10th -to-90th quality shift
increases the predicted high school graduation probability by 0.095 (0.017), from 0.806 to 0.901.
For children of less-educated white single mothers, the increase is 0.140 (0.021), from 0.669 to
0.810. In contrast, non-Hispanic white students with two college-graduate parents can only expect
a 0.040 (0.007) increase in graduation probability from the same shift in school/commuting zone
inputs. We obtain similar estimates of NELS 10th -90th treatment effects using the models without
interactions38 This suggests that the chief source of treatment effect heterogeneity is the nonlinearity
of the probit function rather than the estimated interactions, though the interaction effects do cause
the estimates to diverge from the mean by less than the probit function alone would predict.
    The ELS results with either block group or ZIP code as the neighborhood are smaller. The
“School and CZ” effects are 0.087 (0.015) and 0.076 (0.015), respectively, for Hispanic and non-
Hispanic black students using the block group estimates, and only about 0.021 (0.004) for white
students with two college-graduate parents. The smaller ELS results are primarily due to fact that
the ELS sample average for HSGRAD is 0.92.
   38 The values are 0.088 for blacks, 0.130 for white students with less-educated single mothers, and 0.038 for white
students with two college-graduate parents. The table is available upon request.


                                                         39
      Differences across subpopulations in the effects of the “School only” and “CZ only” treatments
follow a similar pattern. For these counterfactuals, the 10th -90th treatment effects for the subpopula-
tions vary by a few percentage points around the “School only” and “CZ only” 10th -90th treatment
effects for the full sample.
    Figures 1a and 1b and Figure 2 illustrate more generally how the predicted outcome changes
as the quantile of the X i B index increases. The solid dark line in Figure 1a (1b) shows how in the
NELS (ELS block group) case the probability of high school graduation (vertical axis) varies with
the quantile of X i B for a student who receives the median value of the “School and CZ” treatment.
It provides a yard stick for thinking about the magnitude of treatment effects. Figure 2 graphs 10th -
to-90th treatment effects against the X i B quantile. We exclude confidence intervals to reduce clutter,
but Online Appendix Table B8 reports both estimates and standard errors of treatment effects for
students at the 10th , 50th and 90th quantiles of X i B .
    The impact of each 10th -to-90th treatment decreases monotonically with the X i B quantile. Specif-
ically, students in NELS (light grey line) at the 10th quantile of the X i B distribution move from a
0.592 chance of graduating to a 0.762 chance when the quality of the combined school/commuting
zone environment shifts from the 10th to the 90th quantile, whereas students at the 90th quantile
only move from a 0.970 graduation rate to a 0.991. So 8th grade school and commuting zone en-
vironment seems to be very important for high school graduation for particularly disadvantaged
populations, and essentially irrelevant for particularly advantaged populations. The ELS results for
both neighborhood definitions display a similar pattern of sensitivity to school and CZ inputs, but
with proportionately smaller impacts over the range of X i B .


8.2     Enrollment in a Four-Year College
      Panel B of Table 5 reports the impacts of the corresponding counterfactual shifts in school and/or
commuting zone environment for whether the student enrolls in a four-year college within two years
of expected high school graduation.
      A 10th -to-90th quantile shift in combined school/commuting zone quality raises the enrollment
probability by 0.171 (0.018) (0.236 to 0.407) for 8th graders in NELS. The corresponding shifts
in school inputs only and commuting zone inputs only raise enrollment by 0.125 (0.017) and 0.114
(0.017). The estimates based on ELS ZIP code and ELS block group specifications are quite close
to the NELS estimates. Both the NELS and ELS “School and CZ” estimates are within .01 of the
corresponding full specification estimates from AM. Estimates of the impact of 10th -to-50th quantile
shifts in Online Appendix Table B7 are only slightly less than half of the corresponding 10th -to-90th
shift estimates.
      Note that the impacts of school and commuting zone on this outcome are considerably larger
than those for high school graduation. For NELS a partial explanation lies in the fact that the
fraction of the variance in Yi (the latent index) that is attributed to school and commuting zone
inputs is 0.033 for ENROLL and 0.022 for HSGRAD (Appendix Table A1). However, the variance


                                                   40
components underlying the ELS block group and ELS ZIP code counterfactuals are very similar in
magnitude to those used for the high school graduation counterfactuals (0.030 of Var(Yi ) in each
case). Instead, the larger estimated impacts for college enrollment primarily reflect the fact that the
college enrollment probability (0.327 in NELS and 0.422 in ELS, from Table 1-1) is much closer to
0.5 than for high school graduation (0.853 in NELS and 0.919 in ELS). The probit model assumes a
normal distribution of unobserved inputs, so that an outcome mean of .5 suggests that many students
are near the decision margin. Thus, the same change in the latent probit index translates to a much
greater shift in outcome probability for college enrollment.
   Treatment effects for the basic specification of X i are about 0.04 larger in ELS and about 0.02
larger in NELS (Online Appendix Table B9, columns 4-6).

8.2.1   Subpopulation Results for College Enrollment

   Panel B of Table 6 reports the impacts of our counterfactual shifts for particular subgroups of
NELS 8th graders. Because the population mean for college enrollment is below 0.5, the probit
model implies that more disadvantaged subpopulations have fewer students near the decision mar-
gin, so that the largest impacts occur for the most advantaged subgroup (in this case, white students
with two college-graduate parents) and the lowest value is for the most disadvantaged subgroup
(children of single white mothers with education less than or equal to high school). The impacts
of the “School and CZ” treatment on the enrollment probability range from 0.116 to 0.213. The
“School only” treatment displays slightly higher effects than the “CZ only” treatments with similar
degrees of heterogeneity: impacts range from 0.086 to 0.154 for “School only” and 0.075 to 0.142
for the “CZ only” treatment. The estimates of the treatment effects for the ELS ZIP code and block
group specifications follow the same pattern as in NELS, although the subgroup estimates fall in a
narrower range.
   Figure 3 shows the relationship between the treatment effects on college attendance probability
and the quantiles of X i B . The impact of the counterfactual treatments is non-monotonic in X i B ,
increasing and then decreasing as one moves through the distribution of X i B . For example, for the
“School and CZ” counterfactual in NELS, the estimated impact for the 10th , 75th (near the maximum
impact), and 90th quantiles of X i B are 0.062, 0.253, and 0.218, respectively.
   The pattern occurs despite the fact that in the NELS case the coefficient on the interaction be-
tween X i B and Z S2s G S2 is substantial: -0.069 (0.034). Part of the decline at the top of the X i B
distribution may be due to this. However, the pattern is primarily due to a striking fact about the
variation in predicted outcome probabilities across X i B quantiles that is established in Figure 1a.
In NELS (solid light line) for a school/CZ combination of median quality, the predicted enrollment
rates for a student at the 10th , 30th , 70th and 90th quantiles of X i B are 0.042, 0.136, 0.429, and
0.703, respectively. The figure demonstrates just how strongly observed family background and
student aptitude measures (as of 8th grade) predict enrollment at a four-year postsecondary insti-
tution. Consequently, very few students near the bottom of the X i B distribution are in a position


                                                  41
where higher quality school inputs would be enough to push them over the decision margin, even if
they are slightly more sensitive to school quality than the average student.
    In fact, the ELS ZIP code specification provides a good opportunity to assess the importance
                                              b Z C GC ) is substantial, so that there is more signal
of the interaction terms in the model. First, sd(Z 2c 2
contained in this regression index with which to identify true interactions. Second, the interaction
coefficients on 1(LowInc) × Z C2c GC2 and 1(URM) × Z C2c GC2 are seemingly non-negligible in size
(albeit still noisily estimated): 0.050 and 0.054 respectively (Table 4 Panel B). This suggests greater
sensitivity of students from modest backgrounds and minority students to CZ inputs. Third, the
                                                     Z C2c GC2 + vc ), contribute 1.26% of Var(Yi )
variance components for the “CZ only” treatment, Var(Z
when interactions are included and 1.24% of Var(Yi ) when they are excluded. This means that we
can directly compare treatment effects based on the models with and without interactions essentially
holding fixed the importance of the main effects. Indeed, the mean impact of the 10th -90th “CZ only”
treatment on ENROLL is 0.118 for both specifications.
      As it turns out, none of the subgroups we consider displays more than a 0.002 difference in
treatment effects between the linear and non-linear specification. While the imprecision of our
interaction estimates cautions against overinterpreting the results, our limited evidence suggests
that the probit function seems to be doing an effective job of capturing heterogeneity in sensitivity
to higher quality school and commuting zone inputs.


8.3     Graduation from a Four-Year College
      Panel C of Table 5 reports the estimated impacts of the same counterfactual treatments on a
randomly selected student’s probability of graduating college by age 25. The NELS results indicate
that replacing a combined school/commuting zone at the 10th quantile of the quality distribution
with one at the 90th quantile increases the college graduation probability by 0.085 (0.016) (from
0.309 to 0.394). Shifting only school inputs or only CZ inputs from their respective 10th to 90th
quantiles increases the graduation probability by 0.077 (0.18) and 0.046 (0.019), respectively. The
small increase in impact from shifting school and CZ quality together relative to the impact of the
separate shifts is partly due to an estimated small negative covariance between Z S2s G S2 and Z C2c GC2 .
It also reflects the fact that doubling a variance only increases the standard deviation by a factor of
√
   2.
      The ELS block group estimates are only 0.090 (0.012), 0.071 (0.015), and 0.073 (0.017), respec-
tively, with the ELS ZIP code estimates displaying slightly smaller magnitudes. Switching from the
full specification to the basic specification (displayed in Online Appendix Table B9) increases the
estimates for each dataset by about 0.015.
      The three treatments have a smaller effect on the college graduation probability than the enroll-
ment rate. We do not have a complete explanation for this, but three possibilities are worth mention-
ing. First, School and CZ inputs may play a bigger role in inducing students to attend a four-year
college than to successfully complete college. The second and related point is that marginal students


                                                   42
who are induced to enroll in a four-year college as a result of superior school and CZ inputs may
graduate at lower rates. Finally, there is considerable attrition in the sample between the survey in
which ENROLL is measured (2nd and 3rd Follow-ups for NELS and ELS, respectively) and the
survey in which COLLBA is measured (3rd and 4th follow-ups). Differential attrition could lead
the sample of students remaining when COLLBA is measured to be less sensitive to school and CZ
inputs than in earlier samples.39

8.3.1      Subpopulation Results for College Graduation

      Table 6 reveals moderate heterogeneity in estimated impacts from the counterfactual treatments
across subgroups for NELS 8th graders. A 10th -to-90th shift in combined school/CZ input quality
increases the probability of college graduation by between 0.056 (0.011) and 0.101 (0.018) with the
smallest impacts occurring for white students with a single mother with a high school degree or less
and the largest for white students with two parents with bachelor’s degrees.
                                                              Z S2s G S2 ) and Var(vs − vc )) are substan-
     The variance components attributed to school inputs (Var(Z
tially larger in NELS than those attributed to CZ inputs (Var(Z   Z C2c GC2 ) and Var(vc )). As a result,
the counterfactual impacts are substantially larger for the “School only” specification than the “CZ
only” specification, particularly for subgroups featuring high values of X i B . For example, a 10th -
to-90th quantile shift in the quality of school inputs increases enrollment by 0.081 for the white
subpopulation, while the corresponding shift in the quality of commuting zone inputs only pro-
duces a 0.049 increase. The “School Only” and “CZ Only” treatment effects are much more similar
to another in ELS.
      Once again, examining the variation in treatment impacts across X i B quantiles reveals a greater
degree of heterogeneity (Figure 4). For NELS, the “School and CZ” impacts for the 10th , 75th ,
and 90th quantiles of X i B are 0.031, 0.124, and 0.098, respectively, demonstrating the same non-
monotonicity of treatment effects across the X i B distribution as was observed for the college en-
rollment outcome. Figure 1a shows that in NELS the probability of college graduation is 0.046 for
a student at the 10th quantile of X i B and 0.754 at the 90th (evaluated at the median value of the
“School and CZ” treatment).


8.4     Log Wage Rates
      Columns 10-12 of Table 5 report the estimated impacts of the same counterfactual treatments on
a randomly selected student’s log wage as of about age 25. The NELS results (col. 10) indicate that
the effect of the 10th -90th quantile combined school/commuting zone treatment is 0.111 (0.025) log
points (which corresponds to an 11.7% wage increase). A one standard deviation improvement in
the treatment would raise log wages by 0.045 (a 4.6% wage increase). In comparison, the standard
deviation of the permanent component of the wage is 0.361. The values for ELS are slightly smaller.
   39 As  discussed in Section 5, the mean of ENROLL among sample members of the 3rd follow-up survey in NELS
is .353 vs. .327 among those in the 2nd follow-up (when the outcome is determined), suggesting some differential
attribution is taking place.


                                                      43
The estimate of the combined school/community 10th -90th treatment effect is only .104 (0.024)
log points in the block group specification (an 11% wage increase). Estimates using the basic
specification in Online Appendix Table B9 are very similar.
      The effect of the 10th -90th commuting zone treatment is larger than the school treatment in both
NELS and in ELS, in contrast to what we found for education. One would expect commuting zone
characteristics to be particularly important for wages, where opportunities in the local labor market
are paramount.
    Since the wage model is linear, the only source of treatment effect heterogeneity consists of the
interaction terms between M i and Z S2s GS2 and Z C2c GC2 . The coefficients on the interactions terms are
small, so we do not find important subgroup differences.


8.5     Summary of Results from Counterfactual Shifts
      There are several broad takeaways from the estimated impacts of counterfactual 10th -to-90th
quantile shifts in school and/or commuting zone inputs. First, large changes in school and commut-
ing zone inputs can make a substantial difference in students’ educational attainment.
      Second, the impact of these inputs is quite heterogeneous across disadvantaged vs. advantaged
students. The dropout rates of disadvantaged students are particularly sensitive to the external en-
vironment, while few advantaged students are near the margin. In contrast, for college enrollment
and graduation, superior school and commuting zone inputs are important for all, but particularly
consequential for students near (or above) the middle of the distribution of student and family back-
ground.
      Third, the more general model featuring interactions between student and school/commuting
zone inputs produces predicted impacts of shifts in school and commuting zone environment that
differ little from the results using the simpler probit specification without interactions. This suggests
that the nonlinearity inherent in the probit function does a fairly good job of capturing differential
sensitivity to school and region-level inputs, and that a linear specification for the probit index may
suffice in similar contexts. But this need not be true in other applications and the estimates of the
interaction coefficients are imprecise.
      Finally, both school and commuting zone inputs seem to be important, and with comparable
magnitudes. However, this conclusion is more tentative, because we cannot fully distinguish be-
tween unobservable school inputs and unobservable commuting zone inputs.


9      Conclusion
      Educational attainment and wages, like many adult outcomes, are influenced by factors that are
specific to the individual as well as aspects of the broader social environment. In this paper, we build
on the rich literature on sorting, school and neighborhood effects, and multilevel modeling to assess
the relative importance of neighborhood, school, and broader local area factors in shaping student’s


                                                   44
educational attainment and early career wages, and the degree to which this relative importance
differs across students from different backgrounds. We extend the identification results of Altonji
and Mansfield (2018) to models with multiple group levels and with interactions between observed
individual factors and both observed and unobserved group level factors. The identification results
are based on the idea that group averages of individual-level observables can fully control for sorting
bias from group averages of individual-level unobservables. A natural but challenging extension to
our analysis would be to incorporate interactions with unobserved individual characteristics.
   Our theoretical results demonstrate the existence of a structural decomposition of variation in
educational and labor market outcomes of interest into four components: (1) individual contribu-
tions that are common across groups, (2) group contributions that are common across individuals,
(3) contributions that consist of interactions between student and group inputs, and a (4) set of
ambiguous contributions, absorbed by our control function of group-level averages, that reflect a
combination of common group inputs and group-averages of individual inputs.
   We implement this structural decomposition using a multilevel mixed effects model, and use the
results to generate lower bound estimates of the average impact among the student population of
“treatments” consisting of shifts in school, commuting zone, and combined school/commuting zone
quality from the 10th to the 90th quantile of their respective distributions. We also produce estimates
for particular student subpopulations that exploit the treatment effect heterogeneity accommodated
by our model.
   Despite accounting for a small share of the total variance in the latent indices that generate our
binary outcomes, our population average estimates suggest that school and commuting zone inputs
play an important role in determining educational attainment. Moving from a school/commuting
zone combination at the 10th quality quantile to a 90th quantile combination increases the probability
of high school graduation by at least 0.06-0.09 across datasets and specifications, the probability of
enrollment at a four-year college by at least 0.17-0.18, and the probability of college graduation by at
least 0.08-0.09. School and commuting zone inputs seem to play a roughly equal role in producing
educational attainment, though the model’s ability to distinguish between the two is more limited.
A 10th -90th quantile shift in school/commuting zone quality increases wages by 10-11 percent, with
commuting zone factors playing a somewhat larger role relative to school inputs and policies.
   High school graduation rates of disadvantaged populations are considerably more sensitive to
school and commuting zone inputs, while college graduation rates are more sensitive to group-
level inputs for advantaged populations. However, the heterogeneity in treatment effects is driven
by the share of the subpopulation near the decision margin in our probit models, rather than by
fundamental differences in input sensitivity. Our estimated interaction effects are usually small
(though somewhat imprecise), suggesting that the inherent nonlinearity in the probit model well-
approximates the heterogeneity in school and commuting zone treatment effects.
   Our analysis of a regression index of student-level observables suggests that most outcome-
relevant sorting takes place at the level of school attendance zones, with a modest role for commut-



                                                  45
ing zone-level sorting and a very small role for neighborhood sorting. It is possible, of course, that
the neighborhood component may be understated by the use of block group or ZIP code to define
neighborhood boundaries.
   While the panel surveys we use offer many advantages, a multilevel mixed effects model fea-
turing interactions among multiple combinations of levels places strong demands on the data. This
leads some of our estimates (particularly interactions) to be imprecise, and highlights the value of
increasingly available linked administrative data that offer both many groups at each hierarchical
level and large numbers of individuals per group, along with rich sets of observable characteris-
tics at each level. Obtaining observed neighborhood characteristics that are plausible sources of
neighborhood-level causal effects would be particularly valuable.




                                                 46
References
Aaronson, Daniel. 1998. Using sibling data to estimate the impact of neighborhoods on children’s
   educational outcomes. Journal of Human Resources 33(4), 915-946.

Alexander, Karl and Stephen L. Morgan. 2016. The Coleman Report at fifty: Its legacy and implica-
   tions for future research on equality of opportunity. RSF: The Russell Sage Foundation Journal
   of the Social Sciences 2(5), 1-16.

Altonji, Joseph G. and Thomas A. Dunn. 1996. Using siblings to estimate the effect of school
   quality on wages. Review of Economics and Statistics 78(4), 665-671.

Altonji, Joseph G. and Richard K. Mansfield. 2018. Estimating group effects using averages of
   observables to control for sorting on unobservables: School and neighborhood effects. American
   Economic Review 108(10), 2902-46.

Altonji, Joseph G. and Richard K. Mansfield. 2011. The role of family, school, and community
   characteristics in inequality in education and labor market outcomes. In Whither Opportunity?
   Rising Inequality, Schools, and Children’s Life Chances, ed. Greg J. Duncan and Richard J.
   Murnane. Russell Sage Foundation.

Angrist, Joshua D., Sarah R. Cohodes, Susan M. Dynarski, Parag A. Pathak, and Christopher R.
   Walters. 2016. Stand and deliver: Effects of Boston’s charter high schools on college prepara-
   tion, entry, and choice. Journal of Labor Economics 34(2), 275-318.

Bayer, Patrick, Fernando Ferreira, and Robert McMillan. 2007. A unified framework for measuring
   preferences for schools and neighborhoods. Journal of Political Economy 115(4), 588-638.

Bergman, Peter L. S. 2016. The effects of school integration: Evidence from a randomized deseg-
   regation program. Working Paper No. 6119, CESifo Group Munich.

Berry, Steven T. 1994. Estimating discrete-choice models of product differentiation. RAND Journal
   of Economics 25(2), 242-262.

Betts, Julian R. 1995. Does school quality matter? Evidence from the National Longitudinal Survey
   of Youth. Review of Economics and Statistics 77(2), 231-250.

Browning, Martin, Pierre-Andre Chiappori, and Yoram Weiss. 2014. Economics of the Family.
   Cambridge University Press.

Card, David and Jesse Rothstein. 2007. Racial segregation and the black-white test score gap.
   Journal of Public Economics 91(11), 2158-2184.

Chetty, Raj and Nathaniel Hendren. 2018a. The effects of neighborhoods on intergenerational


                                               47
   mobility I: Childhood exposure effects. Quarterly Journal of Economics 133(3), 1107-1162.

——, 2018b. The effects of neighborhoods on intergenerational mobility II: County level estimates.
   Quarterly Journal of Economics 133(3), 1163-1228.

Chetty, Raj, Nathaniel Hendren, and Lawrence F. Katz. 2016. The effects of exposure to better
   neighborhoods on children: New evidence from the Moving to Opportunity experiment. Amer-
   ican Economic Review 106(4), 855-902.

Chyn, Eric. 2018. Moved to opportunity: The long-run effect of public housing demolition on labor
   market outcomes of children. American Economic Review 108(10), 3028-56.

Coleman, James S., Ernest Q. Campbell, Carol J. Hobson, James McPartland, Alexander M. Mood,
   Frederick D. Weinfeld, and Robert L. York. 1966. Equality of Educational Opportunity. US
   Department of Health, Education & Welfare.

Cullen, Julie Berry, Brian A. Jacob, and Steven Levitt. 2006. The effect of school choice on
   participants: Evidence from randomized lotteries. Econometrica 74(5), 1191-1230.

Cunha, Flavio, James J. Heckman, Lance Lochner, and Dimitriy V. Masterov. 2006. Interpreting
   the evidence on life-cycle skill formation. Handbook of the Economics of Education 1, 697-812.

Deming, David J., Justine S. Hastings, Thomas J. Kane, and Douglas O. Staiger. 2014. School
   choice, school quality, and postsecondary attainment. American Economic Review 104(3), 991-
   1013.

Dobbie, Will and Roland G. Fryer. 2011. Are high-quality schools enough to increase achievement
   among the poor? Evidence from the Harlem Children’s Zone. American Economic Journal:
   Applied Economics 3(3), 158-187.

Durlauf, Steven N. 2004. Neighborhood effects. Handbook of Regional and Urban Economics 4,
   2173-2242.

Durlauf, Steven N. and Yannis M. Ioannides. 2010. Social interactions. Annual Review of Eco-
   nomics 2(1), 451-478.

Ekeland, Ivar, James J. Heckman, and Lars Nesheim. 2004. Identification and estimation of hedonic
   models. Journal of Political Economy 112.S1, S60-S109.

Epple, Dennis and Glenn J. Platt. 1998. Equilibrium and local redistribution in an urban economy
   when households differ in both preferences and incomes. Journal of Urban Economics 43(1),
   23-51.

Epple, Dennis and Holger Sieg. 1999. Estimating equilibrium models of local jurisdictions. Journal


                                               48
   of Political Economy 107(4), 645-681.

Garner, Catherine L. and Stephen W. Raudenbush. 1991. Neighborhood effects on educational
   attainment: A multilevel analysis. Sociology of Education 64(4), 251-262.

Goldstein, Harvey. 2011. Multilevel Statistical Models. John Wiley & Sons.

Graham, Bryan S. 2018. Identifying and estimating neighborhood effects. Journal of Economic
   Literature 56(2), 450-500.

Harding, David J., Lisa Gennetian, Christopher Winship, Lisa Sanbonmatsu, and Jeffrey R. Kling.
   2011. Unpacking neighborhood influences on education outcomes: Setting the stage for future
   research. In Whither Opportunity? Rising Inequality, Schools, and Children’s Life Chances, ed.
   Greg J. Duncan and Richard J. Murnane. Russell Sage Foundation.

Jacob, Brian A. 2004. Public housing, housing vouchers, and student achievement: Evidence from
   public housing demolitions in Chicago. American Economic Review 94(1), 233-258.

Jencks, Christopher S. and Susan E. Mayer. 1990. The social consequences of growing up in a
   poor neighborhood. In Inner-City Poverty in the United States, ed. National Research Council.
   National Academies Press.

Jencks, Christopher S. and Marsha D. Brown. 1975. Effects of high schools on their students.
   Harvard Educational Review 45(3), 273-324.

Katz, Lawrence F. 2015. Reducing inequality: Neighborhood and school interventions. Focus
   31(2), 12-17.

Kline, Patrick and Enrico Moretti. 2014. People, places, and public policy: Some simple welfare
   economics of local economic development programs. Annual Review of Economics (1), 629-
   662.

Kling, Jeffrey R., Jeffrey B. Liebman, and Lawrence F. Katz. 2007. Experimental analysis of
   neighborhood effects. Econometrica 75(1), 83-119.

Laliberte, Jean-William P. 2018. Long-term contextual effects in education: Schools and neighbor-
   hoods. Working Paper.

Lindenlaub, Ilse. 2017. Sorting multidimensional types: Theory and application. Review of Eco-
   nomic Studies 84(2), 718-789.

Lise, Jeremy, Costas Meghir, and Jean-Marc Robin. 2016. Matching, sorting, and wages. Review
   of Economic Dynamics 19, 63-87.



                                               49
Lucas, Samuel R. 2016. First- and second-order methodological developments from the Coleman
   Report. RSF: The Russell Sage Foundation Journal of the Social Sciences 2(5), 117-140.

McFadden, Daniel L. 1984. Econometric analysis of qualitative response models. Handbook of
   Econometrics 2, 1395-1457.

Meghir, Costas and Steven Rivkin. 2011. Econometric methods for research in education. Hand-
   book of the Economics of Education 3, 1-87.

Meier, Lukas, Sara Van De Geer, and Peter Buhlmann. 2008. The group lasso for logistic regression.
   Journal of the Royal Statistical Society: Series B (Statistical Methodology) 70(1), 53-71.

Oreopoulos, Philip. 2003. The long-run consequences of living in a poor neighborhood. Quarterly
   Journal of Economics 118(4), 1533-1575.

Raudenbush, Stephen W. and Anthony S. Bryk. 2002. Hierarchical Linear Models: Applications
   and Data Analysis Methods. Sage.

Rosen, Sherwin. 1974. Hedonic prices and implicit markets: Product differentiation in pure com-
   petition. Journal of Political Economy 82(1), 34-55.

Sampson, Robert J., Jeffrey D. Morenoff, and Thomas Gannon-Rowley. 2002. Assessing “neigh-
   borhood effects”: Social processes and new directions in research. Annual Review of Sociology
   28, 443-478.

Sharkey, Patrick and Jacob W. Faber. 2014. Where, when, why, and for whom do residential
   contexts matter? Moving away from the dichotomous understanding of neighborhood effects.
   Annual Review of Sociology 40, 559-579.

Solon, Gary, Marianne E. Page, and Greg J. Duncan. 2000. Correlations between neighboring
   children in their subsequent educational attainment. Review of Economics and Statistics 82(3),
   383-392.

Todd, Petra E. and Kenneth I. Wolpin. 2003. On the specification and estimation of the production
   function for cognitive achievement. The Economic Journal 113, F3-F33.

Yuan, Ming and Yi Lin. 2006. Model selection and estimation in regression with grouped variables.
   Journal of the Royal Statistical Society: Series B (Statistical Methodology) 68(1), 49-67.




                                                50
                                            TABLE 1-1
                              S UMMARY OF O UTCOME VARIABLES

                                                    NELS                   ELS
              Outcome Variable             Mean       Std. Dev.    Mean     Std. Dev.
              Education outcome:
                1(HSGRAD)                   0.853        0.354     0.919       0.272
                1(ENROLL)                   0.327        0.469     0.422       0.494
                1(COLLBA)                   0.353        0.478     0.376       0.484
              Log hourly wage (2009 $)      2.544        0.534     2.666       0.500

N OTE.—Statistics calculated on respective regression samples based on the “full” specification. The
dependent variables are indicators for high school graduation (HSGRAD), enrollment in a 4 year
college within 2 years after graduation 1(ENROLL), attainment of a BA degree (COLLBA), and the
log hourly wage rate, which is measured at about age 25 and adjusted to 2009 dollars.




                                                51
                                             TABLE 1-2
      T HE N UMBER OF I NDIVIDUALS , ZIP C ODES OR B LOCK G ROUPS , S CHOOLS ,         AND
            C OMMUTING Z ONES IN THE S AMPLES ( BY O UTCOME AND DATA S ET )

                              Sample Size     Block Groups     ZIP Codes    Schools   CZs
       NELS specification:
         HSGRAD                      13300               ···        3080        930    300
         ENROLL                      12900               ···        3050        930    300
         COLLBA                      10800               ···        2800        910    300
         LOG WAGE                     8800               ···        2470        880    300
       ELS specification:
         HSGRAD                      14600             9130         4140        700    260
         ENROLL                      13400             8630         3970        700    260
         COLLBA                      12400             8110         3810        700    260
         LOG WAGE                    11600             7720         3670        700    260

   N OTE.—Statistics calculated on respective regression samples based on the “full” specification.
The dependent variables are high school graduation (HSGRAD), enrollment in a 4 year college
within 2 years after graduation (ENROLL), and attainment of a BA degree (COLLBA). The log
hourly wage rate is for about age 25 and adjusted to 2009 dollars. All values are rounded to the
nearest 10.




                                                52
                                                                                        TABLE 2
                             F RACTION OF THE VARIANCE OF E DUCATION AND WAGES AT THE I NDIVIDUAL , N EIGHBORHOOD ,
                                       S CHOOL ,     AND   C OMMUTING Z ONE L EVELS (F ULL S ET OF S TUDENT VARIABLES )

                                                                                A. HS Grad                                  B. College Enroll
                                                                   NELS            ELSbg           ELSz           NELS            ELSbg           ELSz
                                                                    (1)              (2)            (3)            (4)               (5)            (6)
                               Total Individual:         (1)       0.819            0.816          0.856          0.744            0.714          0.710
                                 Var(Yi −Yn )/Var(Yi )          [.775, .85]      [.752, .85]    [.772, .871]   [.709, .768]    [.675, .753]    [.68, .761]
                               Total neighborhood:       (2)       0.013            0.022          0.012          0.013            0.031          0.008
                                 Var(Yn −Ys )/Var(Yi )         [.005, .016]     [.013, .034]    [.008, .017]   [.008, .018]     [.02, .045]   [.004, .012]
                               Total School:             (3)       0.102            0.098          0.093          0.146            0.159          0.174
                                 Var(Ys −Yc )/Var(Yi )         [.071, .132]     [.056, .132]    [.053, .134]   [.125, .172]    [.119, .187] [.131, .196]
                               Total CZ:                 (4)       0.066            0.064          0.039          0.098            0.097          0.107
                                 Var(Yc )/Var(Yi )             [.057, .093]     [.051, .104]    [.046, .098]   [.084, .124]    [.082, .121] [.087, .136]
                                                                              C. College Grad                                 D. Log Wage
                                                                  NELS             ELSbg           ELSz            NELS           ELSbg           ELSz
                                                                   (7)               (8)            (9)             (10)            (11)           (12)
53




                               Total Individual:         (1)      0.791             0.817          0.824           0.886           0.814          0.836
                                 Var(Yi −Yn )/Var(Yi )         [.706, .787]     [.733, .828]    [.767, .844]   [.819, .913] [.736, .836] [.735, .862]
                               Total neighborhood:       (2)      0.010             0.024          0.006           0.007           0.032          0.011
                                 Var(Yn −Ys )/Var(Yi )         [.004, .012]     [.018, .043]    [.004, .012]    [.005, .01]    [.023, .044] [.007, .015]
                               Total School:             (3)      0.120             0.098          0.107           0.031           0.089          0.091
                                 Var(Ys −Yc )/Var(Yi )         [.099, .177]     [.064, .142]    [.069, .142]    [.004, .06]    [.066, .141] [.064, .146]
                               Total CZ:                 (4)      0.079             0.062          0.062           0.076           0.065          0.062
                                 Var(Yc )/Var(Yi )             [.081, .127]      [.059, .09]    [.062, .091]   [.056, .128] [.054, .101] [.054, .123]


         N OTE.—ELSbg represents the ELS data set with the neighborhood specification of block group. ELSz represents the ELS data set with the
     neighborhood specification of ZIP code. This table reports the fractions of the variance of log wage and of the latent variables for high school
     graduation, enrollment at a 4-year college, and a 4-year college degree that is person-specific within a neighborhood (total individual), neighborhood-
     specific within a school (total neighborhood), school-specific within a commuting zone (total school) and commuting-zone-specific (total CZ). They
     are computed using the model estimates reported in Appendix Table B5, which exclude interaction terms and are for the full set of X i variables. The
                                                        X s G S1 , Z S2s G S2 ), which is not reported. The 5th and 95th percentile values of the bootstrap replications
     estimates in Table 2 also involve estimates of cov(X
     are reported in brackets.
                                                                                      TABLE 3
                                    F RACTION OF THE VARIANCE OF X i B AT THE I NDIVIDUAL , N EIGHBORHOOD , S CHOOL ,
                                               AND   C OMMUTING Z ONE L EVELS (F ULL S ET OF S TUDENT VARIABLES )
                                                                                   A. HS Grad                                  B. College Enroll
                                                                      NELS            ELSbg            ELSz          NELS            ELSbg          ELSz
                                                                       (1)              (2)             (3)           (4)               (5)           (6)
                                                 X iB)
                         Individual Share of var(X          (1)       0.703            0.698           0.715         0.645            0.640         0.670
                                                                  [.674, .817]     [.674, .738]    [.689, .756]   [.616, .676]    [.615, .667] [.643, .697]
                                                   X i B)
                         Neighborhood Share of var(X        (2)       0.015            0.023           0.005         0.013            0.035         0.003
                                                                  [.000, .023]     [.005, .043]    [.000, .016]   [.006, .022]    [.015, .053] [.000, .013]
                                             X iB)
                         School Share of var(X              (3)       0.159            0.186           0.187         0.203            0.212         0.212
                                                                  [.114, .175]     [.154, .204]    [.155, .206]   [.175, .222]    [.187, .233] [.187, .233]
                                         X i B)
                         CZ Share of var(X                  (4)       0.123            0.092           0.093         0.138            0.114         0.114
                                                                  [.082, .149]      [.08, .109]     [.08, .109]   [.115, .167]    [.102, .133] [.103, .135]
                         X i B Share of Var(Yi )            (5)       0.243            0.229           0.237         0.369            0.409         0.397
                                                                   [.223, .36]     [.215, .265]    [.213, .269]   [.345, .395]    [.378, .453] [.377, .442]
                                                                                 C. College Grad                                 D. Log Wage
54




                                                                      NELS            ELSbg           ELSz           NELS            ELSbg          ELSz
                                                                       (7)              (8)            (9)            (10)             (11)          (12)
                                                 X iB)
                         Individual Share of var(X          (1)       0.614            0.633          0.664          0.727            0.665         0.700
                                                                   [.59, .641]     [.595, .663]    [.631, .691]   [.695, .779] [.629, .704] [.666, .738]
                                                   X iB)
                         Neighborhood Share of var(X        (2)       0.009            0.036          0.002          0.007            0.046         0.011
                                                                  [.001, .017]     [.012, .058]    [.000, .012]   [.000, .017] [.024, .066] [.000, .021]
                                             X iB)
                         School Share of var(X              (3)       0.229            0.217          0.218          0.161            0.191         0.190
                                                                  [.206, .243]     [.186, .242]    [.191, .243]   [.121, .181] [.159, .213] [.159, .213]
                                         X iB)
                         CZ Share of var(X                  (4)       0.148            0.114          0.116          0.105            0.098         0.099
                                                                  [.127, .177]     [.098, .134]    [.101, .136]   [.086, .125]     [.08, .119]   [.081, .118]
                         X i B Share of Var(Yi )            (5)       0.325            0.386          0.388          0.139            0.232         0.234
                                                                  [.375, .445]     [.345, .415]    [.354, .425]   [.124, .177] [.211, .272] [.222, .275]

         N OTE.—ELSbg represents the ELS data set with the neighborhood specification of block group. ELSz represents the ELS data set with the
     neighborhood specification of ZIP code. The rows of Table 3 report the fractions of the variance of X i B that is within a neighborhood (individual
     share), neighborhood-specific within a school (neighborhood share), school-specific within a commuting zone (school share), and commuting-zone-
     specific (CZ share). X i B is the index of student characteristics that affect the outcome indicated in the column headings. B is estimated separately for
     each outcome and sample as part of the estimation of models without interaction terms reported in Appendix Table B5. The results are for the full set
     of X i variables. The 5th and 95th percentile values of the bootstrap replications are reported in brackets.
                                                        TABLE 4
                              E STIMATES OF THE E DUCATION AND WAGE P ROBIT
                        M ODEL PARAMETERS (F ULL S ET OF S TUDENT VARIABLES )

                                           A. High School Graduation                          B. College Enrollment
                                  NELS        ELSbg        ELSz         N+E        NELS        ELSbg        ELSz        N+E
                                   (1)          (2)         (3)          (4)        (5)          (6)          (7)        (8)
Variables:
     X iB)
  sd(X                          0.619***     0.588***    0.580***      0.600***   0.856***    0.946***    0.945***    0.901***
                                  (.072)       (.028)      (.025)        (.038)     (.026)      (.025)       (.03)        (.02)
     X 1n G N
  sd(X      1)                    0.000        0.000     0.100**        0.050*       0.000    0.060*         0.000        0.000
                                  (.044)       (.044)      (.034)        (.028)     (.032)      (.031)      (.034)       (.023)
     X 1s G S1 )
  sd(X                          0.162***     0.148***    0.117***      0.140***   0.155***    0.173***    0.186***    0.171***
                                  (.041)       (.038)      (.032)        (.026)     (.034)      (.028)      (.033)       (.024)
     Z S2s G S2 )
  sd(Z                          0.096***     0.101**     0.113***      0.105***   0.123***    0.088***    0.117***    0.120***
                                  (.036)        (.04)      (.031)        (.024)     (.029)      (.029)      (.031)       (.021)
     Z C2c GC2 )
  sd(Z                          0.134***     0.132***    0.111***      0.123***   0.165***    0.121***    0.136***     0.151***
                                  (.042)       (.035)      (.032)        (.026)     (.027)      (.031)      (.032)       (.021)
  X i B x X 1n G N   N
                 1 (r1 )         -0.025        0.024     0.040*          0.008      -0.028      -0.030      -0.049       -0.038
                                  (.035)       (.033)      (.023)        (.021)     (.035)       (.03)      (.031)       (.024)
  X i B x X 1s G S1 (r1S )        0.031        0.012       0.018         0.025    0.054**       -0.036      -0.028       0.013
                                  (.033)       (.028)      (.028)        (.022)     (.024)      (.035)      (.035)       (.021)
  X i B x Z S2s G S2 (r21
                       S )       -0.007       -0.008      -0.015        -0.011    -0.069**      -0.017      -0.028     -0.048**
                                  (.036)       (.034)      (.033)        (.024)     (.034)      (.033)      (.032)       (.023)
  X i B x Z C2c GC2 (rC
                      21 )        0.014        0.008      -0.014         0.000      -0.010       0.023      0.017         0.004
                                  (.025)       (.029)      (.029)        (.019)     (.027)      (.026)      (.025)       (.018)
  Female x Z S2s G S2 (r22
                        S )       0.013       -0.063      -0.070        -0.028      -0.012      -0.020      -0.010       -0.011
                                  (.043)       (.054)      (.054)        (.035)     (.031)      (.029)       (.03)       (.022)
  Minority x Z S2s G S2 (r23
                          S )    -0.075      0.122**     0.125**         0.025       0.041      -0.058      -0.052       -0.005
                                  (.047)       (.055)      (.053)        (.035)      (.05)      (.041)      (.038)       (.031)
  LowInc x Z S2s G S2 (r24
                        S )       0.055        0.028       0.007         0.031      -0.013      0.048        0.054       0.020
                                  (.054)        (.06)      (.064)        (.042)     (.051)       (.04)      (.039)       (.032)
  Female x Z C2c GC2 (rC
                       22 )      -0.012       -0.010       0.038         0.013      -0.041      -0.035      -0.039      -0.040*
                                  (.039)       (.042)      (.042)        (.029)     (.029)       (.03)      (.032)       (.021)
  Minority x Z C2c GC2 (rC
                         23 )     0.060        0.008       0.009         0.034      -0.024       0.070       0.054       0.015
                                  (.062)        (.06)      (.062)        (.044)     (.042)      (.043)       (.04)       (.029)
  LowInc x Z C2c GC2 (rC
                       24 )      -0.015       -0.046      -0.042        -0.028    -0.079***      0.019       0.050       -0.015
                                  (.046)       (.044)      (.043)        (.031)      (.03)      (.049)      (.048)       (.028)
  (Intercept)                   1.337***     1.794***    1.778***      1.557***   -0.640***   -0.279***   -0.279***   -0.459***
                                  (.037)       (.046)      (.046)        (.029)     (.043)      (.038)      (.039)       (.029)
Random effects:
  sd(vn − vs )                  0.123***     0.181***    0.134***      0.128***   0.122***    0.158***    0.111***    0.117***
                                  (.017)        (.03)      (.017)        (.012)     (.018)       (.03)      (.018)      (.013)
  sd(vs − vc )                  0.083***     0.118***    0.097***      0.090***   0.142***    0.146***    0.147***    0.145***
                                  (.013)       (.017)      (.016)         (.01)     (.021)      (.027)      (.022)      (.015)
  sd(vc )                       0.060***     0.057***    0.059***      0.059***   0.046***    0.104***    0.101***    0.073***
                                  (.011)       (.012)      (.011)        (.008)      (.01)       (.03)      (.028)      (.015)




                                                          55
                                                TABLE 4,    CONT ’ D
                               E STIMATES OF THE E DUCATION AND WAGE P ROBIT
                         M ODEL PARAMETERS (F ULL S ET OF S TUDENT VARIABLES )

                                             C. College Graduation                                D. Log Wage
                                   NELS       ELSbg        ELSz          N+E        NELS       ELSbg      ELSz       N+E
                                    (9)        (10)         (11)         (12)        (13)       (14)       (15)      (16)
 Variables:
      X iB)
   sd(X                          0.890***    0.835***    0.839***       0.864***   0.134***   0.163***   0.163***   0.148***
                                   (.027)      (.026)      (.027)         (.019)     (.007)     (.006)     (.006)     (.005)
      X 1n G N
   sd(X      1)                     0.040    0.095***       0.048        0.044*    0.042***     0.015    0.032**    0.037***
                                   (.042)      (.028)      (.032)         (.026)     (.014)     (.011)     (.015)      (.01)
      X 1s G S1 )
   sd(X                          0.139***    0.072***    0.071**       0.105***    0.055***   0.037***   0.029***   0.042***
                                   (.035)      (.027)      (.028)         (.022)     (.012)     (.009)      (.01)     (.008)
      Z S2s G S2 )
   sd(Z                          0.088***    0.073***    0.074***      0.081***       0.017     0.012      0.018     0.018*
                                    (.03)      (.024)      (.026)          (.02)     (.013)     (.011)     (.012)     (.009)
      Z C2c GC2 )
   sd(Z                          0.062**     0.091***    0.073***      0.067***    0.037***   0.028***   0.027**    0.032***
                                   (.026)      (.026)      (.026)         (.018)      (.01)      (.01)     (.011)     (.007)
   X i B x X 1n G N   N
                  1 (r1 )        -0.070*     -0.079***   -0.068*        -0.069**     -0.016     0.005      0.003     -0.006
                                    (.04)      (.026)       (.04)         (.028)      (.01)     (.007)     (.007)     (.006)
   X i B x X 1s G S1 (r1S )      0.060**       -0.023      -0.021         0.019      -0.004     0.000     -0.002     -0.003
                                   (.027)      (.028)      (.029)          (.02)     (.009)     (.008)     (.008)     (.006)
   X i B x Z S2s G S2 (r21
                        S )        -0.042    -0.073**    -0.075**       -0.059**      0.006     0.002      0.002      0.004
                                   (.034)      (.033)      (.033)         (.024)     (.008)     (.006)     (.007)     (.005)
   X i B x Z C2c GC2 (rC
                       21 )      0.058*        -0.013      -0.025         0.016    -0.017*      0.002      0.003     -0.007
                                    (.03)       (.03)      (.038)         (.024)      (.01)     (.007)     (.007)     (.006)
   Female x Z S2s G S2 (r22
                         S )       -0.043       0.032       0.034        -0.004       0.009     0.003     -0.004      0.002
                                   (.039)       (.03)       (.03)         (.024)     (.014)     (.015)     (.014)      (.01)
   Minority x Z S2s G S2 (r23
                           S )     -0.020       0.028       0.021         0.001      -0.024     0.005      0.001     -0.011
                                    (.05)      (.046)      (.044)         (.033)     (.016)     (.012)     (.012)      (.01)
   LowInc x Z S2s G S2 (r24
                         S )       -0.001       0.056       0.031         0.015       0.007    -0.003     -0.005      0.001
                                   (.046)      (.061)      (.058)         (.037)     (.015)     (.013)     (.014)      (.01)
   Female x Z C2c GC2 (rC
                        22 )       -0.033       0.006      0.017         -0.008       0.017     0.026      0.020      0.018
                                   (.032)       (.03)      (.031)         (.023)     (.016)     (.016)     (.017)     (.011)
   Minority x Z C2c GC2 (rC
                          23 )     -0.034       0.002      -0.005        -0.020      -0.026    -0.002      0.004     -0.011
                                   (.046)      (.049)      (.049)         (.034)      (.02)     (.013)     (.013)     (.012)
   LowInc x Z C2c GC2 (rC
                        24 )       -0.040    0.118**     0.107*           0.033       0.020     0.016      0.011      0.016
                                   (.051)      (.049)      (.056)         (.038)     (.015)     (.012)     (.013)      (.01)
   (Intercept)                   -0.525***   -0.426***   -0.432***     -0.478***   2.545***   2.664***   2.666***   2.606***
                                   (.042)      (.035)      (.036)         (.028)     (.008)     (.009)     (.009)     (.006)
 Random effects:
   sd(vi )                                                                         0.318***   0.274***   0.278***   0.298***
                                                                                     (.007)     (.008)     (.009)     (.006)
   sd(vn − vs )                  0.096***    0.153***    0.103***      0.099***    0.029***   0.049***   0.031***   0.030***
                                   (.012)      (.023)      (.014)        (.009)      (.004)     (.006)     (.004)     (.003)
   sd(vs − vc )                  0.070***    0.065***    0.059***      0.064***    0.021***   0.020***   0.020***   0.020***
                                   (.008)       (.01)      (.009)        (.006)      (.003)     (.002)     (.002)     (.002)
   sd(vc )                       0.025***    0.042***    0.039***      0.032***    0.014***   0.011***   0.013***   0.013***
                                   (.005)      (.006)      (.006)        (.004)      (.002)     (.002)     (.002)     (.001)


    N OTE.—Bootstrap standard errors are in parentheses. The dependent variables are high school
graduation (HSGRAD) in Panel A, enrollment in a 4 year college within 2 years after expected high
school graduation (ENROLL) in Panel B, attainment of a BA degree (COLLBA) in Panel C and
the log hourly wage rate at about age 25 in Panel D. Panels A, B, and C refer to the latent index of
an MME probit specification. Panel D is based on an MME regression specification. The model is


                                                         56
equation (23). The column heading NELS refers to the NELS data. ELSbg represents the ELS data
set with the neighborhood specification of block group. ELSz represents the ELS data set with the
neighborhood specification of ZIP code. Column 4 (8) report the average and standard error of the
average of the NELS and ELSz estimates in columns 1 and 3 (5 and 7). The parameter vectors B ,
G N1 , G S1 , G S2 , and GC2 that define the explanatory index variables X i B , X 1n G N1 , Z S2s G S2 and Z C2c GC2 are
estimated in a first step. The first 4 rows report the estimated standard deviations of these indices.
The model includes the “full” set of X i variables (student level) and the corresponding “full” set
of X s variables (school means). See Appendix A1 for a list of X i , X 1n , X s , Z S2s ,and Z C2c variables
and Appendix table B2 for summary statistics. The index variables in the interaction terms are
standardized to be mean 0 and sd 1. Standard deviation of vi is 1 in probit specifications. Names
of interaction coefficients are next to the variables. See Section 6.2 for details about the estimation
and bootstrap standard error procedures.
* p < 0.1
** p < 0.05
*** p < 0.01




                                                          57
                                             TABLE 5
           S AMPLE AVERAGES OF THE T REATMENT E FFECTS ON E DUCATION AND
          WAGES OF A 10 TH    TO   90 TH P ERCENTILE S HIFT IN S CHOOL Q UALITY AND
                          C OMMUTING Z ONE Q UALITY (F ULL S AMPLE )

                                     A. HS Grad             B. College Enrollment
                              NELS ELSbg ELSz              NELS ELSbg ELSz
                School+CZ     0.088     0.062 0.060        0.171     0.173 0.183
                              (.014)    (.011) (.011)      (.018)    (.019) (.019)
                School only   0.060     0.045 0.043        0.125     0.120 0.133
                              (.014)      (.01) (.011)     (.017)    (.019) (.019)
                CZ only       0.067     0.041 0.037        0.114     0.112 0.118
                              (.017)    (.009)    (.01)    (.017)    (.022) (.021)
                                  C. College Grad                D. Log Wage
                              NELS ELSbg ELSz              NELS ELSbg ELSz
                School+CZ     0.085     0.090 0.083        0.111     0.104 0.103
                              (.016)    (.012) (.015)      (.025)    (.024) (.027)
                School only   0.077     0.071 0.068        0.069     0.060 0.069
                              (.018)    (.015) (.016)      (.027)    (.023) (.024)
                CZ only       0.046     0.073 0.060        0.102     0.078 0.075
                              (.019)    (.017) (.016)      (.024)    (.024) (.026)


    N OTE.—The row School+Cz reports the average effect of moving students from a school and
commuting zone at the 10th percentile of the distribution of the sum of school and commuting zone
quality to the 90th percentile value. The row School only (CZ only) reports the average effect of
a shift from the 10th percentile of school (commuting zone) quality to the 90th . The estimates are
based on the model estimates in Table 4, which are for the full set of X i variables. See Section
6.4 and Online Appendix B3.3 for the details of the treatment effect calculations. Column heading
indicate the outcome, the data set, and whether the neighborhood definition is block group or ZIP
code. ELSbg represents the ELS data set with the neighborhood specification of block group. ELSz
represents the ELS data set with the neighborhood specification of ZIP code. Bootstrap standard
errors are in parentheses.




                                                 58
                                                           TABLE 6
                   T HE T REATMENT E FFECTS ON E DUCATION AND WAGES OF A
           10 TH   TO   90 TH P ERCENTILE S HIFT IN S CHOOL Q UALITY AND C OMMUTING
                   Z ONE Q UALITY,          BY   P OPULATION S UBGROUP (F ULL S AMPLE )

                                      A. HS Grad                                           B. College Enrollment
                                            sg mother,        both par                                 sg mother,    both par
               white      black    Hispanic                                 white    black Hispanic
                                            hs deg            wh, col deg                              hs deg        wh, col deg
 i. NELS / ZIP Code:
     Sch+CZ 0.086         0.095    0.113          0.140           0.040     0.177    0.167    0.138       0.116         0.213
                (.013)    (.017)   (.019)         (.021)          (.007)    (.018)   (.018)   (.017)      (.014)         (.02)
     Sch only 0.058       0.066    0.077          0.093           0.027     0.129    0.121    0.101       0.086         0.154
                (.014)    (.016)    (.02)         (.022)          (.007)    (.017)   (.018)   (.015)      (.013)        (.018)
     CZ only 0.066        0.071    0.085          0.106           0.031     0.118    0.110    0.091       0.075         0.142
                (.017)    (.019)   (.021)         (.027)          (.007)    (.017)   (.017)   (.016)      (.012)         (.02)
 ii. ELS / Block Group:
     Sch+CZ 0.053         0.076    0.087          0.094           0.021     0.183    0.166    0.145       0.158         0.184
                 (.01)    (.015)   (.015)         (.015)          (.004)     (.02)   (.019)   (.017)      (.021)        (.019)
     Sch only 0.039       0.056    0.062          0.067           0.016     0.127    0.115    0.101       0.112         0.127
                (.009)    (.013)   (.014)         (.014)          (.004)     (.02)   (.019)   (.017)      (.021)        (.018)
     CZ only 0.035        0.050    0.058          0.062           0.014     0.118    0.106    0.093       0.103         0.120
                (.008)    (.013)   (.013)         (.011)          (.003)    (.023)   (.021)   (.019)      (.022)        (.021)
 iii. ELS / ZIP Code:
     Sch+CZ 0.051         0.074     0.083       0.089             0.020     0.193    0.177     0.153       0.167        0.194
                 (.01)    (.015)   (.015)       (.015)            (.004)     (.02)   (.019)   (.017)        (.02)       (.019)
     Sch only 0.043       0.037     0.054       0.060             0.065     0.140    0.129     0.111       0.120        0.139
                 (.01)    (.014)   (.015)       (.015)            (.004)     (.02)   (.019)   (.017)        (.02)       (.017)
     CZ only 0.031        0.045     0.052       0.055             0.013     0.125    0.112     0.097       0.106        0.126
                (.009)    (.014)   (.015)       (.013)            (.004)    (.022)    (.02)   (.018)       (.022)       (.021)
                                    C. College Grad                                              D. Log Wage
                                             sg mother,       both par                                  sg mother,   both par
               white      black    Hispanic                                 white    black    Hispanic
                                             hs deg           wh, col deg                               hs deg       wh, col deg
 i. NELS / ZIP Code:
     Sch+CZ 0.090         0.074    0.067          0.056           0.101     0.111    0.112    0.111       0.111         0.110
                (.017)    (.015)   (.014)         (.011)          (.018)    (.025)   (.026)   (.025)      (.026)        (.025)
     Sch only 0.081       0.067    0.061          0.051           0.090     0.069    0.068    0.069       0.067         0.069
                (.018)    (.016)   (.015)         (.012)          (.019)    (.027)   (.027)   (.027)      (.027)        (.027)
     CZ only 0.049        0.039    0.036          0.029           0.056     0.102    0.104    0.102       0.104         0.101
                 (.02)    (.017)   (.015)         (.012)          (.023)    (.024)   (.025)   (.024)      (.025)        (.023)
 ii. ELS / Block Group:
     Sch+CZ 0.097         0.077    0.072          0.082           0.102     0.104    0.105    0.105       0.101         0.104
                (.013)    (.011)   (.011)         (.013)          (.013)    (.024)   (.024)   (.024)      (.024)        (.024)
     Sch only 0.076       0.061    0.058          0.063           0.078     0.060    0.060    0.060       0.061         0.061
                (.016)    (.014)   (.013)         (.016)          (.015)    (.023)   (.023)   (.023)      (.023)        (.023)
     CZ only 0.079        0.062    0.057          0.065           0.083     0.078    0.078    0.078       0.079         0.078
                (.018)    (.014)   (.013)         (.017)          (.018)    (.024)   (.024)   (.024)      (.024)        (.024)
 iii. ELS / ZIP Code:
     Sch+CZ 0.090         0.072    0.067          0.074           0.094     0.103    0.102    0.103       0.103         0.103
                (.016)    (.013)   (.013)         (.016)          (.015)    (.027)   (.027)   (.027)      (.027)        (.027)
     Sch only 0.073       0.059    0.055          0.061           0.076     0.069    0.069    0.068       0.067         0.069
                (.017)    (.015)   (.014)         (.017)          (.015)    (.024)   (.024)   (.024)      (.024)        (.024)
     CZ only 0.065        0.051    0.048          0.055           0.069     0.075    0.076    0.076       0.075         0.076
                (.017)    (.014)   (.013)         (.017)          (.017)    (.026)   (.026)   (.026)      (.026)        (.026)


   N OTE.—The row Sch+CZ reports the average effect of moving students from a school and
commuting zone at the 10th percentile of the distribution of the sum of school and commuting zone


                                                             59
quality to the 90th percentile value. The row Sch Only (CZ Only) reports the average effect of a
shift from the 10th percentile of school (commuting zone) quality to the 90th . The estimates are
based on the model estimates in Table 4, which are for the full set of X i variables. See Section 6.4
and Online Appendix B3.3 for the details of the treatment effect calculations. The panel headings
indicate the outcome, the data set and whether the neighborhood definition is block group or ZIP
code. The column heading identify the subgroup. “white” are white non-Hispanic students. “black”
and “Hispanic” are non-Hispanic black and Hispanic students. “sg mother, hs deg” are students with
a single mother who has a high school degree or less. “both par wh, col deg” are white students
with two resident parents with college degrees. Bootstrap standard errors are in parentheses.




                                                 60
                  1

                 0.9

                 0.8

                 0.7

   Probability   0.6

                 0.5

                 0.4
                 0.3

                 0.2
                 0.1

                  0
                          5   10   15   20   25   30   35     40     45     50      55   60   65    70      75   80   85   90   95
                                                            Percentile Value of Xi B
                                                   HSGRAD                  ENROLL             COLLBA

    F IG . 1A.—The probability of high school graduation, college enrollment, and BA degree attain-
ment by percentile of X i B at the median value of school and commuting zone quality in NELS. The
figure displays the average predicted value for the NELS grade 8 sample from the probit function
evaluated at the indicated quantile of the X i B index with school and commuting zone contribu-
tions set to the median value. The average is taken over neighborhood and unobserved individual
contributions, as well as the control function, which represents a mix of school contributions and
school-means of individual contributions. See Section 6 for details about the estimating equation.

                      1

                  0.9

                  0.8

                  0.7

                  0.6
   Probability




                  0.5

                  0.4

                  0.3

                  0.2
                  0.1

                      0
                          5   10   15   20   25   30   35     40      45     50     55   60    65      70   75   80   85   90   95
                                                                   Percentile Value of Xi B
                                                       HSGRAD                   ENROLL         COLLBA

    F IG . 1B.—The probability of high school graduation, college enrollment, and BA degree attain-
ment by percentile of X i B at the median value of school and commuting zone quality in ELS. The
figure displays the average predicted value for the ELS block group sample from the probit function
evaluated at the indicated quantile of the X i B index with school and commuting zone contribu-
tions set to the median value. The average is taken over neighborhood and unobserved individual
contributions, as well as the control function, which represents a mix of school contributions and
school-means of individual contributions. See Section 6 for details about the estimating equation.




                                                                           61
                  0.2

                 0.18

                 0.16

                 0.14

   Probability   0.12

                  0.1

                 0.08

                 0.06

                 0.04
                 0.02

                   0
                        5   10   15   20   25   30    35     40    45     50    55      60   65      70    75     80   85   90   95
                                                             Percentile Value of Xi B
                                           ELS block group              ELS zip code              NELS zip code

    F IG . 2.—Treatment effect on high school graduation of a 10th to 90th percentile shift in school
quality + commuting zone quality, by percentile of X i B index. The figure displays the average
predicted change in the probability of high school graduation for a student at the indicated quantile
of the X i B index from growing up in combined school/commuting zone environment at the 90th
quantile of quality versus the 10th quantile of combined school/commuting zone quality. See Section
6.4 for details about how these values are calculated. The three lines display average predicted
changes in probability for students in the NELS grade 8 sample, the ELS sample with ZIP codes
designating neighborhoods, and the ELS sample with block groups designating neighborhoods.




                                                                        62
                  0.3


                 0.25


                  0.2
   Probability
                 0.15


                  0.1


                 0.05


                   0
                        5   10   15   20   25   30    35      40   45     50    55     60   65   70   75     80   85   90   95
                                                               Percentile Value of Xi B
                                            ELS block group             ELS zip code         NELS zip code

    F IG . 3.—Treatment effect on college enrollment of a 10th to 90th percentile shift in school qual-
ity + commuting zone quality, by percentile of X i B index. The figure displays the average predicted
change in the probability of enrollment at a four-year college for a student at the indicated quantile
of the X i B index from growing up in combined school/commuting zone environment at the 90th
quantile of quality versus the 10th quantile of combined school/commuting zone quality. See Sec-
tion 6.4 for details about how these values are calculated. The three lines display average predicted
changes in probability for students in the NELS grade 8 sample, the ELS sample with ZIP codes
designating neighborhoods, and the ELS sample with block groups designating neighborhoods.




                                                                        63
                 0.14

                 0.12

                  0.1

   Probability   0.08

                 0.06

                 0.04

                 0.02

                   0
                        5   10   15   20   25   30    35      40   45     50    55     60   65      70    75     80   85   90   95
                                                               Percentile Value of XiB
                                            ELS block group             ELS zip code             NELS zip code

     F IG . 4.—Treatment effect on college BA of a 10th to 90th percentile shift in school quality
+ commuting zone quality, by percentile of X i B index. The figure display the average predicted
change in the probability of graduation from a four-year college for a student at the indicated quan-
tile of the X i B index from growing up in combined school/commuting zone environment at the 90th
quantile of quality versus the 10th quantile of combined school/commuting zone quality. See Sec-
tion 6.4 for details about how these values are calculated. The three lines display average predicted
changes in probability for students in the NELS grade 8 sample, the ELS sample with ZIP codes
designating neighborhoods, and the ELS sample with block groups designating neighborhoods.




                                                                        64
   Appendices


A1     List of Variables
   Student Characteristics (included in X i ): 1(Female), 1(Non-Hispanic black), 1(Hispanic),
1(Asian), and 1(White) (excluded) and 1(Other Race) (ELS only), 1(Immigrant), 1(Native English
Speaker) and 1(Athletic). In addition, the full model includes Math score, Reading score, Weekly
homework hours, 1(Parent checks homework), Hours/per week spent reading, 1(Attends class with-
out a pencil) and 1(Fought in school).


   Parent and Family Characteristics (included in X i ): SES Index, Number of siblings, 1(Does
not live with both mother and father), Father’s years education, Mother’s years education, 1(Mother’s
education missing), Ln(family income), 1(Mother or father is an immigrant), religion dummies
(1(Catholic), 1(Other Christian), 1(Other Religion), 1(Religion Missing), where 1(Protestant) is ex-
cluded); mother’s occupation dummies (1(Clerical), 1(Manager/accountant/nurse/business owner/teacher),
1(Sales or service), 1(Other or homemaker), 1(Missing)), father’s occupation dummies (1(Accoun-
tant/ nurse/teacher/manager/dentist/lawyer/business owner), 1(Military/security/craftsman/technician),
1(Service/ clerical/sales/missing/other/homemaker), 1(Farmer, laborer, operative)), Home environ-
ment index (first principal component), Parental school engagement index (first principal compo-
nent), Parent’s years of education desired for child.


   Neighborhood Characteristics (included in X n variables):.NELS and ELS ZIP code speci-
fication: % Black, % Hispanic, % Non-married households, % Foreign born, % Some college or
associate degree, % Four-year college degree or higher, Log(median income), Gini coefficient (ELS
only), % SSI or welfare recipients, Log(median house value) (ELS only), and % Housing properties
occupied (ELS only). ELS block group specification: Proportion of jobs in agriculture, mining, oil,
utility, construction, or manufacturing, Proportion of jobs in information, finance, insurance, real
estate, professional, or science, Proportion of jobs in management, administration, waste manage-
ment, Proportion of jobs in education, other services and public administration, and Proportion of
jobs in transportation and warehousing. They also include % Black, % Hispanic, % Other, % Non-
married households, % Foreign born, % Some college or associate degree, % Four-year college
degree or higher, Log(median income), Gini coefficient, % SSI or welfare recipients, Log(median
house value) and % Housing properties occupied.


   School Characteristics (included in X s ): % Minority, % Limited English proficient, % Free/reduced
lunch. The full specification also includes % Special ed, % Remedial reading and % Remedial math.




                                                  65
   School Characteristics (included in Z S2s ): Variables common to both ELS and NELS: 1(Catholic
school), 1(Private school), School enrollment, Student-teacher ratio, % Minority teachers, and
school security policies indices (first and second principal components).
   In addition, the ELS specification also includes Teacher turnover rate, % Teachers with certi-
fication, Teacher evaluation policy index (first principal component), Teacher incentive pay index
(first principal component), Teacher technology access index (first principal component), School
physical environment index (first principal component), administrator’s reported school facilities
index (first principal component), 1(Rural, not in MSA), 1(Rural, in MSA), 1(town), 1(Suburb of
medium city), 1(Medium city), (Large city), and School administrator’s assessment of crime in the
school neighborhood.
   In addition, the NELS specification includes % Teachers with a masters degree, 1(Collective
bargaining), Log(minimum teacher salary), 1(Urban), 1(Suburban), 1(Gifted program), Junior High
(JH) school minutes per year, JH course assignment index (first principal component), JH student
retainment policy index (first principal component), JH student activities index (first principal com-
ponent), JH school environment index (first principal component), JH movement in school policy
index (first principal component), JH counseling policy index, JH school uniform policy index, JH
student problems index (first principal component), and JH student punishment policy index (first
principal component).


   Commuting Zone Characteristics (included in Z C2c ): Household income per capita, Theil
racial segregation index, Log population density, % Black, Income segregation index, Social capital
index, Poverty rate, Unemployment rate, Fraction of Children with Single Mothers, Gini coefficient,
HS dropout rate (income adjusted), College graduate rate (income adjusted), Number of Colleges
per Capita, Chetty-Hendren estimate of commuting zone causal effect on college attendance from
age 18-23, Chetty-Hendren commuting zone causal effect on rank in national income distribution
at age 26, 1(Northeast region), 1(Midwest region) and 1(West region).




                                                 66
                                                                      TABLE A1
           K EY S CHOOL AND C OMMUTING Z ONE VARIANCE C OMPONENTS OF 10-90 T REATMENT E FFECTS
                       OF   S CHOOL AND C OMMUTING Z ONE Q UALITY (F ULL , I NTERACTED S PECIFICATION )

                                                                   A. HS Grad                                      B. College Enroll
                                                      NELS            ELSbg           ELSz            NELS              ELSbg             ELSz
                                                       (1)             (2)             (3)             (4)                (5)              (6)
     Panel A:
           Z S2s G S2 )
       Var(Z                                 (1)        0.006          0.007           0.009           0.008              0.004            0.006
                                                    [.003, .022]    [.009, .041]   [.010, .044]     [.004, .014]      [.002, .011]      [.003, .014]
            Z C2c GC2 )
        Var(Z                                (2)       0.011           0.011           0.008           0.014              0.007            0.008
                                                    [.006, .032]    [.006, .028]   [.004, .027]     [.010, .026]      [.004, .017]      [.004, .017]
              Z S2s G S2 , Z C2c GC2 )
        2*Cov(Z                              (3)       -0.002          0.001           0.003           0.000              0.003            0.002
                                                   [-.014, .003]   [-.009, .007]    [-.008, .01]   [-.009, .005]     [-.004, .005]     [-.007, .004]
        Var(vs -vc )                         (4)       0.004           0.009           0.006           0.010              0.010            0.010
                                                    [.002, .006]    [.003, .009]   [.003, .009]     [.002, .008]        [.002, .01]     [.002, .008]
        Var(vc )                             (5)       0.002           0.002           0.002           0.001              0.005            0.004
                                                    [.001, .003]    [.001, .003]   [.001, .004]     [.000, .002]      [.001, .008]      [.001, .007]
67




     Panel B:
       School and CZ:                        (6)      0.022            0.030           0.029          0.033              0.028             0.030
           Z S2s G S2 +Z
       Var(Z           Z C2c GC2 +vs +vc )         [.017, .045]    [.026, .069]      [.025, .07]   [.021, .042]       [.015, .035]     [.015, .034]
                                             (7)      0.010            0.016           0.015          0.018              0.013             0.016
                         Z S2s GS2 + vs )
        School only: Var(Z
                                                   [.006, .026]    [.014, .047]    [.014, .051]    [.007, .019]       [.005, .018]     [.006, .018]
                                             (8)      0.014            0.013           0.011          0.015              0.012             0.013
                     Z C2c GC2 + vc )
        CZ only: Var(Z
                                                   [.007, .034]      [.008, .03]   [.006, .028]    [.011, .027]       [.006, .021]       [.006, .02]
