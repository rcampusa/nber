                               NBER WORKING PAPER SERIES




 INCENTIVE CONSTRAINED RISK SHARING, SEGMENTATION, AND ASSET PRICING

                                           Bruno Biais
                                         Johan Hombert
                                       Pierre-Olivier Weill

                                       Working Paper 23986
                               http://www.nber.org/papers/w23986


                     NATIONAL BUREAU OF ECONOMIC RESEARCH
                              1050 Massachusetts Avenue
                                Cambridge, MA 02138
                                   November 2017


We’d like to thank, for fruitful comments and suggestions, Andrea Attar, Andy Atkeson, Saki
Bigio, Jason Donaldson, James Dow, Ana Fostel, Valentin Haddad, Thomas Mariotti, Ed Nosal,
Bruno Sultanum, Venky Venkateswaran, and Bill Zame as well as seminar participant at the
AQR conference at the LBS, the Banque de France Workshop on Liquidity and Markets, the
Finance Theory Group conference at the LSE, the Gerzensee Study Center, MIT, Washington
University in St. Louis Olin Business School, the LAEF conference on Information in Financial
Markets, EIEF, University of Geneva, and University of Virginia, Princeton University, Penn
State, Cornell, University of British Columbia, Simon Fraser University, Federal Reserve Bank of
New York, Imperial College, UCL, the 8th Summer Macro-Finance Workshop in Sciences Po,
the Federal Reserve Board and the Federal Reserve Bank of Minneapolis. We thank the Bank of
France and Institut Europlace de Finance for financial support. The views expressed herein are
those of the authors and do not necessarily reflect the views of the National Bureau of Economic
Research.

At least one co-author has disclosed a financial relationship of potential relevance for this
research. Further information is available online at http://www.nber.org/papers/w23986.ack

NBER working papers are circulated for discussion and comment purposes. They have not been
peer-reviewed or been subject to the review by the NBER Board of Directors that accompanies
official NBER publications.

© 2017 by Bruno Biais, Johan Hombert, and Pierre-Olivier Weill. All rights reserved. Short
sections of text, not to exceed two paragraphs, may be quoted without explicit permission
provided that full credit, including © notice, is given to the source.
Incentive Constrained Risk Sharing, Segmentation, and Asset Pricing
Bruno Biais, Johan Hombert, and Pierre-Olivier Weill
NBER Working Paper No. 23986
November 2017
JEL No. D5,G12

                                         ABSTRACT

Incentive problems make assets imperfectly pledgeable. Introducing these problems in an
otherwise canonical general equilibrium model yields a rich set of implications. Asset markets are
endogenously segmented. There is a basis going always in the same direction, as the price of any
risky asset is lower than that of the replicating portfolio of Arrow securities. Equilibrium
expected returns are concave in consumption betas, in line with empirical findings. As the
dispersion of consumption betas of the risky assets increases, incentive constraints are relaxed
and the basis reduced. When hit by adverse shocks, relatively risk tolerant agents sell the safest
assets they hold.

Bruno Biais                                                Pierre-Olivier Weill
Toulouse School of Economics (CNRS, IDEI)                  Department of Economics
Manufacture des Tabacs                                     University of California, Los Angeles
21, allée de Brienne                                       Bunche Hall 8283
31000 TOULOUSE                                             Los Angeles, CA 90095
FRANCE                                                     and NBER
bruno.biais@univ-tlse1.fr                                  poweill@econ.ucla.edu

Johan Hombert
HEC Paris
1 rue de la Liberation
78351 Jouy en Josas
France
hombert@hec.fr
1     Introduction

Financial markets allow agents to share risk by trading contingent claims, such as futures, options or Credit

Default Swaps. These contingent claims are promises to make payments in the future, if some states occur.

To deliver on these promises, agents must have assets generating resources they can use to pay counterparties.

We refer to these promise-backing assets as collateral. This is a broad definition of collateral, encompassing

securities and real assets.

    Collateral, however, is imperfectly pledgeable, due to direct and indirect bankruptcy costs. Direct costs

arise because when an agent defaults it is costly and difficult for creditors to seize his assets. Similarly to

Kiyotaki and Moore (1997) and Kiyotaki (1998), this enables debtors to renegotiate liabilities ex post down

to the collateral value minus bankruptcy costs. Ex-ante, this sets a limit to what can be credibly pledged,

making collateral imperfectly pledgeable. Indirect costs arise because, when an agent is financially distressed,

he no longer has the incentives to maintain the value of his assets. Incentive compatibility constraints

reflecting moral hazard and cash diversion problems thus limit pledgeability, as in Bolton and Scharfstein

(1990), Holmström and Tirole (1997), DeMarzo and Fishman (2007) and DeMarzo and Sannikov (2006).

Significant direct and indirect costs have been documented by Campbell, Giglio, and Pathak (2011) for

households’ mortgage debt, and Andrade and Kaplan (1998), Bris, Welch, and Zhu (2006) and Davydenko,

Strebulaev, and Zhao (2012), for non-financial firms. These costs can also be substantial for financial

firms, even when their liabilities benefit from a “safe harbor” provision, as documented by Fleming and

Sarkar (2014) and Jackson, Scott, Summe, and Taylor (2011) in case studies of the bankruptcy of Lehman

Brothers Holdings Inc. For instance, Fleming and Sarkar (2014, p. 193) write that “it has been alleged that

Lehman (...) failed to segregate collateral” and that creditors to these claims “were unable to make recovery

through the close-out netting process and became unsecured creditor to the Lehman estate.” In addition,

“counterparties did not know when their collateral would be returned to them, nor did they know how much

they would recover given the deliberateness and unpredictability of the bankruptcy process.”

    Imperfect collateral pledgeability limits the extent to which agents can credibly promise contingent pay-

ments, i.e., issue contingent claims, to share risk in financial markets. The goal of this paper is to study

the implications of this friction for risk sharing and asset pricing. To conduct this analysis, we consider a


                                                       2
canonical one-period general equilibrium model with a single consumption good. At time 0, competitive risk

averse agents are endowed with shares of assets (or “Lucas trees”) generating consumption good output at

time 1. Lucas trees are risky and heterogenous: time-1 output varies across states of nature and across trees.

The agents can trade these trees but cannot “strip” their cash flows, i.e, they must buy or sell the whole

vector of outputs generated by a tree in all the possible states of nature. Agents, however, can also trade a

complete set of Arrow securities (one for each state). While Lucas trees are in positive net supply, Arrow

securities are in zero-net supply. Any long asset positions, either in trees or in Arrow securities, can be used

as collateral.

    If collateral was perfectly pledgeable, the first best would be attained in equilibrium. Agents would use

the output from their collateral assets to make the payments they promised when issuing Arrow securities.

These payments would enable agents to exchange consumption across states and achieve efficient insurance.

The consumptions of all agents would comove with aggregate output. In this complete market consumption

CAPM world, only the risk associated with aggregate output would be priced. Finally, agents would be

indifferent between holding a tree and a corresponding replicating portfolio of Arrow securities, since both

would have the same price and the same payoff. As a result, the allocation of trees would be indeterminate.

    In contrast, we analyze equilibrium when collateral is imperfectly pledgeable. Because of the above

discussed direct and indirect bankruptcy costs, an agent cannot pledge all the output of his assets: Incentive

compatibility implies that his pledgeable income in a given state is only a fraction of his tree portfolio’s output

in that state. This limits the state contingent transfers agents can promise one another and hence constrains

the provision of insurance. Thus, while agents can trade a complete set of Arrow securities, risk sharing can

be imperfect and the market endogenously incomplete. We show in this context that equilibrium exists and

is constrained Pareto optimal (constrained optimality of equilibrium obtains because, in a one-period model,

prices do not appear in incentive compatibility constraints.)

    Equilibrium risk sharing is imperfect only if the first best consumption profile cannot be achieved with

an allocation in which all agents only hold long positions in trees, that is, only if agents must establish short

positions to share risk.1 Without short positions, there would no liabilities and no scope for default, so that
   1 When short positions are needed to implement risk sharing, it is optimal to issue Arrow securities, rather than shorting

trees, because the latter creates unnecessary liabilities (and therefore tighten incentive constraints), which the former can avoid.




                                                                 3
imperfect pledgeability would not be an issue.

    When equilibrium short positions imply incentive constraints bind (so that risk sharing is imperfect), the

prices of trees are equal to the value of their output, evaluated at Arrow securities prices, minus the shadow

cost of the incentive constraints. This delivers two related implications for asset prices:

    First, there is a basis between the price of a tree and that of replicating portfolios of Arrow securities,

even when trees and Arrow securities are equally pledgeable. Furthermore, the basis always go in the same

direction, as each tree is priced below its replicating portfolio of Arrow securities. The basis is a deviation

from the law of one price but does not constitute an arbitrage opportunity. In order to conduct an arbitrage

trade, an agent would need to sell Arrow securities and use the proceeds to buy assets. This is precluded by

the incentive constraint: if the agent sold these Arrow securities, this would increase his liabilities, leading

to a violation of his incentive constraint.2

    Second, equilibrium expected excess returns reflect two premia. The first premium increases in the

covariance between the tree payoff and the consumption of an unconstrained agent, whose identity varies

across states. The second premium increases with the covariance between the tree payoff and the shadow

price of the incentive compatibility constraint of the agents holding it.

    Our model also delivers implications for tree holdings. Since incentive constraints limit agents’ ability to

promise future payments via the sale of Arrow securities, agents find it optimal to hold portfolios of risky

trees with payoff as close as possible to their desired state-contingent consumption profile. Indeed, these

portfolios allow them to limit their purchases (resp. sales) of Arrow securities, for states in which their

desired consumption profile is above (resp. below) the output of their risky asset portfolio. Thus, even

though the Arrow security market is complete, the tree market is endogenously segmented: agents differing

in terms of risk aversion find it optimal to hold different types of trees in equilibrium.

    To further illustrate equilibrium properties, we consider the simple 2-by-2 case in which there are two

states, two agents’ types with different relative risk aversion, one more risk tolerant and the other more-risk

averse, and an arbitrary distribution of trees. Equilibrium in this simple case is as follows: As in the first
   2 In contrast, the opposite situation, in which a tree would be worth more than the replicating portfolio of Arrow securities,

could be arbitraged. An agent holding the tree (some agents must, by market clearing), could sell the tree and use the proceeds
to buy the replicating portfolio. In contrast with the case in which the tree is worth less than the replicating portfolio, this
arbitrage can be conducted without taking on state contingent liabilities, and therefore does not tighten incentive constraints.




                                                               4
best (but to a lower extent), the consumption share of the risk tolerant agent is smaller in the bad state than

in the good state. That is, the more risk tolerant agent offers some insurance to the more risk averse agent.

To implement this consumption allocation, the more risk tolerant agent sells (resp. buys) Arrow securities

that pay in the bad (resp. good) state. Hence his incentive compatibility constraint binds in the bad state

and is slack in the good state. To mitigate incentive problems, the more risk averse agent holds trees with

relatively large payoff in the bad state, so that he needs to purchase less Arrow securities from the risk

tolerant agent. That is, the more risk averse agent holds trees with low consumption beta, while, by market

clearing, the more risk tolerant agent holds trees with high consumption beta. This is a deviation from the

two-fund separation principle, which illustrates how segmentation arises in equilibrium in our model. This

simple 2-by-2 case delivers a rich set of implications.

   First, expected excess returns are concave in consumption betas, in line with Black (1972) and recent

evidence by Frazzini and Pedersen (2014) and Hong and Sraer (2016). The intuition is the following: Within

the set of high beta assets held by the risk tolerant agent, the riskier ones have higher cash flow in the good

state (in which his incentive compatibility condition is slack) and lower cash flow in the bad state (in which

his incentive compatibility condition binds). Consequently, the riskiest assets held by the risk tolerant agent

command a lower premium than the safer assets held by this agent. Symmetrically, within the set of low

beta assets held by the more risk averse agent, the safest ones command a relatively low premium, while the

riskier ones command a larger premium. Thus expected excess returns are concave in beta. This contrasts

with the theoretical analysis of Frazzini and Pedersen (2014), in which the security market line is flat but

linear.

   Second, holding aggregate risk and aggregate pledgeable income constant, the distribution of aggregate

output across trees in each state matters for equilibrium outcomes. Namely, incentive constraints are less

likely to impact equilibrium if the dispersion of security betas is larger. The intuition is the following.

Increasing the supply of low beta assets enables the more risk averse agents to hold more assets with payoff

in the bad state, reducing their demand for Arrow securities contingent on that state. This reduces the sales

of these Arrow securities by the more risk tolerant agents, thus relaxing their incentive constraints. This

underscores the key role of our assumption that the same production technology (tree) generating output



                                                          5
in different states cannot be split into several productive assets, each generating output in one state only,

so that only Arrow securities can transfer payoff across states. In practice, the dispersion of security betas

might be lower when many firms are conglomerates; when the productive sector relies on a relatively small

number of technologies; or when many corporations are financially distressed so that safe assets are scarce.

Our analysis suggests that an instrument for public policy could be to modify the distribution of securities

risk profiles, which may be one of the aspects of non-conventional monetary policy.

    Third, our analysis sheds light on the consequences of shocks worsening incentive problems. Suppose the

more risk tolerant agent is subject to a negative shock, increasing his shadow cost of holding assets. This

has joint implications for equilibrium holdings and pricing: The agent sells his least risky holdings, for which

his comparative advantage is the lowest. At the same time, the basis increases for all the assets initially held

by the agent, so that there is comovement among these assets.


    Literature: Our model is in line with the limited commitment literature, which studies risk-sharing

and asset pricing when agents cannot commit not to default on their promises, see Kehoe and Levine (1993,

2001), Holmström and Tirole (2001), Alvarez and Jermann (2000), Chien and Lustig (2009) and Gottardi

and Kubler (2015). In these papers, and also in ours, while there is a complete set of Arrow securities,

incentive constraints prevent full risk-sharing. This affects asset prices, as the stochastic discount factor

for each state reflects the shadow cost of the incentive constraint for that state. However, these papers

assume that some income (interpreted either as labour or corporate income) cannot be seized nor traded,

but tradeable assets can be seized. In contrast, we assume that all income is generated by assets that can

be traded and partially seized. This difference in assumption generates a difference in results: In the limited

commitment literature, the law of one price holds.3 In contrast, our model exhibits equilibrium deviations

from the law of one price. Different state prices are applied to different state-contingent claims. Thus one

contribution of our analysis relative to the limited commitment literature is to show that there is a basis

between the prices of tradeable and imperfectly pledgeable assets and the prices of replicating portfolios of
   3 For example, Alvarez and Jermann (2000) write (on page 776): “The price of an arbitrary asset is calculated by adding up

the prices of the corresponding contingent claims.” Likewise, in Holmström and Tirole (2001), there is a single vector of state
prices that is used to calculate the value of all claims, either corporate or non-corporate (see equation (20) and (23) on page
1849).




                                                               6
Arrow securities.4

    Deviations from the law of one price have been obtained by another important strand of literature, in

particular Hindy and Huang (1995), Aiyagari and Gertler (1999), Gromb and Vayanos (2002, 2017), Coen-

Pirani (2005), Fostel and Geanakoplos (2008), Gârleanu and Pedersen (2011), Geanakoplos and Zame (2014),

and Brumm, Grill, Kubler, and Schmedders (2015). That literature differs from our paper and from the

limited commitment literature in that it specifies plausible but exogenous financial constraints, which are

not microfounded as resulting from incentive compatibility conditions. In contrast, in our paper and in the

limited commitment literature, financial constraints stem from the incentive compatibility condition that the

agent must prefer to hold his promises rather than deviating.5 Thus, while market equilibrium relies on the

exchange of trees and a complete set of Arrow securities, the resulting allocation can also be interpreted as

the outcome of an optimal contracting process. For example, in our model in which equilibrium is constrained

Pareto efficient, the equilibrium allocation is equal to that arising in the optimal contract designed by the

central planner subject to incentive compatibility constraints.

    Gârleanu and Pedersen (2011) offer an insightful analysis of asset pricing under margin constraints.

In their model, the constraint is that the sum across assets of each asset’s exogenous margin multiplied

by the absolute value of the asset weight in the portfolio must be lower than or equal to one. There is

one shadow price for this constraint. The basis between an asset and a replicating derivative portfolio

is equal to this shadow price, multiplied by the difference in exogenous margin constraints between the

asset and the replicating derivative. In our endogenous constraints model, in contrast, as in the limited

commitment literature, there is one incentive compatibility constraint per state, and its shadow price is

impounded in the pricing kernel. Thus, the basis between an asset and a replicating portfolio reflects the

covariance (across states) between the asset’s payoff and the shadow price of the constraint. This leads

to our empirical prediction, absent from Gârleanu and Pedersen (2011) that expected excess returns are

concave in consumption betas. Another distinct empirical prediction is that, in our model, all bases go in

the same direction: assets are always priced below replicating derivative portfolio. Moreover, our predictions
   4 Rampini and Vishwanathan (2017) also study risk-sharing under financial constraints (between a risk averse hedger and a

risk neutral intermediary, via state-contingent debt). Their analysis, which does not consider the trading of assets, differs from
ours, which focuses on pricing the cross section of assets.
   5 In this context the payoff of the agent in case of deviation is explicitly specified. For example in Alvarez and Jermann

(2000) agents must revert to autarky, while in Chien and Lustig (2009) the agents’ holdings of a Lucas tree are seized, and in
our model a fraction of the output from the Lucas trees held by the agent is seized.


                                                                7
about bases arise without assuming exogenous differences in pledgeability between derivatives and underlying

assets.

    Fostel and Geanakoplos (2008), Geanakoplos and Zame (2014), Brumm, Grill, Kubler, and Schmedders

(2015) and Gromb and Vayanos (2002, 2017) offer seminal analyses of general equilibrium under collateral

constraints. In that literature, each financial promise must be backed by its own collateral.6 In our frame-

work, by contrast, the constraint applies to the portfolio of assets and Arrow securities of an agent, in line

with the practice of portfolio margining.7 As mentioned above, a key finding in our framework is that assets

trade at a discount relative to replicating portfolios of derivatives. This could seem to contradict the col-

lateral premium obtained by Fostel and Geanakoplos (2008), Geanakoplos and Zame (2014), and Brumm,

Grill, Kubler, and Schmedders (2015).8 There is no contradiction, however: it is simply that the benchmark

valuation is not the same for the premium and the basis results. The premium, which is the difference

between the price of the asset and its value evaluated at the marginal utility of the agent holding it, obtains

in these papers as well as in ours. Analyzing the discount at which real assets trade relative to replicating

portfolios of Arrow securities is a contribution of our paper relative to that literature.

    Gromb and Vayanos (2002, 2017) also assume that markets are exogenously segmented. In contrast,

our framework leads to endogenous market segmentation. This enables us to pin down new features and

implications of segmentation. In our model, agents hold assets whose final payoffs are correlated (instead

of diversifying). Thus, more risk averse agents hold low consumption beta assets, while more risk tolerant

agents hold high beta assets. This implies that, in response to a shock unrelated to fundamental payoffs

(e.g., a risk aversion or pledgeability shock), assets whose fundamental payoffs are correlated will comove,

i.e., react similarly to the shock, because they are held by the same agents.

    The next section presents our model. Section 3 defines equilibrium and states its optimality properties.

Section 4 presents general results on equilibrium. Section 5 presents more specific results, obtained when

there are only two types of agents.
   6 So the same asset, generating strictly positive output in two states, cannot be used to collateralize the issuance of two

Arrow securities, promising payments in these two states.
   7 For example, on http://www.cboe.com/products/portfolio-margining-rules, one can read: “The portfolio margining

rules have the effect of aligning the amount of margin money ... to the risk of the portfolio as a whole, calculated through
simulating market moves up and down, and accounting for offsets between and among all products held...”
   8 Similarly, new monetarist analyses point to a “liquidity premium” when assets can be used as means of payment: see for

example Lagos (2010), Li, Rocheteau, and Weill (2012), Lester, Postlewaite, and Wright (2012), Venkateswaran and Wright
(2013), and Jacquet (2015) who show how this premium varies with asset risk.



                                                              8
2      Model

2.1     Assets and Agents

There are two dates t = 0, 1. The state of the world ω realizes at t = 1 and is drawn from some finite set

Ω according to the probability distribution {π(ω)}ω∈Ω , where π(ω) > 0 for all ω. All real resources are the

dividends of assets referred to as “trees.” The set of tree types is taken to be a compact interval that we

normalize to be [0, 1], endowed with its Borel σ-algebra. The distribution of asset supplies is a positive and

finite measure N̄ over the set [0, 1] of tree types. We place no restriction on N̄ : it can be discrete, continuous,

or a mixture of both. The payoff of tree j ∈ [0, 1] in state ω ∈ Ω is denoted by dj (ω) ≥ 0, with at least one

strict inequality in some state ω ∈ Ω. A technical condition for our existence proof is that, for all ω ∈ Ω,

j 7→ dj (ω) is continuous. Economically, continuity means that trees are finely differentiated: nearby trees in

[0, 1] have nearby characteristics. Continuity is a mild assumption since we do not impose any restriction on

the distribution N̄ of supplies.9 As will become clear later, we consider a continuum of trees for two reasons.

First, it will demonstrate clearly that our results do not arise because the span of tree payoffs is incomplete.

Second, in Section 5, it will make it easier to explicitly characterize patterns of segmentations.

    The economy is populated by finitely many types of agents, indexed by i ∈ I. The measure of type i ∈ I

agents is normalized to one. Agents of type i ∈ I have Von Neumann Mortgenstern utility


                                                                X
                                                   Ui (ci ) ≡         π(ω)ui [ci (ω)]
                                                                ω∈Ω



over time t = 1 state-contingent consumption. We take the utility function to be either linear, ui (c) = c, or

strictly increasing, strictly concave, and twice-continuously differentiable over c ∈ (0, ∞). Without loss of

generality, we apply an affine transformation to the utility function ui (c) so that it satisfies either ui (0) = 0

; or ui (0) = −∞ and ui (∞) = +∞; or ui (0) = −∞ and ui (∞) = 0. In addition, if ui (0) = −∞ we assume
                                                                                 u0i (c)c
that there exists some γi > 1 such that, for all c small enough,                 |ui (c)|   ≤ (γi − 1). This implies the Constant

Relative Risk Aversion (CRRA) bound 0 ≥ ui (c) ≥ Kc1−γi for all c small enough and some negative constant
   9 For example, our model nests a standard specification with finitely many trees k ∈ {1, . . . , K}, with state-contingent payoff

D(k) (ω) and positive supplies S (k) > 0. Indeed, this discrete specification obtains by fixing a finite sequence j1 < j2 , . . . < jK ,
choosing any continuous function j 7→ dj (ω) such that djk (ω) = D(k) (ω) for k ∈ {1, . . . , K}, and letting N̄ be a discrete
distribution with atoms at j1 < j2 , . . . < jK , Njk − Njk − = S (k) .



                                                                      9
K.10

    Finally, we assume that, at time t = 0, agent i ∈ I is endowed a strictly positive share, n̄i > 0, in the
                                                                                                                   P
market portfolio. Of course, agents’ shares in the market portfolio must add up to one, that is                       i∈I   n̄i = 1.



2.2     Markets, Budget Constraints, and Incentive Compatibility

Markets. At time zero, agents trade two types of assets: trees, and a complete set of Arrow securities.

While trees are in positive supply, Arrow securities are in zero net supply.

    We assume that agents must choose positive tree holdings. Formally, they choose a portfolio N from the

set M+ of positive and finite measures over the set of tree types, [0, 1]. Positivity means that agents cannot

own a negative fraction of a firm. However, we allow them to take short positions by selling a complete set of

Arrow securities, subject to borrowing constraints specified below. Therefore we are explicit about the fact

that short positions are liabilities, and we model these liabilities as negative positions in a portfolio of Arrow

securities. The vector of agent i’s positions in each of the Arrow securities is denoted by ai ≡ {ai (ω)}ω∈Ω .

The position ai (ω) can be positive (if the agent buys the Arrow security) or negative (if the agent sells the

Arrow security).11


Budget constraints. A price system for trees and Arrow securities is a pair (p, q), where p : j 7→ pj is a

continuous function for the price of tree j,12 and q = {q(ω)}ω∈Ω is a vector in R|Ω| for the prices of Arrow

securities. Given the price system (p, q), the time-zero budget constraint for agent i is:


                                        X                    Z                   Z
                                              q(ω)ai (ω) +       pj dNij ≤ n̄i       pj dN̄j .                                  (1)
                                        ω∈Ω

  10 We use this technical condition in our existence proof to show that the maximum correspondence of the social planner’s

problem has a weakly closed graph and that, at points where some of the welfare weights are equal to zero, the maximized
social welfare function is continuous in welfare weights. See the proof of Proposition A.1 in the Supplementary Appendix.
  11 In Appendix B.9 we explicitly allow for short sale of trees. We show that short-selling a tree is always weakly dominated

by selling the corresponding replicating portfolio of Arrow securities. This justifies our assumption that all short positions must
take the form of sales of Arrow securities.
  12 Hence, we assume that the price functional admits a dot-product representation based on a continuous function, p , of tree
                                                                                                                           j
type. This is a restriction: in full generality one should allow for any continuous linear functional, which may not have such
a representation. However, given our maintained assumption that j 7→ dj (ω) is continuous, this restriction turns out to be
without loss of generality. Namely, one can show that any equilibrium allocation can be supported by a price functional with
such a dot-product representation, based on a continuous function of tree types. See the paragraph before Proposition A.3 page
45.




                                                                 10
At time one, agent i’s consumption must satisfy:


                                                                       Z
                                               ci (ω) = ai (ω) +           dj (ω) dNij .                                        (2)



We denote the state-contingent consumption plan by ci ≡ {ci (ω)}ω∈Ω .


Incentive compatibility constraints. At time t = 1, the agent is supposed to follow the consumption

plan given in (2). Instead, the agent could strategically default on his contractual obligations. As discussed

in the introduction in the Lehman Brother’s case, when counterparties default, collateral recovery is costly

and imperfect. Debtors can take advantage of such imperfect recoverability to renegotiate liabilities. To

capture this process in the simplest possible way, we assume an agent can make a take-it-or-leave-it offer to

his creditors, who, if they refuse this offer can only seize fraction 1−δ ∈ (0, 1] of the agent’s assets. Hence the

consumption plan ci (ω) must give agent i no less than a fraction δ of the positive payoff of his trees and Arrow

security long positions in state ω ∈ Ω.13 An alternative interpretation of δ is that it quantifies how much

resources agents can divert, as in the theoretical analyses of Bolton and Scharfstein (1990), Holmström and

Tirole (1997), DeMarzo and Fishman (2007) and DeMarzo and Sannikov (2006). Thus, in the terminology

of Holmström and Tirole (1997), 1 − δ is the pledgeable fraction of the agent’s income.

    Formally, consider agent i’s incentives to strategically default in state ω ∈ Ω. The agent has two types of

                                  dj (ω) dNij of his long tree portfolio. Second, the payoff a+
                              R
assets. First, the payoff                                                                     i (ω) of his long Arrow


security position. The agent’s liability is a short Arrow position, a−
                                                                     i (ω). The net position in the state ω

                                     −
Arrow security is ai (ω) = a+
                            i (ω) − ai (ω). If the agent strategically defaults and renegotiates his liabilities


or diverts, he obtains a fraction δ of his long positions in trees and Arrow securities, and he consumes:


                                                           Z
                                             ĉi (ω) = δ       dj (ω) dNij + δ a+
                                                                                i (ω).                                          (3)



The incentive compatibility condition is such that the agent prefers repaying his promise rather than strate-
  13 Here we assume for simplicity that δ is constant across agents and assets. In the appendix all our proofs cover the generalized

case in which it is a continuous function δij of the identity i of the agent and of the type j of the asset. The results obtained
in the special case in which δ is constant generalise straightforwardly to the general case δij and the main economic intuitions
are unchanged.




                                                                  11
gically defaulting:

                                                  ci (ω) ≥ ĉi (ω),


where ci (ω) is given in (2) and ĉi (ω) in (3). Substituting (2) and (3) into the above equation, we obtain that

the incentive constraint can be rewritten as a state-contingent borrowing constraint:

                                                       Z                            
                                  a−
                                   i (ω)   ≤ (1 − δ)        dj (ω) dNij +    a+
                                                                              i (ω)      .                   (4)



The left-hand side is the agent’s liability in state ω. The right-hand side is the pledgeable part of the agent’s

assets in state ω. An immediate implication of constraint (4) is:

                                                                                         −
Lemma 1 It is always weakly optimal to choose an Arrow position such that a+
                                                                           i (ω) = 0 or ai (ω) = 0.


                              −
   Indeed, if a+
               i (ω) > 0 and ai (ω) > 0, the agent could reduce both positions equally by some small amount.

                                                                  −
Because this does not change the net position, ai (ω) = a+
                                                         i (ω) − ai (ω), the agent can keep his consumption


the same. But this would relax (4) because the left-hand side would decrease by more than the right-hand

side. Economically, this means that it is suboptimal to purchase Arrow assets, a+
                                                                                i (ω), in order to increase


borrowing in the corresponding Arrow liabilities, a−
                                                   i (ω). Indeed, increasing the long Arrow position by one


unit only allows to increase the short position by (1 − δ) < 1. While this indeed increases the agent’s gross

borrowing, the net borrowing actually decreases.

   Lemma 1 allows us to focus on the case in which agents choose Arrow positions such that a+
                                                                                            i (ω) = 0 or


a−
 i (ω) = 0. A key implication is that whenever an agent has a long Arrow position, he does not have any


simultaneous short position and (4) is slack. In other words, long Arrow positions never create any incentive

problems. As will be clear shortly, long tree positions, on the other hand, may create incentive problems.

   The Lemma also leads to a simpler representation of (4) in terms of net Arrow position. Namely, if

a−                +
 i (ω) > 0, then ai (ω) = 0, and (4) writes as


                                                                 Z
                                        − ai (ω) ≤ (1 − δ)           dj (ω) dNij .                           (5)


                     −                                                                  −
If a+                                                                                                 +
    i (ω) > 0, then ai (ω) = 0, (4) is slack, and (5) holds as well. Conversely, given ai (ω) = 0 or ai (ω) = 0,


                                                            12
if (5) holds, then the original constraint (4) holds too. The next step is to use (2) in order to express ai (ω)

in terms of consumption and tree payoff, so we obtain the equivalent incentive compatibility condition:


                                                        Z
                                           ci (ω) ≥ δ       dj (ω) dNij ,                                   (6)



for all ω ∈ Ω, where the left-hand side is the consumption plan of the agent, and the right-hand side is

the part of the dividend flow the agent could get by renegotiating his liabilities, or, equivalently, diverting

resources. We hereafter refer to this part of the dividend flow as the non-pledgeable dividend.

   As shown by equation (4), the state-contingent payoff of trees serves as collateral for the state-contingent

liability of the agent. But the amount the agent can promise is lower than the face value of the collateral,

because of incentive constraints. The wedge between the output/collateral and the maximum promised

payment can be interpreted as a haircut. Haircuts are increasing in δ. Haircuts are not imposed on an

individual asset basis, but at the level of the aggregate position, or portfolio of the agent. This is in line

with the practice of “portfolio margining.”

   Note that the haircut is not imposed by the regulator. It is requested by the private contracting agents

to limit counterparty risk. There is however an aspect of that requirement that cannot be completely

decentralized. The incentive compatibility constraint of agent i involves the Arrow securities traded by

agent i with all other agents in the economy. These multiple trades must be aggregated (and cleared) to

determine the total exposure of agent i to state ω, and then compared to the assets of the agent, imputing the

right haircuts. This can be the role of the Central Clearing Party (CCP), which in our model can centralize

and clear all trades to ensure incentive compatibility, and thus deliver a better outcome than the outcome

which would arise with bilateral contracting only.




                                                        13
3      Definition and Elementary Properties of Equilibrium

3.1     Agent’s Problem and Definition of Equilibrium

As is standard, the consumption plan, ci , and the tree holdings, Ni , satisfy the time-zero budget constraint

(1) and the time-one budget constraint (2), if and only if they satisfy the inter-temporal budget constraint:


                      X                    Z                    Z                X            Z
                            q(ω)ci (ω) +        pj dNij ≤ n̄i        pj dN̄j +         q(ω)       dj (ω) dNij .   (7)
                      ω∈Ω                                                        ω∈Ω



Both the budget constraint (7) and the incentive compatibility constraint (6) are only a function of (ci , Ni ),

and do not depend on the Arrow security holdings ai . Hence, we can define the consumption set of agent
                      |Ω|
i ∈ I to be Xi ≡ R+ × M+ , the product of the set of positive state contingent consumption plans and

of the set of positive tree holdings. The problem of agent i is, then, to maximize Ui (ci ) with respect to

(ci , Ni ) ∈ Xi , subject to the intertemporal budget constraint (7) and the incentive compatibility condition

(6).

    Let X denote the cartesian product of all agents’ consumption set. An allocation is a collection (c, N ) =

(ci , Ni )i∈I ∈ X of consumption plans and tree holdings for every agent i ∈ I. An allocation (c, N ) is feasible

if it satisfies:


                                  X                   XZ
                                        ci (ω) ≤                dj (ω) dNij for all ω ∈ Ω                         (8)
                                  i∈I                  i∈I
                                    X
                                           Ni     = N̄ .                                                          (9)
                                     i∈I



    An equilibrium is a feasible allocation (c, N ) and a price system (p, q) such that, for all i ∈ I, (ci , Ni )

solves agent’s i problem given prices.

    Our formulation of the agent’s problem clearly shows that, since trees are tradeable and the Arrow

security market is complete, an agent can always escape any incentive problems by setting Ni = 0. That is,

the agent can always sell all of his tree holdings, and only purchase Arrow securities. But, of course, this

cannot be part of a tree-market equilibrium: if all agents sell all of their trees, the market clearing condition

for trees, (9), does not hold. This intuitively implies our result about bases: for the tree market to clear,


                                                                14
the price of trees will have to fall below that of Arrow securities. This also highlights that, in our model,

binding incentive compatibility constraints is a general equilibrium phenomenon. This is in contrast with

earlier models in which non-pledgeable income is not tradeable: in these environments, binding incentive

constraints would already arise in partial equilibrium contract-theoretic settings.



3.2    Incentive-Constrained Pareto Optimality

An allocation (c, N ) ∈ X is said to be incentive-feasible if it satisfies the incentive compatibility constraints

(6) for all (i, ω) ∈ I × Ω, and the feasibility constraint (8) and (9). An incentive-feasible allocation (ĉ, N̂ )

Pareto dominates the incentive-feasible allocation (c, N ) if Ui (ĉi ) ≥ Ui (ci ) for all i ∈ I, with at least one

strict inequality for some i ∈ I. An allocation is incentive-constrained Pareto optimal if it is incentive-feasible

and not Pareto dominated by any other incentive-feasible allocation. In our model, we have:


Proposition 1 Any equilibrium allocation is incentive-constrained Pareto optimal.


   The reason why optimality obtains in spite of incentive constraints is because prices do not show up

in the incentive compatibility condition, so that there are no “contractual externalities”. See Prescott and

Townsend (1984) and Kehoe and Levine (1993) for other examples of economies in which equilibrium is

constrained optimal, and Gottardi and Kubler (2015) for examples in which it is not. Because there are

no contractual externalities, the proof of Proposition 1 is similar to its perfect market counterpart: if an

equilibrium allocation were Pareto dominated by another incentive feasible allocation, the latter must lie

outside the agents’ budget set. Adding up across agents leads to a contradiction.



3.3    Existence and Uniqueness

To prove existence of equilibrium, we follow Negishi (1960). We consider the problem of a Planner who assigns
                                                        P
Pareto weights αi ≥ 0 to each agent i ∈ I, with           i∈I    αi = 1, and chooses incentive feasible allocations to
                                          P
maximize the social welfare function,         i∈I   αi Ui (ci ). We establish the existence of Pareto weights such

that, given agents’ initial endowment, the social optimum can be implemented in a competitive equilibrium

without making any wealth transfers between agents.



                                                            15
Proposition 2 There exists an equilibrium.


   The proof follows arguments found in Negishi (1960), Magill (1981), and Mas-Colell and Zame (1991)

with some differences. First, our planner is now subject to incentive compatibility constraints. Second,

technical difficulties arise because the commodity space is infinite dimensional which makes it harder to

apply separation theorems. We solve these difficulties by explicitly deriving first-order necessary and sufficient

conditions for the Planner’s problem, and using the associated Lagrange multipliers to construct equilibrium

prices.

   We can show uniqueness in a particular case of interest:


Proposition 3 Suppose that there are two types of agents, I = {1, 2}, with CRRA utility, with respective

RRA coefficients (γ1 , γ2 ) such that 0 ≤ γ1 ≤ γ2 ≤ 1 and γ2 > 0. Then the equilibrium consumption allocation

is uniquely determined. The prices of Arrow securities and the price of trees are, N̄ -almost everywhere,

uniquely determined up to a positive multiplicative constant.


   In general, the asset allocation is not uniquely determined. As will be clear below, this arises for example

when none of the incentive constraints bind. In that case the allocation is not uniquely determined because

it is equivalent to hold tree j or a portfolio of Arrow securities with the same cash-flows as j.

   As is standard, only relative prices are pinned down, hence price levels are only determined up to a

positive multiplicative constant.

   Finally, asset prices are only uniquely determined N̄ -almost everywhere. In particular, the prices of

assets in zero supply are not uniquely determined. This is intuitive: given the short-sale constraint, the only

equilibrium requirement for an asset in zero supply is that the price is large enough so that no agent want

to hold it. As a result equilibrium only imposes a lower bound on the price of trees in zero supply.14
 14 To   remove the indeterminacy, it would be natural to inject a small additional supply for all trees, N̄ + ε U[0,1] and let ε → 0.




                                                                  16
4     Equilibrium Analysis

4.1       First Best Implementability

We first study circumstances under which the incentive compatibility constraints do not impact equilibrium

outcomes.

    Formally, define a δ = 0 equilibrium to be a first-best allocation and price system (c0 , N 0 , p0 , q 0 ) when

δ = 0, i.e., when there is no scope for incentive problems. Fix some δ > 0. Then, the δ = 0-equilibrium is

said to be δ > 0-implementable if there exists some δ > 0-equilibrium, (cδ , N δ , q δ , pδ ), such that c0 = cδ . It

is clear that a δ = 0-equilibrium, (c0 , N 0 , p0 , q 0 ), is δ > 0-implementable if and only if there exists a feasible

asset allocation, there exists some N δ , such that incentive constraints are satisfied for all agents and all

states:


                                  X
                                           Niδ   = N̄                                                                       (10)
                                  i∈I
                                                       Z
                                     c0i (ω)     ≥ δ                 δ
                                                            dj (ω) dNij   ∀(i, ω) ∈ I × Ω.                                  (11)



Based on this observation, we obtain:


Proposition 4 Fix some δ > 0. A δ = 0 equilibrium (c0 , n0 , p0 , q 0 ) is δ > 0-implementable if one of the

following conditions is satisfied:


    • Inada conditions are satisfied for all i ∈ I and δ is strictly positive but small enough.

                                     |I|
                                                                                   dj (ω) dNij = c0i (ω) ∀(i, ω) ∈ I × Ω.
                                                    P                          R
    • There exists {Ni }i∈I ∈ M+ such that                 i∈I   Ni = N̄ and


    • Agents have Constant Relative Risk Aversion (CRRA) with identical coefficient.


    To understand the first bullet point, note that, with Inada conditions, consumptions are strictly positive

for all agents and all states. Therefore, as long as δ is small enough, the incentive compatibility constraint

(11) is satisfied for all agents and all states when each agent holds, say, an equal fraction of the market

portfolio, Ni = N̄ /|I|, and simultaneously issues liabilities to attain its first-best consumption plan.




                                                                  17
    The second bullet point of the proposition states that all incentive compatibility constraints hold if two

sets of conditions are satisfied. First agents can replicate their δ = 0-equilibrium consumption with positive

holdings of trees. Second, these agents holding are feasible, i.e., they add up to the aggregate. This means

that they do not need to make any financial promise, i.e., promise to deliver consumption out of the payoff

of their equilibrium holdings of trees. Clearly, if agents do not need to make any financial promise, limited

pledgeability is not an issue.

    The third bullet point is an example of the second: if agents have CRRA utilities with identical risk

aversion, then they all consume a constant share of the aggregate endowment. Clearly, they can attain that

consumption plan by holding a portfolio of trees, namely a constant share in the market portfolio.

    Taken together, equations (10)-(11) and Proposition 4 help understand circumstances under which a

δ = 0 equilibrium cannot be implemented. Consider for example an economy composed of CRRA utility

agents with heterogenous risk aversion, and assume that there is only one tree, the “market portfolio”, with

payoff equal to aggregate consumption. Because of heterogeneity in risk aversion, in the δ = 0 equilibrium,

agents’ consumption shares vary across states – namely more risk averse agents tend to have higher con-

sumption shares in states of low aggregate consumption. If δ ' 1, agents cannot issue liabilities and their

consumption must be approximately equal to the payoff of their tree portfolio. But since they can only hold

the market portfolio, their consumption share must be approximately constant across states, so that the

δ ' 1 equilibrium cannot coincide with the δ = 0 equilibrium.



4.2       Optimality Conditions

Since agents have concave objectives and are subject to finitely-many affine constraints, we can apply the

Lagrange multiplier Theorems shown in Section 8.3 and 8.4 of Luenberger (1969) (see Proposition A.4 in the

appendix for details). Let λi denote the Lagrange multiplier of the intertemporal budget constraint (7) and

µi (ω) the Lagrange multiplier of the incentive compatibility constraint (6). The first-order condition with

respect to ci (ω) is15

                                            π(ω)u0i [ci (ω)] + µi (ω) = λi q(ω).                                          (12)
  15 Inprinciple this condition only hold with an inequality if ci (ω) = 0, which may occur when utility is linear. However, we
show in the Appendix (Proposition A.4) that one can always choose multipliers so that this condition holds at equality.




                                                              18
The first term on the left-hand side of (12) reflects that an increase in consumption increases utility and

the second term reflects that it relaxes the incentive compatibility constraint (6), while the term on the

right-hand side reflects that this increase in consumption tightens the budget constraint.

   The first-order condition with respect to Ni is

                                                             "                         #
                                  X                              X
                                        µi (ω)δdj (ω) ≥ λi             q(ω)dj (ω) − pj ,                    (13)
                                  ω∈Ω                            ω∈Ω



with an equality Ni –almost everywhere, that is, for almost all trees held by agent i. The left-hand side of

(13) reflects that an increase in i’s holdings of tree j increases the amount of non-pledgeable dividend δdj (ω),

which tightens the incentive constraint (6) for each ω. The right-hand side reflects that an increase in i’s
                                                                             P
holdings of tree j relaxes the intertemporal budget constraint by              ω   q(ω)dj (ω) − pj .



4.3    Asset Pricing

The pricing of risk and incentives. The first order condition with respect to consumption, (12), shows

that if the incentive compatibility conditions were slack, the marginal rate of substitution between consump-

tions in different states would be equal across all agents, as in the standard, perfect and complete markets,

model. When incentive compatibility conditions bind, in contrast, marginal rates of substitution differ across

agents, reflecting the multipliers of the incentive constraints. This reflects imperfect risk-sharing in markets

that are endogenously incomplete due to incentive constraints, as in Alvarez and Jermann (2000). Thus the

Arrow securities pricing kernel
                                                                 q(ω)
                                                    M (ω) ≡           ,
                                                                 π(ω)

which in our model prices the Arrow securities, differs from its perfect and complete markets counterpart

because in general, there is no agent whose marginal utility is equal to M (ω) in all states. Instead, M (ω)

corresponds to the marginal utility of an unconstrained agent, whose type varies from state to state.

   The first order condition with respect to asset holdings, (13), rewrites as


                                           X                       X µi (ω)
                                   pj ≥          q(ω)dj (ω) − δ             dj (ω),                         (14)
                                                                      λi
                                           ω∈Ω                     ω∈Ω



                                                          19
with an equality for almost all trees held by agent i. Denote


                                                             µi (ω)
                                                 Ai (ω) ≡           ,
                                                            λi π(ω)


which can be interpreted as the shadow cost of the incentive compatibility constraint of agent i in state ω.

With these notations, (14) rewrites as:



                                     pj ≥ E [M (ω)dj (ω)] − δ E [Ai (ω)dj (ω)] ,                                 (15)



with an equality for almost all trees held by agent i. Equation (15) shows that the price of an asset held by

i is the difference between two terms.

   The first term is E [M (ω)dj (ω)], the present value of the dividends evaluated with the pricing kernel M .

It reflects the pricing of risk embedded in the prices of the Arrow securities.

   The second term, δ E [Ai (ω)dj (ω)], is new to our setting. It reflects the pricing of incentives, as it is

equal to the shadow cost incurred by agents of type i when they hold one marginal unit of asset j and

their incentive constraints become tighter. It is the expected product of the shadow cost of the incentive

constraint, Ai (ω), by the non-pledgeable part of the dividend, δ dj (ω).


Excess return decomposition. The pricing formula (15) leads to a natural decomposition of excess

return. Define the risky return on asset j as Rj (ω) ≡ dj (ω)/pj and let the risk-free return be Rf ≡

1/E [M (ω)]. Then, standard manipulations of the first order condition (14) show that for almost all assets

held by agents of type i:



                        E [Rj (ω)] − Rf = −Rf cov [M (ω), Rj (ω)] + Rf E [Ai (ω)δRj (ω)]                         (16)



The first term on the right-hand side of (16) can be interpreted as a risk premium. It is positive if the return

on asset j, Rj (ω), is large for states in which the pricing kernel, M (ω), is low. It is similar to the standard risk

premium associated with consumption betas in frictionless markets but, unlike in the frictionless CCAPM,

the pricing kernel M (ω) mirrors neither aggregate nor individual consumption.


                                                         20
   The second term on the right-hand side of (16) is a premium reflecting incentive constraints. This

premium is large if non-pledgeable income, δ Rj (ω), is large when the incentive compatibility condition is

tight.

   Equation (16) bears some similarities with the margin-CAPM characterized by Gârleanu and Pedersen

(2011) (see in particular Proposition 2 in Gârleanu and Pedersen (2011)). In both cases, expected excess

returns increase with i) a consumption beta and ii) a term reflecting financial constraints. These two terms,

however, are different in Gârleanu and Pedersen (2011) and in our model. First, in Gârleanu and Pedersen

(2011) the consumption beta is defined relative to the aggregate consumption, while, as discussed above, our

consumption risk premium does not mirror aggregate consumption, due to the endogenous, incentive driven,

market incompleteness. Second, in Gârleanu and Pedersen (2011) the premium associated with financial

constraints is proportional to the product between the single multiplier associated with this constraint (which

is a constant) and the exogenous margin requirement for the priced asset. Thus, in Gârleanu and Pedersen

(2011) differences in this premia across assets are proportional to the exogenous differences between these

margin requirements. In contrast, in our model, there are no exogenous differences in margin requirements,

as δ is the same for all assets. Instead there are many incentive compatibility constraints, one for each state,

and correspondingly many multipliers or shadow prices. Thus, we have that the premium associated with

the incentive constraint reflects the covariance between an asset’s non-pledgeable payoff and the shadow

price of the incentive constraint. Consequently, assets with different distributions of payoffs across states

will generically have different incentive constraint premia, even if they have the same level of pledgeability.


Deviation from the Law of One Price. Equation (15) reveals that, if the incentive compatibility

constraint of the asset holder binds in at least one state, and if the dividend is strictly positive in that state,

then the price of the tree is strictly smaller than that of the corresponding portfolio of Arrow securities, i.e.,

there is a basis. One could argue that this constitutes an arbitrage opportunity. However, agents cannot

trade on it without tightening their incentive constraint. Thus, the basis between E [M (ω)dj (ω)] and the

price, pj , reflects limits to arbitrage induced by incentive constraints.

   A specific implication of our model is that the basis always goes in the same direction. The price of a tree




                                                        21
can be lower than that of the replicating portfolio of Arrow securities, but it cannot be higher.16 If it was,

an agent holding the tree could sell it and buy the replicating portfolio of Arrow securities. That arbitrage

trade would be feasible because i) market clearing implies there is at least one agent holding the tree, and

ii) buying Arrow securities does not tighten IC constraints. In contrast with i), when the price of the tree is

lower than that of the replicating portfolio, there does not exist an agent holding the replicating portfolio of

Arrow securities (since holding that portfolio is dominated). Hence arbitrage trades would imply the issuance

of Arrow securities, which would tighten the IC constraint (in contrast with ii)). Thus, unlike in previous

theoretical analyses, bases always go in the same direction (assets are priced below replicating derivatives)

and don’t reflect any exogenous differences across assets in terms of margin constraints or pledgeability. In

fact, our result of the direction of the basis does not rely on our assumption that the payoffs of all assets and

contracts are equally pledgeable, and would still prevail for any heterogeneity in pledgeability parameters.

    In line with our model, during the 2007–2009 crisis, there was a a basis between the price of corporate

bonds (corresponding in our model to trees) and that of replicating portfolios of derivative contracts (see

Bai and Collin-Dufresne (2013)). To arbitrage that basis, investors would have had to purchase the cheap

underlying assets (corporate bonds), and buy protection, while funding this position by levering up. Bai and

Collin-Dufresne (2013) argue that, during the crisis, such arbitrage trades were difficult to carry out because

of financial constraints. Our model offers a micro-funded rationale for these constraints. In particular, the

borrowing constraints experienced by traders in practice are in line with the incentive constraints in our

model, which limit the amount of liabilities agents can issue to fund the arbitrage trade.


Basis vs. collateral premium. Equation (15) shows that the tree is priced at a discount relative to

the replicating portfolio of Arrow securities, i.e., there is a basis. This could seem to contradict the result

obtained in previous literature (see, e.g., Fostel and Geanakoplos (2008)) that equilibrium prices include a

collateral premium. There is no contradiction, however, as the premium obtains, both in this paper and in

previous literature, relative to a different benchmark than the replicating portfolio.

    To see this, consider again the trees held by some agent i. Take the first-order condition (12) with respect
  16 This observation explains our earlier claim that the equilibrium is robust to allowing short-sales of trees. Indeed, the

observation that the basis always goes in the same direction implies that short-selling tree is always less profitable than short-
selling a replicating portfolio of Arrow securities. See Appendix B.9 for the complete argument.




                                                               22
to ci (ω), multiply by the dividend dj (ω) and sum across states to obtain:


                                                  u0i [ci (ω)]
                                                                    
                              E [M (ω)dj (ω)] = E              dj (ω) + E [Ai (ω)dj (ω)] .                     (17)
                                                       λi


Substituting (17) into (15) the price of asset j is


                                u0i [ci (ω)]
                                                                                        
                         pj = E              dj (ω) + E [Ai (ω)dj (ω)] − δ E [Ai (ω)dj (ω)] .                  (18)
                                     λi


This price equation is similar to equation (5) in Fostel and Geanakoplos (2008) or that in Lemma 5.1 in

Alvarez and Jermann (2000). The first term on the right-hand side of (18) is similar to what Fostel and

Geanakoplos (2008) call “payoff value”: it is the expected value of asset’s cash flows, evaluated at the

marginal utility of the agent holding the asset. The second term on the right-hand side of (18) is similar

to the collateral premium in Fostel and Geanakoplos (2008) (see Lemma 1, page 1230). This premium,

however, is reduced by the last term (in factor of δ) which corresponds to the basis whose analysis is one of

the contributions of our paper.



4.4      Segmentation

Let

                                      vij = E [M (ω)dj (ω)] − δ E [Ai (ω)dj (ω)]                               (19)


denote the valuation of agent i for asset j. From the first-order condition (14), one sees that vij = pj for

almost all assets held by agents of type i, and otherwise vij ≤ pj . Therefore, the agents who hold the asset

are those who value it the most, because they have the lowest shadow incentive-cost of holding it.

      In the general model, it is difficult to provide a sharp characterization of the equilibrium asset allocation.

But this can be done in the context of particular examples, such as the one developed in Section 5 below.

In that example, different assets are held, in equilibrium, by different agents, i.e., there is endogenous

segmentation. This result is in line with the assumption made in the (exogenously) segmented market

literature, in particular recent work on “intermediary asset pricing” (see for example Edmond and Weill



                                                          23
(2012) or He and Krishnamurthy (2013)). However, the pricing formula differs from that obtained for

exogenously segmented markets. In particular, in our model, assets are not priced by the marginal utility

of the asset holders. Also, the extent of segmentation is determined in equilibrium and so will vary with

changes in the economic environment, as illustrated in the next section.

    Segmentation can also arise in incomplete market models: for example, in some models, different agents

would hold different asset portfolios because of they have different attitude towards risk. A distinctive feature

of our model is that segmentation persists even though the market for Arrow securities is complete. That is,

it explains why we can observe segmentation when investors have access to sophisticated derivative markets.




5     Two-by-Two

To characterize equilibrium more precisely, we hereafter focus on the simple “two-by-two” case, in which

there are two types of agents i ∈ {1, 2}, two states, ω ∈ {ω1 , ω2 }, and an arbitrary distribution of assets.

We further assume that both types of agents, i ∈ {1, 2}, have CRRA utility with respective coefficients of

relative risk aversion 0 ≤ γ1 < γ2 ≤ 1. That is, agent i = 1 is more risk tolerant, while agent i = 2 is more

risk averse. As shown in Proposition 3, this implies that the equilibrium consumption allocation is uniquely

determined, and the equilibrium prices are uniquely determined up to a multiplicative constant. As shown

in Proposition 4, the restriction γ1 6= γ2 is necessary for incentive compatibility to matter in equilibrium.

    We normalize the dividend of each tree to one, i.e., E [dj (ω)] = 1.17 Given that there are only two states,

any tree can be viewed as a convex combination of two extreme securities: one security that only pays off in

state ω1 , and one security that only pays off in state ω2 . Therefore, one can order the trees so that, for any

j ∈ [0, 1],
                                                     j               1−j
                                        dj (ω) =          I{ω=ω1 } +        I{ω=ω2 } .                                     (20)
                                                   π(ω1 )            π(ω2 )

Notice that (20) includes all possible payoffs in a two-state economy. That is, after the normalization

E [dj (ω)] = 1, any state contigent payoff can be written as (20) for some j.
                                                                                            R
    We label the states so that the aggregate endowment, denoted by y(ω) =                      dj (ω) dN̄j , is strictly larger
  17 This is without loss of generality. This merely amounts to divide the dividend in all states by the expected dividend, and

simultaneously scaling the asset supply up by the same constant.




                                                              24
in state ω2 than in state ω1 :


                                               Z                                       Z
                                        1                                       1
                           y(ω2 ) =                (1 − j) dN̄j > y(ω1 ) =                 j dN̄j .        (21)
                                      π(ω2 )                                  π(ω1 )


In other words, ω1 is the “bad state” while ω2 is the “good state.” The tree j = π(ω1 ) is risk free, and so

its consumption beta, cov [dj (ω), y(ω)] /V [y(ω)] is zero. Trees with j < π(ω1 ) have lower dividend in state

ω1 than in state ω2 , and so have positive consumption beta. The smaller is j, the more positive is the beta.

Vice versa, trees with j > π(ω1 ) have negative consumption beta. The larger is j, the more negative is the

beta.



5.1     Incentive Feasible Consumption Allocations

We start by studying the set of incentive feasible consumption allocations, that is, consumption allocations c

such that (c, N ) is incentive compatible for some tree allocation N . This simplifies the analysis by reducing

the number of choice variables: it allows to work directly with consumption allocations, without having to

explicitly describe the underlying asset allocation that makes it incentive compatible. In particular, it allows

to analyze incentive-feasibility and equilibrium in an Edgeworth box. Focusing on the case in which the

consumption share of agent 1 is lower in the bad state than in the good state (which, as shown below, is the

case in equilibrium), our first main result is the following:


Lemma 2 Consider a feasible consumption allocation such that c1 (ω1 )/y(ω1 ) < c1 (ω2 )/y(ω2 ). Then, c is

incentive feasible if and only if there exists k ∈ [0, 1] and (∆N1 , ∆N2 ) ≥ 0, ∆N1 + ∆N2 = N̄k − N̄k− , such

that:


                                                   Z
                                 c1 (ω1 ) ≥ δ                 dj (ω1 )dN̄j + δdk (ω1 )∆N1                  (22)
                                                    j∈[0,k)
                                                   Z
                                 c2 (ω2 ) ≥ δ                 dj (ω2 )dN̄j + δdk (ω2 )∆N2 .                (23)
                                                    j∈(k,1]



   Equation (22) is the incentive compatibility condition of agent i = 1 in state ω1 when he holds all trees

riskier than k (j < k), and, if there is an atom at k in the distribution of assets, a mass ∆N1 of that atom.



                                                               25
Similarly, equation (23) is the incentive compatibility condition of agent i = 2 when he holds all trees j > k,

plus a mass ∆N2 of the atom at k, if there is one. The lemma thus states that a consumption allocation is

incentive feasible if and only it can be implemented by allocating risky assets to agent 1 and safer assets to

agent 2 without violating their incentive compatibility constraints in states ω1 and ω2 , respectively.

   The intuition for this result can be grasped from the following two observations.

   The first observation is that, since her consumption share is smaller in ω1 than in ω2 , agent i = 1 tends

to have incentive problems in state ω1 . To understand why, imagine that agent i = 1 purchases a fraction

of the market portfolio equal to her average consumption share across states. In order to implement her

consumption plan c1 (ω) while holding this portfolio, agent i = 1 has to sell Arrow securities that pay off in

state ω1 , and purchase Arrow securities that pay off in state ω2 . Hence, agent i = 1 only has a liability in

state ω1 , so that his incentive compatibility constraint can bind only in that state. Vice versa, agent i = 2

faces incentives problems only in state ω2 . The lemma states, then, that a consumption allocation is incentive

feasible if and only if two (equations (22) and (23)) out of the four incentive compatibility constraints hold.

   The second observation is that, to mitigate these incentive problems, it is best to allocate agent i = 1 a

portfolio of trees with low payoff in state ω1 . This minimizes the amount this agent can divert in the state

in which his incentive constraint binds. Symmetrically, it is best to allocate agent i = 2 a portfolio of trees

with low payoff in state ω2 . By market clearing an equivalent way to grasp the intuition for this result is the

following: Allocating to the more risk-averse agents trees with relatively high payoff in the bad state reduces

the reliance of that agent on insurance sold by the more risk tolerant agent. This, in turn, relaxes incentives

constraints.

   The lemma is illustrated in the Edgeworth box in Figure 1. The consumption of agent i = 1 in state ω1

is on the x-axis, and his consumption in state ω2 is on the y-axis. The curves above and below the diagonal

are the boundaries of the incentive feasible set. In line with the lemma, focus on the area above the diagonal,

where the consumption share of agent 1 is larger in the good state, ω2 , than in the bad state ω1 . Consider a

point (c1 (ω1 ), c1 (ω2 )) on the boundary of the incentive set above the diagonal. It is such that (22) and (23)

hold as equalities. Starting from that point, increasing the consumption of agent 1 in state ω1 (i.e., moving

to the right on the x axis) relaxes (22). On the other hand, reducing the consumption of agent 1 in state



                                                       26
                                                                                   incentive feasible boundary with many trees
                                                                                   incentive feasible boundary with one tree
                                                                          1




                              consumption of risk tolerant in state ω2
                                                                         0.8


                                                                         0.6


                                                                         0.4


                                                                         0.2


                                                                          0
                                                                               0        0.2       0.4       0.6        0.8      1
                                                                                     consumption of risk tolerant in state ω1

           Figure 1: The set of incentive feasible consumption allocations in an Edgeworth box, when π(ω1 ) = 0.1
           and δ = 0.5. In the many-trees case, tree supplies are distributed according to a beta distribution with
           parameters a = b = 5. In the one-tree case, there is just one tree equal to the market portfolio of the
           many-trees case.



ω2 (i.e., moving downward on the y axis), which, by market clearing implies increasing the consumption

of agent 2 in that state, relaxes (23). Therefore, the whole triangle with a right angle at (c1 (ω1 ), c1 (ω2 ))

and with hypothenuse on the diagonal is incentive compatible. This implies that all the area between the

boundary of the incentive set and the diagonal is incentive compatible.

    One sees in the figure that any allocation which gives sufficiently small consumption to one of the agents

is incentive feasible. For example, if the consumption of agent i = 1 is sufficiently small then the consumption

of agent i = 2 is almost equal to the aggregate endowment. As long as δ < 1, this allocation can be made

incentive feasible by allocating all the trees to agent i = 2. In equilibrium, agent i = 1 sells all his trees to

agent i = 2, and agent i = 2 issues a liability corresponding to agent i = 1 consumption. This is feasible

since δ < 1 gives agent i = 2 some borrowing capacity.

    Figure 1 also compares the incentive sets for one tree and for many trees (keeping aggregate output in

each state constant.) The dashed line is the boundary of the incentive-feasible set when there is just one

tree in strictly positive supply.18 The solid line is the boundary when there are many trees.19 The figure
  18 In  that case, the distribution N̄ has just one atom. If we normalize this atom to one for simplicity, then in the Edgeworth
box the boundary is the curve parameterized by ∆N1 ∈ [0, 1], with cartesian coordinates c1 (ω1 ) = δd(ω1 )∆N1 and c1 (ω2 ) =
y(ω2 ) − c2 (ω2 ) = d(ω2 ) [1 − δ + δ∆N1 ]
  19 In that case we assume no atom, so the boundary is the curve parameterized by k ∈ [0, 1], with cartesian coordinates

c1 (ω1 ) = δ 0k dj (ω1 ) dN̄j and c1 (ω2 ) = y(ω2 ) − c2 (ω2 ) = 01 dj (ω2 ) dN̄j − δ k1 dj (ω2 )dN̄j .
             R                                                  R                    R




                                                                                                   27
illustrates that the incentive-feasible set is smaller with one tree than with many trees. Indeed, with many

trees, one can replicate one-tree allocations by allocating agents shares in the market portfolio.



5.2    Equilibrium Allocations

In order to characterize equilibrium allocations, we rely on their efficiency properties. Let (c, N ) denote the

equilibrium allocation. As shown in Proposition 1, (c, N ) is constrained Pareto efficient. That is, (c, N )

solves an incentive-constrained planner’s problem, i.e., there exists weights (α1 , α2 ) ∈ (0, 1)2 , α1 + α2 = 1,
                         P
such that c maximizes      i∈I   αi Ui (ci ) with respect to feasible allocations satisfying the incentive compatibility

conditions. Let c? denote the solution of the corresponding unconstrained planner’s problem. That is, c?

maximizes the same welfare function, with the same weights (α1 , α2 ), with respect to feasible allocations,

but without imposing the incentive compatibility conditions.

Lemma 3 If (α1 , α2 ) > 0, then the solutions of the unconstrained and incentive-constrained planner’s prob-

lems both are such that c?1 (ω1 )/y(ω1 ) < c?1 (ω2 )/y(ω2 ) and c1 (ω1 )/y(ω1 ) < c1 (ω2 )/y(ω2 ).

   The lemma states that the risk tolerant agent, i = 1, receives a lower share of aggregate consumption in

the low state than in the high state (as in the first best). Since consumption shares add up to one across

agents, it follows that the risk averse agent, i = 2, enjoys a higher share of aggregate consumption in the low

than in the high state. Intuitively, a consumption allocation which delivers a constant consumption share in

both states to both agents is always strictly incentive feasible: it can be implemented by giving each agent

a share in the market portfolio equal to that consumption share. But the risk tolerant cares relatively less

about the low state, ω1 , and relatively more about the high state, ω2 . Hence, social welfare increases strictly

if the risk tolerant agent, i = 1 insures the more risk averse agent by letting i = 2 have a larger share of

aggregate consumption in the bad state.

   Lemma 3 states that the planner always finds it optimal to pick consumption allocations above the

diagonal of the Edgeworth box. Therefore, the relevant incentive constraint is the upper boundary of the

incentive feasible set in Figure 1. Using Lemma 2, we then obtain our next proposition:

Proposition 5 If c 6= c? , then the incentive compatibility constraint of agent i = 1 binds in state ω1 , while

the incentive compatibility constraint of agent i = 2 binds in state ω2 . Moreover, there exists k ∈ [0, 1] and

                                                           28
(∆N1 , ∆N2 ) ≥ 0, ∆N1 + ∆N2 = N̄k − N̄k− , such that agent i = 1 holds all assets j < k, i.e.,



                                             N1 = N̄ I{j<k} + ∆N1 I{j=k}



and agent i = 2 holds all assets j > k, i.e.,



                                             N2 = N̄ I{j>k} + ∆N2 I{j=k} .



   Lemma 2 stated that a consumption allocation was incentive feasible if and only if it could be implemented

by allocating the riskier trees to the more risk tolerant agent and the safer trees to the more risk averse

agent. In line with that result, Proposition 5 states that, in equilibrium, the binding incentive constraints

of the more risk tolerant agent in the bad state, and the more risk averse agent in the good state, pin down

such an allocation. This equilibrium allocation can be interpreted in terms of segmentation, as different

classes of investors hold different types of assets. Thus, Proposition 5 is in line with the empirical finding

that households’ participation to stock markets is limited (see Vissing-Jørgensen (2002)), if one interprets

the more risk averse agents in our model as households and the relatively risky trees in our model as stocks.20

   The proposition is illustrated in Figure 2. In the figure, the “incentive-constrained Pareto set” and

the “unconstrained Pareto set” are, respectively, the set of consumption allocations obtained by solving

the incentive-constrained and the constrained Planner’s problem for all possible weights (α1 , α2 ) ∈ [0, 1]2 ,

α1 +α2 = 1. The incentive-constrained Pareto set coincides with the unconstrained Pareto set when the latter

lies below the upper boundary of the incentive-feasible set. Otherwise, the incentive-constrained Pareto set

coincides with the IC boundary. As α1 /α2 increases, then the constrained Pareto efficient allocation moves

monotonically to the northeast of the Edgeworth box.

   The above discussion is in terms of the Pareto weigths (α1 , α2 ) for the social planner’s problem. The fol-

lowing proposition shows how it maps into a discussion of the initial endowments (n̄1 , n̄2 ) for the equilibrium

implementing the second best.

  20 In contrast with asset pricing models in which households are assumed not to hold risky assets, in our model this is an

equilibrium outcome.




                                                            29
                                                                                                    constrained Pareto set
                                                                                                    unconstrained Pareto set
                                                                                                    incentive feasible boundary




                              consumption share of risk tolerant in state ω2
                                                                                1


                                                                               0.8


                                                                               0.6


                                                                               0.4


                                                                               0.2


                                                                                0
                                                                                     0        0.2        0.4       0.6        0.8         1
                                                                                         consumption share of risk tolerant in state ω1

          Figure 2: The set of incentive-feasible and the set of incentive-constrained Pareto allocation, when
          π(ω1 ) = 0.9, γ1 = 0.1, γ2 = 1, and δ = 0.5. In the many-trees case, tree supplies are distributed
          according to a beta distribution with parameters a = b = 15. In the one-tree case, there is just one tree
          equal to the market portfolio of the many-trees case.



Proposition 6 The ratio of endogenous Pareto weights, α1 /α2 , is strictly increasing in the ratio of initial

endowment n̄1 /n̄2 .


   Thus, while Figure 2 reveals that incentive compatibility does not matter for extreme values of α1 /α2 ,

Proposition 6 enables one to restate this observation in terms of the distribution of initial endowments.

When this distribution is very unequal, as agents i = 1 are initially endowed with a very large fraction of the

market portfolio (n̄1 /n̄2 large), or agents i = 2 are initially endowed with a very large fraction of the market

portfolio (n̄1 /n̄2 low), there is little scope for risk sharing between the two types of agents. Thus, even the

unconstrained equilibrium involves little trading, so that incentive constrains don’t bind (as is the case in

Figure 2 in the north east and the south west of the Edgeworth box). In contrast, when the distribution

of initial endowments is more equal (n̄1 close to n̄2 ) the scope for risk sharing is large. In that case the

incentive constrained equilibrium allocation differs significantly from its unconstrained counterpart (as is

the case in Figure 2 in the north west of the Edgeworth box). Correspondingly, the basis is zero when the

distribution of endowments is very unequal, while it can be strictly positive when initial endowments are

equally distributed.




                                                                                                         30
5.3    Relative Supply Effects

In our model, the relative supply of trees (i.e., the distribution N̄j ) determines equilibrium outcomes, by

changing the shape of the incentive feasible set. Changing the relative supplies of trees changes equilibrium

outcomes even if it does not change aggregate output and pledgeable income in each state, nor the span

of the trees’ payoff matrix. This is in sharp contrast with the complete markets case, in which the set of

feasible allocations is not affected by the way the aggregate output is split across trees.

   As an illustration, compare an economy with just one tree (the “market portfolio”) to another economy

in which there are two trees, one paying off only in the good state, the other paying off only in the bad state.

To reason ceteris paribus, the aggregate output is the same in each state in the two economies. If incentive

problems are severe, because δ ' 1, then, when there is only one tree, incentive constraints are more likely

to bind in equilibrium. In contrast, when there are two trees, each paying off only in one state, the second

condition of Proposition 4 holds: all agents can attain their δ = 0 equilibrium consumption just by holding

trees. Hence incentive constraints do not bind, even if δ ' 1.

   When there is a single tree, its consumption β is equal to one, while with two trees one has a lower β

and the other a higher one. The comparison between the single tree economy and its two tree counterpart

suggests that increasing the dispersion of βs relaxes incentive constraints. To make this point, first note that

in our simple two-state case, the consumption β of asset j is affine in j with coefficients that only depend

on the values and probabilities of aggregate dividends. Therefore, the dispersion of βs is increasing in the

dispersion of js.

   To model an increase in the dispersion of the distribution of assets, from N̄ to N̄ ∗ , it is natural to consider

a mean preserving spread, that is a decrease in the sense of second order stochastic dominance:


                                     Z    k            Z   k
                                              N̄j∗ ≥           N̄j ,        for all k ∈ [0, 1],                (24)
                                      0                0



preserving the aggregate output in each state. From equation (21), one sees that aggregate output is preserved




                                                                       31
in each state if and only if:


                                            Z    1                 Z   1
                                                     jdN̄j∗   =            jdN̄j                            (25)
                                             0                     0

                                                       N̄1∗   = N̄1 .                                       (26)



In this context, we obtain the following proposition:


Proposition 7 Consider two tree supply distributions N̄ and N̄ ∗ , such that N̄ ∗ is more dispersed than N̄

in the sense that (24), (25) and (26) hold. If an allocation is incentive feasible for N̄ , then it is incentive

feasible for N̄ ∗ .


    Proposition 7 states that the set of incentive feasible allocations increases as the tree supply distribution

becomes more dispersed, i.e., the dispersion of βs increases. The proposition enables one to revisit and

generalise the intuition obtained by comparing the single tree and two-tree economies: a mean-preserving

spread implies that the supply distribution N̄ ∗ puts more weight on the riskiest trees, and also on the safest

trees, than the distribution N̄ . This implies that the set of trees held by the more risk tolerant agent is

overall riskier, and correspondingly yields smaller dividends in the bad state, which relaxes the incentive

compatibility condition of this agent. Symmetrically, by putting more weight on the safest trees, the supply

distribution N̄ ∗ leads to an overall safer set of trees held by the more risk averse agent. This reduces the

dividends of these trees in the good state, which relaxes the incentive constraint of the more risk averse

agent.

    The tightening of incentive constraints, induced by a decrease in the dispersion of consumption betas,

affects equilibrium pricing. This is illustrated in Figure 3, which plots the equilibrium expected return

on the market portfolio for different dispersions of consumption betas, keeping aggregate output in each

state constant. We consider symmetric beta distributions, and let the log of their shape parameter increase

from 1 to 6, so that their dispersion decreases while their mean remains constant. The figure shows that,

as the dispersion of consumption betas decreases, the expected return of the portfolio of Arrow securities

replicating the market increases, reflecting poorer allocation of risks in the economy. Moreover, as betas get

less dispersed, the basis increases, reflecting the increased shadow costs of incentive constraints. In contrast,


                                                              32
                                                               0.15
                                                                            incentive-constrained market
                                                                            incentive-constrained replicating portfolio
                                                               0.14         unconstrained


                    expected excess return, market portfolio   0.13



                                                               0.12



                                                               0.11



                                                                0.1



                                                      9 · 10−2
                                                                      1   1.5       2       2.5     3        3.5     4      4.5     5   5.5   6
                                                                                      log shape parameter of the beta distribution

          Figure 3: The expected excess return on the market portfolio as the dispersion of security beta decreases.
          Tree supplies are distributed according to a beta distribution with parameters a = b varying from 2.7 to
          403.



by construction, when there are no incentive problems the expected return on the market portfolio is not

affected by changes in the dispersion of betas.



5.4    The Cross Section of Bases

Focus on the case in which incentive compatibility constraints bind. By Proposition 5, there exists a threshold

k, such that the more risk-tolerant agent holds assets j < k, while the more risk-averse agent holds assets

j > k. In this context, from the first-order condition (14), the basis on asset j is


                                                                                X                              µ1 (ω1 )
                                                                                      q(ω)dj (ω) − pj = δ               dj (ω1 ).
                                                                                                                 λ1
                                                                                ω∈Ω



Since only relative prices are pinned down, we express this basis in relative prices, and choose as normalizing

factor (or numeraire) the price of the riskless bond, q(ω1 ) + q(ω2 ). For tree j < k the normalised basis is

thus
                                                                                         h µ (ω )/λ i h              i
                                                                                             1   1   1
                                                                                ∆j =                      × δdj (ω1 ) .                           (27)
                                                                                          q(ω1 ) + q(ω2 )


                                                                                                        33
   The first term in the right-hand side of equation (27) is constant across all assets held by agent 1, and

measures, intuitively, the tightness of the incentive constraint of agent 1. The second term is equal to the

non-pledgeable cash flow of the asset in state ω1 in which the agent holding it is constrained. This term,

and correspondingly the basis, is higher for assets with a relatively large payoff in the bad state and a

relatively low payoff in the high state, that is, assets with a lower consumption beta. The intuition is that

the risk tolerant agent sells insurance against the bad state to the risk averse agent. However, the incentive

compatibility constraint limits the amount of insurance she can sell. Since the consumption of the risk

tolerant agent is low in the bad state, deviating is tempting. It implies that the shadow cost of holding a

tree is higher for trees paying relatively more in the bad state, i.e., for trees with a lower consumption beta.

Remember however that the risk tolerant agent holds trees with a high beta. Therefore, among trees with

a high consumption beta, trees with a moderately high beta have a larger basis than trees with a very high

beta.

   Consider now trees j > k held by agent 2. Following the same reasoning as before, the basis equals


                                            h µ (ω )/λ i h              i
                                                2   2   2
                                     ∆j =                    × δdj (ω2 ) .                                 (28)
                                             q(ω1 ) + q(ω2 )


   Equation (28) implies that, among assets held by the risk averse agent, i = 2, the basis is larger for assets

with a relatively large payoff in the good state and a relatively low payoff in the bad state, that is, with a

higher consumption beta. The intuition is symmetric to the one above. The risk averse agent would like to

sell consumption to the risk tolerant agent in the good state, but it is tempting for the risk averse agent to

deviate in the good state. Thus, the shadow cost of holding a tree is higher for tree with a relatively high

payoff in the good state, that is, for trees with a higher consumption beta. The risk averse agent holds trees

with a low consumption beta. Therefore, among trees with a low beta, those with a moderately low beta

have a larger basis than trees with a very low beta. Putting things together, we conclude that:


Proposition 8 Suppose all trees are in positive supply. Then, the basis induced by incentive constraints is

an inverse U-shape function of the consumption beta of the tree.


   The restriction that all trees are in positive supply ensures that prices are uniquely determined. Intu-


                                                      34
                                                          0.3          Arrow securities
                                                                       Trees




                                 expected excess return
                                                          0.2




                                                          0.1




                                                           0
                                                                 0.2     0.4   0.6   0.8    1   1.2   1.4   1.6
                                                                                     beta

                                                           Figure 4: The Modified Security Market Line



itively, the proposition means that, after adjusting for risk, trees with either a low or a large consumption

beta will tend to have a high price, and a low return. This is illustrated in Figure 4. The figure shows the

security market line (SML) in our environment, which we derive explicitly in Proposition B.1 in Supplemen-

tary Appendix B.8. Since assets are held by agents who value them most, the SML is the minimum between

the SML obtained from agent i = 1’s valuation, and that derived from agent i = 2’s valuation. The kink

in the figure occurs at asset k, for which ownership switches from agent 1 to agent 2. The figure illustrates

that, because the basis is inverse-U shaped in β, the SML is flatter at the top and steeper at the bottom, in

line with Black (1972), and recent evidence in Frazzini and Pedersen (2014) and Hong and Sraer (2016).



5.5     Response to Shocks on Incentive Problems

To model shocks on incentives, fix a tree ` < k and consider a small increase in δ for tree ` and possibly

nearby trees. Formally, assume δj = δ + εφj for some continuous function φj strictly positive near `, and

zero everywhere else.21 The shock worsens incentive problems for tree ` (and neighbouring trees). What is

the effect of this shock on allocations?


Proposition 9 Assume that the cumulative distribution of trees is continuous and strictly increasing, that

c 6= c? , and that k ∈ (0, 1). The ε shock shrinks the set of trees held by agent 1: k(ε) < k(0) for small ε > 0.
  21 All of our results extend to this case. In fact, our proofs in the appendix cover the case of δ which are continuously varying

across agents and asset types.




                                                                                35
    When agent 1 becomes slightly worse at pledging a tree he already holds, the shadow value of his

incentive-compatibility constraint increases, which makes it more costly for agent 1 to hold any tree. Thus,

in equilibrium, the set of trees [0, k) held by agent 1 shrinks. This means that agent i = 1 sells the safest

assets in his portfolio, while keeping the riskiest ones. This might sound counter-intuitive if one expected

that, when an agent’s incentive problems become more severe, he should sell his riskiest assets. The result

arises because, even after the shock, agent i = 1 is still in a better position to hold very risky assets than

the more risk averse agent i = 2. Thus, as the shock reduces agent i = 1’s ability to hold assets overall, he

divests those for which his comparative advantage is the lowest.

    Now turn to the effect of the shock on prices. Equations (27) and (28) imply that when agent i = 1

becomes a worse pledger for tree `, the basis of tree ` increases relative to the bases of other trees j held by

i = 1 (that have not been directly hit by the shock), which themselves increase relative to the bases of trees

j 0 held by i = 2. That is
                                           ∆` (ε)   ∆j (ε)   ∆j 0 (ε)
                                                  >        >
                                           ∆` (0)   ∆j (0)   ∆j 0 (0)

Thus, co-movement in the basis induced by incentive constraints is stronger among assets held by the same

type of agents.




6     Conclusion

We introduce incentive compatibility constraints, limiting the pledgeability of collateral, in an otherwise

standard general equilibrium model. In each state, agents can’t pledge more than a fraction of the payoff

from their holdings in that state. Hence, although a complete set of Arrow securities are available for

trade, limited collateral pledgeablity reduces the ability of relatively risk tolerant agents to credibly promise

insurance payments to more risk averse agents.

    Thus, markets are endogenously incomplete. To cope with such incompleteness, relatively risk averse

agents hold low beta assets, while relatively risk tolerant agents hold high beta assets. This reflects the risk

tolerant agents’ comparative advantage at holding risky assets. Correspondingly, the market is endogenously

segmented. When hit by an adverse shock on incentives, agents must sell some of their holdings, which is



                                                       36
not unexpected. More surprisingly, relatively risk tolerant agents sell their safest assets, not their riskiest

ones. This is because, while the shock reduces their ability to hold all assets, it does not eliminate their

comparative advantage at holding the riskiest ones.

   Incentive compatibility constraints also affect equilibrium pricing. They generate a basis between the

prices of risky assets and those of replicating portfolios of derivatives (in spite of the fact that risky assets

and derivatives are equally imperfectly pledgeable). The basis always goes in the same direction: the price

of risky assets is below that of replicating derivative portfolios. Arbitraging the basis would imply buying

the “cheap” risky assets, and selling the “expensive” derivatives, but the latter sale is ruled out by incentive

compatibility. The structure of the basis is such that equilibrium expected excess returns are concave in

consumption betas, in line with empirical findings. Moreover an increase in the dispersion of consumption

betas relaxes incentive constraints, which reduces the basis. The latter two results are related. The concavity

of the security market line reflects that assets with extreme betas are more valuable because they enable

agents to share risk without creating incentive problems. An increase in the dispersion of consumption betas

increases the prevalence of assets with extreme betas, which relaxes incentive constraints in equilibrium.




                                                       37
References

Rao Aiyagari and Mark Gertler. Overreaction of asset prices in general equilibrium. Review of Economic

  Dynamics, 2:3–35, 1999. 7


Charalambos D. Aliprantis and Kim C. Border. Infinite Dimensional Analysis, A Hitchiker’s Guide. Springer,

  1999. 68


Fernando Alvarez and Urban J. Jermann. Efficiency, equilibrium, and asset pricing with risk of default.

  Econometrica, 68:775–797, 2000. 6, 7, 19, 23


Gregor Andrade and Steven N. Kaplan. How costly is financial (not economic) distress? evidence from

  highly leveraged transactions that became distressed. Journal of Finance, 53:1443–1493, 1998. 2


Jennie Bai and Pierre Collin-Dufresne. The cds-bond basis. Working paper, 2013. 22


Fisher Black. Capital market equilibrium with restricted borrowing. Jounal of Business, 3(444-455), 1972.

  5, 35


Patrick Bolton and David S. Scharfstein. A theory of predation based on agency problems in financial

  contracting. American Economic Review, 80:93–106, 1990. 2, 11


Arturo Bris, Ivo Welch, and Ning Zhu. The costs of bankruptcy: Chapter 7 liquidation versus chapter 11

  reorganization. Journal of Finance, 61:1253–1303, 2006. 2


Johannes Brumm, Michael Grill, Felix Kubler, and Karl Schmedders. Collateral requirements and asset

  prices. International Economic Review, 56:1–25, 2015. 7, 8


John Y. Campbell, Stefano Giglio, and Parag Pathak. Forced sales and house prices. American Economic

  Review, 101:2108–2131, 2011. 2


Yili Chien and Hanno Lustig. The market price of aggregate risk and the wealth distribution. Review of

  Financial Studies, 23:1596–1650, 2009. 6, 7


Daniele Coen-Pirani. Margin requirement and equilibrium asset prices. Journal of Monetary Economics, 52:

  449–475, 2005. 7

                                                   38
Sergei A. Davydenko, Ilya A. Strebulaev, and Xiaofei Zhao. A market-based study of the cost of default.

  Review of Financial Studies, 25:2959–2999, 2012. 2


Peter M. DeMarzo and Michael J. Fishman. Optimal long-term financial contracting. Review of Financial

  Studies, 20:2079–2128, 2007. 2, 11


Peter M. DeMarzo and Yuliy Sannikov.        Optimal security design and dynamic capital structure in a

  continuous-time agency model. Journal of Finance, 61:2681–2724, 2006. 2, 11


Chris Edmond and Pierre-Olivier Weill. Aggregate implications of micro asset market segmentation. Journal

  of Monetary Economics, 59:319–335, 2012. 23


Michael J. Fleming and Asani Sarkar. The failure resolution of lehman brothers. FRBNY Economic Policy

  Review, December:175–206, 2014. 2


Ana Fostel and John Geanakoplos. Leverage cycles and the anxious economy. American Economic Review,

  98:1211–44, 2008. 7, 8, 22, 23


Andrea Frazzini and Lasse Hejee Pedersen. Betting agaisnt beta. Journal of Financial Economics, 111:1–25,

  2014. 5, 35


Nicolae Gârleanu and Lasse Heje Pedersen. Margin-based asset pricing and deviations from the law of one

  price. Review of Financial Studies, 24(6):1980–2022, 2011. 7, 21


John Geanakoplos and William R. Zame. Collateral equilibrium, i: a basic framework. Economic Theory,

  56:443–492, 2014. 7, 8


Piero Gottardi and Felix Kubler. Dynamic competitive economies with complete markets and collateral

  constraints. Review of Economic Studies, 82:1119–1153, 2015. 6, 15


Denis Gromb and Dimitri Vayanos. Equilibrium and welfare in markets with financially constrained arbi-

  trageurs. Journal of financial Economics, 66(2):361–407, 2002. 7, 8


Denis Gromb and Dimitri Vayanos. The dynamics of financially constrained arbitrage. Journal of Finance,

  Forthcoming, 2017. 7, 8


                                                    39
Zhiguo He and Arvind Krishnamurthy. Intermediary asset pricing. American Economic Review, 103:732–770,

  2013. 24


Ayman Hindy and Ming Huang. Asset pricing with linear collateral constraints. Technical report, Stanford

  University, 1995. 7


Bengt Holmström and Jean Tirole. Financial intermediation, loanable funds, and the real sector. The

  Quarterly Journal of Economics, 112:663–691, 1997. 2, 11


Bengt Holmström and Jean Tirole. Lapm: A liquidity-based asset pricing model. Journal of Finance, 56:

  1837–1867, 2001. 6


Harrison Hong and David Sraer. Speculative beta. Journal of Finance, Forthcoming, 2016. 5, 35


Thomas H. Jackson, Kenneth E. Scott, Kymberly Anna Summe, and John B. Taylor. Resolution of failed

  financial institututions: orderly liquidation authority and a new chapter 14. Technical report, Hoover

  Institution, Stanford University, 2011. 2


Nicolas L. Jacquet. Asset classes. Technical report, Singapore Management University, 2015. 8


Timothy J. Kehoe and David K. Levine. Debt-constrained asset markets. Review of Economic Studies, 60:

  865–888, 1993. 6, 15


Timothy J. Kehoe and David K. Levine. Liquidity constrained markets versus debt constrained markets.

  Econometrica, 69:575–598, 2001. 6


Nobuhiro Kiyotaki. Credit and business cycles. The Japanese Economic Review, 49:18–35, 1998. 2


Nobuhiro Kiyotaki and John Moore. Credit cycles. Journal of Political Economy, 105:211–248, 1997. 2


Ricardo Lagos. Asset prices and liquidity in an exchange economy. Journal of Monetary Economics, 57:913

  – 930, 2010. 8


Benjamin Lester, Andrew Postlewaite, and Randall Wright. Information, liquidity, asset prices, and monetary

  policy. Review of Economic Studies, 79:1208–1238., 2012. 8



                                                    40
Yiting Li Li, Guillaume Rocheteau, and Pierre-Olivier Weill. Liquidity and the threat of fraudulent assets.

  Journal of Political Economy, 120:815–846, 2012. 8


David Luenberger. Optimization by vector space methods. John Wiley & Son, 1969. 18, 44, 45, 46


Michael J. P. Magill. An equilibrium existence theorem. Journal of Mathematical Analysis and Applications,

  84:162–169, 1981. 16, 47


Andreu Mas-Colell and William R. Zame. Equilibrium theory in infinite dimensional spaces. In Handbook

  of Mathematical Economics, volume IV, chapter 34, pages 1835–1898. Elsevier, 1991. 16


Paul Milgrom and Ilya Segal. Envelope theorems for arbitrary choice sets. Econometrica, 70:583–601, 2002.

  44, 63


Takashi Negishi.     Welfare economics and existence of an equilibrium for a competitive economy.

  Metroeconomica, 12:92–97, 1960. 15, 16, 47


Edward C. Prescott and Robert M. Townsend. Pareto optima and competitive equilibria with adverse

  selection and moral hazard. Econometrica, 52:21–46, 1984. 15


Adriano A. Rampini and S. Vishwanathan. Household risk management. NBER Working Paper 22293, 2017.

  7


Tyrrrell R. Rockafellar. Convex Analysis. Princeton University Press, 1970. 62


Nancy L. Stokey and Robert E. Lucas. Recursive Methods in Economic Dynamics. Harvard University

  Press, 1989. 43, 44, 58, 64


Venky Venkateswaran and Randall Wright. Pledgability and liquidity: A new monetarist model of financial

  and macroeconomic activity. 2013. 8


Annette Vissing-Jørgensen. Limited asset market participation and the elasticity of intertemporal substitu-

  tion. Journal of Political Economy, 110(4):825–853, 2002. 29




                                                    41
A      Appendix: Proofs

In this appendix we prove all of our results for the generalized model in which δ depends on the agent and (continu-

ously) on the tree type. That is, for each, i ∈ I, the function j 7→ δij is continuous.



A.1      Proof of Proposition 1

Let (c, N ) denote an equilibrium allocation with associated price system (q, p). Suppose it is Pareto dominated by

some other incentive-feasible allocation (ĉ, N̂ ). Then, because utility is strictly increasing, ĉi must lie strictly outside

the budget set of all agents for which Ui (ĉi ) > Ui (ci ). Otherwise, these agents would have a strict incentive to switch

to ĉi . Likewise, ĉi must lie weakly outside the budget set set of all agents for which Ui (ĉi ) = Ui (ci ). Otherwise,

these agents would have strict incentive to increase their consumption in some state, which would respect incentive

compatibility. Taken together, we obtain:


                            X                        Z                      Z                 Z X
                                  q(ω)ĉi (ω) +            pj dN̂ij ≥ n̄i        pj dN̄j +                   q(ω)dj (ω) dN̂ij ,
                            ω∈Ω                                                                    ω∈Ω



with a strict inequality for all i ∈ I such that Ui (ĉi ) > Ui (ci ). Adding up across all agents we obtain that:

                                     (                                            )                (                        )
                        X                X                 XZ                             Z            X
                              q(ω)             ĉi (ω) −          dj (ω) dN̂ij        +       pj             dN̂ij − dN̄j       > 0,
                        ω∈Ω              i∈I               i∈I                                         i∈I



which contradicts the feasibility of (ĉ, N̂ ).



A.2      Proof of Proposition 2

Our proof of existence proceeds as follows. In Section A.2.1 we define the Planner’s Problem, we study some of

its elementary properties, and we derive necessary and sufficient optimality conditions for a solution. In Section

A.2.2, we turn to the equilibrium and derive first-order necessary and sufficient conditions for a solution to the

agent’s problem. Comparing the first-order conditions for the Planner and for the agent, in Section A.2.3 we show

an equivalence between the set of equilibrium allocations, and the set of solutions to the Planner’s problem with zero

wealth transfers. We then establish the existence of a solution to the Planner’s problem with zero wealth transfer.

Omitted proofs are in Supplementary Appendix B.

    In what follows we identify any measure with its cumulative distribution function. That is, we identify M+

with the set of increasing and right-continuous functions over [0, 1]. We denote by M the vector space of functions



                                                                            42
which can be written as F = F1 − F2 , where both F1 and F2 belong to M+ . We endow M with the total variation

norm. Given any sequence N k ∈ M, we said that N k converges strongly towards N , and write N k → N , if

limk→∞ kN k − N k = 0. We say that N k converges weakly towards N , and write N k ⇒ N , if                fj dNjk →
                                                                                                      R               R
                                                                                                                          fj dNj

for all continuous real-valued functions j 7→ fj over [0, 1]. A set of allocations K is said to be weakly closed if for any

weakly converging sequence (ck , N k ) ∈ K, i.e. such that ck → c and N k ⇒ N , then the limit of the sequence belongs

to K, i.e., (c, N ) ∈ K. The set K is said to be weakly compact if for any sequence (ck , N k ) ∈ K, there exist some

subsequence (c` , N ` ) and some (c, N ) ∈ K such that c` → c and N ` ⇒ N .



A.2.1     The Planner’s Problem

                                                                                                               P
Let A denote the simplex, i.e., the set of welfare weights α ≡ (α1 , α2 , . . . , αI ) such that αi ≥ 0 and      i∈I   αi = 1.

Given any α ∈ A, and given any (c, N ) ∈ X, social welfare is defined as


                                                          X          X
                                         W (α, c, N ) ≡         αi         π(ω)ui [ci (ω)] .
                                                          i∈I        ω∈Ω



In the above formula, when ui (0) = −∞, we let αi ui [ci (ω)] = 0 if αi = ci (ω) = 0.

   Given weight α ∈ A, the Planner’s Problem is:



                                                 W ? (α) = sup W (α, c, N )                                                 (29)



with respect to incentive-feasible allocations, i.e., with respect to (c, N ) ∈ X satisfying (6), (8) and (9). We let Γ? (α)

denote the set of allocations solving (29). To show the existence of a solution, we rely on:


Lemma A.1 The set of incentive feasible allocations is weakly compact.


The proof relies on Helly’s Selection Theorem (Theorem 12.9 in Stokey and Lucas (1989)) which allows to extract

weakly convergence subsequences from bounded sequences in M+ . The feasibility and incentive compatibility con-

straints hold in the limit by definition of weak convergence. We add to the argument in Stokey and Lucas (1989) by

showing that the feasibility constraint for asset holdings is also satisfied in the limit. With this result in mind, we

show in the supplementary appendix:


Proposition A.1 The planner’s value W ? (α) is a continuous function of α ∈ A, and the maximum correspondence

Γ? (α) is non-empty, weakly compact, convex, and has a weakly closed graph. Moreover, consider any sequence αk → ᾱ

and an associated sequence of optimal allocations (ck , N k ) ∈ Γ? (αk ). Then, if ᾱi = 0, limk→∞ αik u0 cki (ω) cki (ω) = 0
                                                                                                                



                                                                43
for all ω ∈ Ω.


If ui (0) = 0 for all i ∈ I, the result follow from the same argument as in the proof of the Theorem of the Maximum

(see, for example, Theorem 3.6 in Stokey and Lucas (1989)). If ui (0) = −∞ for some i, then we need to adapt the

argument because the social welfare function is not continuous at (α, c, N ) such that αi = ci (ω) = 0. Likewise, the

result concerning αik u0 cki (ω) cki (ω) = 0 is obvious if ui (0) = 0, but requires some additional work when ui (0) = −∞.
                               


   To compare equilibria with solutions of the Planner’s Problem, we rely on first-order conditions. We first derive

necessary conditions. To do so, we cannot apply the Lagrange multiplier theorems of Luenberger (1969), because

they do not accommodate equality constraints. Even if we consider a “relaxed problem” where equality constraints

are replaced by inequality constraints, the theorems do not apply because the relevant positive cone has an empty

interior. We therefore exploit the structure of the problem to derive first-order conditions by hand. To do so we

consider, for any N , the maximized objective with respect to c. We then use an Envelope Theorem of Milgrom and

Segal (2002) to explicitly calculate the directional derivative of this maximized objective with respect to N . We

obtain:


Proposition A.2 Suppose (c, N ) ∈ X solves the Planner’s problem given α ∈ A. Then there exists multipliers
     |Ω|             |Ω|×|I|
q̂ ∈ R+ and µ̂ ∈ R+            such that (c, N ) satisfies two sets of conditions.

   • First-order conditions:



                                         αi π(ω)u0i [ci (ω)] + µ̂i (ω)           =       q̂(ω),   ∀(i, ω) ∈ I × Ω
                                                Z
                                                     [p̂j − v̂ij ] dNij          =       0,


                     P                          P
      where v̂ij ≡     ω∈Ω     q̂(ω)dj (ω) −          ω∈Ω   µ̂i (ω)δij dj (ω), and p̂j ≡ maxi∈I v̂ij .

   • Complementary slackness conditions:

                                            "                                            #
                                                XZ                       X
                                    q̂(ω)               dj (ω) dNij −           ci (ω)        =   0   ∀ω ∈ Ω
                                                i∈I                       i∈I
                                                       Z                
                                        µ̂i (ω) ci (ω) − δij dj (ω) dNij                      =   0   ∀(i, ω) ∈ I × Ω.



Although the above conditions are also sufficient, it is convenient to state more general sufficient conditions, where p̂

is taken to be some abstract continuous linear functional. This allows to show that any equilibrium is a solution to

the Planner’s Problem, even if the pricing functional cannot be represented by a continuous function. Then, using the



                                                                          44
necessary conditions derived in Proposition A.2, one can show that the same equilibrium allocation can be supported

by a pricing functional represented by a continuous function, establishing the claim in footnote 12.


Proposition A.3 An incentive-feasible allocation (c, N ) ∈ X solves the Planner’s problem if there exist multipliers
     |Ω|       |Ω|×|I|
q̂ ∈ R+ , µ̂ ∈ R+        , and a continuous linear functional p̂ satisfying the following two sets of conditions.

   • First-order conditions:



                         αi π(ω)u0i [ci (ω)] + µ̂i (ω)         =    q̂(ω),      ∀(i, ω) ∈ I × Ω
                                         Z
                              p̂ · M − v̂ij dMij               ≥    0    ∀Mi ∈ M+ and i ∈ I, with “ = ” if M = Ni ,


                     P                         P
      where v̂ij ≡   ω∈Ω     q(ω)dj (ω) −            ω∈Ω   µi (ω)δij dj (ω).

   • Complementary slackness conditions:

                                           "                                             #
                                               XZ                         X
                                   q̂(ω)               dj (ω) dNij −            ci (ω)       =   0   ∀ω ∈ Ω
                                               i∈I                        i∈I
                                                       Z                
                                        µ̂i (ω) ci (ω) − δij dj (ω) dNij                     =   0   ∀(i, ω) ∈ I × Ω.



A.2.2      Optimality conditions for the Agent’s Problem

Notice that the range of the constraint set in the agent’s problem is finitely dimensional. In this case, the “interior

point condition” for the positive cone associated with the constraint set is immediately satisfied and so one can apply

the general Lagrange multiplier theorems shown in Section 8.3 and 8.4 of Luenberger (1969).


Proposition A.4 A (ci , Ni ) ∈ Xi solve the agent’s problem if and only if it satisfies the intertemporal budget
                                                                                                                        |Ω|
constraint, (7), the incentive compatibility constraint (6), and there exists multipliers λi ∈ R+ , µi ∈ R+ satisfying

the following two sets of conditions:

   • First-order conditions:



                                π(ω)u0i [ci (ω)] + µi (ω)           =    λi q(ω)
                                   Z
                                       (pj − vij ) dMij             ≥    0      ∀Mi ∈ M+ , with “ = ” if Mi = Ni ,


                     P                         P           µi (ω)
      where vij ≡    ω∈Ω     q(ω)dj (ω) −            ω∈Ω    λi
                                                                  δij dj (ω).




                                                                           45
    • Complementary slackness conditions:

                                   "    Z                              Z                         Z                                #
                                                          X                                                      X
                               λi n̄i       pj dN̄j +           q(ω)       dj (ω) dNij −             pj dNij −         q(ω)ci (ω) = 0
                                                          ω∈Ω                                                    ω∈Ω
                                             Z               
                               µi (ω) ci (ω) − δij dj (ω) dNij = 0                      ∀ω ∈ Ω.



    There is one difference between this Proposition and the Theorems shown in Section 8.3 and 8.4 of Luenberger

(1969): we are asserting that there exists multipliers such that the first-order condition with respect to ci (ω) holds

with equality. This follows from the following observation: if ci (ω) = 0, then the incentive compatibility constraint
                              R
is binding, in particular         δij dj (ω) dNij = 0. Therefore, if we raise µi (ω) so that the first-order condition holds
                                                     R                                                                                    R
with equality, we leave the product µi (ω)               δij dj (ω) dNij = 0 unchanged, which implies that p · Ni −                           vij dNij = 0
                                                                                             R
continues to hold. Finally, since raising µi (ω) decreases vij , p · Mi −                        vij dMij remains positive. Taken together, this

means that we can always pick multipliers so that the first-order condition with respect to ci (ω) holds with equality.

    Finally, the following result provide a simple relationship between the value of the agent’s endowment, and the

marginal value of his consumption plan. This formula will be useful shortly to formulate the equilibrium fixed-point

equation.


Lemma A.2 If (ci , Ni ) ∈ Xi solves the agent’s problem, then


                                            X                                            Z
                                                  π(ω)u0 [ci (ω)] ci (ω) = λi n̄i            pj dN̄j .
                                            ω∈Ω



    The proof of the Lemma goes as follows. A solution to the agent’s problem, (ci , Ni ), maximizes the Lagrangian:

                                                    "                               Z                                                 #
                                                                       X                                               X
                L(ĉi , N̂i ) = Ui (ĉi )   +     λi n̄i p · N̄ +            q(ω)       dj (ω) dN̂ij − p · N −               q(ω)ci (ω)
                                                                       ω∈Ω                                             ω∈Ω
                                                  X                     Z                
                                            +            µi (ω) ĉi (ω) − δij dj (ω) dN̂ij ,
                                                  ω∈Ω



with respect to (ĉi , N̂i ) ∈ Xi . This implies that the function β 7→ L(βci , βNi ) is maximized at β = 1. Taking

first-order condition with respect to β at β = 1, and using the complementary slackness conditions, yields the desired

result.



A.2.3       Existence of a Planner’s Solution with Zero Wealth Transfer

By comparing the first-order conditions of the Planner and of the agent, we obtain:



                                                                           46
Proposition A.5 An allocation (c, N ) ∈ X is an equilibrium allocation if and only if there exists α ∈ A such that:

    • (c, N ) solves the Planner’s problem given α;

                                  π(ω)u0i [ci (ω)] ci (ω) = n̄i                        π(ω)u0k [ck (ω)] ck (ω).
                          P                                        P         P
    • For all i ∈ I, αi     ω∈Ω                                        k∈I     ω∈Ω


In particular, given a solution of the Planner’s problem satisfying the above two conditions, an equilibrium price

system is given by the multipliers (q̂, p̂) of Proposition A.2.


Intuitively, comparing the first-order conditions of the Planner and of the agent reveals that the weight αi must be

proportional to 1/λi , the inverse of the Lagrange multiplier on the agent’s budget constraint. It then follows from

Lemma A.2 that, for all agents i ∈ I:

                                                                          "     #−1 Z
                                         X                                 X 1
                                    αi         π(ω)u0i   [ci (ω)] = n̄i ×          × pj dN̄j .
                                         ω∈Ω
                                                                             λk
                                                                             k∈I


                                                     P
The second condition then follows because                i∈I   n̄i = 1. The final result about the price system follows from direct

comparison of the first-order conditions of the agent and the planner.

   We are now ready to establish the existence of an equilibrium. Let ∆? (α) denote the set of transfers {∆?i (α)}i∈I

such that:
                                         X                                       X          X
                          ∆?i (α) ≡ αi         π(ω)u0i [ci (ω)] ci (ω) − n̄i           αk         π(ω)u0k [ck (ω)] ck (ω),                   (30)
                                         ω∈Ω                                     k∈I        ω∈Ω


generated by all (c, N ) ∈ Γ? (α), with the convention that αi u0i (c)c = 0 if αi = c = 0. Using the Kakutani’s fixed-point

Theorem, as in Negishi (1960) and Magill (1981), we can show:


Proposition A.6 There exists some α ∈ A, such that 0 ∈ ∆? (α).


Based on some α ∈ A, using Proposition A.5, we can construct an equilibrium allocation and price system.



A.3      Proof of Proposition 3

Step 1: The equation 0 ∈ ∆? (α) has a unique solution. Since the utility function of agent i = 2 is strictly
                                                                                                                             R
concave, its allocation is uniquely determined in the Planner’s problem. But since c1 (ω) + c2 (ω) =                             dj (ω) dN̄j , the

consumption allocation of agent 1 is also uniquely determined. Hence ∆? (α), defined in equation (30), is a function

and not a correspondence. Moreover since ∆?1 (α) + ∆?2 (α) = 0 by construction and α1 + α2 = 1 by assumption, it is

enough to look for a solution of ∆?1 (α1 , 1 − α1 ) = 0. That is, solving for equilibrium boils down to a one-equation in




                                                                       47
one-unknown problem. To formulate this problem in simple terms, let


                                                                   X
                                                     MUi (ci ) ≡       π(ω)u0i [ci (ω)] ci (ω).
                                                                   ω



Notice, that with CRRA utility, MUi (ci ) = (1 − γi )Ui (ci ) for γi 6= 1, and MUi (ci ) = 1 for γi = 1. With this notation,

the one-equation-in-one-unknown problem for equilibrium is:



                                                     n̄2 α1 MU1 (c1 ) − n̄1 α2 MU2 (c2 ) = 0,                            (31)



where (c1 , c2 ) is the consumption allocation chosen by the planner given weight α ∈ A. We already know from

Proposition A.6 that this equation has a solution. Our proof of uniqueness is based on the following observation.


Lemma A.3 For any α0 and α such that α10 > α1 ,



                                                U1 (c01 ) ≥ U1 (c1 ) and U2 (c02 ) ≤ U2 (c2 )

                                          MU1 (c01 ) ≥ MU1 (c1 ) and MU2 (c02 ) ≤ MU2 (c2 )



for all c ∈ Γ? (α) and c0 ∈ Γ? (α0 ).


The proof can be found in the Supplementary Appendix. The inequalities on the first line are intuitive: when the

weight on agent 1 increases, then his or her utility increases and that of agent 2 decreases. The inequalities on the

second line follows directly because of CRRA utility with coefficient γi ∈ [0, 1], which imply that µi (c) = (1−γi )Ui (c).

With this in mind we go back to the equilibrium equation (31). Let α denote some solution, and consider any α0 6= α,

for example such that α10 > α1 . Let c and c0 denote the consumption allocations associated with α and α0 . Then,



           n̄2 α10 MU1 (c01 ) − n̄1 α20 MU2 (c02 )

       =   n̄2 α10 MU1 (c01 ) − n̄1 α20 MU2 (c02 ) − n̄2 α1 MU1 (c1 ) + n̄1 α2 MU2 (c2 )

           n̄2 α10 MU1 (c01 ) − MU1 (c1 ) − n̄1 α20 MU2 (c02 ) − MU2 (c2 ) + α10 − α1 [n̄2 MU1 (c1 ) + n̄1 MU2 (c2 )] > 0.
                                                                                 
       =



In the above, the second line follows from subtracting n̄2 α1 MU1 (c1 ) − n̄1 α2 MU2 (c2 ) = 0 since α was assumed to solve

(31). The third line follows from re-arranging terms and keeping in mind that α10 − α1 = α2 − α20 . The inequality

follows from Lemma A.3, and from the fact that marginal utilities are strictly positive. Vice versa, if we consider

some α0 6= α such that α10 < α1 , we obtain that the equilibrium equation (31) is strictly negative. Therefore, the


                                                                        48
equation for the weight, α, has a unique solution.


Step 2: the various uniqueness claims. Consider any equilibrium allocation, (c, N ), and price system, (p, q).

From Proposition A.5, we know that (c, N ) solves the Planner’s given the unique set of weights such that ∆? (α) = 0.

But, as argued above, the consumption allocation is uniquely determined in the Planner’s problem. Hence, it follows

that the equilibrium allocation is uniquely determined in an equilibrium as well. Next, by direct comparison of first-

order conditions, one sees that (c, N ) solve the first-order conditions of the Planner’s problem with weights αi = β/λi ,

multipliers q̂(ω) = βq(ω), µ̂i (ω) = αi µi (ω), v̂ij = βvij and p̂j = βpj , where λi is the Lagrange multiplier on agent’s i
                             P               −1
budget constraint, and β ≡       k∈I   1/λk         . But from the first-order conditions of the Planner’s problem, and given

that c is uniquely determined, it follows that q̂(ω), µ̂(ω) and v̂(ω) are uniquely determined as well. Clearly, this

implies that the price of Arrow securities, q, and the private asset valuations, v, are uniquely determined up to the

multiplicative constant 1/β. Now turning to the price of assets, we note that the first-order condition of the agent’s

problem imply that pj = vij for almost all assets held by i. Since the private valuations are uniquely determined up

to the multiplicative constant 1/β, the same property must hold for the price assets N̄ -almost everywhere.



A.4      Proof of Proposition 4

The first bullet point of Proposition 4 follows directly from Lemma ??. Indeed, the second condition (11) of Lemma

?? holds by construction since δij ∈ [0, 1).

   Next, consider the second bullet point. It is well known that, in this case, in a δ = 0-equilibrium, agents have
                                                                                    P                                  P
constant consumption share. That is, there exists some {αi }i∈I such that               i∈I   αi = 1 and ci (ω) = αi   j∈J   dj (ω)

for all i ∈ I. One then immediately sees that nδij = αi satisfies the two conditions of Lemma ?? for any δ > 0.



A.5      Proof of Lemma 2

As before we state proofs for our results when δij is assumed to depend both on the type of agent holding the asset

and on the type of the asset. In this case, the Proposition holds under the additional restriction that:


                                                             δ1j dj (ω1 )
                                                                          ,                                                   (32)
                                                             δ2j dj (ω2 )




                                                                  49
is strictly increasing. Notice that this restriction is automatically satisfied whenever δ1j = δ2j for all j. The

generalization of (22)-(23) is

                                                            Z
                                          c1 (ω1 )      ≥                 δ1j dj (ω1 )dN̄j + δ1k dk (ω1 )∆N1                              (33)
                                                                j∈[0,k)
                                                            Z
                                          c2 (ω2 )      ≥                 δ2j dj (ω2 )dN̄j + δ2k dk (ω2 )∆N2 .                            (34)
                                                                j∈(k,1]




The “if” part of the Proposition. Pick the smallest possible k and the largest possible ∆N2 such that the

inequalities (33)-(34) hold. Consider the corresponding tree allocation N1 = N̄ I{j∈[0,k)} + ∆N1 I{j=k} and N2 =

∆N2 I{j=k} + N̄ I{j∈(k,1]} .

    By construction, the incentive constraint of agent i = 1 holds in state ω1 , and the incentive constraint of agent

i = 2 holds in state ω2 .

    Next, we argue that the incentive constraint of agent i = 1 holds in state ω2 . This is obvious if N allocates no

tree to agent i = 1. Otherwise, if N allocates some trees to agent i = 1, then the incentive constraint of agent i = 2

must bind in state ω2 . Given δij < 1, this implies that the incentive constraint of agent i = 1 holds in state ω2 .

    With the above observations in mind, the only incentive constraint that remains to be checked is that of agent

i = 2 in state ω1 . If it holds with the proposed tree allocation, N , we are done. Otherwise,

                                                             Z
                                                c2 (ω1 ) <               δ2j dj (ω1 ) dN̄j + δ2k d2k ∆N2 ,
                                                                 (k,1]




in which case we explicitly construct another allocation of tree holdings that is incentive compatible. We proceed as

follows. We start from the proportional tree allocation that delivers agents i = 1 and i = 2 their consumption in state
             c1 (ω2 )                  c2 (ω2 )
ω2 : N̂1 =   y(ω2 )
                      N̄   and N̂2 =   y(ω2 )
                                                N̄ .   By construction, with such proportional allocation, the incentive constraint

of both agents hold in state ω2 . Since the consumption share of agent i = 2 is strictly larger in state ω1 than in state

ω2 , one sees that that agent i = 2 incentive compatibility constraint is slack in state ω1 . Indeed, we have:

                                                                   Z                      Z                     Z
                                   y(ω1 )            c2 (ω2 )
                      c2 (ω1 ) >          c2 (ω2 ) =                     dj (ω1 )dN̄j =       dj (ω1 )dÑ2j >       δ2j dj (ω1 )dÑ2j ,
                                   y(ω2 )            y(ω2 )


where the first inequality states that the consumption share is larger in state ω1 than in state ω2 , the first equality

follows from rearranging and from the definition of y(ω1 ), the second equality follows from the definition of N2 , and

the last inequality follows because δ2j < 1.

    Taking stock, for the original allocation N , the incentive compatibility constraints hold in state ω2 for both



                                                                               50
i = 1 and i = 2, but it does not hold in state ω1 for agent i = 2. For the proportional allocation N̂ , the incentive

compatibility constraints also hold in state ω2 for both i = 1 and i = 2, and it holds with strict inequality in state ω1

for agent i = 2. Therefore, there is a convex combination of N and N̂ such that the incentive compatibility constraint

is binding in state ω1 for agent i = 2. This implies that the incentive compatibility constraint holds in state ω1 for

agent i = 1. Clearly, the incentive compatibility constraint also hold in state ω2 for both agents since they hold

separately for N and N̂ .


The “only if” part of the Proposition. As before, pick the smallest possible k and the largest possible ∆N2

such that (34) holds. Given this ∆N2 , let ∆N1 ≡ N̂k − N̄k− − ∆N2 . If k = 0 and ∆N2 = N̄0 , then (33) evidently

holds. Otherwise, (34) holds with equality and we need to establish that that (33) holds as well. To that end, consider

any N̂ such that (c, N̂ ) is incentive feasible. Then:

         Z
                     δ1j dj (ω1 )dN̄j + δ1k dk (ω1 )∆N1
             [0,k)
         Z                                    
    =                δ1j dj (ω1 ) dN̂1j + dN̂2k + δ1k dk (ω1 )∆N1
             [0,k)
         Z                                     Z                                                    Z
    =                δ1j dj (ω1 )dN̂1j −                   δ1j dj (ω1 )dN̂1j + δ1k dk (ω1 )∆N1 +                δ1j dj (ω1 )dN̂2j
             [0,1]                                 [k,1]                                                [0,k)
                         Z                                                                      Z
                                                    δ1k dk (ω1 )                                                δ1k dk (ω1 )
    ≤    c1 (ω1 ) −                  δ2j dj (ω2 )                dN̂1j + δ1k dk (ω1 )∆N1 +               δ2j dj (ω2 )        dN̂2j
                             [k,1]                  δ2k dk (ω2 )                               [0,k)            δ2k dk (ω2 )
                                           "Z                                                                                  Z                                   #
                    δ1k dk (ω1 )                                                                                         
    =    c1 (ω1 ) +                                    δ2j dj (ω2 )dN̂2j    + δ2k dk (ω2 )∆N1 − δ2k dk (ω2 ) N̄k − N̄k− −                       δ2j dj (ω2 )dN̄j
                    δ2k dk (ω2 )               [0,1]                                                                                    (k,1]
                                                                                                                                   
                                 Z                                            Z                       !
                    δ1k dk (ω1 )                                                                         
    =    c1 (ω1 ) +                     δ2j dj (ω2 )dN̂2j − δ2k dk (ω2 )∆N2 +         δ2j dj (ω2 )dN̄j   ≤ c1 (ω1 ),
                    δ2k dk (ω2 )  [0,1]
                                 
                                                                                 (k,1]                    
                                   |          {z         } |                   {z                       }
                                                           ≤c2 (ω2 )                             =c2 (ω2 )



where: the second line follows by feasibility; N̄ = N̂1 + N̂2 , the third line follows by rearranging and using the

assumption that (c, N̂ ) is incentive feasible; the fourth line follows by using the condition that (32) is strictly increasing;

the fifth line by rearranging and using feasibility again; and the sixth line by our assumption that (c, N̂ ) is incentive

feasible and by our observation that (23) must hold with equality given our choice of k and ∆N2 .



A.6      Proof of Lemma 3

Consider first the first-best allocation, c? . The first-order condition of the Planner’s problem implies


                                                                        −γ1                           −γ2
                                                             α1 [c?1 (ω)]     − α2 [y(ω) − c?1 (ω)]         = 0,



                                                                                    51
                            c1 (ω2 )


                        y(ω2 )                                                      diagonal of Edgeworth box

                       c?1 (ω2 )




                       c1 (ω2 )
                                                                                           c1 (ω1 )
                                       c?1 (ω1 )                        c1 (ω1 ) y(ω1 )

           Figure 5: The Edgeworth box for the consumption of agent 1 in state ω1 (x-axis) and in state ω2 (y-axis).



for all ω ∈ Ω. In terms of consumption share, c(ω)/y(ω), this equation becomes:

                                                          −γ1                                −γ2
                                                c?1 (ω)                               c?1 (ω)
                                                                                
                                                                    γ2 −γ1
                                       α1                        y(ω)        − α2 1 −              = 0.                   (35)
                                                y(ω)                                  y(ω)


    Since γ2 > γ1 , this equation is strictly decreasing in the consumption share and strictly increasing in y(ω). Hence

it follows that the consumption share is strictly increasing in y(ω), i.e., c?1 (ω1 )/y(ω1 ) < c?1 (ω2 )/y(ω2 ). The inequality

for i = 2 follows directly because consumption shares add up to one.

    Now consider the equilibrium allocation, c. Assume, toward a contradiction, that c1 (ω1 )/y(ω1 ) ≥ c1 (ω2 )/y(ω2 ),

i.e., the consumption shares of agent i = 1 lie below the diagonal of the Edgeworth box, as shown in Figure 5. Notice

that since the first-best allocation, c? , satisfies the reverse inequality, it must lie strictly above the diagonal. This

implies that c? 6= c. By strict concavity, social welfare evaluated at c is strictly smaller than social welfare evaluated

at c? , and strictly smaller than social welfare at any point on the segment (c, c? ] linking c to c? , shown in red on the

figure. Clearly, the segment [c, c? ) crosses the diagonal at some point c† , which may be c. Since c† keeps the agent’s

consumption share constant across states, it can be made incentive feasible by giving agents the corresponding

“proportional” asset allocation, i.e., a share in the market portfolio equal to their respective consumption share,

Ni† = c†i (ωi )/y(ωi ) N̄ . But since δ < 1, it follows that all incentive constraints are slack for (c† , N † ). Therefore,

points on the segment (c, c? ] near c† are incentive feasible as well. But they improve social welfare strictly relative to

c, which is a contradiction.




                                                                           52
A.7      Proof of Proposition 5

As for Lemma 2, we offer a proof in the general case when δij is assumed to depend both on the identity of the asset

holders and on the type of the asset, maintaining the restriction that


                                                                      δ1j dj (ω1 )
                                                                                   ,                                             (36)
                                                                      δ2j dj (ω2 )


is strictly increasing.

    Given Lemma 2, what remains to be shown is that, for any incentive-feasible consumption allocation on the

boundary, the distribution of assets is uniquely determined. We establish:


Lemma A.4 Suppose that (22) and (23) holds with equality for some consumption allocation c, some k ∈ [0, 1]

and some (∆N1 , ∆N2 ) ≥ 0 such that ∆N1 + ∆N2 = Nk − Nk− . Then (c, N ) is incentive feasible if and only if

N1 = ∆N1 I{j=k} + N̄ I{j<k} and N2 = ∆N2 I{j=k} + N̄ I{j>k} .


    The “if” part of Lemma A.4 follows because, with the proposed asset allocation, the incentive constraint of agent

i = 1 binds in state ω1 , and that of agent i = 2 binds in state ω2 . It then follows that the two other incentive

constraints are slack.

    For the “only if” part, consider any asset allocation such that (c, N̂ ) is incentive feasible. Then the incentive

constraint of agent i = 1 in state ω1 writes:

                                         Z                                                     Z
                           c1 (ω1 ) =                δ1j dj (ω1 ) dN̄j + δ1k dk (ω1 )∆N1 ≥         δ1j dj (ω1 )dN̂1j
                                             [0,k)




Using that dN̄j = dN̂1j + dN̂2j we then obtain that:

                     Z                                                          Z
                                 δ1j dj (ω1 ) dN̂2j + δ1k dk (ω1 )∆N1 ≥                 δ1j dj (ω1 )dN̂1j + δ1k dk (ω1 )∆N̂1 ,   (37)
                         [0,k)                                                  (k,1]




where ∆N̂1 ≡ N̂1k − N̂1k− . Proceeding analogously with the incentive constraint of agent i = 2 in state ω2 , we obtain:

                     Z                                                          Z
                                 δ2j dj (ω2 ) dN̂1j + δ2k dk (ω2 )∆N2 ≥                 δ2j dj (ω2 )dN̂2j + δ2k dk (ω2 )∆N̂2 ,   (38)
                         (k,1]                                                  [0,k)




where ∆N̂2 ≡ N̂2k − N̂2k− Now multiply equation (37) by δ2k dk (ω2 ), and equation (38) by δ1k dk (ω1 ) and add the

two inequalities. The j = k terms cancel each others out because, by feasibility, ∆N1 + ∆N2 = ∆N̂1 + ∆N̂2 . We




                                                                           53
thus obtain:

Z                                           Z                                              Z                                             Z
            δ1j dj (ω1 )δ2k dj (ω2 ) dN̂2j +            δ2j dj (ω2 )δ1k dk (ω1 ) dN̂1j ≥               δ1j dj (ω1 )δ2k dk (ω2 )dN̂1j +           δ2j dj (ω2 )δ1k dk (ω1 )dN̂2j .
    [0,k)                                       (k,1]                                          (k,1]                                     [0,k)




After rearranging:

       Z                                                                             Z
                   [δ1j dj (ω1 )δ2k dj (ω2 ) − δ2j dj (ω2 )δ1k dk (ω1 )] dN̂2j ≥             [δ1j dj (ω1 )δ2k dk (ω2 ) − δ2j dj (ω2 )δ1k dk (ω1 )] dN̂1j
           [0,k)                                                                     (k,1]




But, by (36), the integrand on the left-hand side is strictly negative over [0, k), while the integrand on the right-hand

side is strictly positive over (k, 1]. Therefore, both integrals are zero: agent i = 2 holds no assets in [0, k) and all

assets in (k, 1], while agent i = 1 holds all assets in [0, k) and no asset in (k, 1]. Plugging this back into the incentive

compatibility constraint, we can determine each agent’s holdings of asset k. Indeed, we obtain:



                                 δ1k dk (ω1 )∆N1 ≥ δ1k dk (ω1 )∆N̂1 and δ2k dk (ω2 )∆N2 ≥ δ2k dk (ω1 )∆N̂2 .



Since ∆N1 + ∆N2 = ∆N̂1 + ∆N̂2 , it follows that ∆N1 = ∆N̂1 and ∆N2 = ∆N̂2 .



A.8            Proof of Proposition 6

With two agents, the zero-transfer equation (30) writes:



                                               n̄2 α1 E u01 [c1 (ω)] c1 (ω) = n̄1 α2 E u02 [c2 (ω)] c2 (ω)
                                                                                     




With CRRA utility, this can be simplified further:



                                                         n̄2 α1 E c1 (ω)1−γ1 = n̄1 α2 E c2 (ω)1−γ2 ,
                                                                                               




so that:
                                                                          α1 E c1 (ω)1−γ1
                                                                                          
                                                                    n̄1
                                                                        =                    .
                                                                    n̄2   α2 E [c2 (ω)1−γ2 ]

Now notice that, as α1 /α2 increases, the solution of the Planner’s problem moves to the northeast of the incentive-

constrained Pareto set (see Lemma A.3 in the Proof of Proposition 3). Clearly, this implies a strictly increasing

relationship between n̄1 /n̄2 and α1 /α2 .




                                                                                54
A.9       Proof of Proposition 7

Suppose c is incentive feasible under tree distribution N̄ and is such that the consumption share of agent i = 1 is

higher in state ω1 than in state ω2 , as is the case in equilibrium (the opposite case is symmetric). Lemma 2 implies

that there exist k ∈ [0, 1] and (∆N1 , ∆N2 ) ≥ 0, ∆N1 + ∆N2 = N̄k − N̄k− such that the incentive compatibility

constraints (22) and (23) are satisfied.

      To establish the claim of the proposition, that c is incentive feasible under tree distribution N̄ ∗ , we need to find

some k∗ ∈ [0, 1] and (∆N1∗ , ∆N2∗ ) ≥ 0, ∆N1∗ + ∆N2∗ = N̄k∗ − N̄k∗ − such that the analog of conditions (22) and (23)

for the new tree allocation (described with variables with a ∗ ) are satisfied. It is thus sufficient to find some k∗ and

(∆N1∗ , ∆N2∗ ) ≥ 0, ∆N1∗ + ∆N2∗ = N̄k∗ − N̄k∗ − such that:


                                          Z                                  Z
                                                       jdN̄j∗ + k∗ ∆N1∗ ≤                  jdN̄j + k∆N1                            (39)
                                           j∈[0,k∗ )                             j∈[0,k)


and
                         Z                                                   Z
                                       (1 − j)dN̄j∗ + (1 − k∗ )∆N2∗ ≤                      (1 − j)dN̄j + (1 − k)∆N2 .              (40)
                           j∈(k∗ ,1]                                             j∈(k,1]


Let k∗ ∈ [0, 1] and (∆N1∗ , ∆N2∗ ) ≥ 0, ∆N1∗ + ∆N2∗ = N̄k∗ − N̄k∗ − , such that



                                                        N̄k∗∗ − + ∆N1∗ = N̄k− + ∆N1 .                                              (41)



      First note that (41) together with (25) and (26) imply that (39) holds if and only if (40) holds. Indeed, adding

                                                         Z                                                   Z
                       N̄1∗ − N̄k∗∗ − + ∆N1∗ −                      jdN̄j∗ = N̄1 − N̄k− + ∆N1 −
                                                                                            
                                                                                                                           jdN̄j
                                                          j∈[0,1]                                                j∈[0,1]




on each side of (39) yields (40).

      Let us now show that (39) holds. Integrating the left-hand side of (39) by parts yields

                                 Z                                                    Z    k∗
                                               jdN̄j∗ + k∗ ∆N1∗ = k∗ N̄k∗∗ − −                  N̄j∗ dj + k∗ ∆N1∗ .
                                   j∈[0,k∗ )                                           0




There are two cases to consider.

      First case: k∗ ≤ k. Then, it follows from (41) that N̄k∗∗ − + ∆N1∗ = N̄k− + ∆N1 ≥ N̄k− ≥ N̄j for j ∈ (k∗ , k).




                                                                        55
Thus,

             Z                                                              Z    k∗                                            Z    k
                             jdN̄j∗ + k∗ ∆N1∗            ≤   k∗ N̄k∗ − −              N̄j∗ dj + k∗ ∆N1∗ +                               (N̄k∗∗ − + ∆N1∗ − N̄j )dj
                 j∈[0,k∗ )                                                   0                                                     k∗
                                                                                                Z       k∗                     Z   k
                                                             k N̄k∗ − + ∆N1∗ −                                  N̄j∗ dj −
                                                                            
                                                         =                                                                             N̄j dj
                                                                                                    0                          k∗
                                                                                         Z          k∗                    Z    k
                                                                                                         N̄j∗ dj −
                                                                         
                                                         =   k N̄k− + ∆N1 −                                                        N̄j dj
                                                                                                0                          k∗
                                                                         
                                                                                         Z          k∗                    Z k
                                                         ≤   k N̄k− + ∆N1 −                              N̄j dj −                  N̄j dj
                                                                                                0                             k∗
                                                                         
                                                                                         Z          k
                                                         =   k N̄k− + ∆N1 −                             N̄j dj
                                                                                                0




where the second line is obtained by calculation, the third line follows from (41), the fourth line follows from the

definition of second order stochastic dominance, the fifth line is obtained by calculation and is equal to the right-hand

side of (39) after integration by parts.

    Second case: k < k∗ . Then

                   Z                                                                                    Z       k∗
                                jdN̄j∗        ∗
                                                  ∆N1∗               ∗
                                                                                                                     N̄j∗ dj
                                                                                            
                                         +k                  =   k       N̄k− + ∆N1 −
                    j∈[0,k∗ )                                                                               0
                                                                                                        Z       k∗
                                                                 k∗ N̄k− + ∆N1 −
                                                                                            
                                                             ≤                                                       N̄j dj
                                                                                                            0
                                                                                                        Z       k              Z       k∗
                                                                 k∗ N̄k− + ∆N1 −
                                                                              
                                                             ≤                                                      N̄j dj −                N̄k dj
                                                                                                            0                      k
                                                                                                        Z       k
                                                                 k∗ N̄k− + ∆N1 −                                    N̄j dj − (k∗ − k) N̄k− + ∆N1
                                                                                                                                                           
                                                             ≤
                                                                                                            0
                                                                                        
                                                                                                    Z       k
                                                             =   k N̄k− + ∆N1 −                                 N̄j dj
                                                                                                        0




where the first line follows by integration by part of (41), the second line follows from the definition of second order

stochastic dominance, the third line follows from N̄ being increasing, the fourth line follows from ∆N2 ≥ 0, the fifth

line is obtained by calculation and is equal to the right-hand side of (39) after integration by parts.



A.10      Proof of Proposition 9

Notice that, since the function φ` is the same for both agents, we have that δ1j dj (ω1 )/δ2j dj (ω2 ) = dj (ω1 )/dj (ω2 ) is

strictly increasing, so all our results apply.

    The equilibrium is uniquely pinned down by a two-equation-in-two-unknown problem, for the ratio of the two

                                                  λ1
budget constraints multipliers, r =               λ2
                                                     ,   and the threshold k determining asset ownership. To obtain the first equation,

first note that the continuity of j 7→ (δ1j dj (ω1 ))/(δ2j dj (ω2 )) implies that for the threshold asset, the first-order


                                                                                 56
condition with respect to asset holdings holds with an equality for both agents. Thus:



                                           F (r, k) ≡ µ1 (ω1 )δ1k dk (ω1 ) − rµ2 (ω2 )δ2k dk (ω2 ) = 0.                                                 (42)



where, from the first-order conditions we have that

                                               Z       1                                            Z         1                              
                                  rπ(ω1 )u02                 1 − δ1j I{j<k} dj (ω1 ) dN̄j − π(ω1 )u01
                                                                           
              µ1 (ω1 )       =                                                                                       δ1j I{j<k} dj (ω1 ) dN̄j
                                                    0                                                        0
                                                Z       1                                                 Z   1                              
                                  1
                                    π(ω2 )u01                                                   π(ω2 )u02
                                                                             
              µ2 (ω2 )       =                               1 − δ2j I{j≥k} dj (ω2 ) dN̄j −                          δ2j I{j≥k} dj (ω2 ) dN̄j .
                                  r                  0                                                       0




Notice that the continuity of the distribution of asset supplies mean that there is no atom, hence ∆N1 = ∆N2 = 0,

i.e., the allocation of the supply of threshold assets between agents is irrelevant. The second equilibrium equation is

(30) which here takes the form:


                                                                                      n̄1
                                        G(r, k) ≡ E[u01 (c1 (ω))c1 (ω)] − r               E[u02 (c2 (ω))c2 (ω)] = 0,                                    (43)
                                                                                      n̄2

                         Rk                                         R1                                                R1
where c1 (ω1 ) =         0
                              δ1j dj (ω1 ) dN̄j , c2 (ω1 ) =          0
                                                                          dj (ω1 ) dN̄j − c1 (ω1 ), c2 (ω2 ) =         k
                                                                                                                           δ2j dj (ω2 ) dN̄j , and c1 (ω2 ) =
R1
 0
     dj (ω2 ) dN̄j − c2 (ω2 ).

     The function F (r, k)/(δ2k dk (ω2 )) is strictly increasing and continuous in both r and k. Moreover, one can

explicitly solve for r as a function of k, ρ(k). This function is strictly decreasing and, because of the Inada condition

u0i (0) = +∞, goes to infinity as k goes to zero, limk→0 ρ(k) = ∞, and goes to zero as k goes to one, limk→1 ρ(k) = 0.

     Since N̄j is strictly increasing, it follows that both c1 (ω1 ) and c1 (ω2 ) are strictly increasing in k while both c2 (ω1 )

and c2 (ω2 ) are strictly decreasing in k. Recall that the coefficient of relative risk aversion are both less than one,

0 ≤ γ1 < γ2 ≤ 1. Therefore, the function G(r, k) is strictly decreasing in r and strictly increasing in k. Plugging in the

function ρ(k) defined above, we obtain a strictly increasing function k 7→ G(ρ(k), k). Given our earlier observation

that limk→0 ρ(k) = ∞ and limk→1 ρ(k) = 0, it follows that k 7→ G(ρ(k), k) is strictly negative when k ' 0, and

strictly positive when k ' 1. Thus, the equilibrium threshold is the unique solution of G(ρ(k), k) = 0. Clearly c1 (ω1 )

increases with ε, while c2 (ω2 ) stays the same. This implies that ρ(k) shifts down, and that G(ρ(k), k) shifts down as

well. Hence k(ε0 ) < k(ε) if ε0 > ε.
                                                                              dk
                                                                                 < 0.
                                                                              dε




                                                                                 57
B      Supplementary appendix

B.1      Proof of Lemma A.1

For this proof, in order to apply some of the results in Chapter 12 of Stokey and Lucas (1989), we extend measures

M ∈ M+ to the entire real line, R, by setting Mj = 0 for all j < 0, and Mj = M1 for all j ≥ 1. Now consider a

sequence (ck , N k ) of incentive feasible allocations. Given that ck belongs to a finite dimensional space and is bounded,

                                                          Nik = N̄ , Nij is bounded above by N̄j for all (i, j) ∈ I × R, an an
                                                P
it has a converging subsequence. Given that         i∈I


application of Helly’s selection Theorem (Theorem 12.9 in Stokey and Lucas (1989) easily extended to finite measures

instead of distributions) shows that for each i ∈ I, Nik has a subsequence such that Ni` converging weakly in M+ .

Taken together, this means that there exists a subsequence (c` , N ` ) of (ck , N k ) and some (c, N ) ∈ X such that c` → c

and Ni` ⇒ Ni for each i ∈ I.

    What is left to show is that (c, N ) is incentive feasible. Given that j 7→ dj (ω) and j 7→ δij are continuous, the

definition of weak convergence allows us to assert that, since the feasibility constraint for consumption, (8), and the

incentive compatibility constraints, (6), hold for each (c` , N ` ), then it must also hold in the limit for (c, N ). The only

difficulty is to show that the feasibility constraint for holdings is also satisfied. For this we rely on the characterization

of weak convergence provided by Theorem 12.8 in Stokey and Lucas (1989), easily extended to finite measures. It

asserts that Ni` converges pointwise at each continuity point of their limit, Ni . Therefore, for any j ∈ R such that all

(Ni )i∈I are continuous, we have:
                                                     X       `
                                                                        X
                                                            Nij →             Nij .
                                                     i∈I                j∈I

                                                                                      P      `
But recall that the feasibility constraint for holdings is satisfied for each j:      i∈I   Nij = N̄j . Together with the above,

this implies that
                                                          X
                                                                 Nij = N̄j ,
                                                           i∈I


for all j ∈ R such as all (Ni )i∈I are continuous. Now recall that the Ni ’s are increasing functions, and so have

countably many discontinuity points. This implies that for any j ∈ R, there is a sequence of jn ↓ j such that jn is a

continuity point for all (Ni )i∈I . Hence, for all jn , we have


                                                          X
                                                                Nijn = N̄jn .
                                                          i∈I


                                                                                                                P
Since j 7→ Nij and N̄j are all right continuous functions we can take the limit jn ↓ j and obtain that             i∈I   Nij = N̄j




                                                                   58
for all j ∈ R, as required.



B.2      Proof of Proposition A.1

In all what follow we let:
                                                X
                                    y(ω) ≡            dj (ω), y ≡ min y(ω), and ȳ ≡ max y(ω).
                                                                   ω∈Ω                      ω∈Ω
                                                j∈J



Proof that Γ? (α) is not empty. We first show that the supremum is achieved. The only difficulty with this

proof arises when αi > 0 and ui (0) = −∞ for some i ∈ I, because in this case the objective is unbounded as

ci (ω) → 0. However, in the planner’s problem, one can restrict attention to ci (ω) that are bounded away from zero.

To see this, we first note that ci (ω) = y(ω)/I is incentive-feasible, implying that:


                                          X          X                         X
                              W ? (α) ≥
                                                                                               
                                                αi         π(ω)ui [y(ω)/I] ≥          min{ui y/I , 0} ≡ W .
                                          i∈I        ω∈Ω                        i∈I



Also, for each i such that αi > 0 and ui (0) = −∞, we have that


                                                                             X
                                  W (α, c, n) ≤ αi π(ω)ui [ci (ω)] +                αk max{ui (ȳ/I), 0}.
                                                                             k6=i



Now consider the equation
                                                                 X
                                      αi π(ω)ui [ci (ω)] +              αk max{ui (ȳ/I), 0} = W .
                                                                 k6=i


Since ui (0) = −∞, the left-hand side is smaller than the right-hand side when c → 0. Since W ≤ 0 by construction,

the left-hand side is larger than the right-hand side when c → ∞. Given the strict monotonicity of ui (c), it follows

that the equation has a unique solution, which is decreasing and continuous in αi . Let ci (αi ) be half of the minimum

of these solutions across all ω ∈ Ω. By construction, for all allocation (c, n) such that ci (ω) < ci for some ω ∈ Ω,

W (α, c, n) < W . If we let ci (αi ) = 0 for other i, that is for i ∈ I such that αi = 0 or ui (0) = 0, then, in the Planner’s

problem, one can restrict attention to allocation such that ci (ω) ≥ ci (αi ), which we write as c ≥ c(α). Notice that,

by construction, the objective of the planner is continuous over c ≥ c(α).

    Now to show that there is a solution consider any sequence (ck , N k ) of incentive-feasible allocation such that

W (α, ck , N k ) → W ? (α). From the above remark we can focus on a sequence such that ck ≥ c(α). Now, by Lemma

A.1, there exists some incentive feasible allocation (c, N ) and a subsequence (c` , N ` ) such that c` → c and N ` → N .

Going to the limit in the Planner’s objective, we obtain that W (α, c, N ) = W ? (α).




                                                                        59
Proof that Γ? (α) is weakly compact. The argument is the same as in the last paragraph, except that we

now consider a sequence (ck , N k ) ∈ Γ? (α).


Proof that Γ? (α) convex-valued. This follows because the objective is concave and the constraints linear.


Proof that W ? (α) is continuous and Γ? (α) has a weakly closed graph. Consider any ᾱ ≥ 0 such that

        ᾱi = 1 and any sequence αk → ᾱ and an associated sequence (ck , N k ) ∈ Γ? (αk ). Without loss of generality
P
  i∈I


for this proof, assume that W ? (αk ) converges to some limit,22 and that (ck , N k ) converges weakly towards some

incentive feasible allocation (c, N ).23 We want to show that W ? (αk ) → W ? (α) and that (c, N ) ∈ Γ? (α). Let

I0 = {i ∈ I : αi = 0 and ui (0) = −∞}. We have:


                                          X            X           h       i X     X       h       i
                            W ? (αk ) =          αik         π(ω)ui cki (ω) +  αik   π(ω)ui cki (ω) .                                    (44)
                                          i∈I
                                           / 0         ω∈Ω                          i∈I0   ω∈Ω



By our maintained assumptions, both the left-hand side and the first term on the right-hand side have a limit as

k → ∞. Hence, the second term on the right-hand side has a limit as well. We argue that this limit must be negative.

Indeed, for i ∈ I0 , if lim cki (ω) > 0, then lim αik ui cki (ω) = 0. If lim cki (ω) = 0, then αik ui cki (ω) ≤ 0 for k large
                                                                                                          


enough. Hence,
                                                        X            X           h       i
                                                  lim          αik         π(ω)ui cki (ω) ≤ 0.
                                                        i∈I0         ω∈Ω


Therefore:
                                                         X            X           h           i
                                    lim W ? (αk ) ≤             ᾱi         π(ω)ui lim cki (ω) ≤ W ? (ᾱ),                               (45)
                                                         i∈I
                                                          / 0         ω∈Ω


since (lim ck , lim N k ) is incentive feasible.

    To show the reverse inequality, for all i ∈ I0 , choose some φi > 0 such that 1 + φi (1 − γi ) < 1, where γi > 1 is the

                                                                     (αi )φi . Since lim αik = 0 for all i ∈ I0 , we have that lim β(αk ) = 0,
                                                        P
assumed CRRA bound for ui (c). Let β(α) ≡                    i∈I0


hence β(αk ) < 1 for all k large enough. Now take any (c, N ) ∈ Γ? (ᾱ). For all i ∈ I0 we have that ᾱi = 0, which

clearly implies that ci (ω) = Ni = 0, i.e., i ∈
                                              / I0 consume the aggregate endowment and holds the aggregate tree

                                                                             / I0 by 1 − β(αk ), we keep the allocation
supplies. Therefore, if we scale down the consumption and asset holding of i ∈

     / I0 incentive compatible and we free up β(αk )y(ω) consumption, and β(αk )N̄ assets. We can then re-distribute
of i ∈
                                                                                                                           φi
this consumption and these assets by giving to each agent i ∈ I0 a consumption equal to y(ω) αik                                 and an asset

                                     k φi
                                      
allocation equal to a fraction αi           of the market portfolio, N̄ . Because the consumption of i ∈ I0 is proportional
  22 Indeed, since W ? (α) is bounded below by W and is clearly bounded above, to show convergence towards W ? (α) it is

sufficient to show that every convergent subsequence of W ? (αk ) converges towards W ? (α).
  23 From Lemma A.1, we can always find a convergence subsequence with this property.




                                                                            60
to its portfolio payoff, the allocation of i ∈ I0 is incentive compatible. Therefore, this process of scaling down the

consumption of i ∈
                 / I0 and redistributing to i ∈ I0 , leads to an incentive feasible allocation. Hence, we have that:


                               X            X                                        X            X                φi 
                 W ? (αk ) ≥          αik         π(ω)ui [ci (ω)(1 − β(α))] +               αik         π(ω)ui y(ω) αik    .
                               i∈I
                                / 0         ω∈Ω                                      i∈I0         ω∈Ω



The first term converges to W ? (ᾱ). Using the assumed CRRA bound, 0 < |u(c)| < |K|c1−γi for c close to zero, one sees
                                                 h       φ i                                      1+(1−γi )φi
that the second term goes to zero: indeed αik ui y(ω) αik i is bounded above by |K|y(ω)1−γi αik                 , which

goes to zero since lim αik = 0 and φi was chosen so that 1+φi (1−γi ) > 0. Hence, we obtain that lim W ? (αk ) ≥ W ? (ᾱ).

Taken together we have that


                                                         X            X           h           i
                                   lim W ? (αk ) ≥              ᾱi         π(ω)ui lim cki (ω) = W ? (ᾱ).                     (46)
                                                         i∈I
                                                          / 0         ω∈Ω



Taken together, (45) and (46) imply that


                                 X           X       h           i                 X kX       h       i
               lim W ? (αk ) =          αi         ui lim cki (ω) = W (ᾱ) and lim  αi  π(ω)ui cki (ω) = 0.
                                 i∈I
                                  / 0        ω∈Ω                                             i∈I0        ω∈Ω



This establishes that W ? (α) is continuous and that Γ? (α) has a closed graph.


Proof that lim αik u0 cki (ω) cki (ω) = 0 if lim αik = 0. Consider any sequence αk → ᾱ and any associated
                            


sequence (not necessarily converging) (ck , N k ) in Γ? (αk ). Since we have shown that Γ? (α) has a weakly closed graph,

it follows that any converging subsequence of (ck , N k ) has a limit belonging to Γ? (ᾱ). Since the Planner finds optimal

to give zero consumption to agents with zero weight, it follows that lim cki (ω) = 0 for all i such that ᾱi = 0.

   If ui (0) = 0, then the result that lim αik u0 cki (ω) cki (ω) = 0 follows from the inequality 0 ≤ u0i (c)c ≤ ui (c). If
                                                        


ui (0) = −∞, we need a different argument. Write W ? (αk ) = W1k + W2k , where


                                 X           X           h       i          X    X       h       i
                       W1k ≡            αi         π(ω)ui cki (ω) and W2k ≡   αi   π(ω)ui cki (ω) .
                                 i∈I
                                  / 0        ω∈Ω                                      i∈I0        ω∈Ω



By assumption, we have that lim W1k + W2k = W ? (ᾱ). Notice that W1k is bounded. Indeed, it is clearly bounded
                                         


above because the constraint set is bounded. It is bounded below because, for any i ∈
                                                                                    / I0 such that ui (0) = −∞,

ᾱi > 0 and so αik and hence ci (αik ) is bounded away fro zero for k large enough. Given boundedness, we can extract

some convergent subsequence W1` of W1k . Since consumption and asset holdings are incentive feasible, it follows from

Lemma A.1 that there exists a weakly convergent subsequence (cp , N p ) of (c` , N ` ). Clearly, lim W1p = lim W1` . But,



                                                                            61
using the results of the previous paragraph, we have that lim W1p = W ? (ᾱ). Hence all convergent subsequences of W1k

have the same limit W ? (ᾱ), implying that lim W1k = W ? (ᾱ) and that lim W2k = 0. It follows that, asymptotically as

k → ∞, the aggregate consumption of agents i ∈
                                             / I0 is arbitrarily close to y(ω), and the consumption of each agent

i ∈ I0 is arbitrarily close to zero. Therefore, for all k large enough, all terms in W2k are negative. Hence, for k large

enough, we that for all i ∈ I0 , W2k ≤ αik π(ω)ui cki (ω) ≤ 0. Since lim W2k = 0, it follows that lim αik π(ω)ui cki (ω) = 0
                                                                                                                     


as well. The result then follows from the CRRA bound 0 ≤ u0i (c)c ≤ γi |ui (c)|.



B.3     Proof of Proposition A.2

Fix any feasible N and let:
                                                                               X
                                                      W (α | N ) = max               αi Ui (ci )
                                                                               i∈I

                         |Ω|×|I|
with respect to c ∈ R+             , and subject to


                                               X                 XZ
                                                     ci (ω) ≤             dj (ω)dNij       ∀ω ∈ Ω
                                               i∈I               i∈I
                                                      Z
                                          ci (ω) ≥        δij dj (ω)dNij       ∀(i, ω) ∈ I × Ω.


                                                               |Ω|×|I|                                                                |Ω|
From Corollary 28.3 in Rockafellar (1970), c ∈ R+                        is an optimal solution only if there exists multipliers q̂ ∈ R+
           |Ω|×|I|
and µ̂ ∈ R+          such that:


                                                     ∂Ui
                                                          αi+ µ̂i (ω)                ≤     q̂(ω)
                                                    ∂ci (ω)
                                        "                           #
                                         XZ               X
                                  q̂(ω)     dj (ω)dNij −     ci (ω)                  =     0,      ∀ω ∈ Ω
                                         i∈I                        i∈I
                                                     Z               
                                      µ̂i (ω) ci (ω) − δij dj (ω)dNij                =     0,      ∀(i, ω) ∈ I × Ω.



Notice that we can always choose multipliers such that the top first-order condition, with respect to ci (ω), holds with

equality. Indeed, if it holds with a strict inequality for some µ̂i (ω) and some (i, ω), then ci (ω) = 0 and so the incentive

constraint holds with equality. So increasing µ̂i (ω) leaves the complementary slackness conditions unchanged.

    Now consider any other feasible N̂ ∈ M+ . Clearly, for any h ∈ [0, 1], (1 − h)N + hN̂ = N + h(N̂ − N ) is
                                                                     h        i
also feasible. In the optimization problem associated with W α | N + h N̂ − N , we take the derivative of the

Lagrangian with respect to h. We evaluate this derivative at h = 0, given some optimal consumption for W (α | N )




                                                                          62
and Lagrange multipliers satisfying the first order-conditions. We obtain:

                                               "                                                       #
                                        XZ         X                        X                              h                  i
                              Lh   =                      q̂(ω)dj (ω) −          µ̂i (ω)δij dj (ω)             dN̂ij − dNij
                                        i∈I      ω∈Ω                       ω∈Ω
                                        XZ            h                i
                                   =           v̂ij dN̂ij − dNij ,
                                        i∈I


                                                             P                             P
where, for any set of Lagrange multipliers, v̂ij ≡             ω∈Ω    q̂(ω)dj (ω) −            ω∈Ω   µ̂i (ω)δij dj (ω). Notice that q̂(ω) is uniquely

determined24 but µ̂i (ω) may not, when ci (ω) = 0. One easily sees in particular that any


                                                                                       ∂Ui
                                                      0 ≤ µ̂i (ω) ≤ q̂(ω) − αi
                                                                                      ∂ci (ω)


solves the first-order conditions. Let V̂ij denote the corresponding interval of v̂ij . It follows from Corollary 5 in
                                                                   h       i
Milgrom and Segal (2002) that the right-derivative of W α | N + h N̂ − N       at h = 0 is


                                d           h       i                                    XZ            h            i
                                  W α | N + h N̂ − N                        = min                    v̂ij dN̂ij − dNij .
                               dh                                 h=0+        v̂ij ∈V̂ij
                                                                                           i∈I


                      R
Now notice that           v̂ij dNij does not depend on the particular choice of v̂ij . Indeed, whenever v̂ij is not uniquely

determined, it is because ci (ω) = 0 for some ω ∈ Ω. But from the incentive compatibility constraint, it then follows
       R                                         R                                                                                     R
that       δij dj (ω) dNij = 0, and so µ̂i (ω)       δij dj (ω) dNij = 0 as well. Since N̂ij is a positive measure,                        v̂ij dN̂ij is

minimized when v̂ij is smallest, which occurs when µ̂i (ω) is largest, that is, when it is chosen so that the first-order

condition with respect to ci (ω) holds with equality.

    Taken together, we obtain that a necessary condition for a feasible N to be optimal is that:


                                                      XZ           h            i
                                                               v̂ij dN̂ij − dNij ≤ 0,                                                             (47)
                                                       i∈I


                                       P                          P
for all feasible N̂ , where v̂ij =       ω∈Ω   q̂(ω)dj (ω) −          ω∈Ω   µ̂i (ω)δij dj (ω) and µ̂i (ω) is chosen so that the first-order

condition with respect to ci (ω) holds with equality. The proof is concluded by the following Lemma:

                                                              R
Lemma B.1 Condition (47) holds if and only if                     [maxk∈I v̂kj − v̂ij ] dNij = 0 for all i ∈ I.


For necessity, consider the correspondence Γ(j) ≡ arg maxk∈I v̂kj . By the Measurable Selection Theorem (Theorem
   24 Indeed for any ω ∈ Ω, there exists somei ∈ I such that the incentive compatibility constraint does not bind. For this i ∈ I,

ci (ω) > 0 and so the first-order condition holds with equality. If ui (c) is linear, then αi ∂Ui /∂ci (ω) = αi is uniquely determined.
If ui (c) is strictly concave, then ci (ω) is uniquely determined and so is αi ∂Ui /∂ci (ω). Using the first-order condition, it then
follows that q̂(ω) is uniquely determined.




                                                                        63
7.6 in Stokey and Lucas (1989)), there exists a measurable selection γ(j). Consider then the asset allocation:

                                                              Z      j
                                                    N̂ij =               I{γ(k)=i} dN̄k ,
                                                                 0




which gives the supply of asset k to one agent with the highest valuation, vγ(k)k . Condition (47) implies that:


                              XZ          h             i                 XZ                                      X
                         0≥           v̂ij dN̂ij − dNij          =                    v̂ij I{γ(j)=i} dN̄j −             v̂ij dNij
                              i∈I                                         i∈I                                     i∈I
                                                                          Z                            XZ
                                                                 =             max v̂kj dN̄j −                   v̂ij dNij
                                                                                k∈I
                                                                                                       i∈I
                                                                          XZ                                
                                                                 =                      max v̂kj − v̂ij          dNij ,
                                                                                        k∈I
                                                                          i∈I


                                                  P
where the second equality follows because             i∈I   v̂ij I{γ(j)=i} = v̂kj , and the third equality follows because N̄ =
P
  i∈I   Ni . But each term in the sum is positive since max v̂kj − v̂ij ≥ 0. It thus follows that each term in the sum is

zero, and we are done.

    For sufficiency, write


                              X         h             i              X                         XZ
                                    v̂ij dN̂ij − dNij        =                v̂ij dN̂ij −                 max vkj dNij
                                                                                                           k∈I
                              i∈I                                    i∈I                       i∈I
                                                                     X                         Z
                                                             =                v̂ij dN̂ij −           max vkj dN̄j
                                                                                                     k∈I
                                                                     i∈I
                                                                     X              
                                                             =         v̂ij − max vkj dN̂ij ≤ 0.
                                                                                         k∈I
                                                                     i∈I


                                                                                 P
where the last equality follows because N̂ is feasible, so N̄j =                      i∈I   N̂ij .




                                                                         64
B.4     Proof of Proposition A.3

Consider any (c, N ) and multipliers q̂, µ̂ and p̂ satisfying the first-order conditions in the Proposition. Now let (ĉ, N̂

denote any other feasible allocation. We have:


                    X                      X
                           αi Ui (ci ) −         αi Ui (ĉi )
                     i∈I                   i∈I
                    XX         ∂Ui                         XX
                ≥                     [ci (ω) − ĉi (ω)] =         [q̂(ω) − µ̂i (ω)] [ci (ω) − ĉi (ω)]
                     i∈I ω∈Ω
                              ∂ci (ω)                      i∈I ω∈Ω
                               "                                 #               "                                   #
                     X           X            XZ                       X          X               XZ
                =        q̂(ω)      ci (ω) −          dj (ω) dNij −        q̂(ω)        ĉi (ω) −       dj (ω) dN̂ij
                    ω∈Ω            i∈I                i∈I                              ω∈Ω             i∈I         i∈I
                        XX                                 Z                          XX                              Z                     
                    −             µ̂i (ω) ci (ω) −              δij dj (ω)dNij +                     µ̂i (ω) ĉi (ω) −       δij dj (ω)dN̂ij
                        i∈I ω∈Ω                                                         i∈I ω∈Ω
                        XZ          h                       i    XZ          h            i
                    +            v̂ij dNij − dN̂ij ≥                     v̂ij dNij − dN̂ij ,
                        i∈I                                      i∈I



where the last inequality follows from the complementarity slackness for (c, N ), and from the feasibility of (ĉ, N̂ ).

Now since both N and N̂ are feasible, we have that:


                                                                        X                    X
                                                       p̂ · N̄ = p̂ ·         Nij = p̂ ·           N̂ij .
                                                                        i∈I                  i∈I



Hence, adding and subtracting p̂ · N̄ , we obtain:


              XZ        h            i X            Z           X           Z         
                    v̂ij dNij − dN̂ij =   p̂ · N̂ij − v̂ij dN̂ij −   p̂ · Nij − v̂ij dNij ≥ 0
              i∈I                                   i∈I                                        i∈I



where the last inequality follows from the first-order condition with respect to N .



B.5     Proof of Proposition A.5

Necessity. let (c, N, p, q) be an equilibrium. Since n̄i > 0, it follows from the firs-order conditions to the agent’s

problem that λi > 0. By direct comparison of first-order conditions, one can then verify that the equilibrium allocation

solves the Planner’s Problem with weights
                                                                               1/λi
                                                                  αi = P               .
                                                                              k∈I 1/λk




                                                                              65
The associated Lagrange multipliers are µ̂i (ω) = αi µi (ω), q̂(ω) = βq(ω) and v̂ij = βvij and p̂ = βp, where β ≡
P              −1
   i∈I   1/λi         . Finally, we have from Lemma A.2 that:


                                                               X      ∂Ui
                                                          αi                 ci (ω) + n̄i p̂ · N̄ .
                                                               ω∈Ω
                                                                     ∂ci (ω)

                                               P
Adding up across all i ∈ I and using                i∈I   n̄i = 1 yields the desired condition.


Sufficiency. Consider any solution of the Planner’s problem satisfying the conditions stated in the Proposition.

Notice that the second condition implies that αi > 0. Using Proposition A.2 we obtain associated multipliers q̂,

µ̂ and p̂. Consider then the candidate equilibrium prices q(ω) = q̂(ω) and p = p̂. Then, by direct comparison of

first-order conditions, one sees that the component (ci , Ni ) of the Planner’s allocation solves agent i ∈ I’s problem,

except perhaps for the budget feasibility condition. The associated multipliers are λi = 1/αi , µi (ω) = µ̂i (ω)/αi and

vij = v̂ij . To complete the proof, we thus need to verify that (ci , Ni ) satisfies budget feasibility. For this we calculate

the transfer that agent i requires to make the planner’s solution budget feasible:


                                 X                                                  X            Z
                        Ti   ≡         q(ω)ci (ω) + p · Ni − n̄i p · N̄ −                 q(ω)       dj (ω) dNij
                                 ω∈Ω                                                ω∈Ω
                                 X        ∂Ui
                                                                                              X        Z
                             =          αi          + µ̂i (ω) ci (ω) + p̂ · Ni − n̄i p̂ · N̄ −     q̂(ω) dj (ω) dNij
                                 ω∈Ω
                                         ∂ci (ω)                                               ω∈Ω
                                                                      Z
                                 X       ∂Ui
                             =       αi          ci (ω) − n̄i p̂ · N + [p̂j − v̂ij ] dNij
                                 ω∈Ω
                                        ∂ci (ω)
                                 X       ∂Ui
                             =       αi          ci (ω) − n̄i p̂ · N.
                                 ω∈Ω
                                        ∂c i (ω)




where we substituted in the Planner’s first order conditions. Since aggregate ressource feasibility, implies aggregate
                                          P                                               P
budget feasibility, it follows that           i∈I   Ti = 0. Since, in addition,              i∈I     n̄i = 1, we obtain that:


                                                                     XX              ∂Uk
                                                       p̂ · N =                αk           ck (ω),
                                                                                    ∂ck (ω)
                                                                     k∈I ω∈Ω



hence Ti = 0 and budget balance holds since (c, N ) satisfied the second condition stated in the Proposition.




                                                                             66
B.6     Proof of Proposition A.6

Proof that ∆? (α) is convex-valued. To show that ∆? (α) is convex valued, we note that when ui (c) is strictly

concave, ci (ω) is uniquely determined, and so the term



                                                      π(ω)u0i [ci (ω)] ci (ω)



is the same for all (c, N ) ∈ Γ? (α). When ui (c) is linear, then u0 (c)c = c is linear. Taken together, this means that

the function defining ∆? (α) preserves the convexity of Γ? (α).


Proof that ∆? (α) has a closed graph. Consider any converging sequence of αk and ∆k ∈ ∆? (αk ), generated

by a sequence (ck , N k ) ∈ Γ? (αk ). Since Γ? (αk ) is included in the set if incentive feasible allocations, which by Lemma

A.1 we know is weakly compact, we can extract a weakly convergent subsequence (c` , N ` ) of (ck , N k ). Since we

know from Proposition A.1 that Γ? (α) has a weakly closed graph, it follows that lim(c` , N ` ) ∈ Γ? lim α` . If u0i (c)
                                                                                                           


is continuously differentiable at lim c`i (ω), then by continuity we have:


                                     h       i                    h           i            
                          lim αi` u0i c`i (ω) c`i (ω) = lim αi` × u0i lim c`i (ω) × lim c`i (ω) .



If ui (c) is not continuously differentiable at lim c`i (ω) then given our maintained assumption that ui (c) is continuously

differentiable over (0, ∞), it must be that lim c`i (ω) = 0 and u0i (0) = −∞. Since lim c`i (ω) = 0 is part of a social

optimum, it must be that lim αi` = 0. But we know in this case from Proposition A.1 that


                                          h       i                         h           i
                               lim αi` u0i c`i (ω) c`i (ω) = 0 = lim αi` u0i lim c`i (ω) lim c`i (ω).



Taken together, we obtain that lim ∆` = lim ∆k ∈ ∆? (lim α` ) = ∆? (lim αk ).


Proof that ∆? (α) is bounded. Otherwise, there would exists some sequence αk and ∆k ∈ ∆? (αk ) such that

max |∆ki | → ∞. Since αk belongs to a compact set we can extract a converging subsequence α` . Since ∆? (α) has a

closed graph lim ∆` ∈ Γ? (lim α` ) and so must be finite, which is a contradiction.


An auxiliary fixed-point problem. Let M be such that max |∆i | ≤ M for all ∆ ∈ ∆? (α) and α ∈ A. Let
                                                             P
D be the set of transfers ∆ = (∆1 , . . . , ∆I ) such that       i∈I   ∆i = 0 and max |∆i | ≤ M . Finally, let K(α, ∆) be the




                                                                67
function A × D → A such that
                                                                   (αi − ∆i )+
                                                  Ki (α, ∆) = P                   ,
                                                                  k∈I (αk − ∆k )
                                                                                +



where x+ denotes the positive part of x. For each (α, ∆) ∈ A × D, let the set Φ(α, ∆) be the product of the singleton

{K(α, ∆)} and the set ∆? (α). By construction, Φ(α, ∆) ⊆ A×D. Since                                   +
                                                                                 P                            P
                                                                                      k∈I (αk −∆k )       ≥       k∈I   (αk − ∆k ) = 1 > 0

it follows that Ki (α, ∆) is a continuous function over A × D. Given our earlier result that ∆? (α) has a closed graph,

this implies that the correspondence Φ(α, ∆) has a closed graph as well. This allows to apply Kakutani’s fixed point

Theorem (see Corollary 17.55 in Aliprantis and Border (1999)) and assert that Φ has a fixed point, i.e., there exists

some (α, ∆) ∈ A × D such that


                                                           (αi − ∆i )+
                                             αi   =   P                   for all i ∈ I
                                                          k∈I (αk − ∆k )
                                                                        +


                                             ∆    ∈   ∆? (α).



Proof that all fixed-points are such that ∆i = 0 for all i ∈ I. Next, we show that a fixed point of Φ has

the property that ∆i = 0 for all i ∈ I. Indeed if αi = 0, then from the definition of ∆? (α) we have that ∆i ≤ 0, and

from the fixed-point equation that (−∆i )+ = 0 ⇔ ∆i ≥ 0. Hence, if αi = 0, then ∆i = 0. If αi > 0, then from the

fixed point equation


                                  X                                           X
                                        (αk − ∆k )+ = αi − ∆i ⇒ ∆i = αi × 1 −   (αk − ∆k )+ .
                                                                                          
                           αi ×
                                  k∈I                                                 k∈I



Hence, all ∆i such that αi > 0 have the same sign. Since ∆i = 0 when αi = 0, it follows that all ∆i have the same
                  P
sign. But since    i∈I   ∆i = 0, this implies that ∆i = 0 for all i ∈ I.



B.7     Proof of Lemma A.3

Consider two sets of weights α and α0 with corresponding optimal allocations (c, N ) ∈ Γ? (α) and (c0 , N 0 ) ∈ Γ? (α0 ).

Since the constraint set of the planner does not depend on α, (c, N ) and (c0 , N 0 ) are both incentive feasible given α

and α0 . Hence, optimality implies that:



          α1 U1 (c1 ) + α2 U2 (c2 ) ≥ α1 U1 (c01 ) + α2 U2 (c02 ) ⇔ α1 U1 (c1 ) − U1 (c01 ) + α2 U2 (c2 ) − U2 (c02 ) ≥ 0.
                                                                                                                  




                                                                 68
Vice versa:

                                         α10 U1 (c01 ) − U1 (c1 ) + α20 U2 (c02 ) − U2 (c2 ) ≥ 0.
                                                                                         



Adding up these two inequality and using that, since the weight add up to one, α10 − α1 = α2 − α20 , we obtain:


                                        0
                                                     U1 (c01 ) − U1 (c1 ) − U2 (c02 ) − U2 (c2 ) ,
                                                                                           
                                        α1 − α1



which implies that:

                                                  U1 (c01 ) − U1 (c1 ) ≥ U2 (c02 ) − U2 (c2 ).


But then we must have that

                                              U1 (c01 ) − U1 (c1 ) ≥ 0 ≥ U2 (c02 ) − U2 (c2 ).


because otherwise either (c, N ) or (c0 , N 0 ) would not be constrained Pareto optima.



B.8      Modified Security Market Line
                                                                                                                            dj (ω)
Proposition B.1 Suppose the distribution of tree supplies is strictly increasing. Let Rj (ω) =                                pj
                                                                                                                                     be the return of
                     R1        pj                                                      Cov(Rm ,Rj )
asset j, Rm (ω) =     0
                          R1          R (ω)dN̄j
                               p` dN̄` j
                                                  the market return, and βj =            V (Rm )
                                                                                                           the market beta of asset j. Then,
                          0


βj is a continuous and strictly decreasing function of j. Moreover, the expected return of tree j is a piecewise linear

function of βj :
                                                                            
                                            E[Rj − Rf ] = βj E[Rm − Rf ] − θm + θj ,                                                            (48)


where
                                                                                      
                                        θj = θk − φ max(βj − βk , 0 − ψ max(βk − βj , 0 ,                                                       (49)

              P             −1
and Rf =       ω∈Ω   q(ω)         is the risk-free rate, θj = ∆j /pj , is the (per dollar invested) discount induced by incentive
                                                                                             R1           pj
constraints for asset j, k is the marginal tree, φ > 0, ψ > 0, and θm =                          0
                                                                                                     R1          θ dN̄j
                                                                                                          p` dN̄` j
                                                                                                                          is the average discount
                                                                                                     0


induced by incentive constraints. Equation (48) also holds for financial assets by setting θj = 0.


Proof that j 7→ βj is strictly decreasing. Since there are only two states of nature, correlations are either
                                                                                                     σ(Rj )
equal to one, zero, or minus one. It follows from Rm (ω1 ) < Rm (ω2 ) that βj =                      σ(Rm )
                                                                                                            Sign[dj (ω2 )     − dj (ω1 )], where:

                                                     2                                             2
                                        dj (ω) − d¯j
                                                                             
                         2 X                            X                     dj (ω2 ) − dj (ω1 )
                    σ(Rj ) =     π(ω)                   =     π(ω)(1 − π(ω))2
                             ω∈Ω
                                             pj           ω∈Ω
                                                                                         pj




                                                                      69
Equation (13) implies that pj = ai (ω1 )dj (ω1 ) + ai (ω2 )dj (ω2 ), where i denotes the agent holding asset j and ai (ω) > 0.

Thus:
                                                                                                   !1              dj (ω2 )
                                                  1          X                                         2
                                                                                                                   dj (ω1 )
                                                                                                                              −1
                                                                                               2
                                           βj =                    π(ω)(1 − π(ω))                                                 d (ω )
                                                                                                                                            .                                (50)
                                                σ(Rm )       ω∈Ω                                           ai (ω1 ) + ai (ω2 ) djj (ω21 )

dj (ω2 )
dj (ω1 )
           7→ βj is clearly continuous away from the marginal asset k. And it is also continuous at the marginal asset

since pj is continuous at j = k. For j 6= k, we can take the derivative:

                                                                                               !1
                                                                                                   2
                                   dβj             1        X                              2                    ai (ω1 ) + ai (ω2 )
                                  d (ω )
                                               =                  π(ω)(1 − π(ω))                                                            2 > 0.
                                                 σ(Rm )
                                                                                                       
                                d djj (ω21 )                ω∈Ω
                                                                                                                                   d (ω )
                                                                                                           ai (ω1 ) + ai (ω2 ) djj (ω21 )


Proof of equation (48). There is a different pricing kernel for each agent. For assets j held by agent i, the

pricing kernel is:
                                                                                
                                                                      q(ω)            µi (ωi )
                                                          1=E              Rj (ω) − δ          Rj (ωi ).
                                                                      π(ω)              λi
                                                           q(ω) −1
Denoting the risk-free rate as Rf = E                      π(ω)
                                                                        , the usual manipulations lead to:

                                                                                                               
                                                                                                   q(ω)
                                                      E[Rj (ω) − Rf ] = −Rf Cov                         , Rj (ω) + θj ,
                                                                                                   π(ω)


where ∆j = Rf δ µiλ(ωi i ) Rj (ωi ). Since there are two states of nature,                                    q(ω)
                                                                                                              π(ω)
                                                                                                                     can be written as an affine function of the

market return with slope κ. Thus:


                                                                                             
                                                    E[Rj (ω) − Rf ] = −κRf Cov Rm (ω), Rj (ω) + θj ,                                                                         (51)


                                                 ∆j                              pj
where θj = Rf δ µiλ(ωi i ) Rj (ωi ) =            pj
                                                      . Multiplying by      R1
                                                                                 p` dN̄`
                                                                                           and integrating over j, we obtain the pricing kernel for
                                                                             0


the market portfolio:
                                                                                          
                                                        E[Rm (ω) − Rf ] = −κRf V ar Rm (ω) + θm ,                                                                            (52)

                  R1          pj
where ∆m =         0
                         R1          θ dN̄j .
                              p` dN̄` j
                                                 Combining (51) and (51) yields the modified CAPM formula (48).
                         0


     Next, we show that θj can be written as a piecewise linear function of βj with a kink at the marginal asset βk .
              dj (ω1 )                 1                                                                                                dj (ω2 )
Rj (ω1 ) =      pj
                         =    ai (ω1 )+ai (ω2 )bj
                                                    , where i denotes the agent holding asset j and bj ≡                                dj (ω1 )
                                                                                                                                                 .   Equation (50) implies
                                                                                      b −1                                                                                    1
                                                             j                                                                       1
                                                                                                                                                          π(ω)(1 − π(ω))2
                                                                                                                                                P
that βj can be written as a function of bj : βj = ρ0 ai (ω1 )+ai (ω2 )bj
                                                                         , where ρ0 =                                              σ(Rm )           ω∈Ω
                                                                                                                                                                                2
                                                                                                                                                                                    .
                                                                                                              ρ0 +βj ai (ω1 )                                  ρ0 −βj ai (ω2 )
Inverting this function, we can write bj as a function of βj : bj =                                           ρ0 −βj ai (ω2 )
                                                                                                                              .   Thus: Rj (ω1 ) =          (ai (ω1 )+ai (ω2 ))ρ0
                                                                                                                                                                                  .
                                   ρ0 +βj ai (ω1 )
Similarly: Rj (ω2 ) =           (ai (ω1 )+ai (ω2 ))ρ0
                                                      .   It implies that ∆j is linear and decreasing in βj for assets j held by agent 1

and linear and increasing for asset held by agent 2. It follows from the continuity of θj at the marginal asset k that


                                                                                   70
θj can be written as (49).



B.9     Long and Short Positions in All Assets

In the model studied in the text, it is assumed that agents can only take short position in Arrow securities. In this

appendix we generalize our model and assume that agents can take short positions in all assets: Arrow securities and

trees. We show that the equilibrium is robust: the same collection of prices and allocation remains an equilibrium

when agents can take short positions in all assets.



B.9.1    Distinguishing Long and Short Positions

To make this argument we introduce new notations that explicitly distinguish long positions from short positions in

an agent’s tree portfolio. Namely, we denote the net tree position by Ni = Ni+ − Ni− , where Ni+ is a positive measure

for the long position, and Ni− is a positive measure for the short position. Likewise, the net Arrow security position

                      −
is ai (ω) = a+
             i (ω) − ai (ω). We take all short positions to be liabilities: that is a short position on a particular tree is


a state contingent promise to pay dj (ω) in state ω ∈ Ω. The incentive compatibility constraint in state ω now states

that the agent prefers paying off the liability induced by the total short position, rather than diverting a fraction δ

of the long position.

                                  Z                                          Z
                                                                       −                             −
                        δ a+                    +            +                          +                  
                           i (ω) +   d j (ω) dN ij (ω)   ≤ a i (ω) − a i (ω) +   dj (ω) dNij (ω) − dNij (ω)
                                   Z                                     Z         
              ⇐⇒        a−
                         i (ω) +
                                                −
                                       dj (ω) dNij (ω) ≤ (1 − δ) a+
                                                                  i (ω) +   d j (ω)   dNi+ (ω).                        (53)



   The other constraints for agent i are the budget constraint at t = 0


                        X                                Z                                  Z
                                             −                               −
                              q(ω) a+
                                                               +                
                                    i (ω) − ai (ω) +         pj dNij (ω) − dNij (ω) ≤ n̄j        pj dN̄j ,             (54)
                        ω∈Ω



and the budget constraint at t = 1

                                                              Z
                                                   −                                  −
                                ci (ω) = a+
                                                                         +                 
                                          i (ω) − ai (ω) +        dj (ω) dNij (ω) − dNij (ω) .                         (55)



   This formulation allows net positions to differ from gross positions. That is, we could have a+
                                                                                                 i (ω) > 0 and


a−                                           +              −
 i (ω) > 0 for some ω ∈ Ω, or we could have Ni (J) > 0 and Ni (J) > 0 for some measurable set J.


   The agent’s problem with long and short positions in all assets is to choose state-contingent consumption plan, ci ,


                                                               71
                       −         −
and a portfolio (a+         +
                  i , ai , Ni , Ni ) in order to maximize the expected utility Ui (ci ), subject to the constraint (53)-(55)




B.9.2      Equilibrium Robustness

Next, we show that our equilibrium is robust to allowing agents to take long and short positions in all assets.

To see this, consider an equilibrium of the paper. For trees in strictly positive supply, it is always the case that
       P
pj ≤     ω∈Ω   q(ω)dj (ω), as shown in Lemma 4. For trees in zero supply there is some indeterminacy but we can always

pick a price such that this inequality holds as well. Now let the solution of the agent’s problem be (ci , ai , Ni ) and let

               −           −
(ĉi , â+           +
         i , âi , N̂i , N̂i ) be such that:




                                        ĉi (ω) ≡ ci (ω)

                                                                       −
                                        â+
                                          i (ω) ≡ max{ai (ω), 0} and âi (ω) ≡ − min{ai (ω), 0}


                                        N̂i+ ≡ Ni and N̂i− ≡ 0.



Then, we have:


                                                              −           −
Proposition B.2 Given the price system (p, q), (ĉi , â+           +
                                                        i , âi , N̂i , N̂i ) is a solution of the agent’s problem with long


and short positions in all assets.


    The proof is straightforward and follows because short positions in Arrow securities are more profitable than

                                                                     q(ω)dj (ω). Hence, by replacing the short position in tree Ni− by
                                                           P
short positions in trees. This is because pj ≤                 ω∈Ω

                                                                                  −
                                                                      R
a payoff-identical short position in Arrow securities,                    dj (ω)dNij , the agent can generate (weakly) higher profits at

time zero, and satisfy all the other constraints. Therefore, to find a solution to the agent’s problem, we can restrict

attention to tree portfolios such that Ni− = 0. In that case the collateral constraint becomes

                                                                        Z             
                                               a−                +
                                                i (ω) ≤ (1 − δ) ai (ω) +
                                                                                    +
                                                                           dj (ω) dNij   .                                         (56)



This is the same constraint as in Section 2.2, and so the result follows.




                                                                           72
