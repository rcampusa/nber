                              NBER WORKING PAPER SERIES




                               TRADE WITH CORRELATION

                                         Nelson Lind
                                       Natalia Ramondo

                                      Working Paper 24380
                              http://www.nber.org/papers/w24380


                    NATIONAL BUREAU OF ECONOMIC RESEARCH
                             1050 Massachusetts Avenue
                               Cambridge, MA 02138
                          March 2018, Revised October 2018




We thank our discussants Costas Arkolakis and Arnaud Costinot for their very helpful comments.
We benefit from comments from Roy Allen, Dave Donaldson, Jonathan Eaton, Stefania Garetto,
and Fernando Parro, as well as from participants at various seminars and conferences. All errors
are our own. The views expressed herein are those of the authors and do not necessarily reflect
the views of the National Bureau of Economic Research.

NBER working papers are circulated for discussion and comment purposes. They have not been
peer-reviewed or been subject to the review by the NBER Board of Directors that accompanies
official NBER publications.

© 2018 by Nelson Lind and Natalia Ramondo. All rights reserved. Short sections of text, not to
exceed two paragraphs, may be quoted without explicit permission provided that full credit,
including © notice, is given to the source.
Trade with Correlation
Nelson Lind and Natalia Ramondo
NBER Working Paper No. 24380
March 2018, Revised October 2018
JEL No. F1

                                          ABSTRACT

We develop a trade model in which productivity presents an arbitrary pattern of correlation. The
model approximates the full class of factor demand systems consistent with Ricardian theory. In
particular, our framework formalizes Ricardo’s insight that countries gain more from trade with
partners that have relatively dissimilar technology. Incorporating this insight entails a simple
correction to the sufficient-statistic approach used for macro counterfactuals, and enables a
general aggregation result that links macro demand systems to micro estimates. In our
quantitative application, we estimate a multi-sector trade model which captures the possibility
that nearby countries may share technology, and, hence, have correlated productivity draws. Our
estimates suggest that accounting for correlation is key to calculating the gains from trade.


Nelson Lind
Department of Economics
Emory University
1602 Fishburne Drive
Rich Bldg., 3rd Floor
Atlanta, GA 30322-2240
nlind@emory.edu

Natalia Ramondo
School of Int'l Relations and Pacific Studies
University of California at San Diego
9500 Gilman Drive, MC 0519
La Jolla, CA 92093
and NBER
nramondo@ucsd.edu
1       Introduction

Two hundred years ago, Ricardo (1817) proposed the idea that cross-country dif-
ferences in production technologies can lead to gains from trade. Ricardo’s work,
which extended Smith (1776)’s idea on specialization to international trade, led to
the following insight: Two countries gain more from trade when they have dissim-
ilar production possibilities. Recent evidence suggests that similarity in technol-
ogy relates to country characteristics—for instance, to the proximity of countries
(Keller, 2002; Bottazzi and Peri, 2003; Comin et al., 2013; Keller and Yeaple, 2013).
If so, correlation in productivity may lead to heterogeneity in the gains from trade.

The Ricardian trade model in Eaton and Kortum (2002, henceforth, EK)—which
gave rise to a rich theoretical and quantitative literature—does not account for
correlation. They assume that productivity is independently distributed Fréchet
across countries. This assumption leads to tractability via a max-stability prop-
erty: the maximum is also Fréchet and its scale is the sum of the underlying scale
parameters,
                                                          "      N
                                                                            !     #
                                                                 X
                    P[max{A1 , . . . , AN } ≤ a] = exp −               To       a−θ .
                                                                 o=1


The symmetry of this additive structure, a consequence of independence, implies
that all trading partners are indistinguishable. As a result, the EK model cannot
capture how similarities across countries shape the gains from trade—which may
be important to understand why countries choose certain trading partners and not
others.

In this paper, we develop a Ricardian theory of trade that allows for arbitrary pat-
terns of correlation in technology, yet preserves the max-stability property central
to the EK model. Specifically, we drop independence and assume a max-stable
multivariate Fréchet distribution for productivity. The distribution of the maxi-
mum is then
                                                    h                        i
                  P[max{A1 , . . . , AN } ≤ a] = exp − G(T1 , . . . , TN )a−θ ,

for some correlation function G.1 Countries can now have different weight on the
    1
   A correlation function, often referred as a tail dependence function or a extremal index function in
probability and statistics, gives a way of representing a max-stable copula.


                                                  1
scale of the maximum. In this way, our framework generalizes EK, maintains its
tractability, and allows us to extend the results of Arkolakis et al. (2012) (hence-
forth, ACR) to incorporate how similarity between countries influences the gains
from trade.

The assumption of a max-stable multivariate Fréchet productivity distribution im-
plies a factor demand system with expenditure shares that match choice probabili-
ties in generalized extreme value (GEV) discrete choice models (McFadden, 1978).
As a result, any trade model that generates a GEV factor demand system is ob-
servationally equivalent to a model in our framework for some specification of
the correlation function. In fact, our framework captures general Ricardian the-
ory due to an approximation result: The GEV class approximates any Ricardian
model—without the need to restrict to Fréchet productivity distributions. Hence,
any factor demand system generated by the Ricardian trade model can be approx-
imated using a multivariate Fréchet distribution of productivity. Put simply, our
framework captures the full aggregate implications of Ricardian trade theory.2

Despite this generality, our theory leads to intuitive and tractable counterfactual
analysis. We show that within the class of GEV factor demand systems, we can
calculate the gains from trade as a simple adjustment to the case of a constant-
elasticity-of-substitution (CES) demand system. Specifically, we show that the re-
sults of ACR generalize, after a simple correction, to the class of models whose
demand systems fit into the GEV form. In the Ricardian context, this correction
adjusts a country’s self-trade share to account for correlation in technology with
the rest of the world, formalizing Ricardo’s insight that more dissimilar countries
have higher gains from trade. Additionally, for any given pattern of correlation
across countries, the adjusted self-trade share is calculated using only data on ex-
penditure shares across countries, preserving the simplicity of ACR.

We can also leverage the max-stability property to get closed-form aggregation,
and to get guidance on how to use micro data to discipline macro factor demand
systems. This result brings existing Ricardian models into a unifying framework.
Specifically, the GEV class accommodates many disaggregate Ricardian models of
trade, such as multi-sector models (Costinot et al., 2012; Costinot and Rodrìguez-
Clare, 2014; Caliendo and Parro, 2015; Ossa, 2015; Levchenko and Zhang, 2016;
French, 2016), multinational production models (Ramondo and Rodríguez-Clare,
   2
    While in the body of the paper we assume that preferences are CES, in Online Appendix O.2.1,
we relax this assumption.


                                               2
2013), global value chain models (Antràs and de Gortari, 2017), and models of
trade with domestic geography (Fajgelbaum and Redding, 2014; Ramondo et al.,
2016; Redding, 2016). In Section 6, we show that all these models, once aggre-
gated at the bilateral level, can be represented by a model in which productivity is
distributed multivariate Fréchet with a correlation function appropriately chosen.

We next assess the empirical relevance of correlation. In our quantitative applica-
tion, we estimate a multi-sector model of trade where correlation in productivity
can depend on the proximity of countries. This spatial correlation model captures
the possibility that nearby countries may share similar technology—and therefore
have correlated productivity draws—by allowing for distance-dependent elastici-
ties of substitution across countries, within sectors.

Our estimates show that correlation follows a spatial pattern: Distant countries
have productivity draws with lower correlation. This empirical result has impor-
tant implications for counterfactuals. Accounting for these spatial correlation pat-
terns translates into gains from trade that can be much higher—and much more
heterogenous—than the gains calculated without accounting for correlation.

This paper relates to several strands of the literature. First, we naturally make con-
tact with the large trade literature using the Ricardian-EK framework in its various
forms (see Eaton and Kortum, 2012, for a survey). More generally, our approach
can be applied to any environment that requires Fréchet tools, with the potential
of changing some of their quantitative conclusions. In particular, it can be applied
to selection models used in the growth literature (such as Hsieh et al., 2013), and
the macro development literature (such as Lagakos and Waugh, 2013; Bryan and
Morten, 2018), as well as to recent trade models used in the urban literature (such
as Ahlfeldt et al., 2015; Monte et al., 2015; Caliendo et al., 2017), reviewed in Red-
ding and Rossi-Hansberg (2017).

Second, we relate to papers in the international trade literature that use non-CES
factor demand systems.3

The early work by Wilson (1980) shows how the Ricardian model in Dornbusch
et al. (1977), extended to an arbitrary number of countries, can be reduced to an-
alyzing the properties of an exchange economy—-countries trade their labor with
   3
     A related trade literature departs from CES with the goal of analyzing endogenous markups
and their effects on the gains from trade. See DeLoecker et al. (2016), Feenstra and Weinstein (2017),
Bertoletti et al. (2017), and Arkolakis et al. (2017), among others.



                                                  3
each other. Under some restrictions on the properties of the factor demand sys-
tem (i.e., gross substitutes and homotheticity), some comparative static results are
derived, such as the effect of increasing tariffs from zero uniformly across goods.
Results, however, are only local. Additionally, Scarf and Wilson (2005) present a
Ricardian model with a demand structure that satisfies the gross substitutability
property, and in which productivity follows an arbitrary probability distribution.
They show that, in this case, the competitive equilibrium exists and is unique.
We restrict our attention to the sub-class of GEV factor demand systems—which
includes models used extensively in the trade literature—and show that it can ap-
proximate any demand system generated by the Ricardian model.

Adao et al. (2017), building on the idea in Wilson (1980), show how to calculate
macro counterfactual exercises in neoclassical trade models with invertible factor
demand systems, and provide sufficient conditions for non-parametric identifi-
cation using aggregate trade data. In our paper, we restrict to the GEV class—a
subclass with the invertibility property. Given that restriction, our aggregation re-
sult allows us to relate various micro structures to the macro demand systems that
they study, and, as a result, to use variation in disaggregate data to identify macro
substitution patterns. All in all, our paper provides a bridge between the macro
results of Adao et al. (2017) and estimates, common in the trade literature, based
on micro data.4

In that regard, papers such as Caron et al. (2014), Lashkari and Mestieri (2016),
Brooks and Pujolas (2017), Feenstra et al. (2017), and Bas et al. (2017), among oth-
ers, estimate non-CES demand systems using disaggregate data. Even though they
abandon the class of homothetic demand systems, which we do not, they aim, as
we do, at showing the consequences of abandoning the assumptions that lead to
linear gravity systems, and at incorporating more detailed micro data to estimate
key elasticities. They all notice the failure of aggregate theories to incorporate the
richness of the micro data (e.g., heterogeneous price and income elasticities across
traded goods), and "fix it" by assuming non-CES demand systems.5 By linking var-
   4
      Our paper shares a common theme with Redding and Weinstein (2017) as they develop a
framework to aggregate from micro trade transactions to macro trade and prices using the class of
nested invertible demand systems.
    5
      Caron et al. (2014) use a constant-relative-elasticity-of-income utility functions to link charac-
teristics of goods in production to their characteristics in preferences, and in this way explain some
"puzzles" observed in the data on trade patterns. Lashkari and Mestieri (2016) use constant-relative-
elasticity-of-income-and-substitution (CREIS) utility functions that allow for general relationships
between income and price elasticies. Brooks and Pujolas (2017) analyze the expression for gains



                                                   4
ious micro structures to common primitives of technology, our general framework
provides guidance—given by our aggregation result—on how to incorporate the
micro estimates in this literature into macro counterfactual exercises.

In contrast with this literature, from the supply-side point of view of our frame-
work, substitution patterns come from the degree of technological similarity—i.e.,
correlation—between countries. As a result, we can incorporate destination-origin
elasticities without relying on demand-side factors and non-CES preferences.6

Finally, we relate to the literature on dynamic innovation and knowledge diffusion
processes that generate Fréchet productivity—as in Kortum (1997), Eaton and Ko-
rtum (1999), Eaton and Kortum (2001), and Buera and Oberfield (2016). We make
contact with this literature by introducing a global innovation representation for pro-
ductivity. This representation characterizes multivariate Fréchet productivity as
the consequence of technology adoption, and provides an economic justification
for any choice of the correlation function. In this representation, an (unbounded)
collection of innovations for the production of each good exists. The productiv-
ity of each innovation depends on a global component—common across coun-
tries and capturing the fundamental efficiency of the technology—and a spatial
applicability component—unique to each country pair and capturing bilateral fac-
tors influencing efficiency. For each good the global component follows a Poisson
process, while spatial applicability can have any distribution. We then apply the
spectral representation theorem for max-stable processes (De Haan, 1984; Penrose,
1992; Schlather, 2002) and establish that productivity has this global innovation
representation if and only if it is distributed max-stable multivariate Fréchet. This
result not only provides economic primitives for productivity, but it also gives a
method to compute correlation functions from any underlying assumptions on the
applicability of technology across the globe.
from trade arising from models with unrestricted utility functions (typically non-homothetic) that
generate a non-constant trade elasticity. Feenstra et al. (2017) use a nested CES utility function to es-
timate micro and macro elasticities of substitution in a multi-sector model. Finally, Bas et al. (2017)
break the Pareto assumption in the Melitz model of trade to get country-pair specific aggregate
elasticities, which they estimate using sectoral-level trade data.
   6
     In Online Appendix O.2, we show extensions of our framework that include comparative ad-
vantage coming from demand-side factors as in the Armington model of trade (Anderson, 1979),
and from entry of heterogenous firms as in the Krugman-Melitz model of trade (Krugman, 1980;
Melitz, 2003). Similarly to ACR, these results make clear which assumptions on economic funda-
mentals lead to equivalence within a large and useful class of models.




                                                   5
2       Ricardian Model of Trade

Consider a global economy consisting of N countries that produce and trade in a
continuum of product varieties v ∈ [0, 1]. Consumers have identical CES prefer-
                                                  R         σ
                                                                    σ+1
                                                     1                σ
ences with elasticity of substitution σ > −1, Cd = 0 Cd (v) σ+1 dv       .7 Given total
expenditure of Xd , expenditure on variety v is Xd (v) ≡ Pd (v)Cd (v) = (Pd (v)/Pd )−σ Xd
                                                  R             − σ1
                                                     1      −σ
where Pd (v) is the price of the variety, and Pd = 0 Pd (v) dv         is the price level
in country d.

We assume that the production function for varieties presents constant returns to
scale in labor and depends on both the origin country o where the good gets pro-
duced and the destination market d where it gets delivered. For each v ∈ [0, 1],
output Yod (v) satisfies
                                   Yod (v) = Aod (v)Lod (v),                                  (1)

where Lod (v) is the amount of labor used to produce variety v at origin o for de-
livery to d and Aod (v) is the marginal product of labor—referred to as productivity.
This productivity variable captures both efficiency of production in the origin and
inefficiencies associated with delivery to the destination (i.e., trade costs).

The marginal cost to deliver a particular variety v to destination d from origin o is

                                                     Wo
                                       cod (v) =            ,                                 (2)
                                                    Aod (v)

where Wo is the nominal wage in country o. As in the original EK model, we as-
sume perfect competition so that prices are equal to unit costs, Pod (v) = cod (v).
Good v is provided to country d by the cheapest supplier, so its price in the desti-
nation market is
                                                          Wo
                                   Pd (v) = min                  .                            (3)
                                             o=1,...,N   Aod (v)

As in EK, we capture heterogeneity in production possibilities by modeling pro-
ductivity as a random draw. We focus on multivariate random variables which
satisfy a property known as max stability. The EK model, which is built on in-
    7
      The restriction to CES preferences is not necessary for our main results, which rely only on
expenditure shares matching import probabilities. In Online Appendix O.2.1, we show that if con-
sumer preferences are homothetic and generate demand satisfying a law of large numbers on Borel
subsets of the continuum of varieties, expenditure shares equal import probabilities when produc-
tivity is multivariate θ-Fréchet. We focus on CES preferences for comparability to the standard EK
framework.

                                                6
dependent Fréchet random variables, gets its tractability from this property. By
relaxing their independence assumption, we get a flexible, yet tractable, model of
trade that captures Ricardo’s insight that the degree of technological similarity de-
termines the gains from trade. Importantly, by assuming that random productivity
is country-pair specific, we are able to introduce purely Ricardian bilateral motives
for trade.


2.1    Max-Stable Multivariate Fréchet Productivity

We start by providing a brief overview of max-stable multivariate Type II extreme
value (Fréchet) random variables. We first define a multivariate θ-Fréchet random
vector.

Definition 1 (Multivariate θ-Fréchet). A random vector, (A1 , . . . , AK ), has a multi-
variate θ-Fréchet distribution if for any αk ≥ 0 with k = 1, . . . , K the random vari-
able maxk=1,...,K αk Ak has a Fréchet distribution with shape parameter θ. In this case,
the marginal distributions are Fréchet with (common) shape parameter θ and, for each
k = 1, . . . , K, satisfy
                                P [Ak ≤ a] = exp −Tk a−θ ,
                                                       
                                                                                     (4)

for some scale parameter Tk .

This definition implies that a multivariate θ-Fréchet distribution is max stable—the
maximum has the same marginal distribution up to scaling. The multivariate θ-
Fréchet distribution includes as special cases the independent multivariate Fréchet
distribution in EK, and the symmetric multivariate Fréchet distribution used in
Ramondo and Rodríguez-Clare (2013). For both special cases, the max-stability
property holds and lends the models their tractability.

By working with the class of multivariate θ-Fréchet random vectors, we can put
minimal restrictions on dependence and maintain the key property of max-stability.
Notice that the restriction to a common shape is necessary for max stability; general
multivariate Fréchet distributions may have marginal distributions with different
shape parameters, in which case the maximum, even with independence, is not
distributed Fréchet.

To make headway without the independence assumption, we characterize the joint
distribution of a multivariate θ-Fréchet random vector by first defining the func-

                                            7
tion that summarizes its correlation structure.

Definition 2 (Correlation Function). G : RK
                                          + → R+ is a correlation function if:


    1 (Normalization). G(0, . . . , 0, 1, 0, . . . , 0) = 1;

    2 (Homogeneity). G is homogeneous of degree one;

    3 (Unboundedness). G(x1 , . . . , xK ) → ∞ as xk → ∞ for any k = 1, . . . , K; and

    4 (Differentiability). The mixed partial derivatives of G exist and are continuous up
       to order K. The k’th partial derivative of G with respect to k distinct arguments is
       non-negative if k is odd and non-positive if k is even.

A correlation function is closely related to a max-stable copula and adds a nor-
malization restriction to the definition of a social surplus function in GEV dis-
crete choice models (McFadden, 1978).8 This normalization restriction provides
us with notation to distinguish between absolute advantage—captured by scale
parameters—and comparative advantage—captured by a correlation function. Cor-
relation functions reflect comparative advantage because they measure relative
productivity levels across varieties and across origin countries within the same
destination market.

Next, we characterize the joint distribution of any multivariate θ-Fréchet random
vector in terms of the scale parameters of its marginal distributions and a correla-
tion function.

Lemma 1 (Correlation Function Representation). The random vector (A1 , . . . , AK )
is multivariate θ-Fréchet if and only if there exists scale parameters Tk for k = 1, . . . , K
and a correlation function G such that its joint distribution satisfies

                                                                             −θ
                P [Ak ≤ ak , k = 1, . . . , K] = exp −G T1 a−θ
                                                                               
                                                            1 , . . . , T K aK     .                         (5)

Proof. The result follows closely Theorem 3.1 of Smith (1984). See Appendix B.

This standard result from probability theory allows us to parameterize joint distri-
butions using scale parameters and correlation functions. The restrictions defining
   8
     A max-stable copula is a copula C : [0, 1]N → [0, 1] satisfying C(u1 , . . . , uN )η = C(uη1 , . . . , uηN )
for η > 0. The map (u1 , . . . , uN ) 7→ e−G(−1/ ln u1 ,...,−1/ ln uN ) is the max-stable copula associated
with a correlation function G.


                                                       8
a correlation function ensure that (5) characterizes a valid multivariate Type II ex-
treme value (Fréchet) distribution.

Importantly, using the characterization in Lemma 1 and the homogeneity property
of the correlation function, we get the max-stability property. The maximum of a
multivariate θ-Fréchet random vector is θ-Fréchet,
                                           
                                  max Ak ≤ a = exp −G (T1 , . . . , TK ) a−θ ,
                                                                           
                         P                                                                                        (6)
                                k=1,...,K


with scale parameter given by G (T1 , . . . , TK ) and shape parameter given by θ.
Evaluated at the scale parameters of the marginal distributions, the correlation
function acts as an aggregator that returns the scale parameter of the maximum.
Moreover, as in EK, the conditional and unconditional distributions of the maxi-
mum are identical,
                                                                                            
            P         max Ak0 ≤ a | Ak = 0 max Ak0 = P                        max Ak0 ≤ a .                       (7)
                    k0 =1,...,K                 k =1,...,N                  k0 =1,...,K


This result is crucial for tractability in EK because it ensures that expenditure
shares simply reflect the probability of importing from an origin country. Because
this property holds for general multivariate θ-Fréchet random vectors, our model
inherits the same tractability. Appendix A formally presents this and other prop-
erties of Fréchet random variables which we use throughout the paper.

To fix ideas, consider the special case of independent productivity—used by EK.
Independence implies that the correlation function is additive,

                                                                                              N
                                                                                                              !
                                                  Y                                           X
 P[A1d (v) ≤ a1 , . . . , Aod (v) ≤ aN ] =                  P[Aod (v) ≤ ao ] = exp −                Tod a−θ
                                                                                                         o        .
                                                o=1,...,N                                     o=1


The max-stability property holds since

                                                            "       N
                                                                                  !       #
                                                                      X
                        P         max Aod (v) ≤ a = exp −                   Tod       a−θ .
                             o=1,...,N
                                                                      o=1



An additive correlation function imposes a strong assumption, namely, that com-
parative advantages across countries are symmetric. Our framework relaxes inde-
pendence while maintaining the max-stability property. By breaking this symme-
try, our model accommodates heterogeneity in comparative advantage, and, as we


                                                      9
show in Section 4, allows us to formalize how similarity in technology matters for
the gains from trade.

The next section shows how a correlation function can be constructed from funda-
mentals, and hence, provides an economic justification for any choice of G.


2.2    Global Innovation Representation of Productivity

We present a structure for technology that is necessary and sufficient for productivity
to be distributed multivariate θ-Fréchet. This structure can be interpreted as the re-
sult of adopting technologies—which are a product of global innovations—based
on a country’s ability to apply each innovation. Theorem 1 characterizes multivari-
ate θ-Fréchet distributions as precisely the productivity distributions arising from
global innovation.

The result is based on a technology structure that satisfies three assumptions.

Assumption 1 (Innovation Decomposition). There exists θ > 0 and, for each v ∈
[0, 1], a countable set of global innovations, i = 1, 2, . . . , with global productivity {Zi (v)}i=1,2,...
and spatial applicability {{Aiod (v)}N
                                     o=1 }i=1,2,... satisfying


                               Aod (v) = max (Zi (v)Aiod (v))1/θ .                                (8)
                                          i=1,2,...


Assumption 2 (Independence). {{Aiod (v)}N
                                        o=1 }i=1,2,... is independent of {Zi (v)}i=1,2,...
and i.i.d. over i = 1, 2, . . . and v ∈ [0, 1] with EAiod (v) < ∞.

Assumption 3 (Poisson Innovations). The collection {Zi (v)}i=1,2,... consists of the
points of a Poisson process with intensity measure z −2 dz, and is i.i.d. over v ∈ [0, 1].

First, Assumption 1 defines a structure for technology that can be interpreted as
arising from global innovation and technology adoption. For each good v, there is
a countable collection of technological innovations i = 1, 2, . . . that influence the
marginal product of labor. These innovations represent physical techniques (i.e.,
blueprints) for producing a good. For a given good v, each innovation i has a global
productivity component, Zi (v), and an origin-destination specific spatial applicability
component, Aiod (v). The global productivity component measures the fundamen-
tal efficiency of technique i. Accordingly, it is identical across all origins and des-
tinations. In turn, the spatial applicability component captures origin-destination


                                                  10
specific factors that determine the efficiency of the technique when adopted at ori-
gin o to deliver goods to destination d.

Second, the key aspect of Assumption 2 is that it does not impose independence
of applicability across origin countries; instead, it allows for arbitrary patterns of
correlation. Moreover, the assumption does not impose any particular joint dis-
tribution for applicability; this distribution can belong to any family so long as
its first moments exists. In our examples, we use Fréchet distributions for spatial
applicability only because they lead to closed-form solutions.

Finally, Assumption 3 states that the global productivity component, Zi (v), follows
a non-homogenous Poisson process over i’s, for each v. This assumption implies
that the number of innovations whose global productivity satisfies a < Zi (v) ≤ b
is a Poisson random variable. It also implies that the distribution of Zi (v) over v,
                                                                                     1
conditional on i, is Pareto with shape parameter i and lower bound (i!)− i .9 Loosely
speaking, better innovations (i.e., with higher global productivity) are less likely to
be observed, but conditional on being observed, later innovations (with higher i)
have a higher lower bound and thinner-tailed (lower-variance) Pareto distribution
across goods v.

One can interpret Assumption 3 as arising from some random discovery process
as in Eaton and Kortum (1999, 2010). In our static framework, we can interpret i as
indexing the collection of all innovations up until the present. Rather than assum-
ing that innovations are country specific, innovations—which represent physical
methods to produce a good—are globally applicable. Origin countries differen-
tially load on global productivity through their individual draw of spatial applica-
bility, Aiod (v), and adopt whichever innovation is most efficient for them.

The following theorem is a consequence of the spectral representation theorem for
max-stable processes (De Haan, 1984; Penrose, 1992; Schlather, 2002).

Theorem 1 (Global Innovation Representation). Productivity, {Aod (v)}N
                                                                     o=1 , is mul-
tivariate θ-Fréchet if and only if it satisfies Assumptions 1, 2, and 3. In this case, we say
that productivity has a global innovation representation.

Let {Aiod (v)}N
              o=1 denote an underlying spatial applicability process. Then, the joint pro-
   9
     We have that P[Zi (v) > z] = P[Zi (v)−1 < t] for t = z −1 . Then, since {Zi (v)}i=1,2,... are
the points of a non homogenous Poisson process with intensity measure z −2 dz, {Zi (v)−1 }i=1,2,...
                                                                      P∞ j             i       −i
are the points of a homogenous Poisson process, and P[Zi (v)−1 < t] = j=i tj! e−t = ti! = zi! .
                                       −i
                                   z
Therefore, P[Zi (v) ≤ z] = 1 − (i!)−1/i     .


                                                11
ductivity distribution is

                                                                                     −θ
         P [A1d (v) ≤ a1 , . . . , AN d (v) ≤ aN ] = exp −Gd T1d a−θ
                                                                                       
                                                                  1 , . . . , T N d aN     ,       (9)

with scale Tod ≡ EAiod (v), for o = 1, . . . , N , and correlation function

                                                                   Aiod (v)
                            Gd (x1 , . . . , xN ) ≡ E max                   xo .                  (10)
                                                       o=1,...,N    Tod

Proof. See Appendix C.

This characterization of productivity establishes primitive assumptions on global
technology that are necessary and sufficient for θ-Fréchet-distributed productiv-
ity across origin countries.10 θ-Fréchet productivity can always be interpreted as
arising from the spatial applicability of global technologies. Intuitively, both abso-
lute advantage (the scale parameters) and comparative advantage (the correlation
function) depend on the ability of exporters to adopt innovations to technology.

This result also provides a method to compute scale parameters and correlation
functions: They are simply the moments of spatial applicability and the expected
value of the maximum of applicability after scaling. Put differently, Theorem 1
gives guidance on how to construct max-stable copulas.

Concretely, assume that the spatial applicability of individual technologies is inde-
pendent across o and distributed Fréchet with scale Γ(1 − 1/ϑ)−ϑ Sod , shape ϑ > 1,
and Γ the gamma function. The constant on the scale ensures that productivity
remains finite as ϑ → 1.

First, we compute the scale parameters of productivity. Theorem 1 establishes that
the scale parameters equal the first moments of spatial applicability. By Lemma A.1,
         1/ϑ
Tod = Sod .

Next, we derive the correlation function—i.e., the expectation in (10). From Lemma A.1,
(Aiod (v)/Tod )xo is ϑ-Fréchet with scale xϑo . Due to independence and max-stability,
the maximum over o is also ϑ-Fréchet and its scale is the sum of the underlying
  10
     It is worth noting that, contrary to the insight first in Kortum (1997), in which the distribution
of the best idea belongs to the extreme value family in the limit, this result is exact.




                                                  12
scale parameters. Using Lemma A.1 to compute the expectation in (10) yields

                                         N
                                                      !1−ρ
                                         X       1
                                                                              1
               Gd (x1 , . . . , xN ) =          1−ρ
                                               xo            ,   where ρ ≡ 1 − .   (11)
                                         o=1
                                                                              ϑ

The implied joint distribution of productivity follows from (9) in Theorem 1.

The correlation function in (11) takes the form of a CES aggregator. The coeffi-
cient ρ measures the degree of correlation, which arises from dispersion in spatial
applicability, controlled by the shape parameter ϑ. As ϑ → 1, dispersion in ap-
plicability is high, and ρ → 0. Intuitively, when applicability becomes very fat
tailed, it dominates the contribution of the common global component of produc-
tivity. In this limiting case, productivity is independent and the correlation func-
tion is additive—as in EK—due to our assumption that applicability is indepen-
dent across countries. In contrast, as ϑ → ∞, dispersion in applicability becomes
negligible and ρ → 1. In this case, applicability becomes deterministic and hetero-
geneity in productivity is entirely determined by the global component, Zi (v). As
a result, productivity becomes perfectly correlated across countries.

This example provides intuition for how Theorem 1 generates varying degrees of
correlation in productivity from underlying assumptions on the applicability of
technology across the globe. High dispersion in spatial applicability dampens the
importance of the common global component of productivity and reduces correla-
tion. This example is also a useful building block for generating richer correlation
functions when combined with our aggregation result in Section 5.

As another application of Theorem 1, we compute a cross-nested CES (CNCES)
correlation function. This example demonstrates how to build correlation func-
tions from underlying microfoundations for technology adoption.

Consider a latent (within country) technology adoption decision where applicabil-
ity comes from a choice of how to apply each innovation. In particular, firms se-
lect an application m across M alternatives so that Aiod (v) = maxm=1,...,M Aimod (v).
Assume that applicability is independent across m and for each m it is ϑ-Fréchet
across o with scale Γ(1 − 1/ϑ)−ϑ Tmod and a correlation function as in (11) with
ρm ∈ [0, 1).

First, we compute the scale parameters of the productivity distribution. Due to
independence, the maximum of applicability over m is ϑ-Fréchet with scale Γ(1 −


                                                    13
         PM
1/ϑ)−ϑ           Tmod . From Lemma A.1, productivity has scale Tod = ( M          1/ϑ
                                                                      P
           m=1                                                          m=1 Tmod )    .

Next, we compute the correlation function. By Lemma A.2, { Aimod
                                                             Tod
                                                                 (v)
                                                                     xo } N
                                                                          o=1 is ϑ-
Fréchet with scale Tmod (xo /Tod )ϑ and CES correlation function with parameter ρm .
Due to max-stability, the maximum over o is also ϑ-Fréchet and it has scale equal to
                           1
( N                    ϑ 1−ρm 1−ρm
 P
   o=1 (Tmod (xo /Tod ) )    )     . Due to independence, the scale of the maximum
over m is simply the sum of these scale parameters. Using Lemma A.1 and focus-
ing on the limiting case of ϑ → 1, we have Tod = M
                                                P
                                                  m=1 Tmod and


                                              M     N
                                                                               !1−ρm
                                              X     X                     1
                       d
                     G (x1 , . . . , xN ) =                (ωmod xo )   1−ρm           ,     (12)
                                              m=1    o=1


for ωmod ≡ Tmod /Tod . The relative efficiency of application m for origin o when
delivering to destination d determines the weight of application m within the re-
sulting CNCES correlation function. The implied productivity distribution follows
from (9) in Theorem 1.11

Summing up, Theorem 1 allows us to relate alternative specifications for the cor-
relation function to underlying primitive assumptions on the nature of technolog-
ical adoption. When developing models based on Fréchet-distributed productiv-
ity, one can either use a particular specification for applicability—possibly arising
from a model of innovation—and derive the implied Gd using Theorem 1, or, alter-
natively, directly specify a correlation function satisfying the restrictions in Defini-
tion 2. The key contribution of Theorem 1 is to provide an economic justification
for any choice of the correlation function, and to provide a method for computing
correlation functions implied by models of technology adoption.


2.3    Prices and Trade Shares

We now characterize import price distributions and expenditure shares under the
assumption that productivity is multivariate θ-Fréchet. The marginal cost to de-
liver a particular variety v to destination d from origin o is given by (2). The joint
distribution of potential import prices is shown in the next proposition.
Proposition 1 (Potential Import Price Distribution). If productivity has a multivari-
ate θ-Fréchet distribution, then the joint distribution of prices presented to destination
  11
     In a recent paper, Lashkaripour and Lugovskyy (2017) use a nested Fréchet—with latent fac-
tors representing firm-specific quality—to generalize EK. Their example fits into the productivity
representation in our Theorem 1.

                                                    14
market d is given by a multivariate Weibull distribution satisfying12

       P[P1d (v) ≥ p1 , . . . , PN d (v) ≥ pN ] = exp −Gd T1d W1−θ pθ1 , . . . , TN d WN−θ pθN .
                                                                                             


Proof. See Appendix D.

The joint distribution of productivity determines the joint distribution of potential
import prices. For each origin o, the marginal distribution of prices, P[Pod (v) ≤
p] = 1 − exp −Tod Wo−θ pθ , is a Weibull distribution with scale parameter Tod Wo−θ
                        

and shape parameter θ. The correlation function Gd determines the dependence
structure.
                                                           R                        − σ1
                                                                1          −σ
Define bilateral import price indices as Pod ≡                 0
                                                                    Pod (v)     dv           . Proposition 1 to-
gether with Lemma A.1 implies that

                                                       −1/θ
                                           Pod = γTod         Wo .                                          (13)

with γ > 0 defined in Proposition 2. Nominal import prices are proportional to the
exporter nominal wage, Wo , and decreasing in the bilateral productivity parame-
ter, Tod . We can interpret the scale parameters of the productivity distribution as
bilateral cost shifters, and map them into into standard variables in the trade liter-
                                                                     1/θ
ature: an origin country productivity index, Ao ≡ Too , and an iceberg trade cost index,
τod ≡ (Too /Tod )1/θ . The variable Ao measures a country’s ability to produce goods
in their domestic market, while τod measures efficiency losses associated with de-
livering goods to market d—the standard iceberg-type trade costs. Re-writing (13)
using these indices yields Pod = γτod Wo /Ao .

Given the distribution of potential import prices, a country imports each variety
from the cheapest source. The max-stability property for the productivity distri-
bution, together with the previous characterization of the potential import price
distribution, leads to closed-form results for trade shares and the price index.

Proposition 2 (Generalized EK). Suppose productivity has a multivariate θ-Fréchet
distribution with θ > σ. Then,
  12
      A random vector (B1 , . . . , BK ) is multivariate Weibull if its marginal distributions are Weibull:
                             θ
P[Bk ≤ b] = 1 − e−Sk b k for some scale Sk > 0 and shape θk > 0 across k = 1, . . . , K. Note that if
(A1 , . . . , Ak ) is θ-Fréchet, then the vector (A−1           −1
                                                   1 , . . . , AK ) is multivariate Weibull and its marginals
have common shape θk = θ, for each k = 1, . . . , K.




                                                    15
  1. The share of varieties that destination d imports from o is

                                              Tod Wo−θ God
                                     πod = PN                    ,                                     (14)
                                                         −θ
                                            o0 =1 To0 d Wo Go0 d


     where

                                                                                     ∂Gd (x1 , . . . , xN )
      God ≡ Gdo T1d W1−θ , . . . , TN d WN−θ              Gdo (x1 , . . . , xN ) ≡
                                               
                                                    and                                                     ;
                                                                                           ∂xo
                                                                                                        (15)

  2. The distribution of prices among goods imported into country d from o is identical
     to the distribution of prices in d.

  3. Total expenditure by country d on goods from country o is Xod = πod Xd ; and

  4. The price index in country d is

                                                                        − θ1
                               Pd = γGd T1d W1−θ , . . . , TN d WN−θ            ,                      (16)

                         1
                     θ−σ − σ
     where γ ≡ Γ      θ
                               and Γ(·) is the gamma function.

Proof. See Appendix E.

First, the formula for the expenditure share, πod , takes the same form as choice
probabilities in GEV discrete choice models (McFadden, 1978), with the quantity
Tod Wo−θ taking the place of choice-specific utility, as we explain in Section 3. Note
that this quantity is monotonically related to the import price index in (13).

Second, using (14) and (16), correlation-adjusted expenditure shares—defined as
 ∗
πod ≡ πod /God —are CES,
                                                    −θ
                                     ∗            Wo
                                    πod   = Tod γ        .                                             (17)
                                                  Pd
Hence, they constitute a gravity system as defined by ACR. In fact, together (13)
and (17) imply that correlation-adjusted expenditure shares are sufficient statis-
                              ∗
tics for real import prices: πod = (Pod /Pd )−θ . This interpretation will be particu-
larly useful when we examine counterfactual analysis and compute correlation-
adjusted expenditure shares in Section 4.2.

Third, as in EK, the distribution of prices among goods actually imported into mar-
ket d is identical to the overall distribution of prices in d. As a result, expenditure


                                                   16
shares are equal to the share of varieties imported into d from o. This result follows
from the property that the conditional distribution of the maximum of a multivari-
ate Fréchet random vector is identical to its unconditional distribution, as shown
in Lemma A.3.

Finally, the price level in each destination market is determined by the correlation
function, Gd . In fact, due to (13) and (16), the price level is determined by aggregat-
                                                                   −θ                                 1
ing import price indices using the correlation function: Pd = Gd (P1d , . . . , PN−θd )− θ .
In analogy to the discrete choice literature, welfare calculations depend crucially
on the specification of this function.



3         GEV Factor Demand Systems

What macro substitution patterns does this theory generate? To answer this ques-
tion, we first establish, in Corollary 1, that the Ricardian model with multivari-
ate θ-Fréchet productivity implies expenditure shares that match choice proba-
bilities in GEV discrete choice models (McFadden, 1978). We then establish in
Proposition 3 that the demand systems generated by the Ricardian model with θ-
Fréchet-distributed productivity can approximate any demand system generated
by stochastic productivity. That is, our framework allows us to approximate any
factor demand systems consistent with Ricardian trade, under the assumptions of
constant returns to scale in production, competitive markets, and a single factor of
production in each country.13

First, we define a factor demand system for destination d as a collection of expendi-
ture share functions {πod }N
                           o=1 such that for each o = 1, . . . , N the function πod :
RN
 + × R+ → [0, 1] is homogenous of degree zero and for any vector of wages
                                                             PN
W ≡ (W1 , . . . , WN ) ∈ RN
                          + and level of expenditure Xd ≥ 0,  o=1 πod (W, Xd ) = 1.
Next, we define the class of GEV factor demand systems.

Definition 3 (GEV Factor Demand System). A generalized extreme value (GEV) fac-
                                                                 GEV N
tor demand system for destination d is a factor demand system, {πod }o=1 , such that there
exists a shape parameter θ > σ, scale parameters {Tod }N
                                                       o=1 , and a correlation function G
                                                                                         d

satisfying
                     GEV                   Tod Wo−θ Gdo (T1d W1−θ , . . . , TN d WN−θ )
                    πod  (W, Xd ) = P                   −θ d          −θ                   −θ
                                                                                                ,   (18)
                                           o 0 T o 0 d W 0 G 0 (T1d W
                                                        o   o        1   , . . . , T N d WN   )
    13
         As mentioned in Footnote 2, CES preferences are not crucial for our results.


                                                      17
for all o = 1, . . . , N .

The GEV class is homothetic since expenditure shares do not depend on overall
expenditure. It is closely related, as mentioned above, to the functional form for
choice probabilities in GEV discrete choice models. It differs slightly, however,
because the correlation function is a restricted version of the social surplus function
in GEV models due to our normalization restriction in Definition 2.

An important class of models within the GEV class are CES factor demand sys-
tems, as in ACR. These models are generated by an additive correlation function,
implying expenditure shares of the form

                                    CES                        Tod Wo−θ
                                   πod  (W, Xd )       = PN                        .                     (19)
                                                              o0 =1   To0 d Wo−θ
                                                                              0



The CES specification leads to a gravity system and includes most of the workhorse
models of trade, such as Armington, Melitz, and EK (Arkolakis et al., 2012).

The GEV class, however, is much larger than the CES class. For example, consider
the cross-nested CES correlation function derived in (12),

                                                 M     N
                                                                                        !1−ρm
                                                 X     X
                       Gd (x1 , . . . , xN ) =               (ωmod xo )1/(1−ρm )                     .   (20)
                                                 m=1   o=1


The factor demand system implied by this correlation function is

                                                 M       − 1−ρ         θ
                                                                                        −θ
                        CNCES
                                                 X   Pmod       m                      Pmd
                       πod    (W, Xd )      =                                PM                      ,   (21)
                                                 m=1
                                                        Pmd                        m0 =1   Pm−θ0 d

               −1/θ                      −θ/(1−ρm ) −(1−ρm )/θ
where Pmod ≡ γTmod Wo , and Pmd ≡ ( N
                                   P
                                    o=1 Pmod       )           . The first fraction
on the right-hand side of (21) represents the probability of importing from country
o given that it chose application m. Due to the correlation in applicability across
countries, for a given m, this conditional probability has an elasticity of substitu-
tion of θ/(1 − ρm ) over the price index of origin o, relative to the destination market
price index, Pmd , for goods produced with application m. The second fraction on
the right-hand side of (21) represents the probability of importing m-goods into
d. Due to independence in applicability across m’s, the elasticity of substitution
between them is simply θ.

It is clear from comparing (19) with (21) that the GEV class generates a richer pat-

                                                       18
tern of substitution across exporters than CES. In general, if we compare the elas-
ticity of demand in the GEV and CES models, around any observed expenditure
shares, the difference comes from the correlation function,

                                        GEV         CES
                                  ∂ ln πod    ∂ ln πod    ∂ ln God
                                            =           +          ,                         (22)
                                  ∂ ln Wo0    ∂ ln Wo0    ∂ ln Wo0
             CES
       ∂ ln πod                              ∂ ln Pd
with   ∂ ln Wo0
                   = −θ (1 − πo0 d ) since   ∂ ln Wo
                                                       = πod .

Our next result states that the GEV factor demand system in (18) matches the ex-
penditure shares of the Ricardian model with multivariate θ-Fréchet productivity
in Proposition 2.

Corollary 1 (GEV Equivalence). A trade model generates a GEV factor demand system
if and only if the Ricardian model generates the same factor demand system for some max-
stable multivariate Fréchet distribution for productivity.

A direct implication of Corollary 1 is that the Ricardian model generates factor
demand systems matching many (non-CES) trade models. In particular, many ex-
isting models are in the GEV sub-class of cross-nested CES factor demand systems,
as we show in Section 6.14

We can push the result in Corollary 1 one step further by adapting results from
the discrete choice literature: GEV random utility models are dense in the space
of all random utility models (Dagsvik, 1995). This result for choice probabilities
does not directly apply to our model since we have CES demand at the variety
level. However, an analogous result holds: The set of factor demand systems
generated by any Ricardian model—without restricting to θ-Fréchet productivity
distributions—can be approximated arbitrarily well by the class of GEV factor de-
mand systems.

Proposition 3 (GEV Approximation). Let {Aod (v)}N
                                                o=1 have any multivariate distri-
bution whose marginals have finite moment of order σ. Denote the factor demand system
implied by the Ricardian model when productivity is distributed the same as {Aod (v)}N
                                                                                     o=1
                                         N +1
by {πod }N
         o=1 . Then for any compact K ⊂ R+    and any  > 0, there exists a GEV factor
                 GEV N
demand system, {πod }o=1 , such that

                                               GEV
                      sup      πod (W, Xd ) − πod  (W, Xd ) <  ∀o = 1, . . . , N.
                   (W,Xd )∈K
  14
      It is worth noting that this subclass can approximate any GEV factor demand system (Fosgerau
et al., 2013) and, by extension, any GEV Ricardian model.

                                                       19
Proof. The proof constructs an approximating GEV factor demand system that con-
verges uniformly to the true demand system. See Appendix F.

The key implication of Proposition 3 is that any factor demand system generated
by the Ricardian trade model can be approximated by a Ricardian trade model
where productivity has a multivariate θ-Fréchet distribution. Put simply, through
this approximation result, our framework encompasses the full macroeconomic
implications of Ricardian trade theory.



4    Macro Counterfactuals

We next show that heterogeneity in correlation leads to heterogeneity in the gains
from trade and that this heterogeneity affects the calculation of any (counterfac-
tual) departure from the current equilibrium. It turns out that calculations using
a GEV demand system are virtually identical, after a correction for correlation, to
the calculations in ACR for trade models with CES factor demand systems. More-
over, the correlation correction only requires data on expenditure shares across
countries, preserving the simplicity of the ACR calculation of the gains from trade.

From (14), the self-trade share is

                                      Tdd Wd−θ Gdd
                              πdd = PN              .                           (23)
                                               −θ
                                     o=1 Tod Wo God


Using the expression for the price index in (16), we can write the real wage in
country d as
                                Wd          1
                                                 ∗ −θ
                                                      1
                                   = γ −1 Tddθ (πdd ) ,                         (24)
                                Pd
       ∗
where πdd ≡ πdd /Gdd is the correlation-adjusted self-trade share.

Let x̂ ≡ x0 /x denote the change from x to x0 in an equilibrium outcome due to some
change in the model’s parameters. Using (24), it is straightforward to show that
the change in real wages between two equilibria is given by

                              Ŵd        Wd0 /Pd0      ∗ −θ
                                                            1
                                     ≡            = (π̂dd ) .                   (25)
                              P̂d        Wd /Pd

That is, in any trade model that implies a GEV factor demand system, a (log)
change in equilibrium real wages—triggered by some shock to the model’s parameters—

                                             20
is proportional to the (log) change in the correlation-adjusted self-trade share, with
the factor of proportionally given by the parameter, θ.15


4.1    Gains From Trade: Autarky

What are the consequences of correlation in technology for the gains from trade
relative to autarky? Intuitively, if two countries have identical idiosyncratic pro-
ductivity draws across varieties (i.e., the case of perfect correlation), with their
average productivity determining labor costs, they will offer each other identical
prices across varieties, and there would be no scope for trade between them. Our
correlation structure is able to capture this possibility.

In autarky, country d purchases only its own goods so that πdd = 1. Moreover, as
τod → ∞, Tod ≡ (Ao /τod )θ → 0 for o 6= d. As a result, Gdd = 1 (i.e., correlation with
other countries is irrelevant in autarky). Real wages in autarky are simply
                                           Autarky
                                       Wd                         1
                                                       = γ −1 Tddθ .                       (26)
                                       Pd

Dividing (24) by (26), the gains from trade relative to autarky are

                                                                       − θ1
                                        Wd /Pd                    πdd
                           GTd ≡                          =                     .          (27)
                                   (Wd /Pd )Autarky               Gdd

This expression generalizes the results of ACR to the class of models with GEV
demand systems. With a CES factor demand system, Gdd = 1 and the gains from
trade in (27) simplify to the ones in ACR where two countries with the same self-
trade share have the same gains from trade relative to autarky.

The expression for gains in (27) admits the possibility that if two countries have
the same self trade share, but one country has very similar technology to all other
countries—i.e., high correlation—their gains from trade will be smaller. In con-
trast, if that country has dissimilar technology to other countries—i.e., low correlation—
their gains from trade will be larger. Our general framework captures Ricardo’s
insight on the heterogeneity of gains from trade across countries.
  15
     In Online Appendix O.1, we define equilibrium formally and show how to apply exact hat-
algebra methods to solve for a change from the current (observed) equilibrium to any counterfac-
tual equilibrium.



                                                 21
Concretely, consider a three-country world with a correlation function given by
                                                             1−ρ
                                           1/(1−ρ)    1/(1−ρ)
                     Gd (x1 , x2 , x3 ) = x1       + x2            + x3 ,

which implies that the joint distribution of productivity across countries is
                                                                                 1−ρ           
                                                                 1              1
                                                             −θ 1−ρ         −θ 1−ρ             −θ
P[A1d (v) ≤ a1 , A2d (v) ≤ a2 , A3d (v) ≤ a3 ] = exp − (T1d a1 )    + (T2d a2 )         + T3d a3 .


Countries 1 and 2 are technological peers, with the parameter ρ measuring the
degree of correlation in their technology. Country 3’s productivity is uncorrelated
with productivity in countries 1 and 2. Then,

                                                 −ρ
God = (T1d W1−θ )1/(1−ρ) + (T2d W2−θ )1/(1−ρ)          (Tod Wo−θ )ρ/(1−ρ)   for   o = 1, 2 and   G3d = 1.

Given that πod = Tod Wo−θ God /Gd (T1d W1−θ , T2d W2−θ , T3d W3−θ ), we can take the ratio
G1d /G2d = (π1d /π2d )ρ , which implies that
                                                ρ
                                        πod
                         God =                          for o = 1, 2.
                                     π1d + π2d

As a result, the gains from trade are

                                  − 1                                              −1
                     (π1d + π2d )ρ θ
                1−ρ
          GTd = πdd                          for        d = 1, 2 and        GT3 = π33θ .

The gains from trade for countries 1 and 2 depend on the degree of correlation
in technology, while the gains from trade for country 3 are pinned down by the
country’s self-trade share. The corrected self-trade shares for country 1 and 2 end
up being a Cobb-Douglas combination—with weight given by ρ—between each
country’s expenditure share on its own goods and on the aggregation of its own
goods with its peer’s goods—the latter can be interpreted as the self-trade share
if countries 1 and 2 were combined into a single country. When correlation in
technology is zero (ρ = 0), a correlation correction is unnecessary; for positive
correlation, the correction increases effective self trade and implies lower gains
from trade; and for perfect correlation (ρ = 1), the two countries are effectively a
single country and the gains from trade depend on their combined self trade.




                                             22
4.2    Calculating the Correlation Correction

To make the necessary adjustment for correlated technology, we need to know
the correlation structure across countries, which requires estimates of Gd . Given
the correlation function, we can then calculate the gains from trade directly from
expenditure data, generalizing the sufficient-statistic approach in ACR.

Because the demand system is CES after the correlation correction, correlation-
adjusted shares are sufficient statistics for underlying bilateral import prices. The
procedure to compute correlation-adjusted expenditure shares amounts to invert-
ing the demand system, (14).

First, we use (13), (16), and the fact that Gdo is homogenous of degree zero, to re-
write (14) as                                       "
                                       −θ                    −θ                     −θ #
                                  Pod                    P1d                     PN d
                      πod =                   Gdo                    ,...,                      .
                                  Pd                     Pd                       Pd

This equation expresses the demand system in terms of real import prices, rather
than bilateral productivity shifters, wages, and price levels.

In fact, due to (13) and (17), the quantities on the right-hand side are exactly equal
to correlation-adjusted expenditure shares.

                              ∗        ∗             ∗
                       πod = πod Gdo (π1d , . . . , πN d)        for     o = 1, . . . , N.          (28)

Because correlation-adjusted expenditure shares are sufficient statistics for real im-
port prices, the correlation correction amounts to inverting the demand system.
That is, given expenditure share data and the correlation function of a single desti-
nation, we have N equations in the N unknown correlation-adjusted expenditure
shares across origins.16 As a result, we only need expenditure share data to calcu-
late the gains from trade.
  16
     Note that the correlation adjustment is well defined. The mapping from RN             N
                                                                                     + to R+ , defined by
the right-hand side of the system in (28), satisfies strict gross substitutability and is homogenous
of degree one. As a result, it is injective (see, for instance, Berry et al., 2013) and there is a unique
               ∗ N
solution for {πod }o=1 , given {πod }N
                                     o=1 .




                                                         23
5    Aggregation

This section provides an aggregation result that links the aggregate trade model
we have studied so far to trade models with more disaggregated structures—such
as sectors and global value chains.

This aggregation result is important because it allows us to link the macro results
of Adao et al. (2017) and estimates, common in the trade literature, based on mi-
cro data. In their paper, they show how to estimate non-parametrically invertible
demand systems using only aggregate trade data. In practice, however, as they
recognize, they need to proceed parametrically (e.g., mixed CES) and they esti-
mate an invertible factor demand system without taking a stance on any partic-
ular microfoundation. By being less general and restricting to the GEV class of
factor demand systems—a sub-class of invertible demand systems with the gross
substitute property—our aggregation result enables us to identify macro substi-
tution patterns using disaggregate data (e.g., sectoral data). We provide concrete
applications in the next section.

Our aggregation result follows directly from Definition 1: Max-linear combina-
tions of multivariate θ-Fréchet random vectors are multivariate θ-Fréchet. This
property implies that we can aggregate models built on optimizing behavior and
Fréchet productivity to get equivalent macro models where productivity is also
Fréchet. Put differently, one can always think of macro-level scale parameters and
macro-level correlation functions as the result of the underlying micro structure.
The following proposition formalizes this result.

Proposition 4 (Aggregation of the Productivity Process). Consider a model with Mo
micro factors within each origin country o = 1, . . . , N . Let productivity {{Amod (v)}M    N
                                                                                        m=1 }o=1
                                                                                         o


be distributed multivariate θ-Fréchet with θ > σ. Denote the associated scale parameters
                                                     M1           MN
by {{Tmod }M    N                                d
           m=1 }o=1 and correlation function by F : R+ × · · · × R+
             o
                                                                     → R+ .

Then, aggregate productivity Aod (v) = maxm=1,...,Mo Amod (v) is also distributed multi-
variate θ-Fréchet. The aggregate scale parameters are, for each o = 1, . . . , N , given by

                 Tod = F d (01 , . . . , 0o−1 , Tod , 0o+1 , . . . , 0N ) ≡ F od (Tod ),      (29)

where 0o is the zero vector of length Mo , and Tod ≡ (T1od , . . . , TMo od ). The aggregate



                                                  24
correlation function is given by

                             Gd (x1 , . . . , xN ) = F d (Ω1d x1 , . . . , ΩN d xN ),                          (30)

where, for each o = 1, . . . , N , Ωod ≡ (ω1od , . . . , ωMo od ) is a vector of aggregation weights
with elements ωmod ≡ Tmod /Tod for m = 1, . . . , Mo .

Proof. This result follows from the max-stability property. See Appendix G.

Proposition 4 states that we can relate a given macro model with multivariate θ-
Fréchet productivity to an underlying disaggregate model in which productivity
also has a multivariate θ-Fréchet distribution. The link between the micro and
macro levels comes from maximizing productivity across m’s within an origin
country.

This aggregation result also produces aggregate expenditure shares belonging to
the GEV class.

Corollary 2 (Aggregation of Expenditure Shares). Suppose that the hypotheses and
notation of Proposition 4 hold. Micro expenditure shares are

         Tmod Wo−θ Fmo T1d W1−θ , . . . , TN d WN−θ
                    d
                                                            
πmod   =                                                         for m = 1, . . . , Mo        and        o = 1, . . . , N,
              F d T1d W1−θ , . . . , TN d WN−θ
                                               


                                           d                                ∂
where Tod ≡ (T1od , . . . , TMo od ), and Fmo (X1 , . . . , XN ) ≡        ∂xmo
                                                                               F d (X1 , . . . , XN ).

Then, aggregate expenditure shares are

                Mo
                X              Tod Wo−θ Gdo (T1d W1−θ , . . . , TN d WN−θ )
        πod ≡         πmod   =                                                   for o = 1, . . . , N,
                m=1
                                   Gd (T1d W1−θ , . . . , TN d WN−θ )

where Tod and Gd are given, respectively, by (29) and (30) in Proposition 4.

This result allows us to pass seamlessly between the micro and macro levels. Its
natural consequence is that we can use disaggregate data (e.g., sectoral data) to
estimate the micro correlation function and infer micro scale parameters. We can
then apply Proposition 4 to derive the macro correlation function and macro scale
parameters, and perform macro counterfactual analysis using the results in Sec-
tion 4. This aggregation result enables us to connect (Ricardian) micro foundations
to macro substitution patterns—as our applications in the next section show.

                                                       25
Aggregation weights are key for the aggregation procedure. Because correlation-
adjusted expenditure is proportional to the scale parameters of both the micro
and macro models, these weights can be recovered by first computing correlation-
adjusted expenditure from disaggregate expenditure shares.

The logic for computing correlation-adjusted trade shares at the micro level follows
the derivations in Section 4.2. Gravity holds after correcting for correlation at the
micro level,                                                −θ
                              ∗          πmod            Wo
                             πmod   ≡          = Tmod γ          ,                     (31)
                                         Fmod             Pd
                      T1d W1−θ , . . . , TN d WN−θ . We can then recover micro correlation-
              d
                                                  
where Fmod ≡ Fmo
                                          ∗
adjusted expenditure by inverting πmod = πmod  d
                                              Fmo (Π∗1d , . . . , Π∗N d ) where Π∗od ≡
  ∗              ∗
(π1od , . . . , πM o od
                        ). Because correlation-adjusted shares are sufficient statistics for la-
tent prices, this step amounts to inverting the demand system.

From these quantities, we can then compute correlation-adjusted expenditure in
the implied macro model. Using (17), (29), the homogeneity of F od , and (31) we
get
                                                                 ∗
                           ∗                                   πmod
                          πod = F od (Π∗od ),   and   ωmod =      ∗
                                                                    .                      (32)
                                                                πod
Aggregation weights equal the ratio of micro and macro correlation-adjusted ex-
penditure shares. In addition to being sufficient statistics for real import prices,
these quantities are sufficient statistics for the aggregation weights.



6        Applications

We now present applications in the literature that extend the Ricardian model of
trade in EK to multiple sectors (Caliendo and Parro, 2015), multinational produc-
tion (Ramondo and Rodríguez-Clare, 2013), domestic geography (Ramondo et al.,
2016), global value chains (Antràs and de Gortari, 2017), and intermediate inputs
(Eaton and Kortum, 2002; Alvarez and Lucas, 2007). All of these models deliver
a GEV factor demand system and illustrate the aggregation result of the previous
section. These applications, by belonging to the GEV class, fall into the class of
factor demand systems with the gross substitutes property; as such, complemen-
tarities are precluded.17
    17
   A notable exception—with strong complementarities—is Fally and Sayre (2018). They build a
model of trade in scarce and spatially concentrated commodities which implies an import demand


                                                26
6.1    Multiple Sectors

Assume that each country is composed of multiple sectors, s = 1, . . . , S. Caliendo
and Parro (2015) assume that consumers in destination d have Cobb-Douglas pref-
erences with sectoral shares µsd , and that productivity within each sector across
origins is distributed independent Fréchet with shape θs and scale A
                                                                   eso . Given trade
costs τsod , the share of d’s total expenditure on goods in sector s from origin o is
                                                      −θs
                                            τsod AWsoo
                               πsod   =P                  −θs µsd ,                     (33)
                                        N              Wo0
                                        o0 =1 τso0 d A 0   so



            e1/θ
where Aso ≡ A so . Due to the Cobb-Douglas assumption, sectoral expenditure

shares are exogenous.

By assuming that productivity is correlated within each sector, we can generate a
similar demand system, but with endogenous sectoral shares. Suppose that pro-
ductivity Asod (v) for good v in sector s is a random vector drawn from a multivari-
ate θ-Fréchet distribution with scale parameter Tsod and cross-nested CES (CNCES)
correlation function,

                                                  S N
                                                                            !1−ρs
                                                  X X
                        F (X1 , . . . , XN ) =                  x1/(1−ρ
                                                                 so
                                                                       s)
                                                                                    ,     (34)
                                                   s=1   o=1


with Xo ≡ (x1o , . . . , xSo ). The parameter ρs measures the degree of correlation
across origin countries in each sector s.

Expenditure shares at the sector level constitute a gravity system given by
                                                 −θ/(1−ρs )          −θ
                                           Psod                   Psd
                             πsod =                                           ,
                                           Psd                    Pd

                1/θ                    −θ/(1−ρs ) − 1−ρs
where Psod ≡ γTsod Wo , Psd ≡ ( N
                               P
                                  o=1 Psod       ) θ , and Pd is the aggregate price
                          P −θ −1/θ
index in country d, Pd =    s Psd      .

This demand system matches (33) for θ/(1 − ρs ) = θs , Psod /γ = τsod Wo /Aso , and
µsd = (Psd /Pd )−θ . Sectoral shares now depend on real sectoral prices with elasticity
of substitution θ. As the parameter θ goes to zero, this sectoral CNCES model
system with very low elasticities of substitution. They estimate gains from trade that are much
larger than ACR.


                                                    27
converges to match the Cobb-Douglas case in Caliendo and Parro (2015).18,19

We can get an equivalent macro model by applying Proposition 4. Aggregate pro-
ductivity Aod (v) is distributed multivariate θ-Fréchet with scale parameters given
by Tod = Ss=1 Tsod and the following CNCES correlation function, as derived in
          P

(12),
                                               S N
                                                                                       !1−ρs
                                               X X
                     Gd (x1 , · · · , xN ) =                  (ωsod xo )1/(1−ρs )              ,                     (35)
                                               s=1      o=1

with ωsod = Tsod /Tod .20 The inner sum indicates that latent sectors induce corre-
lation across origins. The parameter ωsod measures the extent to which sector s
matters for trade flows from o to d—i.e., it reflects sectoral trade costs and compar-
ative advantage.

In turn, aggregate expenditure shares constitute a GEV factor demand system, as
in (21),
                                                                   hP                                     1 i1−ρs
                                                                                  ωso0 d To0 d Wo−θ
                                                       1
                                                                                                       1−ρ
                                                                                                           s
                                   ωsod Tod Wo−θ
                                                    1−ρ
           X            X                                s              o0                       0
  πod ≡        πsod =                                       1                                             1−ρ1 i1−ρs0 .
                                                                P hP
                                    ωso0 d To0 d Wo−θ
                            P                            1−ρ
           s            s     o0                   0
                                                              s
                                                                  s0         o0    ωs0 o0 d To0 d Wo−θ
                                                                                                    0          s0


                                                                                                                     (36)
The aggregate model with a CNCES correlation function has the same aggregate
implications as the multi-sector model with correlation across origin countries
within each sector.


6.2     Multinational Production

Assume that productivity depends on the home country j of a firm. The micro cor-
relation function is CNCES as in (34), and the implied macro correlation function
is as in (35) with s replaced by j for both functions. The parameter ρj measures
correlation across production locations for firms with home country j.
  18
      The Cobb-Douglas restriction, however, entails that key cross-price elasticities characterizing
the macro demand system are not identified from between-sector variation, as pointed out by Adao
et al. (2017). With CNCES, both θ and ρs can be identified from between- and within-sector varia-
tion, respectively.
   19
      French (2016) uses CES expenditure shares across sectors, but he restricts the elasticities of
substitution for each sector to be the same, ρs = ρ.
   20
      As the number of underlying micro factors—the M dimension in (12) and the S dimension
here—gets large, the CNCES specification can arbitrarily approximate the mixed-CES factor de-
mand system used in Adao et al. (2017). In this way, their empirical application can be interpreted
as arising from some latent disaggregate Ricardian model.



                                                        28
The expenditure share on goods produced in o for d by firms from j is
                                                  −θ/(1−ρj )       −θ
                                            Pjod                  Pjd
                               πjod =                           γ         ,
                                            Pjd                   Pd

              −1/θ                       −θ/(1−ρj ) − 1−ρj
where Pjod ≡ Tjod Wo , and Pjd ≡ ( N
                                  P
                                       P
                                    o=1 jod        ) θ . The expenditure share
on goods produced in o for d follows (36) with j replacing s.

This factor demand system matches the one in Ramondo and Rodríguez-Clare
                                1/θ
(2013) for ρj = ρ and Tjod = hjo Aj . That is, if we assume that the distribution
of productivity Aod (v) has a correlation function given by (35) with j replacing s,
our Ricardian trade model matches, at the bilateral level, a Ricardian trade model
with multinational production.


6.3   Multiple Regions

Assume that each country o is composed of multiple regions, given by the set Ro .
Denote productivity in region r by Arod (v). Productivity across regions and coun-
tries is multivariate θ-Fréchet with scale parameter Trod and correlation function
                                                                               !1−ρo
                                                    X      X
                        F d (X1 , . . . , XN ) =                  x1/(1−ρ
                                                                   ro
                                                                          o)
                                                                                         ,                       (37)
                                                      o    r∈Ro


with Xo ≡ (x1o , . . . , xRo o ). The expression in (37) indicates that productivity draws
are independent across countries and correlated within a country, across regions,
with the degree of correlation given by the parameter ρo .

Workers are mobile across regions within a country and the country wage is Wo .
                                             −1/θ
For import price index Prod = γTrod Wo , the trade share from region r ∈ Ro into
country d is

                                  θ
                             − 1−ρ                                                               !− 1−ρ o
                                        −θ                                                            θ
                      Prod        o    Pod                                X           − θ
         πrod =                       P     −θ
                                                     with Pod =                      Pr0 od1−ρo              .   (38)
                      Pod              o0 P o0 d                         r0 ∈R   o



The first fraction on the right-hand side of (38) is the probability of importing from
region r in country o conditional on importing from some region in country o,
while the second fraction is the probability of importing from country o into d.
                                                                  P                 1−ρo
                                                                           1/(1−ρo )
Aggregate productivity is multivariate θ-Fréchet with scale Tod =    r∈Ro Trod             ,

                                                      29
and with an additive correlation function. As a result, the factor demand system is
CES,
                                     X            Tod Wo−θ
                             πod =        πrod = P             −θ
                                                                   .
                                                  o 0 To 0 d W o 0
                                     r∈Ro

By assuming that ρo = 0, for all o = 1, . . . , N , this case matches the one in Ramondo
et al. (2016) .


6.4    Global Value Chains

We now show that the model of global value chains in Antràs and de Gortari (2017)
is equivalent to a model without global value chains, but in which productivity fol-
lows a multivariate Fréchet distribution with an appropriately chosen correlation
function.

Assume that production is carried out in K stages, k = 1, . . . , K, where k = K is the
final stage of production (e.g., assembly), takes the Cobb-Douglas form, and labor
is the only factor of production. Let ` = [`(1), . . . , `(K)] index a path of locations
across production stages.

The unit cost of the input bundle used for goods produced following the produc-
tion path ` is given by

                                               k−1
                                               Y            α` (k)
                                                     W`(k)
                            c` (W) = W`(K)                             ,
                                               k=1
                                                     W`(K)

                  PK−1
with αk > 0 and     k=1   αk < 1. The unit cost of good v is c` (W)/A`d (v). The variable
A`d (v) denotes the marginal product of the input bundle when good v is produced
along ` and delivered to d. This variable is distributed θ-Fréchet i.i.d. across ` with
scale T`d . The likelihood of a particular production path ` destined to country d is
given by
                                            T`d c` (W)−θ
                                 π`d = P                    −θ
                                                               .                       (39)
                                            `0 T`0 d c`0 (W)

This factor   demand share matches the one in Antràs and de Gortari (2017) for T`d =
         1− K−1
            P
                 α Q
τ`(K),d T`(K) k=1 k K−1
 −θ
                     k=1 (τ`(k),`(k+1) )
                                        −θαk αk
                                            T`(k) where τij is an iceberg cost of transport-
ing goods from country i to country j, and Ti is a productivity index for country
i. Aggregate trade shares from country o to d are obtained by summing π`d over
production paths with `(K) = o—i.e., with last production stage in country o.


                                               30
A macro model where productivity is multivariate θ-Fréchet with scale T`d and
correlation function given by

                                                            K−1
                                                            Y              α` (k)
                       d
                                             X                      x`(k)
                    G (x1 , · · · , xN ) =          x`(K)                              ,
                                                `           k=1
                                                                    x`(K)

implies a factor demand system equivalent to the the one from the model with
global value chains.


6.5   Intermediate Inputs

Suppose that each variety is used to produce an aggregate intermediate input. In
turn, firms produce varieties using a Cobb-Douglas production function in labor
and this good. Hence, the unit cost of the input bundle in country o is

                                     co (W) = BWoβ Po1−β ,

where 0 < β ≤ 1 is the share of labor in production, B is a positive constant,
W ≡ [W1 , . . . , WN ], and Po is the price level in o. If productivity is independent
Fréchet with scale Ao and given trade costs of τod , expenditure shares are

                                                  −θ
                                             Ao τod  co (W)−θ
                                πod = P              −θ          −θ
                                                                    .                      (40)
                                             o0 Ao0 τo0 d co0 (W)


The price index in country d is defined implicitly by
                                                                        !−1/θ
                                      X
                                                −θ
                        Pd = γB             Ao τod (Woβ Po1−β )−θ                .
                                        o



It is easy to see that a model without this input-output loop, but with a multivariate
θ-Fréchet distribution of productivity with scale Tod ≡ (Ao /τod )θ/β and correlation
functions for each country implicitly defined by the system

                                                N
                                                X
                           d
                       G (x1 , . . . , xN ) =         xβo Go (x1 , . . . , xN )1−β ,
                                                o=1


generates the same factor demand system as the model with intermediate inputs.



                                                    31
7        Quantitative analysis

This section quantifies the gains from trade when productivity is correlated across
space. Our framework, by allowing for origin-destination specific correlation in
productivity, enables us to introduce bilateral heterogeneity into the estimation
of trade elasticities. These substitution patterns are obtained because we do not
impose iceberg trade costs; rather, we allow for the distribution of productivity to
depend on the destination market where goods get delivered.

We consider a sectoral extension of our model. Based exclusively on supply factors—
i.e., productivity—this sectoral model allows for bilateral heterogeneity in trade
elasticities.21

The choice of the multi-sector Ricardian model of trade not only allows us to assess
the importance of correlation in the calculation of the gains from trade and other
counterfactuals, but it also allows us to highlight the importance of using disag-
gregate data to estimate elasticities that are key for macro counterfactuals. Finally,
we choose this model because it includes two benchmark models used throughout
the existing trade literature as special cases: the CES sectoral model, and the cross-
nested CES (CNCES) sectoral model. These cases arise when bilateral factors do
not influence correlation.


7.1      Specification

Denote each sector by s = 1, . . . , S. We assume that sector-level productivity is
multivariate θ-Fréchet with scale Tsod and correlation function given by

                                                   S
                                                   X
                            d
                          F (X1 , · · · , XN ) =         H sd (xs1 , · · · , xsN ).               (41)
                                                   s=1

    21
     As we show in Online Appendix O.2.1, one can allow for complementarity or substitutabil-
ity across sectors which comes from preferences. In fact, the sectoral model we present be-
low is isomorphic to a model in which preferences across sectors are CES, u(C1d , . . . , CSd ) =
                +1
P          
    S     +1    
        C
    s=1 sd          , with Csd an aggregate of sectoral products, and with the parameter  > −1
the expenditure elasticity of substitution between sectors. Sectoral goods are substitutes as long as
 > 0 so that  takes exactly the role of θ below. Sectoral goods are complements if  < 0, a possibil-
ity only allowed if the model has a preferences interpretation. Our estimates suggest substitution,
not complementarity, across sectors—that is, our estimates of the parameter θ are positive.




                                                   32
In turn, the function H sd is a correlation function capturing correlation within sec-
tor s and destination market d, across origin countries. Following Hanoch (1975)
and Sato (1977), this function is defined implicitly by

                                     N                                        1−ρ1
                                     X            xso                                  sod
                            1=               sd
                                                                                             .          (42)
                                     o=1
                                            H (xs1 , . . . , xsN )

The parameter ρsod measures correlation across origins within sector s and desti-
nation d. The resulting sectoral expenditure shares are iso-elastic,
                                                                 −σsod
                                                           Psod
                                                σsod       Psd
                             πsod = P                                     −σso0 d µsd ,               (43)
                                      N                           Pso0 d
                                             o0 =1   σso0 d        Psd


                 θ
where σsod ≡   1−ρsod
                        is the expenditure elasticity of substitution induced by bilateral
correlation, µsd is the share of expenditure by country d on sector s goods, µsd =
(Psd /Pd )−θ , and the sectoral price index Psd is defined implicitly as

                                               X  Psod −σsod
                                       1=                                        ,                      (44)
                                                 o
                                                           Psd

                 −1/θ
with Psod ≡ γTsod Wo . When ρsod = 0, so that productivity is independent across
sectors and origins, we get the CES sectoral model since σsod = θ. In this case,
there is a single trade elasticity common to all trade flows. When ρsod = ρs , for all
o, d, we get the sectoral CNCES model without bilateral spatial correlation (as in
Section 6).

Next, we compute correlation-adjusted sectoral expenditure shares and the gains
from trade in closed form. As we explain in Section 5, because correlation-adjusted
shares are sufficient statistics for real sectoral import prices, we can calculate the
correlation correction by inverting the demand system. We first solve for within-
sector relative prices. Dividing (43) by σsod , summing over origins, and using (44)
gives (Psod /Psd )−σsod . Correlation-adjusted expenditure is related to to real sectoral
import prices, so we can use sectoral shares, µsd , to get
                                                                  !θ/σsod
                         ∗                 πsod /σsod
                        πsod =       PN                                          ×       µsd        .   (45)
                                       o0 =1   πso0 d /σso0 d                           |{z}
                                 |                 {z                        }       (Psd /Pd )−θ
                                             (Psod /Psd )−θ




                                                        33
Applying our aggregation result, we can use (27) and (32) to compute the gains
                                                                                ∗
from trade. Due to independence across sectors, the function F od is additive, πod =
P ∗
   s πsod , and
                                              !−1/θ
                                    X
                                          ∗
                            GTd =        πsod       .                           (46)
                                                   s

Using sectoral expenditure data, we can compute the gains from autarky once we
have estimates of σsod and θ.


7.2      Estimation

We estimate this multi-sector model using two sequential gravity regressions. The
first step regression uses variation in trade flows and tariffs across origin countries
within each sector to identify geographic correlation in productivity. The second
step regression uses variation across sectors and destination markets to identify θ.

Letting t index years, we impose additional assumptions on the structure of trade
costs and spatial correlation patterns.

First, trade costs depend on gravity covariates, Geood , and on tariffs, tsodt ,

                         ln τsodt = δs0 Geood + ln(1 + tsodt ) + ε1sdt + ε2sodt .

We include in Geood variables such as distance and time differences between trad-
ing partners, and dummies indicating whether the two countries share a border,
language, and legal origins. We further allow for sector specific coefficients, δs .
The variable ε1sdt captures unobserved sector-destination-year components of trade
costs, while ε2sodt captures additional unobserved components of trade costs across
origin countries.

Second, we assume that the sectoral elasticity is additively separable into a sector
effect and a spatial effect which we proxy by a non-linear function of geographic
distance between country pairs,

                                 σsod = σ̄s + σ̃1 Distod + σ̃2 Dist2od .                           (47)

This assumption is motivated by literature that documents how technology diffu-
sion follows a spatial pattern.22
  22
       Keller (2002) estimates that a 1,200-kilometer increase in distance leads to a 50 percent drop in


                                                   34
Using (43), we get our first-step within-sector gravity equation,

ln πsodt = Ssot + Dsdt + Bsod − σ̄s ln(1 + tsodt ) + (αsot + βsdt − ln(1 + tsodt )) (σ̃1 Distod + σ̃2 Dist2od ) + usodt ,
                                                                                                                   (48)

where Ssot ≡ σ̄s αsot , Dsdt ≡ σ̄s βsdt − σ̄s ε1sdt − ln                         σso0 d (Pso0 dt /Psdt )−σso0 d , Bsod ≡
                                                                      P
                                                                            o0
ln σsod − σsod δs0 Geood , αsot ≡ ln Wot /Asot , βsdt ≡ ln Psdt /γ, and usodt = −σsod ε2sodt .
The coefficients from the interaction of distance and distance squared with tariffs
allow us to estimate distance-dependent elasticities of substitution across origin-
destination pairs. Identification follows from including sector-origin-time, sector-
destination-time, and sector-origin-destination effects, as well as both sector-origin-
time and sector-destination-time specific coefficients for bilateral distance. The ex-
clusion restriction for identification is that variation in tariffs across origin coun-
tries is exogenous conditional on these covariates.

To estimate the between-sector elasticity, we use a second step regression that relies
on variation across sectors and a control for inferred within-sector relative prices
from the first step regression. This second step regression comes from the condi-
tion for destination d’s expenditure on sector-s goods, µsd = (Psd /Pd )−θ . First, note
that
                   Psd      Psd       Psod        Psod      Wo
              ln       = ln      + ln      = − ln      + ln     − ln Pd + ln τsod .
                   Pd       Psod       Pd         Psd       Aso
To construct an estimating equation from this result, we need estimates of Psod /Psd
from the first step regression. Specifically, given estimates of σsod , we can combine
(48) with the definition of the sectoral price index in (44) to calculate

                                                                            !− σ̂ 1
                                                                                   sod
                                 Pdsodt            πsodt /σ̂sod
                                        =     PN                                         ,
                                  Psdt           o0 =1   πso0 dt /σ̂so0 d

where σ̂sod is our estimate for σsod from the first step.

We estimate the parameter θ from the coefficient on ln(1 + tsodt ) in the following
second step regression:

                                      \
       ln µsdt = asot + bdt + θ ln (Psodt /Psdt ) − θδs0 Geood − θ ln(1 + tsodt ) + vsodt ,                       (49)
technology diffusion. Similarly, Bottazzi and Peri (2003) find a strong geographic decay in technol-
ogy diffusion between European regions. Comin et al. (2013) document that the lower the spatial
distance to another country’s technology, the higher the rate of adoption. Relatedly, Keller and
Yeaple (2013) link the gravity patterns observed in flows of firms across countries (Foreign Direct
Investment) to multinational firms transferring knowledge from their parent firm to their affiliates
abroad—with this transfer being easier to nearby locations.


                                                         35
where asot ≡ θ ln(Asot /Wot ), bdt ≡ θ ln Pdt , and vsodt ≡ −θ(ε1sdt + ε2sodt ). Identification
in this regression comes from controlling for within-sector relative prices using our
first step estimates. The identification assumption is that the unobserved compo-
nent of trade costs is orthogonal to tariffs conditional on the other covariates.

We estimate (48) and (49) by Ordinary Least Squares (OLS). We use sectoral tariff
data constructed by aggregating underlying 4 digit SITC tariff data, and sectoral
trade flow data from the World Input-Output Database (WIOD). Appendix H de-
scribes the data construction and sample restrictions in detail.

We consider three models. First, we estimate the CES model where productivity is
independent across sectors and origin countries (ρsod = 0). Because σsod = θ, esti-
mation of the first step gives us an estimate of θ. Second, we estimate the CNCES
model where correlation is not bilateral, but, rather, symmetric across origin and
destination countries within each sector—that is, ρsod is common across o and d
within s, so that σsod = σ̄s . Finally, we allow for bilateral spatial correlation and es-
timate our full model with σsod as in (47). Note that the CES model is nested within
the CNCES model and the CNCES model is nested within the spatial model.

Appendix Figure I.1 presents OLS estimates of the elasticity of substitution, σsod ,
as a function of geographical distance, while allowing for sectoral heterogeneity.
The spatial pattern that emerges is clear: Substitutability decreases with distance,
indicating that productivity is less correlated between countries that are further
away from each other.23

Appendix Table I.1 presents our OLS estimates of θ. Column 1 shows an estimate
of θ = 5.523 from the CES model based on our first step regression; this value is
in line with values in the literature (see Simonovska and Waugh, 2013). Column
2 shows that θ = 0.607 after we account for symmetric correlation across space
within each sector (CNCES). Finally, column 3 presents the estimate of θ = 0.489
from our second step regression when we allow for distance-dependent sectoral
elasticities.

We next use the estimates of the correlation function and the parameter θ to per-
form various counterfactual exercises.
  23
      Appendix Figure I.2 shows estimates from our first step regression for the within-sector elas-
ticity of substitution in the CNCES model, σsod = σ̄s .




                                                36
                     Figure 1: Gains from Trade and Self-Trade Share, 2007.

                                        HUN




              .6
                                       SVK



                                                              MEX CAN


                              MLT
                              MLT          ESTAUT CZE SWE
              .4


                                 BEL                     IRL
                   LUX                                       DEU
                                        HUN    LTU
                   LUX                           CYP
                                                LVA              GBR                         RUS
                                                     DNK           FRA
                                       SVKSVNNLD      BGR           FIN
                                                               POL        ESP              USA
                                                              PRT
                                 BEL                          GRC                     AUS
                                           ESTAUT
                                                 CYP                            ITA              IND
              .2




                                          SVN   LVA CZE IRL                     TUR
                                               LTU DNK
                                              NLD                                                 IDN
                                                                                           KOR
                                                      BGR SWEMEX                                     CHN
                                                                 GBR                                BRA
                                                             DEU  CAN
                                                               POL
                                                              PRT
                                                              GRC                                   JPN
                                                                   FRA
                                                                    FIN
                                                                          ESP
                                                                                ITA AUS
                                                                                TUR  USARUS
                                                                                     KORIND
                                                                                         IDNJPN
                                                                                             CHN
                                                                                            BRA
              0




                         .2                   .4              .6                      .8                   1
                                                     Self−Trade Share


Notes: Black data: GTdspatial . Blue data: GTdCN CES . Red line: GTdCES .




7.3      The Gains from Trade

Figure 1 shows the gains from trade calculated using the model with no correla-
tion (CES), with within-sector symmetric correlation (cross-nested CES, CNCES),
and with bilateral spatial correlation, respectively.24 The figure shows not only
that differences in (log) levels are large across the three models for all countries,
but, also and more importantly, differences are large across countries with similar
self-trade shares. For instance, Mexico, Germany, and Poland have a similar self-
trade share of around 60 percent. However, once we account for either symmetric
spatial correlation or bilateral spatial correlation, their gains are significantly dif-
ferent. In contrast, the CES model would predict equal gains from trade for these
three countries. In turn, the CNCES model delivers gains from trade that are more
heterogeneous than the ones from CES, but much less heterogenous than the ones
coming from the spatial model.

Perhaps not surprisingly, Figure 2 shows that countries that are on average fur-
ther away from their trading partners have higher gains from trade in the spa-
tial model, while the CNCES model—with sectoral elasticities that are constant
over space—fails to do that. Through the lens of our spatial model, countries fur-
  24
       Results for years prior to 2007 are relegated to the Online Appendix.



                                                                37
  Figure 2: Gains from Trade and Distance, 2007. Percent differences from CES.
 .6                             (a) Spatial                                                                   (b) CNCES




                                                                                   .6
 .5




                                                                                   .5
                                           HUN
                                                             CANMEX
                                     SVK
 .4




                                                                                   .4
                          SWE                  RUS
 .3




                                                                                   .3
                           CZE   DEU     IRL
                       AUT        GBR
                             FRA EST                          USA
                                  FIN
                                 ESP
                      LTU                                             AUS
 .2




                                                                                   .2
                LVADNK POL  PRT         BGR   IND MLTCYP                                                                   HUN
                                GRC BEL
                                      NLD                                                                                          MLT
                        ITA
                         KOR        TUR CHN IDN
                SVN                                 BRA                                                              SVK
 .1




                                                                                   .1
                          JPN
                                                                                                      AUT CZE              IRL         CYP
               LUX                                                                               LVADNK    SWE
                                                                                                                  EST
                                                                                                                   GBR                       CANMEX
                                                                                                          POLPFRA  FIN BELBGR
                                                                                                               RTGRC
                                                                                                                  DEU
                                                                                                                  ESP            RUS
                                                                                                 SVN LTU
                                                                                               LUX        KOR
                                                                                                         ITA
                                                                                                           JPN       TUR CHN IDNIND
                                                                                                                        NLD            BRA   USA    AUS
 0




                                                                                   0
 −.1




                                                                                   −.1
       500                  1000                   2000                     4000         500              1000                   2000                     4000
                     Trade−Weighted Average Distance (Kilometers)                                  Trade−Weighted Average Distance (Kilometers)




Notes: (2a) Black data: 100 × (GTdCN CES − GTdCES )/GTdCES . (2b): Black data: 100 × (GTdspatial −
GTdCES )/GTdCES . Blue line: log-linear fit. Grey band: 95% point-wise confidence interval.



ther away from each other have more dissimilar technologies—i.e., lower sectoral
elasticities—and, hence, higher gains from trade. This result captures the idea that
more dissimilar countries have higher gains from trade, as proposed by Ricardo.


7.4          NAFTA, the Rise of Chinese Imports, and U.S. Protectionism

Next, we consider the implications of our spatial model regarding various counter-
factual scenarios, and compare them with the implications from the CNCES model.
We use the procedure outlined in Section 4.

We first consider a scenario in which the United States increases trade costs with
Mexico and Canada simultaneously by x percent, with x ∈ [5, 50]. Figure 3 shows
the implications for real wages for the spatial model and the CNCES model. The
difference between the two models shows the effect of accounting for bilateral cor-
relation in addition to within-sector correlation. Differences in the predicted real
wages can be large, particularly for large changes in trade costs.

Why does correlation matter, and even more for large changes in trade costs? The
gains from trade come from two potentially offsetting effects: a price effect and
a wage effect. The price effect is direct. Increasing trade costs on Mexican goods
increases prices for U.S. consumers. The size of this effect is just the elasticity of
the price in the United States to the price of imports from Mexico, which equals



                                                                             38
the expenditure share,

                                −θ               −θ      1     −θ
                                                         −θ
   ∂ ln PU SA     ∂ ln GU SA (P1,U SA , . . . , PN,U SA )     PM EX,U SA GM EX,U SA
                =                                           =                       = πM EX,U SA .
∂ ln τM EX,U SA             ∂ ln PM EX,U SA                           PU−θSA

In contrast, the wage effect is indirect and operates through general equilibrium
effects. The market clearing condition for the United States is

                                   N
                                   X PU−θSA,d GdU SA (P1d
                                                       −θ
                                                          , . . . , PN−θd )
                   WU SA LU SA =                   −θ
                                                                              Xd .
                                   d=1
                                              Gd (P1d , . . . , PN−θd )

If the change in trade costs with Mexico induces U.S. consumers to substitute ex-
penditure away from Mexican goods and towards U.S. goods, the right-hand side
of this condition—that captures labor demand—would increase and U.S. wages
would increase. How rapidly expenditure shifts away from Mexican goods and
towards U.S. goods depends on the correlation in technology. If the United States
and Mexico were very close neighbors (i.e., high correlation), then U.S. and Mex-
ican goods would be substitutable and labor demand in the United States would
be sensitive to trade costs for imports from Mexico. In this case, the wage effect
would be large and would offset the losses coming from increasing prices in the
United States. In contrast, if trade between most parts of Mexico and the United
States occurs over long distances, accounting for spatial correlation would reduce
the substitutability of their goods. As a result, the offsetting wage effect would be
smaller in the spatial model. As we see in Figure 3, accounting for spatial correla-
tion in technology leads to an increase in the losses from increasing U.S. trade costs
with NAFTA partners. Notice, also, that the gap between the models depends on
the size of the increase in trade costs. For small changes in trade costs, the gap
is small because general equilibrium effects on wages are small, while the direct
price effect—with an elasticity equal to the expenditure share—does not change
between the CNCES and spatial models.

Second, we consider the implications of the rise of Chinese manufacturing imports
for the real wage in the United States. To proceed, we compute the change in the
U.S. real wage in each year between the observed outcome (i.e., the real wage im-
plied by each model given the data) and a scenario in which we fix China’s trade
costs at the level of 2003 for the sector "Machinery, Equipment, and Manufacturing
n.e.c.". We choose this sector because expenditure by the United States on manu-


                                              39
                                              Figure 3: Effects of NAFTA Reversal on Real Wages.
                                (a) Cross-nested CES (CNCES) Model                                                                  (b) Spatial Model
                 0




                                                                                                         0
                 −1




                                                                                                         −1
  Percent Change in Real Wage




                                                                                          Percent Change in Real Wage
                          −2




                                                                                                                  −2
                     −3




                                                                                                             −3
              −4




                                                                                                      −4
         −5




                                                                                                 −5
   −6




                                                                                           −6
                                    United States                                                                           United States
                 −7




                                                                                                         −7
                                    Mexico                                                                                  Mexico
                                    Canada                                                                                  Canada
                 −8




                                                                                                         −8
                                0      10           20              30          40   50                                 0      10           20              30          40   50
                                              Percent Increase In Trade Costs                                                         Percent Increase In Trade Costs



Notes: Effects of an unilateral increase in trade costs for goods from Canada and Mexico into the United
States.


facturing goods from China increased threefold between 2003 and 2007 (Appendix
Figure I.3). Additionally, this sector’s implied trade costs decrease sharply in the
spatial model, but they are relatively stable for the CNCES model, as shown in Fig-
ure 4a. For the remaining sectors, the implied trade costs between the two models
are similar (not shown).25 Figure 4b shows the difference in real wages between
the actual and counterfactual scenario: The sharp decrease in trade costs implied
by the spatial model from 2003 on translates into large increases in the U.S. real
wage. The CNCES model fails to capture both the collapse in trade costs within
this sector, and, as a consequence, suggests lower gains for the United States from
the rise of manufacturing imports from China.

Finally, we consider a series of trade protection exercises where the United States
unilaterally increases trade costs by five percent, one trading partner at the time.
We compute the counterfactual change in real wages for both the case of the spatial
model where we account for bilateral correlation in technology and the case of the
CNCES model. The presence of bilateral correlation changes the rankings of the
countries that provoke the largest change in U.S. real wages. While the CNCES
model implies that real wages in the United States would decrease the most with
increases in trade costs from Canada, the spatial model predicts that China would
                                                  ∗      ∗
    25
     Trade costs are calculated using the ratio (πsodt /πsoot )−1/θ = τsodt Pot /Pdt , for each s and t.
Since we can only uncover within-destination relative prices from our expenditure data, we use
GDP deflators from the Penn World Tables (9.0) to adjust this quantity by country price levels and
recover sectoral trade costs.



                                                                                     40
                                                  Figure 4: The Rise of Chinese Manufacturing Imports.
                                   (a) Implied trade costs τCHN,U SA , S10                                               (b) Implied change in U.S. real wage
                  20




                                                                                                     5
                                                                                                                             Spatial
                                                                                                                             CNCES




                                                                                                                  4
                                                                                       Percent Change in Real Wage
                            15
    Log Inferred Trade Costs




                                                                                                         3
                 10




                                        Spatial
                                        CNCES




                                                                                                2
     5




                                                                                      1
                  0




                                                                                                     0
                                 1995   1997       1999   2001   2003   2005   2007                                   2003        2004     2005      2006       2007
                                                          Year                                                                             Year



Notes: S10 refers to the sector "Machinery, Equipment, and Manufacturing n.e.c.". (4a) shows trade costs
in S10, implied by the spatial and CNCES model, respectively—dash lines show the counterfactual levels
of trade costs. (4b) shows the percent changes in the U.S. real wage, implied by the spatial and CNCES
model, respectively.



have the largest impact. Another example of a ranking reversal between the two
models occurs with Korea and Great Britain: While the spatial model puts Korea
in seventh place and Great Britain in eighth place, the CNCES model predicts the
opposite. The intuition for these unilateral protectionism exercises is similar to the
other counterfactuals: the direct price effect is measured by observed expenditure
shares, which are constant across models, while the indirect wage effect depends
on substitutability of goods across trading partners and, therefore, depends on
patterns of spatial correlation.

All these counterfactual exercises illustrate that the welfare implications of changes
in trade costs can change substantially once we account for spatial correlation in
productivity. These results reflect Ricardo’s insight that differences in technologi-
cal similarity across trade partners matter for the gains from trade.



8                                 Conclusions

This paper is motivated by the old Ricardian idea that a country gains from trading
with those countries who are technologically dissimilar. We develop a Ricardian
theory of trade that allows for arbitrary patterns of correlation in technology be-
tween countries. We start from technology primitives that generate multivariate


                                                                                41
Fréchet productivity with a general correlation structure. Even so, we retain all the
tractability of EK-type tools. Importantly, our structure generates the class of GEV
factor demand systems and, as such, approximates any Ricardian model—not only
the one with Fréchet-distributed productivity.

The gains from trade coming from a GEV factor demand system can be written as
a simple correction to self-trade shares. Moreover, the theory, by relating macro
substitutability patterns to underlying micro structures, provides guidance on in-
corporating standard micro estimates into macro counterfactual exercises.

Our quantitative application to a multi-sector model of trade reveals that account-
ing for correlation matters: Gains are much more heterogeneous across countries
than the case of independent productivity. These results suggest that our frame-
work has the potential to change quantitative conclusions in any literature apply-
ing Fréchet tools.




                                         42
References
Adao, R., A. Costinot, and D. Donaldson (2017). Nonparametric counterfactual
 predictions in neoclassical models of international trade. The American Economic
 Review 107(3), 633–689.

Ahlfeldt, G., S. Redding, D. Sturm, and N. Wolf (2015). The economics of density:
 Evidence from the berlin wall. Econometrica 83(6), 2127–2189.

Alvarez, F. and R. E. Lucas (2007). General equilibrium analysis of the eaton-
  kortum model of international trade. Journal of Monetary Economics 54(6), 1726–
  1768.

Anderson, J. E. (1979). A theoretical foundation for the gravity equation. The
 American Economic Review 69(1), 106–116.

Antràs, P. and A. de Gortari (2017). On the geography of global value chains.
 Mimeo, Harvard University.

Arkolakis, C., A. Costinot, D. Donaldson, and A. Rodriguez-Clare (2017). The
  elusive pro-competitive effects of trade. Review of Economic Studies, forthcoming.

Arkolakis, C., A. Costinot, and A. Rodríguez-clare (2012). New trade models, same
  old gains? The American Economic Review, 94–130.

Bas, M., T. Mayer, and M. Thoenig (2017). From micro to macro: Demand, supply,
  and heterogeneity in the trade elasticity. Journal of International Economics 108,
  1–21.

Berry, S., A. Gandhi, and P. Haile (2013). Connected substitutes and invertibility of
  demand. Econometrica 81(5), 2087–2111.

Bertoletti, P., F. Etro, and I. Simonovska (2017). International trade with indirect
  additivity. American Economic Journal: Microeconomics, forthcoming.

Bottazzi, L. and G. Peri (2003). Innovation, demand, and knowledge spillovers:
  Evidence from european patent data. European Economic Review 47, 687–710.

Brooks, W. and P. Pujolas (2017). Non linear gravity. Mimeo, Notre-Dame University.

Bryan, G. and M. Morten (2018). The aggregate productivity effects of internal
  migration: Evidence from indonesia. Journal of Political Economy, forthcoming.

Buera, F. J. and E. Oberfield (2016). The global diffusion of ideas. NBER Working
  Paper Series (21844).

Caliendo, L., F. P. annd Esteban Rossi-Hansberg, and P.-D. Sarte (2017). The impact
  of regional and sectoral productivity changes on the u.s. economy. Review of
  Economic Studies, forthcoming.


                                         43
Caliendo, L. and F. Parro (2015). Estimates of the trade and welfare effects of nafta.
  The Review of Economic Studies 82(1), 1–44.

Caron, J., T. Fally, and J. Markusen (2014). International trade puzzles: a solution
  linking production factors and demand. The Quarterly Journal of Economics 129(3),
  1501–1552.

Comin, D., M. Dmitriev, and E. Rossi-Hansberg (2013). The spatial diffusion of
 technology. Unpublished.

Costinot, A., D. Donaldson, and I. Komunjer (2012). What goods do countries
 trade? a quantitative exploration of ricardo’s ideas. Review of Economic Studies 79,
 581–608.

Costinot, A. and A. Rodrìguez-Clare (2014). Trade theory with numbers: Quanti-
 fying the consequences of globalization. Technical Report 4.

Dagsvik, J. K. (1995). How large is the class of generalized extreme value random
 utility models? Journal of Mathematical Psychology 39(1), 90–98.

De Haan, L. (1984). A spectral representation for max-stable processes. The Annals
 of Probability 12(4), 1194–1204.

DeLoecker, J., P. Goldberg, A. Khandelwal, and N. Pavcnik (2016). Prices, markups
 and trade reform. Econometrica 84(2), 445Ð510.

Dornbusch, R., S. Fisher, and P. Samuelson (1977). Comparative advantage, trade
 and payments in a ricardian model with a continuum of goods. American Eco-
 nomic Review 67, 823–839.

Eaton, J. and S. Kortum (1999). International technology diffusion: Theory and
  measurement. International Economic Review 40(3), 537–570.

Eaton, J. and S. Kortum (2001). Technology, trade, and growth: A unified frame-
  work. European Economic Review 45, 742–755.

Eaton, J. and S. Kortum (2002). Technology, geography, and trade. Econometrica,
  1741–1779.

Eaton, J. and S. Kortum (2010). Technology in the global economy: A framework
  for quantitative analysis. Unpublished manuscript.

Eaton, J. and S. Kortum (2012). Putting ricardo to work. Journal of Economic Per-
  spectives 26(2), 65–90.

Fajgelbaum, P. and S. Redding (2014). External integration, structural transfor-
  mation and economic development: Evidence from argentina 1870-1914. NBER
  Working Paper 20217.

Fally, T. and J. Sayre (2018). Commodity trade matters. Mimeo UC Berkeley.


                                         44
Feenstra, R. C., P. Luck, M. Obstfeld, and K. N. Russ (2017). In search of the arm-
  ington elasticity. The Review of Economics and Statistics 0(0), null.

Feenstra, R. C. and D. E. Weinstein (2017). Globalization, markups, and the U.S.
  price level. Journal of Political Economy 125(4), 1040–1074.

Fosgerau, M., D. McFadden, and M. Bierlaire (2013). Choice probability generating
  functions. Journal of Choice Modeling 8, 1–18.

French, S. (2016). The composition of trade flows and the aggregate effects of trade
  barriers. Journal of International Economics 98, 114–137.

Hanoch, G. (1975). Production and demand models with direct or indirect implicit
 additivity. Econometrica: Journal of the Econometric Society, 395–419.

Hsieh, C.-T., E. Hurst, C. I. Jones, and P. J. Klenow (2013). The allocation of tal-
 ent and u.s. economic growth. Technical report, National Bureau of Economic
 Research.

Keller, W. (2002). Geographic localization of international technology diffusion.
  American Economic Review 92, 120–42.

Keller, W. and S. R. Yeaple (2013). The gravity of knowledge. American Economic
  Review 103(4), 1414.

Kortum, S. (1997). Research, patenting, and technological change. Economet-
 rica 65(6).

Krugman, P. (1980). Scale economies, product differentiation, and the pattern of
  trade. The American Economic Review 70(5), 950–959.

Lagakos, D. and M. E. Waugh (2013). Selection, agriculture, and cross-country
  productivity differences. The American Economic Review 103(2), 948–980.

Lashkari, D. and M. Mestieri (2016). Gains from trade with heterogeneous income
  and price elasticities. Mimeo, Harvard University.

Lashkaripour, A. and V. Lugovskyy (2017). Industry-level scale economies: from
  micro-estimation to macro-implications. Mimeo, Indiana University.

Levchenko, A. and J. Zhang (2016). The evolution of comparative advantage: Mea-
  surement and welfare implications. Journal of Monetary Economics 78, 96–111.

McFadden, D. (1978). Modeling the choice of residential location. Transportation
 Research Record (673).

Melitz, M. J. (2003). The impact of trade on intra-industry reallocations and aggre-
 gate industry productivity. Econometrica 71(6), 1695–1725.

Monte, F., S. Redding, and E. Rossi-Hansberg (2015). Commuting, migration and
 local employment elasticities. NBER Working Paper 21706.

                                        45
Ossa, R. (2015). Why trade matters after all. Journal of International Economics 97(2),
 266–277.

Penrose, M. D. (1992). Semi-min-stable processes. The Annals of Probability 20(3),
  1450–1463.

Ramondo, N. and A. Rodríguez-Clare (2013). Trade, multinational production, and
  the gains from openness. Journal of Political Economy 121(2), 273–322.

Ramondo, N., A. Rodríguez-Clare, and M. Saborío-Rodríguez (2016). Trade, do-
  mestic frictions, and scale effects. American Economic Review 106(10), 3159–84.

Redding, S. (2016). Goods trade, factor mobility and welfare. Journal of International
  Economics 101, 148–167.

Redding, S. and E. Rossi-Hansberg (2017). Quantitative spatial economics. Annual
  Review of Economics 9, 21–58.

Redding, S. J. and D. E. Weinstein (2017). Aggregating from micro to macro pat-
  terns of trade. Mimeo, Princeton University.

Ricardo, D. (1817). On the Principles of Political Economy and Taxation (1 ed.). John
  Murray, London.

Rudin, W. et al. (1964). Principles of mathematical analysis, Volume 3. McGraw-hill
  New York.

Sato, R. (1977). Homothetic and non-homothetic CES production functions. The
  American Economic Review 67(4), 559–569.

Scarf, H. and C. A. Wilson (2005). Uniqueness of equilibrium in the multi-country
  ricardo model. in Frontiers in Applied General Equilibrium Modeling, ed. T. J. Kehoe,
  T. N. Srinivasan, and J. Whalley, 24–44.

Schlather, M. (2002). Models for stationary max-stable random fields. Extremes 5(1),
  33–44.

Simonovska, I. and M. Waugh (2013). The elasticity of trade: Estimates and evi-
  dence. Journal of International Economics 92, 34–50.

Smith, A. (1776). An Inquiry into the Nature and Causes of the Wealth of Nations (1
  ed.). W. Strahan, London.

Smith, T. E. (1984). A choice probability characterization of generalized extreme
  value models. Applied Mathematics and Computation 14(1), 35–62.

Wilson, C. A. (1980). On the general structure of ricardian models with a con-
 tinuum of goods: Applications to growth, tariff theory, and technical change.
 Econometrica 48(7), 1675–1702.



                                          46
A        Properties of Fréchet Random Variables

Lemma A.1. Let X be distributed Fréchet with location T > 0 and shape α > 0. Then
if α > 1, E[X] = Γ(1 − 1/α)T 1/α . Also, for any S > 0 and β > 0, (S 1/α X)β is Fréchet
with location ST and shape α/β.

Proof.
                      Z     ∞                                  Z    ∞
                                 ∂                                          ∂ −T z−α
         E[X] =                 z P [X ≤ z] dz =                        z      e     dz
                                 ∂z                                         ∂z
                      Z0 ∞                                      0
                                                                    Z   ∞
                                     −T z −α          −α−1
                 =              ze             αT z          dz =            t−1/α e−t dtT 1/α = Γ(1 − 1/α)T 1/α ,
                        0                                           0


and

                                                                                      −1/α z 1/β )−α              −α/β
           P[(S 1/α X)β ≤ z] = P[X ≤ S −1/α z 1/β ] = e−T (S                                           = e−ST z          .




Lemma A.2. Let {Xi }i=1,...,N be α-Fréchet with scale parameters {Ti }N
                                                                      i=1 and correlation
function G : RN
              + → R+ . Then, for any Si ≥ 0 i = 1, . . . , N and β > 0, the random vec-
          1/α
tor {(Si        Xi ) β } N                                                      N
                         i=1 is α/β-Fréchet with location parameters of {Si Ti }i=1 and correlation
function G.

Proof.

                1/α                                                                1/β
         P[(Si        Xi )β ≤ yi , i = 1, . . . , N ] = P[Xi ≤ Siα yi , i = 1, . . . , N ]
                                                           h                                         i
                                                                        −α/β                    −α/β
                                                      = exp −G(T1 S1 y1      , . . . , T N S N xN ) .




Lemma A.3. Let {Xi }i=1,...,N be θ-Fréchet with scale parameters {Ti }N
                                                                      i=1 and correlation
function G : RN
              + → R+ . Then, the random variable maxi=1,...,N Xi is θ-Fréchet with
location G(T1 , . . . , TN ). Moreover, let {Ij }M
                                                 j=1 be any partition of {1, . . . , N } and define
the random variable {Y1 , . . . , YM } as

                                                             Yj = max Xi .
                                                                    i∈Ij




                                                                    47
Let j : {1, . . . , N } → {1, . . . , M } be the unique mapping such that j = j(i) if and only if
                                                                                                      Ti
i ∈ Ij . Define T̃j = G(T1 1{1 ∈ Ij }, . . . , TN 1{N ∈ Ij }) and ωi =                                T̃j
                                                                                                          1{i     ∈ Ij }. Then,

   1. {Y1 , . . . , YM } is θ-Fréchet with correlation function H : RM
                                                                     + → R+ satisfying


                                        H(z1 , . . . , zM ) = G(ω1 zj(1) , . . . , ωN zj(N ) );


   2.                                                              P
                                        h                   i
                                                                        i∈Ij      Ti Gi (T1 , . . . , TN )
                                       P Yj = max Xi =                                                       ,
                                                      i                      G(T1 , . . . , TN )
         where Gi (x1 , . . . , xN ) ≡ ∂G(x1 , . . . , xN )/∂xi ;

   3. For any j = 1, . . . , M , the distribution of Yj conditional on the event Yj = maxi=1,...,N Xi
         is identical to the distribution of maxi=1,...,N Xi ,

                    h                    i                                    
                                             −G(T1 ,...,TN )y −θ
                   P Yj ≤ y | Yj = max Xi = e                    = P max Xi ≤ y .
                                                  i                                                i=1,...,N


Proof. We first prove part (1). Let {Ij }M
                                         j=1 be a partition of {1, . . . , N } and define
Yj = maxi∈Ij Xi . Let the function j : {1, . . . , N } → {1, . . . , M } satisfy i ∈ Ij(i) for
all i = 1, . . . , N . Note that there is a unique function satisfying this condition since
{Ij }M
     j=1 is a partition of {1, . . . , N }. Then,


                 P [Yj ≤ yj , ∀j = 1, . . . , M ] = P [Xi ≤ yj , ∀i ∈ Ij , ∀j = 1, . . . , M ]
                                                                            −θ             −θ
                                                          = e−G(T1 yj(1) ,...,TN yj(N ) ) .

Therefore {Y1 , . . . , YM } is θ-Fréchet. Its scale parameters are

                           −θ                 −θ
           lim
        yk →∞,k6=j
                     G(T1 yj(1) , . . . , TN yj(N ) ) = G(T1 1{1 ∈ Ij }, . . . , TN 1{N ∈ Ij }) = T̃j ,


and its correlation function must then be

   G(T1 /T̃j(1) zj(1) , . . . , TN /T̃j(N ) zj(N ) ) = G(ω1 zj(1) , . . . , ωN zj(N ) ) = H(z1 , . . . , zM ).

Note that if we take M = 1 so that I1 = {1, . . . , N } we get
                                             
                   P        max Xi ≤ y = P [Y1 ≤ y] = P [Yj ≤ y, ∀j = 1, . . . , M ]
                           i=1,...,N
                                                                −θ ,...,T        −θ )                        −θ
                                                  = e−G(T1 y                Ny
                                                                                        = e−G(T1 ,...,TN )y .

                                                                48
That is, maxi=1,...,N Xi is a θ-Fréchet random variable with location G(T1 , . . . , TN )
and shape θ.

Next we prove part (2). We have
       h                          i   h                       i
      P max Xi ≤ y and Yj = max Xi = P Yj ≤ y and Yj = max Xi
              i                                       i                                                         i

      = P [Yj ≤ y and Xi ≤ Yj , ∀i = 1, . . . , N ] = P [Yj ≤ y and Xi ≤ Yj , ∀i ∈ / Ij ]
        Z y
                                                 ∂
      =      P [Xi ≤ t, ∀i ∈  / Ij | Yj = t] P[Yj ≤ t]dt
                                                 ∂t
        Z0 y
             ∂
      =           P [Xi ≤ z, ∀i ∈  / Ij , and Xi ≤ t, ∀i ∈ Ij ]|z=t dt
         0 ∂t
        Z yX
                    ∂ −G(T1 y1−θ ,...,TN yN−θ )
      =                e                                          dt
         0 i∈I ∂yi                              yi =t,∀i=1,...,N
                j
        Z yX
                           −θ         −θ
                                                                    −θ
      =            e−G(T1 y1 ,...,TN yN ) Gi (T1 y1−θ , . . . , TN yN  )Ti θyi−θ−1  dt
           0                                                                                                        yi =t,∀i=1,...,N
                      i∈Ij
          Z       y
                                      −θ
                                           X
      =               e−G(T1 ,...,TN )t           Ti Gi (T1 , . . . , TN )θt−θ−1 dt
           0                               i∈Ij
          P
                  i∈Ij    Ti Gi (T1 , . . . , TN ) Z          y
                                                                                      −θ
      =                                                           e−G(T1 ,...,TN )t G(T1 , . . . , TN )θt−θ−1 dt
                    G(T1 , . . . , TN )                   0
          P
                  i∈Ij Ti Gi (T1 , . . . , TN )                              −θ
      =                                               e−G(T1 ,...,TN )y ,
                       G(T1 , . . . , TN )

where Gi (x1 , . . . , xN ) = ∂G(x1 , . . . , xN )/∂xi . Let y → ∞ to get
                                                                       P
                                   h           i
                                                                          i∈Ij    Ti Gi (T1 , . . . , TN )
                                  P Yj = max Xi =                                                               .
                                                  i                            G(T1 , . . . , TN )

Finally, we can prove part (3) using the previous results:
           h                        i P [max X ≤ y and Y = max X ]
                                            i  i          j     i i
          P max Xi ≤ y | Yj = max Xi =
             i                 i              P [Yj = maxi Xi ]
                                                                          P
                                                                              i∈Ij    Ti Gi (T1 ,...,TN )              −θ
                                                                                  G(T1 ,...,TN )
                                                                                                     e−G(T1 ,...,TN )z
                                                                      =               P
                                                                                          i∈I Ti Gi (T1 ,...,TN )
                                                                                                j
                                                                                               G(T1 ,...,TN )
                                                                                                 −θ
                                                                      = e−G(T1 ,...,TN )z
                                                                          h               i
                                                                      = P max Xi ≤ y .
                                                                                  i




                                                                        49
B      Proof of Lemma 1

Proof. First, we show that if productivity is θ-Fréchet, then there must exist a corre-
lation function Gd : RN
                      + → R+ such that (5) is the joint distribution of productivity
across origins.
                                                                   1/θ
Consider any (x1 , . . . , xN ) ∈ RN
                                   + . Then xo                           ≥ 0 for each o. From the definition of a
                                                                                                                       1/θ
multivariate θ-Fréchet random variable, the random variable maxo=1,...,N xo Aod (v)
must be distributed as a θ-Fréchet random variable. That is, there exists some
T > 0 such that                                                               
                                                                                              −θ
                                      P        max        x1/θ
                                                           o Aod (v)     ≤ a = e−T a .
                                              o=1,...,N

Let T d : RN
           + → R+ be the map (x1 , . . . , xN ) 7→ T . We then have that for any
(x1 , . . . , xN ) ∈ RN
                      +

                                                              
                                      x1/θ                 ≤ a = exp −T d (x1 , . . . , xN )a−θ .
                                                                                              
                  P        max         o Aod (v)
                          o=1,...,N


Note that the joint distribution of productivity can be written as

       P[A1d (v) ≤ a1 , . . . , AN d (v) ≤ aN ] = P[A1d (v)/a1 ≤ 1, . . . , AN d (v)/aN ≤ 1]
                                                                             
                                                = P max Aod (v)/ao ≤ 1 .
                                                                         o=1,...,N


Choosing xo = a−θ                                                     d
               o and a = 1 we can use the properties of our function T and get

                                              
                                                                          −θ
                             max Aod (v)/ao ≤ 1 = exp −T d (a−θ
                                                                            
                   P                                         1 , . . . , aN ) .
                           o=1,...,N


Therefore, the joint distribution of productivity satisfies

                                                                                     d (T       −θ           −θ
                  P[A1d (v) ≤ a1 , . . . , AN d (v) ≤ aN ] = e−G                            1d a1 ,...,TN d aN )
                                                                                                                   ,

for the function Gd : RN                                        d
                       + → R+ defined by (x1 , . . . , xN ) 7→ T (x1 /T1d , . . . , xN /TN d ).

We now show that this Gd is a correlation function. First we show that it must be




                                                                   50
homogenous. Fix (x1 , . . . , xN ) ∈ RN
                                      + and let λ > 0. We have


exp −Gd (λx1 , . . . , λxN ) = P[T1d A1d (v)−θ ≥ λx1 , . . . , TN d AN d (v)−θ ≥ λxN ]
                           

                                      = P[(x1 /T1d )1/θ A1d (v) ≤ λ−1/θ , . . . , (xN /TN d )−1/θ AN d (v) ≤ λ−1/θ ]
                                      = P[ max (xo /Tod )−1/θ Aod (v) ≤ λ−1/θ ]
                                          o=1,...,N

                                      = exp −T d (x1 /T1d , . . . , xN /TN d )λ
                                                                              

                                      = exp −λGd (x1 , . . . , xN ) ,
                                                                    


so that Gd (λx1 , . . . , λxN ) = λGd (x1 , . . . , xN ) as desired.

Now consider the normalization restriction. Fix o. The distribution of Aod (v) is
                                                                                                 
                                 −θ
                                                                                   x1/θ
                                      
              exp −Tod a                  = P[Aod (v) ≤ a] = P          max         n And (v)   ≤a ,
                                                                       n=1,...,N


for the choice of xn = 0 for n 6= o and xo = 1. But then,

                  exp −Tod a−θ = exp −T d (x1 , . . . , xN )a−θ
                                                                 

                                = exp −T d (0, . . . , 0, 1, 0, . . . , 0)a−θ
                                                                             

                                = exp −Gd (0, . . . , 0, Tod , 0, . . . , 0)a−θ
                                                                               

                                = exp −Gd (0, . . . , 0, 1, 0, . . . , 0)Tod a−θ ,
                                                                                 


where the last equality comes from the homogeneity of Gd . We therefore must
have Gd (0, . . . , 0, 1, 0, . . . , 0) = 1 as desired.

The unboundedness restriction follows from the limiting properties of joint distri-
butions. Fix o. Then,

                 d (x ,...,x )
       lim e−G       1      N
                                 = lim P[T1d A1d (v)−θ ≥ x1 , . . . , AN d (v) ≥ xN ]
      xo →∞                           xo →∞
                                                  −1/θ                              −1/θ
                                 = lim P[T1d             A1d (v) ≤ x1 , . . . , TN d AN d (v) ≤ xN ] = 0.
                                      xo →∞


Therefore, limxo →∞ Gd (x1 , . . . , xN ) = ∞ as desired.

Finally, the differentiability restrictions are necessary because the productivity dis-
tribution is continuous and therefore has a joint density function. Smith (1984)
shows that the differentiability condition is necessary for this joint density to exist.

Therefore, the function Gd must be a correlation function, and we have proven that


                                                           51
if productivity is θ-Fréchet then there exists a correlation function Gd : RN
                                                                            + → R+
such that (5) holds.

We now prove the converse. Let Tod > 0 for each o = 1, . . . , N , and let Gd : RN
                                                                                 + →
R+ be a correlation function. Suppose that {Aod (v)}N
                                                    o=1 satisfies


                                                                                     −θ
         P[A1d (v) ≤ a1 , . . . , AN d (v) ≤ aN ] = exp −Gd (Tod a−θ
                                                                                       
                                                                  1 , . . . , T N d aN ) .


We want to show that {Aod (v)}N                                           N
                              o=1 is θ-Fréchet. Let (x1 , . . . , xN ) ∈ R+ and consider
the distribution of maxo=1,...,N xo Aod (v),

           P[ max xo Aod (v) ≤ a] = P[x1 A1d (v) ≤ a, . . . , xN AN d (v) ≤ a]
              o=1,...,N

                                       = P[A1d (v) ≤ a/x1 , . . . , AN d (v) ≤ a/xN ]
                                       = exp −Gd (Tod xθ1 a−θ , . . . , TN d xθN a−θ )
                                                                                     

                                       = exp −Gd (Tod xθ1 , . . . , TN d xθN )a−θ ,
                                                                                 


where the last equality uses the homogeneity of Gd . Therefore, maxo=1,...,N xo Aod (v)
is a θ-Fréchet random variable with location parameter Gd (Tod xθ1 , . . . , TN d xθN ). As a
result, we conclude that {Aod (v)}N
                                  o=1 is θ-Fréchet.




C     Proof of Theorem 1

Proof. The proof follows Theorem 2 of De Haan (1984) and Theorem 3 of Penrose
(1992). First, we prove sufficiency. Using Assumption 1,
                                                                                                          
                                                                          1/θ
 P [Aod (v) ≤ ao    ∀o = 1, . . . , N ] = P       max (Zi (v)Aiod (v))           ≤ ao  ∀o = 1, . . . , N
                                              i=1,2,...
                                                                                                    
                                      =P          max Zi (v)Aiod (v) ≤ aθo         ∀o = 1, . . . , N
                                              i=1,2,...

                                                                        aθo
                                                                                                  
                                      = P Zi (v) ≤ min                            ∀i = 1, 2, . . .
                                                          o=1,...,N   Aiod (v)




                                                    52
Using Assumption 2 and 3, the last expression is equal to
                            Z   ∞                  
                                              −2
           = exp −E                    z dz
                    mino aθo /Aiod (v)
                                          
                                                                      −θ
           = exp −E max Aiod (v)ao ≡ exp −Gd (T1d a−θ
                                        −θ
                                                                        
                                                   1 , . . . , T N d aN ) .                        (?)
                             o=1,...,N


Necessity is proved by showing that for any Gd , {Tod }N
                                                       o=1 , and θ there exists Aiod (v)
with Tod = EAiod (v) such that (?) holds for some independent Poisson point process
{Zi (v)}i=1,2,... on [0, ∞) with intensity measure z −2 dz. Theorem 2 of De Haan (1984)
implies that if Ãod (v) is multi-variate 1-Fréchet with unit scale parameters and cor-
relation function Gd , then there exists a random variable Ãiod (v) with EÃiod (v) < ∞
and an independent Poisson process {Z̃i (v)}i=1,2,... on [0, ∞) with intensity measure
z −2 dz such that
                                                       
                                                                                 −1
                            max Z̃i (v)Ãiod (v) ≤ ão = exp Gd (ã−1
                                                                                   
                    P                                              1 , . . . , ãN
                        i=1,2,...


Moreover, we must have EÃiod (v) = 1. As a result, (?) holds after a change of
                                                            1/θ
variables to Aiod (v) = Tod Ãiod (v), and ao = ão .




D       Proof of Proposition 1

Proof. Perfect competition implies that potential import prices are

                                                         Wo
                                            Pod (v) =           .
                                                        Aod (v)

Then,

P[P1d (v) ≥ p1 , . . . , PN d (v) ≥ pN ] = P[P1d (v)/W1 ≥ p1 /W1 , . . . , PN d (v)/WN ≥ pN /WN ]
                                          = P[1/A1d (v) ≥ p1 /W1 , . . . , 1/AN d (v) ≥ pN /WN ]
                                          = P[A1d (v) ≤ W1 /p1 , . . . , AN d (v) ≤ WN /pN ]
                                          = exp −Gd (T1d W1−θ pθ1 , . . . , TN d WN−θ pθn ) .
                                                                                          




                                                    53
E        Proof of Proposition 2

Proof. The proof follows directly from the properties of θ-Fréchet random vari-
ables. The probability that variety v is imported by destination d from origin o
is

                                                                      Tod Wo−θ Gdo (T1d W1−θ , . . . , TN d WN−θ )
         πod ≡ P[Pod (v) ≥ Po0 d (v) ∀o0 6= o] =                                                                   ,
                                                                          Gd (T1d W1−θ , . . . , TN d WN−θ )

by Proposition 1 and Lemma A.3. The distribution of prices among goods im-
ported by destination d from country o satisfies
                                                              
                                                                             −θ           −θ θ
P Pod (v) ≥ p | Pod (v) = 0 min Po0 d (v) = P 0 min Po0 d (v) ≥ p = e−G(T1d W1 ,...,TN d WN )p ,
                                 o =1,...,N                              o =1,...,N


by Proposition 1 and Lemma A.3. The price index in destination d is then

         Z   1                            − σ1                      − σ1
                                                                                                                 − 1
Pd =              min Pod (v)    −σ
                                      dv             = E  min Pod (v)−σ
                                                                               = γGd T1d W1−θ , . . . , TN d WN−θ θ ,
           0 o=1,...,N                                           o=1,...,N


                         1
                     θ−σ − σ
where γ = Γ           θ
                             ,   Γ(·) is the gamma function, and the last equality follows
from the fact that mino=1,...,N Pod (v)−σ = (maxo=1,...,N 1/Pod (v))σ is a Fréchet random
variable with location Gd T1d W1−θ , . . . , TN d WN−θ and shape θ/σ > 1 due to the
                                                      

assumption that θ > σ and due to Lemma A.1.



F        Proof of Proposition 3

Proof. First, the set of varieties from o imported to d is {v ∈ [0, 1] | Wo /Aod (v) =
mino0 Wo0 /Ao0 d (v)} and for any variety in this set, expenditure is
                                                                            −σ
                                                               Wo /Aod (v)
                                       Xd (v) =                                       Xd .
                                                                   Pd

Any v not in this set must get imported from a different origin. The price index is

                                       Z        1                           −σ          − σ1
                             Pd =                        min
                                                          0
                                                             Wo0 /Ao0 d (v)           dv           ,
                                             0            o




                                                                 54
so that we can write the expenditure share as
                         Z       1
                                     Xd (v) n                                o
       πod (W, Xd ) ≡                      1 Wo /Aod (v) = min Wo0 /Ao0 d (v) dv
                                      Xd                    o0
                         R01
                            (Wo /Aod (v))−σ 1 {Wo /Aod (v) = mino0 Wo0 /Ao0 d (v)} dv
                             0
                       =                R1
                                         0
                                            (mino0 Wo0 /Ao0 d (v))−σ dv
                         E [(Wo /Aod (v))−σ 1 {Wo /Aod (v) = mino0 Wo0 /Ao0 d (v)}]
                       =                                                            .
                                        E (mino0 Wo0 /Ao0 d (v))−σ
                                                                   


We need to show that there exists a correlation function that approximates this
factor demand system. The proof is similar to the proof of Theorem 1 in Dagsvik
(1995), differing in the functional form of the demand system to be approximated.
We start by constructing an approximating GEV factor demand system using the
following correlation function, for some θ > σ,

                                                                                 ! σθ  σθ
                                                          X
                   Gd (x1 , . . . , xN ) = E                  Aod (v)θ xo /Tod         .
                                                           o


This choice of Gd will give the result because it implies a price level,
                                              
                                         θ−σ                                             1
                       Pd = Γ                      Gd (T1d W1−θ , . . . , TN d WN−θ )− θ ,
                                          θ

that approximates the true price level. In particular,

                                
                                                                  ! σθ − σ1
                       θ−σ                 X
         Pd = Γ                      E         (Aod (v)/Wo )θ          
                        θ                   o

                h               σ i− σ1                 −σ − σ1
             θ→∞
              → E max Aod (v)/Wo         = E min Wo /Aod (v)          .
                             o                                           o


That is, the price level implied by this correlation function converges pointwise to
the price level associated with the true productivity distribution.




                                                         55
The implied GEV factor demand system is

 GEV                Tod Wo−θ Gdo (T1d W1−θ , . . . , TN d WN−θ )
πod  (W, Xd ; θ) =
                        Gd (T W −θ , . . . , TN d WN−θ )
                      h P 1d 1                    σ                     i
                                                 θ θ −1                θ
                    E      o0 (A  0
                                 od (v)/W  o 0 )        (A od (v)/W o )
                  =                 P                        σ
                               E ( o0 (Ao0 d (v)/Wo0 )θ ) θ
                                        −σ
                  θ→∞ E [(Wo /Aod (v))      1 {Wo /Aod (v) = mino0 Wo0 /Ao0 d (v)}]
                   →                                                                = πod (W, Xd ).
                                       E (mino0 Wo0 /Ao0 d (v))−σ
                                                                       


That is, the implied GEV factor demand system converges pointwise to the true
demand system. To establish uniform convergence across (W, Xd ) ∈ K, for K ⊂
RN
 +
   +1                                      GEV
      compact, note that if the sequence {πod  (W, Xd ; θj )}∞
                                                             j=1 is convergent, there
exists a positive sequence {θk }∞                             GEV
                                k=1 that diverges such that {πod  (W, Xd ; θk )}∞
                                                                                k=1
is monotone and converges. Then, since πod (W, Xd ) is continuous, we can apply
Theorem 7.13 in Rudin et al. (1964) to establish uniform convergence.



G      Proof of Proposition 4

Proof. Micro productivity is distributed multivariate θ-Fréchet, with scale Tmod and
micro correlation function F d (X1 , . . . , XN ). Aggregate productivity is Aod (v) ≡
maxm=1,...,Mo Amod (v). Using Lemma A.2 and Lemma A.3, Aod (v) is distributed as a
multivariate θ-Fréchet with scale parameters

                 Tod = F d (01 , . . . , 0o−1 , Tod , 0o+1 , . . . , 0N ) ≡ F od (Tod ) ,

for Tod ≡ (T1od , . . . , TMo od ), and correlation function

                         Gd (x1 , . . . , xN ) ≡ F d (Ω1d x1 , . . . , ΩN d xN ),

for ωmod ≡ Tmod /Tod and Ωod ≡ (ω1od , . . . , ωMo od ).




                                                   56
H        Data Construction

For our quantitative analysis, we use trade flow data from the World Input-Output
Database (WIOD), tariff data from the United Nations Comtrade Database, and
gravity covariates from Centre D’Études Prospectives et d’Informations Interna-
tionales (CEPII). When calculating the trade costs implied by this data, we use
GDP deflator data from the Penn World Tables (PWT), version 9.0.


H.1       Map from SITC Codes to WIOD Sectors

The WIOD data allows us to compute the total value of trade between a sample of
40 countries across 25 sectors from 1995 through 2011. The sector classification in
this data set comes from aggregating underlying data classified according to the
third revision of the International Standard Industrial Classification (ISIC). The
Comtrade tariff data is classified according to the second revision of the Standard
International Trade Classification (SITC). In order to merge these data sources, we
construct a mapping that assigns SITC codes to WIOD sectors.

First, we match ISIC and SITC definitions using existing correspondences of each
standard to Harmonized System (HS) product definitions. These correspondences
come from the World Bank’s World Integrated Trade Solution (WITS).26 This merge
matches on 5,701 products out of 5,705 total HS products. We drop the four un-
matched products. This creates a HS product dataset with 764 SITC codes and 35
ISIC codes. Note that there are 925 SITC codes in the tariff data to be classified into
WIOD sectors.

Next, we map the ISIC definitions in this merge to the 25 WIOD sectors using the
relation between ISIC codes and the WIOD sectors. This leaves products in the
ISIC code 99 ("Goods not elsewhere classified") without a WIOD sector definition.

At this point, there are two issues we must address: (1) classifying SITC codes that
have products in multiple WIOD sectors; and (2) classifying the SITC codes in the
tariff data that were either matched to ISIC code 99 or were not matched to any
ISIC code. We use a most-common-sector rule and manual classification based on
SITC codes to resolve these two issues and arrive at a mapping from SITC codes to
WIOD sectors.
  26
       They are available at https://wits.worldbank.org/product_concordance.html.


                                               57
We proceed as follows. First, we determine the most common WIOD sector clas-
sification (including "unclassified") at the HS product level of each 4-digit SITC
code within the merge. We re-classify all products within an 4-digit SITC sector as
belonging to the most common WIOD sector, and break ties manually. This step
resolves issue (1) and leaves us with 764 4-digit SITC codes mapped to a unique
WIOD sector, and 161 4-digit SITC codes left unclassified.

Second, we resolve issue (2) by refining the map by using the most common clas-
sification of HS products within each 3-digit SITC code, again breaking ties man-
ually. In this step, we only use the most-common classification at the 3 digit level
to classify previously unclassified 4-digit SITC codes, filling in the map. This step
mostly resolves issue (2), leaving only 12 4-digit SITC codes unclassified. We com-
plete the map by manually classifying ten of these remaining codes, while choos-
ing to leave codes 9110 ("Postal packages not classified according to kind") and
9310 ("Special transactions, commodity not classified according to class") unclassi-
fied.


H.2     Construction of Sectoral Trade Flow and Tariff Data

With this mapping from (all but two) 4-digit SITC codes to WIOD sectors, we next
aggregate the Comtrade tariff data to the WIOD sector level. First, we compute
the average applied tariff and total value of trade within the Comtrade data by
SITC code, exporter, importer, and year. We then compute the average tariff and
total trade value by WIOD sector, exporter, importer, and year, using the value of
total trade in each SITC code and year as weights when calculating averages, and
dropping codes 9110 and 9310.

Next, we merge these data with the WIOD data. The WIOD data give us the
amount of imports by each sector and country across sectors of all other countries.
We first aggregate this input-output data to get total expenditure by each importer
across the sectors of each exporting country. This aggregation gives a balanced bi-
lateral dataset of trade flows across 25 sectors for each exporter-importer pair from
1995 to 2011. The data contains 40 countries and a rest-of-world aggregate (1,681
pairs per sector, including self trade).

We merge this data with our tariff data at the WIOD sector, exporter, importer, and
year level. The two dataset intersect from 1995 through 2007. For each year, we


                                           58
drop any observations in the tariff data that are not in the WIOD data. This elim-
inates countries without WIOD bilateral data. We set tariffs for self trade to zero.
Additionally, we have no tariff data for the rest-of-world aggregate and Romania,
and limited data for Taiwan. We drop these three entities leaving us with a sample
of bilateral trade flows and tariffs between 38 countries. Finally, we do not have
tariff data for sectors 15 through 25 (non-traded sectors), so we also drop them
from the data.

The resulting dataset has many trade zeros and missing tariff observations. To ad-
dress this potential issue, we aggregate together WIOD sectors to get the final ten
sector definitions we use in our quantitative analysis. Specifically, we combine the
"Coke, Refined Petroleum and Nuclear Fuel" and "Chemicals, Rubber, and Plastics"
WIOD sectors to form our "Fuel, Chemicals, Rubber, and Plastics" sector. Also, we
combine the "Machinery, n.e.c.," "Electrical and Optical Equipment," "Transport
Equipment," and "Manufacturing, Nec; Recycling" sectors to get our "Machinery,
Equipment, and Manufacturing n.e.c." sector. We compute the aggregate value of
trade within each of our sectors across bilateral pairs and years, and compute aver-
age tariffs for each of our sectors across bilateral pairs and years using total global
trade in each WIOD sector and year as weights.

This aggregation results in a balanced dataset of trade flows and tariffs across 10
sectors and 38 countries (1,444 exporter-importer pairs) from 1995 to 2007. The
share of trade zeros is 1.3 percent, and the share of missing tariff observations is
8.92 percent. Conditional on zero trade, the probability of tariffs being missing is
42.9 percent and conditional on a missing tariff, the probability of a trade zero is
6.3 percent. We finally merge in the CEPII data on geography and other standard
gravity covariates.



I   Additional Tables and Figures




                                          59
                     Table I.1: Estimates of the trade elasticity θ, OLS.

                                                CES           Cross-nested
                                                                    P      CES                Spatial
                                                                                              P
Dep variable                                   ln πsodt          ln o πsodt                 ln o πsodt

                                                 (1)                    (2)                      (3)
ln(1 + tsodt )                                  5.523                 0.607                    0.489
                                               (0.020)∗∗∗            (0.025)∗∗∗               (0.024)∗∗∗

x̂cnces
  sodt                                                                  X
x̂spatial
  sodt                                                                                           X
Sector-Covariate Interactions                     X                     X                        X
Sector-Origin-Year Effects                        X                     X                        X
Sector-Destination-Year Effects                   X
Destination-Year Effects                                                X                        X
Observations                                  174,201                174,201                 174,201
R-squared                                       0.82                   0.74                    0.73
F-statistic                                    759.2                 1,485.4                  427.8

Notes: Results in column (1) are from estimating (48) by OLS, assuming that ρsod = 0 so that σsod =
θ. Results in columns (2) and (3) are from estimating (49) by OLS, with x̂lsodt = ln (Psod     \  /Psd ), l =
spatial, cnces, from the first-stage gravity equation in (48). In column (2), (47) collapses to σsod = σ̄s
so that ρsod = ρs , for all o, d. Robust standard errors in parenthesis with levels of significance denoted
by *** p < 0.01, and ** p < 0.05 and * p<0.1.




                                                    60
                          Figure I.1: Elasticities of Substitution and Distance, by sector.
 30




                                                                       30




                                                                                                                                            30
 25




                                                                       25




                                                                                                                                            25
 20




                                                                       20




                                                                                                                                            20
 15




                                                                       15




                                                                                                                                            15
 10




                                                                       10




                                                                                                                                            10
 5




                                                                       5




                                                                                                                                            5
 0




                                                                       0




                                                                                                                                            0
       12.5     50          200          800          3200     12800        12.5     50          200          800          3200     12800         12.5       50          200          800          3200     12800
                Population−Weighted Distance (Kilometers)                            Population−Weighted Distance (Kilometers)                               Population−Weighted Distance (Kilometers)

              Bilateral Elasticity Estimate         95% C.I.                       Bilateral Elasticity Estimate         95% C.I.                          Bilateral Elasticity Estimate         95% C.I.




      Agriculture, hunting, forestry, and fishing                                    Mining and quarrying                                                Food, beverages, and tobacco
 30




                                                                       30




                                                                                                                                            30
                                                                                                                                            25
 25




                                                                       25




                                                                                                                                            20
 20




                                                                       20




                                                                                                                                            15
 15




                                                                       15




                                                                                                                                            10
 10




                                                                       10




                                                                                                                                            5
 5




                                                                       5




                                                                                                                                            0
 0




                                                                       0




       12.5     50          200          800          3200     12800        12.5     50          200          800          3200     12800         12.5       50          200          800          3200     12800
                Population−Weighted Distance (Kilometers)                            Population−Weighted Distance (Kilometers)                               Population−Weighted Distance (Kilometers)

              Bilateral Elasticity Estimate         95% C.I.                       Bilateral Elasticity Estimate         95% C.I.                          Bilateral Elasticity Estimate         95% C.I.




                   Textiles and leather                                      Wood and products of wood and cork                                     Pulp, paper, publishing and printing
 30




                                                                       30




                                                                                                                                            30
                                                                       25
 25




                                                                                                                                            25
                                                                       20
 20




                                                                                                                                            20
                                                                       15
 15




                                                                                                                                            15
                                                                       10
 10




                                                                                                                                            10
                                                                       5
 5




                                                                                                                                            5
                                                                       0
 0




                                                                                                                                            0




       12.5     50          200          800          3200     12800        12.5     50          200          800          3200     12800         12.5       50          200          800          3200     12800
                Population−Weighted Distance (Kilometers)                            Population−Weighted Distance (Kilometers)                               Population−Weighted Distance (Kilometers)

              Bilateral Elasticity Estimate         95% C.I.                       Bilateral Elasticity Estimate         95% C.I.                          Bilateral Elasticity Estimate         95% C.I.




         Fuel, chemicals, rubber, and plastics                                Other non-metallic mineral products                                Basic metals and fabricated metal products
 30
 25
 20
 15
 10
 5
 0




       12.5     50          200          800          3200     12800
                Population−Weighted Distance (Kilometers)

              Bilateral Elasticity Estimate         95% C.I.




 Machinery, equipment, and manufacturing n.e.c.

Notes: Results from estimating (48) by OLS.




                                                                                                          61
                                                 Share of Expenditure
                                       0   .02      .04       .06       .08   .1
                                                                                                                                                                                                                                                          Agric
                                                                                                                                                                                                                                                                 ulture
                                                                                                                                                                                                                                                                                                                            Sectoral Elasticity




                                1995
                                                                                                                                                                                                                                                                       , Hun
                                                                                                                                                                                                                                                                            ting,
                                                                                                                                                                                                                                                                                      Fore
                                                                                                                                                                                                                                                                                                                        0     5   10 15 20
                                                                                                                                                                                                                                                                                            stry a
                                                                                                                                                                                                                                                                                                    nd F
                                                                                                                                                                                                                                                                                                            ishin
                                                                                                                                                                                                                                                                                                                  g




     Notes: Data from WIOD.
                                                                                                                                                                                                                                                                                     Minin
                                                                                                                                                                                                                                                                                          g an
                                                                                                                                                                                                                                                                                                 d Qu
                                                                                                                                                                                                                                                                                                        arryin
                                                                                                                                                                                                                                                                                                                 g




                                1997
                                                                                                                                                                                                                                                                       Food
                                                                                                                                                                                                                                                                              , Bev
                                                                                                                                                                                                                                                                                     erag
                                                                                                                                                                                                                                                                                            es an
                                                                                                                                                                                                                                                                                                    d To
                                                                                                                                                                                                                                                                                                            bacc
                                                                                                                                                                                                                                                                                                                 o




                                1999
                                                                                                                                                                                                                                                                                      Texti
                                                                                                                                                                                                                                                                                           le s and
                                                                                                                                                                                                                                                                                                       Leath
                                                                                                                                                                                                                                                                                                            er
                                                                                                                                                                                                                                                             Woo
                                                                                                                                                                                                                                                                   d an
                                                                                                                                                                                                                                                                       d Pro
                                                                                                                                                                                                                                                                               ducts
                                                                                                                                                                                                                                                                                        of W
                                                                                                                                                                                                                                                                                             o  od a
                                                                                                                                                                                                                                                                                                       nd C




                              Year
                                                                                                                                                                                                                                                                                                           ork




                              2001




62
                                                                                                                                                                                                                                                                  Pulp
                                                                                                                                                                                                                                                                      , Pap
                                                                                                                                                                                                                                                                             er, P
                                                                                                                                                                                                                                                                                   rintin
                                                                                                                                                                                                                                                                                          g   and

                                                                                                                                                                                                                                            Sector
                                                                                                                                                                                                                                                                                                    Publi
                                                                                                                                                                                                                                                                                                         shing

                                                                                                                                                                                                                                                             Fuel,
                                                                                                                                                                                                                                                                      Chem




                                2003
                                                                                                                                                                                                                                                                            icals
                                                                                                                                                                                                                                                                                  , Rub
                                                                                                                                                                                                                                                                                           ber,
                                                                                                                                                                                                                                                                                                a   nd P
                                                                                                                                                                                                                                                                                                        lastic
                                                                                                                                                                                                                                                                                                                   s


                                                                                                                                                                                                                                                                            Othe
                                                                                                                                                                                                                                                                                r Non
                                                                                                                                                                                                                                                                                     −Me
                                                                                                                                                                                                                                                                                        tallic
                                                                                                                                                                                                                                                                                                       Mine




                                2005
                                                                                                                                                                                                                                                                                                                ral
                                                                                                                                                                    Notes: Results from estimating (48) by OLS assuming that σsod = σ̄s .


                                                                                                                                                                                                                                                                   Basic
                                                                                                                                                                                                                                                                           Meta
                                                                                                                                                                                                                                                                                ls   and
                                                                                                                                                                                                                                                                                           Fabri
                                                                                                                                                                                                                                                                                                 cated
                                                                                                                                                                                                                                                                                                            Meta
                                                                                                                                                                                                                                                                                                                    l
                                                                                                                                                                                                                                                     Mach
                                                                                                                                                                                                                                                         inery
                                                                                                                                                                                                                                                              , Equ
                                                                                                                                                                                                                                                                     ipme




                                2007
                                                                                                                                                                                                                                                                           nt, a
                                                                                                                                                                                                                                                                                 nd M
                                                                                                                                                                                                                                                                                     a     nufa
                                                                                                                                                                                                                                                                                               ctu   ring
                                                                                                                                                                                                                                                                                                            n.e.c
                                                                                                                                                                                                                                                                                                                   .
                                                                                                                                                                                                                                                                                                                                                  Figure I.2: Elasticity of substitution, by sector. Cross-nested CES estimation.




                                                                                   Figure I.3: U.S. imports from China in "Machinery, Equipment, & Manuf n.e.c.".
