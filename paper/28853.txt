                              NBER WORKING PAPER SERIES




                  HETEROGENEITY AND AGGREGATE FLUCTUATIONS

                                          Minsu Chang
                                         Xiaohong Chen
                                        Frank Schorfheide

                                       Working Paper 28853
                               http://www.nber.org/papers/w28853


                     NATIONAL BUREAU OF ECONOMIC RESEARCH
                              1050 Massachusetts Avenue
                                Cambridge, MA 02138
                                     May 2021




We thank Yongsung Chang, Mark Huggett, Dirk Krüger, Víctor Ríos-Rull as well as seminar
participants at various seminars and conferences for helpful suggestions. Schorfheide gratefully
acknowledges financial support from the National Science Foundation under Grant SES 1851634.
The views expressed herein are those of the authors and do not necessarily reflect the views of the
National Bureau of Economic Research.

NBER working papers are circulated for discussion and comment purposes. They have not been
peer-reviewed or been subject to the review by the NBER Board of Directors that accompanies
official NBER publications.

© 2021 by Minsu Chang, Xiaohong Chen, and Frank Schorfheide. All rights reserved. Short
sections of text, not to exceed two paragraphs, may be quoted without explicit permission
provided that full credit, including © notice, is given to the source.
Heterogeneity and Aggregate Fluctuations
Minsu Chang, Xiaohong Chen, and Frank Schorfheide
NBER Working Paper No. 28853
May 2021
JEL No. C11,C32,C52,E32

                                          ABSTRACT

We develop a state-space model with a state-transition equation that takes the form of a
functional vector autoregression and stacks macroeconomic aggregates and a cross-sectional
density. The measurement equation captures the error in estimating log densities from repeated
cross-sectional samples. The log densities and the transition kernels in the law of motion of the
states are approximated by sieves, which leads to a finite-dimensional representation in terms of
macroeconomic aggregates and sieve coefficents. We use this model to study the joint dynamics
of technology shocks, per capita GDP, employment rates, and the earnings distribution. We find
that the estimated spillovers between aggregate and distributional dynamics are generally small, a
positive technology shock tends to decrease inequality, and a shock that raises the inequality of
earnings leads to a small but not significant increase in GDP.

Minsu Chang                                      Frank Schorfheide
Georgetown University                            University of Pennsylvania
Department of Economics                          Department of Economics
37th St NW & O St NW, ICC 553                    The Ronald O. Perelman Center for
Washington, DC 20007                             Political Science and Economics
minsu.chang@georgetown.edu                       133 South 36th Street
                                                 Philadelphia, PA 19104-6297
Xiaohong Chen                                    and NBER
Department of Economics                          schorf@ssc.upenn.edu
Yale University
28 Hillhouse Avenue
P.O. Box 208268
New Haven, CT 06520-8268
xiaohong.chen@yale.edu




A data appendix is available at http://www.nber.org/data-appendix/w28853
A Replication files are available from is available at https://web.sas.upenn.edu/schorf/
                                                                                                1


1     Introduction

Models with heterogeneity on the household side or the firm side have long been used to study
distributional effects of macroeconomic policies. Heterogeneity evolves dynamically and in
some of these models interacts closely with aggregate fluctuations. This is particularly true
in models with financing constraints that try to capture the large downturn during the recent
Great Recession. While the macroeconomics literature has demonstrated that dynamics in
heterogeneous agent (HA) models can be different from their representative agent (RA)
counterparts, it is an open question whether in the data there is strong evidence that the
dynamics of macroeconomic aggregates interacts, at business cycle frequencies, with the
evolution of the cross-sectional distribution of income and wealth on the household side and
the distribution of productivity and capital on the firm side.

    This paper develops and applies econometric tools that can provide semi-structural evi-
dence about the interaction of aggregate and distributional dynamics. More specifically, we
specify a state-space model with a state-transition equation that takes the form of a linear
functional vector autoregression (fVAR) and stacks macroeconomic aggregates and a cross-
sectional distribution. The cross-sectional distribution is represented as a log probability
density function. This has the advantage that its law of motion is not constrained by non-
negativity or monotonicity restrictions and hence can be linear. We specify measurement
equations for macroeconomic aggregates as well as cross-sectional observations, treating the
underlying densities as unobserved. The measurement equation for the cross-sectional ob-
servations is nonlinear because it needs to exponentiate the log density and normalize it such
that it integrates one.

    To make the functional analysis tractable and easy to implement, we approximate the log-
densities of the cross-sectional distributions as well as the transition kernels in the functional
autoregressive law of motion of the states by finite-dimensional sieves with fixed basis func-
tions and time-varying coefficients that capture the dynamics. This conveniently turns the
state-transition equation into a joint vector-autoregressive law of motion for the aggregate
variables and the time-varying coefficients of the sieve approximations. To avoid nonlinear
filtering, we effectively linearize the measurement equation for the cross-sectional observa-
tion. This approximation enables us to estimate the model in two steps. First, we estimate
the coefficients of the density approximation for each time period based on the sample of
cross-sectional observations. The approximation allows us to treat the coefficients estimates
as noisy measures of their population counterparts. The measurement errors capture the
                                                                                              2


estimation uncertainty associated with the sieve coefficients. In the second step, we estimate
a linear state-space model using Bayesian techniques.

   As mentioned before, our procedure is able to account for estimation errors in the cross-
sectional densities and can also be used with small cross-sectional sample sizes. Our im-
plementation uses spline basis functions to approximate log densities, which dates back to
Kooperberg and Stone (1990). We allow for seasonal adjustments of the cross-sectional
densities if they are combined with seasonally-adjusted aggregate data. Moreover, we show
how to adjust the measurement equation for top-coding of the cross-sectional observations.
Prior distributions are used to regularize a potentially high-dimensional estimation problem.
Finally, in order to determine the number of basis functions K for the sieve approximation
in a data-driven way, we utilize our Bayesian framework to derive a marginal data density
(MDD) approximation for the aggregate and cross-sectional data, akin to the widely-used
Schwarz criterion. Moreover, we use the MDD approximation for model selection, but it
could also be used for model averaging. We use the MDD not only to determine K , but also
to determine the prior precision (and hence the degree of shrinkage) for the coefficients of the
vector-autoregressive state-transition equation; see, for instance, Del Negro and Schorfheide
(2004) and Giannone, Lenza, and Primiceri (2015).

   We apply our econometric framework to simulated and actual data. In the simulation
experiment, we generate data from a version of the Krusell and Smith (1998), henceforth KS,
model, which we solve using the method proposed by Winberry (2018). Households' decisions
in the KS model depend on the aggregate technology shock and the cross-sectional distribu-
tion of skills and wealth. In turn, the entirety of the household-level decisions determine the
cross-sectional distribution, which leads to a joint law of motion of aggregate variables and
cross-sectional distribution. We show that estimates of our functional state-space model can
reproduce the evolution of the distribution of asset holdings and the response of the cross-
sectional distribution to a technology shock. Our MDD model selection criterion chooses a
low-dimensional sieve approximation that trades off model fit and complexity and shrinks
the coefficients that control the effect of the lagged cross-sectional distribution on current
technology to zero, capturing the fact that technology is indeed exogenous in the underlying
KS economy.

   In the empirical application we fit our model to aggregate total factor productivity (TFP)
growth, GDP growth, employment, and cross-sectional data on labor earnings. The latter
are scaled by the labor share of GDP. The empirical model is able to capture the time
path of the cross-sectional densities. Based on the degree of shrinkage selected with the
                                                                                               3


MDD criterion, there is strong evidence that aggregate dynamics do not Granger-cause
cross-sectional dynamics and vice versa. Our estimated covariance matrix of the fVAR
innovations is, however, not block diagonal, and we are able to detect small but in many
cases statistically significant effects of TFP shocks on the cross-sectional density of earnings.
Most notably, the mass of individuals that earn less than GDP per capita rises in response
to a TFP shock. From the response of the densities, we can also compute the response of
percentiles and inequality measures. Here we find that earnings at the 10th percentile rise,
whereas earnings at the 90th percentile fall. Thus, the expansion reduces inequality, which
is also reflected in the response of the Gini coefficient. Overall, however, the effect is small.

   We also consider the effect of a distributional shock that is constructed to increase in-
equality in the short run. This shock is associated with a slight increase in the employment
rate and GDP, generating a positive correlation between inequality and aggregate economic
activity. As a robustness exercise, we consider two simplified vector autoregressions (VARs)
that combine the aggregate variables with a set of percentiles or with measures of inequality.1
While these simplified VARs deliver qualitatively similar IRFs as the functional model, the
responses are less precisely estimated and often feature odd long-run dynamics. A key prob-
lem with VARs that use quantiles of cross-sectional distributions is that nothing prevents
the quantiles from crossing in a simulation or an impulse response function, which is clearly
undesirable. The functional model, on the other hand, is coherent and parsimonious in the
sense that any distributional statistic can be derived from it.

   The structure of the transition equation in our functional state-space model resembles
that of HA models solved with linearization techniques. This solution method was initially
proposed by Reiter (2009) and has been further developed in several papers, including Kaplan
and Violante (2018), Childers (2018), and Winberry (2018). The basic idea is to first solve
for the stationary solution of the HA model with only idiosyncratic uncertainty, using a
global solution technique. In a second step, one computes a first-order perturbation of the
solution with respect to the aggregate shocks. This leads to a vector autoregressive law
of motion that includes the time-varying coefficients associated with the basis functions
that are used to approximate cross-sectional distributions in the first step. This solution
technique is convenient for the likelihood-based estimation of HA models as in Mongey and
Williams (2017), Acharya, Chen, Del Negro, Dogra, Matlin, and Sarfati (2019), Liu and
Plagborg-Møller (2019), Bayer, Born, and Luetticke (2020), Cho (2020).


   1
       An example of this approach is Coibion, Gorodnichenko, Kueng, and Silvia (2017).
                                                                                                          4


    In general, our econometric framework allows researchers to examine the following type
of quantitative questions in a semi-structural framework that does not require the solution,
calibration, or estimation of an HA model: First, does micro-level heterogeneity affect the
propagation of aggregate shocks to aggregate variables?2 Second, what is the effect of an
aggregate shock on cross-sectional distributions? Third, what is the effect of a change in the
cross-sectional distribution on macroeconomic aggregates?

    The aforementioned questions are front and center in the quantitative macroeconomics
literature. In order to address the first question, researchers often compare implications,
such as impulse response functions, correlations, or forecasts from models with and without
micro-level heterogeneity that share an otherwise identical identification structure. Recent
examples include Ahn, Kaplan, Moll, Winberry, and Wolf (2018), Kaplan and Violante
(2018), Ottonello and Winberry (2020), Acharya, Chen, Del Negro, Dogra, Matlin, and
Sarfati (2019), Bayer, Born, and Luetticke (2020), Cho (2020), and Villalvazo (2021). Het-
erogeneity often leads to amplification of shocks and additional persistence; see also Krueger,
Mitman, and Perri (2016). A key challenge is to find a parameterization for the HA and RA
model that allows a meaningful comparison. In our setting we can easily make comparisons
between the functional state-space model and VARs that only include aggregate variables.

    The second question, i.e., the effect of aggregate shocks on cross-sectional distributions is
also frequently studied in the context of HA models. For instance, the paper by Ahn, Kaplan,
Moll, Winberry, and Wolf (2018) studies the effect of factor-specific productivity shocks on
inequality dynamics, whereas Kaplan and Violante (2018) examine the distributional effects
of monetary policy shocks. Bayer, Born, and Luetticke (2020) use their estimated HA model
to construct a historical decomposition of an inequality measure with respect to a collection
of aggregate shocks. Bhandari, Evans, Golosov, and Sargent (2021) report responses of
the dispersion of assets to a TFP shock in a HANK model under optimal monetary-fiscal
policy. Mongey and Williams (2017) analyze the effect of macro shocks on the dispersion
of sales growth. Finally, examples of research examining the third question are papers by
Huggett (1997) and Auclert and Rognlie (2020). The former considers a one-sector growth
model with idiosyncratic shocks and shows that a redistribution of asset holdings among
households while keeping the overall capital stock fixed at its steady state level, triggers a

   2
       From the perspective of a linearized HA model, heterogeneity could affect the steady state (mean) and
the elasticities (slope coefficients). That is something our framework is unable to detect. However, we can
measure potential indirect effects: an aggregate shock may shift the cross-sectional distribution, which in
turn triggers movements in the aggregate variables in subsequent periods.
                                                                                              5


response of the aggregate variables. Auclert and Rognlie (2020) show that a rise in inequality
may lower aggregate output if monetary policy does not react to it.

   There is an extensive literature on the statistical analysis of functional data. General
treatments are provided in the books by Bosq (2000), Ramsey and Silverman (2005), and
Horvath and Kokoszka (2012). Much of the literature assumes that the functions are observed
without error. Our state-transition equation embodies the widely studied functional autore-
gressive model (see Bosq (2000) for a detailed analysis), but also includes a finite-dimensional
vector of states. Functional autoregressive models can be estimated by functional principal
component analysis, which approximates the functions by linear combinations of the eigen-
functions of the sample covariance operator associated with the K largest eigenvalues. Rather
than using what the literature considers to be an optimal (in a least squares sense) empirical
orthonormal basis, we use a spline basis that is chosen independently of the data in our
analysis.

   Applications of functional data analysis in macroeconometrics are growing steadily. Many
of them are related to the yield curve. The state-space model Diebold and Li (2006) could be
interpreted as a functional model for yield-curve data, but there is no infinite-dimensional
aspect to the analysis in the sense that it is assumed (and empirically justified) that the
yield-curves can be represented by three time-varying parameters. Inoue and Rossi (2020)
estimate what they call a VAR with functional shocks, which uses a similar representation
of the yield curve as in Diebold and Li (2006) and focuses on the identification of functional
monetary policy shocks. Meeks and Monti (2019) use functional principal component re-
gression to estimate a New Keynesian Phillips curve in which the distribution of inflation
expectations appears on the right-hand side. Hu and Park (2017) develop an estimation
theory for a functional autoregressive model with unit roots and fit it to yield curve data
and Chang, Kim, and Park (2016) use a functional time series process to capture the evolu-
tion of earnings densities with a focus on unit-root components. Both papers use functional
principal components analysis.

   The remainder of this paper is organized as follows. In Section 2 we present our functional
state-space model for a group of macroeconomic time series and a sequence of cross-sectional
distributions. We develop an approximate filter for the state-space model that facilitates the
likelihood-based estimation. We use Bayesian inference and derive an approximation to
the marginal data density that is used for dimensionality and hyperparameter selection.
Implementation details such as the choice of basis functions, the handling of top coding
and seasonal adjustments, the choice of prior distributions, and the posterior sampler are
                                                                                                      6


discussed in Section 3. Section 4 contains the results from the simulation experiment in which
we estimate the functional state-space model based on data generated from the KS economy.
The empirical application is presented in Section 5 and Section 6 concludes. Supplemental
derivations, and additional computational details and empirical results are relegated to the
Online Appendix.



2     A Functional State Space Model

VARs can be viewed as approximations to the equilibrium dynamics arising from linearized
RA models and have proved to be useful for the evaluation and development of dynamic
stochastic general equilibrium (DSGE) models. Moreover, VARs are widely used in empiri-
cal macroeconomics independently of DSGE models, to study business cycle fluctuations, the
propagation of shocks, and to generate macroeconomic forecasts. In this paper, we develop
a fVAR that is embedded in a state space model and can play a similar role as traditional
VARs in environments in which macroeconomic aggregates interact with cross-sectional dis-
tributions. While we will not establish a formal link between our functional model and the
solution of HA models, it does capture the salient features and provides a natural reference
model for the evaluation of HA models. Moreover, just as VARs, our functional model can
be used as a stand-alone tool for empirical work in macroeconomics.
    The variables in the functional model comprise an ny × 1 vector of macroeconomic aggre-
gates Yt and a cross-sectional density pt (x). In our empirical application Yt consists of (log)
TFP growth, per-capita GDP growth, and the log employment rate. The cross-sectional
variable x is earnings as a fraction of per-capita GDP. Throughout this paper, we will work
with log densities defined as   t (x)   = ln pt (x). We decompose Yt and        t   into a deterministic
component Y ,  (x) and fluctuations around the deterministic component. Let
                                           ~t ,
                                  Yt = Y + Y         t   =      + ~t .                               (1)

For notational convenience we assumed that the deterministic component is time-invariant
and could be interpreted as a steady state. This assumption could be easily relaxed by letting
(Y ,  ) depend on t. We assume that the deviations from the deterministic component
 Yt , t (x) evolve jointly according to the following linear fVAR law of motion:

                      ~t = Byy Y
                      Y        ~t-1 +               x) ~t-1 (~
                                               Byl (~        x)dx
                                                                ~ + uy,t                             (2)

                    ~t (x) = Bly (x)Y
                                    ~t-1 +                ~) ~t-1 (~
                                                  Bll (x, x        x)dx
                                                                      ~ + ul,t (x).
                                                                                                   7


Here uy,t is mean-zero random vector with covariance yy and ul,t (x) is a random element
in a Hilbert space with covariance function ll (x, x
                                                   ~). We denote the covariance function for
uy,t and ul,t (x) by yl (x).
     To condense the notation, we define integral operators with kernels Byl (~
                                                                              x) and Bll (x, x
                                                                                             ~)
as
                  Byl [g ] =     Byl (~
                                      x)g (~
                                           x)dx
                                              ~,   Bll [g ](x) =     Bll (x, x
                                                                             ~)g (~
                                                                                  x)dx
                                                                                     ~.

Using the operator notation, we can write (2) more compactly as

                                        ~t-1 + Byl [ ~t-1 ] + uy,t
                               ~t = Byy Y
                               Y                                                                  (3)
                          ~t (x) = Bly (x)Y
                                          ~t-1 + Bll [ ~t-1 ](x) + ul,t (x).

For now, (3) should be interpreted as a reduced-form fVAR in which uy,t and ul,t (x) are one-
step-ahead forecast errors. We could easily add more lags, but our simulation experiment
and the empirical analysis will be based on a single lag. The system will subsequently serve
as the state-transition equation in a functional state-space model.
     Section 2.1 describes the sampling from the functional state-space model. Rather than
focusing on an infinite-dimensional model in which the densities and operators are treated
nonparametrically, we consider a collection of finite-dimensional models, presented in Sec-
tion 2.2, in which log densities and kernels associated with integral operators are represented
through finite-dimensional sieves. Section 2.3 develops an approximate linear filter for the
finite-dimensional functional state-space models and in Section 2.4 we present a large-sample
approximation of the marginal data density that can be used to select the degree of the sieve-
approximation in a data-driven manner.


2.1     Sampling and Measurement

We assume that in every period t = 1, . . . , T an econometrician observes the macroeconomic
aggregates Yt as well as a sample of Nt draws xit , i = 1, . . . , Nt from the cross-sectional
density pt (x). In practice, Nt is likely to vary from period to period, but for the subsequent
exposition it will be more convenient to assume that Nt = N for all t. We collect the time t
cross-sectional observations in the vector Xt = [x1t , . . . , xN t ] . We also assume that the draws
xit are independently and identically distributed (iid) over the cross-section and independent
over time. The measurement equation for the cross-section observations takes the form
                                       exp{ t (x)}
              xit  iid pt (x) =                      ,    i = 1, . . . , N,   t = 1, . . . , T.   (4)
                                       exp{ t (x)}dx
                                                                                                                 8


The assumption of xit being iid across i and t is consistent with data sets that comprise
repeated cross sections.3 It is also approximately consistent with panel data sets if the unit
index i is randomly re-assigned in every period t. Thus, to the extent that the cross-sectional
densities pt (x) are estimated from a panel data set, there is some potential loss of information
in our functional modeling approach. However, on the positive side, the functional modeling
approach does not require the econometrician to make assumptions about the evolution of
xit at the level of an individual, a household, or a firm.


2.2        A Collection of Finite-Dimensional Models

Equations (1), (3) and (4) define a state-space model for the observables {Yt , Xt }T
                                                                                    t=1 . The
log density      t (·)   is the state variable. To implement the estimation of the functional model
we use a collection of finite-dimensional representations, indexed by a superscript (K ). Let
                                                                          
                             K
                                                                     1 ,t
               (K )
                                                                    . 
                    ( x ) =     k,t k (x) = 1 (x), . . . , K (x) ·  . 
               t                                                    .  =  (x)t             (5)
                            k=1
                                                                    K,t
and
                                               (K )
                                                (x)    =  (x) .
To simplify the notation a bit, we did not use (K ) superscripts for the vectors  (x), t , and
 . Here 1 (x), 2 (x), . . . is a sequence of basis functions. We define ~ t = t -  such that
            ( K )     ( K )
~(K ) (x) = t (x) -  (x). For theoretical considerations it is convenient to demean the
vector of basis functions and assume that               (x)dx = 0. For applications this normalization
is not important.
    To construct the measurement equation of the cross-sectional observations in (4), we
define the K -dimensional vector of sufficient statistics
                                                           N
                                           ¯(Xt ) = 1
                                                                 (xit ).
                                                    N     i=1

This allows us to write a K 'th order representation of the density of Xt :

                             p(K ) (Xt |t ) = exp N L(K ) (t |Xt ) ,                                           (6)

                             L(K ) (t |Xt ) = ¯ (Xt )t - ln         exp { (x)t } dx.

    3
        If the data exhibit spatial correlation, then our estimation approach below essentially replaces the
likelihood function for x1t , . . . , xN t by a composite likelihood function that ignores the spatial correlation;
see Varin, Reid, and Firth (2011).
                                                                                                    9


   We represent the kernels Bll (x, x
                                    ~) and Byl (~
                                                x), the function Bly (x), and the functional
innovation ul,t (x) that appear in the state-transition equation (3) as follows:

                         (K )                                    (K )
                       Bll (x, x
                               ~) =  (x)Bll  (~
                                              x),            Byl (x) = Byl  (~
                                                                             x)                    (7)
                            (K )                          (K )
                         Bly (x) =  (x) Bly ,            ul,t (x) =  (x)u,t ,

where  (x) is a second K × 1 vector of basis functions and u,t is a K × 1 vector of innovations.
The matrix Bll is of dimension K × K , Byl is of dimension ny × K , and Bly is of dimension
               (K )             (K )                                                       (K )
K × ny . Let Byl [·] and Bll [·](x) be the operators associated with the kernels Byl (x) and
 (K )
Bll (x, x
        ~). Then we can write (3) as

                                    ~t-1 + B (K ) [ ~(
                           ~t = Byy Y
                           Y
                                                       K)     (K )
                                                     t-1 ] + uy,t                                  (8)
                                            yl
                      ~( K)     (K )  ~       (K ) ~(K )       (K )
                       t (x) = Bly (x)Yt-1 + Bll [ t-1 ](x) + ul,t (x).


Combining (1), (5), (7), and (8) yields the following vector autoregressive system for the
macroeconomic aggregates and the sieve coefficients (omitting K superscripts):

                      Yt - Y               Byy Byl C        Yt-1 - Y            uy,t
                                       =                                +              ,           (9)
                      t -                  Bly   Bll C     t-1 -                u,t

where C =        (~
                  x) (~  ~. Let ut = [uy,t , u,t ]. We will subsequently assume that the
                      x)dx
innovations are Gaussian:
                                                 ut  N (0, ).                                     (10)


2.3     Approximate Filtering

The K -dimensional approximation of the functional model has a state-space representation
with state vector t , measurement equation (6), and state-transition equation (9). Due
to the measurement equation for Xt , the state-space representation is nonlinear and the
computation of the exact likelihood requires a nonlinear filter. To avoid the use of a nonlin-
ear filter in the empirical application, we will conduct approximations justified by large-N
approximations of Bayesian posteriors and marginal likelihoods.

   We collect the parameters ( , Y , B, ) in the vector . Here the matrix B comprises
Byy , Byl , Bly , and Bll . Although the dimension of  depends on the degree of approximation
K , we omit the (K ) superscript. Let Y1:t denote the sequence Y1 , . . . , Yt . Starting from a
                                                                                                           10


distribution p(K ) (t-1 |Y1:t-1 , X1:t-1 , ), for each period t the filter computes:

 p(K ) (Yt , t |Y1:t-1 , X1:t-1 , ) =        p(K ) (Yt , t |Yt-1 , t-1 , )p(K ) (t-1 |Y1:t-1 , X1:t-1 , )dt-1

 p(K ) (Yt , Xt |Y1:t-1 , X1:t-1 , ) =       p(K ) (Xt |t )p(K ) (Yt , t |Y1:t-1 , X1:t-1 , )dt          (11)

          p(K ) (t |Y1:t , X1:t , )  p(K ) (Xt |t )p(K ) (Yt , t |Y1:t-1 , X1:t-1 , ).

The first equation in display (11) iterates the state-transition equation (9) forward and
integrates over the hidden state t-1 . The second equation generates a forecast of the
observables (Yt , Xt ) using the measurement equation (6). The third equation updates the
density of the hidden state t using Bayes Theorem (here  denotes proportionality). Note
that the density p(K ) (Xt |t ) defined in (6) does not depend on .
   The state-transition density p(K ) (Yt , t |Yt-1 , t-1 , ) is Normal under the assumption
that the shock vector ut is normally distributed. We will now approximate p(K ) (Xt |t ) by
conducting a second-order Taylor series expansion of L(t |Xt ) in (6) around the maximum
likelihood estimator (MLE)

                                         ^ t = argmaxt L(K ) (t |Xt ).
                                                                                                         (12)
    ^t be the negative inverse Hessian associated with L(t |Xt ) evaluated at 
Let V                                                                         ^ t . Then, we
can write
                                           N           ^t-1 (t - 
            p(K ) (Xt |t ) = exp N L(K ) (^
                                          t |Xt ) -
                                             (t -  ^t) V         ^t) + N R ,     (13)
                                           2
where R is the remainder term from the second-order Taylor series approximation. Ab-
stracting from the remainder, the expression on the right-hand side of (13) is proportional
to a measurement equation density from a model that treats the MLE ^ t (Xt ) of the density
coefficients as observables and uses the measurement equation

                               ^ t (Xt ) = t + N -1/2 t ,
                                                                        ^t ).
                                                               t  N (0, V                                (14)

in conjunction with the VAR in (9). By replacing (6) by (14) we obtain a linear Gaussian
state-space model and the likelihood function can be evaluated with the Kalman filter.
   To summarize, our large-N approximation of the filtering problem leads to a convenient
two-step procedure. In the first step, the researcher computes the sequence of MLEs ^ t from
the cross-sectional observations Xt , separately for each period t = 1, . . . , T . In the second
step, the researcher estimates a linear state-space model in which the ^ t s are interpreted
as noisy measures of the latent t s. Because the measurement error variance vanishes at
rate N -1 , for large cross-sectional sample sizes, the estimation of a state-space model can be
replaced by the estimation of a VAR in which the latent t s are replaced by their MLEs.
                                                                                                               11


2.4     Bayesian Model Selection Criterion

In order to be able to determine the sieve order K in a data-driven way, we will now derive
a large-N approximation to the Bayesian marginal data density (MDD) which for a sample
of time dimension T is defined as
                                                 T
                (K )
            p          (Y1:T , X1:T |) =               p(K ) (Yt , Xt |Y1:t-1 , X1:t-1 , ) p(|)d,             (15)
                                                 t=1

where  is a vector of hyperparameters that control the variance of the prior distribution. We
will proceed by deriving a convenient representation for p(K ) (Yt , Xt |Y1:t-1 , X1:t-1 , ), which
was defined in the second equation of display (11):

        p(K ) (Yt , Xt |Y1:t-1 , X1:t-1 , ) =          p(K ) (Xt |t )p(K ) (Yt , t |Y1:t-1 , X1:t-1 , )dt .

The density p(K ) (Xt |t ) can be viewed as a likelihood function for t and p(Yt , t |·) character-
izes the prior distribution for t . Note from the expansion in (13) that the likelihood function
concentrates around ^ t as N - . Using standard Bayesian asymptotic arguments, we
obtain the Laplace approximation
                                                                                           1/2
            p(K ) (Yt , Xt |Y1:t-1 , X1:t-1 , )  exp N L(K ) (^       ^t /N
                                                              t |Xt ) V                                       (16)
                                                         ×(2 )K/2 p(K ) (Yt , ^ t |Y1:t-1 , X1:t-1 , ).

The first term on the right-hand-side is the maximized likelihood function from the cross-
sectional density estimation. The second term is the familiar penalty for model complexity
which is asymptotically dominated by N -K/2 and the last term can be interpreted as the
prior density for t evaluated at ^t.
   We now turn to p(K ) (Yt , ^ t |Y1:t-1 , X1:t-1 , ) which is defined in the first equation of display
(11). Standard Bayesian large-N asymptotics imply that
                                                         approx         ^t-1 /N .
                             t-1 |(Y1:t-1 , X1:t-1 , )      N   ^ t-1 , V                                     (17)

By combining (17) with (9) and integrating out t-1 , we can deduce that p(K ) (Yt , ^ t |Y1:t-1 , X1:t-1 , )
is the density associated with the VAR

                          Yt - Y           Byy Byl C              Yt-1 - Y             u
                                                                                       ~y,t
                                     =                                           +               ,            (18)
                          ^ t - 
                                           Bly    Bll C          ^ t-1 - 
                                                                                       u
                                                                                       ~,t
where
            u
            ~y,t                                                 ^t-1 C B Byl C V
                                                           Byl C V                ^t-1 C B
                         N 0, ~ ,      ~ =+ 1
                                                                         yl               ll
                                                                                                          .
            u
            ~,t                             N                    ^                ^
                                                           Bll C Vt-1 C Byl Bll C Vt-1 C Bll
                                                                                                              12


Thus, replacing the latent t by the MLE ^ t added a 1/N term to the innovation covariance
matrix, which we will ignore subsequently.4 We deduce that we can write

                          p(K ) (Yt , ^ t |Y1:t-1 , X1:t-1 , )  p(K ) (Yt , ^ t |Yt-1 , t-1 = ^ t-1 , )      (19)

    The approximation of the MDD can be completed as follows. Substituting (19) into the
right-hand side of (16) and plugging the resulting expression into the marginal data density
formula (15) leads to
                                                             T
                                                                                                  1/2
            p   (K )
                       (Y1:T , X1:T |)  (2 )       KT /2
                                                                   exp N L(K ) (^       ^t /N
                                                                                t |Xt ) V                    (20)
                                                             t=1
                                                       T
                                             ×              p(K ) (Yt , ^ t |Yt-1 , t-1 = ^ t-1 , ) p(|)d.
                                                      t=1

The MDD formula has two parts that can be evaluated independently. The expression in the
first line of (20) can be viewed as a Bayesian information criterion for selecting the number
of basis functions in the estimation of cross-sectional densities. An increase in the number
                                               t |Xt ) but is penalized through the O(N -K/2 )
of terms K improves the goodness-of-fit L(K ) (^
determinant. The expression in the second line on the right-hand-side of the equation is
the MDD associated with the VAR in (9) where the latent t s are replaced by the MLEs
^ t . There exists a large literature on how to evaluate VAR MDDs either analytically or
numerically for a variety of specifications and we will provide further details below. In
Sections 4 and 5 we not only use the MDD to determine K , but also to determine the
hyperparameter  jointly with K .



3        Implementation Details

We now provide some of the implementation details. The choice of basis functions is de-
scribed in Section 3.1 and some preliminary transformations of the estimated basis function
coefficients is discussed in Section 3.2. Section 3.3 provides details on the specification of the
measurement equation for the basis function coefficients and the state-transition equation of
the empirical state-space model. Priors and the computation of posteriors for the parameters
of the state-space model are discussed in Section 3.4 and Section 3.5 explains how forecasts
and impulse response functions for the basis function coefficients can be converted back into
cross-sectional densities.
    4
        We consider applications in which the cross-sectional dimension N is much larger than the time series
dimension T .
                                                                                               13


3.1    Basis Functions

A convenient basis for the log density is a spline which is a piecewise polynomial function
with knots xk , k = 1, . . . , K - 1. There is a large literature on log-spline density estimation
dating back to Kooperberg and Stone (1990). A typical choice is to consider a cubic spline
that is restricted to be linear and upward sloping on the interval (-, x1 ) and linear and
downward sloping on the interval [xK -1 , ). Thus, the estimated density has the tails of a
Laplace density, which are a bit thicker than Gaussian tails.

   In our two application we restrict x to the interval [0, x
                                                            ¯]. For the estimation based on
simulated data in Section 4 we also use a cubic function for the last segment of the spline:

                        1 (x) = x                                                            (21)
                                                          3
                        k (x) =     max{x - xk-1 , 0} ,        k = 2, . . . , K.

We exclude the constant function 0 (x) = 1 because it is redundant in light of the normaliza-
tion imposed in the definition of LK (t |Xt ) in (6). For the empirical application in Section 5
we construct the spline from x = x
                                 ¯ to x = 0, rather than from x = 0 to x = x
                                                                           ¯, using a linear
element for the right tail

                      K (x) = max {x
                                   ¯ - x, 0}                                                 (22)
                                                      3
                      k (x) =     max {xk-1 - x, 0} ,         k = K - 1, . . . , 1.

For both applications we compared three spline specifications for a given K: (21), (22), and
the aforementioned linear-cubic-linear specification. For the simulated data (21) is preferred
because the right tail of the simulated asset distributions is very thin. For the actual data
it is desirable that the right-most segment of the spline is linear because under the cubic
specification the density was increasing between the top coded value (see below) and the
upper bound x
            ¯ in some periods. Near zero, on the other hand, the cubic segment was more
successful approximating the density than the linear segment.


3.2    Sieve Coefficients

The first step in the estimation of the functional model is the computation of the MLEs
^ t for t = 1, . . . , T . We discuss three adjustments that may be required to implement the
empirical analysis.
                                                                                                           14


Top Coding. In our empirical application the cross-sectional observations are top-coded.
Because we standardize cross-sectional earnings by GDP per-capita which grows in real
terms over time, the top-coded earnings value, which we take to be the maximum in every
given time period t generally, falls over time until the statistical agency resets the maximum
income level.
                                                                                        N
   We define the censoring point ct = maxi=1,...,N xit and let Nt,max =                 i=1   I{xit = ct }. If
Nt,max = 1 we assume that the observed sample is not constrained by the top-coding and
use the standard likelihood function described above. We introduce the unknown parameter
t = P{xit  ct } and drop the top-coded observations from the definition of ¯(Xt ) by letting

                                                   N
                                    ¯(Xt ) = 1
                                                         (xit )I{xit < ct }.
                                             Nt   i=1

The log-likelihood function (divided by Nt , see (6)) under top coding is given by

                                        Nt,max        Nt - Nt,max
                L(K ) (t , t |Xt ) =           ln t +             ln(1 - t )                             (23)
                                         Nt               Nt
                                                                      ct
                                        +¯ (Xt )t - Nt - Nt,max ln       exp  (x)t .
                                                         Nt         0

The first line captures the likelihood of sampling top-coded observations and the second line
represents the continuous density of the observations that are not top coded. Notice that
log-likelihood function can be independently maximized with respect to t and t , where
^t = Nt,max /Nt . The modified definition of L(K ) (t , 
                                                                                                ^t .
                                                        ^t |Xt ) requires a slight rescaling of V
Further details are provided in the Online Appendix.

   In our application, the top-coded values exceed the largest knot in every period t, i.e.,
x
¯t > xK -1 for all t, which means that all spline coefficients remain identifiable. If, on the
other hand, the top-coded value is less than xK -1 in some period t, then some elements of
the t vector are not identifiable from the cross-sectional information. These elements can be
treated as missing values in the estimation of the linear state-space representation described
in Section 3.4 below and will be implicitly imputed by the VAR law of motion (9).5

Compression. The vector ^
                        ~t = ^ t -  may exhibit collinearity. Even though K basis
functions may be necessary to approximate the cross-sectional densities, the time variation
might be concentrated in a lower-dimensional space, because, for instance, only the means
   5
       There is a large literature on handling missing values in state-space models. Textbook treatments are
available in Harvey (1989) and Durbin and Koopman (2001). An application to the estimation of mixed-
frequency VARs is provided in Schorfheide and Song (2015).
                                                                                                         15


of the cross-sectional distributions are varying over time. This feature can be captured by
assuming that the time-variation is captured by a K  ~ < K dimensional factor at :

                                            (t -  ) = at ,                                             (24)

where  is a K  ~ × K matrix. As is well known from the factor model literature,  and at
                            ~ ×K
are only identified up to a K  ~ dimensional invertible matrix. In principle, the matrix 
and the sequence of vectors at , t = 1, . . . , T have to be estimated simultaneously under this
factor structure,

    To avoid the simultaneous estimation of the cross-sectional densities, we take the following
short cut. First, we compute the ^ t s period-by-period without imposing any restrictions.
Second, conditional on  we compute the demeaned (and potentially seasonally adjusted)
MLEs  ^
      ~t = ^ t -  and arrange them in a T × K matrix ^
                                                     ~ with rows ^
                                                                 ~ t . Third, we conduct a
principal components analysis which is based on the eigenvalue decomposition of the sample
covariance matrix ^
                  ~            ^ be K × K
                    ^ /T . Let M
                    ~                                                                   ~
                                           ~ matrix of eigenvectors associated with the K
non-zero eigenvalues (in practice greater than 10-10 ). Then, let

                                      a
                                      ^=^
                                        ~M^,         ^ = (^
                                                          aa^)-1 a
                                                                 ^ ^
                                                                   ~,                                  (25)

                   ~ matrix with rows a
      ^ is the T × K
where a                               ^t .

    We can now replace (13) by6

                      ^ = exp N L(K ) ( + ^a         N           ^V
                                                                  ^t-1 ^ (at - a
   p(K ) (Xt |at ,  , )                    ^t |Xt ) - (at - a
                                                            ^t )               ^t ) + N R .
                                                     2
                                                                                   ~
To evaluate the MDD formula in (20), we replace (2 )KT /2 by (2 )KT /2 , L(K ) (^ t |Xt ) by
 (K )
L ( +     ^a                                               ^t /N | to |(
            ^t |Xt ), and we change the penalty term from |V      1 / 2 ^V
                                                                         ^t 
                                                                           - 1 ^ ) 1 /N |1/2 .
                                                                                  -


Seasonal Adjustments. In our empirical application xit is based on quarterly earnings
data from the Current Population Survey (CPS). Unlike the macroeconomic variables stacked
in Yt , the quarterly earnings data are not seasonally adjusted. Deterministic seasonal ad-
justments of the cross-sectional densities can be incorporated in the model by replacing the
vector of constants  = t - ~ t by a time-varying process. In our application the time
                                             4
period t is a quarter. We let ,t =           q =1   q,t sq (t), where sq (t) = 1 if period t is associated
with quarter q and sq (t) = 0 otherwise.

   6
     Because our goal is to eliminate perfect collinearities, we choose an eigenvalue cut-off that yields  +
^
a ^t = ^ t in Sections 4 and 5.
                                                                                                16


3.3     State-Space Representation

After subtracting  (or ,t in case of the seasonal adjustment) and compressing the t
coefficients, we can express the state-space representation in terms of the lower-dimensional
vectors at and a
               ^t . The measurement equation (14) is replaced by

                         ^t = at + N -1/2 t ,
                         a                      t  N 0, (^V
                                                          ^ -1 ^ )-1 .                        (26)
                                                            t


The state transition is essentially given by (9) but we need to adjust it for the compression
of the t vector. Moreover, we now absorb the matrix C into the matrices of regression
coefficients:
                      Yt - Y            yy ya         Yt-1 - Y         uy,t
                                   =                              +           .               (27)
                         at             ay aa           at-1           ua,t
We assume that the innovations are normally distributed and write the state transition more
compactly as
                                 Wt = 1 Wt-1 + ut ,   ut  N (0, ),                            (28)

where Wt = [(Yt - Y ) , at ] .


3.4     Priors and Posteriors
                                                                            ^t , t = 1, . . . , T ,
The estimation of the state-space model is done conditional on the sequence V
and the compression matrix . ^ Moreover, in our implementation we also condition on esti-
                                       ^ and a
mates of the deterministic components, Y     ^ . Thus, the remaining unknown coefficients
are concentrated in the state-transition equation (28), which takes the form of a multivariate
linear Gaussian regression model. The state transition can be expressed in matrix form as

                                           W = Z  + U,                                        (29)

where W , Z , and U have rows Wt , Wt-1 , and ut , respectively and for a VAR(1) without
intercept  = 1 . Defining  = vec() we use a prior distribution of the form

                                IW (, S ),      |  N µ , P - 1
                                                            () ,                              (30)

where IW (·) is the Inverse-Wishart distribution with  degrees of freedom and scale matrix
S.
                                                                                                  17


   The prior precision matrix P  () is a function of a vector of hyperparameters  =
[1 , 2 , 3 ] and takes the form
                                                                                          
                                    ^y
                                    D      0                           ^y
                                                                     3 D           0
                      (-1 )yy                          (-1 )ya                  
            
            
                                  0         ^a
                                          2 D                           0         ^a
                                                                                2 D
                                                                                          
                                                                                          
  P  () = 1                                                                               .     (31)
                                   ^y
                                 3 D          0                           ^y
                                                                        3 D       0       
                     -1                                      -1
                  ( )ay                                   ( )aa 
                                                                                          
                                   0            ^a
                                              2 D                           0     ^a
                                                                                  D

                                                                                     ^ y and
The partitions of -1 conform with the partition Wt = [(Yt - Y ) , at ]. The matrices D
^ a are diagonal matrices of dimension ny × ny and K
D                                                  ~ ×K~ that are used to rescale the prior
variances based on the variability of the regressors. For instance, one can set the jj element
   ^ y equal to a (pre-)sample variance 
of D                                     ^ 2 (Yjt ). This scaling is common for Minnesota-type
VAR priors.

   The hyperparameter 1 controls the overall precision of the prior distribution; 2 scales
the relative precision of the prior distribution for the coefficients that control the effect of
at-1 on Yt ; likewise, 3 scales the relative precision of the prior distribution for the coefficients
that control the effect of Yt-1 on at . Unlike the more commonly used matrix-Normal Inverse-
Wishart prior that mimics the Kronecker structure of the likelihood function, the prior in
(30) allows us to control the degree of spillovers from distributional dynamics to the aggregate
dynamics and vice versa. If the prior mean µ is zero, then as 2 , 3 - , the posterior
distributions of ay and ya concentrate around zero, which shuts down spillover effects.

   Conditional on , it is straightforward to sample from the posterior distribution of (, )
using a Gibbs sampler following the approach in Carter and Kohn (1994) that iterates over
the blocks:
                     |(, W1:T , ),                               ~1:T , a
                                         |(, W1:T , ) a1:T |(, , Y      ^1:T ).                 (32)
                                            ~1:t , a1:T ] and note that conditional on a1:T the
Here it is important to recall that W1:T = [Y
MLEs a^1:T do not contain any information about (, ). The Online Appendix describes
                                                                           ~1:T , a
how to sample from |(, W1:T , ) and |(, W1:T , ). Sampling from a1:T |(, , Y      ^1:T ) is
implemented by a standard forward filtering and backward simulation approach that utilizes
the Kalman filter in the forward iteration and the simulation smoother for the backward
simulation. The Online Appendix also discusses how the second part of the MDD formula ­
the one associated with the VAR in (29), see the second line on the right-hand side of (20)
­ can be evaluated using a combination of the Rao-Blackwellization approach in Fuentes-
Albero and Melosi (2013) and Geweke (1999)'s modified harmonic mean estimator.
                                                                                                           18


3.5     Recovering Cross-Sectional Densities

Based on the estimated state-transition equation (27) we can generate forecasts and im-
pulse response functions for the compressed coefficients at . However, the dynamics of these
coefficients in itself are not particularly interesting. Thus, we have to convert them back
into densities using the following steps (which can be executed for each draw of at from the
relevant posterior distribution). First, use (24) with  =  ^ to transform at into t . If the
estimation is based on a seasonal adjustment,  can be replaced by ,t , or, if the goal is to
compute impulse responses, one could use the average of the seasonal dummies as intercept.
Second, compute
                                                       exp  (x)t
                                p(K ) (x|t ) =                      .
                                                       exp  (~
                                                             x)t dx
                                                                  ~


4      A Simulation Experiment

To examine our functional state-space model's ability to capture the joint dynamics of ag-
gregate variables and a cross-sectional distribution, we first estimate it based on artificial
data simulated from a Krusell and Smith (1998) economy. The model economy and its ap-
proximate solution is described in Section 4.1. The estimation results are summarized in
Section 4.2.


4.1     Model Economy and Data Generating Process

The model economy consists of a continuum of households j  [0, 1]. Household j chooses
consumption and asset holdings to maximize
                                                 
                                                           c1-
                                                             -1
                                                          t jt
                                         E0            
                                                 t=0
                                                           1-

subject to the budget constraint

               xjt+1 + cjt = (1 -  )Wt   jt   + bWt (1 -     jt )   + xjt (1 + Rt ),   xjt+1  x.          (33)

Here   jt    {0, 1} is an exogenous two-state Markov process that determines the efficiency
units of labor supplied by the household j in period t. Households with                       jt   = 1 receive
after-tax labor income (1 -  )Wt and households with                  jt   = 0 receive unemployment benefits
bWt . The total labor supply L =         jt dj   is fixed over time. We assume that the government
                                                                                                            19


balances its budget constraint in each period by setting  = b(1 - L)/L. The asset xjt is
a claim on the aggregate capital stock and generates a risky return Rt and households face
the borrowing constraint xjt+1  x.

   The representative firm produces output Yt according to the production function

                 Yt = exp{zt }Kt L1- ,            zt = z zt-1 + z t ,        t  N (0, 1),

where zt is an exogenous aggregate productivity shock that follows an AR(1) law of motion,
and Kt is the aggregate capital stock. Factor prices are given by

               Rt =  exp{zt }Kt-1 L1- - ,                  Wt = (1 - ) exp{zt }Kt L- ,                  (34)

where  is the depreciation rate of capital. In equilibrium, the net supply of assets equals
the capital stock: Kt =          xjt dj .

   The aggregate state of the economy is St = (zt , µt ), where µt is the distribution of
households over (   jt , xjt )   pairs. Because   jt   takes only two values, it is convenient to use µt,
to denote the conditional distribution of assets given the employment status t . To simulate
data from the model economy, we construct an approximate solution in which the density
associated with µt, can be written as a mixture of a discrete and continuous part:

                                  qt, (x) = mt, x (x) + (1 - mt, )pt, (x).                              (35)

Here, mt, is the mass of individuals for whom the borrowing constraint x is binding. x (x)
is the Dirac function with the property that x (x) = 0 for x = x and                     x (x)dx = 1. This
function captures the mass of households for which the borrowing constraint is binding. The
continuous part of the asset distribution is represented by the (proper) density pt, (x).

   Following Winberry (2018) we represent the density pt, (x) as follows:
                                                              3
         pt, (x) = exp t, ,0 + t, ,1 (x - mt, ,1 ) +               t, ,k (x - mt, ,1 )k - mt, ,k   .    (36)
                                                             k=2

Here the mt, ,k s are the time-varying centralized moments of the distribution. The t, ,k s are
a set of time-varying coefficients that can be determined from the moments by solving the
system of equations

   mt, ,1 =    xpt, (x)dx;         mt, ,k =   (x - mt, ,1 )k pt, (x)dx, k = 2, 3;          pt, (x)dx = 1.
                                                                                                          20


     The desired consumption of household j in absence of the borrowing constraint is given
by
                                                              -         -1/
                                       cjt =  Et [(1 + Rt+1 )cjt+1 ]          .

According to (33) the return Rt+1 depends on the capital stock Kt+1 , which in turn depends
on the cross-sectional distribution of assets:

                Kt+1 =           P{ = h} x · mt+1, =h + (1 - mt+1, =h )             xpt+1, =h (x)dx .
                         h=0,1

Actual consumption may be lower than desired consumption of the borrowing constraint is
binding. Asset holdings in period t + 1 can be determined from the budget constraint (33).
Doing this for each household j determines the t + 1 distribution of asset holdings. Thus,
the model generates a joint autoregressive law of motion for

                                     t = zt , mt, =0 , mt, =1 , mt, =0 , mt, =1 ,                       (37)

where mt, = [mt, ,1 , mt, ,2 , mt, ,3 ] represents pt, (x).
     We use the method of Winberry (2018) to solve the KS economy. The method involves
two steps. First, we construct a nonlinear solution for the version of the model without aggre-
gate uncertainty. To do so, we replace the unknown decision rule for (transformed) desired
consumption (-1/ ) ln cjt with a Chebychev polynomial and integrals through quadrature
approximations. This leads to a rational expectations system in t , (Kt , Rt , Wt ), the Cheby-
chev polynomial coefficients, the quadrature approximation points of the asset distribution,
and the density evaluated at these points.7 The system is then linearized around the steady
state and solved with a standard solver for linearized rational expectations (LRE) systems.
The solution to the LRE system can be written as a VAR in t , defined in (37), and a set
of equations that relate the remaining variables to the state vector t . To generate data, we
simulate the law of motion for t for 2,000 periods and draw iid cross-sectional observations
from (35), where pt, (x) is defined in (36).
     We calibrate the KS economy to loosely match features of annual U.S. data. The pa-
rameterization is summarized in Table 1. The left panel of Figure 1 depicts the time series
of the aggregate capital stock from t = 1 to t = 200. The capital stock peaks in period
t = 27 and reaches a trough in period t = 150. The densities of asset holdings (normalized
to one) for the unemployed and employed households are plotted in the center panel and
the right panel of the figure. We condition on x > x = 0 and plot pt, (x) given in (36). The
     7
         For the subsequent simulations we use 25 quadrature nodes and a Chebychev polynomial of order three.
                                                                                                                    21


                              Table 1: Calibration of Krusell-Smith Economy

         Parameter                         Value          Parameter                                         Value
              Discount factor                .93          b                    Unempl. benefits               .15
              Utility curvature                   1       (   0       1)       Unempl. to Empl.               .5
         x    Borrowing constraint                0       (   1       0)       Empl. to Unempl.             .038
              Capital share                  .36          z                    TFP Persistence              .859
              Capital depreciation           .10          z                    TFP Innovation StdDev        .028

Notes: Annual parameterization


                                    Figure 1: Features of Simulated Data

             Capital Stock                            Asset Distribution                       Asset Distribution
              Time Series                               Unemployed                                 Employed
    4                                     0.035                                         0.04
                                                                           period 27
                                           0.03                            period 150

   3.5                                                                                  0.03
                                          0.025

                                           0.02
    3                                                                                   0.02
                                          0.015

                                           0.01
   2.5                                                                                  0.01
                                          0.005

    2                                        0                                            0
             50   100   150   200   250       0           2       4        6               0       2    4      6




Notes: Aggregate capital attains its maximum in period t = 27 and its minimum in period t = 150. Each
density is normalized so that it integrates to one.


densities illustrate that employed households hold more assets than unemployed households
and that in a boom period (high capital stock due to favorable technology shocks) the asset
distribution shifts to the right.


4.2          Functional Model Estimation

We now estimate the functional model based on the simulated time series and cross-sectional
data. Because according to the calibration in Table 1 the employment rate is 93%, we focus
on the asset distribution of the employed households and omit information about the assets
of the unemployed from the estimation. Because due to precautionary savings behavior the
mass of employed individuals with zero assets is essentially zero and does not vary over time,
the aggregate variable in our estimation is simply log productivity zt and we provide the
                                                                                                                                         22


                                                   Table 2: Knot Placement


                                                                  Percentiles
 K     0.01   0.025   0.05   0.1   0.15 0.2   0.25   0.3   0.35   0.4   0.45    0.5   0.55   0.6   0.65   0.7   0.75   0.8   0.85 0.9   0.95
 4                                             X                                X                                X
 6                           X                 X                                X                                X                 X
 8                     X     X                 X                                X                                X                 X     X
 10     X      X       X     X                 X                                X                                X                 X     X
 14     X      X       X     X      X          X            X                   X                   X            X            X    X     X
 22     X      X       X     X      X    X     X     X      X     X      X      X      X     X      X     X      X     X      X    X     X


Notes: Percentiles refer to distribution of pooled observations (across i = 1, . . . , N and t = 1, . . . , T ) for
N =10,000 and T =2,000.


econometrician with iid draws from the cross-sectional distribution xit  pt, =1 (x), where
pt, =1 (x) was defined in (36).

      The empirical model differs from the data generating process (DGP) in the following
dimensions. First, strictly speaking, the DGP takes the form of a first-order autoregressive
process only if the asset distribution of the unemployed is also included in the vector of
endogenous variables. Second, the representation of the densities in the DGP are based on
polynomial basis functions whereas the density in the empirical model is based on cubic
splines. Third, the DGP is based on a VAR that includes the moments mt, ,k whereas
the empirical model is based on a VAR that includes the spline coefficient vector at . The
relationship between the mt, ,k s and the polynomial basis function coefficients t, ,k in the
DGP is nonlinear. Overall, for a sufficiently large K , we expect the empirical model to
deliver a good approximation to the DGP, but for any given K it does not nest the DGP.

      The first step in the analysis is the determination of the approximation order K , and the
hyperparameter  based on the MDD approximation. We use the spline basis in (21) and
place the knots at pre-determined percentiles of the empirical distribution of the simulated
xit s, pooled across a large simulation with Nsim = 10, 000 and Tsim = 2, 000. Table 2
summarizes the knot locations as a function of K . For K = 4, we use the 25th , 50th , and
75th percentiles. As K increases, we add lower and upper percentiles. Moving from K = 8
to K = 10, we only add percentiles in the left tail of the distribution, because this part of
the distribution is most affected by business cycle variations.

      For the subsequent estimation we fix the time series dimension at T = 250 and consider
three choices of N : 1,000, 5,000, and 10,000. Conditional on N we evaluate the approximate
                                                                                                                     23


                                Figure 2: Normalized Log Marginal Data Density

    0                                       0                                    0

                                           -20                                   -5
  -100
                                                                                -10
                                           -40
  -200                                                                          -15
                                           -60
  -300                                                                          -20
                                           -80
                                                                                -25
  -400
                                          -100                                  -30

  -500                                    -120                                  -35
         -6   -4   -2   0   2     4   6          -6   -4   -2   0   2   4   6         -6   -4   -2   0   2   4   6

                   ln 1                                    ln 2                                 ln 3

Notes: Based on N=10,000, T=250, and K=10. The log MDD peaks at      ^ 1 = exp(0.22) = 1.25, ^ 2 = exp(6) =
            ^
403.43, and 3 = exp(0.22) = 1.25. Each panel shows a one-dimensional cut of the log MDD surface fixing
the other two  values at the argmax. The x-axis is on a log scale. We normalize the maximum value of the
log MDD to zero.


marginal data density p(K ) (Y1:T , X1:T |) in (20) over a grid of K and  values.8 For each
element of the  vector, we consider 10 equally-spaced values of ln j between -5 and 6. For
each K we maximize the MDD with respect to  to obtain       ^ (K, N ). Figure 2 shows three
cuts of the log MDD as a function of . The figure is based on K = 10 and N = 10, 000.
In the left panel we vary 1 and keep 2 and 3 fixed at    ^ 2 and ^ 3 , respectively. In the
remaining panels we vary the other two  elements. The maximum of the log MDD function
is normalized to zero. The log MDD is quite sensitive to 1 and the maximum with respect
to 2 is attained at the boundary of the grid.

    In Table 3 we report ^ (K, N ) for various choices of K and the cross-sectional sample size
N . The table also contains the values of the log MDD at   ^ (K, N ). Rather than reporting raw
log MDD values, in each column we report log differentials with respect to    ^ (K = 4). Several
important results emerge. First, as N increases from 1,000 to 5,000 or 10,000 the selected
dimension of the spline approximation increases from 6 to 10 because the improvement in
the fit of the cross-sectional densities outweighs the dimensionality penalty. Because for any
fixed K the log-spline density specification does not nest the true cross-sectional density,
there is no "true" K in this simulation design.

    Second, the hyperparameter 1 controls the overall precision (inverse variance) of the
prior distribution for the vector autoregressive coefficients . The ^ 1 (K ) are weakly increas-

   8                                                                                            ~1:T , a
       For each (K, ) combination we generate 5,500 draws from the posterior distribution (, )|(Y      ^1:T )
using a Gibbs sampler. After discarding the first 500 draws we use a modified harmonic mean estimator to
                                              ~1:T , a
construct a numerical approximation of p(K ) (Y      ^1:T |). Details are provided in the Appendix.
                                                                                                                                                   24


               Table 3: Hyperparameter Estimates and Log MDD Differentials for T = 250

                                         N=1,000                                     N=5,000                                 N=10,000
     K                       ^1
                                      ^2
                                           ^ 3 MDD
                                                                       ^1         ^2   ^ 3 MDD                    ^1
                                                                                                                            ^2
                                                                                                                                ^3
                                                                                                                                      MDD
         4               1.2      403        5.3         0             0.3       403       5.3              0    0.1      403   5.3        0
         6               1.2      403    5.3       1,374               0.3       403       5.3       7,300       0.3      403   5.3   14,978
         8               5.3      403        1.2       978             1.2       403       1.2       8,137       0.3      403   5.3   16,853
     10                  5.3      403        1.2       915             1.2       403       1.2       8,187      1.2       403   1.2   17,039
     14                  5.3      403        1.2       795             5.3       403       0.3       7,908       5.3      403   0.1   16,740

Notes: For each K we maximized the MDD with respect to 1 , 2 , and 3 . The table reports ^ estimates
for each (K, N ) pair. The log MDD differentials are computed with respect to K = 4.


                         Figure 3: Cross-sectional Fit (N = 10, 000, T = 250, K = 10 Selected)
   0.5                                                       0.5                                                0.5
             histogram
             K=4
   0.4       K=6                                             0.4                                                0.4
             K=10
             truth
   0.3                                                       0.3                                                0.3


   0.2                                                       0.2                                                0.2


   0.1                                                       0.1                                                0.1


    0                                                         0                                                  0
         0               2        4      6         8               0         2         4         6      8             0     2    4     6       8

                 Period t = 27                                          Period t = 95                                     Period t = 150

Notes: Each panel overlays: a histogram of the empirical asset distribution of the employed, the log-spline
density estimates for various K , and the true density from which the asset values were sampled.


ing in K , indicating that as the dimension of the vector Wt = [(Yt - Y ) , at ] increases more
shrinkage toward the prior mean is desirable. Third, for every (K, N ) combination     ^ 2 = 403
which is the maximum value of the  grid. Recall that 2 scales the relative precision of the
prior distribution for the coefficients that control the effect of the cross-sectional density rep-
resented by at-1 on the aggregate variable Yt . A value of    ^ 2 = 403 implies that the resulting
estimate of the spill-over effect is essentially zero. The estimate ^ 3 is substantially smaller
than ^ 2 . Thus, we deduce that based on the estimated model aggregate dynamics spill into
distributional dynamics, but not vice versa. This is consistent with the KS model economy
in which technology is exogenous, but productivity fluctuations affect the asset distribution.

    In Figure 3 we compare the fit of the estimated cross-sectional densities (various K ) for
                                                                                                                     25


                Figure 4: Impulse Responses to a 3-Standard-Deviation Technology Shock

             Density Differential                   Density Differential           Fraction of Individuals
                     h=5                                    h = 15                     With Assets > 4
                                                                                 0.1
  0.06                                   0.06
                                                                                0.08
  0.04                                   0.04

  0.02                                   0.02                                   0.06

     0                                     0
                                                                                0.04
  -0.02                                 -0.02
                                                                                0.02
  -0.04                                 -0.04

  -0.06                                 -0.06                                     0

         0       2     4     6      8           0       2      4     6     8           10   20   30   40   50   60



              Asset holding x                        Asset holding x                   Time horizon h

Notes: Impulse responses are generated from the estimated state-space representation. Results are based on
T = 250, N = 10, 000, K = 10, and  ^ (K ) (see Table 3). "True" response from the KS model appears in red,
responses from the estimated functional state-space model are in blue (pointwise median is solid, 5th and
95th percentiles are dotted).


N = 10, 000
                           p(K ) (x|                t - ln
                                    ^ t ) = exp  (x)^                          x)^
                                                                         exp  (~ t dx
                                                                                    ~                           (38)

to the "true" cross-sectional density and a histogram of the cross-sectional observations. The
three panels correspond to different time periods. Recall from Figure 1 that the capital stock
peaks in period 27 and reaches a trough in period t = 150. The fit of the estimated densities
varies over time as the shape of the "true" density changes. For K = 4 and K = 6 there is
some mismatch in the left tail in periods t = 27 and t = 150. The fit generally improves as
K increases and for the selected K = 10 we essentially have a perfect fit.

     We proceed by estimating the state-space representation for K = 10 and  = ^ (10) on
the N = 10, 000 sample using the Gibbs sampler described in Section 3.4.9 Figure 4 shows
impulse responses to a 3-standard-deviation technology shock. We compute "true" responses
from the approximate solution of the KS economy and estimated responses from the state-
space representation given by (26) and (27). Because the technology process is exogenous in
the KS economy, its innovation can be easily identified using a Cholesky factorization of .
For each (, ) we generate an impulse response function for at by iterating (27) forward.
Once we have the impulse response sequence {at+h }H                               K
                                                  h=1 we reconstruct the density p (x|t+h )
by reversing the compression step in Section 2.2 to transform {at+h }H              H
                                                                     h=1 into {t+h }h=1 and


    9
        We generate 11,000 draws from the posterior and drop the first 1,000.
                                                                                                           26


plugging the coefficients into (38).

     The "shocked" density is compared to the steady state density that is obtained by using
the  coefficients. The left and center panels of Figure 4 show the difference between the
shocked and the steady state densities at horizons h = 5 and h = 15, respectively.10 We
refer to this difference as the response of the density. In the right panel of Figure 4, we
show the response of the fraction of individuals with assets greater than 4 as a function of
h. This fraction is computed from the density response. To capture parameter uncertainty,
we execute the calculations for each draw (, ) from the posterior distribution and plot (in
blue) the posterior median responses and bands that represent pointwise 5 and 95 percentiles.
The "true" responses from the KS model are plotted in red.

     According to the KS model, a positive technology shock increases asset holdings and shifts
the asset distribution to the right. In the left and center panels of the figure this is reflected
in the increase of the density for x-values above 3.3 and a drop for asset holdings below
3.3. Moreover, it can be seen in the right panel, that the fraction of individuals with asset
holdings greater than 4 increases by roughly six percentage points (0.06). The estimated
responses capture the "true" dynamics well. The posterior median density response decays
slightly slower than the "true" response, but, accounting for parameter uncertainty, the
bands that delimit pointwise 90% credible bands cover the "true" response. To summarize,
the estimated functional state-space model is successful in capturing the joint dynamics of
the cross-sectional asset distribution and the technology shock.



5         Empirical Analysis

The empirical analysis focuses on the joint dynamics on total factor productivity, real per-
capita GDP, and employment at the aggregate level, and the cross-sectional distribution
of earnings at the micro level. Estimation results for the functional state-space model are
presented in Section 5.1. In Section 5.2 we report impulse responses of aggregate variables,
the cross-sectional distribution, and inequality measures derived from the cross-sectional
distribution to aggregate shocks. Two robustness exercises are conducted in Sections 5.3
and 5.4. Finally, in Section 5.5 we examine the response to a distributional shock that raises
inequality.


    10
         Timing convention: the system is in steady state in period h = 1 and the shock occurs at h = 2.
                                                                                                      27


                                   Figure 5: Earnings and GDP

              Log Earnings and GDP                                Log Earnings/GDP




Notes: Left panel: average log earnings (blue, solid) and log per capita GDP (red, dashed). Right panel:
average log earnings-to-GDP ratio (blue, solid) and demeaned log labor share (red, dashed) of the nonfarm
business sector. In both panels per-capita GDP is scaled by 2/3 to account for the labor share.


5.1       Data and Model Estimation

Data. We use three macroeconomic aggregates in our empirical analysis: total factor pro-
ductivity (TFP), real per-capita GDP, and the employment rate. In addition, we use cross-
sectional data on earnings. Real per-capita GDP (A939RX0Q048SBEA) is provided by the
Federal Reserve Bank of St. Louis' FRED database and the TFP series (dtfp) is obtained
from Fernald (2012). Weekly earnings (PRERNWA) are obtained from the monthly Current
Population Survey (CPS) through the website of the National Bureau of Economic Research
(NBER). Weekly earnings are scaled to annual earnings by multiplying with 52. Based
on the CPS variable PREXPLF "Experienced Labor Force Employment" we construct an
employment indicator which is one if the individual is employed and zero otherwise. This
indicator is used to compute the aggregate employment rate.

    In the left panel of Figure 5 we plot average log nominal earnings computed from the
cross-sectional data and log nominal per-capita GDP. We scale per-capita GDP by a factor
of 2/3 to account for the labor share.11 After this re-scaling the mean of log earnings and log

  11
       Nominal per-capita GDP is obtained by multiplying real per-capita GDP by the GDP deflator
                                                                                                         28


per-capita GDP have approximately the same level. However, the mean log earnings grow
more slowly than per-capita GDP. In the right panel of the Figure we plot the average log
earnings-to-GDP ratio (here per-capita GDP is again scaled by 2/3) and the demeaned log
labor share of the nonfarm business sector (obtained from the Bureau of Labor Statistics).
The drop in the log earnings-to-GDP ratio is of the same order of magnitude as the fall in
the labor share over the sample period.

    In the remainder of this paper we simply standardize individual-level earnings by (2/3)
of nominal per-capita GDP. Rather than taking a logarithmic transformation of the earnings
data, we apply the inverse hyperbolic sine transformation, which is given by

                    ln(z + (2 z 2 + 1)1/2 )   sinh-1 (z )                      Earnings
    x = g (z |) =                           =             ,      z=                           .         (39)
                                                                       (2/3) · per-capita GDP

The function is plotted in the Online Appendix. We set  = 1. For small values of z the
function is approximately equal to z and for large values of z it is equal to ln(z ) + ln(2). This
transformation avoids the thorny issue of applying a log transformation to earnings that are
close to zero. Below we will refer to x as transformed data and to z as original data.

Density Estimation. We take the time period t to be a quarter. For each t we estimate a
cross-sectional density for the transformed earnings-to-GDP ratio; see (39). As in the simu-
lation study in Section 4, we consider different approximation orders K . We use the spline
basis in (22) and place the knots at pre-determined percentiles of the empirical distribution
of the xit s pooled across i and t; see Table 2.

    In the top row of Figure 6 we show three types of density estimates for the transformed
earnings in 2000:Q1 and 2010:Q1: log spline estimates for K = 10 and K = 22, and
histograms. While the K = 10 density estimates are smooth, the K = 22 estimates capture
the jaggedness of the histograms. The spike in the right tail visible in the histograms captures
the top coding. It is more pronounced in 2010:Q1 because incomes rise over time and more
households reach the top income level (until the top values gets reset by the statistical
agency). By construction, the log-spline density estimates extrapolate the top-coded income
values.

    In the bottom row of the figure we overlay the sample percentiles of the earnings/GDP
distribution and percentiles computed from the log spline density estimates p(K ) (x|^ t ) for
K = 10 and K = 22. The earnings/GDP distribution has a pointmass at zero, representing

(GDPDEF from FRED). The factor 2/3 is a rule-of-thumb number that happens to align the levels in
the left panel. The average labor share of the nonfarm business sector over the sample period is 0.6.
                                                                                                                  29


            Figure 6: Fitted Densities and Percentiles of Earnings/GDP Distribution

            2000:Q1, Transformed Data                             2010:Q1, Transformed Data
        1                                                    1
                                            histogram                                             histogram
                                            K=10                                                  K=10
      0.8                                   K=22            0.8                                   K=22


      0.6                                                   0.6


      0.4                                                   0.4


      0.2                                                   0.2


        0                                                    0
            0    0.5   1      1.5    2      2.5         3         0    0.5   1      1.5    2      2.5         3


                K = 10, Original Data                                 K = 22, Original Data
        3                                                    3

      2.5                                                   2.5

        2                                                    2

      1.5                                                   1.5

        1                                                    1

      0.5                                                   0.5

        0                                                    0
        1990    1995   2000   2005   2010      2015          1990     1995   2000   2005   2010      2015



Notes: Top row: fitted cross-sectional densities and histograms. Bottom row: sample percentiles (10%, 20%,
50%, 80%, and 90%) are blue, percentiles from estimated densities are red.


the unemployed individuals, and a continuous part, representing individuals with non-zero
earnings. We normalize the estimated density p(K ) (x|^ t ) so that it integrates to the fraction
of employed individuals in the sample and apply the change-of-variable formula to convert
the density for transformed earnings x = g (z |) into actual earnings z ; see (39) and the
Appendix for further details.

    Overall, the estimated cross-sectional densities are able to reproduce the time path of
the empirical percentiles well, except for some small inaccuracies in the 90th percentile
toward the end of the sample. The estimated percentiles for the two specifications are
virtually indistinguishable, despite the difference in the density plots in the top panels.
                                                                                              30


Median earnings (relative to the approximate labor share of per-capita GDP) fall steadily
from above one in 1990 to below one in 2017. A similar pattern is observed for the 80%
percentile. During the Great Recession, there is a noticeable drop of earnings at the 10%
and 20% percentile, followed by a slow and steady rise from 2010 to 2017. Earnings at the
80% and 90% percentiles rise during the Great Recession relative to their 2005 levels.

Functional State-Space Model Estimation. The log-spline density estimation yields a
                                   (K )
sequence of coefficient vectors {^ t }. We then apply the seasonality adjustment and the
                                                    (K )
compression described in Section 3.2 to obtain {a
                                                ^t }. The vector Yt of aggregate variables
is composed of TFP growth, real per-capita GDP growth, and the (un)employment rate
from the CPS data. We set Y equal to the mean of these series. After computing growth
rates for TFP and GDP our sample ranges from 1989:Q2 to 2017:Q3. We consider 1990:Q1
as period t = 1 and use 1989:Q4 to initialize the lag in the first-order vector autoregressive
law of motion. The estimation of the functional state-space model is based on the prior
distribution in (30) and (31). We set  = nw + 5, where nw is the dimension of the vector Wt
                                                   ^ where 
in the state-transition equation (28), and let  =  ,         ^ is the OLS estimator of  in
(28) that is obtained when the latent at in the definition of Wt is replaced by the estimate
a
^t . The prior for  is centered at µ = 0.

Hyperparameter Selection and Granger Causality. We proceed by evaluating the
(approximate) log MDD as a function of the model dimension K  {4, 6, 8, 10, 14, 22} and
the hyperparameter vector . For each element of the  vector we consider ten equally-
spaced values of ln j on the interval [-5, 6]. Recall that the hyperparameter 1 controls
the overall precision of the prior distribution. The remaining two hyperparameters control
the relative precision of the prior for the submatrices ya (2 ) and ay (3 ).

    Results are summarized in Table 4. For each value of K we report the optimal   ^ (columns
2-4) and the log MDD differentials for K (^ ) relative to K = 4 (column 5). With respect to K ,
the log MDD is maximized for the largest value considered, K = 22. That is consistent with
the visual impression from Figure 6. The additional knots are used to capture the jagged
pattern of the histograms and the improvement in fit still outweighs the dimensionality
penalty induced by the MDD.

   The overall degree of selected shrinkage captured by ^ 1 (K ) is weakly increasing in the
dimensionality K . Moreover, there is generally stronger shrinkage of the off-diagonal blocks
to zero. The optimal values ^ 2 (K ) and ^ 3 (K ) are either 95 or 403, indicating the absence of
                                                                                                    31


               Table 4: Hyperparameter Estimates and Log MDD Differentials

                                       Optimal                    Alternative 
                     K       ^1
                                    ^2   ^3    MDD          1     2    3    MDD
                     4       1.2    95   403         0      1.2    1   1         -38
                     6       1.2    95   403     8,697      1.2    1   1    8,651
                     8       1.2   403   403     9,594      1.2    1   1    9,527
                     10      5.3   403    95     9,707      5.3    1   1    9,634
                     14      5.3    95 403      10,177      5.3    1   1   10,089
                     22     5.3    403    95   13,667       5.3    1   1   13,559

Notes: The log MDD differentials are computed with respect to (K = 4,  = ^ ). For each K we maximized
                                     ^
the MDD with respect to  to obtain (K ). We also report log MDD differentials for a set of alternative 
values.


strong Granger-causal relationships between the aggregate variables and the cross-sectional
income distribution.

   The last column reports log MDD differentials obtained by setting 1 = ^ 1 and 2 =
3 = 1, meaning that the degree of shrinkage is identical for the coefficients in the diagonal
blocks (yy , aa ) and the off-diagonal blocks (ya , ay ). The differentials are also computed
relative to (K = 4,  = ^ ). This configuration allows for greater spillovers between aggregate
and cross-sectional dynamics. Holding K fixed, relaxing the shrinkage for the off-diagonal
blocks leads to a deterioration of the log MDD between 38 (K = 4) and 108 (K = 22).
Thus, the larger the dimensionality of the approximation of the cross-sectional density, the
stronger the empirical case for shrinking the spillover coefficients to zero to balance the
trade-off between in-sample fit and model complexity.

   The mechanical application of the MDD criterion suggests to proceed with K = 22.
However, we are concerned that the jagged pattern of the histograms that the K = 22
(and higher) specification is approximating ­ see Figure 6 ­ is more an artifact of the data
collection (e.g., survey respondents rounding their earnings) than a genuine feature of the
earnings distribution. Moreover, because the earnings are standardized by the continuously
evolving GDP per capita, in terms of x-coordinates, the spikes shift from period to period,
inducing spurious dynamics. Thus, in the remainder of this section we first present results for
K = 10, which delivers smooth estimates of the cross-sectional densities. We then proceed
in Section 5.3 with comparing K = 10 to K = 22 results. While the impulse responses of
the cross-sectional densities computed based on K = 22 inherit the saw-tooth pattern visible
                                                                                                            32


in the density estimates, the responses for percentiles and inequality statistics derived from
the density responses are indeed very similar for K = 10 and K = 22.


5.2    Effects of Aggregate Shocks

Identification. In the vector Yt we order TFP growth first, GDP growth second, and
the employment rate third. Let tr be the lower-triangular Cholesky factor of  such that
 = tr tr and let  be an orthonormal matrix. The relationship between the reduced-form
innovations ut and the structural innovations      t   is given by:

                                        ut = tr  t .                                                   (40)

It is well known that  is not identifiable from the data. Denote the j th column of 
by ·j . We label the first structural shock as technology shock and assume that it is the
only shock that affects measured TFP contemporaneously. Thus, ·1 = 1 , where j is an
ny × 1 vector whose j th element is one and all other elements are zero. Moreover, we let
·j = j for j = 2, 3. We refer to shocks    1,t ,   2,t ,   and   3,t   as aggregate shocks because they
do not affect the cross-sectional distribution contemporaneously. The shocks              2,t   and   3,t   do
not have a strict economic interpretation. We refer to them as shocks to GDP growth and
the employment rate. Much of the subsequent discussion will focus on the propagation of
technology shocks.
Response of Aggregate Variables. Impulse response bands (delimited by the 10th and
90th percentile of the posterior distribution) computed conditional on the posterior mean
estimates of the state-space representation for K = 10 are plotted in Figure 7. Because
the distributional responses are generally small, we scale the IRFs by a factor of three and
consider three-standard-deviation shocks throughout this section. We compare responses
based on 2 =   ^ 2 , 3 = ^ 3 against responses obtained by estimating the state-space model
with 2 = 3 = 1. Recall that under the estimated hyperparameters, we are essentially
shrinking the off-diagonal blocks ay and ya to zero. By setting 2 and 3 equal to one, we
are allowing for more flexibility.
   First, the TFP growth shock raises the level of TFP permanently. GDP also rises per-
manently and employment shows a positive response (real business cycle instead of New
Keynesian dynamics). Allowing for more flexibility by setting 2 = 3 = 1 does not change
the IRF bands, except that they become slightly wider. Second, the GDP growth shock
raises GDP permanently, creates a temporary employment boom and a drop in measured
                                                                                                        33


                 Figure 7: Responses of Aggregate Variables to Aggregate Shocks

                  TFP Shock                      GDP Shock                       Empl. Shock
            3                              1                              1.5

                                                                            1
            2                              0
   TFP




                                                                          0.5
            1                              -1
                                                                            0

            0                              -2                             -0.5
                  10   20   30    40             10    20   30    40             10    20    30    40

            3                                                               1
                                           4
                                                                          0.5
            2                              3
   GDP




                                           2                                0
            1
                                           1                              -0.5

            0                              0                               -1
                  10   20   30    40             10    20   30    40             10    20    30    40

                                          1.5                               0
           0.6
   Empl.




                                           1                              -0.5
           0.4

           0.2                            0.5                              -1

            0                              0                              -1.5
                  10   20   30    40             10    20   30    40             10    20    30    40


Notes: IRFs for three-standard deviation aggregate shocks (orthogonalized via Cholesky factorization; see
(40)). Panels depict responses of the log level of TFP and GDP, scaled by 100, and responses of the
employment rate in percent. The bands correspond to pointwise 10th and 90th percentiles of the posterior
distribution for K = 10. Solid blue responses are based on ^ 2 = 403 and ^ 3 = 95; dashed red responses are
based on 2 = 3 = 1.


total factor productivity in the long run. While the 10th percentiles of the responses look
very similar across hyperparameter settings, the 90th percentiles are shifted upward for
2 = 3 = 1, in particular for the medium-run and long-run response of GDP to its own
shock. Finally, the third shock leads to a drop in the employment rate and it raises TFP
and GDP with a one-period delay. While the effect on employment is very similar across the
two hyperparameter configurations, the TFP and GDP bands widen and shift downward as
the shrinkage of the off-diagonal blocks is reduced.

    To summarize, the most noticeable effect of the change in hyperparameters is the widen-
ing of the IRF bands, i.e., the decrease of the prior precision slightly reduces the posterior
precision. In the Online Appendix we compare IRFs of aggregate variables to aggregate
                                                                                             34


shocks for K = 10 and K = 22. Recall that according to Table 4 K = 22 attains the largest
MDD among the specifications considered. The IRF bands for these two specifications are
almost identical, which is consistent with the system being approximately block diagonal.

   We have also compared the ^ IRFs against IRFs in which we force of off-diagonal blocks
of the  matrix to be exactly equal to zero (not shown in the figure). We found the two sets
of IRFs to be effectively non-distinguishable. Thus, we conclude that in order to measure the
response of GDP and employment to an aggregate TFP growth shock, we do not need to keep
track of the earnings distribution. Krusell and Smith (1998) showed that in a benchmark
stochastic growth model with household heterogeneity and uninsurable idiosyncratic risk,
the aggregate dynamics of output, consumption, and investment in response to a TFP shock
are almost identical to their RA counterpart. This HA model feature is consistent with our
empirical result.

Distributional Responses. We will now examine the response of the cross-sectional dis-
tribution of earnings (original data) to a TFP shock. Even though the off-diagonal blocks
ay and ya of the VAR coefficient matrix are close to zero, the TFP shock can affect the
earnings distribution through the impact vector tr 1 . Figure 8 shows posterior median re-
sponses to a three-standard deviation TFP innovation and bands delimited by the 10th and
90th percentiles of the posterior distribution. The top and center left panels reproduce the
responses of TFP and employment to a technology shock previously shown in Figure 7. The
employment response is hump shaped. At its peak the employment rate increases between
0.3% and 0.7%.

   The remaining panels show the response of the earnings distribution at various horizons.
As in Section 4, the density responses are constructed as follows. First, we compute the
impulse response of at from the vector autoregressive state transition equation. Second, we
convert that at sequence into a sequence of densities p(K ) (x|t ). We normalize these densities
so that they integrate to the employment rate. Third, we compute the differential between
the shocked density and the steady state density.

   Because the employment rate rises in response to a technology shock, the area under
the density differential function is positive. According to the median response the mass
of individuals earning less than the labor share of GDP per capita increases substantially
and initially there is a slight drop in the mass of individuals earning between 1.3 and 2.
On impact the 80% bands are wide and include both positive and negative responses. For
                                                                                                                  35


             Figure 8: Earnings Density (Transformed Data) Response to a TFP Shock

               TFP [%]                               Empl. Rate [%]                        Density Response
    Horizons h = 0, . . . , 19              Horizons h = 0, . . . , 19                      Horizon h = 0
    3                                    0.8                                      0.02

                                         0.6                                      0.01
    2
                                         0.4                                         0
    1
                                         0.2                                      -0.01

    0                                      0                                      -0.02
         0     5       10       15               0      5       10       15            0        1     2       3

          Density Response                        Density Response                         Density Response
             Horizon h = 4                           Horizon h = 8                          Horizon h = 12
  0.02                                   0.02                                     0.02

  0.01                                   0.01                                     0.01

     0                                      0                                        0

 -0.01                                   -0.01                                    -0.01

 -0.02                                   -0.02                                    -0.02
      0            1        2        3        0             1        2        3        0        1     2       3


Notes: Responses to a 3-standard-deviations shock to TFP for K = 10. The system is in steady state at
h = -1 and the shock occurs at h = 0. The plot depicts 10th (dashed), 50th (solid), and 90th (dashed)
percentiles of the posterior distribution. As distributional responses we depict differences between the shocked
and the steady state cross-sectional density at various horizons.


horizons h = 4, 8, and 12 and earnings below GDP per capita, the density differential bands
include mostly positive values.

    Most of the probability mass is added between 0.5 and 1.0. This mass comes from two
directions: first, unemployed individuals who find jobs and receive strictly positive instead of
zero labor earnings, and, second, individuals whose earnings do not rise as strongly as GDP
per capita. The first effect is consistent with a model in which individuals are heterogeneous
with respect to their idiosyncratic productivity and only individuals whose productivity
exceeds a state-dependent threshold work; see, for instance, Chang and Kim (2006) and
Chang, Kim, Kwon, and Rogerson (2019). In response to an expansionary TFP shock
previously unemployed low productivity individuals are hired. If wages per efficiency unit
are constant, these individuals are likely to earn less than GDP per capita. The second effect
requires adjustments on the intensive margin or some heterogeneity in wages per efficiency
                                                                                                  36


             Figure 9: Inequality Measure (Original Data) Responses to a TFP Shock

               TFP [%]                Fraction [%] Earnings                    Gini Coefficient
                                          < per-capita GDP
    3                              44.5                              0.43

                                                                    0.425
    2                               44
                                                                     0.42
    1                              43.5
                                                                    0.415

    0                               43                               0.41
        0      5    10   15               0      5    10   15                  0   5    10   15

            10th Percentile                   50th Percentile                  90th Percentile
 0.25                              1.02                              2.6


 0.24                              1.01                              2.5


 0.23                                1                               2.4


 0.22                              0.99                              2.3
        0      5    10   15               0      5    10   15              0       5   10    15


Notes: Responses to a 3-standard-deviations shock to TFP for K = 10. The system is in steady state at
h = -1 and the shock occurs at h = 0. The plot depicts 10th (dashed), 50th (solid), and 90th (dashed)
percentiles of the posterior distribution.


unit. A strong wealth effect that leads wealthy individuals to reduce their hours or a relative
fall of efficiency unit-specific wages for some individuals is required to shift their earnings
from above 1.0 to below 1.0.

   A key advantage of the functional modeling approach is that in any period t the cross-
sectional earnings density fully summarizes the earnings distribution. Based on the impulse
response of the cross-sectional density, we can now compute impulse response functions of
various summary statistics. Figure 9 shows responses for the fraction of individuals with
an earnings-to-per-capita-GDP ratio less than one, the Gini coefficient, and the 10th, 50th,
and 90th percentiles of the distribution. The impulse responses are computed relative to an
average level of these statistics, indicated by a solid black line. All statistics are computed
after assigning zero earnings to the unemployed individuals.

   According to the posterior median of the IRF, overall the fraction of individuals earning
less than per-capita GDP increases from 43.5% to 43.8%. While the density differential
                                                                                           37


response for h = 0 depicted in Figure 8 looked "insignificant," converted into the fraction
earning less than per-capita GDP, the response is positive with a probability of almost
90% even on impact. As individuals move from being unemployed (zero earnings) to being
employed (positive earnings) the Gini coefficient falls from 0.4256 to 0.4224. Earnings at the
10th percentile of the cross-sectional distribution also increase from 0.224 to 0.236, at the
median they stay roughly constant around 1.005, with a band that ranges upon impact from
approximately 0.995 to 1.015. Earnings at the 90th percentile fall very slightly, from 2.496
to 2.483. The posterior median of the ratio of earnings at the 90th and 10th percentile drops
by 5.1% from 11.13 to 10.56 two periods after the impact of the shock. This compression of
the earnings distribution is consistent with the decrease in the Gini coefficient.


5.3    Robustness Analysis 1: Results for K = 22

According to Table 4 the MDD is maximized with respect to K for the largest value consid-
ered, namely K = 22. We previously presented results for K = 10, because they were based
on a smoother density. As a robustness exercise, we compare selected IRFs for K = 10 and
K = 22 in Figure 10. The density responses look quite different for the two model specifi-
cations. For K = 22 the posterior median appears to be much more volatile as a function
of the earnings. The swings trace out movements of the jagged density estimates shown
in Figure 6. The Gini coefficient responses on the other hand, are almost identical for the
two values of K , with the exception of a small level shift. In the Online Appendix we also
plot the responses of the percentiles and the fraction of individuals with earnings less than
GDP per capita. It turns out that the K = 22 IRFs are quantitatively very similar to the
responses depicted in Figure 9, confirming that our results are robust with respect to the
dimensionality K of the density approximation.


5.4    Robustness Analysis 2: Comparison to Simple VARs

The advantage of the functional approach is that once the dynamics of the cross-sectional
densities have been estimated, it is straightforward to compute the dynamics of any statistic
associated with the densities. We previously considered impulse responses of the fraction
of individuals earning less than GDP per capita, the Gini coefficients, and the quantiles
of the earnings distribution, all computed from the original data. As a robustness check,
we estimate two simple VARs. The first VAR combines the aggregate variables with the
                                                                                                                              38


  Figure 10: Earnings Density and Gini Responses to a TFP Shock: K = 10 vs. K = 22

                                                                     K = 10                             K = 22
                                                        0.02                               0.02


                  Density Response
                                     Horizon h = 0
                                                        0.01                               0.01

                                                           0                                  0

                                                        -0.01                              -0.01

                                                        -0.02                              -0.02
                                                             0       1        2        3        0       1        2        3

                                                         0.43                               0.43
                                     Gini Coefficient




                                                        0.425                              0.425

                                                         0.42                               0.42

                                                        0.415                              0.415

                                                         0.41                               0.41
                                                                 0   5   10       15                0   5   10       15


Notes: Responses to a 3-standard-deviations shock to TFP. The system is in steady state at h = -1 and the
shock occurs at h = 0. The plot depicts 10th (dashed), 50th (solid), and 90th (dashed) percentiles of the
posterior distribution. As distributional responses we depict differences between the shocked and the steady
state cross-sectional density at various horizons. Density responses are reported for transformed data, Gini
responses are reported for original data.


fraction of individuals earning less than GDP per capita and the Gini coefficient series
directly computed from the cross-sectional observations. The second VAR combines the
aggregate variables with the 10th, 20th, 50th, 80th and 90th percentiles.

    Both VARs take the form of (29) with the prior in (30), where Wt is redefined to include
the relevant distributional statistics. The estimated hyperparameters for the Gini coefficient
VAR are   ^ 1 = 0.29, ^ 2 = 403, and   ^ 3 = 403. The estimated s for the percentile VAR are
^ 1 = 1.25, 
            ^ 2 = 403, and ^ 3 = 5.29. For the Gini specification the MDD criterion shrinks
toward a block diagonal  matrix. For the percentile VAR, on the other hand, the MDD
criterion leads to less shrinkage on the parameter block that controls the effect of lagged
aggregate variables on the percentiles of the current cross-sectional distribution. In fact the
^ pattern is similar to the one obtained from the functional VAR applied to data simulated

from the KS economy.

    Figure 11 overlays impulse responses to a three standard deviation technology shock for
TFP, the fraction of individuals earning less than per-capita GDP, and the Gini coefficient
from the functional state-space model and the Gini coefficient VAR. While the 90th per-
                                                                                                      39


Figure 11: Functional vs. Alternative VAR: Inequality Statistics Responses to a TFP Shock

            TFP [%]                      Fraction Earnings                    Gini Coefficient
                                      < per-capita GDP [%]
    3                                0.01
                                                                      0.425
                                    0.005
    2                                                                  0.42
                                        0

    1                              -0.005                             0.415

                                     -0.01
    0                                                                  0.41
          10    20    30    40                10   20    30   40                10   20    30    40


Notes: Responses to a 3-standard-deviations shock to TFP. The system is in steady state at h = -1 and
the shock occurs at h = 0. The bands correspond to pointwise 10th and 90th percentiles of the posterior
distribution. Solid blue responses are based on the functional state-space model for K = 10; dashed red
responses are based on the alternative VAR. Inequality responses are computed for the original data.


centiles of the posterior distributions of impulse responses line up quite accurately, the 10th
percentiles differ substantially. Under the simple VAR, the 10th percentiles for the fraction
of earnings and the Gini coefficient continue to fall as the horizon increases, which is not
particularly plausible.

   Figure 12 overlays impulse responses to a three standard deviation technology shock for
TFP and various percentiles of the earnings distribution from the functional state-space
model and the percentile VAR. The bands of the TFP responses line up almost perfectly.
While the responses for the 10th and 20th are quite similar, the functional model delivers
substantially tighter bands than the finite-dimensional VAR that contains the sample quan-
tiles, in particular after 20 to 30 quarters when the widths of the functional VAR bands is
close to zero. The bottom edges of the bands for the responses of the 50th, 80th, and 90th
percentiles are much lower for the simplified VAR than the functional VAR. Overall, the
width of the IRF bands suggests that the functional approach allows for a much sharper
inference, despite a higher but still parsimonious parameter count (ten series instead of two
or five series to represent the dynamics of the cross section), and is therefore preferable.


5.5     Effects of a Distributional Shock

The shocks considered in the previous subsection only affected the aggregate variables upon
impact. We will now consider the effects of a distributional shock which we define to be a
                                                                                                      40


        Figure 12: Functional vs. Alternative VAR: Quantile Responses to a TFP Shock

             TFP [%]                        10th Percentile                   20th Percentile
    3
                                     0.24                              0.48
    2                              0.235                              0.475

                                     0.23                              0.47
    1
                                   0.225                              0.465

    0                                0.22                              0.46
           10     20     30   40              10   20    30   40                10   20    30    40

                Median                      80th Percentile                   90th Percentile
 1.02                              1.88
                                                                       2.5
 1.01
                                   1.86                               2.48
    1
                                                                      2.46
                                   1.84
 0.99
                                                                      2.44
 0.98                              1.82
           10     20     30   40             10    20   30    40               10    20    30    40


Notes: Responses to a 3-standard-deviations shock to TFP. The system is in steady state at h = -1 and
the shock occurs at h = 0. The bands correspond to pointwise 10th and 90th percentiles of the posterior
distribution. Solid blue responses are based on the functional state-space model for K = 10; dashed red
responses are based on the alternative VAR. Percentile responses are computed for the original data.


shock that does not move the aggregate variables upon impact. A distributional shock could
reflect, for instance, an unanticipated revenue neutral change in fiscal policy that triggers
a redistribution of earnings, or a change in the underlying idiosyncratic earnings processes
such as an increase in earnings risk.
   The aggregate effect depends on the nature of the distributional shock. To the extent that
the marginal propensity to consume is negatively correlated with income, higher inequality
may lower aggregate consumption. If inequality comes from a rise in idiosyncratic volatility,
then it could raise precautionary savings. Auclert and Rognlie (2020) show that in general
equilibrium a falling interest rate may weaken the negative relationship between inequality
and aggregate output, and that the net effect is sensitive to monetary and fiscal policy.
   In our fVAR setting the distributional shock is an abstract object that is not directly
tied to idiosyncratic earnings processes. Building on the notation in (40), let Q·4 = q ,
where q = [0, q ] and the partition of q conforms with the partition of ut = [uy,t , u,t ]. By
construction, Q·4 is orthogonal to Q.j , j = 1, . . . , 3. We choose the unit-length vector q as
                                                                                                          41


                                                                    
    Figure 13: Responses to a Distributional Innovation             t   (Maximize Gini-Coefficient)

          Gini Coefficient                        10th Percentile                    90th Percentile
 0.445                                                                     2.7
                                       0.23
  0.44
                                                                           2.6
 0.435                                 0.22
                                                                           2.5
  0.43
                                       0.21
 0.425                                                                     2.4
          0      5   10       15              0      5    10   15                0      5    10   15

          Density Response
              Horizon h = 0                       Empl. Rate [%]                       GDP [%]
                                       0.3                                 0.3

  0.04                                 0.2                                 0.2

  0.02                                 0.1                                 0.1

     0                                   0                                   0

 -0.02                                 -0.1                               -0.1
      0          1        2        3          0      5    10   15                0      5    10   15


Notes: Responses to a 3-standard-deviation distributional innovation    t for K = 10. The system is in steady
state at h = -1 and the shock occurs at h = 0. The plot depicts 10th (dashed), 50th (solid), and 90th
(dashed) percentiles of the posterior distribution. As distributional responses we depict differences between
the shocked and the steady state cross-sectional density at various horizons. Density response is reported
for transformed data, all other responses for original data.


a function of (, ) to generate a maximal increase in inequality upon impact, as measured
by the Gini coefficient.

    The results are depicted in Figure 13. The average response of the Gini coefficient spikes
upon impact by construction of the distributional shock and then dies out fairly quickly
according to the autoregressive dynamics. Earnings at the 10th percentile fall while earnings
at the 90th percentile rise relative to the labor share of GDP per capita. The posterior
median ratio of earnings at the 90th and 10th percentiles rises by 5.3% from 11.13 to 11.72,
confirming that the shock increases inequality. The bottom left panel shows the density
response upon impact of the shock. Probability mass shifts from the 1.0 to 2.5 range into
the 0 to 1.0 range, leaving essentially only the labor income of individuals who are earning
more than 2.5 times of GDP per capita unaffected.

    The bottom center and right panels show the response of two aggregate variables: the
                                                                                            42


employment rate and GDP. By construction, neither employment nor GDP respond to the
distributional shock upon impact. At the posterior median both employment and GDP
increase, but not by much. The employment response is hump shaped and peaks at 0.03%,
whereas the effect on GDP is an increase of 0.08% in the long run. While the TFP shock
generates a negative relationship between economic activity and inequality, the particular
distributional shock constructed here generates a weak positive relationship. The bands
for the GDP and employment rate responses do include zero, which is consistent with the
response that Auclert and Rognlie (2020) find for standard neoclassical models.



6      Conclusion

We developed a functional state-space model that stacks macroeconomic aggregates and
cross-sectional distributions to provide semi-structural evidence about the interaction of ag-
gregate and distributional dynamics. We documented that the model estimated on simulated
data is able to reproduce the impulse response dynamics of the underlying KS model econ-
omy. In our empirical analysis we found that adding the earnings distribution to a VAR
in TFP growth, GDP growth, and employment does not affect the propagation of aggre-
gate variables to aggregate shocks, which is consistent with model-based findings reported
in Krusell and Smith (1998). We find that an expansionary TFP shock decreases earnings
inequality in our sample because it raises earnings at the bottom of the earnings distribu-
tion. Finally, we show that a distributional shock that raises inequality has a small positive,
albeit not significant, effect on aggregate output. We expect the techniques developed in this
paper to be widely applicable to study the interaction between macroeconomic aggregates
and cross-sectional distributions and useful for the evaluation of the most recent vintage of
HA models. Useful extensions left for future work include the introduction of time-varying
volatility and allowing for mixed-frequency observations.



References
Acharya, S., W. Chen, M. Del Negro, K. Dogra, E. Matlin, and R. Sarfati
    (2019): "Estimating HANK: Macro Time Series and Micro Moments," Manuscript, Federal
    Reserve Bank of New York.
                                                                                        43


Ahn, S., G. Kaplan, B. Moll, T. Winberry, and C. Wolf (2018): "When Inequality
  Matters for Macro and Macro Matters for Inequality," in NBER Macroeconomics Annual
  2017, ed. by M. Eichenbaum, and J. Parker, pp. 1 ­ 75. University of Chicago Press.

Auclert, A., and M. Rognlie (2020): "Inequality and Aggregate Demand," Manuscript,
  Stanford University.

Bayer, C., B. Born, and R. Luetticke (2020): "Shocks, Frictions, and Inequality in
  US Business Cycles," Working paper.

Bhandari, A., D. Evans, M. Golosov, and T. J. Sargent (2021): "Inequality, Busi-
  ness Cycles, and Monetary-Fiscal Policy," Econometrica, forthcoming.

Bosq, D. (2000): Linear Processes in Function Spaces. Springer Verlag, New York.

Carter, C., and R. Kohn (1994): "On Gibbs Sampling for State Space Models,"
  Biometrika, 81, 541­553.

Chang, Y., C. S. Kim, and J. Park (2016): "Nonstationarity in Time Series of State
  Densities," Journal of Econometrics, 192, 152­167.

Chang, Y., and S.-B. Kim (2006): "From Individual to Aggregate Labor Supply: A
  Quantitative Analysis Based on a Heterogeneous Agent Macroeconomy," International
  Economic Review, 47, 1­27.

Chang, Y., S.-B. Kim, K. Kwon, and R. Rogerson (2019): "2018 Klein Lecture:
  Individual and Aggregate Labor Supply in Heterogeneous Agent Economies with Intensive
  and Extensive Margins," International Economic Review, 60(1), 3­24.

Childers, D. (2018): "Solution of Rational Expectations Models with Function Valued
  States," Manuscript, Carnegie Mellon University.

Cho, D. (2020):     "Unemployment Risk, MPC Heterogeneity, and Business Cycles,"
  Manuscript, University of Melbourne.

Coibion, O., Y. Gorodnichenko, L. Kueng, and J. Silvia (2017): "Innocent By-
  standers? Monetary Policy and Inequality," Journal of Monetary Economics, 88, 70­89.

Del Negro, M., and F. Schorfheide (2004): "Priors from General Equilibrium Models
  for VARs," International Economic Review, 45(2), 643 ­ 673.
                                                                                       44


Diebold, F. X., and C. Li (2006): "Forecasting the Term Structure of Government Bond
  Yields," Journal of Econometrics, 130, 337­364.

Durbin, J., and S. J. Koopman (2001): Time Series Analysis by State Space Methods.
  Oxford University Press.

Fernald, J. G. (2012): "A Quarterly, Utilization-Adjusted Series on Total Factor Produc-
  tivity," FRBSF Working Paper, 2012-19.

Fuentes-Albero, C., and L. Melosi (2013): "Methods for Computing Marginal Data
  Densities from the Gibbs Output," Journal of Econometrics, 175, 132­141.

Geweke, J. (1999): "Using Simulation Methods for Bayesian Econometric Models: Infer-
  ence, Development, and Communication," Econometric Reviews, 18(1), 1­126.

Giannone, D., M. Lenza, and G. Primiceri (2015): "Prior Selection for Vector Au-
  toregressions," Review of Economics and Statistics, 97(2), 436­451.

Harvey, A. C. (1989): Forecasting, Structural Time Series Models, and the Kalman Filter.
  Cambridge University Press.

Horvath, L., and P. Kokoszka (2012): Inference for Functional Data with Applications.
  Springer Verlag, New York.

Hu, B., and J. Y. Park (2017): "Econometric Analysis of Functional Dynamics in the
  Presence of Persistence," Manuscript, Department of Economics, Indiana University.

Huggett, M. (1997): "The one-sector growth model with idiosyncratic shocks: steady
  states and dynamics," Journal of Monetary Economics, 39, 385­403.

Inoue, A., and B. Rossi (2020): "The Effects of Conventional and Unconventional Mon-
  etary Policy: A New Approach," Manuscript, Vanderbilt University and Pompeu Fabra.

Kaplan, G., and L. Violante, Giovanni (2018): "Microeconomic Heterogeneity and
  Macroeconomic Shocks," Journal of Economic Perspective, 32, 167­194.

Kooperberg, C., and C. J. Stone (1990): "A Study of Logspline Density Estimation,"
  Computational Statistics & Data Analysis, 12, 327­347.

Krueger, D., K. Mitman, and F. Perri (2016): "Macroeconomics and Household
  Heterogeneity," in Handbook of Macroeconomics, ed. by H. Uhlig, and J. Taylor, vol. 2A,
  pp. 843­921. Elsevier (Amsterdam).
                                                                                  45


Krusell, P., and A. A. Smith (1998): "Income and Wealth Heterogeneity in the Macroe-
  conomy," Journal of Political Economy, 106(5), 867­896.

Liu, L., and M. Plagborg-Møller (2019): "Full-Information Estimation of Heteroge-
  neous Agent Models Using Macro and Micro Data," Manuscript, Indiana University and
  Princeton University.

Meeks, R., and F. Monti (2019): "Heterogeneous Beliefs and the Phillips Curve," Bank
  of England Staff Working Paper, 807.

Mongey, S., and J. Williams (2017): "Firm Dispersion and Business Cycles: Estimating
  Aggregate Shocks Using Panel Data," Manuscript, University of Chicago.

Ottonello, P., and T. Winberry (2020): "Financial Heterogeneity and the Investment
  Channel of Monetary Policy," Econometrica, 88, 2473­2502.

Ramsey, J. O., and B. W. Silverman (2005): Functional Data Analysis. Springer Verlag,
  New York, 2nd edn.

Reiter, M. (2009): "Solving Heterogeneous-Agent Models by Projection and Perturba-
  tion," Journal of Economic Dynamics & Control, 33, 649­665.

Schorfheide, F., and D. Song (2015): "Real-Time Forecasting with a Mixed-Frequency
  VAR," Journal of Business and Economic Statistics, 33(3), 366­380.

Varin, C., N. Reid, and D. Firth (2011): "An Overview of Composite Likelihood Meth-
  ods," Statistica Sinica, 21, 5­42.

Villalvazo, S. (2021): "Inequality and Asset Prices during Sudden Stops," Manuscript,
  University of Pennsylvania.

Winberry, T. (2018): "A Toolbox for Solving and Estimating Heterogeneous Agent Macro
  Models," Quantitative Economics, 9, 1123­1151.
Online Appendix ­ This Version: May 20, 2021                                                        A.1


    Online Appendix: Heterogeneity and Aggregate Fluctuations
                 Minsu Chang, Xiaohong Chen, and Frank Schorfheide



A      Functional State-Space Model ­ Further Details

A.1      Hessian Matrix

An important object in the analysis is the Hessian matrix of the log-likelihood function for
the cross-sectional observations. Let k (x), k = 1, . . . , K be the sequence of basis functions
                                                                (K )
for the approximation of the cross-sectional density pt (x) and let Xt = {x1t , . . . , xN t }. To
simplify the notation, we will subsequently drop the (K ) superscript. Recall that ¯k (Xt ) =
1    N
N    i=1 k (xit ).   The log likelihood function of Xt has the form
                                     K                                    K
                     L(t |Xt ) =          k,t ¯k (Xt ) - ln    exp            k,t k (x) dx.        (A.1)
                                    k=1                                k=1

The first-order derivatives with respect to k,t for k = 1, . . . , K are given by
                                                                       K
                                                      k (x) exp        k=1    k,t k (x) dx
                      (1)          ¯k (Xt ) -
                     Lk (t |Xt ) =                                                                 (A.2)
                                                                    K
                                                         exp        k=1   k,t k (x) dx

                                   = ¯k (Xt ) -       k (x)p(x|t )dx.

The second-order derivatives with respect to (k,t , l,t ) are given by

                      (2)                     p(x|t )
                     Lkl (t |Xt ) = -        k (x)      dx
                                                 l,t
                                                  ln p(xit |t )
                                   = -E k (xit )
                                                     l,t

                                   = -E k (xit ) l (xit ) -            l (x)p(x|t )dx        .

Thus, we can write

         (2)
       Lkl (t |Xt )                                                                                (A.3)

         = -            k (x) -    k (x)p(x|t )dx         l (x) -      l (x)p(x|t )dx p(x|t )dx.

Note that the Hessian elements only depend on t but not on the data Xt .
Online Appendix ­ This Version: May 20, 2021                                                                 A.2


A.2       Top Coding

Likelihood Function with Censoring. We define the censoring point ct as

                                               ct = max xit
                                                       i=1,...,N


Moreover, we let
                                                        N
                                        Nt,max =             I{xit = ct }.
                                                       i=1

If Nt,max = 1, we assume that the observed sample is not constrained by the top-coding
and use the standard likelihood function described in the main text. If Nt,max > 1 we use a
likelihood function that assumes that any earnings value exceeding ct is coded as ct .

      Recall that in the main text we ignored the dependence of the cross-sectional sample size
N on t in the notation and defined p(K ) (Xt |t ) = exp N L(K ) (t |Xt ) , where

                                                                                           Nt
           L (K )
                    (t |Xt ) = ¯ (Xt )t - ln          exp  (x)t dx,           ¯(Xt ) = 1
                                                                                                  (xit ).
                                               0                                       N   i=1


      We introduce the unknown parameter t = P{xit  ct }. We drop the top-coded obser-
vations from the definition of ¯(Xt ) und make the time dependence explicit in the notation.

Let
                                                      Nt
                                    ¯t (Xt ) = 1
                                                             (xit )I{xit < ct }.                            (A.4)
                                               Nt     i=1

The log likelihood function is obtained as follows: the sample contains Nt,max top-coded
observations where the probability of sampling a top-coded observation is t . The probability
of samping an observation that is not top-coded is (1 - t ). Conditional on not being top-
coded, the observation xit < ct is sampled from a continuous density with a domain that is
truncated at ct . Thus, dividing the log-likelihood by the sample size Nt , we obtain

                                      Nt,max       Nt - Nt,max
               L(K ) (t , t |Xt ) =          ln  +             ln(1 - t )                                   (A.5)
                                       Nt              Nt
                                                                    ct
                                      +¯ (Xt )t - Nt - Nt,max ln       exp  (x)t dx.
                                        t
                                                      Nt          0

Notice that regardless of the value of t , the MLE of t is

                             ^t = argmax[0,1] L(K ) (t , t |Xt ) = Nt,max /Nt .
                                                                                                            (A.6)
Online Appendix ­ This Version: May 20, 2021                                                                       A.3


Moreover, regardless of the value of t , the MLE of t is given by

                     ^ t = argmaxt L(K ) (t , t |Xt )
                                                                                                                  (A.7)
                                                                                          ct
                         = argmaxt ¯ (Xt )t - Nt - Nt,max ln                                    exp  (x)t dx.
                                    t
                                                      Nt                              0

The objective function for t is almost identical to what we had without top coding, except
for a definition of ¯t (Xt ) that drops the top-coded observations in the summation and the

factor of (Nt - Nt,max )/Nt in front of the normalization constant of the density.

Recovering the Density for Uncensored Observations. To reconstruct the full density
we can use
                                                                   K
                                                      exp          k=1    k,t k (x)
                                  p(x|t ) =       
                                                                                                  .               (A.8)
                                                                   K
                                                 0
                                                      exp          k=1    k,t k (x) dx
Note that here we dropped the censoring indicator function and the integration is now from
0 to . Once the t 's have been estimated based on the censored observations, we work with
the full density in the functional state-space model and its K -dimensional approximation.

Modification of Hessian Matrix. We now re-compute the score and the Hessian. Drop-
ping the (K ) superscript we obtain the following first derivatives with respect to k for
k = 1, . . . , K :
                                                                                           ct
                      (1)              ¯t,k (Xt ) -         Nt - Nt,max
                     Lk (t |t , Xt ) =                                                               p(x|t )dx,
                                                                                                k (x)¯
                                                                Nt                     0

where
                                                          K
                                               exp        k=1     k,t k (x)
                             ¯(x|t ) =
                             p            ct
                                                                                           I{x < ct }.
                                                            K
                                         0
                                               exp          k=1   k,t k (x) dx
We can now deduce from our previous calculations that

                     (2)
                 Lkl (t |t , Xt )                                                                                 (A.9)
                                                     ct                       ct
                            Nt - Nt,max
                  = -                                     k (x) -                       p(x|t )dx
                                                                                   k (x)¯
                                  Nt             0                        0
                                                                         ct
                                                × l (x) -                          p(x|t )dx p
                                                                              l (x)¯         ¯(x|t )dx.
                                                                     0

Thus, compared to the standard case in (A.3), the limits of integration change and there is
an additional factor (Nt - Nt,max )/Nt .
Online Appendix ­ This Version: May 20, 2021                                                 A.4


A.3      VAR State-Transition Equation

In this section we describe how to sample from the conditional posterior distributions
|(, W, ) and |(, W, ) that appear in the Gibbs sampler (20) and how to approximate
the aggregate component of the marginal data density in (20) given by:
                          T
                               p(K ) (Yt , ^ t |Yt-1 , t-1 = ^ t-1 , ) p(|)d.
                         t=1

Throughout this section we adopt the convention that  = vec(). Recall that the prior
distribution for the VAR parameters was given in (30) and has the form

                           IW (, S ),          |  N µ , P - 1
                                                           () .



Posteriors. The state-transition equation in matrix form was given by W = Z  + U ; see
(29). Let nw be the dimension of Wt , then the likelihood function for (, ) is given by

   p(W |, )                                                                             (A.10)
                                    1          ^ Z Z ( - )
                                                         ^                   1      ^
        = (2 )-nw T /2 ||-T /2 exp - tr -1 ( - )                        exp - tr -1 S    ,
                                    2                                        2

where
                    ^ = (Z Z )-1 Z W,
                                           ^ = W W - W Z (Z Z )-1 Z W.
                                           S

The prior density takes the form

                                                   1
              p(, |) = (2 )-nw nz /2 |P  |1/2 exp - ( - µ ) P  ( - µ )                  (A.11)
                                                   2
                                                     1
                       ×C IW ||-( +nw +1)/2 exp - tr -1 S ,
                                                     2

where C IW is the normalization constant of the IW prior.

   The conditional posteriors |(W, , ) and |(W, , ) can be obtained as follows:

                 p(|W, , )  p(W |, )p(|)                                                (A.12)
                                   1     ^) (-1  Z Z )( - ^)
                            × exp - ( - 
                                   2
                                   1
                            × exp - ( - µ ) P  ( - µ ) .
                                   2
Online Appendix ­ This Version: May 20, 2021                                         A.5


Define
               ¯ = P  + -1  Z Z,
               P                         µ   ¯ -1 P  µ + (-1  Z Z )
                                         ¯ = P                     ^ .
                                                      

We deduce that the conditional posterior distribution of  takes the form

                                    |(W, )  N µ   ¯ .
                                              ¯ , P                               (A.13)

The conditional posterior of  can be obtained as follows:

              p(|W, , )  p(W |, )p(|)                                             (A.14)
                                        1
                         ||-T /2 exp - tr (W - Z ) (W - Z )]
                                        2
                                              1
                         ×||-( +nw +1)/2 exp - tr -1 S .
                                              2

Define
                       ¯ =  + T,      ¯ = S + (W - Z ) (W - Z )
                                      S

and deduce that
                                    |(W, )  IW    ¯ .
                                               ¯, S                               (A.15)

Marginal Data Density. Treating W as observed, we can approximate the marginal data
density p(W |) for the VAR using Geweke (1999)'s modified harmonic mean estimator. We
begin by integrating out  directly:

p(W |, ) =        p(W |, )p(|)d                                                   (A.16)
                                               1      ^) (-1  Z Z )( -  ^)
           = (2 )-nw T /2 ||-T /2    exp - ( - 
                                               2
                        1          ^ (2 )-nw nz /2 |P  |1/2 exp - 1 ( - µ ) P  ( - µ ) d.
             × exp - tr -1 S                                                        
                        2                                          2
                                            ¯ |-1/2 exp - 1 tr -1 S
           = (2 )-nw T /2 ||-T /2 |P  |1/2 |P                      ^
                                                           2
                        1 ^ -1                ^+µ P µ -µ       ¯ µ
             × exp -        (  Z Z )                 
                                                             ¯ P ¯ .
                        2

We now can express
                            p(W |) =      p(W |, )p(|)d.                          (A.17)
Online Appendix ­ This Version: May 20, 2021                                                                A.6


   To implement the modified harmonic mean estimator, we need to evaluate the prior
density
                                                      1
                      p(|) = C IW ||-( +nw +1)/2 exp - tr -1 S                                   ,
                                                      2
where
                                                        |S |/2
                       C IW =                                nw                              ,
                             2nw /2  nw (nw -1)/4            i=1   (( + 1 - i)/2)
in addition to p(W |, ) in (A.16).

   We use a modified harmonic mean estimator of the following form
                                               Nsim                                 -1
                                  1                      f vech(i )
                         p(W |)                                                          ,                (A.18)
                                 Nsim           i=1
                                                       p(W |i , )p(i |)

where vech(A) stacks the non-redundant elements of a symmetric matrix A and {i }N sim
                                                                                i=1

are draws from the posterior distribution p(|W, ). We choose the following function f ():

                                        ¯ |-1/2 exp[-0.5( - 
                  f () =  -1 (2 )-n /2 |V                   ¯) V
                                                               ¯ -1 ( - ¯)]
                                                                 

                            ×I ( - ¯) V
                                      ¯ -1 ( - ¯)  F - 1
                                                         ( ) ,
                                                    2 n               


where  = vech(), n = nw (nw +1)/2 × 1, and ¯ and V
                                                 ¯ are numerical approximations of the

posterior mean and covariance matrix of , computed from the posterior draws i = vech(i ).

   In order to evaluate the MDD approximation, it is important to extract a normalization
constant from the likelihood p(W |i , ) in (A.16). Let p(W |i , ) = C i g (W |i , ) where
C i is the normalization constant for draw i. Denote the maximum of the normalization
constants as Cmax . Then
                                       Nsim                               -1
                           1                    f vech(i )
                  p(W |) 
                          Nsim         i=1
                                              p(W |i , )p(i |)
                                       Nsim                                    -1
                                 1                   f vech(i )
                           =
                                Nsim   i=1
                                              C i g (W |i , )p(i |)
                                                    Nsim                                             -1
                                 1        1                        f vech(i )
                           =           ×                 Ci
                                Cmax     Nsim       i=1 Cmax
                                                             g (W |i , )p(i |)
Since the object of interest is ln p(W ),
                                                    Nsim
                                              1
          ln p(W |)  ln(Cmax ) - ln                         exp     ln f vech(i ) - ln g (W |i , )
                                             Nsim     i=1

                        -(ln C i - ln Cmax ) - ln p(i |)              ,
Online Appendix ­ This Version: May 20, 2021                                                       A.7


which avoids exponentiating a large numbers.



B     Solution of the KS Model

The aggregate state of the economy is s = (z, µ), where µ is the distribution of households
over ( , x) pairs. We write µ to denote the conditional distribution of the assets given the
employment status . Expectations of test functions h(x) under this measure are denoted
by Eµ [h(x)] =       h(x)dµ . Note that z is an exogenous state variable and µ an endogenous
state variable. A recursive competitive equilibrium is a list of functions

                               x ( , x; s),       R(s),     W (s),   µ (s).                     (A.19)

We will subsequently construct approximations to these functions.



B.1     Evolution of Asset Holdings

We begin with the evolution of asset holdings conditional on the exogenous two-state
process. The distribution of asset holdings at the beginning of the next period can be
determined as follows. For all measurable sets A,

                          I{x  A}dµ =               (~| )    I{x (~, x; s)  A}dµ~.              (A.20)
                                              ~


    There is always a mass of individuals m
                                          ^ at the borrowing constraint x. The evolution
of this mass can be characterized as follows:

         m =           (~| )         I{x (~, x; s) = x}dµ~ + I{x (~, x; s) = x}m~ .             (A.21)
                 ~             x>x


It is temping to assume that the distribution of asset holdings conditional on x > x is
continuous. Unfortunately, that is not the case if             is a discrete random variable and z is a
continuous random variable. Suppose that z is large, then all individuals with x assets that
transition from unemployment to employment will make the same choice of asset holdings x
                                                                                       ~
which generates a point mass at x
                                ~. The solution method described subsequently will ignore
Online Appendix ­ This Version: May 20, 2021                                             A.8


this difficulty and characterize the distribution of x given x > x by the first three moments
and then approximate it with a continuous density.

   We will write the density associated with µ as

                               q (x) = m x (x) + (1 - m )p (x).

The discrete part corresponds to a point mass of m at x. Using x (x) to denote the Dirac
function with the property that x (x) = 0 for x = 0 and         x (x)dx = 1. The continuous
part is represented by the (proper) density p (x).

   Next period's point masses are given by

         m    =         (~| ) (1 - m~)         I{i  x - x (~, x; s)}p ( )d p~(x)dx    (A.22)
                   ~

                  +m~       I{i  x - x (~, x; s)}p ( )d ,

where, according to Bayes Theorem,  (~| ) =  (~) ( |~)/ ( ). Note that the updating
formula for the point mass has two parts. The first part captures households that were
unconstrained at the beginning of the period, but are constrained at the end of the period.
The second part captures households that remain at the borrowing constraint.

   The continuous part of next period's asset distribution is given by
                                               p (x - x (~, x
                                                            ~; s))I{x > x}p~(~
                                                                             x)dx
                                                                                ~
           p (x) =           (~| ) (1 - m~)                                           (A.23)
                        ~
                                               p (x - x (~, x
                                                            ~; s))I{x > x}p~(~
                                                                             x)dx
                                                                                ~dx
                              p (x - x (~, x; s))I{x > x}
                       +m ~                                 ,
                              p (x - x (~, x; s))I{x > x}dx
with the understanding that the decision rule x (·) is through s also a function of m and
p (x). Equations (A.22) and (A.23) define a law of motion for the cross-sectional density
q (x).


B.2      Firms and Households

Based on the asset distribution approximation, we can re-define the aggregate state as s =
 z, me , pe , mu , pu . Technology evolves according to

                                         z =  z z + z  .                              (A.24)
Online Appendix ­ This Version: May 20, 2021                                                      A.9


The capital stock has to equal the net asset holdings:

                         K (s) =       ( ) (1 - m )          xp (x)dx + m x .                   (A.25)


Profit maximization of the representative firm implies

                                   R(s) = ez K -1 (s)L1- -                                      (A.26)

                                   W (s) = (1 - )ez K  (s)L- .


   We now turn to the optimization problem of the households. They take R(·), W (·), and
µ(·) as given. Define the conditional expectation

                                                                          -
       ( , x; z, m , p ) =  E 1 + R(z , m , p ) c         ,x ;z ,m ,p         , x; z, m , p .   (A.27)

The desired asset holdings in the next period can be obtained by substituting the consump-
tion that satisfies the Euler equation into the budget constraint:

        x ( , x; s) = W (s) (1 -  ) + b(1 - ) + 1 + R(s) x -  -1/ ( , x; s).                    (A.28)

The actual asset holdings have to take into account the borrowing constraint:

                                 x ( , x; s) = max     x, x ( , x; s) .                         (A.29)

Once the asset holdings are determined, consumption is given by

                c( , x; s) = W (s) (1 -  ) + b(1 - ) + 1 + R(s) x - x ( , x; s).                (A.30)



B.3     Finite-dimensional Approximation

Going forward, we will transition to using time subscripts for all aggregate states. We
approximate the density pt, (x) using the following finite-dimensional ­ denoted by (K )
superscript ­ representation:
                                                      K
       (K )
      pt, (x)   = exp t, ,0 + t, ,1 (x - mt, ,1 ) +         t, ,k (x - mt, ,1 )k - mt, ,k   .   (A.31)
                                                      k=2
Online Appendix ­ This Version: May 20, 2021                                                            A.10


Here mt, ,k are centralized moments of the distribution. As it will become apparent below,
we will essentially discretize the approximate density. The moments mt, ,k are then used to
summarize the discretized distribution and reduce the dimensionality of the state space.

    The parameters t, ,k and the moments mt, ,k must be consistent with each other:

                                                    (K )
                                   mt, ,1 =       xpt, (x)dx                                       (A.32)

                                                                  (K )
                                   mt, ,k =      (x - mt, ,1 )k pt, (x)dx.

We also require that the approximate density integrates to one:
                                                     K
      t, ,0 = - ln    exp t, ,1 (x - mt, ,1 ) +            t, ,k (x - mt, ,1 )k - mt, ,k   dx.     (A.33)
                                                    k=2

Conditional on the moments mt, ,k , we can use (A.32) and (A.33) to recover the t, ,k s.

    We now approximate the law of motion for the probability masses mt, and the moments
mt, ,k . First,

                                                                                 (K )
                  mt+1,    =            (~| )     I{xt (~, x) = x}(1 - mt,~)pt,~ (x)dx             (A.34)
                                   ~

                               +I{xt (~, x = x) = x}mt,~

The mass of households at the borrowing constraint in period t + 1 consists of the households
that were unconstrained in period t and then hit the constraint in period t + 1 and those
who were constrained in period t and remained constrained. One also has to account for the
employment transitions:  (~| ) is the probability of having been in employment status ~ in
period t given that the period t + 1 employment status is .

    Second, the moments of the continuous part of the asset distribution have to satisfy

                                                                              (K )
      mt+1, ,1 =           (~| )        I{xt (~, x) > x}xt (~, x)(1 - mt,~)pt,~ (x)dx              (A.35)
                      ~

                     +I{xt (~, x) > x}xt (~, x)mt,~

                                                                                           (K )
      mt+1, ,k =           (~| )        I{xt (~, x) > x}[xt (~, x) - mt+1, ,1 ]k (1 - mt,~)pt,~ (x)dx
                      ~

                     +I{xt (~, x) > x}[xt (~, x) - mt+1, ,1 ]k mt,~ .
Online Appendix ­ This Version: May 20, 2021                                                            A.11

                                                                                                (K )
Conditional on the decision rule xt ( , x) and the initial density approximation pt,~ (x), Equa-
tions (A.34) and (A.35) define a law of motion for mt, ,k and mk
                                                               t, . Combined with (A.31)
                                                               (K )
and (A.32) one obtains a transition equation for pt,~ (x).

   The characterization of the law of motion for m
                                                 ^ t, and mt, ,k involves integrals of the form
                                                       (K )
                                                h(x)pt, (x)dx.

These integrals are approximated using Gauss-Legendre quadrature. Let {xj , j }J
                                                                               j =1 be a

collection of quadrature nodes and weights, then
                                                         J
                                     (K )                               (K )
                                h(x)pt, (x)dx                  h(xj )j pt, (xj ).
                                                        j =1

Thus, for instance, we can define the quadrature approximation
                                         J
                                                                                         (K )
          mQ
           t+1, ,1   =         (~| )           I{xt (~, xj ) > x}xt (~, xj )(1 - mt,~)j pt,~ (xj )     (A.36)
                          ~             j =1


                         +I{xt (~, x) > x}xt (~, x)mt,~ .

In order to implement the integration, we are effectively discretizing the cross-sectional
                                                                       (K )
density of assets. However, rather than treating the pt, (xj ) directly as state variables
and eliminating the moments, we treat the lower dimensional vector of moments as state
variables. This imposes some parsimony on the characterization of the law of motion of the
cross-sectional densities by reducing the state space from J to K (in the numerical illustration
J = 25 and K = 3) and through (A.31) we can easily interpolate the density in-between the
grid points xj . We will subsequently work with the quadrature approximation and drop the
Q superscript.

   Recall that in our notation pK
                                t, (x) is a properly normalized density. The aggregate capital

stock can be obtained from the moments of the asset distribution:

                              Kt =        ( ) [(1 - mt, )mt, ,1 + mt, x] .                             (A.37)

In turn, the factor prices can be written as

                                       Rt = ezt Kt-1 L1- -                                             (A.38)

                                       Wt = (1 - )ezt Kt L- .                                          (A.39)
Online Appendix ­ This Version: May 20, 2021                                                                             A.12


Aggregate total factor productivity evolves according to

                                                    zt = z zt-1 + z t .                                                (A.40)

We approximate the conditional expectation in the Euler equation using Chebychev polyno-
mials:
                                                                  L
                                         (L)
                                       t ( , x) = exp                  t, ,l Tl ( (x)) ,                               (A.41)
                                                                 l=1

where Tl (·) is the l'th order Chebychev polynomial and  (x) = 2(x - x)/(¯
                                                                         x - x) - 1 transforms
                 ¯] into the interval [-1, 1]. Using the  (·) we write that asset and consumption
the interval [x, x
choices as

                                                                                               (L)        -1/
              x,t ( , x) = Wt (1 -  ) + b(1 - ) + 1 + Rt x - t ( , x)                                                  (A.42)

                   xt ( , x) = max             x, x,t ( , x)

                   ct ( , x) = Wt (1 -  ) + b(1 - ) + 1 + Rt x - xt ( , x).


   The coefficients for the Chebychev polynomial are determined by collocation. Define a
grid {xl }L                  L
          l=1 , then {t, ,l }l=1 are obtained by solving the system of equations:

             L
    exp            t, ,i Ti ( (xl ))    =            (~| )Et (1 + Rt+1 )c- 
                                                                         t+1 ~, xt (~, xl ) ,             l = 1, . . . , L.
             i=1                                ~
                                                                                                                       (A.43)



B.4       A Nonlinear Rational Expectations System

We now collect the equations that characterize the equilibrium approximation. For simplicity,
we assume that x = 0 which allows us to drop some indicator functions. Using (A.31), define

                                                                  (K )
                                                      pt, ,j = pt, (xj )

so that we can write

                     pt, ,j = fp xj ; mt, ,1 , . . . , mt, ,K , t, ,1 , . . . , t, ,K ),   j = 1, . . . , J,           (A.44)
Online Appendix ­ This Version: May 20, 2021                                                                            A.13


where the function fp (·) is given by (A.31). Using the quadrature approximations, we can
express the consistency conditions between the t, ,k s and the mt, ,k s as
                 J
   mt, ,1 =              xj j fp xj ; mt, ,1 , . . . , mt, ,K , t, ,1 , . . . , t, ,K )                               (A.45)
                j =1
                 J
   mt, ,k =              (xj - mt, ,1 )k j fp xj ; mt, ,1 , . . . , mt, ,K , t, ,1 , . . . , t, ,K ),    k = 2, . . . , K.
                j =1


This set of equations is used to determine the t, ,k s as a function of the mt, ,k s.

   Now define
                                           xt, ,j = x ( , xj ; st ),   j = 1, . . . , J.

Moreover, assume that the first value of the x grid corresponds to the lower bound on asset
holdings: x1 = 0. Then we can write
                                       J
  mt+1, ,1 =               (~| )             xt,~,j (1 - mt,~)j pt,~,j + xt,~,1 mt,~                                  (A.46)
                     ~                j =1
                                       J
  mt+1, ,k =               (~| )             [xt,~,j - mt+1, ,1 ]k (1 - mt,~)j pt,~,j + [xt,~,1 - mt+1, ,1 ]k mt,~ ,
                     ~                j =1
                         k = 2, . . . , K
                                       J
   mt+1,    =              (~| )             (1 - mt,~)j pt,~,j + I{xt,~,1 = 0}mt,~ .
                     ~                j =1


The capital stock, the factor prices, and TFP are given by

                                             Kt =             ( )(1 - mt, )mt, ,1                                     (A.47)

                                             Rt = ezt Kt-1 L1- - 

                                             Wt = (1 - )ezt Kt L-

                                              zt = z zt-1 + z            z,t .



   We now turn to the households' asset holding and consumption decision. With a slight
change in notation write
                                                                                 L
                            (L)
                            t (     , x; t, ,1 , . . . , t, ,L ) = exp               t, ,l Tl ( (x)) .
                                                                             l=1
Online Appendix ­ This Version: May 20, 2021                                                                               A.14


The desired asset holdings, actual asset holdings, and consumption can be summarized with
the following functions:

    x,t ( , x) = fx ( , x; Wt , rt , t, ,1 , . . . , t, ,L )                                                            (A.48)
                                                                                   (L)                               -1/
                   = Wt (1 -  ) + b(1 - ) + 1 + Rt x - t ( , x; t, ,1 , . . . , t, ,L )

      xt ( , x) = fx ( , x; Wt , Rt , t, ,1 , . . . , t, ,L )

                   = max         0, fx ( , x; Wt , Rt , t, ,1 , . . . , t, ,L )

      ct ( , x) = fc ( , x; Wt , Rt , t, ,1 , . . . , t, ,L )

                   = Wt (1 -  ) + b(1 - ) + 1 + Rt x - fx ( , x; Wt , Rt , t, ,1 , . . . , t, ,L ).

Thus,
                         xt, ,j = fx ( , xj ; Wt , Rt , t, ,1 , . . . , t, ,L ),    j = 1, . . . , J.                   (A.49)
                                                    (L)
Finally, we can use the definition of t ( , x):

    (L)
  t ( , xl ; t, ,1 , . . . , t, ,L )                                                                                    (A.50)
                                       -
    =              (~| )Et (1 + Rt+1 )fc (~, xl ; Wt+1 , Rt+1 , t+1, ,1 , . . . , t+1, ,L ) ,                l = 1, . . . , L.
              ~


   Overall, we obtain a rational expectations system in the following variables:

                                                   ^ t, }, Kt , Rt , Wt , zt , {xt, ,j }, {t, ,l } .
                  {pt, ,j }, {t, ,k }, {mt, ,k }, {m
                    2J        2K            2(K + 1)                     4                2J            2L

Note that (A.44) delivers 2J equations that determine {pt, ,j }; (A.45) delivers 2K equations
that implicitly determine {t, ,k }; (A.46) generates 2(K + 1) equations that determine the
evolution of {mt, ,k } and {m
                            ^ t, }; (A.47) comprises 4 equations that determine the aggregate
variables Kt , Rt , Wt , and zt ; (A.49) delivers 2J equations that determine {xt, ,j }; and, finally,
(A.50) generates 2L equations that determine {t, ,l }. Thus, the system contains as many
equations as variables.



B.5       Steady State and Local Dynamics

The model can now be solved by finding the steady state of the system defined by Equa-
tions (A.44) to (A.50), which amounts to solve the model without aggregate shocks using a
Online Appendix ­ This Version: May 20, 2021                                               A.15


projection approach. The system can then be log-linearized around the steady state and the
first-order dynamics can be obtained with a standard algorithm that solves linear rational
expectations models, as provided by DYNARE. Winberry's MATLAB code treats {mt, ,k },
{m
 ^ t, } and z as state (pre-determined) variables and includes W , R, {pt, ,j }, and {t, ,l } as
non-predetermined variables. The variables {t, ,k } and {xt, ,j } are substituted out.
Online Appendix ­ This Version: May 20, 2021                                             A.16


C      More About the Empirical Analysis

C.1     Data Construction

The observations on real per capita GDP, GDP deflator, and the unemployment rate are
downloaded from the Federal Reserve Bank of St. Louis' FRED database:
https://fred.stlouisfed.org/.
The TFP series is available from the Federal Reserve Bank of San Francisco:
https://www.frbsf.org/economic-research/indicators-data/total-factor-productivity-tfp/.
The labor share series is available from the Bureau of Labor Statistics, labor productivity
and cost measures: https://www.bls.gov/lpc/.
The CPS raw data are downloaded from
http://www.nber.org/data/cps basic.html.
The raw data files are converted into STATA using the do-files available at:
http://www.nber.org/data/cps basic progs.html.
We use the series PREXPLF ("Experienced Labor Force Employment"), which is the same
as in the raw data, and the series PRERNWA ("Weekly Earnings"), which is constructed
as PEHRUSL1 ("Hours Per Week at One's Main Job") times PRHERNAL ("Hourly Earn-
ings") for hourly workers, and given by PRWERNAL for weekly workers. STATA dictionary
files are available at:
http://www.nber.org/data/progs/cps-basic/



    We pre-process the cross-sectional data as follows. We drop individuals if (i) the em-
ployment indicator is not available; and (ii) if they are coded as "employed" but the weekly
earnings are missing. In addition, we re-code individuals with non-zero earnings as employed
and set earnings to zero for individuals that are coded as not employed. A CPS-based un-
employment rate is computed as the fraction of individuals that are coded as not employed.
By construction this is one minus the fraction of individuals with non-zero weekly earnings,
which is used to normalize the cross-sectional density of earnings. It turns out that the CPS-
based unemployment rate tracks the aggregate unemployment rate (UNRATE from FRED)
Online Appendix ­ This Version: May 20, 2021                                                 A.17


                                Figure A-1: CPS Unemployment




Notes: CPS unemployment rate (blue, solid) and aggregate unemployment rate (red, dashed).


very closely; see the left panel of Figure A-1. The levels of the two series are very similar,
but the CPS unemployment rate exhibits additional high-frequency fluctuations, possibly
due to seasonals that have been removed from the aggregate unemployment rate.


C.2     Data Transformations

We transform the raw earnings-GDP ratio, denoted by z below, using the inverse hyperbolic
sine transformation, which is given by
                                     ln(z + (2 z 2 + 1)1/2 )   sinh-1 (z )
                       x = g (z |) =                         =             .                (A.51)
                                                                   
The transformation is plotted in the center panel Figure A-2 for  = 1. Note that g (0|) = 0
and g (1) (0|) = 1, that is, for small values of z the transformation is approximately linear.
For large values of z the transformation is logarithmic:
                                       1          1       1
                            g (z |)      ln(2z ) = ln(2) + ln(z ).
                                                          
The inverse of the transformation takes the form
                                         1         1
                          z = g -1 (x|) = sinh(x) = (ex - e-x ).
                                                   2
Online Appendix ­ This Version: May 20, 2021                                                                            A.18


                          Figure A-2: Estimated Log Earnings Distributions



   Original Earnings/GDP                               Transformation                    Transformed Earnings/GDP
    1                                         4                                             1


   0.8                                        2                                            0.8


   0.6                                        0                                            0.6


   0.4                                        -2                                           0.4


   0.2                                        -4                                           0.2


    0                                         -6                                            0
     0     1        2     3       4                0         1     2    3       4            0   1         2     3       4




Notes: Center panel: inverse hyperbolic sine transformation (blue, solid) for  = 1, logarithmic transforma-
tion (red, dashed), and 45-degree line (magenta, dotted). Left and right panels: each hairline corresponds
to the estimated density of earnings for a particular quarter t, where t ranges from 1989:Q1 to 2017:Q3.


    Most of the calculations in the paper are based on px (x). But in some instances, it is
desirable to report for pz (z ). From a change of variables (omitting the ), we get

                                              pz (z ) = px (g (z ))|g (z )|,

where                                                         z
                                              1+        (2 z 2 +1)1/2                1
                                g (z ) =                                =                    .
                                           z +         (2 z 2 + 1)1/2       (2 z 2   + 1)1/2

    Whenever we do convert the estimated densities back from z to x, we recycle the density
evaluations at xj . Thus, we evaluate pz (z ) for grid points zj = g -1 (xj ), which leads to

                                           pz (zj ) = px (xj ) g (g -1 (xj )) ,

where

                                      1                                              2                                2
 g (g -1 (xj )) =                                            =                                             =                .
                        1 xj
                          (e   - e-xj )2 + 1
                                                       1/2
                                                                 (e2xj + e-2xj + 2e2xj e-2xj )
                                                                                                     1/2       exj   + e-xj
                        4


    In the left and right panels of Figure A-2 we overlay the log-spline estimates of the cross-
sectional densities. The left panel shows the density of the original earnings whereas the
right panel shows the densities of transformed earnings-to-GDP ratio which is obtained by
the change-of-variables.
Online Appendix ­ This Version: May 20, 2021                                                                                            A.19


                                        Figure A-3: Estimated a
                                                              ^k,t versus Smoothed ak,t
                   k=1                                           k=2                                        k=3
    3                                              3                                         3

    2                                              2                                         2

    1                                              1                                         1

    0                                              0                                         0

    -1                                            -1                                         -1

    -2                                            -2                                         -2

    -3                                            -3                                         -3
     1990   1995   2000   2005   2010    2015      1990   1995   2000   2005   2010   2015    1990   1995   2000   2005   2010   2015




                   k=4                                           k=5                                        k=6
    3                                              2                                         3

    2                                                                                        2
                                                   1

    1                                                                                        1
                                                   0
    0                                                                                        0
                                                  -1
    -1                                                                                       -1

                                                  -2
    -2                                                                                       -2

    -3                                            -3                                         -3
     1990   1995   2000   2005   2010    2015      1990   1995   2000   2005   2010   2015    1990   1995   2000   2005   2010   2015




                   k=7                                           k=8                                        k=9
    3                                              3                                         3

    2                                              2                                         2

                                                   1                                         1
    1
                                                   0                                         0
    0
                                                  -1                                         -1
    -1
                                                  -2                                         -2
    -2                                            -3                                         -3

    -3                                            -4                                         -4
     1990   1995   2000   2005   2010    2015      1990   1995   2000   2005   2010   2015    1990   1995   2000   2005   2010   2015




                                                                 k = 10
                                                   3

                                                   2

                                                   1

                                                   0

                                                  -1

                                                  -2

                                                  -3

                                                  -4
                                                   1990   1995   2000   2005   2010   2015


Notes: The red solid lines correspond to the smoothed ak,t series, whereas the blue dashed lines represent
the estimated series a
                     ^k,t .


C.3         Estimated versus Smoothed Coefficients

Figure A-3 overlays the estimated a
                                  ^k,t versus the smoothed ak,t 's generated as output of the
Gibbs sampler. Recall that as part of the transformation from ^ t into a
                                                                       ^t we demean and
Online Appendix ­ This Version: May 20, 2021                                                     A.20


orthogonalize the series. The discrepancy is the measurement error k,t , which is generally
small. All of the series show low frequency movements around zero in combination with
some high frequency fluctuations. By construction, the smoothed series are smoother than
the actual series.



C.4     Shock Identification

Here we provide additional details on how to identify a shock that maximizes the contribution
                                                         ¯ . Define the matrix M = 0ny ×n c , Iny
to the variance of variable i at horizons h = 1, . . . , h                               


and the vector ei that has a one in position i and zeros elsewhere such that we can write
                                                                    h-1
                        wi,t+h - E[wi,t+h ] = . . . + ei                   j
                                                                           1 tr M q + . . . .
                                                                    j =0

                   
We can now define q as the impact effect of the shock that maximizes the forecast error
                                      ¯:
variance over horizons h = 1, . . . , h
                                                      ¯
                                                      h   h-1
                      q
                            = argmax ei                         j                j
                                                                1 tr M q q M tr (1 ) ei .       (A.52)
                                                  h=1 j =0

Using the facts that x A x = tr[xx A] and tr[AB ] = tr[BA], we can rewrite the objective
function as
                                ¯
                                h    h-1
                       ei                  j               j
                                           1 tr M q q M tr 1 ei                                 (A.53)
                             h=1 j =0
                                     ¯
                                     h   h-1
                            =                  tr (ei ei )(j                   j
                                                           1 tr M )(q q )(M tr 1 )
                                    h=1 j =0
                                     ¯
                                     h   h-1
                            =                  tr (q q )(M tr j           j
                                                              1 )(ei ei )(1 tr M )
                                    h=1 j =0
                                           ¯
                                           h    h-1
                            = q                       (M tr j           j
                                                            1 )(ei ei )(1 tr M ) q
                                         h=1 j =0
                            = q Sq .

The optimization problem can therefore be expressed as Lagrangian

                                               L = q Sq - (q q - 1),                            (A.54)
Online Appendix ­ This Version: May 20, 2021                                           A.21


which leads to the first-order condition

                                           Sq = q .                                  (A.55)

At the first-order condition, we obtain that L = . Thus, the solution is obtained by finding
the eigenvector associated with the largest eigenvalue of the matrix S .



C.5     Impulse Responses: K = 10 versus K = 22

In Figure A-4 we compare bands for the impulse responses of aggregate variables to aggregate
shocks for K = 10 and K = 22. They are essentially identical.

   In Figures A-5 and A-6 we compare bands for the impulse responses of the cross-sectional
density and inequality measures to aggregate shocks for K = 10 and K = 22. While the
density responses look different, the responses of the inequality measures and percentiles
derived from these densities are very similar.
Online Appendix ­ This Version: May 20, 2021                                                            A.22




 Figure A-4: Responses of Aggregate Variables to Aggregate Shocks: K = 10 vs. K = 22

                 TFP Shock                       GDP Shock                       Empl. Shock
            3                             0.5                             1.5

                                           0
            2                                                               1
   TFP




                                         -0.5
            1                                                             0.5
                                           -1

            0                            -1.5                               0
                 10   20    30    40             10    20   30    40             10    20    30    40

                                           4                                1
            2
                                           3                              0.5
           1.5
   GDP




                                           2                                0
            1

           0.5                             1                              -0.5

            0                              0                               -1
                 10   20    30    40             10    20   30    40             10    20    30    40

                                          1.5                               0
           0.6
   Empl.




                                           1                              -0.5
           0.4

           0.2                            0.5                              -1


            0                              0                              -1.5
                 10   20    30    40             10    20   30    40             10    20    30    40


Notes: IRFs for three-standard deviation aggregate shocks (orthogonalized via Cholesky factorization; see
(40)). Panels depict responses of the log level of TFP and GDP, scaled by 100, and responses of the
employment rate in percent. The bands correspond to pointwise 10th and 90th percentiles of the posterior
distribution for K = 10. Solid blue responses are based on K = 10 (same as main text); dashed red responses
are based on K = 22.
Online Appendix ­ This Version: May 20, 2021                                                                                                                              A.23


Figure A-5: Earnings Density (Transformed Data) Response to a TFP Shock: K = 10 vs.
K = 22

                                                                                                   K = 10 (Main Text)                      K = 22 (Alternate)


                                     Horizons h = 0, . . . , 19 Horizons h = 0, . . . , 19
                                                                                               3                                     3
                  TFP [%]

                                                                                               2                                     2


                                                                                               1                                     1


                                                                                               0                                     0
                                                                                                     0   5       10       15               0    5       10       15


                                                                                             0.8                                   0.8
                  Empl. Rate [%]




                                                                                             0.6                                   0.6

                                                                                             0.4                                   0.4

                                                                                             0.2                                   0.2

                                                                                               0                                     0
                                                                                                     0   5       10       15               0    5       10       15

                                                                                             0.02                                  0.02
                  Density Response

                                          Horizon h = 0




                                                                                             0.01                                  0.01

                                                                                                0                                     0

                                                                                             -0.01                                 -0.01

                                                                                             -0.02                                 -0.02
                                                                                                  0          1        2        3        0           1        2        3

                                                                                             0.02                                  0.02
                  Density Response

                                          Horizon h = 4




                                                                                             0.01                                  0.01

                                                                                                0                                     0

                                                                                             -0.01                                 -0.01

                                                                                             -0.02                                 -0.02
                                                                                                  0          1        2        3        0           1        2        3

                                                                                             0.02                                  0.02
                  Density Response

                                          Horizon h = 8




                                                                                             0.01                                  0.01

                                                                                                0                                     0

                                                                                             -0.01                                 -0.01

                                                                                             -0.02                                 -0.02
                                                                                                  0          1        2        3        0           1        2        3


Notes: Responses to a 3-standard-deviations shock to TFP. The system is in steady state at h = -1 and the
shock occurs at h = 0. The plot depicts 10th (dashed), 50th (solid), and 90th (dashed) percentiles of the
posterior distribution. As distributional responses we depict differences between the shocked and the steady
state cross-sectional density at various horizons.
Online Appendix ­ This Version: May 20, 2021                                                       A.24


Figure A-6: Inequality Measure (Original Data) Responses to a TFP Shock: K = 10 vs.
K = 22

                                              K = 10 (Main Text)           K = 22 (Alternate)
                                        0.43                         0.43
                    Gini Coefficient
                                       0.425                        0.425

                                        0.42                         0.42

                                       0.415                        0.415

                                        0.41                         0.41
                                                  0   5   10   15              0   5   10   15

                                       44.5                         44.5
                   Fraction [%] < 1




                                        44                           44


                                       43.5                         43.5


                                        43                           43
                                               0      5   10   15           0      5   10   15

                                       0.25                         0.25
                    10th Percentile




                                       0.24                         0.24


                                       0.23                         0.23


                                       0.22                         0.22
                                               0      5   10   15           0      5   10   15

                                       1.02                         1.02
                    50th Percentile




                                       1.01                         1.01


                                         1                            1


                                       0.99                         0.99
                                               0      5   10   15           0      5   10   15

                                       2.6                          2.6
                    90th Percentile




                                       2.5                          2.5


                                       2.4                          2.4


                                       2.3                          2.3
                                              0       5   10   15          0       5   10   15


Notes: Responses to a 3-standard-deviations shock to TFP. The system is in steady state at h = -1 and
the shock occurs at h = 0. The plot depicts 10th (dashed), 50th (solid), and 90th (dashed) percentiles of
the posterior distribution.
