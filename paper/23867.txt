                             NBER WORKING PAPER SERIES




                             A THEORY OF EXPERIMENTERS

                                      Abhijit Banerjee
                                      Sylvain Chassang
                                       Sergio Montero
                                       Erik Snowberg

                                     Working Paper 23867
                             http://www.nber.org/papers/w23867


                    NATIONAL BUREAU OF ECONOMIC RESEARCH
                             1050 Massachusetts Avenue
                               Cambridge, MA 02138
                                  September 2017




We are grateful to Angus Deaton, Pascaline Dupas, Jeff Ely, Guido Imbens, Charles Manski,
Pablo Montagnes, Marco Ottaviani, Bruno Strulovici, Alexey Tetenov, Duncan Thomas, Chris
Udry, as well as audience members at Bocconi, the Cowles Econometric Conference (2016), the
ESSET Meeting at Gerzensee (2017), Emory, INSEAD, MIT, the NBER Development
Economics Summer Meeting (2016), the North-American Econometric Society Meeting (2016),
the SISL Conference at Caltech (2017), UBC, and the UCL/Cemmap workshop on Econometrics
for Public Policy (2016), for several helpful discussions. Chassang and Snowberg gratefully
acknowledge the support of NSF grant SES-1156154. The views expressed herein are those of the
authors and do not necessarily reflect the views of the National Bureau of Economic Research.

NBER working papers are circulated for discussion and comment purposes. They have not been
peer-reviewed or been subject to the review by the NBER Board of Directors that accompanies
official NBER publications.

© 2017 by Abhijit Banerjee, Sylvain Chassang, Sergio Montero, and Erik Snowberg. All rights
reserved. Short sections of text, not to exceed two paragraphs, may be quoted without explicit
permission provided that full credit, including © notice, is given to the source.
A Theory of Experimenters
Abhijit Banerjee, Sylvain Chassang, Sergio Montero, and Erik Snowberg
NBER Working Paper No. 23867
September 2017
JEL No. C90,D81

                                        ABSTRACT

This paper proposes a decision-theoretic framework for experiment design. We model
experimenters as ambiguity-averse decision-makers, who make trade-offs between subjective
expected performance and robustness. This framework accounts for experimenters' preference for
randomization, and clarifies the circumstances in which randomization is optimal: when the
available sample size is large enough or robustness is an important concern. We illustrate the
practical value of such a framework by studying the issue of rerandomization. Rerandomization
creates a trade-off between subjective performance and robustness. However, robustness loss
grows very slowly with the number of times one randomizes. This argues for rerandomizing in
most environments.

Abhijit Banerjee                              Sergio Montero
Department of Economics, E52-540              Department of Political Science
MIT                                           Harkness Hall 320
77 Massachusetts Avenue                       University of Rochester
Cambridge, MA 02139                           Rochester, NY 14627
and NBER                                      smontero@rochester.edu
banerjee@mit.edu
                                              Erik Snowberg
Sylvain Chassang                              Division of Humanities and Social Sciences
Department of Economics                       MC 228-77
New York University                           California Institute of Technology
19 West 4th Street                            Pasadena, CA 91125
New York, NY 10012                            and NBER
and NBER                                      snowberg@caltech.edu
sylvain.chassang@gmail.com
1         Introduction

The proliferation of experiments in academia, business, and public policy has been accom-
panied by spirited debates about best practices for experiment design and the statistical
analysis of experimental results. Topics of debate include pre-registration of experiment de-
signs, pre-analysis plans, the pros and cons of rerandomization, clustering, stratification, and
statistical significance testing (Bruhn and McKenzie, 2009; Deaton, 2010; Duflo et al., 2008;
Humphreys et al., 2013; Imbens, 2010; Olken, 2015; Athey and Imbens, 2016; Benjamin et
al., 2017). At the heart of these debates are differing—usually implicit—models of knowledge
generation and how people interpret experimental evidence. This paper seeks to provide a
decision-theoretic framework that may be able to guide, and help resolve, these debates. We
show that our framework is consistent with important elements of observed experimental
practice. We then use our framework to shed light on one of the less contentious open ques-
tions of experimental design, rerandomization. Finally, we discuss how our framework might
be used to address other questions about experiment design.
        Unfortunately, models of experimentation and information acquisition fail to explain why
researchers (almost always) run randomized controlled trials (RCTs; see Kasy, 2016).1 This
is due to modeling decision-makers as subjective expected utility maximizers (Savage, 1954).
As RCTs are mixed strategies over experimental assignments, they can never be strictly
optimal for such a decision-maker.
        To overcome this limitation, we model a Bayesian experimenter facing an adversarial
audience. This is equivalent to assuming an ambiguity-averse decision-maker with standard
maxmin preferences (Gilboa and Schmeidler, 1989). In our formulation, the decision-maker
maximizes a mixture of her own subjective expected utility term and the welfare of an
adversarial audience with non-common priors. Examples of such audiences abound: the
    1
    For seminal contributions to the literature on experimentation and information acquisition Rothschild
(1974); Grossman and Stiglitz (1980); Aghion et al. (1991); Bergemann and Välimäki (1996); Persico (2000);
Bergemann and Välimäki (2002, 2006).



                                                                                                          1
Food and Drug Administration for drug trials, seminar audiences and journal referees for
research papers, and governments or NGOs for development proposals.2
       The paper reports two main sets of results. The first set of results shows that RCTs can be
optimal for a decision-maker facing an adversarial audience, and clarifies the circumstances
in which this is the case. If the decision-maker places non-zero weight on satisfying her
adversarial audience, then, for sufficiently large sample sizes, it is always strictly optimal for
the decision-maker to use a RCT. Indeed, as the sample size N grows large, RCTs permit
                                                                      √
robust prior-free inference, and achieve assignment losses of order 1/ N . On the other hand,
deterministic experiments are generically strictly optimal when the sample size is small and
the decision-maker puts sufficiently high weight on her subjective expected utility.
       This set of results accords with the observed heterogeneity of experimental practice. Ran-
domized experiments tend to be used by decision-makers who put a high value on convincing
an adversarial audience (scientists, pharmaceutical companies), or when the decision-maker
can afford large samples (A/B testing in online marketing). Whenever data points are expen-
sive and the decision-maker puts little weight on satisfying an adversarial audience, optimal
experiments are deterministic as such a design optimizes the informational value of each
acquired data point (new product launches in select markets, preliminary medical research
on diseases that would otherwise result in quick and certain death).
       The second set of results applies our framework to the question of whether experimenters
should rerandomize to improve covariate balance between treatment and control groups.
Rerandomization draws multiple treatment assignments, then chooses the one that maxi-
mizes balance. For example, a medical researcher may want to ensure that treatment and
control groups are similar in terms of gender, age, race, and baseline health variables such
as blood pressure and weight (Morgan and Rubin, 2012). Despite the ease of using reran-
domization to improve balance, researchers are concerned that it may adversely affect the
   2
   The audience could also be another side of the decision-maker herself, as ambiguity aversion is a natural
way to model self-doubt.



                                                                                                          2
reliability of findings (Bruhn and McKenzie, 2009).
       The trade-offs at the heart of rerandomization are succinctly captured in our framework.
Successive rerandomizations improve balance, as captured by the subjective expected util-
ity component of preferences. However, rerandomization reduces robustness, as captured
by the adversarial component of preferences. In the extreme case where the allocation is
rerandomized until perfect balance is achieved, the allocation is effectively deterministic
and the adversarial term is always bounded away from first-best. In contrast, robustness
losses are vanishing in sample size N when the number of rerandomizations grows linearly
or sublinearly in N .
       Our framework builds on a long line of work in statistics, starting with Wald (1950).
Variants of Wald’s framework have more recently been used in economics and econometrics
to study questions of identification and model uncertainty (Manski, 2004, 2009; Kitagawa and
Tetenov, 2015; Marinacci, 2015). However, prior work has not sought to provide a positive
and normative model of experimenters.3 The prior literature falls into two broad groups:
one focuses on ambiguity aversion, the other on regret minimization. While our main results
are stated in an ambiguity-aversion framework, in Section 5 we show they extend to a regret-
minimization framework. This is important as Tetenov (2012) shows that asymmetric regret
minimization is sufficient for explaining the standard practice of null-hypothesis statistical
testing (NHST) using t-statistics. Our basic insights therefore apply directly to classical
statistical inference as well as to our more conventional decision-theoretic model.
       The paper is structured as follows. Section 2 introduces our framework. Section 3 delin-
eates the forces that determine whether running a randomized or deterministic experiment
is optimal. Section 4 studies the trade-offs involved in rerandomization. Section 5 shows
that our results extend to reference-dependent preferences, better suited to explain the use
of t-statistics in decision-making. Section 6 discusses other applications for our framework,
   3
    This paper is also related to the dormant literature in multi-Bayesian statistical decision theory (Weera-
handi and Zidek, 1981, 1983). In these models, Bayesians with conflicting preferences adopt random decision
rules, rather than randomized experiments.


                                                                                                            3
including subgroup analysis. Appendix A explores the use of reference-dependent preferences
as a foundation for t-statistics. Proofs are contained in Appendix B. Appendix C presents
simulations.



2         A Framework for Studying Experiment Design

Decisions and payoffs. A decision-maker chooses whether or not to implement a policy
that provides a treatment τ ∈ {0, 1} to a unit mass of individuals. For simplicity, we assume
that the final policy choice a ∈ {0, 1} is all-or-nothing and sets τ = a for all individuals.4
Potential outcomes for an individual with treatment status τ are random variables Y τ ∈
{0, 1}; Y = 1 is referred to as a success. Each individual has observable covariates x ∈ X ⊂
Rm that affect the distribution of outcomes Y . X is finite, and the distribution q ∈ ∆(X) of
covariates in the population is known and has full support. The probability of success given
covariate x is denoted by pτx ≡ prob(Y τ = 1|x), and, conditional on x, outcomes are i.i.d.
        The state of the world is described by the finite-dimensional vector p = (p0x , p1x )x∈X ∈
[0, 1]2X ≡ P of success probabilities pτx conditional on treatment status τ ∈ {0, 1} and
covariates x. Note that state-space P is compact, convex, and finite-dimensional. Given a
state p and a policy decision a ∈ {0, 1}, the decision-maker’s payoff u(p, a) is

                                                              X
                                         u(p, a) ≡ Ep Y a =         q(x)pax .
                                                              x∈X


   Although covariates x are observable, our framework implicitly allows for unobservable
                                                                              R
characteristics. Denoting unobserved characteristics by z, we would have pτx = pτx,z dF (z|x).
Large shifts in correlations between x and z are captured by allowing the mapping x 7→ px
to be discontinuous in x.
    4
        See Section 6 for a discussion of sub-group analysis and targeting.




                                                                                                4
Experiments and strategies. To maximize her odds of making the correct policy choice,
the decision-maker can run an experiment on N participants. For simplicity, we assume that
N is even and exogenously given. Formally, an experiment is a tuple e = (xi , τi )i∈{1,...,N } ∈
(X × {0, 1})N ≡ E. Experiment e generates outcome data y = (yi )i∈{1,...,N } ∈ {0, 1}N ≡ Y,
with yi s independent realizations of Yiτi given (xi , τi ). Throughout, we assume that N < 2|X|,
                                                                                                       1
even as we increase N . A natural special case is unique individuals: |X| = N and q(X) =              |X|
                                                                                                          .
This corresponds to settings where subjects are fixed, and the decision-maker must choose
a treatment assignment.
       The decision-maker’s strategy consists of both an experimental design E ∈ ∆(E), which
is a mixed strategy over experimental assignments, and an allocation rule α : E × Y →
∆({0, 1}), which maps experimental data (e, y) to policy decisions a ∈ {0, 1}. We denote by
A the set of such mappings.


Preferences. We consider an ambiguity-averse decision-maker with standard maxmin
preferences (Gilboa and Schmeidler, 1989). We reinterpret these preferences in a way that
is convenient for comparative static exercises. Under this interpretation, the decision-maker
has her own prior h0 and faces an adversarial audience of Bayesian stakeholders with non-
common priors.5 She chooses a strategy (E, α) to solve


                 U (E, α) ≡ λEh0 ,E [u(p, α(e, y))] + (1 − λ) min Eh,E [u(p, α(e, y))],             (DP)
                                                               h∈H



where H is a convex set of priors h ∈ ∆(P ) over states p ∈ P , and represents the set of
priors belonging to members of the audience. The decision-maker places weight λ on her
own subjective utility, and weight 1 − λ on the utility of her audience.6 When λ = 1, these
   5
     If the audience entertained a common prior h, then the decision problem would boil down to subjective
expected utility maximization for the mixed prior λh0 + (1 − λ)h.
   6
     Whenever h0 ∈ H, increasing 1 − λ also corresponds to increasing the set of priors that the decision-
maker entertains as plausible. If audience members have veto power and enjoy a common outside option,
then 1−λλ is the Lagrange multiplier placed on the audience’s individual rationality constraint.




                                                                                                         5
preferences coincide with standard subjective expected utility maximization. We sometimes
refer to this case as Bayesian.


Equivalent experiments. As successes are independent conditional on covariates, ex-
periments that differ only by a permutation of participants with identical covariates are
equivalent from a decision-making perspective.

Definition 1 (equivalent experiments). Two experiments e = (xi , τi )i∈{1,...,N } and e0 =
(x0i , τi0 )i∈{1,...,N } are equivalent, denoted by e ∼ e0 , if there exists a permutation σ : {1, . . . , N } →
                                                                              0
{1, . . . , N } of the participants’ labels such that (xi , τi ) = (x0σ(i) , τσ(i) ) for all i. The equivalence
class of an experiment e is denoted by [e].7 We denote by [E] the partition of possible experi-
ments in equivalence classes. We say that two experimental designs E and E 0 are equivalent,
denoted by E ∼ E 0 , if they induce the same distribution over [E].

Lemma 1. Whenever E ∼ E 0 , max U (E, α) = max U (E 0 , α).
                                         α∈A               α∈A


       All proofs can be found in Appendix B.


Standard RCTs. As many of our results deal with randomized controlled trials (RCTs),
it is useful to define these explicitly. A standard RCT that assigns a share π ∈ (0, 1) of
participants to treatment τ = 1, corresponds to a strategy (Erct , αrct ):

    • Erct samples N exchangeable participants labelled by i ∈ {1, · · · , N }, with covariates
      (xi )i∈{1,··· ,N } drawn according to the distribution of observable covariates q;

    • Erct assigns treatment τi = 1i≤πN ;
                                             PN              PN
    • αrct (e, y) ≡ 1ŷ1 ≥ŷ0 , where ŷ τ ≡  i=1 yi 1τi =τ    i=1 1τi =τ is the mean outcome for
      participants with treatment status τ .

   7
       It is convenient to include distributions E with support in [e] in the equivalence class of e.




                                                                                                             6
2.1     Assumption about the Audience

We impose the following limited extrapolation condition on X, N , and H: Denote by
pa ≡ x∈X q(x)pax the expected probability of success given policy a ∈ {0, 1}. Given an
    P

experiment e = (τi , xi )i∈{1,··· ,N } , denote by pe ≡ (pτxii )i∈{1,··· ,N } the subset of success rates for
participants in the experiment. Vector pe is an upper bound to the information generated
by experiment e in the sense of Blackwell (1953).

Assumption 1 (limited extrapolation). There exists ξ > 0 such that, for all e ∈ E, there
exists a prior h ∈ arg minh∈H Eh (maxa∈{0,1} pa ) such that, for almost every pe ,

                                                                            
                                          a    0                        a   1
                    min Eh        max p − p pe , Eh           max p − p pe           > ξ.
                                a∈{0,1}                       a∈{0,1}




    This imposes two important constraints on the members of the adversarial audience.
First, the information from any experiment is insufficient to fully convince every single
audience member (represented by some prior h ∈ H) of the correct policy a ∈ {0, 1}.
Second, audience members cannot be arbitrarily pessimistic; they cannot be certain that
p1 = p0 = 0.
    Note that the requirement that N < 2|X| ensures that Assumption 1 can be satisfied.
We show in Section 5 that Assumption 1 is dispensable when the decision-maker exhibits
regret aversion.



3     Optimal Design and Randomization

3.1     Bayesian Experimentation

When λ = 1, the decision-maker is a standard subjective expected utility maximizer. In this
case, it is known that deterministic experiments are weakly optimal. In fact, we show that



                                                                                                           7
for generically every prior—that is, for an open and dense set of priors under an appropriate
distance—deterministic experiments are strictly optimal when λ is close to 1.8

Proposition 2 (near-Bayesians do not randomize). If λ = 1, then for every prior h0 , there
exists a deterministic experiment e∗ solving (DP).
      For generically every prior h0 , there exist λ ∈ (0, 1) and a unique equivalence class of
experiments [e∗ ] such that for all λ > λ, a (potentially mixed) experiment E ∈ ∆(E) solves
(DP) if and only if support E ⊂ [e∗ ].

      In recent work, Kasy (2016) uses a similar result to argue that RCTs may be suboptimal.
However, his key point is that deterministic assignments are much more likely to achieve
covariate balance between treatment and control groups. Instead, we suggest that Propo-
sition 2 shows the limits of subjective expected utility maximization as a positive model
of experimenters. We argue that the decision problem defined by (DP) is more successful
at explaining the range of information acquisition strategies observed in practice. Later, in
Section 4, we study rerandomization as a non-deterministic alternative to improving balance.


3.2       Adversarial Experimentation

We now examine the case where the experimenter cares about her audience’s preferences.

Proposition 3. Take weight λ ∈ (0, 1) as given. There exists N such that for all N ≥ N ,
any optimal experiment is randomized. More precisely, the following hold:

       (i) For any N , any optimal experiment E ∗ satisfies

                                                                      r
                                                                          ln 2
                   max min Eh,E ∗ [u(p, α(e, y))] ≥ min Eh max u(p, a) −       .
                   α∈A h∈H                          h∈H    a∈{0,1}         N


  8
      We use the uniform norm on distributions: d(h, h0 ) ≡ supA⊂P      |h(A) − h0 (A)|.
                                                              A meas.




                                                                                             8
        (ii) For any N , all deterministic experiments e ∈ E are bounded away from
         first-best:

                                                                                  
                 ∀e ∈ E,   max min Eh,e [u(p, α(e, y))] < min Eh        max u(p, a) − ξ,
                           α∈A h∈H                          h∈H         a∈{0,1}



         where ξ is defined in Assumption 1.

   Point (i) shows that the efficiency loss of the optimal experiment compared to the first-
                                                        √
best decision is bounded above by a term of order 1/ N . Point (ii) shows that the loss
from a deterministic experiment is bounded below by ξ, where ξ is bounded away from zero,
and independent of N . Thus, as N grows, the optimal experiment cannot be deterministic;
therefore, it must be randomized.
       The rationale for randomization can be understood by observing that the decision-maker
is playing a zero-sum game against nature. The decision-maker first chooses an experimental
design and a decision rule. Nature then picks the prior which maximizes the chance of the
experimenter choosing the wrong policy, given the decision-maker’s experiment design. If
there is a known pattern in the choice of experimental assignments, nature can exploit it
to lower the decision-maker’s payoff. Randomization eliminates patterns that nature can
exploit. This is related to the fact that ambiguity-averse agents may have preferences for
randomization even if they exhibit risk-aversion over known lotteries (Saito, 2015).9


3.3       RCTs as a Rule of Thumb

A corollary of the proof of Proposition 3 is that the standard RCT (Erct , αrct ) (defined in
Section 2) provides a near optimal solution to decision problem (DP).
   9
     A key modeling choice here is that nature cannot observe the outcome of the decision-maker’s random-
ization before picking a prior. Kasy (2016) assumes that nature observes the outcome of the experimenter’s
randomization and then picks a prior, which renders randomization useless. We believe our assumption is
more consistent with research practice: Referees typically complain about research design, not about why
a particular observation ended up in the treatment or control group. The exception is when there is an
extreme imbalance between treatment and control on a covariate the referee considers important.


                                                                                                        9
Corollary 1. Experimentation policy (Erct , αrct ) is such that for all priors h ∈ ∆([0, 1]X ),

                                                                         s
                                                                              ln 2
                      Eh,Erct [u(p, αrct (e, y))] ≥ Eh        max u(p, a) −        ,
                                                             a∈{0,1}         2πN

where π ≡ min{π, 1 − π}.

      As this result holds for every prior h, standard RCTs allow approximately optimal
decision-making for both Bayesian and ambiguity-averse decision-makers. Thus, an RCT
can be interpreted as a rule-of-thumb that avoids the complexity of specifying the space of
priors in decision problem (DP) and deriving an optimal solution.
      Note that Corollary 1 holds even though there may be arbitrarily many covariates, some
of which have a significant impact on treatment effects, and exact balance cannot be ensured.
As outcomes are bounded, it is not possible for rare—and therefore hard to balance—
covariate realizations to have a substantial impact on payoffs. Balance in expectation is
sufficient to guarantee approximately optimal decision-making.


3.4       Positive Implications

Figure 1 maps out some positive implications of Propositions 2 and 3 for experiment design.
When sample points are scarce, or when the decision-maker does not put much weight
on satisfying her audience (λ close to 1), the optimal experiment will be deterministic,
driven by prior h0 . That is, the experimenter will focus on assigning treatment and control
observations to the participants from whom she expects to learn the most. This is the case,
for example, when a firm is implementing a costly new process at a few production sites:
The firm will focus on the places where it can learn the most. This may, for example,
involve assigning treatment to sites where success is the least likely (Banerjee et al., 2017).
Similarly, early stage medical research often does not feature randomization—especially when
treating conditions known to result in severe disability or death.10 In this case, there is no
 10
      For recent examples, see Harmon (2016) and Yuhas (2016).

                                                                                            10
             Figure 1: When to randomize? Theory matches broad patterns.


              1−λ
               λ
                                                          Drug Approval




                                          Development Economics


                        Early Stage                      Randomize
                        Medcal Research

                       Product Design

                         Do Not
                                                                      Online Marketing
                         Randomize
                                   Political Speech



                                                                                         N

adversarial audience. Scientists are trying to learn whether a particular research direction is
worth exploring.
    When the decision-maker must instead satisfy a sufficiently adversarial audience, or she
has a sufficiently large sample, she will randomize. The former is the case in scientific
research. The latter is the case for firms doing A/B testing online. Although the firm only
needs to convince itself of the effectiveness of a particular ad or UI design, observations
are so plentiful that randomization is used to effectively address internal concerns about
robustness. This is also the case for later stage medical research seeking regulatory approval:
government regulators and investors form the adversarial audience for pharmaceutical and
medical device companies.



4     Rerandomization as a Refined Rule-of-Thumb

Having established that our framework makes reasonable positive predictions about exper-
imental practice, we now use it to shed light on an open question of experimental design:

                                                                                             11
rerandomization. As noted in Section 3.3, a standard RCT is only a near-optimal solution
to (DP). In particular, it may sometimes result in an unbalanced sample that permits little
real opportunity for learning.
   This could be avoided by computing an optimal solution to (DP). For appropriate prob-
lems, the solution is a distribution over possible assignments that puts greater weight on
balanced assignments, and may put zero weight on excessively unbalanced assignments.
This distribution maintains sufficient randomization to ensure robust decision-making. Un-
fortunately, it is implausible that one could carefully and reliably elicit full preferences from
experimenters and their audience at the onset of an experiment. Computing an optimal so-
lution to (DP) is a tricky exercise, and a well designed rule-of-thumb may be more valuable.
   In practice, experimenters resolve this difficulty through rerandomization: they repeat-
edly randomize until they obtain an assignment that satisfies their balance objectives. As
Bruhn and McKenzie (2009) highlight, this practice is widespread, poorly theorized and—
in principle—a substantial deviation from one-shot randomization. Our framework can be
used to clarify the trade-offs involved in rerandomization. We argue that, used in moder-
ation, rerandomization is a valuable rule-of-thumb that provides a flexible way to improve
balance—and/or reflect ancillary design objectives—without sacrificing significant decision-
making robustness. Compared to other common approaches to ensuring balance, it has the
added benefit of carefully controlling losses in robustness.


4.1    K-rerandomized Experiments

The objective of the decision-maker, as described by (DP), can be rewritten as


                                 max λEE [B(e)] + (1 − λ)R(E).
                                 E∈∆(E)



Decision problem (DP) sets B(e) ≡ Eh0 [u(p, α(e, y))|e], capturing “balance”, and R(E) ≡
minh∈H Eh,E [u(p, α(e, y))], capturing robustness. We re-write (DP) in this form to emphasize


                                                                                              12
that our results hold for any objective function B(e) the experimenter, or other stakeholders,
might have.
       With this mapping, we define a K-rerandomized experiment EK as follows:

   1. Independently draw a set of K assignments {e1 , · · · , eK } with each ek = (xi , τi,k ) such
         that a fraction π ∈ (0, 1) of participants receives treatment τ = 1.

   2. Select the assignment e∗K ∈ argmaxe∈{e1 ,··· ,eK } B(e) that maximizes balance, breaking
         ties with a uniform draw.

   3. Run experiment e∗K , generating outcomes yK .

   4. Policy is chosen according to αrct (e∗K , yK ) ≡ 1ŷK1 ≥ŷK0 , where ŷK
                                                                             τ
                                                                               is the mean outcome
         for participants with treatment status τ .

       Rerandomization protocols may also use a stopping time to endogenously pick the num-
ber of randomizations (Morgan and Rubin, 2012). Provided the stopping time has an upper
bound K, all our results apply for this bound. However, our results show open-ended stop-
ping times may lead to significant robustness losses.


4.2       The Trade-off of Rerandomization

For any balance function, the gains from rerandomization are immediately apparent.

Remark 1. B(e∗K ) first-order stochastically dominates B(e∗K−1 ).

       The value of balance is formally and intuitively clear. In the context of statistical infer-
ence, Morgan and Rubin (2012) study the value of rerandomization when B(e) = −M (e),
in which M (e) is the Mahalanobis distance between the treatment and control samples.
They show that rerandomization leads to significantly more precise estimates of treatment
effects when outcomes come from a linear Gaussian model.11 Bungi et al. (2016) show, more
  11
    The Mahalanobis distance—defined as M (e) ≡ (x̂1 − x̂0 )0 [cov(x̂1 − x̂0 )]−1 (x̂1 − x̂0 )—is commonly used in
multivariate matching (Rubin, 1980; Cochrane and Rubin, 1973; Rubin, 1979). Outcomes follow a Gaussian
linear model when they are defined by Yiτi = hxi , βi + δτi + σεi , with εi ∼ N (0, 1).

                                                                                                               13
generally, that balance from symmetric stratification procedures also substantially increases
precision.


The Cost of Rerandomization. Although rerandomization provides clear benefits in
terms of improved balance, there are common, but vague, concerns about its potential costs.
As Bruhn and McKenzie (2009) document, this leads many researchers to use rerandomiza-
tion but not report it. Our framework clarifies the issue by showing that rerandomization can
reduce robustness, but that this cost is relevant only when the number of rerandomizations
is very large:

Proposition 4. There exists ρ > 0 such that for all N , if K ≥ 2N , then

                                                                                 
                     max min Eh,EK [u(p, α(e, y))] < min Eh            max u(p, a) − ρξ.
                       α   h∈H                             h∈H         a∈{0,1}




       Intuitively, when K is sufficiently large, the allocation becomes essentially deterministic.
Proposition 3 implies that this precludes first-best robustness.12 However, the number of
rerandomizations K needed to cause fixed losses in robustness is exponential in the sample
size.
       A moderate number of rerandomizations has little impact on robustness:

Proposition 5. Given K ≥ 2, consider a rerandomized experiment EK assigning treatment
to a proportion π ∈ (0, 1) of participants. Then for all h ∈ H,

                                                                 s
                                                                     ln K
                       Eh,EK [u(p, αRCT (e, y))] ≥ Eh max u(p, a) −       ,
                                                      a∈{0,1}         πN

where π ≡ min{π, 1 − π}.
  12
     The process by which a realized experiment e is reached is irrelevant for a Bayesian: h0 (p | e, y, e ∼ δe ) =
h0 (p | e, y, e ∼ Erct ) = h0 (p | e, y, e ∼ EK ), in which δe denotes the deterministic experiment e.




                                                                                                                14
                                                                    √
       As the additional loss from rerandomization is of order          ln K, which is less than 5 for
K ≤ 1010 , K linear in N does not change the order of magnitude of robustness losses. This
suggests the following guideline:

Suggested Guideline. Set K ≤ N .13

       Remark 1 and Propositions 4 and 5 clarify the pros and cons of rerandomization, but
do not provide a hard and fast rule. Our suggested guideline defines a range of acceptable
behavior that limits potential robustness-losses from rerandomization. Within this range,
different decision-makers may choose differently. A Bayesian decision-maker using the linear
Gaussian model studied by Morgan and Rubin (2012) should choose the largest possible
number of rerandomizations. An ambiguity-averse decision-maker entertaining a symmetric
set of possible priors may prefer to randomize only once (see Appendix C.1 for a stylized
numerical example).


4.3       Other Approaches for Increasing Balance

Rerandomization can be seen as an algorithm to bias the distribution of experimental assign-
ments towards high-balance ones. It is simpler than many matching algorithms, especially
when one wants to establish balance on multiple continuous covariates. Moreover, as our
results hold for any balance function B(e), they are also true if this function is specified after
seeing the K possible rerandomizations. As we highlight in Section 6, this degree of freedom
may be very useful in practice as a way to respond to the preferences of stakeholders and
implementation partners.
       It is instructive to relate rerandomization to an experiment design that ensures balance
in a more direct way: by randomizing conditional on strata. Formally, the experimenter
first defines a set of acceptable assignments E† ⊂ E. Then, an assignment is drawn from
  13
   The probability that the rerandomized assignment will be in the top 5% most balanced is 1−0.95K > 99%
when K = 100. Thus, experimenters may wish to limit the number of rerandomizations to 100, even if N is
much larger (Banerjee et al., 2017).


                                                                                                     15
E† with uniform probability. This procedure involves two difficulties. First, if E† is de-
fined implicitly—for example, the set of all assignments whose balance is above a certain
threshold—computing it may be quite difficult. Second, this procedure obfuscates potential
robustness costs. Indeed, if the set of acceptable assignments E† turns out to be small,
the intuition underlying Proposition 4 suggests that robustness will be bounded away from
first-best.14
       Our framework can be used to explicitly evaluate the potential robustness costs of such
approaches. Note that the procedure described above sets B(e) ≡ 1e∈E† . Define EE† as the
randomized experiment that picks an assignment e ∈ E† with uniform probability. Finally,
let pE† > 0 denote the probability that a uniformly chosen assignment e ∈ E belongs to
E† . Note that computing p† may be difficult, especially for complex or opaque matching
algorithms. In that case, Monte Carlo simulations may provide an approximate value for
pE† .

Corollary 2. For all h ∈ H,

                                                                                       s
                                                                              1              ln K†
            Eh,EE† [u(p, αRCT (e, y))] ≥ Eh     max u(p, a) − min
                                                a∈{0,1}          K† ∈N 1 − (1 − p† )K†        πN


       This implies that a stratification or matching procedure will come at a limited cost of
robustness if an acceptable assignment can be reached with high probability within a small
number of rerandomizations.



5        Extension to Reference Dependent Preferences
  14
    This may occur when an experimenter uses a matching algorithm to achieve balance across several
continuous covariates. Note that stratification and matching can considerably improve the precision of
estimates (Athey and Imbens, 2016; Bungi et al., 2016). However, it is important to assess whether a proposed
design limits the set of possible assignments so severely that it causes significant losses in robustness.




                                                                                                          16
It has been shown that decision problem (DP) does not rationalize the use of null-hypothesis
statistical testing (NHST) using t-statistics. For this, we need reference-dependent prefer-
ences with the status quo as the reference point (Tetenov, 2012).15 As most researchers use
NHST, it is important to extend our main results to such reference-dependent preferences.
       Interestingly, this extension also allows us to dispense with the limited extrapolation
assumption. One of the key features of this assumption is to ensure that learning is still
possible even for the worst-case prior for any experimental design. Without this constraint,
the worst prior would always put unit mass on the probability of success being zero, re-
gardless of the policy choice. However, when considering regret minimization, nature favors
environments in which the decision-maker can make an incorrect decision—otherwise there
is no possibility of regret. As a result, under regret aversion, there is always a value for
information even at the unconstrained worst-case prior.
       Let ∆a ≡ pa − p1−a denote true expected outcome differences between action a ∈ {0, 1}
and the alternative. We consider a decision-maker who seeks to solve


                           max λEh0 [wα (∆α )] + (1 − λ) min Eh [wα (∆α )].                          (DP0 )
                            E,α                              h∈H



in which, for all a ∈ {0, 1},


                          wa (∆a ) = ∆a + κa × ∆a 1∆a <0 ,       with κa > 0.


In words, the decision-maker cares about improvements rather than absolute levels, and is
κa > 0 implies she is particularly averse to making wrong choices. Note that H in (DP0 ) is
now the set of all priors over P . For simplicity, we assume N = |X|, so that each subject is
unique.16
  15
    See Appendix A as well as Tetenov (2012) for micro-foundations of the standard approach to NHST.
  16
    Our results extend to the case when N < 2|X|, as before. Moreover, our analysis applies more generally
to functions wa that are strictly increasing and concave in ∆a . We restrict wa to the form above to clarify
the relationship with the prior literature.



                                                                                                         17
       We show in Appendix A that this class of preferences rationalizes the use of t-statistics
whenever κ1 > κ0 , that is, when a preference for success is not symmetric with respect to
the policy choice a. In addition it coincides with pure regret-averse preferences when κ0 and
κ1 grow large.17
       The conditions under which deterministic and randomized experiments are optimal are
qualitatively unchanged:

Proposition 6. Consider a decision-maker solving Problem (DP0 ):

        (i) For generically every prior h0 , there exists λ ∈ (0, 1) such that, for all λ > λ,
         it is optimal to use a deterministic experiment.

        (ii) For every h0 and every λ ∈ (0, 1), as N becomes arbitrarily large, determin-
         istic experiments remain bounded away from efficiency, and randomized experi-
         ments are strictly optimal.

       Additionally, the near-optimality of K-randomized trials continues to hold:

Proposition 7. There exists M > 0 such that for every prior h ∈ H,

                                                                               s
                                                                                   ln K
                Eh wa (∆a ) e ∼ EK , a ∼ αRCT ≥ Eh              max wa (∆a ) − M
                                            
                                                                                        .
                                                               a∈{0,1}              πN




6        Discussion

The ambition of this paper is to propose a decision-theoretic framework that takes seriously
the concerns of experimenters, and can help clarify current experimental practices as well as
resolve open debates. In this final section, we discuss further implications of our framework,
and preview other possible applications.
  17
    Regret-averse preferences have received extensive attention from statisticians and econometricians (Wald,
1950; Manski, 2004, 2009; Kitagawa and Tetenov, 2015). However, failure of transitivity can reduce their
appeal (see, for example, Marinacci, 2015).

                                                                                                          18
Why randomize? Our analysis clarifies the circumstances in which randomization is opti-
mal: when robustness matters and the sample size is large. When robustness considerations
are motivated by an adversarial audience with non-common priors, randomization can be
interpreted as a way to let parties with diverging priors agree on a process. Indeed, stake-
holders with divergent priors need not be satisfied by any given deterministic experiment:
there may always exist a prior under which the experiment’s design is flawed. In contrast,
running a randomized experiment guarantees each stakeholder that, in expectation, the final
decision will be optimal from her perspective. However, there is a tension here: when the
assignment is revealed, some stakeholders may wish to change it ex post.
   Whether robustness is motivated by an external audience, or internal doubts, our analysis
highlights the importance of actually randomizing. An experimenter that adopts a protocol
that is only “nearly” random, such as assignment based on time of day of an experimental
session (see Green and Tusicisny, 2012, for a critique), or the first letter of an experimental
subject’s name (as was the case in the deworming study of Miguel and Kremer, 2004; see
Deaton, 2010 for a critique), can always find a skeptical prior in her audience. Randomization
provides a defense against the most skeptical priors; near-randomization does not.


Rerandomization as an additional degree of freedom. Our framework also clarifies
the trade-offs of rerandomization: it improves subjective balance, but comes at the expense of
robustness. However, the loss in robustness from rerandomization grows slowly in the number
of times we rerandomize. As a result, applied in moderation, rerandomization provides a
useful degree of freedom for experimenters who have subjective preferences over balance.
   While pre-specifying the objective function used in rerandomization has the added benefit
of permitting randomization inference tests (Fisher, 1935; Morgan and Rubin, 2012; Young,
2016,; see Appendix C.2.3 for examples), we emphasize that it is not a requirement for our
results to hold. Indeed, Proposition 5 remains true if the balance function B(e) is specified
after experimental assignments {e1 , · · · , eK } are drawn.


                                                                                            19
       This suggests a novel use of rerandomization: as a way to let stakeholders, such as imple-
mentation partners, express preferences over assignments. The experimenter may draw K
treatment assignments in advance and let her implementation partners pick their preferred
assignment. This process could be used with any stakeholder, including regulators, funders,
or the communities from which experimental participants are drawn. These stakeholders
often have equity concerns and distributional preferences. They may further care about
targeting treatment to those they believe will benefit the most, or may simply dislike ran-
domization and wish to exert some control over assignment. The ability to at least partially
accommodate the preferences of stakeholders by letting them pick their preferred assignment
among K options may help build good will and ensure cooperation.18


Extending the framework: Subgroup analysis. While we believe that our framework
is well suited to extensions designed to answer other important questions about experimental
practice. We illustrate this by providing an outline of how our framework may be extended
to address another important methodological question: sub-group analysis.
       Consider a partition of the population into subgroups G ∈ G where G is a partition of
X. Treatment and policy α may now be targeted by subgroup. Assignment α becomes
a mapping from experimental outcomes (e, y) to a distribution over targeted assignments
a = (aG )G∈G ∈ {0, 1}G . The decision-maker’s problem is now:


                         max λEh0 ,E,α [u(p, a)] + (1 − λ) min Eh,E,α [u(p, a)]                  (DP00 )
                            E,α                            h∈H



                                    q(x)paxG .
                    P       P
where u(p, a) =       G∈G     x∈G

       This framework can provide guidelines on how finely to target treatment as a function
of the data and sample size. An ambiguity-averse decision-maker would not want to tailor
assignments based on within-group treatment effects when the number of groups G ∈ G is
  18
     Constraints from implementation partners led Miguel and Kremer (2004) to assign treatment alphabet-
ically, eliciting concerns from Deaton (2010).


                                                                                                     20
of order N . If treatment effects are constant across groups, targeting leads to inefficient
treatment choices for a non-vanishing share of the population. A Bayesian decision-maker
putting sufficient weight on treatment effects being constant or correlated across groups
would come to the same conclusion. On the other hand, if the number of groups is small
compared to N , and the decision-maker’s subjective prior entertains the possibility that the
optimal treatment is different across groups, then the solution to (DP00 ) will target by group
(and approach first-best efficiency).


   More generally, we believe that related decision-theoretic frameworks are needed to ad-
dress the trickier aspects of experiment design. For example, if a random, uninformed
statement is included in a pre-analysis plan, should this affect inference? It seems logical
that the answer would be no, but this calls into question the entire exercise. Or, why should
formulating an additional hypothesis affect our confidence in the analysis of others? Yet,
this is the impact of corrections for multiple hypotheses testing. These questions, as well as
others, await a rigorous treatment with solid decision-theoretic foundations.




                                                                                            21
References
Aghion, Philippe, Patrick Bolton, Christopher Harris, and Bruno Jullien, “Opti-
 mal Learning by Experimentation,” The Review of Economic Studies, 1991, 58 (4), 621–
 654.

Athey, Susan and Guido Imbens, “The Econometrics of Randomized Experiments,”
 arXiv preprint arXiv:1607.00698, 2016.

Banerjee, Abhijit, Sylvain Chassang, and Erik Snowberg, “Decision Theoretic Ap-
 proaches to Experiment Design and External Validity,” in Esther Duflo and Abhijit Baner-
 jee, eds., Handbook of Field Experiments, Elsevier, 2017, pp. 141–174.

Benjamin, Daniel, James Berger, Magnus Johannesson, Brian Nosek, Eric-
 Jan Wagenmakers, Richard Berk, Kenneth Bollen, Bjorn Brembs, Lawrence
 Brown, and Colin Camerer, et al., “Redefine Statistical Significance,” Nature Human
 Behaviour, 2017, forthcoming.

Bergemann, Dirk and Juuso Välimäki, “Learning and Strategic Pricing,” Econometrica,
 September 1996, 64 (5), 1125–1149.

   and , “Information Acquisition and Efficient Mechanism Design,” Econometrica, 2002,
  70 (3), 1007–1033.

   and    , “Bandit Problems,” 2006. Cowles Foundation discussion paper.

Blackwell, David, “Equivalent Comparisons of Experiments,” The Annals of Mathematical
  Statistics, 1953, 24 (2), 265–272.

Bruhn, Miriam and David McKenzie, “In Pursuit of Balance: Randomization in
 Practice in Development Field Experiments,” American Economic Journal: Applied Eco-
 nomics, 2009, 1 (4), 200–232.

Bungi, Federico A., Ivan A. Canay, and Azeem M. Shaikh, “Inference under
 Covariate-Adaptive Randomization,” 2016. mimeo. Duke University.

Cochrane, William G. and Donald B. Rubin, “Controlling Bias in Observational Stud-
 ies,” Sankhyā: The Indian Journal of Statistics, Series A, 1973, 35 (4), 417–446.

Deaton, Angus, “Instruments, Randomization, and Learning about Development,” Jour-
 nal of Economic Literature, June 2010, 48 (2), 424–455.

Duflo, Esther, Rachel Glennerster, and Michael Kremer, “Using Randomization in
 Development Economics Research: A Tool Kit,” in T. Paul Schultz and John Strauss, eds.,
 Handbook of Development Economics, Vol. 4, Amsterdam: Elsevier, 2008, pp. 3895–3962.



                                                                            References–1
Fisher, Ronald Aylmer, The Design of Experiments, Edinburgh and London: Oliver &
  Boyd, 1935.
Gilboa, Itzhak and David Schmeidler, “Maxmin Expected Utility with a Non-Unique
 Prior,” Journal of Mathematical Economics, 1989, 18 (2), 141–153.
Green, Donald P and Andrej Tusicisny, “Statistical Analysis of Results from Labora-
 tory Studies in Experimental Economics: A Critique of Current Practice,” 2012. Columbia
 University, mimeo.
Grossman, Sanford J and Joseph E Stiglitz, “On the Impossibility of Informationally
 Efficient Markets,” The American Economic Review, June 1980, 70 (3), 393–408.
Harmon,    Amy,      “After Long Fight,       Drug Gives Sudden Reprieve,”
 The New York Times,         Februrary 22,     2016.         Published online at:
 http://www.nytimes.com/2010/02/23/health/research/23trial.html.
Humphreys, Macartan, Raul Sanchez de la Sierra, and Peter Van der Windt,
 “Fishing, Commitment, and Communication: A Proposal for Comprehensive Nonbinding
 Research Registration,” Political Analysis, 2013, 21 (1), 1–20.
Imbens, Guido W, “Better LATE than Nothing: Some Comments on Deaton (2009) and
  Heckman and Urzua (2009),” Journal of Economic Literature, June 2010, 48 (2), 399–423.
Kasy, Maximilian, “Why Experimenters Might not Always Want to Randomize, and what
 they Could Do Instead,” Political Analysis, 2016, 24 (3), 324–338.
Kitagawa, Toru and Aleksey Tetenov, “Who should be Treated? Empirical Welfare
 Maximization Methods for Treatment Choice,” 2015. Collegio Carlo Alberto, mimeo.
Luenberger, David G., Optimization by Vector Space Methods, New York: John Wiley &
 Sons, 1969.
Manski, Charles F., “Statistical Treatment Rules for Heterogeneous Populations,” Econo-
 metrica, 2004, 72 (4), 1221–1246.
  , “The 2009 Lawrence R. Klein Lecture: Diversified Treatment under Ambiguity,” Inter-
  national Economic Review, 2009, 50 (4), 1013–1041.
Marinacci, Massimo, “Model Uncertainty,” Journal of the European Economic Associa-
 tion, 2015, 13 (6), 1022–1100.
McDiarmid, Colin, “On the Method of Bounded Differences,” Surveys in Combinatorics,
 1989, 141 (1), 148–188.
Miguel, Edward and Michael Kremer, “Worms: Identifying Impacts on Education and
 Health in the Presence of Treatment Externalities,” Econometrica, January 2004, 72 (1),
 159–217.

                                                                           References–2
Morgan, Kari Lock and Donald B. Rubin, “Rerandomization to Improve Covariate
 Balance in Experiments,” The Annals of Statistics, 2012, 40 (2), 1263–1282.

Olken, Benjamin A., “Promises and Perils of Pre-Analysis Plans,” The Journal of Eco-
 nomic Perspectives, 2015, 29 (3), 61–80.

Persico, Nicola, “Information Acquisition in Auctions,” Econometrica, 2000, 68 (1), 135–
 148.

Rothschild, Michael, “A Two-Armed Bandit Theory of Market Pricing,” Journal of Eco-
 nomic Theory, 1974, 9 (2), 185–202.

Rubin, Donald B., “Using Multivariate Matched Sampling and Regression Adjustment to
 Control Bias in Observational Studies,” Journal of the American Statistical Association,
 1979, 74 (366a), 318–328.

  , “Bias Reduction using Mahalanobis-metric Matching,” Biometrics, 1980, 36 (2), 293–298.

Saito, Kota, “Preferences for Flexibility and Randomization under Uncertainty,” The
  American Economic Review, 2015, 105 (3), 1246–1271.

Savage, Leonard J., The Foundations of Statistics, Courier Corporation, 1954.

Tetenov, Aleksey, “Statistical Treatment Choice Based on Asymmetric Minimax Regret
  Criteria,” Journal of Econometrics, 2012, 166 (1), 157–165.

Wald, Abraham, Statistical Decision Functions, New York: Wiley, 1950.

Weerahandi, Samaradasa and James V. Zidek, “Multi-Bayesian Statistical Decision
 Theory,” Journal of the Royal Statistical Society. Series A (General), 1981, 144 (1), 85–93.

   and , “Elements of multi-Bayesian decision theory,” The Annals of Statistics, 1983, 11
  (4), 1032–1046.

Young, Alwyn, “Channelling Fisher: Randomization Tests and the Statistical Insignifi-
 cance of Seemingly Significant Experimental Results,” 2016. mimeo., London School of
 Economics.

Yuhas, Alan, “Cancer Researchers Claim ’Extraordinary Results’ using T-
 cell Therapy,” The Guardian, February 15, 2016.              Published online at:
 https://www.theguardian.com/science/2016/feb/15/cancer-extraordinary-results-t-
 cell-therapy-research-clinical-trials.




                                                                               References–3
Online Appendix—Not Intended for Publication


A        Rationalizing t-statistics

A primary goal of this paper is to provide a suitable positive model of experimental practice
that can be used to examine and guide innovations. However, decision problem (DP) is
incompatible with hypothesis testing using t-statistics, a mainstay of experimental practice.
The raw treatment effect—that is, the difference in average outcomes ∆1 ≡ p1 − p0 —is
sufficient for near-optimal decision-making.
      This appendix describes a class of experimenter preferences that rationalize the use of
t-statistics. Hypothesis testing favors implementation of the status quo (or null) treatment
a = 0. We first clarify that standard preferences (including risk-aversion) do not rationalize
t-statistics. We then turn to reference-dependent preferences.
      Ambiguity aversion does not play a role in this argument. We consider a decision-
                                                                 2
maker with independent Gaussian posteriors N (p̂a , σNa ) over the mean outcome pa of action
a ∈ {0, 1}.1 A risk-neutral Bayesian decision-maker solving maxa∈{0,1} E[pa ] will simply take
action a = 1 if and only if p̂1 − p̂0 > 0. However, the t-statistic for a given treatment effect
is given by

                                                 √  p̂1 − p̂0
                                            t≡    Np 2         .                                     (1)
                                                      σ0 + σ12

Thus, decision rules that choose a = 1 if and only if t > t > 0 are suboptimal. To see this,
note that there always exists σ0 large enough to cause the decision-maker to stick with a = 0
regardless of the estimated treatment effect.
                            2
  1                        σa
      Parameters p̂a and   N    could be derived from a standard Gaussian learning model.




                                                                                       Online Appendix–1
Risk-aversion over policy outcomes. A natural supposition is that risk aversion may
drive the reliance on hypothesis testing using t-statistics. However, this is not the case. To
show this, we assume (w.l.o.g.) that σ0 < σ1 , and consider a decision-maker who wants to
solve maxa∈{0,1} E [Γ(pa )] where Γ is thrice continuously differentiable and concave. For N
large, the second order development of E [Γ(pa )] is

                       1 00     σ2                                        Γ(p̂1 ) − Γ(p̂0 )
 E [Γ(pa )] = Γ(p̂a ) − Γ (p̂a ) a implying sufficient statistic θ = 2N 00 1 2                   .
                       2        N                                      Γ (p̂ )σ1 − Γ00 (p̂0 )σ02

                                                                                               0
                                                                                           1 Γ
As σ0 < σ1 , the decision-maker will choose policy a = 1 whenever θ > γ, where γ =         2 Γ00
                                                                                                 .   In
the special case where Γ is quadratic, θ reduces to

                                            p̂1 − p̂0
                                         θ=N 2        .
                                            σ1 − σ02

This differs significantly from a t-statistic: mean treatment effect p̂1 − p̂0 is scaled by the
difference of variances, rather than the sum of standard deviations. Indeed, risk-aversion
means that the decision-maker values certainty (a small variance in outcomes) as well as
a higher mean outcome. Variance—rather than standard deviation—plays a role as Γ is
smooth, and can be approximated by a 2nd order polynomial.


Reference-dependent preferences. The preceding discussion suggests that hypothesis
testing can only be motivated by reference-dependent preferences that treat a = 0 and a = 1
asymmetrically (see Tetenov, 2012). Let ∆a ≡ pa − p1−a . Consider a decision-maker who
seeks to solve
                                         max E[wa (∆a )],                                            (2)
                                        a∈{0,1}


where
                         ∀a ∈ {0, 1},    wa (∆a ) = ∆a + κa × ∆a 1∆a <0



                                                                              Online Appendix–2
with κ1 > κ0 ≥ 0.

Lemma A.1. Consider a reference-dependent agent solving (2). The optimal-decision rule
takes the form t > t∗ , with t∗ > 0.

                    1 −p1
                                                         p                 
Proof. Let t ≡ √p                 1         0
                             . As p − p ∼ N p̂1 − p̂0 ,     σ02   +   σ12       , it follows that t ∼ N (t, 1). As
                  σ02 +σ12

both w0 and w1 are positively homogeneous of degree 1, the decision-maker chooses a = 1 if
and only if:

                                  q              q          
           1         0
                                      2    2          2    2
    E w1 (∆ ) − w0 (∆ ) > 0 ⇐⇒ Et w1 t σ0 + σ1 − w0 −t σ0 + σ1 t > 0
                                                        
                                       ⇐⇒ Et w1 t − w0 −t |t > 0

                                       ⇐⇒ t > t∗

                                           
for some value of t. Note that w1 t − w0 −t = (2 + κ0 )t + (κ1 − κ0 )t1t<0 . As κ1 > κ0 it
                                                                               
follows that w1 t −w0 −t is concave in t. This implies that Et w1 t − w0 −t |t = 0 < 0,
so that t∗ > 0.




B     Proofs

Proof of Lemma: By the Minimax Theorem (Luenberger, 1969), the decision-maker’s
indirect utility from running experiment E can be written as


                        V (E) ≡ max U (E, α) = max min0 Eh,E [u(p, α(e, y))]
                                      α∈A           α∈A h∈H

                                 = min0 max Eh,E [u(p, α(e, y))].
                                   h∈H α∈A




                                                                                            Online Appendix–3
Given h, the decision-maker’s payoff from running experiment E can be written as
                                                                   "                                 #
                                                X                      X
          max Eh,E [u(p, α(e, y))] = max               E(e)Ep∼h              prob(y|p, e)u(p, α(e, y))
           α∈A                            α∈A
                                                 e∈E                   y∈Y
                                          X            X
                                      =         E(e)         max Ep∼h [prob(y|p, e)u(p, a)]
                                                             a∈{0,1}
                                          e∈E          y∈Y
                                          X
                                      =         E(e)v(h, e),
                                          e∈E


                            maxa∈{0,1} Ep∼h [prob(y|p, e)u(p, a)]. As v(h, e0 ) = v(h, e) ≡ v(h, [e])
                    P
where v(h, e) ≡         y∈Y

for all e0 ∈ [e], it follows that V (E) = minh∈H 0 [e]∈[E] E([e])v(h, [e]). Thus, if E and E 0 induce
                                                  P

the same distribution over [E], V (E) = V (E 0 ).                                                          


Proof of Proposition 2: We begin by showing that deterministic experiments are always
weakly optimal for a Bayesian decision-maker. The decision-maker’s indirect utility from
running experiment E can be written as

                                                                 X
                              max Eh0 ,E [u(p, α(e, y))] =             E(e)v(h0 , e),
                              α∈A
                                                                 e∈E


where v(h0 , e) is the indirect utility from decision-making given realized experiment e:
                                                                                             ∗
            P
v(h0 , e) ≡    y∈Y prob(y|e) maxa∈{0,1} Ep∼h0 [u(p, a)|e, y]. Any deterministic experiment e

solving maxe∈E v(h0 , e) is optimal. More strongly, E solves (DP) if and only if support E ⊂
argmax v(h0 , e).
  e∈E
   To show that deterministic experiments are generically strictly optimal, we begin by
showing that argmax[e]∈[E] v(h0 , [e]) is generically a singleton for λ = 1. We first show that
the set of priors h0 such that there is a uniquely optimal equivalence class of experiments is
open. Suppose that [e0 ] is uniquely optimal under h0 . As E is finite, there exists η > 0 such
that v(h0 , [e]) < v(h0 , [e0 ])−η for all [e] 6= [e0 ]. As v(h, e) is continuous in h, this implies that



                                                                                            Online Appendix–4
there exists a neighborhood H0 of h0 such that, for all h ∈ H0 , v(h, [e]) < v(h, [e0 ]) − η/2.
Hence, [e0 ] is the uniquely optimal design for all priors h ∈ H0 .
   We now prove that the set of priors h0 such that there is a uniquely optimal equivalence
class of experiments is dense. The proof is by induction on the number of equivalence classes
[e0 ] in argmax[e]∈[E] v(h0 , [e]). We show that if there exist n such equivalence classes, then in
any neighborhood of h0 there exists a prior h such that there are at most n − 1 equivalence
classes in argmax[e]∈[E] v(h, [e]).
   Indeed, assume that [e0 ] 6= [e1 ] both belong to argmax[e]∈[E] v(h0 , [e]). For θ > 0, consider
the polynomial Mθ (p) in p ∈ P defined by


                   Mθ (p) = v ((1 − θ)h0 + θp, [e0 ]) − v ((1 − θ)h0 + θp, [e1 ]) ,


where (1 − θ)h0 + θp denotes the mixture probability measure that places mass 1 − θ on h,
and mass θ on the Dirac mass at p. As [E] is finite, for all θ > 0 small enough, it must be
that
                        argmax v((1 − θ)h0 + θp, [e]) ⊂ argmax v(h0 , [e]).
                         [e]∈[E]                            [e]∈[E]


Consider such a θ > 0. The fact that [e0 ] 6= [e1 ] implies that Mθ (p) is not identically equal
to 0. Hence, there exists p such that v ((1 − θ)h0 + θp, [e0 ]) 6= v ((1 − θ)h0 + θp, [e1 ]). This
implies that the inductive step holds at prior h̃ = (1 − θ)h0 + θp. Using the fact that
[E] is finite and v(h, [e]) is continuous in h, this implies that the inductive step holds at a
prior that admits a density against the Lebesgue measure. Thus, when λ = 1, deterministic
experiments are generically strictly optimal.
   We now consider the case of λ < 1. Given λ, h, and [e], as the decision-maker’s utility




                                                                                Online Appendix–5
takes values in [0, 1], letting α0 ∈ argmaxα∈A Eh0 ,e [u(p, α(e, y))] we have


   v(λh0 + (1 − λ)h, [e]) ≤ λv(h0 , [e]) + (1 − λ)v(h, [e]) ≤ v(h0 , [e]) + (1 − λ)                         and

   v(λh0 + (1 − λ)h, [e]) ≥ λv(h0 , [e]) + (1 − λ)Eh,e [u(p, α0 (e, y))] ≥ v(h0 , [e]) − (1 − λ).


As there are finitely many experiments, if [e0 ] is the unique maximizer of v(h0 , [e]), there
exists η > 0 such that, for all [e] 6= [e0 ], v(h0 , [e0 ]) > v(h0 , [e]) + η. Together, this implies
that there exists λ ∈ (0, 1) such that, for all λ > λ, objective (DP) is maximized at E if and
only if support E ⊂ [e0 ].                                                                                              


Proof of Proposition 3: To establish point (i) and Corollary 1, we use the standard RCT
(Erct , αrct ). Losses L(p) from first best, given state of the world p, are defined as


                                L(p) ≡ max pa − Ep,Erct prob(1y1 −y0 >0 ) .
                                                                        
                                           a∈{0,1}



By symmetry, it suffices to treat the case where p1 − p0 > 0. In this case, we have L(p) =
(p1 − p0 )probp,Erct (y 1 − y 0 ≤ 0). The probability of choosing the suboptimal policy can be
bounded using McDiarmid’s inequality.2 By applying McDiarmid’s inequality to f (y) ≡
   1
       PN         0    1
                         PπN 1
(1−π)N  i=πN +1 y i − πN  i=1 yi , we obtain




              probp,Erct (y 1 − y 0 ≤ 0) = probp,Erct y 0 − y 1 − (p0 − p1 ) ≥ (p1 − p0 )
                                                                                         
                                                                  !
                                                     2(p1 − p0 )2
                                         ≤ exp − 1              1
                                                    (1−π)N
                                                           + πN
                                         = exp −2π(1 − π)N (p1 − p0 )2
                                                                          


                                         ≤ exp −πN (p1 − p0 )2 ,
                                                                  

   2
     McDiarmid (1989): Let X1 , . . . , Xn be independent random variables, with Xk taking values in a set Ak
for each k. Suppose that the (measurable) function f : ×k Ak → R satisfies |f (x) − f (x0 )| ≤ ck whenever x
and x0 differPonly in the kth coordinate. Then, for any t > 0, prob (f (X1 , . . . , Xn ) − E[f (X1 , . . . , Xn )] ≥ t) ≤
exp −2t2 / k c2k .


                                                                                                Online Appendix–6
where the last inequality follows from 2π(1 − π) ≥ π ≡ min{π, 1 − π}. For any a > 0, the
mapping x 7→ x exp(−ax2 ) is ln-concave and maximized at x = (2a)−1/2 . This implies that

                                                      s               s
                                                          exp(−1)          ln 2
                     max pa − Ep,Erct p1y1 −y0 >0 ≤
                                                
                                                                  ≤             .             (3)
                    a∈{0,1}                                 2πN           2πN

An analogous argument delivers (3) also for the case where p1 − p0 ≤ 0. Hence, given any
h ∈ H,                                                                s
                                    
                                                                         ln 2
                   Eh     max u(p, a) − Eh,Erct [u(p, αrct (e, y))] ≤         .
                         a∈{0,1}                                        2πN

Setting π = 1/2 yields point (i) and the tightest bound.
   To establish point (ii), fix a deterministic experiment e ∈ E. From the Limited Extrap-
olation Assumption, there exists h ∈ H such that for almost every pe ,
                                                         
                              a    0                   a  1
            min Eh max p − p pe , Eh max p − p pe                > ξ. Hence,
                      a∈{0,1}                 a∈{0,1}
                                                                      
                max Eh,e [u(p, α(e, y))] ≤ Eh,e max Eh,e [u(p, a)|pe ]
                  α                               a∈{0,1}
                                                            
                                          ≤ Eh,e max u(p, a) − ξ.
                                                      a∈{0,1}



                                                                                               


Proof of Proposition 4: Consider an experiment e† ∈ argmaxe∈support EK B(e). As the
total number of subsets of {1, · · · , N } is equal to 2N , the number of experiments that assign
treatment to πN participants out of N is necessarily less than or equal to 2N . Hence the
                                                                                  K
probability that the kth rerandomized trial selects e† is at least ρ ≡ 1 − 1 − 2−N . For
K ≥ 2N ,


                        ρ ≥ 1 − exp 2N ln 1 − 2−N
                                                    
                                                         ∼ 1 − exp(−1) > 0.




                                                                                Online Appendix–7
Hence, there exists ρ > 0 such that, for all N , rerandomized experiment EK selects deter-
ministic experiment e† with probability at least ρ.
   The proof of Proposition 3 implies that there exists h† ∈ H such that
                                                                       
             ∀e ∈ E, max Eh† ,e [u(p, α(e, y))] ≤ min Eh max u(p, a) ,
                      α∈A                           h∈H     a∈{0,1}
                                                                       
                                          †
                 and max Eh† ,e† [u(p, α(e , y))] ≤ min Eh max u(p, a) − ξ.
                      α∈A                           h∈H     a∈{0,1}
                                                                       
          Hence, max min Eh,EK [u(p, α(e, y))] ≤ min Eh max u(p, a) − ρξ.
                    α∈A h∈H                            h∈H      a∈{0,1}



                                                                                               


Proof of Proposition 5: Denote by (y 0,k , y 1,k ) the sample average of outcomes by treatment
group for experiment ek , and by (y ∗0 , y ∗1 ) the sample average of outcomes by treatment group
for the experimental design e∗K selected by rerandomized experiment EK .
    Losses L(p) from first best given state of the world p are defined as L(p) ≡ maxa∈{0,1} pa −
                        
Ep,EK prob(1y∗1 −y∗0 >0)‘ . By symmetry, it suffices to treat the case where p1 − p0 > 0. In this
case, we have


                  L(p) = (p1 − p0 )probp,EK (y ∗1 − y ∗0 ≤ 0)
                                                                          
                           1    0
                       ≤ (p − p )probp,EK         min y 1,k − y 0,k ≤ 0
                                                k∈{1,...,K}
                                       ( K                                    )
                                             X
                       ≤ (p1 − p0 ) min 1,        probp,EK (y 1,k − y 0,k ≤ 0) .
                                              k=1


As in the proof of Proposition 3, by applying McDiarmid’s inequality to fk (y) ≡ y 0,k − y 1,k ,
we obtain probp,EK (y 1,k − y 0,k ≤ 0) ≤ exp (−πN (p1 − p0 )2 ), where π ≡ min{π, 1 − π}.




                                                                              Online Appendix–8
                                                                             q
                                                                                 ln K
   We have that K exp(−πN (p1 − p0 )2 ) ≤ 1 ⇐⇒ p1 − p0 ≥                          πN
                                                                                      ,   which implies that

                                                                                          q
                         p1 − p0                                                              ln K
                                                                      if p1 − p0 <                  ,
                        
                                                                                                πN
             L(p) ≤                                                                        q                   (4)
                         K(p1 − p0 ) exp(−πN (p1 − p0 )2 ) if p1 − p0 ≥                       ln K
                        
                                                                                                πN
                                                                                                    .

                                                                       q
                                                                          1
The mapping x 7→ x exp(−πN x2 ) is ln-concave and maximized at x = 2πN       . As K ≥ 2,
       q         q
we have lnπNK > 2πN  1
                       , which implies that both terms on the right-hand side of (4) are
                       q                                      q
maximized at p1 − p0 = lnπNK . This implies that indeed L(p) ≤ lnπNK . Identical reasoning
applies in the case where p1 − p0 < 0.                                                                          


Proof of Corollary 2: Consider a balance function minimized by assignments e ∈ E† . Let
LK denote the loss in efficiency from a K-rerandomized trial, and LE† the loss in efficiency
from experiment EE† . The likelihood that the assignment e drawn from EK belongs to E† is
                                         
1 − (1 − pE† )K . As LK ≥ 1 − (1 − pE† )K LE† , it follows from Proposition 5 that

                                                                s
                                                     1              ln K
                                      LE†   ≤                            .
                                              1 − (1 − pE† )K        πN

                                                                                                                


Proof of Proposition 6: Point (i) follows from a reasoning similar to that of Proposition
2. For λ = 1, given an experiment E, the decision-maker’s indirect utility is

                                                        X
                               max Eh0 [wα (∆α )] =           E(e)w(h0 , e),
                                α,E
                                                        e∈E


                            prob(y|e) maxa∈{0,1} Ep∼h0 [wa (∆a )|e, y] . Hence, an experiment E is
                    P
where w(h0 , e) ≡     y∈Y

optimal if and only if support E ⊂ arg maxe w(h0 , e).



                                                                                             Online Appendix–9
   To conclude the proof of point (i), it is sufficient to show that arg max[e]∈[E] w(h0 , [e]) is a
singleton. A reasoning identical to that of Proposition 2, with w(h0 , [e]) in place of v(h0 , [e]),
shows that this is the case for generically every prior h0 . The existence of an appropriate
threshold λ < 1 follows from the fact that w(h0 , [e]) is Lipshitz continuous in h0 , and there
are finitely many possible experimental assignments.
   We now turn to point (ii). We know from Proposition 7 that there exist randomized
                                                                       √
experiments leading to optimal decisions up to a penalty of order O(1/ N ). This implies
                                                                         √
that the decision-maker can guarantee herself a payoff greater than −O(1/ N ). Consider a
deterministic experiment e. For d ∈ R, let the state p(d) such that

                                      1                1
                              p0x =   2
                                          + d, p1x =   2
                                                                if τx = 1;
                              p0x = 12 ,       p1x =   1
                                                       2
                                                           −d   if τx = 0.


Consider the prior he that puts probability 0.5 on p(d = ν) and 0.5 on p(d = −ν) for
ν ∈ (0, 1/2). By construction the information generated by the experiment is independent of
whether d = ν or d = −ν. In addition, ∆1 = p1 − p0 = −d. Hence, regardless of the action a
taken by the decision-maker, there is probability 0.5 that ∆a = −ν and probability 0.5 that
∆a = +ν. As wa is locally strictly concave around 0, it follows that expected payoffs from
running a deterministic experiments are bounded away below 0.
   This implies that for N large enough, randomized experiments are strictly optimal.             


Proof of Proposition 7: The proof is closely related to that of Proposition 5. Consider
first the case where ∆p > 0. Then the efficiency loss compared to first-best is equal to


                             L = Eh [w1 (∆1 ) − wαRCT (∆1 )|∆1 > 0].




                                                                             Online Appendix–10
As functions wa are Lipschitz continuous and wa (0) = 0, there exists M > 0 such that


                                L ≤ M Eh [(1 − αRCT )∆1 |∆1 > 0].


      In turn, if ∆p < 0, there exists M such that the efficiency loss satisfies L ≤ M Eh [−αRCT ∆1 |∆1 <
0].
    The proof of Proposition 5 implies that Eh [(1−αRCT )∆1 |∆1 > 0] and Eh [−αRCT ∆1 |∆1 <
                          q
0] are bounded above by log  πN
                                K
                                  . This proves Proposition 7.                            




C        Simulations

C.1       Optimal Experimentation

A simple example helps clarify the use of rerandomization as a way to pick a trade-off between
subjectively optimal experiments and the robustness of RCTs. We consider an environment
where N = |X| = 2, X = {0, 1}, and the experimenter is given a sample of participants with
(x1 , x2 ) = (1, 0).
      We parameterize the set H of admissible priors over the set P of states of the world as
follows. First, for the expected probability of success given policy a ∈ {0, 1}, pa = qpa1 + (1 −
q)(1 − pa0 ), we consider priors such that, with equal probability, the pair (p0 , p1 ) describes
                                                                                
either a “high probability of success” world with mina∈{0,1} pa , maxa∈{0,1} pa = (1/2, 3/4)
                                                                          
or a “low probability of success” world with mina∈{0,1} pa , maxa∈{0,1} pa = (1/4, 1/2).
      Next, given pa , to further constrain the support of priors in H, we construct a grid over
the set of values of the conditional success probabilities pa0 and pa1 consistent with pa . Note
that as pa0 = (pa − qpa1 )/(1 − q), pa0 ≥ 0 implies that pa1 ≤ ha ≡ min{1, pa /q}, while pa0 ≤ 1
implies that pa1 ≥ la ≡ max{0, (q − 1 + pa )/q}. Letting ma ≡ la /2 + ha /2, we restrict priors in


                                                                            Online Appendix–11
H to assign positive probability only to values of pa1 defining an equally-spaced, 10-segment
grid from la /2 + ma /2 to ma /2 + ha /2.
   With only two participants, we consider experiments with τ1 = 1 − τ2 , and we solve nu-
merically for the optimal probability with which participant 1 should be treated to maximize
the adversarial component of the experimenter’s payoff as defined in (DP) with policy chosen
according to αrct . Figure C.1 shows how the optimal experiments vary with the value of
q ∈ [0, 1], the share of agents with x = 1 in the population. Relative to a standard RCT with
probability π = 1/2 of treating each participant, the experimenter only experiences gains
from running an optimal experiment for intermediate values of q. In this range, rerandom-
ization offers a compromise between optimality and the robustness of the RCT. However, if q
is close to zero or one, the advantage of rerandomization over the standard RCT disappears.




       Figure C.1: Range of optimal experiments as a function of the environment.




C.2     The Trade-Offs of Rerandomization

We provide two numerical explorations of our results. We begin by considering a well-
behaved case in which treatment effects are continuous with respect to a small number of

                                                                        Online Appendix–12
underlying characteristics, so that there is limited tension between balance and robustness.
We then turn to a much more discontinuous setting designed to oppose the desire to balance
and robust policy making. The message from both simulations is clear: rerandomization
increases balance with very little to no increase in mistaken decisions.


C.2.1   Smooth Priors
                                                                                    Q5
We consider the following environment. Covariates x are drawn i.i.d. according to      k=1   U [0, 1],
a five-dimensional uniform distribution. These are mapped to outcomes according to a five-
dimensional unknown parameter µ:

                                                     exp(µ · x)
                              prob(Yi = 1|x) =                    .
                                                   1 + exp(µ · x)

                                                                              Q5
Parameter µ is drawn according to a five-dimensional truncated normal: µ ∼      k=1   N (0, 1)|[−2,2] .
We denote by τ ∗ and α the Bayes optimal assignment of treatment and policy choice under
this model.
   We report balance—captured by the negative of the L2 norm between mean characteris-
tics across treatment and control—as well as several efficiency losses of interest (see Figure
C.2):

   • Bayes Loss given Bayes Optimal Assignment
                                                           
                              Eµ,x,τ ∗ max u(p, a) − u(p, α) ;                                  (5)
                                         a∈{0,1}



   • Loss under worst prior given Bayes optimal assignment
                                                             
                              max Ex,τ ∗ max u(p, a) − u(p, α) ;                                (6)
                                  µ        a∈{0,1}




                                                                           Online Appendix–13
 Figure C.2: Rerandomization substantially increase balance with no cost to robustness.

                                             10%                                                           0
  Loss Compared to First−best (Error Rate)




                                             8%                                                          −0.1


                                             6%                                                          −0.2




                                                                                               Balance
                                             4%                                                          −0.3


                                             2%                                                          −0.4


                                               0                                                         −0.5
                                                   10         100                      1,000                    10                       100              1,000
                                                          N (Log Scale)                                                              N (Log Scale)


                                                         Randomization                                    Rerandomization
                                                         Randomization (Worst Prior)                      Rerandomization (Worst Prior)
                                                                                                          Rerandomization (Worst Prior, Evil RA)




                                        • Loss under worst prior, and worst assignment τ
                                                                                                  
                                                                 max Ex max E max u(p, a) − u(p, α) .                                                       (7)
                                                                          µ        τ     a∈{0,1}




                                        The ex-ante Bayes expected loss (5) is essentially identical under randomization and
rerandomization. Loss measure (6) chooses the prior that maximizes the error rate given
the experimental strategy E of the experimenter. While this is substantially higher than the
Bayes expected loss — as expected — it is not substantially different between randomization
and rerandomization. Finally, loss measure (7) stacks the deck against the experimenter, and
assumes that the experimenter has an “evil RA” who chooses the experimental assignment
τ from eK that maximizes the expected loss. This has no application in the case of random-
ization, but in the case of rerandomization it substantially increases error rates. However,
it is important to note even under this highly unrealistic scenario—the evil RA must know
the data-generating process—the error rate is about one-tenth of 1% for N ≥ 300.
                                        In the simulations above, we vary K, the number of rerandomizations according to our


                                                                                                                                            Online Appendix–14
   Figure C.3: Rerandomizaton increases balance with no robustness cost with fixed N .

                                         0                                                          0.004




                                                                                                            Worst Prior Error Rate
                                      −0.05                                                         0.003




                            Balance    −0.1                                                         0.002




                                      −0.15                                                         0.001
                                              0   20        40        60         80           100
                                                    Number of Rerandomizations (K)

                                                  Balance            Worst Prior Error Rate




rule of thumb, K = min{N, 100}. This suggests that the simulation may be masking some
decision-making cost of rerandomization by increasing N simultaneously. Figure C.3 shows
this is not the case by plotting worst-prior loss and balance with K, holding N fixed at 100.
Balance improves substantially, especially for the first 20 rerandomizations, but the error
rate is essentially flat.


C.2.2    The Case of Non-Smooth Priors

We now consider an environment designed to create a tension between balance and robust-
ness. Also, we pick assignment τ using balance objective B(e) = −||x1 − x0 ||2 . Policy is
chosen according to α(e, y) ≡ argmaxa∈{0,1} y a − y 1−a .
   The environment involves a single covariate x ∈ X = {1, 2, . . . , 10,000}. Even covariates
are twice as likely as odd covariates, and the treatment effect is small and negative for even
covariates, and large and positive for odd covariates. Specifically, for n ∈ {1, 2, . . . , 5,000},

                             q(2n)     2                      4            p0   1
           q(2n − 1) =             =      , p12n−1 = 4p02n−1 = , and p12n = 2n = ,
                               2     3|X|                     5             2   4



                                                                                                                                     Online Appendix–15
 Figure C.4: Rerandomization substantially increase balance with no cost to robustness.

               60%                                                                       0




               40%                                                                    −500
  Error Rate




                                                                           Balance
               20%                                                                   −1,000




                 0                                                                   −1,500
                     10   100                   1,000             10,000                      10            100                   1,000   10,000
                                N (Log Scale)                                                                     N (Log Scale)


                                                   Randomization                          Rerandomization




                                                 13         2
Thus, on aggregate, u(p, 1) =                    30
                                                        >   5
                                                                = u(p, 0), so treatment is beneficial, and α = 1 is
the “correct” decision. This setup is meant to make attempts to balance the sample likely
to cause inferential mistakes—balancing will tend to pair odd observations with the more
numerous even observations, which are not an appropriate comparison group.3
           Figure C.4 examines the error rates and balance of randomization and rerandomization.
As can be seen in the first panel, all three give roughly the same error rate. This is because
the chosen balance function, B(e), in these simulations is very unlikely to select a more
biased sample allocation. While in any specific application the interaction of the model
parameters and the balance function may produce different results, it appears quite difficult
to find a balance function that 1) might actually be used and 2) is particularly pernicious.
           On the other hand, once again, rerandomization substantially improves the balance of
the samples. This is particularly true for small and moderate sample sizes, up to the order
of 1,000, although even with 10,000 participants there is an improvement in balance, even
     3
    Indeed, using pairwise matching to assign treatment and control status increases inferential errors, but
does so equally for randomization and rerandomization



                                                                                                                       Online Appendix–16
though we only re-draw the experimental allocation 100 times.


C.2.3    (Re-)Randomization Inference

As noted in the text, if B(e) is pre-specified, randomization inference can be used to calculate
standard errors (Fisher, 1935; Young, 2016). Here, we illustrate this process using the
simulations, and balance functions, from the prior subsections.
   In particular, randomization inference uses the following procedure:

  1. Randomize assignment (τi )i∈{1,...,N }

  2. Generate data (yiτi )i∈{1,...,N }

  3. Calculate treatment effect ∆ŷ ≡ ŷ 1 − ŷ 0

  4. Re-draw experimental assignment using the same randomization procedure (τij )i∈{1,...,N }

                                                                              j       j
  5. Calculate treatment effect as if τ j had been implemented ∆j ŷ ≡ ŷ τi =1 − ŷ τi =0

  6. Return to Step 4, repeat until j = J (usually 10,000).

The simulated distribution of ∆j ŷ is the distribution of treatment effects that would be
observed if p1x = p0x , ∀x ∈ X. This can be used to calculate p-values, or infer standard errors.
   Clearly, knowing B(e), and the number of rerandomizations, K, is critical to properly
implementing Step 4. If this is the case, we say that the experimenter can conduct reran-
domization inference.
   In Figure C.5, we compare rerandomization inference and the standard errors that would
come from a regression of outcomes on treatment status. Finally, we also include naı̈ve
randomization inference, where the experimenter does not know B(e), and consequently
draws a single randomization to calculate each ∆j ŷ.




                                                                           Online Appendix–17
      Figure C.5: Comparing rerandomization inference with other inference strategies.


                                                               Smooth Simulation
                           4                                                                   0.4
    Density of Estimates




                                                                             Standard Errors
                           3                                                                   0.3

                           2                                                                   0.2

                           1                                                                   0.1

                           0                                                                    0
                               −0.4   −0.2      0        0.2           0.4                           10       100            1,000
                                             Estimate                                                     N (Log Scale)


                                                        Non−Smooth Simulation
                           4                                                                   0.4
    Density of Estimates




                                                                             Standard Errors
                           3                                                                   0.3

                           2                                                                   0.2

                           1                                                                   0.1

                           0                                                                    0
                               −0.4   −0.2     0        0.2           0.4                            10       100            1,000
                                             Estimate                                                     N (Log Scale)


                                                               Re−Randomization Inference
                                                               Randomization Inference
                                                               Standard Error from Regression




   The right-hand-side panels of the figure show the distribution of ∆j ŷ under each tech-
nique. The distribution shown for the regression comes from a simulated normal with stan-
dard deviation equal to the standard error from the regression coefficient. The left-hand-side
panels show how standard errors from each source change as the sample grows larger. Note
that we set K = min{N, 100} for both the experimental simulation and rerandomization
inference.
   The results under all schemes are substantially the same. This may be due, in part, to
the fact that outcomes are bounded in our simulations. However, it is certainly the case, as



                                                                                                                 Online Appendix–18
our theoretical results show, that rerandomization has a very small impact on the robustness
of decision-making.




                                                                       Online Appendix–19
