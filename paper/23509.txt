                              NBER WORKING PAPER SERIES




                       GENERALIZED COMPENSATION PRINCIPLE

                                        Aleh Tsyvinski
                                        Nicolas Werquin

                                       Working Paper 23509
                               http://www.nber.org/papers/w23509


                     NATIONAL BUREAU OF ECONOMIC RESEARCH
                              1050 Massachusetts Avenue
                                Cambridge, MA 02138
                                     June 2017




The views expressed herein are those of the authors and do not necessarily reflect the views of the
National Bureau of Economic Research.

NBER working papers are circulated for discussion and comment purposes. They have not been
peer-reviewed or been subject to the review by the NBER Board of Directors that accompanies
official NBER publications.

© 2017 by Aleh Tsyvinski and Nicolas Werquin. All rights reserved. Short sections of text, not to
exceed two paragraphs, may be quoted without explicit permission provided that full credit,
including © notice, is given to the source.
Generalized Compensation Principle
Aleh Tsyvinski and Nicolas Werquin
NBER Working Paper No. 23509
June 2017
JEL No. H20,H21

                                          ABSTRACT

We generalize the classic concept of compensating variation and the welfare compensation
principle to a general equilibrium environment with distortionary taxes. We show that the
problem of designing a tax reform that compensates the welfare gains and losses induced by an
economic disruption can be formalized as a solution to a system of differential-algebraic
equations (DAEs). We derive its solution in a closed form and therefore provide a complete
analytical characterization of the welfare-compensating tax reform in general equilibrium. The
partial equilibrium compensation consists of adjusting the average tax rate to exactly cancel out
the initial wage disruption. We show that in general equilibrium, the compensating tax reform
features three primary modifications to this benchmark. First, defining the relevant wage
disruption that needs to be compensated requires accounting for the endogenous wage
adjustments induced by the initial shock. The other two effects arise because the marginal tax
rates, in general equilibrium, impact wages, and hence individual utility. The “progressivity”
effect requires adjustments to the tax code that counteract the welfare effects implied by the
decreasing marginal product of each skill's labor. This leads to exponentially decreasing or
increasing taxes on incomes below those of the disrupted agents. The “compensation of
compensation” effect requires adjustments that counteract the welfare effects implied by the
complementarities between skills in production. This leads to an inductive procedure to
implement compounding rounds of iterative compensation. While we provide a closed form
expression for this effect in the general model, in the special case of a CES production function it
reduces to a remarkably simple uniform shift of the marginal tax rates. Finally, we derive a closed
form formula for the fiscal surplus of the wage disruption and the compensating tax reform,
generalizing the traditional Kaldor-Hicks criterion.


Aleh Tsyvinski
Department of Economics
Yale University
Box 208268
New Haven, CT 06520-8268
and NBER
a.tsyvinski@yale.edu

Nicolas Werquin
Toulouse School of Economics
21 allee de Brienne
31000 Toulouse
nwerquin@gmail.com
Introduction
In this paper we generalize the classic concept of compensating variation (Mas-Colell,
Whinston, and Green [1995], p. 82) and the welfare compensation principle (Kaldor
[1939], Hicks [1939, 1940]) to a general equilibrium environment in which only distor-
tionary taxes are available.
    Consider a disruption in the economy, for example, an inflow of immigrants or a
change in technology, that impacts the distribution of workers’ wages. This economic
shock generally creates winners and losers, i.e., welfare gains for some individuals and
welfare losses for others. The welfare compensation problem consists of designing a
reform of the tax-and-transfer system that offsets these losses by redistributing the
gains of the winners. The traditional public finance (Kaldor [1939], Hicks [1939, 1940])
literature gives a straightforward answer to the welfare compensation problem. In an
economy where type-dependent lump-sum taxes are available policy instruments, the
tax reform that redistributes the welfare gains and losses from the economic shock is
trivial (and, assuming away income effects, does not distort labor supply decisions).
It simply consists of raising (resp., lowering) in a lump-sum way the tax liability of
agents whose welfare increases (resp., decreases) from the disruption, up to the point
where everyone is exactly as well off as before the economic change. The standard
Kaldor-Hicks approach is flawed, however: in practice, because of asymmetric infor-
mation, the only tax instrument at the disposal of the government, the income tax, is
distortionary (Mirrlees [1971]). A compensating tax reform, if it exists, must there-
fore be designed in such a way that each agent’s change in welfare (compensating
variation) is equal to zero, taking into account that their labor supply and, in general
equilibrium, their wage both respond endogenously to the tax change.
    The following considerations highlight the importance of designing a compensat-
ing tax reform in an environment that explicitly accounts for the fact that wages are
endogenously determined in general equilibrium. Consider for example an immigra-
tion inflow, i.e., an exogenous increase in the total labor supply of a given skill. This
disruption lowers the wage of agents with the same skill because the marginal product
of labor is decreasing and raises the wage of those whose skills are complementary
in production. In this situation, therefore, it is clear that the welfare impacts of
immigration result only from the general equilibrium forces. Now suppose that the
government implements a tax reform that aims at compensating the welfare of agents


                                           2
whose wage is adversely impacted by the immigration inflow. Since the only avail-
able policy tools are distortionary taxes, such a reform inevitably impacts the agents’
labor supply choices. By the very same general equilibrium forces that led to the wel-
fare implications of immigration, these labor supply adjustments affect individuals’
wages, and hence their utility. These themselves need to be compensated, using the
distortionary tax code. This leads to an a priori complex fixed point problem.
    We show (Section 2) that the problem of designing a compensating tax reform,
even when only distortionary taxes are available, is simple in a partial equilibrium
environment where wages are fixed. The key insight here is that the changes in
marginal tax rates implied by the reform do not matter for welfare, conditional on
the average tax rate. This follows from the envelope theorem: the marginal tax rate
that the individual faces affects his indirect utility only through his optimal labor
supply decision, so that the corresponding welfare effect is second-order. Specifically,
we show (Proposition 1) that a suitably designed adjustment in the average tax rate
– namely, one that exactly cancels out the exogenous wage disruption – is sufficient
to achieve welfare compensation. We moreover derive a simple closed form expression
for the fiscal surplus, i.e., the impact on government budget of the disruption and its
associated compensation.
    The analysis becomes significantly more complicated when distortionary taxes
are coupled with the general equilibrium considerations (Section 3). In this case,
despite the envelope theorem, the endogenous changes in labor supply matter for
welfare, through their impact on wages that result from the decreasing returns and
the complementarities in production. Therefore, in general equilibrium, because of
the labor supply responses it generates, the marginal tax rate affects directly the
agent’s utility, even conditional on the average tax rate. In other words, to determine
the compensating tax reform, we need to simultaneously solve for the average and the
marginal tax rate functions. This is the key difference with the partial equilibrium
environment and the key technical challenge of our paper.
    We first show that the welfare compensation problem can be formalized mathe-
matically as a system of nonlinear Differential Algebraic Equations (DAEs).1 This
system, the solution of which is the compensating tax reform, is comprised of two

   1
     The DAE theory is much more recent than the theory of ordinary differential equations (Ascher
and Petzold [1998], p. 231). See Kunkel and Mehrmann [2006] for the first textbook treatment of
this topic.

                                                3
parts: (i ) a differential equation, involving the marginal tax rate changes, that arises
from the first-order conditions of the agents; (ii ) an algebraic component, involving
only the average tax rate changes, that arises from the requirement that the indirect
utility of agents remains on the level set defined by their pre-disruption utility. The
difficulty in the analysis of such a system, relative to a standard system of differential
equations, is in the algebraic component that makes the Jacobian of the resulting
system of implicit ODEs singular.2
     We follow Kunkel and Mehrmann [2006] (Chapter 4) to solve the system of non-
linear DAEs for marginal wage disruptions and tax reforms. A first-order Taylor
expansion of the DAE system around the initial equilibrium shows that the welfare
compensation problem reduces to an Integro-Differential Equation (IDE). The diffi-
cult part of the analysis is then to use the methods of Vainberg [1964] and Shishkin
[2007] to convert the IDE into a non-homogeneous first-order ordinary differential
equation, which links the average and the marginal tax rates; this forms the essence
of the welfare compensation. The integral part of the original IDE is then fully sep-
arated in the nonhomogeneous part of this equation, and we can analyze it using
standard tools of the theory of integral equations (e.g., Zemyan [2012]). The main
result of this section is Proposition 2 that gives the closed-form solution and thus
provides the complete analytical characterization of the compensating tax reform in
response to any wage disruption in general equillibrium. This proposition also derives
a closed-form formula for the fiscal surplus of the wage disruption and its compensa-
tion, which generalizes the traditional Kaldor-Hicks criterion and provides a simple
test to determine whether economic shocks or policies are beneficial, in the sense that
offseting its associated individual welfare gains and losses using only distortionary
tax instruments is budget-feasible.
     We then turn to the analysis of the solution and the economic insights of our
main result. There are three key terms in the formula for the welfare compensating
tax reform: (i ) the modified wage disruption term, (ii ) the progressivity term, and
(iii ) the compensation-of-compensation term. We provide a closed form expression
for each of them.
     First, the “modified wage disruption” variable defines the relevant disruption that
needs to be compensated. In addition to the initial shock to wages, the compensation
needs to account for the fact that the initial wage disruption induces labor supply
   2
       See Lamour, März, and Tischendorf [2013], p. xx.

                                                 4
adjustments that further impact wages, because of both the decreasing marginal
product of labor and the complementarities between skills in production.
    Second, the “progressivity” term is a correction to the compensating tax reform
(relative to the simple partial equilibrium compensation), the role of which is to
counteract the welfare effects generated by the compensation because of the decreasing
marginal product of labor. The key to understanding this effect is to realize that in
general equilibrium, despite the envelope theorem, the marginal tax rate directly
affects individual welfare through its impact on wages. Therefore, the compensation
needs to be designed in such a way that the welfare effects generated by the marginal
tax rates counteract those generated by the average tax rates, in addition to those
due to the exogenous disruption. We show that this naturally leads to exponentially
decreasing or increasing tax rates on incomes below those of a disrupted agents, and
hence a progressive (resp., regressive) tax reform in response to a positive (resp.,
negative) disruption of a given wage. This effect is easiest to understand in the
special case where there is decreasing marginal product of labor for each skill but
perfect substitutability with other skills.
    Third, the “compensation-of-compensation” term is due to the cross-wage effects
originating from the skill complementarities in production. As we have argued above,
the progressivity term compensates: (i ) the individual welfare gains and losses gen-
erated by the initial wage disruption, as well as (ii ) the own-wage effects created
endogenously by the compensation itself. Now, if the government implements this
tax reform, a lower marginal tax rate at a given income also affects (iii ) all of the
other wages via the cross-wage effects. The welfare impact of this indirect wage
adjustment needs to be itself compensated using the tax schedule. However, the
marginal tax rates of this second round of compensation generate in turn further
wage and welfare changes for all of the agents, and so on. This leads to an a priori
complex sequence of compensations. We show, however, that we can solve generally
this fixed point problem in closed form by defining inductively a sequence of vari-
ables that each capture a given round of iterated compensation. Remarkably, if the
production function is CES, we show that each round of iterated compensation is a
constant fraction of the previous one. In this case, compensating the welfare gains
and losses resulting from the skill complementarities in production simply requires a
uniform shift of the marginal tax rates of the compensating tax reform obtained in
the absence of cross-wage effects.


                                          5
    We now briefly describe the relationship to the literature. Three sets of papers
are closest to our work. First, Hendren [2014] generalizes the Kaldor-Hicks principle
in the partial equilibrium setting. Our results in Section 3 build on his work. As
we do in Proposition 1, he constructs a tax reform that compensates to a first-order
the individual welfare gains and losses from a disruption (the surplus defined in his
equation (1)), and evaluates the consequences of this compensation on government
revenue; see, e.g., the proof of his Proposition 3 in his Appendix A.3. Our main
contribution is in the analysis to the general equilibrium environment, where a dis-
ruption to the wage of an agent also directly impacts the welfare of other individuals.
Second, Ales, Kurnaz, and Sleet [2015a] studies optimal taxes in response to techni-
cal change in general equilibrium. They do not address the compensation problem,
which is our main contribution, and the technically and conceptually most difficult
part of our paper. Third, Itskhoki [2008] and Antras, de Gortari, and Itskhoki [2016]
study taxation and the welfare implications of trade liberalization in an environment
with distortionary taxes. Itskhoki [2008] solves for optimal redistribution in a closed
and open economy following trade liberalization within a class of distortionary taxes.
Antras, de Gortari, and Itskhoki [2016] solve for the optimal welfare and inequality
correction following trade liberalization restricting taxes to be of the CRP form (Bén-
abou [2002], Heathcote, Storesletten, and Violante [2016]). While we do not consider
a sophisticated model of trade, we solve the compensation problem allowing both
general nonlinear tax schedules and a general production function.
    More broadly, our model is within the class of Mirrleesean economies in general
equilibrium (Stiglitz [1982], Rothschild and Scheuer [2013, 2014, 2016], Ales, Kur-
naz, and Sleet [2015a,b], Scheuer and Werning [2016], Sachs, Tsyvinski, and Werquin
[2016]). More specifically, the proof of Lemma 1 uses the results of Sachs, Tsyvinski,
and Werquin [2016] to solve for the fixed point response of labor supply to a change
in taxes.
    DAE equations are also present in a different context inBenhabib and Bisin [2007]
and Benhabib, Perla, and Tonetti [2017]. Benhabib and Bisin [2007] derive a closed
form solution for the DEA in their environment. In contrast to Benhabib, Perla, and
Tonetti [2017], we do not need to use sophisticated numerical methods to solve the
system of DAEs as we obtain our results in closed form.




                                          6
1       Environment
1.1     Individuals and firms
There is a continuum of measure one of individuals indexed by i ∈ [0, 1]. Preferences
over consumption c and labor supply l are given by u (c − v (l)),3 where u and v are
twice continuously differentiable and satisfy u0 , v 0 > 0, u00 ≤ 0, v 00 > 0. Each type (or
skill) i is composed of a mass one of identical individuals who are atomistic within
their own skill group.
    An agent of type i earns a wage wi ∈ R+ , which he takes as given. He chooses his
labor supply li and earns pre-tax income yi = wi li . He pays a tax liability T (yi ) and
consumes yi − T (yi ). The non-linear tax schedule T : R+ → R is twice continuously
differentiable. The agent’s maximization problem reads

                                  max u [wi l − T (wi l) − v (l)] .
                                   l>0


We assume that li is the unique solution to this problem. It satisfies the first-order
condition

                                0 = [1 − T 0 (wi li )] wi − v 0 (li ) .                               (1)

The indirect utility of agent i is denoted by Ui .4
   There is a continuum of mass one of identical firms that produce output using
the labor of each type i ∈ [0, 1]. Let Li denote the aggregate labor supply of type-i
agents.5 The aggregate production function is denoted by F ({Li }i∈[0,1] ). We assume
that F has constant returns to scale. In equilibrium, firms earn no profits and the




    3
       The assumption that the utility function has no income effects is standard in the taxation
literature (e.g., Diamond [1998]).
     4
       In Appendix B we generalize this model to include heterogenous fixed costs of working, and,
hence, a participation decision. Our results of Propositions 1 and 2 are unaffected.
     5
       Since the mass of agents with skill i is equal to 1, we have Li = li in the initial equilibrium.
Note, however, that each individual agent is atomistic within his skill group, so that his wage changes
only if all individuals with the same skill adjust their labor supply (e.g., in response to a tax change).
In particular, each agent takes his wage as given and independent of his own choices.

                                                    7
wage wi is equal to the marginal productivity of type-i labor, i.e.,6

                                     wi = Fi ({Lj }j∈[0,1] ),                                  (2)

where Fi ≡ ∂F /∂Li denotes the partial derivative of F with respect to its ith
variable.
    We assume that wages and labor supplies are bounded so that incomes y belong
to a compact interval [y, ȳ] ⊂ R+ , that labor incomes yi = wi li ≡ y (wi ) are strictly
increasing in wages wi , and that the density of wages fw (·) is continuously differ-
entiable on [w, w̄] ⊂ R+ . We denote by fy (·) the density of incomes on [y, ȳ], with
fy (y (w)) = (y 0 (w))−1 fw (w). Finally, we denote by w = {wi }i∈[0,1] , l = {li }i∈[0,1] ,
L = {Li }i∈[0,1] , and U = {Ui }i∈[0,1] the distributions of wages, individual labor sup-
plies, aggregate labor supplies, and indirect utilities in the baseline economy with the
tax-and-transfer schedule T .


1.2     Wage disruptions and tax reforms
Wage disruptions. Consider first a partial equilibrium environment where wages
wi are exogenous. Suppose that an exogenous economic shock impacts the wage
distribution w by ŵE = {ŵiE }i∈[0,1] , so that for each i ∈ [0, 1] the wage of agent i
changes from wi to wi + ŵiE . We call ŵE a disruption of the wage distribution w.
    In the general equilibrium environment where the wage is equal to the (non-
constant) marginal product of labor of the corresponding skill, defining a wage dis-
ruption is slightly more involved. It can be induced by two possible exogenous shocks:
a perturbation of the production function F (due to, say, technological change), and
a perturbation of the distribution of aggregate labor supply L = {Li }i∈[0,1] (due to,
say, immigration flows). That is, the production function changes from F to F + Fˆ E ,
and/or the aggregate labor supply of type i changes from Li to Li + L̂E     i . We then
                                E
define the wage disruption ŵ as the impact of these shocks on wages {wi }i∈[0,1] ,
before agents respond to this wage change by adjusting their labor supplies {li }i∈[0,1] .

Definition 1. A wage disruption ŵE is the change in the wage distribution w due
                                E
to an exogenous shock (Fˆ E , L̂ ) to the production function or the distribution of

   6
    We assume without loss of generality that wages wi are increasing in the index i. Therefore the
agent’s skill i can be interpreted as his percentile in the wage distribution.

                                                8
aggregate labor supply, keeping individual labor supplies l = {li }i∈[0,1] fixed:

                     ŵiE = [Fi + FˆiE ]({Lj + L̂E
                                                 j }j∈[0,1] ) − Fi ({Lj }j∈[0,1] ).


The wage disruptions that we consider are continuous maps i 7→ ŵiE on [0, 1], and we
denote by kŵE k = max |ŵiE | their infinite norm.
                         i∈[0,1]


Tax reforms. In order to compensate the agents for their income losses (or redis-
tribute their gains) due to the disruption ŵE , the government can implement a tax
reform T̂ (·) of the tax schedule. That is, the statutory tax schedule at income level
y changes from T (y) to T (y) + T̂ (y). We assume that the tax reforms T̂ that the
government can implement are continuously differentiable, bounded, with bounded
first derivative. This defines a Banach space on which the norm of a function T̂ is
given by kT̂ k = sup |T̂ (y) | + sup |T̂ 0 (y) |.
                     y∈R+                 y∈R+



Disrupted equilibrium. In response to a wage disruption ŵE and a tax reform T̂ ,
individuals optimally adjust their labor supply. In general equilibrium, this further
impacts their wage, which in turn affects their labor supply, and so on. We denote
by ŵi and ˆli the total endogenous changes in individual i’s wage and labor supply
following the initial perturbation (ŵE , T̂ ). That is, the wage and labor supply of an
agent with skill i in the equilibrium of the disrupted economy are respectively equal
to ˜li = li + ˆli and w̃i = wi + ŵiE + ŵi .
     Formally, (ŵi , ˆli ) are defined by the perturbed wage equation

                              w̃i = [Fi + FˆiE ]({Lj + L̂E   ˆ
                                                         j + lj }j∈[0,1] ),                                           (3)

and the perturbed first-order condition

      0 = [1 − T 0 (w̃i ˜li ) − T̂ 0 (w̃i ˜li )]w̃i − v 0 (˜li ) ≡ Φ[w̃i , ˜li , T 0 (w̃i ˜li ) + T̂ 0 (w̃i ˜li )].   (4)

Equation (4) defines a map Φ : R2+ × R → R.

Compensating variation. As a result of the wage disruption ŵE and the tax
reform T̂ , the indirect utility of agent i (transformed into output units by normalizing



                                                           9
it by the marginal utility of consumption) changes by

        u[w̃i ˜li − T (w̃i ˜li ) − T̂ (w̃i ˜li ) − v(˜li )] − Ui
                                                                 ≡ Ψ[w̃i , ˜li , T (w̃i ˜li ) + T̂ (w̃i ˜li ), Ui ]. (5)
                  u0 [wi li − T (wi li ) − v (li )]

Equation (5) defines a map Ψ : R2+ × R → R.

Definition 2. The compensating variation (Mas-Colell, Whinston, and Green [1995],
p. 82) of an individual i from the wage disruption ŵE and the tax reform T̂ is defined
by Ψ[w̃i , ˜li , T (w̃i ˜li ) + T̂ (w̃i ˜li ), Ui ].

   Intuitively, the compensating variation is the monetary amount that an agent i
would be willing to pay, after the wage disruption ŵiE and the tax reform T̂ , in order
to be as well off as before these two shocks.7 A positive (resp., negative) value of
Ψ[w̃i , ˜li , T (w̃i ˜li ) + T̂ (w̃i ˜li ), Ui ] implies that an individual i benefits (resp., loses) from
these shocks.


1.3       The welfare compensation problem
Consider a wage disruption ŵE , as described in the previous section. This economic
shock generally creates winners and losers, i.e., welfare gains for some individuals and
welfare losses for others. The welfare compensation problem consists of designing a
reform T̂ of the existing tax code that offsets these losses by redistributing the gains
of the winners. Such a tax reform, if it exists, must be designed in such a way that
each agent’s compensating variation (5) is equal to zero, taking into account that
their wage and labor supply both respond endogenously to the tax change, so that
equations (3) and (4) remain satisfied.

Definition 3. The solution to the welfare compensation problem in response to a
wage disruption ŵE is a tax schedule T̂ , a wage distribution w̃ = {w̃i }i∈[0,1] , and a
labor supply distribution l̃ = {˜li }i∈[0,1] such that the compensating variation of each
agent is equal to zero when their labor supply is chosen optimally and their wage is
equal to the marginal product of the aggregate labor of their skill type. That is, for all



    7
     We could alternatively define the concept of equivalent variation. In the case of marginal
disruptions considered in this paper (see below), i.e. as kŵE k, kT̂ k → 0, the two concepts coincide.

                                                          10
i ∈ [0, 1],

                            0 = Ψ[w̃i , ˜li , T (w̃i ˜li ) + T̂ (w̃i ˜li ), Ui ]                    (6)
                            0 = Φ[w̃i , ˜li , T 0 (w̃i ˜li ) + T̂ 0 (w̃i ˜li )],                    (7)

where w̃ satisfies (3). The fiscal surplus is the change in government revenue induced
by the wage disruption ŵE and the corresponding compensating tax reform T̂ :
                                     ˆ     1   h                                            i
                        E
                  R(ŵ ) =                         T (w̃i ˜li ) + T̂ (w̃i ˜li ) − T (wi li ) di.    (8)
                                       0


We say that the welfare gains of the economic disruption ŵE are redistributable if
R(ŵE ) ≥ 0.


1.4     Elasticity notations
We start by defining the elasticities of the wage with respect to the aggregate labor
supplies of various skills. There are two channels through which labor supply affects
wages in general equilibrium. First, since the marginal product of labor is non-
increasing, the wage of skill i is decreasing in the labor supply of skill i. We denote
the corresponding elasticity by αi . Second, because different skills are imperfect
substitutes in production, the wage of skill i is (positively or negatively) impacted
by the labor supply of all the other skills j ∈ [0, 1]. We denote the corresponding
elasticities by γij .

Definition 4. We define the structural cross-wage elasticity of the wage of type i
with respect to the labor supply of type j 6= i as

                                               ∂ ln wi   Lj Fij (L)
                                  γij ≡                =            ,                               (9)
                                               ∂ ln Lj    Fi (L)

where Fij denotes the second partial derivative of the production function with respect
to the variables (i, j). We define the structural own-wage elasticity of the wage of type
i with respect to the labor supply of type i as

                       ∂ ln wi       ∂ ln wk   Li Fii (L)       Li Fki (L)
              − αi ≡           − lim         =            − lim            .                       (10)
                       ∂ ln Li k→i ∂ ln Li      Fi (L)      k→i Fk (L)




                                                           11
We have αi ≥ 0 and γij can be positive or negative.

   Expression (10) captures the effect of Li on the wage wi arising purely from the
non-constancy of the marginal product of labor of one’s own skill.
   Next, we define the elasticities of labor supply of agent i with respect to his
marginal tax rate T 0 (yi ) (or his retention rate 1 − T 0 (yi )), and with respect to his
wage wi .

Definition 5. We define the labor supply elasticity with respect to the retention rate
of agent i, along the nonlinear budget constraint and along the non-increasing labor
demand curve, as 8

                                    ∂ ln li                           ei
                      εri ≡                        =                                      ,               (11)
                              ∂ ln (1 − T 0 (yi ))   1 + p (yi ) ei + αi (1 − p (yi )) ei
                  0                             00
where ei ≡ livv00(l(li )i ) and p (y) = 1−T
                                        yT (y)
                                            0 (y) . We define the labor supply elasticity with

respect to the wage of agent i as

                                     ∂ ln li             (1 − p (yi )) ei
                              εw
                               i =           =                                      .                     (12)
                                     ∂ ln wi   1 + p (yi ) ei + αi (1 − p (yi )) ei

We have εri , εw
               i > 0.

                                                                                                          0
    The elasticities (11) and (12) differ from the usual structural elasticity ei = livv00(l(li )i )
as they take into account the fact that the labor supply response to a tax change
(given by ei ) or a wage change (given by (1 − p (yi )) ei ) impacts (i ) the marginal tax
rate faced by the agent, by an amount equal to the rate of progressivity p (y) of the
nonlinear tax schedule, and (ii ) his wage, by an amount equal to the elasticity αi .
These two endogenous effects yield further labor supply adjustments (given by ei and
(1 − p (yi )) ei , respectively), thus explaining the denominators in (11) and (12).




    8
     Note that, since we have assumed that there is a one-to-one map between wages wi (or skills
i) and incomes yi , we can denote the elasticities εri , εw                       r     w
                                                          i , αi equivalently by εyi , εyi , αyi . In the sequel
we use these notations interchangeably depending on the context. On the other hand, the correct
                                                                              γij                      Γij
change of variables for the wage elasticities γij and Γij is γyi ,yj ≡ y0 (j)     and Γyi ,yj ≡ y0 (j)     . See
Appendix A for further details.

                                                        12
2       Compensation in Partial Equilibrium
In this section, we show that the solution to the compensation problem takes a sim-
ple form in partial equilibrium, even when lump-sum taxes are not available policy
instruments (i.e., when taxes are distortionary).9
    We suppose that there is infinite substitutability between skills in production, i.e.,
                                                          ˆ    1
                                    F ({Li }i∈[0,1] ) =            θi Li di,                          (13)
                                                           0


where θi ∈ R+ for all i. This implies that wages are exogenous and equal to wi = θi
for all i. This is the standard partial equilibrium assumption made by Mirrlees [1971].
We have in particular αi = γij = 0 for all i, j ∈ [0, 1].


2.1     General solution to the welfare compensation problem
In the partial equilibrium environment, the initial wage disruption ŵE generates no
further adjustment in the wage, i.e., for all i ∈ [0, 1], ŵi = 0 and w̃i = wi + ŵiE .
We characterize analytically the solution to the welfare compensation problem (6)-
(7) for marginal wage disruptions, i.e., as kŵE k → 0. We construct a compensating
tax reform T̂ that is continuous in the exogenous disruption ŵE , in the sense that
kT̂ (ŵE )k → 0 as kŵE k → 0.
     A first-order Taylor expansion of equations (6) and (7) around the initial equi-
librium implies that the solution (T̂ , l̂) to the welfare compensation problem satisfies
the following linear system of two equations: for all i ∈ [0, 1],

         0 = [Ψ1 + Ψ3 li T 0 (wi li )] ŵiE + [Ψ2 + Ψ3 wi T 0 (wi li )] ˆli + [Ψ3 ] T̂ (wi li )       (14)
         0 = [Φ1 + Φ3 li T 00 (wi li )] ŵE + [Φ2 + Φ3 wi T 00 (wi li )] ˆli + [Φ3 ] T̂ 0 (wi li ),
                                             i                                                        (15)

where Ψk ≡ Ψk (wi , li , T (wi li ) , Ui ) and Φk ≡ Φk (wi , li , T 0 (wi li )), for k ∈ {1, 2, 3},
denote the partial derivatives of the functions Ψ and Φ with respect to their k th
variable, evaluated at their original (un-disrupted) equilibrium. We analyze these
two equations in turn.
   Equation (14) imposes that agent i keeps the same level of welfare in the disrupted

    9
     Here we allow the government to implement continuous (not necessarily continuously differen-
tiable) tax reforms.

                                                    13
economy as in the initial equilibrium, once the new tax schedule is implemented. This
equation can be simplified by recognizing that [Ψ2 + Ψ3 wi T 0 (wi li )] = 0, which follows
immediately from the first-order condition (1), or from the envelope theorem: since
individuals choose their labor supply optimally before the perturbation, their response
has no first-order effect on welfare. That is, their labor supply adjustment ˆli does
not affect their compensating variation (the right hand side of (14)). We show in
Appendix A that equation (14) can then be rewritten as

                                                                          ŵE
                                 
                Ψ1
           0= −          0
                   − li T (wi li ) ŵiE − T̂ (wi li ) = (1 − T 0 (yi )) yi i − T̂ (yi ) .                           (16)
                Ψ3                                                        wi

This equation shows that, in the partial equilibrium framework, the change in the
indirect utility of agent i is due to:

  (i ) the exogenous change ŵiE in his wage, weighted by the share (1 − T 0 (yi )) that
       he keeps after paying taxes (the first term of (16));

 (ii ) the change in his tax liability T̂ (yi ) (the second term of (16)), which makes him
       poorer (resp. richer) if T̂ (yi ) > 0 (resp. < 0).

Crucially, note that the change in the marginal tax rate, T̂ 0 (yi ), does not enter equa-
tion (16), and therefore does not matter for welfare (conditional on the average tax
rate T̂ (yi )). This again follows from the envelope theorem: the marginal tax rate
that the individual faces affects his indirect utility only through his (optimal) labor
supply decision, so that the corresponding welfare effect is second-order.
    Next, we further develop equation (15), which imposes that the labor supply of
agent i remains optimal in the disrupted economy. Using the elasticity notations
introduced in Section 1.4, we show that this equation can be rewritten as10
                 Φ1
       ˆli      −Φ  − li T 00 (wi li )                           T̂ 0 (wi li )                E
                                                                                          w ŵi         T̂ 0 (yi )
           =      3
               Φ2 li
                                               ŵiE −   Φ2 li
                                                                                      = ε i     − ε r
                                                                                                    i               . (17)
        li     Φ3
                       + wi li T 00 (wi li )            Φ3
                                                                + wi li T 00 (wi li )       wi        1 − T 0 (yi )

This equation shows that in response to the perturbation (ŵE , T̂ ), the agent’s labor
supply adjusts both because of the change in his wage ŵiE (by an amount given by
the elasticity εw
                i defined in (12)), and because of the change in his marginal tax rate



                          Φ2 li
  10
       We assume that     Φ3      + wi li T 00 (wi li ) 6= 0, which is generically satisfied.

                                                                14
T̂ 0 (yi ) (by an amount given by the elasticity εri defined in (11)).

    We now summarize the results obtained so far. Equation (16) immediately gives
the tax reform T̂ which ensures that, after reoptimizing their behavior, individuals
remain as well off before as after the wage disruption ŵE . Equation (17) then gives
the corresponding change in the labor supply of agents following the wage disruption
and the compensating tax reform. We thus obtained the solution to the welfare
compensation problem in closed form for any potential wage disruption ŵE . We
gather these results into the following proposition, which moreover gives the impact
of the disruption and its compensation on the government budget.

Proposition 1. Suppose that the production function is given by (13). Consider an
exogenous disruption ŵE = {ŵiE }i∈[0,1] of the wage distribution w. There exists a
unique tax reform that solves the welfare compensation problem, namely:11 for all
y ∈ [y, ȳ],
                                                     ŵyE
                            T̂ (y) = (1 − T 0 (y)) y      .                     (18)
                                                     wy
Moreover, the labor supply of agent i changes by (17) following the wage disruption
and the tax reform. The fiscal surplus of the wage disruption ŵE and the correspond-
ing compensating tax reform T̂ is given by
                       ˆ    ȳ
                                 "
                                                                       0
                                                                              #
                                     ŵxE                 E
                                                   
                                                       ŵ           T̂   (x)
           R(ŵE ) =                      + T 0 (x) εw
                                                     x
                                                         x
                                                            − εrx                xfy (x) dx.   (19)
                        y            wx                wx         1 − T 0 (x)

Proof. See Appendix A.

    We now sketch the proof and provide the interpretation of formula (19). Consider
an individual who earns income x ∈ [y, ȳ] before the wage disruption. First, his wage
changes by ŵxE , so that his income (absent any labor supply responses) changes by
xŵxE . The government keeps a share T 0 (x) of this income change. Moreover, by equa-
tion (18), the government raises the agent’s tax liability by T̂ (x) = (1 − T 0 (x)) x ŵxE .
Therefore tax revenue increases by T 0 (x) x ŵxE + (1 − T 0 (x)) x ŵxE = x ŵxE . This is
the first term in the square brackets of expression (19). Second, the wage disruption

  11
     In this formula, we change variables from the index i to the income level y, as there is a one-
to-one map between these two variables. The variable wy is the wage earned by the agents whose
income in the undisrupted economy is y (i.e., wy = wi if y = yi ).

                                                       15
and the compensating tax reform lead the agent to adjust (say, reduce) his labor sup-
ply by ˆlx , given by (17). This lowers government revenue by a fraction T 0 (x) of the
corresponding income loss (the term in parenthesis in (19)). This yields the second
term in the square brackets of (19). Summing over all incomes x ∈ [y, ȳ], weighted
by the density fy , leads to the total impact on government revenue, or fiscal surplus.
Note that (19) is a closed-form expression, since it depends only on the exogenous
wage disruption ŵE and on the characteristics of the undisrupted economy (income
distribution, tax schedule, labor supply elasticities).
    Proposition 1 is our first step in generalizing the standard Kaldor-Hicks criterion
to the environment when lump-sum taxes are unavailable. It shows that the compen-
sating tax reform consists of adjusting the average tax rates (T̂ (y) /y) up or down by
an amount equal to the income gain or loss of agents resulting from the economy’s
disruption. Our measure of the redistributable aggregate gains R(ŵE ) of the wage
disruption ŵE takes into account the fact that redistributing the individual gains
through the tax code generates labor supply distortions. The government is able to
compensate the gains and losses from the wage disruption in a budget-neutral way if
and only if R(ŵE ) ≥ 0. It is thus possible that a shock to the economy (say, tech-
nological change, an immigration inflow, or opening to international trade) generates
strictly positive aggregate gains, but that these gains are not redistributable because
the distortions generated by the compensating tax reform T̂ outweigh the aggregate
income gains of the initial economic shock.


2.2    Graphical representation
We assume the disutility of labor to be iso-elastic with ε = 0.33 [Chetty et al., 2011].
We assume that incomes are log-normally distributed apart from the top, where we
append a Pareto distribution for incomes above $150,000. We follow Saez [2001] to
obtain the underlying wage distribution from the first-order conditions of the agents.
We assume a CRP specification, i.e., y − T (y) ∝ y 1−p , and set the parameters as in
Heathcote, Storesletten, and Violante [2016].
    We focus our numerical analysis on elementary disruptions that consist of a shock
at only one income level y ∗ . Formally, ŵE is a Dirac delta function at y = y ∗ . Formula
(18) then shows that only the average tax rate at income y ∗ must be adjusted. As
we show in Appendix A and discuss further below, these elementary disruptions are


                                            16
particularly useful because the compensating tax reform T̂ (·) associated with any
general disruption ŵE can be immediately expressed as the sum of the corresponding
elementary compensations T̂y∗ (·) at each income level y ∗ ∈ [y, ȳ] that is disrupted.
    We specifically consider two illustrative wage disruptions and the respective com-
pensating tax reforms. To approximate the elementary Dirac shocks, we construct
smooth wage disruptions that are normally distributed and centered around y ∗ =
$20, 000 and y ∗ = $60, 000. We assume that at these points the wage decreases by
an amount ŵyE∗ that implies a decrease in pre-tax income of y ∗ × ŵyE∗ /wy∗ = $100.
                                                                                

The resulting gross income disruptions are illustrated in the left panel of Figure 1.
    In the right panel of Figure 1 we illustrate the respective compensating tax reforms,
formally derived in Proposition 1. The decrease in the agent’s average tax rate implied
by these reforms mirrors the income loss due to the wage disruptions. Note that the
compensation is larger for an income loss that affects lower incomes, because the
marginal tax rates in our calibration are increasing with income. The marginal tax
rate is 10% at $20,000 and 22% at $60,000. As a consequence, the gross income
reduction of $100 translates into after-tax income losses of $90 and $78 respectively.
Therefore, the compensating tax reform implies a reduction in tax payment of $90
and $78, respectively.

Figure 1: Wage disruptions centered at $20,000 and $60,000 (left panel) and respec-
tive compensating tax reforms (right panel)
                 0                                                                                0

                -10                                                                              -10
                -20                                                                              -20
                -30
                                                                                                 -30
                -40
y × ŵyE /wy




                                                                                   T̂ (y) in $




                                                                                                 -40
                -50
                                                                                                 -50
                -60
                                                                                                 -60
                -70

                -80                                                                              -70
                                                Wage Disruption at $20,000
                -90                             Wage Disruption at $60,000                       -80

               -100                                                                              -90
                      0     20   40      60        80        100        120                            0   20   40      60        80   100   120
                                  Income y in $1,000                                                             Income y in $1,000




3                         Compensation in General Equilibrium
In this section we analyze the welfare compensation problem (6)-(7) in the general
equilibrium environment laid out in Section 1. As in Section 2, we derive its solution

                                                                              17
in a closed form as the size of the wage disruption kŵE k → 0.12


3.1     General solution to the welfare compensation problem
Before solving the welfare compensation problem (6)-(7), it is useful to first discuss the
mathematical formalism of this system of equations. This is a system of Differential
Algebraic Equations (DAE). The unknown function to solve for is (T̂ , l̂). The system
consists of (i ) a differential equation (7), which involves the derivative T̂ 0 of the
unknown function; and (ii ) an algebraic component (6), the level set constraint,
which only features the function T̂ itself. The difficulty in the analysis of such a
system, relative to a standard system of differential equations, is that the Jacobian of
the implicit ODE is singular due to the presence of the algebraic constraint that does
not include T̂ 0 (Ascher and Petzold [1998], p. 231). The DAEs can also be viewed
as differential equations on manifolds (Rheinboldt [1984], Hairer and Wanner [1996],
Chapters VI and VII, Brunner [2004], Chapter 8). The algebraic constraint forms
a manifold, and the literature proceeds by analyzing the behavior of the suitably
projected differential equation using a geometric viewpoint.
    We follow Kunkel and Mehrmann [2006] (Chapter 4) to linearize the system of
nonlinear DAEs.13 A first-order Taylor expansion of equations (6) and (7) implies
that the solution (T̂ , l̂) to the welfare compensation problem satisfies the following
linear system of two equations: for all i ∈ [0, 1],

  0 = [Ψ1 + Ψ3 li T 0 (wi li )] ŵiE + ŵi + [Ψ2 + Ψ3 wi T 0 (wi li )] ˆli + [Ψ3 ] T̂ (wi li )
                                           
                                                                                                      (20)
  0 = [Φ1 + Φ3 li T 00 (wi li )] ŵiE + ŵi + [Φ2 + Φ3 wi T 00 (wi li )] ˆli + [Φ3 ] T̂ 0 (wi li ),
                                           
                                                                                                      (21)

where the partial derivatives Ψk , Φk are evaluated at the original (un-disrupted) equi-
librium. These equations are similar to (14)-(15) obtained in the partial equilibrium
model of Section 2, except that the adjustment in the wage of agent i now includes
                                                            E
  12
       More precisely, we let the exogenous perturbation kL̂ k, kFˆ E k → 0. The wage disruption ŵE
                                    ´ 1
is then given by ŵiE = FˆiE (L) + 0 L̂Ej Fij (L) dj.
    13
       Rabier and Rheinboldt [1990, 1994] provide conditions for the local existence and uniqueness
of solutions. März [2011] is perhaps the most comprehensive recent analysis of the conditions under
which linearizations are valid (see also Campbell [1995]). Campbell and Griepentrog [1995] dis-
cuss the computational verification of solutions. However, complications primarily arise in complex
systems of higher indices (Campbell and Griepentrog [1995]), while our linearized system is a Hes-
senberg index-1 DAE (see Hairer and Wanner [1996], p. 374) which poses fewer challenges (see, e.g.,
a discussion in März [1995]).

                                                   18
the endogenous component ŵi in addition to the initial disruption ŵiE . This endoge-
nous wage correction affects directly the agent’s indirect utility (equation (20)) and
his choice of labor supply (equation (21)).
    In order to find the solution (T̂ , l̂) to the welfare compensation problem, we there-
fore need to first characterize the endogenous wage change ŵi . We show in Appendix
A that a first-order Taylor expansion of the perturbed wage equation (3) leads to

                                ŵi      ˆli ˆ 1 ˆlj
                                    = −αi +     γij dj,                                     (22)
                                wi        li  0    lj

where the elasticities γij and αi are defined in (9) and (10). This equation has the
following economic interpretation: a one percent increase in the labor supply of an
individual of type i leads to a −αi percent change in the wage of type i, beyond the
initial wage disruption ŵiE ; analogously, a one percent increase in the labor supply
of an individual of type j 6= i, for any j ∈ [0, 1], leads to a γij percent change in the
wage of type i.
    We now follow the literature (see, e.g., Hairer and Wanner [1996], p. 374) and
transform the DAE system (20)-(21) into a differential equation.14 Substituting for
ŵi using (22), equation (20) can be rewritten as

                                                     ˆli ˆ 1 ˆlj
                                        "                         #
                                            ŵiE
               0 = (1 − T 0 (yi )) yi            − αi +     γij dj − T̂ (yi ) .             (23)
                                            wi        li  0    lj

This equation generalizes equation (16) (where ŵiE is replaced by (ŵiE + ŵi )) and
shows that, in addition to the two partial equilibrium forces described in Section 2,
there is now the third channel through which the compensating variation of the agent
is affected, namely:

(iii ) the endogenous changes ˆli and {ˆlj }j∈[0,1] in the labor supplies of type-i and
       type-j agents, by impacting the wage of skill i (through equation (22)), have a
       first-order impact on the indirect utility of agent i.

This shows that despite the envelope theorem, the endogenous changes in labor supply
matter for welfare, through their impact on wages that result from the decreasing
  14
     This transfomation is the essence of the relationship between the DAEs and ODEs. Lamour,
März, and Tischendorf [2013] (p. xxi) writes: “almost all approaches to DAEs suppose that the DAE
is eventually reducible to an ODE as a basic principle. This opinion is summarized in Rabier and
Rheinboldt [2000] (p. 191) (. . . ).”

                                                19
marginal productivity and the complementarities in production. Therefore, in general
equilibrium, because of the labor supply responses it generates, the marginal tax rate
affects directly the agent’s utility, even conditional on the average tax rate. This is
the key difference with the partial equilibrium environment.
    Next, substituting for ŵi into equation (24) and solving for lˆi using the labor
supply elasticities introduced in Definition 5,15 we show in Appendix A that we can
rewrite equation (21) as
                               "                                 # ˆ
                      ˆli             ŵ E
                                                  T̂ 0
                                                       (w i li )      1          ˆlj
                                         i
                          =        εw
                                    i      − ε r
                                               i                  +     ε w
                                                                          i γ ij     dj.       (24)
                       li             wi         1 − T 0 (yi )      0             lj

This equation gives the relationship between, on the one hand, the wage disruption
and the change in the marginal tax rate of agent i, and on the other hand, all agents’
changes in labor supply. Equation (24) is more complex, however, than the corre-
sponding equation (17) obtained in partial equilibrium, because the change in labor
supply of agent i, ˆli , depends on those of all other agents j through the skill comple-
mentarities γij . Hence all of the labor supply adjustments {ˆli }i∈[0,1] have to be solved
for simultaneously as functions of the whole wage disruption function ŵE and the tax
reform T̂ . The following lemma derives a closed form solution for ˆli , for all i ∈ [0, 1].

Lemma 1. The solution to (24) is given by: for all i ∈ [0, 1],
            "                            # ˆ          "                              #
       ˆli      ŵ E
                             T̂ 0
                                  (y i )      1           ŵ E
                                                                       T̂ 0
                                                                            (y j )
                   i                                    w j
           = εw
              i      − εri                +     εw
                                                 i Γij εj      − εrj                   dj,     (25)
        li      wi         1 − T 0 (yi )    0             w  j       1 −   T 0 (y )
                                                                                   j


where Γij is given by
                                                               ∞
                                                               X      (n)
                                          Γij = γij +                Γij ,                     (26)
                                                               n=1

       (0)
with Γij = γij and for all n ≥ 1,
                                                 ˆ   1
                                       (n)                (n−1) w
                                      Γij    =           Γik   εk γkj dk.                      (27)
                                                 0


Proof. This follows from Proposition 1 in Sachs, Tsyvinski, and Werquin [2016]. See
Appendix A for details.
  15
    In particular, the effect of the agent’s labor supply on his own wage is accounted for by the
denominator of the labor supply elasticities along the decreasing labor demand curve, (11) and (12).

                                                         20
    We first describe the interpretation of the term Γij defined in (26). This term can
be thought of an elasticity of the wage of type i with respect to the labor supply of
type j. In contrast to γij , it accounts for the infinite sequence of cross-wage effects
between different skills that occur in general equilibrium, and thus represents the
total impact of Lj on wi once the economy has fully adjusted to the initial shock.
The initial change in type-j labor supply directly affects the wage of type i through
                                                                          (0)
the structural cross-wage elasticity γij – this is the direct effect Γij . This induces
a change in type-i labor supply (by εw   i ), which in turn feeds back into the wage of
type j, and so on. The wages and labor supplies of all of the other types k are
analogously affected at each stage, adding their own contribution to the total general
equilibrium adjustment in wi . The closed-form formula (26)-(27) constructs as an
                                                                               (n)
infinite sequence of indirect effects of Lj on wi through the sequence {Γij }n≥1 .16
    We can now interpret equation (25) as follows. The change in labor supply of
agent i is the sum of two terms. The first is the direct effect of agent i’s wage disrup-
tion ŵiE and marginal tax rate change T̂ 0 (yi ) on his labor supply (via the labor supply
elasticities εw       r
              i and εi , respectively). The second (the integral term in (25)) accounts
for the effects of the changes in labor supply of all other agents j ∈ [0, 1] (themselves
driven by the corresponding variables ŵjE and T̂ 0 (yj )); they affect the wage of agent i
though the empirical wage elasticity Γij , leading in turn to a change in labor supply
of agent i given by the elasticity εwi .



    We summarize the results we obtained so far. The key difference between the
system (16)-(17) obtained in partial equilibrium, and the system (23)-(25) obtained
in general equilibrium, is that the latter two equations can no longer be solved in-
dependently. Indeed, in contrast to (16), equation (23) does not yield directly the
solution for the compensating tax reform T̂ as a function of the wage disruption ŵE .
This is because, as we explained above, the agent’s endogenous change in labor sup-
ply affects directly his welfare, so that the variable ˆli enters (23). Moreover, equation
(25) implies that ˆli is in turn a function of the change in the marginal tax rate T̂ 0 (yi ).
That is, the marginal tax rates of the compensating tax reform that the government
implements generate first-order welfare effects that need to be themselves compen-
  16                                                                                             (n)
      A precise interpretation of each round n ≥ 1 of feedback effect (captured by the variable Γij )
is given in Sachs, Tsyvinski, and Werquin [2016]. For empirical purposes, depending on the data at
hand, either γij or Γij may be the more natural elasticities to estimate, and all our formulas can be
equivalently expressed in terms of either of them.

                                                 21
sated using the tax code. In other words, in general equilibrium the government
affects individual welfare through two distinct instruments, the average tax rate and
the marginal tax rate, but these two instruments cannot be chosen independently.
This leads to a complex fixed point problem. Mathematically, equations (23)-(25)
form a linear differential-algebraic equation (DAE) system.17
    By substituting for ˆli into (23) using (25) and changing variables from skills i to
incomes y,18 we obtain the generalization of equation (18) to the general equilibrium
environment. The following lemma is the first step toward characterizing analytically
the solution to the welfare compensation problem in our general setup.

Lemma 2. The compensating tax reform T̂ satisfies the following functional equation:
            
for all y ∈ y, ȳ ,
                                                                ˆ   ȳ
                                     0                                   (1 − T 0 (y)) y
                     αy εry y                      α y εw                                (Γyx εrx x) T̂ 0 (x) dx
                                                           
        − T̂ (y) +                  T̂ (y) − 1 −        y
                                                                y        (1 − T 0 (x)) x                         (28)
                 0
   = − (1 − T (y)) y       Ω̂E
                             y,


where the modified wage disruption Ω̂E
                                     y is defined by:

                                                      "
                                                           E   ˆ ȳ           E
                                                                                  #
                                                        ŵy                ŵ x
                         Ω̂E             1 − α y εw                 Γyx εw
                                                    
                           y ≡                    y          +           x      dx .                            (29)
                                                        wy      y          w  x


Proof. See Appendix A.

   The right hand side of equation (28) is (minus) the compensating variation due to
the wage disruption ŵE , i.e., the welfare gain or loss induced by the initial economic
shock incurred by agents with income y. Note that the relevant disruption variable is
now Ω̂E                         E                             w
      y rather than simply ŵy /wy . The scaling by 1 − αy εy in (29) accounts for the
endogenous own-wage effects: an initial wage increase by ŵyE /wy = 1 percent raises
the labor supply of agents y by εw  y , which in turn lowers their marginal product of
labor (wage) by αy . The integral term in (29) accounts for the cross-wage effects:
the disruption ŵxE /wx at any income x 6= y impacts the wage of agents y via Γyx ,


   17
      More precisely, this is an integro-differential-algebraic equation (IDAE) system (see Chapter 8
in Brunner [2004]), where the integral part arises from the cross-wage effects between different skills
in general equilibrium.
   18
      See footnote 8.

                                                        22
through an infinite sequence of general equilibrium effects induced by the skill com-
plementarities in production. Finally, multiplying agent y’s total wage change Ω̂E   y by
(1 − T 0 (y)) y yields the welfare impact of the disruption.
    The left hand side of (28) is the compensating variation of agent y resulting from
the tax reform T̂ . The first term, −T̂ (y), is the same as in partial equilibrium (see
equation (18)): it reflects the fact that a tax increase (resp., decrease) lowers (resp.,
raises) the agent’s welfare. In general equilibrium, however, the marginal tax rate
also affects the agent’s utility. First, a marginal tax rate increase T̂ 0 (y) > 0 lowers
his labor supply by εry , and hence raises his wage by αy , leading to the second term
 αy εry y T̂ 0 (y) on the left hand side. Note that an increase in the marginal tax rate,
         

keeping the average tax rate constant, raises the agent’s welfare, because it makes
him work less and earn a higher wage. Second, a marginal tax rate change T̂ 0 (x) at
any other income x affects the labor supply of agents x by εrx and hence the wage of
agents y by Γyx εrx , leading to the integral term in (28).
    Therefore, equation (28) imposes that the welfare impact of the tax reform T̂
cancels out that of the wage disruption ŵE , so that each agent’s wefare remains un-
changed.

    The next proposition gives the closed-form solution to the functional equation
(28), thus providing the complete analytical characterization of the compensating tax
reform in response to any wage disruption in general equillibrium. This is the main
result of the paper.

Proposition 2. Consider an exogenous disruption ŵE = {ŵiE }i∈[0,1] of the wage
distribution w, and let kŵE k → 0. The welfare compensating tax reform is given in
closed-form by:
                             ˆ   ȳ           h                            i
                  T̂ (y) =            E (x, y) (1 − T 0 (x)) x Ω̂E
                                                                 x + C (x)   dx,    (30)
                             y


where the “modified wage disruption variable” Ω̂E
                                                x is defined by (29), the “progressivity”
variable E (x, y) is defined by
                                                        ˆ    y              
                                       1                            1
                          E (x, y) ≡          exp                          ds       (31)
                                     αx εrx x             x       αs εrs s



                                                   23
and the “compensation-of-compensation” variable C (x) is defined by
                                        ˆ ȳ hX
                                              ∞                i
                          C (x) ≡                       Λ(n)
                                                         xs        (1 − T 0 (s)) s Ω̂E
                                                                                     s ds                              (32)
                                            y     n=0

                          (n)
where for all n ≥ 0, Λxs are given by
       (0)                              ˆ    s                                                   ˆ   ȳ
    Λxs        (1 − T 0 (x)) x Γxs                        (1 − T 0 (x)) x Γxu
             =                     −             E (s, u)                     du,     Λ(n)
                                                                                       xs    =            Λ(n−1)
                                                                                                           xu    Λ(0)
                                                                                                                  us du.
  1 − α x εw
           x   (1 − T 0 (s)) s αs        y                (1 − T 0 (u)) u αu                     y
                                                                                                                           (33)
The changes in wages and labor supplies following the wage disruption and the tax
reform are given respectively by (22) and (25). Finally, the fiscal impact of the dis-
ruption and the tax reform is given by
                          ˆ    ȳ                            ˆ ȳ
                   E                  T̂ (x)                      T 0 (x)    αx−1
              R(ŵ ) =                          f y (x) dx +                        ...
                           y        1 − T 0 (x)                        0          w
                                                              y 1 − T (x) 1 − αx εx                                    (34)
                                       h                                   i
                                                 0         E
                                     × (1 − T (x)) x Ω̂x + C (x) − T̂ (x) fy (x) dx,

with T̂ given by (30).

Proof. See Appendix A. The proof consists of two parts. Equation (28) is an integro-
differential algebraic equation.19 That is, it is a functional equation which features
both the derivative and an integral of the unknown function T̂ . The difficult part of
the analysis is to use the methods of Vainberg [1964] and Shishkin [2007] and consists
of formally representing and solve equation (28) as a non-homogeneous first-order
ordinary differential equation. The integral part of the original IDE is contained
in the nonhomogeneous part of this equation, so that the solution to the first-order
ODE is obtained in terms of an auxiliary function, which we can characterize as the
solution to a Fredholm integral equation.20 We can then directly use the standard
  19
      The analysis of this section from the system of equations (22)-(23) to the main result of (30)
echoes that of Lamour, März, and Tischendorf [2013] (p. xxi) who argue that the IDAEs are a
special case of abstract differential-algebraic equations (ADAE), so that the methods of analysis of
the DAEs are applicable.
   20
      Note that, just like a standard differential equations, equation (28) has a multiplicity of so-
lutions, indexed by a constant c0 (or an initial condition T̂ (ȳ)). These solutions all satisfy the
individual first-order conditions and keep each agent’s welfare constant. This is true even in the
absence of an initial wage disruption: the government is able reform the tax code in such a way that
everyone’s utility remains the same. All of these tax reforms have the same effect on government
revenue if the tax code is initially Pareto efficient. We pick the most natural solution, that is the
simplest to write formally, which satisfies T̂ (ȳ) = 0.

                                                           24
theory of integral equations (see Zemyan [2012]) to express this auxiliary function in
closed-form as a Neumann series (33). We finally provide a condition ensuring the
convergence of this series and show that it is satisfied in several cases of interest.21

   We discuss the interpretation of our main formula (30) in the next section. The
formula for the fiscal surplus (34) generalizes the traditional Kaldor-Hicks criterion
and provides a simple test to determine whether economic shocks or policies are
beneficial, in the sense that offseting its associated individual welfare gains and losses
using only distortionary tax instruments is budget-feasible.


3.2     Analysis of the compensating tax reform (30)
The compensating tax reform (30) features three important departures from the par-
tial equilibrium compensation (18): (i ) the modified wage disruption Ω̂E that replaces
the exogenous disruption ŵE ; (ii ) the progressivity term (31); (iii ) the compensation-
of-compensation term (32). We already discussed the intuition underlying the first
novel effect in the context of Lemma 2. In order to understand the second and third
novel effects ((31) and (32)), we analyze in more detail two special cases of our general
environment.

Understanding the progressivity term (31). In this paragraph, we assume that
there is infinite substitutability between skills in production (as in Section 2), but we
depart from the partial equilibrium benchmark by letting the marginal product of
labor of each type i be decreasing. This reflects, for example, the downward-sloping
demand curve for labor when there is a fixed factor of production, say land or capital,
for each type.22 That is, the production function writes
                                                       ˆ   1
                                 F ({Li }i∈[0,1] ) =           Fi (Li ) di,                       (35)
                                                       0


where for each i ∈ [0, 1], Fi is a function of the variable Li only and satisfies Fi0 > 0,
Fi00 < 0. The wage of type i is equal to wi = Fi0 (Li ), the own-wage elasticities satisfy
   21
      See also Pachpatte [1986] for conditions ensuring the existence and uniqueness of some classes
of mixed Volterra-Fredholm type integral equations.
   22
      Note that this production function does not have constant returns to scale. It is not difficult to
extend our theory to this case, but it would require introducing profits and the potentially unequal
ownership of firms. We sidestep these techical complications by assuming that the government taxes
profits 100% and redistributes the proceeds to a public good that does not enter the agents’ utility.

                                                  25
αi > 0 for all i, and the cross-wage elasticities γij and Γij are equal to zero for all
i, j. The integral term in the functional equation (28) is then equal to zero, and the
functional equation that defines the compensating tax reform becomes an ordinary
differential equation that can be easily solved. We obtain:

Corollary 1. Suppose that the production function is given by (35), so that the
marginal product of labor of each skill is decreasing and different skills are perfect
substitutes. Suppose moreover that only the wage of agents with skill i∗ (and corre-
sponding income y ∗ ≡ yi∗ ) is disrupted by ŵiE∗ .23 The compensating tax reform (30)
is then given by

                      T̂ DMP (y) = [(1 − T 0 (y ∗ )) y ∗ Ω̂E           ∗
                                                           y ∗ ] × E (y , y) I{y≤y ∗ } ,                  (36)

Suppose in addition that αi ≡ α and εri ≡ εr are constant with αε1 r ≥ 1.24 If the
wage of agents i∗ is positively (resp., negatively) disrupted, then the compensating tax
reform T̂ DMP is progressive (resp., regressive) on the interval y ∈ (y, y ∗ ).25

Proof. See Appendix A.

   To interpret formula (36), consider a wage disruption that adversely affects agents
with skill i∗ , i.e., ŵiE∗ < 0 and ŵiE = 0 for all i 6= i∗ .26 Suppose for simplicity that
αi ≡ α and εri ≡ εr are constant. Recall that in partial equilibrium, the welfare
compensating tax reform satisfies

                                        T̂ (y)
                                               = (1 − T 0 (y)) Ω̂E
                                                                 y,
                                           y

where Ω̂E     E
        y ≡ ŵy /wy . That is, the change in the average tax rate must exactly compen-
sate the exogenous wage disruption (weighted by the retention rate). In particular,
the partial equilibrium compensation T̂ (y) is equal to zero for all incomes y < y ∗

   23
      The compensating tax reform to a disruption that affects the whole wage distribution w is then
given by the sum (integral) of these elementary compensations of each skill i∗ . See Appendix A for
details.
   24
      This is indeed the case if Fi ∝ L1−α
                                         i    for all i, the disutility of labor is isoelastic, and the baseline
tax schedule has a constant rate of progressivity, i.e. if y − T (y) ∝ y 1−p . The restriction αε1 r > 1 is
unimportant: the results are reversed in the case αε1 r < 1.
   25
      Recall that we define the local rate of progressivity of the compensating tax reform p (y) as the
elasticity of the retention rate 1 − T̂ 0 (y) with respect to income.
   26
      Formally, the disruption ŵE is a Dirac delta function. See Appendix A for details.

                                                      26
that are not disrupted. When the marginal product of labor is decreasing, instead,
the functional equation (28) defining the welfare compensating tax reform reads

                            T̂ (y)
                                   = (1 − T 0 (y)) Ω̂E      r    0
                                                     y + (αε ) T̂ (y) ,
                               y

where Ω̂E                w   E
             y ≡ (1 − αε ) ŵy /wy . That is, the change in the average tax rate must
now compensate both the modified wage disruption and, in addition, the wage cor-
rection generated endogenously by the change in the marginal tax rates – recall that
a reform of the marginal tax rate by T̂ 0 (y) impacts the labor supply of agents y by
εr T̂ 0 (y), and hence their wage by αεr T̂ 0 (y). Thus, for agents with income y ∈ [y, y ∗ ),
who are not initially disrupted, the compensating tax reform must ensure that the
relationship T̂ (y)
                  y
                    = (αεr ) T̂ 0 (y) between the average tax rates and the marginal tax
rates is satisfied. In other words, the key insight is that in general equilibrium, the
government impacts individual welfare through both the average and the marginal
tax rates: an increase in the former (resp., the latter) lowers (resp., raises) the agent’s
utility. Hence a welfare compensating tax reform must be such that these two forces
exactly cancel out, so that an income that incurs an average tax hike must also in-
cur a marginal tax hike. Now, this relationship between the two tax rates implies
immediately
                                                         r
                                         T̂ (y) ∝ y 1/(αε )

on the interval [y, y ∗ ). In particular, if αεr = 1, the average and the marginal tax rates
must coincide, so that the tax schedule T̂ is linear. More generally, the marginal tax
rates below y ∗ decline at the constant rate 1/(αεr ). Thus, in the empirically relevant
                                                            y T̂ 00 (y)
case where αε1 r > 1, the rate of progressivity p (y) = 1−      T̂ 0 (y)
                                                                         of the tax reform satisfies
p (y) < 0 if and only if ŵiE∗ < 0. Finally, when αy and εry depend on income y, we
obtain analogously T̂ (y) ∝ E (y ∗ , y),27 which explains formula (36) and shows that
the marginal tax rates below y ∗ must be lowered in an exponentially decreasing way.
    Summarizing, when the production function implies decreasing marginal product
of labor but perfect substitutability between skills, only two effects are present in
formula (30) – the “modified wage disruption” (29) and the “progressivity” effect (31).
Compensating a positive (resp., negative) modified disruption at skill i∗ requires in

                                                                                        r
   27
     It is easy to check that the exponential term E (y ∗ , y) is proportional to y 1/(αε   )
                                                                                                when α and εr
are constant.

                                                    27
this case a progressive (resp., regressive) tax reform on the interval [y, y ∗ ) of the
income distribution.

Understanding the compensation-of-compensation term (33). In this para-
graph, we consider a simple technology where skills are no longer infinitely sub-
stitutable in production. We assume that the production function has a constant
elasticity of substitution (CES), i.e.,

                                                   ˆ       1
                                                                                1
                                                                              1−α
                             F ({Li }i∈[0,1] ) =                θi L1−α
                                                                    i   di           .          (37)
                                                        0


We suppose, moreover, that the agents’ disutility of labor is isoelastic, i.e., v (l) =
l1+1/ε
1+1/ε
       , and that the initial tax schedule has a constant rate of progressivity p (y),28
i.e., T (y) = y − 1−τ
                  1−p
                      y 1−p . These assumptions imply that the elasticities εri , εw
                                                                                   i , and αi
are constant. Moreover, the cross-wage elasticities γij are independent of i, so that
an increase in the labor supply of a given skill j affects the wage of all other skills
i 6= j by the same amount. We show in Appendix A that this allows us to simplify
the functional equation (28) and its solution (30).

Corollary 2. Suppose that the production function is given by (37), that the disutility
of labor is isoelastic, and that the rate of progressivity p (y) of the initial tax schedule
is constant. The compensating tax reform (30) is then given by

           T̂ CES (y) =[(1 − T 0 (y ∗ )) y ∗ Ω̂E         ∗                         0
                                               y ∗ ] E (y , y) I{y≤y ∗ } + c (1 − T (y)) y,     (38)

                                                                          r
                                                               1 1 y 1/(αε )
                                                                    
where Ω̂Ey is the modified wage disruption (29), E (x, y) = αεr x x          is the pro-
gressivity term (31), and c is a constant given in closed form in Appendix A. The first
term in the right hand side of (38) is analogous to the compensation T̂ DMP derived
in (18), and the second term is a uniform (in percentage terms) shift of the marginal
tax rates.29

Proof. See Appendix A.


  28
      See, e.g., Bénabou [2002] and Heathcote, Storesletten, and Violante [2016], who argue that this
tax schedule closely approximates the U.S. tax code.
   29
      This corresponds to a change in the parameter τ of the baseline tax schedule T (y) = y −
1−τ 1−p
1−p y     .

                                                   28
     The second term in (38) is due to the cross-wage effects originating from the skill
complementarities in production. Recall that the tax schedule T̂ DMP given by (18)
compensates (i) the individual welfare gains and losses generated by the initial wage
disruption, as well as (ii ) the own-wage effects created endogenously by the compen-
sation itself (a lower marginal tax rate at income x leads to a lower wage wx via the
elasticity αx εrx ). Now, if the government implements this tax reform, a lower marginal
tax rate at income x also affects all of the other wages {ws }s6=x via the cross-wage
elasticities Γxs defined in (26). The welfare impact of this indirect wage adjustment
                           (0)
is given by the term Λxs in (33), and needs to be itself compensated using the tax
schedule. However, the marginal tax rates of this second round of compensation gen-
erate in turn further wage and welfare changes for all of the agents u ∈ [y, ȳ]. These
again must be compensated (third round of “compensating the compensation”), and
so on. This leads to an a priori complex sequence of compensations. We showed,
however, that we can solve generally this fixed point problem in closed form by defin-
                                              (n)
ing inductively the sequence of variables Λxs for n ≥ 1 (equation (33)), where each
   (n)
Λxs captures one round of iterated compensation.
     Remarkably, if the production function is CES (as in (37)), we show that each
round of iterated compensation is a constant fraction of the previous one. This dras-
tically simplifies the second integral in the formula (30) for T̂ . Equation (38) shows
that in this case, compensating the welfare gains and losses resulting from the skill
complementarities in production simply requires a uniform shift of the compensat-
ing tax reform T̂ DMP obtained in the absence of cross-wage effects. In particular, in
response to a disruption affecting adversely agents with income y ∗ , the tax function
T̂ CES must feature the same exponentially decreasing marginal tax rates as described
in the previous section. In the empirically relevant case where αε1 r > 1, the com-
pensating reform is progressive (resp., regressive) for incomes lower than that of the
agents that are positively (resp., negatively) disrupted.
     Summarizing, in the case where there is a constant elasticity of substitution be-
tween skills in production in addition to a decreasing marginal product of labor, there
is an additional effect relative to the previous paragraph (“compensation of compen-
sation”) that requires a particularly simple – linear – adjustment in the compensating
tax reform.




                                          29
3.3     Graphical representation
The calibration is the same as in Section 2.2. We assume in addition that the pro-
duction function is CES with σ = 0.6. We consider the same normally distributed
adverse wage disruptions as in Section 2.2 (see Figure 1), implying a $100 pre-tax
income loss at y ∗ = $20, 000 and y ∗ = $60, 000.
    Figure 2 plots the general equilibrium compensating tax reform, and decomposes
it into its three key elements: the modified wage disruption (29), the progressivity
effect (31), and the compensation-of-compensation effect (32). First, the black dashed
line in the left panel of the figure represents the tax reform T̂ DMP , i.e., the pure
progressivity effect. As shown by Corollary 1,30 this compensation is exponentially
decreasing up to the income level at which the tax reform peaks. Second, to account
for the modified wage disruption effect, the bold red curve in both panels represents
the first term of the CES compensating tax reform (38). The difference with the tax
reform T̂ DMP is that incomes larger than y ∗ are also compensated: this is because of
the cross-wage effects induced by the initial disruption in the modified wage disruption
term (29). Third, the compensation-of-compensation effect is represented by the
dashed-dotted blue curve in the right panel of Figure 2. As we showed in Corollary
2, in the case of a CES production function this term is proportional to (1 − T 0 (y))y,
so that the marginal tax rates of the CRP baseline tax schedule T are uniformly (in
percent) shifted upwards. Summing the progressivity and modified disruption effects
(red curve) and the compensation-of-compensation effect (blue curve) leads to the
total compensating reform, represented by the black dashed curve in the right panel
of the figure.31




  30
      Formula (38) defines the compensating tax reform in response to a Dirac wage disruption at
income y ∗ . In our simulations, the disruptions we consider are normally distributed around y ∗ and
are therefore only (close) approximations to the corresponding Dirac disruptions. As we explained
above, the tax reform that compensates a general, non-Dirac, disruption is simply equal to the sum
of the reforms that compensate the corresponding Dirac perturbations at each income level.
   31
      The average change in tax rates is of the same order of magnitude in partial equilibrium and in
                                                                                  r
general
´ DMPequilibrium.1 In fact, in0 the∗
                                                      ´ PEfunction (35) with α, ε constant, we have
                                     case of the production
                                       ∗ E      1−αεw
  T̂     (y) dy = 1+αεr (1 − T (y )) y Ω̂y∗ = 1+αεr T̂ (y) dy. However, taking into account the
general equilibrium forces requires the compensation to be much more evenly spread out across
the income distribution than in partial equilibrium, where only the disrupted agent faces a (larger)
compensation.

                                                 30
Figure 2: Decomposition into the progressivity effect (left panel) and the
compensation-of-compensation effect (right panel)
              0                                                                          1

              -1                                                                         0

                                                                                         -1
              -2
                                                                                         -2
              -3
                                                                                         -3
    T̂ in $




                                                                               T̂ in $
              -4
                                                                                         -4
              -5
                                                                                         -5
                                                                                                           T̂ DM P (y) w Cross Wage Effects
              -6                                                                                           T̂ CES (y)
                                    T̂DM P
                                            (y) w Cross Wage Effects                     -6
                                                                                                           Cross Wage Effect Compensation
                                    T̂ DM P (y) w/o Cross Wage Effects
              -7                                                                         -7

              -8                                                                         -8
                   0        50               100                    150                       0   50               100                   150
                            Income y in $1,000                                                    Income y in $1,000




4                      Conclusion
A classic policy question of compensating winners and losers from an economic dis-
ruption becomes quite involved when the environment features both distortionary
taxes and general equilibrium. At the same time, both of these considerations are
important in many applied and policy questions. We show that this problem can be
formalized as a system of Differential Algebraic Equations (DAE). The DAEs are a
relatively recent mathematical subject and, while providing a powerful set of tools,
have been only sporadically used in economics. The main difficulty in the analysis
of such systems comes exactly from the central issue of designing compensating tax
reforms. The need to ensure that the agents are brought to their pre-disruption util-
ity level results in the algebraic constraint. This algebraic constraint is then coupled
with the differential equation due to the requirement that the first order conditions
of the agents remain satisfied following both the disruption and the compensating
tax reform. We show that the solution to the DAE system leads to a fairly complex
implicit integro-differential equation involving the average and the marginal tax rate
functions. This equation has a clear economic meaning identifying that in general
equilibrium with distortionary taxes both the average and marginal tax rates have to
be used in conjunction in the design of the compensation. This is due to the effects
of the marginal tax rate of the compensating tax function on the wage that in turn
affects welfare. We derive a closed form solution to the problem and show that there
are three principal economic effects determining the compensating variation: (i) a
modified wage disruption term, (ii) a progressivity term; (iii) a compensation-of-


                                                                          31
compensation term. All of these effects are derived in a closed form and are easy to
compute in practical applications. We highlight intuition behind the general results
through a number of special cases, in which these effects become particularly simple
and transparent.


References
Laurence Ales, Musab Kurnaz, and Christopher Sleet. Technical change, wage in-
  equality, and taxes. The American Economic Review, 105(10):3061–3101, 2015a.

Laurence Ales, Musab Kurnaz, and Christopher M Sleet. Tasks, talents and taxes.
  American Economic Review (forthcoming), 2015b.

Pol Antras, Alonso de Gortari, and Oleg Itskhoki. Globalization, inequality and
  welfare. Working Paper, 2016.

Uri M Ascher and Linda R Petzold. Computer methods for ordinary differential
  equations and differential-algebraic equations, volume 61. Siam, 1998.

R. Bénabou. Tax and education policy in a heterogenous-agent economy: What
  of levels of redistribution maximize growth and efficiency? Econometrica, 70(2):
  481–517, 2002.

Jess Benhabib and Alberto Bisin. The distribution of wealth: Intergenerational trans-
  mission and redistributive policies. Working Paper, New York University, 2007.

Jess Benhabib, Jesse Perla, and Christopher Tonetti. Reconciling models of diffusion
  and innovation: A theory of the productivity distribution and technology frontier.
  Working Paper, 2017.

Hermann Brunner. Collocation methods for Volterra integral and related functional
  differential equations, volume 15. Cambridge University Press, 2004.

Stephen L Campbell. Linearization of daes along trajectories. Zeitschrift für ange-
  wandte Mathematik und Physik ZAMP, 46(1):70–84, 1995.

Stephen L Campbell and Eberhard Griepentrog. Solvability of general differential
  algebraic equations. SIAM Journal on Scientific Computing, 16(2):257–270, 1995.

                                         32
R. Chetty, J. Friedman, T. Olsen, and L. Pistaferri. Adjustment costs, firm responses,
  and micro vs. macro labor supply elasticities: Evidence from danish tax records.
  Quarterly Journal of Economics, 126(2):749, 2011.

P. A. Diamond. Optimal income taxation: An example with a u-shaped pattern of
  optimal marginal tax rates. American Economic Review, 88(1):83–95, 1998. ISSN
  0002-8282.

M. Golosov, A. Tsyvinski, and N. Werquin. A Variational Approach to the Analysis
 of Tax Systems. Working Paper, 2014.

Ernst Hairer and Gerhard Wanner. Solving ordinary differential equations. II, volume
  14 of Springer Series in Computational Mathematics. Springer-Verlag, Berlin, 1996.

Jonathan Heathcote, Kjetil Storesletten, and Giovanni L Violante. Optimal tax pro-
  gressivity: An analytical framework. NBER Working Paper No. 19899, 2016.

Nathaniel Hendren. The inequality deflator: Interpersonal comparisons without a
  social welfare function. NBER Working Paper 20351, 2014.

John R Hicks. The foundations of welfare economics. The Economic Journal, 49
  (196):696–712, 1939.

John R Hicks. The valuation of the social income. Economica, 7(26):105–124, 1940.

Oleg Itskhoki. Optimal redistribution in an open economy. Working Paper, 2008.

Nicholas Kaldor. Welfare propositions of economics and interpersonal comparisons of
  utility. The Economic Journal, pages 549–552, 1939.

Peter Kunkel and Volker Mehrmann. Differential-algebraic equations: analysis and
  numerical solution. European Mathematical Society, 2006.

René Lamour, Roswitha März, and Caren Tischendorf. Differential-algebraic equa-
  tions: a projector based analysis. Springer Science & Business Media, 2013.

Roswitha März. On linear differential-algebraic equations and linearizations. Applied
  Numerical Mathematics, 18(1-3):267–292, 1995.

Roswitha März. Notes on linearization of differential-algebraic equations and on
  optimization with differential-algebraic constraints. 2011.

                                         33
Andreu Mas-Colell, Michael Dennis Whinston, and Jerry R Green. Microeconomic
 theory, volume 1. Oxford university press New York, 1995.

J. A. Mirrlees. An exploration in the theory of optimum income taxation. The Review
   of Economic Studies, 38(2):175–208, 1971.

BG Pachpatte. On mixed volterra-fredholm type integral equations. Indian J. Pure
 Appl. Math, 17(4):488–496, 1986.

Patrick J Rabier and Werner C Rheinboldt. A general existence and uniqueness theo-
  rem for implicit differential-algebraic equations. Technical report, DTIC Document,
  1990.

Patrick J Rabier and Werner C Rheinboldt. A geometric treatment of implicit
  differential-algebraic equations. Journal of Differential Equations, 109(1):110–146,
  1994.

Patrick J Rabier and Werner C Rheinboldt. Nonholonomic motion of rigid mechanical
  systems from a DAE viewpoint. SIAM, 2000.

Werner C Rheinboldt. Differential-algebraic systems as differential equations on man-
 ifolds. Mathematics of computation, 43(168):473–482, 1984.

Casey Rothschild and Florian Scheuer. Redistributive taxation in the roy model. The
  Quarterly Journal of Economics, 128(2):623–668, 2013.

Casey Rothschild and Florian Scheuer. A theory of income taxation under multidi-
  mensional skill heterogeneity. NBER Working Paper No. 19822, 2014.

Casey Rothschild and Florian Scheuer. Optimal taxation with rent-seeking. Review
  of Economic Studies (forthcoming), 2016.

D. Sachs, A. Tsyvinski, and N. Werquin. Nonlinear tax incidence and optimal taxation
  in general equilibrium. NBER Working Paper 22646, 2016.

E. Saez. Using Elasticities to Derive Optimal Income Tax Rates. Review of Economic
  Studies, 68(1):205–229, 2001. ISSN 1467-937X.

Florian Scheuer and Iván Werning. Mirrlees meets diamond-mirrlees. NBER Working
  Paper No. 22076, 2016.

                                         34
Gennady A. Shishkin. [In Russian] Linear Integrodifferential equations of Fredholm.
 Izdatelstvo Buryatskogo Universiteta, Ulan Ude, 2007.

Joseph E. Stiglitz. Self-selection and pareto efficient taxation. Journal of Public
  Economics, 17(2):213–240, 1982.

Mordukhai M. Vainberg. [In Russian] Integro-differential equations. Itogi Nauki i
 Tehniki. Serija "Teorija verojatnostej. Matematicheskaja statistika. Tehnicheskaja
 kibernetika", 1964.

Stephen M Zemyan. The classical theory of integral equations: a concise treatment.
  Springer Science & Business Media, 2012.




                                        35
Appendix

A       Proofs
We start by deriving the expressions for the functional derivatives used in the text. Further technical
details about the definitions of these derivatives and about the construction of a production function
with a continuum of inputs are given below.
                                                                                                        E
Proof of equations (22), (23), and (24). Consider an exogenous disruption (µFˆ E , µL̂ ) of
the initial economy and a tax reform µT̂ , with µ > 0. The corresponding wage disruption is defined
by (see Definition 1)

                               ∂[F + µFˆ E ]                          ∂F
                   µŵiE =                   ({Lj + µL̂E
                                                       j }j∈[0,1] ) −     ({Lj }j∈[0,1] ).
                                   ∂Li                                ∂Li

A first-order Taylor expansion of the right-hand side as µ → 0 yields
                               ˆ    1
                                               ∂2F                        ∂ Fˆ E
                      ŵiE =            L̂E
                                          j           ({Lj }j∈[0,1] )dj +        ({Lj }j∈[0,1] ).
                                0             ∂Li ∂Lj                      ∂Li

    Denote by µŵi and µlˆi the first-order changes in µ → 0 in the wage (beyond the initial disruption)
and labor supply of type i, and let w̃i = wi + µŵiE + µŵi and ˜li = li + µˆli . To a first order in µ → 0,
the perturbed equilibrium is characterized by the following equations. First, the wage of each type
equals its marginal product of labor,

                                         ∂[F + µFˆ E ]                ˆ
                               w̃i =                   ({Lj + µL̂E
                                                                 j + µlj }j∈[0,1] ).
                                                                                                        (39)
                                             ∂Li

Second, the first-order condition of each skill holds,

                                   0 = [1 − T 0 (w̃i ˜li ) − µT̂ 0 (w̃i ˜li )]w̃i − v 0 (˜li ).         (40)

Third, we impose that every agent’s welfare is the same as in the initial equilibrium, i.e., that his
compensating variation is equal to zero,

                                   Ui = u[w̃i ˜li − T (w̃i ˜li ) − µT̂ (w̃i ˜li ) − v(˜li )].           (41)

    A first-order Taylor expansion in µ → 0 of the perturbed wage equation (39) around the initial
equilibrium yields the Gateaux (and hence Frechet) derivative of the wage functional:
                              "                                                                     #
            1               1 ∂[F + µFˆ E ]                       ˆ             ∂F
              (w̃i − wi ) =                      ({Lj + µL̂E
                                                           j + µlj }j∈[0,1] ) −      ({Lj }j∈[0,1] )
            µ               µ        ∂Li                                        ∂Li
                            ˆ 1                                                 ˆ 1
                                   E   ˆ    ∂ 2 F (L)      ∂ Fˆ E (L)      E        ˆlj ∂ F (L) dj.
                                                                                         2
                          =     (L̂j + lj )           dj +            = ŵi +
                             0              ∂Li ∂Lj           ∂Li                0      ∂Li ∂Lj


                                                                36
Therefore, using the definitions of the structural cross-wage and own-wage elasticities (9), (10) (see
above for technical details), we obtain

                   ˆli Li ∂ 2 F (L) ˆ 1 ˆlj Lj ∂ 2 F (L)          ˆli   ˆ 1 ˆ
                                                                             lj
           ŵi =wi                 +   wi                 dj = −wi αi +    wi γij dj.
                    li wi ∂L2i       0    lj w i ∂L i ∂Lj          li    0   lj

This leads to equation (22).
    A first-order Taylor expansion in µ → 0 of the perturbed first-order condition (40) yields
                     h                                                                 i
                  0 = 1 − T 0 (wi li + µwi ˆli + µŵiE li + µŵi li ) − µT̂ 0 (wi li ) . . .
                                                                    
                       × (wi + µŵiE + µŵi ) − v 0 li + µˆli
                     h                                                                              i
                    = 1 − T 0 (wi li ) − µ(wi ˆli + li ŵiE + li ŵi )T 00 (wi li ) − µT̂ 0 (wi li ) . . .

                             × (wi + µŵiE + µŵi ) − v 0 (li ) − µv 00 (li ) ˆli
                      =µ (1 − T 0 (wi li )) (ŵiE + ŵi ) − µwi (wi ˆli + li ŵiE + li ŵi )T 00 (wi li )
                             − µwi T̂ 0 (wi li ) − µv 00 (li ) ˆli .

Hence                       0                      00
            ˆli = 1 − T (wi li ) − wi li T (wi li ) ŵE + ŵi −                                    wi
                                                                                                                   T̂ 0 (wi li )
                                                                          
                                          2                       i
                           00
                        v (li ) + wi T (wi li )00                                  v (li ) + wi2 T 00 (wi li )
                                                                                     00

                                yi T 00 (yi )
                          1 − 1−T                                                                         T̂ 0 (yi )
                                                   E             
                                      0 (y )
                                          i          ŵi      ŵi                       1
                =li l v00 (l )            00 (y )          +        − li l v00 (l )             00 (y )
                     i        i     y i T      i      wi      wi          i        i      y i T      i  1 − T 0 (yi )
                      v 0 (li ) + 1−T 0 (yi )                              v 0 (li ) + 1−T 0 (yi )

                    (1 − p (yi )) ei ŵiE                                                 T̂ 0 (yi )
                                                            
                                                         ŵi             ei
                =li                                 +          − li                                     ,
                     1 + p (yi ) ei             wi       wi         1 + p (yi ) ei 1 − T 0 (yi )
so that, using (22)

                                                       ˆli ˆ 1
                                                                                   !
              ˆli (1 − p (yi )) ei            ŵiE                ˆlj                       ei         T̂ 0 (yi )
                  =                                − αi +      γij dj                  −
               li   1 + p (yi ) ei             wi       li  0      lj                 1 + p (yi ) ei 1 − T 0 (yi )
                                                                                  ˆ 1    ˆlj
                                                                                               !
                                  (1 − p (yi )) ei                         ŵiE
                  =                                                           +     γij dj
                      (1 + p (yi ) ei ) 1 + (1−p(y i ))ei                   wi            lj
                                              1+p(yi )ei αi
                                                                                   0


                                                      ei                           T̂ 0 (yi )
                         −                                                                     .
                                                                                 1 − T 0 (yi )
                                                                            
                                                           (1−p(yi ))ei
                              (1 + p (yi ) ei ) 1 +         1+p(yi )ei αi


Using the definitions of the labor supply elasticities (12), (11) then leads to equation (24).




                                                                   37
    A first-order Taylor expansion in µ → 0 of the level set equation (41) yields

            0 =u[(wi li + µwi ˆli + µli ŵiE + µli ŵi ) − T (wi li + µwi ˆli + µli ŵiE + µli ŵi )
                        − µT̂ (wi li ) − v (li ) − µv 0 (li ) ˆli ] − Ui
              =u[(wi li − T (wi li ) − v (li )) + µ (1 − T 0 (wi li )) (wi ˆli + li ŵiE + li ŵi )
                        − µT̂ (wi li ) − µv 0 (li ) ˆli ] − Ui
                    h                                                                                     i
              =u [(wi li − T (wi li ) − v (li )) + µ (1 − T 0 (wi li )) li (ŵiE + li ŵi ) − µT̂ (wi li )

                        − u [wi li − T (wi li ) − v (li )]
                h                                                      i
              = µ (1 − T 0 (wi li )) li (ŵiE + li ŵi ) − µT̂ (wi li ) u0 (wi li − T (wi li ) − v (li )) .

Hence
                                                         ŵiE
                                                                     
                                          0                     ŵi
                             0 = (1 − T (yi )) yi             +           − T̂ (yi )
                                                          wi    wi
                                                                  ˆli ˆ 1
                                                                                       !
                                                         ŵiE                ˆlj
                                          0
                              = (1 − T (yi )) yi              − αi +      γij dj           − T̂ (yi ) ,
                                                          wi       li  0      lj

where the last equation uses (22). This leads to equation (23).



   We now use equation (24) to derive the closed-form expression (25) for the labor supply adjust-
ment in response to the disruption and tax reform.

Proof of equation (25). The labor supply adjustments {ˆli }i∈[0,1] satisfy equation (24). This is
a linear Fredholm integral equation. Sachs, Tsyvinski, and Werquin [2016] show that its solution is
given by (25), and provide conditions under which the resolvent series Γij converges. This equation
implies that the wage adjustments {ŵi }i∈[0,1] are given by
                                 "                                      #
           ŵi   1 + p (yi ) ei ˆli            ei          T̂ 0 (yi )      ŵE
               =                       +                         0
                                                                          − i
           wi (1 − p (yi )) ei li         1 + p (yi ) ei 1 − T (yi )        wi
                 (                                    ˆ         "                            # )
                       E
                   w ŵi       r   T̂ 0 (yi )     w
                                                         1
                                                                   w j
                                                                      ŵE    r   T̂ 0 (yj )
               = εi       − εi                 + εi        Γij εj         − εj                dj
                      wi         1 − T 0 (yi )         0              wj       1 − T 0 (yj )
                        1 + p (yi ) ei          1         T̂ 0 (yi )       ŵiE
                         ×              +                              −
                       (1 − p (yi )) ei    1 − p (yi ) 1 − T 0 (yi )        wi
                                                                                                 T̂ 0 (yi )
                                           E                                              
                    1 + p (yi ) ei w         ŵi              1            1 + p (yi ) ei r
               =                    εi − 1        +                  −                    εi
                   (1 − p (yi )) ei           wi       1 − p (yi ) (1 − p (yi )) ei            1 − T 0 (yi )
                                        ˆ        "                               #
                     1 + p (yi ) ei w 1               ŵjE           T̂ 0 (yj )
                 +                   εi     Γij εw j        − εrj                  dj,
                    (1 − p (yi )) ei     0            wj           1 − T 0 (yj )




                                                                 38
which yields                        "                              #
                          ŵi              E
                                       w ŵi      r   T̂ 0 (yi )
                              = − αi εi       − εi
                          wi              wi        1 − T 0 (yi )
                                                 ˆ 1       "                              #                           (42)
                                                                    E            0
                                                                 ŵ j         T̂   (yj )
                                  + (1 − αi εw
                                             i )      Γij εw  j       − εrj                 dj.
                                                  0              wj         1 − T 0 (yj )



    We now use derive equation (28), of which the compensating tax reform T̂ is a solution.

Proof of Lemma 2. Using equation (42), we can rewrite the level set constraint (23) as

                                           ŵiE
                                                      
                                                   ŵi
                   0 = (1 − T 0 (yi )) yi       +         − T̂ (yi )
                                            wi     wi
                                                      "                                #
                                                                           T̂ 0 (yi )
                                          E                 E
                               0           ŵi           w ŵi       r
                      = (1 − T (yi )) yi        − αi εi         − εi
                                            wi              wi         1 − T 0 (yi )
                                          ˆ 1     "
                                                           E             0
                                                                                     # 
                                                        ŵj           T̂   (y  j )
                           + (1 − αi εw
                                      i )      Γij εwj       − εrj                    dj − T̂ (yi ) .
                                            0           wj         1 − T 0 (yj )

Rearranging terms leads to
                                                 "      ˆ 1                 #
                      0                          ŵiE            w j
                                                                    ŵE
         0 = (1 − T (yi )) yi (1 −     αi εw
                                           i )        +     Γij εj       dj
                                                  wi      0         wj
                                                      ˆ 1
                                                          (1 − T 0 (yi )) yi
             + (αi εri yi ) T̂ 0 (yi ) − (1 − αi εw                           Γij εrj yj T̂ 0 (yj ) dj − T̂ (yi ) .
                                                                                        
                                                  i )            0
                                                       0 (1 − T (yj )) yj

Changing variables from i to y leads to
                                                               ˆ   ȳ
                                                          (1 − T 0 (y)) y
                T̂ (y) − αy εry y T̂ 0 (y) + 1 − αy εw                    (Γyx εrx x) T̂ 0 (x) dx
                                                      
                                                     y            0
                                                       y (1 − T (x)) x
                                          "       ˆ ȳ              #
                       0               w
                                          ŵyE                 E
                                                            w ŵx
               = (1 − T (y)) y 1 − αy εy        +      Γyx εx     dx ,
                                            wy     y          wx

where the assumption of a one-to-one map i 7→ y (i) ensures that αy(i) = αi , εry(i) = εri , Ω̂E        E
                                                                                               y(i) = Ω̂i ,
                  γij                   Γij
and γy(i),y(j) = y0 (j) , Γy(i),y(j) = y0 (j) . This leads to the functional equation (28).



    We now derive the closed-form solution to equation (28).

Proof of Proposition 2 (1/2). Following Vainberg [1964], Shishkin [2007], we rewrite the func-
tional equation (28) as a first-order ordinary differential equation

                                       − αy εry y T̂ 0 (y) + T̂ (y) = A (y) ,
                                                 
                                                                                                                      (43)




                                                            39
where the right hand side is an auxiliary function A that depends on the unknown function T̂ :
                                                                                  "       ˆ ȳ              #
                                                        0
                                                                                  ŵyE                 E
                                                                                                    w ŵx
                       A (y) = (1 − T (y)) y 1 −                         αy εw
                                                                             y          +      Γyx εx     dx
                                                                                    wy     y          wx
                                               ˆ   ȳ
                                                        (1 − T 0 (y)) y                        0
                                                                        1 − αy εw       r
                                                                                  
                                          −                    0                y (Γyx εx x) T̂ (x) dx.
                                               y        (1 − T (x)) x

Using standard variation of the parameters techniques, we can express the general solution to this
differential equation as
                   "        ˆ    ȳ       ˆ x              !        #   ˆ y          !
                              1                     1                        1
           T̂ (y) = c0 +        r
                                    exp −             r
                                                        du A (x) dx exp        r
                                                                                   du
                          y αx εx x        y αu εu u                     y αu εu u
                          ˆ y          ! ˆ                                                                      (44)
                                              ȳ
                                1
                  =c0 exp         r
                                     du +        E (x, y) A (x) dx,
                           y αu εu u        y


where c0 is a constant to be specified, and E (x, y) is defined by (31). It is easy to verify that this
expression for T̂ indeed satisfies (28).
    Now, using the definition of A (y), in which we substitute for T̂ 0 (x), we obtain that it satisfies
the following equation:
                                                                        "       ˆ ȳ               #
                                      0
                                                                        ŵyE                 E
                                                                                          w ŵx
              A (y) = (1 − T (y)) y 1 −                        αy εw
                                                                   y          +      Γyx εx     dx
                                                                          wy     y          wx
                            ˆ   ȳ
                                (1 − T 0 (y)) y                           1
                                                 1 − αy εw         r
                                                           
                        −              0                 y (Γyx εx x)            ...
                             y (1 − T (x)) x                            αx εrx x
                              "          ˆ x           ! ˆ
                                                              ȳ
                                                                                          #
                                                1
                            × c0 exp              r
                                                     du +        E (u, x) A (u) du − A (x) dx.
                                          y α u εu u         x


This functional equation can be simplified by exchanging the order of the two integrals in last term
of the right hand side:
                                     ˆ    ȳ       ˆ    ȳ
                                                             (1 − T 0 (y)) y Γyx
                                                                                 E (u, x) A (u) dudx
                                      x=y          u=x       (1 − T 0 (x)) x αx
                                     ˆ    ȳ       ˆ    u
                                                             (1 − T 0 (y)) y Γyx
                             =                                                   E (u, x) A (u) dxdu.
                                      u=y              x=y   (1 − T 0 (x)) x αx




                                                                          40
We thus obtain
                                                       "
                                                            E     ˆ ȳ           E
                                                                                     #
                                                         ŵ y                 ŵ
                  A (y) = (1 − T 0 (y)) y 1 − αy εw                    Γyx εw   x
                                                     
                                                   y            +           x      dx
                                                         wy        y          wx
                                              ˆ                                ˆ x           !
                                          w
                                             ȳ (1 − T 0 (y)) y Γyx                   1
                          − c0 1 − αy εy                 0
                                                                        exp              r
                                                                                           du dx
                                               y (1 − T (x)) x αx                y αu εu u
                                          ˆ
                                          ȳ (1 − T 0 (y)) y Γyx
                          + 1 − αy εw  y              0
                                                                     A (x) dx
                                            y (1 − T (x)) x αx
                                          ˆ "ˆ x                                      #
                                       w
                                          ȳ        (1 − T 0 (y)) y Γys
                          − 1 − αy εy                         0
                                                                           E (x, s) ds A (x) dx,
                                            y    y (1 − T (s)) s αs


i.e.,                                   "
                                             E    ˆ ȳ           E
                                                                     #
              A (y)                       ŵ y                ŵ
                      = (1 − T 0 (y)) y        +       Γyx εw
                                                            x
                                                                x
                                                                   dx
            1 − αy εw
                    y                      wy      y          wx
                              ˆ ȳ                             ˆ x             !
                                   (1 − T 0 (y)) y Γyx                  1
                        − c0               0
                                                         exp              r
                                                                            du dx                          (45)
                                y (1 − T (x)) x αx               y αu εu u
                           ˆ ȳ "                         ˆ x                                 #
                                  (1 − T 0 (y)) y Γyx          (1 − T 0 (y)) y Γys
                        +                               −                          E (x, s) ds A (x) dx.
                            y     (1 − T 0 (x)) x αx                   0
                                                            y (1 − T (s)) s αs

But this is a standard linear Fredholm integral equation (see Zemyan [2012]); its solution is therefore
known in closed form. Denote its kernel by
                                       "
                                                0              ˆ x        0
                                                                                                   #
                                         (1 − T   (y)) y Γyx       (1 − T   (y)) y Γ ys
             Λ(0) (y, x) ≡ 1 − αy εw
                                     
                                   y                         −                          E (x, s) ds ,
                                         (1 − T 0 (x)) x αx               0
                                                                y (1 − T (s)) s αs


and                                             "         ˆ ȳ               #
                      AP E (y)          0
                                                  ŵyE                  E
                                                                    w ŵx
                                ≡ (1 − T (y)) y        +       Γyx εx     dx
                      1 − αy εw
                              y                   wy        y         wx
                                       ˆ ȳ                            ˆ x           !
                                            (1 − T 0 (y)) y Γyx                1
                                  − c0             0
                                                                exp              r
                                                                                   du dx.
                                        y (1 − T (x)) x αx               y αu εu u

        Assume that                      ˆ                             2
                                                   Λ(0) (yi , yj ) didj < 1,
                                          [0,1]2

which ensures the convergence of the series (33). We show below that this condition is satisfied in
the case where the production function is CES, the baseline tax schedule T is CRP (i.e., of the form
T (y) = y − 1−τ
            1−p y
                  1−p
                      ), and the disutility of labor is isoelastic.
    We can then write
                                              ˆ ȳ
                          A (y) = AP E (y) +       Λ(0) (y, x) A (x) dx
                                                     y
                                                    ˆ    ȳ
                                                              (   ∞
                                                                  X
                                                                               )
                                   = AP E (y) +                       Λ(n) (y, x) AP E (x) dx
                                                     y        n=0



                                                              41
            Λ(n) is the resolvent kernel defined by
        P
where
                                                        ˆ    ȳ
                                       (n)
                                     Λ       (y, x) =             Λ(n−1) (y, u) Λ(0) (u, x) du
                                                         y


for all n ≥ 1.
     Note that there is a continuum of solutions, indexed by the constant c0 , or equivalently by the
initial condition T̂ (ȳ) (see equation (44)). We show below that, if the baseline tax schedule is Pareto
efficient, then all of these compensating reforms have the same impact on the government budget.
For simplicity, we consider here the solution such that c0 = 0. We obtain the following solution to
the compensating tax reform problem:
                  ˆ   ȳ
      T̂ (y) =             E (x, y) A (x) dx
                  y
                  ˆ   ȳ
                                    "                              ˆ ȳ n X
                                                                          ∞                 o
                                                                                                                 #           (46)
                                             0                                                     0
              =            E (x, y) (1 − T       (x)) x Ω̂E
                                                          x   +                 (n)
                                                                                Λ                            E
                                                                                      (x, s) (1 − T (s)) s Ω̂s ds dx.
                  y                                                  y    n=0


This concludes the proof of equation (30).



    We now derive the budget impact (fiscal surplus) of the wage disruption and its compensation.

Proof of Proposition 2 (2/2). The effect of the wage disruption and the corresponding com-
pensating tax reform on government budget is given by
                   ˆ 1 h                                                                                                              ˆ 1              
                 1                                                                                                      i
R(ŵE ) = lim                T wi + µŵiE + µŵi li + µˆli + µT̂ wi + µŵiE + µŵi li + µˆli                                       di −     T (wi li ) di
          µ→0 µ         0                                                                                                                0
          ˆ 1                 ˆ 1        E               ˆ
                                                            !
                                      ŵi        ŵi     li
        =      T̂ (yi ) di +                 +       +        wi li T 0 (wi li ) di
           0                   0       wi        wi      li
          ˆ 1                 ˆ 1                            ˆ 1
                                     0           ŵiE
        =      T̂ (yi ) di +       T (yi ) yi          di +       T 0 (yi ) yi . . .
           0                   0                  wi          0
                   "                                 #                    ˆ 1        "                                  #
                           E
                       w ŵi     r     T̂ 0 (yi )                     w
                                                                                          ŵE
                                                                                        w j          r     T̂ 0 (yj )
            −αi εi            − εi                      + (1 − αi εi )          Γij εj          − εj                      dj
                          wi        1 − T 0 (yi )                           0              wj          1 − T 0 (yj )
                   "                                 #        ˆ 1        "                                  # !
                           E
                       w ŵi      r    T̂ 0 (yi )           w               w j
                                                                               ŵE       r    T̂ 0 (yj )
                + εi          − εi                      + εi        Γij εj           − εj                       dj di
                          wi        1 − T 0 (yi )               0               wj         1 − T 0 (yj )
          ˆ ȳ                        ˆ ȳ                                       "          ˆ ȳ                      #
                                              0                              w
                                                                                ŵyE                    w ŵx
                                                                                                                E
        =      T̂ (y) fy (y) dy +           T (y) y 1 + (1 − αy ) εy                     +         Γyx εx          dx fy (y) dy
           y                            y                                            wy       y              wx
             ˆ ȳ                                                                           ˆ                                !
                     0                        r    T̂ 0 (y)                             w
                                                                                           ȳ           r     T̂ 0 (x)
          −        T (y) y (1 − αy ) εy                       + 1 + (1 − αy ) εy                  Γyx εx                  dx fy (y) dy.
               y                                1 − T 0 (y)                                  y              1 − T 0 (x)




                                                                         42
Using equation (28), which can be rewritten as
ˆ                                                                      ˆ                              !
                                                                                                                                          αy εry y T̂ 0 (y)
                                                                                                                                                  
     ȳ
                      T̂ 0 (x)                               ŵyE           ȳ
                                                                                    ŵxE                            T̂ (y)
          Γyx εrx               dx =                              +          Γyx εw
                                                                                  x      dx              −                         +                         ,
                    1 − T 0 (x)
                                                                                                                                              
                                                                                                           1 − αy εw       0         1 − αy εw            0
 y                                                           wy            y        wx                             y (1 − T (y)) y           y (1 − T (y)) y


to substitute in the left hand side of the previous equality, we get
                    ˆ                                            ˆ
                        ȳ                      1 − αy εw    y + εy
                                                                     wȳ
                                                                          T 0 (y)
R(ŵE ) =                    T̂ (y) fy (y) dy +                                       T̂ (y) fy (y) dy
                  y                         y       1 − αy εw   y       1 − T 0 (y)
                    ˆ ȳ                                                         ˆ ȳ
                                                    T̂ 0 (y)                           1 − αy εw y + εy
                                                                                                       w
                                                                                                           T 0 (y)
                         T 0 (y) y (1 − αy ) εry                                                                   T̂ 0 (y) αy εry y fy (y) dy
                                                                                                                                    
                 −                                         0
                                                                 f y (y)  dy −                      w           0
                      y                          1 − T (y)                        y        1 − αy εy     1 − T (y)
                 ˆ ȳ                     ˆ ȳ                 w              0
                                                               εy
                                                                        
                                                                             T (y)
               =      T̂ (y) fy (y) dy +           1+                                    T̂ (y) fy (y) dy
                  y                         y             1 − αy εy 1 − T 0 (y)
                                                                     w
                    ˆ ȳ
                              εry      T 0 (y)
                 −                 w        0
                                                   y T̂ 0 (y) fy (y) dy
                      y 1 − αy εy 1 − T (y)
                 ˆ ȳ                     ˆ ȳ 
                                                               εw            T 0 (y)
                                                                        
                                                                y
               =      T̂ (y) fy (y) dy +           1+                                    T̂ (y) fy (y) dy
                  y                         y             1 − αy εw  y     1 − T 0 (y)
                    ˆ ȳ
                          1       1        T 0 (y) h                         i
                 −                    w          0
                                                           T̂ (y) − A (y) fy (y) dy
                      y αy 1 − αy εy 1 − T (y)
                 ˆ ȳ                     ˆ ȳ 
                                                                     T 0 (y)
                                                              
                                                           1
               =      T̂ (y) fy (y) dy +           1−                          T̂ (y) fy (y) dy
                  y                         y             αy 1 − T 0 (y)
                    ˆ ȳ
                          1 T 0 (y)         A (y)
                 +                  0                w y
                                                        f (y) dy.
                      y αy 1 − T (y) 1 − αy εy


where the third equality uses the transformed version (43) of the functional equation (28) defining
T̂ . Substituting for the solution (46) for T̂ , we thus obtain
                                 ˆ    ȳ   ˆ           ȳ                           
                        E
               R(ŵ ) =                                      E (x, y) A (x) dx fy (y) dy
                                  y                 y
                                      ˆ        ȳ                                        ˆ ȳ
                                                      T 0 (y)
                                                                                                              
                                                                 1 A (y)             1
                                 +                                           +   1 −           E (x, y) A (x) dx  fy (y) dy
                                           y        1 − T 0 (y) αy 1 − αy εw
                                                                           y         αy    y


where                                                                                ˆ       ȳ    X
                                                                0
                              A (y) = (1 − T                        (y)) y Ω̂E
                                                                             y   +                {  Λ(n) (x, s)} (1 − T 0 (x)) xΩ̂E
                                                                                                                                   x dx.
                                                                                         y

This concludes the proof of equation (34).



     We now assume away the cross-wage effects, so that there is perfect susbstitutability between
skills in production, but let the marginal product of labor be decreasing.

Proof of Corollary 1. When the production function has the form (35), we have Γij = 0 for all
i, j. The functional equation (28) that defines the welfare compensating tax reform becomes a linear


                                                                                                    43
first-order ordinary differential equation:

                           − T̂ (y) + αy εry y T̂ 0 (y) = − (1 − T 0 (y)) y Ω̂E
                                              
                                                                              y.


The general solution to this ODE is (following the same steps as in the general setting, and choosing
the constant c0 = 0):
                                       ˆ ȳ
                              T̂ (y) =      E (x, y) (1 − T 0 (x)) xΩ̂E
                                                                      x dx.
                                               y

Now suppose in particular that the modified wage disruption is a Dirac delta function at income
y ∗ , i.e., Ω̂E            ∗                           E,n
              y = δ (y − y ). More formally, let {Ω̂y }n≥1 be a sequence of functions converging to
δ (y − y ∗ ) (this construction is standard), and define the compensating tax reform T̂ in response to
δ (y − y ∗ ) as the limit of the sequence T̂ (n) of compensating tax reforms in response to Ω̂E,n
                                                                                              y . We
then obtain
                                                  ˆ ȳ
                    T̂ (y) ≡ lim T̂ (n) (y) = lim      E (x, y) (1 − T 0 (x)) xΩ̂E,n
                                                                                 x I{x≥y} dx
                         n→∞                       n→∞    y
                             ∗                 0    ∗     ∗
                       =E (y , y) (1 − T (y )) y Ω̂E
                                                   y ∗ I{y ∗ ≥y} ,


where the last equality follows from the construction of the Dirac measure. This proves Corollary 1.



     We now show that the choice of constant c0 in the solution (44) to the functional equation (28)
is innocuous: assuming that the baseline tax schedule T is Pareto optimal,32 all the constants c0
lead to the same impact on government revenue. For simplicity, we prove this result in the case of
perfect substitutability between skills in production, i.e., the production function (35).

Lemma 3. Suppose that the tax schedule T is Pareto optimal, and that the production function
is given by (35) with profits taxed at 100%. Then all the solutions to (28) have the same impact on
the government budget.

Proof. If the production function is given by (35) and profits are taxed 100%, government revenue
is given by                      ˆ                        ˆ
                                       1                      1
                                           T (yi ) di +           [Fi (Li ) − wi Li ] di.
                                   0                      0




   32
    If the tax schedule is Pareto suboptimal, an obvious tax reform to implement before any com-
pensation consideration is to first make it efficient.

                                                              44
The change in revenue following a tax reform T̂ is thus given by33
              ˆ    1              ˆ    1                      ˆli
                                                                    !     ˆ   1
                                                                                  "
                                                                                             ˆli           ˆli
                                                                                                               !        #
                                                 0      ŵi                                          ŵi
              T̂ (yi ) di +      T (yi )                    +
                                                           yi di +                    Li Fi0
                                                                                      (Li ) −            +        wi li di
           0                 0                          wi     li       0                     li     wi     li
          ˆ 1               ˆ 1                                     0
                                                                               !              ˆ 1                 0
                                                                                                                          !
                                                                 T̂   (y  i )                                  T̂   (yi )
        =     T̂ (yi ) di +      (1 − αi ) T 0 (yi ) −εri                          yi di +         αi −εri                  yi di
           0                 0                                 1 − T 0 (yi )                     0          1 − T 0 (yi )
          ˆ 1h                                         ˆ 1
                                         0
                                               i                   T 0 (yi )
        =                       r
                T̂ (yi ) − (αi εi yi ) T̂ (yi ) di −        εri                  T̂ 0 (yi ) yi di
           0                                            0       1 − T 0 (yi )
          ˆ 1                               ˆ 1
                        0                              T 0 (yi )
        =                          E
              (1 − T (yi )) yi Ω̂i di −          εri                T̂ 0 (yi ) yi di,
           0                                  0      1 − T 0 (yi )

where the last equality uses the functional equation (28). Now substituting for the solution
                    "        ˆ y           ! ˆ
                                                ȳ
                                                                                 #
             1                      1                                                 1
T̂ 0 (y) =            c0 exp             ds +      E (x, y) (1 − T 0 (x)) xΩ̂E
                                                                             x dx −         (1 − T 0 (y)) y Ω̂E
                                                                                                              y,
           αy εry y           y  α  ε
                                   s s
                                      rs
                                              y                                     α   r
                                                                                     y εy y


we obtain that the term that depends on c0 in the government revenue effect of the tax reform is
                                  ˆ   ȳ
                                                                      "       ˆ y          !#
                                                   T 0 (y)     1                   1
                              −            εry                         c0 exp            ds   yfy (y) dy.                           (47)
                                  y              1 − T 0 (y) αy εry y                r
                                                                               y αs εs s


   Now, the fact that the baseline tax schedule is Pareto optimal implies that there exists a p.d.f. f˜y
and c.d.f. F̃y such that
                                                                                                         !
                                         T 0 (y)   1 F̃y (y) − Fy (y)                          f˜y (y)
                                              0
                                                 = r                  + αy                             −1 .
                                       1 − T (y)  εy      yfy (y)                              fy (y)

This result follows from the analysis of Sachs, Tsyvinski, and Werquin [2016].34
    Thus the term multiplying −c0 in the expression (47) is equal to
  ˆ                (                                !)                  ˆ y           !
        ȳ
                                        f˜y (y)
                       1 F̃y (y) − Fy (y)                1                     1
             εry                          + αy  −1              exp                 ds yfy (y) dy
   y                   εry    yfy (y)   fy (y)         αy εry y                  r
                                                                          y αs εs s
  ˆ ȳ                    1           ˆ y           !        ˆ ȳ                         ˆ y          !
                                                1                                                1
=        F̃y (y) − Fy (y)           exp             ds dy +           f˜y (y) − fy (y) exp              ds dy
   y                       αy εry y               r
                                          y αs εs s             y
                                                                                                    r
                                                                                              y αs εs s

=0,



   33
      Note that the change in revenue following the wage disruption is of course independent of the
choice of the constant c0 in the compensating tax reform (44), so that we can ignore the corresponding
terms.
   34
      In this paper, we derived the optimal marginal tax rates in the case of a production func-
tion with constant returns to scale. However, our analysis of Section B.4.1. easily carries through
straightforwardly to the production function considered here. In particular, the envelope condition
that guarantees incentive compatibility is unchanged.

                                                                        45
where the last equality follows from a simple integration by parts. This concludes the proof of the
Lemma.



     Next we assume that the production function is CES and that the initial tax schedule has a
constant rate of progressivity. We derive formula (38) by two different methods. The first follows
the same steps as the general derivation of formula (30), the second proceeds by showing that T̂ CES
is the solution to a simple second-order ODE. We start by stating several useful properties of this
environment.

Formulas for the CES technology. All of the following properties are derived formally in Sachs,
Tsyvinski, and Werquin [2016]. The CES production function (37) implies that wages are equal to
                                                                                α
                                                     ˆ    1                  1−α
                                     wi =   θ i Lα
                                                 i             θj L1−α
                                                                   j   dj            .
                                                       0


The own-wage elasticities (10) are equal to αi = α for all i. The cross-wage elasticities (9) are equal
to
                                                  θj L1−α
                                                      j
                                       γij =α ´ 1
                                                  θ L1−α dk
                                               0 k k

for all i, j ∈ [0, 1], or after a change of variables,

                                                                   yfy (y)
                                             γxy = α ´ ȳ                                                 (48)
                                                               y
                                                                   sfy (s) ds

for all x, y ∈ [y, ȳ]. Moreover, Lemma 1 simplifies in this case:
             "                            # ˆ                       "                             #
        ˆli      ŵ E
                              T̂ 0
                                   (yi )       1
                                                         γij             ŵ E
                                                                            j         T̂ 0
                                                                                           (yj )
                   i
            = εw
               i      − εri                +     εw
                                                  i    ´1             εw
                                                                       j      − εrj                 dj,
         li       wi        1 − T 0 (yi )    0      1−    γkk εw dk      wj         1 − T 0 (yj )
                                                                    0        k

                     γ
so that Γij = 1−´ 1 γij εw dk .
                   0 kk k
    Suppose moreover the disutility of labor is isoelastic (with parameter e) and that the tax schedule
is CRP, i.e., it has the functional form

                                           1 − T 0 (y) = (1 − τ ) y −p .                                  (49)

All of the labor supply elasticities are then constant:
                                                         e
                                           εr =
                                                1 + pe + (1 − p) αe
                                                     (1 − p) e
                                           εw =                     ,
                                                1 + pe + (1 − p) αe

and we get
                                                     γij                       γij
                                   Γij =             ´1                 =           .
                                           1−   εw         γkk dk           1 − αεw
                                                      0


                                                            46
    Finally, the progressivity term (31) is equal to
                                                                               ˆ    y
                                                                                                          1  y  αε1r
                                                                                                
                                              1                           1             du
                                  E (x, y) =       exp                                               =                 .                     (50)
                                             αεr x                       αεr    x        u               αεr x x

    Note that the key simplification allowed by the CES production function is that the cross-wage
elasticities γij , Γij (resp., γxy , Γxy ) depend only on j (resp., y).



    We now give the proof of formula (38).

Proof of Corollary 2. If the production function is CES and the initial tax schedule is CRP, all
the elasticities are constant and, moreover, the cross-wage elasticities γxy , Γxy do not depend on x.
Following the same steps as in the proof of Proposition 2 above, we obtain that the kernel Λ(0) (y, x)
of the Fredholm integral equation (45) satisfied by the auxiliary function A is separable, i.e., of the
form
                                                  (0)      (0)
                                   Λ(0) (y, x) = Λ1 (y) × Λ2 (x) .

Specifically, we have

                            (0)                         0
                           Λ1 (y) ≡ 1 − αy εw
                                                
                                              y (1 − T (y)) y
                                                          ˆ x
                            (0)           1         Γyx             1         Γys
                           Λ2 (x) ≡                     −                         E (x, s) ds.
                                    (1 − T 0 (x)) x αx     y  (1 − T 0 (s)) s α
                                                                                s


The solution to (45) is then straightforward to obtain, and moreover, the convergence conditions
assumed in the proof of Proposition 2 are satisfied in this case. We can indeed write
                                                                                    ˆ       ȳ
                                                                         (0)                      (0)
                                    A (y) =AP E (y) + Λ1 (y)                                     Λ2 (x) A (x) dx
                                                                                        y


which implies
            ˆ       ȳ                           ˆ    ȳ
                          (0)                               (0)
                         Λ2     (x) A (x) dx =             Λ2 (x) AP E (x) dx
                y                                y
                                                            ˆ   ȳ
                                                                                                       ! ˆ
                                                                                                                  ȳ
                                                                                                                                         !
                                                                      (0)        (0)                                    (0)
                                                 +                   Λ1     (x) Λ2               (x) dx                Λ2     (u) A (u) du
                                                            y                                                 y
                                                     ´ ȳ       (0)
                                                  Λ2 (x) AP E (x) dx
                                                      y
                                            =    ´ ȳ (0)    (0)
                                                                     .
                                              1 − y Λ1 (x) Λ2 (x) dx




                                                                               47
Therefore we get
                                           ´ ȳ     (0)
                                    Λ2 (x) AP E (x) dx
                                               y
                 PE           (0)
    A (y) =A (y) +      (y)  Λ1    ´ ȳ (0)        (0)
                            1 − y Λ1 (x) Λ2 (x) dx
                                  ´ ȳ (1−T 0 (y))y Γyx ´ x (1−T 0 (y))y Γys
                                                                                                
                                                          − y (1−T 0 (s))s αs E (x, s) ds AP E (x) dx
            PE               w
                                 y (1−T 0 (x))x αx
          =A (y) + 1 − αy εy             ´ ȳ                 h          ´ x (1−T 0 (x))x Γys       i .
                                                                Γyx
                                      1 − y (1 − αx εw   x ) αx − y (1−T 0 (s))s αs E (x, s) ds dx

                   ´ ȳ (1−T 0 (y))y          ´ x (1−T 0 (y))y
                                                                                 
                                                                                       PE
                    y    (1−T 0 (x))x γyx − y (1−T 0 (s))s γys E (x, s) ds A               (x) dx
            PE
          =A (y) +                ´ ȳ h        ´x        0 (x))x
                                                                                    i             ,
                            α − y γyx − y (1−T            0
                                                     (1−T (s))s   γ ys E (x,  s) ds   dx

where the last equality uses the properties of the CES environment derived in the previous proof (in
                     γxy
particular, Γxy = 1−αε   w ).

    Now, using the definition of the CRP tax schedule (49), the expression (48) for the cross-wage
elasticities, and the formula (50) for the progressivity term, we get, letting Ey denote the average
income in the economy:
                          ´ ȳ h   y 1−p
                                              xfy (x)         ´x    y 1−p
                                                                                   sfy (s) 1        s
                                                                                                      i    αε1r
                     y             x       α     Ey  y
                                                          −          s          α     Ey αεr x      ds
                                                                                                     x   AP E (x) dx
         PE
 A (y) =A (y) +                  ´ ȳ h xfy (x) ´ x x 1−p sfy (s) 1                              1r i
                          α − y α Ey               − y s                 α Ey αεr x xs αε ds dx
                         ´ ȳ h p                1     −1− αε 1    ´ x p+ 1                      i
                               x  f   (x)   −        x          r
                                                                         s      αεr f (s) ds AP E (x) dx
                          y         y          αε  r                 y                y
       =AP E (y) + y 1−p            ´ ȳ h                                 1    ´ x p+ 1                   i
                                                           1     −p−
                            Ey − y xfy (x) − αεr x                       αεr
                                                                                  y
                                                                                    s     αεr f (s) ds dx
                                                                                                 y
                         ´ ȳ p P E                               1
                                                                       ´  ȳ        1
                                                                               p+ αεr
                                                                                        h´
                                                                                            ȳ   −1− αε1
                                                                                                             PE
                                                                                                                       i
                          y
                              x A        (x) f y (x)   dx  −    αε  r    y
                                                                             s             s
                                                                                               x         r
                                                                                                           A    (x) dx   fy (s) ds
       =AP E (y) + y 1−p                                ´ ȳ p+ r     1
                                                                           h´
                                                                               ȳ −p− r    1
                                                                                                   i
                                                     1
                                                   αεr y s                        x
                                                                    αε                    αε dx f (s) ds
                                                                              s                      y
                                                          h          1
                                                                            ´ ȳ          1
                                                                                                              i
                         E y A (y) − αε1 r E y p+ αεr y x−1− αεr AP E (x) dx
                             p PE          
       =AP E (y) + y 1−p                                       
                                                                             1−p− αε  1                        ,
                                                                                        r
                                          1        1                    ȳ
                                        αεr 1−p− 1 r E y                y                  −1
                                                                αε



where the third equality exchanges the order of the integrals in the numerator and the denominator.
But we have
                                                                     ˆ    ȳ                  αε1r
                                                                               y 1−p γyx     x
                    AP E (y) = (1 − τ ) y 1−p Ω̂E
                                                y − c0                                               dx
                                                                      y        x1−p α        y
                                                                                     ˆ ȳ                          !
                                                   1−p               c0 − 1r                        1
                                   = (1 − τ ) y          Ω̂E
                                                           y   −        y αε                x   p+ αε r
                                                                                                          fy (x) dx y 1−p .
                                                                     Ey                y




                                                                      48
                                                                1
                                                                          h      1
                                                                                   i
                                                          c0 − αε
We thus get (replacing the constant                       Ey y
                                                                  r
                                                                         E y p+ αεr with simply c0 )


A (y) = (1 − τ ) y 1−p Ω̂E
                         y − c0 y
                                  1−p

                                                                                ´ ȳ p+ αε1r E                               1
                                                                                                                                 
                    h                   i                                                                               1−p− αε r
                 E (1 − τ ) y Ω̂E
                                y − c0 y −
                                                                1
                                                               αεr E    (1 − τ ) y xy                     c0
                                                                                              Ω̂x dx − 1−p−   1  y   ȳ
                                                                                                                     y            − 1
                                                                                                             αεr
        + y 1−p                                                                                1
                                                                                            1−p− αεr
                                                                                                        
                                                                    1      1           ȳ
                                                                   αεr 1−p− 1 r E y    y             −1
                                                                                αε

                     1−p
      = (1 − τ ) y         Ω̂E
                             y   + c1 y    1−p
                                                 ,

where the constant c1 is defined as
                    h      i                     h´             i1
                                        1            ȳ    y p+ αεr
                                                             
                   E y Ω̂E
                         y −           αεr E         y
                                                         Ω̂E
                                                           x
                                                           x dx                                          c0 E [y]
   c1 ≡ (1 − τ )                                 1
                                               1−p− αε
                                                               −                                                  1
                                                                                                                  1−p− αε
                                                                                                                               .
                                                       r                                                                  r
                    1     1                 ȳ                                          1     1                ȳ
                             1
                   αεr 1−p− αε r
                                       E y  y             −1                                     1
                                                                                       αεr 1−p− αε r
                                                                                                       E y     y            −1

    Therefore the compensating tax reform is given by
                             ˆ    ȳ                             αε1r
                               1  y  αε1r                      y
                T̂ (y) =         rx x
                                             A (x) dx + c0
                          y   αε                                 ȳ
                         ˆ ȳ                                                            αε1r
                               1  y  αε1r h            1−p E          1−p
                                                                             i            y
                       =         r
                                               (1 − τ ) x Ω̂x + c1 x           dx + c0
                          y αε x x                                                        ȳ
                                           ˆ ȳ  p+ 1
                                       1         y      αε r
                       = (1 − τ ) y −p r                     Ω̂E
                                                               x dx
                                      αε y x
                                                    1−p− αε1r         !               αε1r
                               1         1           ȳ                     1−p         y
                         + c1 r                                     − 1   y      + c0          .
                              αε 1 − p − αε1 r       y                                  ȳ

Letting ȳ → ∞ and choosing as above the constant c0 = 0, we obtain
                                                          ˆ    ∞    y p+ αε1r
                                                  1
              T̂ (y) = (1 − τ ) y −p                                              Ω̂E
                                                                                    x dx
                                                 αεr       y         x
                                                                             ˆ ȳ                                             (51)
                                                                                    y p+ αε1r E
                                                           h                                       
                                                 1                 i    1
                            + (1 − τ )                     E y Ω̂E
                                                                 y   −     E                 Ω̂ x dx   y 1−p .
                                                E [y]                  αεr     y    x

                      1−τ 1−p                                       1
                                                                           ´∞          1
                                                                                  y 1+ αεr
Since T (y) = y −     1−p y            and E (x, y) =              αεr y   y      x          dx, this expression can be rewritten as
                                       ˆ    ∞
                       T̂ (y) =                 E (x, y) [(1 − T 0 (x)) xΩ̂E               0
                                                                           x ]dx + c (1 − T (y)) y,
                                        y


where the constant c is given by
                                                               ˆ ȳ  
                                                                      y p+ αε1r E
                                                 h                                  
                                 1                     E
                                                         i  1
                             c=                  E y Ω̂y − r E                 Ω̂x dx .
                                E [y]                      αε    y    x

This concludes the proof of Corollary 2.


                                                                           49
    We finally give an alternative proof of formula (38).

Alternative proof of Corollary 2. In the CES-CRP environment, the functional equation solved
by T̂ reads: for all y ∈ [y, ȳ],
                                                        ˆ      ȳ
                                                0
                    y   p−1               r p
                              T̂ (y) − αε y T̂ (y) +                γyx εr xp T̂ 0 (x) dx = (1 − τ ) Ω̂E
                                                                                                       y.              (52)
                                                           y


Since γyx depends only on x, we can differentiate this equation with respect to y to obtain, after
rearranging:

                                                    T̂ 0 (y)          T̂ (y)
                  − αεr T̂ 00 (y) + (1 − pαεr )              + (p − 1) 2 = (1 − τ ) y −p Ω̂E0
                                                                                           y .
                                                                                                                       (53)
                                                        y               y
                               0
where Ω̂E0            w   E
         y = (1 − αε ) ŵy /wy . This is a second order linear (Euler) ODE which can be easily
solved in closed form.
    Consider first the homogeneous equation,

                                                                    T̂ 0 (y)          T̂ (y)
                              − αεr T̂ 00 (y) + (1 − pαεr )                  + (p − 1) 2 = 0.
                                                                        y               y

The general solution to this equation has the form

                                                T̂H (y) = c1 y r1 + c2 y r2 ,

where r1 , r2 are the roots of the characteristic polynomial, i.e., the solutions to

                                                                                      ry r−1          yr
                              0 = − (αεr ) r (r − 1) y r−2 + (1 − pαεr )                     + (p − 1) 2
                                                                                        y             y
                     i.e., 0 = (αεr ) r2 − (1 + (1 − p) αεr ) r + (1 − p) .

We find                                                q
                                                    r                     2
                                    [1 + (1 − p) αε ] ± [1 + (1 − p) αεr ] − 4 (1 − p) αεr
                      r1 , r2 =
                                                           q             2αεr
                                                                                       2
                                    [1 + (1 − p) αεr ] ±            [1 − (1 − p) αεr ]
                                =                                                          ,
                                                        2αεr
hence we obtain that 0 < r1 < r2 are given by

                                                        r1 = (1 − p)
                                                              1
                                                        r2 = r
                                                             αε
                                                         e                                                     1+pe
where the last equality follows from εr =           1+pe+(1−p)αe ,              which implies r2 = (1 − p) +    αe .




                                                                    50
    Next, a particular solution to the initial second-order ODE (53) is given by the method of the
variation of parameters. We seek the general solution T̂ (y) to the differential equation of the form

                                            T̂ (y) = c1 (y) y r1 + c2 (y) y r2 ,

where r1 , r2 are given by the expressions above and c1 (y) , c2 (y) are the unknown functions to solve
for. Impose
                                       c01 (y) y r1 + c02 (y) y r2 = 0.

We thus have

       T̂ 0 (y) =r1 c1 (y) y r1 −1 + r2 c2 (y) y r2 −1
      T̂ 00 (y) =r1 (r1 − 1) c1 (y) y r1 −2 + r2 (r2 − 1) c2 (y) y r2 −2 + r1 c01 (y) y r1 −1 + r2 c02 (y) y r2 −1 .

Substituting into the ODE (53) yields

(1 − τ ) y −p Ω̂E0           r                                r1 −2
                                                                    − αεr r1 (r1 − 1) c1 (y) y r1 −2 + r1 c01 (y) y r1 −1
                                                                                                                        
                y = [(1 − pαε ) r1 c1 (y) + (p − 1) c1 (y)] y

                   + [(1 − pαεr ) r2 c2 (y) + (p − 1) c2 (y)] y r2 −2 − αεr r2 (r2 − 1) c2 (y) y r2 −2 + r2 c02 (y) y r2 −1
                                                                                                                          

                  = − αεr r1 c01 (y) y r1 −1 − αεr r2 c02 (y) y r2 −1

where the second equality follows from the fact that r1 and r2 are the roots of the characteristic
polynomial. We therefore obtain the system of equations

                           c01 (y) y r1 + c02 (y) y r2 = 0
                                                                           1
                           r1 c01 (y) y r1 −1 + r2 c02 (y) y r2 −1 = −        (1 − τ ) y −p Ω̂E0
                                                                                              y
                                                                          αεr

which is linear in the two unknowns c01 (y) , c02 (y). Its solution is
                                !                                   !−1                                    !
                      c01 (y)                y r1         y r2                            0
                                    =
                      c02 (y)             r1 y r1 −1   r2 y r2 −1           − αε1 r   (1 − τ ) y −p Ω̂E0
                                                                                                      y
                                                                      !                                    !
                                      1        r2 y r2 −1    −y r2                        0
                                    =                                                                          ,
                                      W       −r1 y r1 −1     y r1          − αε1 r   (1 − τ ) y −p Ω̂E0
                                                                                                      y


where W is the Wronskian of the two functions y r1 and y r2 , equal to

                                             y r1         y r2
                                W =                                  = (r2 − r1 ) y r1 +r2 −1 .
                                          r1 y r1 −1   r2 y r2 −1




                                                              51
Thus we obtain, using the expressions of r1 , r2 ,

                              y r2 αε1 r (1 − τ ) y −p Ω̂E0
                                                         y
                                                                  1
                                                                αεr (1 − τ )
                  c01 (y) =                                 =   1              Ω̂E0
                                                                                 y
                                 (r2 − r1 ) y r1 +r2 −1        αε r − (1  − p)
                                 y r1 αε1 r (1 − τ ) y −p Ω̂E0
                                                             y
                                                                        1
                                                                      αεr (1 − τ )          1
                  c02 (y) = −                     r  +r   −1
                                                               =  −   1             y 1−p− αεr   Ω̂E0
                                                                                                   y ,
                                    (r2 − r1 ) y   1    2
                                                                    αεr − (1 − p)

i.e.,

                          1−τ
        c1 (y) =a1 +                 Ω̂E
                     1 − (1 − p) αεr y
                                     ˆ ȳ
                          1−τ                    1
        c2 (y) =a2 +               r
                                          x1−p− αεr Ω̂E0x dx
                     1 − (1 − p) αε y
                                                                        ˆ ȳ                   
                          1−τ                    1
                                           1−p− αε      E             1                1
                                                                                  −p− αε     E
               =a2 +                   −y          r
                                                     Ω̂ y −  1 − p −            x        r
                                                                                           Ω̂x dx   ,
                     1 − (1 − p) αεr                                 αεr    y


where a1 , a2 are constants to be determined, and where the last equality assumes that as ȳ → ∞,
                 1
we have ȳ 1−p− αεr Ω̂E
                      ȳ → 0).
    The general solution to the ODE (53) is therefore finally given by
                                                
                                1−τ
           T̂ (y) = a1 +                     Ω̂ y 1−p
                                               E
                           1 − (1 − p) αεr y
                                                                             ˆ
                                                                     1 − τ ȳ −p− 1r E
                                                                                             
                                   1−τ            1−p− αε1
                                                                E                                 1
                   + a2 −                     r
                                                y          r
                                                             Ω̂ y  +     r
                                                                                x     αε Ω̂ dx y αεr
                                                                                           x
                             1 − (1 − p) αε                           αε      y
                                                                   ˆ ȳ  p+ 1          
                   h
                         1−p         1
                                         i
                                                        −p       1         y    αεr   E
                  = a1 y     + a2 y αε r
                                           + (1 − τ ) y                             Ω̂x dx .
                                                               αεr y x

This expression implies
                                                                
                          0                 −p      1     1
                                                            r −1
                                                                     1 − τ −p E
                       T̂ (y) = a1 (1 − p) y + a2 r y    αε        −       y Ω̂y
                                                   αε                 αεr
                                                  ˆ ȳ  p+ 1            
                                 1 − τ −1−p 1            y       αεr
                               +       y                             Ω̂E
                                                                       x dx .
                                  αεr           αεr y x

To find a relationship between the two constants a1 , a2 , we plug these expressions into the functional
equation (52). Tedious but straightforward algebra leads to:
                              i 1−τ h       i 1−τ 1                           ˆ   ȳ    y p+ αε1r            
                    1 h     1
         0 =a1 + a2 E y p+ αεr −    E y Ω̂E
                                          y +         E                                                Ω̂E
                                                                                                         y dy       .
                   Ey            Ey            Ey αεr                            x        u

Note that this equation alone does not allow us to identify separately a1 and a2 , so that there is a




                                                           52
continuum of tax reforms (indexed by, say, a2 ) that are distribution-neutral. Therefore we obtain
                         h                     ˆ ȳ  p+ 1                           i
                  1−τ           E
                                  i          1         y   αεr   E        a2  h      1
                                                                                 p+ αε
         T̂ (y) =         E y Ω̂y − E                          Ω̂x dx −      E y       r
                                                                                            y 1−p
                   Ey                       αεr y x                      1−τ
                                                  ˆ ȳ  p+ 1
                          1                    1         y  αεr
                  + a2 y αεr + (1 − τ ) y −p r                   Ω̂E
                                                                   x dx.
                                             αε y x

                          1
As ȳ → ∞, the term y αεr explodes unless a2 = 0. We thus take a2 = 0 and obtain the following
compensating reform:
                                           ˆ ∞  p+ 1
                                   −p   1       y      αεr
                 T̂ (y) = (1 − τ ) y                       Ω̂E
                                                             x dx
                                       αεr y    x
                                      h                ˆ ∞  p+ 1        
                             1−τ            E
                                              i      1          y αεr
                          +           E y Ω̂y − E                     Ω̂x dx y 1−p .
                                                                        E
                              Ey                    αεr y       x

This is the same expression as (51).



    We finally provide technical details for several elements of the paper.

Technical details for the general equilibrium environment. We refer to Sachs, Tsyvinski,
and Werquin [2016] for the rigorous definition of the production function with a continuum of
inputs, the marginal product of labor (2), and the corresponding elasticities (9), (10).



    The following technical details clarify the construction of the Gateaux and Frechet derivatives
used in the text.

Technical details for the functional derivatives. We refer to Golosov, Tsyvinski, and Werquin
[2014] for the existence of the Gateaux derivatives in the direction of any tax reform T̂ (·), namely
(in the case, say, of the labor supply functional T 7→ li (T )):

                              ˆli ≡ dli (T ) · T̂ ≡ lim li (T + µT̂ ) − li (T ) .
                                                    µ→0           µ

In particular, we show in Golosov, Tsyvinski, and Werquin [2014] that this derivative exists as soon
as the optimal labor supply li is unique in the initial economy (e.g., this is the case if the initial tax
schedule is convex), and a (generically satisfied) technical condition holds, ensuring that the labor
supply elasticities are well defined.
     The initial tax schedule T is bounded and twice continuously differentiable on R+ , with bounded
first and second derivatives, and marginal tax rates bounded away from 1.35 We assume that the

   35
     In Section 3.2, in order to interpret our main result, we use a tax schedule that is unbounded,
and such that the marginal tax rates converge to 1. Since we assume that incomes are bounded,
however, we can work on a large enough compact interval so that the appropriate restrictions on the
tax function hold.

                                                     53
tax reforms T̂ that the government can implement are continuously differentiable, bounded, with
bounded first derivative. This defines a Banach space X on which the norm of a function T̂ is given
            P1
by kT̂ kX = k=0 sup |T̂ (k) (y) | where T̂ (k) is the k th derivative of T̂ .
                  y∈R+
    Below we compute the Gateaux derivatives df (T ) · T̂ of several functionals in any direction T̂ .
Assume that the Gateaux derivatives df (T̃ ) exist for all T̃ in a neighborhood U ⊂ X of T . Let
B (X, R) denote the space of bounded linear operators on X. It is endowed with the norm k · kB
defined by the smallest M > 0 such that for all T̂ ∈ X,

                                 kdf (T̃ ) · T̂ − df (T ) · T̂ k ≤ M kT̂ k.

We can the check that the map df : U → B (X, R) is continuous at T , in the sense that

                            kT̃ − T kX → 0 ⇒ kdf (T̃ ) − df (T ) kB → 0.

That is, the derivative depends continuously on the initial tax schedule T . This implies that f is
also Frechet differentiable at T , and that the corresponding derivative coincides with the Gateaux
derivative.




B      Extension: participation decisions
We now set up an extension of our model to include an extensive margin, i.e., participation decisions.
We require that the compensating tax reform offsets not only the welfare gains and losses of the
agents who are employed both before and after the wage disruption, but also those of all of the other
agents in the economy (the non-employed and those who switch employment status). Remarkably,
and despite the additional channel of response to wage disruption and tax reforms, we show that
formula (30) still characterizes the compensating tax reform in that case. We now briefly describe
this extension and the formal argument.
    Heterogeneity is now two-dimensional: individuals are indexed by their skill i ∈ [0, 1] and by
their fixed cost of working κ ∈ R+ . The utility function is given by

                                   U (c, l) = u[c − v (l) − κI{l>0} ],

where I{l>0} is an indicator function equal to 1 if the agent is employed (i.e., l > 0).
     An individual of type (i, κ) chooses both whether to participate in the labor force at wage wi ,
and if so, how much effort to provide. If he decides to stay non-employed, his labor supply and
income are equal to zero and he consumes the government-provided transfer −T (0). Thus agent
(θ, χ) solves the maximization problem
                                                                               
                   Ui (κ) ≡ max sup u [wi l − T (wi l) − v (l) − κ] ; u (−T (0)) .
                                   l>0



                                                    54
Due to the lack of income effects, the labor supply li that an agent (i, κ) chooses conditional on
participation is independent of κ, and it is the solution to the first order condition

                                           v 0 (li ) = [1 − T 0 (wi li )] wi .

Moreover, an agent with skill i decides to participate if and only if his fixed cost of work κ is smaller
than a threshold κ̄i , given by

                                 κ̄i    = wi li − T (wi li ) − v (li ) + T (0) .                     (54)

Note that both li and κ̄i are endogenous to the tax schedule: the intensive margin choice of labor
effort li depends on the marginal tax rate T 0 (yi ), while the extensive margin choice of participation
depends on the average tax rate relative to transfers, T (yi ) − T (0).
     Denote by fi (κ) the density of κ conditional on skill i, by
                                                     ´ κ̄i
                                                           fi (κ) dκ
                                                πi = ´0∞
                                                      0
                                                           fi (κ) dκ

the employment rate within the population of skill i, and by
                                                        ˆ     κ̄i
                                              Li = li               fi (κ) dκ
                                                          0

the total amount of labor supplied by workers of skill i. The rest of the environment is identical to
that of Section 1.
    We define the participation elasticity ηiT of the population with skill i with respect to their
average tax rate as

                                 ∂ ln πi                                       fi (κ̄i )
               ηiT ≡                               = [yi − T (yi ) + T (0)] ´ ∞           .
                       ∂ ln [yi − T (yi ) + T (0)]                         πi 0 fi (κ) dκ

This elasticity is determined by the reservation density fi (κ̄i ) of agents with skill i who are close to
indifference between participation and non-participation in the baseline tax system. We also define
the participation elasticity ηiw with respect to the wage as

                                     ∂ ln πi                         fi (κ̄i )
                             ηiw ≡           = (1 − T 0 (yi )) yi ´ ∞           .
                                     ∂ ln wi                     πi 0 fi (κ) dκ

Note that these elasticities are partial equilibrium concepts: they ignore the feedback impact of
these initial adjustments in participation on individual wages and, in turn, labor supply.
    It is not difficult to extend the formulas leading to equation (28) to this more general environ-
ment. The details of the derivations are left to the reader and are available upon request.
    Adding the participation decisions does not affect formula (30). To understand this claim,
note that keeping unchanged the welfare of those who are employed neither before nor after the
perturbation requires leaving the unemployment transfer T (0) unaffected. Moreover, by construction


                                                            55
(in order to also keep the welfare of the always-employed agents unchanged), the combination of the
wage disruption inflow and the tax reform must leave the disposable income net of the disutility of
labor, [yi − T (yi ) − v (li )], unchanged for all i. Now, since the participation decision of an individual
with skill i depends only on the difference between these values (see equation (54)), we obtain that
the participation threshold κ̄i must also remain constant. That is, in order to keep everyone’s
welfare constant, the compensating tax reform must ensure that the individuals who were employed
(resp., non-employed) before the immigration inflow remain so, i.e., that no one ends up switching
participation status. This implies in turn that the values of the participation elasticities ηiT and ηiw
(which otherwise would appear in the variables Γyx and the endogenous wage adjustments ŵi ) are
irrelevant for the construction of the compensating tax reform, and that formula (30) continues to
apply.




                                                    56
