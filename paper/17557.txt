                                 NBER WORKING PAPER SERIES




       IDENTIFYING DEMAND WITH MULTIDIMENSIONAL UNOBSERVABLES:
                     A RANDOM FUNCTIONS APPROACH

                                             Jeremy T. Fox
                                              Amit Gandhi

                                         Working Paper 17557
                                 http://www.nber.org/papers/w17557


                      NATIONAL BUREAU OF ECONOMIC RESEARCH
                               1050 Massachusetts Avenue
                                 Cambridge, MA 02138
                                    November 2011




Thanks to Daniel Ackerberg, Richard Blundell, Andrew Chesher, Philip Haile and Jack Porter for
helpful comments. Thanks to Philip Reny for earlier collaboration. Our email addresses are jtfox@umich.edu
and agandhi@ssc.wisc.edu. The views expressed herein are those of the authors and do not necessarily
reflect the views of the National Bureau of Economic Research.

NBER working papers are circulated for discussion and comment purposes. They have not been peer-
reviewed or been subject to the review by the NBER Board of Directors that accompanies official
NBER publications.

© 2011 by Jeremy T. Fox and Amit Gandhi. All rights reserved. Short sections of text, not to exceed
two paragraphs, may be quoted without explicit permission provided that full credit, including © notice,
is given to the source.
Identifying Demand with Multidimensional Unobservables: A Random Functions Approach
Jeremy T. Fox and Amit Gandhi
NBER Working Paper No. 17557
November 2011
JEL No. C0,L0

                                             ABSTRACT

We explore the identification of nonseparable models without relying on the property that the model
can be inverted in the econometric unobservables. In particular, we allow for infinite dimensional
unobservables. In the context of a demand system, this allows each product to have multiple
unobservables. We identify the distribution of demand both unconditional and conditional on market
observables, which allows us to identify several quantities of economic interest such as the (conditional
and unconditional) distributions of elasticities and the distribution of price effects following a merger.
Our approach is based on a significant generalization of the linear in random coefficients model that
only restricts the random functions to be analytic in the endogenous variables, which is satisfied by
several standard demand models used in practice. We assume an (unknown) countable support for
the distribution of the infinite dimensional unobservables.


Jeremy T. Fox
Economics Department
University of Michigan
238 Lorch Hall
611 Tappan St.
Ann Arbor, MI 48104
and NBER
jeremyfox@gmail.com

Amit Gandhi
University of Wisconsin
1180 Observatory Drive
Madison, WI 53706-1393
agandhi@ssc.wisc.edu
1      Introduction

In this paper we study the identification of nonseparable demand systems


                                             Q = D(P, ξ),                                           (1)


where Q is a vector of market level quantities demanded for a set of goods, P is a vector of prices

for these goods, ξ ∈ Ξ is a demand error, and D (·, ·) is the demand system. We do not impose that

ξ is independent of P , as price may be determined in market equilibrium. Rather, we assume that

the demand error ξ is independent of a vector of instruments Z. The non-separable demand system

contrasts with models that assume the error is additively separable, i.e.,


                                         D(P, ξ) = D(P ) + ξ.


Although additive separability has convenient econometric features, there is little underlying economic

basis for demand shocks being separable. For example, when market demand is the aggregation of

individual discrete choices, the quantity sold of product j in a market is a function of the demand

errors for product j and all competing products in the market, which is inconsistent with the additive

structure above (Berry, 1994). Our interest thus centers on identification of the non-separable model

(1).

    There are two major existing literatures on the identification of nonseparable models with endoge-

nous regressors. First, the literature on the nonparametric identification of simultaneous equation

models takes as its starting point the assumption that the demand system (1) is invertible in the error

ξ (Brown, 1983; Roehrig, 1988; Benkard and Berry, 2006; Matzkin, 2008; Berry and Haile, 2010; Berry

et al., 2011). In contrast, we do not require invertibility. Invertibility in ξ requires, at a minimum,

the order restriction that there are only as many unobservables as there are products demanded; the

dimensionality of ξ equals the dimensionality of Q. Instead, we allow the error to be infinite dimen-

sional and hence do not impose the structure that demand is invertible in the unobservable ξ. This

allows for considerable richness in the unobserved market level heterogeneity of demand models, as


                                                   2
we illustrate later using the standard discrete choice setting for demand for differentiated products

(see e.g., Berry, Levinsohn and Pakes (1995) or BLP).

   Another literature that can be applied to demand identification is the literature on nonparametric

control functions (Altonji and Matzkin, 2005; Chesher, 2003; Imbens and Newey, 2009; Blundell and

Matzkin, 2010). This literature can allow for multiple unobservables in the demand equation, and in

particular more unobservables than the number of goods, but cannot allow for such multidimensional

unobservability in the equilibrium pricing equations. This means adapting these approaches to de-

mand models requires that strong assumptions be placed on the reduced form pricing equation that

are at odds with standard supply side models: both the demand and supply side unobservables should

impact equilibrium prices under standard mechanisms according to which prices are set. Thus allow-

ing for multidimensional unobservables in demand requires that we also allow for multidimensional

unobservables to affect prices in order to be consistent with standard economic theory.

   As far as we are aware, the identification problem of introducing multiple unobservables per prod-

uct in a standard supply and demand setting has yet to be studied. As discussed above, multiple

unobservables preclude inverting demand, and thus the demand unobservables themselves (for any

realization of a market) cannot be identified. Instead, we will seek identification of the distribution

of demand functions, both conditional and unconditional on the realization of the market observ-

ables. We will assume that any realization of the demand function function D(·, ξ) for ξ ∈ Ξ is a

real analytic function in prices, which nonparametrically generalizes a property of various well known

demand systems used in practice (e.g., the AIDS model, the mixed logit BLP model). The key to

our approach is then showing that under a general mechanism that governs how prices are set (which

allows for multidimensional unobservables that include the demand unobservable ξ, and is consistent

with standard models of price equilibrium), the reduced form of the model takes on the form of a sys-

tem of random analytic functions that are indexed by an infinite dimensional unobservable consisting

of both the demand unobservables ξ and the supply unobservables ω. We first show this system of

random analytic functions representing the reduced form of the model can be uniquely identified from

the data. We then show that, given a minimal relevance condition on the instruments, the structural

demand feature of interest, namely the distribution of demand functions, can be recovered from the


                                                  3
reduced form.

    Our approach can be seen as building upon the literature on the identification of random func-

tions in a linear in random coefficients framework in order to study nonlinear models with multiple

unobservables. This literature has established nonparametric identification of the distribution of a

finite dimensional vector of linear random coefficients (Beran and Millar, 1994; Beran, 1995), and has

modeled endogeneity via an auxiliary instrumental variables equation that is identified along with the

equation of interest (Hoderlein et al., 2010). These approaches, however, fundamentally rely upon

the linear functional form in both the outcome and auxiliary equations. Linearity of demand in the

unobservables is a strong restriction (i.e., inconsistent with the BLP model), and the assumption

that prices are also linear in the unobservables is even stronger as this does not arise readily from

equilibrium assumptions even when demand is linear. We abstract from linearity and instead exploit

the deeper property of analyticity, which is compatible with a rich array of possible nonlinear demand

functions and standard equilibrium assumptions.1

    Because we identify a distribution over random demand functions indexed by the infinite dimen-

sional unobservable ξ, we impose the additional condition that the true underlying distribution of the

unobservable has some ex-ante unknown countable support. This condition provides a general class

of distributions with infinite support that does not require us to impose further regularity conditions

on the space of unobservables Ξ. We discuss this condition in Section 5, where we outline a possible

extension that would allow us to add continuous, additive unobservables to demand and prices.



2     Model

We lay out primitive assumptions concerning demand and supply. First, we define a real analytic

function.

Definition 1. Let X be a non-empty open set in Rk for a given k. A function g : X → R is analytic

if, given any interior point w ∈ X , there is a power series in x − w that converges to g (x) for all x in
   1 The only other paper of which we are aware that has attempted to extend the identification of random coefficients

from a linear to a nonlinear setting is Liu (1996). Liu does not consider the problem of infinite dimensional unobservables,
non-finite support of the unobservables, or the effects of endogeneity, and thus the results are not applicable to our
problem.


                                                             4
some neighborhood U ⊂ X of w.

   We also define an extension of real analytic functions to vector valued functions.

Definition 2. Let X be a non-empty open set in Rk for a given k. A function g : X → Rl (for a given

l) is vector valued analytic if each component function gi : X → R for i = 1, . . . , l is real analytic.

   We will exploit the property that two real analytic functions that are equal on an open set are

equal everywhere (Krantz and Parks, 2002), which implies in a straightforward way that two vector

valued real analytic functions exhibit the same property

   Consider a population of markets. For simplicity we will assume that each possible market in

the population has J products, but we could allow the number of products to vary across markets

at the expense of complicating notation. For any market in the population, we observe the real-

izations of prices P = (P1 , . . . , PJ ) and quantities Q = (Q1 , . . . , QJ ) and a vector of cost shifters

Z = (Z1 , . . . , ZJ ). Thus, the joint distribution of the observables (P, Q, Z) is identified from market

data. A market is also characterized by two unobservables, a demand side unobservable ξ ∈ Ξ and

a cost side unobservable ω ∈ Ω, whose roles will now be explained.. All other exogenous demand

shifters, such as observed consumer demographics and observed product characteristics other than

price, are implicitly conditioned on in the background.

Assumption 1. Demand is a function D(·, ξ) : P → RJ for an open set P ⊆ RJ that maps any

possible vector of prices p ∈ P into a vector q ∈ RJ of quantities demanded. Different demand

functions are indexed by different demand side unobservables ξ ∈ Ξ, and each ξ ∈ Ξ gives a unique

demand system D (·, ξ). For any realization ξ ∈ Ξ, the demand system D(·, ξ) = (D1 (·, ξ), . . . , DJ (·, ξ))

is such that D(·, ξ) is a vector valued analytic function.

   With this notation, each D (·, ξ) is a separate system of functions and knowing the distribution of

ξ tells us the distribution of demand systems. The key restriction in the assumption is that demand

is an analytic function of prices. Analyticity of market demand is a nonparametric generalization of

the linear random coefficients model in Beran and Millar (1994) and Hoderlein et al. (2010) as well

as other standard demand systems that are used in practice, such as the AIDS demand system of


                                                     5
Deaton and Muellbauer (1980) and the mixed logit demand used in BLP. The generality afforded

by the analyticity assumption allows Ξ to be of arbitrary dimension. In particular, it can be infinite

dimensional as opposed to the standard restriction that the demand unobservable has dimension equal

to the number of products J.

Remark 1. We consider the case where there is one endogenous price for each product. Our results

extend naturally to the case where demand is a function of multiple endogenous variables. Of course,

we would need one excluded instrument for each endogenous regressor.



Remark 2. We assume Ξ is such that each ξ ∈ Ξ gives rise to a unique demand system D(·, ξ). If it

were to be the case that D (p, ξ1 ) = D (p, ξ2 ) ∀ p ∈ P, then we could redefine Ξ to exclude one of ξ1

or ξ2 . In other words, each ξ ∈ Ξ indexes a unique vector valued analytic function.

Example 1. An important example of a demand system satisfying our assumptions is the mixed logit

demand system used in BLP. Abstracting away non-price product characteristics, the market demand

equation in this model is
                                        ˆ
                                                               
                                                 exp pj β + ξ˜j
                               qj = M       PJ                        dH (β) ,                       (2)
                                                                  ˜
                                             j 0 =1 exp pj 0 β + ξj 0
                                        β


where M is the mass of consumers, β is a random coefficient on price, H is the distribution of random

coefficients within a market and ξ˜j is a scalar random error specific to product j in a particular market.

BLP assume that H is the same across markets; indeed H is their structural object of estimation.

This rules out that tastes for price, or more generally product characteristics, vary across markets.

It is plausible that the distribution of tastes does vary across markets. In this case, the shift in the

distribution of tastes across markets will cause corresponding changes in equilibrium prices, making

prices a function of the market-specific realization of the distribution H.

   If we allow the distribution H to vary across markets, it becomes a market-specific random variable,
                                                                                                       
and thus H properly belongs in our potentially infinite-dimensional error term ξ = ξ˜1 , . . . , ξ˜J , H .

If each H is restricted to take on compact support in the space of β’s, the mixed logit demand system

in (2) will be analytic in prices p (Stinchcombe and White, 1998, page 318).


                                                      6
Assumption 2. For each realization of ξ ∈ Ξ and the supply side unobservable ω ∈ Ω, there exists a

unique reduced form pricing function P (·, (ω, ξ)) : Z → P ⊆ RJ for an open set Z ⊆ RJ that maps a

vector of cost shifters z ∈ Z into prices p ∈ P such that each P (·, (ω, ξ)) is a vector valued analytic

function in z. Furthermore, for each realization of (ξ, ω) ∈ Ξ × Ω, there exists z ∈ Z such that the

Jacobian of the pricing function P (·, (ω, ξ)) is full rank at z.

   Uniqueness of the reduced form is a standard assumption in the literature on simultaneous equa-

tions models (Brown, 1983; Roehrig, 1988; Benkard and Berry, 2006; Matzkin, 2008; Berry and Haile,

2010; Berry et al., 2011). The control function literature typically restricts the pricing equation to be

invertible (see e.g., Imbens and Newey (2009)), which requires that the supply side error ω ∈ Ω have

the same dimension as the number of products, and does not allow the demand error ξ to separately

affect prices (see Kim and Petrin (2010) for an application of these assumptions to demand estima-

tion). These restrictions are inconsistent with standard economic theory, which predicts that both the

supply and demand errors have implications for equilibrium prices. Our pricing assumption avoids

this problem and is compatible with the supply and demand unobservables ω ∈ Ω and ξ ∈ Ξ both

entering the mechanism that determines prices without any dimensionality restrictions. Analyticity

of the reduced form pricing equation can be shown to follow given the assumed analyticity of demand

in Assumption 1 and the analyticity of costs under a standard model of imperfect competition, as we

now describe.

Example 2. Consider single-product firms that set prices according to Bertrand-Nash oligopoly

theory. In other words, firm j sets prices to solve its first order condition

                                                              ∂Dj (p, ξ)
                                    cj (z) = pj + Dj (p, ξ)              ,
                                                                ∂pj

where ω = (c1 (·) , . . . , cJ (·)) is a vector of J real analytic marginal cost functions for each market.
                                                                         ∂Dj (p,ξ)
If D (p, ξ) is a vector valued analytic function of p, the derivative      ∂pj       is a real analytic function.

Assume that for any realization of (ω, ξ) and z ∈ Z, there exists a unique equilibrium price P (z, (ω, ξ))

that also is the unique price that solves the above system of first order equations. Then the analytic

implicit theorem (see Krantz and Parks (2002)) can be used to show that P (z, (ω, ξ)) is a vector

                                                     7
valued analytic function in z ∈ Z for any realization of the unobservables (ξ, ω) ∈ Ξ × Ω, i.e., the

equilibrium pricing function P (z, (ω, ξ)) is everywhere analytic and hence satisfies the requirement of

Assumption 2. This same argument can be adapted to multiproduct firms in a straightforward way.

Further assumptions on equilibrium selection are required to address models with multiple equilibria.

   The full rank part of Assumption 2 is simply a relevance assumption on the instruments for shifting

prices, and unlike other nonparametric relevance conditions (the completeness condition in Newey

and Powell (2003) or the measurable separability assumption in Florens et al. (2008)), its validity

can be traced back directly to natural assumptions on the supply and demand model. Without

this assumption on the instrument, there exist realizations of the unobservables (ξ, ω) such that the

instruments could not shift prices in a full rank way anywhere, which might lead to underidentification.

Our assumption on the relevance of the instrument is simply designed to avoid this pathology.

   We now turn to our final assumption, which concerns the stochastic nature of the random ele-

ments of the model. Let ∆ (Ξ × Ω) denote the set of distributions over Ξ × Ω that have countable

supports. That is, each G ∈ ∆ (Ξ × Ω) has a support over some possibly infinite but countable subset

 (ξ1 , ω1 ), (ξ2G , ω2G ), . . . ⊂ Ξ × Ω. Observe that for G, G0 ∈ ∆ (Ξ × Ω), G and G0 can have completely
 G G

non-overlapping supports – the only restriction is that each distribution’s support is countable.

Assumption 3.

   • The support of the cost shifters Z contains a countably dense subset of Z.

   • (ξ, ω) ⊥ Z (full independence)

   • The true distribution G0 of the market unobservables (ξ, ω) ∈ Ξ×Ω is such that G0 ∈ ∆ (Ξ × Ω).

   We discuss countable support of the regressors and the market unobservables in Section 5. We

emphasize here that the support of the true underlying distribution is unknown to the researcher and

hence learned in identification. We do not need to impose that Ξ × Ω is compact or even choose a

particular topology for Ξ × Ω. Full independence between instruments and demand and supply errors

is a common assumption when there are no restrictions on how the errors enter the model. We can



                                                    8
also extend our results to allow more excluded instruments than endogenous regressors. We do not

require large support on Z because of the analyticity assumption on the demand and pricing functions.

    We now state our main result.

Theorem 1. Under Assumptions 1–3, given the joint distribution of the market observables (P, Q, Z),

the true distribution over demand functions D(·, ξ), both unconditional and conditional on any par-

ticular realization of the observables (P, Q, Z) = (p, q, z), is identified.

    Much of the remainder of the paper now explains the key ideas that are needed to prove this result

and show its applicability to demand analysis.



3     Identification of Random Functions

There are two key elements to how we prove Theorem 1. First, we show that the reduced form of

the model gives rise to a system of random analytic functions, and that this reduced form can be

identified from the distribution of the market observables (P, Q, Z). This requires us to extend the

existing literature on identification in linear random coefficient models to allow for random functions

that are nonlinear. The second key element is showing that the structural feature of interest, namely

the distribution of demand systems, can be recovered from the identified reduced form.

    To establish the first key element, let θ = (ξ, ω) ∈ Θ index the joint realization of the demand and

pricing unobservables. Observe that for each realization of θ ∈ Θ, the model generates a reduced form

mapping from z 7→ (p, q), i.e., a unique mapping from the vector of instruments to the endogenously

determined prices and quantities (p, q). Let this mapping be denoted by g(z, θ) = (g1 (z, θ), g2 (z, θ)),

where


                                   q = g2 (z, θ)   = D (P (z, (ξ, ω)), ξ)

                                   p = g1 (z, θ)   = P (z, (ξ, ω)).


Observe that g : Z → R2J is a vector valued analytic function, since the composition of analytic

maps is analytic. Let A denote the family of vector valued analytic functions from Z to R2J . For

                                                      9
each realization of θ = (ξ, ω), the reduced form g (·, θ) is thus an element of A. We can refer to

each element f ∈ A as a “type”, i.e., a type characterizes a particular mapping from cost shifters

z ∈ Z to the endogenous prices and quantities (p, q). The true distribution of the unobservables (ξ, ω)

induces a distribution µ0 over A. Let ∆(A) denote the set of probability distributions over A with

countable support. Observe that under Assumption 3, we have that the true µ0 ∈ ∆(A). For a generic

µ ∈ ∆(A), let T µ ⊂ A denote its support. We discuss the countable support restriction further in

Section 5.

   Observe that the reduced form of the structural model consists of a distribution µ0 ∈ ∆ (A) over

vector valued analytic functions A. We now show that the reduced form is identified, the objects of
                                                                                                            
identification being the the identities of the types T 0 = {f10 , f20 , . . . } ⊂ A and their masses µ0 fi0

for i = 1, 2, . . . In order to identify the reduced form, we must first extend the existing literature on

identification of random coefficients in linear models to allow more generally for nonlinearities. Because

linear functions are analytic, our space of random functions A represents such a generalization. We

first formally describe the meaning of identification in our setting.

   By Assumption 3, the distribution of the explanatory variables Z is such that Z has support equal

to a countably dense subset of Z, and we can restrict attention to variation in Z within any closed

cube C = [a1 , b1 ] × · · · × [aJ , bJ ] that is contained in Z. Let X denote the support of Z within C –

observe that X is also countably dense in C. For example, X could be the intersection of QJ (the set

of J-tuples with rational valued components) with the cube C. Observe that we only require the X

to be a countably infinite set, and thus the cardinality of the support of Z can be the same as the

cardinality of the support T 0 of the random functions. For the sake of concreteness, we will assume

that X takes on this form.

   Also by assumption, the exogenous variables Z and the random coefficients f ∈ A are independent

of one another. Thus for any distributions PZ of Z and and µ ∈ ∆(A), let L[PZ , µ] denote the joint

distribution of the endogenous and exogenous variables (P, Q, Z) implied by the model. In particular,

for measurable subsets A ⊆ R2J and B ⊆ X ,

                                               X X
                           L[PZ , µ](A, B) =                1[f (z) ∈ A] µ(f )PZ (z).                    (3)
                                               z∈B f ∈T µ


                                                     10
We follow Beran (1995) and define identification as follows.

Definition 3. The true distribution µ0 is identified in a class of measures ∆(A) if both µ0 ∈ ∆(A),

and for µ, µ0 ∈ ∆(A), L[PZ , µ] 6= L[PZ , µ0 ], meaning there exists measurable subsets A ⊆ R2J and

B ⊆ X such that L[PX , µ](A, B) 6= L[PX , µ0 ](A, B).

    Intuitively, identification states that any distribution µ 6= µ0 implies a different distribution over

the observables (P, Q, Z) than the truth µ0 . Because the distribution over the observables (P, Q, Z)

is identified in the data, the true µ0 ∈ ∆(A) can be uniquely inferred from the data.

Theorem 2. The true probability measure µ0 is identified in the set ∆(A).

    Consider any two µ, ν ∈ ∆(A). Let T ⊂ A be the union of T µ and T ν , which is countable

because the union of two countable sets is countable. Letting T = {f1 , f2 , . . . } and αi = µ(fi ) − ν(fi ),

identification according to Definition 3 is equivalent to finding the existence of an A ⊆ R2J and B ⊆ X

such that
                                        ∞
                                       XX
                                                 αi 1[fi (x) ∈ A] PZ (z) 6= 0.                            (4)
                                       x∈B i=1

Because µ and ν are assumed to be distinct, then αi 6= 0 for at least one i ≥ 1, and thus without loss

of generality we let α1 6= 0. The key to showing the existence of subsets A and B that play the role

of the “identifying sets” in (4) is the following lemma concerning the class of functions A.

Lemma 1. For any countable subset of (vector valued analytic) functions S = {f1 , f2 , . . . } ⊂ A, there

exists a z ∈ C = [a1 , b1 ] × · · · × [aJ , bJ ] such that f1 (z) 6= fj (z) for all j > 1.

Proof. The first step in the proof is to show that for distinct f, g ∈ A, the set D = {z ∈ C : f (z) =

g(z)} is a nowhere dense set. Observe that since both f and g are continuous, the set D is closed.

Now suppose by way of contradiction that D is somewhere dense. Then D has a non-empty interior,

and hence there is a non-empty open set of the form U = ×Ji=1 (ai , bi ) ⊂ C on which f and g coincide.

But because A is comprised of vector valued analytic functions, this would imply that f = g, thus

contradicting the fact that they are distinct.

    Now let E = ∪i≥2 {z ∈ C : f1 (z) = fi (z)}. The Baire category theorem implies that its complement

in C, E c , is non-empty. Any point z ∈ E c satisfies the condition of the lemma.

                                                          11
    Now we can prove Theorem 2.


Proof of Theorem 2

According to the previous lemma, there exists a ẑ ∈ C such that f1 (ẑ) 6= fj (ẑ) for any j > 1. Let

ŷ = f1 (ẑ). Let A denote an  ≥ 0 open ball centered at ŷ. Now define the functions


                                                hi (z, ) = 1 [fi (z) ∈ A ] ,


which are defined for any i ≥ 1 and z ∈ Z and  ≥ 0. Also define

                                                              ∞
                                                              X
                                                H(z, ) =           αi hi (z, ).
                                                              i=1

          P
Because       i≥1   αi is an absolutely convergent series, it is straightforward to show (via the Weierstrass

M-test) that H (z, ) is a uniformly convergent series over all possible values (z, ). By the uniform

limit theorem, if there is any point (z, ) at which all the hi are continuous, then H will also be

continuous at this point (z, ).

    By construction we have that

                                                        H(ẑ, 0) = α1 .                                                    (5)


Without loss of generality let α1 > 0. Observe also that each hi (ẑ, ) for i ≥ 1 is continuous at  = 0,

and hence H(ẑ, ) is continuous at  = 0.2 Hence there exists ¯ > 0 such that H(ẑ, ) > 0 for all

 < ¯. Letting d(y1 , y2 ) denote the denote the distance between two points in R2J , we can choose a

˜ ≤ ¯ such that ˜ 6= d (f1 (ẑ) , fj (ẑ)) for any j ≥ 1.3 Finally, observe that each hi (z, ˜) for i ≥ 1 is

continuous at ẑ and hence H(z, ˜) is continuous at z = ẑ. Thus for all z ∈ B where B is a sufficiently

small open neighborhood of ẑ we have that H(z, ˜) > 0. By the definition of H, we have that

                                                ∞
                                                X
                                                       αi 1 [fi (z) ∈ A˜] > 0
                                                 i=1
   2 To show continuity of H (ẑ, ), consider that h1 (ẑ, ) is always 1 around  = 0 and hi (ẑ, ) is always 0 around  = 0
for i > 1.
   3 This follows because {d (f (ẑ) , f (ẑ)) | j ≥ 1} is at most a countable set and the interval [0,  ¯] is uncountable.
                               1        j




                                                              12
for each z ∈ B. Because the support X of Z is dense in the cube C, the intersection of the neighborhood

B and the support X is non-empty, and thus

                                       ∞
                                     X X
                                               αi 1 [fi (z) ∈ Aˆ] PZ (z) > 0,
                                   z∈B∩X i=1


and (4) is satisfied.


Proof of Theorem 1

We have now established that the reduced form of the model, i.e., a system of random analytic

functions, is identified from the data. We now wish to show that the structural features of interest,

i.e., the distribution of demand, is identified from the reduced form. Identification of the reduced form
                                                                                    
gives identities of the types T 0 = {f10 , f20 , . . . } ⊂ A and their masses µ0 fi0 for i = 1, 2, . . . , where

each type fi0 : Z → R2J represents a mapping from the cost shifters z ∈ Z to prices and quantitates

(p, q) ∈ R2J . By assumption, each fi0 = g (·, (ξi , ωi )) for some realization of (ξi , ωi ) ∈ Ξ × Ω. The key

to recovering the structural features of interest from the reduced form is the following lemma, which

shows that each realization of the random function fi0 ∈ A is consistent with at most one demand
                                                                        
unobservable ξi ∈ Ξ, i.e. the demand unobservable can be inverted ξ fi0 ∈ Ξ as a function of any

realization fi0 of the reduced form random function.

Lemma 2. For any realization of fi0 ∈ A, there is at most one ξi ∈ Ξ such that fi0 = g (·, (ξi , ωi )) for

some ωi ∈ Ω.
                                                
Proof. To see this, partition fi0 = fi,1
                                     0      0
                                         , fi,2              0
                                                  where q = fi,1 (z) ∈ RJ predicts quantities and p =

fi,2 (z) ∈ RJ predicts price for any z ∈ Z. By Assumption 2 and the fact each fi,2
                                                                               0
                                                                                   is smooth, there
                                       0
exists an open subset U ⊆ Z such that fi,2 has a full rank Jacobian for each z ∈ U . Therefore
 0
fi,2 (W ) ⊆ P is an open set of prices by the open mapping theorem. Now suppose there exists two

ξ, ξ 0 ∈ Ξ such that fi1
                      0
                         (z) = D (fi,2 (z) , ξ) = D (fi,2 (z) , ξ 0 ) for all z ∈ U . Then it would be the

case that D(·, ξ) and D(·, ξ 0 ) coincide on an open set. Because ξ and ξ 0 index different vector valued

analytic functions, by the key property of analytic functions, we must thus have that ξ = ξ 0 .



                                                       13
   It is now possible, in light of Theorem 2, to prove Theorem 1. For each identified type fi0 from
                            
the reduced form, let ξ fi0 ∈ Ξ be the unique demand unobservable consistent with it as implied by

Lemma 2. Now observe that

                                                      X
                               Pr (ξ = ξ ∗ )                µ0 fi0 1 ξ fi0 = ξ ∗
                                                                              
                                                 =
                                                      i≥1

                                                                 µ0 fi0 1 ξ fi0 = ξ ∗ 1 (p, q) = fi0 (z)
                                                      P                                            
                                                         i≥1
        Pr (ξ = ξ ∗ | (P, Q, Z) = (p, q, z))     =                 P      0  0                0           ,
                                                                     i≥1 µ (fi ) 1 [(p, q) = fi (z)]


where Pr (ξ = ξ ∗ ) is the unconditional probability that the demand unobservable ξ equals a particular

value ξ ∗ , and Pr (ξ = ξ ∗ | (P, Q, Z) = (p, q, z)) is the probability ξ equals ξ ∗ conditional on a particular

realization of the market observables (p, q, z). For any possible realization of demand ξ ∗ ∈ Ξ, Theorem

1 allows us to identify both the unconditional and conditional (for any realization of the market

observables (p, q, z)) probability of the demand unobservable being ξ ∗ .



4     Uses of Demand Functions

Some of the major structural uses of demand functions are to measure price elasticities for antitrust

purposes and to predict the sales from a good with changed characteristics. We show how our identi-

fication result applies to these purposes. We also discuss uses of demand functions that require more

supply side information, such as predicting prices and quantities after a merger.

    Consider a situation where we want to measure price elasticities for product j in a particular

geographic market with observables (p, q, z). The mean (across the econometrician’s uncertainty)

own-price demand derivative for product j in this market is

                                  ˆ
                                         ∂Dj (p, ξ ? )
                                                       Pr (ξ = ξ ∗ | p, q, z) dξ ? .
                                    ξ?      ∂pj

One can similarly calculate the variance and indeed the entire distribution of the own-price demand

derivative (or elasticity) for product j. In demand estimation approaches involving inverting an error

term, identification would give Pr (ξ = ξ ∗ | p, q, z) = 1 for some ξ ∗ , and thus there would be no


                                                            14
uncertainty over the own-price demand derivative for each market. The difference is that one cannot

learn ξ ∗ when ξ has dimension more than the number of products. It is quite natural that we cannot

ascertain exactly whether the price and sales of product j are high due to a low dislike of price, a

high unobserved quality, or possibly other explanations. Our approach captures the econometrician’s

uncertainty about the true demand derivative in the market.

   Now consider an example where non-price product characteristics x enter demand and supply.

Let x = (x1 , . . . , xJ ) be the vector of product characteristics for all J choices, where each xj is itself

a vector. Let D (p, x, ξ) be the demand function. Say that we want to predict demand when the

characteristics of product 1 change from x1 to x01 . Let x0 = (x01 , x2 , . . . , xJ ). Then D (p, x0 , ξ) is the

demand for all products at the new product characteristics. Across the population of markets,

                                       ˆ
                                             D1 (p, x0 , ξ ? ) Pr (ξ = ξ ∗ ) dξ ?
                                        ξ?


is the unconditional mean of predicted sales for product 1. This mean can also be computed conditional

on a particular market’s characteristics (p, q, z, x).

   Our approach does not recover the distribution of supply unobservables ω without further assump-

tions on the supply side. We can make such assumptions. Say we assume that each firm j sets prices

to maximize profits

                                           πj = Dj (p, ξ) (pj − cj (z)) ,


where cj (z) is the marginal cost of product j, which isa part of ω and a function of the instruments

z. We do not focus on counterfactuals involving changing z here, so we let cj = cj (z). Profit

maximization leads to the first order condition that

                                     ∂Dj (p, ξ)
                                                (pj − cj ) + Dj (p, ξ) = 0,
                                       ∂pj

which implies
                                                                             −1
                                                                 ∂Dj (p, ξ)
                                    cj = pj + Dj (p, ξ)                             .
                                                                   ∂pj




                                                           15
Therefore, each realization of ξ leads to a value of cj for each firm j. So, with this additional structure,

we identify a joint distribution of marginal costs c = (c1 , . . . , cJ ) and demand errors ξ. Now say we

are interested in a merger between firms 1 and 2. We can use the theory of Bertrand-Nash pricing by

multiproduct firms to predict prices under each combination of ξ and c, at least if the pricing game

has a unique equilibrium. We can then integrate using the distribution of (ξ, c) to calculate the mean

or variance of counterfactual prices and quantities after the merger.



5     Countable Support

A key condition that we use is the (unknown) countably infinite support of the distribution G of the

market unobservables (ξ, ω) ∈ Ξ × Ω. This class of distributions is among the most general that one

can use without imposing further structure on the space of the unobservables Ξ × Ω. Thus we allow

for a countably infinite support of the distribution of unobservables in a possibly infinite dimensional

space that does not impose that Ξ × Ω has a particular topology or that Ξ × Ω is compact. We

only require variation of the instrument z in a countable set (the rationals) as well, and thus the

cardinalities of the support of the data and the support of the unobservables are the same.

    Our main interest lies in identification that imposes minimal structure on the space of unobserv-

ables Ξ × Ω, which motivates the use of distributions with countably infinite support as the class

of distributions over which we seek identification. Considering more general classes of distributions

introduces measurability problems that would require putting more structure on Ξ × Ω to resolve.4

Working with distributions that admit countable support avoids these measurability issues in a general

way given the economic question, while not putting any structure on Ξ × Ω.

    An alternative research question is to restrict the space of the unobservables Ξ×Ω to address these

measurability issues and consider instead some other class of distributions that is perhaps non-nested

with the space of countable distributions. While we fully expect future work to move in this direction,

Ackerberg, Hahn and Ridder (2010) present an example that suggests such an alternative inquiry
  4 For example, defining the class of all probability measures on a real space introduces paradoxes (e.g., the Banach-

Tarski paradox). Lebesgue measure resolves this paradox, but it is well known that there is no analog of Lebesgue
measure on an infinite dimensional Banach space.




                                                          16
could prove difficult. The example in Ackerberg et al. presents a function y = h1 (x, 1 , 2 ), where h

is known and analytic in x and 1 and 2 are scalar, real-valued unobservables. This function h and

a particular, continuous distribution for 1 and 2 give rise to a particular cumulative distribution

function F (y | x). By inverting this cumulative distribution function, Ackerberg et al. show that

another analytic function h2 (x, ν) that is non-nested with h1 and a uniform distribution over the

scalar ν give rise to the same distribution for the data F (y | x). Thus, the same data F (y | x) can

be explained by two continuous distributions over analytic functions, one putting support only on

functions h1 (x, 1 , 2 ), indexed by 1 and 2 , and the other putting support only on h2 (x, ν), indexed

by ν. Positive results in this direction would thus require further substantive restrictions on Ξ × Ω,

for example restrictions on the space of demand functions.

    Some researchers may be uncomfortable with the assumption of countable support, because it

implies that F (p, q | z) has countable support, where F is the distribution function of prices and

quantities. Uncirculated results by Kitamura (2011) explore a finite mixture model where each re-

gression component i corresponds to a fi (x) + i , where i ∼ Fi , where fi (x) is a regression function

and Fi is a cumulative distribution function with continuous support. Letting di be the weight on
                                               N
each function, Kitamura identifies (di , fi , Fi )i=1 , where N is a finite number of mixture components.

Kitamura requires assumptions that can be showed to be implied by analytic functions. Thus another

possible extension of our results is to apply Kitamura’s mixtures theorem for random functions to our

supply and demand setup to identify demand with finite support for the unobservables ξ (as opposed

to the possibly infinite support we consider) while allowing an extra, additively separable continuous

error in prices and demand. Then F (p, q | z) will have continuous support.



6    Conclusions

We explore the identification of distributions of demand functions with endogenous prices. Our ap-

proach does not involve the inversion of one error ξj for each product. Thus, we can allow the

market-level errors ξ and ω to be of high finite dimension or even of infinite dimension. In the con-

text of BLP demand systems, we can allow the distribution of preferences to vary across markets in



                                                    17
addition to allowing unobserved product characteristics to vary across products within a market. We

can allow multiple unobserved characteristics per product. Unlike the control function literature, we

require conditions on pricing functions that can be established by primitive assumptions on the supply

side of the market.

   Our two main technical assumptions are 1) our demand and pricing functions are analytic and 2)

the true distribution of unobserved demand and pricing errors has an (unknown) countable support.

Analytic demand arises from some functional forms, such as the mixed logit with a compact support

for random coefficients. Given analytic demand, analytic pricing functions arise from the analytic

implicit function theorem if the pricing equilibrium, for example, is the unique solution to the first

order conditions.

   We recover a distribution of the demand unobservables ξ and the pricing unobservables η. These

can be used to find the distribution of elasticities, across the population of markets or conditional on

the observables in a given market. We can also extend our model to forecast the sales of a good with

changed product characteristics. Finally, one can impose a particular supply side model and recover

supply side unobservables for each demand side unobservable. The model can then be used to predict

prices and sales after counterfactual changes to the supply side, such as a merger.

   We have not discussed estimation. Our model gives rise to a likelihood for price and quantity

as a function of the unknown distribution of demand and pricing functions. Therefore, we could

apply mixtures estimators found in the literature, such as NPMLE, the EM algorithm, MCMC, and

simulated maximum likelihood. For one computationally simple mixtures estimator, Fox and Kim

(2011) present a consistency theorem that shows that the estimated distribution function converges to

the true distribution function in the Lévy-Prokhorov metric on the space of multivariate distributions

that take on positive support on a compact real space of random coefficients. Using this nonparametric

consistency theorem requires showing that the distribution of random coefficients is identified, which

our paper has done for the more general infinite dimensional case in Theorem 1.




                                                  18
References

Ackerberg, Dan, Jinyong Hahn, and Geert Ridder, “Testable Implications of Multiple Unob-

  servables in Structural Nonparametric Nonseparable Models,” 2010. University of Michigan working

  paper.

Altonji, J.G. and R.L. Matzkin, “Cross section and panel data estimators for nonseparable models

  with endogenous regressors,” Econometrica, July 2005, 73 (4), 1053–1102.

Benkard, C.L. and S. Berry, “On the Nonparametric Identification of Nonlinear Simultaneous

  Equations Models: Comment on Brown (1983) and Roehrig (1988),” Econometrica, 2006, 74 (5),

  1429–1440.

Beran, R., “Prediction in random coefficient regression,” Journal of Statistical Planning and Infer-

  ence, 1995, 43 (1-2), 205–213.

  and PW Millar, “Minimum Distance Estimation in Random Coefficient Regression Models,” The

  Annals of Statistics, 1994, 22 (4), 1976–1992.

Berry, Steven T., “Estimating Discrete-Choice Models of Product Differentiation,” The RAND

  Journal of Economics, Summer 1994, 25 (2), 242–262.

  , Amit Gandhi, and Philip A. Haile, “Connected Substitutes and the Invertibility of Demand,”

  2011. Yale University working paper.

   and Philip A. Haile, “Identification in Differentiated Products Markets Using Market Level

  Data,” February 2010. Yale University working paper.

  , James Levinsohn, and Ariel Pakes, “Automobile Prices in Market Equilibrium,” Economet-

  rica, 1995, 63 (4), 841–890.

Blundell, Richard and Rosa L. Matzkin, “Conditions for the existence of control functions in

  nonseparable simultaneous equations models,” 2010. UCL working paper.




                                                   19
Brown, B.W., “The identification problem in systems nonlinear in the variables,” Econometrica,

  1983, 51 (1), 175–196.

Chesher, Andrew, “Identification in nonseparable models,” Econometrica, September 2003, 71 (5),

  1405–1441.

Deaton, A. and J. Muellbauer, “An almost ideal demand system,” The American Economic

  Review, 1980, 70 (3), 312–326.

Florens, J. P., J. J. Heckman, C. Meghir, and E. Vytlacil, “Identification of Treatment Effects

  Using Control Functions in Models with Continuous, Endogenous Treatment and Heterogeneous

  Effects,” Econometrica, September 2008, 76 (5), 1191–1206.

Fox, Jeremy T. and Kyoo il Kim, “A Simple Nonparametric Approach to Estimating the Dis-

  tribution of Random Coefficients in Structural Models,” 2011. University of Michigan working

  paper.

Hoderlein, Stefan, Jussi Klemelä, and Enno Mammen, “Analyzing the Random Coefficient

  Model Nonparametrically,” Econometric Theory, 2010, 26 (3), 804–837.

Imbens, Guido W. and Whitney K. Newey, “Identification and Estimation of Triangular Simul-

  taneous Equations Models Without Additivity,” Econometrica, September 2009, 77 (5), 1481–1512.

Kim, Kyoo il and Amil Petrin, “Control Function Corrections for Unobserved Factors in Differ-

  entiated Product Models,” 2010. Univeristy of Minnesota working paper.

Kitamura, Yuichi, “Nonparametric Identifiability of Finite Mixtures,” 2011. Yale University working

  paper.

Krantz, Steve G. and Harold R. Parks, A Primer on Real Analytic Functions, second ed.,

  Birkhäuser, 2002.

Liu, Jingou, “The minimum distance method in nonlinear random coefficient models,” Statistica

  Sinica, 1996, 6, 877–898.


                                                20
Matzkin, Rosa L., “Identification in Nonparametric Simultaneous Equations Models,” Econometrica,

  September 2008, 76 (5), 945–978.

Newey, Whitney K. and James L. Powell, “Instrumental variable estimation of nonparametric

  models,” Econometrica, September 2003, 71 (5), 1565–1578.

Roehrig, C.S., “Conditions for identification in nonparametric and parametric models,” Economet-

  rica, 1988, pp. 433–447.

Stinchcombe, M.B. and H. White, “Consistent specification testing with nuisance parameters

  present only under the alternative,” Econometric Theory, 1998, 14 (03), 295–325.




                                                21
