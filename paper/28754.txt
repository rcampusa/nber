                             NBER WORKING PAPER SERIES




       WELFARE AND OUTPUT WITH INCOME EFFECTS AND TASTE SHOCKS

                                        David Baqaee
                                        Ariel Burstein

                                     Working Paper 28754
                             http://www.nber.org/papers/w28754


                    NATIONAL BUREAU OF ECONOMIC RESEARCH
                             1050 Massachusetts Avenue
                               Cambridge, MA 02138
                            May 2021, Revised July 2021




We thank Sihwan Yang for superb research assistance. We thank Andy Atkeson, Natalie Bau,
Javier Cravino, Conor Foley, Pierre Sarte, and Jon Vogel for helpful comments. We are grateful
to Emmanuel Farhi and Seamus Hogan, both of whom passed away tragically before this paper
was written, for their insights and earlier conversations on these topics. This paper received
support from NSF grant No. 1947611. The views expressed herein are those of the authors and do
not necessarily reflect the views of the National Bureau of Economic Research.

NBER working papers are circulated for discussion and comment purposes. They have not been
peer-reviewed or been subject to the review by the NBER Board of Directors that accompanies
official NBER publications.

© 2021 by David Baqaee and Ariel Burstein. All rights reserved. Short sections of text, not to
exceed two paragraphs, may be quoted without explicit permission provided that full credit,
including © notice, is given to the source.
Welfare and Output with Income Effects and Taste Shocks
David Baqaee and Ariel Burstein
NBER Working Paper No. 28754
May 2021, Revised July 2021
JEL No. E0,E01,E1,E21,E23,E3

                                           ABSTRACT

We characterize how welfare responds to changes in budget set and technology when preferences
are non-homothetic or subject to shocks, in both partial and general equilibrium. We generalize
Hulten's theorem, the basis for constructing aggregate quantity indices, to this context. We show
that calculating changes in welfare in response to a shock only requires knowledge of expenditure
shares and elasticities of substitution and (given these elasticities) not of income elasticities and
taste shocks. We also characterize the gap between changes in welfare and changes in chained
indices. We apply our results to long-run and short-run phenomena. In the long-run, we show that
structural transformation, if caused by income effects or changes in tastes, is roughly twice as
important for welfare than what is implied by standard measures of Baumol's cost disease. In the
short-run, we show that when firms' demand shocks are correlated with their supply shocks,
industry-level price and output indices are biased, and this bias does not disappear in the
aggregate. Finally, using the Covid-19 crisis we illustrate the differences between partial and
general equilibrium notions of welfare, and we show that real consumption and real GDP are
unreliable metrics for measuring welfare or production.


David Baqaee
Department of Economics
University of California at Los Angeles
Bunche Hall
Los Angeles, CA 90095
and CEPR
and also NBER
baqaee@econ.ucla.edu

Ariel Burstein
Department of Economics
Bunche Hall 8365
Box 951477
UCLA
Los Angeles, CA 90095-1477
and NBER
arielb@econ.ucla.edu



A data appendix is available at http://www.nber.org/data-appendix/w28754
1      Introduction
In this paper, we study how a change in the economic environment affects welfare. For
example, how does the welfare of an individual consumer change when the budget con-
straint changes, or how does the welfare of a nation change when its technologies change?
Under some strong assumptions, chain-weighted real consumption, as measured by sta-
tistical agencies, correctly answers both of these questions at the same time.1 Two impor-
tant assumptions required for this serendipity are homotheticity and stability of prefer-
ences, which are highly convenient but counterfactual assumptions. Homotheticity re-
quires that the income elasticity of demand must equal one for every good. Stability
requires that consumers only change spending in response to changes in incomes and rel-
ative prices. In this paper, we relax these assumptions and characterize welfare changes,
chained-weighted consumption, and the gap between the two in terms of sufficient statis-
tics.2
    Our baseline welfare measure is the equivalent variation at fixed final preferences,
which answers the question: "holding fixed preferences, how much must the consumers' initial
endowment change to make them indifferent between their choice sets at t0 and t1 ?" where t
can refer to, for example, time or space. Although we focus on equivalent variation, our
results can easily be modified to also characterize compensating variation.
    We first study this problem in partial equilibrium, where choice sets are defined in
terms of budget sets (prices and income are exogenous). Our welfare measure answers
a microeconomic question, comparing two budget sets for an infinitesimal agent who
cannot alter market-level prices through her choices. We then study this problem in gen-
eral equilibrium, where choice sets are defined in terms of production possibility fron-
tiers determined by technologies and factor endowments (prices and income are endoge-
nous).3 In this case, our welfare measure answers a macroeconomic question comparing
two technologies for a collection of agents whose collective decisions alter market-level
prices. When preferences are homothetic and stable, macroeconomic changes in wel-
fare are equal to microeconomic changes in welfare. However, we show that these two
    1 To aggregate data on prices and quantities over multiple goods, chain-weighted indices use good-
specific weights that are updated every period. As compared to fixed-weight indices, chain-weighted in-
dices account for substitution by consumers. The continuous time analog to a chain-weighted index is
called a Divisia index.
    2 As we discuss in detail in Section 2, preference instability is driven by any factor that changes preference

rankings over bundles of goods at fixed prices and income, e.g. age, health, advertising, fads. In the
literature, preference instability and non-homotheticities are typically studied independently. We analyze
them jointly in this paper because both generate the same type of biases in measures of real consumption.
Our results are relevant when either of these forces is active.
    3 For the macro problem, we consider neoclassical economies with representative agents.




                                                        1
measures are not equal when household preferences are non-homothetic or unstable. In-
tuitively, some points on a budget constraint, which may be feasible for an individual
agent, are not feasible for society as a whole due to curvature in the production possibil-
ity frontier.
    We provide exact and approximate characterizations of the change in micro and macro
welfare, and provide a generalization of chain-weighted (or more precisely Divisia) in-
dices that can be used to measure both. Our macro welfare index extends Hulten (1978)
to environments with non-homotheticities and taste shocks. We compare welfare and real
consumption, and clarify the conditions under which real consumption captures welfare-
relevant quantities when preferences are non-homothetic and unstable. In contrast to
a standard Divisia index, which weights changes in prices or technologies using actual
expenditure shares, the welfare-relevant index uses counterfactual "welfare-relevant" ex-
penditure shares calculated under the final indifference curve. We show that this means
that real consumption undercounts expenditure-switching caused by either income effects
or taste shocks. We show that this undercounting is larger if changes in expenditures
caused by income effects or taste shocks are correlated with changes in prices in partial
equilibrium or changes in technologies in general equilibrium. If taste shocks are orthog-
onal to price changes or technology shocks, then real consumption will correctly measure
changes in welfare.
    To understand the intuition for this result, suppose healthcare services grew relative
to manufacturing during the post-war era due to aging or income effects. In this case,
measured real consumption does not correctly account for changes in expenditure shares.
Intuitively, if expenditure shares change due to changes in demand, then when we com-
pare the past to the present, we must use demand curves that are relevant for choices
today, not the ones that were relevant in the past. If richer or older households prefer to
spend their income on healthcare, and households in 2021 are richer and older than they
were in 1950, then when we compare the economy's productive capacity in 1950 to 2021,
we must account for the fact that the richer and older households of today demand a dif-
ferent set of goods than the younger and poorer households of 1950. The gap between
real consumption and welfare is large if spending on healthcare increases due to aging or
income effects and the relative price of healthcare changes relative to that of other sectors.
    Our results for welfare and the gap between welfare and real consumption are ex-
pressed in terms of measurable sufficient statistics. In both partial and general equilib-
rium, we show that computing the change in welfare does not require direct knowledge
of the taste shocks or income elasticities. Instead, what we must know are the expenditure
shares and the elasticities of substitution at the final allocation. For the micro problem,


                                              2
these are the household expenditure shares and the elasticities of substitution in con-
sumption. For the macro problem, these are the input-output table and the elasticities
of substitution in both production and consumption. These results can be used both for
ex-post accounting and ex-ante counterfactuals.
    For very simple economies with one factor, constant returns to scale, and no interme-
diates, the difference between welfare and real consumption is approximately half the
covariance of supply and demand shocks. This formula can be generalized to more com-
plex economies. We show how the details of the production structure, like input-output
linkages, complementarities in production, and decreasing returns to scale, interact with
non-homotheticities and preference shocks to magnify the gap between welfare and real
consumption. We show that the discrepancies between welfare and real consumption that
we emphasize do not get "aggregated" away. In fact, the more we disaggregate, the more
important these discrepancies are likely to become. In this sense, our results are related
to the literature studying the macroeconomic implications of production networks and
disaggregation (e.g. Gabaix, 2011; Acemoglu et al., 2012; Baqaee and Farhi, 2019b).
    We illustrate the relevance of our results for understanding short-run and long-run
phenomena by means of three applications. In our first application, we analyze the im-
portance of non-homotheticity or preference instability for measures of long-run produc-
tivity growth. Since Baumol (1967), an enduring stylized fact about economic growth has
been the observation that industries with slow productivity growth tend to become larger
as a share of the economy over time. This phenomenon, known as Baumol's cost disease,
implies that aggregate growth is increasingly determined by productivity growth in slow-
growth industries since, over time, the industrial mix of the economy shifts to favor these
industries. To be specific, from 1947 to 2014, aggregate TFP in the US grew by 60%. If the
US economy had kept its original 1947 industrial structure, then aggregate TFP would
have grown by 78% instead. We show that if structural transformation is caused solely
by income effects and demand instability, then welfare-relevant TFP grew by only 47%.
This is because measured aggregate TFP does not fully account for substitution caused by
changes in demand, and hence the increase in the welfare-relevant measure of aggregate
TFP is much lower than what is measured. We also find a similar pattern in consumption
data.
    In our second application, we argue that the gap between real consumption and wel-
fare changes is likely to be present even at high frequencies of the data. Whereas industry-
level shares are relatively stable over short-horizons, firm or product-level sales shares
are not. We consider a firm-level specification of our model and show that when firms'
demand shocks are correlated with their supply shocks, there is a gap between welfare-


                                             3
relevant and measured changes in industry-level output and prices. These biases do not
disappear as we aggregate up to the level of real GDP even if firms and industries are
infinitesimal. If we start with aggregate industry-level (rather than disaggregated indus-
try, or firm-level) data, we are ruling out the existence of these biases by construction. In
work-in-progress, we quantify these gaps using product-level data on non-durable con-
sumer goods and find that standard price indices, like the Sato-Vartia index and chained-
weighted price index, understate welfare-relevant inflation rates.
    In our final application, we demonstrate the difference between macroeconomic and
microeconomic notions of welfare using the Covid-19 recession. During this recession,
household expenditures switched to favor certain sectors and those same sectors dis-
played higher price increases. We show that this implies that microeconomic welfare,
taking changes in prices as given, fell by more than macroeconomic welfare, taking into
account the fact that that changes in prices are themselves caused by demand shocks.
    Furthermore, in episodes in which household spending patterns are driven by taste
shocks, as in Covid-19, changes in real consumption generically depend on irrelevant
details like the order in which supply and demand shocks hit the economy. In these cir-
cumstances, the change in real consumption between two time periods is not a function of
only prices and quantities in those two periods. The same logic applies to real GDP, which
means that real GDP or TFP are unreliable metrics for measuring changes in productive
capacity.
    Of course, there are other reasons, besides instability and non-homotheticity, why
chained indices fail to accurately measure welfare. Many of the well-known reasons can
be thought of as being due to missing prices and quantities. For example, it is well-
known that real consumption fails to properly account for the creation and destruction of
goods if we cannot measure the quantity of goods continuously as their price falls from
or goes to their choke price (Hicks, 1940; Feenstra, 1994; Hausman, 1996; Aghion et al.,
2019); real consumption also fails to properly account for changes in the quality of goods
(see Syverson, 2017); finally, real consumption fails to properly account for changes in
non-market components of welfare, like changes in leisure and mortality (see Jones and
Klenow, 2016), or changes in the user cost of durables. In all of these cases, the problem
is that some of the relevant prices or quantities in the consumption bundle are missing
or mismeasured, and correcting the index involves imputing a value for these missing
prices or quantities. Non-homotheticities and taste shocks are different in the sense that
they are not caused by mismeasurement of market prices. For this reason, we abstract
from these important mismeasurement issues and assume that prices and quantities have
been correctly measured. If prices and quantities are mismeasured or missing, then our


                                             4
results would apply to the quality-adjusted, corrected, version of prices instead of ob-
served prices. That is, the corrections we derive are different to the ones that are equiva-
lent to adjustments in prices.4
    Relatedly, taste shocks and mismeasured prices (i.e. unobserved quality change) are
sometimes viewed as alternative means to the same end. This is because they can both
be used to justify why demand curves shift over time, even holding prices and incomes
fixed. However, while they have similar implications for changes in observed prices and
quantities, they have very different implications for welfare. When there are unobserved
changes in quality, the gap between welfare and real consumption is caused by a dif-
ference between measured and welfare-relevant prices. We show that in the case of non-
homotheticities and taste shocks, the gap between welfare and real consumption is caused
by a difference between measured and welfare-relevant expenditure shares.


Other related literature. This paper contributes to the literatures on growth and pro-
ductivity accounting, multi-sectoral and disaggregated macroeconomics, as well as the
literature on structural transformation. We discuss the way our paper complements and
relates to these literatures in turn.
    A key assumption in growth accounting is the existence of a stable and homothetic
final aggregator. As shown by, for example Hulten (1973) among others, chain-linked in-
dices are meaningful if, and only if, a homothetic and stable final aggregator exists. There-
fore, this assumption is ubiquitous in growth accounting, and also appears in almost all
papers that study aggregate outcomes using disaggregated input-output models.5 We
provide a generalization of growth accounting to environments where preferences are
neither homothetic nor stable.
    Measuring changes in welfare using a money metric when there are income effects is
standard in microeconomic theory. Our results extend these insights to a general equi-
librium context, and we relate them to welfare-relevant growth accounting. We provide
a generalization of Domar (1961) and Hulten (1978) that measures changes in welfare in
general equilibrium allowing for preferences to be unstable or non-homothetic. Using
   4 Our   approach to calculate ex-post welfare changes requires well-measured price changes and elastic-
ities of substitution in the final period. For ex-post welfare measurement, when information on prices is
missing or mismeasured, if preferences are non-homothetic an alternative approach is to infer changes in
welfare by relying on changes in prices, expenditures, price elasticities, and Engel curve slopes for only a
subset of goods, given assumptions on separability and stability in preferences (see e.g. Hamilton, 2001
and, more recently, Atkin et al., 2020). In addition to ex-post measurement with non-homotheticities, in this
paper we study the implications of instability of preferences (that generate shifts in expenditures correlated
with price changes) and we also consider counterfactuals.
    5 See, for example, the review paper by Carvalho and Tahbaz-Salehi (2018) and the references therein.




                                                      5
this, we can construct exact and approximate characterizations of how welfare responds
to shocks in general equilibrium, a question which is of central importance in the litera-
ture on disaggregated and production network models.6
    A recent and related paper is Redding and Weinstein (2020), who show that variations
in sales are difficult to explain via shifts in supply curves alone, and shifts in demand
curves (i.e. taste shocks) are an important source of variation in the data. Their approach
to evaluate welfare changes in the presence of taste shocks contrasts with ours because,
unlike us, they treat changes in tastes as being equivalent to changes in price. Opera-
tionally, this makes the taste shocks behave like quality shocks. They estimate changes
in taste/quality necessary to explain variations in product-level data. However, this only
determines changes in the relative size of demand shocks across goods, and it does not
pin down changes in the overall level of these shocks. Redding and Weinstein (2020) pin
down the overall level of the shocks by assuming that they are mean zero (see Martin,
2020 for a discussion of this assumption). Our approach is different in that we do not
compare utils before and after the taste shocks. Instead we compute changes in equiv-
alent variation keeping preferences constant for the variation, as advocated by Fisher
and Shell (1968) and Samuelson and Swamy (1974). This approach does not require any
assumptions about the overall level of the taste shocks in terms of utils. Moreover, as
mentioned above, in practical terms the adjustments we derive require the use of coun-
terfactual expenditure shares and not counterfactual taste-adjusted prices. We compare the
two approaches in more detail in Appendix D.7
    Our paper is also related to the literature on structural transformation and Baumol's
cost disease. As explained by Buera and Kaboski (2009) and Herrendorf et al. (2013), this
literature advances two microfoundations for structural transformation. The first expla-
   6 The  biases we identify, and the failure of Hulten's theorem, are not caused by inefficiencies (e.g.
markups, wedges, taxes). Baqaee and Farhi (2019a) analyze how growth accounting must be adjusted in
inefficient economies. Whereas incorporating inefficiencies in production does not affect our micro welfare
results, how they interact with demand instability and non-homotheticity in general equilibrium is beyond
the scope of this paper.
    7 Given CES preferences, Martin (2020) estimates using scanner level data large differences in annual

price changes between price indices based on fixed initial tastes and final tastes. Other papers studying
the relationship between conventional index numbers and welfare in the presence of preference instability
include Balk (1989) who discusses various ways one can define changes in the cost of living, Feenstra and
Reinsdorf (2007) who show that the Sato-Vartia index is equal to the CES price index evaluated at some
intermediate level of taste shifters, and Caves et al. (1982) who show that when preferences are homothetic,
translog, but unstable, Tornqvist-based indices correspond to a geometric average of welfare changes under
initial and final preferences. We characterize welfare (in partial and general equilibrium) at either initial or
final preferences and using either EV or CV. In contrast to Tornqvist and Sato-Vartia, Divisia indices cannot
generically be interpreted as corresponding to any mixture of well-defined preferences. This is because, as
we discuss in Section 5, Divisia (or chained) indices are path-dependent, so they can violate basic properties
like assigning a higher value to a strictly larger budget set.


                                                       6
nation is all about relative prices differences: if demand curves are not unit-price-elastic,
then changes in relative prices change expenditure shares (e.g. Ngai and Pissarides, 2007;
Acemoglu and Guerrieri, 2008; Buera et al., 2015). The second explanation emphasizes
shifts in demand curves caused by income effects-- households spend more of their in-
come on some goods as they become richer (e.g. Kongsamut et al., 2001; Boppart, 2014;
Comin et al., 2015; Alder et al., 2019), or taste shocks-- households spend more of their
income on some goods as they become older (Cravino et al., 2019). Our results suggest
that structural transformation driven by relative price changes has different welfare im-
plications than structural transformation driven by non-homotheticity or taste shocks.8
    The structure of the paper is as follows. In Section 2, we set up the microeconomic
problem and provide exact and approximate characterizations of the difference between
welfare and measured real consumption. In Section 3, we set up the macroeconomic
general equilibrium model and provide exact and approximate characterizations of the
difference between welfare and measured real output changes. Whereas in section 3 we
present our macro results in terms of endogenous sufficient statistics, in Section 4 we
solve for these endogenous sufficient statistics in terms of microeconomic primitives and
consider some simple but instructive analytical examples. Our applications are in Section
5. We discuss some extensions in Section 6 and conclude in Section 7. Proofs are in the
appendix.


2      Microeconomic Changes in Welfare and Consumption
In this section, we consider changes in budget constraints in partial equilibrium. We
ask how consumers value these changes, and compare these measures of welfare with
measures of real consumption. We provide exact and approximate results. This section
helps build intuition for Section 3, where we model the equilibrium determination of
prices.


2.1     Definition of Welfare and Real Consumption
In this subsection we define welfare and real consumption. Measuring changes in welfare
using equivalent variation is standard when preferences are stable. However, measuring
welfare changes in the presence of unstable preferences is less common and therefore we
discuss this issue in some detail.
    8 For
       welfare analysis with non-homothetic preferences in other contexts such as cross-country real in-
come comparisons and gains from trade, see Feenstra et al. (2009) and Fajgelbaum and Khandelwal (2016).



                                                   7
    Consider a set of preference relations, { x }, over bundles of goods. These preferences
are indexed by x, which represents anything that affects preference rankings over bundles
of goods. For example, x could be calendar time, age, exposure to advertising, or state of
nature. For every x, we represent the preference relation x by a utility function u(c; x ),
where c  R N and N is the number of goods in the consumption bundle. Since the
consumer makes no choices over x, we do not need to specify how u(c; x ) varies with x.
Moreover, preferences over x, if they exist, are not revealed by choices.9
    There are two properties of preferences that are analytically convenient benchmarks
throughout the rest of the analysis.

Definition 1 (Homotheticity). Preferences over goods c are homothetic if, for every positive
scalar a > 0 and every feasible c and x, we can write

                                          u( ac; x ) = au(c; x ).

Definition 2 (Stability). Preferences over goods c are stable if there exists a time-invariant
function  (·) such that the utility function can be written as u(c; x ) = U ((c); x ) for
every feasible c and x.

If preferences are stable, x can change over time (e.g. households get higher or lower utils
from all goods) but, since x is separable from c, these changes do not impact preferences
over bundles of goods c. If preferences are not stable, we say that they are unstable.
    Given preferences encapsulated in u, the indirect utility function of the consumer, for
any value of x, is
                             v( p, I ; x ) = max{u(c; x ) : p · c = I }.
                                                c

where p is a price vector over goods and I is expenditures (which we interchangeably
refer to as income). The vector p includes all relevant prices in the preference relation.
If the preference relation is intertemporal, then p includes the path of current and future
prices.10
    Consider shifts in the budget set as prices and income change from pt0 and It0 to pt1
and It1 . Here, t0 and t1 simply index the vector of prices and income being compared.
Motivated by our applications, we refer to this index as time, but it could equally refer to
space. This change in the budget set is accompanied by changes in x from xt0 to xt1 .
   9 InSection 6, we discuss situations in which x is endogenously chosen and valued by the consumer,
such as leisure, but its price and quantity are not being measured. We also discuss situations in which x is
endogenously chosen by firms, such as advertising.
  10 We discuss how to apply our results in dynamic economies in Section 4.3.




                                                     8
    Since utility is only defined up to monotone transformations, changes in utility do not
have meaningful units. When prices are exogenous, we measure changes in utility using
corresponding changes in income. Our baseline measure of microeconomic welfare is
defined as follows.

Definition 3 (Micro Welfare). The change in welfare measured using the micro equivalent
variation with final preferences is EV m ( pt0 , It0 , pt1 , It1 ; xt1 ) =  where  solves

                                   v( pt1 , It1 ; xt1 ) = v( pt0 , e It0 ; xt1 ).                         (1)

     In words, EV m is the change in income (in logs), under initial prices pt0 , that a con-
sumer with preferences xt1 would need to be indifferent between the budget set defined
by initial prices ( pt0 , e It0 ) and the new budget set defined by new prices and income
( pt1 , It1 ).11 The new budget set is preferred to the initial one, if and only if, EV m is posi-
tive. The superscript m represents the fact that this is the micro equivalent variation, since
we take prices as given.


Discussion of our welfare criterion. Following Fisher and Shell (1968), the welfare cri-
terion in Definition 3 measures the change in welfare by presenting the consumer with a
hypothetical choice holding fixed their preferences. To be concrete, suppose that x rep-
resents the age of the consumer. Clearly, we cannot meaningfully compare the amount
of utils an individual derives from watching cartoons as a child to the amount of utils
that individual derives from drinking coffee as an adult. Since consumers never make
choices about how old they are, their preferences across consumption goods consumed
at different ages are not revealed by their choices. In the words of Heraclitus: "No man
ever steps in the same river twice, for it's not the same river and he's not the same man."
However, if we fix the consumer's age x, we can meaningfully compare the consumer's
choices about budget sets they faced at different points in their life or that they may face
in the future.
    This approach, of holding x constant, is different to the one taken when x represents
some form of quality change. Intuitively, quality adjustments are more applicable to sit-
uations where the consumer can conceivably make choices between the good at differing
  11 In principle, we could also measure changes in welfare using compensating (instead of equivalent)
variation, or by using initial (rather than final) preferences. Combining EV with final preferences (CV
with initial preferences) is natural since this requires preserving the shape of the indifference curve at the
final (initial) allocation. In the body of the paper, we focus on EV using final preferences since equivalent
variation is more commonly used and final preferences are more relevant than initial preferences, but we
characterize these other welfare measures in Appendix B. See also Remark 2.



                                                         9
levels of quality. For example, if a box of chocolates undergoes quality change so that each
box now contains twice as many chocolates, the consumer can conceivably make choices
between the old and new boxes that reveal how much they value the quality change. Taste
changes, on the other hand, do not involve meaningful choices from the consumer's per-
spective. Our approach of holding x constant allows us to study welfare in situations
where, either for practical or philosophical reasons, it is not possible to model preferences
over x itself.


Real Consumption. Having defined changes in welfare, we now define changes in real
consumption. The change in real consumption corresponds to what national income ac-
countants and statistical agencies do when given data on the evolution of prices p and
consumption bundles c.

Definition 4 (Real consumption). For some path of prices that unfold as a function of
time t, the change in real consumption from t0 to t1 is defined to be

                                     t1               d log ci         t1
                       log Y =             bi ( t )
                                    t0 i  N              dt
                                                               dt =          bi d log ci ,
                                                                      t0 i  N
                                                                                                      (2)


where bi (t) is the budget share of good i given prices, income, and preferences at time t.12

    Equation (2) is called a Divisia quantity index. In practice, since perfect data is not
available in continuous time, statistical agencies approximate this integral via a (Rie-
mann) sum using chained indices. We abstract from the imperfections of these approx-
imations in this paper.13 Moreover, we assume that that the data on prices and quanti-
ties is perfect -- completely accurate, comprehensive, adjusted for any necessary quality
changes, and available in continuous time. This is because the important and well-studied
biases associated with imperfections in the data, like the lack of quality adjustment, miss-
ing prices, or infrequent measurement, are different to the biases we study.
    Using the budget constraint, we can express changes in real consumption in terms of
                                                                                                  t
  12 For any variable z, we denote by dz its change over infinitesimal time intervals, so that z = t 1 dz.
                                                                                                    0
  13 In discrete time, one can approximate this Riemann integral in different ways. For example, we can

approximate the integral in levels (arithmetic-weighting) or in logs (geometric-weighting). Furthermore,
we can use left-Rieman sums (Chained Laspeyres), right-Riemann sums (Chained Paasche), or mid-point
Riemann sums (Chained Tornqvist or Fisher). In continuous time, all of these procedures are equivalent
and yield the same answer. In practice, however, Boppart et al. (2021) show that these different weighing
procedures have large quantitative implications for the value of the indices.




                                                        10
changes in income deflated by price changes,

                                                            t1
                             log Y =  log I -                     bi d log pi .
                                                           t0 i  N
                                                                                            (3)


In other words, changes in real consumption are equal to changes in income minus changes
in the consumption price deflator. Notice that changes in real consumption (or the con-
sumption price deflator) potentially depend on the entire path of prices and quantities
between t0 and t1 and not just the initial and final values. This is unlike welfare changes,
EV m , which depend only on initial and final prices and incomes and not on their entire
path.


2.2   Relating Welfare and Consumption
We consider how real consumption and welfare change in response to changes in the
budget set and the indifference curves of the consumer. We first consider globally exact
results and then local approximations. The results are stated in terms of changes in prices
and income, which we endogenize in Sections 3 and 4.


Global results. When preferences are unstable or non-homothetic, the following lemma
shows that changes in welfare can be expressed as changes in income deflated by a shock-
dependent price index. Changes in this price index are equal to budget-share weighted
price changes, as in expression (3) for real consumption. However, whereas the price
deflator for real consumption is based on observed budget shares (given prices, income,
and preferences over time), the price deflator for welfare is based on hypothetical budget
shares (at fixed utility level and fixed preferences).
    To state this, define the expenditure function for any value of x by

                            e( p, u; x ) = min{ p · c : u(c; x ) = u}.
                                                 c

The budget share of good i (given prices, preferences, and a level of utility) is

                                            p i c i ( p, u; x )    log e( p, u; x )
                        bi ( p , u ; x )                        =                   ,       (4)
                                             e ( p, u; x )            log pi

where the second equality, Shephard's lemma, establishes a connection between budget
shares and elasticities of the expenditure function. Note that when preferences are homo-
thetic, then the expenditure function can be written as e( p, u; x ) = e ( p; x ) u and, hence,


                                                     11
budget shares do not depend on u.
   The following lemma characterizes changes in microeconomic welfare.
Lemma 1 (Micro Welfare). Given any change in prices, income, and preferences, micro welfare
changes are given by

                                                               t1
                                  EV m =  log I -
                                                            t0 i  N
                                                                     biev d log pi ,                                 (5)


where biev ( p)  bi ( p, v( pt1 , It1 ; xt1 ); xt1 ) denotes budget shares at prices p, but fixing final pref-
erences xt1 and final utility v( pt1 , It1 ; xt1 ).
   Lemma 1 follows from the observation that EV m can be re-expressed, using the expen-
diture function, as

                      e ( pt0 , v( pt1 , It1 ; xt1 ); xt1 )                e ( pt1 , v( pt1 , It1 ; xt1 ); xt1 )
        EV m = log                                          =  log I - log                                       ,
                      e ( pt0 , v( pt0 , It0 ; xt1 ); xt1 )                e ( pt0 , v( pt1 , It1 ; xt1 ); xt1 )

and recognizing that the second term can be written as the integral in (5).14
    Compared to real consumption (3), which weights price changes by observed budget
shares, EV m weights price changes by hypothetical budget shares evaluated at current
prices but for fixed final preferences, xt1 , and final utility, v( pt1 , It1 ; xt1 ). Welfare depends
on budget shares at xt1 since only these preferences matter for EV m . Welfare depends
on budget shares evaluated at final utility, v( pt1 , It1 ; xt1 ), since EV m adjusts the level of
income in t0 to make consumers as well off as they are in t1 . If welfare increases from t0
to t1 , consumers must be given more income in t0 to make them indifferent between t0
and t1 . As we give consumers more income in t0 , the shape of their indifference curve
changes until it mirrors the one in t1 . This means that the shape of the indifference curve
relevant for the comparison is the one at t1 .15
    We can reinterpret the hypothetical budget shares bev ( p) as corresponding to those of
a fictional consumer with homothetic and stable preferences with expenditure function
  14 By definition, EV m only depends on initial and final prices and income, given t preferences. By the
                                                                                     1
gradient theorem, the integral in (5) is path independent and can be computed under any continuously
differentiable path of prices that go from pt0 to pt1 . When comparing EV m and real consumption, we
consider the integral under the realized set of prices over time.
  15 When preferences are stable, real consumption, defined by (2), is a multi-good version of the change

in consumer surplus, which is the area under the Marshallian demand curve. Similarly, by equation (5),
welfare is the area under the Hicksian demand curve. Hence, in a partial equilibrium context with stable
preferences, the gap between real consumption and welfare is the same as the gap between consumer
surplus and welfare, studied by Hausman (1981) and McKenzie and Pearce (1982) amongst others. This
equivalence does not hold when preferences are unstable (since Marshallian consumer surplus is not the
same as chained real consumption) or in general equilibrium (since micro and macro welfare are not the
same, as we discuss in Section 4).

                                                          12
eev ( p, u) = e ( p, vt1 ; xt1 ) vu
                                  t1
                                     , where vt1 = v( pt1 , It1 ; xt1 ). This implies that we can calculate
changes in welfare given changes in prices based on budget shares bev ( p), without needing
to know income elasticities or the nature of demand shocks. This is because the fictional
consumer has homothetic and stable preferences, which means that all income elasticities
are equal to one and there are no demand shocks. To compute bev ( p), we need to know
the terminal budget shares and the terminal elasticities of substitution, as discussed in the
following remark.

Remark 1 (Non-homothetic CES preferences). To illustrate how Lemma 1 can be used
to calculate EV m with only knowledge of the elasticities of substitution, we consider a
non-homothetic CES example as in Comin et al. (2015) or Fally (2020).16 In this case, the
following differential equation pins down observed changes in actual budget shares:

  d log bi = (1 - 0 ) (d log pi - Eb [d log p]) + ( i - 1) (d log I - Eb [d log p]) + d log xi , (6)

where Eb (·) is the expectation using budget shares as probability weights. The elasticity
 i is the income elasticity of good i, and 0 is the (constant utility) elasticity of substitution
across goods. The term d log xi is a demand shifter (i.e. a taste shock), a residual that
captures changes in expenditure shares not attributable to changes in income or prices.
Note that when  i is equal to 1 for every i, final demand is homothetic, and when xi is
constant for all i, final demand is stable.17
     For ex-post welfare questions, where b(t1 ) is observable, we can construct the unob-
served bev ( p) between t0 and t1 by iterating on

                           d log biev = (1 - 0 ) (d log pi - Ebev [d log p]) ,                           (7)

starting at t1 and going back to t0 . These are changes in budget shares which are only due
to substitution effects. Given bev , we can apply Lemma 1. Hence, demand shocks and
income elasticities are not required to calculate EV m .18
  16 The  result that only elasticities of substitution are necessary to calculate EV m can be generalized to
arbitrary non-CES functional forms, but since the intuition for the more general case is very similar to the
CES case, we leave the more general non-parametric results in Appendix F.
  17 Since b are expenditure shares that always add up to one, it must necessarily be the case that
              i
Eb [d log x ] = 0, and Eb [] = 1. See Appendix C for a derivation of this log-linearization of Marshallian
demand.
  18 In practice, estimating the elasticity of substitution  may require knowing the income elasticities.
                                                              0
However, if the expenditure share of each good is sufficiently small, then 0 can be estimated without
knowledge of income elasticities. Auer et al. (2021) estimate the relevant elasticities and apply Lemma 1
to measure the heterogeneous welfare effects of changes in foreign prices in the presence of demand non-
homotheticities.



                                                     13
    For ex-ante counterfactuals, where b(t1 ) is not known, we must first iterate on equa-
tion (6) from t0 to t1 to obtain b(t1 ). This first step requires knowledge of demand shocks
and income elasticities. Once we calculate bt1 , we repeat the procedure above and apply
(7) to get the path of welfare-relevant budget shares bev .

Remark 2 (Compensating Variation under Initial Preferences). Our baseline measure of
welfare changes is equivalent variation under final preferences. An alternative would be
to use compensating variation under initial preferences. Every result in the paper can be
translated into compensating variation under initial preferences simply by reversing the
flow of time. In particular, whereas Lemma 1 preserves the shape of the indifference curve
at the final allocation, the compensating variation counterpart to Lemma 1 preserves the
shape of the indifference curve at the initial allocation. Hence, calculating compensat-
ing variation requires knowledge of initial budget shares and elasticities of substitution,
whereas equivalent variation requires knowledge of final budget shares and elasticities
of substitution. This means that EV m is more convenient for ex-post comparisons and
CV m (at initial preferences) is more convenient for ex-ante comparisons or counterfactu-
als. This is because in these cases, we use "today's" indifference curves to undertake the
welfare comparisons. See Appendix B for more details.19

    We now contrast changes in real consumption and welfare.

Proposition 1 (Consumption vs. Welfare). Given any continuously differentiable change in
prices, income, and preferences, the difference between welfare changes and real consumption is

                             t1
          EV m -  log Y =          (bi - biev ) d log pi = (t1 - t0 ) Et Cov (b - bev , d log p) ,
                            t0 i  N


where the covariance is calculated across goods at a point in time, and the expectation is calculated
across time between t0 and t1 .

    An immediate consequence of Proposition 1 is the well-known result that real con-
sumption is equal to changes in equivalent variation if, and only if, preferences are ho-
mothetic and stable. This is because when preferences are stable and homothetic, budget
shares do not depend on x or changes in utility u over time. Hence, whenever preferences
are homothetic and stable, biev (t) = bi (t) for every path of shocks and every t.
    When preferences are non-homothetic or unstable, observed budget shares not only
reflect price changes but also non-price changes (that is, changes in x and changes in
  19 InAppendix B we show that, up to a second-order approximation (but not globally), changes in real
consumption equal a simple average of equivalent variation under final preferences and compensating
variation under initial preferences.

                                                   14
u). This generates discrepancies between observed and hypothetical budget shares, and
hence between real consumption and welfare. To gain more intuition for this, we char-
acterize changes in real consumption and welfare using a second-order approximation
around initial choices.

Local results. Consider local approximations of the objects of interest as the time period
goes to zero, t1 - t0 = t  0.20 Throughout the rest of the paper, a second-order approx-
imation means that the remainder term is of order t3 . We focus on second-order approx-
imations to capture the interaction between price changes and expenditure-switching,
which is the source of the gaps between real consumption and welfare changes.
   We begin by stating the results in terms of Hicksian budget shares, and then we re-
express them in terms of Marshallian (observable) budget shares.

Proposition 2 (Approximate Micro using Hicksian Demand). To a second-order approxima-
tion, the change in real consumption is

                                           1          bi   1         bi   1         bi
 log Y   log I - b  log p -                2
                                              log p       +  log x
                                                     log p 2
                                                                         +  log v
                                                                    log x 2        log u
                                                                                          log p,
                                     i N


and the change in welfare is

                                           1          bi              bi              bi
  EV m   log I - b  log p -                2
                                              log p
                                                     log p
                                                           +  log x
                                                                     log x
                                                                           +  log v
                                                                                     log u
                                                                                            log p.
                                     i N

    Comparing the expression for real consumption  log Y and welfare EV m shows that
to a first order, they are the same. Discrepancies between the two arise starting at the
second-order and involve how expenditure-switching is treated. Real consumption ac-
counts for changes in budget shares in the same way regardless of their cause. The first
term in the square brackets reflects changes in budget shares due to changes in relative
prices (substitution effects) and the next two terms correspond to changes in budget share
due to non-price factors (taste shocks and income effects).21
    The second line shows that welfare treats changes in budget shares due to substitu-
tion effects differently to changes in budget shares due to taste shocks or income effects.
  20 For our local approximations, we assume that the exogenous parameters (prices, income, and taste

shifters) are smooth functions of t and that the expenditure function is a smooth function of the exogenous
parameters.
  21 The terms  log x and  log u need only be first-order approximations since they are multiplied by

 log p (and we only need to keep terms that are of order t2 ). However, for the first term -b log p, the
primitive shock in prices must be approximated up to the second order, that is,  log p  ( log p/t)t +
1/2( log p2 /dt2 )t2 .

                                                    15
To understand the gap between welfare and real consumption changes, consider first the
case of homothetic but unstable preferences. Whereas changes in real consumption only
take into consideration changes in budget shares in response to changes in utility param-
eters as the shock unfolds over time, changes in welfare must account for these changes
from the start. Therefore, changes in budget shares due to non-price factors are multi-
plied by 1/2 in real consumption, but they are multiplied by 1 in welfare. In other words,
real consumption does not sufficiently account for substitution caused by preference in-
stability. For example, the additional reduction in welfare (at new preferences) from a
                                                                  bi
price increase in a good i with increasing demand (d log x  log      x d log pi > 0) is not fully
reflected in real consumption, implying EV m <  log Y .22
    Similar reasoning applies in the case of stable but non-homothetic preferences, since
changes in budget shares due to non-homotheticities should be incorporated in welfare
immediately but are reflected in real consumption only gradually. For example, a reduc-
                                                                                      bi
tion in the price of a good for which income effects are relatively weak (d log v  log   v d log pi >
0) implies a smaller increase in welfare than in real consumption (EV <  log Y ).
                                                                            m

    Proposition 2 is expressed in terms of Hicksian elasticities. We now re-express these
results in terms of Marshallian elasticities using the non-homothetic CES aggregator in-
troduced in Remark 1.
Proposition 3 (Approximate Micro using Marshallian Demand). Consider some perturba-
tion in demand  log x, prices  log p, and income  log I. Then, to a second-order approxima-
tion, the change in real consumption is

                                        1
          log Y   log I - Eb [ log p] - (1 - 0 )Varb ( log p)                                       (8)
                                        2
                 1                        1
                - Covb ( log x,  log p) - ( log I - Eb [ log p]) Covb (,  log p) ,
                 2                        2

and the change in welfare is

                1                       1
  EV m   log Y - Covb ( log x,  log p) - ( log I - Eb [ log p]) Covb (,  log p) ,
                2                       2
                                                                               (9)

where Covb (·) is the covariance using the initial budget shares as the probability weights.
   We begin by considering the change in real consumption in (8). To a first order, the
change in real consumption is just the change in income deflated by prices:  log I -
  22 Anon-zero correlation between prices and demand shifters may emerge endogenously if firms have
non-constant returns to scale or if firms invest in advertisement in response to productivity shocks. We
consider the first possibility in Example 4 in Section 4 and discuss the second in Section 6.

                                                  16
Eb [ log p]. The remaining terms capture nonlinearities associated with expenditure-
switching. Since these are second-order, they are multiplied by 1/2. We discuss these
terms one-by-one. If goods are substitutes, 0 > 1, then variance in relative prices boosts
expenditure shares of cheaper goods and this increases measured real consumption. The
second line captures the changes due to changes in demand. Intuitively, if the compo-
sition of demand shifts in favor of goods that happen to become relatively cheap, either
due to non-homotheticity Covb (,  log p) ( log I - Eb [ log p]) < 0 or demand shocks
Covb ( log x,  log p) < 0, then real consumption increases.
    Now consider changes in welfare in (9). As expected, the first-order terms are identi-
cal. The remaining terms capture the nonlinear response of welfare to price shocks. Note
that if preferences are stable and homothetic, then welfare changes coincide with changes
in real consumption. However, if preferences are unstable or non-homothetic, real con-
sumption strays from welfare whenever price changes covary with non-price changes in
demand. This happens because real consumption "undercounts" expenditure-switching
due to the changes in demand.
    In Appendix D we extend Proposition 3 to incorporate unobserved changes in quality.
We show that the biases causes by non-homotheticities and taste shocks are very different
to the ones caused by quality changes. We also explicitly compare the biases that we
study to the ones discussed in Redding and Weinstein (2020).


3    Macroeconomic Changes in Welfare and Consumption
In the previous section we showed how changes in budget sets affect welfare when pref-
erences are unstable and non-homothetic. For these problems, the frontier of the con-
sumer's choice set is linear, since prices are assumed to be exogenous. At the level of
a whole society however, choice sets need not be linear. The production possibility set
associated with an economy may have a nonlinear frontier. In this case, relative prices
respond endogenously to choices made by consumers. In this section, we extend our
analysis to allow for nonlinear production possibility frontiers (PPFs). The analysis in
this section collapses to the one in Section 2 when the PPF of the economy is the same as
the budget constraint (as happens in very simple general equilibrium models).
    We first update our definitions of welfare, now at the macroeconomic level, and we in-
troduce some basic structure and notation. We then present expressions for real GDP and
welfare at the macroeconomic level, first globally and then locally in terms of endogenous
sufficient statistics. In the next section, Section 4, we solve for these endogenous objects
in terms of observable primitives.

                                            17
3.1    Definition of Welfare and Real GDP
Consider a perfectly competitive neoclassical closed economy with a representative agent.
Each good i  N has a production function

                                 yi = Ai Gi        mij   j N
                                                               , li f   f F
                                                                              ,

where Gi is a neoclassical production function, mij are intermediate inputs used by i and
produced by j, and li f denotes primary factor inputs used by i for each factor f  F. The
exogenous scalar Ai is a Hicks-neutral productivity shifter. Without loss of generality,
we assume that Gi has constant returns to scale since decreasing returns to scale can be
captured by adding producer-specific factors. Furthermore Ai is Hicks-neutral without
loss of generality. This is because we can capture non-neutral (biased) productivity shocks
to input j for producer i by introducing a fictitious producer that buys from j and sells to
i with a linear technology. A Hicks-neutral shock to this fictitious producer is equivalent
to a non-neutral technology shock to i.
    Let A be the N × 1 vector of technology shifters and L be the F × 1 vector of primary
(exogenously given) factor endowments. The production possibility set (and its associ-
ated frontier) is the set of feasible consumption bundles that can be attained given A and
L. Given our assumption that production functions have constant returns to scale, the
PPF is linear if there is only one factor of production.
    For each A, L, and x, we denote equilibrium prices and aggregate income by p( A, L, x )
and I ( A, L, x ). These equilibrium prices and incomes are unique up to the choice of a
numeraire.
    Define the macro indirect utility function as the maximum amount of utility the econ-
omy can deliver
                           V ( A, L; x ) = max{u(c; x ) : c is feasible}.
                                               c

Whereas the micro indirect utility takes prices as given and lets consumers pick any point
in their budget set (even if such a point is not feasible at the economy-wide level), the
macro indirect utility function takes the PPF as the primitive and lets society pick feasible
points in the production possibility set. The first welfare theorem implies that the com-
petitive equilibrium decentralizes the planning problem above with prices determined in
equilibrium.23
    We generalize our macroeconomic measure of welfare in the following way.
  23 When the decentralized equilibrium is inefficient or preferences are non-aggregable, we can still rely
on the micro welfare change defined in Section 2, which requires neither assumption. We discuss non-
aggregable preferences in Section 6.


                                                     18
Definition 5 (Macro Welfare). The change in welfare measured using the macro equivalent
variation with final preferences is EV M ( At0 , Lt0 , At1 , Lt1 ; xt1 ) =  where  solves

                              V ( A t1 , L t1 ; x t1 ) = V ( A t0 , e  L t0 ; x t1 ).

    In words, EV M is the proportional change in initial factor endowments required to
make a planner with preferences xt1 indifferent between the PPF defined by ( At0 , e Lt0 )
and the new PPF, defined by ( At1 , Lt1 ). Intuitively, EV M expresses utility changes in terms
of factor endowments. This is convenient in general equilibrium since it can be stated
without reference to (endogenous) prices. In this sense, EV M is similar to consumption-
equivalents commonly used to measure welfare in macroeconomics.24


Discussion of our macroeconomic welfare criterion. To see the difference between
macro and micro notions of welfare, consider a situation where preferences change be-
tween t0 and t1 but technologies and factor endowments do not. Since the PPF is un-
changed, the change in macro welfare is zero. However, if the PPF is nonlinear, the rel-
ative price of goods would change between t0 and t1 . Typically, the price rises for those
goods that became more desirable. In this case, microeconomic welfare, at final prefer-
ences, would fall even though the PPF is unchanged. Hence, microeconomic changes in
welfare are a poor guide for measuring technological change for a society.
    Similarly, suppose we are interested in measuring technological progress in an econ-
omy with growth and aging. Households are richer and older in t1 than in t0 , so they
prefer to spend more of their income on healthcare. Microeconomic welfare is measured
by the endowment a single consumer, living in t1 , would have to be given to make her
willing to go back to the economy with t0 prices. However, since in t0 households were
poor and young, healthcare services are relatively cheap in t0 . This makes t0 prices seem
very attractive to the consumer in t1 . But this is not because technologies in t0 are any bet-
ter. If the older and wealthy consumers were transported to the initial economy, the fact
that they demand more healthcare would raise healthcare prices, and this would mean
that they would not be able to consume as much healthcare services.
    The issue is that using the initial budget set to represent the initial PPF is deceptive,
since the initial budget set reflects both the PPF and demand in t0 . Our macroeconomic
notion of welfare accounts for the endogenous changes in prices by comparing the initial
and final PPFs rather than the initial and final budget sets. To compare initial and final
  24 When  preferences are stable and homothetic, EV M is the same as consumption equivalents, but we
do not define welfare changes in terms of consumption equivalents because when preferences are non-
homothetic or unstable, households' desired consumption bundle is not stable.


                                                       19
PPFs, we scale factor endowments instead of nominal income, since a proportional shift
in factor quantities results in a proportional shift in the PPF and is interpretable without
reference to base prices.
    When relative prices do not respond to consumers' choices (i.e. the PPF is linear), then
macro and micro welfare are always the same. Similarly, if preferences are homothetic
and stable, then macro and micro welfare are the same. Proposition 11 in Appendix A
formalizes this result. For a quantitative illustration of the difference between micro and
macro welfare see the Covid-19 case study in Section 5.


3.2   Relating Welfare and Real GDP
We now characterize changes in real GDP and welfare, first globally and then locally. The
results in this subsection are the general equilibrium counterparts to those in Section 2.
They are "reduced-form" in the sense that they are not expressed in terms of primitives.
In Section 4, we explicitly solve for these sufficient statistics in terms of observable prim-
itives.
    As in Section 2, to study this problem we index the path of technologies, factor inputs,
and preferences A(t) , L(t) and x (t), by time t. The definition of Y is the same as before:
         t
Y = t 1 i N pi dci . In the general equilibrium model and (its applications), we refer to
         0
Y as real GDP.
    Define the sales shares relative to GDP of each good or factor i to be

                                  pi yi            wL
                            i =         1( i  N ) + i i 1( i  F ),
                                   I                I

where wi and Li are the price and quantity of factor i. The sales share i is often referred
to as a Domar weight. Note that referring i as a "share" is an abuse of language since
i N i > 1 whenever there are intermediate inputs. On the other hand i F i = 1.

Global Results. The following results show that changes in real GDP and welfare can
both be represented as sales-weighted averages of technology changes. Real GDP uses
actual sales shares over time, while welfare uses sales shares in an artificial economy in
which budget shares only respond to price changes.

Lemma 2 (Real GDP). Given a change in technologies, factor quantities, and preferences, the
change in real GDP is

                                   t1                    t1
                       log Y =           i d log Ai +
                                  t0 i  N
                                                               i d log Li ,
                                                        t0 i  F
                                                                                         (10)


                                              20
where  are sales shares which are functions of A, L, and x.

     In (10), the first N summands are equal to measured TFP, and the last F summands are
the growth in real GDP caused by changes in factor inputs. Lemma 2 shows that changes
in real GDP are equal to sales-weighted changes in technology and factor inputs. This is a
slight generalization of Hulten (1978) to environments with unstable and non-homothetic
final demand.
     Next, we show that a Hulten-style result also exists for changes in welfare. Define
  ev
 ( A, L) to be sales shares in a fictional economy with the PPF ( A, L) but where con-
sumers have stable homothetic preferences represented by the expenditure function eev ( p, u) =
e( p, vt1 , xt1 ) vu
                   t1
                      where vt1 = v( pt1 , It1 ; xt1 ), similar to Section 2. We call ev the welfare-
relevant sales share.

Proposition 4 (Macro Welfare). Changes in macro welfare are

                                        t1                         t1
                           EV M =             iev d log Ai +
                                       t0 i  N
                                                                         iev d log Li .
                                                                  t0 i  F
                                                                                                      (11)


     According to Proposition 4, growth accounting for welfare should be based on hy-
pothetical sales shares evaluated at current technology but for fixed final preferences and
final utility. This should be contrasted with real GDP in (10), which uses sales shares eval-
uated at current technology and current preferences. As with real GDP, the first N sum-
mands of (11) are changes in welfare-relevant TFP and the last F summands are changes
in welfare due to changes in factor inputs. We discuss some salient implications of this
proposition below.
     The first implication is that for welfare questions, the only information we need about
preferences are expenditure shares and elasticities of substitution at the final allocation,
since the fictional consumer in Proposition 4 has stable preferences with income elastici-
ties all equal to one.25
     Second, Proposition 4 implies that if the path of technologies and factor quantities is
continuously differentiable, then real GDP is equal to the change in welfare if, and only
if, preferences are homothetic and stable (in which case  ( A, L, x ) = ev ( A, L) for every
A, L, and x).
     Third, as stated in the following corollary, movements on the surface of a PPF driven
by changes in preferences have no effect on macroeconomic welfare or real GDP.

  25 Following the observation made in Remark 2, for compensating variation at initial preferences, we need

to know elasticities of substitution at the initial allocation instead of the final one.



                                                        21
Corollary 1 (Demand Shocks Only). In response to changes in preferences, x, that keep the PPF
unchanged, A(t) = A(t0 ) and L(t) = L(t0 ) for t  [t0 , t1 ],

                                          log Y = EV M = 0.

However, micro welfare changes, EV m , may be nonzero.

    Since the production possibility set is not changing, macro welfare (defined for fixed
preferences) does not change. Quantities and prices do, however, change between t0
and t1 in response to changes in preferences over these goods. Micro welfare changes
are typically non-zero when prices change, as shown in Section 2. These results are not
contradictory: the micro welfare metric assumes that consumers can choose any bundle
in their budget set at given prices (hence welfare changes as prices change). On the other
hand, the macro welfare metric takes into account the fact that such choices may not be
feasible for society as a whole. Finally, movements along the surface of a PPF have no
effect on real GDP because demand-driven changes in output raise some quantities and
reduce others, and these effects exactly cancel out.
    While real GDP and macroeconomic welfare changes are the same so long as we stay
on the surface of a given PPF, the two are not equal when the PPF shifts. This is because
real GDP is based on a path of sales shares  that take into consideration technology
shocks as well as changes in preferences and non-homotheticities in final demand. How-
ever, changes in welfare are based on a path of sales shares ev that only take into con-
sideration technology shocks. Therefore, if productivity rises for goods for which sales
shares fall due to non-technological factors, then EV M <  log Y .

   To get more intuition for Proposition 4, in the following section, we use a second-order
approximation to characterize changes in real GDP and welfare.


Local Results. We characterize, up to a second order approximation (as t1 - t0 = t 
0), the response of real GDP and welfare to technology and preference shocks, now tak-
ing into account the endogenous evolution of sales shares. To make the formulas more
compact and without loss of generality, when we write local approximations we abstract
from shocks to factor endowments.26

  26 Shocks to factor endowments are a special case of TFP shocks. To represent a factor endowment shock
as a TFP shock, we add fictitious producers that buy the factor endowments on behalf of the other producers
and shock their productivity.




                                                    22
Proposition 5 (Approximate Macro Welfare and Real GDP). Up to to a second order approx-
imation, the change in real GDP is

                               1             i                i
      log Y    log A +            
                               2 i N
                                      log x
                                             log x
                                                   +  log A
                                                             log A
                                                                    log Ai ,              (12)


and the change in welfare is

                           1             i               log v i
       EV M   log Y +         
                           2 i N
                                  log x
                                         log x
                                               +  log A
                                                         log A  log v
                                                                       log Ai .          (13)


    Equation (12) resembles the one in Proposition 2, but it is based on sales shares and
technology shocks rather than budget shares and price changes. The first term in (12)
corresponds to the Hulten-Domar formula. The terms in square brackets reflect nonlin-
earities due to changes in sales shares. Intuitively, if sales shares decrease for those goods
with higher productivity growth, then real GDP growth slows down due to substitution
effects. This type of effect, known as Baumol's cost disease, is an important driver of the
slow-down in aggregate productivity growth.
    The intuition underlying the gap between macro welfare and real GDP in Proposition
5 is similar to that in Proposition 2 for our micro results (the signs are flipped because
a positive productivity shock reduces prices). Specifically, real GDP takes into consider-
ation changes in sales shares along the equilibrium path. These changes in sales shares
could be induced by technology shocks but they could also be due to changes in prefer-
ences and non-homotheticities. However, welfare measures treat changes in shares due
to technology shocks differently than changes in shares due to demand shocks or non-
homotheticities. In both cases, real GDP "undercorrects" for changes in shares caused by
non-homotheticities or changes in preferences. In particular, welfare is lower than real
GDP if technology growth is lower in goods where sales shares rise due to preference
changes or non-homotheticities.
    Note that there can be a gap between real GDP and welfare even if all productivity
shocks are the same. Specifically, suppose that productivity growth is common across all
goods  log Ai =  log A and denote the gross output to GDP ratio by sum = i N i 
1. Then Proposition 5 implies that the gap between real GDP and welfare is

                                      1              sum
                   EV M -  log Y         log A sum -         log A ,                     (14)
                                      2               log A

where the term in square brackets is the change in the gross output to GDP ratio due


                                             23
to demand-side forces only. In particular, if demand shifts towards sectors with higher
value-added as a share of sales, then EV M <  log Y when technology shocks are positive.
Intuitively, this happens because welfare is less reliant on intermediates than real GDP,
and hence real GDP is more sensitive to productivity shocks. Of course, in the absence of
intermediate inputs, this effect disappears because sum will always equal one.


4    Structural Macro Results and Analytic Examples
The results in Section 3 are reduced-form in the sense that they take changes in observed
and welfare-relevant sales shares as given. In this section, we solve for changes in these
endogenous objects in terms of observable sufficient statistics. For clarity, we restrict
attention to nested-CES economies. The general case is in Appendix F, and the intuition
is very similar. After providing a characterization to solve for changes in prices and shares
in general equilibrium, we go over some analytical examples to provide more intuition.
We also discuss how our results can be applied in dynamics economies.


Nested-CES economies. Household preferences are represented by a non-homothetic
CES aggregator, which imply that budget shares vary according to (6). Recall that 0
is the elasticity of substitution across consumption goods and  is the vector of income-
elasticities. Production also uses nested-CES aggregators. Nested-CES economies can
be written in many different equivalent ways, since they may have arbitrary patterns
of nests. We adopt the following representation. We assume that each good i  N is
produced with the production function

                                                                                               i
                                                                  i -1                i -1    i -1

                                                        ij mij                i f li f
                                                                                       i
        yi = Ai Gi   mij   j N
                                 , li f   f F
                                                = Ai               i
                                                                         +                           ,
                                                       j N                   f F


where the parameters ij and i f are constants. Any nested-CES production network
can be represented in this way if we treat each CES aggregator as a separate producer
(see Baqaee and Farhi, 2019b).


Input-output matrix. We stack the expenditure shares of the representative household,
all producers, and all factors into the (1 + N + F ) × (1 + N + F ) input-output matrix .
The first row corresponds to the household. To highlight the special role played by the
representative agent, we index the household by 0, which means that the first row of 
is equal to the household's budget shares introduced above (0 =b , with bi = 0 for

                                                  24
i / N ).27 The next N rows correspond to the expenditure shares of each producer on
every other producer and factor. The last F rows correspond to the expenditure shares of
the primary factors (which are all zeros, since primary factors do not require any inputs).


Leontief inverse matrix. The Leontief inverse matrix is the (1 + N + F ) × (1 + N + F )
matrix defined as
                           ( I -  ) -1 = I +  +  2 + . . . ,

where I is the identity matrix. The Leontief inverse matrix   I records the direct and
indirect exposures through the supply chains in the production network. We partition 
in the following way:

                                                            1              F
                                                                                  
                              1    1     · · · N                    ···
                              0   11     · · · 1 N         1 N +1   · · · 1 N + F 
                                                                                  
                      
                                         ..
                                                                                  
                              0             .
                                                                                  
                                                                                  
                     =        0  N1             NN  NN +1           · · ·  NN + F 
                                                                                  
                                                                                  .
                              0    0     ···     0          1       ···     0
                                                                                  
                                                                                  
                              .
                              .    .
                                   .             .
                                                 .          .
                                                            .               .
                                                                            .
                                                                                  
                              .    .     ···     .          .        1      .
                                                                                  
                                                                                  
                              0    0     ···     0          0       ···    1

The first row and column correspond to final demand (good 0). The first row is equal to
the vector of sales shares for goods and factors  . To highlight the special role played by
factors, we interchangeably denote their sales share by the F × 1 vector . The next N
rows and columns correspond to goods, and the last F rows and columns correspond to
the factors. Define the (1 + N + F ) × F matrix  F as the submatrix consisting of the right
F columns of , representing the network-adjusted factor intensities of each good. The
sum of network-adjusted factor intensities for every good i is equal to one,  f  F i f = 1
because the factor content of every good is equal to one. In our results below we will use
the identities  = b  and  = b  F .


4.1       General characterization for nested-CES economies
Changes in real GDP and welfare can be computed by weighing technology shocks by
observed and welfare-relevant sales shares ( and ev , respectively) and cumulating the
results (see Lemma 2 and Proposition 5). The following proposition pins down  and ev
  27 We expand the vector of demand-shifters  log x and income elasticities  to be (1 + N + F ) × 1, where
 log xi =  i = 0 if i / N.


                                                     25
along the transition path. This proposition can then be used in combination with Lemma
2 and Proposition 5 to calculate (globally) changes in real GDP and welfare.
   To simplify notation, we again assume away shocks to factor endowments and con-
sider some path of taste and technology shocks { x (t), A(t)}t[t0 ,t1 ] .

Proposition 6 (Characterization for nested-CES economies). Changes in observed variables
are pinned down by the following coupled system of differential equations:

                        d log pi = -  ij d log A j +     i f d log  f ,
                                       j                f F


 dil =    ij ( j - 1)Cov(j)        -d log p, (l ) + 1{i=0} Cov(0) d log x + d log Y, (l ) ,
          j

where changes in observed sales shares are given by di = d0i for every i and changes in real
GDP are given by d log Y = i i d log Ai .
    On the other hand, changes in welfare-relevant variables are pinned down by the following
system of differential equations

                              ev
                       d log pi  = -  ij
                                      ev
                                         d log A j +      iev       ev
                                                            f d log  f ,
                                       j                 f F


                      ev
                     dil =     ij
                               ev
                                  ( j - 1)Covev,( j)     -d log pev , ev
                                                                      (l ) ,                 (15)
                               j

where changes in welfare-relevant sales shares are given by diev = d ev for every i and changes
                                                                        0i
in welfare are given by (4).
    For all of these expressions, the summations are evaluated over all goods and factors, so that
i and j  {0} + N + F, Cov( j) (·) is the covariance using the jth row of  as the probability
weights, and (i) is the ith column of the Leontief inverse.

    These differential equations can be solved by repeated iteration. This allows us to
compute the path of ev and . Once in possession of these paths, the change in real
GDP and welfare are straightfoward to calculate by cumulating the  and ev -weighted
sum of technology shocks. For this iterative procedure, the boundary conditions are that
at the end point, prices satisfy p(t1 ) = pev (t1 ) = 1 and the Leontief inverse matches
ev (t1 ) = (t1 ).
    For ex-post welfare questions, where the Leontief inverse  is observed at t1 , we can
calculate ev between t0 and t1 by starting at t1 and going backwards to t0 . This process
does not require knowledge of either the income elasticities  nor the taste shocks  log x
since they do not appear in either the equation for d log pev nor the equation for dev .

                                               26
    Each term in Proposition 6 has a clear interpretation. We start by discussing the equa-
tion determining prices d log p. This equation captures the fact that the price of each good
d log pi is determined by its (direct and indirect) exposure to the price of inputs j and fac-
tors f . The equation for d log il , in turn, shows that changes in the Leontief inverse are
determined by substitutions by j, if j is an intermediary between i and l , as well as income
and substitution effects if i is the household (i = 0). Finally, the welfare-relevant versions
of these equations, d log pev and dev are identical except that they do not account for
expenditure-switching due to income effects or taste shocks.

Remark 3 (Micro Welfare). Proposition 6 can also be used to compute changes in microe-
conomic welfare EV m . To this, we compute the path of prices using Proposition 6 and
then plug these price changes into equation (7) to get the welfare-relevant budget shares
bev . These can then be used in conjunction with Proposition 2 to get EV m . Note that,
unlike macroeconomic welfare EV M , this calculation requires knowledge of both income
elasticities and taste shocks, unless there is a single factor of production as discussed bel-
low.

Remark 4 (Compensating Variation). Proposition 6 can also be used to compute changes
in compensating variation at initial preferences (instead of equivalent variation at final
preferences). To do this, we would still solve the differential equations for d log pev and
dev , however, we would use different boundary conditions. The boundary conditions
for compensating variation at initial preferences would match the data at t0 instead of t1 ,
setting pev (t0 ) = 1 and ev = (t0 ). We would then solve the differential equations for-
ward from t0 to t1 and use the resulting welfare-relevant shares to weight the technology
shocks. This procedure effectively makes use of the fact that compensating variation at
initial preferences going from t0 to t1 is equal to equivalent variation at final preferences
if we go from t1 to t0 . As with EV M , conditional on the boundary conditions, we do not
need to know the income elasticities or the taste shocks.

    To build more intuition, we focus on the economies with only a single factor of produc-
tion. In this case, the differential equations for d log p and d log pev are decoupled from the
ones for d and dev . This follows from the fact that the economy's single primary factor
must have a sales share of unity. In other words, the following set of equations always
hold:  f = ev   f = 0 f = 0 f = 1. This allows for a simple closed-form characterization
                               ev

of both welfare and real GDP up to a second-order approximation.

Proposition 7 (Approximate Macro Welfare vs GDP: Single Factor). Consider some pertur-
bation in technology,  log A, and final demand,  log x. When the economy has one factor of

                                              27
production, the change in real GDP is

                                         1
           log Y      i  log Ai + 2   j ( j - 1)Var(j)  (i)  log Ai
                     i N                     j                 i N

                      1
                     + Cov(0)       log x + (  i  log Ai ),     (i)  log Ai       ,       (16)
                      2                          i N           i N

The difference between welfare and GDP is

                   1
     EV M -  log Y  Cov(0)               log x + (  i  log Ai ),    (i)  log Ai       .   (17)
                   2                              i N              i N

    Proposition 7 is a general equilibrium counterpart to Proposition 3. We discuss (16)
and (17) in turn, starting with (16). The first term in Equation (16) is the Hulten-Domar
term. The other terms are second-order terms resulting from the fact that sales shares
change in response to shocks. The first one of these terms captures nonlinearities due to
the fact that sales shares can respond to changes in relative prices caused by technology
shocks (these effects were emphasized by Baqaee and Farhi, 2019b). The terms on the
second line of (16), which are the ones we focus on in this paper, capture changes in sales
shares due to changes in preferences or non-homotheticities.
    Equation (17) shows that while real GDP correctly accounts for substitution due to
supply shocks, it needs to be corrected for expenditure-switching due to changes in final
demand caused by taste shocks or non-homotheticities. Whereas in partial equilibrium,
the gap between welfare and real GDP is proportional to the covariance of supply and
demand shocks (see Proposition 3), equation (17) shows that in general equilibrium, the
relevant statistic is the covariance of demand shocks with a network-adjusted notion of
supply shocks not supply shocks per se. Furthermore, Proposition 7 shows that the elas-
ticities of substitution are irrelevant for the gap between welfare and real GDP in one-
factor models. This is because, in response to demand-driven forces, relative prices do
not change as the equilibrium moves along a linear PPF. Therefore, demand shocks do not
trigger expenditure switching due to the endogenous response of relative prices. When
we relax the linearity of the PPF, we see that the elasticities of substitution in production
do, in general, affect the gap between welfare and GDP.




                                                 28
4.2   Analytical Examples
We now work through some simple examples to illustrate the forces that drive a gap
between  and ev and, by extension, real GDP and welfare.

Example 1 (Correlated Supply and Demand Shocks). We start with the simplest possible
example, a one sector model without any intermediates. In this case, sales shares are just
budget shares i = bi = 0i and (i) is the ith column of the 1 + N + F identity matrix
I(i) . Therefore, Proposition 7 implies

                         1
      EV M -  log Y        (Covb ( log x,  log A) + Covb (,  log A) Eb [ log A]) .
                         2

Hence, welfare changes are greater than the change in real GDP if productivity and de-
mand shocks are positively correlated. This could happen either because preferences
exogenously change to favor high productivity goods, Covb ( log x,  log A) > 0, or
preferences endogenously change to favor high productivity growth goods due to non-
homotheticities, Covb (,  log A)  log Y > 0. When shifts in demand are orthogonal to
shifts in supply, to a second-order approximation, real GDP measures welfare correctly.

Example 2 (Input-Output Connections). For models with linear PPFs, input-output con-
nections affect the gap between real GDP and welfare in two ways: (1) the impact of
technology shocks is bigger when there are input-output linkages because (i)  I(i) and
i  bi ; (2) the production network "mixes" the shocks, and this may reduce the cor-
relation of supply and demand shocks by making the technology shocks more uniform.
However, since it is the covariance (not the correlation) of the shocks that matters, this
means the effects are, at least theoretically ambiguous.
    To see these two forces, consider the three economies depicted in Figure 1. Each of
these economies has a roundabout structure. Panel 1a depicts a situation where each
producer uses only its own output as an input, Panel 1b a situation where all producers
use the same basket of goods (denoted by M) as an intermediate input, and Panel 1c a
situation where each producer uses the output of the other producer as an input. We
compute the correction to GDP necessary to arrive at welfare for each of these cases using
Proposition 7. For clarity, we focus on demand shocks caused by instability rather than
non-homotheticity, though it should be clear that this does not affect any of the intuitions.
    For Panel 1a, we get

                                   1                -1
                     EV M -  log Y  Covb ( log xi , iL  log Ai ),
                                   2


                                             29
                                                      M

   1           ···            N
                                            1        ···         N                 1                  2


               HH                                    HH                                    HH

                (a)                                   (b)                                   (c)

Figure 1: Three different kinds of round-about economy. The arrows represent the flow
of goods. The only factor is labor which is not depicted in the diagram.


where the covariance is computed across goods i  N and iL is the labor share for
i. Hence, as intermediate inputs become more important, the necessary adjustment be-
comes larger. This is because, for a given vector of preference shocks, the movement in
sales shares is now larger due to the roundabout nature of production.28
    On the other hand, for Panel 1b, we get29

                          1                                                             i N  log Ai
   EV M -  log Y               Covb ( log xi ,  log Ai ) - Covb ( log xi , iL )                            .
                          2                                                              i N iL

Hence, in this case, if the labor share iL is the same for all i  N , then the intermediate
input share is irrelevant. Intuitively, in this case, all producers buy the same share of
materials, so a shock to the composition of household demand does not alter the sales
of any producer through the supply chain, and hence only the first-round non-network
component of the shocks matters.30
    Finally, consider Panel 1c. For clarity, focus on the case where only producer 1 gets
a productivity shock ( log A2 = 0). In this case, the difference between real GDP and
welfare is

                                     1     1                               1
              EV M -  log Y                      Covb           log x,                  log A1 .
                                     2 1 - 12 21                           21
  28 As discussed after Equation (14), if all productivity shocks are the same, there may still be an adjustment

due to heterogeneity in labor shares. In particular, if demand shocks are higher for sectors with higher labor
shares, then EV M <  log Y when technology shocks are positive.
  29 For this example, we assume that there are no productivity shocks to the intermediate bundle

 log A M = 0 and we assume that iM = 1/ N for each i  N .
  30 As in Footnote 28, if the labor share is heterogeneous across producers, there is an additional adjust-

ment which depends on the covariance between demand shocks and labor shares. If the demand shocks
reallocate expenditures towards sectors with high labor shares, then welfare becomes less sensitive to pro-
ductivity shocks than real GDP.


                                                      30
As the intermediate input share 21 approaches one, the adjustment goes to zero (since
the covariance term goes to zero). Intuitively, as 21 goes to one, the increase in demand
for the first producer from a change in preferences is exactly offset by a reduction in de-
mand from the second producer who buys inputs from the first producer. In this limiting
case, changes in consumer preferences have no effect on the overall sales share of the first
producer.
    These three examples serve to illustrate that the effect of input-output networks on the
adjustment are theoretically ambiguous but potent.

    We now work through some simple examples with multiple factors of production to
illustrate how nonlinear PPFs affect the previous results.

Example 3 (Decreasing Returns to Scale). Consider the one-sector model without in-
termediate inputs in Example 1 but now suppose that production functions are non-
constant-returns-to-scale. Specifically, the production for good i is

                                                  
                                        yi = Ai Li ,

where Li is labor and  need not equal 1. Furthermore, suppose that preferences are
homothetic ( i = 1 for every i), but potentially unstable ( log x = 0). To apply our
theorems to this economy, where producers have non-constant-returns production func-
tions, we introduce a set of producer-specific factors in inelastic supply, and suppose that
each producer has a Cobb-Douglas production function that combines a common factor
with elasticity  and a producer-specific factor with elasticity 1 - . This means that our
economy has 1 + N factors.
    We apply Proposition 5 to compute the difference between welfare and real GDP. To
do this, we first use Proposition 6 to compute changes in sales shares due to demand
shocks:

    i                                                                d log p
          · d log x = Cov(0) d log x, (i) + (0 - 1)Cov(0)        -           d log x, (i) .
    log x                                                            dlogx

The factor content of every good i  N is given by iFf =  when f is the common
factor and iFf = 1 -  when f is the producer-specific factor. Since the factor shares
of each producer are constant, the log change in the producer-specific factor share is the
same as the log change in the sales share of that producer. Therefore, we can replace
d log pi /d log x in the covariance with( - 1) ( log i / log x ) d log x (the other compo-
nents of price changes are common to all producers and drop out of the covariance).
Plugging this into the expression above and solving yields a closed-form expression for

                                            31
i / log x. This allows us to apply Proposition 5 to get the difference between welfare
and real GDP up to a second order approximation:

                                             1 Cov(0) ( log x,  log A)
                       EV M - logY                                     .
                                             2 1 + (0 - 1)(1 - )

Note that the denominator disappears when we have constant-returns to scale ( = 1)
or the elasticity of substitution across goods is one (0 = 1). Outside of these cases,
complementarities (0 < 1) amplify the impact of preference shocks under decreasing
returns to scale ( < 1). Intuitively, if preferences shift in favor of some good, the price
of that good rises due to decreasing returns to scale. The fact that the price of the good
increases raises the sales share of that good due to complementarities, which creates a
feedback loop, raising prices of the good further, and causing additional substitution. In
other words, in the decreasing returns to scale model with complementarities, sales shares
respond more strongly to demand shocks. Given that sales shares respond more strongly
to demand shocks, the necessary adjustment to correct real GDP is larger.

Example 4 (Macro vs. Micro Welfare Change). Finally, we demonstrate the difference
between macro and micro welfare changes using the previous example. The economy
in the previous example has multiple factors and unstable preferences. Therefore, macro
and micro notions of welfare are different since the PPF is no longer linear.
    To illustrate this difference, suppose that only preference shocks are active (there are
no supply shocks  log A = 0 and  log L = 0). By Corollary 1, real GDP changes are
zero. Since the PPF is being held constant, macro-welfare changes are also zero. Micro-
welfare changes, on the other hand, are not equal to zero. Specifically, by Proposition
2, micro welfare improves EV m > 0 if preference shocks negatively covary with price
changes. By equation (40), changes in prices are

                                                        log  f
                               d log pi =    iFf        log x
                                                               d log x.
                                            f F


Using the derivations above, for each i  N , we obtain

                                    (1 -  )        1
                 d log pi =                          Cov(0) d log x, I(i) ,
                              (1 + (0 - 1) (1 - )) i

where I(i) is the ith column of the identity matrix. If there are decreasing returns,  < 1,
then a positive demand shock for i raises the price of i. The change in the price is amplified
if goods are complements and mitigated if goods are substitutes. We can now apply


                                                  32
Proposition 3 to obtain the change in micro welfare, up to a second order,

                             1       (1 -  )
                EV m  -                             Var(0) ( log x ) = 0 = EV M .
                             2 (1 + (0 - 1) (1 - ))

With decreasing returns to scale ( < 1), micro welfare decreases since the demand shock
increases the prices of goods the consumer now values more. From a micro perspective,
where the agent takes the budget sets as given, the agent is worse off.
    On the other hand, when the economy has increasing returns to scale ( > 1), micro
welfare increases in response to demand shocks. Intuitively, in this case, increased de-
mand for a good lowers the price of that good, which makes the consumer better off.31 Of
course, from a societal perspective, welfare has not changed, since the production possi-
bility set of the economy has not changed.


4.3    Dynamic Economies
As mentioned earlier, at an abstract level, all of our results can be applied to dynamic
economies by using the Arrow-Debreu formalism. In particular, we can index goods
by period of time and state of nature and apply our results to these economies (see e.g.
Basu et al., 2012). In a dynamic economy the utility function is intertemporal and capital
accumulation is an intertemporal intermediate good. Proposition 4 implies that, in such a
model, macro welfare can be computed using the final (intertemporal) indifference curve
of the representative agent.
    In this subsection, we instead show how Proposition 4 can be used to make steady-
state to steady-state welfare comparisons in models with unstable and non-homothetic
preferences without requiring us to solve a dynamic model. For simplicity, we restrict
our discussion to non-homothetic CES preferences, though this logic can be extended.
    To this end, consider a perfectly competitive dynamic economy indexed by the initial
period t with a representative agent whose intertemporal preferences are given by

                                                                           0 -1
                                                                           0
                                                                     cis
                         Ut =    s-t u(Cs ),           i0 xit         
                                                                                  = 1,
                                s=t                     i           Cs i

where Cs is a non-homothetic (and potentially unstable) CES aggregator.The economy has
the same set of goods every period, and every good i in period s is produced according
   31 If the economy has increasing returns to scale, then the decentralized equilibrium is potentially ineffi-

cient. However, the propositions regarding micro welfare changes, which take changes in prices as given,
do not require that the decentralized equilibrium be efficient.


                                                      33
to constant returns production technology

                            yis = Ais Gi      mijs   j N
                                                           , H (lis , k is ) ,

where Ais is a productivity shifter, lis are capital and labor inputs, and H is constant
returns to scale.
    Labor Ls in each period is inelastically supplied, and capital is accumulated according
to a capital accumulation technology

                                  Ks+1 = (1 - ) (Ks + Is ) ,

where Is is aggregate investment. Investment goods are produced according to a constant
returns technology
                            Is = A Is I m I js j N , H (l Is , k Is ) .

    The intertemporal PPF of economy t is defined by an initial capital stock inherited
from the past, a path of future labor endowments, and a path of vectors of productivi-
ties: (Kt , { Ls }            
                  s=t , { As }s=t ). This economy has infinitely many factors: the path of labor
endowments as well as the initial capital stock (Kt , { Ls }   s=t ). The welfare change between
t0 and t1 is the proportional change in factor endowments of the t0 economy required to
make the household indifferent between that and the t1 economy. We say that economy t
is in steady-state if the vector of productivities As , labor endowments Ls , per-period utility
u(Cs ), and capital stocks Ks are constant over time.
    The following proposition shows that computing the welfare change between t0 and
t1 is straightforward if the economy is in steady-state in both t0 and t1 .

Proposition 8 (Dynamic Welfare Change). Consider two dynamic economies, denoted t0 and
t1 , that are in steady-state. The change in macro welfare is given by

                                                                                          1
                                                                                 1- 0   1- 0
                                i pit1 cit1                           pit1
                 EV M = log
                                i pit0 cit0
                                              - log     bit1          pit0
                                                                                               .
                                                           i

    In words, the change in nominal consumption deflated by the ideal price index as-
sociated with the t1 indifference curve is equal to the macroeconomic change in welfare.
If preferences are stable and homothetic in both t0 and t1 , then the change in welfare is
equivalent to the change in real consumption. In the next section, we use Proposition 8
to compute welfare changes for the US under alternative assumptions about substitution
and income elasticities.


                                                34
5     Applications
In this section, we consider three applications of our results. The first application is to the
problem of long-run growth and the difference between welfare-relevant and measured
aggregate productivity growth as well as the difference between welfare and measured
real consumption, in the presence of income effects and demand instability. The second
application shows that correlated firm-level supply and demand shocks drive a wedge
between measured real GDP and welfare even in the short-run. Our last application con-
siders how demand instability can make measured real GDP an unreliable metric for
changes in production, and we illustrate this point for the Covid-19 crisis.


5.1    Long-Run Growth and Structural Transformation
Baumol (1967) showed that, as economies grow, sectors with lower relative productivity
growth rates expand (in terms of sales and value-added) relative to sectors with faster
productivity growth. This means that over time, aggregate productivity growth is in-
creasingly determined by those sectors whose productivity growth is slowest. This phe-
nomenon is oftentimes called Baumol's cost disease.
   Following Nordhaus et al. (2008), aggregate productivity growth can be decomposed
into two terms:
                                t1                              t1
               log TFP =                    i,t0  log Ai,t +                 i,t - i,t0  log Ai,t ,
                              t = t0 i  N                      t = t0 i  N

                                                                         Baumol Adjustment


where i,t is the sales shares of industry i in period t and  log Ai,t is the growth in gross-
output productivity over that time period.32 The first term captures changes in aggregate
TFP if industry-structure had remained fixed, and the second term is the adjustment at-
tributed to the fact that sales shares change over time. The second-term captures the
importance of Baumol's cost disease.
    Proposition 4 implies that, for the purposes of welfare, changes in sales shares due to
income effects or demand instability must be treated differently to changes in sales shares
due to substitution effects. In particular, the welfare-relevant measure of the change in
  32 Technically, this is an approximation, since we define aggregate TFP in continuous time but the data is

measured in discrete time (at annual frequency). However, this approximation error, resulting from the fact
that the Riemann sum is not exactly equal to the integral is likely to be negligible in practice. At our level
of disaggregation, long run TFP growth is very similar if we weight sectors using sales shares at time t or
time t and t + 1 averages.



                                                       35
TFP is
                  t1                            t1                                     t1
 log TFP =  w
                    i,t0  log Ai,t +                        i,t - i,t0  log Ai,t +                  ev
                                                                                                    i ,t - i,t  log Ai,t ,
                 t = t0 i  N                  t = t0 i  N                             t = t0 i  N

                                                        Baumol Adjustment                       Welfare Adjustment


where ev is the hypothetical sales-shares of each industry holding fixed final preferences
and income-level -- that is, sales shares after they have been purged from changes due to
factors other than changes in relative prices.33


Two polar extremes. Computing these terms requires an explicit structural model of the
economy.34 However, there are two polar cases in which the TFP adjustment term can be
calculated without specifying the detailed model. On the one hand, demand is stable and
homothetic, and changes in sales shares are due only to relative price changes (substitu-
tion effects). On the other hand, there are no substitution effects (as in a Cobb-Douglas
economy) and changes in sales shares are only due to income effects or demand insta-
bility. If structural transformation is driven by a combination of substitution effects and
non-homotheticities or demand instability, then the change in welfare TFP will be some-
where in between these two cases. The following corollary of Proposition 4 summarizes
the change in welfare-TFP in these two polar cases.

Corollary 2. If changes in sales shares are due only due only to substitution effects, then

                                                               t1
                                     w
                           log TFP =  log TFP =                 i,t  log Ai,t .
                                                              t = t0 i  N


If changes in sales shares are due only to non-homotheticity or instability of demand, then

                                         t1                                    t1
                 w
      log TFP =  log TFP +                           i,t1 - i,t  log Ai,t =     i,t1  log Ai,t .
                                      t = t0 i  N                             t = t0 i  N
  33 We  abstract from investment and apply our formulas statically. This means that we assume a reduced
form representation whereby preference relations are defined over all final goods in a given period (includ-
ing government spending, net exports, and investment) and calculate welfare changes between two time
periods taking technologies and factor quantities as given. When calculating welfare using consumption
data below, we apply the steady-state results of a dynamic economy implied by Proposition 8.
  34 For this exercise, we abstract from investment decisions and apply our formulas statically. This means

that we assume a reduced-form representation whereby preference relations are defined over all final goods
in a given period (including government spending, net exports, and investment) and calculate welfare
changes between two time periods taking preferences, technologies, and factor quantities as given. When
calculating welfare using consumption data below, we apply the steady-state results of a dynamic economy
implied by Proposition 8.



                                                       36
    In the first case, since preferences are homothetic and stable, welfare-TFP is equal to
TFP in the data. In the second case, since there are no substitution effects in production
or demand, sales shares do not respond to productivity changes. In order to hold utility
and preferences fixed at their final value, we must compute welfare-TFP using terminal
sales shares.

                      0.6




                      0.5                                   Initial Shares
                                                            Welfare with only substitution effect
                                                            Welfare with only income effect


                      0.4




                      0.3




                      0.2




                      0.1




                       0
                       1940    1950   1960    1970   1980      1990           2000          2010    2020




Figure 2: Growth in welfare-relevant TFP (in logs) from 1947 to 2014 using US-KLEMS.
The blue line uses initial shares (in each year t between 1947 and 2014) to calculate TFP
changes. The red and yellow line measure the increase in welfare-relevant TFP between
t and 2014 under alternative assumptions about income and substitution elasticities. The
red line assumes that sales shares change only due to substitution effects (welfare-relevant
TFP is equal to measured chained-aggregate TFP). The yellow line assumes that sales
shares change only due to income effects (or demand instability).

   To quantify Corollary 2, we use US-KLEMS data on sales shares and TFP growth for 61
private-sector industries between 1947 and 2014. We calculate changes in industry-level
gross-output TFP following the methodology of Jorgenson et al. (2005) and Carvalho and
Gabaix (2013).35
   Figure 2 plots EV M comparing 2014 to previous years under alternative assumptions
about substitution and income elasticities. For comparisons that are relatively close to
2014, the change in welfare is not very sensitive to our assumptions about elasticities.
This is because at high frequency, the shocks are small and the sales shares are reasonably
  35 For each industry, the change in TFP is itself a chain-weighted index calculated as output growth minus

share-weighted input growth. Inputs are industry-level measures of materials, labor, and capital services.

                                                     37
stable. However, the assumptions about substitution and income elasticities do start to
play a role as we roll the comparison back farther in time. Comparing 1947 to 2014, the
constant-initial-sales-share term grows by around 58 log points (or 78%), whereas the
chain-linked change in aggregate TFP grew by around 47 log points (or 60%). Hence,
Baumol's cost-disease caused aggregate TFP to fall by -10 log points, reducing aggregate
productivity growth by around 23 percent (from 78% to 60%).
    If we assume that structural transformation is due solely to non-homotheticities or
demand instability, then by Corollary 2 the growth in welfare-relevant TFP from 1947-
2014 has been 37 log points (or 46%) instead of the measured 47 log points (or 60%) --
that is, to say, a 23 percent additional reduction in the growth rate.36
    Intuitively, welfare-based productivity increases less than TFP because, relative to
1947, preferences in 2014 favor low productivity growth sectors such as services (due to
either income effects or demand instability). This means that, at 1947 prices, households
require less income growth to be indifferent between their budget constraint in 1947 and
the one in 2014. This is because sectors with high income elasticities or that consumers
prefer in 2014, like services, were cheaper compared to manufacturing in 1947 than in
2014.37
    To sum up, structural transformation between caused by income effects or demand
instability reduced welfare, EV M , by roughly twice as much as structural transformation
caused by substitution effects. To understand why the necessary adjustment is roughly
twice as big using the second-order approximation in Proposition 4, see Appendix E. In
this appendix, we also provide some quantitative illustrations away from the two polar
extremes we discussed above. In Appendix E, we compute welfare changes for different
values of elasticities of substitution in consumption and production using Proposition
6. Recall that this does not require taking a stance on the income elasticities. We show
that welfare-relevant TFP is closer to measured TFP if the elasticity of substitution across
  36 The  gap between constant-initial-sales shares TFP and (chained-linked) aggregate TFP growth and the
gap between aggregate TFP and welfare-relevant TFP growth are driven by two forces. First, reallocation
of sales towards sectors with lower relative productivity growth rates (the standard Baumol's cost-disease
mechanism). Second, reallocation in sales towards sectors with lower intermediate input use (see equation
14). In our quantitative results, the second force accounts for roughly 18% of the gap between constant-
initial-sales shares TFP and aggregate TFP growth, and 35% of the gap between aggregate TFP growth and
welfare-relevant TFP growth.
   37 This intuition is flipped for compensating variation. As households become poorer in 2014 to be made

equally well-off as under their budget constraint in 1947, they favor goods which are relatively cheap
in 2014 such as manufacturing, so their income must be reduced by more. More generally, if structural
transformation is purely due to income effects or preference instability, then welfare-based productiv-
ity growth using CV at initial preferences is given by initial sale-share weighted productivity growth,
  t
 t1 =t0 i  N i,t0  log Ai,t (which corresponds to the Initial Shares line in Figure 2), so in this case the Baumol
adjustment is not welfare-relevant.


                                                       38
disaggregated industries (in consumption or production) is lower than one.


The Baumol effect in real consumption. So far in this application we have examined
aggregate productivity. We now show that similar conclusions apply if we measure wel-
fare changes using data on consumer prices and budget shares across goods in the US
between 1947 and 2019.
    Specifically, we measure the change in microeconomic welfare using Lemma 1 under
alternative assumptions about income and substitution elasticities. We apply this for-
mula statically and calculate welfare changes between two time periods taking as given
changes in prices and nominal expenditures. Under the assumptions of Proposition 8,
these static numbers also represent the change in macroeconomic welfare in a dynamic
model between two steady-states.
    If changes in budget shares are driven by substitution effects only, then welfare changes
are equal to growth in real consumption per capita. If changes in budget shares are driven
by income effects and demand instability only, then welfare changes between any year
and 2019 are given by changes in nominal expenditures deflated by a price index using
2019 budget shares.
    Figure 3 shows that for comparisons that are close to 2019, the change in welfare is
not very sensitive to the assumptions on demand instability and income effects versus
substitution effects because, at high frequency, the shocks are small and the sales shares
at our level of aggregation (66 goods and services) are stable. On the other hand, for
longer time periods, welfare growth is smaller if changes in budget shares took place
due to income effects (or demand instability) rather than substitution effects. That is,
comparing 1947 and 2019, the change in welfare per capita is 145 log points if preferences
are homothetic and stable, but it is only 126 log points if changes in budget shares were
entirely due to demand shocks and income effects. As before, structural transformation in
consumption caused by demand shocks and income effects is roughly twice as important
for welfare as structural transformation caused by substitution effects.


5.2   Aggregation Bias with Firm-Level Shocks
In the previous application, we considered a long-run industry-level application. Since
industry-level sales shares are relatively stable over short-horizons, given industry-level
data, biases in real GDP and consumption are likely to be modest at high frequency. How-
ever, this does not mean that these biases are necessarily absent from short-run data.
    Whereas industry sales shares are stable at high frequency, firm or product-level sales


                                             39
                   1.8


                   1.6                                  Initial Shares
                                                        Welfare with only substitution effect
                                                        Welfare with only income effect
                   1.4


                   1.2


                    1


                   0.8


                   0.6


                   0.4


                   0.2


                    0
                    1940   1950   1960   1970   1980   1990         2000          2010          2020




Figure 3: Change in welfare per capita from 1947 to 2019 using Personal Consumption
Expenditure (PCE) prices and expenditures for 66 goods and services from the BEA. The
blue line uses initial shares (in each year t between 1947 and 2019) to calculate the defla-
tor. The red and yellow line measure the increase in welfare between t and 2019 under
alternative assumptions about income and substitution elasticities. The red line assumes
that budget shares change only due to substitution effects (welfare is equal to measured
chained-real consumption). The yellow line assumes that budget shares change only due
to income effects (or demand instability).


shares are highly volatile even over the very short-run. If firms' or products' supply and
demand shocks are correlated, then measured industry-level output is biased relative to
what is relevant for welfare, even if all firms are infinitesimal within their industry.
    In work in progress, we use product-level data on non-durable consumer goods to
quantify the gap between welfare-relevant and chained price indices. We observe annual
product-level prices and expenditures for 14 years. We first compute a chained-weighted
price deflator (which moves very closely to a Sato-Vartia price index). We then calculate
a welfare-relevant deflator following Lemma 1, based on welfare-relevant budget shares,
computed by feeding in changes in product-level prices into equation (7). At an annual
frequency, and using an elasticity of substitution between products in final demand equal
to 5, the welfare-relevant price deflator increases by 0.5% relative to the chained-weighted
deflator. This difference grows as we consider a longer horizon: it is around 4% over the
whole sample of 14 years. Welfare changes are lower than chained-weighted real con-
sumption because the covariance between price shocks and demand shocks is positive,

                                                40
and grows at lower frequencies. We will include additional details about these empirical
results in the next version of this paper, pending approval from the data provider.
   In what follows we show that the biases in industry-level data are not diversified
away as we aggregate, even if all industries are infinitesimal in the aggregate economy.
We introduce a specification of our model with an explicit industrial structure.

Definition 6 (Industrial Structure). An economy has an industry structure if the following
conditions hold:

   i. Each firm i belongs to one, and only one, industry I . Firms in the same industry
      share the same constant-returns-to-scale production function up to a firm-specific
      Hicks-neutral productivity shifter Ai .

  ii. The representative household has homothetic preferences over industry-level goods,
      where the I th industry-level consumption aggregator is

                                                                    I
                                                            I -1    I -1

                                                 b
                                                 ¯ iI xi c  I
                                        cI =               i               ,
                                                 i I

      where ci are consumption goods purchased by the household from firm i in industry
      I and xi are firm-level demand shocks.

  iii. Inputs purchased by any firm j from firms i in industry I are aggregated according
       to                                                            I
                                                           I -1    I - 1

                                                  s
                                                           I
                                        m jI =    ¯iI m ji                 ,
                                                  i I

                                                                 ¯iI is a constant.
      where m ji are inputs purchased by firm j from firm i, and s

   Input-output and production network models that are disciplined by industry-level
data typically have an industry structure of the form defined above. For such economies,
we can characterize the bias in real GDP relative to welfare easily.

Proposition 9 (Aggregation Bias). For models with an industry structure, in response to firm-
level supply shocks  log A and demand shocks  log x, we have

                                          1
                                          2 i
                log EV M   log Y +             b I Covb( I ) ( log x(i) ,  log A(i) ) + ,
                                             I

where b I is industry I's share of final demand and b( I ) is a vector whose ith element is bi /b I if i
belongs to industry I and zero otherwise. The scalar  is the gap between real GDP and welfare

                                                   41
in a version of the model with only industry-level shocks.38

   In words, Proposition 9 implies that if firms' productivity and demand shocks are
correlated with each other (but not necessarily across firms), then there is a gap between
real GDP and welfare that does not appear in an industry-level specification of the model.
Furthermore, this bias is, to a second-order, additive. That is, the overall bias is the sum of
the industry-level bias (that we studied in the previous section) plus the additional bias
driven by within-industry covariance of supply and demand shocks. Note that if supply
and demand shocks at the firm level are correlated and persistent, then the bias grows
over time, as in our product-level data discussed above.


5.3    Case Study: the Covid-19 Recession
Our final application concerns the Covid-19 recession, and asks how real GDP, microe-
conomic welfare, and macroeconomic welfare were affected. The Covid-19 recession is
a good case study since sectoral expenditure shares changed dramatically during this
time, these changes were not explainable via changes in observed prices alone, and the
movements in demand curves were correlated with movements in supply curves. These
are exactly the conditions under which micro welfare, macro welfare, and real GDP can
diverge from each other.
    Cavallo (2020) argues that, during this episode, the fact that price indices were not
being chained at high enough frequency led to "biases" in official measures of inflation.
However, since final demand was unstable during this period, chaining is not theoret-
ically justified. As we have argued, chaining is only theoretically valid if expenditure-
switching is caused by substitution effects, and not if expenditure-switching is caused by
shocks to demand. Furthermore, if changes in prices are themselves caused by changes
in demand (due to decreasing returns to scale), then microeconomic welfare and macroe-
conomic welfare changes are different.
    In this section, we do not attempt to measure the welfare costs of Covid-19 itself. This
is because households do not make choices over whether or not they live in a world with
Covid-19. Therefore, their preferences about Covid-19 itself are not revealed by their
  38 More   specifically,
                                                                                 f
                  1                          b I                              I
                 =   Eb I ( log AiI )                  + Es I ( log AiI )               log x j ,
                  2 i I j J                 log x j                          log x j

        f
where  I =  I - b I is the sales share of industry I excluding sales to the household. In words,  is
proportional to the product of changes in industry-level sales shares caused by demand shocks times the
industry-level (sales-weighted) productivity shocks.

                                                  42
choices. Instead, we ask a more modest question: how does the household value changes
in prices (micro welfare) and changes in production (macro welfare), holding fixed the
presence of Covid-19.
    To study this episode, we use a modified version of the quantitative model introduced
in Section 4. Since we are interested in a short-run application, we assume that factor
markets are segmented by industry, so that labor and capital in each industry is inelasti-
cally supplied. We calibrate share parameters to match the 71 industry input-output table
in 2018, and consider a range of elasticities of substitution. Following Baqaee and Farhi
(2020), we model the Covid-19 recession as a combination of negative sectoral employ-
ment shocks and sectoral taste shifters. We hit the economy with a vector of primitive sup-
ply and demand shocks calibrated to match the reductions in employment and personal
consumption expenditures by industry.39 The reductions in sectoral employment are cal-
ibrated to match peak-to-trough reductions in hours worked by sector from January, 2020
to May, 2020. The primitive demand shifters are calibrated to match the observed peak-
to-trough reductions in personal consumption expenditures by sector from January, 2020
to May, 2020 (conditional on the supply shocks and the elasticities of substitution).
    We consider three different calibrations informed by empirical estimates from Ata-
lay (2017) and Boehm et al. (2015): high complementarities, medium complementarities,
and no complementarities (Cobb-Douglas). The high complementarity scenario sets the
elasticity of substitution across consumption goods to be 0.7, the one across intermedi-
ates to be 0.01, across value-added and materials to be 0.3, and the one between labor
and capital to be 0.2. The medium complementarities case sets the elasticity of substitu-
tion across consumption goods to be 0.95, the one across intermediates to be 0.01, across
value-added and materials to be 0.5, and the one between labor and capital to be 0.5. The
Cobb-Douglas calibration sets all elasticities of substitution equal to unity.
    Table 1 displays welfare changes between January 2020 and May 2020 in the calibrated
model. We report separately micro and macro welfare based on pre-Covid (initial) and
post-Covid (final) preferences. Recall that micro and macro welfare are not equal in this
economy because the PPF is nonlinear. For comparison, we also report the change in real
consumption assuming supply and demand shocks arrive simultaneously.
    Table 1 shows that the drop in micro welfare is larger under post-Covid preferences
than under pre-Covid preferences. This is because, as shown in our analytic example 4,
demand shocks reduce welfare in the presence of decreasing returns to scale. Intuitively,
  39 Changes in labor by sector and personal consumption expenditures, used to calibrate supply and de-
mand shocks, are taken from Baqaee and Farhi (2020). For related analysis of Covid-19 induced supply
shocks, see e.g. Bonadio et al. (2020) and Barrot et al. (2020). For related analysis of Covid-19 induced
demand shocks, see Cakmakli et al. (2020).


                                                   43
Table 1: The change in micro and macro welfare with pre-Covid and post-Covid prefer-
ences given the supply and demand shocks between February 2020 to May 2020. Chained
real consumption is computed assuming supply and demand shocks arrive simultane-
ously.

    Elasticities                      High compl.     Medium compl.      Cobb-Douglas
    Micro pre-Covid preferences          -11.7%             -9.1%             -8.7%
    Micro post-Covid preferences         -13.2%            -12.3%            -10.9%

    Macro pre-Covid preferences          -16.2%            -12.5%            -10.8%
    Macro post-Covid preferences         -10.1%             -9.4%             -9.0%

    Chained real consumption             -12.1%            -10.6%            -9.8%


demand shocks increase the price of goods that consumers value more over time and this
causes micro welfare to drop since whatever households value becomes more expensive
relative to the past.
    This pattern is exactly reversed for macro welfare. Macro welfare is higher at post-
Covid preferences than at pre-Covid preferences. This is because the negative supply
shocks were biggest in those sectors where demand also fell more drastically (e.g. trans-
portation and energy). Hence, the reduction in welfare is smaller with post-Covid pref-
erences because those goods that the economy is less capable of producing are less de-
sirable. This illustrates that micro and macro welfare answer different questions, and the
answers to these questions can be quantitatively very different. Furthermore, comparing
columns of Table 1 shows that the magnitude of these differences depend on the details
of the production structure like the extent of complementarities in production. As we
raise the elasticities of substitution in production closer to unity (Cobb-Douglas), the dif-
ferences between macro and micro notions become less dramatic. This is because the PPF
is become less curves.
    In Table 1, we also compute real consumption assuming supply and demand shocks
arrive simultaneously and linearly over time. Interestingly, chained real consumption in
Table 1 does not exactly measure any of the different welfare notions. This is because sup-
ply and demand shocks are not orthogonal along the path. In fact, if we change the order
or path of supply and demand shocks, real consumption changes value (even though the
initial and final allocation are not changing). For example, if the supply shocks arrive
before the demand shocks, then real consumption equals macro welfare changes at pre-
Covid preferences. On the other hand, if demand shocks arrive before the supply shocks,
then real consumption equals macro welfare changes at post-Covid preferences.


                                             44
    Hence, if the supply and demand shocks do not disappear in exactly the same way
as they arrived, measured real consumption (or GDP) after the recovery can be higher or
lower than it was before the crisis, even if the economy returns exactly to its pre-Covid
allocation. For example, if in the downturn, demand shocks arrive before supply shocks
and, in the recovery, demand shocks disappear before the supply shocks, then real con-
sumption can be as much as 6% higher when comparing pre-shock real consumption
to post-recovery real consumption. This is despite the fact that every price and quan-
tity is the same when comparing the pre-shock allocation to the post-recovery allocation.
Hence, during episodes where final demand is unstable, real GDP and consumption are
unreliable guides for measuring output or welfare, even if we chain in continuous time.40


6       Extensions
In this section, we briefly summarize how our theoretical results can be extended in dif-
ferent ways.


Extensive margin. If preference instability or non-homotheticity causes a consumer to
begin purchasing a good in t1 that she did not consume in t0 (or to stop consuming a
good that she was previously consuming), then our global and local formulas apply to
that consumer without change.
   To make this more explicit, consider a consumer whose preferences are represented
by the utility function
                                                                              
                                                       x           -1         -1
                                         
                                   u ( c; x ) =            c(z)         dz         ,                    (18)
                                                   0

where goods are indexed by z  [0, 1] but the consumer only values goods z  [0, x  ].
In this situation, x  is a preference parameter, where goods z  ( x  , 1] are available at a
finite price, but the consumer chooses not to consume them.
    Consider how the welfare of the consumer changes accounting for the fact that x  can
change between t0 and t1 . The following is an application of Lemma 1.

    40 This
          is related to a problem known as "chain drift" bias in national accounting. Chain drift occurs when
a chained index registers an overall change between t0 and t1 even though all prices and quantities in t0
and t1 are identical. This is a specific manifestation of path dependence and, by the gradient theorem for
line integrals, it must be driven by either demand instability, income effects, or approximation errors due
to discreteness. Chain drift bias can thus appear when movements in prices and quantities are oscillatory,
where changes that take place over some periods are reversed in subsequent periods. Welfare changes do
not exhibit chain drift since, by definition, they depend only on t0 and t1 variables.




                                                       45
Proposition 10 (New Goods Due to Taste Shocks). Consider a household with preferences
defined by (18). Up to a second-order approximation,

                                 1
               log EV m   log Y + b( x  ) x  [Eb [ log p] -  log p( x  )] .
                                 2

    In words, the gap between welfare and real GDP depends on product of sales shares
at the cut-off b( x  ), the change in the cut-off  x  , and the difference between inflation at
the cut-off versus average inflation. If new goods are added  x  > 0, and the new goods
experienced lower than average inflation, then welfare is higher than what is detected by
real GDP. However, this adjustment is second-order (since it involves products of ), and
to a first-order, real GDP is equal to the true change in the cost of living.
    It is interesting to contrast Proposition 10 to the well-known new-goods adjustment
due to Feenstra (1994), which, to a first-order approximation, is

                                                1
                       log EV m =  log Y +         log           b(z)dz ,                 (19)
                                               1-            C

where C is the set of continuing goods and the integral is their share in expenditures. The
difference in these results is due to a difference in interpretation. Under the interpretation
in Proposition 10, the change in the extensive margin is caused by a change in tastes --
that is, the goods were previously available to the consumer in the initial period but the
consumer chose not to consume them (or goods are available in the final period, but the
consumer chose to stop consuming them). Therefore, when we calculate welfare changes,
we simply need to adjust the price index so that it accounts for the price of goods that the
consumer is choosing to consume in the final period. On the other hand, under (19), when
we compute the change in welfare, we assume that the consumer is unable to consume the
new goods in the past or can no longer consume the disappearing goods in the present.
That is, under (19), when goods are not consumed they are valued by the consumer but
the implicit price is infinity.
    Therefore, if a good is available in t0 and t1 , but the consumer does not consume the
good in period t0 and does consume the good in t1 (due to, for example, advertising),
an application of (19) is not innocuous. If the change in consumer behavior is due to a
change in tastes, as opposed to a change in availability, then no adjustment is necessary
to a first-order, and to a second-order, the relevant adjustment is the one in Proposition
10.




                                              46
Endogenous separable arguments in the utility function (e.g. leisure or home-production).
If there are goods in the utility function that are endogenously chosen but not measured,
then an all-encompassing welfare measure must impute shadow prices for these goods
(see Jones and Klenow, 2016). For example, suppose that leisure is the non-measured
argument in the utility function. If these are separable from market goods, so that pref-
erences over c are stable when the quantity of leisure changes, then our baseline results
apply to the market-good component of welfare, even if leisure changes.

Endogenous non-separable arguments in the utility function (e.g. advertising). If the
parameters of the utility function x are not separable from goods c, then our welfare ques-
tions ask how changes in constraints over c affect welfare holding fixed x. That is, we do
not attempt to answer how a change in x itself affects welfare, which may or may not be
a question that can be answered. A salient example of x can be advertising, which can
change households ranking over different consumption bundles, and is obviously non-
separable from market goods. In principle, advertising may have value to the consumer
-- that is, the consumer can have preferences over the amount of advertising they wish
to be exposed to. If advertising is informative, the consumer's utility may be increasing
in advertising, and equally plausibly, if advertising is manipulative, then utility may be
decreasing in advertising. We do not attempt to answer the question of how much the
household values advertising, instead, we hold fixed the amount of advertising41 (or in-
deed the weather, chemicals in the brain, and whatever else that affects valuations over
consumption bundles), and measure how changes in the availability of market goods af-
fects welfare.
    Interestingly, unlike random fluctuations in tastes, advertising is a purposeful eco-
nomic activity, and therefore, models of advertising and consumer acquisition, for exam-
ple Arkolakis (2016), explicitly predict that changes in tastes induced by advertising will
be correlated with changes in physical productivity, whereby more productive firms will
expend more resources on advertising. This positive correlation means that we should
expect real GDP or real consumption measures to be systematically biased in situations
where advertising plays a large role in consumption choices.

Beyond CES. Our results in Section 4 can be generalized beyond CES functional forms
relatively easily. In Appendix F, we discuss how Proposition 6 must be adjusted to allow
for non-CES production and utility functions.
  41 In
      this sense, our approach is related to Dixit and Norman (1978), who study the welfare implications
of advertising at either pre- or post-advertising preferences. As argued by Fisher and McGowan (1979), this
does not answer the question of what is the value of advertisement taking into account the change in tastes.

                                                    47
Heterogeneous agents. Our microeconomic welfare results can be applied to individual
households in economies without representative agents. Furthermore, if one commits to a
particular social welfare function (SWF), we can extend the results to calculate the change
in social welfare and to characterize the gap between social welfare and real GDP. With
heterogeneous preferences, there are other reasons why social welfare and real GDP do
not coincide in addition to the ones that we have focused on. For example, in Appendix
G we consider a utilitarian SWF and show that there is a gap between social welfare and
changes in real GDP even if preferences at the individual level are stable and homothetic.


7    Conclusion
In this paper, we characterize welfare and the gap between standard measures of con-
sumption and welfare that appear when preferences are non-homothetic or unstable. We
do this in both partial and general equilibrium. We show that the gap between welfare
and real consumption can be large over long horizons relevant for long-run growth as
well as for short-horizons, if expenditure shares at the firm and product-level change
rapidly, and if demand-driven changes in expenditures covary with prices.
    Although our motivation and applications have focused on shocks across time, our
results can also be applied to compare welfare across locations in space (see e.g. Deaton,
2003, and Argente et al., 2020). Variation in tastes and income effects are likely to be even
more significant across space than across time. To measure the difference in micro welfare
between two countries, we need to compute how much income consumers of country A
must be given in country B so that the resulting budget in country B makes them as well
off as they are given their budget in country A. This can be calculated using equation
(5), where the welfare-relevant budget shares (as a function of prices) use country A's
demand.
    The distinction between macroeconomic and microeconomic notions of welfare are
also relevant in a spatial context. Comparing budget constraints in one location to another
may be misleading as a way to compare two economies. This is because, even if PPFs in
both locations are exactly the same, the relative price of goods households value more in
one location will be lower in the other location. Applying our results in a spatial context
is an interesting avenue for future work.




                                             48
References
Acemoglu, D., V. M. Carvalho, A. Ozdaglar, and A. Tahbaz-Salehi (2012). The network origins of aggregate
  fluctuations. Econometrica 80(5), 1977­2016.
Acemoglu, D. and V. Guerrieri (2008). Capital deepening and nonbalanced economic growth. Journal of
  political Economy 116(3), 467­498.
Aghion, P., A. Bergeaud, T. Boppart, P. J. Klenow, and H. Li (2019). Missing growth from creative destruc-
  tion. American Economic Review 109(8), 2795­2822.
Alder, S., T. Boppart, and A. Müller (2019). A theory of structural change that can fit the data.
Argente, D. O., C.-T. Hsieh, and M. Lee (2020, September). Measuring the cost of living in mexico and the
  us. Working Paper 27806, National Bureau of Economic Research.
Arkolakis, C. (2016). A unified theory of firm selection and growth. The Quarterly Journal of Economics 131(1),
  89­155.
Atalay, E. (2017). How important are sectoral shocks? American Economic Journal: Macroeconomics (Forth-
  coming).
Atkin, D., B. Faber, T. Fally, and M. Gonzalez-Navarro (2020, March). Measuring Welfare and Inequality
  with Incomplete Price Information. NBER Working Papers 26890, National Bureau of Economic Re-
  search, Inc.
Auer, R., A. Burstein, S. Lein, and J. Vogel (2021). Unequal expenditure switching: Evidence from switzer-
  land.
Balk, B. M. (1989). Changing consumer preferences and the cost-of-living index: theory and nonparametric
  expressions. Journal of Economics 50(2), 157­169.
Baqaee, D. and E. Farhi (2020). Supply and demand in disaggregated keynesian economies with an appli-
  cation to the covid-19 crisis. Technical report, National Bureau of Economic Research.
Baqaee, D. R. and E. Farhi (2019a). Productivity and misallocation in general equilibrium. The Quarterly
  Journal of Economics 135(1), 105­163.
Baqaee, D. R. and E. Farhi (2019b). The Macroeconomic Impact of Microeconomic Shocks: Beyond Hulten's
  Theorem. Econometrica 87(4), 1155­1203.
Barrot, J.-N., B. Grassi, and J. Sauvagnat (2020). Sectoral effects of social distancing. Available at SSRN.
Basu, S., L. Pascali, F. Schiantarelli, and L. Serven (2012). Productivity and the welfare of nations. Technical
  report, National Bureau of Economic Research.
Baumol, W. J. (1967). Macroeconomics of unbalanced growth: the anatomy of urban crisis. The American
  economic review, 415­426.
Boehm, C., A. Flaaen, and N. Pandalai-Nayar (2015). Input linkages and the transmission of shocks: Firm-
                                    ¯
  level evidence from the 2011 tohoku       earthquake.
Bonadio, B., Z. Huo, A. A. Levchenko, and N. Pandalai-Nayar (2020). Global supply chains in the pandemic.
  Technical report.
Boppart, T. (2014). Structural change and the kaldor facts in a growth model with relative price effects and
  non-gorman preferences. Econometrica 82(6), 2167­2196.
Boppart, T., M. Carlsson, M. Kondziella, and M. Peters (2021). Micro PPI-based real output forensics.
Buera, F. J. and J. P. Kaboski (2009, 04-05). Can Traditional Theories of Structural Change Fit The Data?
  Journal of the European Economic Association 7(2-3), 469­477.
Buera, F. J., J. P. Kaboski, and R. Rogerson (2015). Skill biased structural change. Technical report, National
  Bureau of Economic Research.


                                                      49
Cakmakli, C., S. Demiralp, S. Kalemli-Ozcan, S. Yesiltas, and M. A. Yildirim (2020, May). Covid-19 and
   emerging markets: An epidemiological multi-sector model for a small open economy with an application
   to turkey. Working Paper 27191, National Bureau of Economic Research.
Carvalho, V. and X. Gabaix (2013). The Great Diversification and its undoing. The American Economic
   Review 103(5), 1697­1727.
Carvalho, V. M. and A. Tahbaz-Salehi (2018). Production networks: A primer.
Cavallo, A. (2020). Inflation with covid consumption baskets. Technical report, National Bureau of Eco-
   nomic Research.
Caves, D. W., L. R. Christensen, and W. E. Diewert (1982). The economic theory of index numbers and the
   measurement of input, output, and productivity. Econometrica: Journal of the Econometric Society, 1393­
   1414.
Comin, D. A., D. Lashkari, and M. Mestieri (2015). Structural change with long-run income and price
   effects. Technical report, National Bureau of Economic Research.
Cravino, J., A. A. Levchenko, and M. Rojas (2019, September). Population Aging and Structural Transfor-
   mation. NBER Working Papers 26327, National Bureau of Economic Research, Inc.
Deaton, A. (2003). Adjusted indian poverty estimates for 1999-2000. Economic and political Weekly, 322­326.
Dixit, A. and V. Norman (1978). Advertising and welfare. The Bell Journal of Economics, 1­17.
Domar, E. D. (1961). On the measurement of technological change. The Economic Journal 71(284), 709­729.
Fajgelbaum, P. D. and A. K. Khandelwal (2016). Measuring the unequal gains from trade. The Quarterly
   Journal of Economics 131(3), 1113­1180.
Fally, T. (2020). Integrability, generalized separability, and a new class of demand systems.
Feenstra, R. C. (1994). New product varieties and the measurement of international prices. The American
   Economic Review, 157­177.
Feenstra, R. C., H. Ma, D. P. Rao, et al. (2009). Consistent comparisons of real incomes across time and
   space. Macroeconomic Dynamics 13(S2), 169­93.
Feenstra, R. C. and M. B. Reinsdorf (2007, October). Should Exact Index Numbers Have Standard Errors?
   Theory and Application to Asian Growth. In Hard-to-Measure Goods and Services: Essays in Honor of Zvi
   Griliches, NBER Chapters, pp. 483­513. National Bureau of Economic Research, Inc.
Fisher, F. M. and J. J. McGowan (1979, Autumn). Advertising and Welfare: Comment. Bell Journal of Eco-
   nomics 10(2), 726­727.
Fisher, F. M. and K. Shell (1968). Taste and quality change in the pure theory of the true cost of living index.
   Chicago: Aldine Publishing.
Gabaix, X. (2011). The granular origins of aggregate fluctuations. Econometrica 79(3), 733­772.
Hamilton, B. W. (2001, June). Using engel's law to estimate cpi bias. American Economic Review 91(3), 619­
   630.
Hausman, J. (1981). Exact consumer's surplus and deadweight loss. American Economic Review 71(4), 662­
   76.
Hausman, J. A. (1996). Valuation of new goods under perfect and imperfect competition. In The economics
   of new goods, pp. 207­248. University of Chicago Press.
Herrendorf, B., R. Rogerson, and A. Valentinyi (2013). Two perspectives on preferences and structural
   transformation. American Economic Review 103(7), 2752­89.
Hicks, J. R. (1940). The valuation of the social income. Economica 7(26), 105­124.
Hulten, C. R. (1973). Divisia index numbers. Econometrica: Journal of the Econometric Society, 1017­1025.



                                                      50
Hulten, C. R. (1978). Growth accounting with intermediate inputs. The Review of Economic Studies, 511­518.
Jones, C. I. and P. J. Klenow (2016). Beyond gdp? welfare across countries and time. American Economic
   Review 106(9), 2426­57.
Jorgenson, D. W., M. S. Ho, K. J. Stiroh, et al. (2005). productivity, volume 3: information technology and
   the american growth resurgence. MIT Press Books 3.
Kongsamut, P., S. Rebelo, and D. Xie (2001). Beyond Balanced Growth. Review of Economic Studies 68(4),
   869­882.
Martin, R. S. (2020). Revisiting taste change in cost-of-living measurement. Technical report, US Department
   of Labor, US Bureau of Labor Statistics, Office of Prices and Living Conditions.
McKenzie, G. W. and I. F. Pearce (1982). Welfare measurement: a synthesis. The American Economic Re-
   view 72(4), 669­682.
Ngai, L. R. and C. A. Pissarides (2007). Structural change in a multisector model of growth. American
   economic review 97(1), 429­443.
Nordhaus, W. D. et al. (2008). Baumol's diseases: A macroeconomic perspective. The BE Journal of Macroe-
   conomics 8(1), 1­39.
Redding, S. J. and D. E. Weinstein (2020). Measuring aggregate price indices with taste shocks: Theory and
   evidence for ces preferences. The Quarterly Journal of Economics 135(1), 503­560.
Samuelson, P. A. and S. Swamy (1974). Invariant economic index numbers and canonical duality: survey
   and synthesis. The American Economic Review 64(4), 566­593.
Syverson, C. (2017). Challenges to mismeasurement explanations for the us productivity slowdown. Journal
   of Economic Perspectives 31(2), 165­86.




                                                    51
Appendix A                 Proofs
Proof of Lemma 1. By definition,

                               e ( pt0 , v( pt1 , It1 ; xt1 ); xt1 )
                  EV m = log
                               e ( pt0 , v( pt0 , It0 ; xt1 ); xt1 )
                               e ( pt0 , v( pt1 , It1 ; xt1 ); xt1 ) e ( pt1 , v( pt1 , It1 ; xt1 ); xt1 )
                         = log
                               e ( pt0 , v( pt0 , It0 ; xt1 ); xt1 ) e ( pt1 , v( pt1 , It1 ; xt1 ); xt1 )
                               e ( pt0 , v( pt1 , It1 ; xt1 ); xt1 )                 It1
                         = log                                                                             .
                                               It0                   e ( pt1 , v( pt1 , It1 ; xt1 ); xt1 )

To finish, rewrite

              e ( pt0 , v( pt1 , It1 ; xt1 ); xt1 )         t1    log e( p, v( pt1 , It1 ; xt1 ); xt1 ) d log p
        log                                         =-                                                          dt,
              e ( pt1 , v( pt1 , It1 ; xt1 ); xt1 )        t0                 log p                        dt

and use the Shephard's lemma to express the price elasticity of the expenditure function
in terms of budget shares. If the path of prices between t0 and t1 is not differentiable, then
construct a new a modified path of prices that is differentiable, and apply the integral to
this modified path. Since the integral is path independent, it only depends on pt0 and pt1 .
Therefore any path that connects pt0 and pt1 gives the same integral.

Proof of Proposition 1. If the path of prices is continuously differentiable, we can combine
Lemma 1 with the definition of real consumption.

Proof of Proposition 2. For real consumption, differentiate real consumption

                                      t1                                                   d log pi
                     log Y =
                                    t0
                                           d log I (t) -    bi ( p(t), u(t); x(t))            dt
                                                                                                    dt
                                                           i N

twice with respect to t1 and evaluate the derivative at t1 = t0 . This yields the desired
expression.
   By Lemma 1:

                                             t1        log e( p, v( pt1 , xt1 ), xt1 ) d log p
                  EV =  log I -                   
                                            t0 i  N             log p                  d log t
                                                                                               d log t




                                                                52
Differentiate EV twice with respect to t1 and evaluate the derivative at t1 = t0

 dEV    d log I       log e( p, v( pt1 , xt1 ), xt1 ) d log pi
      =         -                                              -
  dt1      dt    i N
                               log pi                 d log t
            t1                 2 log e( p, v( pt1 , xt1 ), xt1 )
      -          
           t0 i  N
                     d log v
                                     log u log pi
                                                                 d log pi

            t1                 2 log e( p, v( pt1 , xt1 ), xt1 )
      -          
           t0 i  N
                     d log x
                                     log x  log pi
                                                                 d log pi

d2 EV         d2 log p          2 log e( p, v( pt1 , xt1 ), xt1 )
      = -  bi
              d log t2 i     
                       -                                          d log pi d log p j
 dt21     i N             N j N
                                      log pi  log p j
                           2 log e( p, v( pt1 , xt1 ), xt1 )                        log e( p, v( pt1 , xt1 ), xt1 )
      -2         d log v
                                 log pi  log u
                                                             d log pi - 2  d log x
                                                                                          log  p i  log  x
                                                                                                                    d log pi
           i N                                                            i N
                          bi                            d2 log p
       =-               log pi
                               d log pi d log p j -  bi
                                                        d log t2
            i N j N                                 i N
                             b                                         b
      -2    d log v  log
                       i
                         u
                           d log pi - 2  d log x    i
                                                  log x
                                                        d log pi
           i N                                     i N

                              bi                          bi               bi                  d2 log p
       =-                   log p j
                                    d log p j + d log v
                                                         log u
                                                               + d log x
                                                                          log x
                                                                                d log pi -  bi
                                                                                               d log t2
            i N      j N                                                                   i N
                           b                                       b
      -    d log v  log
                      i
                        u
                          d log pi -  d log x    i
                                               log x
                                                     d log pi
          i N                                  i N
                                             2
                                            d log    p                      b                            b
       =-     dbi d log pi -  bi d log t2                -    d log v  log
                                                                         i
                                                                           u
                                                                             d log pi -  d log x    i
                                                                                                  log x
                                                                                                        d log pi
            i N                      i N                     i N                              i N

The first two terms are equal to the second-order expansion of  log Y , and the remaining
terms are the bias.

Proof of Proposition 3. By Proposition 2, we have

                                                                           1
                         log Y   log I -  bi  log pi -
                                                                           2
                                                                               bi  log pi .
                                                     i                       i

Substitute (6) in place of b to get the desired expression. For the bias, note that Proposi-
tion 1 implies that

                                   1         biH
                     EV -  log Y  -  bi -             log p j  log pi
                                   2 i    j
                                             log p j

where b H is the Hicksian budget share (holding fixed utility and demand shifters). Using

                                                             53
                                                       biH                                                       biH
(6) in place of b above and the fact that              log pi       = (1 - 0 )bi (1 - bi ) for i = j and         log p j   =
0 bi b j for i = j, yields the following

                          1
                          2 i                                             bj  log p j
 log EV -  log Y  -            (  i - 1 ) bi            d log I -                               + bi  log xi  log pi ,
                             N                                           j N


which can be rearranged to give the desired expression.

Proof of Lemma 2. Setting nominal GDP to be the numeraire, we can write

                                     t1
                  log Y = -               b d log p
                                    t0
                                     t1
                         =-               b -d log A -  F d log L +  F d log 
                                    t0
                               t1                              t1
                         =          b d log A -                     b  F [d log  - d log L]
                              t0                           t0
                               t1                         t1                       t1
                         =           d log A +                   d log L -              d log 
                              t0                         t0                       t0
                               t1                         t1
                         =           d log A +                   d log L
                              t0                         t0


where the second line uses Proposition 6, and we use the fact that Using  = b  ,
 = b  F , and b  F d log  =  d log  = 0 because the factor shares always sum to one:
 f  F  f = 1.

Proof of Proposition 4. Recall that the macro equivalent variation at final preferences is de-
fined by EV M = , where

                             V A t0 , e  L t0 ; x t1 = V ( A t1 , L t1 ; x t1 )

Denote by p ( A, L, x ) goods prices under technologies A, factor quantities L, and prefer-
ences x. Without loss of generality, we fix income at I . We have pt1  p ( At1 , Lt1 , xt1 )
and
                            v t1  v ( p t1 , I ; x t1 ) = V ( A t1 , L t1 ; x t1 ) .

Define a hypothetical economy with fictional households that have stable homothetic
preferences defined by the expenditure function eev ( p, u) = e ( p, vt1 ; xt1 ) vu
                                                                                  t
                                                                                    . Budget
                                                                                                            1
                                                                     eev ( p,u)     e ( p,v t1 ; x t1 )
shares of this fictional consumer are     ( p) biev      =              piGiven any tech- pi            .
nology vector, in this hypothetical economy we denote the Leontief inverse matrix by ev
and sales shares by ev . Given technologies At and factor quantities Lt , we denote prices

                                                        54
in this hypothetical economy by pev t . Changes in prices in this hypothetical economy sat-
isfy
                         d log pev = -ev d log A + evF d log ev ,                      (20)

where ev is the fictitious Leontief inverse. Note that p ( At1 , Lt1 , xt1 ) = pev ( At1 , Lt1 ) and
p At0 , e Lt0 , xt1 = pev At0 , e Lt0 , where we used the fact that V At0 , e Lt0 ; xt1 = vt1 .
We will use the property that, with constant returns to scale, homothetic preferences, and
constant income I ,
                                                 1
                                   pev ( A, aL) = pev ( A, L)
                                                 a
for every a > 0. Using the previous results,

                       V A t0 , e  L t0 ; x t1 = v p A t0 , e  L t0 , x t1 , I ; x t1
                                               = v pev At0 , e Lt0 , I ; xt1
                                               = v e- pev ( At0 , Lt0 ) , I ; xt1
                                               = v pev ( At0 , Lt0 ) , e I ; xt1 ,

where the last equality used the fact that the value function is homogeneous of degree 0
in prices and income. We thus have

                     v pev ( At0 , Lt0 ) , e I ; xt1 = v ( pev ( At1 , Lt1 ) , I ; xt1 ) ,

which can be re-expressed using the expenditure function as

                                               e ( pev ( At1 , Lt1 ) , vt1 ; xt1 )
                                EV M = log                                         .
                                               e ( pev ( At0 , Lt0 ) , vt1 ; xt1 )

This observation is a key step in the proof. Macro welfare changes can be re-expressed
as micro welfare changes given changes in equilibrium prices in a fictional economy with
preferences represented by eev ( p, u). As in the proof of Lemma 1, rewrite EV M as

                         t1            log e( p, vt1 )                         t1
           EV M = -
                        t0
                                          log  p i
                                                              ev
                                                       d log pi  =-                    
                                                                              t0 i  N + F
                                                                                            biev d log pi
                                                                                                        ev
                                                                                                           .
                              i N + F

Following the same steps as in the proof of Lemma 2 (for the hypothetical economy), we
obtain
                              t1                    t1
                   EV M =         i  ev
                                          log
                                    t0 i  N
                                        d     A i +     iev d log L f .
                                                                  t0   f F




                                                      55
   In general, macro and micro welfare changes are not the same when preferences are
unstable and nonhomothetic. However, when the PPF is linear, the following proposition
shows that they coincide.

Proposition 11 (Macro vs. Micro Welfare). Macro and micro welfare changes are equal (EV m =
EV M ) if preferences are stable and homothetic, or if factor income shares are constant (as in a one
factor economy).

Proof of Proposition 11. By the proof of Proposition 4, EV m = EV M if and only if pev ( At , Lt ) =
p( At , Lt , xt ). This condition is immediate if preferences are homothetic and stable. Con-
sider now the case in which preferences are non-homothetic and/or unstable but factor
income shares, , are constant. Then by Proposition 6, changes in prices in response to
changes in A, L, and x are given by the following differential equation:

                               d log p = -d log A -  F d log L.

Furthermore, note that changes in  are determined by changes in  since  = ( I - )-1 .
Since every i  N has constant returns to scale, changes in ij depend only on changes
in relative prices for every i  N . This means that changes in  only depend on changes
in relative prices, therefore changes in  depend only on changes in relative prices. Since
x and utility v do not appear in any of these expressions, this means that prices and
incomes p( A, L, x ) and I ( A, L, x ), relative to the numeraire, do not depend on x and v.
Thus, pev ( At , Lt ) = p( At , Lt , xt ).


Proof of Proposition 5. Differentiate real GDP,

                                        t1                      d log Ai
                           log Y =            i ( A(t); x(t))
                                       t0 i  N                     dt
                                                                         dt,


twice with respect to t1 and evaluate the derivative at t1 = t0 . This yields the desired
expression. Following similar steps as in the proof of Proposition 3,

                                                     ev
                                    1              i
                                    2 i           log A j  log A j  log Ai .
               EV M   log Y +              i -
                                       N       j N


The term in square brackets is the change in sales shares due to changes in utility and




                                                  56
demand shifters. This expression can be written as

                        1             i               log v i
     EV M   log Y +        
                        2 i N
                               log x
                                      log x
                                            +  log A
                                                      log A  log v
                                                                    log Ai .          (21)




Proof of Proposition 7. Normalize nominal GDP to one. Applying Proposition 6 to a one-
factor model yields
                                   d log p = -d log A,

so that relative prices do not respond to changes in demand or income.
    To solve for  log Y , use Proposition 5 in combination with the expression for d log p
and d in Proposition 6 in the case of one factor. To solve for EV M , by Proposition 11,
EV M = EV m . Solve for EV m -  log Y by plugging the expression for d log p into Propo-
sition 2 and noting that b = (0) .

Proof of Proposition 6. We normalize nominal GDP to be the numeraire. Then Shephard's
lemma implies that, for each i  N

                           d log pi = -d log Ai +  ij d log p j .
                                                   j


Furthermore, for i  F
                              d log pi = -d log Ai + d log i .

Combining these yields the desired expression for changes in prices

                            d log p = -d log A +  F d log .

To get changes in sales shares, note that

                                    =b
                                  d = d(b )
                                      = b d + db 




                                            57
                       ij d log ij = (1 - i )ij (d log p j -  ik d log pk )
                                                                          k
                                    dij = (1 - i )Cov(i) (d log p, I( j) )

                            dij  jk = (1 - i )Cov(i) (d log p, I( j) ) jk
                            j

                                         = (1 - i )  Cov(i) (d log p,  jk I( j) )
                                                      j

                                [d]ik = (1 - i )Cov(i) (d log p, (k) )

Meanwhile


     d log bi = (1 - 0 )        d log pi -  bi d log pi        + ( i - 1)d log Y + d log xi
                                           i

              = (1 - 0 )Cov(0) d log p, I(i) + Cov(0) , I(i) d log Y + Cov(0) d log x, I(i)

 dbi ik = Cov(0)            (1 - 0 )d log p + d log Y + d log x, (k)
 i

Hence,

                                               d =  d + db 

can be written as

dk =      i (1 - i )Cov(i) (d log p, (k) ) + Cov(0)                   , (k) d log Y + Cov(0) d log x, (k) .
          i




Proof of Proposition 8. Consider intertemporal preferences

                                                               
                                        V (A, L, K0 ) =     s-t u(Cs ).
                                                           s=t

Comparing economies t and t , macro EV solves the following equation:

                                                                  
V (A, L, K0 ) =        s-t u(Cs (A, L, K0 )) =                     s-t u(Cs    A , L , K0 ) = V ( A , L , K0 ) .
                      s=t                                       s=t




                                                          58
Since the economy t is in steady-state, we are looking for

                   
                                                         1
                   s-t u (Cs (A, L, K0 )) = 1 -  u               C A , L , K0      .
                  s=t

Furthermore, since (A, L, K0 ) is also a steady-state (by Lemma 3 below), we are search-
ing for
                       u (C (A, L, K0 )) = u C A , L , K0

or
                               C (A, L, K0 ) = C A , L , K0 .

Let v(p, I ) be the static indirect utility function. Then we know that we are searching for

            v( p(A, L, K0 ), m) = v( p(A, L, K0 ), m) = v( p(A , L , K0 ), m ),

where the first equality uses the fact within period relative goods prices do not depend
on within period preferences (since the static PPF is linear). Hence,

                 e( p(A, L, K0 ), vt1 )    e( p(A, L, K0 ), vt1 ) e( p(A , L , K0 ), vt1 )
             =                           =
                 e( p(A, L, K0 ), vt0 )    e( p(A, L, K0 ), vt0 ) e( p(A , L , K0 ), vt1 )
                 e( p(A , L , K0 ), vt1 ) e( p(A, L, K0 ), vt1 )
               =
                  e( p(A, L, K0 ), vt0 ) e( p(A , L , K0 ), vt1 )
               = exp EV m .

Hence, we can use micro EV m to calculate the change in macro welfare.
Lemma 3. The steady-state choice of capital (and investment) is the same for any homothetic and
stable within-period preferences.
Proof. Suppose intertemporal welfare is given by

                                               
                                       Ut =    s-t u(Cs ),
                                              s=t

where Cs is some homothetic aggregator of within-period consumption goods. Since all
goods are produced with constant-returns to scale and every good uses the same homoth-
etic bundle of capital and labor, we can write the consumption aggregator as depending
on
                                     Cs = G ( Lcs , Kcs )

for some function constant-returns-to-scale function G. Similarly, investment goods are

                                                    59
created according to some constant returns to scale function

                                             Is = H ( L Is , Kls ),

and the capital accumulation equation is

                                       Ks+1 = (1 - )(Ks + Is ).

The Lagrangean is

        
 L=      s-t [u(Cs ) + µs (G( Lcs , Kcs ) - Cs ) + s (Ks+1 - (1 - )(Ks + H ( L Is , K Is )))
        s=t
                                                           +s ( Ls - Lcs - L Is ) + t (Ks - Kcs - K Is )]

The first order conditions are

                              L
                                      : u (Cs ) = µs
                              Cs
                             L
                                      : s - s+1 (1 - ) + s+1 = 0
                             K s +1
                              L                         Hs           G
                                      : - s (1 -  )         = s = µs
                             K Is                      K Is          Kcs
                              L            G
                                      : µs      = s
                             Kcs           Kcs
                              L            G
                                      : µs      = s
                              Lcs           Lcs
                              L                     H
                                      : - s (1 -  )       = s .
                              L Is                   L Is

Hence
                                                              G /Kcs
                                      - s (1 -  ) = µ s
                                                              Hs /K Is


               s = s+1 (1 - ) - s+1
                                              G /Kcs+1
           u (Cs ) = (1 - )u (Cs+1 )                    Hs /K Is ( Hs /K Is+1 )-1 + 1 .
                                              G /Kcs

In steady state we have
                                  1 = (1 - ) [1 +  Hs /K Is ] .

Hence, the capital stock and investment in steady-state are pinned down by the following


                                                      60
5 equations in 5 unkowns (KC , K I , K, LC , L I ) :

                                    1 =  (1 -  ) [1 +  H /  K I ] ,
                                   KC   K
                                      = I,
                                   LC   LI
                                     K = KC + K I ,
                                     L = L I + LC ,
                                    K = (1 -  ) H ( L I , K I ).

Since G does not appear in any of these equations, the steady-state investment and capital
stock do not depend on the shape of the within-period utility function G.

Proof of Proposition 9. Start by setting nominal GDP to be the numeraire. To model the
industry-structure, for each industry I , add two new CES aggregators. One buys the
good for the household and one buys the good for firms. Let the price of the household
                                                                                     f
aggregator be given by pc   I and the price of the non-household aggregator be p I and let
p I be the price of the original industry. Let firm i s share of industry I from household
expenditures be biI . Let the expenditure share of other firms on firm i be siI . We have

                                                   biI = 1
                                               i I

                                                   siI = 1.
                                                  i I

                   f
    Let c
        I and  I be sales of industry I to households and firms. Then we have

                                                                  f
                                          d I = dc
                                                 I + d I .


The sales of an individual firm i in industry I is given by

                                              f
                         i = biI c
                                 I + siI  I
                                                              f         f
                        di = dbiI c         c
                                  I + biI d  I + dsiI  I + siI d  I
                        dbiI = Covb I (d log x(iI ) + (1 - I )d log A(iI ) , I(i) )
                        dsiI = Covb I ((1 - I )d log A(iI ) , I(i) ).




                                                        61
The gap between macro welfare and real GDP, EV M -  log Y , is approximately given by

                     1                         1                                               
                       d log x        d log A =                            d log x j  logi x j       d log Ai ,
                     2          log x          2 i N                      j N


where the sums can be re-written as

                          i                           biI c                            c
            d log x j
                         log x j
                                 d log Ai =  d log x
                                                      log x
                                                             I d log Ai + biI d log x
                                                                                       log
                                                                                          I
                                                                                            x
                                                                                              d log Ai
i N   j N                                   i N
                                                                                                              f
                                                             siI    f                          I
                                                   +d log x         I d log Ai + siI d log x        d log Ai .
                                                             log x                            log x

The individual terms of this expression are:

                                   biI c
                        d log x
                                   log x
                                          I d log Ai =  Covb I (d log x(iI ) , I(i) )c
                                                                                     I d log Ai
               i N                                     i N

                                                             = Covb I (d log x(iI ) ,           I(i) d log Ai )cI
                                                                                               i N

                                                             = Covb I (d log x(iI ) , d log AiI )c
                                                                                                 I;



                                          c                                           c
                           biI d log x       I
                                          log x
                                                d log Ai = Eb I (d log AiI ) d log x     I
                                                                                      log x
                                                                                            ;
                   i N

                                                             s
                                          d log x  log
                                                     iI                   f
                                                          d log Ai = 0;
                                         i N
                                                        x I

and
                                               f                                                         f
                                       I                                           I
                         siI d log x  log x
                                            d log Ai = Es I (d log AiI ) d log x
                                                                                  log x
                                                                                        .
                        i

Of the four terms, two depend on changes on industry-level sales shares (the sum of
which is denoted by  in the proposition), one of them is zero, and the remaining one
(the first term) is the within-industry covariance of supply and demand shocks in the
proposition.

Proof of Proposition 10. Consider a household with preferences given by
                                                                                      
                                                             x             -1         -1
                                            C=                   c( x )         dx         .
                                                         0




                                                                  62
Note that budget shares are

                                                                             p ( x , t )1- 
                                      ev ( x, t, t1 ) =                x  ( t1 )
                                                                      0              p( x, t)1- dx
                                                                          p ( x , t )1- 
                                               ( x, t) =
                                                                       x  (t)
                                                                      0          p( x )1- dx

Hence
                                                                                 I
                                            EV m =                                                  1
                                                                                                         .
                                                              x  ( t1 )                            1- 
                                                             0            p( x )1- dx

Next
                                                         t1          x  ( t1 )                          d log p( x, t)
                               m
                 log EV =  log I -                                               ev ( x, t, t1 )                       dxdt.
                                                        t0       0                                           dt
Without loss of generality, let's normalize changes in nominal income to zero. Let i ev
refer to the partial derivative of ev with respect to its ith argument. Differentiating and
evaluating at the initial point, we get

 d log EV m              t1    x  ( t1 )                d log p( x, t)
            =-                             3 ev ( x, t, t1 )           dxdt
     dt1            t0      0                                 dt
                 t1                         d log p( x  (t1 ), t) dx             x  ( t1 )                   d log p( x, t1 )
                       ev 
              -      ( x ( t1 ), t, t1 )                                 dt -              ev ( x, t1 , t1 )                  dx
                t0                                      dt           dt1       0                                   dt1
d2 log EV m           x  ( t1 )                     d log p( x, t1 )                               d log p( x  (t1 ), t1 ) dx 
              =-                3 ev ( x, t1 , t1 )                  dx - ev ( x  (t1 ), t1 , t1 )
     dt2
       1            0                                     dt1                                                   dt           dt1
                                          dx  d log p( x  , t1 )                            x  ( t1 )   dev ( x, t1 , t1 ) d log p( x, t1 )
                   ev     
              -  ( x ( t1 ), t1 , t1 )                            -                                                                         dx
                                          dt1        dt1                                0                    dt1                dt1
                  x  ( t1 )                   d2 log p( x, t1 )
              -             ev ( x, t1 , t1 )                   dx
                0                                   dt2
                                                      1

Evaluating at the initial point this simplifies to

 d log EV m              x           d log p( x, t)
            =-                ( x )                    dx
     dt1                0                  dt
d2 log EV m               x  ( t1 )                     d log p( x, t1 )                               d log p( x  (t1 ), t1 ) dx 
            =-                      3 ev ( x, t1 , t1 )                  dx - ev ( x  (t1 ), t1 , t1 )
     dt2
       1                0                                    dt1                                                dt             dt1
                                          dx  d log p( x  , t1 )                            x  ( t1 )   dev ( x, t1 , t1 ) d log p( x, t1 )
              - ev ( x  (t1 ), t1 , t1 )                          -                                                                         dx
                                          dt1        dt1                                0                    dt1                dt1
                  x  ( t1 )                   d2 log p( x, t1 )
              -             ev ( x, t1 , t1 )                   dx
                0                                   dt2
                                                      1


                                                                      63
We note that
                                                                                          p ( x , t )1- 
                                    ev ( x, t, t1 ) =
                                                                                   x  ( t1 )
                                                                                  0            p( x, t)1- dx


                         log ev ( x, t, t1 )           d log p( x, t)                                                            x  ( t1 )             d log p( x, t)
                                             = (1 -  )                -                                                                      ( x, t)                  dx .
                              t                              dt                                                              0                              dt
                         log ev ( x, t, t1 )             dx 
3 log ev ( x, t, t1 ) =                      = -( x , t)        .
                              t1                          dt1

Meanwhile, real consumption changes are given by

                                         t1         x  (t)
                                                         d log p
                  log Y = -                                  ( x, t)
                                                                 dxdt
                             t0      0                      dt
                d log Y        x  ( t1 )              d log p
                        =-                ( x , t1 )           dx
                  dt1        0                          dt1
               d2 log Y                            dx  d log p
                        = -  ( x   ( t 1 ) , t 1 )
                  dt2
                    1
                                                   dt1 dt1
                                   x  ( t1 )   d( x, t1 ) d log p                                        x  ( t1 )                 d2 log p
                          -                                       dx -                                                ( x , t1 )            dx
                               0                dt1         dt1                                      0                               dt21

where

  d log ( x, t1 )                        d log p( x, t)                               x  ( t1 )              d log p( x, t)                dx 
                  = (1 -  )                             -                                         ( x, t)                   dx - ( x  , t)     .
       dt1                                    dt                                  0                               dt                        dt

Hence

 d log EV m   d log Y
            =
     dt1        dt1
 2
d log EV  m    2
              d log Y                   x  ( t1 )                      d log p( x, t1 )                            d log p( x  (t1 ), t1 ) dx 
                                                             ev                              ev 
       2
            =         -                             3  ( x , t1 , t1 )                  dx -  ( x (t1 ), t1 , t1 )
     dt1         dt2
                   1                0                                       dt1                                             dt             dt1
                 d2 log Y                      dx                x  ( t1 )                 d log p( x, t1 )             d log p( x  (t1 ), t1 ) dx 
             =                + ( x )                                        ( x )                          dx - ( x  )
                    dt2
                      1
                                               dt1           0                                  dt1                              dt             dt1
                 d2 log Y                      dx                     x  ( t1 )                d log p( x, t1 )      d log p( x  (t1 ), t1 )
             =                + ( x )                                             ( x )                         dx -
                    dt2
                      1
                                                dt1               0                                 dt1                       dt
                 d2 log Y                      dx                          d log p   d log p( x  )
             =                + ( x )                        E                     -               .
                    dt2
                      1
                                                dt1                           dt          dt




                                                                                  64
Appendix B              Extension to Other Welfare Measures
Our baseline measure of welfare changes is equivalent variation under final preferences.
Alternatively, we could measure changes in welfare using compensating (instead of equiv-
alent) variation, or by using initial (rather than final) preferences. We focus on equivalent
variation with final preferences since it uses indifference curves in the final allocation
to make welfare comparisons (that is, preferences "today" for growth-accounting pur-
poses). In this appendix, we show that our methods generalize to the other welfare mea-
sures. If preferences are homothetic, then the expenditure function can be written as
e( p, u; x ) = e ( p; x ) u, so equivalent and compensating variation are equal. If preferences
are stable, then the expenditure function can be written as e( p, u; x ) = e ( p, u), so equiv-
alent variation under initial and final preferences are equal (and the same is the case for
compensating variation).
    Recall that when preferences are homothetic, then the expenditure function can be
written as e( p, u; x ) = e ( p; x ) u. Hence, in this case, for any fixed x, compensating varia-
tion is equal to equivalent variation.


B.1    Micro welfare changes
We consider four alternative measures of micro welfare changes. For each measure, we
present expression for global welfare changes and the approximate gap with real con-
sumption.
   The compensating variation with initial preferences is CV m ( pt0 , It0 , pt1 , It1 ; xt0 ) = , where
 solves
                            v( pt1 , e- It1 ; xt0 ) = v( pt0 , It0 ; xt0 ).                         (22)

The analog to (5) in Lemma 1 is

                                                       t1
                               CV m =  log I -
                                                     t0 i  N
                                                             bicv d log pi ,                       (23)


where bicv ( p)  bi ( p, v( pt0 , It0 ; xt0 ); xt0 ).
    Whereas EV m weights price changes by hypothetical budget shares evaluated at cur-
rent prices for fixed final preferences and final utility, CV m uses budget shares evaluated
at current prices for fixed initial preferences and initial utility. An alternative way of cal-
culating CV m is to reverse the flow of time (the final period corresponds to the initial
period), calculate the baseline EV measure under this alternative timeline, and then set
CV m = - EV m .

                                                  65
    We now briefly describe how to calculate bcv to apply (29). For ex-ante counterfactuals,
where b(t0 ) is known, we can construct bcv ( p) between t0 and t1 by iterating on (7) starting
at t0 and going forward to t1 . For ex-post counterfactuals, b(t0 ) can be obtained from past
data, so we can construct bcv ( p) by iterating on (7) starting at t0 and going forward to t1 .
    To a second-order approximation

                                                     1              bi
           log CV m   log I - b  log p -                
                                                     2 i N
                                                            log p
                                                                   log p
                                                                          log p             (24)

                                     1              bi              bi
                        log Y +         
                                     2 i N
                                            log x
                                                   log x
                                                         +  log v
                                                                   log u
                                                                          log p.            (25)


Recall that changes in budget shares due to non-price factors are multiplied by 1/2 in real
consumption. However, they are multiplied by 0 in CV m , since CV m is based on budget
shares at initial preferences and initial utility.
   Combining Proposition 2 and (24), we see that up to a second order approximation,

                                 0.5 ( EV m + CV m )   log Y .

That is, locally (but not globally) changes in real consumption equal a simple average
of equivalent variation under final preferences and compensating variation under initial
preferences.
    Alternatively, we can measure the change in welfare using the micro equivalent variation
with initial preferences, EV m ( pt0 , It0 , pt1 , It1 ; xt0 ) =  where  solves

                               v( pt1 , It1 ; xt0 ) = v( pt0 , e It0 ; xt0 ).               (26)

Globally, changes in welfare are

                                                         t1
                             EV m =  log I -
                                                       t0 i  N
                                                               biev d log pi ,              (27)


where biev ( p)  bi ( p, v( pt1 , It1 ; xt0 ); xt0 ). The gap between changes in welfare and real
consumption is, up to a first order approximation,

                                    1               bi              bi
          log EV m -  log Y            
                                    2 i N
                                          - log x
                                                   log x
                                                         +  log v
                                                                   log u
                                                                          log p.


Finally, the change in welfare measured using the micro compensating variation with final



                                                    66
preferences is CV m ( pt0 , It0 , pt1 , It1 ; xt1 ) =  where  solves

                                    v( pt1 , e- It1 ; xt1 ) = v( pt0 , It0 ; xt1 ).                         (28)

Globally, changes in welfare are given by

                                                              t1
                                  CV m =  log I -
                                                            t0 i  N
                                                                    bicv d log pi ,                         (29)


where bicv ( p)  bi ( p, v( pt0 , It0 ; xt0 ); xt1 ). The gap between changes in welfare and real
consumption is, up to a first order approximation,

                                           1              bi              bi
            log CV m -  log Y                 
                                           2 i N
                                                  log x
                                                         log x
                                                               -  log v
                                                                         log u
                                                                                log p.


Note for EV with initial preferences or CV with final preferences, we must be able to
separate demand instability from income effects. For this reason, to compute welfare
changes, the elasticities of substitution are not sufficient -- we must also know income
elasticities or the demand shocks.
   Finally, we note that real consumption can be interpreted as representing an alter-
native measure of welfare, defined as the sum of instantaneous welfare changes using
current preferences at each point in time. In particular, real consumption can be written
as
              t1    EV m ( p(t), I (t), p(t), I (t); x (t))          EV m ( p(t), I (t), p(t), I (t); x (t))
 log Y =                                                    dp(t) +                                          dI (t),
             t0                      p t1                                             It1

where, at every t  [t0 , t1 ], the integrand is the instantaneous welfare change in response
to changes in prices and income, dp and dI , measured using equivalent variation with
preferences x (t). In contrast to our welfare measures, this measure does not represent the
welfare change over a single preference ordering, and is path dependent (it does not only
depend only on initial and final income and prices).


B.2    Macro welfare changes
For each alternative micro welfare measure there is a corresponding macro welfare mea-
sure. For example, the macro compensating variation with initial preferences is CV M ( At0 , Lt0 , At1 , Lt1 ; xt0 ) =
, where  solves
                          V ( A t0 , L t0 ; x t0 ) = V ( A t1 , e -  L t1 ; x t0 ).


                                                         67
In words, CV M is the proportional change in final factor endowments necessary to make
a planner with preferences xt0 indifferent between the initial PPF ( At0 , Lt0 ) and PPF
defined by ( At1 , e- Lt1 ).
    Equation (11) in Proposition 4 applies using cv ( A), the sales shares in a fictional econ-
omy with the PPF A, L but where consumers have stable homothetic preferences repre-
sented by the expenditure function ecv ( p, u) = e( p, vt0 , xt0 ) vu
                                                                    t0
                                                                       where vt0 = v( pt0 , It0 ; xt0 ).
Growth accounting for welfare is based on hypothetical sales shares evaluated at cur-
rent technology but for fixed initial preferences and initial utility. The only information
on preferences we need to know is elasticities of substitution at the final allocation. As
discussed above, CV M is equal to - EV M if we reverse the flow of time.
    The gap between changes in welfare and real GDP is, to a second-order approximation
(the analog of that in Proposition 5) is

                            1             i               log v i
      CV M   log Y -           
                            2 i N
                                   log x
                                          log x
                                                +  log A
                                                          log A  log v
                                                                        log Ai .                   (30)


  We can also define macro equivalent variation with initial preferences, EV M ( At0 , Lt0 , At1 , Lt1 ; xt0 ) =
, where  solves
                          V ( A t1 , L t1 ; x t0 ) = V ( A t0 , e  L t0 ; x t0 ).

Growth accounting for welfare is based on hypothetical sales shares evaluated at cur-
rent technology for fixed initial preferences and final utility. In contrast to our previous
measures, in order to implement this measure we must know initial demand shifters or
income effects. The gap between changes in welfare and real GDP is

                          1              i               log v i
     EV M   log Y +          
                          2 i N
                                - log x
                                         log x
                                               +  log A
                                                         log A  log v
                                                                       log Ai .                    (31)


Finally, define macro compensating variation with final preferences, CV M ( At0 , Lt0 , At1 , Lt1 ; xt1 ) =
, where  solves
                           V ( A t0 , L t0 ; x t1 ) = V ( A t1 , e -  L t1 ; x t1 ).

Growth accounting for welfare is based on hypothetical sales shares evaluated at current
technology for fixed final preferences and initial utility, which requires information on
demand shifters or income effects. The gap between changes in welfare and real GDP is

                            1             i               log v i
      CV M   log Y +           
                            2 i N
                                   log x
                                          log x
                                                -  log A
                                                          log A  log v
                                                                        log Ai .                   (32)




                                                  68
Appendix C                  Non-homothetic CES preferences
This appendix provides a derivation of the log-linearized expression (6). Changes in Mar-
shallian budget share are given by

       d log biM = d log pi - d log I +   M              w
                                          ij d log p j +  i d log I + d log xi ,
                                                   j

                     = d log pi - d log I +   H    w                  w
                                              ij -  i b j d log p j +  i d log I + d log xi ,
                                                   j


where  H and  M are the Hicksian and Marshallian price elasticities, w are the income elas-
ticities, and d log xi is a residual that captures changes in shares not attributed to changes
in prices or income. The third line is an application of Slutsky's equation. When prefer-
ences are non-homothetic CES, then the Hicksian demand curve can be written as

                                                                 - 0
                                                        pi
                                             c i = i                   u i ,
                                                       j pj cj

where i and  i are some parameters. The Hicksian price elasticity for j = i is

                                        log ci           pj cj
                                                = H
                                                  ij = 0       = 0 b j .
                                        log p j           I

Using this fact and the identity  H             H
                                  ii = -  j =i  ij , we can rewrite changes in budget shares
as

d log biM =         H    w                               w
                    ij -  i b j d log p j + d log pi + (  i - 1) d log I + d log x
              j

                                       pi                 pj
         =        1 -  H
                       ij      d log      +  H   ij d log    + w
                                                               i d log I -  b j d log p j + d log xi
                     j =i
                                       I    j =i
                                                          I                j

                                        pi               pj
         =        1 -  0 b j    d log      +  0 b j d log + w
                                                            i d log I -  b j d log p j + d log xi
                     j =i
                                        I    j =i
                                                         I              j

                                             pi               pj
         = (1 - 0 (1 - bi )) d log              +  0 b j d log + w
                                                                 i d log I -  b j d log p j + d log xi
                                             I    j =i
                                                              I              j


         = (1 - 0 ) d log pi -  b j d log p j + (w
                                                 i - 1) d log I -  b j d log p j + d log xi .
                                         j                                     j




                                                         69
Appendix D               Quality changes
In this appendix, we discuss how our results can be extended to environments with qual-
ity changes that are not reflected in market prices. In this appendix, we also contrast the
bias we identify with the "taste shock bias" discussed by Redding and Weinstein (2020).
    If quality changes are equivalent to changes in prices, then we can write the quality-
adjusted price as p = p ~ /q, where p~ is the market price and q is the quality adjustment.
In other words, changes in quality-adjusted prices are given by  log p =  log p         ~-
 log q. Substituting this into our various propositions allows us to isolate the way quality
changes affect our results. For example, Proposition 3 becomes the following. For brevity,
we assume homothetic preferences below.

Proposition 12 (Approximate Micro with Quality Change). Consider some perturbation in
demand  log x, market prices  log p,  ~ quality  log q, and income  log I. Then, to a second-
order approximation, the change in real consumption is

                                               1
              log Y   log I - Eb [ log p ~ ] - (1 - 0 )Varb (d log p~)
                                               2
                     1                                  1
                    + (1 - 0 )Covb (d log q, d log p
                                                   ~ ) - Covb (d log x, d log p
                                                                              ~ ),
                     2                                  2

and the change in welfare is

                                       1
EV m   log I - Eb [ log p
                        ~ -  log q] - (1 - 0 )Varb ( log p  ~)
                                       2
      1
     - (1 - 0 )Varb ( log q) + (1 - 0 )Covb ( log p
                                                  ~ ,  log q) - Covb ( log x,  log p) ,
      2

where Covb (·) is the covariance using the initial budget shares as the probability weights.

   Hence, by subtracting these two expressions, we can derive the gap between real con-
sumption and welfare up to a second order approximation as

                            1                      1
EV m -  log Y  Eb [ log q] + (0 - 1)Varb ( log q) + (1 - 0 )Covb ( log p
                                                                       ~ ,  log q)
                            2                      2
                     average quality          dispersion in quality             covariance of price and quality
                     1
                 -     Covb ( log x,  log p
                                          ~ ) + Covb ( log x,  log q) .                                       (33)
                     2
                       covariance of taste and price   covariance of taste and quality


The first term on the right-hand side captures how the average increase in quality raises
welfare relative to real consumption. The second term captures the fact that dispersion


                                                       70
in quality raises welfare if the elasticity of substitution is greater than one (since the con-
sumer substitutes towards goods with relatively higher quality, but quality is not cap-
tured by market prices in real consumtption). The third term is an interaction (cross-
partial) effect that raises welfare if market prices fall for goods whose quality rose, as
long as the elasticity of substitution is greater than one. The fourth term is the bias we
have been emphasizing in the paper so far. The final term is the interaction between qual-
ity and taste changes -- welfare is higher, at final preferences, if tastes increase for goods
whose quality also increased.
    In our analysis, we assume that prices have already been adjusted for quality, so the
only non-zero term is the fourth one. Welfare is higher than real consumption if the
covariance between taste shocks and prices is negative. This is independent of the value
of the elasticity of substitution. In other words, in the body of the paper, we assume that
 log q = 0, which means that (33) simplifies to

                                            1
                            EV m -  log Y  - Covb ( log x,  log p
                                                                ~) .                                  (34)
                                            2

   We can use (33) to contrast our results with those of Redding and Weinstein (2020).42
The "taste shifters" in that paper are equivalent to quality shocks  log q = 0, whereas
 log x = 0. Hence, in their case, (33) simplifies

                                 1                          1
EV m -  log Y  Eb [ log q] + (0 - 1)Varb ( log q) - (0 - 1)Covb ( log p           ~ ,  log q) .
                                 2                          2
                                                                                          (35)
Comparing (34) to (35) elucidates the differences. First, the average level of  log q affects
welfare but the average level of  log x does not. Second, for shocks to  log q, even when
they are mean zero, dispersion in q can raise or lower welfare depending on the elasticity
of substitution. Hence, shocks to q on their own can change welfare, even if choice sets
have not changed, and the sign of this effect depends on the elasticity of substitution. This
is in contrast to shocks to x which do not change welfare on their own. Third, in both (34)
and (35), the covariance of taste shifters and market prices matters, however, in (35) the
sign of the covariance depends on whether the elasticity of substitution is greater than or
less than one, whereas in (34), the sign is always the same.
    An important challenge for future research is to separately identify demand shocks of
the form of  log x versus  log q.
  42 We   abstract from product creation and destruction, which Redding and Weinstein (2020) also consider.




                                                     71
Appendix E               Additional details on the Baumol application
In this appendix, we provide some intuition for why, from a welfare perspective, struc-
tural transformation caused by income effects or taste shocks is roughly twice as impor-
tant as that caused by substitution effects. We also use a structural nested-CES model to
explore the change in welfare-relevant TFP outside of the two polar extremes in Section
5.


E.1     Intuition for size of welfare-adjustment
According to our results in Section 5, structural transformation caused by income effects
or demand instability reduced welfare by roughly twice as much as structural transfor-
mation caused by substitution effects. To understand why the necessary adjustment is
roughly twice as big, consider the second-order approximation in Proposition 4:

                                           1           i               i
     log TFPwelfare   log TFP +
                                           2           log x
                                                              log x +
                                                                       log v
                                                                              log v  log Ai ,            (36)
                                                i N

where

                                                                   1
                             log TFP            i,t0  log Ai + 2  i  log Ai .
                                            i N                        i N


If changes in sales shares are due entirely to demand-driven factors, then the term in
square brackets in (36) is equal to i N i  log Ai , so

                      log TFPwelfare            i,t0  log Ai +  i  log Ai .
                                            i N                   i N

In other words, the adjustment to the initial sales shares must be roughly twice as large
as the adjustment to the initial sales shares caused by substitution effects.43



E.2     Welfare-TFP outside of polar extremes
In practice, both substitution effects and non-homotheticities are likely to play an impor-
tant role in explaining structural transformation. To dig deeper into the size of the welfare
  43 These second-order approximations are more accurate if changes in sales shares are well-approximated

by linear time trends, and the surprising accuracy of the second-order approximation is a result of this fact.



                                                       72
adjustment outside our two polar cases, we use a simplified version of the model intro-
duced in Section 4 calibrated to the US economy, accounting for input-output linkages
and complementarities, and use the model to quantify the size of the welfare-adjustment
as a function of the elasticities of substitution. We calculate TFP by industry in the data
allowing for cross-industry variation in capital and labor shares. For simplicity, we feed
these TFP shocks as primitive shocks into a one-factor model. Recomputing these num-
bers for a model with multiple factors would be straightforward.
    Remarkably, Proposition 4 implies that to compute the welfare-relevant change in TFP,
we must only supply the information necessary to compute ev . That is, since we know
sales shares in the terminal period 2014, we do not need to model the non-homotheticities
or demand-shocks themselves, and the exercise requires no information on the functional
form of non-homotheticities or the slope of Engel curves or magnitude of income elastic-
ities conditional on knowing the elasticities of substitution.
    We map the model to the data as follows. We assume that the constant-utility final de-
mand aggregator has a nested-CES form. There is an elasticity 0 across the three groups
of industries: primary, manufacturing, and service industries. The inner nest has elastic-
ity of substitution 1 across industries within primary (2 industries), manufacturing (24
industries), and services (35 industries).44 Production functions are also assumed to have
nested-CES forms: there is an elasticity of substitution 2 between the bundle of interme-
diates and value-added, and an elasticity of substitution 3 across different types of inter-
mediate inputs. For simplicity, we assume there is only one primary factor of production
(a composite of capital and labor). We solve the non-linear model by repeated application
of Proposition 6 in the fictional economy with stable and homothetic preferences.
    We calibrate the CES share parameters so that the model matches the 2014 input-
output tables provided by the BEA. For different values of the elasticities of substitution
(0 , 1 , 2 , 3 ) we feed changes in industry-level TFP (going backwards, from 2014 to 1947)
into the model and compute the resulting change in aggregate TFP. This number repre-
sents the welfare-relevant change in aggregate TFP. We report the results in Table 2.
    The first column in Table 2 shows the change in welfare-relevant TFP assuming that
there are no substitution effects (all production and consumption functions are Cobb-
Douglas). In this case, all changes in sales shares in the data are driven by non-homotheticities
or demand-instability, and hence welfare-relevant TFP has grown more slowly than mea-
sured TFP, exactly as discussed in the previous section. The other columns show how the
  44 In order to map this nested structure to our baseline model, good 0 is a composite of good 1-3, where
good 1 is a composite of primary industries, good 2 is a composite of manufacturing industries, and good
3 is a composite of service industries. Goods 4-65 are the disaggregated industries. Finally, good 66 is the
single factor of production.


                                                    73
Table 2: Percentage change in measured and welfare-relevant TFP in the US from 1947 to
2014.

         ( 0 , 1 , 2 , 3 )   (1,1,1,1)   (0.5,1,1,1)     (1,0.5,1,1)   (1,1,0.5,1)    (1,1,1,0.5)
         Welfare TFP           46%           46%            54%             48%          55%
         Measured TFP          60%           60%            60%             60%          60%


results change given lower elasticities of substitution. As we increase the strength of com-
plementarities (so that substitution effects are active), the implied non-homotheticities re-
quired to match changes in sales shares in the data are weaker. This in turn reduces the
gap between measured and welfare-relevant productivity growth.
    Table 2 also shows that not all elasticities of substitution are equally important. The
results are much more sensitive to changes in the elasticity of substitution across more dis-
aggregated categories, like materials, than aggregated categories, like agriculture, manu-
facturing, and services.
    To see why the results in Table 2 are differentially sensitive to changes in different
elasticities of substitution, combine Propositions 7 and 11 to obtain the following second-
order approximation:

                                         1
  log TFPwelfare         i  log Ai + 2                  ( j - 1) j Var( j)           (k)  log Ai    . (37)
                         i                   j{0}+N                           k N


The second term is half the sum of changes in Domar weights due to substitution effects
(i.e. changes in welfare-relevant sales shares) times the change in productivities. Note that
changes in these welfare-relevant sales shares are linear in the microeconomic elasticities
of substitution. The importance of some elasticity  depends on


                                 j Var(j)               (k)  log Ai     ,
                                j               k N


where the index j sums over all CES nests whose elasticity of substitution is equal to
 (i.e. all j such that  j =  ). Therefore, elasticities of substitution are relatively more
potent if: (1) they control substitution over many nests with high sales shares, or (2) if the
nests corresponding to those elasticities are heterogeneously exposed to the productivity
shocks.
   We compute the coefficients in (37) for our model's various elasticities using the IO
table at the end of the sample. The coefficient on (0 - 1), the elasticity of substitution


                                                   74
between agriculture, manufacturing, and services in consumption is only 0.01. This ex-
plains why the results in Table 2 are not very sensitive to this elasticity. On the other
hand, the coefficient on (1 - 1), the elasticity across disaggregated consumption goods,
is much higher at 0.21. The coefficient on (2 - 1), the elasticity between materials and
value-added bundles is 0.07. Finally, the coefficient on (3 - 1), the elasticity between
disaggregated categories of materials is 0.25. This underscores the fact that elasticities of
substitution are more important if they control substitution in CES nests which are very
heterogeneously exposed to productivity shocks -- that is, nests that have more disag-
gregated inputs.
    According to equation (37), setting 1 = 2 = 3 = 1 (which is similar to abstracting
from heterogeneity within the three broader sectors and heterogeneity within interme-
diate inputs), then 0 is the only parameter that can generate substitution effects in the
model. This may help understand why more aggregated models of structural transfor-
mation (e.g. Buera et al., 2015 and Alder et al., 2019) require low values of 0 to account
for the extent of sectoral reallocation in the data.


Appendix F               Non-CES Functional Forms
In this appendix, we generalize Proposition 6 beyond CES functional forms. To do this,
for each producer k with cost function Ck , we define the Allen-Uzawa elasticity of substi-
tution between inputs x and y as

                                              Ck d2 Ck /(dp x dpy )       k ( x, y)
                           k ( x, y) =                              =                 ,
                                            (dCk /dp x )(dCk /dpy )        ky

where k ( x, y) is the elasticity of the demand by producer k for input x with respect to the
price py of input y, and ky is the expenditure share in cost of input y. For the household
k = 0, we use the household's expenditure function in place of the cost function (where
the Allen-Uzawa elasticities are disciplined by Hicksian cross-price elasticities and ex-
penditure shares).
   Following Baqaee and Farhi (2019b), define the input-output substitution operator for
producer k as

          k (  (i ) ,  ( j ) ) = -                     kx [xy + ky (k ( x, y) - 1)] xi yj ,   (38)
                                     1 x ,y  N +1+ F
                             1
                            = E(k) (k ( x, y) - 1)(i ( x ) - i (y))( j ( x ) -  j (y)) ,      (39)
                             2


                                                          75
where xy is the Kronecker delta, i ( x ) =  xi and  j ( x ) =  xj , and the expectation on
the second line is over x and y. The second line can be obtained from the first using the
symmetry of Allen-Uzawa elasticities of substitution and the homogeneity identity.
   Then, Proposition 6 generalizes as follows:

Proposition 13. Consider some perturbation in final demand d log x and technology d log A.
Then changes in prices of goods and factors are

                          d log pi = -     ij d log A j +  iFf d log  f .                              (40)
                                          j N                    f F


Changes in sales shares for goods and factors are

         i d log i =               j  j -d log p, (i)                                                  (41)
                        j{0}+ N


                        + Cov(0) d log x, (i) + Cov(0) (, (i) )                k d log Ak        .
                                                                             k N

    Since  j shares many of the same properties as a covariance (it is bilinear and symmet-
ric in its arguments, and is equal to zero whenever one of the arguments is a constant), the
intuition for Proposition 13 is very similar to that of Proposition 6. Computing the equilib-
rium response in Proposition 13 requires solving a linear system exactly as in Proposition
6.


Appendix G                Heterogeneous Agents
We consider a utilitarian SWF that sums the welfare of each agent h, measured in terms
of initial prices, relative to initial aggregate income45

                                                 h I eh ( p¯ , uh )
                                         W=                         ,
                                                 j I e j ( p
                                                           ¯, u¯ j)

where I is the set of agents. Preferences can vary across households but, for simplicity,
we assume that each h's preferences are homothetic and stable.
  45 This social welfare function implements a version of the Kaldor-Hicks compensation principle whereby

a change is deemed socially desirable if the winners can hypothetically compensate the losers. In this case,
this hypothetical compensation is measured in terms of initial prices.




                                                    76
   For this case, in this appendix we show that to a second-order approximation,

                             1
             log W =  log Y + Cov (-Eb [ log p],  log I - Eb [ log p]) ,
                             2

where  is the initial distribution of expenditures by each agent, Eb [ log p] is the vector
of inflation rates for each household, and  log I is the vector of nominal income changes.
The change in social welfare is greater than the change in real GDP if changes in real
income negatively covary with inflation across households. There is no bias if preferences
are aggregable, in which case Eb [ log p] is uniform across households, if real income
growth is uniform or, more generally, if changes in household-level inflation rates are
uncorrelated with changes in real income.
    While the specific form of the gap between welfare and real GDP depends on the social
welfare function, if individuals' preferences are not aggregable, then there will always be
a gap even if preferences at the individual level are stable and homothetic.
    To establish these results, we first write the utilitarian social welfare function as

                                       W=    ¯ h Yh ,
                                              h

where  ¯ h is the ratio of agent i expenditures in total expenditures in the initial point,
              ¯ ,u h )
           e (p                                                                     m ), since
and Yh  eh ( p         denotes the change in real consumption of agent h (or exp( EVh
            j ¯ ,u
                 ¯j)
preferences are stable and homothetic). We show that to a second order approximation

                                    1
                     log W   log Y - Cov (Ebh [ log p],  log Yh ),
                                    2

where the covariance is applied across individuals using the probabilities implies by the
vector  at the initial point.




                                             77
   To see this,

                  1
    d log W =
                  W    ¯ h Yh d log Yh ,
                        h
                  1                                    1                        1
   d2 log W =
                  W    ¯ h Yh (d log Yh )2 +
                                             W h h
                                               ¯ Y d2 log Yh -
                                                               W h h
                                                                 ¯ Y d log Yh d log W ,
                        h                                   h                       h
              1                                1
            =
              W          ¯ h Yh (d log Yh )2 +
                                               W           ¯ h Yh d2 log Yh - (d log W )2 ,
                       h                                    h
              1                                1
            =
              W          ¯ h Yh (d log Yh )2 +
                                               W           ¯ h Yh d2 log Yh - (d log Y )2 ,
                       h                                    h
            = ¯ h (d log Yh )2 +  ¯ h d2 log Yh - (d log Y )2 ,
                  h                            h

where we use the fact that W = Yh = 1 and d log W = d log Y at the initial point.
  Next consider the change in real GDP:

                                    t1       pi ( t ) qi ( t )
                  log Y =                                      d log qi (t),
                                t0       i   j p j (t)q j (t)


and

                      pi qi =    h bhi GDP,
                                h


where bhi is the budget share of agent h on good i and GDP is nominal GDP. We have

                                     qhi
             d log qi =              qi
                                         d log qhi
                                h
                                     h bhi
                            =                  d log qhi
                                h     g  g bgi
                                    t1
                  log Y =
                                t0
                                          h  bhi d log qhi
                                         h     i
                                    t1
                            =
                                t0
                                          h d log Yh .
                                         h


Differentiating this with respect to t1 gives

             d log Y =  · d log Y(h) .




                                                                78
Differentiating again gives

             d2 log Y = d · d log Y(h) +  · d2 log Y(h)
                       = d · d log Y(h) + d2 log W -  h (d log Yh )2 + d log Y2 .
                                                          h

Using the fact that


     dh = h d log h = h Ebh [d log p] + d log Yh -   j Ebj [d log p] + d log Yj            ,
                                                              j


we have evaluating at t1 ,


d2 log Y =    h     Ebh [d log p] + d log Yh -   j Ebj [d log p] + d log Yj     d log Yh
             h                                  j

        + d2 log W -  h (d log Yh )2 + d log Y2
                         h

        =  h Ebh [d log p]d log Yh +  h d log Yh d log Yh -  h d log Yh   j Ebj [d log p] + d log Yj
             h                            h                        h              j

        + d2 log W -  h (d log Yh )2 + d log Y2
                         h
        = Cov (Ebh [d log p], d log Y(h) ) + d2 log W .

This implies that

                      d2 log W = d2 log Y - Cov (Ebh [d log p], d log Y(h) ).

Combining the first order and second order terms, changes in the social welfare function
are given to a second order approximation by

                1                    1          1
       d log W + d2 log W = d log Y + d2 log Y - Cov (Ebh [d log p], d log Y(h) ).
                2                    2          2




                                                79
