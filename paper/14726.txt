                                NBER WORKING PAPER SERIES




       OPTIMAL BANDWIDTH CHOICE FOR THE REGRESSION DISCONTINUITY
                              ESTIMATOR

                                           Guido Imbens
                                       Karthik Kalyanaraman

                                        Working Paper 14726
                                http://www.nber.org/papers/w14726


                      NATIONAL BUREAU OF ECONOMIC RESEARCH
                               1050 Massachusetts Avenue
                                 Cambridge, MA 02138
                                     February 2009




Financial support for this research was generously provided through NSF grants 0452590 and 0820361.
The views expressed herein are those of the author(s) and do not necessarily reflect the views of the
National Bureau of Economic Research.

NBER working papers are circulated for discussion and comment purposes. They have not been peer-
reviewed or been subject to the review by the NBER Board of Directors that accompanies official
NBER publications.

© 2009 by Guido Imbens and Karthik Kalyanaraman. All rights reserved. Short sections of text, not
to exceed two paragraphs, may be quoted without explicit permission provided that full credit, including
© notice, is given to the source.
Optimal Bandwidth Choice for the Regression Discontinuity Estimator
Guido Imbens and Karthik Kalyanaraman
NBER Working Paper No. 14726
February 2009
JEL No. C14

                                            ABSTRACT

We investigate the problem of optimal choice of the smoothing parameter (bandwidth) for the regression
discontinuity estimator. We focus on estimation by local linear regression, which was shown to be
rate optimal (Porter, 2003). Investigation of an expected-squared-error-loss criterion reveals the need
for regularization. We propose an optimal, data dependent, bandwidth choice rule. We illustrate the
proposed bandwidth choice using data previously analyzed by Lee (2008), as well as in a simulation
study based on this data set. The simulations suggest that the proposed rule performs well.


Guido Imbens
Department of Economics
Littauer Center
Harvard University
1805 Cambridge Street
Cambridge, MA 02138
and NBER
imbens@fas.harvard.edu

Karthik Kalyanaraman
Dept of Economics
Littauer Center
Harvard University
1805 Cambridge Street
Cambridge, MA 02138
kalyanar@fas.harvard.edu
1       Introduction

Regression discontinuity (RD) designs for evaluating causal effects of interventions, where as-
signment is determined at least partly by the value of an observed covariate lying on either
side of a threshold, were introduced by Thistlewaite and Campbell (1960). See Cook (2008)
for a historical perspective. A recent surge of applications in economics includes studies of the
impact of financial aid offers on college acceptance (Van Der Klaauw, 2002), school quality on
housing values (Black, 1999), class size on student achievement (Angrist and Lavy, 1999), air
quality on health outcomes (Chay and Greenstone, 2005), and incumbency on reelection (Lee,
2008). Recent important theoretical work has dealt with identification issues (Hahn, Todd, and
Van Der Klaauw, 2001, HTV from hereon), optimal estimation (Porter, 2003), tests for validity
of the design (McCrary, 2008), quantile effects (Frandsen, 2008; Frölich and Melly, 2008), and
the inclusion of covariates (Frölich, 2007). General surveys include Lee and Lemieux (2009),
Van Der Klaauw (2008), and Imbens and Lemieux (2008).
        In RD settings analyses typically focus on the average effect of the treatment for units
with values of the forcing variable close to the threshold, using kernel, local linear, or global
polynomial series estimators. Fan and Gijbels (1992) and Porter (2003) show that local linear
estimators are rate optimal and have attractive bias properties. A key decision in implementing
these methods is the choice of bandwidth. Since the focus is solely on the change in the
value of the regression function at the threshold, standard plug-in methods and cross-validation
methods, which choose a bandwidth that is optimal for estimating the regression function over
the entire support, do not yield an optimal bandwidth here. The two contributions of this paper
are (i), the derivation of the optimal bandwidth for this setting, and (ii), a data-dependent
method for choosing the bandwidth that is asymptotically optimal.1 Simulations indicate that
the proposed algorithm works well in realistic settings.


2       Basic model

In the basic RD setting, researchers are interested in the causal effect of a binary treatment. In
the setting we consider we have a sample of N units, drawn randomly from a large population.
For unit i, i = 1, . . ., N , the variable Yi (1) denotes the potential outcome for unit i given
treatment, and Yi (0) the potential outcome without treatment. For unit i we observe the
    1
    Software     for    implementing    this     bandwidth      rule is available on the    website
http://www.economics.harvard.edu/faculty/imbens/imbens.html. This is at the moment limited to Mat-
lab. In the near future a STATA version will also be available.



                                                 2
treatment received, Wi , equal to one if unit i was exposed to the treatment and 0 otherwise,
and the outcome corresponding to the treatment received:
          
             Yi (0)      if Wi = 0,
     Yi =
             Yi (1)      if Wi = 1.
We also observe for each unit a scalar covariate, called the forcing variable, denoted by Xi .
Define

      m(x) = E[Yi |Xi = x],

to be the conditional expectation of the outcome given the forcing variable. The idea behind
the Sharp Regression Discontinuity (SRD) design is that the treatment Wi is determined solely
by the value of the forcing variable Xi being on either side of a fixed, known threshold c, or:

      Wi = 1Xi ≥c .

In Section 5 we extend the SRD setup to the case with additional covariates and to the Fuzzy
Regression Discontinuity (FRD) design, where the probability of receiving the treatment jumps
discontinuously at the threshold for the forcing variable, but not necessarily from zero to one.
   In the SRD design the focus is on average effect of the treatment for units with covariate
values equal to the threshold:

      τRD = E[Yi (1) − Yi (0)|Xi = c].

Now suppose that the conditional distribution functions FY (0)|X (y|x) and FY (1)|X (y|x) are con-
tinuous in x for all y, and that the conditional first moments E[Yi (1)|Xi = x] and E[Yi (0)|Xi = x]
exist, and are continuous at x = c. Then

      τRD = µ+ − µ− ,         where µ+ = lim m(x),           and   µ− = lim m(x).
                                           x↓c                            x↑c

Thus, the estimand is the difference of two regression functions evaluated at boundary points.
   We focus on estimating τRD by local linear regressions on either side of the threshold. Local
nonparametric methods are attractive in this setting because of the need to estimate regression
functions consistently at a point. Furthermore, in the RD setting local linear regression esti-
mators are preferred to the standard Nadaraya-Watson kernel estimator, because local linear
methods have been shown to have attractive bias properties in estimating regression functions
at the boundary (Fan and Gijbels, 1992), and enjoy rate optimality (Porter, 2003). To be
explicit, we estimate the regression function m(·) at x as
                
                  α̂− (x)        if x < c,
      m̂h (x) =                                                                                (2.1)
                  α̂+ (x)        if x ≥ c.

                                                 3
where,
                                         N                                                     
                                         X                                  2          Xi − x
          (α̂− (x), β̂−(x)) = arg min          1Xi <x · (Yi − α − β(Xi − x)) · K                    ,
                                   α,β                                                   h
                                         i=1

and
                                         N                                                     
                                         X                                  2          Xi − x
          (α̂+ (x), β̂+(x)) = arg min          1Xi >x · (Yi − α − β(Xi − x)) · K                    ,
                                   α,β                                                   h
                                         i=1

Then

          τ̂RD = µ̂+ − µ̂− ,

where

          µ̂− = lim m̂h (x) = α̂− (c)           and µ̂+ = lim m̂h (x) = α̂+ (c).
                x↑c                                         x↓c


3       Error Criterion and Infeasible Optimal Bandwidth Choice

The primary question studied in this paper concerns the optimal choice of the bandwidth h. In
the current empirical literature researchers often choose the bandwidth by either crossvalidation
or ad hoc methods. See Härdle (1992) for a textbook discussion of cross-validation and related
methods, and see Lee and Lemieux (2009) for a comprehensive discussion of current practice in
RD settings. Conventional crossvalidation yields a bandwidth that is optimal for fitting a curve
over the entire support of the data.2 In other words, it attempts to choose the bandwidth to
minimize an approximation to the mean integrated squared error criterion (MISE),
                  Z                          
     MISE(h) = E     (m̂h (x) − m(x))2 f (x)dx .
                               x

This criterion is not directly relevant for the problem at hand: we wish to choose a bandwidth
that is optimal for estimating τRD . This estimand has a number two special features. First, it
depends on m(x) only through two values, and specifically their difference. Second, both these
values are boundary values.
        Our proposed criterion is
                                2                              2 
         MSE(h) = E τ̂RD − τRD         = E (µ̂+ − µ+ ) − (µ̂− − µ− )      .                             (3.2)

    2
    See Ludwig and Miller (2005) and Lee and Lemieux (2009) for a discussion of crossvalidation methods
designed more specifically for the RD setting. These methods are discussed in more detail in Section 4.4.



                                                           4
Let h∗ be the optimal bandwidth that minimizes this criterion:

        h∗ = arg min MSE(h).                                                                     (3.3)

This bandwidth is obviously not feasible, and so we will use an approximations to this oracle
bandwidth. The first part of the approximation is that we focus on values of h close to zero,
at least asymptotically. In principle, for a specific regression function in combination with a
specific distribution for the forcing variable it may well be that the optimal bandwidth does not
converge to zero with the sample size. In such cases the optimal bandwidth is very sensitive to
the actual distribution and regression function, and it is difficult to see how one could exploit
such knife-edge cases.
   The next step is to derive an asymptotic expansion of (4.16). First we state the key as-
sumptions. Not all of these will be used immediately, but for convenience we state them all
here.

Assumption 3.1: (Yi , Xi), for i = 1, . . . , N , are independent and identically distributed.

Assumption 3.2: The marginal distribution of the forcing variable Xi, denoted f (·), is right
and left continuous at the discontinuity, c, with limits limx↓c f (x) = f+ (c) > 0 and limx↑c f (x) =
f− (c) > 0 respectively.

Assumption 3.3: The conditional mean m(x) = E[Yi |Xi = x] has p ≥ continuous derivatives
almost everywhere. The right and left limits of the kth derivative of m(x) at the threshold c are
            (k)            (k)
denoted m+ (c) and m− (c).

Assumption 3.4: The kernel K(·) is smooth and has compact support.

Assumption 3.5: The conditional variance function σ 2 (x) = Var(Yi |Xi = x) is bounded ev-
                                                                                       2
erywhere, and right and left continuous at c. The right and left limit are denoted by σ+ (c) and
 2
σ− (c) respectively.

                                                                       (2)          (2)
Assumption 3.6: The second derivatives at the right and left, m+ (x) and m− (x), differ at
                  (2)            (2)
the threshold: m+ (c) 6= m− (c).

Now define the Asymptotic Mean Squared Error (AMSE) as a function of the bandwidth:
                                                      2        2     
                     4
                        
                           (2)      (2)
                                         2    C2     σ+ (c) σ−   (c)
    AMSE(h) = C1 · h · m+ (c) − m− (c) +           ·         +          .         (3.4)
                                              N ·h    f+ (c)   f− (c)


                                                 5
The constants C1 and C2 in this approximation are functions of the kernel:
                                       2
                         ν22 − ν1 ν3                               ν22 π0 − 2ν1 ν2 π1 + ν12 π2
                     
           1
      C1 =                                  ,     and C2 =                                     ,
           4             ν2 ν0 − ν12                                      (ν2 ν0 − ν12 )2

where
             Z       ∞                                       Z    ∞
                          j
      νj =               u K(u)du,              and   πj =             uj K 2 (u)du.
                 0                                           0

The first term in (3.4) corresponds to the square of the bias, and the second term corresponds
to the variance. This expression clarifies the role that Assumption 3.6 will play. If the left and
right limits of the second derivative are equal, then the leading term in the expansion of the
square of the bias is not of the order h4 . Instead the leading bias term would be of lower order.
It is difficult to exploit the improved convergence rate that would result from this in practice,
because it would be difficult to establish sufficiently fast that this difference is indeed zero, and
so we focus on optimality results given Assumption 3.6. Note however, that we will not rely on
Assumption 3.6 for consistency of the estimator for the average treatment effect.

Lemma 3.1: (Mean Squared Error Approximation and Optimal Bandwidth)
(i) Suppose Assumptions 3.1-3.5 hold. Then
                                         
                                4     1
      MSE(h) = AMSE(h) + o h +              .
                                     N ·h

(ii) Suppose Assumptions 3.1-3.6 hold. Then
                                                                                      1/5
                                                                  2 (c)
                                                                 σ+            2 (c)
                                                                              σ−
                                                                 f+ (c)   +   f− (c)
      hopt = arg min AMSE(h) = CK ·                                                         · N −1/5 ,   (3.5)
                                                         
                                                       2 
                  h                     (2)      (2)
                                       m+ (c) − m− (c)

where CK = (C2 /(4 · C1 ))1/5 , indexed by the kernel K(·).

For the edge kernel, with K(u) = 1|u|≤1 (1 − |u|), shown by Cheng, Fan and Marron (1997)
to have AMSE-minimizing properties for boundary estimation problems, the constant is CK ≈
3.4375.


4   Feasible Optimal Bandwidth Choice

In this section we discuss the proposed bandwidth, provide a full data-dependent estimator for
the bandwidth, and discuss its properties.



                                                                   6
4.1     Proposed bandwidth

A natural choice for the estimator for the optimal bandwidth estimator is to replace the six
unknown quantities in the expression for the optimal bandwidth hopt, given in (4.13) by non-
parametric estimators. We make three modifications to this approach, motivated partly by the
desire to reduce the variance of the estimated bandwidth ĥopt, and partly by considerations
regarding the structure of the problem.
      The first two modification involve estimating a single density f (c) and a single conditional
variance σ 2 (c), rather than allowing the density and conditional variance functions to have
discontinuities at the threshold. For the density the motivation is largely the concern that if
the density is discontinuous at the threshold, the validity of the design is typically questioned.
(In fact, this is the basis for the test proposed by McCrary, 2008.) For the use of a single
conditional variance the motivation is largely that in practice the degree of heteroskedasticity
tends to be modest, and so any estimated differences will tend to be largely due to uncertainty
in the estimates rather than actual differences. These two modifications suggest using
                                               1/5
                                        ˆ
                           2 · σ̂ 2 (c)/f(c)
        h̃opt = CK ·                                 · N −1/5.                              (4.6)
                                               
                                             2 
                          (2)           (2)
                        m̂+ (c) − m̂− (c)

We introduce one more modification. The motivation for the third modification is the concern
                                                                        (2)          (2)
that the precision with which we estimate the second derivatives m+ (c) and m− (c) may be
so low, that the estimated optimal bandwidth h̃opt will occasionally be very large, even when
the data are consistent with a substantial degree of curvature. To address this problem we add
a regularization term to the denominator in (4.6). This regularization term will be choosen
carefully to decrease with the sample size, therefore not compromising asymptotic optimality.
Including this regularization term guards against unrealistically large bandwidth choices when
the curvature of the regression function is imprecisely estimated.
      We use as the regularization term the approximate variance of the estimated curvature.
This allows the regularization term to be invariant to the scale of the data. To be explicit,
                                          (2)
we estimate the second derivative m+ (c) by fitting to the observations with Xi ∈ [c, c + h] a
quadratic function. The bandwidth h here may be different from the bandwidth ĥopt used in
the estimation of τRD , and its choice will be discussed in Section 4.2. Let Nh,+ be the number
of units with covariate values in this interval. We assume homoskedasticity with error variance




                                                       7
σ 2 (c) in this interval. Let

                       1           X                                               1         X
        µ̂j,h,+ =                          (Xi − X)j ,        where X =                            Xi ,
                    Nh,+                                                        Nh,+
                               c≤Xi ≤c+h                                               c≤Xi ≤c+h

be the j-th (centered) moment of the Xi in this interval to the right of the threshold. We can
derive the following explicit formula for the conditional variance of the curvature (viz. twice
the coefficient on the quadratic term), denoted by r+ , in terms of these moments:

                                    σ 2 (c)
                                                              
              4
      r+ =
             Nh,+ µ̂4,h,+ − (µ̂2,h,+ )2 − (µ̂3,h,+ )2 /µ̂2,h,+

      However, to avoid estimating fourth moments, we approximate this expression exploiting
the fact that for small h, the distribution of the forcing variable can be approximated by a
uniform distribution on [c, c + h], so that µ̂2,h,+ ≈ h2 /12, µ̂3,h,+ ≈ 0, and µ̂4,h,+ ≈ h4 /60. After
substituting σ̂ 2 (c) for σ 2 (c) this leads to

                720 · σ̂ 2 (c)                                      720 · σ̂ 2 (c)
        r̂+ =                  ,           and similarly r̂− =                     .
                 Nh,+ · h4                                           Nh,− · h4

      The proposed bandwidth is now obtained by adding the regularization terms to the curva-
tures in the bias term of MSE expansion:
                                                                       1/5
                                 2·                    ˆ
                                              σ̂ 2 (c)/f(c)
        ĥopt = CK ·                                                          · N −1/5 ,                (4.7)
                                                        
                                         2              
                          (2)       (2)
                        m̂+ (c) − m̂− (c) + (r̂+ + r̂− )

                                                                                          (2)
To operationalize this proposed bandwidth, we need specific estimators fˆ(c), σ̂ 2 (c), m̂− (c),
        (2)
and m̂+ (c). We provide a specific proposal for this in the next section.

4.2     Algorithm for bandwidth selection

The reference bandwidth ĥopt is a function of the outcome variable Y = (Y, , . . ., YN ), the
forcing variable X = (X1 , . . ., XN ) and the chosen kernel; i.e. ĥopt = h(Y, X). We give below
a general algorithm for a specific implementation. In practice we recommend using the edge
optimal kernels, where K(u) = 1|u|≤1 · (1 − |u|), although the algoritm is easily modified for
other kernels by changing the kernel-specific constant CK .
      To calculate the bandwidth we need estimators for the density at the threshold, f (c), the
conditional variance at the threshold, σ 2 (c), and the limits of the second derivatives at the
                                                      (2)         (2)
threshold from the right and the left, m+ (c), m− (c). (The other components of (4.7), r̂− and
r̂+ are functions of these four components.) The first two functionals are calculated in step 1,


                                                              8
the second two in step 2. Step 3 puts these together with the appropriate kernel constant CK
to produce the reference bandwidth.

Step 1: Estimation of density f (c) and conditional variance σ 2 (c)
                                                              2
                                                                                           P             2
First calculate the sample variance of the forcing variable, SX =                               Xi − X        /(N − 1). We
now use the Silverman rule to get a pilot bandwidth for calculating the density and variance
at c. The standard Silverman rule of h = 1.06 · SX · N −1/5 is based on a normal kernel and a
normal reference density. We modify this for the uniform kernel on [−1, 1] and calculate the
pilot bandwidth h1 as:

      h1 = 1.84 · SX · N −1/5 .

Calculate the number of units on either side of the threshold, and the average outcomes on
either side as
                  N
                  X                                                  N
                                                                     X
      Nh1 ,− =          1c−h1 ≤Xi <c ,                   Nh1 ,+ =          1c≤Xi ≤c+h1 ,
                  i=1                                                i=1

                    1          X                                                       1          X
      Y h1 ,− =                            Yi ,                and     Y h1 ,+ =                              Yi .
                  Nh1 ,−                                                             Nh1 ,+
                           i:c−h1 ≤Xi <c                                                      i:c≤Xi ≤c+h1

Now estimate the density of Xi at c as

                Nh1 ,− + Nh1 ,+
      fˆX (c) =                 ,                                                                                     (4.8)
                     N · h1

and estimate the conditional variance of Yi given Xi = x, at x = c, as
                                                                                     
                       1          X                    2     X                    2
     σ̂ 2 (c) =                           Yi − Y h1 ,− +              Yi − Y h1 ,+  .                               (4.9)
                Nh1 ,− + Nh1 ,+
                                         i:c−h1 ≤Xi <c                           i:c≤Xi <c+h1

The main property we will need for these estimators is that they are consistent for the density
and the conditional variance respectively. They need not be efficient.
                                                         (2)               (2)
Step 2: Estimation of second derivatives m̂+ (c) and m̂− (c)
   First we need a pilot bandwidth h2,+ . We base this on a simple, not necessarily consistent,
estimator of the third derivative of m(·) at c. First, calculate the median of Xi among the
observations with Xi ≥ c, call this median(X+ ), and the same for the median of Xi among the
observations with Xi < c, call this median(X− ). To be precise, if the number of observations
with Xi ≥ 0 is even, we define the median to be the average of the middle two observations.
Temporarily discard the observations with Xi < median(X− ), and the observations with Xi >

                                                               9
median(X+ ). Now fit a third order polynomial to the remaining data, including an indicator
for Xi ≥ 0. Thus, estimate the regression function

      Yi = γ0 + γ1 · 1Xi ≥c + γ2 · (Xi − c) + γ3 · (Xi − c)2 + γ4 · (Xi − c)3 + εi ,            (4.10)

and estimate m(3)(c) as m̂(3)(c) = 6 · γ̂4 . This will be our estimate of the third derivative of
the regression function. Note that m̂(3)(c) is in general not a consistent estimate of m(3) (c) but
will converge to a constant at a parametric rate. Let m3 = 6 · plim(γ̂4 ) denote this constant.
However we do not need a consistent estimate here to achieve what we ultimately need: a
consistent estimate of the constant in the reference bandwidth. Calculate h2,+ , using the σ̂ 2 (c)
and fˆ(c) from Step 1, as
                                                            1/7
                                          σ̂ 2 (c)                      −1/7
      h2,+ = 3.56                               2              N+         ,                (4.11)
                          fˆ(c) max       m̂(3)(c) , 0.01

and
                                                            1/7
                                          σ̂ 2 (c)                      −1/7
      h2,− = 3.56                               2              N−         .
                          fˆ(c) max       m̂(3)(c) , 0.01

The motivation for taking the maximum of (m̂(3)(c))2 and 0.01 is to avoid problems if m3 =
6 · plim(γ̂4 ) is in fact equal to zero. In practice this is unlikely to be a problem, and for the
formal arguments the constant 0.01 can be replaced by any positive number. Without this
constant, h2,+ is in fact an estimate of the optimal bandwidth for calculation of the second
derivative at the boundary using a local quadratic. See the Appendix for details.
   Given this pilot bandwidth h2,+ , we estimate the curvature m(2)(c) by a local quadratic
fit. I.e. temporarily discard the observations other than the N2,+ observations with c ≤ Xi ≤
c + h2,+ . Label the new data Ŷ+ = (Y1 , . . ., YN2,+ ) and X̂+ = (X1 , . . . , XN2,+ ) each of length
N2,+ . Fit a quadratic to the new data. I.e. let T = [ι T1 T2 ] where ι is a column vector
of ones, and T0j = (X1 − c)j , . . ., (XN2,+ − c)j , for j = 1, 2. Estimate the three dimensional
                                                  

                                                                                       (2)
regression coefficient vector, λ̂ = (T0 T)−1 T0 Ŷ. Calculate the curvature as m̂+ (c) = 2 · λ̂3 .
                                              (2)           (2)
This is a consistent estimate of m+ (c). For m̂− (c) follow the same procedure using the data
with c − h2,− ≤ Xi < c.

Step 3: Calculation of Regularization Terms r̂− and r̂+ , and Calculation of ĥopt
Given the previous steps, the regularization terms are calculated as
              720 · σ̂ 2 (c)                         720 · σ̂ 2 (c)
      r̂+ =                  ,        and r̂− =                     .                           (4.12)
              N2,+ · h42,+                           N2,− · h42,−

                                                            10
We now have all the pieces to calculate the proposed bandwidth:
                                                           1/5
                                            2σ̂ 2 (c)
                                                                         · N −1/5 .
                                                                    
        ĥopt = CK ·                               2                               (4.13)
                                     (2)        (2)
                         fˆ(c) ·
                                                                    
                                   m̂+ (c) − m̂− (c) + (r̂+ + r̂− )

where CK is, as in Lemma 3.1, a constant that depends on the kernel used. For the edge kernel,
with K(u) = (1 − |u|) · 1|u|≤1 , the constant is CK ≈ 3.4375.
      G8iven ĥopt , we estimate τRD as

        τ̂RD = lim m̂ĥopt (x) − lim m̂ĥopt (x),
                x↓c               x↑c

where m̂h (x) is as defined in (2.1).

4.3     Properties of algorithm

For this algorithm we establish certain optimality properties. First, the resulting RD estimator
is consistent at the best rate for nonparametric regression functions at a point (Stone, 1982).
Second, as the sample size increases, the estimated constant term in the reference bandwidth
converges to the best constant. Third, we also have an “asymptotic no-regret” or Li (1987)
type consistency result for the mean squared error and consistency at the optimal rate for the
RD estimate.

Theorem 4.1: (Properties of ĥopt)
Suppose Assumptions 3.1-3.5 hold. Then:
(i)
                               
        τ̂RD − τRD = Op N −12/35 ,                                                       (4.14)

(ii) Suppose also Assumption 3.6 holds. Then:
                             
        τ̂RD − τRD = Op N −4/5 ,                                                         (4.15)

(iii)

        ĥopt − hopt
                     = op (1),                                                           (4.16)
            hopt
and (iv):

        MSE(ĥopt) − MSE(hopt)
                               = op (1).                                                 (4.17)
             MSE(hopt)


                                                    11
Note that if Assumption 3.6 fails, the convergence rate for τ̂RD is slower. This is somewhat
counterintuitive. The conventional intuition goes as follows. If Assumption 3.6 fails, the leading
term in the bias vanishes, and the square of the bias becomes of order O(h6 ). Because the
variance remains of order O((N h)−1 ), the optimal rate for the bandwidth becomes N −1/7 ,
and the optimal rate for the MSE becomes N −6/7 and thus the optimal rate for τ̂RD − τRD
becomes N −3/7 , better than the N −2/3 we have when Assumption 3.6 holds. The reason
this does not show up in the theorem is that the optimal bandwidth does not adapt to the
vanishing of the difference in second derivatives. If Assumption 3.6 fails, the bandwidth goes
to zero as N −4/35 (instead of the optimal N −1/7 ), and so the MSE becomes N −24/35, leading
to τ̂RD − τRD = Op (N −12/35), slower than the optimal rate of N −3/7 , and even slower than the
rate we achieve when Assumption 3.6 holds (N −2/5). One could modify the regularization term
to take account of this, but in practice it is unlikely to make a difference.

4.4   Ludwig-Miller Cross-validation

In this section we briefly describe the cross-validation method proposed by Ludwig and Miller
(2005, LM from hereon), which we will compare to our proposed bandwidth in the application
and simulations. See also Lee and Lemieux (2009). The LM bandwidth is the only proposed
bandwidth selection procedure in the literature that is specifically aimed at providing a band-
width in a regression discontinuity setting. Let N− and N+ be the number of observations with
Xi < c and Xi ≥ c respectively. For δ ∈ (0, 1), let θ− (δ) and θ+ (δ) be the δ-th quantile of the
Xi among the subsample of observations with Xi < c and Xi ≥ c respectively, so that
                          N
                     (             !         )
                          X
     θ− (δ) = arg min a      1Xi ≤a ≥ δ · N− ,
                        a
                                  i=1

and
                                  N
                            (                      !              )
                                  X
      θ+ (δ) = arg min a                1c≤Xi ≤a       ≥ δ · N+       .
                        a
                                  i=1

Now the LM cross-validation criterion we use is of the form:
                  N
                  X
      CVδ (h) =         1θ− (δ)≤Xi ≤θ+ (1−δ) · (Yi − m̂h (Xi ))2 .
                  i=1

(In fact, LM use a slightly different criterion function, where they sum up over all observations
within a distance h0 from the threshold.) The estimator for the regression function here is m̂h (x)
defined in equation (2.1). A key feature of this estimator is that for values of x < c, it only uses

                                                          12
observations with Xi < x to estimate m(x), and for values of x ≥ c, it only uses observations
with Xi > x to estimate m(x), so that m̂h (Xi) does not depend on Yi , as is necessary for cross-
validation. By using a value for δ close to zero, we only use observations close to the threshold
to evaluate the cross-valdiation criterion. The only concern is that by using too small value of
δ, we may not get a precisely estimated cross-validation bandwidth. In a minor modification of
the LM proposal we use the edge kernel instead of the Epanechnikov kernel they suggest. In our
calculations we use δ = 0.5. Any fixed value for δ is unlikely to lead to an optimal bandwidth
in general. Moreover, the criterion focuses implicitly on minimizing a criterion more akin to
E (µ̂+ − µ+ )2 − (µ̂− − µ− )2 , (with the errors in estimating µ− and µ+ squared before adding
                            

them up, rather than rather than MSE(h) = E[((µ̂+ − µ+ ) − (µ̂− − µ− ))2 ] in (4.16), where the
error in the difference µ+ − µ− is squared. As a result t even letting δ → 0 with the sample
size in the cross-validation procecure is unlikely to result in an optimal bandwidth.


5     Extensions
5.1    The Fuzzy Regression design

In the Fuzzy Regression Discontinuity Design (FRD) the treatment Wi is not a deterministic
function of the forcing variable. Instead the probability Pr(Wi = 1|Xi = x) changes discontin-
uously at the threshold c. In an important theoretical paper HTV discussion identification in
this setting. The focus is on the ratio

                 limx↓c E [Yi |Xi = x] − limx↑c E [Yi |Xi = x]
       τFRD =                                                  .
                limx↓c E [Yi |Wi = x] − limx↑c E [Wi |Xi = x]

In principle we need to estimate two regression functions, each at two boundary points: the
expected outcome given the forcing variable E[Yi |Xi = x] to the right and left of the threshold
c and the expected value of the treatment variable given the forcing variable E[Wi |Xi = x],
again both to the right and left of c. Thus, in principle there are four bandwidth choices to be
made. However just as we argued for a single bandwidth in the SRD setting one might make
the same argument here though with less force. We follow the suggestion however of Imbens
and Lemieux (2008): i.e. use the algorithm above and estimate two optimal bandwidths, one
for the outcome regression, say ĥYopt, and one for the treatment regression, ĥW
                                                                                opt . It might be

appealing conceptually to use the same bandwidth for both ĥFRD,opt, and one could simply take
the optimal bandwidth for the outcome variable: ĥFRD,opt = ĥYopt , given that the discontinuity
in the treatment regression is typically precisely estimated.



                                                   13
5.2    Additional covariates

Typically the presence of additional covariates does not affect the regression discontinuity anal-
yses very much. In most cases the distribution of the additional covariates does not exhibit
any discontinuity around the threshold for the forcing variable, and as a result those covariates
are approximately independent of the treatment indicator for samples constructed to be close
to the threshold. In that case the covariates only affect the precision of the estimator, and one
can modify the previous analysis using the conditional variance of Yi given all covariates at the
threshold. In practice this does not affect the optimal bandwidth much unless the additional
covariates have great explanatory power (recall that the variance enters to the power 1/5), and
the basic algorithm is likely to perform adequately even in the presence of covariates.


6     An Illustration and Some Simulations
6.1    Data

To illustrate the implementation of these methods we use data previously analyzed by Lee (2008)
in one of the most convincing applications of regression discontinuity designs. Lee studies the
incumbency advantage in elections. His identification strategy is based on the discontinuity
generated by the rule that the party with a majority vote share wins. The forcing variable Xi
is the difference in vote share between the Democratic and Republican parties in one election,
with the threshold c = 0. The outcome variable Yi is vote share at the second election. There
are 6558 observations (districts) in this data set, 3818 with Xi > 0, and 2740 with Xi < 0. The
difference in voting percentages at the last election for the Democrats was 0.13, with a standard
deviation of 0.46. Figure 1 plots the density of the forcing variable, in bins with width 0.05.
Figure 2 plots the average value of the outcome variable, in 40 bins with width 0.05, against
the forcing variable. The discontinuity is clearly visible in the raw data, lending credibility to
any positive estimate of the treatment effect.

6.2    IK algorithm on data

In this section we implement our proposed bandwidth on the Lee dataset. For expositional
reasons we gave all the intermediate steps.

Step 1: Estimation of density f (0) and conditional variance σ 2 (0)
We start with the modified Silverman bandwidth,

       h1 = 1.84 · SX · N −1/5 = 1.84 · 0.4553 · 6558−1/5 = 0.1445.


                                                 14
There are Nh1 ,− = 836 units with values for Xi in the interval [−h1 , 0), with an average outcome
                                              2
of Y h1 ,− = 0.4219 and a sample variance of SY,h     = 0.10472, and Nh1 ,+ = 862 units with
                                                 1 ,−

values for Xi in the interval [0, h1], with an average outcome of Y h1 ,+ = 0.5643 and a sample
             2
variance of SY,h     = 0.12022. This leads to
                1 ,+

              Nh1 ,− + Nh1 ,+       836 + 862
      fˆ(0) =                 =                   = 0.8962,
                2 · N · h1      2 · 6558 · 0.1445
and
                                   2
                   (Nh1 ,− − 1) · SY,h                      2
                                           + (Nh1,+ − 1) · SY,h
                                      1 ,−                     1 ,+
      σ̂ 2 (0) =                                                        = 0.11282.
                                     Nh1 ,− + Nh1 ,+

                                                       (2)        (2)
Step 2: Estimation of second derivatives m̂+ (0) and m̂− (0)
To estimate the curvature at the threshold, we first need to choose bandwidths h2,+ and h2,− .
We choose these bandwidths based on an estimate of m̂(3)(0), obtained by fitting a global cubic
with a jump at the threshold. We estimate this global cubic regression function by dropping
observations with covariate values below the median of the covariate for observations with
covariate values below the threshold, and dropping observations with covariate values above
the median of the covariate for observations with covariate values above the threshold. For
the 2740 (3818) observations with Xi < 0 (Xi > 0), the median of the forcing variable is -
0.2485 (0.3523). Next, we estimate, using the data with Xi ∈ [−0.2485, 0.3523], the polynomial
regression function of order three, with a jump at the threshold:

      Yi = γ0 + γ1 · Xi + γ2 · Xi2 + γ3 · Xi3 + γ4 · 1Xi ≥0 + εi .

The least squares estimate for γ3 is γ̂3 = −0.9102, and thus the third derivative at zero is
estimated as m̂(3)(0) = 6 · γ̂3 = −5.4611. This leads to the two bandwidths
                                               1/7
                                σ̂ 2 (0)
   h2,+ = 3.56 ·                        2    · N+−1/7 = 0.3674,        and h2,− = 0.3852.
                   ˆ                  (3)
                   f (0) · max m̂ (0) , 0.01

The two pilot bandwidths are used to fit two quadratics. The quadratic to the right of 0 is fitted
                               (2)
on [0, 0.3674], yielding m̂+ (0) = −0.5233 and the quadratic to the left is fitted on [-0.3852, 0]
            (2)
yielding m̂− (0) = 0.4904.

Step 3: Calculation of Regularization Terms r̂− and r̂+ , and Calculation of ĥopt
Next, the regularization terms are calculated. We obtain
              720 · σ̂ 2 (0)   720 · 0.11282                                   720 · σ̂ 2 (0)
      r̂+ =                  =                = 0.2634            and r̂− =                   = 0.3036.
               N2,+h42,+       1983 · 0.36744                                   N2,− h42,−

                                                             15
Now we have all the ingredients to calculate the optimal bandwidth under different kernels and
the corresponding RD estimates. Using the edge kernel with CK = 3.4375, we obtain
                                                               1/5
                                     2 · σ̂ 2 (0)
                                                                       N −1/5 = 0.2649.
                                                              
      ĥopt = CK                               2          
                               (2)        (2)
                     fˆ(0) · m̂+ (0) − m̂− (0) + (r̂+ + r̂− )
                                                              


Without the regularization the bandwidth would be h̃opt = 0.2892.

6.3   Six Estimates of the Effect of Incumbency for the Lee Data

Here we calculate six estimates of the ultimate object of interest, the size of the discontinuity in
m(x) at zero. The first four are based on local linear estimation with the edge kernel, and the
bandwidth choosen optimally (ĥopt), optimally without regularization (h̃opt), or cross-validation
(ĥcv , with δ = 0.5). For comparison we report estimates on global least squares regression
of polynomial regression functions on either side of the threshold, using a first, second and
third order polynomial. The point estimates and standard errors are presented in Table 1.
To investigate the sensitivity to the bandwidth choice, Figure 3 plots the RD estimates, and
the associated 95% confidence intervals, as a function of the bandwidth, for h between 0 and
0.5. The solid vertical line indicates the optimal bandwidth (ĥopt = 0.2649), and the dashed
vertical line the LM cross-validation bandwidth hcv = 0.2231, based on δ = 0.5. For the LM
cross-validation, Figure 4 shows the criterion function for δ = 0.5.

6.4   A Small Simulation Study

Next we conduct a small Monte Carlo study assess the properties of the proposed bandwidth
selection rule in practice. We consider two designs, Designs I, and II, and two sample sizes,
N = 100, and N = 500. In all cases we use normal disturbances, with standard deviation
equal to the standard deviation of the outcome in the Lee data set, SY = 0.2411. The density
of the forcing variable is that of 2 · Zi − 1, were Zi has a Beta distribution with parameters
α = 2 and β = 4. The two designs differ in the population regression function. The first design
is motivated by the configuration of the Lee data. The regression function is a 5-th order
polynomial, with separate coefficients for Xi < 0 and Xi > 0, with the coefficients estimated
on the Lee data, leading to

                  0.52 + 0.76x − 2.29x2 + 5.66x3 − 5.87x4 + 2.09x5
              
                                                                                  if x < 0,
     mI (x) =
                  0.48 + 1.43x + 8.69x2 + 25.50x3 + 29.16x4 + 11.13x5             if x ≥ 0.



                                                16
In the second design the regression function is quadratic:

                  3x2
                
                              ifx < 0,
      mII (x) =
                  4x2         ifx ≥ 0,

implying the data generating process is close to the point where the bandwidth hopt is infinite
(because the left and right limit of the second derivative are 6 and 8 respectively), and one may
expect substantial effect from the regularization.
    We report results for five bandwidth choices in Table 2. The first two are infeasible: the
optimal bandwith h∗ , which minimizes the expected squared error, and hopt, which minimizes
the asymptotic approximation to the expected squared error In addition we report the results
based on the proposed bandwidth ĥopt, the non-regularized bandwidth h̃opt, and the Ludwig-
Miller cross-validation bandwidth ĥcv . In Table 2 we present for the two designs, for the two
sample sizes and the five bandwidth choices the mean (MEAN) and standard deviation (STD)
of the bandwidth choices, and the bias (BIAS) and the root-mean-squared-error (RMSE) of the
estimator for τ . In the design inspired by the Lee data the optimal bandwidth h∗ is quite high.
This bandwidth choice outperforms the feasible ones in terms of RMSE quite substantially.
Among the feasible bandwidth choices the unregularized bandwidth choice performs slightly
better in terms of RMSE than the regularized one: both are substantially better than cross-
validation. The slight improvement of the unregularized bandwidth comes at the expense of
substantially more variation in the bandwidth choice across simulations: the standard deviation
of the bandwidth choice is higher by a factor four. This remains true even in the larger sample.
    In the second design the regularized bandwidth choice substantially outperforms the other
feasible bandwidth choices. It has lower RMSE and substantially less variation.


7   Conclusion

In this paper we propose a fully data-driven, asymptotically optimal bandwidth choice for
regression discontinuity settings. This bandwidth choice can provide an objective starting
point for assessing sensitivity to bandwidth choice in such settings. The proposed procedure is
the first available procedure with optimality properties. The bandwidth selection procedures
commonly used in this literature are typically based on global measures, not tailored to the
specific features of the regression discontinuity setting. We compare our proposed bandwidth
selection procedure to the cross-validation procedure developed by Ludwig and Miller (2005),
which is tailored to the regression discontinuity setting, but which requires the researcher to
specify an additional tuning parameter. We find that our proposed method works well in


                                               17
realistic settings motivated by data previously analyzed by Lee (2008).


                                                                      Appendix

To obtain the MSE expansions for the RD estimand, we first obtain the bias and variance estimates from
estimating a regression function at a boundary point. Fan and Gijbels (1992) derive the same claim but under
weaker assumptions (such as thin tailed kernels rather than compact kernels) and hence their proof is less
transparent and not easily generalizable to multiple dimensions and derivatives. The proof we outline is based
on Ruppert and Wand (1994) but since they only cursorily indicate the approach for a boundary point in multiple
dimensions, we provide a simple proof for our case.

Lemma A.1: (MSE for Estimation of a Regression Function at the Boundary)
Suppose (i) we have N pairs (Yi , Xi ), independent and identically distributed, with Xi ≥ 0, (ii), m(x) = E[Yi |Xi =
x] is three times continuously differentiable, (iii), the density of Xi , f (x), is continuously differentiable at x = 0,
with f (0) > 0, (iv), the conditional variance σ2 (x) = Var(Yi |Xi = x) is bounded, and continuous at x = 0, (v),
                                                                     Ru
we have a kernel K : R+ 7→ R, with K(u) = 0 for u ≥ u, and 0 K(u)du = 1, and define Kh (u) = K(u/h)/h.
Define µ = m(0), and
                                 N
                                 X
        (µ̂h , β̂h ) = arg min         (Yi − µ − β · Xi )2 · Kh (Xi ) .
                         µ,β
                                 i=1

Then:
                                          1/2
        E [ µ̂| X1 , . . . , XN ] − µ = C1 m(2) (0)h2 + op h2 ,
                                                            ` ´
                                                                                                                   (A.1)

                                        σ2 (0)
                                                     „    «
                                                        1
        V( µ̂| X1 , . . . , XN ) = C2           + op        ,                                                      (A.2)
                                       f (c)N h        Nh
and
                                                                              σ2 (0)
                                                                                          „       «
          ˆ         2˛
                     ˛                   ˜       “
                                                     (2)
                                                                 ”2
                                                                       4                    4   1
        E (µ̂ − µ) X1 , . . . , XN = C1 m                  (0)        h + C2          + op h +      ,              (A.3)
                                                                             f (0)N h          Nh
where the kernel-specific constants C1 and C2 are those given in Lemma 3.1.

Before proving Lemma A.1, we state and prove two preliminary results.
                             PN             j
Lemma A.2: Define Fj = N1      i=1 Kh (Xi )Xi . Under the assumptions in Lemma A.1, (i), for nonnegative
integer j,

       Fj = hj f (0)νj + op (hj ) ≡ hj (Fj∗ + op(1)),
          R∞
with νj = 0 tj K(t)dt and Fj∗ ≡ f (0)νj , and (ii), If j ≥ 1, Fj = op (hj−1 ).

Proof: Fj is the average of independent and identically distributed random variables, so
                       “           ”
      Fj = E [Fj ] + Op Var(Fj )1/2 .

The mean of Fj is, using a change of variables from z to x = z/h,
                Z ∞                          Z ∞
                    1 “z ” j
      E [Fj ] =       K       z f (z)dz = hj       K (x) xj f (hx)dx
                 0  h     h                   0
                   Z ∞                          Z ∞
                                                                  f (hx) − f (0)                        “  ”
              = hj      K (x) xj f (0)dx + hj+1      K (x) xj+1                  dx = hj f (0)νj + O hj+1 .
                    0                            0                      hx
The variance of Fj can be bounded by
                                        "„ „ ««                #
                                                      2                  Z ∞ “ “ ””2
       1 h            2  2j
                            i      1           Xi           2j        1             z
         E (Kh (Xi )) Xi =            E    K            · X i    =              K          · z 2j f (z)dz.
      N                         N h2            h                   N h2 0          h


                                                                           18
By a change of variables from z to x = z/h, this is equal to
                        ∞                                                                    «2 !
        h2j−1                                                  h2j−1                 hj
                Z                                          „           «        „                        „“       ”2 «
                                  2   2j                                                                      j
                            (K (x)) · x f (hx)dx = O                       =o                       =o        h          .
         N          0                                           N                   hN 1/2

Hence
                         “ ”                  “ ”       “                ”
        Fj = E [Fj ] + op hj = hj f (0)νj + op hj = hj · f (0)νj + op (1) .


                                      PN
Lemma A.3: Let Gj =               1
                                  N
                                    Kh2 (Xi )Xij σ2 (Xi ). Under the assumptions from Lemma A.1,
                                       i=1
                                                                  Z ∞
        Gj = hj−1 σ2 (0)f (0)πj (1 + op (1)) ,        with πj =       tj K 2(t)dt.
                                                                                    0


Proof: This claim is proved in a manner exactly like Lemma A.1, here using in addition the differentiability of
the conditional variance function. 

Proof of Lemma A.1: Define R = [ι X], where ι is a N -dimensional column of ones, define the diagonal
weight matrix W with (i, i)th element equal to Kh (Xi ), and define e1 = (1 0)0 . Then

        m̂(0) = µ̂ = e01 (R0 W R)−1 R0 W Y.

The conditional bias is B = E[m̂(0)|X1 , . . . , XN ] − m(0). Note that E(m̂(0)|X) = e01 (R0 W R)−1 R0 W M where
M = (m(X1 ), . . . , m(XN ))0 . Let m(k)(x) denote the kth derivative of m(x) with respect to x. Using Assumption
(ii) in Lemma A.1, a Taylor expansion of m(Xi ) yields:
                                                 1 (2)
        m(Xi ) = m(0) + m(1) (0)Xi +               m (0)Xi2 + Ti ,
                                                 2
where

        |Ti | ≤ sup m(3) (x) · Xi3 .
                 x

Thus we can write the vector M as
             „           «
                 m(0)
      M =R        (1)      + S + T.
                m (0)

where the vector S has ith element equal to Si = m(2) (0)Xi2 /2, and the vector T has typical element Ti . Therefore
the bias can be written as

        B = e01 (R0 W R)−1 R0 W M − m(0) = e01 (R0 W R)−1 R0 W (S + T ).

Using Lemma A.2 we have
        „         «−1                 „              «−1                        „                   «
            1 0                            F0   F1                  1            F2        −F1
              R WR               =                         =
            N                              F1   F2              F0F2 − F12      −F1          F0
                                      0                                               “                             ” 1
                                                   F2∗                             1            F1∗
                                             F0 F2 −(F1 )
                                               ∗  ∗       ∗  2 +   o p (1)     −   h                    2 + o p (1)
                                                                                      “ F0 F2 −(F
                                                                                           ∗   ∗
                                                                                                     1)
                                                                                                     ∗
                                 =    @     “
                                                      F1∗
                                                                           ”
                                                                                               F0∗
                                                                                                                    ” A
                                        − h1 F ∗ F ∗ −(F    ∗ )2 + op ((1)       h
                                                                                  1
                                                                                   2    F0 F2 −(F1 )
                                                                                          ∗   ∗      ∗ 2  + o p (1)
                                                 0 2        1
                                                 ν2                                    ν1
                                                                                                          `1´ !
                                                    2
                                          (ν0 ν2 −ν1 )f (c)
                                                              +  o p (1)    − (ν  ν   −ν 2 )f (c)h + op h
                                 =                ν1
                                                                                0   2    1 `
                                                               + op h1                  Op h12
                                                                       ` ´                         ´
                                        − (ν ν −ν   2
                                            0 2    1 )f (c)h

                                         Op`(1)´ Op` h1 ´
                                      „                     ` ´ «
                                 =                                      .
                                        Op ( h1       Op h12

Next
                                            op `h2 ´
        ˛       ˛                  „    « „    ` ´ «
        ˛1 0                         F3
        ˛ R W T ˛ = sup m(3) (x) ·
                ˛
                                         =           .
        ˛N      ˛    x               F4     op h3


                                                                           19
Thus
                                                          „ «
                                                           1
       e01 (R0 W R)−1 R0 W T = Op (1) · op (h2 ) + Op         · op (h3 ) = op h2 ,
                                                                             ` ´
                                                           h
implying

       B = e01 (R0 W R)−1 R0 W S + op(h2 ).

Similarly:
                                             PN
                                       1
                                                  Kh (Xi )Xi2                      ν2 h2 + op(h2 )
                                   „                          «                  „                 «
       1           1                                              1 (2)
         (R0 W S) = m(2) (0)           N     Pi=1               =   m   (0)f (0)                     .
       N           2                   1
                                       N
                                              N
                                              i=1 Kh (Xi )Xi
                                                            3
                                                                  2                ν3 h3 + op(h3 )

Therefore:
                                                                  ν22 − ν3 ν1
                                                              „                 «
                                                    1 (2)
       B = e01 (R0 W R)−1 R0 W S + op(h2 ) =          m (c)                         h2 + op (h2 ).
                                                    2             ν0 ν2 − ν12
This finishes the proof for the first part of the result in Lemma A.1, equation (A.1).
Next, we consider the expression for the conditional variance in (A.2).

       V = V(m̂(0)|X1 , . . . , XN ) = e01 (R0 W R)−1 R0 W ΣW R(R0 W R)−1 e1 ,

where Σ is the diagonal matrix with (i, i)th element equal to σ2 (Xi ).
Consider the middle term
                      „ 1 P 2
                                 Kh (Xi )σ2 (Xi )        1
                                                           P 2
                                                              Kh (Xi )Xi σ2 (Xi )
                                                                                     « „                            «
       1 0                 NP i                          NPi
                                                                                         G0                    G1
         R W ΣW R =      1        2             2        1      2         2 2         =                                 .
      N                  N    i K h (X i )X i σ   (X i ) n  i K h (X i )X i σ (X i )     G1                    G2

Thus we have:
                                         „                «„                 «„                       «
                          1                    F2   −F1        G0      G1                  F2   −F1
       NV     =                    e01                                                                    e1
                    (F0F2 − F12 )2            −F1   F0         G1      G2                 −F1   F0
                    F22 G0 − 2F1 F2 G1 + F12 G2
              =
                           (F0 F2 − F12 )2
Applying lemmas A.1 and A.2 this leads to
            σ2 (0)
                      „ 2
                       ν2 π0 − 2ν1 ν2 π1 + ν12 π2
                                                  «      „    «
                                                            1
      V =           ·                               + op        .
           f (0)N h          (ν0 ν2 − ν12 )2               Nh
This finishes the proof for the statement in (A.2). The final result in (A.3) follows directly from the first two
results. 

Proof of Lemma 3.1: Applying Lemma A.1 to the N+ units with Xi ≥ c, implies that
                                         1/2 (2)
     E [ µ̂+ − µ+ | X1 , . . . , XN ] = C1 m+ (c)h2 + op h2 ,
                                                        ` ´

and
                                                    2                  „          «
                                                   σ+ (c)                   1
       V ( µ̂+ − µ+ | X1 , . . . , XN ) = C2                  + op                    .
                                               fX|X≥c (c)N+ h              N+ h

Because N+ /N = pr(Xi ≥ c)+O(1/N ), and fX|X≥c(x) = f (x)/Pr(Xi ≥ c) (and thus fX|X≥c(c) = f+ (c)/Pr(Xi ≥
c)), it follows that
                                                 2           „    «
                                               σ+  (c)          1
        V ( µ̂+ − µ+ | X1 , . . . , XN ) = C2           + op        .
                                              f+ (c)N h        Nh
Conditional on X1 , . . . , XN the covariance between µ̂+ and µ̂− is zero, and thus, combining the results from
applying Lemma A.1 also to the units with Xi < c, we find

       E (τ̂RD − τRD )2 ˛ X1 , . . . , XN = E (µ̂+ − µ̂− − (µ̂+ − µ̂− ))2 ˛ X1 , . . . , XN
        ˆ                 ˛              ˜     ˆ                          ˛                 ˜


              = E (µ̂+ − µ+ )2 ˛ X1 , . . . , XN + E (µ̂− − µ− )2 ˛ X1 , . . . , XN
                  ˆ                 ˛            ˜  ˆ             ˛                  ˜



                                                                  20
                      −2 · E [ µ̂+ − µ+ | X1 , . . . , XN ] · E [ µ̂− − µ− | X1 , . . . , XN ]
                                                                    „ 2
                                                                               σ2 (c)
                                                                                          «       „          «
                          “
                              (2)         (2)
                                                  ”2       C2         σ+ (c)                             1
              = C1 · h4 · m+ (c) − m− (c) +                       ·          + −            . + op h4 +        ,
                                                         N ·h         f+ (c)   f−(c)                    N ·h
proving the first result in Lemma 3.1.
For the second part of Lemma 3.1, solve
                       „                                            „ 2                   2      ««
                                “
                                   (2)          (2)
                                                        ”2             σ+ (c)           σ−  (c)
       hopt = arg min C1 h4 m+ (c) − m− (c) + C2                                +                   ,
                    h                                                 f+ (c)N h f− (c)N h
which leads to
                                  0         2             2
                                                                    11/5
                                           σ+ (c)        σ− (c)
                 „
                     C2
                           «1/5
                                           f+ (c)
                                                     +   f− (c)
        hopt =                                                             N −1/5 .
                                  B                                  C
                                                                  ”2 A
                     4C1
                                  @“
                                        (2)               (2)
                                       m+ (c)       −    m− (c)


Motivation for the Bandwidth Choice in Equation (4.11) in Step 2 of bandwidth algorithm
Fan and Gijbels (1996 Theorem 3.2) give an asymptotic approximation to the MSE for an estimator of the
ν-th derivative of a regression function at a boundary point, using a p-th order local polynomial (using the
notation in Fan and Gijbels). Specializing this to our case, with the boundary point c, a uniform one-sided
kernel K(t) = 10≤t≤1 , and interest in the 2-nd derivative using a local quadratic approximation (ν = p = 2, their
MSE formula simplifies to
                „                                  2     «
                  1 2 “ (3) ”2 2               1 σ+  (c)
       M SE =       K1 m+ (c) h + 4K2                      (1 + op (1))
                  9                          N h5 f+ (c)
Here
               Z                                 Z
        K1 =       t3 K ∗(t)dt         K2 =          (K ∗(t))2 dt,

where
                   010 0                                1−1 0    1
                  0      µ0                 µ1       µ2       1                                                   Z
          ∗                                                                                                                                 1
        K (t) = @ 0 A @ µ1                  µ2       µ3 A @ t A · K(t),                           with µk =           qk K(q)dq =                ,
                                                                                                                                         (k + 1)
                  1      µ2                 µ3       µ4       t2
so that
                   010 0                                     1−1 0    1
                  0       1                    1/2       1/3       1
          ∗
        K (t) = @ 0 A @ 1/2                    1/3       1/4 A @ t A · K(t) = (30 − 180t + 180t2 ) · 1[0,1] ,
                  1      1/3                   1/4       1/5       t2
and therefore, K1 = 1.5 and K2 = 180. Thus
               „ “                          2     «
                 1    (3)
                           ”2          1 σ+   (c)
      M SE =        m+ (c) h2 + 720                 (1 + op (1)).
                 4                    N h5 f+ (c)
Minimizing this over h leads to
                       0                                     11/7                      0                              11/7
                                            2                                                         2
                                           σ+ (c)                    −1/7                            σ+ (c)                   −1/7
        h2,+ = 72001/7 · @                                          N+      ≈ 3.56 · @                                       N+      .
                         B                                   C                       B                               C
                                           “              ”2 A                                       “            ”2 A
                                                (3)                                                       (3)
                                  f+ (c)       m+ (c)                                       f+ (c)       m+ (c)

This is the expression in the text for h2,+ except for the addition of the 0.01 term that ensures the necessary
properties if the estimate of m(3) (c) converges to zero. 

Proof of Theorem 4.1: Before directly proving the three claims in the theorem, we make some preliminary
observations. Write
                                                0                              11/5
                                                                                             2σ2 (c)
        hopt = Copt · N −1/5 ,
                                                                 B                                                      C
                                                with Copt = CK · B
                                                                 @                    „“                                C
                                                                                                                   ”2 « A      ,
                                                                                            (2)            (2)
                                                                            f (c) ·        m+ (c) − m− (c)


                                                                            21
and
                                                           0                                                            11/5
                                                                                            2
                                                                                        2σ̂ (c)
       ĥopt = Ĉopt · N −1/5 ,
                                                         B                                                               C
                                       with Ĉopt = CK · B               „“                                         ”2 « C     .
                                                                                (2)           (2)
                                                         @                                                               A
                                                               fˆ(c) ·        m̂+ (c)   −   m̂− (c)   + r̂+ + r̂−

First we show that the various estimates of the functionals in Ĉopt , σ̂2 (c), fˆ(c), m̂+ (c) and m̂− (c) converge
                                                                                              (2)          (2)

                                                   (2)          (2)
to their counterparts in Copt , σ2 (c), f (c), m+ (c) and m− (c) Consider f(c).   ˆ      This is a histogram estimate of
density at c, with bandwidth h = CN        −1/5         ˆ
                                                . Hence f (c) is consistent for f (c) if f− (c) = f+ (c) = f (c), if the left
and righthand limit are equal, and for (f− (c) + f+ (c))/2 if they are different.
Next, consider σ̂2 (c). Because it is based on a bandwidth h = C · N −1/5 that converges to zero, it is consistent
for σ2 (c) if σ−
               2
                 (c) = σ+ 2
                            (c) = σ2 (c). If the two limiting variances are different, σ̂2 (c) is consistent for (σ−   2
                                                                                                                         (c) ·
           2
f− (c) + σ+ (c) · f+ (c))/(f+ (c) + f− (c)).
                     (2)
Third, consider m̂+ (c). This is a local quadratic estimate using a one sided uniform kernel. From Fan and
                                                                                  (2)           (2)
Gijbels (1996), Theorem 3.2, it follows that to guarantee consistency of m̂+ (c) for m+ (c) we need both
                                           ´−1
                                   N h52,+
                                  `
       h2,+ = op(1)        and                 = op (1).                                                                           (A.4)

Let m3 be the probability limit of m̂(3) (c). This probability limit need not be equal to m(3) (c), but it will exist
under the assumptions in Theorem 4.1. As long as this probability limit differs from zero, then h2,+ = Op (N −1/7 ),
                                                              (2)                         (2)
so that the two conditions in (A.4) are satisfied and m̂+ (c) is consistent for m+ (c).
                              2              4                                           2
Fourth, consider r̂+ = 720σ̂ (c)/(N2,+ h2,+ ). The numerator converges to 720σ̂ (c). The denominator is approx-
imately N2,+ · h42,+ = (C · N · h2,+ ) · C · N −4/7 = C · N 2/7 , so that the ratio is C · N −2/7 = op (1). A similar result
holds for r̂− .
Now we turn to the statements in Theorem 4.1. We will prove (iii), then (iv), and then (i) and (ii). First consider
           (2)       (2)                                                                         (2)       (2)
(iii). If m+ (c)−m− (c) differs from zero, then Copt is finite. Moreover, in that case (m̂+ (c)− m̂− (c))2 + r̂+ + r̂−
                 (2)        (2)    2
converges to (m̂+ (c) − m̂− (c)) , and Ĉopt converges to Copt . These two implications in turn lead to the result
that (ĥopt − hopt )/hopt = (Ĉopt − Copt )/Copt = op (1), finishing the proof for (iii).
Next, we prove (iv). Because hopt = Copt · N −1/5 , it follows that
                                           „                  «
                                                        1                              “       ”
        MSE (hopt ) = AMSE (hopt ) + o h4opt +                    = AMSE (hopt ) + o N −4/5 .
                                                     N · hopt

Because ĥopt = (Ĉopt /Copt ) · Copt N −1/5 , and Ĉopt /Copt → 1 it follows that
            “     ”             “     ”      “       ”
      MSE ĥopt = AMSE ĥopt + o N −4/5 .

Therefore
              “   “     ”             ”         “    “     ”              ”
       N 4/5 · MSE ĥopt − MSE (hopt ) = N 4/5 · AMSE ĥopt − AMSE (hopt ) + op (1),

and
          “     ”                                “   “     ”              ”
       MSE ĥopt − MSE (hopt )            N 4/5 · MSE ĥopt − MSE (hopt )
                                    =
               MSE (hopt )                     N 4/5 · MSE (hopt )
                        “        “    ”                  ”
                 N 4/5 · AMSE ĥopt − AMSE (hopt ) + op (1)
               =                                                   .
                           N 4/5 · AMSE (hopt ) + op (1)
                        “        “    ”                  ”
                 N 4/5 · AMSE ĥopt − AMSE (hopt )
               =                                           + op (1).
                           N 4/5 · AMSE (hopt )
Because N 4/5 · AMSE(hopt ) converges to a nonzero constant, all that is left to prove in order to establish (iii) is
that
             “      “      ”                ”
      N 4/5 · AMSE ĥopt − AMSE (hopt ) = op (1).                                                             (A.5)



                                                             22
Substituting in, we have
              “       “  ”               ”
       N 4/5 · AMSE ĥopt − AMSE (hopt )
                                                                                                  !„
                                                                                                      2        2     «
             “
               (2)      (2)
                             ”2 “                              ”         C2             C2           σ+ (c)   σ− (c)
       = C1 · m+ (c) − m− (c) · (N 1/5 hopt )4 − N 1/5 ĥopt )4 +                 −                ·        +
                                                                     N 1/5 · hopt   N 1/5 · ĥopt    f+ (c)   f−(c)
              = op(1),
because N 1/5 hopt − N 1/5 ĥopt = Copt − Ĉopt = op(1), so that A.5 holds, and therefore (iv) is proven.
Now we turn to (ii). Under the conditions for (ii), ĥopt = Ĉopt N −1/5 , with Ĉopt → Copt , a nonzero constant.
Then Lemma 3.1 implies that MSE(ĥopt ) is Op (ĥ4opt + N −1 ĥ−1opt ) = Op (N
                                                                               −4/5
                                                                                    so that τ̂RD − τRD = Op (N −2/5 .
                                                                                  −2/5
Finally, consider (i). If Assumption 3.6 holds, then τ̂RD − τRD = Op (N                ), and the result holds. Now
                                                  (2)        (2)
suppose Assumption 3.6 does not hold and m+ (c) − m+ (c) = 0. Because h2,+ = CN −1/7 , it follows that
r+ = CN −1 h−4 = CN −3/7 (with each time different constants C), it follows that ĥopt = C(N 3/7 )1/5 N −1/5 =
CN −4/35 , so that the MSE(h) = CN −24/35 + C̃N −31/35 = CN −16/35 (note that the leading bias term is now
O(h3 ) so that the square of the bias is O(h6 ) = O(N −24/25 )) and thus τ̂RD − τRD = Op (N −12/35 ). 




                                                         23
                                          References
Cook, T., (2008), ““Waiting for Life to arrive”: A history of the regression-discontinuity design in
   Psychology, Statistics and Economics,” Journal of Econometrics, 142, 636-654.
Cheng, M.-Y., Fan, J. and Marron, J.S., (1997), “On Automatic Boundary Corrections,” The
   Annals of Statistics, 25, 1691-1708.
Fan, J. and Gijbels, I., (1992), “Variable bandwidth and local linear regression smoothers,” The
    Annals of Statistics, 20, 2008-2036.
Fan, J. and Gijbels, I., (1996), Local polynomial modeling and its implications, Monographs on
    Statistics and Applied Probability 66, Chapman and Hall/CRC, Boca Raton, FL.
Frandsen, B., (2008), “A Nonparametric Estimator for Local Quantile Treatment Effects in the
   Regression Discontinuity Design,” Unpublished Working Paper, Dept of Economics, MIT.
Frölich, M., (2007), “Regression Discontinuity Design with Covariates,” IZA Discussion Paper 3024
    Bonn.
Frölich, M., and B. Melly, (2008), “Quantile Treatment Effects in the Regression Discontinuity
    Design,” IZA Discussion Paper 3638, Bonn.
Hahn, J., Todd, P., and Van Der Klaauw, W., (2001), “Regression discontinuity,” Econometrica,
   69(1), 201-209.
Imbens, G.W. and Lemieux, T., (2008), “Regression discontinuity designs,” Journal of Economet-
    rics, 142, 615-635.
Kalyanaraman, K., (2008), “Bandwidth selection for linear functionals of the regression function,”
    Working Paper, Harvard University Department of Economics, June, 2008.
Lee, D., (2008), “Randomized experiments from non-random selection in U.S. House elections,” Jour-
    nal of Econometrics, 142, 675-697.
Lee, D., and T. Lemieux, (2009), “Regression Discontinuity Designs in Economics,” Working Paper,
    Dept of Economics, Princeton University.
Li, K.-C., (1987), “Asymptotic Optimality for Cp, CL , Cross-validation and Generalized Cross-
    validation: Discrete Index Set,”The Annals of Statistics, vol. 15(3), 958-975.
Ludwig, J. and Miller, D., (2005), “Does Head Start Improve Children’s Life Chances? Evidence
   from a Regression Discontinuity Design,” NBER Working Paper 11702.
Ludwig, J. and Miller, D., (2007), “Does Head Start Improve Children’s Life Chances? Evidence
   from a Regression Discontinuity Design,” Quarterly Journal of Economics.
McCrary, J., (2008), “Manipulation of the running variable in the regression discontinuity design: A
   density test,” Journal of Econometrics, 142, 698-714.
Porter, J., (2003), “Estimation in the Regression Discontinuity Model,” Working Paper, Harvard
   University Department of Economics, draft date September 25, 2003.
Powell, J., and T. Stoker, (1996), “Optimal Bandwidth Choice for Density Weighted Averages,”
   Journal of Econometrics, Vol 75, 291-316
Ruppert, D. and Wand, M.P., (1994), “Multivariate locally weighted least squares regression,” The
   Annals of Statistics, 22, 1346-1370
Shadish, W., T. Campbell and D. Cook, (2002), Experimental and Quasi-experimental Designs
    for Generalized Causal Inference, Houghton and Mifflin, Boston.



                                                24
Stone, C., (1982), “Optimal global rates of convergence for nonparametric regression,” The Annals
    of Statistics, 10, 1040-1053
Thistlewaite, D., and Campbell, D., (1960), “Regression-discontinuity analysis: an alternative to
    the ex-post facto experiment,” Journal of Educational Psychology, 51, 309-317.
Van Der Klaauw, W., (2008), “Regression–Discontinuity Analysis: A Survey of Recent Develop-
    ments in Economics,”Labour, 22(2): 219-245.




                                              25
                     Table 1: Lee Data: RD estimates and bandwidths

Procedure                        h        τ̂RD    (s.e.)

ĥopt                          0.2649    0.0782   0.0083
h̃opt (no regularization)      0.2892    0.0798   0.0079
ĥcv                           0.2231    0.0754   0.0090
Linear                         global    0.1182   0.0065
Quadratic                      global    0.0519   0.0088
Cubic                          global    0.1115   0.0136



                                     Table 2: Simulation results

                   N=100                                          N=500
                ĥ       τ̂RD                                  ĥ       τ̂RD
            MEAN STD BIAS RMSE                             MEAN STD BIAS RMSE

Design I
h∗            1.16       –        0.03     0.12             0.89    –     0.02    0.06
hopt          0.28       –        0.03     0.20             0.21    –     0.03    0.10
ĥopt         0.43      0.12      0.04     0.18             0.44   0.12   0.04    0.08
h̃opt         0.65      0.48      0.04     0.17             0.69   0.63   0.04    0.08
ĥcv          0.90      0.81      0.03     0.22             0.41   0.45   0.03    0.10

Design II
h∗            0.57       –        0.04     0.15             0.49    –      0.01   0.07
hopt          0.74       –        0.11     0.18             0.54    –      0.03   0.07
ĥopt         0.43      0.12     -0.00     0.18             0.42   0.10   -0.01   0.08
ĥnoreg       0.65      0.55      0.06     0.21             0.62   0.45    0.05   0.14
ĥcv          0.23      0.09     -0.03     0.25             0.20   0.03   -0.04   0.11




                                                   26
                                   Fig 1: Density for Forcing Variable
   2

  1.5

   1

  0.5

   0
   −1       −0.8   −0.6    −0.4       −0.2         0        0.2          0.4    0.6   0.8    1

                               Fig 2: Regression Function for Margin
   1

  0.8

  0.6

  0.4

  0.2

   0
   −1       −0.8   −0.6    −0.4       −0.2         0        0.2          0.4    0.6   0.8    1

                     Fig 3: RD Estimates and Confidence Intervals by Bandwidth
 0.15


  0.1


 0.05


   0
        0   0.05    0.1     0.15        0.2     0.25        0.3          0.35   0.4   0.45   0.5
                                              bandwidth
                          Fig 4: Ludwig−Miller Crossvalidation (delta=0.5)
 0.05


0.045


 0.04



        0    0.1    0.2     0.3         0.4      0.5        0.6          0.7    0.8   0.9    1
                                              bandwidth
